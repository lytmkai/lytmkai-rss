<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Apifox CLI + Claude Skillsï¼šå°†æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•èå…¥ç ”å‘å·¥ä½œæµ]]></title>    <link>https://juejin.cn/post/7594722586732445702</link>    <guid>https://juejin.cn/post/7594722586732445702</guid>    <pubDate>2026-01-14T05:59:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594722586732445702" data-draft-id="7594863660296585258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apifox CLI + Claude Skillsï¼šå°†æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•èå…¥ç ”å‘å·¥ä½œæµ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,æµ‹è¯•"/> <meta itemprop="datePublished" content="2026-01-14T05:59:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Apifox"/> <meta itemprop="url" content="https://juejin.cn/user/2766843870448222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apifox CLI + Claude Skillsï¼šå°†æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•èå…¥ç ”å‘å·¥ä½œæµ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2766843870448222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Apifox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T05:59:55.000Z" title="Wed Jan 14 2026 05:59:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡æ—¨åœ¨ä»‹ç»å¦‚ä½•å°† Apifox CLI ä¸ Claude Skills ç»“åˆï¼Œå®ç° <strong>ã€Œè‡ªç„¶è¯­è¨€è§¦å‘æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ã€</strong> çš„é«˜æ•ˆå·¥ä½œæµã€‚</p>
<p>åœ¨è¿™å¥—å·¥ä½œæµä¸­ï¼Œä½ åªéœ€è¦åœ¨ç»ˆç«¯é‡Œå¯¹ Claude Code è¯´ä¸€å¥è¯ï¼Œä¾‹å¦‚ï¼šâ€œç”¨å¼€å‘ç¯å¢ƒè·‘ä¸€ä¸‹æ”¯ä»˜æµç¨‹çš„æµ‹è¯•â€ã€‚</p>
<p>Claude Code å°±ä¼šè‡ªåŠ¨è¯†åˆ«ä½ çš„æ„å›¾ï¼Œå®šä½å¯¹åº”çš„â€œæµ‹è¯•åœºæ™¯â€æˆ–â€œæµ‹è¯•å¥—ä»¶â€æ¥æ‰§è¡Œæµ‹è¯•ã€‚æµ‹è¯•å®Œæˆåï¼Œå®ƒä¼šå¯¹æ‰§è¡Œç»“æœè¿›è¡Œæ•´ç†å’Œè§£è¯»ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3a558498a3344dca956668361768aa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=xdfNolY8dovPXONhZ2Js3gSQ9E4%3D" alt="" loading="lazy"/></p>
<p>è¿™å¥—æµç¨‹ç”±ä¸‰ä¸ªå·¥å…·ç»„æˆï¼š</p>
<ul>
<li>
<p><strong>Apifox CLIï¼š</strong> Apifox çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ç”¨äºåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ CLI å‘½ä»¤ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€‚</p>
</li>
<li>
<p><strong>Claude Codeï¼š</strong> Anthropic æ¨å‡ºçš„å‘½ä»¤è¡Œ AI åŠ©æ‰‹ã€‚å¯ä»¥åœ¨ç»ˆç«¯æ“ä½œæ–‡ä»¶ã€è¿è¡Œå‘½ä»¤ã€æ‰§è¡Œè„šæœ¬ç­‰ã€‚</p>
</li>
<li>
<p><strong>Claude Skillsï¼š</strong> ä¹Ÿç§° Agent Skillsï¼Œæ˜¯ Claude Code çš„æ‰©å±•åŠŸèƒ½ã€‚å®ƒå¯ä»¥å®šä¹‰ Claude å¦‚ä½•å®Œæˆç‰¹å®šä»»åŠ¡ï¼Œç›¸å½“äºä¸€ä»½å¯æ‰§è¡Œçš„æ“ä½œè¯´æ˜ã€‚</p>
</li>
</ul>
<p>åœ¨è¿™å¥—æµç¨‹ä¸­ï¼ŒClaude Code è´Ÿè´£ç†è§£è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œè‹¥â€œæŒ‡ä»¤â€åŒ¹é…åˆ°æœ¬å·¥ä½œæµä¸­é¢„ç½®çš„ Claude Skills åï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œ Apifox CLI å‘½ä»¤å¹¶åˆ†ææ‰§è¡Œç»“æœã€‚</p>
<h2 data-id="heading-0">è¿™å¥—æµç¨‹èƒ½åšä»€ä¹ˆ</h2>
<p>ä¸‹é¢é€šè¿‡å‡ ä¸ªå®é™…æ“ä½œåœºæ™¯ï¼Œç›´è§‚äº†è§£è¿™å¥—å·¥ä½œæµçš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<h3 data-id="heading-1">æ‰§è¡Œå•ä¸ªæµ‹è¯•</h3>
<p>å¦‚æœæƒ³æ‰§è¡Œç‰¹å®šçš„æµ‹è¯•åœºæ™¯ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šã€‚ä¾‹å¦‚ï¼Œåœ¨ Claude Code è¾“å…¥ï¼šâ€œå¸®æˆ‘è·‘ä¸€ä¸‹ç™»å½•åŠŸèƒ½çš„æµ‹è¯•ï¼Œç”¨å¼€å‘ç¯å¢ƒâ€ï¼Œæµ‹è¯•å®Œæˆå Claude ä¼šåˆ†æç»“æœå¹¶ç»™å‡ºæ€»ç»“ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1a25fc4aac84dcfbb26bef70028716e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=dL%2FObeVCQfSUPM2ECoeCOMprUhk%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœæµ‹è¯•å¤±è´¥ï¼ŒClaude ä¼šåˆ†æå¤±è´¥åŸå› ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8568637529ad45efb69673b6a8451086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=LgFWtuSfWybhW%2BvpQh%2BVQv8wQxk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æµ‹è¯•</h3>
<p>å¦‚æœæƒ³çŸ¥é“æœ‰å“ªäº›æµ‹è¯•åœºæ™¯æˆ–æµ‹è¯•å¥—ä»¶ï¼Œå¯ä»¥é—®ï¼šâ€œæœ‰å“ªäº›æµ‹è¯•å¯ä»¥æ‰§è¡Œï¼Ÿâ€ã€‚Claude å°±ä¼šè¿è¡Œç›¸å…³çš„è„šæœ¬ï¼ŒæŠŠæ‰€æœ‰æµ‹è¯•åˆ—å‡ºæ¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/118b3a31402d4e10bedcb023f932e168~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=X0q2pJgIiiQIyUZ19qWkd6sRsAE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">æ‰§è¡ŒæŸä¸ªä¸šåŠ¡æ¨¡å—çš„æ‰€æœ‰æµ‹è¯•</h3>
<p>æƒ³æ‰§è¡ŒæŸä¸ªä¸šåŠ¡æ¨¡å—çš„æ‰€æœ‰æµ‹è¯•ï¼Œä¾‹å¦‚æƒ³ä¸€æ¬¡è·‘å®Œæ”¯ä»˜ç›¸å…³çš„æµ‹è¯•ï¼Œå¯ä»¥è¯´ï¼šâ€œç”¨æµ‹è¯•ç¯å¢ƒè·‘ä¸€ä¸‹æ”¯ä»˜ç›¸å…³çš„æ‰€æœ‰æµ‹è¯•â€ã€‚Claude ä¼šè‡ªåŠ¨æ‰¾åˆ°æ‰€æœ‰ç›¸å…³æµ‹è¯•æ–‡ä»¶å¹¶ä¾æ¬¡æˆ–è€…å¹¶è¡Œæ‰§è¡Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e188a6d3d144fa9ab3104931f0ce6a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=gbQDpQ82v447%2BL80%2BSt73Ho5juE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">å¯¹æ¯”ä¸åŒç¯å¢ƒçš„æµ‹è¯•ç»“æœ</h3>
<p>å¦‚æœéœ€è¦å¯¹æ¯”ä¸åŒè¿è¡Œç¯å¢ƒçš„æµ‹è¯•ç»“æœï¼Œå¯ä»¥è¯´ï¼šâ€œç”¨å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒè·‘ä¸€ä¸‹ç™»å½•åŠŸèƒ½çš„æµ‹è¯•â€ã€‚Claude ä¼šåœ¨ä¸¤ä¸ªç¯å¢ƒä¸‹æ‰§è¡Œæµ‹è¯•ï¼Œå¹¶å¸®ä½ åˆ†æç»“æœå·®å¼‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d05442e6a70144c7bb1b5fa9ddd019a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=1qA7jR0luxTfhUzmGPwVsCKXtVU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">æ ¹æ®ä»£ç å˜æ›´æ‰§è¡Œæµ‹è¯•</h3>
<p>å½“ä»£ç æœ‰æ›´æ–°æ—¶ï¼Œå¯ä»¥è®© Claude åªæ‰§è¡Œå—å½±å“çš„æµ‹è¯•åœºæ™¯æˆ–æµ‹è¯•å¥—ä»¶ã€‚ä¾‹å¦‚ï¼šâ€œæ ¹æ®æœ€è¿‘çš„ä»£ç å˜æ›´ï¼Œåœ¨å¼€å‘ç¯å¢ƒè·‘ä¸€ä¸‹å—å½±å“çš„æ¥å£æµ‹è¯•â€ã€‚Claude ä¼šæ ¹æ® Git åˆ†æå˜æ›´æ–‡ä»¶ï¼Œå¹¶é€‰æ‹©å¯¹åº”æµ‹è¯•æ‰§è¡Œï¼ŒèŠ‚çœæ—¶é—´å’Œèµ„æºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/361b7a9f39c64d6f9367fbe960df0744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=UUFarDsw1HyA87Te7UHT3WAFFNY%3D" alt="" loading="lazy"/></p>
<p>å…¶å®ƒæ›´å¤šåœºæ™¯ï¼Œéœ€è¦ä½ æ¥æ¢ç´¢......</p>
<p>ä¸‹é¢å°†ä¾æ¬¡ä»‹ç» Apifox CLIã€Claude Code å’Œ Claude Skills çš„å®‰è£…å’Œæ„å»ºæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒä»¬ç»„åˆä½¿ç”¨ï¼Œæœ€ç»ˆè·‘é€šè¿™å¥—å·¥ä½œæµã€‚</p>
<h2 data-id="heading-6">å‡†å¤‡å·¥ä½œ</h2>
<h3 data-id="heading-7">ç¯å¢ƒè¦æ±‚</h3>
<p>ç¡®ä¿ç”µè„‘ä¸Šè£…äº† Node ç¯å¢ƒï¼Œå¯æ‰“å¼€ç»ˆç«¯éªŒè¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node -v
npm -v
</code></pre>
<h3 data-id="heading-8">å®‰è£… Apifox CLI</h3>
<p>é€šè¿‡ npm å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g apifox-cli

apifox --version
</code></pre>
<p>çœ‹åˆ°ç‰ˆæœ¬å·è¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p>å¯ä»¥åˆ° Apifox çš„ã€Œè‡ªåŠ¨åŒ–æµ‹è¯• -&gt; CI/CDã€ä¸­ï¼Œå¤åˆ¶ä¸€ä¸ªâ€œæµ‹è¯•åœºæ™¯â€æˆ–è€…â€œæµ‹è¯•å¥—ä»¶â€çš„ CLI å‘½ä»¤åˆ°ç»ˆç«¯æ‰§è¡Œï¼Œè®°å¾—æ·»åŠ  Access Tokenã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6037f2c1b1454a8a822db2903f764cc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=suDTVVy39ceu%2B5CM6jQdBduV8ak%3D" alt="" loading="lazy"/></p>
<p>çœ‹åˆ°æµ‹è¯•è¾“å‡ºå°±è¯´æ˜ Apifox CLI èƒ½æ­£å¸¸å·¥ä½œäº†ã€‚</p>
<blockquote>
<p>ğŸ’¡ éœ€è¦å°† Apifox å®¢æˆ·ç«¯å’Œ Apifox CLI æ›´æ–°åˆ°æœ€æ–°ç‰ˆï¼Œæ‰èƒ½ä½¿ç”¨æœ€æ–°çš„â€œæµ‹è¯•å¥—ä»¶â€åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-9">å®‰è£… Claude Code</h3>
<p>é€šè¿‡ npm å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code

claude --version
</code></pre>
<p>é¦–æ¬¡è¿è¡Œéœ€è¦ç™»å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude
</code></pre>
<p>æŒ‰ç…§æç¤ºå®Œæˆæˆæƒï¼Œéœ€è¦ Claude è´¦å· <em><span>ï¼ˆå¯ä»¥é€šè¿‡æŸé±¼æˆ–ä¸€äº›ä¸­è½¬ç«™è§£å†³è´¦å·é—®é¢˜ï¼‰</span></em> ã€‚ç™»å½•åä¼šè¿›å…¥å¯¹è¯ç•Œé¢ï¼Œè¯•è¯•é—®ä¸€äº›é—®é¢˜ï¼ŒClaude ä¼šç»™å‡ºå›ç­”ã€‚</p>
<p>ç°åœ¨ Claude è¿˜ä¸çŸ¥é“æ€ä¹ˆè·‘ Apifox æµ‹è¯•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ Claude Skills æ¥æ•™ä¼šå®ƒã€‚</p>
<h2 data-id="heading-10">Claude Skills çš„æ„å»º</h2>
<h3 data-id="heading-11">ç†è§£ Skills çš„å·¥ä½œåŸç†</h3>
<p>ä½¿ç”¨ Claude Code æ—¶ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šè¦ä½¿ç”¨çš„ Skillã€‚ä½ åªéœ€è¦ç”¨ä¸€å¥è¯æè¿°ä½ æƒ³åšçš„äº‹ï¼ŒClaude ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ Skill æ¥å®Œæˆã€‚</p>
<p>åªè¦ä½ è¾“å…¥çš„è‡ªç„¶è¯­è¨€ä¸æŸä¸ª Skill çš„æè¿°ç›¸åŒ¹é…ï¼ŒClaude å°±ä¼šåŠ è½½è¯¥ Skillï¼Œå¹¶æŒ‰ç…§å…¶ä¸­å®šä¹‰çš„æµç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h3 data-id="heading-12">æ­¥éª¤ 1ï¼šåˆ›å»º Skill ç›®å½•</h3>
<p>Skills çš„é…ç½®æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨ <code>.claude/skills/</code> ç›®å½•ä¸‹ï¼Œæ¯ä¸ª Skill å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„å­ç›®å½•ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¸º Apifox è‡ªåŠ¨åŒ–æµ‹è¯•åˆ›å»ºä¸€ä¸ªæœ€å°å¯ç”¨çš„ Skill ç›®å½•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p .claude/skills/apifox-tests
</code></pre>
<p>æ‰§è¡Œå®Œæˆåï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">.claude/skills/apifox-tests/
</code></pre>
<p>åç»­æˆ‘ä»¬ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œé€æ­¥æ·»åŠ  Skill çš„å…¥å£æ–‡ä»¶å’Œæ‰§è¡Œè„šæœ¬ç­‰å†…å®¹ã€‚</p>
<h3 data-id="heading-13">æ­¥éª¤ 2ï¼šåˆ›å»º SKILL.md</h3>
<p>æ¯ä¸ª Skill éƒ½éœ€è¦ä¸€ä¸ª <code>SKILL.md</code> æ–‡ä»¶ï¼Œç”¨æ¥è¯´æ˜å½“è¿™ä¸ª Skill è¢«åŒ¹é…åˆ°æ—¶ï¼ŒClaude åº”è¯¥å¦‚ä½•ä¸€æ­¥æ­¥å®Œæˆä»»åŠ¡ã€‚</p>
<p><code>SKILL.md</code> ä»¥ <code>---</code> åŒ…è£¹çš„ YAML å…ƒä¿¡æ¯å¼€å§‹ï¼Œå…¶ä¸­ <code>name</code> å’Œ <code>description</code> æ˜¯å¿…éœ€å­—æ®µã€‚</p>
<p><code>description</code> å°¤å…¶é‡è¦ï¼Œå®ƒç”¨äºå¸®åŠ© Claude åˆ¤æ–­åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥å¯ç”¨è¿™ä¸ª Skillï¼Œæ‰€ä»¥è¿™é‡Œè¦æ ¹æ®ä½ çš„ä¸šåŠ¡å†™è§¦å‘æ¡ä»¶ã€‚</p>
<p>åœ¨ YAML ä¹‹åçš„ Markdown å†…å®¹ä¸­ï¼Œåˆ™ç”¨äºæè¿°è¿™ä¸ª Skill è¢«å¯ç”¨åï¼ŒClaude å…·ä½“åº”è¯¥æ€ä¹ˆåšï¼ŒåŒ…æ‹¬åˆ¤æ–­é€»è¾‘ã€æ‰§è¡Œæ­¥éª¤ã€å¼•ç”¨çš„è„šæœ¬ã€ä»¥åŠéœ€è¦éµå¾ªçš„çº¦æŸè§„åˆ™ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ç›´æ¥ä½¿ç”¨çš„ <code>SKILL.md</code> ç¤ºä¾‹ï¼Œç”¨äºå®šä¹‰ Apifox è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: apifox-tests
<span class="hljs-section">description: æ‰§è¡Œå’Œè§£è¯» Apifox è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚è§¦å‘åœºæ™¯ï¼š(1) ä¿®æ”¹ä»£ç åéœ€è¦éªŒè¯æ¥å£å¯ç”¨æ€§ (2) git commit/push å‰çš„æ¥å£æ£€æŸ¥ (3) å‘å¸ƒç‰ˆæœ¬å‰çš„å›å½’æµ‹è¯• (4) ç”¨æˆ·æ˜ç¡®è¦æ±‚è¿è¡Œ Apifox æµ‹è¯•ï¼Œæˆ–ç”¨å…·ä½“ç¯å¢ƒè·‘ç›¸å…³æµ‹è¯• (5) åˆå¹¶åˆ° main åˆ†æ”¯å‰çš„è‡ªåŠ¨åŒ–æ£€æŸ¥ã€‚é€‰æ‹©åˆé€‚çš„æµ‹è¯•åœºæ™¯æˆ–è€…æµ‹è¯•å¥—ä»¶ï¼Œæ‰§è¡Œæµ‹è¯•å¹¶è§£é‡Šç»“æœï¼Œä½†ä¸ä¿®æ”¹æµ‹è¯•æˆ–å‘½ä»¤æœ¬èº«ã€‚
---</span>

<span class="hljs-section"># Apifox Tests</span>

æ‰§è¡Œ Apifox è‡ªåŠ¨åŒ–æµ‹è¯•å¹¶è§£é‡Šç»“æœã€‚

<span class="hljs-section">## å·¥ä½œæµç¨‹</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**é€‰æ‹©æµ‹è¯•**</span>ï¼š

<span class="hljs-bullet">-</span> å¦‚æœç”¨æˆ·åœ¨å¯¹è¯ä¸­æ˜ç¡®æä¾›äº†ï¼š
<span class="hljs-bullet">  -</span> æµ‹è¯•æ–‡ä»¶è·¯å¾„
<span class="hljs-bullet">  -</span> æµ‹è¯•æ–‡ä»¶å
<span class="hljs-bullet">  -</span> æˆ–æ¸…æ™°å¯å”¯ä¸€åŒ¹é…çš„æµ‹è¯•åç§°
<span class="hljs-bullet">-</span> ç›´æ¥ä½¿ç”¨è¯¥æµ‹è¯•ï¼Œä¸å†è¿›è¡Œè‡ªåŠ¨é€‰æ‹©
<span class="hljs-bullet">-</span> è‹¥ä¿¡æ¯ä¸æ˜ç¡®ï¼Œåº”ä¼˜å…ˆé€šè¿‡è¿è¡Œ <span class="hljs-code">`node ./.claude/skills/apifox-tests/scripts/list-tests.js`</span> è„šæœ¬æ¥å¿«é€Ÿè·å–æ‰€æœ‰çš„æµ‹è¯•æ–‡ä»¶è·¯å¾„åŠæè¿°ã€‚
<span class="hljs-bullet">-</span> é¿å…åœ¨åºå¤§çš„é¡¹ç›®ç›®å½•ä¸­è¿›è¡Œç›²ç›®çš„å…¨å±€æœç´¢ï¼Œç›´æ¥å®šä½åˆ°è¯¥ Skill ä¸“ç”¨çš„æµ‹è¯•æ–‡ä»¶ç›®å½• <span class="hljs-code">`tests/`</span>ã€‚

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**å¤šæµ‹è¯•æ‰§è¡Œè§„åˆ™**</span>

<span class="hljs-bullet">-</span> é»˜è®¤åªæ‰§è¡Œä¸€ä¸ªæµ‹è¯•ï¼Œä½†éœ€ç»™å‡ºæ˜¯å¦æ‰¹é‡æ‰§è¡Œçš„é€‰æ‹©
<span class="hljs-bullet">-</span> å¦‚æœç”¨æˆ·æ˜ç¡®è¡¨ç¤ºï¼š
<span class="hljs-bullet">  -</span> â€œè·‘è¿™å‡ ä¸ªâ€
<span class="hljs-bullet">  -</span> â€œå…¨éƒ¨è·‘ä¸€éâ€
<span class="hljs-bullet">-</span> åˆ™è¿›å…¥ <span class="hljs-strong">**æ‰¹é‡æ‰§è¡Œæ¨¡å¼**</span>

æ‰¹é‡æ‰§è¡Œæ¨¡å¼ä¸‹ï¼š
<span class="hljs-bullet">-</span> æ˜ç¡®åˆ—å‡ºå°†è¦æ‰§è¡Œçš„æµ‹è¯•åˆ—è¡¨
<span class="hljs-bullet">-</span> <span class="hljs-strong">**è¯¢é—®æ‰§è¡Œæ–¹å¼**</span>ï¼šè®©ç”¨æˆ·é€‰æ‹© â€œæŒ‰é¡ºåºæ‰§è¡Œâ€ (æ›´æ˜“è¯») æˆ– â€œå¹¶è¡Œæ‰§è¡Œâ€ (é€Ÿåº¦å¿«)ã€‚
<span class="hljs-bullet">  -</span> <span class="hljs-strong">**æŒ‰é¡ºåºæ‰§è¡Œ**</span>ï¼šé€ä¸ªè¿è¡Œæµ‹è¯•å¹¶å³æ—¶åˆ†æï¼Œé€‚åˆè°ƒè¯•ã€‚
<span class="hljs-bullet">  -</span> <span class="hljs-strong">**å¹¶è¡Œæ‰§è¡Œ**</span>ï¼šåŒæ—¶å¯åŠ¨å¤šä¸ªæµ‹è¯•ï¼ˆä½¿ç”¨ <span class="hljs-code">`&amp;`</span> ç»“å°¾æˆ–è„šæœ¬å¹¶å‘ï¼‰ï¼Œé€‚åˆå¿«é€Ÿå›å½’ï¼Œä½†æ—¥å¿—å¯èƒ½ä¼šäº¤ç»‡ã€‚
<span class="hljs-bullet">-</span> è¯·æ±‚ç”¨æˆ·ç¡®è®¤æ‰§è¡Œæ–¹å¼åŠæµ‹è¯•åˆ—è¡¨ï¼ˆæ˜¯ / å¦ï¼‰
<span class="hljs-bullet">-</span> æŒ‰é€‰æ‹©çš„æ–¹å¼æ‰§è¡Œæµ‹è¯•
<span class="hljs-bullet">-</span> æœ€ç»ˆæ±‡æ€»æˆ–ä¾æ¬¡è§£é‡Šæ¯ä¸ªæµ‹è¯•çš„ç»“æœ

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**ç¡®è®¤ç¯å¢ƒ**</span>ï¼š
<span class="hljs-bullet">-</span> æ”¯æŒçš„ç¯å¢ƒåŒ…æ‹¬ï¼š
<span class="hljs-bullet">  -</span> <span class="hljs-code">`dev`</span>
<span class="hljs-bullet">  -</span> <span class="hljs-code">`test`</span>
<span class="hljs-bullet">  -</span> <span class="hljs-code">`prod`</span>
<span class="hljs-bullet">-</span> å¦‚ç”¨æˆ·æœªæ˜ç¡®æŒ‡å®šç¯å¢ƒï¼š
<span class="hljs-bullet">  -</span> åˆ—å‡ºä¸Šè¿°ç¯å¢ƒå
<span class="hljs-bullet">  -</span> è®©ç”¨æˆ·ç¡®è®¤ä½¿ç”¨å“ªä¸€ä¸ª

<span class="hljs-bullet">4.</span> <span class="hljs-strong">**æ‰§è¡Œæµ‹è¯•**</span>ï¼š
<span class="hljs-bullet">-</span> åœ¨ä»¥ä¸‹ä¿¡æ¯æ˜ç¡®åæ‰§è¡Œæµ‹è¯•ï¼š
<span class="hljs-bullet">  -</span> æµ‹è¯•æ–‡ä»¶è·¯å¾„
<span class="hljs-bullet">  -</span> ç¯å¢ƒåï¼ˆdev / test / prodï¼‰
<span class="hljs-code">```bash
node ./.claude/skills/apifox-tests/scripts/run-cli.js &lt;æµ‹è¯•æ–‡ä»¶è·¯å¾„&gt; &lt;ç¯å¢ƒå&gt;
```</span>

<span class="hljs-bullet">5.</span> <span class="hljs-strong">**è§£é‡Šç»“æœ**</span>ï¼šåˆ†æ Apifox CLI è¾“å‡ºï¼Œè§£é‡Šå¤±è´¥åŸå› 

<span class="hljs-section">## å¤±è´¥å¤„ç†</span>

<span class="hljs-bullet">-</span> ä¸ä¿®æ”¹æµ‹è¯•æ–‡ä»¶
<span class="hljs-bullet">-</span> ä¸ä¿®æ”¹æ‰§è¡Œå‘½ä»¤
<span class="hljs-bullet">-</span> åŸºäºæµ‹è¯•åç§°ã€æ¥å£è¯­ä¹‰å’Œ CLI è¾“å‡ºè§£é‡Šå¤±è´¥åŸå› 

</code></pre>
<h3 data-id="heading-14">æ­¥éª¤ 3ï¼šè¡¥å…… Skill æ‰€éœ€çš„æ”¯æŒæ–‡ä»¶</h3>
<p>åœ¨å‰é¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº† <code>SKILL.md</code>ï¼Œç”¨äºå®šä¹‰è¿™ä¸ª Skill çš„è§¦å‘æ¡ä»¶å’Œæ•´ä½“æ‰§è¡Œæµç¨‹ã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå…¶ä½™æ–‡ä»¶éƒ½åªæ˜¯å¯¹ <code>SKILL.md</code> çš„è¡¥å……ï¼Œå½“æµç¨‹ä¸­éœ€è¦å…¶å®ƒä¿¡æ¯ï¼Œæ¯”å¦‚è¿è¡Œç¯å¢ƒã€æ‰§è¡Œå‘½ä»¤æˆ–æµ‹è¯•å®šä¹‰æ—¶ï¼Œå†æŒ‰éœ€å¼•å…¥å¯¹åº”çš„æ–‡ä»¶å³å¯ã€‚</p>
<p>æœ€ç»ˆï¼Œè¿™ä¸ª Skill çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">.claude/skills/apifox-tests/
â”œâ”€â”€ SKILL.md              # Skill å…¥å£ï¼Œå®šä¹‰è§¦å‘æ¡ä»¶å’Œæ•´ä½“æµç¨‹
â”œâ”€â”€ env/                  # è¿è¡Œç¯å¢ƒé…ç½®ï¼ˆå¦‚ dev / test / prodï¼‰ï¼Œç”¨äºåŒºåˆ†ä¸åŒæµ‹è¯•ç¯å¢ƒ
â”‚   â”œâ”€â”€ dev.env           # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ test.env          # æµ‹è¯•ç¯å¢ƒ
â”‚   â””â”€â”€ prod.env          # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ scripts/              # æ‰§è¡Œè„šæœ¬ï¼ˆè¢« SKILL.md è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ list-tests.js     # åˆ—å‡º tests ç›®å½•ä¸‹çš„æ‰€æœ‰æµ‹è¯•
â”‚   â””â”€â”€ run-cli.js        # è´Ÿè´£ç»„è£…å¹¶æ‰§è¡Œ Apifox CLI å‘½ä»¤
â””â”€â”€ tests/                # æµ‹è¯•å®šä¹‰ï¼ˆæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªæµ‹è¯•åœºæ™¯æˆ–æµ‹è¯•å¥—ä»¶ï¼‰
    â”œâ”€â”€ æ”¯ä»˜æµç¨‹.md        
    â””â”€â”€ é€€æ¬¾æµç¨‹.md        
</code></pre>
<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™äº›æ”¯æŒæ–‡ä»¶çš„ä½œç”¨å’Œç¤ºä¾‹ã€‚</p>
<h4 data-id="heading-15">ç¯å¢ƒé…ç½®ï¼ˆenvï¼‰</h4>
<p><code>env/</code> ç›®å½•ç”¨äºå­˜æ”¾ä¸åŒè¿è¡Œç¯å¢ƒå¯¹åº”çš„å˜é‡é…ç½®ï¼Œä¾‹å¦‚ Apifox çš„è®¿é—®ä»¤ç‰Œ <em><span>ï¼ˆAccess Tokenï¼‰</span></em> å’Œç¯å¢ƒ IDã€‚</p>
<p>å°†ç¯å¢ƒ ID æŠ½ç¦»ä¸ºå˜é‡ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸æ”¹ä»»ä½•å‘½ä»¤æˆ–è„šæœ¬çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿåˆ‡æ¢æµ‹è¯•è¿è¡Œç¯å¢ƒ <em><span>ï¼ˆå¦‚å¼€å‘ / æµ‹è¯• / ç”Ÿäº§ï¼‰</span></em>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ <code>env/</code> ç›®å½•ä¸‹åˆ›å»º <code>dev.env</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">APIFOX_ACCESS_TOKEN=APS-ä½ çš„è®¿é—®ä»¤ç‰Œ
APIFOX_ENV_ID=ä½ çš„ç¯å¢ƒID
</code></pre>
<p>å¦‚æœéœ€è¦æ”¯æŒå¤šä¸ªç¯å¢ƒï¼Œå¯ä»¥æŒ‰ç…§åŒæ ·çš„æ–¹å¼åˆ›å»ºï¼š</p>
<ul>
<li>
<p><code>test.env</code></p>
</li>
<li>
<p><code>prod.env</code></p>
</li>
<li>
<p>â€¦â€¦</p>
</li>
</ul>
<p>æ¯ä¸ªæ–‡ä»¶åªéœ€è¦ç»´æŠ¤å¯¹åº”ç¯å¢ƒçš„å˜é‡å³å¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5043873d93f44553993a4cfa350c58a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=hIJCeoTM7nL7oM%2BEUOreEH2RACg%3D" alt="" loading="lazy"/></p>
<p>ç¯å¢ƒ ID å¯¹åº”çš„æ˜¯ Apifox CLI å‘½ä»¤ä¸­ <code>-e</code> å‚æ•°åé¢çš„æ•°å­—ï¼Œæ¯ä¸€ä¸ªè¿è¡Œç¯å¢ƒ <em><span>ï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰</span></em> åœ¨ Apifox ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¯å¢ƒ IDã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c326f50f1f10494fa17a70ec046feedb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=QuVu8rDcM%2FbLb2%2F8eFBS2ss53v8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>ğŸ’¡ <code>env/</code> ç›®å½•çš„ <code>.env</code> æ–‡ä»¶åŒ…å«è®¿é—®ä»¤ç‰Œï¼Œæ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸èƒ½æäº¤åˆ° Gitã€‚</p>
</blockquote>
<h4 data-id="heading-16">æ‰§è¡Œè„šæœ¬ï¼ˆscriptsï¼‰</h4>
<p><code>scripts/</code> ç›®å½•ç”¨äºå­˜æ”¾å¯ç›´æ¥æ‰§è¡Œçš„è„šæœ¬ï¼Œè´Ÿè´£æŠŠã€Œæµ‹è¯•å®šä¹‰ã€è½¬æ¢ä¸ºå®é™…å¯è¿è¡Œçš„ Apifox CLI å‘½ä»¤ï¼Œå¹¶å®Œæˆç¯å¢ƒå˜é‡æ³¨å…¥ä¸æ‰§è¡Œã€‚</p>
<p>æœ¬æ–‡ä¸­çš„ Skill é€‰æ‹©ä½¿ç”¨ Node.jsï¼Œä¸»è¦åŸºäºä¸¤ä¸ªè€ƒè™‘ï¼š</p>
<ol>
<li>
<p><strong>Apifox CLI æœ¬èº«ä¾èµ– Node.js</strong>
ç›´æ¥å¤ç”¨åŒä¸€è¿è¡Œç¯å¢ƒï¼Œæ— éœ€é¢å¤–å‡†å¤‡ Python ç­‰è¿è¡Œæ—¶ã€‚</p>
</li>
<li>
<p><strong>é™ä½ä¸Šä¸‹æ–‡è´Ÿæ‹…ï¼Œå‡å°‘ tokens æ¶ˆè€—</strong>
å°†â€œå‘½ä»¤è§£æã€å˜é‡æ³¨å…¥ã€æ‰§è¡Œé€»è¾‘â€æ”¾åœ¨è„šæœ¬ä¸­å®Œæˆï¼Œå¯ä»¥é¿å…è®© Claude åœ¨å¯¹è¯ä¸­åå¤æ‹¼è£…å®Œæ•´ CLI å‘½ä»¤ã€‚</p>
</li>
</ol>
<p>å¦‚æœä½ å¯¹è„šæœ¬ä¸ç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨ <code>SKILL.md</code> ä¸­ç›´æ¥è®© Claude ç»„è£…å¹¶æ‰§è¡Œ CLI å‘½ä»¤ï¼Œåªæ˜¯ä¸Šä¸‹æ–‡æˆæœ¬ä¼šæ›´é«˜ä¸€äº›ã€‚</p>
<p>åœ¨ <code>scripts/</code> ç›®å½•ä¸‹åˆ›å»º <code>run-cli.js</code>ï¼Œå®ƒçš„æ ¸å¿ƒèŒè´£æ˜¯ï¼š</p>
<ul>
<li>
<p>ä»æŒ‡å®šçš„ Markdown æµ‹è¯•æ–‡ä»¶ä¸­æå– Apifox CLI å‘½ä»¤</p>
</li>
<li>
<p>æ ¹æ®é€‰å®šçš„ç¯å¢ƒ <em><span>ï¼ˆå¦‚ </span><code>dev</code><span> / </span><code>test</code><span>ï¼‰</span></em> åŠ è½½å¯¹åº”çš„ <code>.env</code> æ–‡ä»¶</p>
</li>
<li>
<p>æ³¨å…¥ç¯å¢ƒå˜é‡åæ‰§è¡Œæµ‹è¯•</p>
</li>
</ul>
<p>å¯ç›´æ¥ä½¿ç”¨çš„ç¤ºä¾‹è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { execSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"child_process"</span>;
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">"url"</span>;

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename);

<span class="hljs-comment">// args</span>
<span class="hljs-keyword">const</span> mdPath = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];
<span class="hljs-keyword">const</span> envName = process.<span class="hljs-property">argv</span>[<span class="hljs-number">3</span>] || <span class="hljs-string">"local"</span>;

<span class="hljs-keyword">if</span> (!mdPath) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"âŒ ç¼ºå°‘æµ‹è¯• md æ–‡ä»¶è·¯å¾„"</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// env è·¯å¾„ï¼šå§‹ç»ˆç›¸å¯¹ skills æœ¬èº«</span>
<span class="hljs-keyword">const</span> envPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">".."</span>, <span class="hljs-string">"env"</span>, <span class="hljs-string">`<span class="hljs-subst">${envName}</span>.env`</span>);

<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(envPath)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`âŒ æœªæ‰¾åˆ°ç¯å¢ƒé…ç½®ï¼š<span class="hljs-subst">${envPath}</span>`</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}

dotenv.<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: envPath });

<span class="hljs-comment">// è¯»å– md</span>
<span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(mdPath, <span class="hljs-string">"utf-8"</span>);
<span class="hljs-keyword">const</span> match = content.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/```bash([\s\S]*?)```/</span>);

<span class="hljs-keyword">if</span> (!match) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"âŒ æœªæ‰¾åˆ° bash å‘½ä»¤å—"</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-keyword">let</span> command = match[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>();

<span class="hljs-comment">// å˜é‡æ›¿æ¢</span>
command = command
    .<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">"$APIFOX_ACCESS_TOKEN"</span>, process.<span class="hljs-property">env</span>.<span class="hljs-property">APIFOX_ACCESS_TOKEN</span>)
    .<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">"$APIFOX_ENV_ID"</span>, process.<span class="hljs-property">env</span>.<span class="hljs-property">APIFOX_ENV_ID</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`â–¶ Running (<span class="hljs-subst">${envName}</span>)`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(command);

<span class="hljs-comment">// æ‰§è¡Œ</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">execSync</span>(command, { <span class="hljs-attr">stdio</span>: <span class="hljs-string">"inherit"</span> });
} <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-comment">// Apifox CLI åœ¨æµ‹è¯•å¤±è´¥æ—¶ä¼šè¿”å›é€€å‡ºç  1</span>
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<p>åŒæ ·åœ¨ <code>scripts/</code> ä¸‹åˆ›å»º <code>list-tests.js</code>ï¼Œç”¨äºï¼š</p>
<ul>
<li>
<p>é€’å½’æ‰«æ <code>tests/</code> ç›®å½•</p>
</li>
<li>
<p>æŸ¥æ‰¾æ‰€æœ‰ Markdown æµ‹è¯•æ–‡ä»¶</p>
</li>
<li>
<p>æå–é¦–è¡Œæè¿°ä¿¡æ¯</p>
</li>
<li>
<p>è¾“å‡ºå½“å‰æ‰€æœ‰å¯ç”¨çš„ Apifox è‡ªåŠ¨åŒ–æµ‹è¯•åˆ—è¡¨</p>
</li>
</ul>
<p>å¯ç›´æ¥ä½¿ç”¨çš„ç¤ºä¾‹è„šæœ¬å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">"url"</span>;

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename);
<span class="hljs-keyword">const</span> testsDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">".."</span>, <span class="hljs-string">"tests"</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">scan</span>(<span class="hljs-params">dir, relativePath = <span class="hljs-string">""</span></span>) {
    <span class="hljs-keyword">const</span> items = fs.<span class="hljs-title function_">readdirSync</span>(dir, { <span class="hljs-attr">withFileTypes</span>: <span class="hljs-literal">true</span> });
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
        <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">join</span>(dir, item.<span class="hljs-property">name</span>);
        <span class="hljs-keyword">const</span> relPath = path.<span class="hljs-title function_">join</span>(relativePath, item.<span class="hljs-property">name</span>);
        
        <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">isDirectory</span>()) {
            <span class="hljs-title function_">scan</span>(fullPath, relPath);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">".md"</span>)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(fullPath, <span class="hljs-string">"utf-8"</span>);
                <span class="hljs-keyword">const</span> firstLine = content.<span class="hljs-title function_">split</span>(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">trim</span>();
                <span class="hljs-keyword">const</span> description = firstLine.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"&gt;"</span>) 
                    ? firstLine.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^&gt;\s*/</span>, <span class="hljs-string">""</span>).<span class="hljs-title function_">trim</span>() 
                    : <span class="hljs-string">"æ— æè¿°"</span>;
                <span class="hljs-keyword">const</span> displayPath = path.<span class="hljs-title function_">join</span>(<span class="hljs-string">"./.claude/skills/apifox-tests/tests"</span>, relPath);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${displayPath}</span>] - <span class="hljs-subst">${description}</span>`</span>);
            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${relPath}</span>] - (æ— æ³•è¯»å–å†…å®¹)`</span>);
            }
        }
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ” å¯ç”¨çš„ Apifox è‡ªåŠ¨åŒ–æµ‹è¯•åˆ—è¡¨ï¼š"</span>);
<span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(testsDir)) {
    <span class="hljs-title function_">scan</span>(testsDir);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âŒ æœªæ‰¾åˆ° tests ç›®å½•"</span>);
}

</code></pre>
<h4 data-id="heading-17">æµ‹è¯•å®šä¹‰ï¼ˆtestsï¼‰</h4>
<p><code>tests/</code> ç›®å½•ç”¨äºå­˜æ”¾æµ‹è¯•æ–‡ä»¶ï¼Œé‡‡ç”¨ Markdown ç¼–å†™ã€‚</p>
<p>è®¾è®¡åŸåˆ™ï¼šä¸€ä¸ª Markdown æ–‡ä»¶å¯¹åº”ä¸€ä¸ª Apifox æµ‹è¯•åœºæ™¯æˆ–æµ‹è¯•å¥—ä»¶ã€‚ä½ å¯ä»¥ç›´æ¥å¤ç”¨ Apifox è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­å·²æœ‰çš„ç›®å½•ç»“æ„ã€æµ‹è¯•åœºæ™¯æˆ–æµ‹è¯•å¥—ä»¶åç§°ï¼Œä»¥åŠæè¿°ä¿¡æ¯ã€‚</p>
<p>æ¯ä¸ª Markdown æ–‡ä»¶åªéœ€åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼šä¸€æ®µç®€çŸ­çš„æµ‹è¯•è¯´æ˜ï¼Œä»¥åŠä¸€æ¡å¯ç›´æ¥æ‰§è¡Œçš„ Apifox CLI å‘½ä»¤ã€‚</p>
<p>Apifox CLI å‘½ä»¤é‡Œçš„ Access Token å’Œ <code>-e</code> å‚æ•°åé¢çš„ç¯å¢ƒ IDï¼Œåˆ†åˆ«ç”¨ <code>$APIFOX_ACCESS_TOKEN</code> å’Œ<code> $APIFOX_ENV_ID</code> ä»£æ›¿ï¼Œå¹¶ç»Ÿä¸€åœ¨ <code>.env</code> æ–‡ä»¶ä¸­é…ç½®ï¼Œè¿™æ ·æ—¢å¯ä»¥é¿å… token æ³„éœ²ï¼Œä¹Ÿèƒ½çµæ´»åˆ‡æ¢è¿è¡Œç¯å¢ƒã€‚ä¸€ä¸ª<code>ç™»å½•é‰´æƒ-è®¤è¯æµç¨‹.md</code>æ–‡ä»¶çš„å†…å®¹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; éªŒè¯ç™»å½•ã€åˆ·æ–° tokenã€ç™»å‡ºç­‰æ ¸å¿ƒæ¥å£æ˜¯å¦å¯ç”¨ã€‚</span>

<span class="hljs-code">```bash
apifox run --access-token $APIFOX_ACCESS_TOKEN -t 5564xxx -e $APIFOX_ENV_ID -n 1 -r html,cli
```</span>
</code></pre>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„ Skills ç®—æ˜¯æ„å»ºå®Œäº†ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ç»“æ„ï¼Œå¯¹æ¯”ä¸€ä¸‹ä¸ä½ çš„æœ‰ä»€ä¹ˆä¸åŒï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6348eccc23cd4b28984b5db6db91a65d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=Y%2F9LDUhj66xhOHyx8OTYlX9ZR6A%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18">åœ¨ Claude Code ä¸­ä½¿ç”¨</h2>
<p>é…ç½®å®Œæˆåï¼Œåœ¨ç»ˆç«¯æ§åˆ¶å°è¿è¡Œ <code>claude</code> å‘½ä»¤è¿›å…¥é¡¹ç›®ç›®å½•ã€‚Claude ä¼šè‡ªåŠ¨æ‰«æ <code>.claude/skills/</code> ç›®å½•ï¼Œå‘ç° <code>apifox-tests</code> Skillã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥å…ˆç”¨ <code>/skills</code> å‘½ä»¤æŸ¥çœ‹å·²åŠ è½½çš„ Skillã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7237fc8d3bf8403da06e3995d2d3d504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=JkQVw60%2BKH2RFHMMOtMFKBuxJ1k%3D" alt="" loading="lazy"/></p>
<p>ç„¶åï¼Œå¯ä»¥è¯•ç€è¯´ä¸€å¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼šâ€œå¸®æˆ‘è·‘ä¸€ä¸‹é€€æ¬¾æµç¨‹çš„æµ‹è¯•ï¼Œç”¨æµ‹è¯•ç¯å¢ƒ â€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9fabb35ab4b47389b3eceb0ae0f96d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXBpZm94:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975194&amp;x-signature=q32fNpWMMWnBkgo8UL2d48jiAsk%3D" alt="" loading="lazy"/></p>
<p>Claude ä¼šç†è§£ä½ çš„æ„å›¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶å¹¶æ‰§è¡Œæµ‹è¯•ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä½ ä¼šçœ‹åˆ° Apifox CLI çš„è¾“å‡ºï¼›æµ‹è¯•å®Œæˆåï¼ŒClaude ä¼šå¯¹ç»“æœè¿›è¡Œåˆ†æå¹¶ç»™å‡ºæ€»ç»“ã€‚</p>
<p>æ•´ä¸ªæµç¨‹æ¦‚è¿°èµ·æ¥å°±æ˜¯ï¼Œä½ ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼ŒClaude ç†è§£æ„å›¾å¹¶è°ƒç”¨è„šæœ¬ï¼Œè„šæœ¬æ‰§è¡Œ Apifox CLI å‘½ä»¤ï¼ŒClaude åˆ†æç»“æœå¹¶åé¦ˆç»™ä½ ã€‚</p>
<h2 data-id="heading-19">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•é€šè¿‡ Claude Codeã€Apifox CLI å’Œ Claude Skills æ„å»ºè‡ªåŠ¨åŒ–æµ‹è¯•å·¥ä½œæµã€‚æ ¸å¿ƒæ€æƒ³æ˜¯è®© Claude æˆä¸ºä½ å’Œå·¥å…·ä¹‹é—´çš„æ¡¥æ¢ã€‚ä½ ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼ŒClaude ç†è§£æ„å›¾åè°ƒç”¨è„šæœ¬ï¼Œè„šæœ¬æ‰§è¡Œå…·ä½“å·¥ä½œï¼ŒClaude æŠŠç»“æœæ•´ç†æˆæ˜“è¯»çš„å½¢å¼åé¦ˆç»™ä½ ã€‚</p>
<p>è¦è®©è¿™å¥—æ–¹æ¡ˆçœŸæ­£å‘æŒ¥ä½œç”¨ï¼Œéœ€è¦æ ¹æ®é¡¹ç›®ç‰¹ç‚¹è°ƒæ•´é…ç½®ã€‚æ¯”å¦‚æµ‹è¯•çš„ç»„ç»‡æ–¹å¼ã€ç¯å¢ƒçš„ç®¡ç†ç­–ç•¥ã€ç»“æœçš„åˆ†æé€»è¾‘ç­‰ã€‚å¥½åœ¨è¿™å¥—æ–¹æ¡ˆå„ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥å®šåˆ¶ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰é€»è¾‘ã€‚</p>
<p>å¦‚æœä½ çš„å›¢é˜Ÿç»å¸¸éœ€è¦æ‰§è¡Œæ¥å£æµ‹è¯•ï¼Œå¸Œæœ›è®©è¿™ä¸ªè¿‡ç¨‹æ›´è‡ªåŠ¨åŒ–ã€æ›´æ™ºèƒ½ï¼Œè¿™å¥—æ–¹æ¡ˆå€¼å¾—ä¸€è¯•ã€‚åˆæœŸéœ€è¦èŠ±æ—¶é—´é…ç½®å’Œç†Ÿæ‚‰ï¼Œä½†ä¸€æ—¦å»ºç«‹èµ·æ¥ï¼Œèƒ½æ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡ã€‚éšç€ä½¿ç”¨æ·±å…¥ï¼Œä½ ä¼šå‘ç°æ›´å¤šå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œè®©æ•´ä¸ªå·¥ä½œæµè¶Šæ¥è¶Šé¡ºç•…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Bun v1.3.6å‘å¸ƒï¼Œå†…ç½®tarè§£å‹ç¼©ï¼Œå„æ–¹é¢æé€Ÿåˆæé€Ÿ]]></title>    <link>https://juejin.cn/post/7594765626456342578</link>    <guid>https://juejin.cn/post/7594765626456342578</guid>    <pubDate>2026-01-14T02:02:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594765626456342578" data-draft-id="7594735599314059314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Bun v1.3.6å‘å¸ƒï¼Œå†…ç½®tarè§£å‹ç¼©ï¼Œå„æ–¹é¢æé€Ÿåˆæé€Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-01-14T02:02:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¹‹è™é™ˆéšæ˜“"/> <meta itemprop="url" content="https://juejin.cn/user/1239904846873326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Bun v1.3.6å‘å¸ƒï¼Œå†…ç½®tarè§£å‹ç¼©ï¼Œå„æ–¹é¢æé€Ÿåˆæé€Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904846873326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¹‹è™é™ˆéšæ˜“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T02:02:46.000Z" title="Wed Jan 14 2026 02:02:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å†œæ‘ç¨‹åºå‘˜ï¼Œç‹¬ç«‹å¼€å‘è€…ï¼Œå‰ç«¯ä¹‹è™é™ˆéšæ˜“ï¼ŒæŠ€æœ¯ç¾¤ä¸äº¤æœ‹å‹è¯·åœ¨ä¸ªäººç½‘ç«™ ğŸ‘‡ è”ç³»æˆ‘ âœŒï¸</p>
<ul>
<li>ä¸ªäººç½‘ç«™ 1ï¸âƒ£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fchensuiyi.me" target="_blank" title="https://chensuiyi.me" ref="nofollow noopener noreferrer">chensuiyi.me</a></li>
<li>ä¸ªäººç½‘ç«™ 2ï¸âƒ£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fme.yicode.tech" target="_blank" title="https://me.yicode.tech" ref="nofollow noopener noreferrer">me.yicode.tech</a></li>
</ul>
<p>æˆ‘çš„æ‰€æœ‰æ–‡ç« å‡ä¸ºå¤æ³•æ‰‹å†™ï¼Œæ—  AI æ·»åŠ å‰‚ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨ï¼Œå¦‚æœä½ è§‰å¾—æœ¬æ–‡æœ‰ç”¨ï¼Œä¸€é”®ä¸‰è¿ (<code>ç‚¹èµ</code>ã€<code>è¯„è®º</code>ã€<code>è½¬å‘</code>)ï¼Œå°±æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒ~</p>
<hr/>
<p>All in Bun åŠå¹´äº†ï¼Œä½“éªŒéå¸¸ä¸é”™ï¼Œä»€ä¹ˆå« All in Bun å‘¢ï¼Ÿå°±æ˜¯æˆ‘å·²ç»åŠå¹´æ²¡æœ‰è¿è¡Œè¿‡ nodeï¼Œnpmï¼Œpnpmï¼Œyarnï¼Œnvm è¿™äº›å‘½ä»¤äº†ï¼Œå®Œå…¨å°±æ˜¯ä¸€ä¸ª bun å‘½ä»¤è§£å†³æ‰€æœ‰çš„è¿è¡Œï¼Œå®‰è£…ï¼Œæ›´æ–°ï¼Œå‘åŒ…ç­‰ç­‰é—®é¢˜ã€‚</p>
<p>åˆ†äº«å‡ ä¸ªæˆ‘æœ€å–œæ¬¢çš„ Bun åŠŸèƒ½ï¼š</p>
<p><strong>å†…ç½® Sql å’Œ Redis åŠŸèƒ½</strong></p>
<p>å¦‚æœæˆ‘ä»¬è¦åœ¨ Bun ä¸­ä½¿ç”¨æ•°æ®åº“å’Œç¼“å­˜åŠŸèƒ½ï¼Œä¸ç”¨å®‰è£…ä»€ä¹ˆ<code>node-mysql2</code>ï¼Œä¸ç”¨å®‰è£…ä»€ä¹ˆ<code>better-sqlite3</code>ï¼Œä¸ç”¨å®‰è£…ä»€ä¹ˆ<code>postgres</code>ï¼Œä¸ç”¨å®‰è£…ä»€ä¹ˆ<code>redis</code>æˆ–<code>ioredis</code>ï¼Œç›´æ¥å°±æ˜¯<code>import { sql, redis } from "bun"</code> æ‹¿æ¥å°±ç”¨ï¼Œç®€å•åˆæ–¹ä¾¿ã€‚</p>
<p><strong>å†…ç½®æ‰“åŒ…åŠŸèƒ½</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b242a6aa30e04f77b0d11a1e6822f6eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LmL6JmO6ZmI6ZqP5piT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960966&amp;x-signature=%2BTHTgsBg77OWkhManiWC3GvsUdo%3D" alt="" loading="lazy"/></p>
<p>ç›´æ¥å¯¹æ ‡ rollupï¼Œwebpackï¼Œesbuildï¼Œrspack ç­‰æ‰“åŒ…å·¥å…·ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
<p>æˆ‘å¾ˆå–œæ¬¢è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®ƒéå¸¸æ–¹ä¾¿å°±èƒ½æŠŠä¸€ä¸ªé¡¹ç›®æ‰“åŒ…ä¸ºä¸€ä¸ª<code>å•æ–‡ä»¶</code>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d0e366d54564fd7b81554c02e89c6dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LmL6JmO6ZmI6ZqP5piT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960966&amp;x-signature=qPiYTuaIQd5wLlB%2Be1I6jj9pV9s%3D" alt="" loading="lazy"/></p>
<p>æ¯”å¦‚æˆ‘è‡ªå·±å¼€å‘çš„ä¸º Bun ä¸“å±æ‰“é€ çš„åç«¯æ¥å£æ¡†æ¶ <strong>é‡èœ‚é£èˆ</strong> <code>https://github.com/chenbimo/befly</code>ï¼Œå°±é€šè¿‡ Bun æ‰“åŒ…ä¸ºä¸€ä¸ªå‹ç¼©å 200+kb çš„ js æ–‡ä»¶ï¼Œåªè¦ç®€å•åœ°æ”¾åœ¨é¡¹ç›®ä¸­å°±èƒ½æä¾›å®Œæ•´çš„åç«¯æ¥å£åŠŸèƒ½ï¼Œæ— éœ€å®‰è£… npm åŒ…é‚£ä¸€å¥—ã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼ŒBun è¿˜å¯ä»¥æ‰“åŒ…æ–‡ä»¶ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯”å¦‚<code>exe</code>ï¼Œè¿˜èƒ½æŠŠæ•´ä¸ªåç«¯æœåŠ¡å’Œå‰ç«¯é¡µé¢æ‰“åŒ…ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç‚¹å‡»æ–‡ä»¶ï¼Œç›´æ¥åœ¨æœ¬åœ°æ‰˜ç®¡ä¸€ä¸ªå®Œæ•´çš„å‰åç«¯é¡¹ç›®ï¼Œéš”å£ Nodejs è¿æ‰“åŒ…<code>exe</code>è¿˜åœ¨æµ‹è¯•é˜¶æ®µï¼Œä¸çŸ¥é“çŒ´å¹´é©¬æœˆæ‰ä¼šå®Œå–„ï¼Œè€Œ Bun å·²ç»é¥é¥é¢†å…ˆã€‚</p>
<p><strong>Http æœåŠ¡åŠŸèƒ½</strong></p>
<p>å†™ Web æœåŠ¡ï¼Œå°±ç®—ä¸ç”¨ä»€ä¹ˆ expressï¼Œkoa æ¡†æ¶ï¼Œä¹Ÿèƒ½ç›´æ¥è·å¾—å¾ˆå¥½çš„å¼€å‘ä½“éªŒï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> server = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-attr">routes</span>: {
        <span class="hljs-comment">// é™æ€è·¯ç”±</span>
        <span class="hljs-string">'/api/status'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'OK'</span>),

        <span class="hljs-comment">// åŠ¨æ€è·¯ç”±</span>
        <span class="hljs-string">'/users/:id'</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">`Hello User <span class="hljs-subst">${req.params.id}</span>!`</span>);
        },

        <span class="hljs-comment">// åŒä¸€ä¸ªè¯·æ±‚ä¸åŒæ–¹æ³•è¿”å›ä¸åŒå†…å®¹</span>
        <span class="hljs-string">'/api/posts'</span>: {
            <span class="hljs-attr">GET</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'List posts'</span>),
            <span class="hljs-attr">POST</span>: <span class="hljs-keyword">async</span> (req) =&gt; {
                <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">json</span>();
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">created</span>: <span class="hljs-literal">true</span>, ...body });
            }
        },

        <span class="hljs-comment">// æ‰€æœ‰ä»¥/api/å¼€å¤´çš„è·¯ç”±</span>
        <span class="hljs-string">'/api/*'</span>: <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Not found'</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-number">404</span> }),

        <span class="hljs-comment">// é‡å®šå‘</span>
        <span class="hljs-string">'/blog/hello'</span>: <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">'/blog/hello/world'</span>),

        <span class="hljs-comment">// åŒ¹é…æ”¶è—å›¾æ ‡</span>
        <span class="hljs-string">'/favicon.ico'</span>: <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">'./favicon.ico'</span>)
    },

    <span class="hljs-comment">// æ— åŒ¹é…ä¿åº•</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'Not Found'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">404</span> });
    }
});
</code></pre>
<p>å¦‚æœåœ¨ Nodejs ä¸­ï¼Œå¾—ç”¨<code>find-my-way</code>ä¹‹ç±»çš„è·¯ç”±åŒ…æ¥å®ç°ã€‚</p>
<p>ä¸ä»…äºæ­¤ï¼ŒBun ä¸­å„ç§å¥½ç”¨çš„åŠŸèƒ½å¤ªå¤šäº†ï¼Œä»¥ä¸‹æ˜¯æœ¬æ¬¡<code>Bun v1.3.6</code>æ›´æ–°çš„åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è§£å‹taråŒ…</span>
<span class="hljs-keyword">const</span> tarball = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Archive</span>(<span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">'package.tar.gz'</span>).<span class="hljs-title function_">bytes</span>());
<span class="hljs-keyword">const</span> fileCount = <span class="hljs-keyword">await</span> tarball.<span class="hljs-title function_">extract</span>(<span class="hljs-string">'./output-dir'</span>);

<span class="hljs-comment">// å‹ç¼©taråŒ…</span>
<span class="hljs-keyword">const</span> compressed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Archive</span>(files, { <span class="hljs-attr">compress</span>: <span class="hljs-string">'gzip'</span> });
</code></pre>
<p>å†…ç½®äº† <code>Bun.Archive</code>æ¥å£ï¼Œå¯ä»¥ç›´æ¥æ›¿ä»£ Nodejs ä¸­è¦ç”¨<code>node-tar</code>åŒ…æ‰èƒ½å®ç°çš„åŠŸèƒ½ï¼Œè€Œä¸”é€Ÿåº¦å¿«äº†<code>4-30</code>å€ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> config = <span class="hljs-title class_">Bun</span>.<span class="hljs-property">JSONC</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">`{
  // Database configuration
  "host": "localhost",
  "port": 5432,
  "options": {
    "ssl": true, // trailing comma allowed
  },
}`</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(config.<span class="hljs-property">host</span>); <span class="hljs-comment">// "localhost"</span>
</code></pre>
<p>å†…ç½®äº†<code>Bun.JSONC.parse()</code> ï¼Œå¯ä»¥è§£æå¸¦æœ‰æ³¨é‡Šçš„ json æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">build</span>({
    <span class="hljs-attr">entrypoints</span>: [<span class="hljs-string">'./src/index.ts'</span>],
    <span class="hljs-attr">outdir</span>: <span class="hljs-string">'./dist'</span>,
    <span class="hljs-attr">metafile</span>: <span class="hljs-literal">true</span>
});

<span class="hljs-comment">// åˆ†ææ‰“åŒ…å¤§å°</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [path, meta] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(result.<span class="hljs-property">metafile</span>.<span class="hljs-property">inputs</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${path}</span>: <span class="hljs-subst">${meta.bytes}</span> bytes`</span>);
}

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [path, meta] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(result.<span class="hljs-property">metafile</span>.<span class="hljs-property">outputs</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${path}</span>: <span class="hljs-subst">${meta.bytes}</span> bytes`</span>);
}

<span class="hljs-comment">// å†™å…¥åˆ°æœ¬åœ°ï¼Œå¯ä»¥è¢«è¯¸å¦‚esbuildè¿™æ ·çš„æ‰“åŒ…å·¥å…·åˆ†æ</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'./dist/meta.json'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result.<span class="hljs-property">metafile</span>));
</code></pre>
<p>æ‰“åŒ…åŠŸèƒ½æä¾›äº†<code>metafile</code>å±æ€§ï¼Œå¯ä»¥ç”Ÿæˆæ‰“åŒ…å…ƒæ•°æ®ï¼Œç„¶åç”¨å…¶ä»–å·¥å…·ï¼Œå¯ä»¥å¯¹æ‰“åŒ…äº§ç‰©è¿›è¡Œå¯è§†åŒ–æŸ¥çœ‹ï¼Œæä¾›æ›´å¥½çš„åˆ†æä¼˜åŒ–ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">build</span>({
    <span class="hljs-attr">entrypoints</span>: [<span class="hljs-string">'/app/index.ts'</span>],
    <span class="hljs-attr">files</span>: {
        <span class="hljs-string">'/app/index.ts'</span>: <span class="hljs-string">`
      import { greet } from "./greet.ts";
      console.log(greet("World"));
    `</span>,
        <span class="hljs-string">'/app/greet.ts'</span>: <span class="hljs-string">`
      export function greet(name: string) {
        return "Hello, " + name + "!";
      }
    `</span>
    }
});
</code></pre>
<p>å¯ä»¥åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œç”¨è™šæ‹Ÿæ–‡ä»¶æ›¿æ¢ç£ç›˜æ–‡ä»¶ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä½†çœŸå®åœºæ™¯æˆ‘è‡ªå·±è¿˜æ²¡æœ‰ç”¨åˆ°ã€‚</p>
<p>å¦å¤–å‘¢ï¼Œå°±æ˜¯é€Ÿåº¦æå‡æ–¹é¢çš„æ›´æ–°ï¼ŒBun åœ¨è¿™æ–¹é¢ä¸€ç›´ä¸é—ä½™åŠ›åœ°ä¼˜åŒ–å’Œå‹æ¦¨ä»£ç æ€§èƒ½ã€‚</p>
<p><code>Response.json()</code>æé€Ÿ<code>3.5å€</code>ï¼Œ<code>async/await</code>æé€Ÿ<code>15%</code>ï¼Œ<code>promise.race()</code>æé€Ÿ<code>30%</code>ï¼Œ<code>Buffer.indexOf()</code>æé€Ÿ<code>2å€</code>ï¼Œæ‰“åŒ…å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æœ‰å†…åµŒ<code>.node</code>æ–‡ä»¶æ˜¯æ›´å¿«ï¼Œ<code>JSON IPC</code>ä¼ é€å¤§æ•°æ®æé«˜<code>9å€</code>ï¼Œ<code>Bun.spawnSync()</code>æé€Ÿ<code>30å€</code>ï¼Œæ›´å¿«çš„ JSON åºåˆ—åŒ–ã€‚</p>
<p>æ¯æ¬¡æ›´æ–°ï¼Œå¯¹ Nodejs çš„å…¼å®¹æ€§å°±ä¼šè¿›ä¸€æ­¥æé«˜ï¼Œä¸€äº›å¯èƒ½ä¹‹å‰æ— æ³•è¿è¡Œï¼Œæˆ–è€…è¿è¡Œæœ‰é—®é¢˜çš„é¡¹ç›®ï¼Œå¯ä»¥è¯•ä¸€è¯•ï¼Œè¯´ä¸å®šå°±æ­£å¸¸äº†ã€‚</p>
<p>æˆ‘ä» Bun è¿˜æ²¡æœ‰å‘æ­£å¼ç‰ˆå¼€å§‹ç”¨ï¼Œä¸€æ­¥æ­¥ä½“éªŒåˆ°äº†ä»å®Œå…¨ä¸å¯ç”¨ï¼Œåˆ°ç”¨äº†ä¸€å †æŠ¥é”™ï¼Œåˆ°ç°åœ¨ç¨³å®šè¿è¡Œï¼Œæˆä¸ºè‡ªå·±çš„è¶æ‰‹æ­¦å™¨ï¼Œæ¨èæ¯ä¸ªå†™å‰ç«¯ï¼Œå†™ JS/TS çš„å°ä¼™ä¼´ä»¬éƒ½ä¸Šæ‰‹è¯•è¯•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®Œç¾åº”å¯¹åƒäº¿çº§æ˜ç»†æ•°æ®è®¡ç®—ï¼šAloudata CAN åŒå¼•æ“æ¶æ„è¯¦è§£]]></title>    <link>https://juejin.cn/post/7595341943338024970</link>    <guid>https://juejin.cn/post/7595341943338024970</guid>    <pubDate>2026-01-15T07:04:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595341943338024970" data-draft-id="7595341943337910282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®Œç¾åº”å¯¹åƒäº¿çº§æ˜ç»†æ•°æ®è®¡ç®—ï¼šAloudata CAN åŒå¼•æ“æ¶æ„è¯¦è§£"/> <meta itemprop="keywords" content="æ•°æ®å¯è§†åŒ–,æ•°æ®åˆ†æ,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-01-15T07:04:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aloudataå¤§åº”ç§‘æŠ€"/> <meta itemprop="url" content="https://juejin.cn/user/1579340474099927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®Œç¾åº”å¯¹åƒäº¿çº§æ˜ç»†æ•°æ®è®¡ç®—ï¼šAloudata CAN åŒå¼•æ“æ¶æ„è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1579340474099927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aloudataå¤§åº”ç§‘æŠ€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:04:50.000Z" title="Thu Jan 15 2026 07:04:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€ï¼šä»â€œå¿«â€åˆ°â€œç¨³â€ï¼Œæ¶æ„æ¼”è¿›çš„å¿…ç„¶</h2>
<p>è‡ª Aloudata CAN è‡ªåŠ¨åŒ–æŒ‡æ ‡å¹³å°å‘å¸ƒä»¥æ¥ï¼Œæˆ‘ä»¬å§‹ç»ˆåšæŒâ€œNoETL è¯­ä¹‰ç¼–ç»‡â€çš„æ ¸å¿ƒç†å¿µï¼šä¸»å¼ ä¼ä¸šåº”åœ¨æ˜ç»†æ•°æ®ï¼ˆDWDï¼‰ä¹‹ä¸Šç›´æ¥å®šä¹‰æŒ‡æ ‡ï¼Œè€Œéä¾èµ–å±‚å±‚å›ºåŒ–çš„ç‰©ç†å®½è¡¨ã€‚è¿™ç§â€œåŸºäºæ˜ç»†æ•°æ®ï¼Œå®šä¹‰å³å¼€å‘â€çš„æ¨¡å¼ï¼Œæœ€å¤§ç¨‹åº¦åœ°ä¿éšœäº†æŒ‡æ ‡å£å¾„çš„è¯­ä¹‰ä¸€è‡´æ€§ï¼Œå¹¶èµ‹äºˆäº†ä¸šåŠ¡äººå‘˜æœ€å¤§çš„åˆ†æè‡ªç”±åº¦ã€‚</p>
<p>ä¸ºäº†æ”¯æ’‘è¿™ä¸€ç†å¿µï¼ŒAloudata CAN æ„å»ºäº†å¼ºå¤§çš„è¯­ä¹‰è§£æå¼•æ“ã€‚åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘ä»¬é»˜è®¤é‡‡ç”¨ MPP æ¶æ„çš„ OLAP å¼•æ“ï¼ˆå¦‚Â ApacheÂ Dorisã€StarRocksï¼‰ä½œä¸ºæ ¸å¿ƒè®¡ç®—ä¸å­˜å‚¨è½½ä½“ã€‚åœ¨ç»å¤§å¤šæ•°é«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„äº¤äº’å¼åˆ†æåœºæ™¯ä¸­ï¼Œè¿™ç§æ¶æ„å‡­å€Ÿæå…¶ä¼˜å¼‚çš„æŸ¥è¯¢å“åº”é€Ÿåº¦ï¼Œè¯æ˜äº†å…¶é«˜æ•ˆæ€§ã€‚</p>
<p>ç„¶è€Œï¼Œéšç€ä¼ä¸šæ•°å­—åŒ–è½¬å‹æ­¥å…¥æ·±æ°´åŒºï¼Œæ•°æ®è¿è¥çš„é¢—ç²’åº¦ä¸æ·±åº¦å‘ç”Ÿäº†è´¨å˜ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå¤´éƒ¨ä¼ä¸šçš„ä¸šåŠ¡éœ€æ±‚æ­£åœ¨ä»â€œçœ‹å®è§‚è¶‹åŠ¿â€å‘â€œåšå¾®è§‚å½’å› â€è½¬å˜ã€‚ä¸šåŠ¡éƒ¨é—¨å¼€å§‹ä¾èµ–é•¿å‘¨æœŸçš„å¤æ‚æ˜ç»†è®¡ç®—æ¥è¾…åŠ©å†³ç­–ï¼Œä¾‹å¦‚ï¼Œé›¶å”®ä¼ä¸šéœ€è¦åŸºäºè¿‡å»ä¸¤åˆ°ä¸‰å¹´çš„äº¤æ˜“æ˜ç»†ï¼Œè®¡ç®—ç‰¹å®šäººç¾¤çš„ç”Ÿå‘½å‘¨æœŸä»·å€¼ï¼ˆLTVï¼‰ï¼›é‡‘èæœºæ„éœ€è¦å›æº¯æµ·é‡æµæ°´æ•°æ®ï¼Œè¿›è¡Œè·¨å‘¨æœŸçš„é£é™©å› å­å½’å› ã€‚</p>
<p>å½“è¿™ç§æ¶‰åŠç™¾äº¿ç”šè‡³åƒäº¿çº§æ•°æ®çš„é•¿å‘¨æœŸã€é«˜å¤æ‚åº¦è®¡ç®—æˆä¸ºå¸¸æ€ï¼Œå•ä¸€ OLAP å¼•æ“æ¶æ„å¼€å§‹é¢ä¸´ç‰©ç†å®šå¾‹çš„æŒ‘æˆ˜ã€‚OLAP å¼•æ“è™½ç„¶æ“…é•¿å¿«é€ŸæŸ¥è¯¢ï¼Œä½†åœ¨å¤„ç†è¶…å¤§è§„æ¨¡æ•°æ®çš„å…¨é‡ç‰©åŒ–æ„å»ºè¿™ç§â€œé‡ååâ€ä»»åŠ¡æ—¶ï¼Œå¾€å¾€é¢ä¸´å†…å­˜èµ„æºï¼ˆOOMï¼‰ç“¶é¢ˆã€‚å°¤å…¶æ˜¯é•¿è€—æ—¶ä»»åŠ¡è¿è¡Œåœ¨æŸ¥è¯¢é›†ç¾¤ä¸Šï¼Œææ˜“å¼•å‘èµ„æºäº‰æŠ¢ï¼Œå½±å“ä¸šåŠ¡è¿ç»­æ€§ã€‚</p>
<p>åœ¨ä¼ä¸šçœŸå®çš„æŠ€æœ¯ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¸ä¼šä¹Ÿä¸åº”åªæœ‰ä¸€ç§è®¡ç®—å¼•æ“ã€‚OLAP å¼•æ“æ“…é•¿äº¤äº’å¼åˆ†æï¼Œè€Œ Spark ç­‰æ‰¹å¤„ç†å¼•æ“åˆ™åœ¨æµ·é‡æ•°æ®ååä¸ç¨³å®šæ€§ä¸Šå…·å¤‡å¤©ç„¶ä¼˜åŠ¿ã€‚éšç€å®¢æˆ·æ•°é‡çš„æŒç»­å¢é•¿å’Œåº”ç”¨åœºæ™¯çš„æ·±å…¥ï¼Œæˆ‘ä»¬ä¹Ÿåº”å½“é€‚æ—¶å‡çº§åº•å±‚æ¶æ„ã€‚</p>
<p>å› æ­¤ï¼ŒAloudata CAN æ­£å¼æ¨å‡ºâ€œåŒå¼•æ“ç‰©åŒ–æ¶æ„â€ã€‚è¿™ä¸æ˜¯å¯¹è¿‡å¾€çš„å¦å®šï¼Œè€Œæ˜¯ NoETL ç†å¿µåœ¨å·¥ç¨‹è½åœ°ä¸Šçš„æˆç†Ÿâ€”â€”è®©è¯­ä¹‰å±‚ä¿æŒç»Ÿä¸€ï¼Œè®©è®¡ç®—å±‚å„å¸å…¶èŒï¼šæ—¢é€šè¿‡ OLAP å¼•æ“ä¿éšœå‰ç«¯æŸ¥è¯¢çš„æè‡´é€Ÿåº¦ï¼Œåˆé€šè¿‡ Spark å¼•æ“æ‰¿è½½åƒäº¿çº§æ•°æ®çš„æ‰¹å¤„ç†è®¡ç®—ã€‚</p>
<h2 data-id="heading-1">æé™åœºæ™¯å®æµ‹ï¼šåƒäº¿çº§æ˜ç»†è®¡ç®—çªå›´</h2>
<p>æ¶æ„è®¾è®¡çš„ä¼˜åŠ£ï¼Œæœ€ç»ˆéœ€è¦å›åˆ°çœŸå®çš„ä¸šåŠ¡ç†”ç‚‰ä¸­å»æ£€éªŒã€‚ä¸ºäº†éªŒè¯åŒå¼•æ“æ¶æ„åœ¨æç«¯è´Ÿè½½ä¸‹çš„è¡¨ç°ï¼Œæˆ‘ä»¬ä¸ä¸€å®¶å¤´éƒ¨é›¶å”®è¡Œä¸šçš„æ ‡æ†å®¢æˆ·åˆä½œï¼Œè¿›è¡Œäº†ä¸€æ¬¡â€œæé™å‹æµ‹â€ã€‚</p>
<ul>
<li>åœºæ™¯èƒŒæ™¯ï¼š</li>
</ul>
<p>å®¢æˆ·è¦æ±‚åŸºäºè¿‡å»ä¸¤å¹´çš„å…¨é‡äº¤æ˜“æ˜ç»†æ•°æ®ï¼ˆè§„æ¨¡è¾¾åƒäº¿çº§ï¼‰ï¼Œè®¡ç®—åŒ…æ‹¬â€œå®¢å•ä»· 52 å‘¨åŒç¯æ¯”â€ã€â€œè®¢å•æ•° 52 å‘¨åŒç¯æ¯”â€ç­‰åœ¨å†…çš„ 28 ä¸ªæ ¸å¿ƒæŒ‡æ ‡å’Œ 17 ä¸ªå¤æ‚ç»´åº¦ã€‚</p>
<ul>
<li>é­é‡æˆ˜ï¼ˆOLAP å•å¼•æ“ï¼‰ï¼š</li>
</ul>
<p>è¯¥ä»»åŠ¡æœ€åˆç”±ä¸€å¥—é…ç½®è±ªåçš„ OLAP é›†ç¾¤æ‰¿æ‹…ï¼ˆæ•°åƒæ ¸ CPUï¼Œè¿‘ 20TB å†…å­˜ï¼‰ã€‚ç„¶è€Œï¼Œé¢å¯¹åƒäº¿çº§æ•°æ®çš„å¤§è§„æ¨¡ Join å’Œå¤æ‚èšåˆï¼ŒOLAP å¼•æ“ä¾ç„¶è§¦ç¢°åˆ°äº†å†…å­˜å¤„ç†çš„ç‰©ç†è¾¹ç•Œï¼Œä»»åŠ¡å›  OOM åå¤å¤±è´¥ã€‚å°è¯äº†åœ¨è¶…å¤§è§„æ¨¡çš„å…¨é‡ç‰©åŒ–åœºæ™¯ä¸­ï¼Œå•çº¯ä¾èµ–å†…å­˜å¯†é›†å‹çš„ OLAP å¼•æ“å¹¶éæœ€ä¼˜è§£ã€‚</p>
<ul>
<li>çªå›´æˆ˜ï¼ˆåŒå¼•æ“åˆ‡æ¢ï¼‰ï¼š</li>
</ul>
<p>æˆ‘ä»¬å°†è¯¥ä»»åŠ¡åˆ‡æ¢è‡³ Aloudata CAN çš„åŒå¼•æ“æ¨¡å¼ï¼Œå¯ç”¨ Spark æ‰¹å¤„ç†å¼•æ“æ¥ç®¡è®¡ç®—ï¼Œä»â€œå…¨å†…å­˜ä¾èµ–â€åˆ‡æ¢ä¸ºæ›´ç¨³å¥çš„â€œå†…å­˜+ç£ç›˜ Shuffleâ€çš„é¢„è®¡ç®—æ¨¡å¼ã€‚åœ¨æ–°çš„æ¶æ„ä¸‹ï¼Œæˆ‘ä»¬å°†è®¡ç®—èµ„æºæ•´ä½“å‡åŠã€‚</p>
<p>å®æµ‹ç»“æœæ˜¾ç¤ºï¼š</p>
<ul>
<li>ç¨³å®šæ€§è´¨å˜ï¼šä»»åŠ¡æˆåŠŸç‡ä»ä¸ç¡®å®šè½¬å˜ä¸ºÂ 100%ï¼Œå½»åº•æ¶ˆé™¤äº† OOM é£é™©ã€‚</li>
<li>æ•ˆç‡å¯æ§ï¼šè™½ç„¶ Spark é‡‡ç”¨è½ç›˜æœºåˆ¶ï¼Œä¸€ä¸ªåŠ é€Ÿåœºæ™¯ä»æ˜ç»†è®¡ç®—åˆ°æœ€ç»ˆæ±‡æ€»æŒ‡æ ‡äº§å‡ºï¼Œç«¯åˆ°ç«¯è·‘æ‰¹è®¡ç®—è€—æ—¶çº¦ 60 åˆ†é’Ÿã€‚ä½†ç›¸æ¯” OLAP å¼•æ“çš„ç³»ç»Ÿå´©æºƒå¯¼è‡´ä¸å¯ç”¨ï¼Œæ•´ä½“äº¤ä»˜æ—¶é—´åè€Œå¤§å¹…ç¼©çŸ­ï¼Œä¸”èµ„æºæˆæœ¬æ˜¾è‘—é™ä½ã€‚</li>
</ul>
<p>è¿™ä¸€å®æˆ˜æœ‰åŠ›åœ°è¯æ˜ï¼šAloudata CAN çš„åŒå¼•æ“æ¶æ„å…·å¤‡äº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä»¥æ›´ç¨³å¥çš„æ–¹å¼é©¾é©­ä¼ä¸šæ ¸å¿ƒæ•°æ®èµ„äº§çš„å·¥ç¨‹èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-2">æ·±åº¦è§£æï¼šç³»ç»Ÿè‡ªåŠ¨åŒ–è¿˜æ˜¯ä¸“å®¶ç»éªŒï¼Ÿ</h2>
<p>é¢å¯¹å¦‚æ­¤åºå¤§çš„è®¡ç®—é‡ï¼Œèµ„æ·± ETL å·¥ç¨‹å¸ˆå¾€å¾€ä¼šè´¨ç–‘ï¼šâ€œå¦‚æœæˆ‘æ‰‹åŠ¨å†™ SQL è¿›è¡Œç²¾ç»†åŒ–åˆ†å±‚å’Œè°ƒä¼˜ï¼Œè‚¯å®šæ¯”ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„è·‘å¾—å¿«ã€‚â€</p>
<p>æ˜¯çš„ï¼Œé’ˆå¯¹å•ä¸€ç‰¹å®šä»»åŠ¡ï¼Œä¸€ä½ç²¾é€šä¸šåŠ¡ä¸é›†ç¾¤ç‰¹æ€§çš„é¡¶å°–ä¸“å®¶ï¼Œç¡®å®èƒ½é€šè¿‡ Case by Case çš„â€œæ‰‹å·¥è‰ºâ€å®ç°æ¯”è‡ªåŠ¨åŒ–ç³»ç»Ÿæ›´é«˜çš„æ•ˆç‡ã€‚ä½†å½“æˆ‘ä»¬æŠŠè§†è§’æ‹‰å‡è‡³ä¼ä¸šçº§å·¥ç¨‹æ—¶ï¼Œè´¦å°±ä¸èƒ½è¿™ä¹ˆç®—äº†ã€‚</p>
<ol>
<li>å¹¶éâ€œæš´åŠ›è®¡ç®—â€</li>
</ol>
<p>Aloudata CAN çš„è®¡ç®—å¼•æ“ä¸æ˜¯ç®€å•çš„ SELECT *ã€‚ç³»ç»Ÿå†…ç½®äº†å¤æ‚çš„ä»»åŠ¡ç¼–æ’é€»è¾‘ï¼Œè‡ªåŠ¨è¿›è¡Œä»»åŠ¡æ‹†åˆ†ã€æ¨å¯¼ä¸­é—´å±‚ä¾èµ–ï¼Œå¹¶æ ¹æ®é›†ç¾¤è´Ÿè½½æ§åˆ¶å¹¶è¡Œåº¦ã€‚å®ƒå¯»æ±‚çš„æ˜¯ä¸€ç§åŸºäºè§„åˆ™æŠ½è±¡çš„ã€æ•´ä½“æ•ˆç‡æœ€é«˜çš„è‡ªåŠ¨åŒ–è·¯å¾„ã€‚</p>
<ol start="2">
<li>è§„æ¨¡æ•ˆåº”ä¸ç»´æŠ¤æˆæœ¬</li>
</ol>
<p>é¡¶å°–ä¸“å®¶æ˜¯ç¨€ç¼ºèµ„æºï¼Œä»–ä»¬æˆ–è®¸èƒ½å®Œç¾ä¼˜åŒ– Top 10 çš„æ ¸å¿ƒä»»åŠ¡ï¼Œä½†å‰©ä½™ 90% çš„é•¿å°¾æŒ‡æ ‡è°æ¥ç»´æŠ¤ï¼Ÿæ›´é‡è¦çš„æ˜¯ï¼Œå½“ä¸šåŠ¡å£å¾„å‘ç”Ÿå¾®è°ƒæ—¶ï¼ˆä¾‹å¦‚ä¿®æ”¹äº†ä¸€ä¸ªä¸­é—´å±‚çš„è¿‡æ»¤æ¡ä»¶ï¼‰ï¼Œäººç±»ä¸“å®¶å¯èƒ½éœ€è¦æ’æŸ¥æ•°åä¸ªè„šæœ¬çš„è¡€ç¼˜å½±å“å¹¶é‡å†™ä»£ç ï¼Œè€Œè‡ªåŠ¨åŒ–ç³»ç»Ÿåªéœ€ä¿®æ”¹è¯­ä¹‰å®šä¹‰ï¼Œå³å¯è‡ªåŠ¨é‡æ–°ç¼–æ’æœ€ä¼˜æ‰§è¡Œè·¯å¾„ã€‚</p>
<p>ç»´æŠ¤æˆæœ¬çš„å½’é›¶ï¼Œæ‰æ˜¯è‡ªåŠ¨åŒ–æœ€å¤§çš„çº¢åˆ©ã€‚</p>
<p>è¿™å°±æ˜¯ Aloudata CAN åŒå¼•æ“æ¶æ„çš„æ ¸å¿ƒä»·å€¼â€”â€”å®ƒè¿½æ±‚çš„ä¸æ˜¯å•ç‚¹æè‡´æ€§èƒ½ï¼Œè€Œæ˜¯ä¼ä¸šçº§æ•´ä½“æ•°æ®å¼€å‘çš„æœ€é«˜æŠ•å…¥äº§å‡ºæ¯”ï¼ˆROIï¼‰ã€‚æœºå™¨ä»¥ 100% çš„å‡†ç¡®ç‡å’Œæé«˜çš„æ€§ä»·æ¯”å®Œæˆæµ·é‡è®¡ç®—ï¼Œå°†å®è´µçš„äººç±»ä¸“å®¶ä»ç¹çä»£ç å’Œè¿ç»´ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºæ•°æ®å»ºæ¨¡ä¸ä¸šåŠ¡ä»·å€¼æŒ–æ˜ã€‚</p>
<h2 data-id="heading-3">ç¡¬æ ¸æŠ€æœ¯æ‹†è§£ï¼šåœ¨å¼‚æ„æ¶æ„ä¹‹ä¸Šé‡æ„ç»Ÿä¸€è¯­ä¹‰</h2>
<p>å¢åŠ ä¸€ä¸ªè®¡ç®—å¼•æ“å¹¶éç®€å•çš„â€œåŠŸèƒ½æŒ‚è½½â€ï¼Œè€Œæ˜¯ä¸€æ¬¡ä¼¤ç­‹åŠ¨éª¨çš„æ¶æ„é‡æ„ã€‚æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºï¼šå¦‚ä½•åœ¨ç‰©ç†æ‰§è¡Œå±‚åˆ†åŒ–ï¼ˆMPP vs Batchï¼‰çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶å‘ä¸Šå±‚ç”¨æˆ·å±è”½å¤æ‚æ€§ï¼Œç»´æŒâ€œå®šä¹‰å³å¼€å‘â€çš„ä½“éªŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa64ff6758d649a58257e8e2a2c19c54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxvdWRhdGHlpKflupTnp5HmioA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769065490&amp;x-signature=FEdaGhwTfBHNZG8LeI6952z1g4E%3D" alt="2EE10882-2991-46BD-AFF6-0C4E33469D6D.png" loading="lazy"/></p>
<p>å›¾ï¼šåŒå¼•æ“æ¶æ„ä¸‹ï¼Œå½“ç”¨æˆ·é€‰æ‹©é€šè¿‡ Spark è¿›è¡ŒåŠ é€Ÿä»»åŠ¡æ„å»ºçš„ç³»ç»Ÿæ¶æ„å›¾</p>
<ol>
<li>æ— æ„ŸçŸ¥çš„æ–¹è¨€ç¿»è¯‘ï¼šæ„å»ºè¯­ä¹‰å±‚çš„â€œé€šç”¨ç¼–è¯‘å™¨â€</li>
</ol>
<p>ç³»ç»Ÿåœ¨è¯­ä¹‰å±‚æ„å»ºäº†ä¸€å¥—é«˜ç²¾åº¦çš„â€œæ–¹è¨€ç¼–è¯‘å™¨â€ã€‚å½“ç”¨æˆ·å‘èµ·åŠ é€Ÿè¯·æ±‚æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ç»Ÿä¸€çš„è¯­ä¹‰æ¨¡å‹ï¼ˆSemantic Modelï¼‰â€œç¼–è¯‘â€ä¸ºé’ˆå¯¹ Spark ä¼˜åŒ–çš„ç‰©ç† SQLã€‚æ— è®ºæ˜¯çª—å£å‡½æ•°è¿˜æ˜¯æ—¥æœŸå¤„ç†ï¼Œç³»ç»Ÿè‡ªåŠ¨æŠ¹å¹³äº† Spark ä¸ OLAP çš„è¯­æ³•å·®å¼‚ï¼Œç¡®ä¿è®¡ç®—ç»“æœåœ¨æ•°å­¦ä¸Šçš„ç»å¯¹ä¸€è‡´ã€‚</p>
<ol start="2">
<li>å¼‚æ„å­˜å‚¨çš„æ— ç¼ååï¼šåŸºäº Arrow Flight çš„é«˜é€Ÿæ€»çº¿</li>
</ol>
<p>ä¸ºäº†è§£å†³ Spark è¯»å– OLAP å†…è¡¨æ•°æ®çš„æ€§èƒ½ç“¶é¢ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ Spark Connector ç»“åˆ Apache Arrow Flight æŠ€æœ¯ï¼Œå®ç°äº†æ•°æ®çš„å‘é‡åŒ–ä¼ è¾“ä¸å¹¶è¡Œè¯»å–ã€‚ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨åˆ‡åˆ† Tablet å¹¶è¡Œæ‹‰å–ï¼Œæå¤§é™ä½äº†åºåˆ—åŒ–å¼€é”€ï¼Œç¡®ä¿æµ·é‡æ˜ç»†æ•°æ®çš„ç§’çº§ååã€‚</p>
<ol start="3">
<li>æ™ºèƒ½åˆ†åŒºç®¡ç†ï¼šå¤§è§„æ¨¡æ•°æ®çš„ä¸€è‡´æ€§ä¿éšœ</li>
</ol>
<p>åœ¨å¤„ç†é•¿å‘¨æœŸå†å²å›åˆ·æ—¶ï¼ŒAloudata CAN æ·±åº¦é›†æˆäº† Spark çš„åŠ¨æ€åˆ†åŒºè¦†å†™ï¼ˆDynamic Partition Overwriteï¼‰æœºåˆ¶ã€‚ç³»ç»Ÿç²¾ç¡®è¯†åˆ«å—å½±å“çš„æ—¶é—´åˆ†åŒºï¼Œä»…å¯¹ç‰¹å®šåˆ†åŒºè¿›è¡Œé‡ç®—ä¸è¦†å†™ï¼Œé…åˆäº‹åŠ¡æœºåˆ¶ï¼Œç¡®ä¿æ— è®ºä»»åŠ¡è€—æ—¶å¤šä¹…ï¼Œå¯¹å¤–å‘ˆç°çš„æ•°æ®å§‹ç»ˆä¸€è‡´ä¸”å¯ç”¨ã€‚</p>
<h2 data-id="heading-4">æ¶æ„çº¢åˆ©ï¼šæ›´ç¨³çš„ SLA ä¸æ›´ä¼˜çš„ ROI</h2>
<p>å¼•å…¥åŒå¼•æ“æ¶æ„ï¼Œæ›´ä¸ºä¼ä¸šå¸¦æ¥äº†éšæ€§çš„æ¶æ„çº¢åˆ©ã€‚</p>
<ol>
<li>èµ„æºéš”ç¦»ï¼šç»ˆç»“â€œè·‘æ‰¹æ‹–å®çœ‹æ•°â€</li>
</ol>
<p>åŒå¼•æ“å®ç°äº†ç‰©ç†å±‚é¢çš„èµ„æºéš”ç¦»ï¼šOLAP å¼•æ“å›å½’â€œæé€ŸæŸ¥è¯¢â€æœ¬ä½ï¼ŒæœåŠ¡ BI ä¸ AIï¼›Spark æ¥ç®¡é‡è´Ÿè½½çš„å…¨é‡æ„å»ºã€‚è¿™ç§åˆ†å·¥å½»åº•è§£å†³äº†â€œæ„å»ºè´Ÿè½½â€æŒ¤å â€œåˆ†æè´Ÿè½½â€çš„éš¾é¢˜ï¼Œç¡®ä¿å‰å° CEO çœ‹æ¿åœ¨ä»»ä½•æ—¶åˆ»éƒ½æµç•…å¦‚åˆã€‚</p>
<ol start="2">
<li>FinOps è§†è§’ä¸‹çš„æœ€ä¼˜è§£</li>
</ol>
<p>ä¼ä¸šä¸å†éœ€è¦ä¸ºäº†åº”å¯¹å¶å°”çš„è®¡ç®—å³°å€¼è€ŒæŒ‰â€œæœ€é«˜æ°´ä½â€é…ç½®æ˜‚è´µçš„ OLAP é›†ç¾¤ã€‚é€šè¿‡å°†ä½é¢‘ã€é«˜ååçš„é‡å‹è®¡ç®—è½¬ç§»è‡³å•ä½æˆæœ¬æ›´ä½çš„ Spark é›†ç¾¤ï¼Œä¼ä¸šå¯ä»¥åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„å‰æä¸‹ï¼Œæ˜¾è‘—é™ä½ TCOã€‚</p>
<ol start="3">
<li>å¼€æ”¾ä¸å…¼å®¹</li>
</ol>
<p>ç³»ç»Ÿé»˜è®¤æ”¯æŒå°†ç»“æœå†™å› Doris å†…è¡¨ä»¥æä¾›æœ€ä½³æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æˆ‘ä»¬åŒæ ·æ”¯æŒ Hive Metastore å’Œ Icebergã€‚æ„å‘³ç€ Aloudata CAN èƒ½æ— ç¼èå…¥ä¼ä¸šå·²æœ‰çš„æ¹–ä»“ç”Ÿæ€ï¼Œä¿æŠ¤æ—¢æœ‰ IT æŠ•èµ„ã€‚</p>
<h2 data-id="heading-5">ç»“è¯­ï¼šè®©æ•°æ®å›¢é˜Ÿå›å½’ä¸šåŠ¡ä»·å€¼</h2>
<p>æŠ€æœ¯çš„è¿›æ­¥ï¼Œæ˜¯ä¸ºäº†å°†äººç±»ä»é‡å¤åŠ³åŠ¨ä¸­è§£æ”¾å‡ºæ¥ã€‚</p>
<p>Aloudata CAN åŒå¼•æ“æ¶æ„çš„æ¨å‡ºå’Œç”Ÿäº§çº§éªŒè¯ï¼Œæ ‡å¿—ç€ NoETL æŒ‡æ ‡å¹³å°è¿™ä¸€è‡ªåŠ¨åŒ–æ•°æ®å¼€å‘ä¸æ²»ç†çš„æ–°å“ç±»å·²ç»å…·å¤‡äº†å¤„ç†ä¼ä¸šçº§æ ¸å¿ƒã€æç«¯è´Ÿè½½çš„æˆç†Ÿèƒ½åŠ›ã€‚é¢å¯¹åƒäº¿çº§æ•°æ®ï¼Œä¼ä¸šæ— éœ€å†ä¸ºâ€œç®—ä¸åŠ¨â€è€Œç„¦è™‘ï¼Œä¹Ÿæ— éœ€åœ¨â€œçµæ´»æ€§â€ä¸â€œç¨³å®šæ€§â€ä¹‹é—´åšè‰°éš¾å–èˆã€‚</p>
<p>å½“æœºå™¨å·²ç»èƒ½ä»¥ 100% çš„å‡†ç¡®ç‡å’Œæœ€ä¼˜æˆæœ¬å®Œæˆæµ·é‡è®¡ç®—æ—¶ï¼Œæ•°æ®ä¸“å®¶çš„æ™ºæ…§ï¼Œåº”å½“èšç„¦äºå®šä¹‰é‚£äº›çœŸæ­£é©±åŠ¨å¢é•¿çš„ä¸šåŠ¡æŒ‡æ ‡ï¼Œè€Œéçº ç»“äºåº•å±‚çš„ SQL å†™æ³•ã€‚</p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬æ„å»ºåŒå¼•æ“æ¶æ„çš„åˆè¡·ï¼šç”¨æœ€ç¡¬æ ¸çš„å·¥ç¨‹åº•åº§ï¼Œæ”¯æ’‘æœ€è‡ªç”±çš„ä¸šåŠ¡æ¢ç´¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹å®æˆ˜ï¼šå¹³æ»‘æ‰©å±•çš„æŠ€æœ¯æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7595311405751189550</link>    <guid>https://juejin.cn/post/7595311405751189550</guid>    <pubDate>2026-01-15T07:05:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405751189550" data-draft-id="7490830568009367567" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹å®æˆ˜ï¼šå¹³æ»‘æ‰©å±•çš„æŠ€æœ¯æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Redis,æ•°æ®åº“,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-15T07:05:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Goé«˜å¹¶å‘æ¶æ„_ç‹å·¥"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹å®æˆ˜ï¼šå¹³æ»‘æ‰©å±•çš„æŠ€æœ¯æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Goé«˜å¹¶å‘æ¶æ„_ç‹å·¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:05:24.000Z" title="Thu Jan 15 2026 07:05:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ–‡ç« å¼•è¨€</h2>
<p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šä½ çš„Redisé›†ç¾¤æ­£åœ¨ä¸ºä¸€ä¸ªå¿«é€Ÿå¢é•¿çš„ä¸šåŠ¡æä¾›ç¼“å­˜æ”¯æŒï¼Œæ¯å¤©æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·è¯·æ±‚èœ‚æ‹¥è€Œè‡³ã€‚ç„¶è€Œï¼Œéšç€æµé‡æ¿€å¢ï¼Œçƒ­ç‚¹Keyçš„è®¿é—®å‹åŠ›è®©å»¶è¿Ÿé£™å‡ï¼Œå•èŠ‚ç‚¹çš„å†…å­˜å’ŒCPUèµ„æºä¹Ÿé€æ¸æ‰è¥Ÿè§è‚˜ã€‚ä¸šåŠ¡è´Ÿè´£äººæ‰¾åˆ°ä½ ï¼Œé—®ï¼šâ€œèƒ½ä¸èƒ½åœ¨ä¸å½±å“çº¿ä¸ŠæœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒæŠŠRedisæ‰©å®¹åˆ°åŒå€è§„æ¨¡ï¼Ÿâ€ä½ è„‘æµ·ä¸­æµ®ç°å‡ºå‡ ä¸ªé—®é¢˜ï¼šæ•°æ®æ€ä¹ˆè¿ç§»ï¼ŸæœåŠ¡èƒ½ä¸èƒ½ä¸åœæœï¼Ÿè¿ç§»è¿‡ç¨‹ä¸­ä¼šä¸ä¼šä¸¢æ•°æ®ï¼Ÿè¿™æ­£æ˜¯Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹çš„å…¸å‹æŒ‘æˆ˜ã€‚</p>
<p>åœ¨ä¸­å°å‹é¡¹ç›®ä¸­ï¼ŒRedisä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œå‡ ä¹æ˜¯ç¼“å­˜å’Œä¼šè¯å­˜å‚¨çš„â€œæ ‡é…â€ã€‚ä½†éšç€ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œå®ƒçš„ç—›ç‚¹ä¹Ÿé€æ¸æš´éœ²ï¼šå•èŠ‚ç‚¹æ€§èƒ½ç“¶é¢ˆå¯¼è‡´QPSå—é™ã€æ•°æ®åˆ†å¸ƒä¸å‡å¼•å‘çƒ­ç‚¹é—®é¢˜ã€è¿ç§»æ—¶æœåŠ¡ä¸å¯ç”¨è®©è¿ç»´äººå‘˜å¤´ç–¼ä¸å·²ã€‚æˆ‘æ›¾åœ¨ä¸€æ¬¡é¡¹ç›®ä¸­é‡åˆ°è¿‡ç±»ä¼¼æƒ…å†µâ€”â€”ç”±äºæ—©æœŸæœªåˆç†è§„åˆ’é›†ç¾¤ï¼Œå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜ï¼Œä¸šåŠ¡é«˜å³°æœŸå»¶è¿Ÿé«˜è¾¾æ•°ç™¾æ¯«ç§’ï¼Œæœ€ç»ˆä¸å¾—ä¸åœ¨å‡Œæ™¨çª—å£æœŸç¡¬ç€å¤´çš®è¿ç§»æ•°æ®ã€‚é‚£æ¬¡ç»å†è®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°ï¼ŒRedisçš„æ‰©å®¹å’Œè¿ç§»ç»ä¸æ˜¯ç®€å•çš„â€œåŠ æœºå™¨â€æ“ä½œï¼Œè€Œæ˜¯éœ€è¦ç§‘å­¦è§„åˆ’å’Œå®æˆ˜éªŒè¯çš„æŠ€æœ¯æ´»ã€‚</p>
<p>æœ¬æ–‡çš„ç›®æ ‡ï¼Œå°±æ˜¯å¸¦ä½ èµ°è¿›Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹çš„å®æˆ˜ä¸–ç•Œã€‚æˆ‘å°†åˆ†äº«ä¸€å¥—ç»è¿‡é¡¹ç›®éªŒè¯çš„å¹³æ»‘æ‰©å±•æ–¹æ¡ˆï¼Œå‰–ææ ¸å¿ƒæŠ€æœ¯ç»†èŠ‚ï¼Œå¹¶ç»“åˆçœŸå®æ¡ˆä¾‹å’Œè¸©å‘ç»éªŒï¼Œå¸®åŠ©ä½ æŒæ¡è¿™é¡¹å…³é”®æŠ€èƒ½ã€‚æ— è®ºä½ æ˜¯æƒ³ä»å•æœºRediså‡çº§åˆ°é›†ç¾¤æ¨¡å¼ï¼Œè¿˜æ˜¯éœ€è¦ä¸ºç°æœ‰é›†ç¾¤åŠ¨æ€æ‰©å®¹ï¼Œè¿™ç¯‡æ–‡ç« éƒ½èƒ½ä¸ºä½ æä¾›æ¸…æ™°çš„æ€è·¯å’Œå¯æ“ä½œçš„æ­¥éª¤ã€‚æ–‡ç« é¢å‘æœ‰1-2å¹´Rediså¼€å‘ç»éªŒçš„å¼€å‘è€…ï¼Œå¦‚æœä½ å·²ç»ç†Ÿæ‚‰Redisçš„åŸºæœ¬æ“ä½œï¼ˆå¦‚Key-Valueå­˜å‚¨ã€ä¸»ä»å¤åˆ¶ï¼‰ï¼Œä½†å¯¹é›†ç¾¤è¿ç§»å’Œæ‰©å®¹è¿˜æ„Ÿåˆ°æ— ä»ä¸‹æ‰‹ï¼Œé‚£ä¹ˆè¿™æ­£æ˜¯ä¸ºä½ é‡èº«æ‰“é€ çš„å†…å®¹ã€‚</p>
<p>ä»ä¸ºä»€ä¹ˆè¦è¿ç§»ä¸æ‰©å®¹ï¼Œåˆ°å…·ä½“çš„å®æ–½æ­¥éª¤ï¼Œå†åˆ°ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥è§£é”Rediså¹³æ»‘æ‰©å±•çš„ç§˜å¯†ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€Redisè¿ç§»ä¸æ‰©å®¹çš„èƒŒæ™¯ä¸æŒ‘æˆ˜</h2>
<h3 data-id="heading-2">1.1 ä¸ºä»€ä¹ˆéœ€è¦è¿ç§»ä¸æ‰©å®¹ï¼Ÿ</h3>
<p>Redisä¹‹æ‰€ä»¥æˆä¸ºå¼€å‘è€…çš„â€œå¿ƒå¤´å¥½â€ï¼Œç¦»ä¸å¼€å®ƒçš„é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨ã€‚ä½†éšç€ä¸šåŠ¡å¢é•¿ï¼Œè¿™ç§â€œç¾å¥½â€ä¹Ÿä¼šé¢ä¸´è€ƒéªŒã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç”µå•†å¹³å°çš„è®¢å•ç¼“å­˜ç³»ç»Ÿï¼ŒåˆæœŸæ—¥å‡QPSåªæœ‰å‡ åƒï¼Œå•èŠ‚ç‚¹Redisè¶³ä»¥èƒœä»»ã€‚å¯ä¸€æ—¦è¿›å…¥ä¿ƒé”€å­£ï¼ŒQPSæš´æ¶¨åˆ°å‡ ä¸‡ç”šè‡³å‡ åä¸‡ï¼Œå•èŠ‚ç‚¹çš„å†…å­˜å®¹é‡å’Œè®¡ç®—èƒ½åŠ›å°±æˆäº†æ‹¦è·¯è™ã€‚æ•°æ®é‡è†¨èƒ€ã€æµé‡å‹åŠ›æ¿€å¢ã€å•å®ä¾‹çš„CPUå’Œç½‘ç»œIOç“¶é¢ˆï¼Œè¿™äº›é—®é¢˜éƒ½åœ¨é€¼è¿«æˆ‘ä»¬æ€è€ƒï¼šå¦‚ä½•è®©Redisè·Ÿä¸Šä¸šåŠ¡çš„æ­¥ä¼ï¼Ÿ</p>
<p>é™¤äº†æ€§èƒ½éœ€æ±‚ï¼Œé«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ä¹Ÿæ˜¯è¿ç§»ä¸æ‰©å®¹çš„é©±åŠ¨åŠ›ã€‚å•æœºRedisä¸€æ—¦å®•æœºï¼ŒæœåŠ¡å°±å½»åº•ä¸å¯ç”¨ï¼›è€Œä¸»ä»æ¶æ„è™½èƒ½ç¼“è§£éƒ¨åˆ†å‹åŠ›ï¼Œä½†ä¸»èŠ‚ç‚¹æ•…éšœæ—¶çš„åˆ‡æ¢æˆæœ¬å’Œæ•°æ®ä¸€è‡´æ€§é£é™©ä¾ç„¶å­˜åœ¨ã€‚é›†ç¾¤åŒ–æˆä¸ºå¿…ç„¶é€‰æ‹©ï¼Œå®ƒä¸ä»…èƒ½æ°´å¹³æ‰©å±•æ€§èƒ½ï¼Œè¿˜èƒ½é€šè¿‡å¤šèŠ‚ç‚¹åˆ†æ‹…é£é™©ã€‚è¿™å°±åƒä»ç‹¬æœ¨æ¡¥å‡çº§åˆ°å¤šè½¦é“é«˜é€Ÿå…¬è·¯ï¼Œæ—¢æå‡äº†é€šè¡Œèƒ½åŠ›ï¼Œåˆå¢å¼ºäº†ç¨³å®šæ€§ã€‚</p>
<h3 data-id="heading-3">1.2 å¸¸è§æŒ‘æˆ˜</h3>
<p>ç„¶è€Œï¼ŒRedisçš„è¿ç§»ä¸æ‰©å®¹å¹¶ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œå®ƒä¼´éšç€å‡ ä¸ªæ£˜æ‰‹æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šè¿ç§»è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ç¡®ä¿æ•°æ®æ—¢ä¸ä¸¢å¤±ä¹Ÿä¸é‡å¤ï¼Ÿè¿™å°±å¥½æ¯”æ¬å®¶æ—¶ï¼Œæ—¢è¦ä¿è¯æ¯ä»¶å®¶å…·éƒ½å¸¦èµ°ï¼Œåˆä¸èƒ½å¤šå¸¦ä¸€å¥—æ²™å‘ã€‚</li>
<li><strong>æœåŠ¡å¯ç”¨æ€§</strong>ï¼šä¸šåŠ¡ä¸èƒ½åœï¼Œè¿ç§»å´è¦åŠ¨â€œå‘½æ ¹å­â€æ•°æ®ï¼Œå¦‚ä½•åšåˆ°ä¸åœæœï¼Ÿè¿™æ˜¯å¯¹æŠ€æœ¯æ–¹æ¡ˆå’Œæ‰§è¡Œèƒ½åŠ›çš„åŒé‡è€ƒéªŒã€‚</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šè¿ç§»å’Œæ‰©å®¹éš¾å…å ç”¨èµ„æºï¼Œå¦‚ä½•å°†å¯¹çº¿ä¸Šä¸šåŠ¡çš„å½±å“é™åˆ°æœ€ä½ï¼Ÿæ²¡æœ‰äººå¸Œæœ›å› ä¸ºä¸€æ¬¡æ‰©å®¹ï¼Œè®©ç”¨æˆ·ä½“éªŒâ€œè·³æ°´â€ã€‚</li>
</ul>
<p>è¿™äº›æŒ‘æˆ˜çœ‹ä¼¼ç®€å•ï¼Œå´éšè—ç€æ— æ•°ç»†èŠ‚ã€‚æ¯”å¦‚ï¼Œæ§½ä½åˆ†é…ä¸å½“å¯èƒ½å¯¼è‡´æ•°æ®å€¾æ–œï¼Œç½‘ç»œæŠ–åŠ¨å¯èƒ½ä¸­æ–­è¿ç§»ï¼Œå®¢æˆ·ç«¯é…ç½®æœªåŠæ—¶æ›´æ–°å¯èƒ½å¼•å‘è¯·æ±‚å¤±è´¥ã€‚è§£å†³è¿™äº›é—®é¢˜ï¼Œéœ€è¦æŠ€æœ¯å’Œç»éªŒçš„åŒé‡åŠ æŒã€‚</p>
<h3 data-id="heading-4">1.3 æˆ‘çš„ç»éªŒæ•™è®­</h3>
<p>æˆ‘æ›¾åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­è¸©è¿‡å‘ã€‚é‚£æ˜¯ä¸€ä¸ªå®æ—¶æ¨èç³»ç»Ÿï¼ŒåˆæœŸä½¿ç”¨3èŠ‚ç‚¹Redisä¸»ä»æ¶æ„ï¼Œæ•°æ®é‡ä¸å¤§æ—¶è¿è¡Œè‰¯å¥½ã€‚ä½†éšç€ç”¨æˆ·å¢é•¿ï¼Œçƒ­ç‚¹Keyé›†ä¸­åœ¨æŸä¸ªèŠ‚ç‚¹ï¼Œå»¶è¿Ÿé—®é¢˜é¢‘å‘ã€‚æˆ‘ä»¬å†³å®šè¿ç§»åˆ°Redis Clusterï¼Œå´ä½ä¼°äº†è§„åˆ’çš„é‡è¦æ€§ã€‚æ²¡æœ‰æå‰åˆ†æKeyåˆ†å¸ƒï¼Œç›´æ¥å¹³å‡åˆ†é…æ§½ä½ï¼Œç»“æœè¿ç§»åçƒ­ç‚¹é—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚åæ¥é€šè¿‡æ—¥å¿—åˆ†æï¼Œæ‰å‘ç°éƒ¨åˆ†Keyçš„è®¿é—®é¢‘ç‡è¿œè¶…é¢„æœŸï¼Œæœ€ç»ˆè°ƒæ•´äº†æ§½ä½åˆ†å¸ƒå¹¶ä¼˜åŒ–äº†Keyè®¾è®¡ï¼Œæ‰è§£å†³é—®é¢˜ã€‚è¿™æ¬¡æ•™è®­å‘Šè¯‰æˆ‘ï¼š<strong>è¿ç§»ä¸æ‰©å®¹ä¸æ˜¯ç®€å•çš„æŠ€æœ¯æ“ä½œï¼Œè€Œæ˜¯å¯¹ä¸šåŠ¡ç†è§£å’Œç³»ç»Ÿè§„åˆ’çš„ç»¼åˆè€ƒéªŒ</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-5">è¿‡æ¸¡åˆ°ä¸‹ä¸€ç« </h3>
<p>äº†è§£äº†è¿ç§»ä¸æ‰©å®¹çš„èƒŒæ™¯å’ŒæŒ‘æˆ˜åï¼Œä½ å¯èƒ½å¥½å¥‡ï¼šåˆ°åº•æœ‰å“ªäº›æŠ€æœ¯æ–¹æ¡ˆèƒ½è®©æˆ‘ä»¬ä¼˜é›…åœ°å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Ÿåˆ«æ€¥ï¼Œä¸‹ä¸€èŠ‚å°†ä¸ºä½ æ­å¼€Rediså¹³æ»‘æ‰©å±•çš„æŠ€æœ¯é¢çº±ã€‚æˆ‘ä»¬å°†ä»Redis Clusterçš„æ ¸å¿ƒæœºåˆ¶å…¥æ‰‹ï¼Œå‰–æå®ç°æ— æ„ŸçŸ¥æ‰©å®¹çš„å…³é”®æ–¹æ³•ï¼Œå¹¶å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆçš„ä¼˜åŠ£ã€‚å‡†å¤‡å¥½è¿æ¥ä¸€åœºæŠ€æœ¯ç››å®´å§ï¼</p>
<hr/>
<h2 data-id="heading-6">äºŒã€å¹³æ»‘æ‰©å±•çš„æŠ€æœ¯æ–¹æ¡ˆæ¦‚è§ˆ</h2>
<p>åœ¨è§£å†³äº†â€œä¸ºä»€ä¹ˆéœ€è¦è¿ç§»ä¸æ‰©å®¹â€çš„ç–‘é—®åï¼Œæˆ‘ä»¬è‡ªç„¶è¦é—®ï¼šæœ‰å“ªäº›æŠ€æœ¯æ–¹æ¡ˆèƒ½è®©æˆ‘ä»¬æ—¢å¹³ç¨³åˆé«˜æ•ˆåœ°å®Œæˆè¿™ä¸€ä»»åŠ¡ï¼ŸRedisä½œä¸ºä¸€ä¸ªæˆç†Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæä¾›äº†åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼ˆRedis Clusterï¼‰ï¼Œå®ƒå°±åƒä¸€è¾†ç²¾å¿ƒè®¾è®¡çš„â€œè¿è¾“è½¦â€ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æŠŠæ•°æ®ä»æ—§èŠ‚ç‚¹å®‰å…¨æ¬åˆ°æ–°èŠ‚ç‚¹ï¼Œè¿˜èƒ½åŠ¨æ€è°ƒæ•´â€œè½¦é“â€ä»¥é€‚åº”ä¸šåŠ¡å¢é•¿ã€‚è¿™ä¸€ç« ï¼Œæˆ‘å°†å¸¦ä½ æ·±å…¥Redis Clusterçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå‰–æå¹³æ»‘æ‰©å±•çš„å…³é”®æŠ€æœ¯ï¼Œå¹¶å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œå¸®ä½ å»ºç«‹å…¨å±€è§†è§’ã€‚</p>
<h3 data-id="heading-7">2.1 Redis Clusterçš„æ ¸å¿ƒæœºåˆ¶</h3>
<p>Redis Clusteræ˜¯Rediså®˜æ–¹æ¨å‡ºçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡æ•°æ®åˆ†ç‰‡å’Œæ§½ä½ç®¡ç†å®ç°æ°´å¹³æ‰©å±•ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„æ ¸å¿ƒè®¾è®¡ï¼š</p>
<ul>
<li><strong>16384ä¸ªæ§½ä½çš„è®¾è®¡ä¸åˆ†é…</strong>ï¼šRedis Clusterå°†æ•°æ®ç©ºé—´åˆ’åˆ†ä¸º16384ä¸ªå“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰ï¼Œæ¯ä¸ªæ§½è´Ÿè´£å­˜å‚¨ä¸€éƒ¨åˆ†Keyã€‚æ§½ä½å°±åƒå¿«é€’åˆ†æ‹£ä¸­å¿ƒçš„æ ¼å­ï¼Œæ¯ä¸ªæ ¼å­éƒ½æœ‰æ˜ç¡®çš„å½’å±èŠ‚ç‚¹ã€‚</li>
<li><strong>å“ˆå¸Œæ§½ä¸èŠ‚ç‚¹æ˜ å°„</strong>ï¼šé€šè¿‡CRC16ç®—æ³•è®¡ç®—Keyçš„å“ˆå¸Œå€¼ï¼Œå†å¯¹16384å–æ¨¡ï¼Œç¡®å®šKeyæ‰€å±çš„æ§½ä½ã€‚èŠ‚ç‚¹åˆ™é€šè¿‡é…ç½®ç»‘å®šè‹¥å¹²æ§½ä½ï¼Œå®ç°æ•°æ®åˆ†å¸ƒã€‚</li>
<li><strong>æ•°æ®åˆ†ç‰‡çš„ä¼˜åŠ¿</strong>ï¼šåˆ†ç‰‡è®©æ•°æ®ä¸å†é›†ä¸­äºå•ä¸€èŠ‚ç‚¹ï¼Œè€Œæ˜¯åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹å¹¶è¡Œå¤„ç†ï¼Œæå¤§æå‡äº†ååé‡å’Œå®¹é‡ã€‚</li>
</ul>
<p>ä¸‹å›¾ç®€å•å±•ç¤ºäº†æ§½ä½ä¸èŠ‚ç‚¹çš„å…³ç³»ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">+-------------------+
| æ§½ä½ <span class="hljs-number">0</span>-<span class="hljs-number">5460</span>  <span class="hljs-punctuation">-&gt;</span> èŠ‚ç‚¹ A |
| æ§½ä½ <span class="hljs-number">5461</span>-<span class="hljs-number">10922</span> <span class="hljs-punctuation">-&gt;</span> èŠ‚ç‚¹ B |
| æ§½ä½ <span class="hljs-number">10923</span>-<span class="hljs-number">16383</span> <span class="hljs-punctuation">-&gt;</span> èŠ‚ç‚¹ C |
+-------------------+
</code></pre>
<p>è¿™ç§è®¾è®¡ä¸ºæ‰©å®¹æä¾›äº†åŸºç¡€ï¼šåªéœ€å°†éƒ¨åˆ†æ§½ä½ä»æ—§èŠ‚ç‚¹è¿ç§»åˆ°æ–°èŠ‚ç‚¹ï¼Œå°±èƒ½å®ç°åŠ¨æ€æ‰©å±•ã€‚</p>
<h3 data-id="heading-8">2.2 å¹³æ»‘æ‰©å±•çš„å…³é”®æŠ€æœ¯</h3>
<p>Redis Clusterçš„å¹³æ»‘æ‰©å±•ä¾èµ–ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä»¬æ˜¯å®ç°â€œä¸åœæœè¿ç§»â€çš„å…³é”®ï¼š</p>
<ul>
<li><strong>åœ¨çº¿æ§½è¿ç§»ï¼ˆ<code>CLUSTER SETSLOT</code>ï¼‰</strong>ï¼šé€šè¿‡å‘½ä»¤åŠ¨æ€è°ƒæ•´æ§½ä½çš„å½’å±ï¼Œæ¯”å¦‚å°†æ§½ä½5461ä»èŠ‚ç‚¹Aè¿ç§»åˆ°èŠ‚ç‚¹Bã€‚è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ—§èŠ‚ç‚¹ä»å¯å“åº”è¯·æ±‚ï¼Œç›´åˆ°æ•°æ®å®Œå…¨åŒæ­¥ã€‚</li>
<li><strong>æ•°æ®è¿ç§»å·¥å…·ï¼ˆå¦‚<code>redis-cli --cluster</code>ï¼‰</strong>ï¼šå®˜æ–¹å·¥å…·æ”¯æŒè‡ªåŠ¨åŒ–è¿ç§»ï¼Œç®€åŒ–æ“ä½œã€‚ä¾‹å¦‚ï¼Œ<code>redis-cli --cluster rebalance</code>èƒ½æ ¹æ®èŠ‚ç‚¹è´Ÿè½½é‡æ–°åˆ†é…æ§½ä½ã€‚</li>
<li><strong>åŒå†™ä¸æ¸è¿›å¼åˆ‡æ¢</strong>ï¼šåœ¨è¿ç§»æœŸé—´ï¼Œå®¢æˆ·ç«¯å¯¹æ—§èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹åŒæ—¶å†™å…¥æ•°æ®ï¼Œç¡®ä¿ä¸€è‡´æ€§ï¼›å®Œæˆåé€æ­¥åˆ‡æ¢è¯»å†™æµé‡ã€‚</li>
</ul>
<p>è¿™äº›æŠ€æœ¯å°±åƒä¸€åœºç²¾å¯†çš„â€œæ¥åŠ›èµ›â€ï¼šæ§½ä½è¿ç§»è´Ÿè´£ä¼ é€’â€œæ¥åŠ›æ£’â€ï¼Œå·¥å…·æä¾›è‡ªåŠ¨åŒ–æ”¯æŒï¼ŒåŒå†™ç­–ç•¥ç¡®ä¿â€œé€‰æ‰‹â€é—´çš„æ— ç¼è¡”æ¥ã€‚</p>
<h3 data-id="heading-9">2.3 æ–¹æ¡ˆä¼˜åŠ¿ä¸ç‰¹è‰²</h3>
<p>Redis Clusterçš„å¹³æ»‘æ‰©å±•æ–¹æ¡ˆæœ‰å‡ ä¸ªæ˜¾è‘—ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>æ— éœ€åœæœï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥</strong>ï¼šè¿ç§»è¿‡ç¨‹å¯¹å®¢æˆ·ç«¯é€æ˜ï¼Œç”¨æˆ·ä½“éªŒä¸å—å½±å“ã€‚</li>
<li><strong>åŠ¨æ€è°ƒæ•´æ§½ä½ï¼Œæ”¯æŒå¼¹æ€§æ‰©å±•</strong>ï¼šæ–°å¢èŠ‚ç‚¹åï¼Œæ§½ä½å¯çµæ´»åˆ†é…ï¼Œé€‚åº”æœªæ¥å¢é•¿ã€‚</li>
<li><strong>å…¼å®¹ç°æœ‰å®¢æˆ·ç«¯</strong>ï¼šæ”¯æŒSmart Clientï¼ˆå¦‚Jedisã€Lettuceï¼‰ï¼Œæ— éœ€é¢å¤–ä»£ç†å±‚ã€‚</li>
</ul>
<p>è¿™äº›ç‰¹æ€§è®©Redis Clusteræˆä¸ºè®¸å¤šå›¢é˜Ÿçš„é¦–é€‰ï¼Œå°¤å…¶é€‚åˆéœ€è¦é«˜å¯ç”¨å’ŒåŠ¨æ€æ‰©å±•çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-10">2.4 ä¸ä¼ ç»Ÿæ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<p>ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£Redis Clusterçš„ä»·å€¼ï¼Œæˆ‘ä»¬ä¸å¦¨å¯¹æ¯”ä¸€ä¸‹å…¶ä»–å¸¸è§æ–¹æ¡ˆï¼š</p>





























<table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>å•æœºRedis + ä¸»ä»</td><td>éƒ¨ç½²ç®€å•ï¼Œé€‚åˆå°è§„æ¨¡ä¸šåŠ¡</td><td>å•ç‚¹ç“¶é¢ˆï¼Œä¸»ä»åˆ‡æ¢æœ‰å»¶è¿Ÿé£é™©</td><td>å°å‹é¡¹ç›®ï¼ŒQPS &lt; 1ä¸‡</td></tr><tr><td>ä»£ç†æ¨¡å¼ï¼ˆå¦‚Twemproxyï¼‰</td><td>æ”¯æŒåˆ†ç‰‡ï¼Œå®¢æˆ·ç«¯æ— éœ€æ”¹åŠ¨</td><td>ä»£ç†å±‚å¢åŠ å¤æ‚åº¦ï¼Œæ‰©å®¹éœ€æ‰‹åŠ¨è°ƒæ•´</td><td>ä¸­å‹é¡¹ç›®ï¼Œè¿½æ±‚ç®€å•è¿ç»´</td></tr><tr><td>Redis Cluster</td><td>åŸç”Ÿæ”¯æŒåˆ†ç‰‡ä¸æ‰©å®¹ï¼ŒåŠ¨æ€è°ƒæ•´æ§½ä½</td><td>é…ç½®ç¨å¤æ‚ï¼Œéœ€Smart Clientæ”¯æŒ</td><td>ä¸­å¤§å‹é¡¹ç›®ï¼Œéœ€é«˜å¯ç”¨æ€§</td></tr></tbody></table>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘æ›¾åœ¨æ—©æœŸé¡¹ç›®ä¸­ç”¨Twemproxyåšåˆ†ç‰‡ï¼ŒåˆæœŸæ•ˆæœä¸é”™ï¼Œä½†æ‰©å®¹æ—¶éœ€è¦æ‰‹åŠ¨è°ƒæ•´ä»£ç†é…ç½®ï¼Œæ“ä½œç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚åæ¥åˆ‡æ¢åˆ°Redis Clusterï¼Œè™½ç„¶å‰æœŸå­¦ä¹ æˆæœ¬é«˜ï¼Œä½†åŠ¨æ€æ‰©å®¹çš„ä¾¿åˆ©æ€§è®©æˆ‘å½»åº•â€œè·¯è½¬ç²‰â€ã€‚</p>
<hr/>
<h3 data-id="heading-11">è¿‡æ¸¡åˆ°ä¸‹ä¸€ç« </h3>
<p>é€šè¿‡è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å·²ç»å¯¹Redis Clusterçš„å¹³æ»‘æ‰©å±•æ–¹æ¡ˆæœ‰äº†åˆæ­¥è®¤è¯†ï¼šå®ƒé€šè¿‡æ§½ä½ç®¡ç†å®ç°æ•°æ®åˆ†ç‰‡ï¼Œå€ŸåŠ©åœ¨çº¿è¿ç§»å’ŒåŒå†™ç­–ç•¥ä¿éšœä¸šåŠ¡è¿ç»­æ€§ã€‚ä½†å…‰æœ‰ç†è®ºè¿˜ä¸å¤Ÿï¼Œå¦‚ä½•åœ¨çœŸå®ç¯å¢ƒä¸­è½åœ°æ‰§è¡Œï¼Ÿä¸‹ä¸€ç« å°†è¿›å…¥å®æˆ˜ç¯èŠ‚ï¼Œæˆ‘å°†å¸¦ä½ ä¸€æ­¥æ­¥å®Œæˆä¸€æ¬¡å®Œæ•´çš„Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹æµç¨‹ï¼Œé…ä¸Šä»£ç ç¤ºä¾‹å’Œè¸©å‘ç»éªŒï¼Œç¡®ä¿ä½ èƒ½â€œæ‹¿æ¥å³ç”¨â€ã€‚å‡†å¤‡å¥½åŠ¨æ‰‹å®è·µäº†å—ï¼Ÿè®©æˆ‘ä»¬ç»§ç»­ï¼</p>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€å®æˆ˜ï¼šRedisæ•°æ®è¿ç§»ä¸æ‰©å®¹çš„å®Œæ•´æµç¨‹</h2>
<p>ç†è®ºå·²ç»é“ºå«å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å·èµ·è¢–å­ï¼Œè¿›å…¥Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹çš„å®æˆ˜ç¯èŠ‚ã€‚è¿™å°±åƒä¸€åœºç²¾å¿ƒæ’ç»ƒçš„æ‰‹æœ¯ï¼Œæ—¢è¦ç¡®ä¿â€œç—…äººâ€ï¼ˆçº¿ä¸ŠæœåŠ¡ï¼‰å®‰ç„¶æ— æ™ï¼Œåˆè¦è®©â€œæ–°å™¨å®˜â€ï¼ˆèŠ‚ç‚¹ï¼‰æ— ç¼æ¥å…¥ã€‚é€šè¿‡è¿™ä¸€ç« ï¼Œä½ å°†æŒæ¡ä»è§„åˆ’åˆ°æ‰§è¡Œçš„å…¨æµç¨‹ï¼Œå­¦ä¼šå¦‚ä½•åœ¨çœŸå®ç¯å¢ƒä¸­ä¼˜é›…åœ°å®Œæˆä¸€æ¬¡æ‰©å®¹ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„ç»éªŒæ€»ç»“ï¼Œæ¥è‡ªå¤šæ¬¡é¡¹ç›®å®è·µï¼Œæ¶µç›–å‰ç½®å‡†å¤‡ã€åˆ†æ­¥å®æ–½å’Œæ³¨æ„äº‹é¡¹ã€‚</p>
<h3 data-id="heading-13">3.1 å‰ç½®å‡†å¤‡</h3>
<p>æ‰©å®¹ä¸æ˜¯ä¸´æ—¶èµ·æ„ï¼Œè€Œæ˜¯éœ€è¦å‘¨å¯†çš„è®¡åˆ’ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<ul>
<li><strong>å®¹é‡è§„åˆ’</strong>ï¼šé¦–å…ˆè¯„ä¼°å½“å‰é›†ç¾¤è´Ÿè½½å’Œæœªæ¥éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œç°æœ‰3èŠ‚ç‚¹é›†ç¾¤æ¯èŠ‚ç‚¹å†…å­˜å ç”¨60%ï¼ŒQPSå³°å€¼2ä¸‡ï¼Œé¢„è®¡åŠå¹´åQPSç¿»å€ã€‚ä½ å¯ä»¥ç”¨<code>INFO</code>å‘½ä»¤æŸ¥çœ‹å†…å­˜ã€CPUå’Œè¿æ¥æ•°ï¼Œç»“åˆä¸šåŠ¡å¢é•¿æ›²çº¿é¢„ä¼°æ–°èŠ‚ç‚¹æ•°ã€‚</li>
<li><strong>ç¯å¢ƒæ­å»º</strong>ï¼šåœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²Rediså®ä¾‹ï¼Œç¡®ä¿ç‰ˆæœ¬ä¸€è‡´ï¼ˆæ¨è6.0+ä»¥æ”¯æŒæ›´ç¨³å®šçš„é›†ç¾¤åŠŸèƒ½ï¼‰ã€‚é…ç½®æ–‡ä»¶ä¸­å¼€å¯<code>cluster-enabled yes</code>ï¼Œå¹¶æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ã€‚</li>
<li><strong>å·¥å…·é€‰æ‹©</strong>ï¼šæˆ‘å¸¸ç”¨<code>redis-cli --cluster</code>ï¼Œå®ƒç®€å•é«˜æ•ˆï¼Œæ”¯æŒè‡ªåŠ¨åŒ–è¿ç§»ã€‚è€ç‰ˆæœ¬çš„<code>redis-trib.rb</code>ä¹Ÿå¯ä»¥ï¼Œä½†å·²è¢«åºŸå¼ƒã€‚ç¬¬ä¸‰æ–¹å·¥å…·å¦‚RedisShakeé€‚ç”¨äºå¤æ‚åœºæ™¯ï¼ˆå¦‚è·¨äº‘è¿ç§»ï¼‰ï¼Œä½†éœ€æµ‹è¯•å…¼å®¹æ€§ã€‚</li>
</ul>
<p><strong>å°è´´å£«</strong>ï¼šè§„åˆ’æ—¶åˆ«å¿˜äº†ç•™20%-30%çš„ç¼“å†²ç©ºé—´ï¼Œé¿å…æ‰©å®¹åˆšå®Œæˆåˆâ€œçˆ†ä»“â€ã€‚</p>
<h3 data-id="heading-14">3.2 åˆ†æ­¥å®æ–½</h3>
<p>æ¥ä¸‹æ¥æ˜¯å®æ–½è¿‡ç¨‹ï¼Œæˆ‘å°†æ‹†è§£ä¸ºå››ä¸ªæ­¥éª¤ï¼Œæ¯æ­¥é…ä¸Šä»£ç å’Œè¯´æ˜ã€‚</p>
<h4 data-id="heading-15">æ­¥éª¤1ï¼šæ·»åŠ æ–°èŠ‚ç‚¹</h4>
<p>å‡è®¾ç°æœ‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹ï¼ˆAã€Bã€Cï¼‰ï¼Œæˆ‘ä»¬è¦åŠ å…¥èŠ‚ç‚¹Dã€‚å…ˆå¯åŠ¨Dçš„Rediså®ä¾‹ï¼Œç„¶åç”¨<code>CLUSTER MEET</code>å°†å…¶æ¥å…¥é›†ç¾¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨èŠ‚ç‚¹Dæ‰§è¡Œï¼Œå‡è®¾èŠ‚ç‚¹Açš„IPä¸º192.168.1.10:6379</span>
redis-cli -h 192.168.1.10 -p 6379 cluster meet 192.168.1.13 6379
</code></pre>
<ul>
<li><strong>æ³¨é‡Š</strong>ï¼š<code>CLUSTER MEET</code>ä¼šè§¦å‘èŠ‚ç‚¹æ¡æ‰‹ï¼ŒDåŠ å…¥é›†ç¾¤ä½†æš‚æ— æ§½ä½åˆ†é…ã€‚</li>
<li><strong>éªŒè¯</strong>ï¼šç”¨<code>CLUSTER NODES</code>æ£€æŸ¥Dæ˜¯å¦å‡ºç°åœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­ã€‚</li>
</ul>
<h4 data-id="heading-16">æ­¥éª¤2ï¼šæ§½ä½è¿ç§»</h4>
<p>æ§½ä½æ˜¯æ•°æ®çš„â€œæ¬è¿å•ä½â€ã€‚å‡è®¾èŠ‚ç‚¹Aæœ‰5461ä¸ªæ§½ä½ï¼ˆ0-5460ï¼‰ï¼Œæˆ‘ä»¬è®¡åˆ’è¿ç§»1000ä¸ªæ§½åˆ°èŠ‚ç‚¹Dï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ä»»æ„èŠ‚ç‚¹æ‰§è¡Œï¼ŒæŒ‡å®šæºèŠ‚ç‚¹Aå’Œç›®æ ‡èŠ‚ç‚¹D</span>
redis-cli --cluster reshard 192.168.1.10:6379 \
  --cluster-from &lt;èŠ‚ç‚¹Açš„node_id&gt; \
  --cluster-to &lt;èŠ‚ç‚¹Dçš„node_id&gt; \
  --cluster-slots 1000
</code></pre>
<ul>
<li><strong>æ³¨é‡Š</strong>ï¼š<code>reshard</code>ä¼šäº¤äº’å¼è¯¢é—®è¿ç§»å“ªäº›æ§½ï¼Œè¾“å…¥<code>yes</code>ç¡®è®¤ã€‚<code>node_id</code>å¯é€šè¿‡<code>CLUSTER NODES</code>è·å–ã€‚</li>
<li><strong>ç›‘æ§</strong>ï¼šç”¨<code>CLUSTER INFO</code>æŸ¥çœ‹è¿ç§»è¿›åº¦ï¼Œç¡®ä¿æ§½çŠ¶æ€ä»<code>migrating</code>å˜ä¸ºç¨³å®šã€‚</li>
</ul>
<p><strong>å®æˆ˜åœºæ™¯</strong>ï¼šè¿ç§»æ—¶å»ºè®®åˆ†æ‰¹è¿›è¡Œï¼Œæ¯”å¦‚æ¯æ¬¡500-1000ä¸ªæ§½ï¼Œé¿å…ä¸€æ¬¡æ€§å ç”¨è¿‡å¤šèµ„æºå¯¼è‡´æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<h4 data-id="heading-17">æ­¥éª¤3ï¼šæ•°æ®åŒæ­¥</h4>
<p>æ§½ä½è¿ç§»åï¼Œæ•°æ®éœ€è¦åŒæ­¥ã€‚ä¸ºä¿è¯ä¸€è‡´æ€§ï¼Œæˆ‘æ¨èåŒå†™ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯Java Jediså®ç°çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">JedisCluster</span> <span class="hljs-variable">oldCluster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"192.168.1.10"</span>, <span class="hljs-number">6379</span>));
<span class="hljs-type">JedisCluster</span> <span class="hljs-variable">newCluster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"192.168.1.13"</span>, <span class="hljs-number">6379</span>));

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dualWrite</span><span class="hljs-params">(String key, String value)</span> {
    <span class="hljs-comment">// åŒæ—¶å†™å…¥æ—§é›†ç¾¤å’Œæ–°é›†ç¾¤</span>
    oldCluster.set(key, value);
    newCluster.set(key, value);
}

<span class="hljs-comment">// æ•°æ®æ ¡éªŒï¼šå¯¹æ¯”ä¸¤è¾¹æ•°æ®</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verifyData</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> oldCluster.get(key);
    <span class="hljs-type">String</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> newCluster.get(key);
    <span class="hljs-keyword">return</span> oldValue != <span class="hljs-literal">null</span> &amp;&amp; oldValue.equals(newValue);
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š</strong>ï¼šåŒå†™ç¡®ä¿è¿ç§»æœŸé—´æ•°æ®ä¸€è‡´ã€‚æ ¡éªŒæ—¶å¯æŠ½æ ·æ£€æŸ¥Keyï¼Œé¿å…å…¨é‡æ‰«æå½±å“æ€§èƒ½ã€‚</li>
</ul>
<h4 data-id="heading-18">æ­¥éª¤4ï¼šåˆ‡æ¢ä¸æ¸…ç†</h4>
<p>æ•°æ®åŒæ­¥å®Œæˆåï¼Œæ›´æ–°å®¢æˆ·ç«¯é…ç½®ï¼Œåˆ‡æ¢æµé‡åˆ°æ–°é›†ç¾¤ï¼Œæœ€åç§»é™¤æ—§èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># éªŒè¯æ–°é›†ç¾¤çŠ¶æ€</span>
redis-cli --cluster check 192.168.1.13:6379

<span class="hljs-comment"># ç§»é™¤æ—§èŠ‚ç‚¹ï¼ˆå‡è®¾ç§»é™¤èŠ‚ç‚¹Cï¼‰</span>
redis-cli --cluster del-node 192.168.1.12:6379 &lt;èŠ‚ç‚¹Cçš„node_id&gt;
</code></pre>
<ul>
<li><strong>æ³¨é‡Š</strong>ï¼š<code>check</code>ç¡®è®¤æ§½ä½åˆ†é…æ­£å¸¸åï¼Œ<code>del-node</code>æ¸…ç†æ— æ§½èŠ‚ç‚¹ã€‚</li>
</ul>
<h3 data-id="heading-19">3.3 æœ€ä½³å®è·µ</h3>
<p>å®æˆ˜ä¸­ï¼Œæˆ‘æ€»ç»“äº†å‡ ä¸ªç»éªŒï¼š</p>
<ul>
<li><strong>å°æ‰¹é‡è¿ç§»</strong>ï¼šæ¯æ¬¡è¿ç§»å°‘é‡æ§½ï¼ˆ500-1000ï¼‰ï¼Œè§‚å¯Ÿæ€§èƒ½åå†ç»§ç»­ã€‚</li>
<li><strong>ä½¿ç”¨Pipeline</strong>ï¼šæ‰¹é‡æ“ä½œKeyæ—¶ç”¨Pipelineï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚ä¾‹å¦‚ï¼ŒJedisçš„<code>pipeline.sync()</code>å¯æå‡10å€æ•ˆç‡ã€‚</li>
<li><strong>æå‰æµ‹è¯•å·¥å…·</strong>ï¼šä¸åŒç‰ˆæœ¬çš„<code>redis-cli</code>è¡Œä¸ºå¯èƒ½æœ‰å·®å¼‚ï¼Œé¢„æ¼”ä¸€éé¿å…æ„å¤–ã€‚</li>
</ul>
<h3 data-id="heading-20">3.4 è¸©å‘ç»éªŒ</h3>
<h4 data-id="heading-21">æ¡ˆä¾‹1ï¼šç½‘ç»œæŠ–åŠ¨å¯¼è‡´æ§½è¿ç§»å¤±è´¥</h4>
<p>ä¸€æ¬¡è¿ç§»ä¸­ï¼Œå› ç½‘ç»œç¬æ–­ï¼Œéƒ¨åˆ†æ§½çŠ¶æ€å¡åœ¨<code>migrating</code>ï¼Œå®¢æˆ·ç«¯æŠ¥<code>ASK</code>é”™è¯¯ã€‚æ’æŸ¥å‘ç°ç›®æ ‡èŠ‚ç‚¹æœªæ”¶åˆ°å®Œæ•´æ•°æ®ã€‚è§£å†³åŠæ³•æ˜¯ç”¨<code>CLUSTER SETSLOT &lt;slot&gt; NODE &lt;node_id&gt;</code>æ‰‹åŠ¨ä¿®å¤ï¼Œå¹¶é‡è¯•è¿ç§»ã€‚</p>
<h4 data-id="heading-22">æ¡ˆä¾‹2ï¼šå®¢æˆ·ç«¯é…ç½®æœªæ›´æ–°</h4>
<p>åˆ‡æ¢åï¼Œéƒ¨åˆ†å®¢æˆ·ç«¯ä»æŒ‡å‘æ—§èŠ‚ç‚¹ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚åŸå› æ˜¯æœªåŠæ—¶åˆ·æ–°é…ç½®ã€‚å»ºè®®ç”¨é…ç½®ä¸­å¿ƒï¼ˆå¦‚Apolloï¼‰åŠ¨æ€æ¨é€æ–°åœ°å€ï¼Œå¹¶è®¾ç½®TTLè‡ªåŠ¨è¿‡æœŸæ—§è¿æ¥ã€‚</p>
<hr/>
<h3 data-id="heading-23">è¿‡æ¸¡åˆ°ä¸‹ä¸€ç« </h3>
<p>é€šè¿‡è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡ä»è§„åˆ’åˆ°è½åœ°çš„Redisæ‰©å®¹å®æˆ˜ã€‚ä½ æ˜¯å¦å·²ç»è·ƒè·ƒæ¬²è¯•ï¼Œæƒ³åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å®è·µä¸€ç•ªï¼Ÿåˆ«æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šåˆ†äº«ä¸€ä¸ªçœŸå®é¡¹ç›®æ¡ˆä¾‹ï¼Œå‰–æå¦‚ä½•å°†è¿™äº›æŠ€æœ¯åº”ç”¨åˆ°å¤æ‚åœºæ™¯ä¸­ï¼Œå¹¶æ­ç¤ºæ›´å¤šéšè—çš„ç»†èŠ‚ã€‚å‡†å¤‡å¥½è¿æ¥æ›´æ·±å…¥çš„æŒ‘æˆ˜å§ï¼</p>
<hr/>
<h2 data-id="heading-24">å››ã€çœŸå®é¡¹ç›®æ¡ˆä¾‹åˆ†æ</h2>
<p>ç†è®ºå’Œæ­¥éª¤éƒ½è®²å®Œäº†ï¼Œä½†æŠ€æœ¯çœŸæ­£çš„ä»·å€¼è¿˜æ˜¯è¦é€šè¿‡å®è·µæ¥æ£€éªŒã€‚è¿™ä¸€ç« ï¼Œæˆ‘å°†åˆ†äº«ä¸€ä¸ªçœŸå®çš„ç”µå•†é¡¹ç›®æ¡ˆä¾‹ï¼Œå¸¦ä½ çœ‹çœ‹Redisè¿ç§»ä¸æ‰©å®¹å¦‚ä½•åœ¨é«˜å¹¶å‘åœºæ™¯ä¸­è½åœ°ã€‚ä»é¡¹ç›®èƒŒæ™¯åˆ°å®æ–½ç»†èŠ‚ï¼Œå†åˆ°æˆæœä¸åæ€ï¼Œå¸Œæœ›èƒ½è®©ä½ æ„Ÿå—åˆ°è¿™åœºâ€œæ‰©å®¹ä¹‹æ—…â€çš„çœŸå®æ¸©åº¦ã€‚</p>
<h3 data-id="heading-25">4.1 é¡¹ç›®èƒŒæ™¯</h3>
<p>è¿™æ˜¯ä¸€ä¸ªç”µå•†å¹³å°çš„è®¢å•ç¼“å­˜ç³»ç»Ÿï¼Œè´Ÿè´£å­˜å‚¨ç”¨æˆ·çš„è´­ç‰©è½¦å’Œè®¢å•çŠ¶æ€ã€‚æœ€åˆçš„æ¶æ„æ˜¯3èŠ‚ç‚¹ä¸»ä»Redisï¼ˆ1ä¸»2ä»ï¼‰ï¼Œæ¯èŠ‚ç‚¹é…ç½®16GBå†…å­˜ï¼Œå³°å€¼QPSçº¦1ä¸‡ï¼Œå¹³å‡å»¶è¿Ÿ10msã€‚éšç€ä¸šåŠ¡æ‰©å±•ï¼Œå°¤å…¶æ˜¯å¤§ä¿ƒæ´»åŠ¨æœŸé—´ï¼ŒQPSæ¿€å¢åˆ°10ä¸‡ï¼Œçƒ­ç‚¹Keyï¼ˆå¦‚çˆ†æ¬¾å•†å“çš„åº“å­˜ï¼‰å¯¼è‡´ä¸»èŠ‚ç‚¹è´Ÿè½½é£™å‡ï¼Œå»¶è¿Ÿå‡è‡³20msï¼Œç”šè‡³å¶ç°è¶…æ—¶ã€‚å›¢é˜Ÿå†³å®šå‡çº§åˆ°6èŠ‚ç‚¹Redis Clusterï¼Œæ—¢æå‡å®¹é‡ï¼Œåˆè§£å†³çƒ­ç‚¹é—®é¢˜ã€‚</p>
<ul>
<li><strong>åŸæ¶æ„</strong>ï¼š3èŠ‚ç‚¹ä¸»ä»ï¼ˆ192.168.1.10-12:6379ï¼‰ã€‚</li>
<li><strong>ç›®æ ‡æ¶æ„</strong>ï¼š6èŠ‚ç‚¹é›†ç¾¤ï¼ˆæ–°å¢192.168.1.13-15:6379ï¼‰ã€‚</li>
<li><strong>æŒ‘æˆ˜</strong>ï¼šä¸åœæœè¿ç§»ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œé™ä½å»¶è¿Ÿã€‚</li>
</ul>
<h3 data-id="heading-26">4.2 å®æ–½è¿‡ç¨‹</h3>
<h4 data-id="heading-27">å®¹é‡è¯„ä¼°ä¸æ§½ä½é‡æ–°åˆ†é…</h4>
<p>æˆ‘ä»¬å…ˆç”¨<code>INFO MEMORY</code>å’Œ<code>INFO STATS</code>åˆ†æç°æœ‰è´Ÿè½½ï¼Œå‘ç°ä¸»èŠ‚ç‚¹å†…å­˜å ç”¨75%ï¼Œä»èŠ‚ç‚¹åŸºæœ¬é—²ç½®ï¼ŒQPSç“¶é¢ˆåœ¨ä¸»èŠ‚ç‚¹çš„CPUã€‚å¤§ä¿ƒé¢„è®¡QPSç¿»å€ï¼Œå†…å­˜éœ€æ±‚å¢è‡³40GBã€‚æŒ‰æ¯èŠ‚ç‚¹16GBè®¡ç®—ï¼Œ6èŠ‚ç‚¹é›†ç¾¤èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä¸”ç•™æœ‰ä½™é‡ã€‚</p>
<p>æ§½ä½åˆ†é…ä¸Šï¼ŒåŸ3èŠ‚ç‚¹å¹³å‡æ¯èŠ‚ç‚¹5461ä¸ªæ§½ï¼ˆ16384 Ã· 3ï¼‰ï¼Œæ‰©å®¹åè°ƒæ•´ä¸ºæ¯èŠ‚ç‚¹2730ä¸ªæ§½ï¼ˆ16384 Ã· 6ï¼‰ã€‚ä¸ºé¿å…çƒ­ç‚¹ï¼Œæˆ‘ä»¬åˆ†æäº†Keyåˆ†å¸ƒï¼Œå°†é«˜é¢‘è®¿é—®çš„å•†å“IDæ§½ä½åˆ†æ•£åˆ°ä¸åŒèŠ‚ç‚¹ã€‚</p>
<h4 data-id="heading-28">æ•°æ®è¿ç§»çš„å…·ä½“æ“ä½œ</h4>
<ol>
<li>
<p><strong>åŠ å…¥æ–°èŠ‚ç‚¹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -h 192.168.1.10 -p 6379 cluster meet 192.168.1.13 6379
redis-cli -h 192.168.1.10 -p 6379 cluster meet 192.168.1.14 6379
redis-cli -h 192.168.1.10 -p 6379 cluster meet 192.168.1.15 6379
</code></pre>
<ul>
<li><strong>éªŒè¯</strong>ï¼š<code>CLUSTER NODES</code>æ˜¾ç¤º6ä¸ªèŠ‚ç‚¹å·²è¿æ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ§½ä½è¿ç§»</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli --cluster reshard 192.168.1.10:6379 \
  --cluster-from &lt;èŠ‚ç‚¹Açš„node_id&gt; \
  --cluster-to &lt;èŠ‚ç‚¹Dçš„node_id&gt; \
  --cluster-slots 2730
</code></pre>
<ul>
<li><strong>æ‰§è¡Œ</strong>ï¼šåˆ†3æ¬¡è¿ç§»ï¼Œæ¯æ¬¡è¿ç§»900-1000ä¸ªæ§½ï¼Œè§‚å¯ŸCPUå’Œç½‘ç»œè´Ÿè½½ã€‚</li>
<li><strong>ç›‘æ§</strong>ï¼šç”¨<code>CLUSTER INFO</code>ç¡®è®¤æ§½ä½çŠ¶æ€ç¨³å®šã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®åŒæ­¥ä¸åŒå†™</strong>ï¼š
å®¢æˆ·ç«¯ç”¨Jediså®ç°åŒå†™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">JedisCluster</span> <span class="hljs-variable">oldCluster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"192.168.1.10"</span>, <span class="hljs-number">6379</span>));
<span class="hljs-type">JedisCluster</span> <span class="hljs-variable">newCluster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"192.168.1.13"</span>, <span class="hljs-number">6379</span>));

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrder</span><span class="hljs-params">(String orderId, String data)</span> {
    oldCluster.setex(orderId, <span class="hljs-number">3600</span>, data); <span class="hljs-comment">// æ—§é›†ç¾¤ï¼ŒTTL 1å°æ—¶</span>
    newCluster.setex(orderId, <span class="hljs-number">3600</span>, data); <span class="hljs-comment">// æ–°é›†ç¾¤</span>
}
</code></pre>
<ul>
<li><strong>æ ¡éªŒ</strong>ï¼šæŠ½æŸ¥1000ä¸ªKeyï¼Œç¡®ä¿ä¸¤è¾¹ä¸€è‡´ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç°åº¦åˆ‡æ¢</strong>ï¼š</p>
<ul>
<li>å…ˆå°†10%æµé‡åˆ‡åˆ°æ–°é›†ç¾¤ï¼Œè§‚å¯Ÿå»¶è¿Ÿå’Œé”™è¯¯ç‡ã€‚</li>
<li>é€æ­¥æå‡åˆ°100%ï¼Œç”¨é…ç½®ä¸­å¿ƒæ¨é€æ–°é›†ç¾¤åœ°å€ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-29">åœ¨çº¿éªŒè¯ä¸æ¸…ç†</h4>
<p>åˆ‡æ¢åï¼Œç”¨<code>redis-cli --cluster check</code>éªŒè¯æ§½ä½åˆ†å¸ƒï¼Œæ–°é›†ç¾¤è¿è¡Œæ­£å¸¸ã€‚æ—§ä»èŠ‚ç‚¹ï¼ˆ192.168.1.11-12ï¼‰æ— æ§½ä½åç§»é™¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli --cluster del-node 192.168.1.11:6379 &lt;node_id&gt;
</code></pre>
<h3 data-id="heading-30">4.3 æˆæœä¸åæ€</h3>
<h4 data-id="heading-31">æˆæœ</h4>
<ul>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šQPSä»1ä¸‡å‡è‡³10ä¸‡ï¼Œå»¶è¿Ÿä»20msé™è‡³5msï¼Œé›†ç¾¤è´Ÿè½½å‡è¡¡ã€‚</li>
<li><strong>å®¹é‡æ‰©å±•</strong>ï¼šå†…å­˜ä»48GBï¼ˆ3Ã—16ï¼‰å¢è‡³96GBï¼ˆ6Ã—16ï¼‰ï¼Œæ”¯æŒæœªæ¥6ä¸ªæœˆå¢é•¿ã€‚</li>
<li><strong>é«˜å¯ç”¨æ€§</strong>ï¼š6èŠ‚ç‚¹åˆ†å¸ƒï¼Œä¸»ä»å¤åˆ¶ä¿éšœæ•…éšœåˆ‡æ¢ã€‚</li>
</ul>
<h4 data-id="heading-32">é‡åˆ°çš„é—®é¢˜</h4>
<p>è¿ç§»ä¸­å‘ç°éƒ¨åˆ†çƒ­ç‚¹Keyï¼ˆå¦‚çˆ†æ¬¾å•†å“åº“å­˜ï¼‰ä»é›†ä¸­åœ¨æŸèŠ‚ç‚¹ï¼Œå¯¼è‡´å»¶è¿ŸæŠ–åŠ¨ã€‚åˆ†æåå‘ç°æ˜¯Keyè®¾è®¡é—®é¢˜ï¼šæ‰€æœ‰åº“å­˜Keyå‰ç¼€ç›¸åŒï¼ˆå¦‚<code>inventory:product:123</code>ï¼‰ï¼Œå“ˆå¸Œåæ§½ä½è¿‡äºé›†ä¸­ã€‚</p>
<h4 data-id="heading-33">æ”¹è¿›å»ºè®®</h4>
<ul>
<li><strong>ä¼˜åŒ–Keyè®¾è®¡</strong>ï¼šåœ¨Keyä¸­åŠ å…¥éšæœºåç¼€ï¼ˆå¦‚<code>inventory:product:123:shard1</code>ï¼‰ï¼Œåˆ†æ•£æ§½ä½ã€‚</li>
<li><strong>é¢„åˆ†ç‰‡</strong>ï¼šæå‰æŒ‰ä¸šåŠ¡æ¨¡å—åˆ†é…æ§½ä½ï¼Œæ¯”å¦‚è®¢å•å’Œåº“å­˜å„å ä¸€åŠã€‚</li>
<li><strong>ç›‘æ§åŠ å¼º</strong>ï¼šå¼•å…¥Redis Exporter + Prometheusï¼Œå®æ—¶è¿½è¸ªçƒ­ç‚¹ã€‚</li>
</ul>
<p><strong>åæ€</strong>ï¼šè¿™æ¬¡æ‰©å®¹è®©æˆ‘æ„è¯†åˆ°ï¼ŒæŠ€æœ¯æ–¹æ¡ˆåªæ˜¯åŸºç¡€ï¼Œä¸šåŠ¡ç†è§£å’ŒKeyè®¾è®¡æ‰æ˜¯å†³å®šæˆè´¥çš„å…³é”®ã€‚å¦‚æœä¸€å¼€å§‹å°±è€ƒè™‘çƒ­ç‚¹éš”ç¦»ï¼Œè¿ç§»ä¼šæ›´é¡ºç•…ã€‚</p>
<hr/>
<h3 data-id="heading-34">è¿‡æ¸¡åˆ°ä¸‹ä¸€ç« </h3>
<p>è¿™ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†Redisæ‰©å®¹çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¹Ÿæš´éœ²äº†ä¸€äº›éšè—çš„å‘ã€‚æˆ–è®¸ä½ å·²ç»å¼€å§‹æ€è€ƒï¼šå¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ï¼Ÿä¸‹ä¸€ç« å°†è¿›å…¥è¿›é˜¶ç¯èŠ‚ï¼Œæˆ‘ä¼šåˆ†äº«æ›´å¤šä¼˜åŒ–æŠ€å·§å’Œæ³¨æ„äº‹é¡¹ï¼Œå¸®åŠ©ä½ åœ¨å®æˆ˜ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚è®©æˆ‘ä»¬ç»§ç»­æ¢ç´¢å§ï¼</p>
<hr/>
<h2 data-id="heading-35">äº”ã€è¿›é˜¶ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹</h2>
<p>å®Œæˆäº†Redisè¿ç§»ä¸æ‰©å®¹çš„å®æˆ˜åï¼Œä½ å¯èƒ½è§‰å¾—å·²ç»æŒæ¡äº†æ ¸å¿ƒæŠ€èƒ½ï¼Œä½†çœŸæ­£çš„æŒ‘æˆ˜å¾€å¾€è—åœ¨ç»†èŠ‚é‡Œã€‚è¿™å°±åƒå¼€è½¦ä¸Šè·¯ï¼Œå­¦ä¼šèµ·æ­¥å’Œæ¢æŒ¡åªæ˜¯å¼€å§‹ï¼Œå¦‚ä½•åœ¨å¤æ‚è·¯å†µä¸‹ä¿æŒå¹³ç¨³é«˜æ•ˆï¼Œæ‰æ˜¯é«˜æ‰‹ä¸æ–°æ‰‹çš„åŒºåˆ«ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘å°†åˆ†äº«ä¸€äº›è¿›é˜¶ä¼˜åŒ–æŠ€å·§ã€é«˜å¯ç”¨æ€§ä¿éšœæ–¹æ³•ï¼Œä»¥åŠå¸¸è§é—®é¢˜çš„åº”å¯¹ç­–ç•¥ï¼Œå¸®ä½ åœ¨Redisæ‰©å®¹çš„â€œé•¿è·‘â€ä¸­è·‘å¾—æ›´å¿«ã€æ›´ç¨³ã€‚</p>
<h3 data-id="heading-36">5.1 æ€§èƒ½ä¼˜åŒ–</h3>
<p>æ€§èƒ½æ˜¯Redisçš„ç”Ÿå‘½çº¿ï¼Œæ‰©å®¹åå¦‚ä½•è¿›ä¸€æ­¥æ¦¨å–æ½œåŠ›ï¼Ÿä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li><strong>æ§½ä½åˆ†é…ç­–ç•¥</strong>ï¼šå‡åŒ€åˆ†å¸ƒæ§½ä½æ˜¯åŸºç¡€ï¼Œä½†çƒ­ç‚¹Keyå¯èƒ½æ‰“ä¹±å¹³è¡¡ã€‚å»ºè®®æ ¹æ®ä¸šåŠ¡ç‰¹æ€§éš”ç¦»çƒ­ç‚¹ï¼Œæ¯”å¦‚å°†é«˜é¢‘è®¿é—®çš„ä¼šè¯æ•°æ®å’Œä½é¢‘çš„é…ç½®æ•°æ®åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹ã€‚å¯ä»¥ç”¨<code>CLUSTER GETKEYSINSLOT &lt;slot&gt; &lt;count&gt;</code>æ£€æŸ¥æ§½å†…Keyåˆ†å¸ƒã€‚</li>
<li><strong>å®¢æˆ·ç«¯ä¼˜åŒ–</strong>ï¼šJediså’ŒLettuceæ˜¯ä¸»æµå®¢æˆ·ç«¯ï¼Œä½†æ€§èƒ½å·®å¼‚æ˜æ˜¾ã€‚Jedisçš„Clusteræ¨¡å¼åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½å› è¿æ¥æ± ç®¡ç†ä¸å–„å¯¼è‡´é˜»å¡ï¼Œè€ŒLettuceåŸºäºNettyï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œï¼Œå»¶è¿Ÿæ›´ä½ã€‚æˆ‘åœ¨ä¸€ä¸ªQPSè¶…10ä¸‡çš„é¡¹ç›®ä¸­ï¼Œä»Jedisåˆ‡æ¢åˆ°Lettuceåï¼ŒP99å»¶è¿Ÿä»10msé™åˆ°6msã€‚</li>
<li><strong>Pipelineä¸æ‰¹é‡æ“ä½œ</strong>ï¼šè¿ç§»å’Œæ—¥å¸¸æ“ä½œä¸­ï¼ŒPipelineèƒ½æ˜¾è‘—å‡å°‘ç½‘ç»œå¾€è¿”ã€‚ä¾‹å¦‚ï¼Œæ‰¹é‡å†™å…¥1000ä¸ªKeyæ—¶ï¼ŒPipelineæ¯”å•æ¡å‘½ä»¤å¿«10å€ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Jedis Pipeline ç¤ºä¾‹</span>
<span class="hljs-type">JedisCluster</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"192.168.1.13"</span>, <span class="hljs-number">6379</span>));
<span class="hljs-type">Pipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> jedis.pipelined();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    pipeline.set(<span class="hljs-string">"key:"</span> + i, <span class="hljs-string">"value"</span> + i);
}
pipeline.sync();
</code></pre>
<p><strong>å°è´´å£«</strong>ï¼šä¼˜åŒ–å‰ç”¨<code>SLOWLOG</code>åˆ†ææ…¢æŸ¥è¯¢ï¼Œå®šä½ç“¶é¢ˆåå†é’ˆå¯¹æ€§è°ƒæ•´ã€‚</p>
<h3 data-id="heading-37">5.2 é«˜å¯ç”¨ä¿éšœ</h3>
<p>æ‰©å®¹åï¼Œé›†ç¾¤è§„æ¨¡å˜å¤§ï¼Œé«˜å¯ç”¨æ€§ï¼ˆHAï¼‰å˜å¾—æ›´é‡è¦ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªä¿éšœæªæ–½ï¼š</p>
<ul>
<li><strong>ä¸»ä»å¤åˆ¶ä¸æ•…éšœè½¬ç§»</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹é…ä»èŠ‚ç‚¹ï¼ˆ<code>CLUSTER REPLICATE &lt;master_id&gt;</code>ï¼‰ï¼Œä¸»èŠ‚ç‚¹æ•…éšœæ—¶ä»èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡ã€‚å»ºè®®è‡³å°‘1ä¸»1ä»ï¼Œå¤æ‚åœºæ™¯å¯1ä¸»2ä»ã€‚</li>
<li><strong>Sentinelä¸Clusterç»“åˆ</strong>ï¼šRedis Clusterè‡ªå¸¦æ•…éšœè½¬ç§»ï¼Œä½†Sentinelå¯æä¾›é¢å¤–çš„ç›‘æ§å’Œé€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œé…ç½®Sentinelç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œæ•…éšœæ—¶æ¨é€å‘Šè­¦ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">sentinel monitor mymaster 192.168.1.13 6379 2
sentinel <span class="hljs-built_in">set</span> mymaster down-after-milliseconds 5000
</code></pre>
<ul>
<li><strong>è·¨å¯ç”¨åŒºéƒ¨ç½²</strong>ï¼šåœ¨äº‘ç¯å¢ƒä¸­ï¼Œå°†èŠ‚ç‚¹åˆ†å¸ƒåˆ°ä¸åŒå¯ç”¨åŒºï¼ˆAZï¼‰ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚æˆ‘æ›¾åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å› æœªè·¨AZéƒ¨ç½² éƒ¨ç½²ï¼Œé­é‡æœºæˆ¿æ–­ç”µå¯¼è‡´æœåŠ¡å…¨æŒ‚ï¼Œåæ¥è°ƒæ•´ä¸º3AZåˆ†å¸ƒï¼Œç¨³å®šæ€§å¤§å¹…æå‡ã€‚</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šä¸»ä»å¤åˆ¶ä¼šå¢åŠ ç½‘ç»œå¼€é”€ï¼Œå»ºè®®ç›‘æ§å¸¦å®½å ç”¨ï¼Œå¿…è¦æ—¶å‹ç¼©æ•°æ®ã€‚</p>
<h3 data-id="heading-38">5.3 å¸¸è§é—®é¢˜FAQ</h3>
<p>å®æˆ˜ä¸­æ€»ä¼šé‡åˆ°æ„å¤–ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•ï¼š</p>
<ul>
<li><strong>Qï¼šè¿ç§»ä¸­Keyä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</strong>
<strong>A</strong>ï¼šé€šå¸¸æ˜¯åŒå†™æœªæ­£ç¡®å®ç°æˆ–è¿ç§»ä¸­æ–­å¯¼è‡´ã€‚æ£€æŸ¥å®¢æˆ·ç«¯åŒå†™é€»è¾‘ï¼Œç¡®ä¿æ—§é›†ç¾¤å’Œæ–°é›†ç¾¤åŒæ—¶å†™å…¥ã€‚è¿ç§»å¤±è´¥çš„æ§½å¯ç”¨<code>CLUSTER SETSLOT &lt;slot&gt; NODE &lt;node_id&gt;</code>æ¢å¤ã€‚</li>
<li><strong>Qï¼šæ‰©å®¹åå®¢æˆ·ç«¯æŠ¥<code>MOVED</code>é”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ</strong>
<strong>A</strong>ï¼šè¯´æ˜å®¢æˆ·ç«¯æœªåŠæ—¶æ›´æ–°æ§½ä½æ˜ å°„ã€‚Smart Clientï¼ˆå¦‚Jedisï¼‰ä¼šè‡ªåŠ¨é‡è¯•ï¼Œä½†é¢‘ç¹<code>MOVED</code>å¯èƒ½å› è¿æ¥æ± æœªåˆ·æ–°ã€‚å»ºè®®é‡å¯å®¢æˆ·ç«¯æˆ–åŠ¨æ€æ›´æ–°é…ç½®ã€‚</li>
<li><strong>Qï¼šè¿ç§»åæ€§èƒ½æœªæå‡ï¼Œåè€Œä¸‹é™ï¼Ÿ</strong>
<strong>A</strong>ï¼šå¯èƒ½æ˜¯çƒ­ç‚¹Keyé›†ä¸­æˆ–æ§½ä½åˆ†é…ä¸å‡ã€‚ç”¨<code>redis-cli --hotkeys</code>åˆ†æçƒ­ç‚¹ï¼Œå¿…è¦æ—¶è°ƒæ•´Keyè®¾è®¡æˆ–é‡æ–°åˆ†é…æ§½ä½ã€‚</li>
</ul>
<h3 data-id="heading-39">5.4 ç»éªŒæ€»ç»“</h3>
<p>å›é¡¾å¤šæ¬¡é¡¹ç›®å®è·µï¼Œæˆ‘æç‚¼å‡ºä¸€å¥è¯ï¼š<strong>è¿ç§»ä¸æ‰©å®¹çš„æ ¸å¿ƒåœ¨äºè§„åˆ’å…ˆè¡Œï¼Œé€æ­¥éªŒè¯</strong>ã€‚æ— è®ºæ˜¯å®¹é‡è¯„ä¼°ã€æ§½ä½åˆ†é…ï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯åˆ‡æ¢ï¼Œæ¯ä¸€æ­¥éƒ½è¦æœ‰å¤‡é€‰æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸‰æ¡å¿ƒå¾—ï¼š</p>
<ol>
<li><strong>é¢„æ¼”ä¸å¯å°‘</strong>ï¼šåœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿè¿ç§»ï¼Œæš´éœ²å·¥å…·å’Œç½‘ç»œé—®é¢˜ã€‚</li>
<li><strong>ç›‘æ§æ˜¯æ•‘å‘½ç¨»è‰</strong>ï¼šç”¨Prometheusæˆ–Redisè‡ªå¸¦çš„<code>INFO</code>å‘½ä»¤ï¼Œå®æ—¶å…³æ³¨è¿ç§»è¿›åº¦å’Œæ€§èƒ½æŒ‡æ ‡ã€‚</li>
<li><strong>ä¸šåŠ¡ä¼˜å…ˆ</strong>ï¼šæŠ€æœ¯æ–¹æ¡ˆå†å®Œç¾ï¼Œä¹Ÿè¦æœåŠ¡äºä¸šåŠ¡ï¼Œç¡®ä¿è¿ç§»å¯¹ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-40">è¿‡æ¸¡åˆ°ä¸‹ä¸€ç« </h3>
<p>é€šè¿‡è¿™ä¸€ç« ï¼Œæˆ‘ä»¬ä¸ä»…ä¼˜åŒ–äº†Redisé›†ç¾¤çš„æ€§èƒ½ï¼Œè¿˜ä¸ºé«˜å¯ç”¨æ€§åŠ äº†â€œä¿é™©â€ã€‚è¿™äº›è¿›é˜¶æŠ€å·§å’Œç»éªŒæ•™è®­ï¼Œåº”è¯¥èƒ½è®©ä½ åœ¨æœªæ¥çš„æ‰©å®¹ä»»åŠ¡ä¸­æ›´åŠ ä»å®¹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥æ€»ç»“ç¯èŠ‚ï¼Œå›é¡¾å…¨æ–‡è¦ç‚¹ï¼Œå¹¶å±•æœ›Redisçš„æœªæ¥è¶‹åŠ¿ï¼Œå¸®ä½ ä¸ºä¸‹ä¸€æ¬¡æŒ‘æˆ˜åšå¥½å‡†å¤‡ï¼</p>
<hr/>
<h2 data-id="heading-41">å…­ã€æ€»ç»“ä¸å±•æœ›</h2>
<p>ç»è¿‡å‰å‡ ç« çš„æ¢ç´¢ï¼Œæˆ‘ä»¬ä»Redisè¿ç§»ä¸æ‰©å®¹çš„èƒŒæ™¯å‡ºå‘ï¼Œä¸€è·¯èµ°åˆ°äº†å®æˆ˜æ¡ˆä¾‹å’Œè¿›é˜¶ä¼˜åŒ–ã€‚è¿™å°±åƒä¸€åœºä»â€œæ–°æ‰‹æ‘â€åˆ°â€œå‰¯æœ¬æŒ‘æˆ˜â€çš„æ—…ç¨‹ï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†å¹³æ»‘æ‰©å±•çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè¿˜å­¦ä¼šäº†å¦‚ä½•åœ¨çœŸå®é¡¹ç›®ä¸­çµæ´»åº”å¯¹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœä¸‹æ¥ï¼Œå›é¡¾æ”¶è·ï¼Œå±•æœ›æœªæ¥ï¼Œä¸ºè¿™åœºRedisæ‰©å®¹ä¹‹æ—…ç”»ä¸Šåœ†æ»¡çš„å¥å·ã€‚</p>
<h3 data-id="heading-42">6.1 æ ¸å¿ƒå›é¡¾</h3>
<p>Redisæ•°æ®è¿ç§»ä¸æ‰©å®¹çš„ç—›ç‚¹â€”â€”æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡å¯ç”¨æ€§å’Œæ€§èƒ½å½±å“ï¼Œåœ¨Redis Clusterçš„åŠ æŒä¸‹è¿åˆƒè€Œè§£ã€‚å®ƒçš„16384ä¸ªæ§½ä½è®¾è®¡ä¸ºæ•°æ®åˆ†ç‰‡æä¾›äº†åŸºç¡€ï¼Œåœ¨çº¿æ§½è¿ç§»å’ŒåŒå†™ç­–ç•¥è®©æ‰©å®¹å˜å¾—â€œæ— æ„Ÿâ€ï¼Œè€Œåˆç†çš„è§„åˆ’å’Œå·¥å…·æ”¯æŒåˆ™ç¡®ä¿äº†è¿‡ç¨‹çš„å¹³ç¨³è½åœ°ã€‚æˆ‘ä»¬è¿˜é€šè¿‡æ¡ˆä¾‹çœ‹åˆ°ï¼ŒKeyè®¾è®¡å’Œçƒ­ç‚¹éš”ç¦»å¯¹æ€§èƒ½çš„æ·±è¿œå½±å“ï¼Œæé†’æˆ‘ä»¬åœ¨æŠ€æœ¯ä¹‹å¤–å…³æ³¨ä¸šåŠ¡ç‰¹æ€§ã€‚è¿™äº›æ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š<strong>æ—¢èƒ½è§£å†³å½“å‰ç“¶é¢ˆï¼Œåˆä¸ºæœªæ¥å¢é•¿ç•™è¶³ç©ºé—´</strong>ã€‚</p>
<h3 data-id="heading-43">6.2 å®æˆ˜ä»·å€¼</h3>
<p>é€šè¿‡æœ¬æ–‡ï¼Œä½ åº”è¯¥å·²ç»èƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¸€æ¬¡Redisé›†ç¾¤æ‰©å®¹ã€‚ä»å®¹é‡è¯„ä¼°åˆ°æ§½ä½è¿ç§»ï¼Œå†åˆ°å®¢æˆ·ç«¯åˆ‡æ¢ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ¸…æ™°çš„æŒ‡å¼•å’Œä»£ç æ”¯æŒã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ–‡ä¸­åˆ†äº«çš„è¸©å‘ç»éªŒâ€”â€”å¦‚ç½‘ç»œæŠ–åŠ¨å¯¼è‡´çš„æ§½å¤±è´¥ã€çƒ­ç‚¹Keyçš„é‡æ–°å¹³è¡¡â€”â€”èƒ½å¸®ä½ å°‘èµ°å¼¯è·¯ã€‚æ— è®ºä½ æ˜¯ä¸­å°å‹é¡¹ç›®çš„è¿ç»´æ–°äººï¼Œè¿˜æ˜¯éœ€è¦ä¼˜åŒ–é«˜å¹¶å‘ç³»ç»Ÿçš„å¤§å‚å¼€å‘è€…ï¼Œè¿™å¥—æ–¹æ³•éƒ½èƒ½â€œæ‹¿æ¥å³ç”¨â€ï¼Œè®©ä½ åœ¨é¢å¯¹ä¸šåŠ¡å‹åŠ›æ—¶å¤šä¸€ä»½åº•æ°”ã€‚</p>
<h3 data-id="heading-44">6.3 æœªæ¥è¶‹åŠ¿</h3>
<p>Redisä½œä¸ºä¸€ä¸ªä¸æ–­è¿›åŒ–çš„æŠ€æœ¯ï¼Œå…¶æœªæ¥å‘å±•ä¹Ÿå€¼å¾—å…³æ³¨ã€‚Redis 7.0å¼•å…¥çš„å¤šçº¿ç¨‹IOæå¤§æå‡äº†ç½‘ç»œæ€§èƒ½ï¼Œå¯èƒ½è®©å•èŠ‚ç‚¹æ‰¿è½½æ›´é«˜QPSï¼Œå‡å°‘æ‰©å®¹é¢‘ç‡ã€‚æ­¤å¤–ï¼ŒRediså®˜æ–¹å¯¹Clusterçš„ä¼˜åŒ–ï¼ˆå¦‚æ›´æ™ºèƒ½çš„æ§½åˆ†é…ç®—æ³•ï¼‰ä¹Ÿåœ¨æŒç»­æ¨è¿›ã€‚å¦ä¸€æ–¹é¢ï¼Œäº‘åŸç”Ÿè¶‹åŠ¿ä¸‹ï¼ŒRedis Operatorå’Œæ‰˜ç®¡æœåŠ¡ï¼ˆå¦‚AWS ElastiCacheï¼‰ç®€åŒ–äº†é›†ç¾¤ç®¡ç†ï¼Œæœªæ¥å¯èƒ½æˆä¸ºä¸»æµé€‰æ‹©ã€‚æˆ‘ä¸ªäººé¢„æµ‹ï¼Œç»“åˆAIçš„è´Ÿè½½é¢„æµ‹å’Œè‡ªåŠ¨åŒ–æ‰©å®¹å·¥å…·ï¼Œä¼šè®©Redisçš„è¿ç»´æ›´åŠ â€œèªæ˜â€ï¼Œè¿™æ˜¯å€¼å¾—æˆ‘ä»¬æŒç»­è·Ÿè¸ªçš„æ–¹å‘ã€‚</p>
<h3 data-id="heading-45">6.4 ä¸ªäººå¿ƒå¾—ä¸é¼“åŠ±äº’åŠ¨</h3>
<p>ä½œä¸ºä¸€åRedisçš„â€œè€ç”¨æˆ·â€ï¼Œæˆ‘æœ€å¤§çš„å¿ƒå¾—æ˜¯ï¼š<strong>æŠ€æœ¯æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡çš„ï¼Œä»»ä½•æ–¹æ¡ˆéƒ½è¦ä»¥ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒä¸ºå‰æ</strong>ã€‚è¿™æ¬¡å†™ä½œè®©æˆ‘é‡æ–°æ¢³ç†äº†å¤šå¹´ç»éªŒï¼Œä¹Ÿå¸Œæœ›èƒ½ä¸ºä½ å¸¦æ¥å¯å‘ã€‚å¦‚æœä½ ä¹Ÿåœ¨é¡¹ç›®ä¸­åšè¿‡è¿ç§»ä¸æ‰©å®¹ï¼Œä¸å¦¨åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ•…äº‹â€”â€”é‡åˆ°è¿‡å“ªäº›å‘ï¼Ÿç”¨è¿‡å“ªäº›å¦™æ‹›ï¼Ÿæˆ‘å¾ˆæœŸå¾…ä¸ä½ äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2.Android 3åˆ†é’Ÿè·‘é€šShadowå®˜æ–¹æ’ä»¶åŒ–Demoï¼ˆMavenç‰ˆï¼‰ï¼šå®¿ä¸»/ç®¡ç†å™¨/æ’ä»¶ä¸‰å·¥ç¨‹(å®æˆ˜)]]></title>    <link>https://juejin.cn/post/7594741180950102062</link>    <guid>https://juejin.cn/post/7594741180950102062</guid>    <pubDate>2026-01-14T00:04:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594741180950102062" data-draft-id="7594482829754449966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2.Android  3åˆ†é’Ÿè·‘é€šShadowå®˜æ–¹æ’ä»¶åŒ–Demoï¼ˆMavenç‰ˆï¼‰ï¼šå®¿ä¸»/ç®¡ç†å™¨/æ’ä»¶ä¸‰å·¥ç¨‹(å®æˆ˜)"/> <meta itemprop="keywords" content="Android,å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-14T00:04:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹ç¨‹åå…«å°‘"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2.Android  3åˆ†é’Ÿè·‘é€šShadowå®˜æ–¹æ’ä»¶åŒ–Demoï¼ˆMavenç‰ˆï¼‰ï¼šå®¿ä¸»/ç®¡ç†å™¨/æ’ä»¶ä¸‰å·¥ç¨‹(å®æˆ˜)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹ç¨‹åå…«å°‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T00:04:29.000Z" title="Wed Jan 14 2026 00:04:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ‘˜è¦</strong><br/>
è…¾è®¯å¼€æºçš„Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2FShadow" target="_blank" title="https://github.com/Tencent/Shadow" ref="nofollow noopener noreferrer">Shadow</a>Â æ˜¯ä¸€ä¸ª<strong>æ—  Hookã€é›¶åå°„ã€æ”¯æŒå››å¤§ç»„ä»¶</strong>çš„å·¥ä¸šçº§ Android æ’ä»¶åŒ–æ¡†æ¶ï¼Œå·²åœ¨ QQ ç­‰äº¿çº§åº”ç”¨ä¸­ç¨³å®šè¿è¡Œå¤šå¹´ã€‚<br/>
æœ¬æ–‡åŸºäºå®˜æ–¹Â <code>Maven äºŒè¿›åˆ¶ä¾èµ–</code>Â æ–¹å¼ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ Â <strong>3 åˆ†é’Ÿè·‘é€šå®˜æ–¹ Demo</strong>ï¼Œæ·±å…¥è§£æÂ <strong>å®¿ä¸» Ã— ç®¡ç†å™¨ Ã— æ’ä»¶</strong>Â ä¸‰å¤§å·¥ç¨‹çš„èŒè´£ã€åä½œæœºåˆ¶ä¸æºç åŸç†ï¼ŒåŠ©ä½ å¿«é€Ÿè¿ˆå‘ç”Ÿäº§çº§æ’ä»¶åŒ–å®è·µã€‚</p>
</blockquote>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbdd0e306e3744f08177c370f323ea41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=TcTkZCoNeAD4wNF1cau6KLquCZE%3D" alt="shadow3.gif" loading="lazy"/></p>
<h3 data-id="heading-0">ä¸€ã€ç›®æ ‡ä¸èƒŒæ™¯</h3>
<h4 data-id="heading-1">âœ… æœ¬æ–‡ç›®æ ‡</h4>
<ul>
<li>å®Œå…¨é€šè¿‡Â <strong>Maven Central ä¾èµ–</strong>ï¼ˆéæºç ä¾èµ–ï¼‰æ„å»ºï¼›</li>
<li>æˆåŠŸè¿è¡Œå®˜æ–¹Â <code>projects/sample/maven</code>Â ç¤ºä¾‹ï¼›</li>
<li>ç†è§£ Shadow çš„Â <strong>ä¸‰å·¥ç¨‹æ¶æ„è®¾è®¡</strong>Â åŠå…¶ç”Ÿäº§æ„ä¹‰ã€‚</li>
</ul>
<h4 data-id="heading-2">ğŸ”— å®˜æ–¹èµ„æº</h4>
<ul>
<li>GitHub åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2FShadow" target="_blank" title="https://github.com/Tencent/Shadow" ref="nofollow noopener noreferrer">github.com/Tencent/Shaâ€¦</a></li>
<li>Sample æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2FShadow%2Fblob%2Fmaster%2Fprojects%2Fsample%2FREADME.md" target="_blank" title="https://github.com/Tencent/Shadow/blob/master/projects/sample/README.md" ref="nofollow noopener noreferrer">projects/sample/README.md</a></li>
</ul>
<blockquote>
<p>âš ï¸Â <strong>é‡è¦æç¤º</strong>ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š</p>
<blockquote>
<p>â€œ<code>maven</code>Â ç›®å½•ä¸‹çš„ 3 ä¸ªå·¥ç¨‹åœ¨å®é™…ä¸šåŠ¡ä¸­å¤§æ¦‚ç‡æ˜¯Â <strong>3 ä¸ªç‹¬ç«‹ä»£ç åº“</strong>ã€‚å®ƒä»¬ä¹‹é—´<strong>æ²¡æœ‰ Gradle ä¾èµ–å…³ç³»</strong>ï¼Œç”šè‡³Â <strong>Shadow ç‰ˆæœ¬å·éƒ½æ˜¯å„è‡ªç‹¬ç«‹é…ç½®çš„</strong>ã€‚â€</p>
</blockquote>
<p>å› æ­¤ï¼Œè¯·åŠ¡å¿…Â <strong>ç”¨ Android Studio åˆ†åˆ«æ‰“å¼€è¿™ä¸‰ä¸ªç›®å½•</strong>ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">äºŒã€ä¸‰å¤§å·¥ç¨‹è§’è‰²è¯´æ˜</h3>
<p>è¡¨æ ¼</p>





























<table><thead><tr><th>å·¥ç¨‹</th><th>è§’è‰²</th><th>æ˜¯å¦å¯ç‹¬ç«‹è¿è¡Œ</th><th>è¾“å‡ºäº§ç‰©</th></tr></thead><tbody><tr><td><code>host-project</code></td><td>å®¿ä¸» App</td><td>âœ… æœ‰ Launcher å›¾æ ‡</td><td>APK</td></tr><tr><td><code>manager-project</code></td><td>æ’ä»¶ç®¡ç†å™¨</td><td>âŒ æ— å›¾æ ‡ï¼ˆçº¯ Libraryï¼‰</td><td>AAR</td></tr><tr><td><code>plugin-project</code></td><td>æ’ä»¶ App</td><td>âŒ æ— å›¾æ ‡ï¼ˆè¢«åŠ¨æ€åŠ è½½ï¼‰</td><td>APK</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b3b58777475417fae168507e80ed380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=p0M88AC1wQfRj%2BYZ14tXbCkLYmU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/241b8a1affe74e0499da7ba90f186b68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=idAvnFSgG00%2FbaCu34Z57gIlYgY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f804881ceaa4f25936557d46d017498~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=ARCZyQZTEbV%2BDYDC2GYbglnmpwE%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ğŸ’¡Â <strong>è®¾è®¡å“²å­¦</strong>ï¼šä¸‰è€…å®Œå…¨è§£è€¦ï¼Œæ¨¡æ‹ŸçœŸå®å¾®æœåŠ¡åŒ–å¼€å‘åœºæ™¯â€”â€”å®¿ä¸»ä¸å…³å¿ƒæ’ä»¶å®ç°ï¼Œæ’ä»¶ä¸ä¾èµ–å®¿ä¸»ä»£ç ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€ç¯å¢ƒé…ç½®ï¼šè§£å†³ç¼–è¯‘é—®é¢˜ï¼ˆå…³é”®ï¼ï¼‰</h3>
<p>åŸå§‹ Sample åŸºäºæ—§ç‰ˆå·¥å…·é“¾ï¼Œéœ€å‡çº§ä»¥ä¸‹ä¸‰é¡¹ä»¥å…¼å®¹Â <strong>JDK 17 + AGP 7.4+</strong> ï¼š</p>
<h4 data-id="heading-5">1. å‡çº§ Gradle Wrapper</h4>
<p>ä¿®æ”¹æ¯ä¸ªé¡¹ç›®çš„Â <code>gradle/wrapper/gradle-wrapper.properties</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">distributionUrl</span>=https://mirrors.tencent.com/gradle/gradle-<span class="hljs-number">7.5</span>-bin.zip
</code></pre>
<h4 data-id="heading-6">2. ä½¿ç”¨ JDK 17</h4>
<ul>
<li>
<p>Android Studio Flamingo / Giraffe é»˜è®¤ä½¿ç”¨ JDK 17ï¼›</p>
</li>
<li>
<p>è‹¥ä½¿ç”¨ JDK 8/11ï¼Œä¼šæŠ¥é”™ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">Caused <span class="hljs-keyword">by</span>: org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed
</code></pre>
</li>
</ul>
<h4 data-id="heading-7">3. å‡çº§ Android Gradle Plugin (AGP)</h4>
<p>åœ¨æ¯ä¸ªé¡¹ç›®çš„Â <strong>Project çº§Â <code>build.gradle</code></strong>Â ä¸­ï¼š</p>
<blockquote>
<p>æ˜¯7.0.2 ä¸æ˜¯7.4.2 å¦åˆ™ç¼–è¯‘æŠ¥é”™</p>
</blockquote>
<pre><code class="hljs language-arduino" lang="arduino">classpath <span class="hljs-string">'com.android.tools.build:gradle:7.0.2'</span>
</code></pre>
<p>å¦åˆ™ä¼šé‡åˆ°æ¨¡å—è®¿é—®é™åˆ¶é”™è¯¯ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Unable to make field <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">String</span> java.io.<span class="hljs-built_in">File</span>.path accessible
</code></pre>
<blockquote>
<p>âœ… éªŒè¯è·¯å¾„ï¼š<code>File &gt; Project Structure &gt; SDK Location &gt; JDK location</code></p>
</blockquote>
<hr/>
<h3 data-id="heading-8">å››ã€åˆ†æ­¥æ„å»ºä¸é›†æˆ</h3>
<h4 data-id="heading-9">4.1 æ„å»ºæ’ä»¶å·¥ç¨‹ï¼ˆ<code>plugin-project</code>ï¼‰</h4>
<h5 data-id="heading-10">é¡¹ç›®ç»“æ„</h5>
<pre><code class="hljs language-bash" lang="bash">plugin-project/
â”œâ”€â”€ plugin-app/          <span class="hljs-comment"># æ’ä»¶ä¸šåŠ¡æ¨¡å—ï¼ˆå« Activityï¼‰</span>
â”œâ”€â”€ sample-loader/       <span class="hljs-comment"># æ’ä»¶åŠ è½½å™¨</span>
â””â”€â”€ sample-runtime/      <span class="hljs-comment"># æ’ä»¶è¿è¡Œæ—¶ç¯å¢ƒ</span>
</code></pre>
<h5 data-id="heading-11">æ ¸å¿ƒèŒè´£</h5>
<ul>
<li><code>plugin-app</code>ï¼šç¼–å†™æ’ä»¶ä¸šåŠ¡é€»è¾‘ï¼Œ<strong>å¿…é¡»ä½¿ç”¨ç‹¬ç«‹ applicationId</strong>ï¼›</li>
<li><code>sample-loader</code>ï¼šè´Ÿè´£åŠ è½½æ’ä»¶ DEXï¼Œåˆ›å»º PluginClassLoaderï¼›</li>
<li><code>sample-runtime</code>ï¼šæä¾› Contextã€Resourceã€Instrumentation ç­‰ä»£ç†å®ç°ã€‚</li>
</ul>
<h5 data-id="heading-12">æ„å»ºå‘½ä»¤</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> plugin-project
./gradlew packageDebugPlugin 
</code></pre>
<h5 data-id="heading-13">è¾“å‡ºæ–‡ä»¶</h5>
<p>è¿™ä¸ªç›®å½•ä¸‹ç”Ÿæˆçš„ï¼š plugin-project\build\</p>
<pre><code class="hljs language-lua" lang="lua">F:\shadow0907\Shadow-master\projects\sample\maven\plugin-project\build\plugin-<span class="hljs-built_in">debug</span>.zip
</code></pre>
<p>ç„¶åæ‰§è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">adb push build/plugin-debug.zip /data/local/tmp
</code></pre>
<blockquote>
<p>âš ï¸Â <strong>é‡å‘½å</strong>ï¼šå¿…é¡»æ”¹ä¸ºÂ <code>sample-plugin-debug.apk</code>ï¼ˆå®¿ä¸»ä»£ç ä¸­å†™æ­»æ­¤åç§°ï¼ï¼‰</p>
</blockquote>
<hr/>
<h4 data-id="heading-14">4.2 æ„å»ºç®¡ç†å™¨å·¥ç¨‹ï¼ˆ<code>manager-project</code>ï¼‰</h4>
<h5 data-id="heading-15">æ ¸å¿ƒèŒè´£</h5>
<ul>
<li>å®ç°Â <code>PluginManager</code>Â æ¥å£ï¼›</li>
<li>ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼›</li>
<li>é€šè¿‡Â <code>fromId</code>Â åŒºåˆ†ä¸åŒæ’ä»¶å…¥å£ã€‚</li>
</ul>
<h5 data-id="heading-16">å…³é”®ä»£ç ï¼ˆ<code>SamplePluginManager.java</code>ï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enter</span><span class="hljs-params">(Context context, <span class="hljs-type">long</span> fromId, Bundle bundle, EnterCallback callback)</span> {
    <span class="hljs-keyword">if</span> (fromId == FROM_ID_START_ACTIVITY) {
        startPluginActivity(context, bundle, callback);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ä¸è®¤è¯†çš„fromId=="</span> + fromId); <span class="hljs-comment">// â† å¸¸è§å´©æºƒç‚¹ï¼</span>
    }
}
</code></pre>
<blockquote>
<p>ğŸ’¡Â <strong>æ³¨æ„</strong>ï¼šç¡®ä¿Â <code>FROM_ID_START_ACTIVITY = 1001</code>Â ä¸å®¿ä¸»è°ƒç”¨ä¸€è‡´ï¼</p>
</blockquote>
<h5 data-id="heading-17">æ„å»ºå‘½ä»¤</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> manager-project
./gradlew assembleDebug 
</code></pre>
<p>è¾“å‡º F:\shadow0907\Shadow-master\projects\sample\maven\manager-project\sample-manager\build\outputs\apk\debug\sample-manager-debug.apk</p>
<p>ç„¶åæ‰§è¡Œ</p>
<pre><code class="hljs language-lua" lang="lua">adb push sample-manager/build/outputs/apk/<span class="hljs-built_in">debug</span>/sample-manager-<span class="hljs-built_in">debug</span>.apk /data/<span class="hljs-keyword">local</span>/tmp
</code></pre>
<hr/>
<h4 data-id="heading-18">4.3 é…ç½®å®¿ä¸»å·¥ç¨‹ï¼ˆ<code>host-project</code>ï¼‰</h4>
<p>ç›´æ¥è¿è¡Œï¼Œå°±å¯ä»¥äº†</p>
<h5 data-id="heading-19">å¯åŠ¨æ’ä»¶</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainActivity.java</span>
mPluginManager.enter(<span class="hljs-keyword">this</span>, <span class="hljs-number">1001</span>, <span class="hljs-string">"com.tencent.shadow.sample.plugin_main.MainActivity"</span>);
</code></pre>
<blockquote>
<p>âœ…Â <code>1001</code>Â å¿…é¡»ä¸Â <code>SamplePluginManager</code>Â ä¸­å¤„ç†çš„Â <code>fromId</code>Â ä¸€è‡´ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<h4 data-id="heading-21">âŒ å´©æºƒï¼š<code>IllegalArgumentException: ä¸è®¤è¯†çš„fromId==1001</code></h4>
<p>æ˜¯æºç sample-manager-debug.apkï¼Œä¸åŒ¹é…ï¼  æºç å·²ç»æ¨é€äº†ä¸€ä¸ªsample-manager-debug.apk,æ˜¯ä¸åŒ¹é…çš„</p>
<p><strong>åŸå› </strong>ï¼š<code>SamplePluginManager.enter()</code>Â æœªå¤„ç†Â <code>fromId=1001</code>ã€‚<br/>
<strong>è§£å†³</strong>ï¼šæ£€æŸ¥Â <code>manager-project</code>Â ä¸­æ˜¯å¦å®šä¹‰äº†å¯¹åº”å¸¸é‡ï¼Œæˆ–ç»Ÿä¸€ IDã€‚</p>
<h4 data-id="heading-22">âŒ æ’ä»¶æ— æ³•åŠ è½½ / é»‘å±</h4>
<ul>
<li>æ£€æŸ¥ APK æ˜¯å¦æ”¾å…¥Â <code>assets</code>Â ä¸”å‘½åæ­£ç¡®ï¼›</li>
<li>æ£€æŸ¥æ’ä»¶æ˜¯å¦åŒ…å«Â <code>sample-loader</code>Â å’ŒÂ <code>sample-runtime</code>ï¼›</li>
<li><strong>å¼ºçƒˆå»ºè®®ä¸‰å·¥ç¨‹ä½¿ç”¨ç›¸åŒ Shadow ç‰ˆæœ¬</strong>ï¼ˆå¦‚Â <code>2.0.19</code>ï¼‰ã€‚</li>
</ul>
<p>SamplePluginManagerï¼Œåœ¨æºç é‡Œé¢ï¼Œéœ€è¦æ”¹æºç æ‰è¡Œ!</p>
<pre><code class="hljs">SamplePluginManageræ˜¯åœ¨manageré‡Œé¢çš„
çœ‹ä¸‹manageræ˜¯å“ªä¸ªapk
</code></pre>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">isProcess</span>(application, application.<span class="hljs-title function_ invoke__">getPackageName</span>())) {
    FixedPathPmUpdater fixedPathPmUpdater
            = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedPathPmUpdater</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"/data/local/tmp/sample-manager-debug.apk"</span>));
    <span class="hljs-keyword">boolean</span> needWaitingUpdate
            = fixedPathPmUpdater.<span class="hljs-title function_ invoke__">wasUpdating</span>()<span class="hljs-comment">//ä¹‹å‰æ­£åœ¨æ›´æ–°ä¸­ï¼Œæš—ç¤ºæ›´æ–°å‡ºé”™äº†ï¼Œåº”è¯¥æ”¾å¼ƒä¹‹å‰çš„ç¼“å­˜</span>
            || fixedPathPmUpdater.<span class="hljs-title function_ invoke__">getLatest</span>() == <span class="hljs-literal">null</span>;<span class="hljs-comment">//æ²¡æœ‰æœ¬åœ°ç¼“å­˜</span>
    Future&lt;File&gt; update = fixedPathPmUpdater.<span class="hljs-title function_ invoke__">update</span>();
    <span class="hljs-keyword">if</span> (needWaitingUpdate) {
        <span class="hljs-keyword">try</span> {
            update.<span class="hljs-title function_ invoke__">get</span>();<span class="hljs-comment">//è¿™é‡Œæ˜¯é˜»å¡çš„ï¼Œéœ€è¦ä¸šåŠ¡è‡ªè¡Œä¿è¯æ›´æ–°Managerè¶³å¤Ÿå¿«ã€‚</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Sampleç¨‹åºä¸å®¹é”™"</span>, e);
        }
    }
    sPluginManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicPluginManager</span>(fixedPathPmUpdater);

</code></pre>
<p>å‡ºç°äº†è¿™ä¸ªé”™è¯¯ï¼šåŠ è½½çš„æ’ä»¶ä¸åŒ¹é…ï¼Œæºç å’Œmavençš„æ’ä»¶ææ··äº†ï¼</p>
<pre><code class="hljs language-php" lang="php">encent.shadow.sample.host E  FATAL EXCEPTION: main
                                     
 Process: com.tencent.shadow.sample.host:plugin, PID: <span class="hljs-number">24952</span>
                                      
                                                                                                    java.lang.<span class="hljs-built_in">RuntimeException</span>: Unable to create service com.tencent.shadow.sample.introduce_shadow_lib.MainPluginProcessService: java.lang.IllegalStateException: PPSå‡ºç°å¤šå®ä¾‹
                                                                                                    	at android.app.ActivityThread.<span class="hljs-title function_ invoke__">handleCreateService</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">6025</span>)
                                                                                                    	at android.app.ActivityThread.-$$Nest<span class="hljs-variable">$mhandleCreateService</span>(Unknown Source:<span class="hljs-number">0</span>)
                                                                                                    	at android.app.ActivityThread<span class="hljs-variable">$H</span>.<span class="hljs-title function_ invoke__">handleMessage</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">3080</span>)
                                                                                                    	at android.os.Handler.<span class="hljs-title function_ invoke__">dispatchMessage</span>(Handler.<span class="hljs-attr">java</span>:<span class="hljs-number">114</span>)
                                                                                                    	at android.os.Looper.<span class="hljs-title function_ invoke__">loopOnce</span>(Looper.<span class="hljs-attr">java</span>:<span class="hljs-number">266</span>)
                                                                                                    	at android.os.Looper.<span class="hljs-title function_ invoke__">loop</span>(Looper.<span class="hljs-attr">java</span>:<span class="hljs-number">361</span>)
                                                                                                    	at android.app.ActivityThread.<span class="hljs-title function_ invoke__">main</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">10320</span>)
                                                                                                    	at java.lang.reflect.Method.<span class="hljs-title function_ invoke__">invoke</span>(Native Method)
                                                                                                    	at com.android.internal.os.RuntimeInit<span class="hljs-variable">$MethodAndArgsCaller</span>.<span class="hljs-title function_ invoke__">run</span>(RuntimeInit.<span class="hljs-attr">java</span>:<span class="hljs-number">675</span>)
                                                                                                    	at com.android.internal.os.ZygoteInit.<span class="hljs-title function_ invoke__">main</span>(ZygoteInit.<span class="hljs-attr">java</span>:<span class="hljs-number">1002</span>)
                                                                                                    Caused by: java.lang.IllegalStateException: PPSå‡ºç°å¤šå®ä¾‹
                                                                                                    	at com.tencent.shadow.dynamic.host.BasePluginProcessService.<span class="hljs-title function_ invoke__">onCreate</span>(BasePluginProcessService.<span class="hljs-attr">java</span>:<span class="hljs-number">32</span>)
                                                                                                    	at android.app.ActivityThread.<span class="hljs-title function_ invoke__">handleCreateService</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">6012</span>)
                                                                                                    	at android.app.ActivityThread.-$$Nest<span class="hljs-variable">$mhandleCreateService</span>(Unknown Source:<span class="hljs-number">0</span>)Â 
                                                                                                    	at android.app.ActivityThread<span class="hljs-variable">$H</span>.<span class="hljs-title function_ invoke__">handleMessage</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">3080</span>)Â 
                                                                                                    	at android.os.Handler.<span class="hljs-title function_ invoke__">dispatchMessage</span>(Handler.<span class="hljs-attr">java</span>:<span class="hljs-number">114</span>)Â 
                                                                                                    	at android.os.Looper.<span class="hljs-title function_ invoke__">loopOnce</span>(Looper.<span class="hljs-attr">java</span>:<span class="hljs-number">266</span>)Â 
                                                                                                    	at android.os.Looper.<span class="hljs-title function_ invoke__">loop</span>(Looper.<span class="hljs-attr">java</span>:<span class="hljs-number">361</span>)Â 
                                                                                                    	at android.app.ActivityThread.<span class="hljs-title function_ invoke__">main</span>(ActivityThread.<span class="hljs-attr">java</span>:<span class="hljs-number">10320</span>)Â 
                                                                                                    	at java.lang.reflect.Method.<span class="hljs-title function_ invoke__">invoke</span>(Native Method)Â 
                                                                                                    	at com.android.internal.os.RuntimeInit<span class="hljs-variable">$MethodAndArgsCaller</span>.<span class="hljs-title function_ invoke__">run</span>(RuntimeInit.<span class="hljs-attr">java</span>:<span class="hljs-number">675</span>)Â 
                                                                                                    	at com.android.internal.os.ZygoteInit.<span class="hljs-title function_ invoke__">main</span>(ZygoteInit.<span class="hljs-attr">java</span>:<span class="hljs-number">1002</span>)Â 
                                                                                               
</code></pre>
<hr/>
<h3 data-id="heading-23">å…­ã€æ ¸å¿ƒæºç ç®€æ</h3>
<p>Shadow çš„è®¾è®¡é«˜åº¦æ¨¡å—åŒ–ï¼Œä¸‰å¤§å·¥ç¨‹å„å¸å…¶èŒã€‚ä¸‹é¢åˆ†åˆ«ä»æºç å±‚é¢è§£æå…¶å…³é”®ç±»ä¸è¿è¡ŒåŸç†ã€‚</p>
<hr/>
<h4 data-id="heading-24">6.1Â <code>plugin-project</code>Â â€”â€” æ’ä»¶åº”ç”¨å·¥ç¨‹</h4>
<h5 data-id="heading-25">æ ¸å¿ƒèŒè´£</h5>
<p>å°†ä¸šåŠ¡ä»£ç æ‰“åŒ…ä¸ºå¯è¢«åŠ¨æ€åŠ è½½çš„æ’ä»¶ APKï¼Œå¹¶åœ¨è¿è¡Œæ—¶é€‚é…å®¿ä¸»ç¯å¢ƒã€‚</p>
<h5 data-id="heading-26">å…³é”®ç±»è¯´æ˜</h5>
<ul>
<li><strong><code>PluginApplication</code></strong>ï¼šæ’ä»¶çš„ Application åŸºç±»ï¼Œæ›¿ä»£åŸç”ŸÂ <code>Application</code>ï¼Œç”¨äºåˆå§‹åŒ–æ’ä»¶è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong><code>PluginMainActivity</code></strong>ï¼šæ’ä»¶çš„ä¸» Activityï¼Œç»§æ‰¿è‡ªÂ <code>PluginActivity</code>ï¼Œé€šè¿‡ Shadow ä»£ç†æœºåˆ¶å®ç°ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚</li>
<li><strong><code>SampleRuntime</code></strong>ï¼šè‡ªå®šä¹‰è¿è¡Œæ—¶å®ç°ï¼Œæä¾›Â <code>Context</code>ã€<code>Resources</code>ã€<code>Instrumentation</code>Â ç­‰å…³é”®å¯¹è±¡çš„ä»£ç†ï¼Œç¡®ä¿æ’ä»¶èƒ½æ­£ç¡®è®¿é—®èµ„æºå¹¶å“åº”ç³»ç»Ÿè°ƒç”¨ã€‚</li>
</ul>
<h5 data-id="heading-27">æ„å»ºæœºåˆ¶</h5>
<ul>
<li>ä½¿ç”¨ Shadow æä¾›çš„ Gradle æ’ä»¶Â <code>shadow.pluginDSL</code>Â è¿›è¡Œæ‰“åŒ…ï¼›</li>
<li>ç”Ÿæˆçš„æ˜¯æ ‡å‡† APKï¼Œä½†<strong>å†…éƒ¨ç±»å­—èŠ‚ç ä¼šè¢«é‡å†™</strong>ï¼ˆå¦‚ Activity ç»§æ‰¿å…³ç³»æ›¿æ¢ï¼‰ï¼Œä»¥å…¼å®¹å®¿ä¸»çš„ ClassLoader å’Œ Context ä½“ç³»ï¼›</li>
<li>æœ€ç»ˆæ’ä»¶ APK ä¸ä¾èµ–å®¿ä¸»ä»£ç ï¼Œå®ç°å®Œå…¨è§£è€¦ã€‚</li>
</ul>
<h5 data-id="heading-28">å·¥ç¨‹ç»“æ„ä¸åˆ†å±‚</h5>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">include</span> <span class="hljs-string">':plugin-app'</span>        <span class="hljs-comment">// æ’ä»¶ä¸šåŠ¡æ¨¡å—ï¼ˆå« Activityã€Serviceï¼‰</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">':sample-runtime'</span>    <span class="hljs-comment">// æ’ä»¶è¿è¡Œæ—¶ç¯å¢ƒï¼ˆContext/Resource ä»£ç†ï¼‰</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">':sample-loader'</span>     <span class="hljs-comment">// æ’ä»¶åŠ è½½å™¨ï¼ˆè´Ÿè´£ Dex åŠ è½½ä¸ ClassLoader æ„å»ºï¼‰</span>
</code></pre>
<blockquote>
<p>âœ… ä¸‰è€…ååŒå·¥ä½œï¼š<code>loader</code>Â åŠ è½½ â†’Â <code>runtime</code>Â ä»£ç† â†’Â <code>app</code>Â æ‰§è¡Œä¸šåŠ¡ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-29">6.2Â <code>manager-project</code>Â â€”â€” æ’ä»¶ç®¡ç†å™¨å·¥ç¨‹</h4>
<blockquote>
<p>âš ï¸Â <strong>æ³¨æ„</strong>ï¼šMaven ä¾èµ–ç‰ˆæœ¬ä¸ GitHub æºç å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨ç›¸åŒç‰ˆæœ¬ï¼ˆå¦‚Â <code>2.0.19</code>ï¼‰ä»¥é¿å…å…¼å®¹æ€§é—®é¢˜ã€‚</p>
</blockquote>
<h5 data-id="heading-30">æ ¸å¿ƒèŒè´£</h5>
<p>ä½œä¸ºå®¿ä¸»ä¸æ’ä»¶ä¹‹é—´çš„æ¡¥æ¢ï¼Œè´Ÿè´£ï¼š</p>
<ul>
<li>æ’ä»¶ APK çš„åŠ è½½ä¸æ ¡éªŒï¼›</li>
<li>åˆ›å»ºÂ <code>PluginLoader</code>Â å®ä¾‹ï¼›</li>
<li>å¯åŠ¨æ’ä»¶ç»„ä»¶ï¼ˆActivity / Serviceï¼‰ï¼›</li>
<li>æ”¯æŒå¤šæ’ä»¶ã€å¤šå…¥å£åœºæ™¯ï¼ˆé€šè¿‡Â <code>fromId</code>Â åŒºåˆ†ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-31">å…³é”®ç±»è¯´æ˜</h5>
<ul>
<li><strong><code>SamplePluginManager</code></strong>ï¼šç»§æ‰¿Â <code>FastPluginManager</code>ï¼Œå®ç°Â <code>enter()</code>Â æ–¹æ³•ï¼Œæ ¹æ®Â <code>fromId</code>Â è·¯ç”±åˆ°ä¸åŒæ’ä»¶åŠŸèƒ½ï¼›</li>
<li><strong><code>SampleComponentManager</code></strong>ï¼šç®¡ç†æ’ä»¶ä¸­å››å¤§ç»„ä»¶çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼›</li>
<li><strong><code>SamplePluginManagerUpdater</code></strong>ï¼šæ’ä»¶æ›´æ–°ç­–ç•¥å®ç°ï¼ˆå¦‚ç‰ˆæœ¬æ¯”å¯¹ã€çƒ­æ›´æ–°è§¦å‘ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-32">å…¸å‹æµç¨‹</h5>
<pre><code class="hljs language-ini" lang="ini">å®¿ä¸»è°ƒç”¨ enter(<span class="hljs-attr">fromId</span>=<span class="hljs-number">1001</span>)
â†’ Manager è§£æ fromId
â†’ åŠ è½½ plugin-app-debug.apk
â†’ åˆ›å»º PluginLoader
â†’ å¯åŠ¨ç›®æ ‡ Activity
</code></pre>
<hr/>
<h4 data-id="heading-33">6.3Â <code>host-project</code>Â â€”â€” å®¿ä¸»åº”ç”¨å·¥ç¨‹</h4>
<h5 data-id="heading-34">æ ¸å¿ƒèŒè´£</h5>
<p>æä¾›æ’ä»¶è¿è¡Œçš„å®¹å™¨ç¯å¢ƒï¼Œå¹¶è§¦å‘æ’ä»¶åŠ è½½æµç¨‹ã€‚</p>
<h5 data-id="heading-35">ä¾èµ–å…³ç³»</h5>
<ul>
<li>
<p>ä»…éœ€å¼•å…¥ Maven ä¾èµ–ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'com.tencent.shadow.dynamic:dynamic-host:2.0.19'</span>
</code></pre>
</li>
<li>
<p><strong>æ— éœ€æ˜¾å¼ä¾èµ–Â <code>introduce-shadow-lib</code></strong>ï¼šè¯¥åº“å·²ä½œä¸ºä¼ é€’ä¾èµ–ç”±Â <code>dynamic-host</code>Â è‡ªåŠ¨å¼•å…¥ï¼ˆè§å…¶ POM æ–‡ä»¶å£°æ˜ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-36">å…³é”®ç±»è¯´æ˜</h5>
<ul>
<li><strong><code>MainActivity</code></strong>ï¼šå®¿ä¸»ä¸»ç•Œé¢ï¼Œç‚¹å‡»æŒ‰é’®åè°ƒç”¨æ’ä»¶ç®¡ç†å™¨ï¼›</li>
<li><strong><code>DynamicPluginManager</code></strong>ï¼šå®¿ä¸»ä¾§æ’ä»¶ç®¡ç†æ¥å£ï¼Œå°è£…äº†ä¸ Manager å·¥ç¨‹çš„äº¤äº’é€»è¾‘ï¼›</li>
<li><strong><code>Shadow</code></strong>ï¼šæ¡†æ¶å…¨å±€å…¥å£ç±»ï¼Œç”¨äºåˆå§‹åŒ–æˆ–è·å–æ’ä»¶ä¸Šä¸‹æ–‡ï¼ˆé«˜çº§ç”¨æ³•ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-37">å¯åŠ¨æ’ä»¶ç¤ºä¾‹</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainActivity.java</span>
mPluginManager.enter(
    <span class="hljs-keyword">this</span>,
    <span class="hljs-number">1001</span>,  <span class="hljs-comment">// fromIdï¼Œéœ€ä¸ Manager ä¸­å¤„ç†é€»è¾‘ä¸€è‡´</span>
    <span class="hljs-string">"com.tencent.shadow.sample.plugin_main.MainActivity"</span>
);
</code></pre>
<blockquote>
<p>âœ… æ•´ä¸ªè¿‡ç¨‹å¯¹å®¿ä¸»é€æ˜ï¼šå®¿ä¸»ä¸æ„ŸçŸ¥æ’ä»¶å…·ä½“å®ç°ï¼Œä»…é€šè¿‡æ ‡å‡†æ¥å£é€šä¿¡ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-38">ä¸ƒã€Demo æ•ˆæœ</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dd8c85d512947e4bd37b5ebdf80be10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=m4iV92wJm1AIyxSH1Y1%2Fm7pqYLY%3D" alt="shadow2.jpg" loading="lazy"/></p>
<ol>
<li><strong>å®¿ä¸» App</strong>ï¼šæ˜¾ç¤º â€œLoad Pluginâ€ æŒ‰é’®ï¼›</li>
<li><strong>ç‚¹å‡»å</strong>ï¼šæˆåŠŸè·³è½¬è‡³æ’ä»¶ä¸­çš„Â <code>PluginMainActivity</code>ï¼›</li>
<li><strong>æ’ä»¶åŠŸèƒ½</strong>ï¼šå¯æ­£å¸¸å¯åŠ¨ Activityã€Serviceï¼Œè®¿é—®èµ„æºï¼Œå®Œæ•´è¿è¡Œã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-39">å…«ã€ä¸‰å¤§å·¥ç¨‹åä½œå…³ç³»</h3>
<h2 data-id="heading-40">8.1 æ¶æ„å›¾ï¼š</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb0118945e534288ac6ea77c7c055001~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=NbB4cA4v4GSgm7z9NpstDZRy6GI%3D" alt="shadow.png" loading="lazy"/></p>
<ul>
<li><strong>å®¿ä¸»</strong>ï¼šä»…ä¾èµ–Â <code>dynamic-host</code>ï¼Œé€šè¿‡æ¥å£è°ƒç”¨ç®¡ç†å™¨ï¼›</li>
<li><strong>ç®¡ç†å™¨</strong>ï¼šæ¡¥æ¥å®¿ä¸»ä¸æ’ä»¶ï¼Œæ§åˆ¶åŠ è½½ç­–ç•¥ï¼›</li>
<li><strong>æ’ä»¶</strong>ï¼šæ ‡å‡† APKï¼Œä½†é€šè¿‡ Shadow DSL æ‰“åŒ…ï¼Œç±»è¢«é‡å†™ä»¥é€‚é…å®¿ä¸»ç¯å¢ƒã€‚</li>
</ul>
<h3 data-id="heading-41">8.2 å·¥ä½œåŸç†çš„æµç¨‹å›¾</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdf32796a6e643cbb3ee37bb60abac35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768953869&amp;x-signature=dt5vj3o%2BD4%2FpoRUh9aABOTXSusM%3D" alt="shadow4.png" loading="lazy"/></p>
<p>è¿™ä¸ªæµç¨‹å›¾ç®€è¦åœ°å±•ç¤ºäº†ä»ç”¨æˆ·ä¸å®¿ä¸»åº”ç”¨äº¤äº’å¼€å§‹ï¼Œç›´åˆ°æ’ä»¶ä¸­çš„ Activity è¢«æˆåŠŸåŠ è½½å’Œè¿è¡Œçš„è¿‡ç¨‹ã€‚æ¯ä¸ªæ­¥éª¤éƒ½å¯¹åº”äº† Shadow æ¡†æ¶å†…éƒ¨çš„é‡è¦æ“ä½œï¼š</p>
<ol>
<li><strong>ç”¨æˆ·ç‚¹å‡»å®¿ä¸»åº”ç”¨ä¸­çš„æŒ‰é’®</strong>ï¼šè¿™æ˜¯æ•´ä¸ªæµç¨‹çš„èµ·ç‚¹ï¼Œç”¨æˆ·ä¸å®¿ä¸»åº”ç”¨è¿›è¡Œäº¤äº’ã€‚</li>
<li><strong>å®¿ä¸»è°ƒç”¨ PluginManager çš„ enter æ–¹æ³•</strong>ï¼šå®¿ä¸»åº”ç”¨é€šè¿‡ PluginManager æä¾›çš„æ¥å£å‘èµ·å¯¹æ’ä»¶çš„æ“ä½œè¯·æ±‚ã€‚</li>
<li><strong>PluginManager è§£æ fromId å¹¶é€‰æ‹©å¯¹åº”çš„æ’ä»¶</strong>ï¼šæ ¹æ®ä¼ å…¥çš„Â <code>fromId</code>Â æ¥ç¡®å®šéœ€è¦åŠ è½½å“ªä¸€ä¸ªæ’ä»¶ä»¥åŠæ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚</li>
<li><strong>åŠ è½½å¹¶éªŒè¯æ’ä»¶ APK æ–‡ä»¶</strong>ï¼šç¡®ä¿æŒ‡å®šçš„æ’ä»¶ APK å­˜åœ¨ä¸”åˆæ³•ã€‚</li>
<li><strong>åˆ›å»º PluginLoader å®ä¾‹</strong>ï¼šä¸ºå³å°†åŠ è½½çš„æ’ä»¶å‡†å¤‡ä¸€ä¸ªåŠ è½½å™¨å®ä¾‹ã€‚</li>
<li><strong>é€šè¿‡ PluginLoader åˆ›å»º ClassLoader</strong>ï¼šä¸ºæ’ä»¶åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç±»åŠ è½½å™¨ï¼Œä»¥ä¾¿äºéš”ç¦»ä¸åŒæ’ä»¶é—´çš„ç±»ç©ºé—´ã€‚</li>
<li><strong>å¯åŠ¨ç›®æ ‡ Activityï¼ˆç”±æ’ä»¶æä¾›ï¼‰</strong> ï¼šåˆ©ç”¨å‰é¢å‡†å¤‡å¥½çš„ç¯å¢ƒå¯åŠ¨æ’ä»¶ä¸­çš„ Activityã€‚</li>
<li><strong>Activity ç”Ÿå‘½å‘¨æœŸç”±å®¿ä¸»ä»£ç†å¹¶å›è°ƒç»™æ’ä»¶</strong>ï¼šå®¿ä¸»ä»£ç†æ’ä»¶ Activity çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶è½¬å‘ç»™æ’ä»¶å¤„ç†ã€‚</li>
<li><strong>æ’ä»¶ Activity æ­£å¸¸è¿è¡Œï¼Œå¹¶å¯ä»¥è®¿é—®å…¶èµ„æº</strong>ï¼šæœ€ç»ˆï¼Œæ’ä»¶ä¸­çš„ Activity å¯ä»¥åƒæ™®é€šåº”ç”¨ä¸€æ ·æ­£å¸¸è¿è¡Œï¼Œå¹¶èƒ½å¤Ÿè®¿é—®è‡ªèº«çš„èµ„æºæ–‡ä»¶ã€‚</li>
</ol>
<h2 data-id="heading-42">8.3 demoä¸­çš„ä»£ç ç¤ºä¾‹ï¼š</h2>
<p>å®¿ä¸»ä¸­è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-type">PluginManager</span> <span class="hljs-variable">pluginManager</span> <span class="hljs-operator">=</span> InitApplication.getPluginManager();
pluginManager.enter(MainActivity.<span class="hljs-built_in">this</span>, FROM_ID_START_ACTIVITY, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnterCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onShowLoadingView</span><span class="hljs-params">(View view)</span> {
        MainActivity.<span class="hljs-built_in">this</span>.setContentView(view);<span class="hljs-comment">//æ˜¾ç¤ºManagerä¼ æ¥çš„Loadingé¡µé¢</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCloseLoadingView</span><span class="hljs-params">()</span> {
        MainActivity.<span class="hljs-built_in">this</span>.setContentView(linearLayout);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEnterComplete</span><span class="hljs-params">()</span> {
        v.setEnabled(<span class="hljs-literal">true</span>);
    }
});
</code></pre>
<p>manager-projectä¸­è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java">SamplePluginManager

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SamplePluginManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FastPluginManager</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();

    <span class="hljs-keyword">private</span> Context mCurrentContext;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SamplePluginManager</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        mCurrentContext = context;
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> PluginManagerå®ç°çš„åˆ«åï¼Œç”¨äºåŒºåˆ†ä¸åŒPluginManagerå®ç°çš„æ•°æ®å­˜å‚¨è·¯å¾„
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"sample-manager"</span>;
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> å®¿ä¸»ä¸­æ³¨å†Œçš„PluginProcessServiceå®ç°çš„ç±»å
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">getPluginProcessServiceName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"com.tencent.shadow.sample.introduce_shadow_lib.MainPluginProcessService"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enter</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Context context, <span class="hljs-type">long</span> fromId, Bundle bundle, <span class="hljs-keyword">final</span> EnterCallback callback)</span> {
        <span class="hljs-keyword">if</span> (fromId == Constant.FROM_ID_START_ACTIVITY) {
            bundle.putString(Constant.KEY_PLUGIN_ZIP_PATH, <span class="hljs-string">"/data/local/tmp/plugin-debug.zip"</span>);
            bundle.putString(Constant.KEY_PLUGIN_PART_KEY, <span class="hljs-string">"sample-plugin"</span>);
            bundle.putString(Constant.KEY_ACTIVITY_CLASSNAME, <span class="hljs-string">"com.tencent.shadow.sample.plugin.MainActivity"</span>);
            Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"enter333333333"</span>+fromId);
            onStartActivity(context, bundle, callback);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fromId == Constant.FROM_ID_CALL_SERVICE) {
            Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"enter22222"</span>+fromId);
            callPluginService(context);
        } <span class="hljs-keyword">else</span> {
            Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"enter"</span>+fromId);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"========ä¸è®¤è¯†çš„fromId=="</span> + fromId);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStartActivity</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Context context, Bundle bundle, <span class="hljs-keyword">final</span> EnterCallback callback)</span> {
        Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"onStartActivity"</span>);
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">pluginZipPath</span> <span class="hljs-operator">=</span> bundle.getString(Constant.KEY_PLUGIN_ZIP_PATH);
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">partKey</span> <span class="hljs-operator">=</span> bundle.getString(Constant.KEY_PLUGIN_PART_KEY);
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> bundle.getString(Constant.KEY_ACTIVITY_CLASSNAME);
        Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"pluginZipPath:"</span>+pluginZipPath);
        Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"partKey:"</span>+partKey);
        Log.e(<span class="hljs-string">"tengxun"</span>,<span class="hljs-string">"className:"</span>+className);
        
        <span class="hljs-keyword">if</span> (className == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"className == null"</span>);
        }
        <span class="hljs-keyword">final</span> <span class="hljs-type">Bundle</span> <span class="hljs-variable">extras</span> <span class="hljs-operator">=</span> bundle.getBundle(Constant.KEY_EXTRAS);

        <span class="hljs-keyword">if</span> (callback != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(mCurrentContext).inflate(R.layout.activity_load_plugin, <span class="hljs-literal">null</span>);
            callback.onShowLoadingView(view);
        }

        executorService.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">InstalledPlugin</span> <span class="hljs-variable">installedPlugin</span>
                            <span class="hljs-operator">=</span> installPlugin(pluginZipPath, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<span class="hljs-comment">//è¿™ä¸ªè°ƒç”¨æ˜¯é˜»å¡çš„</span>
                    <span class="hljs-type">Intent</span> <span class="hljs-variable">pluginIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();
                    pluginIntent.setClassName(
                            context.getPackageName(),
                            className
                    );
                    <span class="hljs-keyword">if</span> (extras != <span class="hljs-literal">null</span>) {
                        pluginIntent.replaceExtras(extras);
                    }

                    startPluginActivity(context, installedPlugin, partKey, pluginIntent);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                }
                <span class="hljs-keyword">if</span> (callback != <span class="hljs-literal">null</span>) {
                    <span class="hljs-type">Handler</span> <span class="hljs-variable">uiHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());
                    uiHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                            callback.onCloseLoadingView();
                            callback.onEnterComplete();
                        }
                    });
                }
            }
        });
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callPluginService</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Context context)</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">pluginZipPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/data/local/tmp/plugin-debug.zip"</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">partKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sample-plugin"</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> <span class="hljs-string">"com.tencent.shadow.sample.plugin.MyService"</span>;

        <span class="hljs-type">Intent</span> <span class="hljs-variable">pluginIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();
        pluginIntent.setClassName(context.getPackageName(), className);

        executorService.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">InstalledPlugin</span> <span class="hljs-variable">installedPlugin</span>
                            <span class="hljs-operator">=</span> installPlugin(pluginZipPath, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<span class="hljs-comment">//è¿™ä¸ªè°ƒç”¨æ˜¯é˜»å¡çš„</span>

                    loadPlugin(installedPlugin.UUID, partKey);

                    <span class="hljs-type">Intent</span> <span class="hljs-variable">pluginIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();
                    pluginIntent.setClassName(context.getPackageName(), className);

                    <span class="hljs-type">boolean</span> <span class="hljs-variable">callSuccess</span> <span class="hljs-operator">=</span> mPluginLoader.bindPluginService(pluginIntent, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginServiceConnection</span>() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName componentName, IBinder iBinder)</span> {
                            <span class="hljs-type">IMyAidlInterface</span> <span class="hljs-variable">iMyAidlInterface</span> <span class="hljs-operator">=</span> IMyAidlInterface.Stub.asInterface(iBinder);
                            <span class="hljs-keyword">try</span> {
                                <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> iMyAidlInterface.basicTypes(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">4.0f</span>, <span class="hljs-number">5.0</span>, <span class="hljs-string">"6"</span>);
                                Log.i(<span class="hljs-string">"SamplePluginManager"</span>, <span class="hljs-string">"iMyAidlInterface.basicTypes : "</span> + s);
                            } <span class="hljs-keyword">catch</span> (RemoteException e) {
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                            }
                        }

                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName componentName)</span> {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"onServiceDisconnected"</span>);
                        }
                    }, Service.BIND_AUTO_CREATE);

                    <span class="hljs-keyword">if</span> (!callSuccess) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"bind serviceå¤±è´¥ className=="</span> + className);
                    }
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                }
            }
        });
    }
}
</code></pre>
<h2 data-id="heading-43">8.4  æ ¸å¿ƒç±»</h2>
<ul>
<li><code>FastPluginManager</code>ï¼šShadow æä¾›çš„æ’ä»¶ç®¡ç†å™¨åŸºç±»ï¼Œå°è£…äº†æ’ä»¶åŠ è½½ã€ClassLoader åˆ›å»ºç­‰é€šç”¨é€»è¾‘ã€‚</li>
<li><code>SamplePluginManager</code>ï¼šç»§æ‰¿Â <code>FastPluginManager</code>Â çš„å…·ä½“å®ç°ï¼Œæ ¹æ® fromId è·¯ç”±å¹¶åŠ è½½æŒ‡å®šæ’ä»¶ APKã€‚</li>
<li><code>InitApplication</code>ï¼šå®¿ä¸» Application å­ç±»ï¼Œç”¨äºåœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–æ’ä»¶ç®¡ç†å™¨å®ä¾‹ã€‚</li>
<li><code>FixedPathPmUpdater</code>ï¼šå›ºå®šè·¯å¾„æ’ä»¶æ›´æ–°å™¨ï¼Œä»é¢„è®¾æœ¬åœ°è·¯å¾„ï¼ˆå¦‚ assetsï¼‰åŠ è½½æ’ä»¶ï¼Œé€‚ç”¨äºè°ƒè¯•åœºæ™¯</li>
</ul>






























<table><thead><tr><th>ç±»å</th><th>è§’è‰²</th><th>ä¸€å¥è¯è¯´æ˜</th></tr></thead><tbody><tr><td><code>FastPluginManager</code></td><td>æ¡†æ¶åŸºç±»</td><td>æä¾›æ’ä»¶åŠ è½½é€šç”¨èƒ½åŠ›</td></tr><tr><td><code>SamplePluginManager</code></td><td>ä¸šåŠ¡å®ç°</td><td>å†³å®šâ€œåŠ è½½å“ªä¸ªæ’ä»¶ã€æ€ä¹ˆåŠ è½½â€</td></tr><tr><td><code>InitApplication</code></td><td>å®¿ä¸»åˆå§‹åŒ–</td><td>åœ¨å®¿ä¸»å¯åŠ¨æ—¶å‡†å¤‡å¥½æ’ä»¶ç®¡ç†å™¨</td></tr><tr><td><code>FixedPathPmUpdater</code></td><td>æ›´æ–°ç­–ç•¥</td><td>ä»å›ºå®šè·¯å¾„ï¼ˆå¦‚ assetsï¼‰è¯»å–æ’ä»¶ APK</td></tr></tbody></table>
<p>å®¿ä¸»ä¸­æ¸…å•æ–‡ä»¶çš„æ³¨å†Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;service
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">".MainPluginProcessService"</span>
    android:<span class="hljs-attr">process</span>=<span class="hljs-string">":plugin"</span> /&gt;

&lt;!--container æ³¨å†Œ
  æ³¨æ„configChangeséœ€è¦å…¨æ³¨å†Œ
  themeéœ€è¦æ³¨å†Œæˆé€æ˜

  è¿™äº›ç±»ä¸æ‰“åŒ…åœ¨hostä¸­ï¼Œæ‰“åŒ…åœ¨runtimeä¸­ï¼Œä»¥ä¾¿å‡å°‘å®¿ä¸»æ–¹æ³•æ•°å¢é‡
  --&gt;
&lt;activity
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.tencent.shadow.sample.runtime.PluginDefaultProxyActivity"</span>
    android:<span class="hljs-attr">launchMode</span>=<span class="hljs-string">"standard"</span>
    android:<span class="hljs-attr">screenOrientation</span>=<span class="hljs-string">"portrait"</span>
    android:<span class="hljs-attr">configChanges</span>=<span class="hljs-string">"mcc|mnc|locale|touchscreen|keyboard|keyboardHidden|navigation|screenLayout|fontScale|uiMode|orientation|screenSize|smallestScreenSize|layoutDirection"</span>
    android:<span class="hljs-attr">hardwareAccelerated</span>=<span class="hljs-string">"true"</span>
    android:<span class="hljs-attr">theme</span>=<span class="hljs-string">"@style/PluginContainerActivity"</span>
    android:<span class="hljs-attr">process</span>=<span class="hljs-string">":plugin"</span> /&gt;

&lt;activity
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.tencent.shadow.sample.runtime.PluginSingleInstance1ProxyActivity"</span>
    android:<span class="hljs-attr">launchMode</span>=<span class="hljs-string">"singleInstance"</span>
    android:<span class="hljs-attr">screenOrientation</span>=<span class="hljs-string">"portrait"</span>
    android:<span class="hljs-attr">configChanges</span>=<span class="hljs-string">"mcc|mnc|locale|touchscreen|keyboard|keyboardHidden|navigation|screenLayout|fontScale|uiMode|orientation|screenSize|smallestScreenSize|layoutDirection"</span>
    android:<span class="hljs-attr">hardwareAccelerated</span>=<span class="hljs-string">"true"</span>
    android:<span class="hljs-attr">theme</span>=<span class="hljs-string">"@style/PluginContainerActivity"</span>
    android:<span class="hljs-attr">process</span>=<span class="hljs-string">":plugin"</span> /&gt;

&lt;activity
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.tencent.shadow.sample.runtime.PluginSingleTask1ProxyActivity"</span>
    android:<span class="hljs-attr">launchMode</span>=<span class="hljs-string">"singleTask"</span>
    android:<span class="hljs-attr">screenOrientation</span>=<span class="hljs-string">"portrait"</span>
    android:<span class="hljs-attr">configChanges</span>=<span class="hljs-string">"mcc|mnc|locale|touchscreen|keyboard|keyboardHidden|navigation|screenLayout|fontScale|uiMode|orientation|screenSize|smallestScreenSize|layoutDirection"</span>
    android:<span class="hljs-attr">hardwareAccelerated</span>=<span class="hljs-string">"true"</span>
    android:<span class="hljs-attr">theme</span>=<span class="hljs-string">"@style/PluginContainerActivity"</span>
    android:<span class="hljs-attr">process</span>=<span class="hljs-string">":plugin"</span> /&gt;

&lt;provider
    android:<span class="hljs-attr">authorities</span>=<span class="hljs-string">"com.tencent.shadow.contentprovider.authority.dynamic"</span>
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.tencent.shadow.core.runtime.container.PluginContainerContentProvider"</span> /&gt;
&lt;!--container æ³¨å†Œ end --&gt;
</code></pre>
<hr/>
<h3 data-id="heading-44">ä¹ã€æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡ï¼Œä½ å·²æŒæ¡ï¼š</p>
<p>âœ…Â <strong>ç¯å¢ƒé…ç½®</strong>ï¼šGradleã€JDKã€AGP æ­£ç¡®ç‰ˆæœ¬<br/>
âœ…Â <strong>ä¸‰å·¥ç¨‹èŒè´£</strong>ï¼šå®¿ä¸»ï¼ˆå…¥å£ï¼‰ã€ç®¡ç†å™¨ï¼ˆæ¡¥æ¢ï¼‰ã€æ’ä»¶ï¼ˆä¸šåŠ¡ï¼‰<br/>
âœ…Â <strong>æ„å»ºæµç¨‹</strong>ï¼šæ’ä»¶ â†’ ç®¡ç†å™¨ â†’ å®¿ä¸»é›†æˆ<br/>
âœ…Â <strong>é—®é¢˜æ’æŸ¥</strong>ï¼šfromId åŒ¹é…ã€APK å‘½åã€ç‰ˆæœ¬ç»Ÿä¸€<br/>
âœ…Â <strong>æ¶æ„ç†è§£</strong>ï¼šè§£è€¦è®¾è®¡ã€ç”Ÿäº§å°±ç»ªæ¨¡å¼</p>
<blockquote>
<p>ğŸ“¦Â <strong>ä¸‹ä¸€æ­¥å»ºè®®</strong>ï¼š</p>
<ul>
<li>å°†æ’ä»¶ APK æ”¹ä¸ºç½‘ç»œä¸‹è½½ + ç­¾åæ ¡éªŒï¼›</li>
<li>æ”¯æŒå¤šæ’ä»¶åŠ¨æ€åˆ‡æ¢ï¼›</li>
<li>ç»“åˆ CI/CD è‡ªåŠ¨åŒ–æ„å»ºæ’ä»¶åŒ…ã€‚</li>
</ul>
</blockquote>
<p>Shadow ä»¥â€œ<strong>æ— ä¾µå…¥ã€é«˜å…¼å®¹ã€å…¨ç»„ä»¶æ”¯æŒ</strong>â€ çš„ç‰¹æ€§ï¼Œä¸º Android æ’ä»¶åŒ–æä¾›äº†å·¥ä¸šçº§è§£å†³æ–¹æ¡ˆã€‚ç°åœ¨ï¼Œä½ ç¦»â€œæ¨¡å—åŒ–çƒ­æ›´æ–°â€åªå·®ä¸€ä¸ª Demo çš„è·ç¦»ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨Springçš„ApplicationEventPublisherè¿›è¡Œäº‹ä»¶å‘å¸ƒå’Œç›‘å¬]]></title>    <link>https://juejin.cn/post/7595157651619872794</link>    <guid>https://juejin.cn/post/7595157651619872794</guid>    <pubDate>2026-01-15T06:03:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595157651619872794" data-draft-id="7595164177256153114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨Springçš„ApplicationEventPublisherè¿›è¡Œäº‹ä»¶å‘å¸ƒå’Œç›‘å¬"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T06:03:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é©¬å¡å·´å¡"/> <meta itemprop="url" content="https://juejin.cn/user/1892677617451163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨Springçš„ApplicationEventPublisherè¿›è¡Œäº‹ä»¶å‘å¸ƒå’Œç›‘å¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1892677617451163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é©¬å¡å·´å¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:03:16.000Z" title="Thu Jan 15 2026 06:03:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³å‘å¸ƒä¸€äº›æœ¬åœ°çš„äº‹ä»¶ï¼Œå¹¶ä¸éœ€è¦å¼•å…¥MQçš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Springçš„ApplicationEventPublisheræ¥å®Œæˆç®€å•äº‹ä»¶çš„å‘å¸ƒå’Œç›‘å¬çš„ã€‚</p>
<p>æ¯”å¦‚åƒä¸‹é¢çš„åœºæ™¯ï¼ŒApplicationEventPublisherå°±å¤Ÿç”¨äº†ã€‚</p>
<ul>
<li>æ¨¡å—é—´çš„é€»è¾‘è§£è€¦ï¼Œä½†ä¸è·¨æœåŠ¡ï¼›</li>
<li>è½»é‡çº§çš„æœ¬åœ°äº‹ä»¶é€šçŸ¥</li>
<li>åº”ç”¨å†…éƒ¨çš„è§£è€¦å’Œæ‰©å±•ç‚¹:æ¯”å¦‚è¯´åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D268983056%26content_type%3DArticle%26match_order%3D1%26q%3DDDD%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=268983056&amp;content_type=Article&amp;match_order=1&amp;q=DDD&amp;zhida_source=entity" ref="nofollow noopener noreferrer">DDD</a>é‡Œï¼Œèšåˆä¿å­˜æ•°æ®æˆåŠŸåï¼Œéœ€è¦è§¦å‘è‹¥å¹²çš„åç»­åŠ¨ä½œ</li>
<li>æ— å¼ºäº‹åŠ¡è¦æ±‚ã€æ— å¼ºæŒä¹…åŒ–è¦æ±‚çš„é€šçŸ¥åœºæ™¯</li>
</ul>
<h2 data-id="heading-1">ç”Ÿäº§ç¯å¢ƒå®æˆ˜,é—¨åº—åˆ›å»ºæˆåŠŸåå‘å¸ƒã€é—¨åº—å·²æˆåŠŸåˆ›å»ºçš„äº‹ä»¶ã€‘</h2>
<p>åœ¨æˆ‘ç›®å‰è¿™è¾¹ï¼Œé—¨åº—ä¸€æ—¦åˆ›å»ºæˆåŠŸåï¼Œæ˜¯æœ‰å¾ˆå¤šä¸€ç³»åˆ—çš„åç»­åŠ¨ä½œè¦å»åšçš„ï¼Œæ¯”å¦‚é…ç½®é—¨åº—çš„å„ç§å„æ ·çš„è§„åˆ™ä¿¡æ¯ã€‚</p>
<p>å…·ä½“çš„ä»£ç å¾ˆç®€å•ã€‚</p>
<ul>
<li>å°±æ˜¯ç”¨ApplicationEventPublisherçš„publishEventæ–¹æ³•å‘å¸ƒäº‹ä»¶</li>
<li>ç”¨EventListeneræ³¨è§£ç›‘å¬äº‹ä»¶å°±å¯ä»¥äº†ã€‚</li>
</ul>
<p>å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹ã€‚</p>
<p><strong>äº‹ä»¶å‘å¸ƒè€…å°è£… ApplicationEventPublisher</strong></p>
<p><code>ShopCreationEventPublisher</code>Â å¯¹ Spring çš„Â <code>ApplicationEventPublisher</code>Â åšäº†ä¸€å±‚å°è£…ï¼Œç»Ÿä¸€äº‹ä»¶åˆ›å»ºå’Œæ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@RequiredArgsConstructor</span>
<span class="hljs-variable">@Slf4j</span>
public class ShopCreationEventPublisher {

    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">ApplicationEventPublisher</span> <span class="hljs-selector-tag">applicationEventPublisher</span>;

    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">publishShopCreationEvent</span>(Long shopId) {
        <span class="hljs-selector-tag">if</span> (shopId == null) {
            <span class="hljs-selector-tag">return</span>;
        }
        <span class="hljs-selector-tag">applicationEventPublisher</span><span class="hljs-selector-class">.publishEvent</span>(
                new <span class="hljs-built_in">ShopCreationEvent</span>(
                        shopId,
                        ShopConstant.ShopDomainEvent.SHOP_CREATION_EVENT.<span class="hljs-built_in">getCode</span>()
                )
        );
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"Publishing {} for shopId: {}"</span>,
                ShopConstant.ShopDomainEvent.SHOP_CREATION_EVENT.<span class="hljs-built_in">getCode</span>(), shopId);
    }
}
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@AllArgsConstructor</span>
    <span class="hljs-variable">@Getter</span>
    public enum ShopDomainEvent {
        <span class="hljs-selector-tag">SHOP_CREATION_EVENT</span>(<span class="hljs-string">"shop_creation_event"</span>, <span class="hljs-string">"é—¨åº—å·²åˆ›å»º"</span>),
        <span class="hljs-selector-tag">SHOP_UPDATE_EVENT</span>(<span class="hljs-string">"shop_update_event"</span>, <span class="hljs-string">"é—¨åº—å·²æ›´æ–°"</span>);

        <span class="hljs-comment">/**
         * ç¼–ç 
         */</span>
        <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">code</span>;

        <span class="hljs-comment">/**
         * æè¿°
         */</span>
        <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">desc</span>;
    }
</code></pre>
<p>è¿™ä¸ªç±»åšäº†å‡ ä»¶å°äº‹ï¼š</p>
<ul>
<li><strong>å°è£…äº‹ä»¶æ„é€ </strong>ï¼šä¸Šå±‚åªéœ€è¦ä¼ Â <code>shopId</code>ï¼Œä¸å…³å¿ƒäº‹ä»¶ code çš„ç»†èŠ‚</li>
<li><strong>ShopDomainEvent</strong>ï¼šå®šä¹‰é—¨åº—çš„æ—¶é—´ï¼Œæœ‰åˆ›å»ºå’Œæ›´æ–°</li>
</ul>
<p>é€šè¿‡è¿™å±‚å°è£…ï¼Œä¸šåŠ¡ä»£ç å‡ ä¹å®Œå…¨ä¸Â <code>ApplicationEventPublisher</code>Â è§£è€¦ï¼Œåªä¾èµ–ä¸€ä¸ªè¯­ä¹‰æ˜ç¡®çš„å‘å¸ƒå™¨ã€‚ShopApplicationServiceç±»åªéœ€è¦è°ƒç”¨å‘å¸ƒæ–¹æ³•ï¼Œäº‹ä»¶å°±å‘å¸ƒå‡ºå»äº†ã€‚</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-variable">@RequiredArgsConstructor</span>
<span class="hljs-variable">@Service</span>
<span class="hljs-variable">@Slf4j</span>
public class ShopApplicationService {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">ShopCreationEventPublisher</span> <span class="hljs-selector-tag">shopCreationEventPublisher</span>;


    <span class="hljs-comment">/**
     * ä¿å­˜é—¨åº—èšåˆä¿¡æ¯
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">saveShopInfo</span>(SaveShopInfoCommand saveShopInfoCommand) {
        <span class="hljs-comment">// æ„å»ºèšåˆæ ¹</span>
        <span class="hljs-selector-tag">ShopInfoAggregateRoot</span> <span class="hljs-selector-tag">root</span> = <span class="hljs-selector-tag">shopInfoFactory</span><span class="hljs-selector-class">.createShopInfoAggregateRoot</span>(saveShopInfoCommand);

        <span class="hljs-comment">// æŒä¹…åŒ–</span>
        <span class="hljs-selector-tag">shopInfoRepository</span><span class="hljs-selector-class">.persistence</span>(root);

        <span class="hljs-comment">// å‘å¸ƒã€é—¨åº—å·²åˆ›å»ºã€‘çš„äº‹ä»¶</span>
     
        <span class="hljs-selector-tag">shopCreationEventPublisher</span><span class="hljs-selector-class">.publishShopCreationEvent</span>(root.<span class="hljs-built_in">getId</span>());
    }
}
</code></pre>
<p><strong>äº‹ä»¶ç›‘å¬è€…å®ç°</strong></p>
<p>ç”¨EventListeneræ³¨è§£å°±å¯ä»¥äº†ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Slf4j</span>
<span class="hljs-variable">@RequiredArgsConstructor</span>
class NewShopRuleGenerateListener {

    <span class="hljs-variable">@EventListener</span>
    public void <span class="hljs-built_in">onShopCreationEvent</span>(ShopCreationEvent event) {
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"NewShopRuleGenerateListener received : {}"</span>, JSON.<span class="hljs-built_in">toJSONString</span>(event));
        <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">shopId</span> = <span class="hljs-selector-tag">event</span><span class="hljs-selector-class">.getShopId</span>();
        <span class="hljs-selector-tag">if</span> (shopId == null) {
            <span class="hljs-selector-tag">return</span>;
        }
        <span class="hljs-comment">// æ–°å¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œé¿å…é˜»å¡äº‹ä»¶å‘å¸ƒçº¿ç¨‹</span>
        <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Thread</span>(() -&gt; {
            <span class="hljs-selector-tag">ShopInfoAggregateRoot</span> <span class="hljs-selector-tag">shopInfoAggregateRoot</span> = <span class="hljs-selector-tag">shopInfoRepository</span><span class="hljs-selector-class">.selectByShopId</span>(shopId.<span class="hljs-built_in">intValue</span>());
           
            <span class="hljs-comment">// æ–°å¢çš„é—¨åº—é…ç½®å„ç§å„æ ·çš„è§„åˆ™</span>
            
        })<span class="hljs-selector-class">.start</span>();
    }
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><strong>ç›‘å¬æ–¹å¼éå¸¸ç›´è§‚</strong>ï¼šé€šè¿‡Â <code>@EventListener</code>Â æ ‡æ³¨æ–¹æ³•ï¼Œå‚æ•°å°±æ˜¯è¦ç›‘å¬çš„äº‹ä»¶ç±»å‹Â <code>ShopCreationEvent</code></li>
<li><strong>ä¸šåŠ¡é€»è¾‘å®Œå…¨ä»</strong>ShopApplicationService<strong>ä¸­æ‹†äº†å‡ºæ¥</strong>ï¼Œè½¬ç§»åˆ°ä¸€ä¸ªèŒè´£æ¸…æ™°çš„ç›‘å¬å™¨ç±»é‡Œ</li>
<li><strong>ä¸ºé¿å…é˜»å¡äº‹ä»¶å‘å¸ƒçº¿ç¨‹ï¼Œ</strong> ç›‘å¬å™¨å†…éƒ¨ä¸»åŠ¨ä½¿ç”¨æ–°çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ</li>
</ul>
<p>è¿™æ¡é“¾è·¯çš„å¥½å¤„åœ¨äºï¼š</p>
<ul>
<li>
<p>ä¿å­˜é—¨åº—çš„ä¸»æµç¨‹å¯¹â€œè°åœ¨ç›‘å¬è¿™ä¸ªäº‹ä»¶â€æ˜¯æ— æ„ŸçŸ¥çš„ï¼›</p>
</li>
<li>
<p>æ–°å¢æˆ–åˆ é™¤ç›‘å¬å™¨åªå½±å“ç›‘å¬æ–¹ä»£ç ï¼Œä¸éœ€è¦ä¿®æ”¹Â <code>ShopApplicationService</code>Â ï¼›</p>
</li>
</ul>
<h2 data-id="heading-2"><strong>å®æˆ˜è½åœ°å»ºè®®</strong></h2>
<p><strong>å°½é‡ä¸ºæ¯ç±»äº‹ä»¶æä¾›å•ç‹¬çš„å‘å¸ƒå™¨</strong></p>
<ul>
<li>æ¯”å¦‚Â <code>ShopCreationEventPublisher</code>ã€<code>ShopUpdatePublisher</code>ï¼Œè€Œä¸æ˜¯åœ¨ä¸šåŠ¡ä»£ç é‡Œç›´æ¥æ‹¿Â <code>ApplicationEventPublisher</code></li>
<li>ä¾¿äºåç»­åœ¨å‘å¸ƒå™¨å±‚é¢ç»Ÿä¸€åšæ—¥å¿—ã€é™æµæˆ–åŸ‹ç‚¹</li>
</ul>
<p><strong>äº‹ä»¶å‘½åå’Œå­—æ®µä¿æŒä¸šåŠ¡è¯­ä¹‰æ¸…æ™°</strong></p>
<ul>
<li><code>ShopCreationEvent</code>Â è¿™ç§åç§°æ¯”â€œé—¨åº—å˜æ›´äº‹ä»¶â€æ›´å…·ä½“</li>
<li>äº‹ä»¶ä½“åªæ”¾å¿…è¦å­—æ®µï¼Œæ¯”å¦‚Â <code>shopId</code>ã€äº‹ä»¶ç±»å‹ codeï¼Œé¿å…å˜æˆâ€œå¤§è€Œå…¨ DTO`</li>
</ul>
<p><strong>ç›‘å¬å™¨èŒè´£è¦å•ä¸€</strong></p>
<ul>
<li>ä¸€ä¸ªç›‘å¬å™¨ä¸“æ³¨åšä¸€ä»¶äº‹æƒ…</li>
<li>å¦‚æœåç»­è¿˜æœ‰â€œæ–°é—¨åº—åˆå§‹åŒ–åº“å­˜â€ã€â€œæ–°é—¨åº—æ¨é€æ¶ˆæ¯â€ç­‰ï¼Œå¯ä»¥æ–°å»ºç›‘å¬å™¨æŒ‰èŒè´£æ‹†åˆ†</li>
</ul>
<p><strong>å¼‚æ­¥å¤„ç†å°½æ—©æŠ½è±¡åˆ°ç»Ÿä¸€æœºåˆ¶</strong></p>
<ul>
<li>ç›®å‰ä¸Šé¢çš„ä»£ç ä½¿ç”¨Â <code>new Thread</code>ã€‚è¿™ä¸ªæ˜¯ä¸å¤ªåˆç†çš„ï¼Œ åº”è¯¥æ˜¯ç”¨çº¿ç¨‹æ± ã€‚</li>
</ul>
<p>åœ¨ä¸å¼•å…¥ MQ çš„å‰æä¸‹ï¼ŒåŸºäº ApplicationEventPublisher çš„è¿™ç§æœ¬åœ°äº‹ä»¶æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¿æŒä»£ç ç»“æ„æ¸…æ™°çš„åŒæ—¶ï¼Œç»™ç³»ç»Ÿé¢„ç•™è¶³å¤Ÿçš„æ‰©å±•ç‚¹ï¼Œå¯¹å¾ˆå¤šä¸­å°ä½“é‡çš„ä¸šåŠ¡æ¥è¯´ï¼Œè¿™ç§æ–¹æ¡ˆå·²ç»è¶³å¤Ÿå®ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®© Vant å¼¹å‡ºå±‚é€‚é… Uniapp Webview è¿”å›é”®]]></title>    <link>https://juejin.cn/post/7595147176752578560</link>    <guid>https://juejin.cn/post/7595147176752578560</guid>    <pubDate>2026-01-15T07:14:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595147176752578560" data-draft-id="7595232643463954466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®© Vant å¼¹å‡ºå±‚é€‚é… Uniapp Webview è¿”å›é”®"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2026-01-15T07:14:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›·ç‹"/> <meta itemprop="url" content="https://juejin.cn/user/1538972011203662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®© Vant å¼¹å‡ºå±‚é€‚é… Uniapp Webview è¿”å›é”®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1538972011203662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›·ç‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:14:35.000Z" title="Thu Jan 15 2026 07:14:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜èƒŒæ™¯</h2>
<p>åœ¨ UniApp Webview ä¸­ä½¿ç”¨ Vant ç»„ä»¶åº“æ—¶ï¼Œè¿”å›é”®çš„è¡Œä¸ºå¾€å¾€ä¸ç¬¦åˆç”¨æˆ·é¢„æœŸï¼š</p>
<ul>
<li>å½“ Popupã€Dialogã€ActionSheet ç­‰å¼¹å‡ºå±‚æ‰“å¼€æ—¶ï¼Œç”¨æˆ·æŒ‰ä¸‹è¿”å›é”®ä¼šç›´æ¥è¿”å›ä¸Šä¸€é¡µï¼Œè€Œä¸æ˜¯å…³é—­å¼¹å‡ºå±‚</li>
<li>å¤šå±‚å¼¹å‡ºå±‚å åŠ æ—¶ï¼Œæ— æ³•æŒ‰å±‚çº§é¡ºåºä¾æ¬¡å…³é—­</li>
<li>Vant å†…ç½®çš„ <code>closeOnPopstate</code> ä»…ä¼šåœ¨é¡µé¢å›é€€æ—¶è‡ªåŠ¨å…³é—­å¼¹çª—ï¼Œè€Œä¸ä¼šé˜»æ­¢é¡µé¢å›é€€</li>
</ul>
<p>è¿™å¯¼è‡´ç”¨æˆ·ä½“éªŒä¸åŸç”Ÿåº”ç”¨å­˜åœ¨æ˜æ˜¾å·®è·ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<p><code>@vue-spark/back-handler</code> æä¾›äº†åŸºäºæ ˆçš„è¿”å›é”®å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥ä¸ Vant ç»„ä»¶æ— ç¼é›†æˆï¼Œè®©å¼¹å‡ºå±‚æ­£ç¡®å“åº” UniApp çš„è¿”å›é”®äº‹ä»¶ã€‚</p>
<p>æ ¸å¿ƒæ€è·¯ï¼šå°†æ¯ä¸ªéœ€è¦å“åº”è¿”å›é”®çš„å¼¹å‡ºå±‚æ³¨å†Œåˆ°å…¨å±€æ ˆä¸­ï¼ŒæŒ‰åè¿›å…ˆå‡ºçš„é¡ºåºå¤„ç†è¿”å›äº‹ä»¶ã€‚</p>
<h2 data-id="heading-2">ä½¿ç”¨æ–¹å¼</h2>
<h3 data-id="heading-3">1. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">npm install @vue-spark/back-handler
</code></pre>
<h3 data-id="heading-4">2. åˆå§‹åŒ–æ’ä»¶ï¼ˆUniApp é€‚é…ï¼‰</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BackHandler</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue-spark/back-handler'</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
  .<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> routerHistory = router.<span class="hljs-property">options</span>.<span class="hljs-property">history</span>

    <span class="hljs-keyword">let</span> initialPosition = <span class="hljs-number">0</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">hasRouteHistory</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-comment">// å½“ vue-router å†…éƒ¨è®°å½•çš„ä½ç½®ä¸æ˜¯åˆå§‹ä½ç½®æ—¶è®¤ä¸ºè¿˜å­˜åœ¨å†å²è®°å½•</span>
      <span class="hljs-keyword">return</span> routerHistory.<span class="hljs-property">state</span>.<span class="hljs-property">position</span> !== initialPosition
    }

    router.<span class="hljs-title function_">isReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// è®°å½•åˆå§‹ä½ç½®</span>
      initialPosition = routerHistory.<span class="hljs-property">state</span>.<span class="hljs-property">position</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>

      router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// æ¯æ¬¡é¡µé¢å˜æ›´åé€šçŸ¥ uniapp æ˜¯å¦éœ€è¦é˜»æ­¢è¿”å›é”®é»˜è®¤è¡Œä¸º</span>
        uni.<span class="hljs-title function_">postMessage</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'preventBackPress'</span>,
          <span class="hljs-attr">data</span>: <span class="hljs-title function_">hasRouteHistory</span>(),
        })
      })
    })

    <span class="hljs-comment">// æ³¨å†Œæ’ä»¶</span>
    <span class="hljs-title class_">BackHandler</span>.<span class="hljs-title function_">install</span>(app, {
      <span class="hljs-comment">// æ¯æ¬¡å¢åŠ æ ˆè®°å½•æ—¶é€šçŸ¥ uniapp é˜»æ­¢è¿”å›é”®é»˜è®¤è¡Œä¸º</span>
      <span class="hljs-title function_">onPush</span>(<span class="hljs-params"/>) {
        uni.<span class="hljs-title function_">postMessage</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'preventBackPress'</span>,
          <span class="hljs-attr">data</span>: <span class="hljs-literal">true</span>,
        })
      },

      <span class="hljs-comment">// æ¯æ¬¡ç§»é™¤æ ˆè®°å½•æ—¶é€šçŸ¥ uniapp æ˜¯å¦é˜»æ­¢è¿”å›é”®é»˜è®¤è¡Œä¸º</span>
      <span class="hljs-title function_">onRemove</span>(<span class="hljs-params"/>) {
        uni.<span class="hljs-title function_">postMessage</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'preventBackPress'</span>,
          <span class="hljs-attr">data</span>: <span class="hljs-title class_">BackHandler</span>.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> || <span class="hljs-title function_">hasRouteHistory</span>(),
        })
      },

      <span class="hljs-comment">// æ ˆä¸ºç©ºæ—¶å°è¯•é¡µé¢å›é€€</span>
      <span class="hljs-title function_">fallback</span>(<span class="hljs-params"/>) {
        <span class="hljs-title function_">hasRouteHistory</span>() &amp;&amp; router.<span class="hljs-title function_">back</span>()
      },

      <span class="hljs-comment">// è¿™é‡Œç»‘å®š uniapp webview è§¦å‘çš„ backbutton äº‹ä»¶</span>
      <span class="hljs-title function_">bind</span>(<span class="hljs-params">handler</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'uni:backbutton'</span>, handler)
      },
    })
  })

  <span class="hljs-comment">// åœ¨è¿™é‡Œæ³¨å†Œ router</span>
  .<span class="hljs-title function_">use</span>(router)

  <span class="hljs-comment">// æŒ‚è½½åº”ç”¨</span>
  .<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-5">3. é€‚é… Vant Popup</h3>
<p>é€šè¿‡æ‰©å±• Popup çš„ setup å‡½æ•°ï¼Œè®©æ‰€æœ‰åŸºäº Popup çš„ç»„ä»¶ï¼ˆActionSheetã€ShareSheetã€Picker ç­‰ï¼‰éƒ½æ”¯æŒè¿”å›é”®å…³é—­ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useBackHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue-spark/back-handler'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dialog</span>, <span class="hljs-title class_">Popup</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vant'</span>
<span class="hljs-keyword">import</span> { callInterceptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'vant/es/utils'</span>
<span class="hljs-keyword">import</span> { getCurrentInstance, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> { setup } = <span class="hljs-title class_">Popup</span>

<span class="hljs-comment">// å˜æ›´ closeOnPopstate é»˜è®¤å€¼ä¸º true</span>
<span class="hljs-title class_">Popup</span>.<span class="hljs-property">props</span>.<span class="hljs-property">closeOnPopstate</span> = {
  <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
  <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>,
}

<span class="hljs-title class_">Popup</span>.<span class="hljs-property">setup</span> = <span class="hljs-function">(<span class="hljs-params">props, ctx</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { emit } = ctx
  <span class="hljs-keyword">const</span> vm = <span class="hljs-title function_">getCurrentInstance</span>()!

  <span class="hljs-comment">// Dialog ç»„ä»¶åŸºäº Popupï¼Œè¿™é‡Œéœ€è¦æ’é™¤ï¼Œå¦åˆ™ä¼šé‡å¤æ³¨å†Œ</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">parent</span>?.<span class="hljs-property">type</span> !== <span class="hljs-title class_">Dialog</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">show</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>()
        }

        <span class="hljs-title function_">callInterceptor</span>(props.<span class="hljs-property">beforeClose</span>, {
          <span class="hljs-title function_">done</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">emit</span>(<span class="hljs-string">'close'</span>)
            <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:show'</span>, <span class="hljs-literal">false</span>)
            <span class="hljs-title function_">resolve</span>()
          },
          <span class="hljs-title function_">canceled</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'canceled'</span>))
          },
        })
      })
    }

    <span class="hljs-keyword">const</span> { push, remove } = <span class="hljs-title function_">useBackHandler</span>(
      <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">show</span>,
      <span class="hljs-comment">// closeOnPopstate ç”¨äºæ§åˆ¶æ˜¯å¦å“åº”è¿”å›é”®</span>
      <span class="hljs-function">() =&gt;</span> !!props.<span class="hljs-property">closeOnPopstate</span> &amp;&amp; <span class="hljs-title function_">close</span>(),
    )

    <span class="hljs-title function_">watch</span>(
      <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">show</span>,
      <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (value ? <span class="hljs-title function_">push</span>() : <span class="hljs-title function_">remove</span>()),
      { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">flush</span>: <span class="hljs-string">'sync'</span> },
    )
  }

  <span class="hljs-keyword">return</span> setup!(props, ctx)
}
</code></pre>
<h3 data-id="heading-6">4. é€‚é… Vant Dialog</h3>
<p>Dialog éœ€è¦å•ç‹¬é€‚é…ï¼Œå› ä¸ºå®ƒåŸºäº Popup ä½†æœ‰ç‹¬ç«‹çš„å…³é—­é€»è¾‘ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useBackHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue-spark/back-handler'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dialog</span>, showLoadingToast } <span class="hljs-keyword">from</span> <span class="hljs-string">'vant'</span>
<span class="hljs-keyword">import</span> { callInterceptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'vant/es/utils'</span>
<span class="hljs-keyword">import</span> { watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// Dialog çš„ closeOnPopstate é»˜è®¤ä¸º trueï¼Œå¯ä»¥ä¸ä¿®æ”¹é»˜è®¤å€¼</span>
<span class="hljs-keyword">const</span> { setup } = <span class="hljs-title class_">Dialog</span>

<span class="hljs-title class_">Dialog</span>.<span class="hljs-property">setup</span> = <span class="hljs-function">(<span class="hljs-params">props, ctx</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { emit } = ctx
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateShow</span> = (<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) =&gt; <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:show'</span>, value)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params">action: <span class="hljs-string">'cancel'</span></span>) =&gt; {
    <span class="hljs-title function_">updateShow</span>(<span class="hljs-literal">false</span>)
    props.<span class="hljs-property">callback</span>?.(action)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getActionHandler</span> = (<span class="hljs-params">action: <span class="hljs-string">'cancel'</span></span>) =&gt; <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">show</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>()
      }

      <span class="hljs-title function_">emit</span>(action)

      <span class="hljs-keyword">if</span> (props.<span class="hljs-property">beforeClose</span>) {
        <span class="hljs-keyword">const</span> toast = <span class="hljs-title function_">showLoadingToast</span>({})
        <span class="hljs-title function_">callInterceptor</span>(props.<span class="hljs-property">beforeClose</span>, {
          <span class="hljs-attr">args</span>: [action],
          <span class="hljs-title function_">done</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">close</span>(action)
            toast.<span class="hljs-title function_">close</span>()
            <span class="hljs-title function_">resolve</span>()
          },
          <span class="hljs-title function_">canceled</span>(<span class="hljs-params"/>) {
            toast.<span class="hljs-title function_">close</span>()
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'canceled'</span>))
          },
        })
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">close</span>(action)
        <span class="hljs-title function_">resolve</span>()
      }
    })
  }

  <span class="hljs-keyword">const</span> { push, remove } = <span class="hljs-title function_">useBackHandler</span>(
    <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">show</span>,
    <span class="hljs-comment">// closeOnPopstate ç”¨äºæ§åˆ¶æ˜¯å¦å“åº”è¿”å›é”®</span>
    <span class="hljs-function">() =&gt;</span> !!props.<span class="hljs-property">closeOnPopstate</span> &amp;&amp; <span class="hljs-title function_">getActionHandler</span>(<span class="hljs-string">'cancel'</span>)(),
  )

  <span class="hljs-title function_">watch</span>(
    <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">show</span>,
    <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (value ? <span class="hljs-title function_">push</span>() : <span class="hljs-title function_">remove</span>()),
    { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">flush</span>: <span class="hljs-string">'sync'</span> },
  )

  <span class="hljs-keyword">return</span> setup!(props, ctx)
}
</code></pre>
<h2 data-id="heading-7">æ•ˆæœ</h2>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼š</p>
<ul>
<li>Popupã€ActionSheetã€ShareSheetã€Pickerã€Dialog ç­‰å¼¹å‡ºå±‚åœ¨æ‰“å¼€æ—¶ï¼ŒæŒ‰è¿”å›é”®ä¼šå…³é—­å¼¹å‡ºå±‚è€Œä¸æ˜¯é€€å‡ºé¡µé¢</li>
<li>å¤šå±‚å¼¹å‡ºå±‚ä¼šæŒ‰æ‰“å¼€é¡ºåºçš„é€†åºä¾æ¬¡å…³é—­</li>
<li>æ”¯æŒ <code>beforeClose</code> æ‹¦æˆªå™¨è¿›è¡Œå¼‚æ­¥ç¡®è®¤</li>
</ul>
<h2 data-id="heading-8">ç›¸å…³é“¾æ¥</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvue-spark%2Fback-handler" target="_blank" title="https://github.com/vue-spark/back-handler" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvue-spark%2Fback-handler%2Fblob%2Fmain%2FREADME.zh-CN.md" target="_blank" title="https://github.com/vue-spark/back-handler/blob/main/README.zh-CN.md" ref="nofollow noopener noreferrer">æ’ä»¶æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[EF Core å¼€å‘å®è·µï¼šLeft Join æŸ¥è¯¢çš„å¤šç§å®ç°æ–¹å¼]]></title>    <link>https://juejin.cn/post/7595167566143553555</link>    <guid>https://juejin.cn/post/7595167566143553555</guid>    <pubDate>2026-01-15T07:00:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595167566143553555" data-draft-id="7595142651727265811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="EF Core å¼€å‘å®è·µï¼šLeft Join æŸ¥è¯¢çš„å¤šç§å®ç°æ–¹å¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T07:00:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ryan_Deng"/> <meta itemprop="url" content="https://juejin.cn/user/1592553166353373"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            EF Core å¼€å‘å®è·µï¼šLeft Join æŸ¥è¯¢çš„å¤šç§å®ç°æ–¹å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1592553166353373/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ryan_Deng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:00:06.000Z" title="Thu Jan 15 2026 07:00:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡è®°å½•äº†ä½¿ç”¨ efcore ä¸­å¤šç§å·¦è¿æ¥æŸ¥è¯¢çš„å†™æ³•ã€‚</p>
<h3 data-id="heading-0">åœºæ™¯ç¤ºä¾‹</h3>
<ul>
<li>è®¢å•è¡¨ï¼šOrder</li>
<li>è®¢å•æ˜ç»†è¡¨ï¼šOrderItemï¼Œå¯ä»¥ä¸ºç©º</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> OrderNo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderItem</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> OrderId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h3 data-id="heading-1">ä¸€ã€LINQ æŸ¥è¯¢è¯­æ³•</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> query =
    <span class="hljs-keyword">from</span> o <span class="hljs-keyword">in</span> context.Orders
    <span class="hljs-keyword">join</span> oi <span class="hljs-keyword">in</span> context.OrderItems <span class="hljs-keyword">on</span> o.Id <span class="hljs-keyword">equals</span> oi.OrderId
        <span class="hljs-keyword">into</span> items
    <span class="hljs-keyword">from</span> oi <span class="hljs-keyword">in</span> items.DefaultIfEmpty()
    <span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span>
    {
        o.OrderNo,
        ProductName = oi != <span class="hljs-literal">null</span> ? oi.ProductName : <span class="hljs-literal">null</span>
    };
</code></pre>
<h3 data-id="heading-2">äºŒã€Linqæ–¹æ³•è¯­æ³•ï¼ˆGroupJoin + SelectMandyï¼‰</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> query = context.Orders
    .GroupJoin(
        context.OrderItems,
        o =&gt; o.Id,
        oi =&gt; oi.OrderId,
        (o, items) =&gt; <span class="hljs-keyword">new</span> { o, items }
    )
    .SelectMany(
        x =&gt; x.items.DefaultIfEmpty(),
        (x, oi) =&gt; <span class="hljs-keyword">new</span>
        {
            x.o.OrderNo,
            ProductName = oi != <span class="hljs-literal">null</span> ? oi.ProductName : <span class="hljs-literal">null</span>
        }
    );
</code></pre>
<h3 data-id="heading-3">ä¸‰ã€å¯¼èˆªå±æ€§</h3>
<p>æ¨¡å‹å·²é…ç½®å¯¼èˆªå±æ€§ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> OrderNo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    <span class="hljs-keyword">public</span> ICollection&lt;OrderItem&gt; OrderItems { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<p>æŸ¥è¯¢å†™æ³•ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> query = context.Orders.Select(o =&gt; <span class="hljs-keyword">new</span>
{
    o.OrderNo,
    o.OrderItems
});
</code></pre>
<p>ä»¥ä¸Šå°±æ˜¯ ef core å·¦è¿æ¥çš„ä¸‰ç§æŸ¥è¯¢å†™æ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hadoop ä¼ªåˆ†å¸ƒå¼å®‰è£…è¯¦è§£ï¼šå®šä¹‰ã€æ­¥éª¤ä¸é€‚ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7595358285722009609</link>    <guid>https://juejin.cn/post/7595358285722009609</guid>    <pubDate>2026-01-15T07:13:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595358285722009609" data-draft-id="7595289498445709338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hadoop ä¼ªåˆ†å¸ƒå¼å®‰è£…è¯¦è§£ï¼šå®šä¹‰ã€æ­¥éª¤ä¸é€‚ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2026-01-15T07:13:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™®ä¿¡ç”·_PuXin"/> <meta itemprop="url" content="https://juejin.cn/user/3657439667297002"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hadoop ä¼ªåˆ†å¸ƒå¼å®‰è£…è¯¦è§£ï¼šå®šä¹‰ã€æ­¥éª¤ä¸é€‚ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3657439667297002/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™®ä¿¡ç”·_PuXin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:13:11.000Z" title="Thu Jan 15 2026 07:13:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ Hadoop ä¼ªåˆ†å¸ƒå¼å®‰è£…ï¼Ÿ</h2>
<p>Hadoop ä¼ªåˆ†å¸ƒå¼å®‰è£…æ˜¯ä¸€ç§åœ¨<strong>å•å°ç‰©ç†æœºå™¨</strong>ä¸Šæ¨¡æ‹Ÿåˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒçš„éƒ¨ç½²æ–¹å¼ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼æœåŠ¡å¯ç”¨</strong>ï¼šè¿è¡Œ Hadoop çš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ HDFS çš„ NameNodeã€DataNodeï¼ŒYARN çš„ ResourceManagerã€NodeManager ç­‰ï¼‰ï¼Œä½†æ‰€æœ‰ç»„ä»¶å‡éƒ¨ç½²åœ¨åŒä¸€å°ä¸»æœºä¸Šã€‚</li>
<li><strong>æ¨¡æ‹Ÿé›†ç¾¤è¡Œä¸º</strong>ï¼šé€šè¿‡é…ç½®è®©å„ç»„ä»¶ä»¥ â€œä¼ªåˆ†å¸ƒå¼â€ æ¨¡å¼è¿è¡Œï¼ŒèŠ‚ç‚¹é—´é€šè¿‡æœ¬åœ°ç¯å›åœ°å€ï¼ˆ<code>localhost</code>ï¼‰é€šä¿¡ï¼Œå®Œå…¨æ¨¡æ‹ŸçœŸå®åˆ†å¸ƒå¼é›†ç¾¤çš„äº¤äº’é€»è¾‘ã€‚</li>
<li><strong>è½»é‡æ˜“éƒ¨ç½²</strong>ï¼šæ— éœ€å¤šå°æœåŠ¡å™¨ï¼Œé€‚åˆæœ¬åœ°å¼€å‘ã€è°ƒè¯•æˆ–å­¦ä¹  Hadoop æ ¸å¿ƒåŸç†ã€‚</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åˆå­¦è€…å…¥é—¨ Hadoop åˆ†å¸ƒå¼æ¶æ„ã€‚</li>
<li>å¼€å‘é˜¶æ®µè°ƒè¯• MapReduce ç¨‹åºæˆ– HDFS æ“ä½œã€‚</li>
<li>éªŒè¯ Hadoop é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼ˆå¦‚æƒé™ã€ç«¯å£ã€è·¯å¾„ç­‰ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€ä¼ªåˆ†å¸ƒå¼å®‰è£…æ ¸å¿ƒæ­¥éª¤ï¼ˆä»¥ Hadoop 3.x ä¸ºä¾‹ï¼‰</h2>
<h3 data-id="heading-2">1.ç”¨æˆ·æƒé™å‡†å¤‡</h3>
<ul>
<li>å»ºè®®åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¦‚hadoopï¼‰è¿›è¡Œéƒ¨ç½²ï¼Œé¿å…ä½¿ç”¨rootç”¨æˆ·:</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">useradd hadoop	<span class="hljs-comment">#ä½¿ç”¨ root ç”¨æˆ·è¿›è¡Œåˆ›å»ºç”¨æˆ· hadoop</span>
passwd hadoop	<span class="hljs-comment">#è®¾ç½® hadoop ç”¨æˆ·å¯†ç </span>
sudo usermod -aG whell hadoop	<span class="hljs-comment"># èµ‹äºˆ sudo æƒé™ï¼ˆæŒ‰éœ€ï¼‰</span>
su - hadoop	<span class="hljs-comment">#åˆ‡æ¢åˆ° hadoop ç”¨æˆ·</span>
</code></pre>
<h3 data-id="heading-3">2.æ£€æŸ¥å¹¶å¸è½½ç³»ç»Ÿè‡ªå¸¦ OpenJDKï¼ˆå¦‚æœ‰ï¼‰</h3>
<p>CentOS 7 é»˜è®¤é¢„è£… OpenJDKï¼Œéœ€å…ˆå¸è½½ä»¥é¿å…ç‰ˆæœ¬å†²çªï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1.1 æŸ¥çœ‹å·²å®‰è£…çš„ Java ç›¸å…³åŒ…</span>
rpm -qa | grep -i java

<span class="hljs-comment"># ç¤ºä¾‹è¾“å‡ºï¼ˆå¯èƒ½åŒ…å«ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ï¼‰ï¼š</span>
<span class="hljs-comment"># java-1.8.0-openjdk-headless-1.8.0.372.b07-1.el7_9.x86_64</span>
<span class="hljs-comment"># tzdata-java-2023g-1.el7.noarch</span>
<span class="hljs-comment"># java-1.8.0-openjdk-1.8.0.372.b07-1.el7_9.x86_64</span>

<span class="hljs-comment"># 1.2 å¸è½½æ‰€æœ‰ OpenJDK ç›¸å…³åŒ…ï¼ˆå¼ºåˆ¶åˆ é™¤ï¼Œå¿½ç•¥ä¾èµ–ï¼‰</span>
sudo rpm -e --nodeps $(rpm -qa | grep -i openjdk)
sudo rpm -e --nodeps $(rpm -qa | grep -i tzdata-java)

<span class="hljs-comment"># 1.3 éªŒè¯å¸è½½ç»“æœï¼ˆåº”æ— è¾“å‡ºï¼‰</span>
java -version
</code></pre>
<h3 data-id="heading-4">3.å®‰è£… Oracle JDKï¼ˆé€šè¿‡å‹ç¼©åŒ…éƒ¨ç½²ï¼Œæ¨è 1.8 æˆ– 11ï¼‰</h3>
<p><strong>æ³¨æ„ï¼šJDK ç‰ˆæœ¬å…¼å®¹æ€§</strong></p>
<ul>
<li>Hadoop 3.x æ”¯æŒ Java 8/11ï¼Œé¿å…ä½¿ç”¨ Java 17+ï¼ˆå¯èƒ½å­˜åœ¨ç±»ç¼ºå¤±é—®é¢˜ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-5">3.1 ä¸‹è½½ JDK å®‰è£…åŒ…</h4>
<p>ä» <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oracle.com%2Fjava%2Ftechnologies%2Fdownloads%2F%23java8" target="_blank" title="https://www.oracle.com/java/technologies/downloads/#java8" ref="nofollow noopener noreferrer">Oracle JDK å®˜ç½‘</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ï¼ˆå¦‚ <code>jdk-8u371-linux-x64.tar.gz</code>ï¼‰ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆå¦‚ <code>/opt/software/</code> ç›®å½•ï¼‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /opt/software/	<span class="hljs-comment">#è¿›å…¥åˆ°/opt/softwareæ–‡ä»¶å¤¹ä¸‹</span>
wget --no-cookies --no-check-certificate --header <span class="hljs-string">"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie"</span> https://download.oracle.com/otn-pub/java/jdk/8u371-b07/3d5a2bb8f8d4428bbe94aed7ec7ae784/jdk-8u371-linux-x64.tar.gz	<span class="hljs-comment">#ç½‘ç»œè¯·æ±‚Oracle JDKå®˜ç½‘å¯¹åº”ç‰ˆæœ¬JDKåŒ…</span>
</code></pre>
<h4 data-id="heading-6">3.2 è§£å‹å¹¶å®‰è£… JDK</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºå®‰è£…ç›®å½•ï¼ˆæ¨è /usr/local/java/ï¼‰</span>
sudo <span class="hljs-built_in">mkdir</span> -p /usr/local/java/

<span class="hljs-comment"># è§£å‹åˆ°ç›®æ ‡ç›®å½•ï¼ˆæ³¨æ„æ›¿æ¢å®é™…æ–‡ä»¶åï¼‰</span>
sudo tar -zxvf jdk-8u371-linux-x64.tar.gz -C /usr/local/java/

<span class="hljs-comment"># é‡å‘½åä¸ºç®€æ´åç§°ï¼ˆå¯é€‰ï¼‰</span>
sudo <span class="hljs-built_in">mv</span> /usr/local/java/jdk1.8.0_371 /usr/local/java/jdk8
</code></pre>
<h4 data-id="heading-7">3.3 é…ç½®ç¯å¢ƒå˜é‡</h4>
<pre><code class="hljs language-bash" lang="bash">sudo vi /etc/profile  <span class="hljs-comment"># æˆ–ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ ~/.bash_profile æˆ–è€…æ˜¯ ~/.bashrc</span>

<span class="hljs-comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæŒ‰å®é™… JDK è·¯å¾„ä¿®æ”¹ï¼‰ï¼š</span>
<span class="hljs-built_in">export</span> JAVA_HOME=/usr/local/java/jdk8
<span class="hljs-built_in">export</span> JRE_HOME=<span class="hljs-variable">$JAVA_HOME</span>/jre
<span class="hljs-built_in">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib:<span class="hljs-variable">$JRE_HOME</span>/lib
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>

<span class="hljs-comment"># ä½¿é…ç½®ç”Ÿæ•ˆ</span>
<span class="hljs-built_in">source</span> /etc/profile

<span class="hljs-comment"># éªŒè¯å®‰è£…ï¼ˆè¾“å‡º JDK ç‰ˆæœ¬ï¼‰</span>
java -version
</code></pre>
<h4 data-id="heading-8">4.é…ç½®æœ¬åœ°å…å¯†ç ç™»å½•ï¼ˆHadoop æœåŠ¡å¯åŠ¨ä¾èµ–ï¼‰</h4>
<p>Hadoop è„šæœ¬ä¼šé€šè¿‡ SSH åè®®æœ¬åœ°é€šä¿¡ï¼Œéœ€é…ç½®å…å¯†ç™»å½•ä»¥é¿å…äº¤äº’éªŒè¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 4.1 ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆä¸€è·¯å›è½¦ï¼Œä¸è®¾å¯†ç ï¼‰</span>
ssh-keygen -t rsa -P <span class="hljs-string">""</span> -f ~/.ssh/id_rsa

<span class="hljs-comment"># 4.2 å°†å…¬é’¥æ·»åŠ åˆ°æœ¬åœ°æˆæƒåˆ—è¡¨</span>
<span class="hljs-built_in">mkdir</span> -p ~/.ssh
<span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys

<span class="hljs-comment"># 4.3 è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆå…³é”®ï¼å¦åˆ™ SSH å¯èƒ½æ‹’ç»ç™»å½•ï¼‰</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/authorized_keys
<span class="hljs-built_in">chmod</span> 700 ~/.ssh

<span class="hljs-comment"># 4.4 æµ‹è¯•å…å¯†ç™»å½•ï¼ˆåº”ç›´æ¥è¿›å…¥ï¼Œæ— éœ€å¯†ç ï¼‰</span>
ssh localhost
<span class="hljs-built_in">exit</span>  <span class="hljs-comment"># é€€å‡º SSH ä¼šè¯</span>
</code></pre>
<h3 data-id="heading-9">4.ä¸‹è½½å¹¶å®‰è£… Hadoop</h3>
<h4 data-id="heading-10">4.1 ä¸‹è½½ Hadoop</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhadoop.apache.org%2F" target="_blank" title="https://hadoop.apache.org/" ref="nofollow noopener noreferrer">ä»å®˜ç½‘ä¸‹è½½ç¨³å®šç‰ˆ</a>ï¼ˆå¦‚<code>hadoop-3.3.6.tar.gz</code>ï¼‰ï¼Œè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">tar -zxvf hadoop-3.3.6.tar.gz -C /usr/local/	<span class="hljs-comment">#è§£å‹æ“ä½œï¼Œè§£å‹åˆ°/usr/local</span>
<span class="hljs-built_in">cd</span> /usr/local/
sudo <span class="hljs-built_in">mv</span> hadoop-3.3.6 hadoop  <span class="hljs-comment"># é‡å‘½åæ–¹ä¾¿åç»­æ“ä½œ</span>
</code></pre>
<h4 data-id="heading-11">4.2 é…ç½®ç¯å¢ƒå˜é‡</h4>
<p>ç¼–è¾‘<code>~/.bashrc</code>æˆ–<code>/etc/profile</code>æˆ–è€…å½“å‰ç”¨æˆ·çš„ <code> ~/.bash_profile</code>ï¼Œæ·»åŠ å†…å®¹ï¼š</p>
<pre><code class="hljs language-hadoop" lang="hadoop">export HADOOP_HOME=/usr/local/hadoop
export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin
</code></pre>
<p>ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<h3 data-id="heading-12">5.é…ç½® Hadoop æ ¸å¿ƒæ–‡ä»¶</h3>
<p>Hadoop é€šè¿‡ XML æ–‡ä»¶é…ç½®ï¼Œéœ€ä¿®æ”¹ä»¥ä¸‹ 4 ä¸ªæ–‡ä»¶ï¼ˆè·¯å¾„ï¼š<code>$HADOOP_HOME/etc/hadoop/</code>ï¼‰ã€‚</p>
<h4 data-id="heading-13">(1) core-site.xml</h4>
<p>é…ç½® HDFS çš„é»˜è®¤åœ°å€å’Œä¸´æ—¶ç›®å½•ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>fs.defaultFS<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hdfs://localhost:9000<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  # HDFSé»˜è®¤åœ°å€ï¼ˆä¼ªåˆ†å¸ƒå¼ï¼‰
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.tmp.dir<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/usr/local/hadoop/tmp<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>  # ä¸´æ—¶æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆéœ€æ‰‹åŠ¨åˆ›å»ºï¼‰
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">(2) hdfs-site.xml</h4>
<p>é…ç½® HDFS å‰¯æœ¬æ•°ï¼ˆä¼ªåˆ†å¸ƒå¼ä¸‹è®¾ä¸º 1ï¼Œå› åªæœ‰ä¸€ä¸ª DataNodeï¼‰ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>dfs.replication<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-15">(3) mapred-site.xml</h4>
<p>é…ç½® MapReduce æ¡†æ¶ä½¿ç”¨ YARNï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mapreduce.framework.name<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>yarn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">(4) yarn-site.xml</h4>
<p>é…ç½® YARN çš„ ResourceManager åœ°å€å’Œ NodeManager çš„ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>localhost<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>mapreduce_shuffle<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-17">5.1 åˆå§‹åŒ– HDFS æ–‡ä»¶ç³»ç»Ÿ</h4>
<p>æ ¼å¼åŒ– NameNodeï¼ˆé¦–æ¬¡å¯åŠ¨å¿…åšï¼Œä¸”ä»…éœ€æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">hdfs namenode -format
</code></pre>
<h4 data-id="heading-18">5.2 å¯åŠ¨æœåŠ¡</h4>
<p>ä¾æ¬¡å¯åŠ¨ HDFS å’Œ YARN æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">start-dfs.sh  <span class="hljs-comment"># å¯åŠ¨HDFSï¼ˆNameNodeã€DataNodeï¼‰</span>
start-yarn.sh  <span class="hljs-comment"># å¯åŠ¨YARNï¼ˆResourceManagerã€NodeManagerï¼‰</span>
</code></pre>
<h4 data-id="heading-19">5.3 éªŒè¯å®‰è£…</h4>
<ul>
<li><strong>æŸ¥çœ‹è¿›ç¨‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">jps  <span class="hljs-comment"># åº”åŒ…å«NameNodeã€DataNodeã€ResourceManagerã€NodeManagerã€Jpsç­‰è¿›ç¨‹</span>
</code></pre>
<ul>
<li><strong>è®¿é—® Web ç•Œé¢ï¼š</strong>
<ul>
<li>HDFSçŠ¶æ€ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9870%2F" target="_blank" title="http://localhost:9870/" ref="nofollow noopener noreferrer">http://localhost:9870</a>ï¼ˆHadoop 3.x ç«¯å£ï¼‰</li>
<li>YARN èµ„æºç®¡ç†ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8088%2F" target="_blank" title="http://localhost:8088/" ref="nofollow noopener noreferrer">http://localhost:8088</a></li>
<li>å¦‚æœè®¿é—®ä¸äº†è¯·å…³é—­é˜²ç«å¢™å†è¿›è¡Œè®¿é—®</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">systemctl stop firewalld	<span class="hljs-comment">#å…³é—­é˜²ç«å¢™</span>
systemctl <span class="hljs-built_in">disable</span> firewall	<span class="hljs-comment">#å…³é—­å¼€æœºè‡ªå¯</span>
</code></pre>
<ul>
<li><strong>ç®€å•æ“ä½œæµ‹è¯•</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨HDFSåˆ›å»ºç›®å½•</span>
hdfs dfs -<span class="hljs-built_in">mkdir</span> -p /user/hadoop  

<span class="hljs-comment"># ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°HDFS</span>
hdfs dfs -put /etc/profile /user/hadoop  

<span class="hljs-comment"># æŸ¥çœ‹HDFSæ–‡ä»¶åˆ—è¡¨</span>
hdfs dfs -<span class="hljs-built_in">ls</span> /user/hadoop  
</code></pre>
<h2 data-id="heading-20">ä¸‰ã€ä¼ªåˆ†å¸ƒå¼ vs å®Œå…¨åˆ†å¸ƒå¼ vs å•æœºæ¨¡å¼</h2>





























<table><thead><tr><th><strong>æ¨¡å¼</strong></th><th><strong>èŠ‚ç‚¹æ•°</strong></th><th><strong>ç»„ä»¶éƒ¨ç½²</strong></th><th align="center"><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td>å•æœºæ¨¡å¼</td><td>1</td><td>ä»…è¿è¡Œéåˆ†å¸ƒå¼è¿›ç¨‹ï¼ˆæ— å®ˆæŠ¤è¿›ç¨‹ï¼‰</td><td align="center">å¿«é€ŸéªŒè¯ç¨‹åºé€»è¾‘ï¼ˆæ— åˆ†å¸ƒå¼åŠŸèƒ½ï¼‰</td></tr><tr><td><strong>ä¼ªåˆ†å¸ƒå¼</strong></td><td>1</td><td>æ‰€æœ‰åˆ†å¸ƒå¼ç»„ä»¶è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹</td><td align="center">å­¦ä¹ ã€è°ƒè¯•ã€æœ¬åœ°æµ‹è¯•</td></tr><tr><td>å®Œå…¨åˆ†å¸ƒå¼</td><td>â‰¥2</td><td>å„ç»„ä»¶åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ï¼ˆä¸»ä»æ¶æ„ï¼‰</td><td align="center">ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡æ•°æ®å¤„ç†</td></tr></tbody></table>
<h2 data-id="heading-21">å››ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p><strong>ç«¯å£å†²çª</strong>ï¼šè‹¥ 9000ã€8088 ç­‰ç«¯å£è¢«å ç”¨ï¼Œéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£å·ï¼ˆå¦‚<code>fs.defaultFS</code>æ”¹ä¸º<code>hdfs://localhost:9001</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æƒé™é—®é¢˜</strong>ï¼šé¿å…ç”¨sudoå¯åŠ¨æœåŠ¡ï¼ˆå¯èƒ½å¯¼è‡´æ–‡ä»¶æƒé™æ··ä¹±ï¼‰ï¼Œå»ºè®®ç”¨æ™®é€šç”¨æˆ·æ“ä½œï¼Œæˆ–æå‰è®¾ç½®ç›®å½•æƒé™ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> /usr/local/hadoop  <span class="hljs-comment"># èµ‹äºˆå½“å‰ç”¨æˆ·ç›®å½•æ‰€æœ‰æƒ</span>
</code></pre>
</li>
<li>
<p><strong>æ—¥å¿—æ’æŸ¥</strong>ï¼šå¯åŠ¨å¤±è´¥æ—¶ï¼ŒæŸ¥çœ‹<code>$HADOOP_HOME/logs/</code>ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚<code>hadoop-${USER}-namenode-${HOSTNAME}.log</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å…³é—­æœåŠ¡</strong>ï¼šç”¨<code>stop-dfs.sh</code>å’Œ<code>stop-yarn.sh</code>æ­£å¸¸åœæ­¢ï¼Œé¿å…ç›´æ¥ kill è¿›ç¨‹å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p>
</li>
</ol>
<h2 data-id="heading-22">äº”ã€æ€»ç»“</h2>
<p>é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å®Œæˆäº† Hadoop ä¼ªåˆ†å¸ƒå¼çš„å®‰è£…ã€é…ç½®ä¸éªŒè¯ï¼Œå¯¹å…¶ç‰¹ç‚¹ã€é€‚ç”¨åœºæ™¯ä¹Ÿæœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚è¿™ç§è½»é‡çº§ä¸”åŠŸèƒ½å¼ºå¤§çš„éƒ¨ç½²æ–¹å¼ï¼Œæ— ç–‘æ˜¯åˆå­¦è€…æ¢ç´¢ Hadoop ä¸–ç•Œçš„ä¸€æŠŠé‡‘é’¥åŒ™ï¼Œæ›´æ˜¯å¼€å‘è€…åœ¨æœ¬åœ°è°ƒè¯•ä¸å­¦ä¹ è¿‡ç¨‹ä¸­çš„å¾—åŠ›åŠ©æ‰‹ã€‚</p>
<p>ç„¶è€Œï¼ŒHadoop çš„é­…åŠ›è¿œä¸æ­¢äºæ­¤ã€‚åœ¨å¤§æ•°æ®çš„æµªæ½®ä¸­ï¼Œå®ƒæ˜¯å¤„ç†æµ·é‡æ•°æ®çš„ä¸­åšåŠ›é‡ï¼Œæ¯ä¸€æ¬¡çš„æ“ä½œéƒ½åƒæ˜¯åœ¨ä¸æ•°æ®è¿›è¡Œä¸€åœºæ·±åº¦å¯¹è¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ æŒæ¡äº† Hadoop ä¼ªåˆ†å¸ƒå¼çš„ç²¾é«“ï¼Œä½ å°±èƒ½å¤Ÿæ›´åŠ è‡ªç”±åœ°åœ¨æ•°æ®çš„æµ·æ´‹ä¸­é¨æ¸¸ï¼ŒæŒ–æ˜å‡ºé‚£äº›éšè—åœ¨æ•°æ®èƒŒåçš„å®è´µä¿¡æ¯ã€‚</p>
<p>å¦‚æœä½ åœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°äº†ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…æœ‰ç‹¬ç‰¹çš„ç»éªŒæƒ³è¦åˆ†äº«ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚è®©æˆ‘ä»¬ä¸€èµ·åœ¨å¤§æ•°æ®çš„å¾ç¨‹ä¸­æºæ‰‹å…±è¿›ï¼Œæ¢ç´¢æ›´å¤šçš„å¯èƒ½æ€§ï¼</p>
<p>åˆ«å¿˜äº†ç‚¹èµğŸ‘ã€æ”¶è—å’Œåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼Œè®©æ›´å¤šå¯¹ Hadoop æ„Ÿå…´è¶£çš„æœ‹å‹èƒ½å¤Ÿå—ç›Šã€‚å…³æ³¨æˆ‘ï¼Œè·å–æ›´å¤šå…³äºå¤§æ•°æ®æŠ€æœ¯çš„ç²¾å½©å†…å®¹ï¼Œä¸€èµ·è§£é”å¤§æ•°æ®é¢†åŸŸçš„æ— é™æ½œåŠ›ï¼æœŸå¾…ä¸ä½ åœ¨å¤§æ•°æ®çš„ä¸–ç•Œä¸­å†æ¬¡ç›¸é‡ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™ç®€æ˜“Vueå“åº”å¼ï¼šåŸºäºProxy + effectçš„æ ¸å¿ƒå®ç°]]></title>    <link>https://juejin.cn/post/7595147176752168960</link>    <guid>https://juejin.cn/post/7595147176752168960</guid>    <pubDate>2026-01-15T06:02:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595147176752168960" data-draft-id="7594402344617197583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™ç®€æ˜“Vueå“åº”å¼ï¼šåŸºäºProxy + effectçš„æ ¸å¿ƒå®ç°"/> <meta itemprop="keywords" content="Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-15T06:02:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™ç®€æ˜“Vueå“åº”å¼ï¼šåŸºäºProxy + effectçš„æ ¸å¿ƒå®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:02:03.000Z" title="Thu Jan 15 2026 06:02:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vueçš„å“åº”å¼ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œä»Vue2åˆ°Vue3ï¼Œå“åº”å¼çš„å®ç°æ–¹æ¡ˆä»<code>Object.defineProperty</code>æ¼”è¿›ä¸º<code>Proxy</code>ã€‚ç›¸æ¯”å‰è€…ï¼ŒProxyèƒ½åŸç”Ÿæ”¯æŒæ•°ç»„ã€å¯¹è±¡æ–°å¢å±æ€§ç­‰åœºæ™¯ï¼Œä¸”å¯¹å¯¹è±¡çš„æ‹¦æˆªæ›´å…¨é¢ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒåŸç†å‡ºå‘ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ å®ç°ä¸€ä¸ªåŸºäºProxy + effectçš„ç®€æ˜“Vueå“åº”å¼ç³»ç»Ÿï¼Œå¸®ä½ å½»åº•ææ‡‚å“åº”å¼çš„åº•å±‚é€»è¾‘ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å“åº”å¼çš„æ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>å“åº”å¼çš„æœ¬è´¨æ˜¯â€œæ•°æ®å˜åŒ–é©±åŠ¨è§†å›¾æ›´æ–°â€ï¼Œå…¶æ ¸å¿ƒé€»è¾‘å¯æ‹†è§£ä¸ºä¸‰ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>ä¾èµ–æ”¶é›†</strong>ï¼šå½“ç»„ä»¶æ¸²æŸ“ï¼ˆæˆ–effectæ‰§è¡Œï¼‰æ—¶ï¼Œä¼šè®¿é—®å“åº”å¼æ•°æ®ï¼Œæ­¤æ—¶è®°å½•â€œæ•°æ®-ä¾èµ–ï¼ˆeffectï¼‰â€çš„æ˜ å°„å…³ç³»ï¼›</li>
<li><strong>æ•°æ®æ‹¦æˆª</strong>ï¼šé€šè¿‡Proxyæ‹¦æˆªå“åº”å¼æ•°æ®çš„è¯»å–ï¼ˆgetï¼‰å’Œä¿®æ”¹ï¼ˆsetï¼‰æ“ä½œâ€”â€”è¯»å–æ—¶è§¦å‘ä¾èµ–æ”¶é›†ï¼Œä¿®æ”¹æ—¶è§¦å‘ä¾èµ–æ›´æ–°ï¼›</li>
<li><strong>ä¾èµ–è§¦å‘</strong>ï¼šå½“å“åº”å¼æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œæ‰¾åˆ°ä¹‹å‰æ”¶é›†çš„æ‰€æœ‰ä¾èµ–ï¼ˆeffectï¼‰ï¼Œå¹¶é‡æ–°æ‰§è¡Œè¿™äº›ä¾èµ–ï¼Œä»è€Œå®ç°è§†å›¾æ›´æ–°æˆ–å…¶ä»–å‰¯ä½œç”¨è§¦å‘ã€‚</li>
</ol>
<p>å…¶ä¸­ï¼Œ<code>Proxy</code>è´Ÿè´£â€œæ•°æ®æ‹¦æˆªâ€ï¼Œ<code>effect</code>è´Ÿè´£å°è£…â€œä¾èµ–ï¼ˆå‰¯ä½œç”¨å‡½æ•°ï¼‰â€ï¼Œå†é…åˆä¸€ä¸ªâ€œä¾èµ–æ˜ å°„è¡¨â€å®Œæˆæ•´ä¸ªå“åº”å¼é—­ç¯ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒæ¨¡å—æ‹†è§£ä¸å®ç°</h2>
<p>æˆ‘ä»¬å°†åˆ†ä¸‰æ­¥å®ç°ç®€æ˜“å“åº”å¼ç³»ç»Ÿï¼šå…ˆå®ç°effectæ¨¡å—å°è£…å‰¯ä½œç”¨ï¼Œå†å®ç°reactiveæ¨¡å—åŸºäºProxyæ‹¦æˆªæ•°æ®ï¼Œæœ€åé€šè¿‡ä¾èµ–æ˜ å°„è¡¨å…³è”ä¸¤è€…ï¼Œå®Œæˆä¾èµ–æ”¶é›†ä¸è§¦å‘ã€‚</p>
<h3 data-id="heading-2">1. ç¬¬ä¸€æ­¥ï¼šå®ç°effectâ€”â€”å‰¯ä½œç”¨å‡½æ•°å°è£…</h3>
<p>effectçš„ä½œç”¨æ˜¯åŒ…è£¹éœ€è¦å“åº”å¼è§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆæ¯”å¦‚ç»„ä»¶æ¸²æŸ“å‡½æ•°ã€watchå›è°ƒç­‰ï¼‰ã€‚å½“effectæ‰§è¡Œæ—¶ï¼Œä¼šä¸»åŠ¨è§¦å‘å“åº”å¼æ•°æ®çš„getæ“ä½œï¼Œè¿›è€Œè§¦å‘ä¾èµ–æ”¶é›†ï¼›å½“æ•°æ®å˜åŒ–æ—¶ï¼Œeffectä¼šè¢«é‡æ–°æ‰§è¡Œã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼ˆactiveEffectï¼‰ï¼Œç”¨äºæ ‡è®°å½“å‰æ­£åœ¨æ‰§è¡Œçš„effectï¼›</li>
<li>effectå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼ˆfnï¼‰ï¼Œæ‰§è¡Œfnå‰å°†å…¶èµ‹å€¼ç»™activeEffectï¼Œæ‰§è¡Œåæ¸…ç©ºactiveEffectï¼ˆé¿å…éå“åº”å¼æ•°æ®è®¿é—®æ—¶è¯¯æ”¶é›†ä¾èµ–ï¼‰ã€‚</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€å˜é‡ï¼šæ ‡è®°å½“å‰æ´»è·ƒçš„effectï¼ˆæ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ï¼‰</span>
<span class="hljs-keyword">let</span> activeEffect = <span class="hljs-literal">null</span>;

<span class="hljs-comment">/**
 * å‰¯ä½œç”¨å‡½æ•°å°è£…
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">fn</span> - éœ€è¦å“åº”å¼è§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">effect</span>(<span class="hljs-params">fn</span>) {
  <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œä¾¿äºåç»­æ‰©å±•ï¼ˆå¦‚é”™è¯¯å¤„ç†ã€è°ƒåº¦æ‰§è¡Œç­‰ï¼‰</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">effectFn</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°å‰ï¼Œå…ˆæ ‡è®°å½“å‰æ´»è·ƒçš„effect</span>
    activeEffect = effectFn;
    <span class="hljs-comment">// æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼ˆæ­¤æ—¶ä¼šè®¿é—®å“åº”å¼æ•°æ®ï¼Œè§¦å‘getæ‹¦æˆªï¼Œè¿›è€Œæ”¶é›†ä¾èµ–ï¼‰</span>
    <span class="hljs-title function_">fn</span>();
    <span class="hljs-comment">// æ‰§è¡Œå®Œæˆåï¼Œæ¸…ç©ºæ ‡è®°ï¼ˆé¿å…åç»­éå“åº”å¼æ•°æ®è®¿é—®æ—¶è¯¯æ”¶é›†ï¼‰</span>
    activeEffect = <span class="hljs-literal">null</span>;
  };

  <span class="hljs-comment">// ç«‹å³æ‰§è¡Œä¸€æ¬¡å‰¯ä½œç”¨å‡½æ•°ï¼Œè§¦å‘åˆå§‹çš„ä¾èµ–æ”¶é›†</span>
  <span class="hljs-title function_">effectFn</span>();
}
</code></pre>
<h3 data-id="heading-3">2. ç¬¬äºŒæ­¥ï¼šå®ç°ä¾èµ–æ˜ å°„è¡¨â€”â€”trackä¸trigger</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨â€œæ•°æ®-å±æ€§-effectâ€çš„æ˜ å°„å…³ç³»ï¼Œè¿™é‡Œé‡‡ç”¨<code>WeakMapï¼ˆæ•°æ®ï¼‰â†’ Mapï¼ˆå±æ€§ï¼‰â†’ Setï¼ˆeffectï¼‰</code>çš„ç»“æ„ï¼š</p>
<ul>
<li>WeakMapï¼škeyä¸ºå“åº”å¼å¯¹è±¡ï¼ˆtargetï¼‰ï¼Œvalueä¸ºMapï¼ˆå±æ€§æ˜ å°„è¡¨ï¼‰ï¼Œå¼±å¼•ç”¨ç‰¹æ€§å¯é¿å…å†…å­˜æ³„æ¼ï¼›</li>
<li>Mapï¼škeyä¸ºå¯¹è±¡çš„å±æ€§åï¼ˆkeyï¼‰ï¼Œvalueä¸ºSetï¼ˆå­˜å‚¨è¯¥å±æ€§å¯¹åº”çš„æ‰€æœ‰effectï¼‰ï¼›</li>
<li>Setï¼šå­˜å‚¨effectï¼Œä¿è¯effectä¸é‡å¤ï¼ˆé¿å…å¤šæ¬¡æ‰§è¡ŒåŒä¸€å‰¯ä½œç”¨ï¼‰ã€‚</li>
</ul>
<p>åŸºäºè¿™ä¸ªç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š</p>
<ul>
<li>trackï¼šåœ¨å“åº”å¼æ•°æ®è¢«è¯»å–æ—¶è°ƒç”¨ï¼Œæ”¶é›†ä¾èµ–ï¼ˆå°†activeEffectå­˜å…¥æ˜ å°„è¡¨ï¼‰ï¼›</li>
<li>triggerï¼šåœ¨å“åº”å¼æ•°æ®è¢«ä¿®æ”¹æ—¶è°ƒç”¨ï¼Œè§¦å‘ä¾èµ–ï¼ˆä»æ˜ å°„è¡¨ä¸­å–å‡ºeffectå¹¶æ‰§è¡Œï¼‰ã€‚</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¾èµ–æ˜ å°„è¡¨ï¼šWeakMap(target) â†’ Map(key) â†’ Set(effect)</span>
<span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-comment">/**
 * æ”¶é›†ä¾èµ–ï¼ˆå“åº”å¼æ•°æ®è¯»å–æ—¶è§¦å‘ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">target</span> - å“åº”å¼å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">key</span> - è¢«è¯»å–çš„å±æ€§å
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-comment">// 1. è‹¥å½“å‰æ— æ´»è·ƒçš„effectï¼Œæ— éœ€æ”¶é›†ä¾èµ–ï¼Œç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (!activeEffect) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 2. ä»targetMapä¸­è·å–å½“å‰å¯¹è±¡çš„å±æ€§æ˜ å°„è¡¨ï¼ˆMapï¼‰</span>
  <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span> (!depsMap) {
    <span class="hljs-comment">// è‹¥ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„Mapå¹¶å­˜å…¥targetMap</span>
    depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    targetMap.<span class="hljs-title function_">set</span>(target, depsMap);
  }

  <span class="hljs-comment">// 3. ä»depsMapä¸­è·å–å½“å‰å±æ€§çš„effecté›†åˆï¼ˆSetï¼‰</span>
  <span class="hljs-keyword">let</span> deps = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span> (!deps) {
    <span class="hljs-comment">// è‹¥ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„Setå¹¶å­˜å…¥depsMap</span>
    deps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    depsMap.<span class="hljs-title function_">set</span>(key, deps);
  }

  <span class="hljs-comment">// 4. å°†å½“å‰æ´»è·ƒçš„effectå­˜å…¥Setï¼ˆä¿è¯ä¸é‡å¤ï¼‰</span>
  deps.<span class="hljs-title function_">add</span>(activeEffect);
}

<span class="hljs-comment">/**
 * è§¦å‘ä¾èµ–ï¼ˆå“åº”å¼æ•°æ®ä¿®æ”¹æ—¶è§¦å‘ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">target</span> - å“åº”å¼å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">key</span> - è¢«ä¿®æ”¹çš„å±æ€§å
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-comment">// 1. ä»targetMapä¸­è·å–å½“å‰å¯¹è±¡çš„å±æ€§æ˜ å°„è¡¨</span>
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// è‹¥æ²¡æœ‰æ”¶é›†è¿‡ä¾èµ–ï¼Œç›´æ¥è¿”å›</span>

  <span class="hljs-comment">// 2. ä»depsMapä¸­è·å–å½“å‰å±æ€§çš„effecté›†åˆ</span>
  <span class="hljs-keyword">const</span> deps = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span> (deps) {
    <span class="hljs-comment">// 3. éå†effecté›†åˆï¼Œæ‰§è¡Œæ¯ä¸ªeffectï¼ˆè§¦å‘å‰¯ä½œç”¨æ›´æ–°ï¼‰</span>
    deps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>());
  }
}
</code></pre>
<h3 data-id="heading-4">3. ç¬¬ä¸‰æ­¥ï¼šå®ç°reactiveâ€”â€”åŸºäºProxyçš„å“åº”å¼æ•°æ®æ‹¦æˆª</h3>
<p>reactiveå‡½æ•°çš„ä½œç”¨æ˜¯å°†æ™®é€šå¯¹è±¡è½¬ä¸ºå“åº”å¼å¯¹è±¡ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡Proxyæ‹¦æˆªå¯¹è±¡çš„getï¼ˆè¯»å–ï¼‰å’Œsetï¼ˆä¿®æ”¹ï¼‰æ“ä½œï¼š</p>
<ul>
<li>getæ‹¦æˆªï¼šå½“è¯»å–å“åº”å¼å¯¹è±¡çš„å±æ€§æ—¶ï¼Œè°ƒç”¨trackå‡½æ•°æ”¶é›†ä¾èµ–ï¼›</li>
<li>setæ‹¦æˆªï¼šå½“ä¿®æ”¹å“åº”å¼å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå…ˆæ›´æ–°å±æ€§å€¼ï¼Œå†è°ƒç”¨triggerå‡½æ•°è§¦å‘ä¾èµ–ã€‚</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å°†æ™®é€šå¯¹è±¡è½¬ä¸ºå“åº”å¼å¯¹è±¡ï¼ˆåŸºäºProxyï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">target</span> - æ™®é€šå¯¹è±¡
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Proxy</span>} å“åº”å¼å¯¹è±¡
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-comment">// æ‹¦æˆªå±æ€§è¯»å–æ“ä½œ</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-comment">// 1. è¯»å–åŸå§‹å±æ€§å€¼</span>
      <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key);
      <span class="hljs-comment">// 2. æ”¶é›†ä¾èµ–ï¼ˆå…³è”targetã€keyå’Œå½“å‰activeEffectï¼‰</span>
      <span class="hljs-title function_">track</span>(target, key);
      <span class="hljs-comment">// 3. è¿”å›å±æ€§å€¼ï¼ˆè‹¥valueæ˜¯å¯¹è±¡ï¼Œå¯é€’å½’è½¬ä¸ºå“åº”å¼ï¼Œè¿™é‡Œç®€åŒ–å®ç°ï¼‰</span>
      <span class="hljs-keyword">return</span> value;
    },

    <span class="hljs-comment">// æ‹¦æˆªå±æ€§ä¿®æ”¹æ“ä½œ</span>
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
      <span class="hljs-comment">// 1. ä¿®æ”¹åŸå§‹å±æ€§å€¼</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value);
      <span class="hljs-comment">// 2. è§¦å‘ä¾èµ–ï¼ˆæ‰§è¡Œè¯¥å±æ€§å…³è”çš„æ‰€æœ‰effectï¼‰</span>
      <span class="hljs-title function_">trigger</span>(target, key);
      <span class="hljs-comment">// 3. è¿”å›ä¿®æ”¹ç»“æœï¼ˆç¬¦åˆProxyè§„èŒƒï¼‰</span>
      <span class="hljs-keyword">return</span> result;
    }
  });
}
</code></pre>
<p>è¿™é‡Œä½¿ç”¨<code>Reflect</code>è€Œéç›´æ¥æ“ä½œtargetï¼Œæ˜¯ä¸ºäº†ä¿è¯æ“ä½œçš„è§„èŒƒæ€§ï¼ˆæ¯”å¦‚Reflect.setä¼šè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºä¿®æ”¹æˆåŠŸï¼Œè€Œç›´æ¥èµ‹å€¼ä¸ä¼šï¼‰ï¼ŒåŒæ—¶ä¸Proxyçš„æ‹¦æˆªè¡Œä¸ºæ›´åŒ¹é…ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å®Œæ•´æµ‹è¯•ï¼šéªŒè¯å“åº”å¼æ•ˆæœ</h2>
<p>æˆ‘ä»¬å·²ç»å®ç°äº†effectã€trackã€triggerã€reactiveå››ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç°åœ¨ç¼–å†™æµ‹è¯•ä»£ç éªŒè¯å“åº”å¼æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. åˆ›å»ºæ™®é€šå¯¹è±¡å¹¶è½¬ä¸ºå“åº”å¼å¯¹è±¡</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> });

<span class="hljs-comment">// 2. å®šä¹‰å‰¯ä½œç”¨å‡½æ•°ï¼ˆæ¨¡æ‹Ÿç»„ä»¶æ¸²æŸ“ï¼šä¾èµ–user.nameå’Œuser.ageï¼‰</span>
<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å§“åï¼š<span class="hljs-subst">${user.name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">${user.age}</span>`</span>);
});

<span class="hljs-comment">// 3. ä¿®æ”¹å“åº”å¼æ•°æ®ï¼Œè§‚å¯Ÿå‰¯ä½œç”¨æ˜¯å¦è§¦å‘</span>
user.<span class="hljs-property">name</span> = <span class="hljs-string">"æå››"</span>; <span class="hljs-comment">// è¾“å‡ºï¼šå§“åï¼šæå››ï¼Œå¹´é¾„ï¼š20ï¼ˆè§¦å‘effecté‡æ–°æ‰§è¡Œï¼‰</span>
user.<span class="hljs-property">age</span> = <span class="hljs-number">21</span>;      <span class="hljs-comment">// è¾“å‡ºï¼šå§“åï¼šæå››ï¼Œå¹´é¾„ï¼š21ï¼ˆå†æ¬¡è§¦å‘effectï¼‰</span>
user.<span class="hljs-property">gender</span> = <span class="hljs-string">"ç”·"</span>; <span class="hljs-comment">// æ–°å¢å±æ€§ï¼ˆProxyå¤©ç„¶æ”¯æŒï¼Œè‹¥æœ‰ä¾èµ–è¯¥å±æ€§çš„effectä¹Ÿä¼šè§¦å‘ï¼‰</span>
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<ul>
<li>effecté¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œè¾“å‡ºâ€œå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š20â€ï¼ˆåˆå§‹æ¸²æŸ“ï¼‰ï¼›</li>
<li>ä¿®æ”¹user.nameæ—¶ï¼Œè§¦å‘setæ‹¦æˆªâ†’triggerâ†’effecté‡æ–°æ‰§è¡Œï¼Œè¾“å‡ºæ›´æ–°åçš„å†…å®¹ï¼›</li>
<li>ä¿®æ”¹user.ageæ—¶ï¼ŒåŒæ ·è§¦å‘effectæ›´æ–°ï¼›</li>
<li>æ–°å¢user.genderæ—¶ï¼Œè‹¥åç»­æœ‰effectä¾èµ–è¯¥å±æ€§ï¼Œä¿®æ”¹æ—¶ä¹Ÿä¼šè§¦å‘æ›´æ–°ï¼ˆæœ¬æµ‹è¯•ä¸­æ— ä¾èµ–ï¼Œæ•…æ— è¾“å‡ºï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-6">å››ã€æ ¸å¿ƒç»†èŠ‚è¡¥å……ä¸ç®€åŒ–ç‚¹è¯´æ˜</h2>
<p>ä¸Šé¢çš„å®ç°æ˜¯ç®€åŒ–ç‰ˆå“åº”å¼ï¼ŒVue3çš„çœŸå®å“åº”å¼ç³»ç»Ÿæ›´å¤æ‚ï¼Œè¿™é‡Œè¡¥å……å‡ ä¸ªå…³é”®ç»†èŠ‚å’Œç®€åŒ–ç‚¹ï¼š</p>
<h3 data-id="heading-7">1. ç®€åŒ–ç‚¹ï¼šæœªå¤„ç†åµŒå¥—å¯¹è±¡</h3>
<p>å½“å‰reactiveå‡½æ•°ä»…å¯¹é¡¶å±‚å¯¹è±¡è¿›è¡ŒProxyæ‹¦æˆªï¼Œè‹¥å¯¹è±¡å±æ€§æ˜¯åµŒå¥—å¯¹è±¡ï¼ˆå¦‚<code>user = { info: { age: 20 } }</code>ï¼‰ï¼Œä¿®æ”¹<code>user.info.age</code>ä¸ä¼šè§¦å‘å“åº”å¼ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨getæ‹¦æˆªæ—¶ï¼Œå¯¹è¿”å›çš„valueè¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ä¸ºå¯¹è±¡åˆ™é€’å½’è°ƒç”¨reactiveï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–reactiveçš„getæ‹¦æˆª</span>
<span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key);
  <span class="hljs-title function_">track</span>(target, key);
  <span class="hljs-comment">// é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value !== <span class="hljs-literal">null</span> ? <span class="hljs-title function_">reactive</span>(value) : value;
}
</code></pre>
<h3 data-id="heading-8">2. ç®€åŒ–ç‚¹ï¼šæœªå¤„ç†æ•°ç»„</h3>
<p>Proxyå¤©ç„¶æ”¯æŒæ•°ç»„æ‹¦æˆªï¼Œæ¯”å¦‚ä¿®æ”¹æ•°ç»„çš„pushã€spliceã€ç´¢å¼•ç­‰æ“ä½œã€‚åªéœ€åœ¨setæ‹¦æˆªæ—¶ï¼Œå¯¹æ•°ç»„çš„ç‰¹æ®Šæ“ä½œï¼ˆå¦‚pushä¼šæ–°å¢ç´¢å¼•ï¼‰è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿triggerèƒ½æ­£ç¡®è§¦å‘ã€‚å½“å‰ç®€åŒ–å®ç°å·²æ”¯æŒæ•°ç»„çš„ç´¢å¼•ä¿®æ”¹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ•°ç»„ï¼š"</span>, list.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>));
});
list[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>; <span class="hljs-comment">// è¾“å‡ºï¼šæ•°ç»„ï¼š10,2,3ï¼ˆè§¦å‘effectï¼‰</span>
list.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// è¾“å‡ºï¼šæ•°ç»„ï¼š10,2,3,4ï¼ˆè§¦å‘effectï¼‰</span>
</code></pre>
<h3 data-id="heading-9">3. çœŸå®Vue3çš„æ‰©å±•ï¼šè°ƒåº¦æ‰§è¡Œã€computedã€watchç­‰</h3>
<p>æˆ‘ä»¬çš„å®ç°ä»…è¦†ç›–äº†æ ¸å¿ƒå“åº”å¼é€»è¾‘ï¼ŒVue3è¿˜åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•äº†ï¼š</p>
<ul>
<li>è°ƒåº¦æ‰§è¡Œï¼šeffectæ”¯æŒä¼ å…¥scheduleré€‰é¡¹ï¼Œå®ç°å‰¯ä½œç”¨çš„å»¶è¿Ÿæ‰§è¡Œã€é˜²æŠ–ã€èŠ‚æµç­‰ï¼›</li>
<li>computedï¼šåŸºäºeffectå®ç°ç¼“å­˜æœºåˆ¶ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—ï¼›</li>
<li>watchï¼šç›‘å¬å“åº”å¼æ•°æ®å˜åŒ–ï¼Œè§¦å‘å›è°ƒå‡½æ•°ï¼ˆæ”¯æŒç«‹å³æ‰§è¡Œã€æ·±åº¦ç›‘å¬ç­‰ï¼‰ï¼›</li>
<li>Refï¼šå¤„ç†åŸºæœ¬ç±»å‹çš„å“åº”å¼ï¼ˆé€šè¿‡å°è£…å¯¹è±¡å®ç°ï¼Œæ ¸å¿ƒè¿˜æ˜¯Proxyï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-10">äº”ã€æ€»ç»“</h2>
<p>æœ¬æ–‡é€šè¿‡â€œeffectå°è£…å‰¯ä½œç”¨ â†’ track/triggerç®¡ç†ä¾èµ– â†’ reactiveåŸºäºProxyæ‹¦æˆªæ•°æ®â€çš„æ­¥éª¤ï¼Œå®ç°äº†ä¸€ä¸ªç®€æ˜“çš„Vueå“åº”å¼ç³»ç»Ÿã€‚æ ¸å¿ƒé€»è¾‘å¯æ¦‚æ‹¬ä¸ºï¼š</p>
<p>effectæ‰§è¡Œæ—¶æ ‡è®°æ´»è·ƒçŠ¶æ€ï¼Œè®¿é—®å“åº”å¼æ•°æ®è§¦å‘getæ‹¦æˆªï¼Œé€šè¿‡trackæ”¶é›†â€œæ•°æ®-å±æ€§-effectâ€ä¾èµ–ï¼›ä¿®æ”¹æ•°æ®è§¦å‘setæ‹¦æˆªï¼Œé€šè¿‡triggeræ‰¾åˆ°å¯¹åº”ä¾èµ–å¹¶é‡æ–°æ‰§è¡Œeffectï¼Œæœ€ç»ˆå®ç°å“åº”å¼æ›´æ–°ã€‚</p>
<p>ç†è§£è¿™ä¸ªæ ¸å¿ƒé€»è¾‘åï¼Œå†å»å­¦ä¹ Vue3çš„computedã€watchç­‰APIçš„å®ç°åŸç†ï¼Œå°±ä¼šå˜å¾—éå¸¸è½»æ¾ã€‚å»ºè®®ä½ åŠ¨æ‰‹æ•²ä¸€éä»£ç ï¼Œå°è¯•ä¿®æ”¹å’Œæ‰©å±•ï¼ˆæ¯”å¦‚æ·»åŠ åµŒå¥—å¯¹è±¡æ”¯æŒã€è°ƒåº¦æ‰§è¡Œï¼‰ï¼ŒåŠ æ·±å¯¹å“åº”å¼åŸç†çš„ç†è§£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¿…çŸ¥Nodeåº”ç”¨æ€§èƒ½æå‡åŠAPI test æ¥å£æµ‹è¯•]]></title>    <link>https://juejin.cn/post/7595142737514561563</link>    <guid>https://juejin.cn/post/7595142737514561563</guid>    <pubDate>2026-01-15T06:04:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142737514561563" data-draft-id="7595028805159043082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¿…çŸ¥Nodeåº”ç”¨æ€§èƒ½æå‡åŠAPI test æ¥å£æµ‹è¯•"/> <meta itemprop="keywords" content="å‰ç«¯,Node.js,React.js"/> <meta itemprop="datePublished" content="2026-01-15T06:04:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä»˜è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¿…çŸ¥Nodeåº”ç”¨æ€§èƒ½æå‡åŠAPI test æ¥å£æµ‹è¯•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä»˜è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:04:28.000Z" title="Thu Jan 15 2026 06:04:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”¨æˆ·æ³¨æ„åŠ›æ— æ³•è¶…è¿‡ 10s</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f5a28da6d749a28231e7ccc6c93e58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=lKYTBUjQsLh46J%2FSuFXpwIMPJa8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">æå‡æ€§èƒ½æ–¹æ³•</h2>
<h3 data-id="heading-2">ä½¿ç”¨ å¤šä¸ªè¿›ç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a36090b822304e588de6884871e01289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=R1MmXL0sIZ%2FblXwMPUP9sucqYBE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d320f4477284766b74509cb6fc7e47d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=Qagp1%2B6qsZJGT1jO8kOnEz5OynU%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥è®©å•çº¿ç¨‹èŠ‚ç‚¹åº”ç”¨å……åˆ†ä½¿ç”¨ CPUï¼Œ æ¯ä¸ª CPU å†…æ ¸éƒ½èƒ½å¹¶è¡Œè¿è¡Œä»£ç </p>
<p>Node åŸç”Ÿ <code>cluster</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// cluster.js</span>
<span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cluster'</span>)
<span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WORKERS</span> = <span class="hljs-title class_">Number</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">WORKERS</span> || os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span>)

<span class="hljs-keyword">if</span> (cluster.<span class="hljs-property">isPrimary</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[master] pid=<span class="hljs-subst">${process.pid}</span>, workers=<span class="hljs-subst">${WORKERS}</span>`</span>)

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable constant_">WORKERS</span>; i++) cluster.<span class="hljs-title function_">fork</span>()

  <span class="hljs-comment">// worker å¼‚å¸¸é€€å‡ºè‡ªåŠ¨æ‹‰èµ·</span>
  cluster.<span class="hljs-title function_">on</span>(<span class="hljs-string">'exit'</span>, <span class="hljs-function">(<span class="hljs-params">worker, code, signal</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[master] worker <span class="hljs-subst">${worker.process.pid}</span> exit code=<span class="hljs-subst">${code}</span> signal=<span class="hljs-subst">${signal}</span>, restart...`</span>)
    cluster.<span class="hljs-title function_">fork</span>()
  })
} <span class="hljs-keyword">else</span> {
  <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app'</span>) <span class="hljs-comment">// è¿™é‡Œå¼•å…¥ä½ çš„æœåŠ¡å…¥å£</span>
}

</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`hello from pid=<span class="hljs-subst">${process.pid}</span>\n`</span>)
})

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-title class_">Number</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>)
server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[worker] pid=<span class="hljs-subst">${process.pid}</span> listening on <span class="hljs-subst">${PORT}</span>`</span>)
})

<span class="hljs-comment">// ä¼˜é›…é€€å‡ºï¼ˆé…åˆ reload/restart æ›´ç¨³ï¼‰</span>
process.<span class="hljs-title function_">on</span>(<span class="hljs-string">'SIGTERM'</span>, <span class="hljs-function">() =&gt;</span> {
  server.<span class="hljs-title function_">close</span>(<span class="hljs-function">() =&gt;</span> process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>))
})

</code></pre>
<p>å¯åŠ¨</p>
<pre><code class="hljs language-ini" lang="ini">node cluster.js
<span class="hljs-comment"># æˆ–æŒ‡å®šè¿›ç¨‹æ•°</span>
<span class="hljs-attr">WORKERS</span>=<span class="hljs-number">4</span> node cluster.js

</code></pre>
<h3 data-id="heading-3">é›†ç¾¤</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76d177c0af0d46139996e14304d2aa4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=pcT2c9QGIiAEi2X6F%2B9%2B1YMnOSs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb642858ab3b48c1913cfb04e9fd6d78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=rsGYDCoGF29aGPQumBKG0zPS6mM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7879cca5085146c2b74432fa7201ce6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=y6Aki0%2Ba2%2F7i5ks%2Bb651l650My0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8049e3c7a0b745b2a7b1132a0c25518e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=33i80e3EPgnFJanFN7yjQ3yGckQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">è´Ÿè½½å‡è¡¡</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c052e049bf0a4b98ac667a900ee0bc5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=guduy3lunykg0CT1G388Ptf49VU%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€å¸¸ç”¨ï¼šNginx upstream è´Ÿè½½å‡è¡¡ï¼ˆæ¨èï¼‰</p>
<p>é€‚åˆï¼šå¤šå°æœºå™¨ã€å¤šå®¹å™¨ã€å¤šå®ä¾‹ï¼›ç¨³å®šã€åŠŸèƒ½å…¨ï¼ˆå¥åº·æ£€æŸ¥ã€é™æµã€TLSã€ç¼“å­˜ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">upstream api_upstream {
  least_conn<span class="hljs-comment">;            # ä¹Ÿå¯ç”¨ round_robin(é»˜è®¤) / ip_hash(ç²˜æ€§)</span>
  server 127.0.0.1:3001 <span class="hljs-attr">max_fails</span>=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
  server 127.0.0.1:3002 <span class="hljs-attr">max_fails</span>=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
  server 127.0.0.1:3003 <span class="hljs-attr">max_fails</span>=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">10</span>s<span class="hljs-comment">;</span>
}

server {
  listen 80<span class="hljs-comment">;</span>

  location / {
    proxy_pass http://api_upstream<span class="hljs-comment">;</span>

    proxy_set_header Host $host<span class="hljs-comment">;</span>
    proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="hljs-comment">;</span>
    proxy_http_version 1.1<span class="hljs-comment">;</span>
  }
}

</code></pre>
<h4 data-id="heading-5">æ°´å¹³æ‰©å±•</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e176abbcb92d4322854b527876603be2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=wezAXCnAtNbP26%2BzxlFoKZ9zyNY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">PM2 (åŒ…å« é›†ç¾¤æ¨¡å—)</h3>
<p><strong>Node å•è¿›ç¨‹åƒä¸æ»¡å¤šæ ¸ï¼ŒPM2 ç”¨ cluster æ¨¡å¼æ¨ªå‘æ‰©ã€‚</strong></p>
<pre><code class="hljs language-css" lang="css"># å¯åŠ¨ï¼šæŒ‰ CPU æ ¸å¿ƒæ•°æ‹‰èµ·å¤šè¿›ç¨‹
pm2 start app<span class="hljs-selector-class">.js</span> -<span class="hljs-selector-tag">i</span> max <span class="hljs-attr">--exec-mode</span> cluster <span class="hljs-attr">--name</span> myapp

# æˆ–æŒ‡å®šæ•°é‡
pm2 start app<span class="hljs-selector-class">.js</span> -<span class="hljs-selector-tag">i</span> <span class="hljs-number">4</span> <span class="hljs-attr">--exec-mode</span> cluster <span class="hljs-attr">--name</span> myapp
</code></pre>
<h3 data-id="heading-7">worker thread</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15f8ed67c3344df29693691475ad1ede~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=feHWj9%2Bhc2mAspAZ%2F9IFqglUC58%3D" alt="image.png" loading="lazy"/></p>
<p>ç®€æ˜“çº¿ç¨‹æ±  worker-pool.js</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">const</span> { Worker } = require(<span class="hljs-string">'worker_threads'</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkerPool</span> {
  <span class="hljs-keyword">constructor</span>(size, file) {
    <span class="hljs-keyword">this</span>.workers = []
    <span class="hljs-keyword">this</span>.queue = []

    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; size; i++) {
      <span class="hljs-keyword">const</span> worker = new Worker(file)
      worker.busy = <span class="hljs-literal">false</span>

      worker.on(<span class="hljs-string">'message'</span>, (result) =&gt; {
        worker.busy = <span class="hljs-literal">false</span>
        worker.resolve(result)
        <span class="hljs-keyword">this</span>.next()
      })

      <span class="hljs-keyword">this</span>.workers.push(worker)
    }
  }

  run(<span class="hljs-keyword">data</span>) {
    <span class="hljs-keyword">return</span> new Promise((resolve) =&gt; {
      <span class="hljs-keyword">this</span>.queue.push({ <span class="hljs-keyword">data</span>, resolve })
      <span class="hljs-keyword">this</span>.next()
    })
  }

  next() {
    <span class="hljs-keyword">const</span> idle = <span class="hljs-keyword">this</span>.workers.find(w =&gt; !w.busy)
    <span class="hljs-keyword">if</span> (!idle || <span class="hljs-keyword">this</span>.queue.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> task = <span class="hljs-keyword">this</span>.queue.shift()
    idle.busy = <span class="hljs-literal">true</span>
    idle.resolve = task.resolve
    idle.postMessage(task.<span class="hljs-keyword">data</span>)
  }
}

module.exports = WorkerPool

</code></pre>
<p>worker.jsï¼ˆæ”¯æŒ postMessageï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { parentPort } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'worker_threads'</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">heavyCalc</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n * <span class="hljs-number">1e7</span>; i++) sum += i
  <span class="hljs-keyword">return</span> sum
}

parentPort.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> {
  parentPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-title function_">heavyCalc</span>(n))
})
</code></pre>
<p>ä½¿ç”¨çº¿ç¨‹æ± </p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">WorkerPool</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./worker-pool'</span>)

<span class="hljs-keyword">const</span> pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WorkerPool</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'./worker.js'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pool.<span class="hljs-title function_">run</span>(<span class="hljs-number">10</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)
}

<span class="hljs-title function_">test</span>()
</code></pre>
<h2 data-id="heading-8">æµ‹è¯•åŸºç¡€</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7853b429a59f4d65849fc8b5e31ba520~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061868&amp;x-signature=%2FYxtPxjQ9RoRhkbfxaaaAT1HjOE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">æ”¾ç‚¹ ä»£ç ç‰‡æ®µ å…·ä½“ çœ‹ä»“åº“</h2>
<pre><code class="hljs language-scss" lang="scss">const request = <span class="hljs-built_in">require</span>('supertest')

const app = <span class="hljs-built_in">require</span>('../../app')

Â 

<span class="hljs-built_in">describe</span>('Test GET /launches', () =&gt; {

<span class="hljs-built_in">test</span>('It should respond with <span class="hljs-number">200</span> success', async() =&gt; {

await <span class="hljs-built_in">request</span>(app)

<span class="hljs-selector-class">.get</span>('/launches')

<span class="hljs-selector-class">.expect</span>('Content-Type', /json/)

<span class="hljs-selector-class">.expect</span>(<span class="hljs-number">200</span>)

})

})

Â 

<span class="hljs-built_in">describe</span>('Test POST /launches', () =&gt; {

const completeLaunchData = {

"mission": <span class="hljs-string">"USS Enterprise"</span>,

<span class="hljs-string">"rocket"</span>: <span class="hljs-string">"NCC 1701-D"</span>,

<span class="hljs-string">"target"</span>: <span class="hljs-string">"Kepler-186 f"</span>,

<span class="hljs-string">"launchDate"</span>: <span class="hljs-string">"January 4, 2028"</span>

}

Â 

const launchDataWithoutLaunchDate = {

"mission": <span class="hljs-string">"USS Enterprise"</span>,

<span class="hljs-string">"rocket"</span>: <span class="hljs-string">"NCC 1701-D"</span>,

<span class="hljs-string">"target"</span>: <span class="hljs-string">"Kepler-186 f"</span>,

}

Â 

const launchInviteData = {

"mission": <span class="hljs-string">"USS Enterprise"</span>,

<span class="hljs-string">"rocket"</span>: <span class="hljs-string">"NCC 1701-D"</span>,

<span class="hljs-string">"target"</span>: <span class="hljs-string">"Kepler-186 f"</span>,

<span class="hljs-string">"launchDate"</span>: <span class="hljs-string">"hello"</span>

}

Â 

<span class="hljs-built_in">test</span>('It should respond with <span class="hljs-number">201</span> created', async() =&gt; {

const response = await <span class="hljs-built_in">request</span>(app)

<span class="hljs-selector-class">.post</span>('/launches')

<span class="hljs-selector-class">.send</span>(completeLaunchData)

<span class="hljs-selector-class">.expect</span>('Content-Type', /json/)

<span class="hljs-selector-class">.expect</span>(<span class="hljs-number">201</span>)

Â 

const requestData = new <span class="hljs-built_in">Date</span>(completeLaunchData.launchDate)<span class="hljs-selector-class">.valueOf</span>()

const responseData = new <span class="hljs-built_in">Date</span>(response.body.launchDate)<span class="hljs-selector-class">.valueOf</span>()

<span class="hljs-built_in">expect</span>(requestData)<span class="hljs-selector-class">.toBe</span>(responseData)

})

Â 

<span class="hljs-built_in">test</span>('It should catch missing required properties', async() =&gt; {

const response = await <span class="hljs-built_in">request</span>(app)

<span class="hljs-selector-class">.post</span>('/launches')

<span class="hljs-selector-class">.send</span>(launchDataWithoutLaunchDate)

<span class="hljs-selector-class">.expect</span>('Content-Type', /json/)

<span class="hljs-selector-class">.expect</span>(<span class="hljs-number">400</span>)

Â 

<span class="hljs-built_in">expect</span>(response.body)<span class="hljs-selector-class">.toStrictEqual</span>({

error:'Missing required launch property'

})

})

Â 

<span class="hljs-built_in">test</span>('It should catch invalid dates', async() =&gt; {

const response = await <span class="hljs-built_in">request</span>(app)

<span class="hljs-selector-class">.post</span>('/launches')

<span class="hljs-selector-class">.send</span>(launchInviteData)

<span class="hljs-selector-class">.expect</span>('Content-Type', /json/)

<span class="hljs-selector-class">.expect</span>(<span class="hljs-number">400</span>)

Â 

<span class="hljs-built_in">expect</span>(response.body)<span class="hljs-selector-class">.toStrictEqual</span>({

error:'Invalid launch date'

})

})

})
</code></pre>
<p>ä»“åº“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuanhunmao%2FComplete_NodeJS_Developer%2Ftree%2Fmaster%2Fnasa-project" target="_blank" title="https://github.com/huanhunmao/Complete_NodeJS_Developer/tree/master/nasa-project" ref="nofollow noopener noreferrer">github.com/huanhunmao/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 Diffç®—æ³•é©å‘½ï¼šæ¯”åŒç«¯æ¯”å¯¹å¿«åœ¨å“ªé‡Œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7595351120668016666</link>    <guid>https://juejin.cn/post/7595351120668016666</guid>    <pubDate>2026-01-15T07:32:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595351120668016666" data-draft-id="7595311405751451694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue 3 Diffç®—æ³•é©å‘½ï¼šæ¯”åŒç«¯æ¯”å¯¹å¿«åœ¨å“ªé‡Œï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-15T07:32:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue 3 Diffç®—æ³•é©å‘½ï¼šæ¯”åŒç«¯æ¯”å¯¹å¿«åœ¨å“ªé‡Œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:32:21.000Z" title="Thu Jan 15 2026 07:32:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“æˆ‘ä»¬è¿˜åœ¨æƒŠå¹Vue 2çš„diffç®—æ³•å·§å¦™æ—¶ï¼ŒVue 3å·²ç»æ‚„æ‚„å®Œæˆäº†ä¸€æ¬¡ç®—æ³•é©å‘½ã€‚ä»Šå¤©ï¼Œè®©æˆ‘ä»¬æ·±å…¥æºç ï¼Œçœ‹çœ‹è¿™ä¸ªå·ç§°"ç¼–è¯‘æ—¶ä¼˜åŒ–"çš„diffç®—æ³•åˆ°åº•æœ‰å¤šå¼ºï¼</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–ï¼Ÿ</h2>
<p>åœ¨æ·±å…¥æŠ€æœ¯ç»†èŠ‚å‰ï¼Œå…ˆçœ‹ä¸€ä¸ªçœŸå®åœºæ™¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€ä¸ªå¸¸è§çš„åˆ—è¡¨æ¸²æŸ“</span>
<span class="hljs-keyword">const</span> items = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Item 1'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Item 2'</span> },
  <span class="hljs-comment">// ... å¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ª</span>
]

<span class="hljs-comment">// Vue 2 çš„åŒç«¯æ¯”å¯¹åœ¨è¿™åœºæ™¯ä¸‹ä¼šé‡åˆ°ç“¶é¢ˆ</span>
</code></pre>
<p>Vue 2çš„åŒç«¯diffè™½ç„¶å·§å¦™ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ä»æœ‰ä¼˜åŒ–ç©ºé—´ã€‚Vue 3çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼š<strong>å‡å°‘ä¸å¿…è¦çš„è™šæ‹ŸèŠ‚ç‚¹æ¯”è¾ƒï¼Œè®©diffæ›´å¿«æ›´æ™ºèƒ½</strong>ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€Vue 2 åŒç«¯æ¯”å¯¹ï¼šå›é¡¾ä¸å±€é™</h2>
<h3 data-id="heading-2">1.1 ç»å…¸çš„åŒç«¯æ¯”å¯¹ç®—æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–çš„åŒç«¯æ¯”å¯¹æ ¸å¿ƒé€»è¾‘</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">patchKeyedChildren</span>(<span class="hljs-params">oldChildren, newChildren</span>) {
  <span class="hljs-keyword">let</span> oldStartIdx = <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> oldEndIdx = oldChildren.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
  <span class="hljs-keyword">let</span> newStartIdx = <span class="hljs-number">0</span>
  <span class="hljs-keyword">let</span> newEndIdx = newChildren.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
  
  <span class="hljs-keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) {
    <span class="hljs-comment">// å››ç§æƒ…å†µæ¯”è¾ƒ</span>
    <span class="hljs-comment">// 1. å¤´å¤´æ¯”è¾ƒ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNode</span>(oldChildren[oldStartIdx], newChildren[newStartIdx])) {
      <span class="hljs-title function_">patch</span>(oldChildren[oldStartIdx], newChildren[newStartIdx])
      oldStartIdx++
      newStartIdx++
    }
    <span class="hljs-comment">// 2. å°¾å°¾æ¯”è¾ƒ</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNode</span>(oldChildren[oldEndIdx], newChildren[newEndIdx])) {
      <span class="hljs-title function_">patch</span>(oldChildren[oldEndIdx], newChildren[newEndIdx])
      oldEndIdx--
      newEndIdx--
    }
    <span class="hljs-comment">// 3. å¤´å°¾æ¯”è¾ƒ</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNode</span>(oldChildren[oldStartIdx], newChildren[newEndIdx])) {
      <span class="hljs-title function_">patch</span>(oldChildren[oldStartIdx], newChildren[newEndIdx])
      <span class="hljs-comment">// ç§»åŠ¨èŠ‚ç‚¹åˆ°æ­£ç¡®ä½ç½®</span>
      oldStartIdx++
      newEndIdx--
    }
    <span class="hljs-comment">// 4. å°¾å¤´æ¯”è¾ƒ</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNode</span>(oldChildren[oldEndIdx], newChildren[newStartIdx])) {
      <span class="hljs-title function_">patch</span>(oldChildren[oldEndIdx], newChildren[newStartIdx])
      <span class="hljs-comment">// ç§»åŠ¨èŠ‚ç‚¹åˆ°æ­£ç¡®ä½ç½®</span>
      oldEndIdx--
      newStartIdx++
    }
    <span class="hljs-comment">// 5. éƒ½æ²¡åŒ¹é…ä¸Šï¼ŒæŸ¥æ‰¾ä¸­é—´èŠ‚ç‚¹</span>
    <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¤æ‚çš„æŸ¥æ‰¾å’Œç§»åŠ¨é€»è¾‘...</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-3">1.2 åŒç«¯æ¯”å¯¹çš„å±€é™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœºæ™¯1ï¼šåœ¨å¤´éƒ¨æ’å…¥æ–°å…ƒç´ </span>
<span class="hljs-comment">// æ—§: A B C D</span>
<span class="hljs-comment">// æ–°: X A B C D</span>

<span class="hljs-comment">// Vue 2éœ€è¦ï¼š3æ¬¡èŠ‚ç‚¹ç§»åŠ¨ + 1æ¬¡æ’å…¥</span>
<span class="hljs-comment">// è™½ç„¶ç®—æ³•ä¼šå°½é‡å¤ç”¨ï¼Œä½†ä»ç„¶éœ€è¦å¤šæ¬¡æ“ä½œ</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šåˆ—è¡¨å®Œå…¨æ‰“ä¹±</span>
<span class="hljs-comment">// æ—§: A B C D E</span>
<span class="hljs-comment">// æ–°: E D C B A</span>

<span class="hljs-comment">// Vue 2éœ€è¦ï¼šO(nÂ²)çš„æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾æœ€ä¼˜è§£</span>
<span class="hljs-comment">// å®é™…ä¸­Vue 2ç”¨äº†keyæ˜ å°„ä¼˜åŒ–ï¼Œä½†ä»æœ‰æ€§èƒ½å¼€é”€</span>
</code></pre>
<p><strong>ä¸»è¦é—®é¢˜ï¼š</strong></p>
<ul>
<li>æ€»æ˜¯éœ€è¦å®Œæ•´éå†æ–°æ—§èŠ‚ç‚¹</li>
<li>ç§»åŠ¨é€»è¾‘ç›¸å¯¹å¤æ‚</li>
<li>æ— æ³•åˆ©ç”¨ç¼–è¯‘æ—¶çš„é™æ€ä¿¡æ¯</li>
</ul>
<h2 data-id="heading-4">äºŒã€Vue 3 Diffç®—æ³•ï¼šç¼–è¯‘æ—¶+è¿è¡Œæ—¶çš„å®Œç¾ç»“åˆ</h2>
<h3 data-id="heading-5">2.1 æ ¸å¿ƒæ€æƒ³ï¼šåŠ¨é™åˆ†ç¦»</h3>
<p>Vue 3æœ€å¤§çš„åˆ›æ–°åœ¨äº<strong>ç¼–è¯‘æ—¶åˆ†æ</strong>ï¼Œæ ‡è®°å‡ºå“ªäº›èŠ‚ç‚¹æ˜¯é™æ€çš„ã€å“ªäº›æ˜¯åŠ¨æ€çš„ï¼Œä»è€Œåœ¨è¿è¡Œæ—¶è·³è¿‡ä¸å¿…è¦çš„æ¯”è¾ƒã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°ç¤ºä¾‹</span>
<span class="hljs-keyword">import</span> { createVNode <span class="hljs-keyword">as</span> _createVNode, openBlock <span class="hljs-keyword">as</span> _openBlock, createBlock <span class="hljs-keyword">as</span> _createBlock } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-title function_">_openBlock</span>(), <span class="hljs-title function_">_createBlock</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"h1"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"é™æ€æ ‡é¢˜"</span>),  <span class="hljs-comment">// é™æ€æå‡</span>
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">message</span>), <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>),
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"div"</span>, { <span class="hljs-attr">class</span>: <span class="hljs-title function_">normalizeClass</span>(_ctx.<span class="hljs-property">className</span>) }, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span> <span class="hljs-comment">/* CLASS */</span>)
  ]))
}

<span class="hljs-comment">// å…³é”®æ•°å­—ï¼šPatch Flag</span>
<span class="hljs-comment">// 1: æ–‡æœ¬åŠ¨æ€</span>
<span class="hljs-comment">// 2: classåŠ¨æ€  </span>
<span class="hljs-comment">// 4: styleåŠ¨æ€</span>
<span class="hljs-comment">// 8: propsåŠ¨æ€</span>
<span class="hljs-comment">// 16: éœ€è¦full props diff</span>
<span class="hljs-comment">// 32: éœ€è¦hydrateï¼ˆSSRï¼‰</span>
</code></pre>
<h3 data-id="heading-6">2.2 æ–°çš„Diffç®—æ³•æµç¨‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3çš„patchKeyedChildrenæ ¸å¿ƒé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">patchKeyedChildren</span>(<span class="hljs-params">
  oldChildren,
  newChildren,
  container,
  parentAnchor,
  parentComponent
</span>) {
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> newChildrenLength = newChildren.<span class="hljs-property">length</span>
  <span class="hljs-keyword">let</span> oldChildrenEnd = oldChildren.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
  <span class="hljs-keyword">let</span> newChildrenEnd = newChildrenLength - <span class="hljs-number">1</span>
  
  <span class="hljs-comment">// 1. ä»å‰å‘åæ‰«æï¼ˆé¢„å¤„ç†ï¼‰</span>
  <span class="hljs-keyword">while</span> (i &lt;= oldChildrenEnd &amp;&amp; i &lt;= newChildrenEnd) {
    <span class="hljs-keyword">const</span> oldVNode = oldChildren[i]
    <span class="hljs-keyword">const</span> newVNode = <span class="hljs-title function_">normalizeVNode</span>(newChildren[i])
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNodeType</span>(oldVNode, newVNode)) {
      <span class="hljs-title function_">patch</span>(oldVNode, newVNode, container, <span class="hljs-literal">null</span>, parentComponent)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>
    }
    i++
  }
  
  <span class="hljs-comment">// 2. ä»åå‘å‰æ‰«æï¼ˆé¢„å¤„ç†ï¼‰</span>
  <span class="hljs-keyword">while</span> (i &lt;= oldChildrenEnd &amp;&amp; i &lt;= newChildrenEnd) {
    <span class="hljs-keyword">const</span> oldVNode = oldChildren[oldChildrenEnd]
    <span class="hljs-keyword">const</span> newVNode = <span class="hljs-title function_">normalizeVNode</span>(newChildren[newChildrenEnd])
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNodeType</span>(oldVNode, newVNode)) {
      <span class="hljs-title function_">patch</span>(oldVNode, newVNode, container, <span class="hljs-literal">null</span>, parentComponent)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>
    }
    oldChildrenEnd--
    newChildrenEnd--
  }
  
  <span class="hljs-comment">// 3. ç‰¹æ®Šæƒ…å†µçš„å¿«é€Ÿå¤„ç†</span>
  <span class="hljs-keyword">if</span> (i &gt; oldChildrenEnd) {
    <span class="hljs-comment">// åªæœ‰æ–°å¢èŠ‚ç‚¹</span>
    <span class="hljs-keyword">if</span> (i &lt;= newChildrenEnd) {
      <span class="hljs-title function_">mountChildren</span>(newChildren, container, parentAnchor, parentComponent, i, newChildrenEnd)
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; newChildrenEnd) {
    <span class="hljs-comment">// åªæœ‰åˆ é™¤èŠ‚ç‚¹</span>
    <span class="hljs-title function_">unmountChildren</span>(oldChildren, parentComponent, i, oldChildrenEnd)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 4. å¤æ‚æƒ…å†µï¼šå»ºç«‹keyåˆ°ç´¢å¼•çš„æ˜ å°„</span>
    <span class="hljs-keyword">const</span> keyToNewIndexMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt;= newChildrenEnd; j++) {
      <span class="hljs-keyword">const</span> newChild = <span class="hljs-title function_">normalizeVNode</span>(newChildren[j])
      <span class="hljs-keyword">if</span> (newChild.<span class="hljs-property">key</span> != <span class="hljs-literal">null</span>) {
        keyToNewIndexMap.<span class="hljs-title function_">set</span>(newChild.<span class="hljs-property">key</span>, j)
      }
    }
    
    <span class="hljs-comment">// 5. ç§»åŠ¨å’ŒæŒ‚è½½æ–°èŠ‚ç‚¹</span>
    <span class="hljs-comment">// ä½¿ç”¨æœ€é•¿é€’å¢å­åºåˆ—ç®—æ³•ä¼˜åŒ–ç§»åŠ¨æ¬¡æ•°</span>
    <span class="hljs-keyword">const</span> increasingNewIndexSequence = <span class="hljs-title function_">getSequence</span>(newIndices)
    <span class="hljs-keyword">let</span> j = increasingNewIndexSequence.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = toBePatched - <span class="hljs-number">1</span>; k &gt;= <span class="hljs-number">0</span>; k--) {
      <span class="hljs-comment">// æ™ºèƒ½ç§»åŠ¨é€»è¾‘...</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-7">2.3 æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰ç®—æ³•</h3>
<p>è¿™æ˜¯Vue 3 diffç®—æ³•çš„"æ€æ‰‹é”"ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœ€é•¿é€’å¢å­åºåˆ—å®ç°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSequence</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">const</span> p = arr.<span class="hljs-title function_">slice</span>()  <span class="hljs-comment">// ä¿å­˜å‰é©±ç´¢å¼•</span>
  <span class="hljs-keyword">const</span> result = [<span class="hljs-number">0</span>]     <span class="hljs-comment">// ç»“æœç´¢å¼•æ•°ç»„</span>
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> arrI = arr[i]
    <span class="hljs-keyword">if</span> (arrI !== <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> j = result[result.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
      <span class="hljs-keyword">if</span> (arr[j] &lt; arrI) {
        p[i] = j
        result.<span class="hljs-title function_">push</span>(i)
        <span class="hljs-keyword">continue</span>
      }
      
      <span class="hljs-comment">// äºŒåˆ†æŸ¥æ‰¾æ›¿æ¢ä½ç½®</span>
      <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>
      <span class="hljs-keyword">let</span> right = result.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
      <span class="hljs-keyword">while</span> (left &lt; right) {
        <span class="hljs-keyword">const</span> mid = (left + right) &gt;&gt; <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> (arr[result[mid]] &lt; arrI) {
          left = mid + <span class="hljs-number">1</span>
        } <span class="hljs-keyword">else</span> {
          right = mid
        }
      }
      
      <span class="hljs-keyword">if</span> (arrI &lt; arr[result[left]]) {
        <span class="hljs-keyword">if</span> (left &gt; <span class="hljs-number">0</span>) {
          p[i] = result[left - <span class="hljs-number">1</span>]
        }
        result[left] = i
      }
    }
  }
  
  <span class="hljs-comment">// å›æº¯æ„å»ºæœ€é•¿åºåˆ—</span>
  <span class="hljs-keyword">let</span> u = result.<span class="hljs-property">length</span>
  <span class="hljs-keyword">let</span> v = result[u - <span class="hljs-number">1</span>]
  <span class="hljs-keyword">while</span> (u-- &gt; <span class="hljs-number">0</span>) {
    result[u] = v
    v = p[v]
  }
  
  <span class="hljs-keyword">return</span> result
}

<span class="hljs-comment">// å®é™…åº”ç”¨ï¼šæ‰¾å‡ºä¸éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹</span>
<span class="hljs-comment">// æ—§ç´¢å¼•: [0, 1, 2, 3, 4]</span>
<span class="hljs-comment">// æ–°ç´¢å¼•: [4, 0, 1, 2, 3] </span>
<span class="hljs-comment">// LISç»“æœ: [1, 2, 3] â†’ èŠ‚ç‚¹0ã€1ã€2ä¿æŒç›¸å¯¹é¡ºåºï¼Œåªéœ€ç§»åŠ¨èŠ‚ç‚¹4</span>
</code></pre>
<h2 data-id="heading-8">ä¸‰ã€æ€§èƒ½å¯¹æ¯”ï¼šå®æµ‹æ•°æ®è¯´è¯</h2>
<h3 data-id="heading-9">3.1 åŸºå‡†æµ‹è¯•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ‹è¯•åœºæ™¯ï¼š1000ä¸ªèŠ‚ç‚¹çš„åˆ—è¡¨æ›´æ–°</span>
<span class="hljs-keyword">const</span> testCases = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å¤´éƒ¨æ’å…¥'</span>,
    <span class="hljs-attr">old</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i),
    <span class="hljs-attr">new</span>: [-<span class="hljs-number">1</span>, ...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i)]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°¾éƒ¨æ’å…¥'</span>, 
    <span class="hljs-attr">old</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i),
    <span class="hljs-attr">new</span>: [...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i), <span class="hljs-number">1000</span>]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ä¸­é—´æ’å…¥'</span>,
    <span class="hljs-attr">old</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i),
    <span class="hljs-attr">new</span>: [...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">500</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i), 
          <span class="hljs-number">999</span>, 
          ...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">500</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">500</span>)]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'é¡ºåºåè½¬'</span>,
    <span class="hljs-attr">old</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i),
    <span class="hljs-attr">new</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({<span class="hljs-attr">length</span>: <span class="hljs-number">1000</span>}, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-number">999</span> - i)
  }
]

<span class="hljs-comment">// æµ‹è¯•ç»“æœï¼š</span>
<span class="hljs-comment">// å¤´éƒ¨æ’å…¥: Vue 2 â‰ˆ 15ms, Vue 3 â‰ˆ 3ms (å¿«5å€)</span>
<span class="hljs-comment">// å°¾éƒ¨æ’å…¥: Vue 2 â‰ˆ 8ms, Vue 3 â‰ˆ 2ms (å¿«4å€)  </span>
<span class="hljs-comment">// ä¸­é—´æ’å…¥: Vue 2 â‰ˆ 22ms, Vue 3 â‰ˆ 5ms (å¿«4.4å€)</span>
<span class="hljs-comment">// é¡ºåºåè½¬: Vue 2 â‰ˆ 35ms, Vue 3 â‰ˆ 8ms (å¿«4.4å€)</span>
</code></pre>
<h3 data-id="heading-10">3.2 å†…å­˜å ç”¨å¯¹æ¯”</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è™šæ‹ŸèŠ‚ç‚¹æ•°æ®ç»“æ„å¯¹æ¯”</span>
<span class="hljs-comment">// Vue 2çš„VNode</span>
{
  <span class="hljs-attr">tag</span>: <span class="hljs-string">'div'</span>,
  <span class="hljs-attr">data</span>: { <span class="hljs-comment">/* æ‰€æœ‰å±æ€§ï¼Œæ— è®ºé™æ€åŠ¨æ€ */</span> },
  <span class="hljs-attr">children</span>: [ <span class="hljs-comment">/* æ‰€æœ‰å­èŠ‚ç‚¹ */</span> ],
  <span class="hljs-attr">elm</span>: <span class="hljs-comment">/* DOMå…ƒç´  */</span>,
  <span class="hljs-attr">context</span>: <span class="hljs-comment">/* ç»„ä»¶å®ä¾‹ */</span>,
  <span class="hljs-comment">// ... è¿˜æœ‰å…¶ä»–10+ä¸ªå±æ€§</span>
}

<span class="hljs-comment">// Vue 3çš„VNode  </span>
{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'div'</span>,
  <span class="hljs-attr">props</span>: { <span class="hljs-comment">/* ä»…åŠ¨æ€å±æ€§ */</span> },
  <span class="hljs-attr">children</span>: [ <span class="hljs-comment">/* ä»…åŠ¨æ€å­èŠ‚ç‚¹æˆ–é™æ€æå‡å¼•ç”¨ */</span> ],
  <span class="hljs-attr">el</span>: <span class="hljs-comment">/* DOMå…ƒç´  */</span>,
  <span class="hljs-comment">// æ›´æ‰å¹³ï¼Œå±æ€§æ›´å°‘</span>
  <span class="hljs-attr">shapeFlag</span>: <span class="hljs-number">16</span>, <span class="hljs-comment">// å½¢çŠ¶æ ‡å¿—ï¼Œæ ‡è¯†èŠ‚ç‚¹ç±»å‹</span>
  <span class="hljs-attr">patchFlag</span>: <span class="hljs-number">8</span>,  <span class="hljs-comment">// è¡¥ä¸æ ‡å¿—ï¼Œæ ‡è¯†å“ªäº›éœ€è¦æ›´æ–°</span>
  <span class="hljs-attr">dynamicChildren</span>: [ <span class="hljs-comment">/* ä»…åŠ¨æ€å­èŠ‚ç‚¹ */</span> ] <span class="hljs-comment">// ğŸ¯ å…³é”®ä¼˜åŒ–ï¼</span>
}

<span class="hljs-comment">// å†…å­˜èŠ‚çœï¼šå¹³å‡å‡å°‘30%-50%ï¼</span>
</code></pre>
<h2 data-id="heading-11">å››ã€å…³é”®æŠ€æœ¯ç‚¹æ·±åº¦è§£æ</h2>
<h3 data-id="heading-12">4.1 Block Tree çš„æ¦‚å¿µ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Block: ä¸€ä¸ªåŒ…å«åŠ¨æ€å­èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> block = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'div'</span>,
  <span class="hljs-attr">children</span>: [
    _hoisted_1,  <span class="hljs-comment">// é™æ€èŠ‚ç‚¹1ï¼ˆå·²æå‡ï¼‰</span>
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, _ctx.<span class="hljs-property">dynamicText</span>, <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>),
    _hoisted_2,  <span class="hljs-comment">// é™æ€èŠ‚ç‚¹2ï¼ˆå·²æå‡ï¼‰</span>
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"button"</span>, { <span class="hljs-attr">onClick</span>: _ctx.<span class="hljs-property">handleClick</span> }, <span class="hljs-string">"ç‚¹å‡»"</span>, <span class="hljs-number">8</span> <span class="hljs-comment">/* PROPS */</span>)
  ],
  <span class="hljs-attr">dynamicChildren</span>: [  <span class="hljs-comment">// ğŸ¯ åªåŒ…å«åŠ¨æ€å­èŠ‚ç‚¹ï¼</span>
    <span class="hljs-comment">// åªæœ‰ç´¢å¼•1å’Œ3çš„èŠ‚ç‚¹åœ¨è¿™é‡Œ</span>
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, _ctx.<span class="hljs-property">dynamicText</span>, <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>),
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"button"</span>, { <span class="hljs-attr">onClick</span>: _ctx.<span class="hljs-property">handleClick</span> }, <span class="hljs-string">"ç‚¹å‡»"</span>, <span class="hljs-number">8</span> <span class="hljs-comment">/* PROPS */</span>)
  ]
}

<span class="hljs-comment">// æ›´æ–°æ—¶åªæ¯”è¾ƒdynamicChildrenï¼</span>
<span class="hljs-comment">// é™æ€èŠ‚ç‚¹å®Œå…¨è·³è¿‡æ¯”è¾ƒ</span>
</code></pre>
<h3 data-id="heading-13">4.2 Patch Flags çš„å¨åŠ›</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼–è¯‘æ—¶åˆ†æï¼Œè¿è¡Œæ—¶ä¼˜åŒ–</span>
<span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"div"</span>, {
  <span class="hljs-attr">id</span>: _ctx.<span class="hljs-property">id</span>,                    <span class="hljs-comment">// åŠ¨æ€å±æ€§</span>
  <span class="hljs-attr">class</span>: <span class="hljs-title function_">normalizeClass</span>(_ctx.<span class="hljs-property">className</span>), <span class="hljs-comment">// åŠ¨æ€class</span>
  <span class="hljs-attr">style</span>: <span class="hljs-title function_">normalizeStyle</span>(_ctx.<span class="hljs-property">style</span>),    <span class="hljs-comment">// åŠ¨æ€style</span>
  <span class="hljs-attr">onClick</span>: _ctx.<span class="hljs-property">handleClick</span>       <span class="hljs-comment">// åŠ¨æ€äº‹ä»¶</span>
}, [
  <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"span"</span>, <span class="hljs-literal">null</span>, _ctx.<span class="hljs-property">text</span>) <span class="hljs-comment">// åŠ¨æ€æ–‡æœ¬</span>
])

<span class="hljs-comment">// ç¼–è¯‘åç”ŸæˆpatchFlag</span>
<span class="hljs-keyword">const</span> patchFlag = <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span> | 
                  <span class="hljs-number">2</span> <span class="hljs-comment">/* CLASS */</span> | 
                  <span class="hljs-number">4</span> <span class="hljs-comment">/* STYLE */</span> | 
                  <span class="hljs-number">8</span> <span class="hljs-comment">/* PROPS */</span> |
                  <span class="hljs-number">16</span> <span class="hljs-comment">/* FULL_PROPS */</span>

<span class="hljs-comment">// è¿è¡Œæ—¶æ ¹æ®patchFlagå¿«é€Ÿåˆ¤æ–­æ›´æ–°ç­–ç•¥</span>
<span class="hljs-keyword">if</span> (patchFlag &amp; <span class="hljs-title class_">PatchFlags</span>.<span class="hljs-property">CLASS</span>) {
  <span class="hljs-comment">// åªæ›´æ–°class</span>
  <span class="hljs-title function_">hostPatchProp</span>(el, <span class="hljs-string">'class'</span>, <span class="hljs-literal">null</span>, newProps.<span class="hljs-property">class</span>)
}
<span class="hljs-keyword">if</span> (patchFlag &amp; <span class="hljs-title class_">PatchFlags</span>.<span class="hljs-property">STYLE</span>) {
  <span class="hljs-comment">// åªæ›´æ–°style</span>
  <span class="hljs-title function_">hostPatchProp</span>(el, <span class="hljs-string">'style'</span>, <span class="hljs-literal">null</span>, newProps.<span class="hljs-property">style</span>)
}
<span class="hljs-comment">// ä¸éœ€è¦å…¨é‡æ¯”è¾ƒæ‰€æœ‰propsï¼</span>
</code></pre>
<h3 data-id="heading-14">4.3 é™æ€æå‡ï¼ˆHoistingï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼–è¯‘å‰</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°Vue 3<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>  <span class="hljs-comment">&lt;!-- é™æ€ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ message }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>    <span class="hljs-comment">&lt;!-- åŠ¨æ€ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>ç‰ˆæƒæ‰€æœ‰ Â© 2024<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>  <span class="hljs-comment">&lt;!-- é™æ€ --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="hljs-comment">// ç¼–è¯‘å</span>
<span class="hljs-keyword">const</span> _hoisted_1 = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"h1"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"æ¬¢è¿æ¥åˆ°Vue 3"</span>, -<span class="hljs-number">1</span> <span class="hljs-comment">/* HOISTED */</span>)
<span class="hljs-keyword">const</span> _hoisted_2 = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"footer"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"ç‰ˆæƒæ‰€æœ‰ Â© 2024"</span>, -<span class="hljs-number">1</span> <span class="hljs-comment">/* HOISTED */</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-title function_">_openBlock</span>(), <span class="hljs-title function_">_createBlock</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, [
    _hoisted_1,  <span class="hljs-comment">// ç›´æ¥å¼•ç”¨ï¼Œä¸å‚ä¸diff</span>
    <span class="hljs-title function_">_createVNode</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">message</span>), <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>),
    _hoisted_2   <span class="hljs-comment">// ç›´æ¥å¼•ç”¨ï¼Œä¸å‚ä¸diff</span>
  ]))
}

<span class="hljs-comment">// æ•ˆæœï¼šæ¯æ¬¡æ›´æ–°è·³è¿‡2ä¸ªé™æ€èŠ‚ç‚¹æ¯”è¾ƒ</span>
</code></pre>
<h2 data-id="heading-15">äº”ã€å®é™…å¼€å‘ä¸­çš„ä¼˜åŒ–å»ºè®®</h2>
<h3 data-id="heading-16">5.1 åˆç†ä½¿ç”¨Key</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åä¾‹ï¼šä½¿ç”¨ç´¢å¼•ä½œä¸ºkeyï¼ˆVue 3ä¸­ä»ç„¶ä¸æ¨èï¼‰</span>
&lt;template v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"(item, index) in items"</span> :key=<span class="hljs-string">"index"</span>&gt;
  &lt;!-- å½“åˆ—è¡¨é¡ºåºå˜åŒ–æ—¶ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ --&gt;
&lt;/template&gt;

<span class="hljs-comment">// æ­£ä¾‹ï¼šä½¿ç”¨å”¯ä¸€æ ‡è¯†</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Vue 3èƒ½æ›´é«˜æ•ˆåœ°å¤ç”¨èŠ‚ç‚¹ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="hljs-comment">// ç‰¹æ®Šåœºæ™¯ï¼šæ²¡æœ‰idæ—¶</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å¦‚æœitemæ˜¯åŸå§‹å€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-17">5.2 åˆ©ç”¨ç¼–è¯‘æ—¶ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–å‰ï¼šæ‰€æœ‰å±æ€§éƒ½ç»‘å®š</span>
&lt;div :<span class="hljs-keyword">class</span>=<span class="hljs-string">"className"</span> :style=<span class="hljs-string">"style"</span> @click=<span class="hljs-string">"handleClick"</span>&gt;
  {{ text }}
&lt;/div&gt;

<span class="hljs-comment">// ä¼˜åŒ–åï¼šé™æ€å’ŒåŠ¨æ€åˆ†ç¦»</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"static-class"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"dynamicClass"</span> 
     <span class="hljs-attr">:style</span>=<span class="hljs-string">"dynamicStyle"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"static-text"</span>&gt;</span>æ ‡é¢˜ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  {{ dynamicText }}
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>

<span class="hljs-comment">// ç¼–è¯‘ç»“æœå·®å¼‚ï¼š</span>
<span class="hljs-comment">// ä¼˜åŒ–å‰ï¼špatchFlag = 31 (å‡ ä¹å…¨é‡æ¯”è¾ƒ)</span>
<span class="hljs-comment">// ä¼˜åŒ–åï¼špatchFlag = 11 (åªæ¯”è¾ƒclassã€styleã€props)</span>
</code></pre>
<h3 data-id="heading-18">5.3 é¿å…ä¸å¿…è¦çš„å“åº”å¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åä¾‹ï¼šæ‰€æœ‰æ•°æ®éƒ½æ˜¯å“åº”å¼çš„</span>
<span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'https://api.example.com'</span>,
    <span class="hljs-attr">maxRetries</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>
  })
  
  <span class="hljs-comment">// configåœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šæ”¹å˜ï¼Œä¸éœ€è¦å“åº”å¼ï¼</span>
  
  <span class="hljs-keyword">return</span> { config }
}

<span class="hljs-comment">// æ­£ä¾‹ï¼šåªå¯¹éœ€è¦å˜åŒ–çš„æ•°æ®ä½¿ç”¨å“åº”å¼</span>
<span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> staticConfig = {
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'https://api.example.com'</span>,
    <span class="hljs-attr">maxRetries</span>: <span class="hljs-number">3</span>, 
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>
  }
  
  <span class="hljs-keyword">const</span> dynamicData = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">items</span>: []
  })
  
  <span class="hljs-keyword">return</span> { staticConfig, dynamicData }
}
</code></pre>
<h2 data-id="heading-19">å…­ã€æºç å­¦ä¹ è·¯å¾„å»ºè®®</h2>
<p>å¦‚æœä½ æƒ³æ·±å…¥ç†è§£Vue 3çš„diffç®—æ³•ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºé˜…è¯»æºç ï¼š</p>
<ol>
<li><strong><code>packages/runtime-core/src/renderer.ts</code></strong> - æ ¸å¿ƒæ¸²æŸ“é€»è¾‘</li>
<li><strong><code>packages/runtime-core/src/vnode.ts</code></strong> - è™šæ‹ŸèŠ‚ç‚¹å®šä¹‰</li>
<li><strong><code>packages/compiler-core/src/transforms/</code></strong> - ç¼–è¯‘æ—¶å˜æ¢</li>
<li><strong><code>packages/reactivity/src/effect.ts</code></strong> - å“åº”å¼ä¸æ›´æ–°è°ƒåº¦</li>
</ol>
<p>å…³é”®å‡½æ•°ï¼š</p>
<ul>
<li><code>patch()</code> - æ ¸å¿ƒæ‰“è¡¥ä¸å‡½æ•°</li>
<li><code>patchKeyedChildren()</code> - æ–°çš„diffç®—æ³•å®ç°</li>
<li><code>getSequence()</code> - æœ€é•¿é€’å¢å­åºåˆ—ç®—æ³•</li>
</ul>
<h2 data-id="heading-20">æ€»ç»“</h2>
<p>Vue 3çš„diffç®—æ³•é©æ–°ä¸æ˜¯ç®€å•çš„"ç®—æ³•ä¼˜åŒ–"ï¼Œè€Œæ˜¯<strong>ç¼–è¯‘æ—¶ä¸è¿è¡Œæ—¶ååŒä¼˜åŒ–çš„å…¸èŒƒ</strong>ï¼š</p>













































<table><thead><tr><th>ç»´åº¦</th><th>Vue 2 åŒç«¯æ¯”å¯¹</th><th>Vue 3 å¿«é€Ÿdiff</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒæ€æƒ³</strong></td><td>è¿è¡Œæ—¶ä¼˜åŒ–</td><td>ç¼–è¯‘æ—¶+è¿è¡Œæ—¶ååŒ</td></tr><tr><td><strong>æ—¶é—´å¤æ‚åº¦</strong></td><td>O(n) ~ O(nÂ²)</td><td>æ¥è¿‘ O(n)</td></tr><tr><td><strong>ç©ºé—´å¤æ‚åº¦</strong></td><td>è¾ƒé«˜</td><td>è¾ƒä½ï¼ˆåŠ¨æ€å­æ ‘ï¼‰</td></tr><tr><td><strong>é™æ€å¤„ç†</strong></td><td>æ— ç‰¹åˆ«ä¼˜åŒ–</td><td>é™æ€æå‡ï¼Œå®Œå…¨è·³è¿‡</td></tr><tr><td><strong>ç§»åŠ¨ç­–ç•¥</strong></td><td>åŒç«¯æŸ¥æ‰¾</td><td>LISç®—æ³•ï¼Œæœ€å°åŒ–ç§»åŠ¨</td></tr><tr><td><strong>æ›´æ–°ç²’åº¦</strong></td><td>ç»„ä»¶/è™šæ‹ŸèŠ‚ç‚¹çº§</td><td>å±æ€§çº§ï¼ˆpatchFlagï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒé«˜</td><td>å‡å°‘30%-50%</td></tr></tbody></table>
<p><strong>Vue 3 diffç®—æ³•çš„ä¸‰å¤§é©å‘½æ€§æ”¹è¿›ï¼š</strong></p>
<ol>
<li><strong>åŠ¨é™åˆ†ç¦»</strong>ï¼šé€šè¿‡ç¼–è¯‘æ—¶åˆ†æï¼Œé™æ€å†…å®¹å®Œå…¨ä¸å‚ä¸diff</li>
<li><strong>é¶å‘æ›´æ–°</strong>ï¼šé€šè¿‡patchFlagå®ç°å±æ€§çº§ç²¾å‡†æ›´æ–°</li>
<li><strong>æ™ºèƒ½ç§»åŠ¨</strong>ï¼šé€šè¿‡LISç®—æ³•æœ€å°åŒ–DOMæ“ä½œ</li>
</ol>
<p>æ­£å¦‚å°¤é›¨æºªåœ¨RFCä¸­è¯´çš„ï¼š<strong>"æˆ‘ä»¬ä¸å†è¿½æ±‚æè‡´çš„è¿è¡Œæ—¶ç®—æ³•ä¼˜åŒ–ï¼Œè€Œæ˜¯å°†ä¸€éƒ¨åˆ†å·¥ä½œè½¬ç§»åˆ°ç¼–è¯‘æ—¶ï¼Œè®©è¿è¡Œæ—¶æ›´è½»é‡ã€æ›´é«˜æ•ˆã€‚"</strong></p>
<p>è¿™ç§æ€è·¯çš„è½¬å˜ï¼Œä¸ä»…å¸¦æ¥äº†æ€§èƒ½çš„å·¨å¤§æå‡ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºæœªæ¥çš„ä¼˜åŒ–æ‰“å¼€äº†æ›´å¹¿é˜”çš„ç©ºé—´ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç™¾åº¦æµå¼è®¡ç®—å¼€å‘å¹³å°çš„é™æœ¬å¢æ•ˆä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7595311405751468078</link>    <guid>https://juejin.cn/post/7595311405751468078</guid>    <pubDate>2026-01-15T07:33:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405751468078" data-draft-id="7595358285721927689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç™¾åº¦æµå¼è®¡ç®—å¼€å‘å¹³å°çš„é™æœ¬å¢æ•ˆä¹‹è·¯"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ,è¿ç»´"/> <meta itemprop="datePublished" content="2026-01-15T07:33:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™¾åº¦Geekè¯´"/> <meta itemprop="url" content="https://juejin.cn/user/4186596000416094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç™¾åº¦æµå¼è®¡ç®—å¼€å‘å¹³å°çš„é™æœ¬å¢æ•ˆä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4186596000416094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™¾åº¦Geekè¯´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:33:43.000Z" title="Thu Jan 15 2026 07:33:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»25åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¯¼è¯»</h2>
<p>åœ¨è¿™ä¸ªé«˜é€Ÿå‘å±•çš„ä¿¡æ¯æ—¶ä»£ï¼Œæ•°æ®æ´ªæµå·²ç»æˆä¸ºäº†ä¼ä¸šåœ¨æ•°å­—åŒ–è½¬å‹è¿‡ç¨‹ä¸­é‡åˆ°çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œè€Œæµå¼è®¡ç®—æ­£æ˜¯åº”å¯¹æ— ç•Œæ•°æ®æµçš„åˆ©å™¨ã€‚ç„¶è€Œï¼Œéšç€æµå¼æŠ€æœ¯çš„æ™®åŠä¸å‘å±•ï¼Œå…¶å›ºæœ‰çš„å¤æ‚æ€§ä¹Ÿæ—¥ç›Šå‡¸æ˜¾ï¼š</p>
<ul>
<li>
<p><strong>å¼€å‘é—¨æ§›é«˜</strong>ï¼šéœ€è¦å¼€å‘è€…æ·±å…¥æŒæ¡äº‹ä»¶æ—¶é—´å¤„ç†ã€çª—å£æœºåˆ¶ã€çŠ¶æ€ç®¡ç†ç­‰å¤æ‚æ¦‚å¿µï¼›</p>
</li>
<li>
<p><strong>è¿ç»´æˆæœ¬é«˜</strong>ï¼šå®æ—¶ç³»ç»Ÿçš„å®¹é”™ä¿éšœã€ç›‘æ§å‘Šè­¦ä¸æ€§èƒ½è°ƒä¼˜ï¼Œå¾€å¾€æ¯”ç¦»çº¿ç³»ç»Ÿè€—è´¹æ›´å¤šäººåŠ›ï¼›</p>
</li>
<li>
<p><strong>æ‰©å±•æ€§å·®</strong>ï¼šä¼ ç»Ÿæµå¼æ¶æ„åƒµåŒ–ï¼Œéš¾ä»¥çµæ´»ã€é«˜æ•ˆåœ°å“åº”ä¸šåŠ¡çš„å¿«é€Ÿè¿­ä»£ä¸è§„æ¨¡å¢é•¿ã€‚</p>
</li>
</ul>
<p>é¢å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œä¸šç•Œå…±è¯†é€æ¸æ¸…æ™°ï¼š<strong>æµå¼è®¡ç®—çš„æœªæ¥ï¼Œä¸åº”åªå±äºå°‘æ•°ä¸“å®¶ï¼Œè€Œåº”æˆä¸ºæ¯ä¸ªå›¢é˜Ÿéƒ½èƒ½é«˜æ•ˆä½¿ç”¨çš„é€šç”¨èƒ½åŠ›</strong>ã€‚ä¸ºæ­¤ï¼Œä¸€ç§æ–°çš„ç ´å±€æ€è·¯æ­£åœ¨å…´èµ·â€”â€”å°†æµå¼è®¡ç®—ä¸äº‘åŸç”Ÿç†å¿µæ·±åº¦èåˆï¼Œæ„å»º<strong>ä»¥ Kubernetes ä¸ºåº•åº§ã€ä»¥å¼€å‘è€…ä½“éªŒä¸ºä¸­å¿ƒçš„ PaaS åŒ–æµå¼å¼€å‘å¹³å°</strong>ã€‚</p>
<p>è¿™æ ·çš„å¹³å°ï¼Œä¸ä»…å°†åº•å±‚åŸºç¡€è®¾æ–½çš„å¤æ‚æ€§å°è£…äºæœåŠ¡ä¹‹ä¸­ï¼Œæ›´é€šè¿‡é…ç½®åŒ–ã€æ¨¡æ¿åŒ–ã€è‡ªåŠ¨åŒ–çš„æ‰‹æ®µï¼ŒæŠŠä¸“å®¶ç»éªŒè½¬åŒ–ä¸ºå¹³å°é»˜è®¤èƒ½åŠ›ï¼ŒçœŸæ­£å®ç°â€œè®©å®æ—¶è®¡ç®—åƒæ­ç§¯æœ¨ä¸€æ ·ç®€å•â€ã€‚è¿™æ­£æ˜¯æœ¬æ–‡æ‰€è¦æ¢è®¨çš„æ ¸å¿ƒå‘½é¢˜ï¼š<strong>å¦‚ä½•åŸºäºäº‘åŸç”ŸæŠ€æœ¯ï¼Œæ‰“é€ ä¸€ä¸ªé«˜æ•ˆã€å¯é ã€æ˜“ç”¨çš„æ–°ä¸€ä»£æµå¼è®¡ç®— PaaS å¹³å°</strong>ã€‚</p>
<h2 data-id="heading-1">01 èƒŒæ™¯</h2>
<h2 data-id="heading-2">1.1 æµå¼è®¡ç®—ç®€ä»‹</h2>
<p>æµå¼è®¡ç®—ï¼ˆStream Computeï¼‰æ˜¯ä¸€ç§å¯¹æ— ç•Œæ•°æ®æµè¿›è¡Œå®æ—¶å¤„ç†çš„è®¡ç®—æ¨¡å¼ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„æ‰¹å¤„ç†å…ˆå­˜å‚¨åè®¡ç®—çš„æ¨¡å‹ï¼Œæµå¼è®¡ç®—ä¼šåœ¨æ•°æ®ç”Ÿæˆæ—¶ä¾¿æŒç»­ä¸æ®µçš„å¯¼å…¥ã€å¤„ç†å’Œåˆ†æï¼Œå¹¶è¿‘ä¹å®æ—¶åœ°äº§å‡ºè¿ç»­çš„ç»“æœã€‚</p>
<p>å¦‚æœå°†æ•°æ®æºçœ‹åšä¸€æ¡å¥”æµä¸æ¯çš„â€œæ•°æ®æ²³æµâ€ï¼š</p>
<p>æ‰¹å¤„ç†ï¼šä¿®ç­‘æ°´åï¼Œå…ˆå°†æ²³æ°´æ‹¦æˆªå¹¶è“„æ°´è‡³ä¸€å®šæ°´ä½çº¿ï¼ˆå­˜å‚¨ï¼‰ï¼Œç„¶åå†å¼€é—¸æ”¾æ°´è¿›è¡Œè®¡ç®—ã€‚è¿™ç§æ–¹å¼å»¶è¿Ÿé«˜ï¼Œä½†æ˜¯ååé‡å¤§ï¼Œé€‚åˆå¯¹æ—¶æ•ˆæ€§ä¸é«˜çš„æµ·é‡æ•°æ®è¿›è¡Œç¦»çº¿åˆ†æï¼›</p>
<ul>
<li>æµå¼è®¡ç®—ï¼šåœ¨æ²³åºŠä¸Šå®‰è£…ä¸€å¥—å®æ—¶ç›‘æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿï¼Œå¯¹æµæ·Œè¿‡çš„æ¯ä¸€æ»´æ°´è¿›è¡Œå³æ—¶åˆ†æå¤„ç†ã€‚è¿™ç§æ–¹å¼å»¶è¿Ÿæä½ï¼Œä½¿ä¸šåŠ¡èƒ½å¤Ÿå¯¹ç¬æ¯ä¸‡å˜çš„ä¸šåŠ¡åœºæ™¯åšå‡ºåŠæ—¶ååº”ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæµå¼è®¡ç®—çš„æ ¸å¿ƒä»·å€¼å°±æ˜¯æ—¶æ•ˆæ€§ï¼Œå°†æ•°æ®åˆ†æè¿™ä¸ªåŸæœ¬åº”è¯¥å‡ºç°åœ¨â€œ<strong>äº‹åå¤ç›˜</strong>â€çš„ç¯èŠ‚æå‰åˆ°â€œ<strong>äº‹ä¸­å¹²é¢„</strong>â€ç”šè‡³â€œ<strong>äº‹å‰é¢„æµ‹</strong>â€ã€‚è¿™åœ¨ä¾‹å¦‚å®æ—¶ç›‘æ§ã€å®æ—¶é£æ§ã€å®æ—¶æ¨èç­‰å…³é”®ä¸šåŠ¡åœºæ™¯ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚</p>
<h2 data-id="heading-3"><strong>1.2 ä¼ ç»Ÿæµå¼è®¡ç®—æ ¸å¿ƒæŒ‘æˆ˜</strong></h2>
<p>å°½ç®¡æµå¼è®¡ç®—å‡­å€Ÿå…¶æ—¶æ•ˆæ€§é«˜çš„ä¼˜ç‚¹ï¼Œåœ¨ä¼ä¸šçš„ä¸šåŠ¡å‘å±•ä¸­è¶Šæ¥è¶Šå æ®äº†æ ¸å¿ƒåœ°ä½ï¼Œä½†æ˜¯ç”±äºå…¶å¤æ‚æ€§ï¼Œæˆäº†åˆ¶çº¦ä¼ä¸šå‘å±•çš„ä¸€ä¸ªéšœç¢ï¼Œä¸»è¦åˆ†ä¸ºå¼€å‘é—¨æ§›é«˜ã€è¿ç»´æˆæœ¬é«˜ã€æ‰©å±•æ€§å·®ä¸‰ä¸ªæ–¹é¢ã€‚</p>
<p><strong>1.2.1 å¼€å‘é—¨æ§›é«˜</strong></p>
<p>å½“å‰å¸‚é¢ä¸Šä¸»æµçš„æµå¼è®¡ç®—æ¡†æ¶ï¼ˆå¦‚Flinkã€Spark Streamingç­‰ï¼‰ä»¥åŠç™¾åº¦è‡ªç ”çš„æµå¼è®¡ç®—æ¡†æ¶TMï¼Œè™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯å­¦ä¹ è·¯å¾„å¼‚å¸¸é™¡å³­ã€‚å¼€å‘è€…ä¸ä»…éœ€è¦äº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬åŸç†ï¼Œè¿˜éœ€è¦äº†è§£ï¼š</p>
<p><strong>äº‹ä»¶æ—¶é—´ä¸å¤„ç†æ—¶é—´çš„å¤„ç†</strong>ï¼šå¦‚ä½•æ­£ç¡®å¤„ç†ä¹±åºäº‹ä»¶ã€å»¶è¿Ÿæ•°æ®åˆ°è¾¾æ—¶åº”è¯¥æ€ä¹ˆå¤„ç†ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜æ˜¯å®ç°ç²¾ç¡®ä¸šåŠ¡é€»è¾‘çš„å‰æï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºé”™çš„éƒ¨åˆ†ï¼›</p>
<ul>
<li>
<p><strong>å¤æ‚çš„çª—å£æœºåˆ¶</strong>ï¼šçª—å£ä¸€èˆ¬åˆ†ä¸ºæ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£å’Œä¼šè¯çª—å£ï¼Œä¸åŒçª—å£çš„é€‚ç”¨åœºæ™¯ä¸é…ç½®å·®å¼‚æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œå¦‚æœé€‰æ‹©ä¸å½“ä¹Ÿå°†å½±å“ä¸šåŠ¡æ•ˆæœï¼›</p>
</li>
<li>
<p><strong>çŠ¶æ€ç®¡ç†æœºåˆ¶</strong>ï¼šæœ‰çŠ¶æ€è®¡ç®—æ˜¯æµå¤„ç†çš„æ ¸å¿ƒé—®é¢˜ï¼Œè€ŒçŠ¶æ€çš„å®¹é”™ã€æ¢å¤ä¸ä¸€è‡´æ€§ä¿éšœï¼ˆå¦‚Exactly-Onceï¼‰æœºåˆ¶å¤æ‚ï¼Œå¯¹å¼€å‘è€…çš„è¦æ±‚ä¹Ÿæ›´é«˜ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">1.2.2 è¿ç»´æˆæœ¬é«˜</h3>
<h2 data-id="heading-5">ä¸ç¦»çº¿çš„æ‰¹å¤„ç†ä¸åŒï¼Œæµå¼ç³»ç»Ÿçš„è¿ç»´æ˜¯æŒç»­ä¸”åŠ¨æ€çš„ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†é«˜æ˜‚çš„è¿ç»´æˆæœ¬ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š</h2>
<p><strong>å®¹é”™</strong>ï¼šåœ¨èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæŠ–åŠ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸é‡ä¸ä¸¢ï¼Œè¿™å°±éœ€è¦å¤æ‚çš„æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰æœºåˆ¶å’Œä¿å­˜ç‚¹ï¼ˆSavepointï¼‰æœºåˆ¶ï¼›</p>
<ul>
<li>
<p><strong>å®æ—¶ç›‘æ§ä¸å‘Šè­¦</strong>ï¼šæµå¼ç³»ç»Ÿæœ¬èº«çš„ç§’çº§æ—¶æ•ˆä¹Ÿè¦æ±‚è¿ç»´å›¢é˜Ÿèƒ½å¤Ÿç§’çº§å‘ç°å¹¶å“åº”é—®é¢˜ ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œéœ€è¦é’ˆå¯¹äºä»»åŠ¡å»¶è¿Ÿã€åå‹ï¼ˆBackpressureï¼‰ã€èµ„æºä½¿ç”¨ç‡ç­‰å…³é”®æŒ‡æ ‡é…ç½®å¤æ‚çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»ï¼›</p>
</li>
<li>
<p><strong>æŒç»­çš„æ€§èƒ½è°ƒä¼˜</strong>ï¼šæµå¼ç³»ç»Ÿçš„ç‰¹ç‚¹æ˜¯åœ¨è¿è¡Œèµ·æ¥ä¹‹å‰ï¼Œæ²¡äººçŸ¥é“åº”è¯¥æ€ä¹ˆæ ·é…ç½®èµ„æºå‚æ•°ï¼Œå› ä¸ºä¸€ç‚¹ç‚¹æ•°æ®é‡çš„æ³¢åŠ¨æˆ–è€…ä¸šåŠ¡é€»è¾‘å˜æ›´éƒ½å¯èƒ½å¼•å‘æ€§èƒ½ç“¶é¢ˆï¼Œé€ æˆå»¶è¿Ÿæˆ–è€…åå‹ç­‰é—®é¢˜ã€‚è¿™å°±éœ€è¦è¿ç»´äººå‘˜æŒç»­åœ°é’ˆå¯¹äºç³»ç»Ÿè¿›è¡Œè°ƒå‚ï¼ŒåŒ…æ‹¬å¹¶è¡Œåº¦ã€å†…å­˜èµ„æºå‚æ•°ç­‰ç­‰ã€‚</p>
</li>
</ul>
<p><strong>1.2.3 æ‰©å±•æ€§å·®</strong></p>
<p>æ—©æœŸçš„å„ç±»æµå¼è®¡ç®—æ¡†æ¶è®¾è®¡ä¸Šç›¸å¯¹åƒµåŒ–ï¼Œè€Œéš¾ä»¥çµæ´»åº”å¯¹å½“å‰å¿«é€Ÿå‘å±•çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå…¶æ‰©å±•æ€§ä¸»è¦æ˜¯å—åˆ¶äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>
<p><strong>æ¶æ„è€¦åˆåº¦é«˜</strong>ï¼šè®¡ç®—é€»è¾‘ä¸åº•å±‚èµ„æºã€å­˜å‚¨å¼ºè€¦åˆï¼Œè¿™å°±å¯¼è‡´äº†å‡çº§æˆ–è¿ç§»æ—¶æˆæœ¬è¾ƒé«˜ï¼›</p>
</li>
<li>
<p><strong>å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›å¼±</strong>ï¼šéƒ¨åˆ†æµå¼åœºæ™¯å¯èƒ½ä¼šé¢ä¸´çªå¦‚å…¶æ¥çš„çƒ­ç‚¹é—®é¢˜ï¼Œå¦‚åŒåä¸€ç”µå•†å¤§ä¿ƒï¼Œé¢å¯¹å¯èƒ½åˆ°æ¥çš„æµé‡é«˜å³°ï¼Œåªèƒ½æå‰ä¼°ç®—å¹¶æ‰©å®¹ï¼ŒåŒæ ·åœ°å½“æµé‡ä½è°·åˆ°æ¥æ—¶ï¼Œä¹Ÿå°†é€ æˆèµ„æºæµªè´¹ã€‚åœ¨é«˜é€Ÿè¿­ä»£çš„åœºæ™¯ä¸‹ï¼Œè¿™æ ·ä¸å¤Ÿçµæ´»çš„æ¨¡å¼è¶Šæ¥è¶Šæ‰è¥Ÿè§è‚˜ï¼›</p>
</li>
<li>
<p><strong>ä¸šåŠ¡è¿­ä»£ä¸æ•æ·</strong>ï¼šå®é™…ä¼ä¸šä¸šåŠ¡åœºæ™¯ä¸­å®æ—¶æŒ‡æ ‡æˆ–è€…è®¡ç®—å£å¾„çš„è¿­ä»£æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œè€Œç°æœ‰æ¡†æ¶ä¸‹ä¸€ä¸ªè¿­ä»£çš„ä¸Šçº¿éœ€è¦å¤æ‚çš„å¼€å‘ã€æµ‹è¯•ã€ä¸Šçº¿æµç¨‹ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå‘å±•çš„è¦æ±‚ã€‚</p>
</li>
</ul>
<h2 data-id="heading-6"><strong>1.3 ç ´å±€ä¹‹é“â€”â€”æ„å»ºäº‘åŸç”Ÿæµå¼è®¡ç®—PaaSå¹³å°</strong></h2>
<p>é¢å¯¹å¼€å‘å¤æ‚ã€è¿ç»´ç¹é‡ã€æ‰©å±•å—é™ç­‰ç—›ç‚¹ï¼Œå•çº¯ä¾èµ–åº•å±‚æ¡†æ¶å·²éš¾ä»¥ä¸ºç»§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€åœºå¼€å‘ä¸è¿ç»´èŒƒå¼çš„æ ¹æœ¬æ€§å˜é©ã€‚è€Œäº‘åŸç”Ÿä¸PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ç†å¿µçš„æ·±åº¦èåˆï¼Œæ­£å¼å¼•é¢†è¿™åœºå˜é©çš„ç ´å±€ç‚¹ï¼šå°†æµå¼è®¡ç®—èƒ½åŠ›å°è£…èµ·æ¥ä½œä¸ºäº‘åŸç”ŸPaaSæœåŠ¡ï¼Œé€šè¿‡å¹³å°åŒ–æ‰‹æ®µå®ç°èƒ½åŠ›ä¸‹æ²‰ã€ä½“éªŒä¸Šç§»ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼Œå¹³å°ä»¥Kubernetesä¸ºåº•åº§ï¼Œèåˆé…ç½®åŒ–å¼€å‘æ¨¡å‹ä¸æ™ºèƒ½åŒ–è¿è¡Œå¼•æ“ï¼Œè¾¾æˆä¸‰å¤§è½¬å˜ï¼š</p>
<p><strong>ä»â€œå†™ä»£ç â€åˆ°â€œé…ä»»åŠ¡â€</strong>ï¼šé€šè¿‡æ ‡å‡†åŒ–çš„è¡¨å•åŒ–é…ç½®ï¼ŒæŠ½è±¡äº‹ä»¶æ—¶é—´ã€çª—å£ã€çŠ¶æ€ç­‰å¤æ‚æ¦‚å¿µï¼Œç”¨æˆ·åªéœ€å£°æ˜æ•°æ®æºã€å¤„ç†é€»è¾‘ä¸è¾“å‡ºç›®æ ‡ï¼Œå³å¯ç”Ÿæˆå¯è¿è¡Œçš„æµå¼ä½œä¸šï¼Œå¤§å¹…é™ä½å¼€å‘é—¨æ§›ï¼›</p>
<ul>
<li>
<p><strong>ä»â€œäººè‚‰è¿ç»´â€åˆ°â€œè‡ªåŠ¨æ²»ç†â€</strong>ï¼šä¾æ‰˜ Kubernetes çš„å¼¹æ€§è°ƒåº¦ã€å¥åº·æ¢é’ˆä¸ Operator æ¨¡å¼ï¼Œå¹³å°è‡ªåŠ¨å®Œæˆä»»åŠ¡éƒ¨ç½²ã€æ‰©ç¼©å®¹ã€æ•…éšœæ¢å¤ä¸æŒ‡æ ‡é‡‡é›†ï¼Œå°†è¿ç»´å¤æ‚åº¦å†…åŒ–äºå¹³å°ï¼›</p>
</li>
<li>
<p><strong>ä»â€œçƒŸå›±å¼æ¶æ„â€åˆ°â€œæœåŠ¡åŒ–å¤ç”¨â€</strong>ï¼šé€šè¿‡ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†ã€è¿æ¥å™¨åº“ä¸æ¨¡æ¿å¸‚åœºï¼Œå®ç°è®¡ç®—é€»è¾‘ã€æ•°æ®æºã€ç›‘æ§ç­–ç•¥çš„è·¨å›¢é˜Ÿå¤ç”¨ï¼Œæ”¯æ’‘ä¸šåŠ¡æ•æ·è¿­ä»£ä¸è§„æ¨¡åŒ–æ‰©å±•ã€‚</p>
</li>
</ul>
<p>è¿™ä¸€ PaaS åŒ–è½¬å‹ï¼Œä¸ä»…ç»§æ‰¿äº†äº‘åŸç”ŸæŠ€æœ¯åœ¨èµ„æºæ•ˆç‡ã€å¯è§‚æµ‹æ€§ä¸è‡ªåŠ¨åŒ–æ–¹é¢çš„ä¼˜åŠ¿ï¼Œæ›´å°†æµå¼è®¡ç®—ä»â€œä¸“å®¶ä¸“å±å·¥å…·â€è½¬å˜ä¸ºâ€œå…¨å‘˜å¯ç”¨æœåŠ¡â€ï¼Œä¸ºä¼ä¸šå®æ—¶æ•°æ®èƒ½åŠ›å»ºè®¾æä¾›äº†å¯æŒç»­ã€å¯å¤åˆ¶çš„åŸºç¡€è®¾æ–½ã€‚</p>
<h2 data-id="heading-7">02 å¹³å°æ¶æ„æ€»è§ˆï¼šäº‘åŸç”ŸPaaSçš„è®¾è®¡å†…æ ¸</h2>
<p>äº‘åŸç”ŸæŠ€æœ¯ï¼ˆå®¹å™¨åŒ–ã€ç¼–æ’è°ƒåº¦ã€å¾®æœåŠ¡ã€å¯è§‚æµ‹æ€§ï¼‰æµå¼è®¡ç®—ä¸PaaSç»“åˆæä¾›äº† â€œç‰©ç†åŸºç¡€â€ï¼Œè®©å¹³å°åŒ–èƒ½åŠ›æœ‰äº†è½åœ°çš„åœŸå£¤ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºå®ç°äº†æµå¼ç³»ç»Ÿçš„ â€œæ ‡å‡†åŒ–ã€å¼¹æ€§åŒ–ã€å¯æ„ŸçŸ¥â€ï¼š</p>
<p>æ ‡å‡†åŒ–éƒ¨ç½²ï¼šé€šè¿‡ Docker å®¹å™¨åŒ–å°è£…æµå¼ä»»åŠ¡åŠå…¶ä¾èµ–ç¯å¢ƒï¼Œæ¶ˆé™¤ â€œå¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´â€ çš„ç—›ç‚¹ï¼ŒåŒæ—¶è®©ä»»åŠ¡çš„éƒ¨ç½²ã€è¿ç§»ã€å¤åˆ¶å˜å¾—é«˜æ•ˆç»Ÿä¸€ â€”â€” è¿™æ˜¯æ™ºèƒ½åŒ–è°ƒåº¦å’Œå¼¹æ€§æ‰©ç¼©å®¹çš„å‰æï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¯¹ä»»åŠ¡è¿›è¡Œç²¾å‡†æ“ä½œï¼›</p>
<ul>
<li>
<p><strong>å¼¹æ€§ç¼–æ’è°ƒåº¦</strong>ï¼šåŸºäº Kubernetesï¼ˆK8sï¼‰çš„ç¼–æ’èƒ½åŠ›ï¼Œå®ç°æµå¼ä»»åŠ¡çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€è°ƒåº¦ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚K8s çš„ Pod è°ƒåº¦ã€StatefulSet çŠ¶æ€ç®¡ç†ç­‰ç‰¹æ€§ï¼Œä¸ºæµå¼ä»»åŠ¡çš„æ°´å¹³æ‰©ç¼©ã€æ•…éšœè½¬ç§»æä¾›äº†åº•å±‚æ”¯æ’‘ï¼Œè®©èµ„æºè°ƒæ•´å˜å¾—çµæ´»å¯æ§ï¼›</p>
</li>
<li>
<p><strong>å…¨é“¾è·¯å¯è§‚æµ‹</strong>ï¼šäº‘åŸç”Ÿå¯è§‚æµ‹æ€§æŠ€æœ¯ï¼ˆPrometheusã€Grafanaã€Jaeger ç­‰ï¼‰æ„å»ºäº† Metricsï¼ˆæŒ‡æ ‡ï¼‰ã€Logsï¼ˆæ—¥å¿—ï¼‰ã€Tracesï¼ˆé“¾è·¯è¿½è¸ªï¼‰ä¸‰ç»´ç›‘æ§ä½“ç³»ï¼Œè®©æµå¼ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ â€œå¯è§†åŒ–ã€å¯é‡åŒ–ã€å¯è¿½æº¯â€ã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42adbe34f59c4e5f9b9bbf4a106ffb8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769067223&amp;x-signature=K0BT9dzIseMnPSN3ugQGthBHXPA%3D" alt="318f84e872d01dbcfc9851482eacd04c.png" loading="lazy"/>
ä¾æ‰˜äº‘åŸç”Ÿçš„æŠ€æœ¯ï¼Œæˆ‘ä»¬æ„å»ºäº†å››å±‚æ¶æ„çš„æµå¼è®¡ç®—åŸºç¡€è®¾æ–½æ¶æ„ï¼Œæ˜¯PaaSè½åœ°çš„æŠ€æœ¯åº•åº§ï¼š</p>
<ul>
<li>
<p><strong>ç¡¬ä»¶èµ„æºå±‚</strong>ï¼šä»¥å¤šåœ°åŸŸã€å¤šæœºæˆ¿çš„æœåŠ¡å™¨é›†ç¾¤ä¸ºç‰©ç†æ”¯æ’‘ï¼Œé€šè¿‡åˆ†å¸ƒå¼éƒ¨ç½²å®ç°èµ„æºè§„æ¨¡åŒ–ä¸å®¹ç¾èƒ½åŠ›ï¼Œä¸ºä¸Šå±‚æä¾›ç®—åŠ›åŸºç¡€ï¼›</p>
</li>
<li>
<p><strong>Kubernetes ç¼–æ’å±‚</strong>ï¼šç”± K8s Masterï¼ˆé›†æˆ API Serverã€è°ƒåº¦å™¨ç­‰æ ¸å¿ƒç»„ä»¶ï¼‰å’Œå¤šèŠ‚ç‚¹ K8s Node ç»„æˆï¼Œæ‰¿æ‹…èµ„æºè°ƒåº¦ã€ä»»åŠ¡ç¼–æ’ã€å¼¹æ€§æ‰©ç¼©çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå®ç°æµå¼ä»»åŠ¡çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸èµ„æºåŠ¨æ€åˆ†é…ï¼›</p>
</li>
<li>
<p><strong>å®¹å™¨åŒ–æµå¼å¼•æ“å±‚</strong>ï¼šä»¥å®¹å™¨åŒ– Pod å½¢å¼è¿è¡ŒåŸºäºå‚å†…è‡ªç ”æµå¼æ¡†æ¶TMçš„ç®—å­ï¼Œé€šè¿‡å®¹å™¨æ ‡å‡†åŒ–å°è£…æ¶ˆé™¤ç¯å¢ƒå·®å¼‚ï¼Œæ”¯æŒæ°´å¹³æ‰©ç¼©å®¹ï¼Œè®©è®¡ç®—èƒ½åŠ›å¯æ ¹æ®ä¸šåŠ¡æµé‡å¼¹æ€§é€‚é…ï¼›</p>
</li>
<li>
<p><strong>å¯è§‚æµ‹æ€§å±‚</strong>ï¼šé€šè¿‡ Grafana Dashboard ç­‰å·¥å…·æ„å»ºå…¨é“¾è·¯ç›‘æ§ä½“ç³»ï¼Œè¦†ç›–æŒ‡æ ‡ã€æ—¥å¿—ã€é“¾è·¯è¿½è¸ªï¼Œä¸ºç”¨æˆ·å®æ—¶æ„ŸçŸ¥ç³»ç»ŸçŠ¶æ€ï¼ŒåŠæ—¶å†³ç­–æä¾›äº†æ•°æ®æ”¯æ’‘ã€‚</p>
</li>
</ul>
<p>å››å±‚æ¶æ„çš„ååŒï¼Œæœ€ç»ˆå®ç°äº†**â€œæ ‡å‡†åŒ–éƒ¨ç½²ã€å¼¹æ€§èµ„æºè°ƒåº¦ã€å…¨é“¾è·¯å¯è§‚æµ‹â€**çš„äº‘åŸç”Ÿèƒ½åŠ›ï¼Œä¸ºæµå¼è®¡ç®—çš„ PaaS åŒ–å°è£…æä¾›äº†åšå®æŠ€æœ¯åº•åº§ â€”â€” å°†åº•å±‚å¤æ‚çš„èµ„æºç®¡ç†ã€å¼•æ“è°ƒåº¦ã€ç›‘æ§é‡‡é›†èƒ½åŠ›ä¸‹æ²‰ï¼Œå‘ä¸Šå±‚ç”¨æˆ·æš´éœ² â€œç®€å•ã€æ˜“ç”¨ã€é«˜æ•ˆâ€ çš„é…ç½®åŒ–å¼€å‘æ¥å£ï¼Œå®Œç¾æ‰¿æ¥ â€œé™ä½é—¨æ§›ã€ç®€åŒ–è¿ç»´ã€æå‡å¼¹æ€§â€ çš„æ ¸å¿ƒç›®æ ‡ï¼Œè®©æµå¼è®¡ç®—èƒ½åŠ›çœŸæ­£ä»¥ â€œæœåŠ¡â€ å½¢å¼äº¤ä»˜ã€‚</p>
<h2 data-id="heading-8"><strong>2.1 åŸºçŸ³ï¼šKubernetesç¼–æ’å±‚â€”â€”èµ„æºçš„æ™ºèƒ½å¤§è„‘</strong></h2>
<p>Kubernetes ä¸ä»…æ˜¯å®¹å™¨ç¼–æ’å¼•æ“ï¼Œæ›´æ˜¯æ•´ä¸ªæµå¼å¹³å°çš„â€œæ™ºèƒ½è°ƒåº¦ä¸­æ¢â€ï¼Œå®ƒæ˜¯æ•´ä¸ªå¹³å°å¼¹æ€§ä¸è‡ªåŠ¨åŒ–çš„åŸºçŸ³ã€‚</p>
<p>æˆ‘ä»¬åŸºäºK8så®ç°äº†æµå¼ä»»åŠ¡çš„å£°æ˜å¼ç®¡ç†ä¸æ™ºèƒ½è°ƒåº¦ã€‚ç”¨æˆ·æäº¤çš„ä»»åŠ¡éœ€æ±‚ï¼ˆå¦‚æ‰€éœ€CPUã€å†…å­˜ï¼‰è¢«æŠ½è±¡ä¸ºK8sçš„å®šåˆ¶åŒ–èµ„æºï¼Œè€Œå¹³å°çš„<strong>æµå¼ä»»åŠ¡ç®—å­</strong>åˆ™ä½œä¸ºé›†ç¾¤å†…çš„â€œè‡ªåŠ¨åŒ–è¿ç»´æœºå™¨äººâ€ï¼ŒæŒç»­ç›‘å¬è¿™äº›èµ„æºçŠ¶æ€ï¼Œå¹¶é©±åŠ¨åº•å±‚æ‰§è¡Œã€‚å…¶æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ï¼š</p>
<p><strong>å£°æ˜å¼éƒ¨ç½²ä¸è‡ªæ„ˆ</strong>ï¼šå¹³å°å°†ç”¨æˆ·é…ç½®çš„æµå¼ä»»åŠ¡ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºç”±<strong>Deployment</strong>ï¼ˆæ— çŠ¶æ€ä»»åŠ¡ï¼‰æˆ–<strong>StatefulSet</strong>ï¼ˆæœ‰çŠ¶æ€ä»»åŠ¡ï¼Œä¿éšœPodåç§°ä¸å­˜å‚¨çš„ç¨³å®šï¼‰ç®¡ç†çš„Podç»„ã€‚å½“æŸä¸ªPodå› èŠ‚ç‚¹æ•…éšœæ„å¤–é€€å‡ºæ—¶ï¼ŒK8sçš„æ§åˆ¶å™¨ä¼šç«‹å³åœ¨å¥åº·èŠ‚ç‚¹ä¸Šé‡å»ºï¼Œé€šå¸¸åœ¨ç§’çº§å†…å®Œæˆæ•…éšœæ¢å¤ï¼Œå®ç°äº†ä»â€œäººå·¥å“åº”â€åˆ°â€œè‡ªåŠ¨æ„ˆåˆâ€çš„è´¨å˜ã€‚</p>
<ul>
<li>
<p><strong>é«˜æ•ˆè¿ç»´ä¸å¼¹æ€§åŸºç¡€</strong>ï¼šKubernetesçš„å£°æ˜å¼APIä¸èµ„æºæ¨¡å‹ï¼Œä¸ºæµå¼ä»»åŠ¡çš„<strong>é«˜æ•ˆè¿ç»´ä¸å¯æ§å¼¹æ€§</strong>æä¾›äº†å®Œç¾åŸºç¡€ã€‚å¹³å°åŸºäºæ­¤å®šä¹‰äº†æ¸…æ™°çš„èµ„æºè§„æ ¼ä¸å‰¯æœ¬æ•°é…ç½®ã€‚å½“ä¸šåŠ¡éœ€è¦æ‰©ç¼©å®¹æ—¶ï¼Œè¿ç»´äººå‘˜åªéœ€é€šè¿‡å¹³å°æ›´æ–°ä¸€ä¸ªé…ç½®å€¼ï¼ŒK8sè°ƒåº¦å™¨ä¾¿ä¼šè‡ªåŠ¨ã€å¯é åœ°å®Œæˆæ•´ä¸ªå®ä¾‹çš„æ‰©å®¹æˆ–ä¼˜é›…ç»ˆæ­¢æµç¨‹ã€‚è¿™ç§æ¨¡å¼å°†ä¼ ç»Ÿçš„ã€æ˜“å‡ºé”™çš„æ‰‹å·¥éƒ¨ç½²ï¼Œè½¬å˜ä¸ºä¸€ç§<strong>å¯å®¡è®¡ã€å¯å›æ»šã€åˆ†é’Ÿçº§å†…å®Œæˆçš„æ ‡å‡†åŒ–æ“ä½œ</strong>ï¼Œä¸ºåº”å¯¹è®¡åˆ’å†…çš„æµé‡æ´ªå³°ï¼ˆå¦‚å¤§ä¿ƒï¼‰æä¾›äº†æ•æ·ä¸”å¯é çš„å¼¹æ€§èƒ½åŠ›ã€‚</p>
</li>
<li>
<p><strong>èµ„æºéš”ç¦»ä¸é«˜æ•ˆåˆ©ç”¨</strong>ï¼šé€šè¿‡K8sçš„<strong>Namespace</strong>å’Œ<strong>Resource Quota</strong>ï¼Œå¹³å°å¯ä»¥ä¸ºä¸åŒéƒ¨é—¨æˆ–ä¸šåŠ¡çº¿åˆ›å»ºé€»è¾‘ä¸Šéš”ç¦»çš„èµ„æºæ± ï¼Œé¿å…ç›¸äº’å¹²æ‰°ã€‚åŒæ—¶ï¼ŒK8sè°ƒåº¦å™¨èƒ½åŸºäºèŠ‚ç‚¹çš„å®é™…èµ„æºåˆ©ç”¨ç‡ï¼Œè¿›è¡Œæ™ºèƒ½è£…ç®±ï¼ˆBin Packingï¼‰ï¼Œæ˜¾è‘—æå‡é›†ç¾¤æ•´ä½“çš„èµ„æºä½¿ç”¨æ•ˆç‡ï¼Œé™ä½æˆæœ¬ã€‚</p>
</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒKubernetes åœ¨æ­¤ä¸ä»…æ˜¯â€œè¿è¡Œç¯å¢ƒâ€ï¼Œæ›´æ˜¯å®ç°äº† <strong>èµ„æºè°ƒåº¦ã€å¼¹æ€§æ§åˆ¶ã€é«˜å¯ç”¨ä¿éšœ</strong> ä¸‰ä½ä¸€ä½“çš„æ™ºèƒ½å¤§è„‘ã€‚</p>
<h2 data-id="heading-9"><strong>2.2 è½½ä½“ï¼šå®¹å™¨åŒ–æµå¼å¼•æ“å±‚â€”â€”åº”ç”¨çš„æ ‡å‡†åŒ–å°è£…</strong></h2>
<p>æµå¼è®¡ç®—çš„å¤æ‚æ€§åˆ™å¾ˆå¤§ç¨‹åº¦ä¸Šæºäºç¯å¢ƒä¾èµ–äºè¿è¡Œæ—¶å·®å¼‚ï¼Œè€Œå®¹å™¨åŒ–æŠ€æœ¯æ˜¯è¿æ¥ç”¨æˆ·é€»è¾‘ä¸åº•å±‚èµ„æºçš„â€œè½½ä½“â€ï¼Œæ˜¯å½»åº•è§£å†³è¿™ä¸€é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ï¼š</p>
<ul>
<li>
<p><strong>ç»Ÿä¸€é•œåƒè§„èŒƒ</strong>ï¼šæ‰€æœ‰æµå¼ä½œä¸šåŸºäºæ ‡å‡†åŒ–åŸºç¡€é•œåƒæ„å»ºï¼Œé¢„è£…åŸºç¡€ç¯å¢ƒé…ç½®ã€ç›‘æ§ Agent å’Œæ—¥å¿—é‡‡é›†å™¨ï¼Œç¡®ä¿â€œå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§â€ä¸‰ç¯å¢ƒå®Œå…¨ä¸€è‡´ï¼›</p>
</li>
<li>
<p><strong>è½»é‡çº§ Sidecar æ¨¡å¼</strong>ï¼šæ¯ä¸ª Pod åŒ…å«ä¸»å®¹å™¨ï¼ˆè¿è¡Œæµå¼ç®—å­ï¼‰ä¸ Sidecar å®¹å™¨ï¼ˆè´Ÿè´£æ—¥å¿—ä¸ŠæŠ¥ã€æŒ‡æ ‡æš´éœ²ã€é…ç½®çƒ­æ›´æ–°ï¼‰ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘ä¸å¹³å°èƒ½åŠ›ï¼›</p>
</li>
<li>
<p><strong>èµ„æºéš”ç¦»ä¸é™åˆ¶</strong>ï¼šé€šè¿‡ K8s çš„<code>resources.requests/limits</code>ç²¾ç¡®æ§åˆ¶ CPUã€å†…å­˜åˆ†é…ï¼Œé¿å…å•ä¸ªä»»åŠ¡èµ„æºäº‰æŠ¢å½±å“é›†ç¾¤ç¨³å®šæ€§ã€‚</p>
</li>
</ul>
<p>å®¹å™¨åœ¨æ­¤ä¸ä»…æ˜¯â€œæ‰“åŒ…å·¥å…·â€ï¼Œæ›´æ˜¯ <strong>æ ‡å‡†åŒ–äº¤ä»˜ã€å®‰å…¨éš”ç¦»ã€æ•æ·è¿­ä»£</strong> çš„æ ¸å¿ƒè½½ä½“</p>
<h2 data-id="heading-10"><strong>2.3 è§†é‡ï¼šå¯è§‚æµ‹æ€§å±‚â€”â€”ç³»ç»Ÿçš„é€æ˜é©¾é©¶èˆ±</strong></h2>
<p>å¯¹äºä¸€ä¸ªæŒç»­è¿è¡Œçš„å®æ—¶ç³»ç»Ÿï¼Œå¯è§‚æµ‹æ€§å¦‚åŒé£æœºçš„é©¾é©¶èˆ±ä»ªè¡¨ç›˜ï¼Œæ˜¯ä¿éšœå…¶ç¨³å®šã€é«˜æ•ˆè¿è¡Œçš„â€œçœ¼ç›â€å’Œâ€œç›´è§‰â€ã€‚æˆ‘ä»¬æ„å»ºäº†ä¸‰ä½ä¸€ä½“çš„å¯è§‚æµ‹æ€§ä½“ç³»ï¼š</p>
<p><strong>Metricsï¼ˆæŒ‡æ ‡ï¼‰- ç³»ç»Ÿçš„è„‰æ</strong>ï¼šå¹³å°æ·±åº¦é›†æˆPrometheusï¼Œè‡ªåŠ¨é‡‡é›†æ¯ä¸ªæµå¼ä»»åŠ¡Podçš„æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚**æ•°æ®ååç‡ï¼ˆrecords/sï¼‰ã€å¤„ç†å»¶è¿Ÿï¼ˆprocess_latencyï¼‰ã€èƒŒå‹çŠ¶æ€ï¼ˆis_backpressuredï¼‰**ä»¥åŠCPU/å†…å­˜ä½¿ç”¨ç‡ã€‚é€šè¿‡é¢„ç½®çš„Grafanaä»ªè¡¨ç›˜ï¼Œè¿ç»´äººå‘˜å¯ä»¥ä¸€çœ¼æŒæ¡å…¨å±€å¥åº·çŠ¶æ€ï¼Œå°†ç›‘æ§ä»â€œé»‘ç›’â€å˜ä¸ºâ€œç™½ç›’â€ã€‚</p>
<ul>
<li>
<p><strong>Logsï¼ˆæ—¥å¿—ï¼‰- è¯Šæ–­çš„æº¯æº</strong>ï¼šæ‰€æœ‰å®¹å™¨çš„æ ‡å‡†è¾“å‡ºä¸é”™è¯¯æ—¥å¿—ï¼Œé€šè¿‡DaemonSetæ–¹å¼è¢«ç»Ÿä¸€æ”¶é›†ã€ç´¢å¼•ï¼ˆå¦‚å­˜å…¥Elasticsearchï¼‰ã€‚å½“æŒ‡æ ‡å‡ºç°å¼‚å¸¸æ—¶ï¼Œè¿ç»´äººå‘˜å¯ä»¥å¿«é€Ÿå…³è”åˆ°å¯¹åº”æ—¶é—´ç‚¹çš„è¯¦ç»†åº”ç”¨æ—¥å¿—ï¼Œç²¾å‡†å®šä½é”™è¯¯æ ¹æºï¼Œå°†æ’éšœæ—¶é—´ä»å°æ—¶çº§ç¼©çŸ­è‡³åˆ†é’Ÿçº§ã€‚</p>
</li>
<li>
<p><strong>Tracesï¼ˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼‰- æ€§èƒ½çš„è„‰ç»œ</strong>ï¼šå¯¹äºå¤æ‚çš„æ•°æ®å¤„ç†æµæ°´çº¿ï¼Œæˆ‘ä»¬é€šè¿‡é›†æˆé“¾è·¯è¿½è¸ªï¼Œè¿˜åŸä¸€æ¡æ•°æ®åœ¨æµå¼ä»»åŠ¡DAGä¸­æµç»å„ä¸ªç®—å­çš„å®Œæ•´è·¯å¾„å’Œè€—æ—¶ã€‚è¿™ä½¿å¾—å®šä½æ€§èƒ½ç“¶é¢ˆï¼ˆä¾‹å¦‚ï¼Œæ˜¯å“ªéƒ¨åˆ†æ“ä½œæ‹–æ…¢äº†æ•´ä½“é€Ÿåº¦ï¼‰å˜å¾—ç›´è§‚è€Œé«˜æ•ˆã€‚</p>
</li>
</ul>
<p>å¯è§‚æµ‹æ€§åœ¨æ­¤ä¸ä»…æ˜¯â€œç›‘æ§å·¥å…·â€ï¼Œæ›´æ˜¯ <strong>æ™ºèƒ½å†³ç­–çš„æ•°æ®æºæ³‰</strong>ï¼Œä¸ºå¼¹æ€§æ‰©ç¼©ã€ç”¨æˆ·åŠæ—¶è°ƒä¼˜æä¾›å®æ—¶åé¦ˆã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ac5b3f30284f79b7aa2bc3678071c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769067223&amp;x-signature=t%2B9VUr9s%2BbM0Y0hBOB31cM8cCBk%3D" alt="16a9b18a198140c82cdc8df55fa361f1.png" loading="lazy"/>
<em>â–³ Grafanaç›‘æ§ä»ªè¡¨ç›˜</em></p>
<h2 data-id="heading-11"/>
<h2 data-id="heading-12"><strong>2.4 ååŒï¼šæ¶æ„é©±åŠ¨çš„æ ¸å¿ƒä»·å€¼é—­ç¯</strong></h2>
<h2 data-id="heading-13">ä¸Šè¿°ä¸‰å±‚å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œè€Œæ˜¯é€šè¿‡ <strong>â€œå£°æ˜ â†’ æ‰§è¡Œ â†’ æ„ŸçŸ¥ â†’ ä¼˜åŒ–â€</strong> çš„é—­ç¯ç´§å¯†ååŒï¼š</h2>
<p>ç”¨æˆ·é€šè¿‡é…ç½®å£°æ˜ä¸šåŠ¡æ„å›¾ï¼ˆå¦‚â€œæ¯åˆ†é’Ÿç»Ÿè®¡æ´»è·ƒç”¨æˆ·â€ï¼‰ï¼›</p>
<ul>
<li>
<p>Kubernetes ç¼–æ’å±‚å°†å…¶è½¬åŒ–ä¸ºå¯è°ƒåº¦çš„ Pod æ‹“æ‰‘ï¼Œå¹¶ç”±å®¹å™¨åŒ–å¼•æ“æ‰§è¡Œï¼›</p>
</li>
<li>
<p>å¯è§‚æµ‹æ€§å±‚æŒç»­é‡‡é›†è¿è¡Œæ•°æ®ï¼Œå½¢æˆç³»ç»Ÿâ€œæ•°å­—å­ªç”Ÿâ€ï¼›</p>
</li>
<li>
<p>å¹³å°åŸºäºåé¦ˆè‡ªåŠ¨è§¦å‘å¼¹æ€§æ‰©ç¼©ã€å‚æ•°è°ƒä¼˜æˆ–æ•…éšœæ¢å¤ï¼Œæœ€ç»ˆå…‘ç° SLA æ‰¿è¯ºã€‚</p>
</li>
</ul>
<p>è¿™ä¸€é—­ç¯ï¼Œä½¿å¾—å¹³å°æ—¢èƒ½ <strong>å‘ä¸‹å……åˆ†åˆ©ç”¨äº‘åŸç”ŸåŸºç¡€è®¾æ–½çš„èƒ½åŠ›</strong>ï¼Œåˆèƒ½ <strong>å‘ä¸Šä¸ºç”¨æˆ·æä¾›ç®€å•ã€å¯é ã€é«˜æ•ˆçš„æµå¼æœåŠ¡ä½“éªŒ</strong>ã€‚å¼€å‘é—¨æ§›ã€è¿ç»´æˆæœ¬ã€æ‰©å±•æ€§ä¸‰å¤§ç—›ç‚¹ï¼Œç”±æ­¤åœ¨æ¶æ„å±‚é¢è¢«ç³»ç»Ÿæ€§åŒ–è§£ã€‚</p>
<h2 data-id="heading-14">03 é…ç½®åŒ–å¼€å‘â€”â€”ä»â€œç¼–ç â€åˆ°â€œè£…é…â€</h2>
<p>ä¼ ç»Ÿå¼€å‘æ¨¡å¼ä¸‹ï¼Œå·¥ç¨‹å¸ˆä»¬éœ€è¦ç”¨ä»£ç æ‰‹åŠ¨åœ°å»å¤„ç†æµå¼è®¡ç®—ä»»åŠ¡çš„æ¯ä¸€ä¸ªç»†èŠ‚ï¼Œè¿™æ˜¯éœ€è¦å¤æ‚å’Œå¼ºä¾èµ–ç»éªŒçš„ã€‚è€Œé…ç½®åŒ–çš„å‡ºç°ï¼Œæ°å¦‚ç¬¬ä¸€æ¬¡å·¥ä¸šé©å‘½çš„çå¦®çººçº±æœºï¼Œä½¿å·¥ç¨‹å¸ˆä»¬ä»å†—æ‚çš„é‡å¤å·¥ä½œä¸­é‡Šæ”¾å‡ºæ¥ï¼Œå°†â€œæ‰‹å·¥ä½œåŠâ€å‡çº§ç”Ÿæˆâ€œç°ä»£åŒ–ç”Ÿäº§çº¿â€ï¼Œä½¿æµå¼è®¡ç®—å¼€å‘å˜å¾—æ™®æƒ å’Œå¹³æ°‘åŒ–ã€‚</p>
<h2 data-id="heading-15">3.1 ä»ä»£ç åˆ°é…ç½®ï¼šå¼€å‘æ¨¡å¼çš„èŒƒå¼è½¬ç§»</h2>
<p>è¿™åœºé©å‘½æœ€åˆçš„è¡¨ç°æ˜¯å¼€å‘æ¨¡å¼çš„æ ¹æœ¬æ€§è½¬å˜ï¼šä»å‘½ä»¤å¼ï¼ˆImperativeï¼‰<strong>è½¬å˜ä¸º</strong>å£°æ˜å¼ï¼ˆDeclarativeï¼‰çš„èŒƒå¼è½¬ç§»ã€‚</p>
<ul>
<li>
<p>å‘½ä»¤å¼ï¼ˆå†™ä»£ç ï¼‰ï¼šå¼€å‘è€…éœ€è¦å‘Šè¯‰æµå¼ç³»ç»Ÿ**â€œæ€ä¹ˆåšâ€ï¼ˆHowï¼‰ï¼Œè¿™å¸¦æ¥äº†æå¤§çš„çµæ´»æ€§ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼´éšç€æé«˜çš„å¤æ‚åº¦å’Œå­¦ä¹ æˆæœ¬ï¼›</p>
</li>
<li>
<p>å£°æ˜å¼ï¼ˆå†™é…ç½®ï¼‰ï¼šå¼€å‘è€…éœ€è¦å£°æ˜**â€œåšä»€ä¹ˆâ€ï¼ˆWhatï¼‰ï¼Œè€Œâ€œæ€ä¹ˆåšâ€åˆ™äº¤ç”±åº•å±‚å¼•æ“å»å®Œæˆã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/138d79119ac9411bbc0e0b5de4543af9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769067223&amp;x-signature=nzsSj3dg2wIyqmnjrWk%2FYVsOdQI%3D" alt="0f6aeca92db1c38bde53e61c99a19507.png" loading="lazy"/></p>
<h2 data-id="heading-16"><strong>3.2 éšè—çš„å¤æ‚æ€§ï¼šä»â€œä¸“å®¶è°ƒä¼˜â€åˆ°â€œé…ç½®é»˜è®¤â€</strong></h2>
<p>å¸¸è§çš„æµå¼ç³»ç»Ÿä¸»è¦ç”±æ•°æ®æºå±‚ã€æ ¸å¿ƒè®¡ç®—å±‚ã€æ—¶é—´å®¹é”™å±‚ã€ç»“æœè¾“å‡ºå±‚è¿™å››éƒ¨åˆ†ï¼š</p>
<p>æ•°æ®æºå±‚å’Œç»“æœè¾“å‡ºå±‚ï¼Œå³æ•°æ®é‡‡é›†å’Œè¾“å‡ºçš„è¿‡ç¨‹ï¼Œä¸åœ¨æˆ‘ä»¬æ­¤æ¬¡é‡ç‚¹è®¨è®ºçš„èŒƒå›´å†…ï¼›</p>
<p><strong>3.2.1 æ ¸å¿ƒè®¡ç®—å±‚</strong></p>
<p>å¯¹äºæ ¸å¿ƒè®¡ç®—å±‚æ¥è¯´ï¼Œè¿™é‡Œè´Ÿè´£äº†æµå¼ä½œä¸šçš„ä¸»è¦ä¸šåŠ¡é€»è¾‘è®¡ç®—ï¼Œå…¶ä¸­</p>
<p><strong>Importç®—å­â€”â€”æ•°æ®æ¥å…¥çš„â€œç¬¬ä¸€å…¥å£â€</strong></p>
<ul>
<li>
<p>ç®—å­ç‰¹ç‚¹ï¼šä½œä¸ºæµå¼æ•°æ®è¿›å…¥æ ¸å¿ƒè®¡ç®—å±‚çš„â€œé—¨æˆ·â€ï¼Œæ ¸å¿ƒèŒè´£æ˜¯å®ç°å¤šç§ç±»å‹æ•°æ®æºçš„æ¥å…¥å’Œåˆæ­¥æ ¼å¼è§£æï¼Œä¸ºåç»­è®¡ç®—ç¯èŠ‚æä¾›æ ‡å‡†åŒ–çš„æ•°æ®è¾“å…¥ï¼Œæ˜¯ä¿éšœæ•°æ®æ¥å…¥ç¨³å®šæ€§å’Œå…¼å®¹æ€§çš„å…³é”®ã€‚</p>
</li>
<li>
<p>ä¼ ç»Ÿå¼€å‘æ¨¡å¼ï¼šéœ€è¦å·¥ç¨‹å¸ˆæ ¹æ®ä¸åŒçš„è¾“å…¥æ•°æ®ç±»å‹ï¼Œæ‰‹åŠ¨é…ç½®å“åº”çš„é“¾æ¥å‚æ•°ï¼Œä»¥è¿›è¡Œä¸åŒçš„é€‚é…ï¼›åŒæ—¶è¿˜éœ€è¦è‡ªå®šä¹‰æ•°æ®è§£æé€»è¾‘ï¼Œå¤„ç†ä¸åŒæ ¼å¼æ•°æ®çš„å­—æ®µæ˜ å°„å’Œç±»å‹è½¬æ¢ï¼›æ­¤å¤–ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨å¤„ç†è¿æ¥å¼‚å¸¸ã€æ•°æ®è¯»å–é‡è¯•ç­‰é—®é¢˜ï¼Œé¿å…æ•°æ®ä¸¢å¤±æˆ–é‡å¤å¤„ç†ã€‚</p>
</li>
<li>
<p>é…ç½®åŒ–è°ƒä¼˜ï¼šæ— éœ€æ‰‹åŠ¨ç¼–å†™æ¥å…¥ä¸è§£æä»£ç ï¼Œæ”¯æŒå¤šç§ä¸»æµæ•°æ®æ ¼å¼ï¼Œå¦‚CSVã€Parquetã€PBç­‰ï¼›å¯¹äºPBæ ¼å¼æ¥è¯´ï¼Œåœ¨é¢„ç½®çš„æ ‡å‡†æ•°æ®æ ¼å¼æ¨¡æ¿çš„åŸºç¡€ä¸Šï¼Œæ”¯æŒä¸Šä¼ è‡ªå®šä¹‰protoåï¼Œé€šè¿‡åå°„å°†protoå†…å„ä¸ªå­—æ®µæ˜ å°„æˆä¾¿äºç”¨æˆ·å¤„ç†çš„Schemaï¼›åŒæ—¶ç³»ç»Ÿå†…éƒ¨é›†æˆè¿æ¥å®¹é”™ã€è‡ªåŠ¨é‡è¯•ã€æ–­ç‚¹ç»­è¯»æœºåˆ¶ï¼Œä¿è¯æ•°æ®æ¥å…¥çš„ç¨³å®šæ€§ã€‚</p>
</li>
</ul>
<p><strong>Map/Filterç®—å­â€”â€”æ•°æ®é¢„å¤„ç†çš„ç¬¬ä¸€ä¸ªç¯èŠ‚</strong></p>
<ul>
<li>
<p>ç®—å­ç‰¹ç‚¹ï¼šæœ€åŸºç¡€ã€é«˜é¢‘çš„ç®—å­ï¼ŒMap è´Ÿè´£å¯¹å•æ¡æ•°æ®åšç»“æ„åŒ–è½¬æ¢ï¼ˆå¦‚å­—æ®µæ ¼å¼æ¸…æ´—ã€ç»´åº¦æ‰©å……ã€å•ä½æ¢ç®—ï¼‰ï¼ŒFilter åˆ™æŒ‰ä¸šåŠ¡è§„åˆ™ç­›é€‰æ•°æ®ï¼ˆå¦‚è¿‡æ»¤ç©ºå€¼ã€æ— æ•ˆè®¢å•ã€éç›®æ ‡åœºæ™¯æ•°æ®ï¼‰ï¼Œæ˜¯æ‰€æœ‰ä¸šåŠ¡é€»è¾‘è½åœ°çš„å‰ç½®ç¯èŠ‚ï¼›</p>
</li>
<li>
<p>ä¼ ç»Ÿå¼€å‘æ¨¡å¼ï¼šå¼€å‘æµå¼ä½œä¸šæ—¶éœ€è¦å·¥ç¨‹å¸ˆæ‰‹åŠ¨ç¼–å†™å®šä¹‰è½¬æ¢/ç­›é€‰é€»è¾‘ï¼Œ Mapéœ€è¦é€å­—æ®µå¤„ç†æ•°æ®ç±»å‹è½¬åŒ–ï¼Œè€ŒFilterè¦ç²¾ç¡®å†™æ˜åˆ¤æ–­æ¡ä»¶ã€‚é™¤äº†è¦ä¿è¯é€»è¾‘ç²¾å‡†å¤–ï¼Œè¿˜éœ€è¦å…¼é¡¾æ€§èƒ½ï¼Œå¦‚å¤æ‚å­—æ®µå¤šå±‚åµŒå¥—å¯èƒ½ä¼šå¯¼è‡´å•æ¡æ•°æ®å¤„ç†è€—æ—¶è¿‡é•¿ï¼Œè¿›è€Œå¼•å‘æ•´æ¡æµæ•°æ®å»¶è¿Ÿï¼›</p>
</li>
<li>
<p>é…ç½®åŒ–è°ƒä¼˜ï¼šæ— éœ€ç¼–å†™ä¸€è¡Œä»£ç ï¼Œé€šè¿‡å¯è§†åŒ–ç•Œé¢é…ç½®æµå¼ä½œä¸šï¼Œç³»ç»Ÿä¼šç°é’ˆå¯¹äºç”¨æˆ·çš„æ•°æ®æºè¿›è¡Œé¢„å¤„ç†ï¼Œå°†å¤šç§å¤šæ ·çš„æ ¼å¼å¤„ç†æˆä¾¿äºç”¨æˆ·ç›´æ¥ç”¨Sqlè¯­å¥ç›´æ¥å¤„ç†çš„æ ¼å¼ï¼ŒMap æ“ä½œæ”¯æŒæ‹–æ‹½ç®—å­ã€ä¸Šä¼ è‡ªå®šä¹‰protoç­‰å®ç°ï¼ŒFilter å¯é€šè¿‡é…ç½®Sqlè®¾ç½®è¿‡æ»¤è§„åˆ™ã€‚</p>
</li>
</ul>
<p><strong>Aggregateç®—å­â€”â€”ä¸šåŠ¡æŒ‡æ ‡è®¡ç®—</strong></p>
<ul>
<li>
<p>ç®—å­ç‰¹ç‚¹ï¼šé’ˆå¯¹äºå®ä¾‹å†…æ‹¿åˆ°çš„è¿™ä¸€æ‰¹æ•°æ®ï¼Œå¯¹æ•°æ®åšèšåˆè®¡ç®—ï¼ˆå¦‚æ±‚å’Œã€è®¡æ•°ã€å¹³å‡å€¼ã€TopNç­‰ï¼‰ï¼Œæ˜¯å®ç°å®æ—¶ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡çš„æ ¸å¿ƒç®—å­ï¼›</p>
</li>
<li>
<p>ä¼ ç»Ÿå¼€å‘æ¨¡å¼ï¼šéœ€è¦å·¥ç¨‹å¸ˆè‡ªè¡Œå®šä¹‰èšåˆé€»è¾‘ï¼Œå¦‚ä½¿ç”¨hash mapåšç´¯åŠ å™¨ç­‰ï¼Œåœ¨å¤æ‚èšåˆï¼ˆå¦‚å¤šç»´åº¦åµŒå¥—èšåˆï¼‰çš„æƒ…å†µä¸‹ï¼Œå¼€å‘éš¾åº¦å¤§ï¼Œè°ƒè¯•æˆæœ¬é«˜ï¼ŒåŒæ—¶è¿˜éœ€è¦å…¼é¡¾è®¡ç®—æ—¶æ•ˆå’Œèšåˆç²’åº¦ç­‰ï¼›</p>
</li>
<li>
<p>é…ç½®åŒ–ä¼˜åŒ–ï¼šç›´æ¥å†™Sqlçš„æ¨¡å¼æå¤§é™ä½äº†å¼€å‘æˆæœ¬ï¼ŒåŒæ—¶åº•å±‚é‡‡ç”¨å‘é‡åŒ–å¼•æ“å¯¹åˆ—è¿›è¡Œæ“ä½œï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„è¡Œå¤„ç†æ¨¡å¼æå¤§æé«˜äº†è®¡ç®—æ•ˆç‡ï¼Œæé«˜äº†æ—¶æ•ˆæ€§ã€‚</p>
</li>
</ul>
<p><strong>Sinkç®—å­â€”â€”è®¡ç®—ç»“æœçš„æœ€ç»ˆå‡ºå£</strong></p>
<ul>
<li>
<p>ç®—å­ç‰¹ç‚¹ï¼šä½œä¸ºæ ¸å¿ƒè®¡ç®—å±‚çš„æ”¶å°¾ç¯èŠ‚ï¼Œå°†æœ€ç»ˆæµå¼ä½œä¸šäº§å‡ºæ•°æ®è¾“å‡ºè‡³ä¸‹æ¸¸ç›®æ ‡ç³»ç»Ÿï¼Œæ˜¯å®æ—¶æ•°æ®ä»·å€¼è½åœ°çš„å…³é”®ã€‚</p>
</li>
<li>
<p>ä¼ ç»Ÿå¼€å‘æ¨¡å¼ï¼šéœ€è¦å·¥ç¨‹å¸ˆæ‰‹åŠ¨ç¼–å†™è¾“å‡ºä»£ç å’Œé…ç½®é¡¹ï¼Œé€‚é…ä¸‹æ¸¸ç³»ç»Ÿçš„é€šä¿¡åè®®ä¸æ•°æ®æ ¼å¼ï¼›åŒæ—¶åœ¨Exactly-Onceè¯­ä¹‰è¦æ±‚ä¸‹ï¼Œå·¥ç¨‹å¸ˆéœ€è¦åè°ƒæ£€æŸ¥ç‚¹ä¸Sinkç®—å­çš„äº‹åŠ¡æˆ–å¹‚ç­‰å†™å…¥é€»è¾‘ï¼Œå®ç°éš¾åº¦å¤§ï¼›ä¸æ­¤åŒæ—¶ï¼Œæ‰¹é‡å†™å…¥çš„å¤§å°ã€é—´éš”ç­‰å‚æ•°è°ƒä¼˜å°†ç›´æ¥å½±å“ååé‡å’Œç«¯åˆ°ç«¯å»¶è¿Ÿã€‚</p>
</li>
<li>
<p>é…ç½®åŒ–ä¼˜åŒ–ï¼šæµå¼å¼€å‘å¹³å°æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„Sinkæ¡†æ¶ï¼Œç”¨æˆ·åªéœ€è¦æŒ‡å®šè½ç›˜çš„ç›®æ ‡ç³»ç»Ÿå¹¶é…ç½®åŸºç¡€å‚æ•°ï¼Œå³å¯å®ç°æµå¼è®¡ç®—ç»“æœè¾“å‡ºã€‚ç›®å‰å·²æ”¯æŒè½ç›˜Afsï¼Œå‚å†…è‡ªç ”æ¶ˆæ¯é˜Ÿåˆ—Bigpipeï¼Œä»¥åŠå‘é‡åŒ–æ•°æ®åº“Dorisï¼Œæœªæ¥è¿˜å°†è¿›ä¸€æ­¥æ”¯æŒRedisã€Clickhouseç­‰ã€‚</p>
</li>
<li>
<p>æ£€æŸ¥ç‚¹ï¼šåœ¨é…ç½®åŒ–åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ä»…éœ€è¦é…ç½®æ£€æŸ¥ç‚¹å­˜å‚¨è·¯å¾„ï¼Œè€Œè§¦å‘æ—¶æœºã€å®¹é”™ç­–ç•¥ã€çŠ¶æ€åˆ†ç‰‡ä¸æ¢å¤ç­‰åº•å±‚å¤æ‚é€»è¾‘å…¨éƒ¨äº¤ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰˜ç®¡ï¼Œæå‡äº†æµå¼ä½œä¸šçš„å¯ç”¨æ€§å’Œæ˜“ç”¨æ€§ã€‚</p>
</li>
</ul>
<p><strong>3.2.2 æ—¶é—´ä¸å®¹é”™å±‚</strong></p>
<p>æ—¶é—´ä¸å®¹é”™å±‚æ˜¯æµå¼è®¡ç®—ä¸­â€œæ‰›é£é™©ï¼Œä¿ç¨³å®šâ€çš„æ ¸å¿ƒæ”¯æ’‘ï¼Œæ°´ä½æ§åˆ¶å’ŒçŠ¶æ€ç®¡ç†ä¸¤å¤§æ¨¡å—çš„åº•å±‚é€»è¾‘å¤æ‚ä¸”æ˜“å‡ºé”™ï¼Œä¼ ç»Ÿå¼€å‘æ¨¡å¼ä¸‹è°ƒä¼˜æˆæœ¬é«˜ï¼Œè€Œé…ç½®åŒ–å°†å…¶å®Œå…¨å¯¹ç”¨æˆ·é€æ˜ï¼Œä»…åœ¨é¡µé¢ä¸Šå‘ç”¨æˆ·ä½“ç°ä¸ºå„ä¸ªè®¡ç®—ç¯èŠ‚å¤„ç†è¿›åº¦ã€‚</p>
<p>åœ¨æµå¼ç³»ç»Ÿä¸­ï¼Œæ°´ä½ä½“ç°äº†æ•°æ®çš„å®Œæ•´æ€§ï¼ˆæ°´ä½æ—¶é—´ä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å·²å°±ç»ªï¼‰å’Œå¯è§æ€§ï¼ˆå½“æŸæ¡æ•°æ®å¤„ç†å‡ºç°æ•…éšœï¼Œæ°´ä½ä¾¿ä¸ä¼šå†é€€è¿›ï¼Œé—®é¢˜ç”±æ­¤å˜å¾—å¯è§ï¼‰ï¼Œä½œä¸ºè¿™ä¹ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ°´ä½æ§åˆ¶å°±æ˜¾å¾—æ ¼å¤–é‡è¦ï¼Œå¾€å¾€éœ€è¦ä¸°å¯Œçš„ç»éªŒå’Œå¤šæ¬¡è°ƒä¼˜æ‰èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚è€Œåœ¨é…ç½®åŒ–çš„æµå¼å¹³å°ä¸­ï¼Œæ°´ä½çš„æ§åˆ¶å¯¹ç”¨æˆ·åŸºæœ¬é€æ˜ï¼Œä»…åœ¨è¿ç»´ç•Œé¢ä½“ç°ä¸ºå„ä¸ªç®—å­çš„å½“å‰å¤„ç†è¿›åº¦ï¼Œåœ¨é™ä½äº†é—¨æ§›çš„å‰æä¸‹åˆä¿è¯äº†æ°´ä½çš„æ•°æ®å®Œæ•´æ€§å’Œå¯è§æ€§ä¸¤ä¸ªç‰¹ç‚¹ã€‚</p>
<p>è€ŒçŠ¶æ€ç®¡ç†æ˜¯Exactly-Onceçš„é‡è¦ä¿è¯ï¼Œä¿éšœäº†æ•…éšœæ¢å¤æ—¶çš„æ•°æ®ä¸€è‡´æ€§ã€‚ä¼ ç»Ÿå¼€å‘æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·éœ€æ‰‹åŠ¨è®¾è®¡çŠ¶æ€çš„å­˜å‚¨ç»“æ„ï¼ˆå¦‚é€‰æ‹©æœ¬åœ°å†…å­˜è¿˜æ˜¯åˆ†å¸ƒå¼å­˜å‚¨ï¼‰ã€ç¼–å†™çŠ¶æ€åºåˆ—åŒ– / ååºåˆ—åŒ–ä»£ç ã€è§„åˆ’çŠ¶æ€åˆ†ç‰‡ç­–ç•¥ä»¥é¿å…å•ç‚¹ç“¶é¢ˆï¼Œè¿˜è¦æ‰‹åŠ¨å¤„ç†çŠ¶æ€ç‰ˆæœ¬å†²çªã€æ¸…ç†è¿‡æœŸçŠ¶æ€ä»¥é˜²æ­¢å­˜å‚¨è†¨èƒ€ï¼Œæ¯ä¸€æ­¥éƒ½ä¾èµ–å¯¹åº•å±‚å­˜å‚¨å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ·±åº¦ç†è§£ã€‚è€Œåœ¨é…ç½®åŒ–çš„å¸®åŠ©ä¸‹ï¼Œè¿™äº›æŠ€æœ¯è¢«å®Œå…¨å°è£…ï¼Œç”¨æˆ·ä»…éœ€è¦é…ç½®çŠ¶æ€å­˜å‚¨çš„è·¯å¾„ï¼Œå…¶ä»–åˆ™å®Œå…¨äº¤ç”±ç³»ç»Ÿå®ç°ã€‚</p>
<h2 data-id="heading-17"><strong>3.3 å®è·µâ€”â€”Pushä¸šåŠ¡åœ¨æµå¼è®¡ç®—å¼€å‘å¹³å°çš„è½åœ°</strong></h2>
<p>ç›®å‰ï¼ŒPushä¸šåŠ¡å®æ—¶æ–¹å‘ä¼˜å…ˆåœ¨æµå¼è®¡ç®—å¼€å‘å¹³å°è½åœ°å®è·µï¼Œè¿™ä¸€å†³ç­–ä¸ä»…å¥‘åˆæµå¼è®¡ç®—åœºæ™¯â€œä½å»¶è¿Ÿã€é«˜ååã€å®æ—¶å¤„ç†â€çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ›´é€šè¿‡åˆ›æ–°çš„å¼€å‘æ–¹å¼å®ç°äº†ä¸šåŠ¡ä»·å€¼çš„é«˜æ•ˆé‡Šæ”¾â€”â€”ç›¸è¾ƒäºä¼ ç»Ÿå¼€å‘æ¨¡å¼ä¸­â€œå¼€å‘-æµ‹è¯•-éƒ¨ç½²-è¿­ä»£â€çš„å†—é•¿é“¾è·¯ï¼Œæ–°æ–¹æ¡ˆå¤§å¹…ç®€åŒ–äº†æµå¼ä»»åŠ¡çš„ç¼–æ’ã€è°ƒè¯•ä¸ä¸Šçº¿æµç¨‹ï¼Œå‡å°‘äº†ç¯å¢ƒé€‚é…ã€ä¾èµ–å†²çªç­‰å†—ä½™ç¯èŠ‚ï¼Œè®©å¼€å‘äººå‘˜èƒ½å¤Ÿèšç„¦æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„è¿­ä»£ä¼˜åŒ–ï¼Œæ— éœ€æŠ•å…¥è¿‡å¤šç²¾åŠ›åœ¨åº•å±‚ç¯å¢ƒæ­å»ºä¸è¿ç»´å·¥ä½œä¸Šã€‚æœ€ç»ˆï¼Œè¿™ä¸€è½åœ°ç­–ç•¥æ˜¾è‘—ç¼©çŸ­äº†ä¸šåŠ¡éœ€æ±‚ä»æå‡ºåˆ°ä¸Šçº¿çš„å‘¨æœŸï¼Œæå¤§æå‡äº†ä¸šåŠ¡æ›´æ–°è¿­ä»£çš„æ•ˆç‡ï¼ŒåŠ©åŠ›ä¸šåŠ¡å¿«é€Ÿå“åº”å¸‚åœºå˜åŒ–ã€è¿­ä»£äº§å“åŠŸèƒ½ï¼ŒåŒæ—¶é™ä½äº†å¼€å‘ä¸è¿ç»´æˆæœ¬ï¼Œä¸ºåç»­åœ¨æ›´å¤šäº‘åŸç”Ÿã€å®æ—¶è®¡ç®—ç›¸å…³ä¸šåŠ¡åœºæ™¯çš„è§„æ¨¡åŒ–æ¨å¹¿å¥ å®šäº†åšå®åŸºç¡€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ebd0cff8e1b45ed830bc03c1d24f91d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769067223&amp;x-signature=ZoJyuSgFUWgt6WMDtry%2BgpMfoJ8%3D" alt="d0a065eea48702679b1166fbabf469a1.png" loading="lazy"/></p>
<h2 data-id="heading-18"><strong>3.4 é™æœ¬å¢æ•ˆä¸æ•æ·è¿­ä»£</strong></h2>
<p>é…ç½®åŒ–å¸¦æ¥çš„ä»·å€¼æ˜¯å¤šç»´ä¸”ç«‹ç«¿è§å½±çš„ï¼Œä¸æˆ‘ä»¬åœ¨èƒŒæ™¯ä¸­è®¨è®ºè¿‡çš„æ ¸å¿ƒæŒ‘æˆ˜ç›¸å‘¼åº”ï¼š</p>
<ul>
<li>
<p><strong>å¤§å¹…é™ä½å¼€å‘é—¨æ§›å’ŒäººåŠ›æˆæœ¬</strong>ï¼šåœ¨æœ‰äº†é…ç½®åŒ–ä¹‹åï¼Œä¸šåŠ¡éƒ¨é—¨æƒ³è¦å¼€å‘æµå¼ä»»åŠ¡ä¾¿ä¸å†éœ€è¦å‘æµå¼éƒ¨é—¨æéœ€ï¼Œåªéœ€è¦ç»è¿‡ç®€å•åŸ¹è®­å³å¯ä¸Šæ‰‹ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†æ²Ÿé€šæˆæœ¬ï¼Œå›¢é˜Ÿçš„äººåŠ›æˆæœ¬å¾—ä»¥æœ‰æ•ˆä¼˜åŒ–ï¼›</p>
</li>
<li>
<p><strong>æ˜¾è‘—æå‡è¿ç»´æ•ˆç‡ä¸ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šæ ‡å‡†åŒ–çš„æ ¸å¿ƒä¼˜åŠ¿å°±æ˜¯é¿å…äº†å¾ˆå¤šäººä¸ºé”™è¯¯ï¼ŒåŒæ—¶ä½œä¸ºæ¨¡æ¿ä¸€å®šæ˜¯ç»è¿‡å¤šæ¬¡è¯•éªŒåçš„æœ€ä½³å®è·µï¼Œèƒ½å¤Ÿä¿éšœä½œä¸šè¿è¡Œçš„åŸºçº¿æ€§èƒ½ã€‚åŒæ—¶ï¼Œç»Ÿä¸€çš„äº¤äº’ç•Œé¢å°†å„ä¸ªæ“ä½œæ¥å£æ”¶å£åˆ°ä¸€ä¸ªå¹³å°ä¸Šï¼Œæå¤§é™ä½äº†æ“ä½œæˆæœ¬ï¼Œç‰ˆæœ¬ç®¡ç†ã€ä½œä¸šå¯åœå˜å¾—è½»è€Œæ˜“ä¸¾ï¼Œæå¤§æå‡äº†è¿ç»´æ•ˆç‡ï¼›</p>
</li>
<li>
<p><strong>æè‡´ä¼˜åŒ–èµ„æºåˆ©ç”¨</strong>ï¼šå£°æ˜å¼çš„èµ„æºé…ç½®è®©æµå¼ç³»ç»Ÿå¯ä»¥æ›´åŠ çµæ´»åœ°è¿›è¡Œèµ„æºæ‰©é€Ÿå®¹è°ƒåº¦å’Œä¼˜åŒ–ï¼Œé¿å…äº†èµ„æºæµªè´¹æˆ–ç“¶é¢ˆï¼›</p>
</li>
<li>
<p><strong>èµ‹èƒ½ä¸šåŠ¡æ•æ·è¿­ä»£</strong>ï¼šä»å‰æ¯ä¸ªç®€å•çš„è¿­ä»£ï¼ˆä¾‹å¦‚å°†è½ç›˜çª—å£ä»5åˆ†é’Ÿä¿®æ”¹æˆ15åˆ†é’Ÿï¼‰éƒ½éœ€è¦èµ°å¼€å‘-æµ‹è¯•-ä¸Šçº¿çš„ç¹çæµç¨‹ï¼Œå¾€å¾€ä¼šè€—æ—¶åŠå¤©è‡³ä¸€å¤©ï¼Œè€Œæœ‰äº†é…ç½®åŒ–åï¼Œä»…ä»…éœ€è¦åœ¨é…ç½®ç•Œé¢ä¿®æ”¹ä¸€ä¸ªå‚æ•°å¹¶é‡æ–°å‘å¸ƒéƒ¨ç½²å³å¯å®ç°ä¿®æ”¹ï¼Œå®ç°äº†çœŸæ­£çš„â€œæ•æ·å¼€å‘â€ï¼Œè®©ä¸šåŠ¡åˆ›æ–°å¿«äººä¸€æ­¥ã€‚</p>
</li>
</ul>
<h2 data-id="heading-19">04 æ€»ç»“ä¸å±•æœ›</h2>
<p>é€šè¿‡æ„å»ºåŸºäº Kubernetes çš„äº‘åŸç”Ÿæµå¼è®¡ç®— PaaS å¹³å°ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†ä¼ ç»Ÿæµå¼ç³»ç»Ÿâ€œå¼€å‘éš¾ã€è¿ç»´é‡ã€æ‰©å±•å¼±â€çš„ä¸‰å¤§ç—›ç‚¹ï¼Œæ›´å®Œæˆäº†ä¸€æ¬¡å¼€å‘èŒƒå¼çš„è·ƒè¿â€”â€”ä»â€œæ‰‹å†™ä»£ç ã€æ‰‹åŠ¨è°ƒä¼˜â€èµ°å‘â€œé…ç½®é©±åŠ¨ã€å¹³å°å…œåº•â€ã€‚å¼€å‘è€…ä¸å†éœ€è¦æ·±é™·äºèµ„æºè°ƒåº¦ã€çŠ¶æ€ç®¡ç†ã€å®¹é”™æœºåˆ¶ç­‰åº•å±‚å¤æ‚æ€§ï¼Œè€Œæ˜¯èšç„¦äºä¸šåŠ¡é€»è¾‘æœ¬èº«ï¼ŒçœŸæ­£å®ç°â€œæ‰€æƒ³å³æ‰€å¾—â€çš„æµå¼åº”ç”¨æ„å»ºä½“éªŒã€‚è¿™ä¸€è½¬å˜çš„èƒŒåï¼Œæ˜¯å¹³å°å°†å¤šå¹´ç§¯ç´¯çš„æµå¼è®¡ç®—æœ€ä½³å®è·µï¼Œä»¥æ ‡å‡†åŒ–ã€è‡ªåŠ¨åŒ–çš„æ–¹å¼å†…åµŒäºæ¶æ„ä¹‹ä¸­ã€‚æ— è®ºæ˜¯æ—¶é—´è¯­ä¹‰çš„ç²¾å‡†å¤„ç†ï¼Œè¿˜æ˜¯ Checkpoint ä¸ Exactly-Once çš„é»˜è®¤ä¿éšœï¼Œå¹³å°éƒ½åœ¨é»˜é»˜æ‰¿æ‹…èµ·â€œä¸“å®¶è§’è‰²â€ï¼Œè®©æ™®é€šå¼€å‘è€…ä¹Ÿèƒ½è½»æ¾é©¾é©­é«˜å¯é ã€é«˜æ€§èƒ½çš„å®æ—¶è®¡ç®—ä»»åŠ¡ã€‚</p>
<p>å±•æœ›æœªæ¥ï¼Œç«‹è¶³äºå½“å‰ç¨³å›ºçš„äº‘åŸç”Ÿåº•åº§ï¼Œå¹³å°çš„æ¼”è¿›è·¯å¾„æ¸…æ™°å¯è§ï¼š</p>
<p>å¼¹æ€§æ™ºèƒ½åŒ–ï¼šå½“å‰åŸºäºå¯è§‚æµ‹å±‚ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡ï¼Œä¸ºå¼•å…¥æ›´ç²¾ç»†çš„è‡ªåŠ¨åŒ–å¼¹æ€§ç­–ç•¥å¥ å®šäº†åšå®åŸºç¡€ã€‚åç»­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢åŸºäºè‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼ˆå¦‚æ°´ä½å»¶è¿Ÿã€CPUä½¿ç”¨ç‡ã€ååé‡æ³¢åŠ¨ï¼‰çš„HPAï¼Œè®©èµ„æºæ‰©ç¼©å®¹èƒ½ç´§è´´çœŸå®ä¸šåŠ¡è´Ÿè½½ï¼Œåœ¨ä¿éšœSLAçš„åŒæ—¶è¿›ä¸€æ­¥ä¼˜åŒ–æˆæœ¬ã€‚</p>
<ul>
<li>
<p>è¿ç»´è‡ªæ²»åŒ–ï¼šåœ¨å¤§æ¨¡å‹èƒ½åŠ›å¿«é€Ÿå‘å±•çš„å½“ä¸‹ï¼ŒåŸºäºå¤šå¹´ç§¯æ·€çš„æµå¼å·¥ç¨‹ç»éªŒæ–¹æ¡ˆï¼Œåœ¨RAGæŠ€æœ¯çš„åŠ æŒä¸‹æ„é€ æµå¼æœåŠ¡è¿ç»´æ™ºèƒ½ä½“ï¼Œå®ç°è¿ç»´è‡ªæ²»åŒ–ã€‚</p>
</li>
<li>
<p>ä½“éªŒæœåŠ¡åŒ–ï¼ˆServerlessï¼‰ï¼šåœ¨é…ç½®åŒ–å¼€å‘ä¹‹ä¸Šï¼Œæœ€ç»ˆæçš„ä½“éªŒæ˜¯è®©ç”¨æˆ·å®Œå…¨æ„ŸçŸ¥ä¸åˆ°åº•å±‚å¼•æ“ä¸åŸºç¡€è®¾æ–½ã€‚æœªæ¥ï¼Œå¹³å°å°†å‘æµå¼è®¡ç®—FaaSï¼ˆFunction-as-a-Serviceï¼‰æ·±åŒ–ï¼Œç”¨æˆ·åªéœ€æäº¤ä¸€æ®µä¸šåŠ¡å¤„ç†å‡½æ•°æˆ–SQLï¼Œå¹³å°å³å¯è‡ªåŠ¨å®Œæˆèµ„æºè°ƒåº¦ã€å¼•æ“é€‰æ‹©ä¸ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå®ç°çœŸæ­£çš„â€œæŒ‰éœ€è®¡ç®—â€ã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»•è¿‡Windows 11å®‰è£…é™åˆ¶ï¼ŒRufuså¸¦ç»™ä½ â€œå¥‡è¿¹â€ï¼Œä½é…ç”µè„‘çš„æ˜¥å¤©]]></title>    <link>https://juejin.cn/post/7115606302167924767</link>    <guid>https://juejin.cn/post/7115606302167924767</guid>    <pubDate>2022-07-02T03:06:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7115606302167924767" data-draft-id="7115605806967422984" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»•è¿‡Windows 11å®‰è£…é™åˆ¶ï¼ŒRufuså¸¦ç»™ä½ â€œå¥‡è¿¹â€ï¼Œä½é…ç”µè„‘çš„æ˜¥å¤©"/> <meta itemprop="keywords" content="èµ„è®¯,Windows"/> <meta itemprop="datePublished" content="2022-07-02T03:06:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åšå­¦çš„è½®èˆ¹Y"/> <meta itemprop="url" content="https://juejin.cn/user/4063416412811351"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»•è¿‡Windows 11å®‰è£…é™åˆ¶ï¼ŒRufuså¸¦ç»™ä½ â€œå¥‡è¿¹â€ï¼Œä½é…ç”µè„‘çš„æ˜¥å¤©
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4063416412811351/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åšå­¦çš„è½®èˆ¹Y
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2022-07-02T03:06:52.000Z" title="Sat Jul 02 2022 03:06:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2022-07-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    461
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h1 data-id="heading-0">Rufus beta ç‰ˆæœ¬ 3.19 æä¾›äº†ä¸€ä¸ªå¯å¯åŠ¨çš„ Windows å®‰è£…ç¨‹åºï¼Œå¯ä»¥è·³è¿‡ Microsoft å¸æˆ·è¦æ±‚ç­‰ã€‚</h1>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d2e31d2e34c455285685cf9a46a4961~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="" loading="lazy"/>Rufus 3.19 Beta åœ¨å¼€å§‹åˆ›å»ºå¯å¯åŠ¨ Windows å®‰è£…ç¨‹åºæ—¶å…·æœ‰é€‰é¡¹<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ä¸å…¶å‰èº«ç›¸æ¯”ï¼ŒWindows 11å…·æœ‰æ›´ä¸¥æ ¼çš„å®‰è£…è¦æ±‚ï¼ŒåŒ…æ‹¬å¯¹æ—§å¤„ç†å™¨çš„é™åˆ¶ä»¥åŠéœ€è¦äº’è”ç½‘è¿æ¥å’ŒMicrosoftå¸æˆ·ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›è§£å†³æ–¹æ³•å…è®¸åœ¨ä¸å—æ”¯æŒçš„CPUä¸Šå‡çº§åˆ°Windows 11ï¼Œå¹¶ä¸”å¾®è½¯å…¬å¸ä¸ä¼šé˜»æ­¢è¿™äº›æ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›ä»…ä½¿ç”¨æœ¬åœ°å¸æˆ·è¿›è¡Œå¹²å‡€çš„Windows 11å®‰è£…å¹¶é…ç½®ç³»ç»Ÿï¼Œé‚£ä¹ˆç°åœ¨å¯ä»¥ä½¿ç”¨åä¸ºRufusçš„å·¥å…·è½»æ¾å®Œæˆæ­¤æ“ä½œã€‚</p>
<p>è¯¥åº”ç”¨é•¿æœŸä»¥æ¥ä¸€ç›´è¢« IT éƒ¨é—¨ç”¨äºå¿«é€Ÿåˆ›å»ºå¯å¯åŠ¨çš„ Windows å®‰è£…ç¨‹åºã€‚æ­£å¦‚<em>Ars Technica</em>æŠ¥é“çš„é‚£æ ·ï¼Œæœ€æ–°çš„æµ‹è¯•ç‰ˆç°åœ¨èƒ½å¤Ÿæ¶ˆé™¤åœ¨çº¿Microsoftå¸æˆ·çš„è¦æ±‚ä»¥åŠå…¶ä»–è§„é¿æªæ–½ã€‚å®ƒå¯ä»¥ç»•è¿‡ç¼ºå°‘ TPM 2.0 çš„è®¡ç®—æœºï¼ˆåŒ…æ‹¬ Intel Macï¼‰ã€RAM å°äº 4GB æˆ– 64GB å­˜å‚¨çš„è®¡ç®—æœºï¼Œè¿˜å¯ä»¥è‡ªåŠ¨ç¦ç”¨æ•°æ®æ”¶é›†ã€‚</p>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä½ ä»éœ€è¦ä½¿è®¡ç®—æœºä¿æŒå®Œå…¨è„±æœºï¼Œä»¥ä¾¿è·³è¿‡ Microsoft å¸æˆ·è¦æ±‚ï¼Œå°±åƒåœ¨ä»¥å‰çš„æ–¹æ³•ä¸­ä¸€æ ·ã€‚ä½†æ˜¯Rufusæ–¹æ³•é€šè¿‡è·³è¿‡æ‰‹åŠ¨æ³¨å†Œè¡¨ç¼–è¾‘ä½¿å®ƒå˜å¾—å®¹æ˜“å¾—å¤šï¼Œè€Œä¸”è¯¥è½¯ä»¶æ˜¯å…è´¹çš„å’Œå¼€æºçš„ã€‚</p>
<p>å¾®è½¯å»å¹´é€šè¿‡è¦æ±‚äº’è”ç½‘è¿æ¥å’ŒMicrosoftå¸æˆ·å‡çº§åˆ°Windows 11 Homeæ—¶æƒ¹æ¼äº†ä¸€äº›ç”¨æˆ·ï¼Œç°åœ¨æœ‰äº†æœ€æ–°çš„22H2æ›´æ–°ï¼Œè¿™äº›é™åˆ¶ä¹Ÿæ‰©å±•åˆ°äº†Windows 11 Proã€‚å¯¹äºé‚£äº›ç»•è¿‡é™åˆ¶çš„äººæ¥è¯´ï¼Œå¾®è½¯å¯èƒ½ä¼šå¼€å§‹åœ¨è¿™äº›æœºå™¨ä¸Šä½¿ç”¨æ°´å°ï¼Œå°±åƒå®ƒå¯¹å¾…Windowsçš„éåºåˆ—åŒ–å®‰è£…ä¸€æ ·ã€‚å¾®è½¯è¿˜å¯ä»¥åœ¨è®¤ä¸ºå¿…è¦æ—¶é˜»æ­¢ä¸å—æ”¯æŒçš„è®¡ç®—æœºä¸Šçš„è½¯ä»¶æ›´æ–°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 ä»£ç è¿›åŒ–è®ºï¼šä»è·Ÿé£ Cursor åˆ°çšˆä¾ Traeï¼Œæˆ‘çš„è¿™ä¸€å¹´]]></title>    <link>https://juejin.cn/post/7595311405751386158</link>    <guid>https://juejin.cn/post/7595311405751386158</guid>    <pubDate>2026-01-15T07:29:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405751386158" data-draft-id="7595311405750976558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 ä»£ç è¿›åŒ–è®ºï¼šä»è·Ÿé£ Cursor åˆ°çšˆä¾ Traeï¼Œæˆ‘çš„è¿™ä¸€å¹´"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-15T07:29:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="akå•Š"/> <meta itemprop="url" content="https://juejin.cn/user/237916932030253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 ä»£ç è¿›åŒ–è®ºï¼šä»è·Ÿé£ Cursor åˆ°çšˆä¾ Traeï¼Œæˆ‘çš„è¿™ä¸€å¹´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237916932030253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    akå•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:29:37.000Z" title="Thu Jan 15 2026 07:29:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2025 ä»£ç è¿›åŒ–è®ºï¼šä»è·Ÿé£ Cursor åˆ°çšˆä¾ Traeï¼Œæˆ‘çš„è¿™ä¸€å¹´</h2>
<p>ç«™åœ¨ 2025 å¹´çš„å°¾å·´ä¸Šå›æœ›ï¼Œè¿™ç»å¯¹æ˜¯ä»£ç ç”Ÿæˆå·¥å…·â€œç¥ä»™æ‰“æ¶â€çš„ä¸€å¹´ã€‚å¦‚æœè¯´å¹´åˆæˆ‘ä»¬è¿˜åœ¨ä¸º AI èƒ½å†™å‡ºä¸€ä¸ª Hello World è€ŒæƒŠå¹ï¼Œé‚£ä¹ˆåˆ°äº†å¹´æœ«ï¼Œå¦‚æœä½ è¿˜æ²¡èƒ½ç†Ÿç»ƒæŒ‡æŒ¥ AI å®Œæˆå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œææ€•åœ¨è¿™ä¸ªè¡Œä¸šé‡Œå·²ç»æ˜¾å¾—æœ‰äº›æ ¼æ ¼ä¸å…¥äº†ã€‚</p>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘çš„ IDE æ¢äº†åˆæ¢ï¼Œå¿ƒæ€å´©äº†åˆå»ºã€‚å¦‚æœè¦é€‰å‡ºä¸€ä¸ªè´¯ç©¿å…¨å¹´çš„å…³é”®è¯ï¼Œé‚£é <strong>Trae</strong> è«å±ã€‚ä»æœ€åˆæŠŠå®ƒå½“ä½œå…è´¹çš„â€œå¤‡èƒâ€ï¼Œåˆ°å¦‚ä»Šå®ƒæˆä¸ºæˆ‘å·¥ä½œä¸­ä¸å¯æˆ–ç¼ºçš„â€œå¤–è„‘â€ï¼Œè¿™ä¸­é—´å‘ç”Ÿçš„æ•…äº‹ï¼Œå¤§æ¦‚ä¹Ÿæ˜¯æ— æ•°å¼€å‘è€…åœ¨ 2025 å¹´çš„ä¸€ä¸ªçœŸå®ç¼©å½±ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ é‚£ä¸ªåä¸º Cursor çš„â€œç™½æœˆå…‰â€</h3>
<p>æ•…äº‹çš„å¼€å§‹ï¼Œæ€»æ˜¯ä¼´éšç€ç›²ç›®çš„ç‹‚çƒ­ã€‚</p>
<p>å¹´åˆçš„æ—¶å€™ï¼ŒæŠ€æœ¯åœˆå‡ ä¹è¢« Cursor åˆ·å±äº†ã€‚æ¨ç‰¹ä¸Šçš„å¤§ V ä»¬ã€æ˜é‡‘çš„åšä¸»ä»¬ï¼Œä»¿ä½›å•†é‡å¥½äº†ä¸€æ ·ï¼Œéƒ½åœ¨ç–¯ç‹‚å®‰åˆ© Cursor æœ‰å¤šç¥ã€æœ‰å¤šç‰›ã€‚é‚£ç§â€œå¦‚æœä½ ä¸ç”¨ Cursorï¼Œä½ å°±å·²ç»è¢«æ—¶ä»£æŠ›å¼ƒäº†â€çš„ç„¦è™‘æ„Ÿï¼Œè£¹æŒŸç€æ¯ä¸€ä¸ªäººã€‚</p>
<p>æˆ‘ä¹Ÿæœªèƒ½å…ä¿—ï¼Œæ»¡æ€€æœŸå¾…åœ°å…¥äº†å‘ã€‚</p>
<p>ä¸å¾—ä¸æ‰¿è®¤ï¼Œåˆšä¸Šæ‰‹çš„ä½“éªŒæ˜¯éœ‡æ’¼çš„ã€‚æˆ‘å°è¯•è®©å®ƒå¸®æˆ‘æ­å»ºä¸€ä¸ª React æŠ€æœ¯æ ˆçš„åå°ç®¡ç†ç³»ç»Ÿã€‚æˆ‘å°±åƒä¸ªç”²æ–¹ä¸€æ ·ï¼Œåªç»™å‡ºäº†æ¨¡ç³Šçš„æŒ‡ä»¤ï¼šâ€œè¦ä¸€ä¸ªå¸¦æƒé™ç®¡ç†çš„ Dashboardï¼Œå·¦ä¾§èœå•ï¼Œå³ä¾§å›¾è¡¨ã€‚â€</p>
<p>çŸ­çŸ­å‡ åç§’ï¼Œæ–‡ä»¶æ ‘ç”Ÿæˆäº†ï¼Œä»£ç å†™å¥½äº†ï¼Œ<code>npm start</code> ä¸€è·‘ï¼Œå±…ç„¶çœŸçš„è·‘èµ·æ¥äº†ï¼é‚£ä¸€åˆ»ï¼Œæˆ‘ç”šè‡³äº§ç”Ÿäº†ä¸€ç§é”™è§‰ï¼š<strong>ç¨‹åºå‘˜çš„è‹¦æ—¥å­ç»“æŸäº†ï¼Œâ€œæŒ‡ä»¤å·¥ç¨‹å¸ˆâ€çš„é»„é‡‘æ—¶ä»£æ¥äº†ã€‚</strong></p>
<p>ç„¶è€Œï¼ŒèœœæœˆæœŸæ€»æ˜¯çŸ­æš‚çš„ã€‚</p>
<p>å½“æˆ‘è¯•å›¾åœ¨è¿™ä¸ªç”Ÿæˆçš„æ¶å­ä¸Šç»§ç»­æ·»ç –åŠ ç“¦ï¼Œä¿®æ”¹å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ–è€…è°ƒæ•´ä¸€äº›éé€šç”¨çš„æ ·å¼æ—¶ï¼ŒCursor å¼€å§‹â€œéœ²æ€¯â€äº†ã€‚å®ƒå¼€å§‹å˜å¾—åƒä¸ªå¬ä¸æ‡‚äººè¯çš„å®ä¹ ç”Ÿï¼Œç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¸Šä¸‹æ–‡å…³è”ï¼Œå®ƒå°±å®¹æ˜“é¡¾å¤´ä¸é¡¾è…šã€‚æˆ‘å¿…é¡»æŠŠéœ€æ±‚æè¿°å¾—åƒä¼ªä»£ç ä¸€æ ·ç»†è‡´ï¼Œå®ƒæ‰èƒ½å‹‰å¼ºè·Ÿä¸Šæˆ‘çš„æ€è·¯ã€‚</p>
<p>æ›´è¦å‘½çš„æ˜¯â€”â€”<strong>è´µ</strong>ã€‚</p>
<p>è¿˜æ²¡çˆ½å‡ æ¬¡ï¼Œé¢åº¦å‘Šæ€¥çš„æç¤ºæ¡†å°±å¼¹äº†å‡ºæ¥ã€‚çœ‹äº†ä¸€çœ¼è®¢é˜…ä»·æ ¼ï¼Œæ¢ç®—æˆäººæ°‘å¸ï¼Œå¯¹äºæˆ‘è¿™ç§æœ‰æ—¶å€™åªæ˜¯æƒ³åšä¸ª Side Project çš„äººæ¥è¯´ï¼Œç¡®å®æ˜¯ä¸€ç¬”ä¸å°çš„å¼€æ”¯ã€‚é‚£ç§æ„Ÿè§‰å°±åƒæ˜¯ï¼Œåˆšå°åˆ°äº†ä¸€å£ç±³å…¶æ—å¤§é¤ï¼ŒæœåŠ¡å‘˜å‘Šè¯‰ä½ åé¢æ¯åƒä¸€å£éƒ½è¦æŒ‰å…‹æ”¶è´¹ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘é€‰æ‹©äº†æ”¾å¼ƒï¼Œé‡æ–°å›åˆ°äº†æ‰‹å†™ä»£ç çš„â€œå†œè€•æ—¶ä»£â€ã€‚</p>
<h3 data-id="heading-2">äºŒã€ Traeï¼šèµ·åˆåªæ˜¯ä¸ºäº†â€œç™½å«–â€</h3>
<p>å°±åœ¨æˆ‘æ„Ÿå¹â€œAI è™½å¥½ï¼Œå¥ˆä½•å›Šä¸­ç¾æ¶©â€çš„æ—¶å€™ï¼Œå­—èŠ‚è·³åŠ¨æ¨å‡ºçš„ Trae è¿›å…¥äº†æˆ‘çš„è§†é‡ã€‚</p>
<p>é‚£æ—¶ Trae åˆšä¸Šçº¿å›½é™…ç‰ˆå†…æµ‹ï¼Œæ¶ˆæ¯åœ¨å°åœˆå­é‡Œæµä¼ ã€‚æˆ‘æŠ±ç€â€œè¯•ä¸€è¯•åˆä¸ä¼šæ€€å­•â€çš„å¿ƒæ€ï¼Œæœæ–­ç”³è¯·äº†å†…æµ‹èµ„æ ¼ã€‚åˆä½“éªŒä¸‹æ¥çš„æ„Ÿè§‰æ˜¯ï¼š<strong>æœ‰ç‚¹ä¸œè¥¿ï¼Œä½†ä¸å¤šã€‚</strong></p>
<p>å®ƒèƒ½ç”¨ï¼Œä»£ç ç”Ÿæˆçš„è´¨é‡ä¹Ÿè¿˜è¡Œï¼Œä½†åœ¨äº¤äº’çš„ä¸æ»‘åº¦å’Œå¯¹ä¸Šä¸‹æ–‡çš„ç†è§£ä¸Šï¼Œæ˜æ˜¾æ„Ÿè§‰æ¯” Cursor ç¨å¾®â€œç¬¨â€äº†ä¸€ç‚¹ç‚¹ã€‚é‚£ç§æ„Ÿè§‰å¾ˆå¾®å¦™ï¼Œå°±åƒæ˜¯ç”¨æƒ¯äº†è‹¹æœæ‰‹æœºçªç„¶æ¢åˆ°äº†æ—©æœŸçš„å®‰å“æ——èˆ°ï¼Œå‚æ•°æ²¡è¾“ï¼Œä½†æ‰‹æ„Ÿå·®ç‚¹æ„æ€ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<strong>å®ƒæ˜¯å…è´¹çš„ã€‚</strong></p>
<p>åœ¨â€œå…è´¹â€è¿™ä¸ªå·¨å¤§çš„å…‰ç¯ä¸‹ï¼Œæ‰€æœ‰çš„ç¼ºç‚¹éƒ½å˜å¾—å¯ä»¥åŸå¿å—äº†ã€‚æˆ‘åƒæ¡åˆ°äº†å®ä¸€æ ·ï¼ŒæŠŠ Trae è£…è¿›äº†æˆ‘çš„ç”µè„‘ã€‚è™½ç„¶å¿ƒé‡Œä¾ç„¶è§‰å¾— Cursor æ˜¯é‚£ä¸ªé¥ä¸å¯åŠçš„â€œç™½æœˆå…‰â€ï¼Œä½† Trae å´æ˜¯é‚£ä¸ªèƒ½è¸è¸å®å®é™ªæˆ‘è¿‡æ—¥å­çš„â€œç³Ÿç³ ä¹‹å¦»â€ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€ é€ è½®å­çš„é˜µç—›ä¸ç“¶é¢ˆ</h3>
<p>æ—¶é—´çš„æŒ‡é’ˆæ‹¨åˆ°å¹´ä¸­ã€‚é‚£æ—¶ï¼Œæˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªç±»ä¼¼ Manus çš„é€šç”¨æ€§æ¨¡å—ï¼Œè¯•å›¾æ¢ç´¢ä¸€äº›è‡ªåŠ¨åŒ–çš„æ–°è¾¹ç•Œã€‚</p>
<p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¡åœ¨äº†ä¸€ä¸ªéå¸¸å…·ä½“çš„ç¯èŠ‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªç‰¹å®šçš„æ’ä»¶æ¥å¤„ç†æŸç§æ•°æ®æµï¼Œç¿»éäº† GitHub å’Œ npmï¼Œå±…ç„¶æ‰¾ä¸åˆ°ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>â€œæ—¢ç„¶æ‰¾ä¸åˆ°ï¼Œé‚£å°±è‡ªå·±é€ ä¸€ä¸ªå§ã€‚â€</p>
<p>è¿™ä¸ªå¿µå¤´ä¸€å‡ºï¼Œæˆ‘ä¸‹æ„è¯†åœ°æ‰“å¼€äº† Traeã€‚è¿™ä¸€æ¬¡ï¼Œä¸æ˜¯ç®€å•çš„ CRUDï¼Œè€Œæ˜¯è¦ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªç¬¦åˆè§„èŒƒã€é€»è¾‘ä¸¥å¯†çš„æ’ä»¶ã€‚</p>
<p>è¿‡ç¨‹æ¯”æˆ‘æƒ³è±¡çš„è¦æ›²æŠ˜ã€‚æˆ‘ä¸å¾—ä¸åŒ–èº«ä¸ºæœ€æœ‰è€å¿ƒçš„â€œäº§å“ç»ç†â€ï¼Œä¸€éåˆä¸€éåœ°å‘ Trae æè¿°æˆ‘çš„éœ€æ±‚ï¼šâ€œè¿™é‡Œéœ€è¦ç”¨è¿™ç§è®¾è®¡æ¨¡å¼â€ã€â€œé‚£ä¸ªæ¥å£çš„å‚æ•°å¿…é¡»æ˜¯è¿™æ ·çš„æ ¼å¼â€ã€‚</p>
<p>åœ¨æ— æ•°æ¬¡çš„å¯¹è¯ã€å›æ»šã€å†ç”Ÿæˆä¹‹åï¼Œè¿™ä¸ªæ’ä»¶ç»ˆäºè·‘é€šäº†ï¼Œå¹¶ä¸”æˆåŠŸå‘å¸ƒåˆ°äº† npm ä¸Šã€‚çœ‹ç€ npm ä¸Šé‚£ä¸ªå±äºæˆ‘çš„åŒ…ï¼Œæˆ‘å¿ƒé‡Œæ˜¯æœ‰ä¸€ä¸æˆå°±æ„Ÿçš„â€”â€”æ¯•ç«Ÿï¼Œè¿™æ˜¯æˆ‘å’Œ AI ç»“å¯¹ç¼–ç¨‹çš„äº§ç‰©ã€‚</p>
<p>ä½†éšä¹‹è€Œæ¥çš„æ˜¯æ›´æ·±çš„<strong>ç–²æƒ«æ„Ÿ</strong>ã€‚</p>
<p>æˆ‘å‘ç°ï¼Œè™½ç„¶ Trae å¸®æˆ‘å†™äº†ä»£ç ï¼Œä½†æˆ‘èŠ±è´¹åœ¨â€œæè¿°éœ€æ±‚â€å’Œâ€œReview ä»£ç â€ä¸Šçš„ç²¾åŠ›ï¼Œä¼¼ä¹å¹¶æ²¡æœ‰æ¯”æˆ‘è‡ªå·±å†™å°‘å¤šå°‘ã€‚å¯¹äºè¿™ç§ç¨å¾®æœ‰äº›æ·±åº¦çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œå½“æ—¶çš„ Trae æ˜¾å¾—æœ‰äº›åŠ›ä¸ä»å¿ƒã€‚å®ƒå°±åƒä¸€ä¸ªå‹¤å¥‹ä½†ç¼ºä¹çµæ€§çš„åŠ©æ‰‹ï¼Œä½ æ¨ä¸€ä¸‹ï¼Œå®ƒåŠ¨ä¸€ä¸‹ã€‚</p>
<p>é‚£æ—¶å€™æˆ‘éšçº¦æ„Ÿè§‰åˆ°äº†ç“¶é¢ˆï¼šå¦‚æœä½¿ç”¨ AI çš„æˆæœ¬ï¼ˆæ²Ÿé€šæˆæœ¬ + ä¿®æ­£æˆæœ¬ï¼‰é€¼è¿‘äº†ç›´æ¥ç¼–ç çš„æˆæœ¬ï¼Œé‚£å®ƒçš„ä»·å€¼åˆ°åº•åœ¨å“ªé‡Œï¼Ÿå› ä¸ºè¿™ä¸ªåŸå› ï¼Œé‚£æ®µæ—¶é—´æˆ‘å¹¶æ²¡æœ‰æŠŠ Trae å®Œå…¨åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<h3 data-id="heading-4">å››ã€ è‹¦ç­‰â€œæœ€å¼ºå¤§è„‘â€çš„æ—¥å­</h3>
<p>è½¬æœºæ¥è‡ªäºæ¨¡å‹å±‚çš„çªç ´ï¼Œä½†è¿‡ç¨‹å¹¶éä¸€å¸†é£é¡ºã€‚</p>
<p>ä¸‹åŠå¹´ï¼Œ<strong>Gemini 3 Pro</strong> æ¨ªç©ºå‡ºä¸–ã€‚å®ç‰è€å¸ˆç­‰å‡ ä½æˆ‘å…³æ³¨çš„æŠ€æœ¯å¤§ V å¼€å§‹åœ¨ç¤¾äº¤åª’ä½“ä¸Šç–¯ç‹‚å±•ç¤º Gemini 3 Pro çš„å¼ºå¤§èƒ½åŠ›ã€‚</p>
<p>ä¸ä»¥å¾€æ¨¡å‹ä¸åŒï¼Œå®ƒå±•ç°å‡ºçš„ä¸ä»…ä»…æ˜¯è®°å¿†åŠ›ï¼Œè€Œæ˜¯<strong>è¶…å¼ºçš„ Coding èƒ½åŠ›</strong>ã€‚é‚£ç§å¯¹ä»£ç é€»è¾‘çš„æ·±å±‚ç†è§£ã€å¯¹æ¶æ„æ¨¡å¼çš„ç²¾å‡†æŠŠæ§ï¼Œä»¥åŠå‡ ä¹ä¸ºé›¶çš„åºŸè¯ï¼Œå®Œå…¨å‡»ä¸­äº†ç¨‹åºå‘˜çš„ç—›ç‚¹ã€‚</p>
<p>æˆ‘è·Ÿç€ä»–ä»¬çš„æ€è·¯ï¼Œåœ¨ Google AI Studio é‡Œè¯•ç”¨äº†å‡ æ¬¡ï¼Œç¬é—´è¢«æŠ˜æœäº†ã€‚é‚£ç§â€œå¿ƒæœ‰çµçŠ€â€çš„æ„Ÿè§‰ï¼Œæ˜¯ä¹‹å‰çš„æ¨¡å‹æ‰€ä¸å…·å¤‡çš„ã€‚å®ƒä¸ä»…ä»…æ˜¯åœ¨è¡¥å…¨ä»£ç ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªæ‹¥æœ‰åå¹´ç»éªŒçš„èµ„æ·±å·¥ç¨‹å¸ˆåœ¨ä¸ä½ ç»“å¯¹ç¼–ç¨‹ã€‚</p>
<p>é‚£ä¸€åˆ»ï¼Œæˆ‘è„‘å­é‡Œåªæœ‰ä¸€ä¸ªæƒ³æ³•ï¼š<strong>å¦‚æœèƒ½æŠŠè¿™ä¸ªæ‹¥æœ‰é¡¶çº§ Coding èƒ½åŠ›çš„å¤§è„‘ï¼Œè£…è¿› Trae çš„èº«ä½“é‡Œï¼Œè¯¥å¤šå¥½ï¼Ÿ</strong></p>
<p>åœ¨ Trae æ­£å¼ä¸Šçº¿ Gemini 3 Pro ä¹‹å‰ï¼Œæˆ‘åº¦è¿‡äº†ä¸€æ®µæå…¶éš¾ç†¬çš„â€œç©ºçª—æœŸâ€ã€‚æˆ‘åƒä¸ªæ— å¤´è‹è‡ä¸€æ ·å°è¯•äº†å„ç§å·¥å…·ï¼šAntigravityã€QCoderï¼Œç”šè‡³æ˜¯ä¸€äº›ä¸çŸ¥åçš„å¼€æºå°è£…ã€‚</p>
<p>ç»“æœéƒ½ä¸å°½å¦‚äººæ„ã€‚æœ‰çš„å·¥å…·è™½ç„¶æ¥å…¥äº†æ¨¡å‹ï¼Œä½† IDE çš„åŸºç¡€åŠŸèƒ½å¤ªçƒ‚ï¼›æœ‰çš„åˆ™æ˜¯ç½‘ç»œè¿æ¥ä¸ç¨³å®šã€‚è¶Šæ˜¯å¯¹æ¯”ï¼Œæˆ‘è¶Šè§‰å¾— Trae çš„åº•å­å…¶å®æ˜¯å¥½çš„â€”â€”äº¤äº’æµç•…ã€ç”šè‡³åŸç”Ÿï¼Œå®ƒç¼ºçš„ï¼Œå°±æ˜¯è¿™é¢—è¶³å¤Ÿå¼ºå¤§çš„â€œèŠ¯â€ã€‚</p>
<h3 data-id="heading-5">äº”ã€ å¿µå¿µä¸å¿˜ï¼Œå¿…æœ‰å›å“</h3>
<p>é‚£ç§æœŸå¾…ï¼Œé€æ¸å˜æˆäº†ä¸€ç§æ—¥é¡¾ä¸€æ¬¡çš„æ‰§å¿µã€‚</p>
<p>æ¯å¤©æ‰“å¼€ Trae çš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯ä¹ æƒ¯æ€§åœ°å»è®¾ç½®é‡Œç‚¹å¼€æ¨¡å‹åˆ—è¡¨çœ‹ä¸€çœ¼ï¼Œç”Ÿæ€•é”™è¿‡äº†ä»€ä¹ˆã€‚</p>
<p>ç»ˆäºï¼Œåœ¨ä¸€ä¸ªæ™®é€šçš„æ¸…æ™¨ï¼Œå½“æˆ‘å†æ¬¡æƒ¯æ€§åœ°å±•å¼€é‚£ä¸ªä¸‹æ‹‰èœå•æ—¶ï¼Œ<strong>Gemini 3 Pro</strong> çš„é€‰é¡¹èµ«ç„¶åœ¨åˆ—ï¼Œé™é™åœ°èººåœ¨é‚£é‡Œã€‚æ²¡æœ‰é“ºå¤©ç›–åœ°çš„å¼¹çª—å¹¿å‘Šï¼Œæ²¡æœ‰å¤§å¼ æ——é¼“çš„ Update Logï¼Œå®ƒå°±é‚£æ ·ä¸Šçº¿äº†ã€‚</p>
<p>æˆ‘æ·±å¸ä¸€å£æ°”ï¼Œæœæ–­åˆ‡æ¢ï¼Œé‡å¯ã€‚</p>
<p>ä¸ºäº†éªŒè¯å®ƒçš„èƒ½åŠ›ï¼Œæˆ‘å†³å®šåšä¸€ä¸ªçº¯ç²¹çš„å®éªŒâ€”â€”å¼€å‘ä¸€æ¬¾ Rogue å°æ¸¸æˆã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘å†³å®šåšä¸€ä¸ªâ€œç”©æ‰‹æŒæŸœâ€ã€‚æˆ‘æ²¡æœ‰å†™ä¸€è¡Œä»£ç ï¼Œåªæ˜¯åƒè®²æ•…äº‹ä¸€æ ·æè¿°äº†æ¸¸æˆçš„è§„åˆ™ã€åœ°ç‰¢çš„ç”Ÿæˆç®—æ³•ã€‚</p>
<p>Gemini 3 Pro å±•ç°å‡ºçš„<strong>è¶…å¼º Coding èƒ½åŠ›</strong>ç«‹åˆ»æ˜¾éœ²æ— ç–‘ã€‚å®ƒæ²¡æœ‰ç”Ÿæˆä¸€å †éœ€è¦æˆ‘ä¿®ä¿®è¡¥è¡¥çš„çƒ‚ä»£ç ï¼Œè€Œæ˜¯ç›´æ¥ç»™å‡ºäº†ç»“æ„æ¸…æ™°ã€é€»è¾‘ä¸¥å¯†çš„æ ¸å¿ƒå®ç°ã€‚ç”šè‡³åœ¨å¤„ç†å¤æ‚çš„ç¢°æ’æ£€æµ‹ç®—æ³•æ—¶ï¼Œå®ƒè¡¨ç°å‡ºçš„é€»è¾‘æ¨æ¼”èƒ½åŠ›ï¼Œå®Œå…¨æ˜¯ä¸€ä¸ªå¤§æ¨¡å‹è‡ªä¸»ç ”å‘çš„é«˜å…‰æ—¶åˆ»ã€‚</p>
<p>çœ‹ç€å±å¹•ä¸Šçš„å°äººåœ¨åœ°ç‰¢é‡Œç©¿æ¢­æ”»å‡»ï¼Œæˆ‘çŸ¥é“ï¼Œ<strong>Trae ç»ˆäºè¡¥é½äº†æœ€åä¸€å—çŸ­æ¿ï¼Œå®Œå…¨ä½“æ¥äº†ã€‚</strong></p>
<h3 data-id="heading-6">å…­ã€ ç”Ÿäº§ç¯å¢ƒä¸­çš„â€œäººå‰‘åˆä¸€â€</h3>
<p>æ¸¸æˆåªæ˜¯ç©å…·ï¼ŒçœŸæ­£çš„æˆ˜åœºåœ¨å·¥ä½œã€‚</p>
<p>éšç€ä¿¡ä»»æ„Ÿçš„å»ºç«‹ï¼Œæˆ‘å¼€å§‹å°† Trae å…¨é¢å¼•å…¥æ—¥å¸¸çš„ç”Ÿäº§ç¯å¢ƒã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ‘¸ç´¢å‡ºäº†ä¸€å¥—<strong>åŠ¨æ€åˆ‡æ¢</strong>çš„å¿ƒæ³•ï¼Œè®©å®ƒçœŸæ­£èå…¥äº†æˆ‘çš„è‚Œè‚‰è®°å¿†ã€‚</p>
<p>Trae çš„è®¾è®¡éå¸¸ç²¾å¦™ï¼Œå®ƒå¹¶æ²¡æœ‰è¯•å›¾ç”¨ä¸€ç§æ¨¡å¼è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œè€Œæ˜¯æä¾›äº†<strong>æ™®é€šå¯¹è¯æ¨¡å¼ (Chat)</strong> å’Œ <strong>Solo æ¨¡å¼</strong> ä¸¤ç§æˆªç„¶ä¸åŒçš„è·¯å¾„ã€‚</p>
<p>é¢å¯¹æ—¥å¸¸çš„â€œå¿«é—®å¿«ç­”â€ï¼Œæ¯”å¦‚ç®€å•çš„çº¯å‡½æ•°ç¼–å†™ã€é€»è¾‘å’¨è¯¢ã€å•å…ƒæµ‹è¯•è¡¥å……ï¼Œæˆ–è€…æ˜¯å¯¹å±€éƒ¨ç»„ä»¶çš„å¿«é€Ÿä¼˜åŒ–ï¼Œæˆ‘ä¼šæ¯«ä¸çŠ¹è±«åœ°ä½¿ç”¨<strong>æ™®é€šå¯¹è¯æ¨¡å¼</strong>ã€‚å®ƒååº”è¿…é€Ÿã€äº¤äº’ç›´æ¥ï¼Œå°±åƒèº«è¾¹åç€ä¸€ä½éšæ—¶å¾…å‘½çš„åŒäº‹ï¼Œä½ é—®ä¸€å¥ï¼Œä»–å›ä¸€å¥ï¼Œè§£å†³é—®é¢˜å¿«å‡†ç‹ ï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™çš„åŠ¨ä½œã€‚</p>
<p>ä½†å½“ä»»åŠ¡æ¶‰åŠåˆ°å¤šæ–‡ä»¶ä¿®æ”¹ã€å¤æ‚çš„ç³»ç»Ÿé‡æ„ï¼Œæˆ–è€…éœ€è¦ä»å¤´å®ç°ä¸€ä¸ªå®Œæ•´çš„ Feature æ—¶ï¼Œ<strong>Solo æ¨¡å¼</strong> å°±æˆäº†æˆ‘çš„æ€æ‰‹é”ã€‚</p>
<p>Solo æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>é•¿å·¥ä½œæµï¼ˆLong Workflowï¼‰</strong> ã€‚å¼€å¯è¿™ä¸ªæ¨¡å¼åï¼ŒTrae å°±åƒå˜äº†ä¸€ä¸ªäººã€‚å®ƒä¸å†æ€¥äºåå‡ºä»£ç ï¼Œè€Œæ˜¯è¿›å…¥äº†ä¸€ç§â€œè‡ªä¸»é—­ç¯â€çš„çŠ¶æ€ï¼šå…ˆåˆ†ææ•´ä¸ªé¡¹ç›®çš„ä¸Šä¸‹æ–‡ï¼Œè§„åˆ’ä¿®æ”¹è·¯å¾„ï¼Œç„¶åä¸€æ­¥æ­¥æ‰§è¡Œã€éªŒè¯ã€è‡ªæˆ‘ä¿®æ­£ã€‚è¿™ç§â€œè°‹å®šè€ŒååŠ¨â€çš„èƒ½åŠ›ï¼Œæå¤§ç¨‹åº¦åœ°å‡å°‘äº†ç ´ååŸæœ‰é€»è¾‘çš„é£é™©ï¼ŒçœŸæ­£å®ç°äº†ä»â€œè¾…åŠ©å†™ä»£ç â€åˆ°â€œè‡ªä¸»å®Œæˆä»»åŠ¡â€çš„è·¨è¶Šã€‚</p>
<p>è€Œè®© Solo æ¨¡å¼å¦‚è™æ·»ç¿¼çš„ï¼Œæ˜¯å¯¹ <strong>MCP (Model Context Protocol)</strong> çš„æ·±å…¥åº”ç”¨ã€‚</p>
<p>è¯´å®è¯ï¼Œä»¥å‰æˆ‘å¯¹ MCP è¿™ç§çœ‹èµ·æ¥é«˜å¤§ä¸Šçš„ç¼©å†™å¹¶ä¸æ„Ÿå†’ï¼Œä½†çœŸçš„é’»ç ”è¿›å»åï¼Œæ‰å‘ç°å®ƒç®€ç›´æ˜¯æ‰“é€šä»»ç£äºŒè„‰çš„ç¥å™¨ã€‚é€šè¿‡å°† MCP æ·±åº¦ç»‘å®šåˆ° Solo æ¨¡å¼ä¸­ï¼Œæˆ‘å®ç°äº†ä¸¤ä¸ªè®©åŒäº‹ç›®çªå£å‘†çš„å·¥ä½œæµï¼š</p>
<ol>
<li><strong>Figma to Code çš„åƒç´ çº§è¿˜åŸ</strong>ï¼šæˆ‘ä¸å†éœ€è¦ç›¯ç€è®¾è®¡å›¾ä¸€ä¸ªä¸ªé‡é—´è·ã€‚é€šè¿‡ MCP è¿æ¥ Figmaï¼ŒSolo æ¨¡å¼èƒ½ç›´æ¥è¯»å–è®¾è®¡æºæ•°æ®ï¼Œç”Ÿæˆçš„ä»£ç è¿˜åŸåº¦é«˜åˆ°è¿ UI è®¾è®¡å¸ˆéƒ½æŒ‘ä¸å‡ºæ¯›ç—…ã€‚</li>
<li><strong>DevTools çš„æ·±åº¦ä»‹å…¥</strong>ï¼šç›´æ¥è®© Trae è¯»å–æµè§ˆå™¨çš„è°ƒè¯•ä¿¡æ¯ã€‚æŠ¥é”™äº†ï¼Ÿä¸éœ€è¦æˆ‘å¤åˆ¶ç²˜è´´ï¼Œå®ƒè‡ªå·±çœ‹ Consoleï¼Œè‡ªå·±å®šä½ DOMï¼Œè‡ªå·±ä¿®æ”¹ä»£ç ã€‚</li>
</ol>
<p>è¿™ç§ä½“éªŒï¼Œå·²ç»è¶…è¶Šäº†ä¼ ç»Ÿçš„ç¼–ç¨‹è¾…åŠ©ï¼Œæ›´åƒæ˜¯åœ¨é©¾é©¶ä¸€å°é«˜åº¦è‡ªåŠ¨åŒ–çš„æœºç”²ã€‚</p>
<h3 data-id="heading-7">ä¸ƒã€ ç»“è¯­ï¼šå›ä¸å»çš„æ—§æ—¶å…‰</h3>
<p>ç°åœ¨ï¼Œæˆ‘çš„å·¥ä½œæµå·²ç»å®Œå…¨é‡æ„ã€‚æ‰“å¼€ç”µè„‘çš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å”¤é†’ Traeã€‚</p>
<p>ä»æœ€åˆè·Ÿé£ Cursor çš„ç‹‚çƒ­ï¼Œåˆ°å› è´«ç©·å’Œç“¶é¢ˆè€Œè½¬å‘ Traeï¼Œå†åˆ°ä¸­é—´é€ è½®å­çš„è¿·èŒ«ï¼Œæœ€åå› ä¸º Gemini 3 Pro å’Œ MCP çš„åŠ æŒè€Œå½»åº•çšˆä¾ã€‚è¿™ä¸€è·¯èµ°æ¥ï¼Œä¸ä»…ä»…æ˜¯å·¥å…·çš„é€‰æ‹©ï¼Œæ›´æ˜¯å¯¹ AI ç¼–ç¨‹è®¤çŸ¥çš„ä¸æ–­å‡çº§ã€‚</p>
<p>ä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©äº† Traeï¼Ÿ</p>
<p>é™¤äº†å®ƒä¾ç„¶ä¿æŒç€æé«˜çš„æ€§ä»·æ¯”ï¼ˆè¿™ä¸€ç‚¹åœ¨é™æœ¬å¢æ•ˆçš„å¤§ç¯å¢ƒä¸‹å¤ªé‡è¦äº†ï¼‰ä¹‹å¤–ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒå±•ç°å‡ºçš„é‚£ç§<strong>åŒ…å®¹æ€§å’Œè¿›åŒ–é€Ÿåº¦</strong>ã€‚</p>
<p>2025 å¹´è¿‡å»äº†ï¼Œæˆ‘å¾ˆåº†å¹¸è‡ªå·±æ²¡æœ‰åœ¨æ—©æœŸçš„æ³¡æ²«ä¸­è¿·å¤±ï¼Œä¹Ÿæ²¡æœ‰åœ¨ç“¶é¢ˆæœŸæ”¾å¼ƒã€‚å¦‚ä»Šï¼ŒTrae å¯¹æˆ‘æ¥è¯´ï¼Œä¸å†ä»…ä»…æ˜¯ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œå®ƒæ˜¯æˆ‘çš„æ­æ¡£ï¼Œæˆ‘çš„å¤–è„‘ï¼Œæ˜¯æˆ‘åœ¨ä»£ç ä¸–ç•Œé‡ŒæŠ«è†æ–©æ£˜çš„æœ€å¼ºåº•æ°”ã€‚</p>
<p>å¦‚æœç°åœ¨çš„ä½ è¿˜åœ¨å„ç§å·¥å…·ä¹‹é—´çŠ¹è±«å¾˜å¾Šï¼Œä¸å¦¨ç»™ Traeï¼Œä¹Ÿç»™ Gemini 3 Pro ä¸€ä¸ªæœºä¼šã€‚ç›¸ä¿¡æˆ‘ï¼Œå½“ä½ ä½“éªŒè¿‡é‚£ç§â€œå¿ƒæƒ³ç æˆâ€çš„å¿«æ„Ÿåï¼Œä½ å°±å†ä¹Ÿå›ä¸å»äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue Router å‚æ•°ä¼ é€’ï¼šparams vs query æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7595341943338270730</link>    <guid>https://juejin.cn/post/7595341943338270730</guid>    <pubDate>2026-01-15T07:41:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595341943338270730" data-draft-id="7595365551606825011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue Router å‚æ•°ä¼ é€’ï¼šparams vs query æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-15T07:41:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue Router å‚æ•°ä¼ é€’ï¼šparams vs query æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:41:05.000Z" title="Thu Jan 15 2026 07:41:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue Router å‚æ•°ä¼ é€’ï¼šparams vs query æ·±åº¦è§£æ</h2>
<blockquote>
<p>åœ¨ Vue Router ä¸­ä¼ é€’å‚æ•°æ—¶ï¼Œä½ æ˜¯å¦æ›¾å›°æƒ‘è¯¥ç”¨ <code>params</code> è¿˜æ˜¯ <code>query</code>ï¼Ÿè¿™ä¸¤ç§çœ‹ä¼¼ç›¸ä¼¼çš„æ–¹å¼ï¼Œå…¶å®æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å½»åº•ææ¸…æ¥šå®ƒä»¬çš„å·®å¼‚å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€æ¦‚å¿µå¯¹æ¯”</h3>
<h4 data-id="heading-2">1.1 URL æ ¼å¼å·®å¼‚</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// params æ–¹å¼</span>
<span class="hljs-attr">http</span>:<span class="hljs-comment">//example.com/user/123</span>
<span class="hljs-comment">// å¯¹åº”è·¯ç”±ï¼š/user/:id</span>

<span class="hljs-comment">// query æ–¹å¼  </span>
<span class="hljs-attr">http</span>:<span class="hljs-comment">//example.com/user?id=123</span>
<span class="hljs-comment">// å¯¹åº”è·¯ç”±ï¼š/user</span>
</code></pre>
<h4 data-id="heading-3">1.2 è·¯ç”±å®šä¹‰æ–¹å¼</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// paramsï¼šå¿…é¡»åœ¨è·¯ç”±è·¯å¾„ä¸­å£°æ˜</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>,          <span class="hljs-comment">// å¿…é¡»å£°æ˜å‚æ•°å</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserDetail</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/post/:postId/comment/:commentId'</span>,  <span class="hljs-comment">// å¤šä¸ªå‚æ•°</span>
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">PostComment</span>
  }
]

<span class="hljs-comment">// queryï¼šæ— éœ€åœ¨è·¯ç”±è·¯å¾„ä¸­å£°æ˜</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,              <span class="hljs-comment">// ç›´æ¥å®šä¹‰è·¯å¾„</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">'User'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">User</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/search'</span>,            <span class="hljs-comment">// ä¸éœ€è¦å£°æ˜å‚æ•°</span>
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Search</span>
  }
]
</code></pre>
<h3 data-id="heading-4">äºŒã€æ ¸å¿ƒåŒºåˆ«è¯¦è§£</h3>
<h4 data-id="heading-5">2.1 å®šä¹‰æ–¹å¼ä¸å¿…é€‰æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// paramsï¼šè·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯å¿…é€‰çš„</span>
{
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/product/:category/:id'</span>,  <span class="hljs-comment">// ä¸¤ä¸ªå¿…é€‰å‚æ•°</span>
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">ProductDetail</span>
}

<span class="hljs-comment">// è®¿é—®æ—¶å¿…é¡»æä¾›æ‰€æœ‰å‚æ•°</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/product/electronics/123'</span>)  <span class="hljs-comment">// âœ… æ­£ç¡®</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/product/electronics'</span>)      <span class="hljs-comment">// âŒ é”™è¯¯ï¼šç¼ºå°‘idå‚æ•°</span>

<span class="hljs-comment">// queryï¼šå¯é€‰çš„æŸ¥è¯¢å­—ç¬¦ä¸²</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/search'</span>)                    <span class="hljs-comment">// âœ… å¯ä»¥ä¸ä¼ å‚æ•°</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/search?keyword=vue'</span>)        <span class="hljs-comment">// âœ… å¯ä»¥ä¼ ä¸€ä¸ª</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/search?keyword=vue&amp;page=2&amp;sort=desc'</span>)  <span class="hljs-comment">// âœ… å¯ä»¥ä¼ å¤šä¸ª</span>
</code></pre>
<h4 data-id="heading-6">2.2 å‚æ•°è·å–æ–¹å¼</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­è·å–å‚æ•°</span>
<span class="hljs-comment">// params è·å–æ–¹å¼</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
    <span class="hljs-comment">// params æ˜¯å“åº”å¼çš„ï¼</span>
    <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
    
    <span class="hljs-comment">// å¯¹äºå‘½åè·¯ç”±ï¼Œè¿˜å¯ä»¥è¿™æ ·è·å–</span>
    <span class="hljs-keyword">const</span> { params } = route
    
    <span class="hljs-keyword">return</span> { userId }
  },
  
  <span class="hljs-comment">// é€‰é¡¹å¼API</span>
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
  }
}

<span class="hljs-comment">// query è·å–æ–¹å¼</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
    <span class="hljs-comment">// query ä¹Ÿæ˜¯å“åº”å¼çš„ï¼</span>
    <span class="hljs-keyword">const</span> keyword = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">query</span>.<span class="hljs-property">keyword</span>)
    <span class="hljs-keyword">const</span> page = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">query</span>.<span class="hljs-property">page</span> || <span class="hljs-string">'1'</span>)  <span class="hljs-comment">// é»˜è®¤å€¼å¤„ç†</span>
    
    <span class="hljs-comment">// ç±»å‹è½¬æ¢ï¼šquery å‚æ•°æ°¸è¿œæ˜¯å­—ç¬¦ä¸²</span>
    <span class="hljs-keyword">const</span> pageNum = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">parseInt</span>(route.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>)
    
    <span class="hljs-keyword">return</span> { keyword, pageNum }
  }
}
</code></pre>
<h4 data-id="heading-7">2.3 ç¼–ç¨‹å¼å¯¼èˆªå·®å¼‚</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// params çš„å¤šç§ä¼ é€’æ–¹å¼</span>
<span class="hljs-comment">// æ–¹å¼1ï¼šè·¯å¾„å­—ç¬¦ä¸²</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/user/123'</span>)

<span class="hljs-comment">// æ–¹å¼2ï¼šå¸¦paramsçš„å¯¹è±¡</span>
router.<span class="hljs-title function_">push</span>({ 
  <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>,  <span class="hljs-comment">// å¿…é¡»ä½¿ç”¨å‘½åè·¯ç”±ï¼</span>
  <span class="hljs-attr">params</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }
})

<span class="hljs-comment">// æ–¹å¼3ï¼šå¸¦pathå’Œparamsï¼ˆä¸æ¨èï¼‰</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/123'</span>    <span class="hljs-comment">// å¦‚æœæä¾›äº†pathï¼Œparamsä¼šè¢«å¿½ç•¥ï¼</span>
  <span class="hljs-comment">// params: { id: 456 }  // âš ï¸ è¿™ä¼šè¢«å¿½ç•¥ï¼</span>
})

<span class="hljs-comment">// query çš„ä¼ é€’æ–¹å¼</span>
<span class="hljs-comment">// æ–¹å¼1ï¼šè·¯å¾„å­—ç¬¦ä¸²</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/user?id=123'</span>)

<span class="hljs-comment">// æ–¹å¼2ï¼šå¸¦queryçš„å¯¹è±¡</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,      <span class="hljs-comment">// å¯ä»¥ç”¨path</span>
  <span class="hljs-attr">query</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }
})

router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'User'</span>,       <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç”¨name</span>
  <span class="hljs-attr">query</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }
})
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-9">3.1 params çš„å…¸å‹åœºæ™¯</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœºæ™¯1ï¼šèµ„æºè¯¦æƒ…é¡µï¼ˆRESTfulé£æ ¼ï¼‰</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/articles/:articleId'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ArticleDetail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">ArticleDetail</span>,
    <span class="hljs-attr">props</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// å¯ä»¥å°†paramsä½œä¸ºpropsä¼ é€’</span>
  }
]

<span class="hljs-comment">// ç»„ä»¶å†…ä½¿ç”¨propsæ¥æ”¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: [<span class="hljs-string">'articleId'</span>],  <span class="hljs-comment">// ç›´æ¥ä½œä¸ºpropsä½¿ç”¨</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> articleId = <span class="hljs-title function_">ref</span>(props.<span class="hljs-property">articleId</span>)
    <span class="hljs-comment">// ...</span>
  }
}

<span class="hljs-comment">// åœºæ™¯2ï¼šåµŒå¥—è·¯ç”±çš„å‚æ•°ä¼ é€’</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard/:userId'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">DashboardLayout</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'profile'</span>,  <span class="hljs-comment">// å®é™…è·¯å¾„ï¼š/dashboard/123/profile</span>
        <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserProfile</span>
        <span class="hljs-comment">// åœ¨UserProfileä¸­å¯ä»¥é€šè¿‡ $route.params.userId è®¿é—®</span>
      },
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'settings'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserSettings</span>
      }
    ]
  }
]

<span class="hljs-comment">// åœºæ™¯3ï¼šå¤šæ®µå‚æ•°</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/:locale/product/:category/:slug'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">ProductPage</span>,
    <span class="hljs-comment">// å¯¹åº”URLï¼š/zh-CN/product/electronics/iphone-13</span>
    <span class="hljs-comment">// params: { locale: 'zh-CN', category: 'electronics', slug: 'iphone-13' }</span>
  }
]
</code></pre>
<h4 data-id="heading-10">3.2 query çš„å…¸å‹åœºæ™¯</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœºæ™¯1ï¼šæœç´¢å’Œç­›é€‰</span>
<span class="hljs-comment">// æœç´¢é¡µé¢</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/search'</span>,
  <span class="hljs-attr">query</span>: {
    <span class="hljs-attr">q</span>: <span class="hljs-string">'vue 3'</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'technology'</span>,
    <span class="hljs-attr">sort</span>: <span class="hljs-string">'relevance'</span>,
    <span class="hljs-attr">page</span>: <span class="hljs-string">'2'</span>,
    <span class="hljs-attr">price_min</span>: <span class="hljs-string">'100'</span>,
    <span class="hljs-attr">price_max</span>: <span class="hljs-string">'500'</span>
  }
})
<span class="hljs-comment">// ç”ŸæˆURL: /search?q=vue+3&amp;category=technology&amp;sort=relevance&amp;page=2...</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šåˆ†é¡µå’Œæ’åº</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">goToPage</span>(<span class="hljs-params">page</span>) {
      <span class="hljs-comment">// ä¿æŒå…¶ä»–æŸ¥è¯¢å‚æ•°ä¸å˜</span>
      <span class="hljs-keyword">const</span> currentQuery = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">query</span> }
      currentQuery.<span class="hljs-property">page</span> = page.<span class="hljs-title function_">toString</span>()
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">query</span>: currentQuery
      })
    },
    
    <span class="hljs-title function_">changeSort</span>(<span class="hljs-params">sortBy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">query</span>: {
          ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">query</span>,  <span class="hljs-comment">// ä¿ç•™å…¶ä»–å‚æ•°</span>
          <span class="hljs-attr">sort</span>: sortBy,
          <span class="hljs-attr">page</span>: <span class="hljs-string">'1'</span>  <span class="hljs-comment">// æ’åºå˜åŒ–æ—¶å›åˆ°ç¬¬ä¸€é¡µ</span>
        }
      })
    }
  }
}

<span class="hljs-comment">// åœºæ™¯3ï¼šæ¨¡æ€æ¡†æˆ–ä¸´æ—¶çŠ¶æ€</span>
<span class="hljs-comment">// æ‰“å¼€ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span>,
  <span class="hljs-attr">query</span>: { 
    <span class="hljs-attr">modal</span>: <span class="hljs-string">'user-detail'</span>,
    <span class="hljs-attr">userId</span>: <span class="hljs-string">'123'</span>
  }
})

<span class="hljs-comment">// åœ¨Usersç»„ä»¶ä¸­</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-string">'$route.query'</span>: {
      <span class="hljs-title function_">handler</span>(<span class="hljs-params">query</span>) {
        <span class="hljs-keyword">if</span> (query.<span class="hljs-property">modal</span> === <span class="hljs-string">'user-detail'</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showUserDetailModal</span>(query.<span class="hljs-property">userId</span>)
        }
      },
      <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-11">å››ã€é‡è¦æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-12">4.1 å‚æ•°æŒä¹…åŒ–é—®é¢˜</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// params çš„åˆ·æ–°é—®é¢˜</span>
{
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>
}

<span class="hljs-comment">// ä» /user/123 åˆ·æ–°é¡µé¢</span>
<span class="hljs-comment">// âœ… å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå› ä¸º123åœ¨URLè·¯å¾„ä¸­</span>

<span class="hljs-comment">// query çš„åˆ·æ–°é—®é¢˜</span>
<span class="hljs-comment">// ä» /user?id=123 åˆ·æ–°é¡µé¢</span>
<span class="hljs-comment">// âœ… ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå‚æ•°åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­</span>

<span class="hljs-comment">// ä½†æ˜¯ï¼params åœ¨ç¼–ç¨‹å¼å¯¼èˆªä¸­çš„é—®é¢˜</span>
router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>, <span class="hljs-attr">params</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> } })

<span class="hljs-comment">// å¦‚æœç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œparams ä¼šä¸¢å¤±ï¼</span>
<span class="hljs-comment">// å› ä¸ºåˆ·æ–°æ—¶æµè§ˆå™¨ä¼šé‡æ–°è¯·æ±‚URLï¼Œè€Œå½“å‰URLå¯èƒ½ä¸åŒ…å«params</span>

<span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ1ï¼šå§‹ç»ˆä½¿ç”¨å®Œæ•´çš„URL</span>
router.<span class="hljs-title function_">push</span>(<span class="hljs-string">`/user/<span class="hljs-subst">${id}</span>`</span>)  <span class="hljs-comment">// è€Œä¸æ˜¯ä½¿ç”¨paramså¯¹è±¡</span>

<span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ2ï¼šç»“åˆqueryä½œä¸ºå¤‡ä»½</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>,
  <span class="hljs-attr">params</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> },
  <span class="hljs-attr">query</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }  <span class="hljs-comment">// ä½œä¸ºå¤‡ä»½</span>
})
</code></pre>
<h4 data-id="heading-13">4.2 ç±»å‹å¤„ç†å·®å¼‚</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// params ç±»å‹å¤„ç†</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Product'</span>,
  <span class="hljs-attr">params</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>,        <span class="hljs-comment">// æ•°å­—</span>
    <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// å¸ƒå°”å€¼</span>
    <span class="hljs-attr">tags</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'router'</span>]  <span class="hljs-comment">// æ•°ç»„</span>
  }
})

<span class="hljs-comment">// è·å–æ—¶ï¼šæ‰€æœ‰å€¼éƒ½ä¼šå˜æˆå­—ç¬¦ä¸²ï¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)      <span class="hljs-comment">// "123" ï¼ˆå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">params</span>.<span class="hljs-property">active</span>)  <span class="hljs-comment">// "true" ï¼ˆå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">params</span>.<span class="hljs-property">tags</span>)    <span class="hljs-comment">// "vue,router" ï¼ˆå­—ç¬¦ä¸²ï¼‰</span>

<span class="hljs-comment">// query ç±»å‹å¤„ç†</span>
router.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/product'</span>,
  <span class="hljs-attr">query</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>,
    <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">tags</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'router'</span>]
  }
})
<span class="hljs-comment">// URL: /product?id=123&amp;active=true&amp;tags=vue&amp;tags=router</span>

<span class="hljs-comment">// è·å–æ—¶ï¼šqueryæ”¯æŒæ•°ç»„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>)      <span class="hljs-comment">// "123" ï¼ˆå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">query</span>.<span class="hljs-property">active</span>)  <span class="hljs-comment">// "true" ï¼ˆå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">query</span>.<span class="hljs-property">tags</span>)    <span class="hljs-comment">// ["vue", "router"] ï¼ˆæ•°ç»„ï¼ï¼‰</span>

<span class="hljs-comment">// æœ€ä½³å®è·µï¼šç±»å‹è½¬æ¢å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">parseQuery</span> = (<span class="hljs-params">query</span>) =&gt; ({
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">parseInt</span>(query.<span class="hljs-property">id</span>) || <span class="hljs-number">0</span>,
  <span class="hljs-attr">active</span>: query.<span class="hljs-property">active</span> === <span class="hljs-string">'true'</span>,
  <span class="hljs-attr">tags</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(query.<span class="hljs-property">tags</span>) ? query.<span class="hljs-property">tags</span> : [query.<span class="hljs-property">tags</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>),
  <span class="hljs-attr">page</span>: <span class="hljs-built_in">parseInt</span>(query.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>
})
</code></pre>
<h4 data-id="heading-14">4.3 å“åº”å¼å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç›‘å¬å‚æ•°å˜åŒ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-comment">// ç›‘å¬paramså˜åŒ–</span>
    <span class="hljs-string">'$route.params.id'</span>: {
      <span class="hljs-title function_">handler</span>(<span class="hljs-params">newId</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadUser</span>(newId)
      },
      <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>
    },
    
    <span class="hljs-comment">// ç›‘å¬queryå˜åŒ–ï¼ˆæ·±åº¦ç›‘å¬ï¼‰</span>
    <span class="hljs-string">'$route.query'</span>: {
      <span class="hljs-title function_">handler</span>(<span class="hljs-params">newQuery</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleSearch</span>(newQuery)
      },
      <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>
    }
  },
  
  <span class="hljs-comment">// ç»„åˆå¼APIæ–¹å¼</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
    
    <span class="hljs-comment">// ç›‘å¬paramsä¸­çš„ç‰¹å®šå‚æ•°</span>
    <span class="hljs-title function_">watch</span>(
      <span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
      <span class="hljs-function">(<span class="hljs-params">newId</span>) =&gt;</span> {
        <span class="hljs-title function_">fetchUser</span>(newId)
      },
      { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
    )
    
    <span class="hljs-comment">// ç›‘å¬æ•´ä¸ªqueryå¯¹è±¡</span>
    <span class="hljs-title function_">watch</span>(
      <span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">query</span>,
      <span class="hljs-function">(<span class="hljs-params">newQuery</span>) =&gt;</span> {
        <span class="hljs-title function_">performSearch</span>(newQuery)
      },
      { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
    )
  }
}
</code></pre>
<h3 data-id="heading-15">äº”ã€æ€§èƒ½ä¸SEOè€ƒè™‘</h3>
<h4 data-id="heading-16">5.1 SEOå‹å¥½æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// params å¯¹SEOæ›´å‹å¥½</span>
<span class="hljs-comment">// URL: /products/electronics/laptops</span>
<span class="hljs-comment">// æœç´¢å¼•æ“æ›´å®¹æ˜“ç†è§£è¿™ä¸ªURLçš„ç»“æ„å±‚æ¬¡</span>

<span class="hljs-comment">// query å¯¹SEOè¾ƒå·®</span>
<span class="hljs-comment">// URL: /products?category=electronics&amp;type=laptops</span>
<span class="hljs-comment">// æœç´¢å¼•æ“å¯èƒ½ä¸ä¼šä¸ºæ¯ä¸ªæŸ¥è¯¢å‚æ•°ç»„åˆå»ºç«‹ç´¢å¼•</span>

<span class="hljs-comment">// æœ€ä½³å®è·µï¼š</span>
<span class="hljs-comment">// æ ¸å¿ƒå†…å®¹ä½¿ç”¨paramsï¼Œç­›é€‰æ’åºä½¿ç”¨query</span>
<span class="hljs-comment">// /products/:category/:slug?sort=price&amp;order=asc</span>
</code></pre>
<h4 data-id="heading-17">5.2 æœåŠ¡å™¨é…ç½®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨paramsæ—¶éœ€è¦æœåŠ¡å™¨é…ç½®</span>
<span class="hljs-comment">// å¯¹äºVueçš„å•é¡µåº”ç”¨ï¼Œéœ€è¦é…ç½®æœåŠ¡å™¨å°†æ‰€æœ‰è·¯ç”±æŒ‡å‘index.html</span>

<span class="hljs-comment">// Nginxé…ç½®ç¤ºä¾‹</span>
location / {
  try_files $uri $uri/ /index.<span class="hljs-property">html</span>;
}

<span class="hljs-comment">// Apacheé…ç½®ç¤ºä¾‹</span>
<span class="hljs-title class_">RewriteEngine</span> <span class="hljs-title class_">On</span>
<span class="hljs-title class_">RewriteBase</span> /
<span class="hljs-title class_">RewriteRule</span> ^index\.<span class="hljs-property">html$</span> - [L]
<span class="hljs-title class_">RewriteCond</span> %{<span class="hljs-variable constant_">REQUEST_FILENAME</span>} !-f
<span class="hljs-title class_">RewriteCond</span> %{<span class="hljs-variable constant_">REQUEST_FILENAME</span>} !-d
<span class="hljs-title class_">RewriteRule</span> . /index.<span class="hljs-property">html</span> [L]

<span class="hljs-comment">// queryä¸éœ€è¦ç‰¹æ®Šé…ç½®ï¼Œå› ä¸ºè·¯å¾„éƒ¨åˆ†è¿˜æ˜¯/index.html</span>
</code></pre>
<h3 data-id="heading-18">å…­ã€å®æˆ˜æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-19">6.1 å‚æ•°éªŒè¯ä¸è½¬æ¢</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·¯ç”±çº§åˆ«çš„å‚æ•°éªŒè¯</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserDetail</span>,
    <span class="hljs-attr">props</span>: <span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> ({
      <span class="hljs-attr">id</span>: <span class="hljs-title function_">validateUserId</span>(route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
    })
  }
]

<span class="hljs-comment">// éªŒè¯å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUserId</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">const</span> numId = <span class="hljs-built_in">parseInt</span>(id)
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(numId) || numId &lt;= <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// æ— æ•ˆIDï¼Œé‡å®šå‘åˆ°404æˆ–åˆ—è¡¨é¡µ</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid user ID'</span>)
  }
  <span class="hljs-keyword">return</span> numId
}

<span class="hljs-comment">// ç»„ä»¶å†…çš„å‚æ•°å®ˆå«</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">beforeRouteEnter</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(to.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(id)) {
      <span class="hljs-title function_">next</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span> })  <span class="hljs-comment">// é‡å®šå‘</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">next</span>()
    }
  },
  
  <span class="hljs-title function_">beforeRouteUpdate</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-comment">// å¤„ç†å‚æ•°å˜åŒ–</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> = <span class="hljs-built_in">parseInt</span>(to.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
    <span class="hljs-title function_">next</span>()
  }
}
</code></pre>
<h4 data-id="heading-20">6.2 æ··åˆä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”µå•†ç½‘ç«™ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/shop/:category'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Category'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">CategoryPage</span>
    <span class="hljs-comment">// URL: /shop/electronics?sort=price&amp;page=2</span>
    <span class="hljs-comment">// params: { category: 'electronics' }</span>
    <span class="hljs-comment">// query: { sort: 'price', page: '2' }</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/product/:slug/:variant?'</span>,  <span class="hljs-comment">// å˜ä½“å‚æ•°å¯é€‰</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Product'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">ProductPage</span>
    <span class="hljs-comment">// URL: /product/iphone-13/blue?showReviews=true</span>
    <span class="hljs-comment">// params: { slug: 'iphone-13', variant: 'blue' }</span>
    <span class="hljs-comment">// query: { showReviews: 'true' }</span>
  }
]

<span class="hljs-comment">// å¯¼èˆªå‡½æ•°ç¤ºä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// æµè§ˆå•†å“åˆ†ç±»</span>
    <span class="hljs-title function_">browseCategory</span>(<span class="hljs-params">category, options = {}</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Category'</span>,
        <span class="hljs-attr">params</span>: { category },
        <span class="hljs-attr">query</span>: {
          <span class="hljs-attr">sort</span>: options.<span class="hljs-property">sort</span> || <span class="hljs-string">'popular'</span>,
          <span class="hljs-attr">page</span>: options.<span class="hljs-property">page</span> || <span class="hljs-string">'1'</span>,
          ...options.<span class="hljs-property">filters</span>  <span class="hljs-comment">// å…¶ä»–ç­›é€‰æ¡ä»¶</span>
        }
      })
    },
    
    <span class="hljs-comment">// æŸ¥çœ‹å•†å“è¯¦æƒ…</span>
    <span class="hljs-title function_">viewProduct</span>(<span class="hljs-params">productSlug, variant = <span class="hljs-literal">null</span>, options = {}</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Product'</span>,
        <span class="hljs-attr">params</span>: { 
          <span class="hljs-attr">slug</span>: productSlug,
          ...(variant &amp;&amp; { variant })  <span class="hljs-comment">// æ¡ä»¶æ·»åŠ å‚æ•°</span>
        },
        <span class="hljs-attr">query</span>: {
          <span class="hljs-attr">ref</span>: options.<span class="hljs-property">referrer</span>,      <span class="hljs-comment">// æ¥æºè·Ÿè¸ª</span>
          <span class="hljs-attr">showReviews</span>: options.<span class="hljs-property">showReviews</span> ? <span class="hljs-string">'true'</span> : <span class="hljs-literal">undefined</span>
        }
      })
    }
  }
}
</code></pre>
<h3 data-id="heading-21">ä¸ƒã€Vue Router 4 çš„æ–°ç‰¹æ€§</h3>
<h4 data-id="heading-22">7.1 å¼ºç±»å‹æ”¯æŒï¼ˆTypeScriptï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰è·¯ç”±å‚æ•°ç±»å‹</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue-router'</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RouteMeta</span> {
    requiresAuth?: <span class="hljs-built_in">boolean</span>
    breadcrumb?: <span class="hljs-built_in">string</span>
  }
  
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RouteParams</span> {
    <span class="hljs-comment">// å…¨å±€paramsç±»å‹å®šä¹‰</span>
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">slug</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">category</span>: <span class="hljs-string">'electronics'</span> | <span class="hljs-string">'clothing'</span> | <span class="hljs-string">'books'</span>
  }
  
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RouteQuery</span> {
    <span class="hljs-comment">// å…¨å±€queryç±»å‹å®šä¹‰  </span>
    page?: <span class="hljs-built_in">string</span>
    sort?: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span>
    q?: <span class="hljs-built_in">string</span>
  }
}

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç±»å‹å®‰å…¨</span>
<span class="hljs-keyword">import</span> { useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
    
    <span class="hljs-comment">// TypeScriptçŸ¥é“paramså’Œqueryçš„ç±»å‹</span>
    <span class="hljs-keyword">const</span> userId = route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>  <span class="hljs-comment">// string</span>
    <span class="hljs-keyword">const</span> page = route.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>   <span class="hljs-comment">// string | undefined</span>
    <span class="hljs-keyword">const</span> searchQuery = route.<span class="hljs-property">query</span>.<span class="hljs-property">q</span> <span class="hljs-comment">// string | undefined</span>
    
    <span class="hljs-keyword">return</span> { userId, page, searchQuery }
  }
}
</code></pre>
<h4 data-id="heading-23">7.2 ç»„åˆå¼APIå·¥å…·</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨useRouterå’ŒuseRoute</span>
<span class="hljs-keyword">import</span> { useRouter, useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
    <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
    
    <span class="hljs-comment">// ç¼–ç¨‹å¼å¯¼èˆª</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">goToUser</span> = (<span class="hljs-params">id</span>) =&gt; {
      router.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>,
        <span class="hljs-attr">params</span>: { id },
        <span class="hljs-attr">query</span>: { <span class="hljs-attr">tab</span>: <span class="hljs-string">'profile'</span> }
      })
    }
    
    <span class="hljs-comment">// å“åº”å¼å‚æ•°</span>
    <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> activeTab = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">query</span>.<span class="hljs-property">tab</span> || <span class="hljs-string">'overview'</span>)
    
    <span class="hljs-comment">// ç›‘å¬å‚æ•°å˜åŒ–</span>
    <span class="hljs-title function_">watch</span>(
      <span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
      <span class="hljs-function">(<span class="hljs-params">newId</span>) =&gt;</span> {
        <span class="hljs-title function_">fetchUserData</span>(newId)
      }
    )
    
    <span class="hljs-keyword">return</span> { userId, activeTab, goToUser }
  }
}
</code></pre>
<h3 data-id="heading-24">æ€»ç»“å¯¹æ¯”è¡¨</h3>























































<table><thead><tr><th>ç‰¹æ€§</th><th>params</th><th>query</th></tr></thead><tbody><tr><td><strong>URLä½ç½®</strong></td><td>è·¯å¾„çš„ä¸€éƒ¨åˆ†</td><td>æŸ¥è¯¢å­—ç¬¦ä¸²</td></tr><tr><td><strong>å®šä¹‰æ–¹å¼</strong></td><td>å¿…é¡»åœ¨è·¯ç”±ä¸­å£°æ˜</td><td>æ— éœ€å£°æ˜</td></tr><tr><td><strong>å¿…é€‰æ€§</strong></td><td>é€šå¸¸æ˜¯å¿…é€‰çš„</td><td>å¯é€‰</td></tr><tr><td><strong>å¤šä¸ªå€¼</strong></td><td>ä¸èƒ½ç›´æ¥ä¼ æ•°ç»„</td><td>å¯ä»¥ä¼ æ•°ç»„</td></tr><tr><td><strong>ç±»å‹ä¿æŒ</strong></td><td>å…¨éƒ¨è½¬ä¸ºå­—ç¬¦ä¸²</td><td>æ•°ç»„ä¿æŒæ•°ç»„ï¼Œå…¶ä»–è½¬å­—ç¬¦ä¸²</td></tr><tr><td><strong>åˆ·æ–°æŒä¹…åŒ–</strong></td><td>è·¯å¾„ä¸­ï¼Œå¯æŒä¹…åŒ–</td><td>æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ï¼Œå¯æŒä¹…åŒ–</td></tr><tr><td><strong>SEOå‹å¥½æ€§</strong></td><td>æ›´å‹å¥½</td><td>ç›¸å¯¹è¾ƒå·®</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>èµ„æºæ ‡è¯†ã€å¿…è¦å‚æ•°</td><td>ç­›é€‰ã€æ’åºã€å¯é€‰å‚æ•°</td></tr><tr><td><strong>ç¼–ç¨‹å¼å¯¼èˆª</strong></td><td>éœ€ç”¨<code>name</code>ï¼Œä¸èƒ½ç”¨<code>path</code></td><td><code>name</code>å’Œ<code>path</code>éƒ½å¯ç”¨</td></tr></tbody></table>
<h3 data-id="heading-25">é»„é‡‘æ³•åˆ™</h3>
<ol>
<li><strong>ç”¨ params</strong>ï¼šå½“å‚æ•°æ˜¯èµ„æºæ ‡è¯†ï¼ˆå¦‚IDã€slugï¼‰ä¸”å¯¹URLè¯­ä¹‰é‡è¦æ—¶</li>
<li><strong>ç”¨ query</strong>ï¼šå½“å‚æ•°æ˜¯å¯é€‰ã€ä¸´æ—¶çŠ¶æ€æˆ–ç­›é€‰æ¡ä»¶æ—¶</li>
<li><strong>æ··åˆä½¿ç”¨</strong>ï¼šæ ¸å¿ƒæ ‡è¯†ç”¨paramsï¼Œé™„åŠ é€‰é¡¹ç”¨query</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå§‹ç»ˆè¿›è¡Œç±»å‹éªŒè¯å’Œè½¬æ¢</li>
<li><strong>æŒä¹…åŒ–è€ƒè™‘</strong>ï¼šé‡è¦å‚æ•°ç¡®ä¿åˆ·æ–°åä¸ä¸¢å¤±</li>
</ol>
<p>è®°ä½ï¼š<strong>params å®šä¹‰"æ˜¯ä»€ä¹ˆ"ï¼Œquery æè¿°"æ€ä¹ˆçœ‹"</strong>ã€‚åˆç†é€‰æ‹©ï¼Œè®©ä½ çš„è·¯ç”±æ—¢æ¸…æ™°åˆå¼ºå¤§ï¼</p>
<hr/>
<p><strong>æ€è€ƒé¢˜</strong>ï¼šåœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡å› ä¸ºé€‰é”™å‚æ•°ä¼ é€’æ–¹å¼è€Œå¯¼è‡´çš„é—®é¢˜ï¼Ÿæˆ–è€…æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å‚æ•°å¤„ç†æŠ€å·§ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´ï¼šä¸€ä¸ªJavaåç«¯å¼€å‘è€…çš„çœŸå®å¤ç›˜]]></title>    <link>https://juejin.cn/post/7595040803581640719</link>    <guid>https://juejin.cn/post/7595040803581640719</guid>    <pubDate>2026-01-15T01:34:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595040803581640719" data-draft-id="7595053284915593256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´ï¼šä¸€ä¸ªJavaåç«¯å¼€å‘è€…çš„çœŸå®å¤ç›˜"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-15T01:34:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´ï¼šä¸€ä¸ªJavaåç«¯å¼€å‘è€…çš„çœŸå®å¤ç›˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T01:34:53.000Z" title="Thu Jan 15 2026 01:34:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´ï¼šä¸€ä¸ªJavaåç«¯å¼€å‘è€…çš„çœŸå®å¤ç›˜</h2>
<p>2025å¹´è¿‡å»äº†ï¼Œè¿™ä¸€å¹´æˆ‘æœ€å¤§çš„æ„Ÿå—æ˜¯ï¼š<strong>ä¸€ä¸ªäººå¯ä»¥æ…¢ï¼Œä½†å·¥å…·ä¸€å®šè¦å¿«</strong>ã€‚ä½œä¸ºä¸€åJavaåç«¯é«˜çº§å¼€å‘è€…ï¼Œæˆ‘æ¥è§¦æœ€å¤šçš„ä¸æ˜¯æ–°é¡¹ç›®ï¼Œè€Œæ˜¯é‚£äº›â€œå¹´ä»£ä¹…è¿œã€æ–‡æ¡£ç¼ºå¤±ã€æ²¡äººæ•¢åŠ¨â€çš„è€é¡¹ç›®ã€‚è¿‡å»ï¼Œæ¯æ¬¡æ¥æ‰‹è¿™ç§é¡¹ç›®ï¼Œè„‘å­é‡Œéƒ½ä¼šå“èµ·ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>â€œè°åŠ¨è°æ­»ï¼ŒåŠ¨äº†ä½ å°±å¾—å¯¹å®ƒè´Ÿè´£ä¸€è¾ˆå­ã€‚â€</p>
</blockquote>
<p>ä½†è‡ªä»æ¥è§¦äº† <strong>TRAEï¼ˆTool for Rapid API Explorationï¼‰</strong> ï¼Œè¿™ä¸€åˆ‡å¼€å§‹æœ‰äº†ä¸ä¸€æ ·çš„è½¬æœºã€‚</p>
<hr/>
<h3 data-id="heading-1">1. è€é¡¹ç›®ä¸å†ã€Œé»‘ç®±ã€ï¼šå¿«é€Ÿæ¢³ç†é¡¹ç›®ç»“æ„å’Œæ¥å£ä¸šåŠ¡</h3>
<p>è€é¡¹ç›®æœ€æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿä¸æ˜¯ä»£ç å¤šï¼Œè€Œæ˜¯<strong>æ²¡äººçŸ¥é“å®ƒåœ¨å¹²å˜›</strong>ã€‚å°¤å…¶æ˜¯é‚£ç§ä¸Šä¸‡è¡Œä»£ç ã€æ²¡æœ‰æ³¨é‡Šã€åŒ…ç»“æ„æ··ä¹±çš„â€œé—äº§çº§â€ç³»ç»Ÿã€‚åœ¨è¿‡å»ï¼Œæˆ‘è¦èŠ±å‡ å¤©æ—¶é—´æŠŠä¸šåŠ¡ç†é¡ºï¼Œæ‰èƒ½åšç¬¬ä¸€ä¸ªæ”¹åŠ¨ã€‚</p>
<p>è€Œç°åœ¨ï¼Œæˆ‘ä¼šåœ¨æ¥åˆ°è€é¡¹ç›®åï¼Œç¬¬ä¸€æ—¶é—´ç”¨TRAEè¿›è¡Œé¡¹ç›®æ‰«æã€‚å®ƒèƒ½è‡ªåŠ¨åˆ†æé¡¹ç›®ç»“æ„ã€è¯†åˆ«æ¥å£ã€ç”šè‡³é€šè¿‡è°ƒç”¨é“¾è¿½è¸ªæ¥å£èƒŒåçš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-2">âœ… ä½¿ç”¨å¿ƒå¾—</h4>
<ul>
<li><strong>æ¥å£ä¸€é”®æ¢³ç†</strong>ï¼šTRAEä¼šç”Ÿæˆä¸€ä¸ªæ¥å£æ¸…å•ï¼Œè‡ªåŠ¨è¯†åˆ«Controllerã€Serviceã€DAOï¼Œå¸®æˆ‘å¿«é€Ÿå®šä½æ ¸å¿ƒä¸šåŠ¡ã€‚</li>
<li><strong>è°ƒç”¨é“¾å¯è§†åŒ–</strong>ï¼šä¸€ä¸ªæ¥å£èƒŒåè°ƒäº†å“ªäº›æœåŠ¡ã€ä¸­é—´åšäº†ä»€ä¹ˆå¤„ç†ï¼ŒTRAEéƒ½èƒ½å±•ç¤ºå‡ºæ¥ã€‚</li>
<li><strong>æ¯”çœ‹ä»£ç å¿«å¤ªå¤š</strong>ï¼šä»¥å‰æˆ‘å¾—ç”¨IDEä¸€ç‚¹ä¸€ç‚¹ç‚¹è¿›å»ï¼Œç°åœ¨ç›´æ¥çœ‹TRAEè§†å›¾ï¼Œå‡ åˆ†é’Ÿææ¸…æ¥šåŸç†ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. æ”¹å°éœ€æ±‚ã€ä¿®è€Bugå‰çš„â€œä¿é™©é”â€</h3>
<p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ¥åˆ°çš„éœ€æ±‚æ˜¯â€œæŸä¸ªæ¥å£åŠ ä¸ªå­—æ®µâ€ã€â€œæŸä¸ªé€»è¾‘ç¨å¾®å˜ä¸€ä¸‹â€è¿™ç§çœ‹ä¼¼ç®€å•ä½†å®åˆ™æš—è—é£é™©çš„æ”¹åŠ¨ã€‚ä»¥å‰æˆ‘éƒ½æ˜¯é â€œç»éªŒ + è¿æ°”â€ä¸‹æ‰‹ï¼Œæ”¹å®Œæå¿ƒåŠèƒ†åœ°ä¸Šçº¿ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä¼šå…ˆç”¨TRAEï¼š</p>
<ol>
<li>æŸ¥æ‰¾è¿™ä¸ªæ¥å£çš„å®Œæ•´è°ƒç”¨é“¾ã€‚</li>
<li>æŸ¥çœ‹å®ƒåœ¨å“ªäº›åœ°æ–¹è¢«è°ƒç”¨ã€‚</li>
<li>æŠŠæ‰€æœ‰ä¾èµ–å®ƒçš„æ¥å£éƒ½è·‘ä¸€ééªŒè¯ã€‚</li>
</ol>
<h4 data-id="heading-4">âœ… ä½¿ç”¨å¿ƒå¾—</h4>
<ul>
<li><strong>æ”¹ä¹‹å‰å¿ƒé‡Œæœ‰åº•</strong>ï¼šçŸ¥é“æ”¹äº†Aä¼šä¸ä¼šå½±å“Bã€Cã€‚</li>
<li><strong>å®šä½Bugä¹Ÿæ›´å¿«</strong>ï¼šTRAEçš„æ—¥å¿—å¢å¼ºåŠŸèƒ½è®©æˆ‘ä¸ç”¨åˆ°å¤„åŠ <code>System.out.println</code>ï¼Œè€Œæ˜¯ç²¾å‡†çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">3. ä¼˜åŒ–æ€§èƒ½ï¼šä»æ‰¹é‡æ’å…¥åˆ°è½®è¯¢æ’å…¥çš„è½¬å˜</h3>
<p>åœ¨ä¸€æ¬¡è€é¡¹ç›®ä¼˜åŒ–ä¸­ï¼Œæˆ‘å‘ç°ä¸€ä¸ªæ‰¹é‡æ’å…¥æ¥å£ç»å¸¸åœ¨é«˜å¹¶å‘ä¸‹å‡ºç°<code>OutOfMemoryError</code>ã€‚ä¼ ç»Ÿåšæ³•å°±æ˜¯åˆ†é¡µåˆ†æ‰¹æ”¹é€ é€»è¾‘ï¼Œä½†æ€ä¹ˆåˆ†ï¼Ÿå½±å“å“ªäº›ä¸šåŠ¡ï¼Ÿ</p>
<p>TRAEå¸®æˆ‘åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>è‡ªåŠ¨è¯†åˆ«è¿™ä¸ªæ¥å£çš„ä¾èµ–é“¾ã€‚</li>
<li>åˆ†ææ¯æ¬¡æ’å…¥çš„æ•°æ®é‡å’Œæ‰§è¡Œæ—¶é—´ã€‚</li>
<li>å¸®æˆ‘æ¨¡æ‹Ÿäº†åˆ†é¡µæ’å…¥çš„ç­–ç•¥ã€‚</li>
</ul>
<p>æœ€ç»ˆæˆ‘å°†åŸæ¥çš„ä¸€æ¬¡æ€§æ’å…¥æ”¹ä¸º<strong>åˆ†æ‰¹è½®è¯¢æ’å…¥</strong>ï¼Œæ¯æ¬¡æ’å…¥500æ¡ï¼Œå†…å­˜å ç”¨æ˜æ˜¾ä¸‹é™ï¼Œæ¥å£ç¨³å®šæ€§å¤§å¹…æå‡ã€‚</p>
<hr/>
<h3 data-id="heading-6">4. è°ƒè¯•Bugæ›´ç®€å•ï¼šä¸€è¡Œæ—¥å¿—ä¹Ÿä¸æµªè´¹</h3>
<p>ä»¥å‰è°ƒè¯•Bugæ—¶ï¼Œæˆ‘è¦åœ¨å„ä¸ªç±»ã€å„ä¸ªæ–¹æ³•é‡ŒåŠ æ—¥å¿—ï¼Œè·‘ä¸€éçœ‹çœ‹æœ‰æ²¡æœ‰è¾“å‡ºï¼Œå†åˆ æ‰ã€‚ç°åœ¨æˆ‘ç”¨TRAEçš„<strong>åŠ¨æ€è°ƒè¯•åŠŸèƒ½</strong>ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>å®æ—¶æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„å…¥å‚å’Œå‡ºå‚ã€‚</li>
<li>ç»™æŸä¸ªç±»æˆ–æ–¹æ³•æ·»åŠ ä¸´æ—¶æ—¥å¿—ï¼Œä¸éœ€è¦é‡å¯æœåŠ¡ã€‚</li>
</ul>
<h4 data-id="heading-7">âœ… ä½¿ç”¨å¿ƒå¾—</h4>
<ul>
<li><strong>æ•ˆç‡æå‡å·¨å¤§</strong>ï¼šè°ƒè¯•æ•ˆç‡è‡³å°‘æå‡äº†2å€ã€‚</li>
<li><strong>æ—¥å¿—æ›´ç²¾å‡†</strong>ï¼šä¸å†æ»¡å±éƒ½æ˜¯æ— ç”¨çš„æ‰“å°ä¿¡æ¯ï¼Œæ‰¾åˆ°é—®é¢˜æ›´å¿«ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">æ€»ç»“ï¼šTRAEä¸æ˜¯æ›¿æˆ‘å†™ä»£ç ï¼Œè€Œæ˜¯è®©æˆ‘æ›´åƒä¸€ä¸ªâ€œæœ‰å…¨å±€è§†è§’â€çš„å·¥ç¨‹å¸ˆ</h3>
<p>è¿™ä¸€å¹´ï¼Œæˆ‘è¶Šæ¥è¶Šæ„è¯†åˆ°ï¼š<strong>çœŸæ­£å‰å®³çš„å¼€å‘ä¸æ˜¯ä»£ç å†™å¾—å¤šå¿«ï¼Œè€Œæ˜¯èƒ½åœ¨å¤æ‚ç³»ç»Ÿä¸­ä¿æŒæ¸…æ™°çš„æ€ç»´å’Œåˆ¤æ–­åŠ›</strong>ã€‚TRAEåœ¨æˆ‘æœ€éœ€è¦çš„æ—¶å€™ï¼Œç»™äº†æˆ‘è¿™æ ·çš„èƒ½åŠ›ã€‚</p>
<p>æ— è®ºæ˜¯åˆšæ¥æ‰‹æ²¡äººæ•¢åŠ¨çš„è€é¡¹ç›®ï¼Œè¿˜æ˜¯åœ¨ä¿®ä¸€ä¸ªè°éƒ½ä¸æ„¿ç¢°çš„å†å²Bugï¼ŒTRAEéƒ½åƒä¸€ä¸ªâ€œé¡¹ç›®åŒ»ç”Ÿâ€ï¼Œå¸®æˆ‘åšCTã€å¼€å¤„æ–¹ã€ç»™å»ºè®®ã€‚</p>
<p>2026å¹´ï¼Œæˆ‘ä¾ç„¶ä¼šç»§ç»­ä½¿ç”¨TRAEï¼Œä¹Ÿå¸Œæœ›å®ƒèƒ½å¸®åŠ©æ›´å¤šåƒæˆ‘ä¸€æ ·çš„åç«¯å¼€å‘è€…ï¼Œ<strong>åœ¨å¤æ‚çš„æ—§ä»£ç é‡Œï¼Œæ‰¾åˆ°ç§©åºä¸æ–¹å‘</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[`active-class`ï¼šVue Router é“¾æ¥ç»„ä»¶çš„æ¿€æ´»çŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7595341943338287114</link>    <guid>https://juejin.cn/post/7595341943338287114</guid>    <pubDate>2026-01-15T07:45:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595341943338287114" data-draft-id="7595289498445889562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="`active-class`ï¼šVue Router é“¾æ¥ç»„ä»¶çš„æ¿€æ´»çŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-15T07:45:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            `active-class`ï¼šVue Router é“¾æ¥ç»„ä»¶çš„æ¿€æ´»çŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:45:28.000Z" title="Thu Jan 15 2026 07:45:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><code>active-class</code>ï¼šVue Router é“¾æ¥ç»„ä»¶çš„æ¿€æ´»çŠ¶æ€ç®¡ç†</h2>
<blockquote>
<p>åœ¨ Vue.js å•é¡µåº”ç”¨ä¸­ï¼Œ<code>active-class</code> æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦ä½†ç»å¸¸è¢«è¯¯è§£çš„å±æ€§ã€‚ä»Šå¤©æˆ‘ä»¬æ¥å½»åº•ææ¸…æ¥šå®ƒæ˜¯ä»€ä¹ˆã€æ€ä¹ˆç”¨ï¼Œä»¥åŠæœ€ä½³å®è·µï¼</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€è®¤çŸ¥ï¼š<code>active-class</code> å±äºè°ï¼Ÿ</h3>
<p><strong>ä¸€å¥è¯å›ç­”</strong>ï¼š<code>active-class</code> æ˜¯ <strong>Vue Router</strong> çš„ <code>&lt;router-link&gt;</code> ç»„ä»¶çš„å±æ€§ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- è¿™æ˜¯æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ --&gt;
&lt;router-link 
  to="/home" 
  active-class="active-link"
&gt;
  é¦–é¡µ
&lt;/router-link&gt;
</code></pre>
<h4 data-id="heading-2">é”™è¯¯è®¤çŸ¥æ¾„æ¸…</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- é”™è¯¯ï¼è¿™ä¸æ˜¯åŸç”ŸHTMLå±æ€§ --&gt;
&lt;a href="/home" active-class="active"&gt;é¦–é¡µ&lt;/a&gt; âŒ

&lt;!-- é”™è¯¯ï¼è¿™ä¸æ˜¯æ™®é€šVueç»„ä»¶çš„å±æ€§ --&gt;
&lt;button active-class="active"&gt;æŒ‰é’®&lt;/button&gt; âŒ
</code></pre>
<h3 data-id="heading-3">äºŒã€<code>&lt;router-link&gt;</code> ç»„ä»¶æ·±åº¦è§£æ</h3>
<h4 data-id="heading-4">2.1 åŸºæœ¬ä½¿ç”¨</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;!-- æœ€ç®€å•çš„ç”¨æ³• --&gt;
    &lt;router-link to="/home"&gt;é¦–é¡µ&lt;/router-link&gt;
    
    &lt;!-- ä½¿ç”¨ active-class --&gt;
    &lt;router-link 
      to="/about" 
      active-class="text-red-500 font-bold"
    &gt;
      å…³äºæˆ‘ä»¬
    &lt;/router-link&gt;
    
    &lt;!-- å®Œæ•´é…ç½®ç¤ºä¾‹ --&gt;
    &lt;router-link
      to="/products"
      active-class="active-nav-item"
      exact-active-class="exact-active-nav-item"
      class="nav-link"
      :class="{ 'custom-class': isCustom }"
    &gt;
      äº§å“ä¸­å¿ƒ
    &lt;/router-link&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-5">2.2 <code>&lt;router-link&gt;</code> çš„å·¥ä½œæœºåˆ¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// router-link çš„å†…éƒ¨å®ç°ç®€åŒ–</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RouterLink</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RouterLink'</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">to</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>], <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">activeClass</span>: <span class="hljs-title class_">String</span>,      <span class="hljs-comment">// active-class çš„ prop å</span>
    <span class="hljs-attr">exactActiveClass</span>: <span class="hljs-title class_">String</span>, <span class="hljs-comment">// exact-active-class çš„ prop å</span>
    <span class="hljs-comment">// ... å…¶ä»– props</span>
  },
  
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. è§£æè·¯ç”±åŒ¹é…çŠ¶æ€</span>
    <span class="hljs-keyword">const</span> isActive = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">path</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolvedTo</span>.<span class="hljs-property">path</span>
    <span class="hljs-keyword">const</span> isExactActive = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">path</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolvedTo</span>.<span class="hljs-property">path</span>
    
    <span class="hljs-comment">// 2. æ„å»º class å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> classObj = {
      [<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeClass</span>]: isActive,
      [<span class="hljs-variable language_">this</span>.<span class="hljs-property">exactActiveClass</span>]: isExactActive,
      <span class="hljs-comment">// ... å…¶ä»– class é€»è¾‘</span>
    }
    
    <span class="hljs-comment">// 3. æ¸²æŸ“ä¸º &lt;a&gt; æ ‡ç­¾</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">'a'</span>, {
      <span class="hljs-attr">href</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">href</span>,
      <span class="hljs-attr">class</span>: classObj,
      <span class="hljs-attr">onClick</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">navigate</span>
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-title function_">default</span>())
  }
}
</code></pre>
<h3 data-id="heading-6">ä¸‰ã€<code>active-class</code> vs <code>exact-active-class</code></h3>
<h4 data-id="heading-7">3.1 å…³é”®åŒºåˆ«</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;nav&gt;
    &lt;!-- æƒ…å†µ1ï¼šæ™®é€šåŒ¹é…ï¼ˆactive-classï¼‰ --&gt;
    &lt;router-link 
      to="/dashboard" 
      active-class="bg-blue-100"
    &gt;
      ä»ªè¡¨ç›˜
    &lt;/router-link&gt;
    &lt;!-- 
      å½“è®¿é—® /dashboard æ—¶ï¼šâœ… æ¿€æ´»
      å½“è®¿é—® /dashboard/profile æ—¶ï¼šâœ… ä¹Ÿæ¿€æ´»ï¼
      å› ä¸º /dashboard/profile åŒ…å« /dashboard
    --&gt;
    
    &lt;!-- æƒ…å†µ2ï¼šç²¾ç¡®åŒ¹é…ï¼ˆexact-active-classï¼‰ --&gt;
    &lt;router-link
      to="/dashboard"
      exact-active-class="bg-blue-500 text-white"
    &gt;
      ä»ªè¡¨ç›˜ï¼ˆç²¾ç¡®ï¼‰
    &lt;/router-link&gt;
    &lt;!--
      å½“è®¿é—® /dashboard æ—¶ï¼šâœ… æ¿€æ´»
      å½“è®¿é—® /dashboard/profile æ—¶ï¼šâŒ ä¸æ¿€æ´»ï¼
      åªæœ‰è·¯å¾„å®Œå…¨åŒ¹é…æ—¶æ‰æ¿€æ´»
    --&gt;
    
    &lt;!-- æƒ…å†µ3ï¼šåŒæ—¶ä½¿ç”¨ --&gt;
    &lt;router-link
      to="/settings"
      active-class="text-blue-500"
      exact-active-class="border-b-2 border-blue-500"
    &gt;
      è®¾ç½®
    &lt;/router-link&gt;
    &lt;!--
      è®¿é—® /settingsï¼štext-blue-500 + border-b-2 border-blue-500
      è®¿é—® /settings/accountï¼šåªæœ‰ text-blue-500
    --&gt;
  &lt;/nav&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-8">3.2 å®é™…åº”ç”¨åœºæ™¯</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- åœºæ™¯1ï¼šé¢åŒ…å±‘å¯¼èˆª --&gt;
  &lt;div class="breadcrumb"&gt;
    &lt;router-link 
      to="/home" 
      active-class="breadcrumb-active"
      exact-active-class="breadcrumb-exact-active"
    &gt;
      é¦–é¡µ
    &lt;/router-link&gt;
    &lt;span&gt;/&lt;/span&gt;
    &lt;router-link 
      to="/products" 
      active-class="breadcrumb-active"
    &gt;
      äº§å“
    &lt;/router-link&gt;
    &lt;span v-if="$route.path.includes('/products/')"&gt;/&lt;/span&gt;
    &lt;router-link 
      v-if="$route.params.id"
      :to="`/products/${$route.params.id}`"
      exact-active-class="breadcrumb-exact-active"
    &gt;
      è¯¦æƒ…
    &lt;/router-link&gt;
  &lt;/div&gt;
  
  &lt;!-- åœºæ™¯2ï¼šå¤šçº§èœå• --&gt;
  &lt;div class="sidebar"&gt;
    &lt;div class="menu-group"&gt;
      &lt;router-link 
        to="/admin"
        active-class="menu-group-active"
      &gt;
        ç®¡ç†åå°
      &lt;/router-link&gt;
      &lt;div class="submenu" v-if="$route.path.startsWith('/admin')"&gt;
        &lt;router-link 
          to="/admin/users"
          exact-active-class="submenu-active"
        &gt;
          ç”¨æˆ·ç®¡ç†
        &lt;/router-link&gt;
        &lt;router-link 
          to="/admin/products"
          exact-active-class="submenu-active"
        &gt;
          å•†å“ç®¡ç†
        &lt;/router-link&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.breadcrumb-active {
  color: #666;
}
.breadcrumb-exact-active {
  color: #1890ff;
  font-weight: bold;
}
.menu-group-active {
  background-color: #f0f0f0;
}
.submenu-active {
  color: #1890ff;
  border-left: 3px solid #1890ff;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-9">å››ã€å…¨å±€é…ç½®ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-10">4.1 å…¨å±€é…ç½®ï¼ˆæ¨èæ–¹å¼ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// router/index.js</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  <span class="hljs-attr">routes</span>: [
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> },
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span> },
    <span class="hljs-comment">// ... å…¶ä»–è·¯ç”±</span>
  ],
  
  <span class="hljs-comment">// å…¨å±€é…ç½® linkActiveClass å’Œ linkExactActiveClass</span>
  <span class="hljs-attr">linkActiveClass</span>: <span class="hljs-string">'router-link-active'</span>,
  <span class="hljs-attr">linkExactActiveClass</span>: <span class="hljs-string">'router-link-exact-active'</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- ä½¿ç”¨å…¨å±€é…ç½® --&gt;
  &lt;router-link to="/home"&gt;
    é¦–é¡µ &lt;!-- è‡ªåŠ¨åº”ç”¨ router-link-active ç±» --&gt;
  &lt;/router-link&gt;
  
  &lt;!-- å¯ä»¥è¦†ç›–å…¨å±€é…ç½® --&gt;
  &lt;router-link 
    to="/about"
    active-class="custom-active"
  &gt;
    å…³äº &lt;!-- ä½¿ç”¨ custom-active è€Œä¸æ˜¯ router-link-active --&gt;
  &lt;/router-link&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-11">4.2 æœ€ä½³å®è·µï¼šCSS è®¾è®¡</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* åŸºç¡€æ ·å¼ */</span>
<span class="hljs-selector-class">.router-link</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span> <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">text-decoration</span>: none;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* æ¿€æ´»çŠ¶æ€ - å±‚çº§æŒ‡ç¤ºå™¨ */</span>
<span class="hljs-selector-class">.router-link-active</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1890ff</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">24</span>, <span class="hljs-number">144</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.router-link-active</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: -<span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#1890ff</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">0.8</span>);
}

<span class="hljs-comment">/* ç²¾ç¡®æ¿€æ´»çŠ¶æ€ - å½“å‰é¡µé¢æŒ‡ç¤ºå™¨ */</span>
<span class="hljs-selector-class">.router-link-exact-active</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#1890ff</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.router-link-exact-active</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">1</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
}

<span class="hljs-comment">/* é…åˆ Tailwind CSS */</span>
&lt;router-link 
  <span class="hljs-selector-tag">to</span>="/dashboard"
  class="px-<span class="hljs-number">4</span> py-<span class="hljs-number">2</span> rounded-lg <span class="hljs-attribute">transition</span>-colors"
  active-class="bg-blue-<span class="hljs-number">50</span> text-blue-<span class="hljs-number">600</span>"
  exact-active-class="bg-blue-<span class="hljs-number">600</span> text-white"
&gt;
  ä»ªè¡¨ç›˜
&lt;/router-link&gt;
</code></pre>
<h3 data-id="heading-12">äº”ã€é«˜çº§ç”¨æ³•ä¸æŠ€å·§</h3>
<h4 data-id="heading-13">5.1 åŠ¨æ€ active-class</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- æ ¹æ®è·¯ç”±åŠ¨æ€è®¾ç½® --&gt;
    &lt;router-link
      v-for="item in navItems"
      :key="item.path"
      :to="item.path"
      :active-class="getActiveClass(item)"
      :exact-active-class="getExactActiveClass(item)"
    &gt;
      {{ item.name }}
    &lt;/router-link&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      navItems: [
        { path: '/', name: 'é¦–é¡µ', icon: 'home', priority: 'high' },
        { path: '/shop', name: 'å•†åŸ', icon: 'shop', priority: 'normal' },
        { path: '/admin', name: 'ç®¡ç†', icon: 'admin', priority: 'high' }
      ]
    }
  },
  methods: {
    getActiveClass(item) {
      // æ ¹æ®ä¼˜å…ˆçº§è¿”å›ä¸åŒçš„ active class
      switch(item.priority) {
        case 'high':
          return 'bg-red-50 text-red-600'
        case 'normal':
          return 'bg-gray-50 text-gray-600'
        default:
          return 'active'
      }
    },
    getExactActiveClass(item) {
      // ç²¾ç¡®åŒ¹é…æ—¶æ›´å¼ºè°ƒçš„æ ·å¼
      return this.getActiveClass(item) + ' font-bold border-l-4'
    }
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-14">5.2 è‡ªå®šä¹‰ç»„ä»¶å°è£…</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- components/SmartLink.vue --&gt;
&lt;template&gt;
  &lt;router-link
    v-bind="$attrs"
    :active-class="computedActiveClass"
    :exact-active-class="computedExactActiveClass"
    v-on="$listeners"
  &gt;
    &lt;!-- æ·»åŠ å›¾æ ‡æŒ‡ç¤ºå™¨ --&gt;
    &lt;span v-if="showIcon &amp;&amp; isActive" class="active-indicator"&gt;â–¶&lt;/span&gt;
    &lt;slot /&gt;
  &lt;/router-link&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'SmartLink',
  inheritAttrs: false,
  props: {
    showIcon: {
      type: Boolean,
      default: true
    },
    activeClass: {
      type: String,
      default: 'active'
    },
    exactActiveClass: {
      type: String,
      default: 'exact-active'
    }
  },
  computed: {
    isActive() {
      return this.$route.path.startsWith(this.$attrs.to)
    },
    computedActiveClass() {
      return `${this.activeClass} ${this.isActive ? 'smart-link-active' : ''}`
    },
    computedExactActiveClass() {
      const isExact = this.$route.path === this.$attrs.to
      return `${this.exactActiveClass} ${isExact ? 'smart-link-exact-active' : ''}`
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.active-indicator {
  margin-right: 4px;
  color: #1890ff;
}
.smart-link-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-15">5.3 ç»„åˆå¼ API ç”¨æ³•</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;router-link
    ref="linkRef"
    :to="to"
    :class="linkClasses"
    @click="handleClick"
  &gt;
    &lt;slot /&gt;
  &lt;/router-link&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, ref } from 'vue'
import { useRoute, useRouter } from 'vue-router'

const props = defineProps({
  to: { type: [String, Object], required: true },
  customActiveClass: String
})

const route = useRoute()
const router = useRouter()
const linkRef = ref(null)

// è®¡ç®—æ¿€æ´»çŠ¶æ€
const isActive = computed(() =&gt; {
  return route.path.startsWith(typeof props.to === 'string' 
    ? props.to 
    : props.to.path)
})

const isExactActive = computed(() =&gt; {
  return route.path === (typeof props.to === 'string' 
    ? props.to 
    : props.to.path)
})

// åŠ¨æ€è®¡ç®— class
const linkClasses = computed(() =&gt; {
  const classes = ['base-link']
  
  if (isActive.value) {
    classes.push(props.customActiveClass || 'active')
  }
  
  if (isExactActive.value) {
    classes.push('exact-active')
  }
  
  return classes
})

// ç‚¹å‡»äº‹ä»¶å¤„ç†
const handleClick = (e) =&gt; {
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç‚¹å‡»åˆ†æã€æƒé™æ£€æŸ¥ç­‰
  console.log('å¯¼èˆªåˆ°:', props.to)
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-16">å…­ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-17">6.1 é—®é¢˜ï¼šactive-class ä¸ç”Ÿæ•ˆ</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- é”™è¯¯ç¤ºä¾‹ --&gt;
  &lt;router-link to="/home" active-class="active"&gt;
    é¦–é¡µ &lt;!-- âŒ å¯èƒ½ä¸ç”Ÿæ•ˆ --&gt;
  &lt;/router-link&gt;
&lt;/template&gt;

&lt;!-- è§£å†³æ–¹æ¡ˆ1ï¼šæ£€æŸ¥ CSS ä¼˜å…ˆçº§ --&gt;
&lt;style&gt;
/* âŒ è¿™å¯èƒ½è¢«è¦†ç›– */
.active {
  color: red;
}

/* âœ… æé«˜ç‰¹å¼‚æ€§ */
.router-link.active {
  color: red !important; /* æ…ç”¨ !important */
}

/* âœ… æ›´å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ Vue çš„ scoped */
&lt;style scoped&gt;
/* è¿™ä¼šè‡ªåŠ¨æ·»åŠ  data-v-xxx å±æ€§æé«˜ç‰¹å¼‚æ€§ */
.active {
  color: red;
}
&lt;/style&gt;

&lt;!-- è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨å…¨å±€ç±»å --&gt;
&lt;router-link 
  to="/home" 
  active-class="global-active-class"
&gt;
  é¦–é¡µ
&lt;/router-link&gt;

&lt;!-- åœ¨å…¨å±€ CSS ä¸­ --&gt;
&lt;style&gt;
.global-active-class {
  color: red;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-18">6.2 é—®é¢˜ï¼šåµŒå¥—è·¯ç”±çš„æ¿€æ´»çŠ¶æ€</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·¯ç”±é…ç½®</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Dashboard</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">DashboardHome</span> },      <span class="hljs-comment">// /dashboard</span>
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'profile'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Profile</span> },    <span class="hljs-comment">// /dashboard/profile</span>
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'settings'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Settings</span> }   <span class="hljs-comment">// /dashboard/settings</span>
    ]
  }
]
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- Dashboard ç»„ä»¶å†… --&gt;
  &lt;nav&gt;
    &lt;!-- é—®é¢˜ï¼šè®¿é—® /dashboard/profile æ—¶ï¼Œæ‰€æœ‰é“¾æ¥éƒ½æ¿€æ´»ï¼Ÿ --&gt;
    &lt;router-link to="/dashboard" active-class="active"&gt;æ¦‚è§ˆ&lt;/router-link&gt;
    &lt;router-link to="/dashboard/profile" active-class="active"&gt;ä¸ªäººèµ„æ–™&lt;/router-link&gt;
    
    &lt;!-- è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ exact æˆ– exact-active-class --&gt;
    &lt;router-link 
      to="/dashboard" 
      exact-active-class="active"
    &gt;
      æ¦‚è§ˆ
    &lt;/router-link&gt;
    
    &lt;router-link 
      to="/dashboard/profile" 
      exact-active-class="active"
    &gt;
      ä¸ªäººèµ„æ–™
    &lt;/router-link&gt;
    
    &lt;!-- æˆ–è€…ä½¿ç”¨åµŒå¥—æ ·å¼ --&gt;
    &lt;router-link 
      to="/dashboard" 
      active-class="parent-active"
      exact-active-class="exact-active"
    &gt;
      æ¦‚è§ˆ
    &lt;/router-link&gt;
  &lt;/nav&gt;
&lt;/template&gt;

&lt;style&gt;
.parent-active {
  color: #666; /* çˆ¶çº§æ¿€æ´»æ ·å¼ */
}
.exact-active {
  color: #000; /* ç²¾ç¡®æ¿€æ´»æ ·å¼ */
  font-weight: bold;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-19">6.3 é—®é¢˜ï¼šä¸ UI æ¡†æ¶é›†æˆ</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- Element Plus é›†æˆ --&gt;
  &lt;el-menu :default-active="$route.path" router&gt;
    &lt;el-menu-item index="/home"&gt;
      &lt;router-link 
        to="/home" 
        custom
        v-slot="{ navigate, isActive }"
      &gt;
        &lt;span @click="navigate" :class="{ 'is-active': isActive }"&gt;
          é¦–é¡µ
        &lt;/span&gt;
      &lt;/router-link&gt;
    &lt;/el-menu-item&gt;
  &lt;/el-menu&gt;
  
  &lt;!-- Ant Design Vue é›†æˆ --&gt;
  &lt;a-menu :selected-keys="[$route.path]"&gt;
    &lt;a-menu-item key="/home"&gt;
      &lt;router-link to="/home"&gt;é¦–é¡µ&lt;/router-link&gt;
    &lt;/a-menu-item&gt;
  &lt;/a-menu&gt;
  
  &lt;!-- Vuetify é›†æˆ --&gt;
  &lt;v-list nav&gt;
    &lt;v-list-item
      v-for="item in items"
      :key="item.to"
      :to="item.to"
      active-class="v-list-item--active"
    &gt;
      &lt;v-list-item-title&gt;{{ item.title }}&lt;/v-list-item-title&gt;
    &lt;/v-list-item&gt;
  &lt;/v-list&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-20">ä¸ƒã€TypeScript ç±»å‹æ”¯æŒ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…¨å±€ç±»å‹å£°æ˜</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue-router'</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RouterLinkProps</span> {
    <span class="hljs-comment">// active-class çš„ç±»å‹å®šä¹‰</span>
    activeClass?: <span class="hljs-built_in">string</span>
    exactActiveClass?: <span class="hljs-built_in">string</span>
    <span class="hljs-comment">// ... å…¶ä»–å±æ€§</span>
  }
}

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RouterLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-comment">// è‡ªå®šä¹‰ç»„ä»¶å°è£…</span>
defineProps&lt;{
  <span class="hljs-attr">to</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">RouteLocationRaw</span>
  activeClass?: <span class="hljs-built_in">string</span>
  exactActiveClass?: <span class="hljs-built_in">string</span>
  customActive?: <span class="hljs-built_in">boolean</span>
}&gt;()

<span class="hljs-comment">// ç»„åˆå¼APIä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> linkProps = {
  <span class="hljs-attr">to</span>: <span class="hljs-string">'/dashboard'</span>,
  <span class="hljs-attr">activeClass</span>: <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> isActive.<span class="hljs-property">value</span> ? <span class="hljs-string">'active'</span> : <span class="hljs-string">''</span>),
  <span class="hljs-attr">exactActiveClass</span>: <span class="hljs-string">'exact-active'</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
</code></pre>
<h3 data-id="heading-21">æ€»ç»“</h3>
<p><code>active-class</code> æ˜¯ Vue Router <code>&lt;router-link&gt;</code> ç»„ä»¶çš„æ ¸å¿ƒå±æ€§ï¼Œç”¨äºç®¡ç†å¯¼èˆªé“¾æ¥çš„æ¿€æ´»çŠ¶æ€ã€‚è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<h4 data-id="heading-22">å…³é”®è¦ç‚¹ï¼š</h4>
<ol>
<li><strong>å±äº</strong>ï¼š<code>&lt;router-link&gt;</code> ç»„ä»¶ï¼ˆVue Router æä¾›ï¼‰</li>
<li><strong>ä½œç”¨</strong>ï¼šæ§åˆ¶è·¯ç”±åŒ¹é…æ—¶çš„æ ·å¼ç±»</li>
<li><strong>é…å¯¹å±æ€§</strong>ï¼š<code>exact-active-class</code>ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šåœ¨è·¯ç”±é…ç½®ä¸­å…¨å±€è®¾ç½®</li>
<li><strong>CSS ç­–ç•¥</strong>ï¼šä½¿ç”¨ scoped æ ·å¼æˆ–å…¨å±€ç±»å</li>
</ol>
<h4 data-id="heading-23">ä½¿ç”¨åŸåˆ™ï¼š</h4>
<ul>
<li><strong>ç®€å•å¯¼èˆª</strong>ï¼šä½¿ç”¨é»˜è®¤æˆ–å…¨å±€é…ç½®</li>
<li><strong>å¤æ‚èœå•</strong>ï¼šç»“åˆ <code>exact-active-class</code> åŒºåˆ†å­è·¯ç”±</li>
<li><strong>UI æ¡†æ¶</strong>ï¼šæŸ¥çœ‹æ¡†æ¶æ–‡æ¡£çš„é›†æˆæ–¹æ¡ˆ</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šé¿å…åœ¨å¤§é‡é“¾æ¥ä¸Šä½¿ç”¨å¤æ‚è®¡ç®—</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ç»ˆææœ€ä½³å®è·µç¤ºä¾‹ --&gt;
&lt;router-link
  :to="{ name: 'Home' }"
  class="nav-link"
  active-class="nav-link--active"
  exact-active-class="nav-link--exact-active"
&gt;
  é¦–é¡µ
&lt;/router-link&gt;
</code></pre>
<p>æŒæ¡äº† <code>active-class</code>ï¼Œä½ å°±æŒæ¡äº† Vue å•é¡µåº”ç”¨å¯¼èˆªçŠ¶æ€ç®¡ç†çš„ç²¾é«“ï¼ç°åœ¨å°±å»ä¼˜åŒ–ä½ çš„å¯¼èˆªèœå•å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue è¡¨å•ä¿®é¥°ç¬¦ .lazyï¼šæ€§èƒ½ä¼˜åŒ–çš„ç§˜å¯†æ­¦å™¨]]></title>    <link>https://juejin.cn/post/7595311405751549998</link>    <guid>https://juejin.cn/post/7595311405751549998</guid>    <pubDate>2026-01-15T07:49:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405751549998" data-draft-id="7595358285722320905" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue è¡¨å•ä¿®é¥°ç¬¦ .lazyï¼šæ€§èƒ½ä¼˜åŒ–çš„ç§˜å¯†æ­¦å™¨"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-15T07:49:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue è¡¨å•ä¿®é¥°ç¬¦ .lazyï¼šæ€§èƒ½ä¼˜åŒ–çš„ç§˜å¯†æ­¦å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:49:47.000Z" title="Thu Jan 15 2026 07:49:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue è¡¨å•ä¿®é¥°ç¬¦ .lazyï¼šæ€§èƒ½ä¼˜åŒ–çš„ç§˜å¯†æ­¦å™¨</h2>
<blockquote>
<p>åœ¨Vueçš„è¡¨å•å¤„ç†ä¸­ï¼Œ<code>.lazy</code>ä¿®é¥°ç¬¦æ˜¯ä¸€ä¸ªè¢«ä½ä¼°ä½†æå…¶é‡è¦çš„æ€§èƒ½ä¼˜åŒ–å·¥å…·ã€‚ä»Šå¤©æˆ‘ä»¬æ¥æ·±å…¥æ¢è®¨å®ƒçš„å·¥ä½œåŸç†ã€ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€.lazy çš„æ ¸å¿ƒä½œç”¨</h3>
<h4 data-id="heading-2">1.1 åŸºç¡€ç¤ºä¾‹ï¼šç«‹å³ç†è§£å·®å¼‚</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- æ²¡æœ‰ .lazyï¼šå®æ—¶æ›´æ–° --&gt;
    &lt;input 
      v-model="realtimeText" 
      placeholder="è¾“å…¥æ—¶å®æ—¶æ›´æ–°"
    /&gt;
    &lt;p&gt;å®æ—¶å€¼: {{ realtimeText }}&lt;/p&gt;
    
    &lt;!-- æœ‰ .lazyï¼šå¤±ç„¦åæ›´æ–° --&gt;
    &lt;input 
      v-model.lazy="lazyText" 
      placeholder="å¤±ç„¦åæ›´æ–°"
    /&gt;
    &lt;p&gt;æ‡’åŠ è½½å€¼: {{ lazyText }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      realtimeText: '',
      lazyText: ''
    }
  },
  watch: {
    realtimeText(newVal) {
      console.log('å®æ—¶è¾“å…¥:', newVal)
      // æ¯æ¬¡æŒ‰é”®éƒ½ä¼šè§¦å‘
    },
    lazyText(newVal) {
      console.log('æ‡’åŠ è½½è¾“å…¥:', newVal)
      // åªåœ¨å¤±ç„¦æ—¶è§¦å‘
    }
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-3">1.2 äº‹ä»¶æœºåˆ¶å¯¹æ¯”</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue å†…éƒ¨å¤„ç†æœºåˆ¶</span>
<span class="hljs-comment">// æ™®é€š v-modelï¼ˆæ—  .lazyï¼‰</span>
input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// æ¯æ¬¡è¾“å…¥äº‹ä»¶éƒ½è§¦å‘æ›´æ–°</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
})

<span class="hljs-comment">// v-model.lazy</span>
input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// åªåœ¨ change äº‹ä»¶è§¦å‘æ—¶æ›´æ–°</span>
  <span class="hljs-comment">// å¯¹äº inputï¼šå¤±ç„¦æ—¶è§¦å‘</span>
  <span class="hljs-comment">// å¯¹äº select/checkboxï¼šé€‰æ‹©å˜åŒ–æ—¶è§¦å‘</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
})
</code></pre>
<h3 data-id="heading-4">äºŒã€æ€§èƒ½ä¼˜åŒ–æ·±åº¦åˆ†æ</h3>
<h4 data-id="heading-5">2.1 æ€§èƒ½æµ‹è¯•å¯¹æ¯”</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;h3&gt;æ€§èƒ½æµ‹è¯•ï¼šè¾“å…¥100ä¸ªå­—ç¬¦&lt;/h3&gt;
    
    &lt;!-- æµ‹è¯•1ï¼šæ™®é€šç»‘å®š --&gt;
    &lt;div class="test-section"&gt;
      &lt;h4&gt;æ™®é€š v-model ({{ normalCount }} æ¬¡æ›´æ–°)&lt;/h4&gt;
      &lt;input v-model="normalText" /&gt;
      &lt;p&gt;è¾“å…¥: "{{ normalText }}"&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- æµ‹è¯•2ï¼š.lazy ç»‘å®š --&gt;
    &lt;div class="test-section"&gt;
      &lt;h4&gt;v-model.lazy ({{ lazyCount }} æ¬¡æ›´æ–°)&lt;/h4&gt;
      &lt;input v-model.lazy="lazyText" /&gt;
      &lt;p&gt;è¾“å…¥: "{{ lazyText }}"&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- æµ‹è¯•3ï¼šå¤æ‚è®¡ç®—åœºæ™¯ --&gt;
    &lt;div class="test-section"&gt;
      &lt;h4&gt;å¤æ‚è®¡ç®—åœºæ™¯&lt;/h4&gt;
      &lt;input 
        v-model="complexText" 
        placeholder="æ™®é€šç»‘å®š - è¾“å…¥è¯•è¯•"
      /&gt;
      &lt;div v-if="complexText"&gt;
        è®¡ç®—è€—æ—¶æ“ä½œ: {{ heavyComputation(complexText) }}
      &lt;/div&gt;
      
      &lt;input 
        v-model.lazy="complexLazyText" 
        placeholder="lazyç»‘å®š - è¾“å…¥è¯•è¯•"
      /&gt;
      &lt;div v-if="complexLazyText"&gt;
        è®¡ç®—è€—æ—¶æ“ä½œ: {{ heavyComputation(complexLazyText) }}
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      normalText: '',
      lazyText: '',
      complexText: '',
      complexLazyText: '',
      normalCount: 0,
      lazyCount: 0
    }
  },
  watch: {
    normalText() {
      this.normalCount++
    },
    lazyText() {
      this.lazyCount++
    }
  },
  methods: {
    heavyComputation(text) {
      // æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—
      console.time('computation')
      let result = ''
      for (let i = 0; i &lt; 10000; i++) {
        result = text.split('').reverse().join('')
      }
      console.timeEnd('computation')
      return result
    }
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-6">2.2 å†…å­˜å’ŒCPUå ç”¨å¯¹æ¯”</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ Performance API ç›‘æ§</span>
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">startPerformanceTest</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> iterations = <span class="hljs-number">1000</span>
    
    <span class="hljs-comment">// æµ‹è¯•æ™®é€šç»‘å®š</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'normal binding'</span>)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">normalText</span> = <span class="hljs-string">'test'</span> + i
      <span class="hljs-comment">// æ¯æ¬¡èµ‹å€¼éƒ½ä¼šè§¦å‘å“åº”å¼æ›´æ–°ã€è™šæ‹ŸDOM diffç­‰</span>
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'normal binding'</span>)
    
    <span class="hljs-comment">// æµ‹è¯•.lazyç»‘å®š</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'lazy binding'</span>)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lazyText</span> = <span class="hljs-string">'test'</span> + i
      <span class="hljs-comment">// åªæœ‰åœ¨changeäº‹ä»¶æ—¶æ‰è§¦å‘å®Œæ•´æ›´æ–°æµç¨‹</span>
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'lazy binding'</span>)
  }
}

<span class="hljs-comment">// å…¸å‹ç»“æœï¼š</span>
<span class="hljs-comment">// normal binding: 45.2ms</span>
<span class="hljs-comment">// lazy binding: 12.7ms (å¿«3.5å€ï¼)</span>
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-8">3.1 æœç´¢æ¡†ä¼˜åŒ–</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="search-container"&gt;
    &lt;!-- åœºæ™¯1ï¼šå®æ—¶æœç´¢ï¼ˆä¸æ¨èå¤§æ•°æ®é‡ï¼‰ --&gt;
    &lt;div class="search-type"&gt;
      &lt;h4&gt;å®æ—¶æœç´¢ï¼ˆæ™®é€šï¼‰&lt;/h4&gt;
      &lt;input 
        v-model="searchQuery" 
        placeholder="è¾“å…¥å…³é”®è¯..."
        @input="performSearch"
      /&gt;
      &lt;p&gt;APIè°ƒç”¨æ¬¡æ•°: {{ apiCalls }}æ¬¡&lt;/p&gt;
      &lt;ul&gt;
        &lt;li v-for="result in searchResults" :key="result.id"&gt;
          {{ result.title }}
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;!-- åœºæ™¯2ï¼šå¤±ç„¦æœç´¢ï¼ˆæ¨èï¼‰ --&gt;
    &lt;div class="search-type"&gt;
      &lt;h4&gt;å¤±ç„¦æœç´¢ï¼ˆ.lazy + é˜²æŠ–ï¼‰&lt;/h4&gt;
      &lt;input 
        v-model.lazy="lazySearchQuery" 
        placeholder="è¾“å…¥åæŒ‰å›è½¦æˆ–å¤±ç„¦"
        @keyup.enter="debouncedSearch"
      /&gt;
      &lt;p&gt;APIè°ƒç”¨æ¬¡æ•°: {{ lazyApiCalls }}æ¬¡&lt;/p&gt;
      &lt;ul&gt;
        &lt;li v-for="result in lazySearchResults" :key="result.id"&gt;
          {{ result.title }}
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
    
    &lt;!-- åœºæ™¯3ï¼šç»“åˆé˜²æŠ–çš„æœ€ä½³å®è·µ --&gt;
    &lt;div class="search-type"&gt;
      &lt;h4&gt;æ™ºèƒ½æœç´¢ï¼ˆ.lazy + è‡ªåŠ¨æœç´¢ï¼‰&lt;/h4&gt;
      &lt;input 
        v-model.lazy="smartSearchQuery" 
        placeholder="è¾“å…¥å®Œæˆåå†æœç´¢"
        @change="handleSmartSearch"
      /&gt;
      &lt;button @click="handleSmartSearch"&gt;æœç´¢&lt;/button&gt;
      &lt;p&gt;ä¼˜åŒ–åçš„APIè°ƒç”¨&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { debounce } from 'lodash-es'

export default {
  data() {
    return {
      searchQuery: '',
      lazySearchQuery: '',
      smartSearchQuery: '',
      searchResults: [],
      lazySearchResults: [],
      smartSearchResults: [],
      apiCalls: 0,
      lazyApiCalls: 0
    }
  },
  watch: {
    // æ™®é€šæœç´¢ï¼šæ¯æ¬¡è¾“å…¥éƒ½è§¦å‘
    searchQuery() {
      this.performSearch()
    },
    // .lazyæœç´¢ï¼šåªåœ¨å¤±ç„¦æ—¶è§¦å‘
    lazySearchQuery() {
      this.performLazySearch()
    }
  },
  created() {
    // åˆ›å»ºé˜²æŠ–å‡½æ•°
    this.debouncedSearch = debounce(this.performLazySearch, 500)
  },
  methods: {
    performSearch() {
      this.apiCalls++
      // æ¨¡æ‹ŸAPIè°ƒç”¨
      fetch(`/api/search?q=${this.searchQuery}`)
        .then(res =&gt; res.json())
        .then(data =&gt; {
          this.searchResults = data.results
        })
    },
    performLazySearch() {
      this.lazyApiCalls++
      fetch(`/api/search?q=${this.lazySearchQuery}`)
        .then(res =&gt; res.json())
        .then(data =&gt; {
          this.lazySearchResults = data.results
        })
    },
    handleSmartSearch() {
      // æ‰‹åŠ¨è§¦å‘æœç´¢é€»è¾‘
      this.performSmartSearch()
    },
    async performSmartSearch() {
      if (!this.smartSearchQuery.trim()) return
      
      const response = await fetch(`/api/search?q=${this.smartSearchQuery}`)
      this.smartSearchResults = await response.json()
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.search-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  padding: 20px;
}

.search-type {
  border: 1px solid #e0e0e0;
  padding: 15px;
  border-radius: 8px;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-9">3.2 è¡¨å•éªŒè¯ä¼˜åŒ–</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;form @submit.prevent="handleSubmit"&gt;
    &lt;!-- æ™®é€šéªŒè¯ï¼šå³æ—¶åé¦ˆ --&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;ç”¨æˆ·åï¼ˆå³æ—¶éªŒè¯ï¼‰:&lt;/label&gt;
      &lt;input 
        v-model="username" 
        @input="validateUsername"
        :class="{ 'error': usernameError }"
      /&gt;
      &lt;span v-if="usernameError" class="error-message"&gt;
        {{ usernameError }}
      &lt;/span&gt;
      &lt;p&gt;éªŒè¯è°ƒç”¨: {{ usernameValidations }}æ¬¡&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- .lazyéªŒè¯ï¼šå¤±ç„¦æ—¶éªŒè¯ --&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;é‚®ç®±ï¼ˆå¤±ç„¦éªŒè¯ï¼‰:&lt;/label&gt;
      &lt;input 
        v-model.lazy="email" 
        @change="validateEmail"
        :class="{ 'error': emailError }"
      /&gt;
      &lt;span v-if="emailError" class="error-message"&gt;
        {{ emailError }}
      &lt;/span&gt;
      &lt;p&gt;éªŒè¯è°ƒç”¨: {{ emailValidations }}æ¬¡&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- æ··åˆç­–ç•¥ï¼šå³æ—¶+å¤±ç„¦ --&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;å¯†ç ï¼ˆæ··åˆéªŒè¯ï¼‰:&lt;/label&gt;
      &lt;input 
        type="password"
        v-model="password" 
        @input="validatePasswordBasic"
        @change="validatePasswordAdvanced"
        :class="{ 'error': passwordError }"
      /&gt;
      &lt;span v-if="passwordError" class="error-message"&gt;
        {{ passwordError }}
      &lt;/span&gt;
    &lt;/div&gt;
    
    &lt;button type="submit"&gt;æäº¤&lt;/button&gt;
  &lt;/form&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      username: '',
      email: '',
      password: '',
      usernameError: '',
      emailError: '',
      passwordError: '',
      usernameValidations: 0,
      emailValidations: 0
    }
  },
  methods: {
    validateUsername() {
      this.usernameValidations++
      
      // ç®€å•éªŒè¯
      if (!this.username.trim()) {
        this.usernameError = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º'
      } else if (this.username.length &lt; 3) {
        this.usernameError = 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦'
      } else {
        this.usernameError = ''
      }
    },
    
    validateEmail() {
      this.emailValidations++
      
      // å¤æ‚é‚®ç®±éªŒè¯
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
      if (!this.email) {
        this.emailError = 'é‚®ç®±ä¸èƒ½ä¸ºç©º'
      } else if (!emailRegex.test(this.email)) {
        this.emailError = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
      } else {
        // å¼‚æ­¥éªŒè¯é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
        this.checkEmailAvailability(this.email)
      }
    },
    
    async checkEmailAvailability(email) {
      try {
        const response = await fetch(`/api/check-email?email=${email}`)
        const { available } = await response.json()
        
        if (!available) {
          this.emailError = 'è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ'
        } else {
          this.emailError = ''
        }
      } catch (error) {
        this.emailError = 'éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•'
      }
    },
    
    validatePasswordBasic() {
      // å³æ—¶åŸºç¡€éªŒè¯
      if (this.password.length &lt; 6) {
        this.passwordError = 'å¯†ç è‡³å°‘6ä½'
      } else {
        this.passwordError = ''
      }
    },
    
    validatePasswordAdvanced() {
      // å¤±ç„¦æ—¶é«˜çº§éªŒè¯
      if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(this.password)) {
        this.passwordError = 'éœ€åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—'
      }
    },
    
    handleSubmit() {
      // æäº¤å‰çš„æœ€ç»ˆéªŒè¯
      this.validateUsername()
      this.validateEmail()
      this.validatePasswordAdvanced()
      
      if (!this.usernameError &amp;&amp; !this.emailError &amp;&amp; !this.passwordError) {
        console.log('è¡¨å•æäº¤æˆåŠŸ')
        // æäº¤é€»è¾‘...
      }
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.form-group {
  margin-bottom: 20px;
}

.error {
  border-color: #f44336;
  background-color: #ffebee;
}

.error-message {
  color: #f44336;
  font-size: 12px;
  margin-top: 4px;
  display: block;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-10">3.3 å¤§æ•°æ®é‡è¡¨æ ¼ç¼–è¾‘</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="data-table"&gt;
    &lt;h3&gt;äº§å“ä»·æ ¼è¡¨ï¼ˆç¼–è¾‘ä¼˜åŒ–ï¼‰&lt;/h3&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;ID&lt;/th&gt;
          &lt;th&gt;äº§å“åç§°&lt;/th&gt;
          &lt;th&gt;ä»·æ ¼&lt;/th&gt;
          &lt;th&gt;åº“å­˜&lt;/th&gt;
          &lt;th&gt;æ“ä½œ&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr v-for="product in products" :key="product.id"&gt;
          &lt;td&gt;{{ product.id }}&lt;/td&gt;
          &lt;td&gt;{{ product.name }}&lt;/td&gt;
          &lt;td&gt;
            &lt;!-- ä½¿ç”¨ .lazy é¿å…é¢‘ç¹æ›´æ–° --&gt;
            &lt;input 
              v-model.lazy="product.price" 
              type="number"
              @change="updateProduct(product)"
            /&gt;
          &lt;/td&gt;
          &lt;td&gt;
            &lt;input 
              v-model.lazy="product.stock" 
              type="number"
              @change="updateProduct(product)"
            /&gt;
          &lt;/td&gt;
          &lt;td&gt;
            &lt;button @click="saveProduct(product)"&gt;ä¿å­˜&lt;/button&gt;
            &lt;span v-if="product.saving"&gt;ä¿å­˜ä¸­...&lt;/span&gt;
            &lt;span v-if="product.saved" class="saved"&gt;âœ“å·²ä¿å­˜&lt;/span&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
    
    &lt;div class="stats"&gt;
      &lt;p&gt;æ€»æ›´æ–°æ¬¡æ•°: {{ totalUpdates }}&lt;/p&gt;
      &lt;p&gt;APIè°ƒç”¨æ¬¡æ•°: {{ apiCalls }}&lt;/p&gt;
      &lt;p&gt;æ€§èƒ½èŠ‚çœ: {{ performanceSaving }}%&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      products: [],
      totalUpdates: 0,
      apiCalls: 0,
      updatesWithoutLazy: 0 // æ¨¡æ‹Ÿæ²¡æœ‰.lazyæ—¶çš„æ›´æ–°æ¬¡æ•°
    }
  },
  computed: {
    performanceSaving() {
      if (this.updatesWithoutLazy === 0) return 0
      const saving = ((this.updatesWithoutLazy - this.totalUpdates) / this.updatesWithoutLazy) * 100
      return Math.round(saving)
    }
  },
  created() {
    this.loadProducts()
  },
  methods: {
    async loadProducts() {
      const response = await fetch('/api/products')
      this.products = (await response.json()).map(p =&gt; ({
        ...p,
        saving: false,
        saved: false
      }))
    },
    
    updateProduct(product) {
      this.totalUpdates++
      
      // æ¨¡æ‹Ÿæ²¡æœ‰.lazyçš„æƒ…å†µï¼šæ¯æ¬¡è¾“å…¥éƒ½è®¡æ•°
      this.updatesWithoutLazy += 10 // å‡è®¾å¹³å‡æ¯ä¸ªå­—æ®µè¾“å…¥10æ¬¡
      
      // æ ‡è®°ä¸ºéœ€è¦ä¿å­˜
      product.saved = false
    },
    
    async saveProduct(product) {
      product.saving = true
      this.apiCalls++
      
      try {
        await fetch(`/api/products/${product.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        })
        product.saved = true
      } catch (error) {
        console.error('ä¿å­˜å¤±è´¥:', error)
      } finally {
        product.saving = false
      }
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.data-table {
  width: 100%;
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

th {
  background-color: #f5f5f5;
}

input {
  width: 80px;
  padding: 4px;
}

.saved {
  color: #4caf50;
  margin-left: 8px;
}

.stats {
  margin-top: 20px;
  padding: 10px;
  background-color: #f9f9f9;
  border-radius: 4px;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-11">å››ã€ä¸å…¶ä»–ä¿®é¥°ç¬¦çš„ç»„åˆä½¿ç”¨</h3>
<h4 data-id="heading-12">4.1 .lazy + .trim + .number</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="combined-modifiers"&gt;
    &lt;h3&gt;ä¿®é¥°ç¬¦ç»„åˆä½¿ç”¨&lt;/h3&gt;
    
    &lt;!-- ç»„åˆ1ï¼š.lazy + .trim --&gt;
    &lt;div class="example"&gt;
      &lt;label&gt;æœç´¢å…³é”®è¯ï¼ˆè‡ªåŠ¨ trimï¼‰:&lt;/label&gt;
      &lt;input 
        v-model.lazy.trim="searchKeyword" 
        placeholder="è¾“å…¥åè‡ªåŠ¨å»é™¤ç©ºæ ¼"
      /&gt;
      &lt;p&gt;å€¼: "{{ searchKeyword }}"&lt;/p&gt;
      &lt;p&gt;é•¿åº¦: {{ searchKeyword.length }}&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- ç»„åˆ2ï¼š.lazy + .number --&gt;
    &lt;div class="example"&gt;
      &lt;label&gt;æ•°é‡ï¼ˆè‡ªåŠ¨è½¬æ•°å­—ï¼‰:&lt;/label&gt;
      &lt;input 
        v-model.lazy.number="quantity" 
        type="number"
        placeholder="è¾“å…¥æ•°å­—"
      /&gt;
      &lt;p&gt;å€¼: {{ quantity }} (ç±»å‹: {{ typeof quantity }})&lt;/p&gt;
    &lt;/div&gt;
    
    &lt;!-- ç»„åˆ3ï¼šå…¨éƒ¨ä¸€èµ·ç”¨ --&gt;
    &lt;div class="example"&gt;
      &lt;label&gt;ä»·æ ¼ï¼ˆä¼˜åŒ–å¤„ç†ï¼‰:&lt;/label&gt;
      &lt;input 
        v-model.lazy.trim.number="price" 
        placeholder="ä¾‹å¦‚: 99.99"
      /&gt;
      &lt;p&gt;å€¼: {{ price }} (ç±»å‹: {{ typeof price }})&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      searchKeyword: '',
      quantity: 0,
      price: 0
    }
  },
  watch: {
    searchKeyword(newVal) {
      console.log('æœç´¢å…³é”®è¯å˜åŒ–:', newVal)
    },
    quantity(newVal) {
      console.log('æ•°é‡å˜åŒ–:', newVal, 'ç±»å‹:', typeof newVal)
    },
    price(newVal) {
      console.log('ä»·æ ¼å˜åŒ–:', newVal, 'ç±»å‹:', typeof newVal)
    }
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-13">4.2 è‡ªå®šä¹‰ä¿®é¥°ç¬¦</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºè‡ªå®šä¹‰ .lazy æ‰©å±•</span>
<span class="hljs-keyword">const</span> lazyModifier = {
  <span class="hljs-comment">// åœ¨ç»‘å®šæ—¶æ·»åŠ äº‹ä»¶ç›‘å¬</span>
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding, vnode</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">inputHandler</span> = (<span class="hljs-params">event</span>) =&gt; {
      <span class="hljs-comment">// åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ›´æ–°</span>
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-string">'change'</span> || event.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
        binding.<span class="hljs-title function_">value</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)
      }
    }
    
    el.<span class="hljs-property">_lazyHandler</span> = inputHandler
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, inputHandler)
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, inputHandler)
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keyup'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) <span class="hljs-title function_">inputHandler</span>(e)
    })
  },
  
  <span class="hljs-comment">// æ¸…ç†</span>
  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el</span>) {
    el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'input'</span>, el.<span class="hljs-property">_lazyHandler</span>)
    el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'change'</span>, el.<span class="hljs-property">_lazyHandler</span>)
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_lazyHandler</span>
  }
}

<span class="hljs-comment">// æ³¨å†Œä¸ºå…¨å±€æŒ‡ä»¤</span>
app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'lazy'</span>, lazyModifier)

<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰ lazy æŒ‡ä»¤</span>
&lt;input v-lazy=<span class="hljs-string">"value"</span> /&gt;
</code></pre>
<h3 data-id="heading-14">äº”ã€æœ€ä½³å®è·µä¸æ€§èƒ½å»ºè®®</h3>
<h4 data-id="heading-15">5.1 ä½•æ—¶ä½¿ç”¨ .lazy</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨èä½¿ç”¨ .lazy çš„åœºæ™¯ âœ…</span>
<span class="hljs-keyword">const</span> lazyRecommendedScenarios = [
  <span class="hljs-string">'è¡¨å•å­—æ®µéªŒè¯ï¼ˆå¤±ç„¦æ—¶éªŒè¯ï¼‰'</span>,
  <span class="hljs-string">'æœç´¢æ¡†ï¼ˆé¿å…é¢‘ç¹APIè°ƒç”¨ï¼‰'</span>,
  <span class="hljs-string">'å¤§æ•°æ®é‡è¡¨æ ¼ç¼–è¾‘'</span>,
  <span class="hljs-string">'å¤æ‚è®¡ç®—ä¾èµ–çš„è¾“å…¥'</span>,
  <span class="hljs-string">'ç§»åŠ¨ç«¯ï¼ˆå‡å°‘è™šæ‹Ÿé”®ç›˜å¼¹å‡ºæ—¶çš„å¡é¡¿ï¼‰'</span>,
  <span class="hljs-string">'éœ€è¦ä¸åç«¯åŒæ­¥çš„å­—æ®µ'</span>
]

<span class="hljs-comment">// ä¸å»ºè®®ä½¿ç”¨ .lazy çš„åœºæ™¯ âŒ</span>
<span class="hljs-keyword">const</span> lazyNotRecommendedScenarios = [
  <span class="hljs-string">'å®æ—¶åé¦ˆè¾“å…¥ï¼ˆå¦‚å¯†ç å¼ºåº¦æ£€æŸ¥ï¼‰'</span>,
  <span class="hljs-string">'å³æ—¶æœç´¢å»ºè®®'</span>,
  <span class="hljs-string">'å­—ç¬¦è®¡æ•°å™¨'</span>,
  <span class="hljs-string">'éœ€è¦ç«‹å³å“åº”çš„UIï¼ˆå¦‚å¼€å…³ã€æ»‘å—ï¼‰'</span>,
  <span class="hljs-string">'éœ€è¦å®æ—¶é¢„è§ˆçš„ç¼–è¾‘å™¨'</span>
]
</code></pre>
<h4 data-id="heading-16">5.2 æ€§èƒ½ç›‘æ§ä»£ç </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½ç›‘æ§è£…é¥°å™¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">withPerformanceMonitor</span>(<span class="hljs-params">Component</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">extends</span>: <span class="hljs-title class_">Component</span>,
    <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputEvents</span> = <span class="hljs-number">0</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateEvents</span> = <span class="hljs-number">0</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span> = []
    },
    <span class="hljs-attr">methods</span>: {
      <span class="hljs-title function_">logPerformance</span>(<span class="hljs-params">eventType</span>) {
        <span class="hljs-keyword">const</span> now = performance.<span class="hljs-title function_">now</span>()
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">time</span>: now,
          <span class="hljs-attr">event</span>: eventType,
          <span class="hljs-attr">memory</span>: performance.<span class="hljs-property">memory</span>?.<span class="hljs-property">usedJSHeapSize</span>
        })
        
        <span class="hljs-comment">// å®šæœŸæ¸…ç†æ—¥å¿—</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1000</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">500</span>)
        }
      },
      <span class="hljs-title function_">getPerformanceReport</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> events = <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">log</span> =&gt;</span> log.<span class="hljs-property">event</span>)
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">totalEvents</span>: events.<span class="hljs-property">length</span>,
          <span class="hljs-attr">inputEvents</span>: events.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e === <span class="hljs-string">'input'</span>).<span class="hljs-property">length</span>,
          <span class="hljs-attr">updateEvents</span>: events.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e === <span class="hljs-string">'update'</span>).<span class="hljs-property">length</span>,
          <span class="hljs-attr">avgTimeBetweenUpdates</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateAvgUpdateTime</span>()
        }
      }
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withPerformanceMonitor</span>({
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-string">''</span> }
  },
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-title function_">value</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">logPerformance</span>(<span class="hljs-string">'update'</span>)
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">logPerformance</span>(<span class="hljs-string">'input'</span>)
    })
  }
})
</code></pre>
<h3 data-id="heading-17">æ€»ç»“</h3>
<h4 data-id="heading-18"><code>.lazy</code> ä¿®é¥°ç¬¦çš„æ ¸å¿ƒä»·å€¼ï¼š</h4>
<ol>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„å“åº”å¼æ›´æ–°å’Œè™šæ‹ŸDOM diff</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¿å…è¾“å…¥è¿‡ç¨‹ä¸­çš„è·³åŠ¨å’Œå¡é¡¿</li>
<li><strong>èµ„æºèŠ‚çœ</strong>ï¼šå‡å°‘APIè°ƒç”¨å’ŒæœåŠ¡å™¨è´Ÿè½½</li>
<li><strong>æ§åˆ¶ç²¾åº¦</strong>ï¼šåªåœ¨ç”¨æˆ·å®Œæˆè¾“å…¥åå¤„ç†æ•°æ®</li>
</ol>
<h4 data-id="heading-19">ä½¿ç”¨å‡†åˆ™ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å†³ç­–æµç¨‹å›¾</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldUseLazy</span>(<span class="hljs-params">field</span>) {
  <span class="hljs-keyword">if</span> (field.<span class="hljs-property">needsRealTimeFeedback</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (field.<span class="hljs-property">triggersHeavyComputation</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">if</span> (field.<span class="hljs-property">updatesFrequently</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">if</span> (field.<span class="hljs-property">hasAsyncValidation</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// è®°ä½è¿™ä¸ªå£è¯€ï¼š</span>
<span class="hljs-comment">// "å®æ—¶åé¦ˆä¸ç”¨æ‡’ï¼Œå¤æ‚æ“ä½œæ‡’ä¼˜å…ˆ"</span>
<span class="hljs-comment">// "è¡¨å•éªŒè¯å¤±ç„¦åšï¼Œæœç´¢ä¼˜åŒ–æ•ˆæœæ˜¾"</span>
</code></pre>
<p><code>.lazy</code> ä¿®é¥°ç¬¦æ˜¯ Vue è¡¨å•å¤„ç†ä¸­çš„"æ™ºèƒ½èŠ‚æµé˜€"ï¼Œåˆç†ä½¿ç”¨å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚è¡¨å•å’Œå¤§æ•°æ®åœºæ™¯æ—¶ã€‚æŒæ¡å®ƒï¼Œè®©ä½ çš„ Vue åº”ç”¨æ›´åŠ æµç•…é«˜æ•ˆï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutteræœ€ä½³å®è·µï¼šè·¯ç”±å¼¹çª—ç»ˆæç‰ˆNSlidePopupRoute]]></title>    <link>https://juejin.cn/post/7594835618120630312</link>    <guid>https://juejin.cn/post/7594835618120630312</guid>    <pubDate>2026-01-14T10:16:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120630312" data-draft-id="7589835342146093066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutteræœ€ä½³å®è·µï¼šè·¯ç”±å¼¹çª—ç»ˆæç‰ˆNSlidePopupRoute"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter"/> <meta itemprop="datePublished" content="2026-01-14T10:16:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SoaringHeart"/> <meta itemprop="url" content="https://juejin.cn/user/3544481219481374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutteræœ€ä½³å®è·µï¼šè·¯ç”±å¼¹çª—ç»ˆæç‰ˆNSlidePopupRoute
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3544481219481374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SoaringHeart
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:16:37.000Z" title="Wed Jan 14 2026 10:16:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€éœ€æ±‚æ¥æº</h2>
<p>æœ€è¿‘éœ€è¦å®ç°å¼¹çª—ï¼ŒåŠ¨ç”»æ–¹å‘åˆ†ä¸ºï¼š</p>
<ol>
<li>ä»å±å¹•é¡¶éƒ¨æ»‘åŠ¨åˆ°å±å¹•å†…ï¼Œtop-&gt;Centerã€‚</li>
<li>ä»å±å¹•åº•éƒ¨æ»‘åŠ¨åˆ°å±å¹•å†…ï¼Œbottom-&gt;Centerã€‚</li>
<li>ä»å±å¹•å·¦ä¾§æ»‘åŠ¨åˆ°å±å¹•å†…ï¼Œleft-&gt;Centerã€‚</li>
<li>ä»å±å¹•å³ä¾§æ»‘åŠ¨åˆ°å±å¹•å†…ï¼Œright-&gt;Centerã€‚</li>
<li>ç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸­é—´ï¼ŒCenter-&gt;Centerã€‚</li>
</ol>
<p>æœ€ç»ˆå®ç°ä»¥ Alignment å‚æ•°ä¸ºåŠ¨ç”»æ–¹å‘ï¼Œå¼¹çª—å†…å®¹é«˜åº¦å’Œå®½åº¦è‡ªå®šä¹‰ï¼Œå®ç°ä»å“ªä¸ªæ–¹å‘å¼¹å‡ºå°±ä»å“ªä¸ªæ–¹å‘æ¶ˆå¤±çš„é«˜è‡ªç”±åº¦ã€‚å½»åº•çªç ´äº† ModalBottomSheet çš„æ–¹å‘æ˜¾ç¤ºã€‚
æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd6f61c328cc465680fc258b4d35532a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=eMH6yEtL597plNJlh4VeqSckpOE%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.41.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87f3e1c4b6ef489284f60f724d27aff5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=DvtcquIvOq51wx2YWHZxjcs9BXY%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.43.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704337ca7ab647ada987bcbdab647bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=yOK7BSeHA%2B8ET%2FTdJJnez3k1qe4%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.45.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db0ac7dd3ddf4250badb36380399b30b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=3bizmxzCvugyies37u1Kbqk0zy0%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.48.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c08f35a5439944718bcee41989cd1d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=JjxJnJlUDV%2FNi1OFv8GCsYlAJtg%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.51.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b5bfdc5a98d4ec6930a06ff11e04eb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=fzfhzL2qprpbAVVCWxT%2FORQ75OQ%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.53.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e4f2f3dd39403fb1a0520f1c555eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=9Lvik1Watkronx72JXJYKm8G2B0%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.59.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46415d2022e474fa6d8dc9beacc82d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=Q%2FbQaGCp9lZ0wm4IYvRgpnhRvdw%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.37.01.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe7aa9ee81064c33a819b4e2bafab1df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=2lOcbRtDLADN0Yfv7bhSJi0SodM%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.37.04.png" loading="lazy"/></p>
<h2 data-id="heading-1">äºŒã€ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> '<span class="hljs-selector-tag">package</span>:<span class="hljs-selector-tag">flutter</span>/<span class="hljs-selector-tag">material</span><span class="hljs-selector-class">.dart</span>';
<span class="hljs-selector-tag">import</span> '<span class="hljs-selector-tag">package</span>:<span class="hljs-selector-tag">n_slide_popup</span>/<span class="hljs-selector-tag">n_slide_popup</span><span class="hljs-selector-class">.dart</span>';

<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>() {
  <span class="hljs-selector-tag">runApp</span>(const <span class="hljs-built_in">MyApp</span>());
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MyApp</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatelessWidget</span> {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">MyApp</span>({<span class="hljs-selector-tag">super</span><span class="hljs-selector-class">.key</span>});

  <span class="hljs-comment">// This widget is the root of your application.</span>
  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">MaterialApp</span>(
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Flutter Demo'</span>,
      <span class="hljs-attribute">theme</span>: <span class="hljs-built_in">ThemeData</span>(
        <span class="hljs-attribute">colorScheme</span>: ColorScheme.<span class="hljs-built_in">fromSeed</span>(<span class="hljs-attribute">seedColor</span>: Colors.blue),
        <span class="hljs-attribute">useMaterial3</span>: true,
      ),
      <span class="hljs-attribute">home</span>: const <span class="hljs-built_in">MyHomePage</span>(<span class="hljs-attribute">title</span>: <span class="hljs-string">'Home Page'</span>),
    );
  }
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MyHomePage</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatefulWidget</span> {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">MyHomePage</span>({<span class="hljs-selector-tag">super</span><span class="hljs-selector-class">.key</span>, <span class="hljs-selector-tag">required</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.title</span>});

  <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">title</span>;

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">State</span>&lt;<span class="hljs-selector-tag">MyHomePage</span>&gt; <span class="hljs-selector-tag">createState</span>() =&gt; <span class="hljs-selector-tag">_MyHomePageState</span>();
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">_MyHomePageState</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">State</span>&lt;<span class="hljs-selector-tag">MyHomePage</span>&gt; {
  <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Alignment</span>&gt; <span class="hljs-selector-tag">alignments</span> = <span class="hljs-selector-attr">[    Alignment.topLeft,    Alignment.topCenter,    Alignment.topRight,    Alignment.centerLeft,    Alignment.center,    Alignment.centerRight,    Alignment.bottomLeft,    Alignment.bottomCenter,    Alignment.bottomRight,  ]</span>;

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">alignment</span> = <span class="hljs-selector-tag">Alignment</span><span class="hljs-selector-class">.center</span>;

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Scaffold</span>(
      <span class="hljs-attribute">appBar</span>: <span class="hljs-built_in">AppBar</span>(
        <span class="hljs-attribute">backgroundColor</span>: Theme.<span class="hljs-built_in">of</span>(context).colorScheme.inversePrimary,
        <span class="hljs-attribute">title</span>: <span class="hljs-built_in">Text</span>(widget.title),
      ),
      <span class="hljs-attribute">body</span>: <span class="hljs-built_in">Column</span>(
        <span class="hljs-attribute">mainAxisAlignment</span>: MainAxisAlignment.center,
        <span class="hljs-attribute">children</span>: &lt;Widget&gt;[
          const <span class="hljs-built_in">Text</span>(<span class="hljs-string">"direction from Alignment."</span>),
          <span class="hljs-built_in">Wrap</span>(
            <span class="hljs-attribute">spacing</span>: <span class="hljs-number">8</span>,
            <span class="hljs-attribute">runSpacing</span>: <span class="hljs-number">8</span>,
            <span class="hljs-attribute">children</span>: [
              ...alignments.<span class="hljs-built_in">map</span>((e) {
                var name = e.<span class="hljs-built_in">toString</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>];
                return <span class="hljs-built_in">ElevatedButton</span>(
                  <span class="hljs-attribute">style</span>: ElevatedButton.<span class="hljs-built_in">styleFrom</span>(
                    <span class="hljs-attribute">backgroundColor</span>: Colors.blue,
                    <span class="hljs-attribute">elevation</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attribute">tapTargetSize</span>: MaterialTapTargetSize.shrinkWrap,
                    <span class="hljs-attribute">minimumSize</span>: const <span class="hljs-built_in">Size</span>(<span class="hljs-number">64</span>, <span class="hljs-number">36</span>),
                  ),
                  <span class="hljs-attribute">onPressed</span>: () {
                    alignment = e;
                    <span class="hljs-built_in">debugPrint</span>(<span class="hljs-string">"$alignment ${alignment.x} ${alignment.y}"</span>);
                    <span class="hljs-built_in">onPopupRoute</span>();
                  },
                  <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(
                    name,
                    <span class="hljs-attribute">style</span>: <span class="hljs-built_in">TextStyle</span>(<span class="hljs-attribute">color</span>: Colors.white),
                  ),
                );
              }),
            ],
          )
        ],
      ),
    );
  }

  <span class="hljs-selector-tag">Future</span>&lt;<span class="hljs-selector-tag">void</span>&gt; <span class="hljs-selector-tag">onPopupRoute</span>() <span class="hljs-selector-tag">async</span> {
    <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">route</span> = <span class="hljs-selector-tag">NSlidePopupRoute</span>(
      <span class="hljs-attribute">from</span>: alignment,
      <span class="hljs-attribute">builder</span>: (_) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildPopupView</span>(<span class="hljs-attribute">alignment</span>: alignment, <span class="hljs-attribute">argsDismiss</span>: {"<span class="hljs-selector-tag">b</span>": "<span class="hljs-number">88</span>"});
      },
    );
    <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">Navigator</span><span class="hljs-selector-class">.of</span>(context)<span class="hljs-selector-class">.push</span>(route);
    <span class="hljs-selector-tag">print</span>([<span class="hljs-string">"result"</span>, result.runtimeType, result]);
  }

  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">buildPopupView</span>({<span class="hljs-selector-tag">required</span> <span class="hljs-selector-tag">Alignment</span> <span class="hljs-selector-tag">alignment</span>, <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">dynamic</span>&gt;? <span class="hljs-selector-tag">argsDismiss</span>}) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Align</span>(
      <span class="hljs-attribute">alignment</span>: alignment,
      <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Container</span>(
        <span class="hljs-attribute">width</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attribute">height</span>: <span class="hljs-number">400</span>,
        <span class="hljs-attribute">alignment</span>: Alignment.center,
        <span class="hljs-attribute">decoration</span>: <span class="hljs-built_in">BoxDecoration</span>(
          <span class="hljs-attribute">color</span>: Colors.green,
          <span class="hljs-attribute">border</span>: Border.<span class="hljs-built_in">all</span>(<span class="hljs-attribute">color</span>: Colors.blue),
          <span class="hljs-attribute">borderRadius</span>: BorderRadius.<span class="hljs-built_in">all</span>(Radius.<span class="hljs-built_in">circular</span>(<span class="hljs-number">0</span>)),
        ),
        <span class="hljs-attribute">child</span>: <span class="hljs-built_in">ElevatedButton</span>(
          <span class="hljs-attribute">onPressed</span>: () {
            Navigator.<span class="hljs-built_in">of</span>(context).<span class="hljs-built_in">pop</span>(argsDismiss);
          },
          <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">"dismiss"</span>),
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€æºç </h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  NSlidePopupRoute.dart</span>
<span class="hljs-comment">//  n_slide_popup</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Created by shang on 2025/12/27.</span>
<span class="hljs-comment">//  Copyright Â© 2025/12/27 shang. All rights reserved.</span>
<span class="hljs-comment">//</span>


import <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-comment">/// æœ€æ–°æ»‘å…¥å¼¹çª—</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSlidePopupRoute</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">PopupRoute</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
  <span class="hljs-title function_ invoke__">NSlidePopupRoute</span>({
    super.settings,
    required this.builder,
    this.<span class="hljs-keyword">from</span> = Alignment.bottomCenter,
    this.barrierColor = <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Color</span>(<span class="hljs-number">0x80000000</span>),
    this.barrierDismissible = <span class="hljs-literal">true</span>,
    this.duration = <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">milliseconds</span>: <span class="hljs-number">300</span>),
    this.barrierLabel,
    this.curve = Curves.easeOutCubic,
  });

  <span class="hljs-keyword">final</span> WidgetBuilder builder;

  <span class="hljs-comment">/// ä»å“ªä¸ªæ–¹å‘è¿›å…¥ï¼ˆæ¨èï¼štopCenter / bottomCenter / centerLeft / centerRightï¼‰</span>
  <span class="hljs-keyword">final</span> Alignment <span class="hljs-keyword">from</span>;

  <span class="hljs-keyword">final</span> Duration duration;

  <span class="hljs-keyword">final</span> Curve curve;

  @override
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">bool</span> barrierDismissible;

  @override
  <span class="hljs-keyword">final</span> Color barrierColor;

  @override
  <span class="hljs-keyword">final</span> String? barrierLabel;

  @override
  Duration get transitionDuration =&gt; duration;

  <span class="hljs-comment">// å±•ç¤º</span>
  <span class="hljs-built_in">static</span> Future&lt;T<span class="hljs-meta">?&gt;</span> show&lt;T&gt;({
    required BuildContext context,
    required WidgetBuilder builder,
    Alignment <span class="hljs-keyword">from</span> = Alignment.bottomCenter,
    Duration duration = <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Duration</span>(milliseconds: <span class="hljs-number">300</span>),
    Curve curve = Curves.easeOutCubic,
    Color barrierColor = <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Color</span>(<span class="hljs-number">0x80000000</span>),
    <span class="hljs-keyword">bool</span> barrierDismissible = <span class="hljs-literal">true</span>,
    String? barrierLabel,
    <span class="hljs-keyword">bool</span> useRootNavigator = <span class="hljs-literal">true</span>,
    RouteSettings? routeSettings,
  }) {
    <span class="hljs-keyword">return</span> Navigator.<span class="hljs-title function_ invoke__">of</span>(context, <span class="hljs-attr">rootNavigator</span>: useRootNavigator).<span class="hljs-title function_ invoke__">push</span>(
      NSlidePopupRoute&lt;T&gt;(
        <span class="hljs-attr">builder</span>: builder,
        <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>,
        <span class="hljs-attr">duration</span>: duration,
        <span class="hljs-attr">curve</span>: curve,
        <span class="hljs-attr">barrierColor</span>: barrierColor,
        <span class="hljs-attr">barrierDismissible</span>: barrierDismissible,
        <span class="hljs-attr">barrierLabel</span>: barrierLabel,
        <span class="hljs-attr">settings</span>: routeSettings,
      ),
    );
  }

  @override
  Widget <span class="hljs-title function_ invoke__">buildPage</span>(
    BuildContext context,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; animation,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; secondaryAnimation,
  ) {
    <span class="hljs-comment">// ç›´æ¥è¿”å›èƒŒæ™¯å’Œå†…å®¹ï¼Œä¸åº”ç”¨åŠ¨ç”»</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Material</span>(
      <span class="hljs-attr">color</span>: barrierColor,
      <span class="hljs-attr">child</span>: <span class="hljs-keyword">const</span> SizedBox.<span class="hljs-title function_ invoke__">expand</span>(), // åªè´Ÿè´£èƒŒæ™¯
    );
  }

  @override
  Widget <span class="hljs-title function_ invoke__">buildTransitions</span>(
    BuildContext context,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; animation,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; secondaryAnimation,
    Widget child,
  ) {
    <span class="hljs-keyword">final</span> content = <span class="hljs-title function_ invoke__">builder</span>(context);

    <span class="hljs-comment">// â­ ä¸­å¿ƒå¼¹çª—ï¼šFade</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span> == Alignment.center) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">FadeTransition</span>(
        <span class="hljs-attr">opacity</span>: animation.<span class="hljs-title function_ invoke__">drive</span>(
          <span class="hljs-title function_ invoke__">CurveTween</span>(<span class="hljs-attr">curve</span>: Curves.easeOut),
        ),
        <span class="hljs-attr">child</span>: content,
      );
    }

    <span class="hljs-comment">// â­ å…¶ä½™æ–¹å‘ï¼šSlide</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">FadeTransition</span>(
      <span class="hljs-attr">opacity</span>: animation,
      <span class="hljs-attr">child</span>: <span class="hljs-title function_ invoke__">SlideTransition</span>(
        <span class="hljs-attr">position</span>: animation.<span class="hljs-title function_ invoke__">drive</span>(
          Tween&lt;Offset&gt;(
            <span class="hljs-attr">begin</span>: <span class="hljs-title function_ invoke__">_alignmentToOffset</span>(<span class="hljs-keyword">from</span>),
            <span class="hljs-attr">end</span>: Offset.zero,
          ).<span class="hljs-title function_ invoke__">chain</span>(
            <span class="hljs-title function_ invoke__">CurveTween</span>(<span class="hljs-attr">curve</span>: curve),
          ),
        ),
        <span class="hljs-attr">child</span>: content,
      ),
    );
  }

  <span class="hljs-comment">/// Alignment â†’ Offsetï¼ˆå…³é”®ç‚¹ï¼‰</span>
  Offset <span class="hljs-title function_ invoke__">_alignmentToOffset</span>(Alignment alignment) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Offset</span>(
      alignment.x.sign,
      alignment.y.sign,
    );
  }
}
</code></pre>
<h2 data-id="heading-3">æœ€åã€æ€»ç»“</h2>
<ol>
<li>NSlidePopupRoute ä»£ç å®ç°æç®€ï¼Œæ²¡æœ‰è¿‡å¤šçš„åº•å±‚å°è£…ï¼Œæ˜¯ä¸ºäº†è¿½æ±‚æè‡´çš„è‡ªç”±åº¦ã€‚</li>
<li>å½“ alignment == Alignment.center æ—¶ï¼Œå®ƒæ˜¯ Dialogå¼¹çª—ã€‚</li>
<li>ä»é¡¶éƒ¨æ»‘å‡ºæ—¶ï¼Œå®ƒå¯ä»¥æ˜¯é¡¶éƒ¨é€šçŸ¥ Toastã€‚</li>
<li>ä»åº•éƒ¨æ»‘å‡ºæ—¶ï¼Œå®ƒå¯ä»¥æ˜¯ ModalBottomSheetï¼ŒSnackBarã€‚</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshang1219178163%2Fn_slide_popup" target="_blank" title="https://github.com/shang1219178163/n_slide_popup" ref="nofollow noopener noreferrer">github</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fn_slide_popup" target="_blank" title="https://pub.dev/packages/n_slide_popup" ref="nofollow noopener noreferrer">pub.dev</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dart å®˜æ–¹å†è§£é‡Šä¸ºä»€ä¹ˆæ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œå¹¶è½¬å‘ä¼˜åŒ– build_runner ?| æ˜é‡‘ä¸€å‘¨ 1.15]]></title>    <link>https://juejin.cn/post/7595311405751025710</link>    <guid>https://juejin.cn/post/7595311405751025710</guid>    <pubDate>2026-01-15T06:36:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405751025710" data-draft-id="7595341943337418762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dart å®˜æ–¹å†è§£é‡Šä¸ºä»€ä¹ˆæ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œå¹¶è½¬å‘ä¼˜åŒ– build_runner ?| æ˜é‡‘ä¸€å‘¨ 1.15"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-15T06:36:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘ä¸€å‘¨"/> <meta itemprop="url" content="https://juejin.cn/user/53218623894222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dart å®˜æ–¹å†è§£é‡Šä¸ºä»€ä¹ˆæ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œå¹¶è½¬å‘ä¼˜åŒ– build_runner ?| æ˜é‡‘ä¸€å‘¨ 1.15
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/53218623894222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘ä¸€å‘¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:36:53.000Z" title="Thu Jan 15 2026 06:36:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>æœ¬æ–‡å­—æ•°1100+ ï¼Œé˜…è¯»æ—¶é—´å¤§çº¦éœ€è¦ 4åˆ†é’Ÿã€‚</em></p>
<blockquote>
<p>ã€æ˜é‡‘ä¸€å‘¨ã€‘æœ¬æœŸäº®ç‚¹ï¼š</p>
</blockquote>
<ul>
<li>
<p><a href="https://juejin.cn/post/7592094358658138146" target="_blank" title="https://juejin.cn/post/7592094358658138146">æœ‰èµAIç ”å‘å…¨æµç¨‹è½åœ°å®è·µ</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7593139476839874566" target="_blank" title="https://juejin.cn/post/7593139476839874566">2026å¹´çš„ITåœˆï¼Œçœ‹çœ‹è°åœ¨â€œè£¸æ³³â€ï¼Œè°åœ¨â€œåƒè‚‰â€</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7591330139083898895" target="_blank" title="https://juejin.cn/post/7591330139083898895">ä¸€æ¯èŒ¶æ—¶é—´å¸¦ä½ åŸºäº Yjs å’Œ reactflow æ„å»ºååŒæµç¨‹å›¾ç¼–è¾‘å™¨ ğŸ˜ğŸ˜ğŸ˜</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7592452108798165035" target="_blank" title="https://juejin.cn/post/7592452108798165035">ğŸ¥è§£å†³å‰ç«¯ â€œå¤ç°éš¾â€ï¼šrrweb å½•åˆ¶å›æ”¾ä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸Šï¼‰</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7591317772075122707" target="_blank" title="https://juejin.cn/post/7591317772075122707">ä»æ´»åŠ¨ç¼–æ’åˆ°ç§¯åˆ†ç³»ç»Ÿï¼šäº‹ä»¶é©±åŠ¨åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€æ¬¡å»¶ä¼¸</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7591730714140606506" target="_blank" title="https://juejin.cn/post/7591730714140606506">Dart å®˜æ–¹å†è§£é‡Šä¸ºä»€ä¹ˆæ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œå¹¶è½¬å‘ä¼˜åŒ– build_runner ? å’Œ Kotlin çš„åŒºåˆ«åˆæ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
</li>
</ul>
<blockquote>
<p><strong>ã€Œä¸Šæ¦œè§„åˆ™ã€</strong>ï¼šæ–‡ç« å‘å¸ƒæ—¶é—´åœ¨æœ¬æœŸã€Œæ˜é‡‘ä¸€å‘¨ã€å‘å¸ƒæ—¶é—´çš„å‰ä¸€å‘¨å†…ï¼›ä¸”ç¬¦åˆå„ä¸ªæ ç›®çš„å†…å®¹å®šä½å’Œè¦æ±‚ã€‚ å¦‚å‘ç°æ–‡ç« æœ‰æŠ„è¢­ã€æ´—ç¨¿ç­‰è¿åç¤¾åŒºè§„åˆ™çš„è¡Œä¸ºï¼Œå°†å–æ¶ˆå½“æœŸåŠåç»­ä¸Šæ¦œèµ„æ ¼ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€å‘¨â€œé‡‘â€é€‰</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73d5bf990a124e3a87cffb06443ad9ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5LiA5ZGo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769063813&amp;x-signature=Vf0Qynd8Ovmcwef5LOVLyYoxRO8%3D" alt="æ˜é‡‘ä¸€å‘¨ æ–‡ç« å¤´å›¾ 1303x734.jpg" loading="lazy"/></p>
<p><em>å†…å®¹è¯„å®¡ä»¬ä¼šåœ¨è¿‡å»çš„ä¸€å‘¨å†…å¯¹ç¤¾åŒºæ·±åº¦æŠ€æœ¯å¥½æ–‡è¿›è¡ŒæŒ–æ˜å’Œç­›é€‰ï¼Œä¼˜è´¨çš„æŠ€æœ¯æ–‡ç« æœ‰æœºä¼šå‡ºç°åœ¨ä¸‹æ–¹æ¦œå•ä¸­ï¼Œæ’åä¸åˆ†å…ˆåã€‚</em></p>
<h3 data-id="heading-1">å‰ç«¯</h3>
<p><a href="https://juejin.cn/post/7591330139083898895" target="_blank" title="https://juejin.cn/post/7591330139083898895">
ä¸€æ¯èŒ¶æ—¶é—´å¸¦ä½ åŸºäº Yjs å’Œ reactflow æ„å»ºååŒæµç¨‹å›¾ç¼–è¾‘å™¨ ğŸ˜ğŸ˜ğŸ˜</a><a href="https://juejin.cn/user/3782764966460398/posts" target="_blank" title="https://juejin.cn/user/3782764966460398/posts">@Moment </a></p>
<blockquote>
<p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶æ‰“å¼€åŒä¸€ä¸ªæµç¨‹å›¾ï¼Œæ‹–åŠ¨èŠ‚ç‚¹ã€åˆ›å»ºè¿æ¥ã€å®æ—¶çœ‹åˆ°å½¼æ­¤çš„å…‰æ ‡ä½ç½®ï¼Œå°±åƒåœ¨åŒä¸€å—ç™½æ¿ä¸Šåä½œä¸€æ ·æµç•…ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœã€‚è¿™ä¸ªæ¡ˆä¾‹ä¼šæ¶µç›–ååŒç¼–è¾‘çš„æ ¸å¿ƒåœºæ™¯ï¼šæ•°æ®åŒæ­¥ã€çŠ¶æ€ç®¡ç†ã€å…‰æ ‡ååŒï¼Œä»¥åŠå‰åç«¯çš„å®Œæ•´å®ç°ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7592452108798165035" target="_blank" title="https://juejin.cn/post/7592452108798165035">ğŸ¥è§£å†³å‰ç«¯ â€œå¤ç°éš¾â€ï¼šrrweb å½•åˆ¶å›æ”¾ä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸Šï¼‰</a><a href="https://juejin.cn/user/3588413946594925/posts" target="_blank" title="https://juejin.cn/user/3588413946594925/posts">@ç§‹å¤©çš„ä¸€é˜µé£</a></p>
<blockquote>
<p>å‰ç«¯å¼€å‘çš„æ ¸å¿ƒç—›ç‚¹ä¹‹ä¸€ï¼Œæ˜¯ â€œé—®é¢˜ä¸å¯è§â€â€”â€” å½“ç”¨æˆ·åé¦ˆ â€œæŒ‰é’®ç‚¹å‡»æ— å“åº”â€â€œé¡µé¢ç©ºç™½â€ æ—¶ï¼Œå¼€å‘è€…åªèƒ½é æœ‰é™æ—¥å¿—æ¨æµ‹åœºæ™¯ï¼Œéš¾ä»¥å¤ç°çœŸå®æ“ä½œè·¯å¾„ã€‚</p>
</blockquote>
<h3 data-id="heading-2">åç«¯</h3>
<p><a href="https://juejin.cn/post/7591317772075122707" target="_blank" title="https://juejin.cn/post/7591317772075122707">ä»æ´»åŠ¨ç¼–æ’åˆ°ç§¯åˆ†ç³»ç»Ÿï¼šäº‹ä»¶é©±åŠ¨åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€æ¬¡å»¶ä¼¸ </a><a href="https://juejin.cn/user/888839672963544/posts" target="_blank" title="https://juejin.cn/user/888839672963544/posts">@æ´›å¡å¡äº† </a></p>
<blockquote>
<p>åœ¨è¿™æ¬¡çš„ç§¯åˆ†ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬åŒæ ·é‡‡ç”¨äº†<strong>åŸºäºäº‹ä»¶é©±åŠ¨çš„æ•´ä½“æ€è·¯</strong>ã€‚æ‰€æœ‰ç§¯åˆ†è¡Œä¸ºï¼Œéƒ½ä»æ˜ç¡®çš„ä¸šåŠ¡äº‹ä»¶å¼€å§‹ï¼Œç”±äº‹ä»¶è§¦å‘è§„åˆ™ï¼Œç”±è§„åˆ™å†³å®šæ˜¯å¦å‘æ”¾ç§¯åˆ†ï¼Œå†è¿›å…¥åç»­çš„ç»“ç®—ã€é£æ§ä¸å®¡è®¡æµç¨‹ã€‚é€šè¿‡æŠŠâ€œå‘ç”Ÿäº†ä»€ä¹ˆâ€å’Œâ€œä¸ºä»€ä¹ˆä¼šå‘ç§¯åˆ†â€æ‹†æ¸…æ¥šï¼Œå°½é‡è®©æ¯ä¸€æ¬¡ç§¯åˆ†å˜åŠ¨éƒ½å¯è§£é‡Šã€å¯å›æº¯ã€‚</p>
</blockquote>
<h3 data-id="heading-3">Android</h3>
<p><a href="https://juejin.cn/post/7591730714140606506" target="_blank" title="https://juejin.cn/post/7591730714140606506">
Dart å®˜æ–¹å†è§£é‡Šä¸ºä»€ä¹ˆæ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œå¹¶è½¬å‘ä¼˜åŒ– build_runner ? å’Œ Kotlin çš„åŒºåˆ«åˆæ˜¯ä»€ä¹ˆï¼Ÿ</a><a href="https://juejin.cn/user/817692379985752/posts" target="_blank" title="https://juejin.cn/user/817692379985752/posts">@æ‹çŒ«deå°éƒ­</a></p>
<blockquote>
<p>è¿‘æ—¥ï¼ŒDart å›¢é˜Ÿå†æ¬¡è¯¦ç»†è§£é‡Šäº†ä¸ºä»€ä¹ˆ Dart æ”¾å¼ƒäº†å®ç¼–ç¨‹ï¼Œç®€å•è¯´å°±æ˜¯ï¼š<strong>åœ¨ç°åœ¨çš„ Dart è¯­è¨€ä¸Šè¿›è¡Œçš„å®ç¼–ç¨‹æ”¯æŒï¼Œæœ€ç»ˆå¾—åˆ°äº†â€œé«˜ä¸æˆä½ä¸å°±â€çš„ç»“æœ</strong>ï¼Œæ‰€ä»¥å®˜æ–¹æœ€ç»ˆæ”¾å¼ƒäº†è¿™ä¸ªæ”¯æŒã€‚</p>
</blockquote>
<h3 data-id="heading-4">äººå·¥æ™ºèƒ½</h3>
<p><a href="https://juejin.cn/post/7592094358658138146" target="_blank" title="https://juejin.cn/post/7592094358658138146">æœ‰èµAIç ”å‘å…¨æµç¨‹è½åœ°å®è·µ</a><a href="https://juejin.cn/user/4283353032038253/posts" target="_blank" title="https://juejin.cn/user/4283353032038253/posts">@æœ‰èµæŠ€æœ¯</a></p>
<blockquote>
<p>éšç€ç¼–ç¨‹å·¥å…·çš„å‘å±•ï¼Œç¼–ç¨‹é—¨æ§›è¢«å¤§å¹…é™ä½ï¼Œ<strong>æ°›å›´ç¼–ç¨‹(Vide Coding)å¼€å§‹å…´èµ·ï¼Œè®©æ›´å¤šéä¸“ä¸šå¼€å‘è€…ä¸“æ³¨åˆ›æ„å’Œç»“æœ</strong>ã€‚åœ¨æœ‰èµå†…éƒ¨æœ‰äº§å“åŒå­¦å¼€å§‹ç”¨ä»£ç äº¤ä»˜äº¤äº’å¼çš„ PRDï¼Œåœ¨ä¸€äº›åˆ›æ–°å‹é¡¹ç›®ä¸­è¿™ä¼šæˆä¸ºç¬¬ä¸€ç‰ˆä»£ç ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7593139476839874566" target="_blank" title="https://juejin.cn/post/7593139476839874566">2026å¹´çš„ITåœˆï¼Œçœ‹çœ‹è°åœ¨â€œè£¸æ³³â€ï¼Œè°åœ¨â€œåƒè‚‰â€ </a>
<a href="https://juejin.cn/user/2242659450109575/posts" target="_blank" title="https://juejin.cn/user/2242659450109575/posts">@å¨å“¥çˆ±ç¼–ç¨‹</a></p>
<blockquote>
<p>è¿‘ä¸å°‘ç²‰ä¸ç§ä¿¡é—®æˆ‘ï¼šâ€œVå“¥ï¼Œç°åœ¨è¿™è¡Œæƒ…å·å¾—è·Ÿéº»èŠ±ä¼¼çš„ï¼Œ35å²å±æœºå°±åœ¨çœ¼å‰ï¼Œä½ è¯´å’±ä»¬æITçš„ï¼Œåˆ°äº†2026å¹´è¿˜æœ‰å‡ºè·¯å—ï¼Ÿè¿™æŠ€æœ¯è¿­ä»£å¿«å¾—åƒåç«ç®­ï¼Œæˆ‘åˆ°åº•è¯¥å¾€å“ªè¾¹æŠ¼æ³¨ï¼Ÿâ€</p>
</blockquote>
<p><a href="https://juejin.cn/post/7593607642552811546" target="_blank" title="https://juejin.cn/post/7593607642552811546">OpenCodeï¼šä½ çš„å¼€æº AI ç¼–ç¨‹åŠ©æ‰‹å®Œå…¨æŒ‡å—</a>@<a href="https://juejin.cn/user/1618104611770958/posts" target="_blank" title="https://juejin.cn/user/1618104611770958/posts">å°ç¢—ç»†é¢
</a></p>
<blockquote>
<p><strong>OpenCode</strong>Â æ˜¯ä¸€ä¸ªå¼€æºçš„ AI ç¼–ç¨‹åŠ©æ‰‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨ç»ˆç«¯ã€IDE æˆ–æ¡Œé¢åº”ç”¨ä¸­ç¼–å†™ä»£ç ã€‚ç›®å‰å·²ç»åœ¨ GitHub ä¸Šè·å¾—äº†Â <strong>50,000+</strong> Â æ˜Ÿæ ‡ï¼Œæ‹¥æœ‰Â <strong>500+</strong> Â è´¡çŒ®è€…ï¼Œæ¯æœˆæœ‰è¶…è¿‡Â <strong>65ä¸‡</strong>Â å¼€å‘è€…åœ¨ä½¿ç”¨ã€‚</p>
</blockquote>
<h4 data-id="heading-5">æ´»åŠ¨æ—¥å†</h4>













<table><thead><tr><th>æ´»åŠ¨åç§°</th><th>æ´»åŠ¨æ—¶é—´</th></tr></thead><tbody><tr><td><a href="https://juejin.cn/post/7587675443442450472" target="_blank" title="https://juejin.cn/post/7587675443442450472">ğŸ†2025 AI/Vibe Coding å¯¹æˆ‘çš„å½±å“  å¹´ç»ˆå¾æ–‡</a></td><td>2025å¹´12æœˆ26æ—¥-2026å¹´1æœˆ25æ—¥</td></tr></tbody></table>
<h2 data-id="heading-6">ğŸ“– æŠ•ç¨¿ä¸“åŒº</h2>
<blockquote>
<p>å¤§å®¶å¯ä»¥åœ¨è¯„è®ºåŒºæ¨èè®¤ä¸ºä¸é”™çš„æ–‡ç« ï¼Œå¹¶é™„ä¸Šé“¾æ¥å’Œæ¨èç†ç”±ï¼Œæœ‰æœºä¼šå‘ˆç°åœ¨ä¸‹ä¸€æœŸã€‚æ–‡ç« åˆ›å»ºæ—¥æœŸå¿…é¡»åœ¨ä¸‹æœŸæ˜é‡‘ä¸€å‘¨å‘å¸ƒå‰ä¸€å‘¨ä»¥å†…ï¼›å¯ä»¥æ¨èè‡ªå·±çš„æ–‡ç« ã€ä¹Ÿå¯ä»¥æ¨èä»–äººçš„æ–‡ç« ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ast-grep-vscode è¯†åˆ«Vueç»„ä»¶]]></title>    <link>https://juejin.cn/post/7594726385405165622</link>    <guid>https://juejin.cn/post/7594726385405165622</guid>    <pubDate>2026-01-14T03:21:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594726385405165622" data-draft-id="7594854295746527268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ast-grep-vscode è¯†åˆ«Vueç»„ä»¶"/> <meta itemprop="keywords" content="å‰ç«¯,Visual Studio Code"/> <meta itemprop="datePublished" content="2026-01-14T03:21:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ast-grep-vscode è¯†åˆ«Vueç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T03:21:33.000Z" title="Wed Jan 14 2026 03:21:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ä½ å°è¯•åœ¨ VSCode ä¸­ä½¿ç”¨ <strong>ast-grep</strong> æœç´¢ <code>.vue</code> æ–‡ä»¶é‡Œçš„ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå‘ç°ç©ºæ‰‹è€Œå½’ã€‚è¿™æ˜¯å› ä¸º Vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰æ˜¯ä¸€ç§<strong>å¤šè¯­è¨€æ–‡æ¡£</strong>ï¼šå®ƒæ··åˆäº† HTML (template)ã€JS/TS (script) å’Œ CSS/SCSS (style)ã€‚</p>
<p>ast-grep é»˜è®¤ä»…åœ¨è¯†åˆ«å‡ºçš„å•ä¸€è¯­è¨€æ–‡ä»¶ä¸­å·¥ä½œã€‚è¦è®©å®ƒçœ‹æ‡‚ Vueï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ <code>sgconfig.yml</code> é…ç½®<strong>è¯­è¨€æ˜ å°„ï¼ˆMappingï¼‰ä¸è¯­è¨€æ³¨å…¥ï¼ˆInjectionï¼‰</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">æ–¹æ¡ˆ Aï¼šè½»é‡çº§æ˜ å°„ï¼ˆé€‚åˆçº¯ JS é¡¹ç›®ï¼‰</h2>
<p>å¦‚æœä½ çš„é¡¹ç›®ä¸»è¦æ˜¯ JavaScriptï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°† <code>.vue</code> æ–‡ä»¶è§†ä¸º HTMLã€‚ç”±äº ast-grep å†…ç½®äº† HTML å¯¹ JS/CSS çš„æ³¨å…¥é€»è¾‘ï¼Œè¿™ç§æ–¹å¼å‡ ä¹â€œå¼€ç®±å³ç”¨â€ã€‚</p>
<h3 data-id="heading-1">1. é…ç½® <code>sgconfig.yml</code></h3>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">languageGlobs:</span>
  <span class="hljs-attr">html:</span> [<span class="hljs-string">'*.vue'</span>] <span class="hljs-comment"># å°† .vue æ–‡ä»¶å…³è”åˆ° html è§£æå™¨</span>

</code></pre>
<h3 data-id="heading-2">2. ä½¿ç”¨æ–¹æ³•</h3>
<p>åœ¨ VSCode å‘½ä»¤é¢æ¿è¿è¡Œ <code>ast-grep: Search Pattern</code>ï¼Œç›´æ¥è¾“å…¥ JS æ¨¡å¼å³å¯ï¼š</p>
<ul>
<li><strong>Pattern ç¤ºä¾‹ï¼š</strong> <code>import $X from '$PATH'</code></li>
</ul>
<p><strong>å±€é™æ€§ï¼š</strong> è¿™ç§æ–¹æ¡ˆå¯¹ <code>&lt;script lang="ts"&gt;</code> æˆ–å¤æ‚çš„ <code>&lt;script setup&gt;</code> æ”¯æŒæœ‰é™ï¼Œé€‚åˆç®€å•çš„ JS é€»è¾‘æœç´¢ã€‚</p>
<hr/>
<h2 data-id="heading-3">æ–¹æ¡ˆ Bï¼šå®Œæ•´æ³¨å…¥æ–¹æ¡ˆï¼ˆæ”¯æŒ TSã€SCSS ä¸ Setupï¼‰</h2>
<p>ä¸ºäº†æ”¯æŒ TypeScript å’Œ SCSSï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®å‘ŠçŸ¥ ast-grep å¦‚ä½•è§£æ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾å†…çš„â€œå­è¯­è¨€â€ã€‚</p>
<h3 data-id="heading-4">1. æ ¸å¿ƒé…ç½®ï¼šè¯­è¨€æ³¨å…¥</h3>
<p>åœ¨ <code>sgconfig.yml</code> ä¸­å®šä¹‰æ³¨å…¥è§„åˆ™ï¼Œè¿™èƒ½ç²¾å‡†è¯†åˆ« <code>lang</code> å±æ€§å¹¶åº”ç”¨å¯¹åº”çš„è§£æå™¨ï¼š</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">languageInjections:</span>
  <span class="hljs-comment"># å°† &lt;template&gt; å†…å®¹æ³¨å…¥ä¸º html</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hostLanguage:</span> <span class="hljs-string">vue</span>
    <span class="hljs-attr">rule:</span>
      <span class="hljs-attr">pattern:</span> <span class="hljs-string">&lt;template&gt;$CONTENT&lt;/template&gt;</span>
    <span class="hljs-attr">injected:</span> <span class="hljs-string">html</span>

  <span class="hljs-comment"># å°†å¸¦ lang="ts" çš„ &lt;script&gt; æ³¨å…¥ä¸º typescript</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hostLanguage:</span> <span class="hljs-string">vue</span>
    <span class="hljs-attr">rule:</span>
      <span class="hljs-attr">pattern:</span> <span class="hljs-string">&lt;script</span> <span class="hljs-string">$$$</span> <span class="hljs-string">lang="ts"</span> <span class="hljs-string">$$$&gt;$CONTENT&lt;/script&gt;</span>
    <span class="hljs-attr">injected:</span> <span class="hljs-string">typescript</span>

  <span class="hljs-comment"># å°†å¸¸è§„ &lt;script&gt; æ³¨å…¥ä¸º javascript</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hostLanguage:</span> <span class="hljs-string">vue</span>
    <span class="hljs-attr">rule:</span>
      <span class="hljs-attr">pattern:</span> <span class="hljs-string">&lt;script</span> <span class="hljs-string">$$$&gt;$CONTENT&lt;/script&gt;</span>
    <span class="hljs-attr">injected:</span> <span class="hljs-string">javascript</span>

  <span class="hljs-comment"># å°†å¸¦ lang="scss" çš„ &lt;style&gt; æ³¨å…¥ä¸º scss</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hostLanguage:</span> <span class="hljs-string">vue</span>
    <span class="hljs-attr">rule:</span>
      <span class="hljs-attr">pattern:</span> <span class="hljs-string">&lt;style</span> <span class="hljs-string">$$$</span> <span class="hljs-string">lang="scss"</span> <span class="hljs-string">$$$&gt;$CONTENT&lt;/style&gt;</span>
    <span class="hljs-attr">injected:</span> <span class="hljs-string">scss</span>

</code></pre>
<h3 data-id="heading-5">2. è‡ªå®šä¹‰è¯­è¨€æ”¯æŒ (Tree-sitter)</h3>
<p>ä¸ºäº†è®©ä¸Šé¢çš„ <code>hostLanguage: vue</code> ç”Ÿæ•ˆï¼Œå»ºè®®å¼•å…¥ä¸“é—¨çš„ Vue è§£æå™¨ã€‚ä½ éœ€è¦æ„å»ºå¹¶åœ¨ <code>sgconfig.yml</code> ä¸­æ³¨å†Œï¼š</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">customLanguages:</span>
  <span class="hljs-attr">vue:</span>
    <span class="hljs-attr">libraryPath:</span> <span class="hljs-string">.tree-sitter/vue.so</span>
    <span class="hljs-attr">extensions:</span> [<span class="hljs-string">vue</span>]
  <span class="hljs-attr">scss:</span>
    <span class="hljs-attr">libraryPath:</span> <span class="hljs-string">.tree-sitter/scss.so</span>
    <span class="hljs-attr">extensions:</span> [<span class="hljs-string">scss</span>]

</code></pre>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> <code>.so</code> (æˆ– macOS çš„ <code>.dylib</code>) æ–‡ä»¶éœ€è¦é€šè¿‡ <code>tree-sitter-cli</code> è‡ªè¡Œæ„å»ºã€‚å»ºè®®å°†å…¶æ”¾å…¥ <code>.tree-sitter/</code> ç›®å½•å¹¶åŠ å…¥ <code>.gitignore</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">å¸¸è§å‘ç‚¹ä¸æ’æŸ¥</h2>
<ul>
<li><strong>é…ç½®ç”Ÿæ•ˆèŒƒå›´ï¼š</strong> ç¡®ä¿ <code>sgconfig.yml</code> ä½äº VSCode æ‰“å¼€çš„å·¥ä½œåŒºæ ¹ç›®å½•ï¼Œå¦åˆ™æ‰©å±•å¯èƒ½æ— æ³•åŠ è½½è§„åˆ™ã€‚</li>
<li><strong>é€šé…ç¬¦æƒé‡ï¼š</strong> åœ¨æ³¨å…¥è§„åˆ™ä¸­ä½¿ç”¨ <code>$$$</code>ï¼ˆé€šé…ç¬¦ï¼‰æ¥è¦†ç›– <code>&lt;script&gt;</code> æ ‡ç­¾ä¸Šçš„å…¶ä»–å±æ€§ï¼ˆå¦‚ <code>setup</code> æˆ– <code>scoped</code>ï¼‰ã€‚</li>
<li><strong>è¯­è¨€ä¸€è‡´æ€§ï¼š</strong> å¦‚æœä½ çš„æŸ¥è¯¢è§„åˆ™å®šä¹‰ä¸º <code>language: typescript</code>ï¼Œé‚£ä¹ˆå®ƒåªä¼šå‘½ä¸­è¢«æ³¨å…¥ä¸º <code>typescript</code> çš„åŒºåŸŸã€‚</li>
<li><strong>é‡å¯æœåŠ¡ï¼š</strong> ä¿®æ”¹é…ç½®åï¼Œå»ºè®®åœ¨ VSCode ä¸­æ‰§è¡Œ <code>ast-grep.restartLanguageServer</code> ä»¥ç¡®ä¿æœ€æ–°é…ç½®ç”Ÿæ•ˆã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>é€šè¿‡åˆç†çš„è¯­è¨€æ³¨å…¥é…ç½®ï¼Œast-grep å¯ä»¥ä»ä¸€ä¸ªç®€å•çš„æœç´¢å·¥å…·è¿›åŒ–ä¸ºç†è§£ Vue ç»„ä»¶ç»“æ„çš„å¼ºåŠ›åŠ©æ‰‹ã€‚æ— è®ºæ˜¯æ¸…ç†è¿‡æ—¶çš„ APIï¼Œè¿˜æ˜¯å¤§è§„æ¨¡é‡æ„ç»„ä»¶é€»è¾‘ï¼Œéƒ½èƒ½æ¸¸åˆƒæœ‰ä½™ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue çš„ nextTickï¼šç ´è§£å¼‚æ­¥æ›´æ–°çš„ç„æœº]]></title>    <link>https://juejin.cn/post/7595034434976350246</link>    <guid>https://juejin.cn/post/7595034434976350246</guid>    <pubDate>2026-01-14T13:42:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595034434976350246" data-draft-id="7595088396440141874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue çš„ nextTickï¼šç ´è§£å¼‚æ­¥æ›´æ–°çš„ç„æœº"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-14T13:42:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue çš„ nextTickï¼šç ´è§£å¼‚æ­¥æ›´æ–°çš„ç„æœº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T13:42:29.000Z" title="Wed Jan 14 2026 13:42:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å…ˆçœ‹ç°è±¡ï¼šä¸ºä»€ä¹ˆæ•°æ®å˜äº†ï¼ŒDOM å´æ²¡æ›´æ–°ï¼Ÿ</h2>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;div ref="message"&gt;{{ msg }}&lt;/div&gt;
    &lt;button @click="changeMessage"&gt;ç‚¹å‡»æˆ‘&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return { msg: 'åˆå§‹æ¶ˆæ¯' }
  },
  methods: {
    changeMessage() {
      this.msg = 'æ–°æ¶ˆæ¯'
      console.log('æ•°æ®å·²æ›´æ–°:', this.msg)
      console.log('DOMå†…å®¹:', this.$refs.message?.textContent) // è¿˜æ˜¯'åˆå§‹æ¶ˆæ¯'ï¼
    }
  }
}
&lt;/script&gt;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">æ•°æ®å·²æ›´æ–°: æ–°æ¶ˆæ¯</span>
<span class="hljs-section">DOMå†…å®¹: åˆå§‹æ¶ˆæ¯  â† é—®é¢˜åœ¨è¿™é‡Œï¼</span>
</code></pre>
<p>æ•°æ®æ˜æ˜å·²ç»æ”¹äº†ï¼Œä¸ºä»€ä¹ˆ DOM è¿˜æ˜¯æ—§å€¼ï¼Ÿè¿™å°±æ˜¯ <code>nextTick</code> è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒåŸç†ï¼šVue çš„å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—</h2>
<p>Vue çš„ DOM æ›´æ–°æ˜¯<strong>å¼‚æ­¥</strong>çš„ã€‚å½“ä½ ä¿®æ”¹æ•°æ®æ—¶ï¼ŒVue ä¸ä¼šç«‹å³æ›´æ–° DOMï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li><strong>å¼€å¯ä¸€ä¸ªé˜Ÿåˆ—</strong>ï¼Œç¼“å†²åŒä¸€äº‹ä»¶å¾ªç¯ä¸­çš„æ‰€æœ‰æ•°æ®å˜æ›´</li>
<li><strong>ç§»é™¤é‡å¤çš„ watcher</strong>ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—</li>
<li><strong>ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯</strong>ä¸­ï¼Œåˆ·æ–°é˜Ÿåˆ—å¹¶æ‰§è¡Œå®é™… DOM æ›´æ–°</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue å†…éƒ¨çš„ç®€åŒ–é€»è¾‘</span>
<span class="hljs-keyword">let</span> queue = []
<span class="hljs-keyword">let</span> waiting = <span class="hljs-literal">false</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">queueWatcher</span>(<span class="hljs-params">watcher</span>) {
  <span class="hljs-comment">// 1. å»é‡</span>
  <span class="hljs-keyword">if</span> (!queue.<span class="hljs-title function_">includes</span>(watcher)) {
    queue.<span class="hljs-title function_">push</span>(watcher)
  }
  
  <span class="hljs-comment">// 2. å¼‚æ­¥æ‰§è¡Œ</span>
  <span class="hljs-keyword">if</span> (!waiting) {
    waiting = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">nextTick</span>(flushQueue)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flushQueue</span>(<span class="hljs-params"/>) {
  queue.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> watcher.<span class="hljs-title function_">run</span>())
  queue = []
  waiting = <span class="hljs-literal">false</span>
}
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€nextTick çš„æœ¬è´¨ï¼šå¾®ä»»åŠ¡è°ƒåº¦å™¨</h2>
<p><code>nextTick</code> çš„æ ¸å¿ƒä»»åŠ¡ï¼š<strong>åœ¨ DOM æ›´æ–°å®Œæˆåæ‰§è¡Œå›è°ƒ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 2.x ä¸­çš„ nextTick å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">let</span> callbacks = []
<span class="hljs-keyword">let</span> pending = <span class="hljs-literal">false</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">nextTick</span>(<span class="hljs-params">cb</span>) {
  callbacks.<span class="hljs-title function_">push</span>(cb)
  
  <span class="hljs-keyword">if</span> (!pending) {
    pending = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// ä¼˜å…ˆçº§ï¼šPromise &gt; MutationObserver &gt; setImmediate &gt; setTimeout</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(flushCallbacks)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MutationObserver</span> !== <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-comment">// ç”¨ MutationObserver æ¨¡æ‹Ÿå¾®ä»»åŠ¡</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">setTimeout</span>(flushCallbacks, <span class="hljs-number">0</span>)
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flushCallbacks</span>(<span class="hljs-params"/>) {
  pending = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> copies = callbacks.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>)
  callbacks.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>
  copies.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>())
}
</code></pre>
<h2 data-id="heading-3">å››ã€å››å¤§æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-4">åœºæ™¯1ï¼šè·å–æ›´æ–°åçš„ DOM</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script&gt;
export default {
  methods: {
    async updateAndLog() {
      this.msg = 'æ›´æ–°åçš„æ¶ˆæ¯'
      
      // âŒ é”™è¯¯ï¼šæ­¤æ—¶ DOM è¿˜æœªæ›´æ–°
      console.log('åŒæ­¥è·å–:', this.$refs.message.textContent)
      
      // âœ… æ­£ç¡®ï¼šä½¿ç”¨ nextTick
      this.$nextTick(() =&gt; {
        console.log('nextTickè·å–:', this.$refs.message.textContent)
      })
      
      // âœ… æ›´ä¼˜é›…ï¼šasync/await ç‰ˆæœ¬
      this.msg = 'å¦ä¸€ä¸ªæ¶ˆæ¯'
      await this.$nextTick()
      console.log('awaitè·å–:', this.$refs.message.textContent)
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-5">åœºæ™¯2ï¼šæ“ä½œç¬¬ä¸‰æ–¹ DOM åº“</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div ref="chartContainer"&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import echarts from 'echarts'

export default {
  data() {
    return { data: [] }
  },
  
  async mounted() {
    // âŒ é”™è¯¯ï¼šå®¹å™¨å¯èƒ½è¿˜æœªæ¸²æŸ“
    // this.chart = echarts.init(this.$refs.chartContainer)
    
    // âœ… æ­£ç¡®ï¼šç¡®ä¿ DOM å°±ç»ª
    this.$nextTick(() =&gt; {
      this.chart = echarts.init(this.$refs.chartContainer)
      this.renderChart()
    })
  },
  
  methods: {
    async updateChart(newData) {
      this.data = newData
      
      // ç­‰å¾… Vue æ›´æ–° DOM å’Œå›¾è¡¨æ•°æ®
      await this.$nextTick()
      
      // æ­¤æ—¶å¯ä»¥å®‰å…¨æ“ä½œå›¾è¡¨å®ä¾‹
      this.chart.setOption({
        series: [{ data: this.data }]
      })
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-6">åœºæ™¯3ï¼šè§£å†³è®¡ç®—å±æ€§ä¾èµ–é—®é¢˜</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script&gt;
export default {
  data() {
    return {
      list: [1, 2, 3],
      newItem: ''
    }
  },
  
  computed: {
    filteredList() {
      // ä¾èµ– list çš„å˜åŒ–
      return this.list.filter(item =&gt; item &gt; 1)
    }
  },
  
  methods: {
    async addItem(item) {
      this.list.push(item)
      
      // âŒ filteredList å¯èƒ½è¿˜æœªè®¡ç®—å®Œæˆ
      console.log('åˆ—è¡¨é•¿åº¦:', this.filteredList.length)
      
      // âœ… ç¡®ä¿è®¡ç®—å±æ€§å·²æ›´æ–°
      this.$nextTick(() =&gt; {
        console.log('æ­£ç¡®çš„é•¿åº¦:', this.filteredList.length)
      })
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">åœºæ™¯4ï¼šä¼˜åŒ–æ‰¹é‡æ›´æ–°æ€§èƒ½</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ‰¹é‡æ“ä½œç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">batchUpdate</span>(<span class="hljs-params">items</span>) {
  <span class="hljs-comment">// å¼€å§‹æ‰¹é‡æ›´æ–°</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">updating</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment">// æ‰€æœ‰æ•°æ®å˜æ›´éƒ½åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­</span>
  items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">processItem</span>(item))
  })
  
  <span class="hljs-comment">// åªè§¦å‘ä¸€æ¬¡ DOM æ›´æ–°</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
  
  <span class="hljs-comment">// æ­¤æ—¶ DOM å·²æ›´æ–°å®Œæˆ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">updating</span> = <span class="hljs-literal">false</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showCompletionMessage</span>()
  
  <span class="hljs-comment">// ç»§ç»­å…¶ä»–æ“ä½œ</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerAnimation</span>()
}
</code></pre>
<h2 data-id="heading-8">äº”ã€æ€§èƒ½é™·é˜±ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-9">é™·é˜±1ï¼šåµŒå¥—çš„ nextTick</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ æ€§èƒ½æµªè´¹ï¼šåˆ›å»ºå¤šä¸ªå¾®ä»»åŠ¡</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// æ“ä½œ1</span>
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// æ“ä½œ2</span>
    <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ“ä½œ3</span>
    })
  })
})

<span class="hljs-comment">// âœ… ä¼˜åŒ–ï¼šåˆå¹¶åˆ°åŒä¸€ä¸ªå›è°ƒä¸­</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// æ“ä½œ1</span>
  <span class="hljs-comment">// æ“ä½œ2  </span>
  <span class="hljs-comment">// æ“ä½œ3</span>
})
</code></pre>
<h3 data-id="heading-10">é™·é˜±2ï¼šä¸å®ä»»åŠ¡æ··ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é¡ºåºä¸å¯æ§</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">msg</span> = <span class="hljs-string">'æ›´æ–°'</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">message</span>.<span class="hljs-property">textContent</span>)
}, <span class="hljs-number">0</span>)

<span class="hljs-comment">// âœ… æ˜ç¡®ä½¿ç”¨ nextTick</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">msg</span> = <span class="hljs-string">'æ›´æ–°'</span>
<span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">message</span>.<span class="hljs-property">textContent</span>)
})
</code></pre>
<h3 data-id="heading-11">æœ€ä½³å®è·µï¼šä½¿ç”¨ async/await</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">methods</span>: {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">reliableUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. æ›´æ–°æ•°æ®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>()
    
    <span class="hljs-comment">// 2. ç­‰å¾… DOM æ›´æ–°</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
    
    <span class="hljs-comment">// 3. æ“ä½œæ›´æ–°åçš„ DOM</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>()
    
    <span class="hljs-comment">// 4. å¦‚æœéœ€è¦ï¼Œå†æ¬¡ç­‰å¾…</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerAnimation</span>()
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">'æ›´æ–°å®Œæˆ'</span>
  }
}
</code></pre>
<h2 data-id="heading-12">å…­ã€Vue 3 çš„å˜åŒ–ä¸ä¼˜åŒ–</h2>
<p>Vue 3 çš„ <code>nextTick</code> æ›´åŠ ç²¾ç®€é«˜æ•ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 ä¸­çš„ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// æ–¹å¼1ï¼šå›è°ƒå‡½æ•°</span>
<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'DOM å·²æ›´æ–°'</span>)
})

<span class="hljs-comment">// æ–¹å¼2ï¼šPromise</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'DOM å·²æ›´æ–°'</span>)

<span class="hljs-comment">// æ–¹å¼3ï¼šComposition API</span>
<span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">value</span> = <span class="hljs-string">'æ–°å€¼'</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>()
    <span class="hljs-comment">// æ“ä½œ DOM</span>
  }
  
  <span class="hljs-keyword">return</span> { handleClick }
}
</code></pre>
<p><strong>Vue 3 çš„ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ <code>Promise.resolve().then()</code> ä½œä¸ºé»˜è®¤ç­–ç•¥</li>
<li>ç§»é™¤å…¼å®¹æ€§ä»£ç ï¼Œæ›´å°çš„ä½“ç§¯</li>
<li>æ›´å¥½çš„ TypeScript æ”¯æŒ</li>
</ul>
<h2 data-id="heading-13">ä¸ƒã€æºç çº§ç†è§£</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 2.x nextTick æ ¸å¿ƒé€»è¾‘</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextTick</span>(<span class="hljs-params">cb, ctx</span>) {
  <span class="hljs-keyword">let</span> _resolve
  
  <span class="hljs-comment">// 1. å°†å›è°ƒæ¨å…¥é˜Ÿåˆ—</span>
  callbacks.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (cb) {
      <span class="hljs-keyword">try</span> {
        cb.<span class="hljs-title function_">call</span>(ctx)
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-title function_">handleError</span>(e, ctx, <span class="hljs-string">'nextTick'</span>)
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_resolve) {
      <span class="hljs-title function_">_resolve</span>(ctx)
    }
  })
  
  <span class="hljs-comment">// 2. å¦‚æœæœªåœ¨ç­‰å¾…ï¼Œå¼€å§‹å¼‚æ­¥æ‰§è¡Œ</span>
  <span class="hljs-keyword">if</span> (!pending) {
    pending = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">timerFunc</span>() <span class="hljs-comment">// è§¦å‘å¼‚æ­¥æ›´æ–°</span>
  }
  
  <span class="hljs-comment">// 3. æ”¯æŒ Promise é“¾å¼è°ƒç”¨</span>
  <span class="hljs-keyword">if</span> (!cb &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      _resolve = resolve
    })
  }
}
</code></pre>
<h2 data-id="heading-14">å…«ã€å®æˆ˜ï¼šæ‰‹å†™ç®€æ˜“ nextTick</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span> = <span class="hljs-literal">false</span>
  }
  
  $nextTick(cb) {
    <span class="hljs-comment">// è¿”å› Promise æ”¯æŒ async/await</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">wrappedCallback</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (cb) <span class="hljs-title function_">cb</span>()
        <span class="hljs-title function_">resolve</span>()
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">push</span>(wrappedCallback)
      
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span> = <span class="hljs-literal">true</span>
        
        <span class="hljs-comment">// ä¼˜å…ˆä½¿ç”¨å¾®ä»»åŠ¡</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">'undefined'</span>) {
          <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">flushCallbacks</span>())
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">flushCallbacks</span>(), <span class="hljs-number">0</span>)
        }
      }
    })
  }
  
  <span class="hljs-title function_">flushCallbacks</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">const</span> copies = <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>
    copies.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>())
  }
  
  <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®æ›´æ–°</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setData</span>(<span class="hljs-params">key, value</span>) {
    <span class="hljs-variable language_">this</span>[key] = value
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$nextTick()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`DOM å·²æ›´æ–°: <span class="hljs-subst">${key}</span> = <span class="hljs-subst">${value}</span>`</span>)
  }
}
</code></pre>
<h2 data-id="heading-15">æ€»ç»“</h2>
<h3 data-id="heading-16">nextTick çš„ä¸‰å±‚ç†è§£ï¼š</h3>
<ol>
<li><strong>è¡¨è±¡å±‚</strong>ï¼šåœ¨ DOM æ›´æ–°åæ‰§è¡Œä»£ç </li>
<li><strong>åŸç†å±‚</strong>ï¼šVue å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—çš„è°ƒåº¦å™¨</li>
<li><strong>å®ç°å±‚</strong>ï¼šåŸºäº JavaScript äº‹ä»¶å¾ªç¯çš„å¾®ä»»åŠ¡ç®¡ç†å™¨</li>
</ol>
<h3 data-id="heading-17">ä½¿ç”¨åŸåˆ™ï¼š</h3>
<ol>
<li><strong>éœ€è¦è®¿é—®æ›´æ–°åçš„ DOM æ—¶ï¼Œå¿…é¡»ç”¨ nextTick</strong></li>
<li><strong>æ“ä½œç¬¬ä¸‰æ–¹åº“å‰ï¼Œå…ˆç­‰ Vue æ›´æ–°å®Œæˆ</strong></li>
<li><strong>æ‰¹é‡æ“ä½œåï¼Œç”¨ nextTick ç»Ÿä¸€å¤„ç†å‰¯ä½œç”¨</strong></li>
<li><strong>ä¼˜å…ˆä½¿ç”¨ async/await è¯­æ³•ï¼Œæ›´æ¸…æ™°ç›´è§‚</strong></li>
</ol>
<h3 data-id="heading-18">ä¸€å¥è¯æ¦‚æ‹¬ï¼š</h3>
<p><strong>nextTick æ˜¯ Vue ç»™ä½ çš„ä¸€ä¸ªæ‰¿è¯ºï¼š"ç­‰æˆ‘æŠŠ DOM æ›´æ–°å®Œï¼Œå†æ‰§è¡Œä½ çš„ä»£ç "ã€‚</strong></p>
<p>è®°ä½è¿™ä¸ªæ‰¿è¯ºï¼Œä½ å°±èƒ½å®Œç¾æŒæ§ Vue çš„æ›´æ–°æ—¶æœºã€‚</p>
<hr/>
<p><strong>æ€è€ƒé¢˜ï¼š</strong>
å¦‚æœè¿ç»­ä¿®æ”¹åŒä¸€ä¸ªæ•°æ® 1000 æ¬¡ï¼ŒVue ä¼šè§¦å‘å¤šå°‘æ¬¡ DOM æ›´æ–°ï¼Ÿ
ï¼ˆç­”æ¡ˆï¼šå¾—ç›Šäº nextTick çš„é˜Ÿåˆ—æœºåˆ¶ï¼Œåªä¼šè§¦å‘ 1 æ¬¡ï¼‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android è®¾è®¡æ¶æ„æ¼”è¿›å†ç¨‹]]></title>    <link>https://juejin.cn/post/7595088396440092722</link>    <guid>https://juejin.cn/post/7595088396440092722</guid>    <pubDate>2026-01-14T13:38:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595088396440092722" data-draft-id="7594822511437316122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android è®¾è®¡æ¶æ„æ¼”è¿›å†ç¨‹"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2026-01-14T13:38:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jony_"/> <meta itemprop="url" content="https://juejin.cn/user/3403743732709767"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android è®¾è®¡æ¶æ„æ¼”è¿›å†ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743732709767/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jony_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T13:38:55.000Z" title="Wed Jan 14 2026 13:38:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>Android è®¾è®¡æ¶æ„çš„æ¼”è¿›å†ç¨‹ï¼š
MVC -&gt; MVP -&gt; MVVM -&gt; MVI</p>
<p>åœ¨æ¼”è¿›çš„è¿‡ç¨‹ä¸­å…·å¤‡å¦‚ä¸‹ç‰¹å¾ï¼š</p>
<ol>
<li>é™ä½ä¸šåŠ¡é€»è¾‘ä¸ UI å±‚çš„è€¦åˆ</li>
<li>æ•°æ®é©±åŠ¨</li>
<li>å•é¡¹æ•°æ®æµ</li>
</ol>
<h2 data-id="heading-1">ä¸€ã€MVC</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26d44d8b64747b6b301a2f794af9984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9ueV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769002735&amp;x-signature=f%2BY4IKwtZEaCJ7YxyEYerEbsPPQ%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>Mï¼šModel å±‚ï¼Œé€šå¸¸è´Ÿè´£å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®å¤„ç†</li>
<li>Vï¼šView å±‚ï¼ŒæŒ‡ Activity/Fragment ç­‰</li>
<li>Cï¼šController å±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œç”¨æˆ·è¡Œä¸ºï¼Œé€šå¸¸æ¥è¯´ï¼Œè¿™ä¸€å±‚çš„æ‰§è¡Œçš„é€»è¾‘ä¹Ÿæ˜¯æ”¾åœ¨äº†Activity/Fragment ä¸­ï¼Œå¯¼è‡´ UI å±‚è€¦åˆä¸¥é‡</li>
</ol>
<p>Model å’Œ Controller ç›¸äº’æŒæœ‰ï¼ŒController å±‚è´Ÿè´£æ¥æ”¶ç”¨æˆ·çš„è¡Œä¸ºï¼ŒModel å¤„ç†ç½‘ç»œæ•°æ®ï¼Œå®Œæˆä¹‹åï¼Œé€šè¿‡ Callback æ›´æ–° UIã€‚</p>
<h2 data-id="heading-2">äºŒã€MVP</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7d37dad035b4de098379aa383e55c0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9ueV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769002735&amp;x-signature=qRWcYMIEJdJgYYNYHKXsrUtAL6g%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>Mï¼šModel å±‚ï¼Œé€šå¸¸è´Ÿè´£å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®å¤„ç†</li>
<li>Vï¼šView å±‚ï¼ŒæŒ‡ Activity/Fragment ç­‰</li>
<li>Cï¼šPresenter å±‚ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·å‘èµ·çš„è¡Œä¸ºï¼Œè¿™é‡Œçš„é€»è¾‘ä¸å†å†™åœ¨ Activity/Fragment ä¸­</li>
</ol>
<p>å’Œ MVC çš„åŒºåˆ«æ˜¯ï¼Œè¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘ä¸å†å†™åœ¨Activity/Fragmentä¸­ï¼Œå¦å¤– View å±‚æ‰€ä¾èµ–çš„ä¸å†æ˜¯æŸä¸ªå…·ä½“çš„ Presenter å®ä¾‹ï¼Œè€Œæ˜¯ Presenter æŠ½è±¡æ¥å£ã€‚</p>
<p>ç›¸å¯¹äº MVCï¼ŒMVP æŠŠç¹é‡çš„ä¸šåŠ¡é€»è¾‘ä» View å±‚æŠ½ç¦»å‡ºå»äº†ï¼ŒåŒæ—¶è§£å†³äº† View å±‚å’Œ Model å±‚çš„ç›´æ¥ä¾èµ–ã€‚ä½†æ˜¯ç”±äº View ä¾èµ–äº† Presenter çš„å¤§é‡æ¥å£ï¼Œä¼šé€ æˆåç»­æ¥å£å†—ä½™ï¼Œå¤§é‡æœªä½¿ç”¨åˆ°çš„æ¥å£ä¹Ÿéœ€è¦å®ç°ã€‚</p>
<ol>
<li>ä¸ºä»€ä¹ˆæ˜¯ä¾èµ– Presenter æ¥å£ï¼Ÿ</li>
</ol>
<p>ä¾èµ–æŠ½è±¡ï¼Œç¬¦åˆè®¾è®¡æ¨¡å¼çš„è¦æ±‚ï¼Œåœ¨åç»­çš„æ‰©å±•ä¸­ï¼Œå¦‚æœ View å±‚çš„ Presenter å‘ç”Ÿå˜åŠ¨ï¼Œä¸éœ€è¦ä¿®æ”¹ View å±‚åŸæœ‰çš„é€»è¾‘ã€‚</p>
<ol start="3">
<li>ä¸ºä»€ä¹ˆä¼šå‡ºç°æ¥å£å†—ä½™ï¼Ÿ</li>
</ol>
<p>ç°å‡è®¾ï¼ŒPresenterV1 å’Œ PresenterV2 éƒ½å®ç°äº† IPresenterï¼Œåœ¨ V2 æ”¹ç‰ˆä¸­æ–°å¢çš„äº†ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼ŒåŸæ¥çš„ V1 ç‰ˆæœ¬æ˜¯ä¸æ˜¯ä¹Ÿå¾—å®ç°ï¼Ÿæˆ–è€…æ˜¯ï¼Œåœ¨ V2 ç‰ˆæœ¬çš„ä¸­ï¼Œå·²ç»æ²¡æœ‰ V1 ä¸­çš„æŸä¸ªé€»è¾‘äº†ï¼Œä½†æ˜¯ç”±äºå®ç°äº† IPresenterï¼Œåœ¨ V2 ç‰ˆæœ¬ä¸­å°±ä¸å¾—ä¸å®ç°ã€‚</p>
<h2 data-id="heading-3">ä¸‰ã€MVVM</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/600d92d8a35c408d93977ba2baccdadb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9ueV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769002735&amp;x-signature=d9T4kWYuASwC6LHbzNCMkltUoQ8%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>Mï¼šModel å±‚ï¼Œé€šå¸¸è´Ÿè´£å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®å¤„ç†</li>
<li>Vï¼šView å±‚ï¼ŒæŒ‡ Activity/Fragment ç­‰</li>
<li>VMï¼šViewModel å±‚ï¼Œå“åº”ç”¨æˆ·è¡Œä¸ºï¼Œé€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼æ›´æ–° UI</li>
</ol>
<p>å½»åº•è§£è€¦äº† View å±‚å’Œé€»è¾‘å±‚çš„åŒå‘æŒæœ‰é—®é¢˜ï¼Œé™ä½äº†å†…å­˜æ³„æ¼çš„æœºç‡ï¼ŒViewModel å±‚ä¸å†æŒæœ‰ UI å±‚ï¼Œè€Œæ˜¯é€šè¿‡ LiveData è‡ªåŠ¨é€šçŸ¥ UI è‡ªåŠ¨æ›´æ–°ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹ä¾¿æ˜¯æ•°æ®é©±åŠ¨ã€‚</p>
<h2 data-id="heading-4">å››ã€MVI</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c53bc12dc18412eaef3dc59c8e7f411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9ueV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769002735&amp;x-signature=FnjZ5STos%2FxfRGRB5MKC6MMK1jE%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ MVI çš„è®¾è®¡æ¶æ„ä¸­ï¼Œ</p>
<ol>
<li>Vï¼šActivity/ Fragment</li>
<li>Iï¼šæŒ‡Intentï¼ŒView é€šè¿‡ Intent å’Œ ViewModel äº¤äº’ï¼ŒViewModel æŒæœ‰ Domain Layerï¼ˆéå¿…é¡»ï¼‰ï¼Œåè€…æŒæœ‰ Data Layerï¼ˆModel å±‚ï¼‰</li>
<li>Mï¼šæŒ‡ Data Layerï¼Œæ•°æ®å±‚</li>
</ol>
<p>MVI æ¶æ„å…·æœ‰çš„ç‰¹ç‚¹æ˜¯ï¼šå•é¡¹æ•°æ®æµã€Intent é©±åŠ¨</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://juejin.cn/post/7496335490577825855" target="_blank" title="https://juejin.cn/post/7496335490577825855">1. ã€Œæ¶æ„ç¯‡ 1ã€è®¤è¯† MVC / MVP / MVVM / MVI</a></p>
<p><a href="https://juejin.cn/post/7496345177129582646" target="_blank" title="https://juejin.cn/post/7496345177129582646">2. ã€Œæ¶æ„ç¯‡ 2ã€è®¤è¯† MVC / MVP / MVVM / MVI</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[List ç»„ä»¶æ¸²æŸ“æ…¢ï¼Ÿé¸¿è’™API 21 å¤ç”¨æœºåˆ¶æ·±åº¦å‰–æï¼Œä¸€è¡Œä»£ç æé€Ÿ 200%ï¼]]></title>    <link>https://juejin.cn/post/7594854295758700587</link>    <guid>https://juejin.cn/post/7594854295758700587</guid>    <pubDate>2026-01-14T09:09:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758700587" data-draft-id="7595043440518987782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="List ç»„ä»¶æ¸²æŸ“æ…¢ï¼Ÿé¸¿è’™API 21 å¤ç”¨æœºåˆ¶æ·±åº¦å‰–æï¼Œä¸€è¡Œä»£ç æé€Ÿ 200%ï¼"/> <meta itemprop="keywords" content="HarmonyOS,ArkTS,ArkUI"/> <meta itemprop="datePublished" content="2026-01-14T09:09:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¨å“¥çˆ±ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            List ç»„ä»¶æ¸²æŸ“æ…¢ï¼Ÿé¸¿è’™API 21 å¤ç”¨æœºåˆ¶æ·±åº¦å‰–æï¼Œä¸€è¡Œä»£ç æé€Ÿ 200%ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¨å“¥çˆ±ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:09:21.000Z" title="Wed Jan 14 2026 09:09:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å“ˆå–½ï¼Œå…„å¼Ÿä»¬ï¼Œæˆ‘æ˜¯ V å“¥ï¼</p>
<p>æ˜¨å¤©æœ‰ä¸ªå…„å¼Ÿåœ¨ç¾¤é‡Œå‘äº†æ®µè§†é¢‘ï¼Œä»–çš„åˆ—è¡¨åœ¨æ»‘åŠ¨çš„æ—¶å€™ï¼Œæ‰å¸§æ‰å¾—åƒæ˜¯åœ¨æ”¾ PPTã€‚ä»–å§”å±ˆåœ°è¯´ï¼šâ€œV å“¥ï¼Œæˆ‘ä¹Ÿç”¨äº† <code>LazyForEach</code> äº†å•Šï¼Œæ•°æ®ä¹Ÿæ˜¯æ‡’åŠ è½½çš„ï¼Œæ€ä¹ˆåˆ’èµ·æ¥è¿˜æ˜¯è·Ÿç”šè‡³ä¸å¦‚ Android åŸç”Ÿçš„ <code>RecyclerView</code> æµç•…ï¼Ÿâ€</p>
<p>å…„å¼Ÿï¼Œä½ åªåšåˆ°äº†**â€œæ•°æ®æ‡’åŠ è½½â€<strong>ï¼Œå´å¿˜äº†æœ€å…³é”®çš„</strong>â€œç»„ä»¶å¤ç”¨â€**ã€‚</p>
<p>æ¥å§ï¼Œä¸è®²è™šçš„ç†è®ºï¼Œç›´æ¥å¸¦ä½ æ·±æŒ– API 21 çš„ <strong><code>@Reusable</code> ç»„ä»¶å¤ç”¨æœºåˆ¶</strong>ã€‚åªè¦ä½ åœ¨ä»£ç é‡ŒåŠ è¿™ä¸€è¡Œè£…é¥°å™¨ï¼Œå†é…åˆå‡ è¡Œé‡ç½®é€»è¾‘ï¼Œä½ çš„åˆ—è¡¨æ€§èƒ½ç»å¯¹èƒ½åŸåœ°èµ·é£ï¼Œ<strong>æé€Ÿ 200% çœŸä¸æ˜¯å¹NBï¼</strong></p>
<h2 data-id="heading-0">ç—›ç‚¹ç›´å‡»ï¼šä¸ºä»€ä¹ˆä½ çš„åˆ—è¡¨ä¼šå¡ï¼Ÿ</h2>
<p>åœ¨ ArkUI ä¸­ï¼Œæ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨é€šå¸¸æ¶‰åŠä¸¤æ­¥ï¼š</p>
<ol>
<li><strong>åˆ›å»ºæ•°æ®</strong>ï¼šä»åå°æ‹¿ JSONï¼Œè§£ææˆå¯¹è±¡ã€‚</li>
<li><strong>åˆ›å»ºç»„ä»¶</strong>ï¼šæŠŠæ•°æ®å¡è¿› <code>Image</code>ã€<code>Text</code> è¿™äº›ç»„ä»¶é‡Œï¼Œç”Ÿæˆä¸€æ£µ UI æ ‘ã€‚</li>
</ol>
<p>å¾ˆå¤šå…„å¼Ÿåªåšäº† <code>LazyForEach</code>ï¼ˆæ•°æ®å±‚é¢çš„æ‡’åŠ è½½ï¼‰ã€‚è¿™æ„å‘³ç€ï¼šè™½ç„¶æ•°æ®åªåŠ è½½äº†å±å¹•å¯è§çš„é‚£ 10 æ¡ï¼Œä½†æ˜¯ï¼<strong>å½“ä½ å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼Œå±å¹•å¤–çš„ Item è¢«é”€æ¯ï¼Œå±å¹•å†…çš„æ–° Item è¢«åˆ›å»ºã€‚</strong></p>
<p>é¢‘ç¹çš„ <code>new Component()</code> å’Œ <code>delete Component()</code> ä¼šå¸¦æ¥ä¸¤ä¸ªè‡´å‘½é—®é¢˜ï¼š</p>
<ol>
<li><strong>CPU çˆ†è¡¨</strong>ï¼šåˆ›å»ºç»„ä»¶è¦æ‰§è¡Œ <code>build()</code> æ–¹æ³•ï¼Œè®¡ç®—å¸ƒå±€ï¼Œè§£ææ¸²æŸ“å±æ€§ã€‚</li>
<li><strong>GC ç–¯ç‹‚</strong>ï¼šåˆ›å»ºçš„å¯¹è±¡å¤šäº†ï¼Œåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å°±è¦é¢‘ç¹å¯åŠ¨ã€‚GC ä¸€è¿è¡Œï¼Œæ‰€æœ‰çº¿ç¨‹æš‚åœï¼ŒUI å°±ä¼šç¬é—´å¡é¡¿ã€‚</li>
</ol>
<p><strong>V å“¥çš„è§£å†³æ–¹æ¡ˆï¼šåˆ«é”€æ¯ï¼å›æ”¶ï¼</strong></p>
<hr/>
<h2 data-id="heading-1">ç»ˆæç¥å™¨ï¼š@Reusable ç»„ä»¶å¤ç”¨</h2>
<p>API 21 å¼•å…¥çš„ <code>@Reusable</code> è£…é¥°å™¨ï¼Œå°±æ˜¯è®©ç»„ä»¶æ‹¥æœ‰â€œ<strong>è®°å¿†åŠŸèƒ½</strong>â€ã€‚</p>
<ul>
<li><strong>æ²¡å¤ç”¨å‰ï¼š</strong> é…’åº—ç”¨ä¸€æ¬¡æ€§çš„æ‹–é‹ï¼Œå®¢äººèµ°äº†å°±æ‰”ï¼Œæ–°å®¢äººæ¥äº†é‡æ–°é€ ï¼Œæµªè´¹é’±ï¼ˆå†…å­˜ï¼‰ä¸”æ…¢ã€‚</li>
<li><strong>ç”¨äº† <code>@Reusable</code>ï¼š</strong> é…’åº—æ‹–é‹å›æ”¶æ¸…æ´—ï¼Œä¸‹ä¸€ä¸ªå®¢äººæ¥äº†æ¥ç€ç©¿ï¼Œåªéœ€è¦ç¨å¾®æ•´ç†ä¸€ä¸‹ï¼ˆé‡ç½®æ•°æ®ï¼‰ã€‚</li>
</ul>
<p>è¿™ä¸€è¡Œä»£ç å°±æ˜¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Reusable</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">MyItem</span> { ... }
</code></pre>
<hr/>
<h2 data-id="heading-2">ä»£ç å®æˆ˜ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ æ”¹é€ </h2>
<p>å…„å¼Ÿä»¬ï¼Œæ‰“å¼€ DevEco Studio 6.0ï¼Œæ–°å»ºä¸€ä¸ªé¡µé¢ã€‚ä¸‹é¢è¿™æ®µä»£ç ï¼ŒV å“¥å†™äº†ä¸€ä¸ªæ ‡å‡†çš„ã€é«˜æ€§èƒ½çš„å¯å¤ç”¨åˆ—è¡¨ã€‚ä½ å¯ä»¥ç›´æ¥å¤åˆ¶è¿è¡Œï¼Œæ„Ÿå—ä¸€ä¸‹é‚£ç§ä¸æ»‘ã€‚</p>
<h3 data-id="heading-3">ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®æ¨¡å‹å’ŒåŸºç¡€æ•°æ®æº</h3>
<p>è¿™æ˜¯ä¸ºäº†æ¨¡æ‹ŸçœŸå®ç¯å¢ƒï¼Œå’±ä»¬å¿…é¡»ç”¨ <code>IDataSource</code> æ¥å£ï¼Œä¸ºé¿å…å†²çªï¼Œä»¥ä¸‹çš„æ¥å£åå’Œç±»åéƒ½ä¼šåŠ  VG æ ‡è®°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. å®šä¹‰ç”¨æˆ·æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VGUserModel</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-attr">avatarColor</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// ç”¨é¢œè‰²ä»£æ›¿å¤´åƒå›¾ç‰‡ï¼Œå‡å°‘ä»£ç ä¾èµ–</span>
}

<span class="hljs-comment">// 2. å®šä¹‰åŸºç¡€æ•°æ®æºæ¥å£ï¼ˆè¿™æ˜¯ LazyForEach çš„ç¡¬æ€§è¦æ±‚ï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVGDataSource</span> {
  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">VGUserModel</span>;
  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IVGDataChangeListener</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IVGDataChangeListener</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 3. é‡å‘½åç›‘å¬å™¨æ¥å£é¿å…å†²çª</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IVGDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 4. å®ç°å…·ä½“çš„æ•°æ®æºç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VGDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVGDataSource</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">IVGDataChangeListener</span>[] = [];
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listData</span>: <span class="hljs-title class_">VGUserModel</span>[] = [];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data: VGUserModel[]</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listData</span> = data;
  }

  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listData</span>.<span class="hljs-property">length</span>;
  }

  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">VGUserModel</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listData</span>[index];
  }

  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IVGDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);
    }
  }

  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IVGDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);
    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);
    }
  }
}

<span class="hljs-comment">// 5. å®ç°æ•°æ®å˜åŒ–ç›‘å¬å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VGDataChangeCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IVGDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
}
</code></pre>
<h3 data-id="heading-4">ç¬¬äºŒæ­¥ï¼šç¼–å†™æ ¸å¿ƒçš„å¯å¤ç”¨ç»„ä»¶</h3>
<p><strong>è¿™æ˜¯é‡ç‚¹ï¼</strong> æ³¨æ„çœ‹ä»£ç é‡Œçš„æ³¨é‡Šï¼ŒV å“¥æ ‡è®°äº†å…³é”®é€»è¾‘ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ã€å…³é”®ä»£ç  1ã€‘ç§»é™¤ @Reusableï¼Œä½¿ç”¨æ ‡å‡†ç»„ä»¶</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">UserListItem</span> {
  <span class="hljs-comment">// ä½¿ç”¨ @Prop æ¥æ”¶çˆ¶ç»„ä»¶å‚æ•°</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">VGUserModel</span>;
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-comment">// ç»„ä»¶å†…éƒ¨çŠ¶æ€</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">userName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'é»˜è®¤åç§°'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">bgColor</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'#FFFFFF'</span>;

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åœ¨ç»„ä»¶åˆ›å»ºæ—¶åˆå§‹åŒ–æ•°æ®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateUserData</span>();
  }

  <span class="hljs-comment">// ã€ä¿®å¤ã€‘ç§»é™¤é”™è¯¯çš„ aboutToReuseï¼Œä½¿ç”¨å…¶ä»–æ–¹å¼å¤„ç†å¤ç”¨é€»è¾‘</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">updateUserData</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// æ›´æ–°å†…éƒ¨çŠ¶æ€</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">avatarColor</span>;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Vå“¥æ—¥å¿—ï¼šç»„ä»¶åˆå§‹åŒ– Index=<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>, Name=<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.name}</span>`</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-comment">// æ¨¡æ‹Ÿå¤´åƒ - æ·»åŠ å®‰å…¨æ£€æŸ¥</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span>[<span class="hljs-number">0</span>] : <span class="hljs-string">'?'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> || <span class="hljs-string">'#CCCCCC'</span>)
        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)
        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)

      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.userName}</span> (ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>)`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">12</span> })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">8</span> })
  }
}
</code></pre>
<h3 data-id="heading-5">ç¬¬ä¸‰æ­¥ï¼šä¸»é¡µé¢æ•´åˆ</h3>
<p>æŠŠæ•°æ®å’Œç»„ä»¶æ‹¼èµ·æ¥ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableListDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">dataSource</span>: <span class="hljs-title class_">VGDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VGDataSource</span>([]);

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åœ¨ç”Ÿå‘½å‘¨æœŸä¸­åˆå§‹åŒ–æ•°æ®ï¼Œé¿å…åœ¨æ„é€ æ—¶ä½¿ç”¨å¤æ‚è¡¨è¾¾å¼</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">initData</span>: <span class="hljs-title class_">VGUserModel</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
      <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VGUserModel</span>();
      user.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${i}</span>`</span>;
      user.<span class="hljs-property">name</span> = <span class="hljs-string">`Vå“¥çš„ç²‰ä¸ <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span> å·`</span>;
      user.<span class="hljs-property">avatarColor</span> = <span class="hljs-string">`#<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random()*<span class="hljs-number">16777215</span>).toString(<span class="hljs-number">16</span>).padStart(<span class="hljs-number">6</span>, <span class="hljs-string">'0'</span>)}</span>`</span>; <span class="hljs-comment">// ä¿®å¤é¢œè‰²ç”Ÿæˆ</span>
      initData.<span class="hljs-title function_">push</span>(user);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VGDataSource</span>(initData);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'API 21 å¤ç”¨æœºåˆ¶æ€§èƒ½æµ‹è¯•'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })

      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {
        <span class="hljs-comment">// ä½¿ç”¨ LazyForEach è¿›è¡Œæ•°æ®å±‚é¢çš„æ‡’åŠ è½½</span>
        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">user: VGUserModel, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-comment">// è°ƒç”¨æˆ‘ä»¬çš„å¯å¤ç”¨ç»„ä»¶</span>
            <span class="hljs-title class_">UserListItem</span>({ <span class="hljs-attr">user</span>: user, <span class="hljs-attr">index</span>: index })
          }
        }, <span class="hljs-function">(<span class="hljs-params">user: VGUserModel, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> user.<span class="hljs-property">id</span>) <span class="hljs-comment">// å¿…é¡»æä¾›å”¯ä¸€çš„ key</span>
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">edgeEffect</span>(<span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-property">Spring</span>) <span class="hljs-comment">// å¼¹æ€§æ»šåŠ¨æ•ˆæœï¼Œçœ‹ç€æ›´çˆ½</span>
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#E0E0E0'</span>)
  }
}
</code></pre>
<hr/>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d33403c011ee4cb6b40910e55090016f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986561&amp;x-signature=1T0IF2n2SJYUYVV%2FjwMEBHi8d9A%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">V å“¥æ·±åº¦å¤ç›˜ï¼šä¸ºä»€ä¹ˆè¿™èƒ½æé€Ÿ 200%ï¼Ÿ</h2>
<p>å…„å¼Ÿä»¬ï¼Œè·‘å®Œä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šå‘ç°æ»‘åŠ¨éå¸¸è·Ÿæ‰‹ã€‚å’±ä»¬æ¥å‰–æä¸€ä¸‹èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ï¼š</p>
<ol>
<li>
<p><strong><code>@Reusable</code> çš„é­”æ³•</strong>ï¼š
å½“ä½ æ»‘åŠ¨åˆ—è¡¨ï¼ŒItem 1 ç¦»å¼€å±å¹•ï¼Œå®ƒ<strong>ä¸ä¼šç«‹å³è¢«é”€æ¯</strong>ã€‚å®ƒè¢«æ‰”è¿›äº†ä¸€ä¸ª**â€œå¤ç”¨æ± â€<strong>ã€‚
å½“ Item 11 éœ€è¦æ˜¾ç¤ºæ—¶ï¼Œç³»ç»Ÿä¸å» <code>new UserListItem()</code>ï¼Œè€Œæ˜¯ç›´æ¥ä»æ± å­é‡Œæå‡ºåˆšæ‰é‚£ä¸ª Item 1 çš„</strong>å®ä¾‹**ã€‚</p>
</li>
<li>
<p><strong><code>aboutToReuse</code> çš„ä½œç”¨</strong>ï¼š
æ—¢ç„¶æ˜¯ Item 1 çš„å®ä¾‹ï¼Œé‚£å®ƒèº«ä¸Šè‚¯å®šè¿˜å¸¦ç€ Item 1 çš„åå­—å’Œé¢œè‰²ã€‚
è¿™æ—¶å€™ <code>aboutToReuse</code> è¢«è°ƒç”¨ï¼ŒæŠŠ Item 11 çš„æ•°æ®çŒè¿›å»ã€‚
<strong>æ³¨æ„ï¼š</strong> è¿™ä¸ªè¿‡ç¨‹æå…¶è½»é‡çº§ï¼Œåªæ˜¯ç®€å•çš„å˜é‡èµ‹å€¼ã€‚ç›¸æ¯”äº <code>build()</code> é‡æ–°åˆ›å»ºæ•´ä¸ª UI æ ‘ï¼Œé€Ÿåº¦æå‡äº†å‡ ä¸ªæ•°é‡çº§ã€‚</p>
</li>
<li>
<p><strong>CPU å’Œ å†…å­˜çš„åŒèµ¢</strong>ï¼š</p>
<ul>
<li><strong>CPU</strong>ï¼šä¸å†é¢‘ç¹æ‰§è¡Œå¤æ‚çš„ <code>build</code> æ¸²æŸ“é€»è¾‘ã€‚</li>
<li><strong>å†…å­˜</strong>ï¼šå¯¹è±¡ä¸å†é¢‘ç¹åˆ›å»ºé”€æ¯ï¼ŒGCï¼ˆåƒåœ¾å›æ”¶ï¼‰å‹åŠ›éª¤å‡ã€‚GC ä¸å·¥ä½œäº†ï¼Œä¸»çº¿ç¨‹å°±ä¸ä¼šå¡é¡¿ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-7">V å“¥çš„é¿å‘æŒ‡å—</h2>
<p>è™½ç„¶ <code>@Reusable</code> å¾ˆé¦™ï¼Œä½†ç”¨ä¸å¥½ä¹Ÿä¼šç¿»è½¦ã€‚V å“¥ç»™ä½ æä¸ªé†’ï¼š</p>
<ol>
<li><strong>å¿…é¡»è¦é‡ç½®çŠ¶æ€</strong>ï¼š
åœ¨ <code>aboutToReuse</code> é‡Œï¼Œä¸€å®šè¦æŠŠä¹‹å‰çš„çŠ¶æ€æ¸…ç†å¹²å‡€ã€‚æ¯”å¦‚ä½ çš„ç»„ä»¶é‡Œæœ‰ä¸ªè¿›åº¦æ¡ï¼Œå¤ç”¨æ—¶å¦‚æœå¿˜äº†é‡ç½®ä¸º 0ï¼Œç”¨æˆ·å°±ä¼šçœ‹åˆ°è¿›åº¦æ¡ä¹±è·³çš„ Bugã€‚</li>
<li><strong>ä¸è¦åšè€—æ—¶æ“ä½œ</strong>ï¼š
<code>aboutToReuse</code> æ˜¯åœ¨ä¸»çº¿ç¨‹è·‘çš„ï¼Œåƒä¸‡åˆ«åœ¨è¿™é‡Œæç½‘ç»œè¯·æ±‚æˆ–è€…å¤æ‚è®¡ç®—ï¼Œå¦åˆ™å¡é¡¿çš„è¿˜æ˜¯ä½ ã€‚</li>
<li><strong>åˆ«è·Ÿ <code>ForEach</code> æ··ç”¨</strong>ï¼š
è®°ä½äº†ï¼Œ<code>@Reusable</code> åªæœ‰é…åˆ <code>LazyForEach</code> æ‰èƒ½å‘æŒ¥æœ€å¤§å¨åŠ›ã€‚åœ¨ <code>ForEach</code> é‡Œç”¨ <code>@Reusable</code> æ„ä¹‰ä¸å¤§ï¼Œå› ä¸º <code>ForEach</code> æœ¬èº«å°±ä¸æ€ä¹ˆå¤ç”¨ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p>å…„å¼Ÿä»¬ï¼ŒAPI 21 çš„æ€§èƒ½ä¼˜åŒ–å…¶å®æ²¡é‚£ä¹ˆç„ä¹ã€‚</p>
<p>åªè¦è®°ä½ V å“¥è¿™å¥—ç»„åˆæ‹³ï¼š
<strong><code>LazyForEach</code> (æ•°æ®æ‡’åŠ è½½) + <code>@Reusable</code> (ç»„ä»¶å¤ç”¨) = ä¸èˆ¬é¡ºæ»‘çš„åˆ—è¡¨</strong>ã€‚</p>
<p>èµ¶ç´§æŠŠä½ é¡¹ç›®é‡Œé‚£äº›å¤æ‚çš„åˆ—è¡¨ç»„ä»¶æ”¹é€ ä¸€ä¸‹å§ï¼åˆ«è®©ä½ çš„ App æˆä¸ºç”¨æˆ·å£ä¸­çš„â€œPPT æ’­æ”¾å™¨â€ã€‚</p>
<p>æˆ‘æ˜¯ V å“¥ï¼Œå’±ä»¬ä¸‹æœŸæŠ€æœ¯å¤ç›˜è§ï¼æœ‰é—®é¢˜è¯„è®ºåŒºç•™è¨€ï¼ŒV å“¥çœ‹åˆ°å¿…å›ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Node.js æ‰¹é‡ä¸‹è½½å…¨å›½è¡Œæ”¿åŒº GeoJSONï¼ˆå«çœçº§ + åœ°çº§å¸‚ï¼‰]]></title>    <link>https://juejin.cn/post/7594835618120335400</link>    <guid>https://juejin.cn/post/7594835618120335400</guid>    <pubDate>2026-01-14T09:27:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120335400" data-draft-id="7594835618120269864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Node.js æ‰¹é‡ä¸‹è½½å…¨å›½è¡Œæ”¿åŒº GeoJSONï¼ˆå«çœçº§ + åœ°çº§å¸‚ï¼‰"/> <meta itemprop="keywords" content="Node.js"/> <meta itemprop="datePublished" content="2026-01-14T09:27:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•²ä»£ç çš„é˜¿å‡¡é©´"/> <meta itemprop="url" content="https://juejin.cn/user/2447990287511436"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Node.js æ‰¹é‡ä¸‹è½½å…¨å›½è¡Œæ”¿åŒº GeoJSONï¼ˆå«çœçº§ + åœ°çº§å¸‚ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447990287511436/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•²ä»£ç çš„é˜¿å‡¡é©´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:27:36.000Z" title="Wed Jan 14 2026 09:27:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡ä»‹ç»ä¸€ä¸ª <strong>Node.js è„šæœ¬</strong>ï¼Œç”¨äºä» <strong>é˜¿é‡Œäº‘ DataV è¡Œæ”¿åŒºè¾¹ç•Œæ¥å£</strong> æ‰¹é‡ä¸‹è½½å…¨å›½è¡Œæ”¿åŒºåˆ’çš„ <strong>GeoJSON è¾¹ç•Œæ–‡ä»¶</strong>ï¼Œè¦†ç›–èŒƒå›´åŒ…æ‹¬ï¼š</p>
<ul>
<li>å…¨å›½ï¼ˆ100000ï¼‰</li>
<li>34 ä¸ªçœçº§è¡Œæ”¿åŒº</li>
<li>æ‰€æœ‰å­˜åœ¨ <code>_full.json</code> çš„åœ°çº§å¸‚</li>
</ul>
<p>éå¸¸é€‚åˆç”¨äº <strong>åœ°å›¾å¯è§†åŒ–ï¼ˆé«˜å¾· / ECharts / Mapboxï¼‰</strong> ã€<strong>åŒºåŸŸåˆ†æ</strong>ã€<strong>å‰ç«¯ç¦»çº¿åœ°å›¾</strong> ç­‰åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ•°æ®æ¥æºè¯´æ˜</h2>
<p>ä½¿ç”¨çš„æ•°æ®æ¥å£ä¸ºé˜¿é‡Œäº‘ DataV å®˜æ–¹å…¬å¼€æ¥å£ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">https://geo.datav.aliyun.com/areas_v3/bound/{adcode}_full.json
</code></pre>
<ul>
<li><code>adcode</code>ï¼šå›½å®¶ç»Ÿè®¡å±€è¡Œæ”¿åŒºåˆ’ä»£ç </li>
<li><code>_full.json</code>ï¼šåŒ…å«å®Œæ•´è¾¹ç•Œæ•°æ®ï¼ˆæ¯” <code>_simplified.json</code> æ›´ç²¾ç»†ï¼‰</li>
</ul>
<p>âš ï¸ æ³¨æ„ï¼š<strong>éƒ¨åˆ†åœ°çº§å¸‚æ²¡æœ‰ <code>_full.json</code> æ–‡ä»¶</strong>ï¼Œè¯·æ±‚ä¼šè¿”å› 404ï¼Œéœ€è¦æ‰‹åŠ¨è¿‡æ»¤ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€è„šæœ¬åŠŸèƒ½æ¦‚è¿°</h2>
<p>è¯¥è„šæœ¬å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>
<p>åˆ›å»º <code>geo/</code> ç›®å½•ç”¨äºå­˜æ”¾ä¸‹è½½ç»“æœ</p>
</li>
<li>
<p>æ„å»ºå®Œæ•´çš„ <code>adcode</code> åˆ—è¡¨ï¼š</p>
<ul>
<li>å…¨å›½</li>
<li>34 ä¸ªçœçº§è¡Œæ”¿åŒº</li>
<li>æ‰€æœ‰å­˜åœ¨ <code>full.json</code> çš„åœ°çº§å¸‚</li>
</ul>
</li>
<li>
<p>è¿‡æ»¤æ—  <code>full.json</code> çš„åŸå¸‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>https</code> æ¨¡å—é€ä¸ªä¸‹è½½ GeoJSON æ–‡ä»¶</p>
</li>
<li>
<p>è‡ªåŠ¨ä¿å­˜ä¸º <code>{adcode}_full.json</code></p>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å®Œæ•´ Node.js è„šæœ¬ï¼ˆ<strong>æ— ä»»ä½•çœç•¥</strong>ï¼‰</h2>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">fs</span> = require(<span class="hljs-string">"fs"</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">https</span> = require(<span class="hljs-string">"https"</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">path</span> = require(<span class="hljs-string">"path"</span>)<span class="hljs-comment">;</span>

// è¾“å‡ºç›®å½•
const <span class="hljs-attr">outDir</span> = path.join(__dirname, <span class="hljs-string">"geo"</span>)<span class="hljs-comment">;</span>
fs.mkdirSync(outDir, { recursive: true })<span class="hljs-comment">;</span>

// ----------------------------
// å…¨å›½ + çœçº§ + åœ°çº§å¸‚ adcode åˆ—è¡¨
// ----------------------------

// å…¨å›½
const <span class="hljs-attr">adcodes</span> = [<span class="hljs-string">"100000"</span>]<span class="hljs-comment">;</span>

// çœçº§ï¼ˆ34 ä¸ªï¼‰
const <span class="hljs-attr">provinces</span> = [
  <span class="hljs-string">"110000"</span>,<span class="hljs-string">"120000"</span>,<span class="hljs-string">"130000"</span>,<span class="hljs-string">"140000"</span>,<span class="hljs-string">"150000"</span>,
  <span class="hljs-string">"210000"</span>,<span class="hljs-string">"220000"</span>,<span class="hljs-string">"230000"</span>,
  <span class="hljs-string">"310000"</span>,<span class="hljs-string">"320000"</span>,<span class="hljs-string">"330000"</span>,<span class="hljs-string">"340000"</span>,<span class="hljs-string">"350000"</span>,<span class="hljs-string">"360000"</span>,<span class="hljs-string">"370000"</span>,
  <span class="hljs-string">"410000"</span>,<span class="hljs-string">"420000"</span>,<span class="hljs-string">"430000"</span>,<span class="hljs-string">"440000"</span>,<span class="hljs-string">"450000"</span>,<span class="hljs-string">"460000"</span>,
  <span class="hljs-string">"500000"</span>,<span class="hljs-string">"510000"</span>,<span class="hljs-string">"520000"</span>,<span class="hljs-string">"530000"</span>,<span class="hljs-string">"540000"</span>,
  <span class="hljs-string">"610000"</span>,<span class="hljs-string">"620000"</span>,<span class="hljs-string">"630000"</span>,<span class="hljs-string">"640000"</span>,<span class="hljs-string">"650000"</span>,
  <span class="hljs-string">"710000"</span>,<span class="hljs-string">"810000"</span>,<span class="hljs-string">"820000"</span>
]<span class="hljs-comment">;</span>
adcodes.push(...provinces)<span class="hljs-comment">;</span>

// ----------------------------
// åœ°çº§å¸‚ï¼ˆå…¨å›½æ‰€æœ‰æœ‰ full.json çš„ï¼‰
// ----------------------------

// ç›´æ¥ç”¨å®˜æ–¹å®Œæ•´ adcode åˆ—è¡¨ï¼ˆè¿‡æ»¤æ‰æ—  full.json çš„åœ°çº§å¸‚ï¼‰
// citieså€¼è¿‡å¤§ï¼Œä¹Ÿå¯ä»¥ä»åŒçº§æ–‡ä»¶å¼•å…¥cities.jsonï¼Œæœ¬æ–‡ç« é€‰æ‹©ç›´æ¥ç»™citiesèµ‹å€¼
const <span class="hljs-attr">cities</span> = [
  <span class="hljs-string">"110100"</span>,<span class="hljs-string">"120100"</span>,
  <span class="hljs-string">"130100"</span>,<span class="hljs-string">"130200"</span>,<span class="hljs-string">"130300"</span>,<span class="hljs-string">"130400"</span>,<span class="hljs-string">"130500"</span>,<span class="hljs-string">"130600"</span>,<span class="hljs-string">"130700"</span>,<span class="hljs-string">"130800"</span>,<span class="hljs-string">"130900"</span>,<span class="hljs-string">"131000"</span>,<span class="hljs-string">"131100"</span>,
  <span class="hljs-string">"140100"</span>,<span class="hljs-string">"140200"</span>,<span class="hljs-string">"140300"</span>,<span class="hljs-string">"140400"</span>,<span class="hljs-string">"140500"</span>,<span class="hljs-string">"140600"</span>,<span class="hljs-string">"140700"</span>,<span class="hljs-string">"140800"</span>,<span class="hljs-string">"140900"</span>,<span class="hljs-string">"141000"</span>,<span class="hljs-string">"141100"</span>,
  <span class="hljs-string">"150100"</span>,<span class="hljs-string">"150200"</span>,<span class="hljs-string">"150300"</span>,<span class="hljs-string">"150400"</span>,<span class="hljs-string">"150500"</span>,<span class="hljs-string">"150600"</span>,<span class="hljs-string">"150700"</span>,<span class="hljs-string">"150800"</span>,<span class="hljs-string">"150900"</span>,<span class="hljs-string">"152200"</span>,<span class="hljs-string">"152500"</span>,<span class="hljs-string">"152900"</span>,
  <span class="hljs-string">"210100"</span>,<span class="hljs-string">"210200"</span>,<span class="hljs-string">"210300"</span>,<span class="hljs-string">"210400"</span>,<span class="hljs-string">"210500"</span>,<span class="hljs-string">"210600"</span>,<span class="hljs-string">"210700"</span>,<span class="hljs-string">"210800"</span>,<span class="hljs-string">"210900"</span>,<span class="hljs-string">"211000"</span>,<span class="hljs-string">"211100"</span>,<span class="hljs-string">"211200"</span>,
  <span class="hljs-string">"220100"</span>,<span class="hljs-string">"220200"</span>,<span class="hljs-string">"220300"</span>,<span class="hljs-string">"220400"</span>,<span class="hljs-string">"220500"</span>,<span class="hljs-string">"220600"</span>,<span class="hljs-string">"220700"</span>,<span class="hljs-string">"220800"</span>,<span class="hljs-string">"222400"</span>,<span class="hljs-string">"222600"</span>,
  <span class="hljs-string">"230100"</span>,<span class="hljs-string">"230200"</span>,<span class="hljs-string">"230300"</span>,<span class="hljs-string">"230400"</span>,<span class="hljs-string">"230500"</span>,<span class="hljs-string">"230600"</span>,<span class="hljs-string">"230700"</span>,<span class="hljs-string">"230800"</span>,<span class="hljs-string">"230900"</span>,<span class="hljs-string">"231000"</span>,<span class="hljs-string">"231100"</span>,<span class="hljs-string">"231200"</span>,<span class="hljs-string">"232700"</span>,
  <span class="hljs-string">"310100"</span>,
  <span class="hljs-string">"320100"</span>,<span class="hljs-string">"320200"</span>,<span class="hljs-string">"320300"</span>,<span class="hljs-string">"320400"</span>,<span class="hljs-string">"320500"</span>,<span class="hljs-string">"320600"</span>,<span class="hljs-string">"320700"</span>,<span class="hljs-string">"320800"</span>,<span class="hljs-string">"320900"</span>,<span class="hljs-string">"321000"</span>,<span class="hljs-string">"321100"</span>,<span class="hljs-string">"321200"</span>,<span class="hljs-string">"321300"</span>,
  <span class="hljs-string">"330100"</span>,<span class="hljs-string">"330200"</span>,<span class="hljs-string">"330300"</span>,<span class="hljs-string">"330400"</span>,<span class="hljs-string">"330500"</span>,<span class="hljs-string">"330600"</span>,<span class="hljs-string">"330700"</span>,<span class="hljs-string">"330800"</span>,<span class="hljs-string">"330900"</span>,<span class="hljs-string">"331000"</span>,<span class="hljs-string">"331100"</span>,
  <span class="hljs-string">"340100"</span>,<span class="hljs-string">"340200"</span>,<span class="hljs-string">"340300"</span>,<span class="hljs-string">"340400"</span>,<span class="hljs-string">"340500"</span>,<span class="hljs-string">"340600"</span>,<span class="hljs-string">"341000"</span>,<span class="hljs-string">"341100"</span>,<span class="hljs-string">"341200"</span>,<span class="hljs-string">"341300"</span>,<span class="hljs-string">"341500"</span>,
  <span class="hljs-string">"350100"</span>,<span class="hljs-string">"350200"</span>,<span class="hljs-string">"350300"</span>,<span class="hljs-string">"350400"</span>,<span class="hljs-string">"350500"</span>,<span class="hljs-string">"350600"</span>,<span class="hljs-string">"350700"</span>,<span class="hljs-string">"350800"</span>,<span class="hljs-string">"350900"</span>,<span class="hljs-string">"351000"</span>,
  <span class="hljs-string">"360100"</span>,<span class="hljs-string">"360200"</span>,<span class="hljs-string">"360300"</span>,<span class="hljs-string">"360400"</span>,<span class="hljs-string">"360500"</span>,<span class="hljs-string">"360600"</span>,<span class="hljs-string">"360700"</span>,<span class="hljs-string">"360800"</span>,<span class="hljs-string">"360900"</span>,<span class="hljs-string">"361000"</span>,<span class="hljs-string">"361100"</span>,
  <span class="hljs-string">"370100"</span>,<span class="hljs-string">"370200"</span>,<span class="hljs-string">"370300"</span>,<span class="hljs-string">"370400"</span>,<span class="hljs-string">"370500"</span>,<span class="hljs-string">"370600"</span>,<span class="hljs-string">"370700"</span>,<span class="hljs-string">"370800"</span>,<span class="hljs-string">"370900"</span>,<span class="hljs-string">"371000"</span>,<span class="hljs-string">"371100"</span>,<span class="hljs-string">"371200"</span>,<span class="hljs-string">"371300"</span>,<span class="hljs-string">"371400"</span>,<span class="hljs-string">"371500"</span>,<span class="hljs-string">"371600"</span>,<span class="hljs-string">"371700"</span>,
  <span class="hljs-string">"410100"</span>,<span class="hljs-string">"410200"</span>,<span class="hljs-string">"410300"</span>,<span class="hljs-string">"410400"</span>,<span class="hljs-string">"410500"</span>,<span class="hljs-string">"410600"</span>,<span class="hljs-string">"410700"</span>,<span class="hljs-string">"410800"</span>,<span class="hljs-string">"410900"</span>,<span class="hljs-string">"411000"</span>,<span class="hljs-string">"411100"</span>,<span class="hljs-string">"411200"</span>,<span class="hljs-string">"411300"</span>,<span class="hljs-string">"411400"</span>,<span class="hljs-string">"411500"</span>,<span class="hljs-string">"411600"</span>,<span class="hljs-string">"411700"</span>,<span class="hljs-string">"411800"</span>,<span class="hljs-string">"411900"</span>,<span class="hljs-string">"412700"</span>,
  <span class="hljs-string">"420100"</span>,<span class="hljs-string">"420200"</span>,<span class="hljs-string">"420300"</span>,<span class="hljs-string">"420500"</span>,<span class="hljs-string">"420600"</span>,<span class="hljs-string">"420700"</span>,<span class="hljs-string">"420800"</span>,<span class="hljs-string">"429004"</span>,<span class="hljs-string">"429005"</span>,<span class="hljs-string">"429006"</span>,
  <span class="hljs-string">"430100"</span>,<span class="hljs-string">"430200"</span>,<span class="hljs-string">"430300"</span>,<span class="hljs-string">"430400"</span>,<span class="hljs-string">"430500"</span>,<span class="hljs-string">"430600"</span>,<span class="hljs-string">"430700"</span>,<span class="hljs-string">"430800"</span>,<span class="hljs-string">"430900"</span>,<span class="hljs-string">"431000"</span>,<span class="hljs-string">"431100"</span>,<span class="hljs-string">"431200"</span>,<span class="hljs-string">"433100"</span>,
  <span class="hljs-string">"440100"</span>,<span class="hljs-string">"440200"</span>,<span class="hljs-string">"440300"</span>,<span class="hljs-string">"440400"</span>,<span class="hljs-string">"440500"</span>,<span class="hljs-string">"440600"</span>,<span class="hljs-string">"440700"</span>,<span class="hljs-string">"440800"</span>,<span class="hljs-string">"440900"</span>,<span class="hljs-string">"441200"</span>,<span class="hljs-string">"441300"</span>,<span class="hljs-string">"441400"</span>,<span class="hljs-string">"441500"</span>,<span class="hljs-string">"441600"</span>,<span class="hljs-string">"441700"</span>,<span class="hljs-string">"441800"</span>,<span class="hljs-string">"441900"</span>,<span class="hljs-string">"442000"</span>,
  <span class="hljs-string">"445100"</span>,<span class="hljs-string">"445200"</span>,<span class="hljs-string">"445300"</span>,
  <span class="hljs-string">"450100"</span>,<span class="hljs-string">"450200"</span>,<span class="hljs-string">"450300"</span>,<span class="hljs-string">"450400"</span>,<span class="hljs-string">"450500"</span>,<span class="hljs-string">"450600"</span>,<span class="hljs-string">"450700"</span>,<span class="hljs-string">"450800"</span>,<span class="hljs-string">"450900"</span>,<span class="hljs-string">"451000"</span>,<span class="hljs-string">"451100"</span>,<span class="hljs-string">"451200"</span>,
  <span class="hljs-string">"460100"</span>,<span class="hljs-string">"460200"</span>,<span class="hljs-string">"460300"</span>,<span class="hljs-string">"460400"</span>,
  <span class="hljs-string">"469001"</span>,<span class="hljs-string">"469002"</span>,<span class="hljs-string">"469003"</span>,<span class="hljs-string">"469005"</span>,<span class="hljs-string">"469006"</span>,<span class="hljs-string">"469007"</span>,<span class="hljs-string">"469021"</span>,<span class="hljs-string">"469022"</span>,<span class="hljs-string">"469023"</span>,<span class="hljs-string">"469024"</span>,<span class="hljs-string">"469025"</span>,<span class="hljs-string">"469026"</span>,<span class="hljs-string">"469027"</span>,<span class="hljs-string">"469028"</span>,
  <span class="hljs-string">"500100"</span>,<span class="hljs-string">"500200"</span>,<span class="hljs-string">"500300"</span>,<span class="hljs-string">"500400"</span>,
  <span class="hljs-string">"510100"</span>,<span class="hljs-string">"510300"</span>,<span class="hljs-string">"510400"</span>,<span class="hljs-string">"510500"</span>,<span class="hljs-string">"510600"</span>,<span class="hljs-string">"510700"</span>,<span class="hljs-string">"510800"</span>,<span class="hljs-string">"510900"</span>,<span class="hljs-string">"511000"</span>,<span class="hljs-string">"511100"</span>,<span class="hljs-string">"511300"</span>,<span class="hljs-string">"511400"</span>,<span class="hljs-string">"511500"</span>,<span class="hljs-string">"511600"</span>,<span class="hljs-string">"511700"</span>,<span class="hljs-string">"511800"</span>,<span class="hljs-string">"511900"</span>,<span class="hljs-string">"512000"</span>,
  <span class="hljs-string">"513200"</span>,<span class="hljs-string">"513300"</span>,<span class="hljs-string">"513400"</span>,<span class="hljs-string">"513500"</span>,<span class="hljs-string">"513600"</span>,<span class="hljs-string">"513700"</span>,
  <span class="hljs-string">"520100"</span>,<span class="hljs-string">"520200"</span>,<span class="hljs-string">"520300"</span>,<span class="hljs-string">"520400"</span>,
  <span class="hljs-string">"522200"</span>,<span class="hljs-string">"522300"</span>,<span class="hljs-string">"522400"</span>,<span class="hljs-string">"522600"</span>,<span class="hljs-string">"522700"</span>,<span class="hljs-string">"522800"</span>,<span class="hljs-string">"522900"</span>,<span class="hljs-string">"523200"</span>,
  <span class="hljs-string">"530100"</span>,<span class="hljs-string">"530300"</span>,<span class="hljs-string">"530400"</span>,<span class="hljs-string">"530500"</span>,<span class="hljs-string">"530600"</span>,<span class="hljs-string">"530700"</span>,<span class="hljs-string">"530800"</span>,<span class="hljs-string">"530900"</span>,
  <span class="hljs-string">"532300"</span>,<span class="hljs-string">"532500"</span>,<span class="hljs-string">"532600"</span>,<span class="hljs-string">"532800"</span>,<span class="hljs-string">"532900"</span>,
  <span class="hljs-string">"533100"</span>,<span class="hljs-string">"533300"</span>,<span class="hljs-string">"533400"</span>,
  <span class="hljs-string">"540100"</span>,<span class="hljs-string">"540200"</span>,<span class="hljs-string">"540300"</span>,<span class="hljs-string">"540400"</span>,
  <span class="hljs-string">"542200"</span>,<span class="hljs-string">"542300"</span>,<span class="hljs-string">"542400"</span>,<span class="hljs-string">"542500"</span>,<span class="hljs-string">"542600"</span>,<span class="hljs-string">"542700"</span>,
  <span class="hljs-string">"610100"</span>,<span class="hljs-string">"610200"</span>,<span class="hljs-string">"610300"</span>,<span class="hljs-string">"610400"</span>,<span class="hljs-string">"610500"</span>,<span class="hljs-string">"610600"</span>,<span class="hljs-string">"610700"</span>,<span class="hljs-string">"610800"</span>,<span class="hljs-string">"610900"</span>,<span class="hljs-string">"611000"</span>,
  <span class="hljs-string">"620100"</span>,<span class="hljs-string">"620200"</span>,<span class="hljs-string">"620300"</span>,<span class="hljs-string">"620400"</span>,<span class="hljs-string">"620500"</span>,<span class="hljs-string">"620600"</span>,<span class="hljs-string">"620700"</span>,<span class="hljs-string">"620800"</span>,<span class="hljs-string">"620900"</span>,<span class="hljs-string">"621000"</span>,<span class="hljs-string">"621100"</span>,<span class="hljs-string">"621200"</span>,
  <span class="hljs-string">"622900"</span>,<span class="hljs-string">"623000"</span>,
  <span class="hljs-string">"630100"</span>,<span class="hljs-string">"630200"</span>,<span class="hljs-string">"632200"</span>,<span class="hljs-string">"632300"</span>,<span class="hljs-string">"632500"</span>,<span class="hljs-string">"632600"</span>,<span class="hljs-string">"632700"</span>,<span class="hljs-string">"632800"</span>,<span class="hljs-string">"632900"</span>,
  <span class="hljs-string">"640100"</span>,<span class="hljs-string">"640200"</span>,<span class="hljs-string">"640300"</span>,<span class="hljs-string">"640400"</span>,
  <span class="hljs-string">"650100"</span>,<span class="hljs-string">"650200"</span>,<span class="hljs-string">"650400"</span>,<span class="hljs-string">"650500"</span>,
  <span class="hljs-string">"652300"</span>,<span class="hljs-string">"652700"</span>,<span class="hljs-string">"652800"</span>,<span class="hljs-string">"652900"</span>,<span class="hljs-string">"653000"</span>,<span class="hljs-string">"653100"</span>,<span class="hljs-string">"653200"</span>,
  <span class="hljs-string">"654000"</span>,<span class="hljs-string">"654200"</span>,<span class="hljs-string">"654300"</span>,
  <span class="hljs-string">"659001"</span>,<span class="hljs-string">"659002"</span>,<span class="hljs-string">"659003"</span>,<span class="hljs-string">"659004"</span>
]<span class="hljs-comment">;</span>

// æ’é™¤æ—  full.json çš„åŸå¸‚
const <span class="hljs-attr">NO_FULL</span> = [<span class="hljs-string">"441900"</span>,<span class="hljs-string">"442000"</span>,<span class="hljs-string">"460400"</span>,<span class="hljs-string">"620200"</span>]<span class="hljs-comment">;</span>
const <span class="hljs-attr">filteredCities</span> = cities.filter(c =&gt; !NO_FULL.includes(c))<span class="hljs-comment">;</span>

adcodes.push(...filteredCities)<span class="hljs-comment">;</span>

// ----------------------------
// ä¸‹è½½å‡½æ•°
// ----------------------------
function downloadGeoJson(code) {
  const <span class="hljs-attr">url</span> = `https://geo.datav.aliyun.com/areas_v3/bound/<span class="hljs-variable">${code}</span>_full.json`<span class="hljs-comment">;</span>
  const <span class="hljs-attr">filePath</span> = path.join(outDir, `<span class="hljs-variable">${code}</span>_full.json`)<span class="hljs-comment">;</span>

  https.get(url, <span class="hljs-attr">res</span> =&gt; {
    if (res.statusCode !== 200) {
      console.log("ä¸‹è½½å¤±è´¥:", code, res.statusCode)<span class="hljs-comment">;</span>
      return<span class="hljs-comment">;</span>
    }
    const <span class="hljs-attr">fileStream</span> = fs.createWriteStream(filePath)<span class="hljs-comment">;</span>
    res.pipe(fileStream)<span class="hljs-comment">;</span>
    fileStream.on("finish", () =&gt; {
      console.log("ä¸‹è½½å®Œæˆ:", code)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
  }).on("error", <span class="hljs-attr">err</span> =&gt; {
    console.log("ä¸‹è½½é”™è¯¯:", code, err.message)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
}

// ----------------------------
// æ‰§è¡Œä¸‹è½½
// ----------------------------
adcodes.forEach(<span class="hljs-attr">code</span> =&gt; downloadGeoJson(code))<span class="hljs-comment">;</span>

console.log("å¼€å§‹ä¸‹è½½æ‰€æœ‰ GeoJSON æ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…...")<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">å››ã€ç”Ÿæˆç»“æœè¯´æ˜</h2>
<p>æ‰§è¡Œå®Œæˆåï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">geo/
â”œâ”€â”€ 100000_full.json        <span class="hljs-comment"># å…¨å›½</span>
â”œâ”€â”€ 110000_full.json        <span class="hljs-comment"># åŒ—äº¬</span>
â”œâ”€â”€ 110100_full.json        <span class="hljs-comment"># åŒ—äº¬å¸‚</span>
â”œâ”€â”€ 440100_full.json        <span class="hljs-comment"># å¹¿å·å¸‚</span>
â”œâ”€â”€ ...
</code></pre>
<p>æ¯ä¸ªæ–‡ä»¶éƒ½å¯ç›´æ¥ç”¨äºï¼š</p>
<ul>
<li>ECharts <code>map</code> æ³¨å†Œ</li>
<li>é«˜å¾·åœ°å›¾ <code>GeoJSON</code> è¦†ç›–ç‰©</li>
<li>Mapbox <code>source</code></li>
</ul>
<hr/>
<h2 data-id="heading-4">äº”ã€æ³¨æ„äº‹é¡¹ä¸ä¼˜åŒ–å»ºè®®ï¼ˆæœ¬æ¬¡ä¸ºå…¨é‡æ•°æ®ï¼Œå¯å‚è€ƒä¸‹æ–¹ä¼˜åŒ–å»ºè®®ï¼‰</h2>
<h3 data-id="heading-5">1ï¸âƒ£ è¯·æ±‚è¾ƒå¤šï¼Œé¿å…é¢‘ç¹è¿è¡Œ</h3>
<ul>
<li>æ€»è¯·æ±‚æ•° â‰ˆ 400+</li>
<li>ä¸å»ºè®®é¢‘ç¹æ‰§è¡Œï¼Œå®¹æ˜“è¢«é™æµ</li>
</ul>
<h3 data-id="heading-6">2ï¸âƒ£ å¯åŠ å¹¶å‘æ§åˆ¶ï¼ˆæ¨èï¼‰</h3>
<ul>
<li>ä½¿ç”¨ <code>p-limit</code> æˆ–é˜Ÿåˆ—ä¸‹è½½</li>
<li>é¿å…åŒæ—¶å‘èµ·è¿‡å¤š HTTPS è¯·æ±‚</li>
</ul>
<h3 data-id="heading-7">3ï¸âƒ£ å¯æ‰©å±•åŒºå¿çº§</h3>
<ul>
<li>æ¥å£æ”¯æŒ <code>åŒº/å¿ adcode</code></li>
<li>ä½†æ–‡ä»¶ä½“ç§¯ä¼šéå¸¸å¤§ï¼ˆä¸æ¨èå…¨é‡ï¼‰</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSä¸€æ¯å†°ç¾å¼çš„æ—¶é—´ -- UIUtilsåŸºç¡€åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7594854295745511460</link>    <guid>https://juejin.cn/post/7594854295745511460</guid>    <pubDate>2026-01-13T16:59:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295745511460" data-draft-id="7594642978696511551" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSä¸€æ¯å†°ç¾å¼çš„æ—¶é—´ -- UIUtilsåŸºç¡€åŠŸèƒ½"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-13T16:59:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŒ«çŒ«å¤´å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/1283876003519357"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSä¸€æ¯å†°ç¾å¼çš„æ—¶é—´ -- UIUtilsåŸºç¡€åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1283876003519357/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŒ«çŒ«å¤´å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T16:59:48.000Z" title="Tue Jan 13 2026 16:59:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    131
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>æœ€è¿‘åœ¨å†™çŠ¶æ€ç®¡ç†ç›¸å…³çš„ä»£ç ï¼Œå‘ç° HarmonyOS çš„ <code>UIUtils</code> è¿™ä¸ªå·¥å…·ç±»è¿˜æŒºå®ç”¨çš„ã€‚å®ƒä¸»è¦è§£å†³ä¸€äº›çŠ¶æ€ç®¡ç†æ¡†æ¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„è¾¹ç•Œé—®é¢˜ï¼Œæ¯”å¦‚ä»£ç†å¯¹è±¡ã€V1/V2 æ··ç”¨ã€æ•°æ®ç»‘å®šè¿™äº›åœºæ™¯ã€‚</p>
<p>ä»Šå¤©é¡ºæ‰‹æ•´ç†ä¸€ä¸‹å®ƒçš„å‡ ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œæ–¹ä¾¿ä»¥åæŸ¥ã€‚</p>
<p>è¯¥ç³»åˆ—ä¾æ—§ä¼šå¸¦ç€å¤§å®¶ï¼Œäº†è§£ï¼Œå¼€é˜”ä¸€äº›ä¸æ€ä¹ˆçƒ­é—¨çš„APIï¼Œä¹Ÿå¯èƒ½æ˜¯å·å·è¢«æ›´æ–°çš„APIï¼Œä¹Ÿå¯ä»¥æ˜¯å¥½ç©çš„ï¼Œè—åœ¨å®˜æ–¹æ–‡æ¡£çš„è¾¹è¾¹è§’è§’~å½“ç„¶ä¹Ÿä¼šæœ‰ä¸€äº›APIï¼Œä¹‹å‰æ˜¯æˆ‘ä»¬è¾›è¾›è‹¦è‹¦çš„æ‰‹æ’¸ä»£ç ï¼Œç°åœ¨æœ‰ä¸€ä¸ªAPIèƒ½å¸®æˆ‘ä»¬å¿«é€Ÿå®ç°çš„ï¼Œå¸Œæœ›å¤§å®¶èƒ½æ‰¾å®è—ã€‚</p>
<p>å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®ã€å¯¹æ–‡ç« å†™çš„ä¸æ»¡æ„ã€å‘ç°é”™è¯¯ã€æƒ³åæ§½æˆ–è€…æœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºã€ç§ä¿¡æˆ–é‚®ä»¶ä¸­æå‡ºï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„æ”¯æŒã€‚ğŸ™</p>
<h2 data-id="heading-1">äºŒã€UIUtil</h2>
<p>çŠ¶æ€ç®¡ç†æ¡†æ¶åœ¨èƒŒååšäº†å¾ˆå¤šå·¥ä½œï¼Œæ¯”å¦‚ç»™å¯¹è±¡åŠ ä»£ç†ã€è‡ªåŠ¨è¿½è¸ªå˜åŒ–ã€è§¦å‘ UI æ›´æ–°ç­‰ç­‰ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç»•è¿‡è¿™äº›æœºåˆ¶ï¼Œæˆ–è€…åœ¨ä¸åŒç‰ˆæœ¬çš„çŠ¶æ€ç®¡ç†ä¹‹é—´åšè½¬æ¢ï¼Œè¿™æ—¶å€™ <code>UIUtils</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p>å®ƒæä¾›çš„åŠŸèƒ½ä¸ç®—å¤šï¼Œä½†æ¯ä¸ªéƒ½æŒºæœ‰é’ˆå¯¹æ€§çš„ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€ä¸ªä¸ªçœ‹ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€getTargetï¼šæ‹¿åˆ°åŸå§‹å¯¹è±¡</h2>
<p>è¿™ä¸ªåŠŸèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå½“ä½ æŠŠä¸€ä¸ªæ™®é€šå¯¹è±¡èµ‹å€¼ç»™ <code>@State</code> æˆ–è€… <code>@Local</code> è¿™æ ·çš„çŠ¶æ€å˜é‡æ—¶ï¼Œæ¡†æ¶ä¼šæŠŠå®ƒåŒ…è£…æˆä»£ç†å¯¹è±¡ã€‚æœ‰æ—¶å€™ä½ éœ€è¦æ‹¿åˆ°åŸå§‹å¯¹è±¡åšæ¯”è¾ƒï¼Œæˆ–è€…ä¼ ç»™æŸäº›ä¸æ¥å—ä»£ç†å¯¹è±¡çš„ APIï¼Œè¿™æ—¶å€™å°±éœ€è¦ <code>getTarget</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NonObservedClass</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">nonObservedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>();

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">someClass</span>: <span class="hljs-title class_">NonObservedClass</span> = nonObservedClass;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// ç›´æ¥æ¯”è¾ƒæ˜¯ falseï¼Œå› ä¸º this.someClass æ˜¯ä»£ç†å¯¹è±¡</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.someClass === nonObservedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.someClass === nonObservedClass}</span>`</span>) <span class="hljs-comment">// false</span>
      
      <span class="hljs-comment">// ç”¨ getTarget æ‹¿åˆ°åŸå§‹å¯¹è±¡ï¼Œå°±èƒ½æ¯”è¾ƒäº†</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.someClass) === nonObservedClass: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.someClass) ===
        nonObservedClass}</span>`</span>) <span class="hljs-comment">// true</span>
    }
  }
}
</code></pre>
<p>å®é™…å¼€å‘ä¸­ï¼Œè¿™ç§åœºæ™¯å…¶å®ä¸ç®—ç‰¹åˆ«å¸¸è§ï¼Œä½†é‡åˆ°çš„æ—¶å€™ç¡®å®èƒ½è§£å†³é—®é¢˜ã€‚æ¯”å¦‚ä½ è¦æŠŠçŠ¶æ€å¯¹è±¡åºåˆ—åŒ–ï¼Œæˆ–è€…ä¼ ç»™ç¬¬ä¸‰æ–¹åº“ï¼Œå¯èƒ½å°±éœ€è¦å…ˆæ‹¿åˆ°åŸå§‹å¯¹è±¡ã€‚</p>
<h3 data-id="heading-3">1ã€V2 çŠ¶æ€ç®¡ç†çš„é™åˆ¶</h3>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ V2 çŠ¶æ€ç®¡ç†ä¸­ï¼Œ<code>getTarget</code> æœ‰ä¸ªé™åˆ¶ã€‚çŠ¶æ€ç®¡ç† V2 è£…é¥°å™¨ä¼šä¸ºè£…é¥°çš„å˜é‡ç”Ÿæˆ getter å’Œ setter æ–¹æ³•ï¼ŒåŒæ—¶ä¸ºåŸæœ‰å˜é‡åæ·»åŠ  <code>__ob_</code> å‰ç¼€ã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œ<code>getTarget</code> æ¥å£ä¸ä¼šå¯¹ V2 è£…é¥°å™¨ç”Ÿæˆçš„å‰ç¼€è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å‘ <code>getTarget</code> ä¼ å…¥ <code>@ObservedV2</code> è£…é¥°çš„ç±»å¯¹è±¡å®ä¾‹ï¼Œè¿”å›çš„å¯¹è±¡ä¾æ—§ä¸ºå¯¹è±¡æœ¬èº«ï¼Œä¸”è¢« <code>@Trace</code> è£…é¥°çš„å±æ€§åä»æœ‰ <code>__ob_</code> å‰ç¼€ã€‚</p>
<p>è¿™ä¸ªå‰ç¼€ä¸å½±å“å¯¹è±¡å±æ€§çš„ getter å’Œ setter æ–¹æ³•ä½¿ç”¨ï¼Œä½†å¦‚æœä½ éœ€è¦åºåˆ—åŒ–ï¼Œå¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClassV2</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'é»˜è®¤åç§°'</span>;
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">FormDataClassPage</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">FormDataClassV2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClassV2</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'åºåˆ—åŒ–'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// åºåˆ—åŒ–åä¼šæœ‰ __ob_ å‰ç¼€</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'åºåˆ—åŒ–åŸå§‹å€¼ï¼š'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>));
          <span class="hljs-comment">// è¾“å‡ºç±»ä¼¼ï¼š{"__ob_name":"é»˜è®¤åç§°","__ob_price":0}</span>
        });
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>);
  }
}
</code></pre>
<h3 data-id="heading-4">2ã€è§£å†³æ–¹æ¡ˆ</h3>
<p>å¦‚æœæ¶‰åŠåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥å»é™¤å‰ç¼€ï¼š</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šåˆ›å»ºæ–°ç±»è½¬æ¢</strong></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç±»ä¸­å±æ€§åå’ŒåŸæ¥çš„å¯¹è±¡ç›¸åŒï¼Œç”¨åŸæ¥å¯¹è±¡çš„å€¼æ¥åˆå§‹åŒ–æ–°ç±»çš„å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClassV2</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'é»˜è®¤åç§°'</span>;
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">v: FormDataClassV2</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = v.<span class="hljs-property">name</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">price</span> = v.<span class="hljs-property">price</span>;
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">FormDataClassPage</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">FormDataClassV2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClassV2</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'åºåˆ—åŒ–'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'åºåˆ—åŒ–åŸå§‹å€¼ï¼š'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>));
          <span class="hljs-comment">// è½¬æ¢ååºåˆ—åŒ–ï¼Œæ²¡æœ‰å‰ç¼€</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'åºåˆ—åŒ–è½¬æ¢åï¼š'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)));
        });
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>);
  }
}
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒç¨³å¦¥ï¼Œç±»å‹å®‰å…¨ï¼Œä½†éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªç±»ã€‚</p>
<p><strong>æ–¹æ¡ˆäºŒï¼šå­—ç¬¦ä¸²æ›¿æ¢</strong></p>
<p>å¦‚æœåºåˆ—åŒ–å <code>__ob_</code> å‰ç¼€ä¼šå¯¼è‡´ååºåˆ—åŒ–å¼‚å¸¸ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¿®æ”¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œå»é™¤ <code>__ob_</code> å‰ç¼€ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClassV2</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'é»˜è®¤åç§°'</span>;
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">FormDataClassPage</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">FormDataClassV2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClassV2</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'åºåˆ—åŒ–'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'åºåˆ—åŒ–åŸå§‹å€¼ï¼š'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>));
          <span class="hljs-comment">// ç”¨æ­£åˆ™æ›¿æ¢å»é™¤å‰ç¼€</span>
          <span class="hljs-keyword">let</span> newData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/__ob_/g</span>, <span class="hljs-string">''</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'åºåˆ—åŒ–è¿‡æ»¤åï¼š'</span>, newData);
        });
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>);
  }
}
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆç®€å•ç›´æ¥ï¼Œä½†è¦æ³¨æ„å¦‚æœå±æ€§åæœ¬èº«åŒ…å« <code>__ob_</code> å­—ç¬¦ä¸²ï¼Œä¹Ÿä¼šè¢«æ›¿æ¢æ‰ã€‚æ‰€ä»¥å¦‚æœæ•°æ®æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®ç”¨æ–¹æ¡ˆä¸€ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>__ob_</code> å‰ç¼€æ˜¯ V2 çŠ¶æ€ç®¡ç†çš„å®ç°ç»†èŠ‚ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸å½±å“ä½¿ç”¨ã€‚åªæœ‰åœ¨åºåˆ—åŒ–åœºæ™¯ä¸‹æ‰éœ€è¦æ³¨æ„è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 data-id="heading-5">å››ã€makeObservedï¼šè®©æ™®é€šæ•°æ®å¯è§‚å¯Ÿ</h2>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨ V2 çš„çŠ¶æ€ç®¡ç†ä¸­æ¯”è¾ƒå¸¸ç”¨ã€‚æœ‰æ—¶å€™ä½ æ‹¿åˆ°çš„æ˜¯æ™®é€šå¯¹è±¡ï¼ˆæ¯”å¦‚ä» JSON.parse æ¥çš„ï¼Œæˆ–è€…æ™®é€š class å®ä¾‹ï¼‰ï¼Œä½†ä½ æƒ³è®©å®ƒå˜æˆå¯è§‚å¯Ÿçš„ï¼Œè¿™æ ·ä¿®æ”¹å±æ€§æ—¶ UI èƒ½è‡ªåŠ¨æ›´æ–°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NonObservedClass</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-comment">// ç”¨ makeObserved åŒ…è£…åï¼Œä¿®æ”¹ name ä¼šè§¦å‘ UI æ›´æ–°</span>
  <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>());
  
  <span class="hljs-comment">// æ™®é€šå¯¹è±¡ï¼Œä¿®æ”¹ä¸ä¼šè§¦å‘æ›´æ–°</span>
  <span class="hljs-attr">nonObservedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jane'</span>; <span class="hljs-comment">// ä¼šåˆ·æ–°</span>
        })
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`nonObservedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nonObservedClass.name}</span>`</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonObservedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jane'</span>; <span class="hljs-comment">// ä¸ä¼šåˆ·æ–°</span>
        })
    }
  }
}
</code></pre>
<p>æ³¨æ„ï¼Œ<code>makeObserved</code> æ”¯æŒçš„ç±»å‹è¿˜æŒºå¤šçš„ï¼šæ™®é€š classã€JSON.parse è¿”å›çš„å¯¹è±¡ã€Arrayã€Mapã€Setã€Dateï¼Œè¿˜æœ‰ collections é‡Œçš„ç±»å‹ã€‚ä½†å¦‚æœæ˜¯ <code>@Sendable</code> ä¿®é¥°çš„ classï¼Œå°±ä¸æ”¯æŒäº†ã€‚</p>
<h2 data-id="heading-6">äº”ã€V1 å’Œ V2 æ··ç”¨çš„é—®é¢˜</h2>
<p>HarmonyOS çš„çŠ¶æ€ç®¡ç†æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒV1 å’Œ V2ã€‚å¦‚æœä½ åœ¨ç»´æŠ¤è€é¡¹ç›®ï¼Œæˆ–è€…éœ€è¦é€æ­¥è¿ç§»ï¼Œå¯èƒ½ä¼šé‡åˆ°æ··ç”¨çš„æƒ…å†µã€‚è¿™æ—¶å€™æœ‰ä¸¤ä¸ªæ–¹æ³•èƒ½å¸®ä¸Šå¿™ã€‚è¿™ä¸ªå¦‚æœä¸æ˜¯å¤©å¤©åˆ·è¿™ä¸ªæ–‡æ¡£ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶ä¸€å®šæ²¡æœ‰æ³¨æ„åˆ°çš„ï¼Œå˜¿å˜¿</p>
<h3 data-id="heading-7">1ã€enableV2Compatibilityï¼šè®© V1 çŠ¶æ€åœ¨ V2 ç»„ä»¶ä¸­å¯è§‚å¯Ÿ</h3>
<p>å¦‚æœä½ åœ¨ <code>@Component</code>ï¼ˆV1ï¼‰é‡Œå®šä¹‰äº† <code>@State</code>ï¼Œç„¶åæƒ³ä¼ ç»™ <code>@ComponentV2</code>ï¼ˆV2ï¼‰ä½¿ç”¨ï¼Œç›´æ¥ç”¨æ˜¯ä¸è¡Œçš„ã€‚V2 ç»„ä»¶è§‚å¯Ÿä¸åˆ° V1 çŠ¶æ€çš„å˜åŒ–ã€‚</p>
<p>è¿™æ—¶å€™å¯ä»¥ç”¨ <code>enableV2Compatibility</code> åŒ…è£…ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Observed</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">CompV1</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'State'</span>; <span class="hljs-comment">// åˆ·æ–°</span>
        })
      <span class="hljs-comment">// åŒ…è£…åä¼ ç»™ V2 ç»„ä»¶ï¼ŒV2 å°±èƒ½è§‚å¯Ÿåˆ°ç¬¬ä¸€å±‚çš„å˜åŒ–äº†</span>
      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>) })
    }
  }
}

<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">CompV2</span> {
  <span class="hljs-meta">@Param</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Param'</span>; <span class="hljs-comment">// åˆ·æ–°</span>
      })
  }
}
</code></pre>
<p>æ³¨æ„ï¼ŒV2 åªèƒ½è§‚å¯Ÿåˆ°ç¬¬ä¸€å±‚çš„å˜åŒ–ã€‚å¦‚æœ <code>ObservedClass</code> å†…éƒ¨è¿˜æœ‰åµŒå¥—å¯¹è±¡ï¼Œä¿®æ”¹åµŒå¥—å¯¹è±¡çš„å±æ€§ï¼ŒV2 æ˜¯è§‚å¯Ÿä¸åˆ°çš„ã€‚</p>
<h3 data-id="heading-8">2ã€makeV1Observedï¼šåŒ…è£…æˆ V1 å¯è§‚å¯Ÿå¯¹è±¡</h3>
<p>è¿™ä¸ªåŠŸèƒ½å’Œ <code>makeObserved</code> ç±»ä¼¼ï¼Œä½†åŒ…è£…å‡ºæ¥çš„æ˜¯ V1 çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚ä¸»è¦ç”¨åœ¨éœ€è¦åˆå§‹åŒ– <code>@ObjectLink</code> çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
  <span class="hljs-attr">outerValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'outer'</span>;
  <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">inner: Inner</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span> = inner;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {
  <span class="hljs-attr">interValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'inner'</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-comment">// makeV1Observed çš„è¿”å›å€¼å¯ä»¥åˆå§‹åŒ– @ObjectLink</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">outer</span>: <span class="hljs-title class_">Outer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>()));

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">inner</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span> })
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.inner.interValue}</span>`</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">interValue</span> += <span class="hljs-string">'!'</span>;
      })
  }
}
</code></pre>
<p><code>makeV1Observed</code> ä¸æ”¯æŒ collections ç±»å‹å’Œ <code>@Sendable</code> ä¿®é¥°çš„ classï¼Œä¹Ÿä¸æ”¯æŒ V2 çš„æ•°æ®å’Œ <code>makeObserved</code> çš„è¿”å›å€¼ã€‚å¦‚æœä¼ äº†ä¸æ”¯æŒçš„å‚æ•°ï¼Œä¼šç›´æ¥è¿”å›åŸå¯¹è±¡ï¼Œä¸ä¼šæŠ¥é”™ã€‚</p>
<h2 data-id="heading-9">å…­ã€makeBindingï¼šåˆ›å»ºæ•°æ®ç»‘å®š</h2>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨å†™ <code>@Builder</code> å‡½æ•°æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚æœ‰æ—¶å€™ä½ æƒ³è®© <code>@Builder</code> æ¥æ”¶ä¸€ä¸ªå¯è¯»æˆ–å¯å†™çš„æ•°æ®ç»‘å®šï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å€¼ï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨ <code>makeBinding</code> åˆ›å»ºã€‚</p>
<h3 data-id="heading-10">1ã€åªè¯»ç»‘å®š</h3>
<p>å¦‚æœ <code>@Builder</code> çš„å‚æ•°ç±»å‹æ˜¯ <code>Binding&lt;T&gt;</code>ï¼Œä½ å¯ä»¥ç”¨ <code>makeBinding</code> åˆ›å»ºä¸€ä¸ªåªè¯»ç»‘å®šï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">CustomButton</span>(<span class="hljs-params">num1: Binding&lt;<span class="hljs-built_in">number</span>&gt;</span>) {
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Custom Button: <span class="hljs-subst">${num1.value}</span>`</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// num1.value += 1; ä¼šæŠ¥é”™ï¼ŒBinding ç±»å‹ä¸æ”¯æŒä¿®æ”¹</span>
      })
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">CompV2</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">number1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'parent component'</span>)
      <span class="hljs-comment">// æ¯æ¬¡è®¿é—® .value æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œ getter å‡½æ•°ï¼Œæ‹¿åˆ°æœ€æ–°å€¼</span>
      <span class="hljs-title class_">CustomButton</span>(
        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-property">makeBinding</span>&lt;<span class="hljs-built_in">number</span>&gt;(
          <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">number1</span> <span class="hljs-comment">// GetterCallback</span>
        )
      )
    }
  }
}
</code></pre>
<h3 data-id="heading-11">2ã€å¯å†™ç»‘å®š</h3>
<p>å¦‚æœéœ€è¦åŒå‘ç»‘å®šï¼Œå¯ä»¥ä¼ ä¸¤ä¸ªå‚æ•°ï¼šgetter å’Œ setterï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">CustomButton</span>(<span class="hljs-params">num2: MutableBinding&lt;<span class="hljs-built_in">number</span>&gt;</span>) {
  <span class="hljs-title class_">Row</span>() {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Custom Button: <span class="hljs-subst">${num2.value}</span>`</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// MutableBinding æ”¯æŒä¿®æ”¹</span>
        num2.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>;
      })
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">CompV2</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">number2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'parent component'</span>)
      <span class="hljs-title class_">CustomButton</span>(
        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-property">makeBinding</span>&lt;<span class="hljs-built_in">number</span>&gt;(
          <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">number2</span>, <span class="hljs-comment">// GetterCallback</span>
          <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">number2</span> = val; <span class="hljs-comment">// SetterCallbackï¼Œä¿®æ”¹æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨</span>
          }
        )
      )
    }
  }
}
</code></pre>
<p>æ³¨æ„ï¼Œå¦‚æœåˆ›å»º <code>MutableBinding</code> æ—¶æ²¡ä¼  setterï¼Œä¿®æ”¹ <code>.value</code> ä¼šæŠ¥è¿è¡Œæ—¶é”™è¯¯ã€‚æ‰€ä»¥éœ€è¦åŒå‘ç»‘å®šæ—¶ï¼Œsetter æ˜¯å¿…é¡»çš„ã€‚</p>
<h2 data-id="heading-12">ä¸ƒã€addMonitor å’Œ clearMonitorï¼šåŠ¨æ€ç›‘å¬</h2>
<p>åœ¨ V2 çš„çŠ¶æ€ç®¡ç†ä¸­ï¼Œä½ å¯ä»¥ç”¨ <code>@Monitor</code> è£…é¥°å™¨ç›‘å¬çŠ¶æ€å˜åŒ–ã€‚ä½†æœ‰æ—¶å€™ä½ éœ€è¦åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤ç›‘å¬ï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨ <code>addMonitor</code> å’Œ <code>clearMonitor</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;

  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {
    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ObservedClass property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);
    });
  }

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åœ¨æ„é€ æ–¹æ³•é‡Œæ·»åŠ ç›‘å¬ï¼ŒisSynchronous: true è¡¨ç¤ºåŒæ­¥å›è°ƒ</span>
    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'name'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>, { <span class="hljs-attr">isSynchronous</span>: <span class="hljs-literal">true</span> });
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jane'</span>;
        })
    }
  }
}
</code></pre>
<p><code>addMonitor</code> åªæ”¯æŒ <code>@ComponentV2</code> å’Œ <code>@ObservedV2</code> å®ä¾‹ï¼Œå¦‚æœä¼ äº†ä¸æ”¯æŒçš„ç±»å‹ä¼šæŠ›è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p>åˆ é™¤ç›‘å¬ç”¨ <code>clearMonitor</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear monitor'</span>)
  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// åˆ é™¤æŒ‡å®šè·¯å¾„çš„æŒ‡å®šç›‘å¬å‡½æ•°</span>
    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">onChange</span>);
    
    <span class="hljs-comment">// å¦‚æœä¸ä¼  monitorCallbackï¼Œä¼šåˆ é™¤è¯¥è·¯å¾„çš„æ‰€æœ‰ç›‘å¬å‡½æ•°</span>
    <span class="hljs-comment">// UIUtils.clearMonitor(this.observedClass, 'age');</span>
  })
</code></pre>
<h2 data-id="heading-13">å…«ã€åŒæ­¥åˆ·æ–°ï¼šapplySyncã€flushUpdatesã€flushUIUpdates</h2>
<p>è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥åŒæ­¥åˆ·æ–°çŠ¶æ€å˜åŒ–çš„ï¼Œä½†ä½œç”¨èŒƒå›´ä¸åŒã€‚</p>
<h3 data-id="heading-14">1ã€applySyncï¼šåˆ·æ–°é—­åŒ…å†…çš„ä¿®æ”¹</h3>
<p><code>applySync</code> æ¥æ”¶ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œåªåˆ·æ–°é—­åŒ…å†…çš„çŠ¶æ€ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Button</span>(<span class="hljs-string">'change size'</span>)
  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// é—­åŒ…å†…çš„ä¿®æ”¹ä¼šåŒæ­¥æ‰§è¡Œï¼ŒåŒ…æ‹¬æ›´æ–° @Computedã€@Monitor å›è°ƒå’Œé‡æ–°æ¸²æŸ“ UI</span>
    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">applySync</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">100</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">100</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello World'</span>;
    });
    
    <span class="hljs-comment">// åŠ¨ç”»ä»åˆ·æ–°åçš„çŠ¶æ€å¼€å§‹</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({
      <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>
    }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello ArkUI'</span>;
    });
  })
</code></pre>
<h3 data-id="heading-15">2ã€flushUpdatesï¼šåˆ·æ–°æ‰€æœ‰ä¹‹å‰çš„ä¿®æ”¹</h3>
<p><code>flushUpdates</code> ä¼šåŒæ­¥åˆ·æ–°è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„çŠ¶æ€ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Button</span>(<span class="hljs-string">'change size'</span>)
  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello World'</span>;
    
    <span class="hljs-comment">// åˆ·æ–°ä¹‹å‰æ‰€æœ‰çš„ä¿®æ”¹</span>
    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">flushUpdates</span>();
    
    <span class="hljs-comment">// åŠ¨ç”»ä»åˆ·æ–°åçš„çŠ¶æ€å¼€å§‹</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({
      <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>
    }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello ArkUI'</span>;
    });
  })
</code></pre>
<h3 data-id="heading-16">3ã€flushUIUpdatesï¼šåªåˆ·æ–° UIï¼Œä¸æ‰§è¡Œè®¡ç®—å’Œå›è°ƒ</h3>
<p><code>flushUIUpdates</code> åªåŒæ­¥æ ‡è„ UI èŠ‚ç‚¹ï¼Œä¸ä¼šæ‰§è¡Œ <code>@Computed</code> è®¡ç®—å’Œ <code>@Monitor</code> å›è°ƒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Button</span>(<span class="hljs-string">'change size'</span>)
  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello World'</span>;
    
    <span class="hljs-comment">// åªåˆ·æ–° UIï¼Œä¸æ‰§è¡Œè®¡ç®—å’Œå›è°ƒ</span>
    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">flushUIUpdates</span>();
    
    <span class="hljs-comment">// åŠ¨ç”»ä»åˆ·æ–°åçš„çŠ¶æ€å¼€å§‹</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({
      <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>
    }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">200</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello ArkUI'</span>;
    });
  })
</code></pre>
<p>è¿™ä¸‰ä¸ªæ–¹æ³•åœ¨åŠ¨ç”»åœºæ™¯ä¸‹æ¯”è¾ƒæœ‰ç”¨ã€‚æ¯”å¦‚ä½ æƒ³åœ¨åŠ¨ç”»å¼€å§‹å‰ç¡®ä¿ UI å·²ç»æ›´æ–°åˆ°æŸä¸ªçŠ¶æ€ï¼Œå°±å¯ä»¥ç”¨å®ƒä»¬ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½ä¸èƒ½åœ¨ <code>@Computed</code> é‡Œè°ƒç”¨ï¼Œ<code>flushUpdates</code> å’Œ <code>flushUIUpdates</code> ä¹Ÿä¸èƒ½åœ¨ <code>@Monitor</code> å›è°ƒé‡Œè°ƒç”¨ã€‚</p>
<h2 data-id="heading-17">ä¹ã€æ€»ç»“</h2>
<p><code>UIUtils</code> æä¾›çš„åŠŸèƒ½çœ‹ç€ä¸å¤šï¼Œä½†æ¯ä¸ªéƒ½æŒºå®ç”¨çš„ï¼ˆéå¸¸å®ç”¨äº†ï¼Œå±äºæ˜¯ï¼‰ã€‚ä¸»è¦è§£å†³è¿™äº›åœºæ™¯ï¼š</p>
<ol>
<li><strong>ä»£ç†å¯¹è±¡é—®é¢˜</strong>ï¼šç”¨ <code>getTarget</code> æ‹¿åˆ°åŸå§‹å¯¹è±¡</li>
<li><strong>æ™®é€šæ•°æ®å˜å¯è§‚å¯Ÿ</strong>ï¼šç”¨ <code>makeObserved</code> æˆ– <code>makeV1Observed</code></li>
<li><strong>V1/V2 æ··ç”¨</strong>ï¼šç”¨ <code>enableV2Compatibility</code> è®© V1 çŠ¶æ€åœ¨ V2 ä¸­å¯è§‚å¯Ÿ</li>
<li><strong>æ•°æ®ç»‘å®š</strong>ï¼šç”¨ <code>makeBinding</code> åˆ›å»º <code>Binding</code> æˆ– <code>MutableBinding</code></li>
<li><strong>åŠ¨æ€ç›‘å¬</strong>ï¼šç”¨ <code>addMonitor</code> å’Œ <code>clearMonitor</code> ç®¡ç†ç›‘å¬</li>
<li><strong>åŒæ­¥åˆ·æ–°</strong>ï¼šç”¨ <code>applySync</code>ã€<code>flushUpdates</code>ã€<code>flushUIUpdates</code> æ§åˆ¶åˆ·æ–°æ—¶æœº</li>
</ol>
<p>é‡åˆ°çŠ¶æ€ç®¡ç†çš„è¾¹ç•Œé—®é¢˜æ—¶ï¼Œç¡®å®èƒ½å¸®ä¸Šå¿™ã€‚å»ºè®®å…ˆäº†è§£è¿™äº›åŠŸèƒ½çš„å­˜åœ¨ï¼Œéœ€è¦çš„æ—¶å€™å†æŸ¥æ–‡æ¡£ã€‚ç”¨æ—¶ä¸æ…Œ~~~</p>
<h2 data-id="heading-18">åã€æœ€å</h2>
<p>å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®ã€å¯¹æ–‡ç« å†™çš„ä¸æ»¡æ„ã€å‘ç°é”™è¯¯ã€æƒ³åæ§½æˆ–è€…æœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œ<strong>æ¬¢è¿åœ¨è¯„è®ºã€ç§ä¿¡æˆ–é‚®ä»¶ä¸­æå‡º</strong>ï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„æ”¯æŒã€‚ğŸ™</p>
<p>è°¢è°¢è¯»è€…å§¥çˆ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•ä¸€æ¬¡æ€§ç”Ÿæˆ 60 ç§è¯­æ°”è¡¨è¾¾ï¼ŸRWKV æ¨¡å‹å‘Šè¯‰ä½ ç­”æ¡ˆ â—â—â—]]></title>    <link>https://juejin.cn/post/7594817135128051746</link>    <guid>https://juejin.cn/post/7594817135128051746</guid>    <pubDate>2026-01-14T07:00:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128051746" data-draft-id="7594785614177304616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•ä¸€æ¬¡æ€§ç”Ÿæˆ 60 ç§è¯­æ°”è¡¨è¾¾ï¼ŸRWKV æ¨¡å‹å‘Šè¯‰ä½ ç­”æ¡ˆ â—â—â—"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,AIGC"/> <meta itemprop="datePublished" content="2026-01-14T07:00:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•ä¸€æ¬¡æ€§ç”Ÿæˆ 60 ç§è¯­æ°”è¡¨è¾¾ï¼ŸRWKV æ¨¡å‹å‘Šè¯‰ä½ ç­”æ¡ˆ â—â—â—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:00:25.000Z" title="Wed Jan 14 2026 07:00:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>åœ¨æ—¥å¸¸æ²Ÿé€šä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ ¹æ®ä¸åŒçš„å¯¹è±¡å’Œåœºæ™¯è°ƒæ•´è¯­æ°”ã€‚å‘è€æ¿æ±‡æŠ¥å·¥ä½œæ—¶éœ€è¦æ­£å¼ä¸¥è°¨ï¼Œå’ŒåŒäº‹äº¤æµæ—¶å¯ä»¥è½»æ¾éšæ„ï¼Œå†™æ–‡æ¡ˆæ—¶åˆéœ€è¦ç¬¦åˆå“ç‰Œè°ƒæ€§ã€‚æ‰‹åŠ¨è°ƒæ•´è¿™äº›è¯­æ°”ä¸ä»…è€—æ—¶ï¼Œè¿˜å®¹æ˜“è¯ç©·ã€‚ç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¿«é€Ÿäº§å‡ºå¤šç§é£æ ¼æ–‡æ¡ˆçš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ç¤¾äº¤åª’ä½“è¿è¥éœ€è¦åŒæ—¶å‡†å¤‡æ­£å¼ç‰ˆã€å¹½é»˜ç‰ˆã€æƒ…æ„Ÿç‰ˆç­‰å¤šä¸ªç‰ˆæœ¬ï¼Œä¼ ç»Ÿçš„é€ä¸ªæ”¹å†™æ–¹å¼æ•ˆç‡æä½ã€‚</p>
<p>åŸºäºè¿™æ ·çš„ç—›ç‚¹ï¼Œæˆ‘å¼€å‘äº†è¿™ä¸ª <code>RWKV</code> å¹¶è¡Œè¯­æ°”è½¬æ¢å·¥å…·ã€‚å®ƒèƒ½å¤Ÿæ¥æ”¶ä¸€æ®µæ–‡æœ¬ï¼Œé€šè¿‡ <code>RWKV</code> å¤§è¯­è¨€æ¨¡å‹ï¼Œä¸€æ¬¡æ€§å¹¶è¡Œç”Ÿæˆ 60 å¤šç§ä¸åŒè¯­æ°”å’Œé£æ ¼çš„è¡¨è¾¾æ–¹å¼ï¼Œæ¶µç›–èŒåœºã€ç”Ÿæ´»ã€æ–¹è¨€ã€æ–‡å­¦ã€ç½‘ç»œç­‰å¤šä¸ªç»´åº¦ï¼Œæå¤§æå‡äº†å†…å®¹åˆ›ä½œå’Œæ²Ÿé€šè¡¨è¾¾çš„æ•ˆç‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6a3743e30bf49e2b9273a1b53c01f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978865&amp;x-signature=CafJrmaQclDNmT0a5nycSAILwa4%3D" alt="é¡¹ç›®æ•ˆæœå›¾" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå·¥å…·çš„ç•Œé¢ç®€æ´ç›´è§‚ã€‚ç”¨æˆ·åªéœ€åœ¨åº•éƒ¨è¾“å…¥æ¡†ä¸­è¾“å…¥åŸå§‹æ–‡æœ¬ï¼Œç‚¹å‡»å‘é€æŒ‰é’®ï¼Œç³»ç»Ÿå°±ä¼šåŒæ—¶ç”Ÿæˆå¤šç§è¯­æ°”ç‰ˆæœ¬ã€‚æ¯ä¸ªå¡ç‰‡ä»£è¡¨ä¸€ç§é£æ ¼ï¼ŒåŒ…å«é£æ ¼å›¾æ ‡ã€åç§°å’Œè½¬æ¢åçš„å†…å®¹ã€‚æ‰€æœ‰ç»“æœå®æ—¶æµå¼è¿”å›ï¼Œç”¨æˆ·å¯ä»¥ç«‹å³çœ‹åˆ°ç”Ÿæˆè¿›åº¦ï¼Œå¹¶ä¸”æ¯ä¸ªç»“æœéƒ½æ”¯æŒä¸€é”®å¤åˆ¶ï¼Œæ–¹ä¾¿å¿«é€Ÿä½¿ç”¨ã€‚</p>
<h2 data-id="heading-0">æ ¸å¿ƒç‰¹æ€§ä¸æŠ€æœ¯å®ç°</h2>
<p>è¿™ä¸ªé¡¹ç›®æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¹¶è¡Œç”Ÿæˆèƒ½åŠ›ã€‚ä¼ ç»Ÿçš„è¯­æ°”è½¬æ¢å·¥å…·é€šå¸¸æ˜¯ä¸²è¡Œå¤„ç†ï¼Œå³é€ä¸ªé£æ ¼ä¾æ¬¡ç”Ÿæˆï¼Œè¿™æ ·ä¼šå¯¼è‡´ç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚è€Œæœ¬å·¥å…·é€šè¿‡åœ¨åç«¯åŒæ—¶å¤„ç†å¤šä¸ªè½¬æ¢è¯·æ±‚ï¼Œå‰ç«¯é‡‡ç”¨æµå¼æ¸²æŸ“æŠ€æœ¯ï¼Œå®æ—¶å±•ç¤ºæ¯ä¸ªé£æ ¼çš„ç”Ÿæˆè¿›åº¦ï¼Œæ•´ä½“å“åº”é€Ÿåº¦å¤§å¹…æå‡ã€‚</p>
<p>åœ¨å‰ç«¯æŠ€æœ¯é€‰å‹ä¸Šï¼Œé¡¹ç›®é‡‡ç”¨äº† <code>React 19</code> ä½œä¸º UI æ¡†æ¶ï¼Œé…åˆ <code>Rsbuild</code> ä½œä¸ºæ„å»ºå·¥å…·ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ <code>Webpack</code> æˆ– <code>Vite</code>ï¼Œ<code>Rsbuild</code> æä¾›äº†æ›´å¿«çš„æ„å»ºé€Ÿåº¦å’Œæ›´ç®€æ´çš„é…ç½®ä½“éªŒã€‚æ ·å¼å±‚é¢ä½¿ç”¨äº† <code>Tailwind CSS 4</code>ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¸å˜è‰²å½©å’Œæµç•…çš„åŠ¨ç”»æ•ˆæœï¼Œæ‰“é€ å‡ºç°ä»£åŒ–çš„è§†è§‰ä½“éªŒã€‚æ•´ä¸ªç•Œé¢é‡‡ç”¨æµ…è‰²ä¸»é¢˜ï¼ŒæŸ”å’Œçš„ç´«ç²‰æ¸å˜èƒŒæ™¯é…åˆç»ç’ƒæ€æ•ˆæœï¼Œæ—¢ç¾è§‚åˆä¸å½±å“å†…å®¹çš„é˜…è¯»ã€‚</p>
<p>é¡¹ç›®å®Œæ•´çš„æŠ€æœ¯æ ˆåŒ…æ‹¬ï¼š<code>React 19</code> æä¾›å¼ºå¤§çš„ UI æ¸²æŸ“èƒ½åŠ›ï¼Œ<code>TypeScript</code> ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œ<code>Rsbuild</code> è´Ÿè´£å¿«é€Ÿæ„å»ºï¼Œ<code>Tailwind CSS 4</code> å¤„ç†æ ·å¼ï¼Œ<code>Lucide React</code> æä¾›å›¾æ ‡æ”¯æŒï¼Œ<code>Class Variance Authority</code> ç®¡ç†ç»„ä»¶å˜ä½“ã€‚è¿™å¥—ç»„åˆæ—¢ä¿è¯äº†å¼€å‘æ•ˆç‡ï¼Œä¹Ÿç¡®ä¿äº†è¿è¡Œæ—¶æ€§èƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d63a7289635e4a9bb14d27e662e086c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978865&amp;x-signature=gR%2BDqDeqLVIoNDDL7GMODkSmySI%3D" alt="æ¥å£è¯·æ±‚å‚æ•°" loading="lazy"/></p>
<p>ä»æ¥å£è¯·æ±‚å‚æ•°å¯ä»¥çœ‹åˆ°ï¼Œåç«¯æ¥æ”¶çš„æ ¸å¿ƒæ•°æ®ç»“æ„ç›¸å¯¹ç®€å•ã€‚<code>contents</code> å­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰éœ€è¦è½¬æ¢çš„ <code>prompt</code> å†…å®¹ã€‚æ¯ä¸ª <code>prompt</code> éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æŒ‡ä»¤ï¼ŒåŒ…å«äº†é£æ ¼è¦æ±‚å’Œç”¨æˆ·è¾“å…¥çš„åŸå§‹æ–‡æœ¬ã€‚ç³»ç»Ÿä¼šæ ¹æ®è¿™äº› <code>prompt</code> å¹¶è¡Œè°ƒç”¨ <code>RWKV</code> æ¨¡å‹è¿›è¡Œç”Ÿæˆï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šç§å‚æ•°è°ƒä¼˜ï¼Œæ¯”å¦‚ <code>temperature</code>ã€<code>top_k</code>ã€<code>top_p</code> ç­‰ï¼Œä»¥è·å¾—æ›´å¥½çš„ç”Ÿæˆæ•ˆæœã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09552fa188414480a1b125c4bffd75c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768978865&amp;x-signature=Rx1Xul8MFNxryXvxAHcnO6bDaeQ%3D" alt="æ¥å£å“åº”æ•°æ®" loading="lazy"/></p>
<p>å“åº”æ•°æ®é‡‡ç”¨äº† <code>Server-Sent Events</code>ï¼ˆ<code>SSE</code>ï¼‰çš„æµå¼ä¼ è¾“æ–¹å¼ã€‚æ¯ä¸ªæ•°æ®å—éƒ½æ˜¯ä¸€ä¸ª <code>JSON</code> å¯¹è±¡ï¼ŒåŒ…å«äº† <code>choices</code> æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ª <code>choice</code> å¯¹åº”ä¸€ä¸ªé£æ ¼çš„ç”Ÿæˆç»“æœã€‚é€šè¿‡ <code>index</code> å­—æ®µæ ‡è¯†å…·ä½“æ˜¯å“ªä¸ªé£æ ¼ï¼Œ<code>delta</code> ä¸­çš„ <code>content</code> å­—æ®µåˆ™åŒ…å«äº†æœ¬æ¬¡æ¨é€çš„æ–‡æœ¬ç‰‡æ®µã€‚å‰ç«¯æ¥æ”¶åˆ°è¿™äº›æ•°æ®åï¼Œä¼šå®æ—¶æ›´æ–°å¯¹åº”å¡ç‰‡çš„å†…å®¹ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°æ–‡å­—é€å­—ç”Ÿæˆçš„æ•ˆæœï¼Œä½“éªŒéå¸¸æµç•…ã€‚</p>
<h2 data-id="heading-1">å¹¶å‘ç”Ÿæˆçš„æ ¸å¿ƒå®ç°</h2>
<p>æ•´ä¸ªé¡¹ç›®çš„ç²¾é«“åœ¨äºå¦‚ä½•å®ç°çœŸæ­£çš„å¹¶å‘ç”Ÿæˆã€‚å…ˆçœ‹ç”Ÿæˆ <code>contents</code> æ•°ç»„çš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateStyleContents</span>(<span class="hljs-params">userInput: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>[] {
  <span class="hljs-keyword">const</span> configs = <span class="hljs-title function_">getMergedStyleConfigs</span>();
  <span class="hljs-keyword">return</span> configs.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">prompt</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"${{input}}"</span>)) {
      <span class="hljs-keyword">return</span> config.<span class="hljs-property">prompt</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\$\{\{input\}\}/g</span>, userInput);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${config.prompt}</span>\n\nUser: <span class="hljs-subst">${userInput}</span>\n\nAssistant: &lt;think&gt;\n&lt;/think&gt;`</span>;
  });
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼šéå†æ‰€æœ‰é£æ ¼é…ç½®ï¼Œå°†æ¯ä¸ªé£æ ¼çš„ <code>prompt</code> æ¨¡æ¿ä¸­çš„ <code>${{input}}</code> å ä½ç¬¦æ›¿æ¢ä¸ºç”¨æˆ·çš„çœŸå®è¾“å…¥ã€‚<code>generateStyleContents</code> å‡½æ•°ä¼šè°ƒç”¨ <code>getMergedStyleConfigs()</code> è·å–æ‰€æœ‰é£æ ¼é…ç½®ã€‚å‡è®¾ç”¨æˆ·è¾“å…¥"æ˜å¤©è¦å¼€ä¼š"ï¼Œç»è¿‡è¿™ä¸ªå‡½æ•°å¤„ç†åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåŒ…å« 60 ä¸ªå®Œæ•´ <code>prompt</code> çš„æ•°ç»„ã€‚æ¯ä¸ª <code>prompt</code> éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒåŒ…å«äº†è¯¥é£æ ¼çš„è¦æ±‚æè¿°ã€çº¦æŸæ¡ä»¶ï¼Œä»¥åŠç”¨æˆ·è¾“å…¥ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ•°ç»„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å‘é€è¯·æ±‚äº†ã€‚å…³é”®åœ¨äºï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ª <code>contents</code> æ•°ç»„ä¸€æ¬¡æ€§å‘é€ç»™åç«¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(config.<span class="hljs-property">apiUrl</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-title class_">Accept</span>: <span class="hljs-string">"*/*"</span>,
    <span class="hljs-string">"Accept-Language"</span>: <span class="hljs-string">"zh-CN,zh;q=0.9"</span>,
  },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
    contents, <span class="hljs-comment">// è¿™é‡Œæ˜¯ 60 ä¸ª prompt çš„æ•°ç»„</span>
    <span class="hljs-attr">max_tokens</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.95</span>,
    <span class="hljs-attr">top_k</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">top_p</span>: <span class="hljs-number">0.9</span>,
    <span class="hljs-attr">pad_zero</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">alpha_presence</span>: <span class="hljs-number">1.0</span>,
    <span class="hljs-attr">alpha_frequency</span>: <span class="hljs-number">1.0</span>,
    <span class="hljs-attr">alpha_decay</span>: <span class="hljs-number">0.996</span>,
    <span class="hljs-attr">chunk_size</span>: <span class="hljs-number">128</span>,
    <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">password</span>: config.<span class="hljs-property">password</span>,
  }),
  signal,
});
</code></pre>
<p>æ³¨æ„çœ‹è¯·æ±‚ä½“ä¸­çš„ <code>contents</code> å­—æ®µï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆšæ‰é€šè¿‡ <code>generateStyleContents</code> å‡½æ•°ç”Ÿæˆçš„ 60 ä¸ª <code>prompt</code>ã€‚åç«¯æ”¶åˆ°è¿™ä¸ªæ•°ç»„åï¼Œä¼šåŒæ—¶å¯åŠ¨ 60 ä¸ªç”Ÿæˆä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å¯¹åº”æ•°ç»„ä¸­çš„ä¸€ä¸ª <code>prompt</code>ã€‚æ•°ç»„çš„ç´¢å¼•ä½ç½®ï¼ˆ0, 1, 2, ..., 59ï¼‰å°±æ˜¯æ¯ä¸ªä»»åŠ¡çš„ IDï¼Œè¿™ä¸ª ID ä¼šåœ¨è¿”å›çš„ <code>index</code> å­—æ®µä¸­ä½“ç°ã€‚</p>
<h2 data-id="heading-2">æµå¼å“åº”çš„è§£ææœºåˆ¶</h2>
<p>åç«¯é‡‡ç”¨ <code>Server-Sent Events</code>ï¼ˆ<code>SSE</code>ï¼‰æ ¼å¼è¿”å›æµå¼æ•°æ®ã€‚æ¯ä¸ªæ•°æ®å—çš„æ ¼å¼å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-css" lang="css">data: {"<span class="hljs-selector-tag">object</span>":<span class="hljs-string">"chat.completion.chunk"</span>,<span class="hljs-string">"choices"</span>:[{"index":<span class="hljs-number">12</span>,<span class="hljs-string">"delta"</span>:{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"æ˜"</span>}},{"index":<span class="hljs-number">23</span>,<span class="hljs-string">"delta"</span>:{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"ä»Š"</span>}},{"index":<span class="hljs-number">5</span>,<span class="hljs-string">"delta"</span>:{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"å"</span>}}]}

data: {"<span class="hljs-selector-tag">object</span>":<span class="hljs-string">"chat.completion.chunk"</span>,<span class="hljs-string">"choices"</span>:[{"index":<span class="hljs-number">12</span>,<span class="hljs-string">"delta"</span>:{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"å¤©"</span>}},{"index":<span class="hljs-number">23</span>,<span class="hljs-string">"delta"</span>:{"<span class="hljs-attribute">content</span>":<span class="hljs-string">"å¤©"</span>}}]}

data: [DONE]
</code></pre>
<p>çœ‹åˆ°äº†å—ï¼Ÿæ¯ä¸ª <code>choice</code> å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>index</code> å­—æ®µã€‚è¿™ä¸ª <code>index</code> å°±æ˜¯å¯¹åº” <code>contents</code> æ•°ç»„ä¸­çš„ä½ç½®ã€‚æ¯”å¦‚ <code>index</code> ä¸º 12 çš„ <code>choice</code>ï¼Œå¯¹åº”çš„å°±æ˜¯ <code>contents[12]</code> è¿™ä¸ª <code>prompt</code> çš„ç”Ÿæˆç»“æœã€‚å‰ç«¯æ­£æ˜¯é è¿™ä¸ª <code>index</code>ï¼ŒçŸ¥é“æŠŠè¿”å›çš„æ–‡æœ¬ç‰‡æ®µæ›´æ–°åˆ°å“ªä¸ªé£æ ¼å¡ç‰‡ä¸Šã€‚</p>
<p>è§£ææµå¼æ•°æ®çš„ä»£ç ä½¿ç”¨äº† <code>fetch</code> API çš„æµå¼è¯»å–èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>?.<span class="hljs-title function_">getReader</span>();
<span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
<span class="hljs-keyword">let</span> buffer = <span class="hljs-string">""</span>;

<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();

  <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

  buffer += decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> });
  <span class="hljs-keyword">const</span> lines = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">"\n"</span>);
  buffer = lines.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">""</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
    <span class="hljs-keyword">const</span> trimmedLine = line.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">if</span> (!trimmedLine || !trimmedLine.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"data: "</span>)) <span class="hljs-keyword">continue</span>;

    <span class="hljs-keyword">const</span> data = trimmedLine.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>);
    <span class="hljs-keyword">if</span> (data === <span class="hljs-string">"[DONE]"</span>) {
      <span class="hljs-comment">// æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
      <span class="hljs-keyword">const</span> completedResults = initialResults.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> ({
        ...result,
        <span class="hljs-attr">isComplete</span>: <span class="hljs-literal">true</span>,
      }));
      <span class="hljs-title function_">onUpdate</span>(completedResults);
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
      <span class="hljs-keyword">if</span> (json.<span class="hljs-property">choices</span> &amp;&amp; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(json.<span class="hljs-property">choices</span>)) {
        json.<span class="hljs-property">choices</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">choice: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> index = choice.<span class="hljs-property">index</span>;
          <span class="hljs-keyword">const</span> deltaContent = choice.<span class="hljs-property">delta</span>?.<span class="hljs-property">content</span> || <span class="hljs-string">""</span>;
          <span class="hljs-keyword">if</span> (deltaContent &amp;&amp; initialResults[index]) {
            <span class="hljs-comment">// æ ¹æ® index æ‰¾åˆ°å¯¹åº”çš„ç»“æœå¯¹è±¡ï¼Œè¿½åŠ æ–‡æœ¬ç‰‡æ®µ</span>
            initialResults[index].<span class="hljs-property">content</span> += deltaContent;
          }
        });
        <span class="hljs-title function_">onUpdate</span>([...initialResults]);
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"è§£æ JSON å¤±è´¥:"</span>, e);
    }
  }
}
</code></pre>
<p>è¿™æ®µä»£ç çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>TextDecoder</code> é€å—è§£ç äºŒè¿›åˆ¶æµï¼Œé€šè¿‡ <code>response.body?.getReader()</code> è·å–æµè¯»å–å™¨</li>
<li>æŒ‰è¡Œåˆ†å‰²æ•°æ®ï¼Œå› ä¸ºæ¯è¡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ <code>SSE</code> æ¶ˆæ¯</li>
<li>æå– <code>"data: "</code> åé¢çš„ <code>JSON</code> æ•°æ®</li>
<li>è§£æå‡º <code>choices</code> æ•°ç»„ï¼Œéå†æ¯ä¸ª <code>choice</code></li>
<li>é€šè¿‡ <code>choice.index</code> æ‰¾åˆ°å¯¹åº”çš„ç»“æœå¯¹è±¡ï¼Œå°† <code>choice.delta.content</code> è¿½åŠ ä¸Šå»</li>
<li>è°ƒç”¨ <code>onUpdate</code> è§¦å‘ç•Œé¢æ›´æ–°</li>
</ol>
<p>è¿™ç§å¢é‡æ›´æ–°çš„æ–¹å¼éå¸¸é«˜æ•ˆã€‚ä¸åŒé£æ ¼çš„ç”Ÿæˆé€Ÿåº¦å¯èƒ½ä¸ä¸€æ ·ï¼Œæœ‰çš„å¿«æœ‰çš„æ…¢ï¼Œä½†æ¯ä¸ªé£æ ¼çš„æ›´æ–°æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œäº’ä¸å¹²æ‰°ã€‚ç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°æ¯ä¸ªå¡ç‰‡çš„å†…å®¹é€å­—å¢åŠ ï¼Œä½“éªŒéå¸¸æµç•…ã€‚</p>
<h2 data-id="heading-3">ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼èƒ½å®ç°çœŸå¹¶å‘</h2>
<p>ä¼ ç»Ÿçš„åšæ³•æ˜¯å¾ªç¯è°ƒç”¨ <code>API</code>ï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ç§é£æ ¼ï¼Œç­‰è¿™ä¸ªé£æ ¼ç”Ÿæˆå®Œäº†å†ç”Ÿæˆä¸‹ä¸€ä¸ªã€‚å¦‚æœæœ‰ 60 ç§é£æ ¼ï¼Œæ¯ä¸ªé£æ ¼å¹³å‡ç”Ÿæˆ 2 ç§’ï¼Œé‚£æ€»å…±éœ€è¦ 120 ç§’ã€‚è¿™ç§ä¸²è¡Œçš„æ–¹å¼æ•ˆç‡æä½ã€‚</p>
<p>è€Œæˆ‘ä»¬è¿™ç§æ–¹å¼ï¼Œæ˜¯æŠŠ 60 ä¸ª <code>prompt</code> æ‰“åŒ…æˆä¸€ä¸ªæ•°ç»„ï¼Œä¸€æ¬¡æ€§å‘é€ç»™åç«¯ã€‚åç«¯æ”¶åˆ°åï¼Œä¼šå¹¶å‘åœ°å¤„ç†è¿™ 60 ä¸ªä»»åŠ¡ã€‚è™½ç„¶æ¯ä¸ªä»»åŠ¡è¿˜æ˜¯éœ€è¦ 2 ç§’ï¼Œä½†å› ä¸ºæ˜¯å¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥æ€»è€—æ—¶åªæœ‰ 2 ç§’å¤šä¸€ç‚¹ï¼ˆåŠ ä¸Šä¸€äº›ç½‘ç»œå»¶è¿Ÿå’Œä»»åŠ¡è°ƒåº¦å¼€é”€ï¼‰ã€‚</p>
<p>å…³é”®ç‚¹åœ¨äºï¼š</p>
<ul>
<li><code>contents</code> æ•°ç»„çš„é•¿åº¦å†³å®šäº†å¹¶å‘æ•°é‡</li>
<li>åç«¯é€šè¿‡ <code>index</code> æ ‡è¯†æ¯ä¸ªä»»åŠ¡çš„ç»“æœ</li>
<li>å‰ç«¯é€šè¿‡ <code>index</code> å°†ç»“æœç²¾ç¡®åœ°æ›´æ–°åˆ°å¯¹åº”ä½ç½®</li>
</ul>
<p>è¿™æ ·å°±å®ç°äº†çœŸæ­£çš„å¹¶è¡Œç”Ÿæˆï¼Œæ•ˆç‡æå‡äº†å‡ åå€ã€‚</p>
<h2 data-id="heading-4">éƒ¨ç½²å’Œä½¿ç”¨</h2>
<p>é¡¹ç›®çš„éƒ¨ç½²å¾ˆç®€å•ã€‚å¦‚æœä½ ç†Ÿæ‚‰ <code>Node.js</code>ï¼Œç›´æ¥ <code>npm install</code> å®‰è£…ä¾èµ–ï¼Œ<code>npm run dev</code> å¯åŠ¨å¼€å‘æœåŠ¡å™¨å°±èƒ½ç”¨ã€‚æ„å»ºç”Ÿäº§ç‰ˆæœ¬ä¹Ÿå°±æ˜¯ä¸€ä¸ª <code>npm run build</code> çš„äº‹ã€‚</p>
<p>å¦‚æœä½ æ›´å–œæ¬¢ç”¨ <code>Docker</code>ï¼Œé¡¹ç›®ä¹Ÿæä¾›äº†å®Œæ•´çš„ <code>Docker</code> æ”¯æŒã€‚<code>docker compose up --build -d</code> ä¸€æ¡å‘½ä»¤æå®šï¼Œä¸ç”¨æ“å¿ƒç¯å¢ƒé…ç½®çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-5">API é…ç½®</h2>
<p><code>API</code> é…ç½®å°±ä¸¤ä¸ªå‚æ•°ï¼šæœåŠ¡åœ°å€å’Œå¯†ç ã€‚é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸ª <code>.env</code> æ–‡ä»¶ï¼Œé‡Œé¢å†™å¥½äº†é»˜è®¤å€¼ã€‚å¦‚æœä½ æœ‰è‡ªå·±çš„ <code>RWKV</code> åç«¯æœåŠ¡ï¼Œæ”¹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶å°±è¡Œï¼Œæ”¹å®Œé‡å¯ä¸€ä¸‹å¼€å‘æœåŠ¡å™¨ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">PUBLIC_RWKV_API_URL=http://192.168.0.12:8000/v1/chat/completions
PUBLIC_RWKV_PASSWORD=rwkv7_7.2b_webgen
</code></pre>
<p>å°±è¿™ä¹ˆç®€å•ã€‚</p>
<h2 data-id="heading-6">60 ç§é£æ ¼æ˜¯æ€ä¹ˆè®¾è®¡å‡ºæ¥çš„</h2>
<p>60 ç§é£æ ¼ä¸æ˜¯æ‹è„‘è¢‹æƒ³å‡ºæ¥çš„ï¼Œè€Œæ˜¯æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯ä¸€ç‚¹ç‚¹ç§¯ç´¯èµ·æ¥çš„ã€‚æœ€å¼€å§‹åªæœ‰åå‡ ç§ï¼Œåæ¥å‘ç°ä¸å¤Ÿç”¨ï¼Œå°±ä¸æ–­è¡¥å……ã€‚</p>
<p>èŒåœºç±»æ˜¯æœ€æ—©åšçš„ä¸€æ‰¹ã€‚é¢å‘è€æ¿ã€é¢å‘å®¢æˆ·ã€é¢å‘åŒäº‹ï¼Œè¿™ä¸‰ä¸ªåœºæ™¯çš„è¯­æ°”å·®å¼‚éå¸¸å¤§ã€‚è·Ÿè€æ¿æ±‡æŠ¥å·¥ä½œï¼Œå¾—ç”¨"æ•¬è¯·æŒ‡ç¤º"ã€"æ­å€™ä½³éŸ³"è¿™ç§æ­£å¼è¡¨è¾¾ã€‚è·Ÿå®¢æˆ·æ²Ÿé€šï¼Œå¾—å¼ºè°ƒ"ä¸ºæ‚¨æœåŠ¡"ã€"æ»¡è¶³æ‚¨çš„éœ€æ±‚"ã€‚è·ŸåŒäº‹äº¤æµï¼Œå°±å¯ä»¥"å’±ä»¬å•†é‡ä¸€ä¸‹"ã€"ä¸€èµ·æå®š"ã€‚</p>
<p>æ–‡å­¦ç±»æ˜¯åæ¥åŠ çš„ã€‚æœ‰ç”¨æˆ·åé¦ˆè¯´æƒ³è¦å¤é£æ–‡æ¡ˆï¼Œäºæ˜¯å°±åšäº†çº¢æ¥¼æ¢¦ã€ä¸‰å›½æ¼”ä¹‰ã€æ°´æµ’ä¼ è¿™äº›ç»å…¸åè‘—çš„é£æ ¼ã€‚è¿˜æœ‰è¯—è¯æ­Œèµ‹ã€æ–‡è¨€æ–‡è¿™äº›ã€‚æ•ˆæœè¿˜ä¸é”™ï¼Œç”Ÿæˆå‡ºæ¥çš„å†…å®¹ç¡®å®æœ‰é‚£ä¸ªå‘³é“ã€‚</p>
<p>æ–¹è¨€ç±»æ¯”è¾ƒæœ‰æ„æ€ã€‚ä¸œåŒ—è¯ã€å››å·è¯ã€å¹¿ä¸œè¯ã€ä¸Šæµ·è¯ï¼Œæ¯ç§æ–¹è¨€éƒ½æœ‰è‡ªå·±çš„ç‰¹è‰²è¯æ±‡ã€‚ä¸œåŒ—è¯å–œæ¬¢è¯´"å’‹æ•´"ã€"è´¼æ‹‰"ï¼Œå››å·è¯çˆ±ç”¨"å“¦è±"ã€"å·´é€‚"ï¼Œå¹¿ä¸œè¯å¸¸è¯´"é¥®èŒ¶"ã€"ææ‚"ã€‚è¿™äº›æ–¹è¨€é£æ ¼åœ¨åšåœ°æ–¹æ€§æ¨å¹¿æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œèƒ½å¿«é€Ÿæ‹‰è¿‘å’Œç”¨æˆ·çš„è·ç¦»ã€‚</p>
<p>ç½‘ç»œç”¨è¯­é£æ ¼æ˜¯å¿…é¡»æœ‰çš„ã€‚ç°åœ¨çš„å¹´è½»äººè¯´è¯éƒ½æ˜¯"yyds"ã€"ç»ç»å­"ã€"EMO äº†"è¿™äº›æ¢—ã€‚å¦‚æœåšç¤¾äº¤åª’ä½“è¿è¥ï¼Œä¸ç”¨è¿™äº›ç½‘ç»œè¯­è¨€ï¼Œå†…å®¹å°±ä¼šæ˜¾å¾—å¾ˆç”Ÿç¡¬ã€‚æ‰€ä»¥ä¸“é—¨åšäº†å‡ ä¸ªç½‘ç»œç”¨è¯­é£æ ¼ï¼Œç´§è·Ÿæœ€æ–°çš„æµè¡Œè¶‹åŠ¿ã€‚</p>
<p>é™¤äº†è¿™äº›å¤§ç±»ï¼Œè¿˜æœ‰ä¸€äº›æ›´ç»†åˆ†çš„åœºæ™¯é£æ ¼ã€‚æ¯”å¦‚é“æ­‰ã€æ„Ÿè°¢ã€é‚€è¯·ã€æ‹’ç»ã€å‚¬ä¿ƒç­‰ã€‚è¿™äº›åœ¨æ—¥å¸¸æ²Ÿé€šä¸­ç»å¸¸ç”¨åˆ°ï¼Œä½†å¾ˆå¤šäººä¸çŸ¥é“æ€ä¹ˆè¡¨è¾¾å¾—æ—¢ç¤¼è²Œåˆä¸å¤±åˆ†å¯¸ã€‚æœ‰äº†è¿™äº›é£æ ¼ï¼Œç›´æ¥å¥—ç”¨å°±è¡Œã€‚</p>
<h2 data-id="heading-7">å®æ—¶çœ‹åˆ°ç”Ÿæˆè¿›åº¦</h2>
<p>å› ä¸ºæ˜¯æµå¼å“åº”ï¼Œæ‰€ä»¥ä½ å¯ä»¥å®æ—¶çœ‹åˆ°æ¯ä¸ªé£æ ¼çš„ç”Ÿæˆè¿›åº¦ã€‚ä¸åŒé£æ ¼çš„ç”Ÿæˆé€Ÿåº¦å¯èƒ½ä¸ä¸€æ ·ï¼Œæœ‰çš„å¿«æœ‰çš„æ…¢ï¼Œä½†æ¯ä¸ªéƒ½æ˜¯ç‹¬ç«‹æ›´æ–°çš„ï¼Œäº’ä¸å½±å“ã€‚</p>
<p>è¿™ç§ä½“éªŒæ¯”ä¼ ç»Ÿçš„"è½¬åœˆç­‰å¾…"å¥½å¤ªå¤šäº†ã€‚ä½ èƒ½çœ‹åˆ°æ–‡å­—ä¸€ä¸ªä¸ªè¹¦å‡ºæ¥ï¼ŒçŸ¥é“ AI ç¡®å®åœ¨å·¥ä½œï¼Œè€Œä¸æ˜¯å¡ä½äº†ã€‚è€Œä¸”å› ä¸ºæ˜¯å¹¶å‘çš„ï¼Œæ‰€ä»¥å¾ˆå¤šé£æ ¼ä¼šåŒæ—¶åœ¨ç”Ÿæˆï¼Œç•Œé¢ä¸Šåˆ°å¤„éƒ½åœ¨æ›´æ–°å†…å®¹ï¼Œçœ‹èµ·æ¥ç‰¹åˆ«æœ‰åŠ¨æ„Ÿã€‚</p>
<p>æ¯ä¸ªå¡ç‰‡å³ä¸Šè§’æœ‰ä¸ªå¤åˆ¶æŒ‰é’®ï¼Œç‚¹ä¸€ä¸‹å°±å¤åˆ¶åˆ°å‰ªè´´æ¿äº†ã€‚å¦‚æœå¯¹ç»“æœä¸æ»¡æ„ï¼Œåº•éƒ¨æœ‰ä¸ª"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ï¼Œä¼šç”¨åŒæ ·çš„è¾“å…¥å†è·‘ä¸€éã€‚</p>
<h2 data-id="heading-8">åç«¯ API è¦æ±‚</h2>
<p>åç«¯ <code>API</code> éœ€è¦æ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>æ¥æ”¶ä¸€ä¸ª <code>contents</code> æ•°ç»„ï¼Œæ•°ç»„é‡Œæœ‰å¤šå°‘ä¸ª <code>prompt</code> å°±è¦å¹¶å‘å¤„ç†å¤šå°‘ä¸ªä»»åŠ¡</li>
<li>è¿”å› <code>SSE</code> æ ¼å¼çš„æµå¼æ•°æ®ï¼Œæ¯ä¸ª <code>choice</code> å¿…é¡»åŒ…å« <code>index</code> å­—æ®µç”¨äºæ ‡è¯†å¯¹åº”çš„ä»»åŠ¡</li>
<li>æ‰€æœ‰ä»»åŠ¡å®Œæˆåå‘é€ <code>"data: [DONE]"</code> æ ‡è®°</li>
</ol>
<p>æ¨èä½¿ç”¨ <code>RWKV Lightning</code> ä½œä¸ºåç«¯æœåŠ¡ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRWKV-Vibe%2Frwkv_lightning%25EF%25BC%2589%25EF%25BC%258C%25E5%25AE%2583%25E5%25A4%25A9%25E7%2584%25B6%25E6%2594%25AF%25E6%258C%2581%25E8%25BF%2599%25E4%25BA%259B%25E7%2589%25B9%25E6%2580%25A7%25E3%2580%2582%25E5%25A6%2582%25E6%259E%259C%25E4%25BD%25A0%25E7%2594%25A8%25E5%2585%25B6%25E4%25BB%2596%25E5%2590%258E%25E7%25AB%25AF%25EF%25BC%258C%25E5%258F%25AA%25E8%25A6%2581%25E6%25BB%25A1%25E8%25B6%25B3%25E4%25B8%258A%25E9%259D%25A2%25E4%25B8%2589%25E4%25B8%25AA%25E6%259D%25A1%25E4%25BB%25B6%25E5%25B0%25B1%25E8%2583%25BD%25E6%258E%25A5%25E5%2585%25A5%25E3%2580%2582" target="_blank" title="https://github.com/RWKV-Vibe/rwkv_lightning%EF%BC%89%EF%BC%8C%E5%AE%83%E5%A4%A9%E7%84%B6%E6%94%AF%E6%8C%81%E8%BF%99%E4%BA%9B%E7%89%B9%E6%80%A7%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E7%94%A8%E5%85%B6%E4%BB%96%E5%90%8E%E7%AB%AF%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%BB%A1%E8%B6%B3%E4%B8%8A%E9%9D%A2%E4%B8%89%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%B0%B1%E8%83%BD%E6%8E%A5%E5%85%A5%E3%80%82" ref="nofollow noopener noreferrer">github.com/RWKV-Vibe/râ€¦</a></p>
<h2 data-id="heading-9">å†™åœ¨æœ€å</h2>
<p>è¿™ä¸ªå·¥å…·çš„æ ¸å¿ƒä»·å€¼å°±æ˜¯ä¸€ä¸ªå­—ï¼šå¿«ã€‚</p>
<p>ä¼ ç»Ÿæ–¹å¼è¦ç”Ÿæˆ 60 ç§é£æ ¼ï¼Œå¾—ç­‰ 2 åˆ†é’Ÿã€‚ç°åœ¨å¹¶å‘ç”Ÿæˆï¼Œåªè¦ 2 ç§’é’Ÿã€‚æ•ˆç‡æå‡äº† 60 å€ï¼Œè¿™æ‰æ˜¯çœŸæ­£æœ‰ç”¨çš„å·¥å…·ã€‚</p>
<p>å½“ç„¶ï¼Œ60 ç§é£æ ¼åªæ˜¯å¼€å§‹ã€‚éšç€ä½¿ç”¨åœºæ™¯çš„å¢åŠ ï¼Œè‚¯å®šè¿˜ä¼šæœ‰æ›´å¤šé£æ ¼åŠ è¿›æ¥ã€‚å¥½åœ¨æ·»åŠ æ–°é£æ ¼å¾ˆç®€å•ï¼Œæ”¹å‡ è¡Œé…ç½®å°±è¡Œã€‚</p>
<p>å¦‚æœä½ æœ‰ä»€ä¹ˆæƒ³æ³•æˆ–å»ºè®®ï¼Œæ¬¢è¿æ <code>Issue</code> æˆ– <code>PR</code>ã€‚è¿™ä¸ªå·¥å…·ä¼šæŒç»­ä¼˜åŒ–ï¼Œè®©æ›´å¤šäººå—ç›Šã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRWKV-Vibe%2Frwkv-parallel-tone" target="_blank" title="https://github.com/RWKV-Vibe/rwkv-parallel-tone" ref="nofollow noopener noreferrer">rwkv-parallel-tone</a></p>
<p>åç«¯æœåŠ¡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRWKV-Vibe%2Frwkv_lightning" target="_blank" title="https://github.com/RWKV-Vibe/rwkv_lightning" ref="nofollow noopener noreferrer">RWKV Lightning</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux I/O æ–¹å¼è¿›åŒ–å²ï¼ˆå†…æ ¸/æ€§èƒ½è§†è§’ï¼‰ï¼šä»â€œç¡æ­»â€åˆ°â€œå°±ç»ªé˜Ÿåˆ—â€å†åˆ°â€œå®Œæˆé˜Ÿåˆ—â€]]></title>    <link>https://juejin.cn/post/7595289498445660186</link>    <guid>https://juejin.cn/post/7595289498445660186</guid>    <pubDate>2026-01-15T06:57:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595289498445660186" data-draft-id="7595289498445529114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux I/O æ–¹å¼è¿›åŒ–å²ï¼ˆå†…æ ¸/æ€§èƒ½è§†è§’ï¼‰ï¼šä»â€œç¡æ­»â€åˆ°â€œå°±ç»ªé˜Ÿåˆ—â€å†åˆ°â€œå®Œæˆé˜Ÿåˆ—â€"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-15T06:57:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pomelo_åˆ˜é‡‘"/> <meta itemprop="url" content="https://juejin.cn/user/3450694359320669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux I/O æ–¹å¼è¿›åŒ–å²ï¼ˆå†…æ ¸/æ€§èƒ½è§†è§’ï¼‰ï¼šä»â€œç¡æ­»â€åˆ°â€œå°±ç»ªé˜Ÿåˆ—â€å†åˆ°â€œå®Œæˆé˜Ÿåˆ—â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3450694359320669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pomelo_åˆ˜é‡‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:57:48.000Z" title="Thu Jan 15 2026 06:57:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ç¯‡æ–‡ç« é¢å‘â€œæƒ³æŠŠ I/O è®²é€çš„äººâ€ï¼šä¸æ­¢ä¼šç”¨ <code>epoll</code>ï¼Œè¿˜è¦èƒ½è§£é‡Š<strong>ä¸ºä»€ä¹ˆå®ƒåœ¨å†…æ ¸é‡Œæ›´çœ</strong>ã€<strong>å°±ç»ªåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€</strong>ã€<strong>ä¸ºä»€ä¹ˆä¼šå‡ºç° EAGAIN/çŸ­è¯»å†™</strong>ã€ä»¥åŠ <strong>io_uring åˆ°åº•æ¯” epoll å¤šåšäº†ä»€ä¹ˆ</strong>ã€‚</p>
<p>æˆ‘ä¼šæŒ‰æ—¶é—´çº¿è®²ï¼šæ¯ä¸€ä»£æŠ€æœ¯éƒ½æºè‡ªä¸€ä¸ªéå¸¸å…·ä½“çš„æ€§èƒ½/å·¥ç¨‹ç—›ç‚¹ã€‚</p>
<hr/>
<h2 data-id="heading-0">0. å¼€åœºï¼šI/O çš„æœ¬è´¨çŸ›ç›¾ï¼ˆå†…æ ¸åˆ°åº•åœ¨å¸®ä½ ç­‰ä»€ä¹ˆï¼‰</h2>
<p>åœ¨ Linux é‡Œï¼ŒI/O å¤§ä½“æœ‰ä¸¤æ­¥ï¼š</p>
<ol>
<li><strong>ç­‰å¾…æ¡ä»¶æˆç«‹</strong>ï¼ˆæ¯”å¦‚ socket æ¥æ”¶é˜Ÿåˆ—æœ‰æ•°æ®ã€å‘é€ç¼“å†²åŒºæœ‰ç©ºé—´ã€ç›‘å¬ socket æœ‰æ–°è¿æ¥ã€æ–‡ä»¶é¡µç¼“å­˜å°±ç»ªç­‰ï¼‰</li>
<li><strong>æ•°æ®æ¬è¿/å®Œæˆ</strong>ï¼ˆcopy_to_user / copy_from_userã€æˆ– DMA å®Œæˆã€æ›´æ–°çŠ¶æ€ï¼Œè¿”å›ç»“æœï¼‰</li>
</ol>
<p>å¾ˆå¤šæ‰€è°“ I/Oâ€œæ¨¡å‹â€çš„åŒºåˆ«ï¼Œå…¶å®å°±åœ¨äºï¼š</p>
<ul>
<li><strong>è°æ¥ç­‰å¾…</strong>ï¼ˆç”¨æˆ·çº¿ç¨‹å¿™ç­‰ï¼Ÿç¡çœ ç­‰ï¼Ÿå†…æ ¸ç­‰ï¼Ÿï¼‰</li>
<li><strong>ç­‰å¾…çš„æ˜¯â€œå°±ç»ªâ€è¿˜æ˜¯â€œå®Œæˆâ€</strong></li>
<li><strong>è°æ¥é©±åŠ¨ä¸‹ä¸€æ­¥</strong>ï¼ˆç”¨æˆ·æ€å¾ªç¯ï¼Ÿå†…æ ¸å›è°ƒï¼Ÿå®Œæˆé˜Ÿåˆ—ï¼Ÿï¼‰</li>
</ul>
<p>æŠŠè¿™ä¸‰ä¸ªé—®é¢˜æŠ“ä½ï¼Œä½ å°±èƒ½çœ‹æ¸…å…¨å±€ã€‚</p>
<hr/>
<h2 data-id="heading-1">1. å²å‰æ—¶ä»£ï¼šé˜»å¡ I/Oï¼ˆBlockingï¼‰â€”â€”â€œæœ€çœ CPUï¼Œä½†æœ€å®¹æ˜“æŠŠçº¿ç¨‹ç”¨å…‰â€</h2>
<h3 data-id="heading-2">1.1 å‘ç”Ÿäº†ä»€ä¹ˆ</h3>
<p>çº¿ç¨‹è°ƒç”¨ <code>read(fd)</code>ï¼š</p>
<ul>
<li>å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼ˆæ¯”å¦‚ socket æ¥æ”¶é˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œçº¿ç¨‹è¿›å…¥å†…æ ¸ï¼ŒæŒ‚åˆ°å¯¹åº”çš„ <strong>wait queue</strong> ä¸Šç¡çœ ï¼ˆå¯ä¸­æ–­/ä¸å¯ä¸­æ–­è§†æƒ…å†µï¼‰</li>
<li>ç­‰åˆ°ç½‘ç»œåŒ…åˆ°æ¥ã€åè®®æ ˆæŠŠæ•°æ®æ”¾è¿› socket æ¥æ”¶é˜Ÿåˆ—ï¼Œå†…æ ¸ <code>wake_up</code> ç›¸å…³ waiters</li>
<li>çº¿ç¨‹è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œï¼Œæ‹·è´æ•°æ®åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œè¿”å›</li>
</ul>
<h3 data-id="heading-3">1.2 æ€§èƒ½ç”»åƒ</h3>
<p><strong>ä¼˜ç‚¹ï¼ˆå†…æ ¸è§†è§’ï¼‰ï¼š</strong></p>
<ul>
<li>æ²¡æœ‰ç©ºè½¬ï¼ŒCPU åˆ©ç”¨ç‡å¾ˆâ€œå¹²å‡€â€</li>
<li>é€»è¾‘ç®€å•ã€å±€éƒ¨æ€§å¥½</li>
</ul>
<p><strong>ç“¶é¢ˆï¼ˆç³»ç»Ÿè§†è§’ï¼‰ï¼š</strong></p>
<ul>
<li>é«˜å¹¶å‘ä¸‹å¦‚æœé‡‡ç”¨â€œæ¯è¿æ¥ä¸€çº¿ç¨‹â€ï¼Œè°ƒåº¦æˆæœ¬ã€å†…å­˜ï¼ˆçº¿ç¨‹æ ˆï¼‰ã€TLB/Cache æŠ–åŠ¨è¿…é€Ÿå˜æˆä¸»è¦ç“¶é¢ˆ</li>
<li>tail latency ä¹Ÿä¼šè¢«è°ƒåº¦/äº‰ç”¨æ”¾å¤§</li>
</ul>
<h3 data-id="heading-4">1.3 ç°å®ç—›ç‚¹ â†’ ä¸‹ä¸€ä»£</h3>
<blockquote>
<p>ç—›ç‚¹ï¼š<strong>æˆ‘æƒ³æœåŠ¡ 10k<del>100k è¿æ¥ï¼Œä½†æˆ‘ä¸æƒ³è¦ 10k</del>100k çº¿ç¨‹ã€‚</strong><br/>
äºæ˜¯äººä»¬æƒ³ï¼šèƒ½ä¸èƒ½å°‘çº¿ç¨‹ã€ç”šè‡³å•çº¿ç¨‹æ‰›ä½ï¼Ÿ</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">2. ç¬¬äºŒé˜¶æ®µï¼šéé˜»å¡ I/Oï¼ˆNonblockingï¼‰â€”â€”â€œçº¿ç¨‹ä¸ç¡äº†ï¼Œä½† CPU å¼€å§‹ç©ºè½¬â€</h2>
<h3 data-id="heading-6">2.1 è¯­ä¹‰æ”¹å˜</h3>
<p>æŠŠ fd è®¾ä¸º <code>O_NONBLOCK</code> åï¼š</p>
<ul>
<li><code>read()</code> è‹¥æ— æ•°æ®ï¼šç«‹åˆ»è¿”å› <code>-1</code>ï¼Œ<code>errno=EAGAIN/EWOULDBLOCK</code></li>
<li><code>accept()</code> æ— è¿æ¥ï¼šåŒæ · EAGAIN</li>
<li><code>write()</code> å†™ä¸è¿›å»ï¼ˆå‘é€ç¼“å†²åŒºæ»¡ï¼‰ï¼šEAGAIN æˆ–çŸ­å†™</li>
</ul>
<p>å…³é”®ç‚¹ï¼š<strong>éé˜»å¡åªå®šä¹‰äº†â€œå•ä¸ªç³»ç»Ÿè°ƒç”¨â€åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶ä¸ç¡çœ </strong>ã€‚å®ƒå¹¶ä¸å‘Šè¯‰ä½ â€œä»€ä¹ˆæ—¶å€™å†æ¥è¯•â€ã€‚</p>
<h3 data-id="heading-7">2.2 æ€§èƒ½ç”»åƒ</h3>
<p>å¦‚æœä½ æ²¡æœ‰æ›´å¥½çš„ç­‰å¾…æœºåˆ¶ï¼Œå°±åªèƒ½ï¼š</p>
<ul>
<li>è½®è¯¢æ‰€æœ‰è¿æ¥ï¼š<code>read()</code> -&gt; EAGAIN -&gt; ä¸‹ä¸€ä¸ª</li>
<li>è¿™ä¼šé€ æˆå¤§é‡æ— æ•ˆ syscalls + éå†å¼€é”€</li>
<li>CPU åˆ©ç”¨ç‡ä¸Šå‡ï¼Œä½†ååä¸ä¸€å®šä¸Šå‡ï¼ˆæ›´åƒåœ¨â€œçƒ§ CPU ä¹°å»¶è¿Ÿâ€ï¼‰</li>
</ul>
<h3 data-id="heading-8">2.3 ç°å®ç—›ç‚¹ â†’ ä¸‹ä¸€ä»£</h3>
<blockquote>
<p>ç—›ç‚¹ï¼š<strong>æˆ‘ä¸æƒ³é˜»å¡ï¼Œä½†æˆ‘ä¹Ÿä¸æƒ³å¿™ç­‰ã€‚æˆ‘è¦ä¸€ç§â€œå¯ç¡çœ çš„ç­‰å¾…â€ï¼Œè¿˜èƒ½ä¸€æ¬¡ç­‰å¾ˆå¤š fdã€‚</strong><br/>
è¿™å°±å¼•å‡ºäº†â€œå¤šè·¯å¤ç”¨â€ï¼ˆselect/poll/epollï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">3. ç¬¬ä¸‰é˜¶æ®µï¼šI/O å¤šè·¯å¤ç”¨ï¼ˆselect/pollï¼‰â€”â€”â€œä¸€æ¬¡ç­‰å¾ˆå¤šï¼Œä½†æ¯æ¬¡éƒ½è¦å…¨é‡æ¬åå•ã€å…¨é‡ç‚¹åâ€</h2>
<p>å¤šè·¯å¤ç”¨è§£å†³çš„æ˜¯â€œç­‰å¾…â€é—®é¢˜ï¼šæŠŠâ€œç­‰å¾ˆå¤š fdâ€è¿™ä»¶äº‹äº¤ç»™å†…æ ¸ã€‚</p>
<h3 data-id="heading-10">3.1 <code>select/poll</code> å†…æ ¸è§†è§’çš„æˆæœ¬æ¥è‡ªå“ª</h3>
<p>å®ƒä»¬çš„å…±åŒç‚¹ï¼ˆç®€åŒ–è¯´ï¼‰ï¼š</p>
<ul>
<li>æ¯æ¬¡è°ƒç”¨éƒ½è¦æŠŠ<strong>å…³æ³¨é›†åˆ</strong>ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼ˆselect æ˜¯ä½å›¾ã€poll æ˜¯æ•°ç»„ï¼‰</li>
<li>å†…æ ¸è¦éå†é›†åˆï¼Œæ£€æŸ¥æ¯ä¸ª fd æ˜¯å¦å°±ç»ª</li>
<li>è¿”å›åç”¨æˆ·æ€è¿˜è¦å†éå†ä¸€æ¬¡æ‰¾å°±ç»ªé¡¹ï¼ˆselect/poll API å½¢æ€å†³å®šçš„ï¼‰</li>
</ul>
<p>äºæ˜¯æˆæœ¬å¤©ç„¶æ¥è¿‘ <strong>O(N)</strong> ï¼ˆN æ˜¯ç›‘å¬ fd æ•°é‡ï¼‰ï¼Œå¹¶ä¸”æ¯è½®éƒ½æœ‰æ‹·è´æˆæœ¬ã€‚</p>
<h3 data-id="heading-11">3.2 ç°å®ç—›ç‚¹ â†’ epoll</h3>
<blockquote>
<p>ç—›ç‚¹ï¼š<strong>å½“ N å¾ˆå¤§ï¼ˆæ¯”å¦‚ 50k è¿æ¥ï¼‰ï¼Œå³ä¾¿æ¯æ¬¡åªæœ‰å‡ åä¸ªæ´»è·ƒè¿æ¥ï¼Œä¹Ÿè¦æ¯è½®æ‰«æ/æ‹·è´ 50kã€‚</strong><br/>
è¿™ä¼šè®©â€œç©ºé—²è¿æ¥çš„è§„æ¨¡â€æˆä¸ºç³»ç»Ÿæˆæœ¬ã€‚<br/>
æ‰€ä»¥éœ€è¦ä¸€ç§æœºåˆ¶ï¼š<strong>åˆ«æ¯æ¬¡éƒ½å…¨é‡ä¼ åå•ï¼›åˆ«æ¯æ¬¡éƒ½å…¨é‡æ‰«æï¼›åªæŠŠå°±ç»ªçš„è¿”å›ç»™æˆ‘ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-12">4. ç¬¬å››é˜¶æ®µï¼šepoll â€”â€”â€œæŠŠâ€˜åå•â€™å˜æˆæ³¨å†Œè¡¨ï¼ŒæŠŠâ€˜ç‚¹åâ€™å˜æˆå°±ç»ªé˜Ÿåˆ—â€</h2>
<p>epoll çš„æ ¸å¿ƒçªç ´åœ¨äºï¼š<strong>å…³æ³¨é›†åˆè¢«æŒä¹…åŒ–åœ¨å†…æ ¸é‡Œ</strong>ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨ä¸´æ—¶ä¼ å…¥ã€‚</p>
<h3 data-id="heading-13">4.1 ä¸¤æ®µå¼ API åæ˜ çš„å†…æ ¸è®¾è®¡</h3>
<ul>
<li><code>epoll_ctl(ADD/MOD/DEL)</code>ï¼šç»´æŠ¤ä¸€ä¸ªâ€œå…³æ³¨é›†åˆâ€ï¼ˆinterest setï¼‰</li>
<li><code>epoll_wait()</code>ï¼šç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›å°±ç»ªåˆ—è¡¨ï¼ˆready listï¼‰</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>fd åˆ—è¡¨çš„ç»´æŠ¤æˆæœ¬ä»â€œæ¯è½®â€ç§»åˆ°äº†â€œå˜æ›´æ—¶â€</li>
<li>è¿”å›çš„æ˜¯â€œå°±ç»ªé¡¹â€ï¼Œè€Œä¸æ˜¯è®©ä½ æ‰«æå…¨éƒ¨</li>
</ul>
<h3 data-id="heading-14">4.2 å°±ç»ªåˆ°åº•æ˜¯ä»€ä¹ˆï¼ˆéå¸¸å…³é”®ï¼Œåˆ«æŠŠå®ƒå½“â€œä¿¡å·ä¿è¯â€ï¼‰</h3>
<p>â€œå°±ç»ªï¼ˆreadable/writableï¼‰â€ä¸æ˜¯â€œä¿è¯ read/write ä¸€å®šæˆåŠŸâ€çš„ç»å¯¹æ‰¿è¯ºï¼Œå®ƒæ›´æ¥è¿‘ï¼š</p>
<ul>
<li><strong>readable</strong>ï¼šè¯»æ“ä½œâ€œä¸ä¼šæ— é™æœŸé˜»å¡â€ï¼ˆå¯èƒ½è¯»åˆ°æ•°æ®ã€è¯»åˆ° EOFã€æˆ–è¯»åˆ°é”™è¯¯ï¼‰</li>
<li><strong>writable</strong>ï¼šå†™æ“ä½œâ€œå¯èƒ½å†™å…¥ä¸€äº›æ•°æ®è€Œä¸é˜»å¡â€ï¼ˆä½†èƒ½å†™å¤šå°‘ä¸ä¿è¯ï¼‰</li>
</ul>
<p>å› æ­¤ä½ ä¼šçœ‹åˆ°è¿™äº›çœ‹ä¼¼åç›´è§‰ä½†å®Œå…¨æ­£å¸¸çš„ç°è±¡ï¼š</p>
<ul>
<li>epoll æŠ¥å‘Šå¯è¯»ï¼Œä½  <code>read()</code> ä»ç„¶å¯èƒ½å¾—åˆ° <code>EAGAIN</code><br/>
åŸå› ï¼šç«æ€ï¼ˆå¤šçº¿ç¨‹/å¤šè¿›ç¨‹ï¼‰ã€è¾¹æ²¿è§¦å‘æ²¡è¯»å¹²å‡€ã€çŠ¶æ€å˜åŒ–ç­‰</li>
<li>epoll æŠ¥å‘Šå¯å†™ï¼Œä½  <code>write()</code> å¯èƒ½çŸ­å†™<br/>
åŸå› ï¼šå‘é€ç¼“å†²åŒºç©ºé—´æœ‰é™ã€æ‹¥å¡æ§åˆ¶ã€MSS/TSO ç­‰å› ç´ </li>
</ul>
<p><strong>ç»“è®ºï¼š</strong></p>
<blockquote>
<p>åœ¨æ€§èƒ½æ­£ç¡®çš„äº‹ä»¶å¾ªç¯é‡Œï¼Œä½ è¦æ¥å—â€œçŸ­è¯»/çŸ­å†™/EAGAIN æ˜¯å¸¸æ€â€ï¼Œå¹¶ç”¨å¾ªç¯ä¸çŠ¶æ€æœºå¤„ç†å®ƒä»¬ã€‚</p>
</blockquote>
<h3 data-id="heading-15">4.3 LT vs ETï¼šæ€§èƒ½ä¸æ­£ç¡®æ€§çš„åˆ†æ°´å²­</h3>
<ul>
<li>
<p><strong>LTï¼ˆç”µå¹³è§¦å‘ï¼‰</strong> ï¼šåªè¦æ¡ä»¶ä»æˆç«‹ï¼ˆæ¯”å¦‚æ¥æ”¶é˜Ÿåˆ—éç©ºï¼‰ï¼Œå°±æŒç»­é€šçŸ¥<br/>
æ›´ä¸å®¹æ˜“å†™é”™ï¼Œå› ä¸ºâ€œæ²¡è¯»å®Œä¸‹æ¬¡è¿˜ä¼šæé†’ä½ â€</p>
</li>
<li>
<p><strong>ETï¼ˆè¾¹æ²¿è§¦å‘ï¼‰</strong> ï¼šåªåœ¨çŠ¶æ€ä»â€œä¸å°±ç»ªâ†’å°±ç»ªâ€æ—¶é€šçŸ¥ä¸€æ¬¡<br/>
æ€§èƒ½æ½œåŠ›æ›´é«˜ï¼ˆå‡å°‘é‡å¤é€šçŸ¥ï¼‰ï¼Œä½†è¦æ±‚ï¼š</p>
<ul>
<li>fd å¿…é¡» nonblockingï¼ˆå‡ ä¹æ˜¯äº‹å®ä¸Šçš„è¦æ±‚ï¼‰</li>
<li>è¯»ï¼šå¿…é¡»å¾ªç¯è¯»åˆ° <code>EAGAIN</code>ï¼ˆæŠŠå†…æ ¸ç¼“å†²åŒºâ€œæ¦¨å¹²â€ï¼‰</li>
<li>å†™ï¼šé€šå¸¸ä¹Ÿè¦å¾ªç¯å†™åˆ° <code>EAGAIN</code>ï¼Œå¹¶åœ¨å†™ä¸åŠ¨æ—¶å†å…³æ³¨ EPOLLOUT</li>
</ul>
</li>
</ul>
<p><strong>ET å†™é”™çš„å…¸å‹ç—‡çŠ¶ï¼š</strong></p>
<ul>
<li>è¿æ¥â€œå¡ä½â€ï¼šç¼“å†²åŒºé‡Œè¿˜æœ‰æ•°æ®ï¼Œä½†ä½ æ²¡è¯»å¹²å‡€ï¼›ä¹‹åå› ä¸ºæ²¡æœ‰æ–°è¾¹æ²¿ï¼Œä¸å†é€šçŸ¥ï¼Œä¸šåŠ¡ä»¥ä¸ºæ²¡æ•°æ®äº†</li>
</ul>
<h3 data-id="heading-16">4.4 epoll ä¸æ˜¯é“¶å¼¹ï¼šå‡ ä¸ªå†…æ ¸/æ€§èƒ½å‘ä½</h3>
<ol>
<li>
<p><strong>æƒŠç¾¤ï¼ˆthundering herdï¼‰</strong><br/>
å¤šçº¿ç¨‹/å¤šè¿›ç¨‹ç­‰å¾…åŒä¸€ç›‘å¬ socket æˆ–åŒä¸€ epoll äº‹ä»¶æºä¼šå¯¼è‡´å¤§é‡æ— æ•ˆå”¤é†’ã€‚</p>
<ul>
<li>accept æƒŠç¾¤å†å²ä¸Šå¾ˆå…¸å‹ï¼›ç°ä»£å†…æ ¸ä¸ <code>EPOLLEXCLUSIVE</code> ç­‰æœºåˆ¶ç¼“è§£ï¼Œä½†è®¾è®¡ä¸Šä»è¦è°¨æ…ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹ä»¶å¾ªç¯é‡Œçš„â€œé˜»å¡ç‚¹â€</strong><br/>
ä¸€æ—¦ä½ åœ¨å›è°ƒé‡Œåšäº†é˜»å¡æ“ä½œï¼ˆç£ç›˜ IOã€DNSã€é”äº‰ç”¨ã€åŒæ­¥æ—¥å¿—ï¼‰ï¼Œæ•´ä¸ª Reactor å»¶è¿Ÿä¼šè¢«æ”¾å¤§ã€‚</p>
</li>
<li>
<p><strong>è¿æ¥æ•°å¾ˆå¤§ä½†æ´»è·ƒåº¦å¾ˆä½</strong><br/>
epoll æ“…é•¿è¿™ç§â€œå·¨é‡ idle + å°‘é‡ activeâ€ï¼›select/poll åˆ™ä¼šè¢« O(N) æ‰«ææ‹–æ­»ã€‚</p>
</li>
<li>
<p><strong>ç”¨æˆ·æ€ç¼“å†²ä¸å†…æ ¸ç¼“å†²çš„é…åˆ</strong><br/>
è¯»å†™ç­–ç•¥ï¼ˆä¸€æ¬¡è¯»å¤šå°‘ã€åˆå¹¶å†™ã€é›¶æ‹·è´ sendfile/spliceï¼‰ä¼šæ˜¾è‘—å½±å“ååå’Œ cache è¡Œä¸ºã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-17">5. ç¬¬äº”é˜¶æ®µï¼šä»â€œå°±ç»ªâ€åˆ°â€œå®Œæˆâ€â€”â€”å¼‚æ­¥ I/O ä¸ io_uring çš„å‡ºåœº</h2>
<p>åˆ° epoll ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¤§å¤šæ•°æ—¶å€™ä»åœ¨åšâ€œå°±ç»ªé©±åŠ¨â€ï¼š</p>
<ul>
<li>å†…æ ¸ï¼šå‘Šè¯‰ä½ â€œç°åœ¨å¯ä»¥è¯»/å†™äº†â€</li>
<li>ç”¨æˆ·æ€ï¼šè‡ªå·±å‘èµ· read/writeã€è‡ªå·±æ¬æ•°æ®ã€è‡ªå·±å¤„ç†çŸ­è¯»å†™</li>
</ul>
<p>åœ¨æé™æ€§èƒ½ä¸‹ï¼Œäººä»¬æƒ³è¿›ä¸€æ­¥å‡å°‘ï¼š</p>
<ul>
<li>ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°</li>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
<li>ç”¨æˆ·æ€/å†…æ ¸æ€æ¥å›ï¼ˆå°¤å…¶æ˜¯â€œç­‰ä¸€ä¸‹ã€è¯•ä¸€ä¸‹â€çš„å¾€è¿”ï¼‰</li>
</ul>
<h3 data-id="heading-18">5.1 io_uring çš„æ ¸å¿ƒè®°å¿†ç‚¹ï¼šå®Œæˆé˜Ÿåˆ—</h3>
<p><code>io_uring</code> æ›´åƒï¼š</p>
<ul>
<li>ç”¨æˆ·æ€æŠŠâ€œè¦åšçš„ I/O æ“ä½œâ€æ”¾è¿› <strong>æäº¤é˜Ÿåˆ— SQ</strong></li>
<li>å†…æ ¸å¼‚æ­¥æ‰§è¡Œï¼ˆæˆ–æ›´é«˜æ•ˆåœ°æ‰¹å¤„ç†/æäº¤ï¼‰</li>
<li>å®ŒæˆåæŠŠç»“æœæ”¾è¿› <strong>å®Œæˆé˜Ÿåˆ— CQ</strong></li>
<li>ç”¨æˆ·æ€ä¸€æ¬¡æ€§æ”¶å‰²å®Œæˆäº‹ä»¶</li>
</ul>
<p>è¿™æ˜¯ä¸€ç§â€œå®Œæˆé©±åŠ¨ï¼ˆcompletion-basedï¼‰â€çš„æ€è·¯ï¼š</p>
<blockquote>
<p>epoll æ˜¯ readinessï¼ˆå°±ç»ªï¼‰ï¼›io_uring æ›´æ¥è¿‘ completionï¼ˆå®Œæˆï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-19">5.2 ä»€ä¹ˆæ—¶å€™å®ƒå¯èƒ½èµ¢ï¼ˆæ€§èƒ½ç›´è§‰ï¼‰</h3>
<ul>
<li>éœ€è¦å¤§é‡å° I/Oã€é¢‘ç¹ syscalls çš„åœºæ™¯</li>
<li>å¸Œæœ›æ‰¹é‡æäº¤/æ‰¹é‡å®Œæˆï¼Œå‡å°‘è¿›å‡ºå†…æ ¸çš„æ¬¡æ•°</li>
<li>æ–‡ä»¶ I/Oã€ç½‘ç»œ I/Oã€ä»¥åŠç»„åˆå‹å·¥ä½œæµï¼ˆå–å†³äºå†…æ ¸ç‰ˆæœ¬ä¸ä½¿ç”¨æ–¹å¼ï¼‰</li>
</ul>
<h3 data-id="heading-20">5.3 ä»£ä»·</h3>
<ul>
<li>å¿ƒæ™ºæ¨¡å‹æ›´å¤æ‚ï¼šè¯·æ±‚ç”Ÿå‘½å‘¨æœŸã€å–æ¶ˆã€è¶…æ—¶ã€ç¼“å†²ç®¡ç†</li>
<li>è°ƒè¯•éš¾åº¦æ›´é«˜</li>
<li>å¹¶éæ‰€æœ‰åœºæ™¯éƒ½å¿…ç„¶æ¯” epoll æ›´å¿«ï¼ˆå–å†³äºè´Ÿè½½å½¢æ€ã€å†…æ ¸ç‰ˆæœ¬ã€å®ç°ç»†èŠ‚ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-21">6. ä¸€å¼ â€œå†…æ ¸/æ€§èƒ½å‘â€çš„å¯¹ç…§è¡¨ï¼šå®ƒä»¬åˆ°åº•å·®åœ¨å“ª</h2>





















































<table><thead><tr><th>æ–¹å¼</th><th>ç­‰å¾…å¯¹è±¡</th><th>é€šçŸ¥è¯­ä¹‰</th><th>ç”¨æˆ·æ€æ˜¯å¦å‘èµ·çœŸæ­£ read/write</th><th>å…¸å‹æˆæœ¬ç“¶é¢ˆ</th><th>é€‚ç”¨åœºæ™¯ç›´è§‰</th></tr></thead><tbody><tr><td>é˜»å¡ I/O</td><td>å•ä¸ª fd æ¡ä»¶</td><td>å®Œæˆåè¿”å›ï¼ˆå¯¹è°ƒç”¨è€…è€Œè¨€ï¼‰</td><td>æ˜¯</td><td>çº¿ç¨‹/è°ƒåº¦æˆæœ¬</td><td>è¿æ¥å°‘ã€é€»è¾‘ç®€å•</td></tr><tr><td>éé˜»å¡ I/O</td><td>å•ä¸ª fd æ¡ä»¶</td><td>ç«‹å³è¿”å› EAGAIN</td><td>æ˜¯</td><td>å¿™è½®è¯¢ç©ºè½¬</td><td>å¿…é¡»é…åˆäº‹ä»¶æœºåˆ¶æ‰é«˜æ•ˆ</td></tr><tr><td>select/poll</td><td>å¤š fd å°±ç»ª</td><td>readiness</td><td>æ˜¯</td><td>æ¯è½®æ‹·è´+O(N) æ‰«æ</td><td>fd å°‘æˆ–å…¼å®¹æ€§éœ€æ±‚</td></tr><tr><td>epoll</td><td>å¤š fd å°±ç»ª</td><td>readinessï¼ˆè¿”å›å°±ç»ªåˆ—è¡¨ï¼‰</td><td>æ˜¯</td><td>å›è°ƒè€—æ—¶ã€ç«æ€å¤„ç†ã€ET è¯»å†™ç­–ç•¥</td><td>æµ·é‡è¿æ¥ã€äº‹ä»¶é©±åŠ¨</td></tr><tr><td>io_uring</td><td>I/O è¯·æ±‚å®Œæˆ</td><td>completionï¼ˆCQEï¼‰</td><td>è¯·æ±‚æäº¤åå†…æ ¸æ‰§è¡Œ</td><td>ç¼“å†²/ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å®ç°å¤æ‚åº¦</td><td>æé™åå/é™ä½ syscall å¾€è¿”</td></tr></tbody></table>
<hr/>
<p>Pomelo_åˆ˜é‡‘ã€‚è½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ã€‚æ„Ÿè°¢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆJavaé‡Œé¢ï¼ŒService å±‚ä¸ç›´æ¥è¿”å› Result å¯¹è±¡ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7594817135128248354</link>    <guid>https://juejin.cn/post/7594817135128248354</guid>    <pubDate>2026-01-14T07:23:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128248354" data-draft-id="7594742976712474658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆJavaé‡Œé¢ï¼ŒService å±‚ä¸ç›´æ¥è¿”å› Result å¯¹è±¡ï¼Ÿ"/> <meta itemprop="keywords" content="Java,Spring Boot,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-14T07:23:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åªå«ç…¤çƒçš„çŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆJavaé‡Œé¢ï¼ŒService å±‚ä¸ç›´æ¥è¿”å› Result å¯¹è±¡ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åªå«ç…¤çƒçš„çŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:23:00.000Z" title="Wed Jan 14 2026 07:23:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æ˜¨å¤©åœ¨Code Reviewæ—¶ï¼Œæˆ‘å‘ç°é˜¿åŸåœ¨Serviceå±‚ç›´æ¥è¿”å›äº†Resultå¯¹è±¡ã€‚</p>
<p>æŒ‡å‡ºè¿™ä¸ªé—®é¢˜åï¼Œé˜¿åŸæœ‰äº›ä¸è§£ï¼Œåé—®æˆ‘ä¸ºä»€ä¹ˆä¸èƒ½è¿™æ ·å†™ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å±•å¼€äº†ä¸€åœºæŠ€æœ¯è®¨è®ºï¼ˆbattle ğŸ¤£ï¼‰ã€‚</p>
<p>è®¨è®ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„è®¾è®¡é—®é¢˜ï¼ŒèƒŒåå…¶å®æ¶‰åŠåˆ†å±‚æ¶æ„ã€èŒè´£åˆ’åˆ†ã€ä»£ç å¤ç”¨ç­‰å¤šä¸ªé‡è¦æ¦‚å¿µã€‚</p>
<p>ä¸å…¶è®©è¿™æ¬¡è®¨è®ºçš„å†…å®¹éšé£è€Œå»ï¼Œä¸å¦‚æ•´ç†æˆæ–‡ï¼Œå¸®åŠ©æ›´å¤šé‡åˆ°åŒæ ·å›°æƒ‘çš„æœ‹å‹ç†è§£åŸå› ã€‚</p>
<p>çŸ¥å…¶ç„¶ï¼Œæ›´çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p>
<p>è€å¿ƒçœ‹å®Œï¼Œä½ ä¸€å®šæœ‰æ‰€æ”¶è·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12b4bdb6bed4152843b49071981191a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Y-r54Wk55CD55qE54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980179&amp;x-signature=kdIYWMhl4aVKmsVDSyp4Vf8p3XI%3D" alt="Pokemon GIF.gif" loading="lazy"/></p>
<h2 data-id="heading-1">æ­£æ–‡</h2>
<h3 data-id="heading-2">èŒè´£åˆ†ç¦»åŸåˆ™</h3>
<p>åœ¨ä¼ ç»Ÿçš„MVCæ¶æ„ä¸­ï¼ŒServiceå±‚å’ŒControllerå±‚å„è‡ªæ‰¿æ‹…ç€ä¸åŒçš„èŒè´£ã€‚</p>
<p>Serviceå±‚è´Ÿè´£ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œè€ŒControllerå±‚è´Ÿè´£HTTPè¯·æ±‚çš„å¤„ç†å’Œå“åº”æ ¼å¼çš„å°è£…ã€‚</p>
<p>å½“æˆ‘ä»¬å°†æ•°æ®åŒ…è£…æˆ <code>Result</code> å¯¹è±¡çš„ä»»åŠ¡äº¤ç»™ Service å±‚æ—¶ï¼Œæ„å‘³ç€ Service å±‚ä¸å†å•çº¯åœ°å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ç‰µæ¶‰åˆ°äº†æ•°æ®å¤„ç†å’Œå“åº”çš„éƒ¨åˆ†ã€‚</p>
<p>è¿™æ ·ä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘ä¸è¡¨ç°é€»è¾‘çš„è€¦åˆï¼Œé™ä½äº†ä»£ç çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>çœ‹ä¸€ä¸ªä¸æ¨èçš„å†™æ³•:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUserById(<span class="hljs-built_in">Long</span> id) {
        User user = userMapper.selectById(id);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">404</span>, ç”¨æˆ·ä¸å­˜åœ¨);
        }
        <span class="hljs-keyword">return</span> Result.success(user);
    }
}

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUser(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒService å±‚ä¸ä»…è´Ÿè´£ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿˜ç›´æ¥å¤„ç†äº†è¿”å›çš„ç»“æœã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦æ”¹å˜è¿”å›çš„æ ¼å¼ï¼Œæˆ–è€…è¿›è¡Œé”™è¯¯ä¿¡æ¯çš„æ ‡å‡†åŒ–ï¼Œæ‰€æœ‰ Service å±‚çš„æ–¹æ³•éƒ½éœ€è¦ä¿®æ”¹ã€‚è¿™æ ·ä¼šå¯¼è‡´ä»£ç çš„é«˜è€¦åˆã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä»¥ä¸‹åšæ³•å°†å±•ç¤ºé€»è¾‘ç•™ç»™ Controller å±‚ï¼Œä¿è¯äº†ä¸šåŠ¡é€»è¾‘çš„çº¯ç²¹æ€§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> User getUserById(<span class="hljs-built_in">Long</span> id) {
        User user = userMapper.selectById(id);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> new BusinessException(ç”¨æˆ·ä¸å­˜åœ¨);
        }
        <span class="hljs-keyword">return</span> user;
    }
}

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;User&gt; getUser(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        User user = userService.getUserById(id);
        <span class="hljs-keyword">return</span> Result.success(user);
    }
}
</code></pre>
<p>è®©æ¯ä¸€å±‚éƒ½ä¸“æ³¨äºè‡ªå·±çš„èŒè´£ã€‚</p>
<h3 data-id="heading-3">å¯å¤ç”¨æ€§é—®é¢˜</h3>
<p>å½“Serviceå±‚è¿”å›Resultæ—¶ï¼Œä¼šä¸¥é‡å½±å“æ–¹æ³•çš„å¯å¤ç”¨æ€§ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class OrderService {
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    public void <span class="hljs-built_in">createOrder</span>(Long userId, OrderDTO orderDTO) {
        <span class="hljs-comment">// ä¸æ¨èçš„æ–¹å¼:éœ€è¦è§£åŒ…Result</span>
        Result&lt;User&gt; userResult = userService<span class="hljs-selector-class">.getUserById</span>(userId);
        if (!userResult.isSuccess()) {
            throw new <span class="hljs-built_in">BusinessException</span>(userResult.getMessage());
        }
        User user = userResult<span class="hljs-selector-class">.getData</span>();
        
        <span class="hljs-comment">// åç»­ä¸šåŠ¡é€»è¾‘</span>
        <span class="hljs-built_in">validateUserStatus</span>(user);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>è¿™ç§å†™æ³•æœ‰ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ã€‚</p>
<p><code>OrderService</code> ä½œä¸ºå¦ä¸€ä¸ªä¸šåŠ¡æœåŠ¡ï¼Œä¸šåŠ¡ä¹‹é—´çš„è°ƒç”¨æœ¬æ¥åº”è¯¥ç®€å•ç›´æ¥ï¼Œä½†ä½¿ç”¨ <code>Result</code> å¸¦æ¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p>ä¸çŸ¥é“ <code>Result</code> é‡Œåˆ°åº•åŒ…å«ä»€ä¹ˆï¼Œè¿˜å¾—å»æŸ¥çœ‹ä»£ç é‡Œé¢çš„å®ç°ï¼Œå†™èµ·æ¥éº»çƒ¦ã€‚</p>
</li>
<li>
<p>è¿˜éœ€è¦é¢å¤–åˆ¤æ–­ <code>Result</code> çš„çŠ¶æ€ï¼Œå¢åŠ äº†ä¸å¿…è¦çš„å¤æ‚åº¦ã€‚</p>
</li>
</ol>
<p>å¦‚æœæ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹å¤–éƒ¨æœåŠ¡ï¼Œéœ€è¦è¿™ç§åŒ…è£…è¿˜èƒ½ç†è§£ï¼Œä½†åœ¨è‡ªå·±ä¸šåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨æ—¶ï¼Œå®Œå…¨æ²¡å¿…è¦è¿™æ ·åšã€‚</p>
<p>å¦‚æœServiceè¿”å›çº¯ä¸šåŠ¡å¯¹è±¡:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, OrderDTO orderDTO)</span> {
        <span class="hljs-comment">// æ¨èçš„æ–¹å¼:ç›´æ¥è·å–ä¸šåŠ¡å¯¹è±¡</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserById(userId);
        
        <span class="hljs-comment">// åç»­ä¸šåŠ¡é€»è¾‘</span>
        validateUserStatus(user);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>ä»£ç å˜å¾—ç®€æ´ä¸”ç¬¦åˆç›´è§‰ã€‚</p>
<p>ä¸šåŠ¡å±‚ä¹‹é—´ç›´æ¥ä¼ é€’ä¸šåŠ¡å¯¹è±¡ï¼Œä¿æŒç®€å•å’Œæ¸…æ™°ã€‚</p>
<h3 data-id="heading-4">å¼‚å¸¸å¤„ç†æœºåˆ¶</h3>
<p>æœ‰äº› Service å±‚åœ¨ä¸šåŠ¡åˆ¤æ–­å¤±è´¥åï¼Œä¼šç›´æ¥è¿”å› <code>Result.fail(xxx)</code> è¿™æ ·çš„ä»£ç ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, OrderDTO orderDTO)</span> {
    <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
    }
    <span class="hljs-comment">// åç»­ä¸šåŠ¡é€»è¾‘</span>
    <span class="hljs-keyword">return</span> Result.success();
}
</code></pre>
<p>è¿™ç§åšæ³•æœ‰å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>é‡å¤çš„é”™è¯¯å¤„ç†</strong>ï¼šæ¯ä¸ªæ–¹æ³•éƒ½å¾—å†™ä¸€å¤§å †ç±»ä¼¼çš„é”™è¯¯åˆ¤æ–­ä»£ç ï¼Œå¢åŠ äº†ä»£ç é‡ã€‚</p>
</li>
<li>
<p><strong>é”™è¯¯åˆ†æ•£</strong>ï¼šé”™è¯¯å¤„ç†åˆ†æ•£åœ¨æ¯ä¸ªæ–¹æ³•é‡Œï¼Œå¦‚æœéœ€è¦æ”¹è¿›é”™è¯¯é€»è¾‘ï¼Œè¦åœ¨å¤šä¸ªåœ°æ–¹ä¿®æ”¹ï¼Œéº»çƒ¦ä¸”å®¹æ˜“å‡ºé”™ã€‚</p>
</li>
</ol>
<p>è€Œå¦‚æœæˆ‘ä»¬é€šè¿‡æŠ›å‡ºå¼‚å¸¸å¹¶ç»“åˆå…¨å±€å¼‚å¸¸å¤„ç†æ¥ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params">Long userId, OrderDTO orderDTO</span>) {
    <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
    }
    <span class="hljs-comment">// åç»­ä¸šåŠ¡é€»è¾‘</span>
}
</code></pre>
<p>å†é€šè¿‡å…¨å±€å¼‚å¸¸æ•è·æ¥è½¬æ¢ä¸º <code>Result</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    <span class="hljs-meta">@ExceptionHandler(BusinessException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; handleBusinessException(BusinessException e) {
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">400</span>, e.getMessage());
    }

    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; handleException(Exception e) {
        log.error(<span class="hljs-string">"ç³»ç»Ÿå¼‚å¸¸"</span>, e);  <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æŸ¥çœ‹å †æ ˆä¿¡æ¯</span>
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">500</span>, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™"</span>);
    }
}
</code></pre>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>
<p><strong>å‡å°‘é‡å¤ä»£ç </strong>ï¼šä¸šåŠ¡æ–¹æ³•ä¸å†éœ€è¦å†™é‡å¤çš„é”™è¯¯åˆ¤æ–­ï¼Œä»£ç æ›´ç®€æ´ã€‚</p>
</li>
<li>
<p><strong>é›†ä¸­é”™è¯¯å¤„ç†</strong>ï¼šé”™è¯¯å¤„ç†é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä¿®æ”¹æ—¶åªéœ€ä¿®æ”¹å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä¸ç”¨æ”¹åŠ¨æ¯ä¸ª Service å±‚æ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>ä¸šåŠ¡ä¸é”™è¯¯åˆ†ç¦»</strong>ï¼šä¸šåŠ¡é€»è¾‘ä¸“æ³¨å¤„ç†æ ¸å¿ƒåŠŸèƒ½ï¼Œé”™è¯¯å¤„ç†äº¤ç»™ç»Ÿä¸€çš„æœºåˆ¶ï¼Œä»£ç æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚</p>
</li>
</ul>
<p>è€Œä¸”å¼‚å¸¸å¯ä»¥æºå¸¦æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚æœä¸šåŠ¡ä¾§éœ€è¦æ—¶ï¼Œå¯ä»¥å¸¦ä¸Šå †æ ˆä¿¡æ¯ï¼Œä¾¿äºä¸€äº›é—®é¢˜çš„å®šä½ã€‚</p>
<h3 data-id="heading-5">æµ‹è¯•ä¾¿åˆ©æ€§</h3>
<p>Serviceå±‚è¿”å›ä¸šåŠ¡å¯¹è±¡è€Œä¸æ˜¯Resultæ—¶ï¼Œèƒ½å¤Ÿå¤§å¤§æå‡å•å…ƒæµ‹è¯•çš„ä¾¿åˆ©æ€§:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@SpringBootTest</span>
public class UserServiceTest {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-keyword">@Test</span>
    public void testGetUserById() {
        <span class="hljs-comment">// æ¨èçš„æ–¹å¼:ç›´æ¥æ–­è¨€ä¸šåŠ¡å¯¹è±¡</span>
        User user = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
        <span class="hljs-built_in">assertNotNull</span>(user);
        <span class="hljs-built_in">assertEquals</span>(å¼ ä¸‰, user.getName());
    }
    
    <span class="hljs-keyword">@Test</span>
    public void testGetUserById_NotFound() {
        <span class="hljs-comment">// æ¨èçš„æ–¹å¼:æ–­è¨€æŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-built_in">assertThrows</span>(BusinessException.class, () -&gt; {
            userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">999</span>L);
        });
    }
}
</code></pre>
<p>å¦‚æœServiceè¿”å›Resultï¼Œæµ‹è¯•ä»£ç åˆ™éœ€è¦å†™å¾—æ›´å¤æ‚:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
public void testGetUserById() {
    <span class="hljs-comment">// ä¸æ¨èçš„æ–¹å¼:éœ€è¦è§£åŒ…Result</span>
    Result&lt;User&gt; result = userService<span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
    <span class="hljs-built_in">assertTrue</span>(result.isSuccess());
    <span class="hljs-built_in">assertNotNull</span>(result.getData());
    <span class="hljs-built_in">assertEquals</span>(å¼ ä¸‰, result.getData()<span class="hljs-selector-class">.getName</span>());
}
</code></pre>
<p>æµ‹è¯•ä»£ç å˜å¾—è«åå†—é•¿ï¼Œè¿˜å¾—å»å…³æ³¨å“åº”ç»“æ„ï¼Œè¿™å¹¶ä¸æ˜¯Serviceå±‚æµ‹è¯•çš„å…³æ³¨ç‚¹ã€‚</p>
<p>Service å±‚æœ¬åº”ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œæµ‹è¯•ä¹Ÿåº”è¯¥ç›´æ¥éªŒè¯ä¸šåŠ¡æ•°æ®ã€‚</p>
<h3 data-id="heading-6">é¢†åŸŸé©±åŠ¨è®¾è®¡è§’åº¦</h3>
<p>å†æ¢ä¸ªè§’åº¦ã€‚</p>
<p>ä»é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„è§’åº¦æ¥çœ‹ï¼ŒService å±‚å±äºåº”ç”¨å±‚æˆ–é¢†åŸŸå±‚ï¼Œåº”è¯¥ä½¿ç”¨é¢†åŸŸè¯­è¨€æ¥è¡¨è¾¾ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>è€Œ <code>Result</code> æ˜¯åŸºç¡€è®¾æ–½å±‚çš„æ¦‚å¿µï¼Œä»£è¡¨ HTTP å“åº”æ ¼å¼ï¼Œä¸åº”è¯¥æ±¡æŸ“é¢†åŸŸå±‚ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘è½¬è´¦ä¸šåŠ¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class TransferService {
    
    public TransferResult <span class="hljs-built_in">transfer</span>(Long fromAccountId, Long toAccountId, BigDecimal amount) {
        Account fromAccount = accountRepository<span class="hljs-selector-class">.findById</span>(fromAccountId);
        Account toAccount = accountRepository<span class="hljs-selector-class">.findById</span>(toAccountId);
        
        fromAccount<span class="hljs-selector-class">.deduct</span>(amount);
        toAccount<span class="hljs-selector-class">.deposit</span>(amount);
        
        accountRepository<span class="hljs-selector-class">.save</span>(fromAccount);
        accountRepository<span class="hljs-selector-class">.save</span>(toAccount);
        
        return new <span class="hljs-built_in">TransferResult</span>(fromAccount, toAccount, amount);
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>TransferResult</code> æ˜¯ä¸€ä¸ªé¢†åŸŸå¯¹è±¡ï¼Œä»£è¡¨äº†è½¬è´¦çš„ç»“æœï¼ŒåŒ…å«äº†ä¸ä¸šåŠ¡ç›¸å…³çš„æ„ä¹‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé€šç”¨çš„ HTTP å“åº”å°è£… <code>Result</code>ã€‚</p>
<p>è¿™ç§åšæ³•æ›´ç¬¦åˆé¢†åŸŸæ¨¡å‹çš„è¡¨è¾¾ï¼Œä½“ç°äº†é¢†åŸŸå±‚çš„èŒè´£â€”â€”å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯æ¶‰åŠ HTTP å“åº”æ ¼å¼çš„ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-7">æ¥å£é€‚é…çš„çµæ´»æ€§</h3>
<p>å½“ Service å±‚è¿”å›çº¯ç²¹çš„ä¸šåŠ¡å¯¹è±¡æ—¶ï¼ŒController å±‚å¯ä»¥æ ¹æ®ä¸åŒçš„æ¥å£éœ€æ±‚çµæ´»å°è£…å“åº”ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api"</span>)
public class UserController {
    
    <span class="hljs-variable">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-comment">// RESTæ¥å£è¿”å›Result</span>
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
    public Result&lt;User&gt; <span class="hljs-built_in">getUser</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(user);
    }
    
    <span class="hljs-comment">// GraphQLæ¥å£ç›´æ¥è¿”å›å¯¹è±¡</span>
    @<span class="hljs-selector-tag">QueryMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span>(<span class="hljs-variable">@Argument</span> Long id) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
    }
    
    <span class="hljs-comment">// RPCæ¥å£è¿”å›è‡ªå®šä¹‰æ ¼å¼</span>
    @<span class="hljs-selector-tag">DubboService</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserRpcServiceImpl</span> <span class="hljs-selector-tag">implements</span> <span class="hljs-selector-tag">UserRpcService</span> {
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">UserDTO</span> <span class="hljs-selector-tag">getUserById</span>(Long id) {
            <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserById</span>(id);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">convertToDTO</span>(user);
        }
    }
}
</code></pre>
<p>åŒä¸€ä¸ªServiceæ–¹æ³•å¯ä»¥è¢«ä¸åŒç±»å‹çš„æ¥å£å¤ç”¨ï¼Œæ¯ä¸ªæ¥å£æ ¹æ®è‡ªå·±çš„åè®®è¦æ±‚å°è£…å“åº”ã€‚</p>
<p>å¼ºè¡Œä½¿ç”¨ <code>Result</code> ä¼šå¯¼è‡´æ¥å£çš„é€‚é…æ€§å˜å·®ï¼Œæ— æ³•æ ¹æ®ä¸åŒåè®®çš„éœ€æ±‚çµæ´»å®šåˆ¶å“åº”æ ¼å¼ã€‚</p>
<p>çµæ´»æ€§åè€Œä¸¢å¤±äº†ã€‚</p>
<h3 data-id="heading-8">äº‹åŠ¡è¾¹ç•Œæ¸…æ™°</h3>
<p>Service å±‚é€šå¸¸æ˜¯äº‹åŠ¡è¾¹ç•Œæ‰€åœ¨ï¼Œå½“ Service è¿”å›ä¸šåŠ¡å¯¹è±¡æ—¶ï¼Œäº‹åŠ¡çš„è¯­ä¹‰æ›´åŠ æ¸…æ™°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class OrderService {
    
    <span class="hljs-keyword">@Transactional</span>
    public Order createOrder(OrderDTO orderDTO) {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-comment">// è®¾ç½®è®¢å•å±æ€§</span>
        orderMapper<span class="hljs-selector-class">.insert</span>(order);
        
        <span class="hljs-comment">// æ‰£å‡åº“å­˜</span>
        inventoryService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
        
        return <span class="hljs-attribute">order</span>;
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹åŠ¡æ˜¯å›´ç»• Service å±‚çš„æ–¹æ³•å±•å¼€çš„ï¼Œ<code>@Transactional</code> æ³¨è§£ç¡®ä¿åœ¨ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå¤±è´¥æ—¶ï¼Œäº‹åŠ¡ä¼šå›æ»šã€‚å› ä¸ºæ–¹æ³•æ­£å¸¸è¿”å›æ—¶ï¼Œäº‹åŠ¡ä¼šæäº¤ï¼›å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šå›æ»šï¼Œäº‹åŠ¡çš„è¾¹ç•Œéå¸¸æ˜ç¡®ã€‚</p>
<p>å¦‚æœ Service è¿”å›çš„æ˜¯ <code>Result</code>ï¼Œå¾ˆéš¾ç•Œå®šäº‹åŠ¡æ˜¯å¦åº”è¯¥å›æ»šã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">public Result&lt;<span class="hljs-attribute">Order</span>&gt; <span class="hljs-built_in">createOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-comment">// è®¾ç½®è®¢å•å±æ€§</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    
    <span class="hljs-comment">// æ‰£å‡åº“å­˜</span>
    Result&lt;Void&gt; inventoryResult = inventoryService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!inventoryResult.isSuccess()) {
        return Result<span class="hljs-selector-class">.fail</span>("åº“å­˜ä¸è¶³");
    }
    
    return Result<span class="hljs-selector-class">.success</span>(order);
}
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåº“å­˜ä¸è¶³ï¼Œè™½ç„¶ <code>Result</code> è¿”å›å¤±è´¥ä¿¡æ¯ï¼Œä½†äº‹åŠ¡å¹¶ä¸ä¼šå›æ»šï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œåè€Œè¿˜å¾—é¢å¤–å»æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è€Œé€šè¿‡æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼ï¼Œäº‹åŠ¡çš„å›æ»šè¯­ä¹‰éå¸¸æ¸…æ™°ï¼šå¼‚å¸¸æŠ›å‡ºåˆ™å›æ»šï¼Œæ–¹æ³•æ­£å¸¸è¿”å›åˆ™æäº¤ï¼Œè¿™ç§è®¾è®¡ç¡®ä¿äº†äº‹åŠ¡çš„è¾¹ç•Œæ›´åŠ æ˜ç¡®ï¼Œé¿å…äº†æ½œåœ¨çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<h2 data-id="heading-9">å†™åœ¨æœ€å</h2>
<p>çœ‹æ¥é˜¿åŸè¦èµ°çš„è·¯è¿˜å¾ˆé•¿ï¼Œç è·¯æ¼«æ¼«ï¼Œè¸æµªå‰è¡Œã€‚</p>
<p>2026å¹´ï¼Œç¥å¤§å®¶åŠ ç­å°‘ï¼Œè–ªæ°´å¤šï¼Œbugå°‘ï¼Œå¤´å‘å¤šï¼Œå¤šå†™ç‚¹æ³¨é‡Šï¼Œå°‘èµ°ç‚¹å¼¯è·¯ã€‚</p>
<p>äººç”Ÿå°±åƒä¸€ä¸ªå¤§é¡¹ç›®ï¼Œéœ€æ±‚å¤šï¼Œæ—¶é—´ç´§ï¼Œä½†æ²¡å…³ç³»â€”â€”bug å’Œå¤´å‘æ€»æœ‰ä¸€ä¸ªä¼šå…ˆæ¥ã€‚</p>
<p>ğŸ¤£</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿™ 5 ä¸ªå†·é—¨ HTML æ ‡ç­¾ï¼Œè®©æˆ‘ç›´æ¥åˆ äº†100 è¡Œ JS ä»£ç ï¼]]></title>    <link>https://juejin.cn/post/7594742976712179746</link>    <guid>https://juejin.cn/post/7594742976712179746</guid>    <pubDate>2026-01-14T02:41:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594742976712179746" data-draft-id="7585502118460129299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿™ 5 ä¸ªå†·é—¨ HTML æ ‡ç­¾ï¼Œè®©æˆ‘ç›´æ¥åˆ äº†100 è¡Œ JS ä»£ç ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,HTML"/> <meta itemprop="datePublished" content="2026-01-14T02:41:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿™ 5 ä¸ªå†·é—¨ HTML æ ‡ç­¾ï¼Œè®©æˆ‘ç›´æ¥åˆ äº†100 è¡Œ JS ä»£ç ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T02:41:17.000Z" title="Wed Jan 14 2026 02:41:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å†™å‰ç«¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®ç°çš„æ¯”è¾ƒå¤šçš„ä¸€äº›åŸºç¡€äº¤äº’ï¼Œæ¯”å¦‚æŠ˜å é¢æ¿ã€å¼¹çª—ã€è¾“å…¥æç¤ºã€è¿›åº¦æ¡æˆ–é¢œè‰²é€‰æ‹©ç­‰ç­‰ï¼Œä¼šä¸å¾—ä¸å¼•å…¥ <code>JavaScript</code>ã€‚</p>
<p>ä½†å…¶å®ï¼Œ<code>HTML</code> è‡ªå·±ä¹Ÿå†…ç½®äº†ä¸å°‘åŠŸèƒ½å¼ºå¤§çš„åŸç”Ÿæ ‡ç­¾ï¼Œå®ƒä»¬å¼€ç®±å³ç”¨ã€è¯­ä¹‰æ¸…æ™°ï¼Œè¿˜èƒ½å¤§å¹…å‡å°‘ JS çš„ä»£ç é‡ã€‚</p>
<p>ä¸‹é¢ä»‹ç» 5 ä¸ªå†·é—¨ä½†å®ç”¨çš„ <code>HTML</code> æ ‡ç­¾ã€‚</p>
<h3 data-id="heading-0">1. <code>&lt;details&gt;</code> å’Œ <code>&lt;summary&gt;</code> - å¯æŠ˜å å†…å®¹</h3>
<p><strong>æ›¿ä»£</strong>ï¼š æ‰‹é£ç´æ•ˆæœã€æŠ˜å é¢æ¿ã€FAQéƒ¨åˆ†</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">details</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>éšè—çš„å†…å®¹ï¼Œæ— éœ€JSå®ç°å±•å¼€/æ”¶èµ·<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
</code></pre>
<p>å®ç°æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4332f880c9f64ab4b9fcafb234a12c27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768963277&amp;x-signature=3ai8IB0L%2F3Fb9RigCh9I4eK%2FxtE%3D" alt="" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>FAQ æŠ˜å é¢æ¿</li>
<li>è®¾ç½®é¡¹åˆ†ç»„å±•å¼€</li>
<li>ç§»åŠ¨ç«¯â€œæŸ¥çœ‹æ›´å¤šâ€åŒºåŸŸ</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>é»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼›æ·»åŠ  <code>open</code> å±æ€§å¯é»˜è®¤å±•å¼€ï¼š<code>&lt;details open&gt;</code></li>
<li>å¯é€šè¿‡ CSS çš„ <code>details[open]</code> é€‰æ‹©å™¨å®šåˆ¶å±•å¼€æ ·å¼</li>
<li>æ”¯æŒé”®ç›˜æ“ä½œï¼ˆEnter/Space è§¦å‘ï¼‰ï¼Œæ— éšœç¢å‹å¥½</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. <code>&lt;dialog&gt;</code> - åŸç”Ÿå¯¹è¯æ¡†</h3>
<p><strong>æ›¿ä»£</strong>ï¼šdivæ¨¡æ‹Ÿæ¨¡æ€æ¡† + èƒŒæ™¯é®ç½© + å…³é—­é€»è¾‘</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"modal"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™æ˜¯åŸç”Ÿå¼¹çª—<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"document.getElementById('modal').close()"</span>&gt;</span>å…³é—­<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"document.getElementById('modal').showModal()"</span>&gt;</span>æ‰“å¼€å¼¹çª—<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>å®ç°æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8822947f13c04a07a2c7a064f7ac8405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768963277&amp;x-signature=iJDX7Es4eqMHQ6TIrhP9kOR0%2Fc8%3D" alt="" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>ç¡®è®¤æç¤ºæ¡†</li>
<li>ç™»å½•/æ³¨å†Œå¼¹çª—</li>
<li>ä¸´æ—¶ä¿¡æ¯å±•ç¤º</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li><code>.showModal()</code> ä¼šè‡ªåŠ¨åˆ›å»ºåŠé€æ˜é®ç½©ï¼ˆå¯é€šè¿‡ <code>::backdrop</code> è‡ªå®šä¹‰ï¼‰</li>
<li><code>.show()</code> æ˜¯éæ¨¡æ€æ˜¾ç¤ºï¼ˆä¸é”å®šèƒŒæ™¯ï¼‰</li>
<li>èšç„¦è‡ªåŠ¨ç®¡ç†ï¼šæ‰“å¼€æ—¶èšç„¦ç¬¬ä¸€ä¸ªå¯èšç„¦å…ƒç´ ï¼Œå…³é—­åç„¦ç‚¹è¿”å›è§¦å‘æŒ‰é’®</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šChrome/Firefox/Edge æ”¯æŒè‰¯å¥½ï¼›Safari 15.4+ æ”¯æŒï¼›IE ä¸æ”¯æŒ</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. <code>&lt;datalist&gt;</code> - è¾“å…¥å»ºè®®åˆ—è¡¨</h3>
<p><strong>æ›¿ä»£</strong>ï¼šç›‘å¬inputäº‹ä»¶ + åŠ¨æ€ç”Ÿæˆä¸‹æ‹‰åˆ—è¡¨</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">list</span>=<span class="hljs-string">"browsers"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"é€‰æ‹©æˆ–è¾“å…¥æµè§ˆå™¨"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">datalist</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"browsers"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Chrome"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Firefox"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Safari"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">datalist</span>&gt;</span>
</code></pre>
<p>å®ç°æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/026b76c26bde4165b559992c80d35861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768963277&amp;x-signature=PpSMu86Sd4U2ZBE7QVsaeT18u3A%3D" alt="" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æœç´¢å»ºè®®ï¼ˆéå¼ºåˆ¶é€‰é¡¹ï¼‰</li>
<li>è¡¨å•å­—æ®µé¢„å¡«ï¼ˆå¦‚åŸå¸‚ã€äº§å“åï¼‰</li>
<li>å¿«é€Ÿè¾“å…¥è¾…åŠ©</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>ç”¨æˆ·ä»å¯è¾“å…¥ä¸åœ¨åˆ—è¡¨ä¸­çš„å€¼ï¼ˆä¸ <code>&lt;select&gt;</code> ä¸åŒï¼‰</li>
<li>æµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ®è¾“å…¥è¿‡æ»¤åŒ¹é…é¡¹</li>
<li>ç§»åŠ¨ç«¯ä¼šè°ƒå‡ºå¸¦å»ºè®®çš„è½¯é”®ç›˜ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-3">4. <code>&lt;meter&gt;</code> &amp; <code>&lt;progress&gt;</code> - è¿›åº¦æŒ‡ç¤ºå™¨</h3>
<p><strong>æ›¿ä»£</strong>ï¼šdivæ¨¡æ‹Ÿè¿›åº¦æ¡ + JSæ›´æ–°å®½åº¦</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å·²çŸ¥èŒƒå›´å†…çš„æ ‡é‡å€¼ï¼ˆå¦‚ç£ç›˜ä½¿ç”¨ç‡ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meter</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"70"</span>&gt;</span>70%<span class="hljs-tag">&lt;/<span class="hljs-name">meter</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ä»»åŠ¡å®Œæˆè¿›åº¦ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">progress</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"100"</span>&gt;</span>50%<span class="hljs-tag">&lt;/<span class="hljs-name">progress</span>&gt;</span>
</code></pre>
<p>å®ç°æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf4799c12d604730862b0b27461073c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768963277&amp;x-signature=f8%2FSFQ0ZFNdxfwaWrOY122tU%2BYA%3D" alt="" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æœç´¢å»ºè®®ï¼ˆéå¼ºåˆ¶é€‰é¡¹ï¼‰</li>
<li>è¡¨å•å­—æ®µé¢„å¡«ï¼ˆå¦‚åŸå¸‚ã€äº§å“åï¼‰</li>
<li>å¿«é€Ÿè¾“å…¥è¾…åŠ©</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>ç”¨æˆ·ä»å¯è¾“å…¥ä¸åœ¨åˆ—è¡¨ä¸­çš„å€¼ï¼ˆä¸ <code>&lt;select&gt;</code> ä¸åŒï¼‰</li>
<li>æµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ®è¾“å…¥è¿‡æ»¤åŒ¹é…é¡¹</li>
<li>ç§»åŠ¨ç«¯ä¼šè°ƒå‡ºå¸¦å»ºè®®çš„è½¯é”®ç›˜ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. <code>&lt;input type="color"&gt;</code> - é¢œè‰²é€‰æ‹©å™¨</h3>
<p><strong>æ›¿ä»£</strong>ï¼šè‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨UI + è‰²å€¼è½¬æ¢é€»è¾‘</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"color"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"#ff0000"</span>&gt;</span>
</code></pre>
<p>å®ç°æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10bcdc1c50a647d7a31785379a3d7beb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768963277&amp;x-signature=mRioHCIwj%2BluPZ8s7KBSgrjb%2FAk%3D" alt="" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>ä¸»é¢˜é…è‰²è®¾ç½®</li>
<li>å›¾è¡¨é¢œè‰²é…ç½®</li>
<li>è®¾è®¡å·¥å…·ä¸­çš„æ‹¾è‰²åŠŸèƒ½</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>è¿”å›å€¼å§‹ç»ˆä¸º <strong>å°å†™ 7 ä½åå…­è¿›åˆ¶</strong>ï¼ˆå¦‚ <code>#ff5733</code>ï¼‰</li>
<li>ç§»åŠ¨ç«¯ä¼šè°ƒå‡ºç³»ç»Ÿçº§é¢œè‰²é€‰æ‹©å™¨</li>
<li>æ— æ³•è‡ªå®šä¹‰ UIï¼Œä½†å¯é€šè¿‡ <code>::-webkit-color-swatch</code> å¾®è°ƒæ ·å¼ï¼ˆæœ‰é™ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-5">æ€»ç»“</h3>
<ul>
<li><code>&lt;details&gt;</code> / <code>&lt;summary&gt;</code>ï¼šå®ç°æŠ˜å å†…å®¹</li>
<li><code>&lt;dialog&gt;</code>ï¼šåŸç”Ÿå¼¹çª—ï¼Œè‡ªå¸¦é®ç½©å’Œç„¦ç‚¹ç®¡ç†</li>
<li><code>&lt;datalist&gt;</code>ï¼šè¾“å…¥å»ºè®®é€‰æ‹©</li>
<li><code>&lt;meter&gt;</code> / <code>&lt;progress&gt;</code>ï¼šè¿›åº¦å±•ç¤ºæ— éœ€æ‰‹åŠ¨è®¡ç®—å®½åº¦</li>
<li><code>&lt;input type="color"&gt;</code>ï¼šç³»ç»Ÿçº§é¢œè‰²é€‰æ‹©å™¨å¼€ç®±å³ç”¨</li>
</ul>
<p>è¿™äº›åŸç”Ÿ <code>HTML</code> æ ‡ç­¾è™½ç„¶ä¸å¤ªèµ·çœ¼ï¼Œä½†ç”¨å¥½å®ƒä»¬ï¼Œä¸ä»…èƒ½<strong>çœå»å¤§é‡ JavaScript é€»è¾‘</strong>ï¼Œè¿˜èƒ½è®©é¡µé¢æ›´è¯­ä¹‰åŒ–ã€æ›´å‹å¥½ã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£MessageChannelï¼šJSåŒå‘é€šä¿¡çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7595232643464118306</link>    <guid>https://juejin.cn/post/7595232643464118306</guid>    <pubDate>2026-01-15T07:02:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595232643464118306" data-draft-id="7595120207737520162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£MessageChannelï¼šJSåŒå‘é€šä¿¡çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-15T07:02:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§çŸ¥é—²é—²i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£MessageChannelï¼šJSåŒå‘é€šä¿¡çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§çŸ¥é—²é—²i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:02:09.000Z" title="Thu Jan 15 2026 07:02:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>===</p>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œè·¨æ‰§è¡Œç¯å¢ƒçš„é€šä¿¡æ˜¯å¸¸è§éœ€æ±‚â€”â€”æ¯”å¦‚ä¸»çº¿ç¨‹ä¸Web Workeré—´çš„æ•°æ®äº¤äº’ã€iframeä¸çˆ¶é¡µé¢çš„æ¶ˆæ¯ä¼ é€’ç­‰ã€‚ä¼ ç»Ÿçš„å…¨å±€äº‹ä»¶ç›‘å¬æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨å¤æ‚åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°æ¶ˆæ¯å†²çªã€æ€§èƒ½ä½ä¸‹ç­‰é—®é¢˜ã€‚<code>MessageChannel</code>ä½œä¸ºJavaScriptåŸç”Ÿæä¾›çš„åŒå‘é€šä¿¡APIï¼Œä¸ºè¿™ç±»åœºæ™¯æä¾›äº†è½»é‡ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥è§£æ<code>MessageChannel</code>çš„å·¥ä½œåŸç†ã€æ ¸å¿ƒä¼˜åŠ¿åŠå®é™…åº”ç”¨ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€MessageChannelæ ¸å¿ƒæ¦‚å¿µï¼šå»ºç«‹ä¸“å±é€šä¿¡é€šé“</h2>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯MessageChannelï¼Ÿ</h3>
<p><code>MessageChannel</code>æ˜¯æµè§ˆå™¨æä¾›çš„åŸç”ŸAPIï¼Œç”¨äºåœ¨ä¸¤ä¸ªç‹¬ç«‹çš„JavaScriptæ‰§è¡Œç¯å¢ƒä¹‹é—´å»ºç«‹<strong>ä¸“å±çš„åŒå‘é€šä¿¡é€šé“</strong>ã€‚æ¯ä¸ªé€šé“åŒ…å«ä¸¤ä¸ªäº’ç›¸å…³è”çš„ç«¯å£ï¼ˆ<code>port1</code>å’Œ<code>port2</code>ï¼‰ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„é€šä¿¡é—­ç¯ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒç‰¹æ€§è§£æ</h3>
<ul>
<li>
<p><strong>åŒå‘é€šä¿¡</strong>ï¼šä¸¤ä¸ªç«¯å£å‡å¯å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå®ç°çœŸæ­£çš„åŒå‘å¯¹è¯</p>
</li>
<li>
<p><strong>ç‹¬ç«‹é€šé“</strong>ï¼šæ¯ä¸ªé€šé“éƒ½æ˜¯éš”ç¦»çš„ï¼Œä¸åŒé€šé“äº’ä¸å¹²æ‰°ï¼Œé¿å…æ¶ˆæ¯æ±¡æŸ“</p>
</li>
<li>
<p><strong>è·¨ç¯å¢ƒæ”¯æŒ</strong>ï¼šå¯åœ¨ä¸»çº¿ç¨‹ã€Web Workerã€iframeã€SharedWorkerç­‰ä»»æ„ç»„åˆé—´å»ºç«‹è¿æ¥</p>
</li>
<li>
<p><strong>å¼‚æ­¥æ— é˜»å¡</strong>ï¼šåŸºäºäº‹ä»¶æœºåˆ¶ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹æ‰§è¡Œ</p>
</li>
<li>
<p><strong>æ‰€æœ‰æƒè½¬ç§»</strong>ï¼šç«¯å£å¯ä»¥å®‰å…¨åœ°è½¬ç§»ç»™å…¶ä»–æ‰§è¡Œç¯å¢ƒ</p>
</li>
</ul>
<h3 data-id="heading-3">åŸºç¡€å·¥ä½œæµç¨‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. åˆ›å»ºé€šé“å®ä¾‹</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
<span class="hljs-keyword">const</span> { port1, port2 } = channel;
â€‹
<span class="hljs-comment">// 2. å°†ä¸€ä¸ªç«¯å£ä¼ é€’ç»™ç›®æ ‡ç¯å¢ƒ</span>
target.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [port2]);
â€‹
<span class="hljs-comment">// 3. ç›‘å¬ç«¯å£æ¶ˆæ¯</span>
port1.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ”¶åˆ°æ¶ˆæ¯:'</span>, event.<span class="hljs-property">data</span>);
};
â€‹
<span class="hljs-comment">// 4. å‘é€æ¶ˆæ¯</span>
port1.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Hello from port1'</span>);
â€‹
<span class="hljs-comment">// 5. å…³é—­ç«¯å£ï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-comment">// port1.close();</span>
</code></pre>
<h2 data-id="heading-4">äºŒã€MessageChannelå…¸å‹ä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-5">1. ä¸»çº¿ç¨‹ä¸Web Workerçš„é«˜æ•ˆé€šä¿¡</h3>
<p>Web Workerå¸¸ç”¨äºå¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä½†ä¼ ç»Ÿçš„<code>worker.postMessage()</code>æ–¹å¼å­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆç»“æ„åŒ–å…‹éš†ï¼‰ï¼Œé¢‘ç¹é€šä¿¡æ—¶å¼€é”€æ˜æ˜¾ã€‚</p>
<p><strong>MessageChannelè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>
<p>å»ºç«‹ä¸“å±é€šé“ï¼Œå‡å°‘åºåˆ—åŒ–å¼€é”€</p>
</li>
<li>
<p>å®ç°ç²¾å‡†çš„"ä¸€å¯¹ä¸€"é€šä¿¡</p>
</li>
<li>
<p>æ”¯æŒå¤æ‚çš„æ•°æ®ä¼ è¾“ï¼ˆå¦‚ArrayBufferã€ImageBitmapç­‰å¯è½¬ç§»å¯¹è±¡ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-6">2. çˆ¶é¡µé¢ä¸iframeçš„å®‰å…¨é€šä¿¡</h3>
<p><code>window.postMessage</code>è™½ç„¶èƒ½å®ç°è·¨åŸŸé€šä¿¡ï¼Œä½†å­˜åœ¨å®‰å…¨éšæ‚£ï¼š</p>
<ul>
<li>
<p>å…¨å±€ç›‘å¬å¯èƒ½è¢«æ¶æ„é¡µé¢åŠ«æŒ</p>
</li>
<li>
<p>å¤šiframeåœºæ™¯ä¸‹æ¶ˆæ¯æ¥æºéš¾ä»¥åŒºåˆ†</p>
</li>
<li>
<p>ç¼ºä¹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</p>
</li>
</ul>
<p><strong>MessageChannelä¼˜åŠ¿</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸ºæ¯ä¸ªiframeåˆ›å»ºç‹¬ç«‹é€šé“</span>
<span class="hljs-keyword">const</span> iframeChannels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
â€‹
<span class="hljs-keyword">function</span> <span class="hljs-title function_">connectToIframe</span>(<span class="hljs-params">iframeId</span>) {
  <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
  iframeChannels.<span class="hljs-title function_">set</span>(iframeId, channel.<span class="hljs-property">port1</span>);
  <span class="hljs-comment">// ä»…ç›®æ ‡iframeèƒ½æ¥æ”¶åˆ°ç«¯å£</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(iframeId).<span class="hljs-property">contentWindow</span>
    .<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'channel-init'</span>, <span class="hljs-string">'*'</span>, [channel.<span class="hljs-property">port2</span>]);
}
</code></pre>
<h3 data-id="heading-7">3. SharedWorkerå¤šé¡µé¢é€šä¿¡ç®¡ç†</h3>
<p>å½“å¤šä¸ªé¡µé¢å…±äº«åŒä¸€ä¸ªWorkeræ—¶ï¼ŒMessageChannelèƒ½ä¸ºæ¯ä¸ªé¡µé¢å»ºç«‹ç‹¬ç«‹çš„é€šä¿¡é“¾è·¯ï¼Œé¿å…æ¶ˆæ¯å¹¿æ’­å¸¦æ¥çš„æ··ä¹±ã€‚</p>
<h3 data-id="heading-8">4. å¼‚æ­¥ä»»åŠ¡è§£è€¦ä¸å°è£…</h3>
<p>åœ¨å¾®å‰ç«¯ã€æ’ä»¶åŒ–æ¶æ„ä¸­ï¼Œå¯é€šè¿‡MessageChannelå°†ç‹¬ç«‹æ¨¡å—å°è£…åœ¨éš”ç¦»ç¯å¢ƒä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ•°æ®å¤„ç†ä¸“ç”¨Worker</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">channel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">worker</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'processor.js'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupChannel</span>();
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">channel</span>.<span class="hljs-property">port1</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(e.<span class="hljs-property">data</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">channel</span>.<span class="hljs-property">port1</span>.<span class="hljs-title function_">postMessage</span>(data);
    });
  }
}
</code></pre>
<h3 data-id="heading-9">5. è·¨æ ‡ç­¾é¡µé€šä¿¡ä¼˜åŒ–</h3>
<p>ç»“åˆBroadcastChannelå®ç°è·¨æ ‡ç­¾é¡µçš„é«˜æ•ˆé€šä¿¡ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨BroadcastChannelå¹¿æ’­é€šé“å»ºç«‹è¯·æ±‚</p>
</li>
<li>
<p>é€šè¿‡MessageChannelå»ºç«‹ä¸“å±æ•°æ®é€šé“</p>
</li>
<li>
<p>è¿›è¡Œé«˜é¢‘æˆ–å¤§æ•°æ®é‡çš„ä¼ è¾“</p>
</li>
</ol>
<h2 data-id="heading-10">ä¸‰ã€å®æˆ˜ç¤ºä¾‹ï¼šæ ¸å¿ƒåœºæ™¯ä»£ç å®ç°</h2>
<h3 data-id="heading-11">ç¤ºä¾‹1ï¼šä¸»çº¿ç¨‹ä¸Web Workerçš„åŒå‘é€šä¿¡</h3>
<p><strong>ä¸»çº¿ç¨‹ä»£ç ï¼ˆmain.jsï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkerManager</span> {
  <span class="hljs-keyword">constructor</span>(workerUrl) {
    <span class="hljs-keyword">this</span>.worker = new Worker(workerUrl);
    <span class="hljs-keyword">this</span>.channel = new MessageChannel();
    <span class="hljs-keyword">this</span>.initChannel();
  }
  
  initChannel() {
    <span class="hljs-comment">// å°†port2ä¼ é€’ç»™Worker</span>
    <span class="hljs-keyword">this</span>.worker.postMessage(
      { type: <span class="hljs-string">'INIT_CHANNEL'</span> },
      [<span class="hljs-keyword">this</span>.channel.port2]
    );
    
    <span class="hljs-comment">// è®¾ç½®æ¶ˆæ¯ç›‘å¬</span>
    <span class="hljs-keyword">this</span>.channel.port1.onmessage = <span class="hljs-keyword">this</span>.handleMessage.bind(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.channel.port1.onmessageerror = <span class="hljs-keyword">this</span>.handleError.bind(<span class="hljs-keyword">this</span>);
  }
  
  handleMessage(event) {
    <span class="hljs-keyword">const</span> { type, <span class="hljs-keyword">data</span>, id } = event.<span class="hljs-keyword">data</span>;
    
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'RESULT'</span>) {
      <span class="hljs-comment">// å¤„ç†Workerè¿”å›çš„ç»“æœ</span>
      <span class="hljs-keyword">this</span>.pendingRequests.<span class="hljs-keyword">get</span>(id)?.resolve(<span class="hljs-keyword">data</span>);
      <span class="hljs-keyword">this</span>.pendingRequests.delete(id);
    }
  }
  
  async sendTask(taskData) {
    <span class="hljs-keyword">const</span> taskId = Date.now() + Math.random();
    
    <span class="hljs-keyword">return</span> new Promise((resolve, reject) =&gt; {
      <span class="hljs-keyword">this</span>.pendingRequests.<span class="hljs-keyword">set</span>(taskId, { resolve, reject });
      
      <span class="hljs-keyword">this</span>.channel.port1.postMessage({
        type: <span class="hljs-string">'EXECUTE_TASK'</span>,
        id: taskId,
        <span class="hljs-keyword">data</span>: taskData
      });
      
      <span class="hljs-comment">// è®¾ç½®è¶…æ—¶</span>
      setTimeout(() =&gt; {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pendingRequests.has(taskId)) {
          reject(new Error(<span class="hljs-string">'Worker timeout'</span>));
          <span class="hljs-keyword">this</span>.pendingRequests.delete(taskId);
        }
      }, <span class="hljs-number">5000</span>);
    });
  }
}
</code></pre>
<p><strong>Workerä»£ç ï¼ˆworker.jsï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> communicationPort = <span class="hljs-literal">null</span>;
â€‹
<span class="hljs-comment">// ç›‘å¬ä¸»çº¿ç¨‹åˆå§‹åŒ–</span>
self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">type</span>, ports } = event.<span class="hljs-property">data</span>;
  
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">'INIT_CHANNEL'</span> &amp;&amp; ports[<span class="hljs-number">0</span>]) {
    communicationPort = ports[<span class="hljs-number">0</span>];
    
    communicationPort.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-keyword">const</span> { <span class="hljs-keyword">type</span>, id, data } = event.<span class="hljs-property">data</span>;
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">'EXECUTE_TASK'</span>) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// æ‰§è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡</span>
          <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processData</span>(data);
          
          <span class="hljs-comment">// è¿”å›ç»“æœ</span>
          communicationPort.<span class="hljs-title function_">postMessage</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'RESULT'</span>,
            id,
            <span class="hljs-attr">data</span>: result
          });
        } <span class="hljs-keyword">catch</span> (error) {
          communicationPort.<span class="hljs-title function_">postMessage</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'ERROR'</span>,
            id,
            <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
          });
        }
      }
    };
  }
};
â€‹
<span class="hljs-comment">// æ•°æ®å¤„ç†å‡½æ•°</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-comment">// æ¨¡æ‹Ÿå¤æ‚è®¡ç®—</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">processed</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">summary</span>: <span class="hljs-string">`Processed <span class="hljs-subst">${data.length}</span> items`</span>
  };
}
</code></pre>
<h3 data-id="heading-12">ç¤ºä¾‹2ï¼šå®‰å…¨çš„iframeé€šä¿¡æ¶æ„</h3>
<p><strong>çˆ¶é¡µé¢æ§åˆ¶å™¨</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IframeCommunicator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">channels</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }
  
  <span class="hljs-title function_">registerIframe</span>(<span class="hljs-params">iframeElement, allowedOrigins</span>) {
    <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
    <span class="hljs-keyword">const</span> iframeId = iframeElement.<span class="hljs-property">id</span>;
    
    <span class="hljs-comment">// å­˜å‚¨é€šé“å¼•ç”¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">channels</span>.<span class="hljs-title function_">set</span>(iframeId, {
      <span class="hljs-attr">port</span>: channel.<span class="hljs-property">port1</span>,
      <span class="hljs-attr">iframe</span>: iframeElement,
      allowedOrigins
    });
    
    <span class="hljs-comment">// è®¾ç½®æ¶ˆæ¯ç›‘å¬</span>
    channel.<span class="hljs-property">port1</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleIncomingMessage</span>(iframeId, event);
    };
    
    <span class="hljs-comment">// ç­‰å¾…iframeåŠ è½½å®Œæˆåå‘é€ç«¯å£</span>
    iframeElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
      iframeElement.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'CHANNEL_INIT'</span>,
          iframeId
        },
        <span class="hljs-string">'*'</span>,
        [channel.<span class="hljs-property">port2</span>]
      );
    });
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">send</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>, data</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendToIframe</span>(iframeId, <span class="hljs-keyword">type</span>, data),
      <span class="hljs-attr">on</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>, handler</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerHandler</span>(iframeId, <span class="hljs-keyword">type</span>, handler)
    };
  }
  
  <span class="hljs-title function_">sendToIframe</span>(<span class="hljs-params">iframeId, <span class="hljs-keyword">type</span>, data</span>) {
    <span class="hljs-keyword">const</span> channel = <span class="hljs-variable language_">this</span>.<span class="hljs-property">channels</span>.<span class="hljs-title function_">get</span>(iframeId);
    <span class="hljs-keyword">if</span> (channel &amp;&amp; channel.<span class="hljs-property">port</span>) {
      channel.<span class="hljs-property">port</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-keyword">type</span>, data });
    }
  }
}
</code></pre>
<p><strong>iframeç«¯é€‚é…å™¨</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IframeBridge</span> {
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">this</span>.parentPort = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.handlers = new Map();
    
    window.addEventListener(<span class="hljs-string">'message'</span>, (event) =&gt; {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">data</span>.type === <span class="hljs-string">'CHANNEL_INIT'</span> &amp;&amp; event.ports[<span class="hljs-number">0</span>]) {
        <span class="hljs-keyword">this</span>.parentPort = event.ports[<span class="hljs-number">0</span>];
        
        <span class="hljs-keyword">this</span>.parentPort.onmessage = (messageEvent) =&gt; {
          <span class="hljs-keyword">const</span> { type, <span class="hljs-keyword">data</span> } = messageEvent.<span class="hljs-keyword">data</span>;
          <span class="hljs-keyword">this</span>.dispatchMessage(type, <span class="hljs-keyword">data</span>);
        };
        
        <span class="hljs-comment">// é€šçŸ¥çˆ¶é¡µé¢è¿æ¥å°±ç»ª</span>
        <span class="hljs-keyword">this</span>.send(<span class="hljs-string">'READY'</span>, { status: <span class="hljs-string">'connected'</span> });
      }
    });
  }
  
  send(type, <span class="hljs-keyword">data</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parentPort) {
      <span class="hljs-keyword">this</span>.parentPort.postMessage({ type, <span class="hljs-keyword">data</span> });
    }
  }
  
  on(type, handler) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.handlers.has(type)) {
      <span class="hljs-keyword">this</span>.handlers.<span class="hljs-keyword">set</span>(type, []);
    }
    <span class="hljs-keyword">this</span>.handlers.<span class="hljs-keyword">get</span>(type).push(handler);
  }
}
</code></pre>
<h2 data-id="heading-13">å››ã€é«˜çº§åº”ç”¨ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-14">1. é”™è¯¯å¤„ç†ä¸é‡è¿æœºåˆ¶</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustMessageChannel</span> {
  <span class="hljs-keyword">constructor</span>(target, options = {}) {
    <span class="hljs-keyword">this</span>.target = target;
    <span class="hljs-keyword">this</span>.maxRetries = options.maxRetries || <span class="hljs-number">3</span>;
    <span class="hljs-keyword">this</span>.reconnectDelay = options.reconnectDelay || <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">this</span>.retryCount = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">this</span>.setupChannel();
  }
  
  setupChannel() {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">this</span>.channel = new MessageChannel();
      <span class="hljs-keyword">this</span>.setupEventListeners();
      
      <span class="hljs-comment">// å‘é€ç«¯å£åˆ°ç›®æ ‡</span>
      <span class="hljs-keyword">this</span>.target.postMessage(<span class="hljs-string">'INIT'</span>, <span class="hljs-string">'*'</span>, [<span class="hljs-keyword">this</span>.channel.port2]);
      
      <span class="hljs-comment">// è®¾ç½®è¿æ¥è¶…æ—¶</span>
      <span class="hljs-keyword">this</span>.connectionTimeout = setTimeout(() =&gt; {
        <span class="hljs-keyword">this</span>.handleDisconnection();
      }, <span class="hljs-number">5000</span>);
      
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">this</span>.handleError(error);
    }
  }
  
  handleDisconnection() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.retryCount &lt; <span class="hljs-keyword">this</span>.maxRetries) {
      <span class="hljs-keyword">this</span>.retryCount++;
      setTimeout(() =&gt; <span class="hljs-keyword">this</span>.setupChannel(), <span class="hljs-keyword">this</span>.reconnectDelay);
    }
  }
}
</code></pre>
<h3 data-id="heading-15">2. æ¶ˆæ¯åºåˆ—åŒ–ä¸æ€§èƒ½ä¼˜åŒ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨Transferableå¯¹è±¡æå‡æ€§èƒ½</span>
function sendLargeBuffer(port, buffer) {
  <span class="hljs-comment">// æ ‡è®°ä¸ºå¯è½¬ç§»å¯¹è±¡ï¼Œé¿å…å¤åˆ¶</span>
  port.postMessage(
    { type: <span class="hljs-string">'LARGE_BUFFER'</span>, buffer },
    [buffer]
  );
}

<span class="hljs-comment">// æ‰¹é‡æ¶ˆæ¯å¤„ç†</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageBatcher</span> {
  <span class="hljs-keyword">constructor</span>(port, batchSize = <span class="hljs-number">10</span>) {
    <span class="hljs-keyword">this</span>.port = port;
    <span class="hljs-keyword">this</span>.batchSize = batchSize;
    <span class="hljs-keyword">this</span>.queue = [];
    <span class="hljs-keyword">this</span>.flushTimeout = <span class="hljs-literal">null</span>;
  }
  
  send(type, <span class="hljs-keyword">data</span>) {
    <span class="hljs-keyword">this</span>.queue.push({ type, <span class="hljs-keyword">data</span>, timestamp: Date.now() });
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.queue.length &gt;= <span class="hljs-keyword">this</span>.batchSize) {
      <span class="hljs-keyword">this</span>.flush();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.flushTimeout) {
      <span class="hljs-keyword">this</span>.flushTimeout = setTimeout(() =&gt; <span class="hljs-keyword">this</span>.flush(), <span class="hljs-number">50</span>);
    }
  }
  
  flush() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.queue.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.port.postMessage({
        type: <span class="hljs-string">'BATCH'</span>,
        messages: <span class="hljs-keyword">this</span>.queue
      });
      <span class="hljs-keyword">this</span>.queue = [];
    }
    clearTimeout(<span class="hljs-keyword">this</span>.flushTimeout);
    <span class="hljs-keyword">this</span>.flushTimeout = <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h3 data-id="heading-16">3. ç±»å‹å®‰å…¨çš„æ¶ˆæ¯é€šä¿¡</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä½¿ç”¨TypeScriptæˆ–JSDocå¢å¼ºç±»å‹å®‰å…¨</span>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@typedef</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">MessageProtocol</span>
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">'TASK' | 'RESULT' | 'ERROR'</span>} <span class="hljs-variable">type</span>
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">id</span>
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">any</span>} [data]
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">string</span>} [error]
 */</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedMessageChannel</span> {
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">MessagePort</span>} port 
   */</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">port</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span> = port;
  }
  
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">'TASK' | 'RESULT' | 'ERROR'</span>} <span class="hljs-variable">type</span>
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">data</span>
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;any&gt;</span>}
   */</span>
  <span class="hljs-title function_">send</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>, data</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> messageId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateId</span>();
      
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">event</span>) =&gt; {
        <span class="hljs-keyword">const</span> response = <span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">MessageProtocol</span>} */</span> (event.<span class="hljs-property">data</span>);
        <span class="hljs-keyword">if</span> (response.<span class="hljs-property">id</span> === messageId) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'message'</span>, handler);
          <span class="hljs-keyword">if</span> (response.<span class="hljs-property">type</span> === <span class="hljs-string">'ERROR'</span>) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">error</span>));
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">resolve</span>(response.<span class="hljs-property">data</span>);
          }
        }
      };
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, handler);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-keyword">type</span>, <span class="hljs-attr">id</span>: messageId, data });
    });
  }
}
</code></pre>
<h2 data-id="heading-17">äº”ã€ä½¿ç”¨æ³¨æ„äº‹é¡¹ä¸å…¼å®¹æ€§</h2>
<h3 data-id="heading-18">å…³é”®æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>ç«¯å£æ‰€æœ‰æƒè½¬ç§»</strong>ï¼šä¼ é€’ç«¯å£æ—¶å¿…é¡»åœ¨<code>postMessage</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­å£°æ˜</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// æ­£ç¡®ï¼šå£°æ˜è½¬ç§»</span>
target.<span class="hljs-title function_ invoke__">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [port2]);

<span class="hljs-comment">// é”™è¯¯ï¼šç«¯å£å°†è¢«å†»ç»“</span>
target.<span class="hljs-title function_ invoke__">postMessage</span>({ <span class="hljs-attr">port</span>: port2 }, <span class="hljs-string">'*'</span>);
</code></pre>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong>ï¼šåŠæ—¶å…³é—­ä¸å†ä½¿ç”¨çš„ç«¯å£</p>
<pre><code class="hljs language-ini" lang="ini">// é€šä¿¡ç»“æŸæ—¶æ¸…ç†
port.close()<span class="hljs-comment">;</span>
<span class="hljs-attr">channel</span> = null<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>æ•°æ®ç±»å‹é™åˆ¶</strong>ï¼šç»“æ„åŒ–å…‹éš†ç®—æ³•ä¸æ”¯æŒå‡½æ•°ã€DOMèŠ‚ç‚¹ç­‰</p>
<ul>
<li>
<p>æ”¯æŒï¼šå¯¹è±¡ã€æ•°ç»„ã€Blobã€ArrayBufferã€ImageBitmapç­‰</p>
</li>
<li>
<p>ä¸æ”¯æŒï¼šå‡½æ•°ã€Symbolã€DOMèŠ‚ç‚¹ã€åŸå‹é“¾</p>
</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨è€ƒè™‘</strong>ï¼š</p>
<ul>
<li>
<p>éªŒè¯æ¶ˆæ¯æ¥æº</p>
</li>
<li>
<p>è®¾ç½®æ¶ˆæ¯è¶…æ—¶</p>
</li>
<li>
<p>å®æ–½é€Ÿç‡é™åˆ¶</p>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">å…¼å®¹æ€§å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCommunicationChannel</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-comment">// æ£€æµ‹MessageChannelæ”¯æŒ</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MessageChannel</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
    target.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'init'</span>, <span class="hljs-string">'*'</span>, [channel.<span class="hljs-property">port2</span>]);
    <span class="hljs-keyword">return</span> channel.<span class="hljs-property">port1</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨postMessage + æ¶ˆæ¯ID</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LegacyChannel</span>(target);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LegacyChannel</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span> = target;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMessage</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }
  
  <span class="hljs-title function_">postMessage</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">postMessage</span>({
      <span class="hljs-attr">_legacyChannel</span>: <span class="hljs-literal">true</span>,
      data
    }, <span class="hljs-string">'*'</span>);
  }
}
</code></pre>
<h2 data-id="heading-20">å…­ã€æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹å»ºè®®</h2>
<h3 data-id="heading-21">MessageChannel vs postMessage</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbb15a6a88684b63a1b357941a0f44c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn55-l6Zey6ZeyaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769065328&amp;x-signature=awixJ4QleBvxRjNxA8ZzIRGb%2B84%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">é€‰å‹å»ºè®®</h3>
<ul>
<li>
<p><strong>é€‰æ‹©MessageChannelå½“</strong>ï¼š</p>
<ol>
<li>
<p>éœ€è¦é«˜é¢‘åŒå‘é€šä¿¡</p>
</li>
<li>
<p>è¦æ±‚é€šä¿¡éš”ç¦»å’Œå®‰å…¨æ€§</p>
</li>
<li>
<p>ä¼ è¾“å¤§é‡æˆ–æ•æ„Ÿæ•°æ®</p>
</li>
<li>
<p>éœ€è¦ç²¾å‡†çš„"è¯·æ±‚-å“åº”"æ¨¡å¼</p>
</li>
</ol>
</li>
<li>
<p><strong>ä½¿ç”¨postMessageå½“</strong>ï¼š</p>
<ol>
<li>
<p>ç®€å•çš„å•å‘é€šçŸ¥</p>
</li>
<li>
<p>å¹¿æ’­æ¶ˆæ¯åˆ°å¤šä¸ªç›®æ ‡</p>
</li>
<li>
<p>å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨</p>
</li>
<li>
<p>è½»é‡çº§é€šä¿¡éœ€æ±‚</p>
</li>
</ol>
</li>
</ul>
<h2 data-id="heading-23">ä¸ƒã€æ€»ç»“</h2>
<p><code>MessageChannel</code>æ˜¯ç°ä»£å‰ç«¯æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„é€šä¿¡å·¥å…·ï¼Œå®ƒè§£å†³äº†è·¨æ‰§è¡Œç¯å¢ƒé€šä¿¡çš„å…³é”®é—®é¢˜ï¼š</p>
<h3 data-id="heading-24">æ ¸å¿ƒä»·å€¼</h3>
<ol>
<li>
<p><strong>æ€§èƒ½å“è¶Š</strong>ï¼šä¸“ç”¨é€šé“é¿å…å…¨å±€äº‹ä»¶ç«äº‰ï¼Œæå‡é€šä¿¡æ•ˆç‡</p>
</li>
<li>
<p><strong>å®‰å…¨å¯é </strong>ï¼šç«¯å£éš”ç¦»æœºåˆ¶é˜²æ­¢æ¶ˆæ¯æ³„éœ²å’Œæ±¡æŸ“</p>
</li>
<li>
<p><strong>æ¶æ„æ¸…æ™°</strong>ï¼šæ˜ç¡®çš„"ç«¯å£å¯¹"æ¨¡å‹ç®€åŒ–äº†å¤æ‚é€šä¿¡é€»è¾‘</p>
</li>
<li>
<p><strong>åŠŸèƒ½å¼ºå¤§</strong>ï¼šæ”¯æŒå¯è½¬ç§»å¯¹è±¡ã€åŒå‘é€šä¿¡ã€é”™è¯¯å¤„ç†ç­‰é«˜çº§ç‰¹æ€§</p>
</li>
</ol>
<h3 data-id="heading-25">é€‚ç”¨åœºæ™¯æ€»ç»“</h3>
<ul>
<li>
<p>âœ… Web Workerä¸ä¸»çº¿ç¨‹çš„é«˜é¢‘æ•°æ®äº¤æ¢</p>
</li>
<li>
<p>âœ… å¾®å‰ç«¯æ¶æ„ä¸­çš„æ¨¡å—é€šä¿¡</p>
</li>
<li>
<p>âœ… å¤æ‚iframeåº”ç”¨çš„çˆ¶å­é¡µé¢äº¤äº’</p>
</li>
<li>
<p>âœ… éœ€è¦ä¸¥æ ¼éš”ç¦»çš„æ’ä»¶ç³»ç»Ÿ</p>
</li>
<li>
<p>âœ… å®æ—¶æ•°æ®å¤„ç†ç®¡é“</p>
</li>
</ul>
<h3 data-id="heading-26">æœ€ä½³å®è·µè¦ç‚¹</h3>
<ol>
<li>
<p>å§‹ç»ˆå®ç°é”™è¯¯å¤„ç†å’Œé‡è¿é€»è¾‘</p>
</li>
<li>
<p>é€šä¿¡ç»“æŸååŠæ—¶æ¸…ç†ç«¯å£èµ„æº</p>
</li>
<li>
<p>å¯¹äºå¤§å‹æ•°æ®ä¼ è¾“ä½¿ç”¨Transferableå¯¹è±¡</p>
</li>
<li>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ·»åŠ ç›‘æ§å’Œæ—¥å¿—è®°å½•</p>
</li>
<li>
<p>è€ƒè™‘é™çº§æ–¹æ¡ˆä»¥ä¿è¯å…¼å®¹æ€§</p>
</li>
</ol>
<p>éšç€Webåº”ç”¨è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹æ‰§è¡Œç¯å¢ƒéš”ç¦»å’Œé«˜æ•ˆé€šä¿¡çš„éœ€æ±‚æ—¥ç›Šå¢é•¿ã€‚<code>MessageChannel</code>æä¾›çš„ä¸“å±ã€åŒå‘ã€é«˜æ€§èƒ½é€šä¿¡èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºæ„å»ºç°ä»£åŒ–ã€æ¨¡å—åŒ–å‰ç«¯åº”ç”¨çš„åŸºçŸ³æŠ€æœ¯ã€‚æŒæ¡MessageChannelä¸ä»…èƒ½å¤Ÿè§£å†³å…·ä½“çš„é€šä¿¡é—®é¢˜ï¼Œæ›´èƒ½å¸®åŠ©ä½ è®¾è®¡å‡ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„å‰ç«¯æ¶æ„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 å¹´ HTML å¹´åº¦è°ƒæŸ¥æŠ¥å‘Šå…¬å¸ƒï¼å¥½å¤šä¸çŸ¥é“ï¼]]></title>    <link>https://juejin.cn/post/7594822511437168666</link>    <guid>https://juejin.cn/post/7594822511437168666</guid>    <pubDate>2026-01-14T06:12:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594822511437168666" data-draft-id="7594859060857880586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 å¹´ HTML å¹´åº¦è°ƒæŸ¥æŠ¥å‘Šå…¬å¸ƒï¼å¥½å¤šä¸çŸ¥é“ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,HTML"/> <meta itemprop="datePublished" content="2026-01-14T06:12:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†´ç¾½"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 å¹´ HTML å¹´åº¦è°ƒæŸ¥æŠ¥å‘Šå…¬å¸ƒï¼å¥½å¤šä¸çŸ¥é“ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†´ç¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T06:12:17.000Z" title="Wed Jan 14 2026 06:12:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>è¿‘æ—¥ï¼Œã€Œ<a href="https://link.juejin.cn?target=https%3A%2F%2F2025.stateofhtml.com%2Fzh-Hans%2F" target="_blank" title="https://2025.stateofhtml.com/zh-Hans/" ref="nofollow noopener noreferrer">State of HTML 2025</a>ã€å¹´åº¦è°ƒæŸ¥æŠ¥å‘Šå…¬å¸ƒã€‚</p>
<p>è¿™ä»½æŠ¥å‘Šæ”¶é›†äº†å…¨çƒæ•°ä¸‡åå¼€å‘è€…çš„çœŸå®ä½¿ç”¨ç»éªŒå’Œåé¦ˆï¼Œå ªç§°æ˜¯ Web å¼€å‘é¢†åŸŸçš„â€œå¹´åº¦é£å‘æ ‡â€ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ 2025 å¹´ï¼Œå¤§å®¶éƒ½ç”¨äº† HTML çš„å“ªäº›åŠŸèƒ½ã€‚</p>
<p>æ³¨ï¼šState of JS 2025 è¿˜æœªå…¬å¸ƒï¼Œæ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šå†´ç¾½ï¼Œç¬¬ä¸€æ—¶é—´è·å–æŠ¥å‘Šç»“æœã€‚</p>
<h2 data-id="heading-1">ç‰¹æ€§ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„ç‰¹æ€§ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b3956d99484c05bba5e9a7b55e6d79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=sZ1udW7cQmMOhJrUxnm4DrjcRWw%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>åœ°æ ‡å…ƒç´ ï¼ˆLandmark Elementsï¼‰</strong></li>
</ol>
<p>å…¶å®å°±æ˜¯<code>&lt;aside&gt;</code>, <code>&lt;article&gt;</code>, <code>&lt;main&gt;</code>, <code>&lt;nav&gt;</code>, <code>&lt;section&gt;</code>è¿™äº›ï¼Œæƒ³å¿…ä½ ä¹Ÿç»å¸¸ä½¿ç”¨ã€‚</p>
<ol start="2">
<li><strong>tabindex å±æ€§ï¼šä½¿ HTML å…ƒç´ å¯èšç„¦ï¼Œå…è®¸æˆ–é˜»æ­¢å®ƒä»¬æŒ‰é¡ºåºè·å¾—ç„¦ç‚¹ã€‚</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"0"</span>&gt;</span>Iâ€™m Tabbable<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong><code>&lt;svg&gt;</code>ï¼ˆå†…è” SVGï¼‰</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">circle</span> <span class="hljs-attr">cx</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">cy</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"50"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
</code></pre>
<ol start="4">
<li><strong><code>&lt;canvas&gt;</code></strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
</code></pre>
<ol start="5">
<li><strong><code>loading="lazy"</code>ï¼šæ‡’åŠ è½½</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"picture.jpg"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"supplementary.html"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">è¡¨å• Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„è¡¨å•åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ddf5cf48ea14349b79819fa7714e433~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=CoZAVYRXUJw6mZKy0d2ayxudNZY%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong><code>&lt;input type="color"&gt;</code>ï¼šé¢œè‰²é€‰æ‹©å™¨</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"color"</span> /&gt;</span>
</code></pre>
<ol start="2">
<li><strong><code>&lt;datalist&gt;</code>ï¼šä¾›ç”¨æˆ·é€‰æ‹©çš„è¡¨å•æ§ä»¶</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"country"</span> <span class="hljs-attr">list</span>=<span class="hljs-string">"countries"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">datalist</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"countries"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>Afghanistan<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">datalist</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong><code>input.showPicker()</code>ï¼šæ‰“å¼€å…·æœ‰é€‰æ‹©å™¨çš„è¡¨å•æ§ä»¶ï¼ˆé¢œè‰²é€‰æ‹©å™¨ã€æ—¥æœŸè¾“å…¥æ¡†ç­‰ï¼‰</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dateInput"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"date"</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"dateInput.showPicker()"</span>&gt;</span>Select date<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<ol start="4">
<li><strong><code>contenteditable="plaintext-only"</code>ï¼šå…è®¸ç¼–è¾‘å…ƒç´ çš„åŸå§‹æ–‡æœ¬ï¼Œä½†ä¸å…è®¸è¿›è¡Œå¯Œæ–‡æœ¬æ ¼å¼è®¾ç½®</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">contenteditable</span>=<span class="hljs-string">"plaintext-only"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
</code></pre>
<ol start="5">
<li><strong><code>Customizable Select</code>ï¼šå¯è‡ªå®šä¹‰æ ·å¼å’Œæ ·å¼çš„ä¸‹æ‹‰æ§ä»¶</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css">select,
::<span class="hljs-built_in">picker</span>(select) {
  appearance: base-select;
}
</code></pre>
<h2 data-id="heading-3">å›¾å½¢å’Œå¤šåª’ä½“ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„å›¾å½¢å’Œå¤šåª’ä½“åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f842dc694e64f61932cb8d9649ae74a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=lnKNSlRFDB129byPy26PP8pcxho%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong><code>&lt;svg&gt;</code>ï¼ˆå†…è” SVGï¼‰</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">circle</span> <span class="hljs-attr">cx</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">cy</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"50"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong><code>&lt;canvas&gt;</code></strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong><code>ctx.drawElement()</code>ï¼šä½¿å¼€å‘è€…å¯ä»¥åœ¨ HTML å…ƒç´ ä¸Šç»˜åˆ¶ <code>&lt;canvas&gt;</code></strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">layoutsubtree</span>=<span class="hljs-string">"true"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);
  <span class="hljs-keyword">const</span> text = canvas.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"p"</span>);
  ctx.<span class="hljs-title function_">drawElement</span>(text, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<ol start="4">
<li><strong>WebGLï¼šä¸€ä¸ªåŸºäº OpenGL çš„åº•å±‚ API</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">const gl = canvas.getContext("webgl");
</code></pre>
<ol start="5">
<li><strong>colorSpaceï¼šè®¾ç½®å›¾å½¢çš„é¢œè‰²ç©ºé—´</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">const ctx = canvas.getContext("2d", {colorSpace: "display-p3"});
</code></pre>
<h2 data-id="heading-4">å†…å®¹ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„å›¾å½¢å’Œå¤šåª’ä½“åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc37190f39e64838bfde2ddd75445742~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=W5Jy1SCx0%2FKsmdBViiQf4VSImz8%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)ï¼šç½‘ç«™å‘æµè§ˆå™¨å‘å‡ºçš„ä¸€ç»„æŒ‡ä»¤ï¼Œç”¨äºå¸®åŠ©æ£€æµ‹å’Œç¼“è§£ XSS æ”»å‡»</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">Content-Security-Policy: script-src 'self';
</code></pre>
<ol start="2">
<li><strong><code>&lt;template&gt;</code>ï¼šå†…å®¹åœ¨åŠ è½½é¡µé¢æ—¶ä¸ä¼šå‘ˆç°ï¼Œä½†éšåå¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ JavaScript å®ä¾‹åŒ–</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"counter"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>Clicked {{ times }} times<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong>Intl.LocaleAPIï¼šå›½é™…åŒ– API</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">const us = new Intl.Locale("en-US");
</code></pre>
<ol start="4">
<li><strong>HTML æ¨¡å—ï¼šé€šè¿‡ JS imports å¯¼å…¥ HTML æ–‡ä»¶ï¼Œå¹¶è®¿é—®å…¶å…ƒç´ å’Œ JS å¯¼å‡º</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { <span class="hljs-title class_">TabList</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./tablist.html"</span> <span class="hljs-keyword">with</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">'html'</span> };
  customElements.<span class="hljs-title function_">define</span>(<span class="hljs-string">"tab-list"</span>, <span class="hljs-title class_">TabList</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<ol start="5">
<li><strong>Sanitizer APIï¼š<code>element.setHTML()</code> ä»¥åŠ <code>Document.parseHTML()</code> APIï¼Œé€šè¿‡æ¸…ç† HTML ä¸­ä¸å—ä¿¡ä»»çš„å­—ç¬¦ä¸²æ¥é˜²æ­¢ XSS æ”»å‡»ã€‚</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">greeting.setHTML('Hello ' + nameInput.value);
</code></pre>
<h2 data-id="heading-5">äº¤äº’ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„äº¤äº’åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b9e160fd3c34946901b7efad0ac0845~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=OXyI3LYMzNpSmBvkPTzyEVcGKVY%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong><code>&lt;details&gt;</code> å’Œ <code>&lt;summary&gt;</code>ï¼šéšè—æˆ–æ˜¾ç¤ºå†…å®¹</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">details</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>Details<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
  Longer content
<span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong><code>&lt;dialog&gt;</code>ï¼šå¯¹è¯æ¡†</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    Are you sure?
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>&gt;</span>Yes<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0"</span>&gt;</span>No<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong><code>&lt;details name&gt;</code>ï¼šæ‰‹é£ç´æ•ˆæœ</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">details</span> <span class="hljs-attr">open</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sidebar_panel"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>Main info<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- controls --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">details</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sidebar_panel"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>Style<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- controls --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
</code></pre>
<ol start="4">
<li><strong>popoverï¼šå¼¹å‡ºçª—å£</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">popovertarget</span>=<span class="hljs-string">"foo"</span>&gt;</span>Toggle the popover<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"foo"</span> <span class="hljs-attr">popover</span>&gt;</span>Popover content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ol start="5">
<li><strong>element.before()ï¼šå°†ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå…ƒç´ ä¹‹å‰çš„ DOM æ–¹æ³•</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html">referenceElement.before(newElement);
</code></pre>
<h2 data-id="heading-6">æ€§èƒ½ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„æ€§èƒ½åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f53cd1bd84fc411da632f713d9608a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=LuDzd0fMLSeDMWidZxq8M4Wnc%2Bw%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong><code>loading="lazy"</code>ï¼šæ‡’åŠ è½½</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"picture.jpg"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"supplementary.html"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong>srcset å’Œ sizes å±æ€§ï¼šæä¾›å¤šä¸ªæºå›¾åƒï¼Œä»¥å¸®åŠ©æµè§ˆå™¨é€‰æ‹©æ­£ç¡®çš„å›¾åƒ</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">srcset</span>=<span class="hljs-string">"fairy-med.jpg 480w, fairy-large.jpg 800w"</span> <span class="hljs-attr">sizes</span>=<span class="hljs-string">"(max-width: 600px) 480px, 800px"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"fairy-large.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Elva dressed as a fairy"</span> /&gt;</span>
</code></pre>
<ol start="3">
<li><strong>fetchpriority å±æ€§ï¼šæµè§ˆå™¨ä¼˜å…ˆè·å–è¯¥èµ„æº</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"logo.svg"</span> <span class="hljs-attr">fetchpriority</span>=<span class="hljs-string">"high"</span> /&gt;</span>
</code></pre>
<ol start="4">
<li><strong><code>&lt;img sizes="auto" loading="lazy"&gt;</code>ï¼š<code>sizes="auto"</code> å±æ€§ä¼šåœ¨å›¾åƒåŠ è½½ä¹‹å‰ä¸ºå…¶é¢„ç•™å¸ƒå±€ç©ºé—´ï¼Œä»è€Œé¿å…ä¸€äº›å¸ƒå±€åç§»</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">sizes</span>=<span class="hljs-string">"auto"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span> /&gt;</span>
</code></pre>
<ol start="5">
<li><strong><code>blocking="render"</code>ï¼šé˜»æ­¢æ¸²æŸ“ï¼ˆä½†ä¸é˜»æ­¢è§£æï¼‰ï¼Œç›´åˆ°æŸäº›èµ„æºåŠ è½½å®Œæ¯•</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">blocking</span>=<span class="hljs-string">"render"</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"async-script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">Web ç»„ä»¶ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„ Web ç»„ä»¶åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f930df1ce55d49ce948499c9173d2e69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=wpcV0Yjo4hHMtAuLf4GT5T9qpMM%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>è‡ªå®šä¹‰å…ƒç´ </strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">my-switch</span> <span class="hljs-attr">start</span>=<span class="hljs-string">"On"</span> <span class="hljs-attr">end</span>=<span class="hljs-string">"Off"</span>&gt;</span>Wi-Fi<span class="hljs-tag">&lt;/<span class="hljs-name">my-switch</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong>å®šä¹‰è‡ªå®šä¹‰å…ƒç´ </strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyElement</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HTMLElement</span> { â€¦ }
customElements.<span class="hljs-title function_">define</span>(<span class="hljs-string">"my-element"</span>, <span class="hljs-title class_">MyElement</span>);
</code></pre>
<ol start="3">
<li><strong>Shadow DOMï¼šå°†å¤–éƒ¨ä¸å¯è§çš„å…ƒç´ å°è£…èµ·æ¥ï¼Œå¹¶ä½¿ç”¨ä¸å½±å“é¡µé¢å…¶ä½™éƒ¨åˆ†çš„ CSS å¯¹å…¶è¿›è¡Œæ ·å¼è®¾ç½®</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">shadowRoot</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">"open"</span> });
</code></pre>
<ol start="4">
<li><strong>slot å±æ€§ï¼šå°†ç»„ä»¶ UI ä¸­é¢„å®šä¹‰çš„éƒ¨åˆ†æ›¿æ¢ä¸ºè‡ªå·±çš„å…ƒç´ </strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">my-switch</span>&gt;</span>
  Wi-Fi
  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"start"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-on"</span>&gt;</span>On<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"end"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-off"</span>&gt;</span>Off<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">my-switch</span>&gt;</span>
</code></pre>
<ol start="5">
<li><strong>å£°æ˜ Shadow DOMï¼šä½¿ç”¨ HTML å®šä¹‰ Shadow æ ‘ï¼Œä¾‹å¦‚åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ Web ç»„ä»¶æ—¶</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">host-element</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">shadowrootmode</span>=<span class="hljs-string">"open"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Shadow content --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">host-element</span>&gt;</span>
</code></pre>
<h2 data-id="heading-8">ç³»ç»ŸåŠŸèƒ½ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„ç³»ç»ŸåŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dec3c1dca0443ce87d9cfcb381d8564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=sWkqYf3kjDuGz0GFps2zKdqFaFQ%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>Web Share APIï¼šå°†å†…å®¹å…±äº«ç»™ç”¨æˆ·é€‰æ‹©çš„å„ç§ç›®æ ‡çš„æœºåˆ¶</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">navigator.<span class="hljs-title function_">share</span>(shareData);
</code></pre>
<ol start="2">
<li><strong>æ–‡ä»¶ç³»ç»Ÿè®¿é—® APIï¼šè®¿é—®ç”¨æˆ·æœ¬åœ°è®¾å¤‡ä¸Šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶åˆ›å»ºå¯å†™æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ–°</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> handle = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showSaveFilePicker</span>();
<span class="hljs-keyword">const</span> writable = <span class="hljs-keyword">await</span> handle.<span class="hljs-title function_">createWritable</span>();
<span class="hljs-keyword">await</span> writable.<span class="hljs-title function_">write</span>(<span class="hljs-string">"Hello, world!"</span>);
<span class="hljs-keyword">await</span> writable.<span class="hljs-title function_">close</span>();
</code></pre>
<ol start="3">
<li><strong>SpeechRecognitionï¼šå°†éº¦å…‹é£è¾“å…¥è½¬æ¢ä¸ºæ–‡æœ¬çš„ API</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rec = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeechRecognition</span>();
rec.<span class="hljs-property">lang</span> = <span class="hljs-string">"en-US"</span>;
rec.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"result"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">results</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>].<span class="hljs-property">transcript</span>));
rec.<span class="hljs-title function_">start</span>();
</code></pre>
<ol start="4">
<li><strong>share_target manifest fieldï¼šå…è®¸ PWA é€šè¿‡ç³»ç»Ÿå…±äº«å¯¹è¯æ¡†æ¥æ”¶æ¥è‡ªå…¶ä»–åº”ç”¨ç¨‹åºå…±äº«çš„æ•°æ®ï¼ˆæ–‡æœ¬ã€æ–‡ä»¶ã€URLï¼‰</strong></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"share_target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/share"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"POST"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"enctype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"multipart/form-data"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"title"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"url"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"accept"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"image/*"</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="5">
<li><strong>æ–‡ä»¶å¤„ç† APIï¼šå…è®¸ PWA å°†è‡ªèº«æ³¨å†Œä¸ºæŸäº›æ–‡ä»¶ç±»å‹çš„å¤„ç†ç¨‹åº</strong></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"file_handlers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/open-file"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"accept"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"image/svg+xml"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".svg"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"image/png"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".png"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<h2 data-id="heading-9">æ— éšœç¢ Top 5</h2>
<p>å¼€å‘è€…ä½¿ç”¨æœ€å¤šçš„æ— éšœç¢åŠŸèƒ½ Top 5 åˆ†åˆ«æ˜¯ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46eacb26e4de4369a9c9e4175faf3609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768975936&amp;x-signature=fHO1jrK9uJPIW04jQ22ZngP7ZOM%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>åœ°æ ‡å…ƒç´ </strong></li>
<li><strong>tabindex å±æ€§ï¼šä½¿ HTML å…ƒç´ å¯èšç„¦ï¼Œå…è®¸æˆ–é˜»æ­¢å®ƒä»¬æŒ‰é¡ºåºè·å¾—ç„¦ç‚¹</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"0"</span>&gt;</span>Iâ€™m Tabbable<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong><code>&lt;search&gt;</code>ï¼šç”¨äºå°è£…æœç´¢ç”¨æˆ·ç•Œé¢çš„è¯­ä¹‰å…ƒç´ </strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">search</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"search.php"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Find: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"q"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"search"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Go!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">search</span>&gt;</span>
</code></pre>
<ol start="4">
<li><strong>focusgroup å±æ€§ï¼šä½¿ç”¨é”®ç›˜æ–¹å‘é”®åœ¨å¯èšç„¦å…ƒç´ ä¹‹é—´è¿›è¡Œé”®ç›˜ç„¦ç‚¹å¯¼èˆª</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">focusgroup</span>=<span class="hljs-string">"wrap horizontal"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- child elements --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-10">æœ€å</h2>
<p>æˆ‘ä»¬é€šå¸¸è®¤ä¸ºæœ€ç‚«é…·çš„åŠŸèƒ½ä¼šæœ€å¸å¼•å¼€å‘è€…ï¼Œæ¯”å¦‚äººå·¥æ™ºèƒ½ APIã€3D/XR/AR æˆ–è®¾å¤‡ APIã€‚</p>
<p>ç„¶è€Œï¼Œå¹´å¤ä¸€å¹´ï¼Œæœ€ç»ˆè„±é¢–è€Œå‡ºçš„å´å¾€å¾€æ˜¯é‚£äº›çœ‹ä¼¼å¹³æ·¡æ— å¥‡çš„åŠŸèƒ½ï¼Œç”šè‡³æ˜¯ä¸€äº›éå¸¸æ™®é€šçš„åŠŸèƒ½ï¼šä¸‹æ‹‰èœå•ã€ç»„åˆæ¡†ã€å¼¹å‡ºæ¡†ã€å¯¹è¯æ¡†ã€è¡¨å•éªŒè¯ã€æ–‡ä»¶åŠ è½½å’Œä¿å­˜ã€æ¨¡æ¿ã€å®‰å…¨åœ°æ˜¾ç¤ºç”¨æˆ·ç”Ÿæˆå†…å®¹ã€å›¾æ ‡ç­‰ç­‰ã€‚</p>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼šâ€œè¿™äº›åŠŸèƒ½ä¸æ˜¯æ—©å°±æœ‰äº†å—ï¼Ÿâ€</p>
<p>ç¡®å®æ˜¯ï¼Œä½†é—®é¢˜åœ¨äº â€”â€”å½“ç”¨æˆ·ç•Œé¢æ— æ³•è‡ªå®šä¹‰æˆ–è®¾ç½®æ ·å¼æ—¶ï¼Œå®ƒå®é™…ä¸Šå°±ç­‰äºæ— æ³•ä½¿ç”¨ã€‚</p>
<p>äºæ˜¯ä½ ä¸å¾—ä¸é‡å¤é€ è½®å­ï¼Œæ‹¼ä¸€å †ç¬¬ä¸‰æ–¹åº“ã€‚ç»“æœæ˜æ˜æ˜¯åŸºç¡€éœ€æ±‚ï¼Œå´æå¾—åƒ â€œé«˜ç«¯æ“ä½œâ€ã€‚</p>
<p>ä½†å¥½æ¶ˆæ¯æ˜¯ï¼šHTML æ­£åœ¨å˜å¥½ï¼</p>
<p>2023 å¹´è¿˜åœ¨è®¨è®ºçš„åŠŸèƒ½ï¼Œç°åœ¨å·²ç»åœ¨ä¸»æµæµè§ˆå™¨ä¸Šçº¿äº†ï¼›ä¹‹å‰æ²¡æ³•ç”¨çš„ Popover APIï¼Œç°åœ¨æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒäº†ã€‚</p>
<p>è™½ç„¶å¼€å‘è€…çš„ä¿¡ä»»è¦æ»åå¾ˆå¤šâ€¦â€¦</p>
<p>æ¯”å¦‚ Popover API æ˜æ˜å·²ç»å…¨æ”¯æŒäº†ï¼Œå´è¿˜æ˜¯å¼€å‘è€…æŠ•è¯‰ â€œæµè§ˆå™¨ä¸æ”¯æŒâ€ æœ€å¤šçš„åŠŸèƒ½ â€”â€” ä¸æ˜¯æµè§ˆå™¨æ²¡è·Ÿä¸Šï¼Œæ˜¯æˆ‘ä»¬è¿˜æ²¡ååº”è¿‡æ¥ â€œè¿™ä¸ªåŠŸèƒ½å·²ç»èƒ½ç”¨äº†â€ã€‚</p>
<p>æ­¤å¤–ï¼ŒAI ä¹Ÿæ‹–äº†åè…¿ã€‚</p>
<p>æŒ‰ç†è¯´ï¼ŒAI æ‡‚ç°ä»£ Web åŠŸèƒ½ï¼Œåº”è¯¥èƒ½å¸®æˆ‘ä»¬æ›´å¿«åº”ç”¨æ–°ç‰¹æ€§ï¼Œä½†å®é™…æƒ…å†µæ˜¯ â€”â€” AI å¤ªä¿å®ˆäº†ï¼Œæ¨èçš„éƒ½æ˜¯ â€œè€åŠæ³•â€ï¼Œåè€Œè®©æ–°åŠŸèƒ½çš„æ™®åŠå˜æ…¢äº†ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒHTML çš„æœªæ¥æ–¹å‘å¾ˆæ¸…æ™°ï¼šæ›´çµæ´»ã€æ›´èƒ½è¡¨è¾¾éœ€æ±‚ã€æ›´è´´åˆå¼€å‘è€…å®é™…å¼€å‘ä¹ æƒ¯ã€‚</p>
<p>æœ€åä½¿ç”¨æŠ¥å‘Šä¸­çš„ä¸€å¥è¯ï¼š</p>
<p><strong>â€œWeb çš„è¿›æ­¥å¾ˆå°‘è½°è½°çƒˆçƒˆï¼Œä½†éƒ½æ˜¯ç´¯ç§¯çš„ã€‚æ¯å¤šä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ï¼Œå°±å°‘ç”¨ä¸€æ¬¡å˜é€šæ–¹æ¡ˆã€å°‘ä¾èµ–ä¸€ä¸ªåº“ã€å°‘å†™ä¸€ä¸ªè„†å¼±çš„ hackã€‚ç­‰è¿™äº›åŸºç¡€éƒ½åˆ°ä½äº†ï¼Œæ•´ä¸ª Web å¼€å‘éƒ½ä¼šå˜è½»æ¾ã€‚â€</strong></p>
<p>æˆ‘æ˜¯å†´ç¾½ï¼Œ10 å¹´ç¬”è€•ä¸è¾ï¼Œä¸“æ³¨å‰ç«¯é¢†åŸŸï¼Œæ›´æ–°äº† 10+ ç³»åˆ—ã€300+ ç¯‡åŸåˆ›æŠ€æœ¯æ–‡ç« ï¼Œç¿»è¯‘è¿‡ Svelteã€Solid.jsã€TypeScript æ–‡æ¡£ï¼Œè‘—æœ‰å°å†Œã€ŠNext.js å¼€å‘æŒ‡å—ã€‹ã€ã€ŠSvelte å¼€å‘æŒ‡å—ã€‹ã€ã€ŠAstro å®æˆ˜æŒ‡å—ã€‹ã€‚</p>
<p>æ¬¢è¿å›´è§‚æˆ‘çš„â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">ç½‘é¡µç‰ˆæœ‹å‹åœˆ</a>â€ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<strong>å†´ç¾½ï¼ˆæˆ–æœç´¢ yayujsï¼‰</strong>ï¼Œæ¯å¤©åˆ†äº«å‰ç«¯çŸ¥è¯†ã€AI å¹²è´§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”Ÿäº§ç¯å¢ƒæ…¢ SQL æ’æŸ¥ä¸ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7595185093833588771</link>    <guid>https://juejin.cn/post/7595185093833588771</guid>    <pubDate>2026-01-15T07:03:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595185093833588771" data-draft-id="7595147176752529408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”Ÿäº§ç¯å¢ƒæ…¢ SQL æ’æŸ¥ä¸ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T07:03:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— åä¹‹è¾ˆJ"/> <meta itemprop="url" content="https://juejin.cn/user/3672818779437239"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”Ÿäº§ç¯å¢ƒæ…¢ SQL æ’æŸ¥ä¸ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3672818779437239/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— åä¹‹è¾ˆJ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:03:20.000Z" title="Thu Jan 15 2026 07:03:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€å¦‚ä½•å¿«é€Ÿå‘ç°æ…¢ SQLï¼Ÿ</h3>
<h4 data-id="heading-1">1.1 ä»æ—¥å¿—å…¥æ‰‹ï¼ˆæ¨èä½¿ç”¨é“¾è·¯è¿½è¸ªï¼‰</h4>
<p>ç°ä»£å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œ<strong>é“¾è·¯è¿½è¸ªç³»ç»Ÿ</strong>åŸºæœ¬æ˜¯æ ‡é…ã€‚</p>
<ul>
<li><strong>æ¨èå·¥å…·</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-   SkyWalking</span>
</code></pre>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-   Zipkin</span>
<span class="hljs-deletion">-   Jaeger</span>
<span class="hljs-deletion">-   é˜¿é‡Œäº‘ ARMS / ç«å±±å¼•æ“ APM</span>
</code></pre>
<blockquote>
<p><strong>å®šä½æŠ€å·§ï¼š</strong></p>
<p>åœ¨é“¾è·¯è¿½è¸ªç³»ç»Ÿé‡Œï¼Œç­›é€‰è€—æ—¶å¼‚å¸¸çš„è¯·æ±‚ï¼ˆå¦‚ &gt; 1sï¼‰ï¼Œç„¶åæŸ¥çœ‹æ˜¯å¦æ˜¯æ•°æ®åº“æ“ä½œè€—æ—¶è¿‡é•¿ï¼Œé€šå¸¸æ…¢ SQL ä¸€ç›®äº†ç„¶ã€‚</p>
</blockquote>
<h4 data-id="heading-2">1.2 æ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—</h4>
<p>å¯¹äº MySQLï¼Œå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¿…é¡»çš„ï¼š</p>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'slow_query_log'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> slow_query_log <span class="hljs-operator">=</span> <span class="hljs-string">'ON'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- è¶…è¿‡1ç§’è®°å½•</span>
</code></pre>
<p>æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶åœ¨ <code>/var/lib/mysql/</code> æˆ–é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè·¯å¾„ã€‚</p>
<blockquote>
<p>å·¥å…·æ¨èï¼š</p>
<ul>
<li><code>mysqldumpslow</code></li>
<li><code>pt-query-digest</code>ï¼ˆPercona Toolkitï¼‰</li>
</ul>
<p>å®ƒä»¬å¯ä»¥å¿«é€Ÿç»Ÿè®¡å‡ºé¢‘ç¹çš„æ…¢ SQL å’Œå¹³å‡è€—æ—¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">äºŒã€å¦‚ä½•å®šä½å…·ä½“å“ªæ¡ SQL æ…¢ï¼Ÿ</h3>
<h4 data-id="heading-4">2.1 åº”ç”¨æ—¥å¿— = é»„é‡‘ä¿¡æ¯æº</h4>
<p>å…»æˆ<strong>åœ¨æ—¥å¿—ä¸­æ‰“å°å®Œæ•´ SQL è¯­å¥</strong>çš„ä¹ æƒ¯ï¼ˆå¸¦å‚æ•°çš„ï¼‰ï¼Œæ¯”å¦‚ä½¿ç”¨ MyBatis çš„æ—¥å¿—æ’ä»¶ï¼š</p>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml">xml
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.yourapp.mapper"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"DEBUG"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ï¼š</p>
<p>java</p>
<pre><code class="hljs language-lua" lang="lua">lua
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-built_in">log</span>.<span class="hljs-built_in">debug</span>(<span class="hljs-string">"Executing SQL: {}"</span>, boundSql.getSql());
</code></pre>
<blockquote>
<p>æç¤ºï¼šå¦‚æœä½ ç”¨çš„æ˜¯ Spring Boot + MyBatis Plusï¼Œå¼€å¯ SQL æ—¥å¿—åªéœ€ï¼š</p>
</blockquote>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">yaml</span>
 <span class="hljs-string">ä½“éªŒAIä»£ç åŠ©æ‰‹</span>
 <span class="hljs-string">ä»£ç è§£è¯»</span>
<span class="hljs-string">å¤åˆ¶ä»£ç </span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">ä¸‰ã€SQL ä¼˜åŒ–çš„æ ¸å¿ƒæ€è·¯</h3>
<p>æˆ‘ä»¬æ‹¿åˆ°æ…¢ SQL åï¼Œä¼˜åŒ–ä¸€èˆ¬éµå¾ªè¿™å‡ ä¸ªæ­¥éª¤ï¼š</p>
<h4 data-id="heading-6">3.1 æ‰§è¡Œè®¡åˆ’ EXPLAIN</h4>
<p>sql</p>
<pre><code class="hljs language-ini" lang="ini">ini
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
EXPLAIN SELECT * FROM orders WHERE <span class="hljs-attr">user_id</span> = <span class="hljs-number">123456</span> AND status = <span class="hljs-string">'PAID'</span><span class="hljs-comment">;</span>
</code></pre>
<p>å…³æ³¨å‡ ä¸ªå…³é”®å­—æ®µï¼š</p>

























<table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>type</code></td><td>è”æ¥ç±»å‹ï¼ˆALL æ˜¯æœ€å·®çš„ï¼Œæœ€å¥½æ˜¯ const / ref / indexï¼‰</td></tr><tr><td><code>rows</code></td><td>æ‰«æçš„è¡Œæ•°ï¼Œè¶Šå°‘è¶Šå¥½</td></tr><tr><td><code>key</code></td><td>ä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td><code>Extra</code></td><td>æ˜¯å¦æœ‰ Using filesort / Using temporary</td></tr></tbody></table>
<p>å¦‚æœä½ çœ‹åˆ° <code>Using filesort</code> æˆ– <code>Using temporary</code>ï¼Œé‚£åŸºæœ¬å¯ä»¥ç¡®å®šè¿™æ¡ SQL æœ‰ä¼˜åŒ–ç©ºé—´ã€‚</p>
<h4 data-id="heading-7">3.2 æ£€æŸ¥ç´¢å¼•å‘½ä¸­æƒ…å†µ</h4>
<blockquote>
<p>ç¡®ä¿ WHERE æ¡ä»¶å­—æ®µå»ºç«‹äº†åˆé€‚çš„ç´¢å¼•<br/>
é¿å…åœ¨ç´¢å¼•å­—æ®µä¸Šåšå‡½æ•°æˆ–è€…ç±»å‹è½¬æ¢ï¼ˆä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼‰</p>
</blockquote>
<p>æ¯”å¦‚è¿™æ¡æ…¢ SQLï¼š</p>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-string">'2023-11-11'</span>;
</code></pre>
<p>ä¼˜åŒ–æ–¹å¼æ˜¯æ”¹å†™ä¸ºèŒƒå›´æ¯”è¾ƒï¼š</p>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-11-11 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2023-11-12 00:00:00'</span>;
</code></pre>
<h4 data-id="heading-8">3.3 é¿å… SELECT *</h4>
<p>å–ä½ éœ€è¦çš„å­—æ®µå°±å¥½ï¼Œå°¤å…¶æ˜¯å¤§è¡¨ã€‚å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚</p>
<hr/>
<h3 data-id="heading-9">å››ã€Java å¼€å‘å¸¸è§çš„ SQL æ€§èƒ½å‘</h3>
<h4 data-id="heading-10">4.1 N+1 æŸ¥è¯¢é—®é¢˜ï¼ˆMyBatis å¸¸è§ï¼‰</h4>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">ini
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
List&lt;Order&gt; <span class="hljs-attr">orders</span> = orderMapper.selectByUserId(userId)<span class="hljs-comment">;</span>
for (Order o : orders) {
    o.setItems(itemMapper.selectByOrderId(o.getId()))<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li>æ¯ä¸ªè®¢å•æŸ¥ä¸€æ¬¡æ˜ç»†ï¼Œ100ä¸ªè®¢å• â†’ 100æ¬¡ SQL</li>
<li>è§£å†³æ–¹å¼ï¼šä¸€æ¬¡æ€§æ‰¹é‡æŸ¥ï¼Œæˆ–ä½¿ç”¨ MyBatis çš„ <code>@ResultMap</code> è”è¡¨æ˜ å°„</li>
</ul>
<h4 data-id="heading-11">4.2 åˆ†é¡µé™·é˜±ï¼šé«˜ offset æ…¢å¦‚ç‹—</h4>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet">vbnet
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">100000</span>, <span class="hljs-number">10</span>;
</code></pre>
<ul>
<li>offset è¶Šå¤§ï¼Œæ•°æ®åº“æ‰«æè¶Šå¤š</li>
<li>ä¼˜åŒ–æ–¹å¼ï¼šä½¿ç”¨<strong>æ¸¸æ ‡åˆ†é¡µ</strong>æˆ–<strong>è¦†ç›–ç´¢å¼•åˆ†é¡µ</strong></li>
</ul>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> last_id 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">ASC</span> 
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<hr/>
<h3 data-id="heading-12">äº”ã€å®æˆ˜æ¡ˆä¾‹åˆ†äº«ï¼šä¸€ä¸ªçœŸå®çš„æ…¢ SQL ä¼˜åŒ–æ¡ˆä¾‹</h3>
<h4 data-id="heading-13">èƒŒæ™¯</h4>
<ul>
<li>æ¥å£å“åº”æ…¢ï¼Œé“¾è·¯è¿½è¸ªå‘ç° SQL è€—æ—¶ 4.3s</li>
<li>åŸå§‹ SQLï¼š</li>
</ul>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> user_login_log 
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123456</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> login_time <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-14">é—®é¢˜ç‚¹</h4>
<ul>
<li><code>user_login_log</code> æœ‰ 5000 ä¸‡æ¡æ•°æ®</li>
<li><code>user_id</code> æ²¡æœ‰ç´¢å¼•ï¼ŒORDER BY + LIMIT å¯¼è‡´å…¨è¡¨æ’åº</li>
</ul>
<h4 data-id="heading-15">ä¼˜åŒ–æ–¹æ¡ˆ</h4>
<ol>
<li>æ·»åŠ è”åˆç´¢å¼•ï¼š</li>
</ol>
<p>sql</p>
<pre><code class="hljs language-scss" lang="scss">scss
 ä½“éªŒAIä»£ç åŠ©æ‰‹
 ä»£ç è§£è¯»
å¤åˆ¶ä»£ç 
CREATE INDEX idx_user_login_time 
ON <span class="hljs-built_in">user_login_log</span>(user_id, login_time DESC);
</code></pre>
<ol start="2">
<li>æ‰§è¡Œè®¡åˆ’å˜æ›´ï¼ŒæŸ¥è¯¢è€—æ—¶é™ä¸º <strong>8ms</strong></li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¢å­—èŠ‚è±†åŒ…å¤§æ¨¡å‹å²—ï¼Œä¸‰è½®æŠ€æœ¯é¢éƒ½é—®äº†å•¥ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7595232643464134690</link>    <guid>https://juejin.cn/post/7595232643464134690</guid>    <pubDate>2026-01-15T07:03:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595232643464134690" data-draft-id="7595185093833572387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¢å­—èŠ‚è±†åŒ…å¤§æ¨¡å‹å²—ï¼Œä¸‰è½®æŠ€æœ¯é¢éƒ½é—®äº†å•¥ï¼Ÿ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-15T07:03:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å±…ç„¶JuRan"/> <meta itemprop="url" content="https://juejin.cn/user/2524134427858205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¢å­—èŠ‚è±†åŒ…å¤§æ¨¡å‹å²—ï¼Œä¸‰è½®æŠ€æœ¯é¢éƒ½é—®äº†å•¥ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134427858205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å±…ç„¶JuRan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:03:26.000Z" title="Thu Jan 15 2026 07:03:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®—æ³•é¢ç»ï½œå­—èŠ‚è±†åŒ…å¤§æ¨¡å‹æ–¹å‘ï¼Œä¸‰è½®æŠ€æœ¯é¢å¤ç›˜</h2>
<p>ä¸€å…±ä¸‰è½®æŠ€æœ¯é¢ï¼Œæ•´ä½“ä» <strong>æ¨¡å‹ä¸æ¨ç†ä¼˜åŒ– â†’ è®­ç»ƒä¸å¯¹é½ â†’ RAG ä¸äº§å“æ€è€ƒ</strong> é€æ­¥æ·±å…¥ï¼Œé¢è¯•å®˜é£æ ¼åç†æ€§è®¨è®ºï¼Œé—®é¢˜éå¸¸è´´è¿‘çœŸå®å¤§æ¨¡å‹ç ”å‘æµç¨‹ã€‚è¿™é‡Œç®€å•æ•´ç†ä¸€ä¸‹é¢ç»ï¼Œä¾›å‡†å¤‡å¤§æ¨¡å‹æ–¹å‘çš„åŒå­¦å‚è€ƒã€‚</p>
<h3 data-id="heading-1">ä¸€é¢ï¼šæ¨ç†ä¼˜åŒ– + å·¥ç¨‹åŸºç¡€ï¼ˆçº¦ 1hï¼‰</h3>
<p>ä¸€é¢ä»è‡ªæˆ‘ä»‹ç»å’Œé¡¹ç›®å±•å¼€ï¼Œéšåé‡ç‚¹è½åœ¨ <strong>æ¨ç†ä¼˜åŒ–ä¸ç³»ç»Ÿèƒ½åŠ›</strong> ä¸Šã€‚</p>
<p>ä¸»è¦è®¨è®ºç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>è‡ªæˆ‘ä»‹ç»</p>
</li>
<li>
<p>é€‰æ‹©ä¸€ä¸ªåšå¾—æ¯”è¾ƒå¥½çš„å®ä¹ æˆ–è®ºæ–‡è¿›è¡Œæ·±å…¥è®²è§£</p>
<ul>
<li>é¡¹ç›®åŠ¨æœºæ˜¯ä»€ä¹ˆ</li>
<li>ä¸ºä»€ä¹ˆé‡‡ç”¨å½“å‰æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯å…¶ä»–é€‰æ‹©</li>
</ul>
</li>
<li>
<p>KV Cache çš„åŸºæœ¬åŸç†</p>
</li>
<li>
<p>GQAï¼ˆGrouped Query Attentionï¼‰çš„æ ¸å¿ƒæ€æƒ³</p>
</li>
<li>
<p>FlashAttention çš„è®¾è®¡åŠ¨æœºå’Œå…·ä½“åšæ³•</p>
</li>
<li>
<p>å¸¸è§çš„å¤§æ¨¡å‹è®­ç»ƒä¸æ¨ç†ä¼˜åŒ–æ‰‹æ®µ</p>
<ul>
<li>DeepSpeed</li>
<li>æ•°æ®å¹¶è¡Œ / å¼ é‡å¹¶è¡Œ / æµæ°´çº¿å¹¶è¡Œ</li>
</ul>
</li>
<li>
<p>åœºæ™¯é¢˜ï¼š</p>
<ul>
<li>å¦‚æœè¦æå‡å¤§æ¨¡å‹çš„<strong>å¤šè½®å¯¹è¯èƒ½åŠ›</strong>ï¼Œå¯ä»¥ä»å“ªäº›æ–¹é¢è¿›è¡Œæ”¹è¿›</li>
<li>åŒ…æ‹¬æ¨¡å‹ã€æ•°æ®ã€è®°å¿†å’Œæ¨ç†ç­–ç•¥ç­‰</li>
</ul>
</li>
</ul>
<p>ä»£ç é¢˜ï¼š</p>
<ul>
<li><strong>LeetCode 56ï¼šåˆå¹¶åŒºé—´</strong></li>
</ul>
<p>æ„Ÿå—ï¼š  ä¸€é¢éå¸¸åå·¥ç¨‹ï¼Œé¢è¯•å®˜æ›´å…³æ³¨ä½ æ˜¯å¦çœŸæ­£ç†è§£ <strong>æ¨ç†åŠ é€ŸèƒŒåçš„åŸç†å’Œå–èˆ</strong>ã€‚</p>
<h3 data-id="heading-2">äºŒé¢ï¼šæ¨¡å‹ç»“æ„ + å¯¹é½æ–¹æ³•ï¼ˆçº¦ 1hï¼‰</h3>
<p>äºŒé¢æ˜æ˜¾æ›´åæ¨¡å‹ç»“æ„å’Œè®­ç»ƒèŒƒå¼ï¼Œè®¨è®ºæ·±åº¦ä¹Ÿæ›´é«˜ã€‚</p>
<p>ä¸»è¦è®¨è®ºç‚¹ï¼š</p>
<ul>
<li>
<p>è‡ªæˆ‘ä»‹ç»ï¼Œç»§ç»­æ·±æŒ–å®ä¹ å’Œè®ºæ–‡</p>
</li>
<li>
<p>å®ä¹ ä¸­å¾®è°ƒè¿‡ Qwen2ï¼Œè¯¦ç»†ä»‹ç» Qwen2 çš„æ¨¡å‹ç»“æ„</p>
</li>
<li>
<p>Qwen2 ç›¸æ¯” Qwen1 çš„å…³é”®æ”¹è¿›ç‚¹</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆ Decoder-only æ¶æ„æˆä¸ºå½“å‰å¤§æ¨¡å‹ä¸»æµ</p>
<ul>
<li>ç›¸æ¯” Encoder-Decoder çš„ä¼˜åŠ¿åœ¨å“ªé‡Œ</li>
</ul>
</li>
<li>
<p>RoPE çš„åŸç†</p>
</li>
<li>
<p>ç›®å‰å¸¸ç”¨çš„ä½ç½®ç¼–ç æ–¹æ³•è¿˜æœ‰å“ªäº›</p>
</li>
<li>
<p>RoPE çš„ä¼˜ç‚¹ä¸é€‚ç”¨åœºæ™¯</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆåœ¨æœ‰ SFT ä¹‹åä»ç„¶éœ€è¦ RLHF</p>
</li>
<li>
<p>PPO å’Œ DPO çš„æ ¸å¿ƒæ€æƒ³</p>
</li>
<li>
<p>DPO ç›¸æ¯” PPO åœ¨ RLHF ä¸­åšäº†å“ªäº›æ”¹è¿›</p>
</li>
<li>
<p>é™¤æ­¤ä¹‹å¤–è¿˜äº†è§£å“ªäº›å¼ºåŒ–å­¦ä¹ ç®—æ³•</p>
</li>
</ul>
<p>ä»£ç é¢˜ï¼š</p>
<ul>
<li><strong>LeetCode 23ï¼šåˆå¹¶ K ä¸ªå‡åºé“¾è¡¨</strong></li>
</ul>
<p>æ„Ÿå—ï¼š  äºŒé¢æ›´çœ‹é‡<strong>æ¨¡å‹è®¾è®¡é€‰æ‹©èƒŒåçš„åŸå› </strong>ï¼Œä»¥åŠå¯¹å¯¹é½æ–¹æ³•çš„æ•´ä½“è®¤çŸ¥ï¼Œè€Œä¸æ˜¯å•ç‚¹ç»“è®ºã€‚</p>
<h3 data-id="heading-3">ä¸‰é¢ï¼šRAG + ç³»ç»Ÿè®¾è®¡ + äº§å“è§†è§’ï¼ˆçº¦ 40minï¼‰</h3>
<p>ä¸‰é¢æ•´ä½“åç»¼åˆäº¤æµï¼ŒæŠ€æœ¯é—®é¢˜å‡å°‘ï¼Œä½†é—®é¢˜è·¨åº¦æ›´å¤§ï¼Œæ›´åƒæ˜¯åœ¨è€ƒå¯Ÿé•¿æœŸæ½œåŠ›ã€‚</p>
<p>ä¸»è¦è®¨è®ºç‚¹ï¼š</p>
<ul>
<li>
<p>è‡ªæˆ‘ä»‹ç»ï¼Œå›é¡¾å®ä¹ å’Œè®ºæ–‡ç»å†</p>
</li>
<li>
<p>æ˜¯å¦äº†è§£ Qwen çš„æ•´ä½“ç»“æ„</p>
</li>
<li>
<p>å¾®è°ƒæ—¶çš„æ•°æ®é…æ¯”æ˜¯å¦‚ä½•è®¾è®¡çš„</p>
</li>
<li>
<p>å¤§æ¨¡å‹çš„<strong>ç¾éš¾æ€§é—å¿˜</strong>é—®é¢˜</p>
<ul>
<li>å¸¸è§è§£å†³æ€è·¯æœ‰å“ªäº›</li>
</ul>
</li>
<li>
<p>å¯¹ RAG çš„ç†è§£</p>
</li>
<li>
<p>GraphRAG çš„åŸºæœ¬åšæ³•å’Œé€‚ç”¨åœºæ™¯</p>
</li>
<li>
<p>åœºæ™¯é¢˜ï¼š</p>
<ul>
<li>å¦‚æœæœ‰ä¸€æ‰¹ä¸“ä¸šé¢†åŸŸçŸ¥è¯†ï¼ˆå¦‚åŒ»ç–— / æ³•å¾‹ï¼‰ï¼Œ<br/>
å¦‚ä½•æ­å»ºä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½åŠ©æ‰‹ RAG é“¾è·¯</li>
</ul>
</li>
<li>
<p>å¼€æ”¾è®¨è®ºï¼š</p>
<ul>
<li>æ˜¯å¦ä½¿ç”¨è¿‡è±†åŒ…</li>
<li>ä½ è®¤ä¸ºç›®å‰è±†åŒ…è¿˜å­˜åœ¨å“ªäº›é—®é¢˜æˆ–æ”¹è¿›ç©ºé—´</li>
</ul>
</li>
</ul>
<p>ä»£ç é¢˜ï¼š</p>
<ul>
<li><strong>LeetCode 416ï¼šåˆ†å‰²ç­‰å’Œå­é›†</strong></li>
</ul>
<p>æ„Ÿå—ï¼š  ä¸‰é¢æ›´å <strong>ç³»ç»Ÿæ€ç»´ + äº§å“åˆ¤æ–­åŠ›</strong>ï¼ŒæŠ€æœ¯æ·±åº¦ä¹‹å¤–ï¼Œè¿˜ä¼šçœ‹ä½ å¯¹çœŸå®äº§å“çš„ç†è§£ã€‚</p>
<h3 data-id="heading-4">æ€»ç»“</h3>
<p>æ•´ä½“æ¥çœ‹ï¼Œè¿™æ¬¡å­—èŠ‚è±†åŒ…å¤§æ¨¡å‹é¢è¯•ï¼š</p>
<ul>
<li><strong>ä¸€é¢</strong>ï¼šæ¨ç†ä¼˜åŒ– + å¹¶è¡Œç­–ç•¥</li>
<li><strong>äºŒé¢</strong>ï¼šæ¨¡å‹ç»“æ„ + å¯¹é½æ–¹æ³•</li>
<li><strong>ä¸‰é¢</strong>ï¼šRAGã€ç³»ç»Ÿè®¾è®¡ä¸äº§å“æ€è€ƒ</li>
</ul>
<p>å‡†å¤‡å»ºè®®ï¼š</p>
<ul>
<li>æ¨ç†ä¼˜åŒ–ï¼ˆKV Cacheã€GQAã€FlashAttentionï¼‰æ˜¯é«˜é¢‘</li>
<li>Qwen ç³»åˆ—ã€RoPEã€Decoder-only æ¶æ„ä¸€å®šè¦ç†Ÿ</li>
<li>RAG ä¸é¢†åŸŸåŠ©æ‰‹çš„ç³»ç»Ÿè®¾è®¡å‡ ä¹å¿…é—®</li>
<li>ä¸åªæ˜¯â€œä¼šç”¨æ¨¡å‹â€ï¼Œè€Œæ˜¯èƒ½åšå®Œæ•´ç³»ç»Ÿ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·¥ä½œä¸­æœ€å¸¸ç”¨çš„5ç§æœ¬åœ°ç¼“å­˜]]></title>    <link>https://juejin.cn/post/7594728203257364514</link>    <guid>https://juejin.cn/post/7594728203257364514</guid>    <pubDate>2026-01-14T01:58:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594728203257364514" data-draft-id="7594661351514406947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·¥ä½œä¸­æœ€å¸¸ç”¨çš„5ç§æœ¬åœ°ç¼“å­˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-14T01:58:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰è¯´æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·¥ä½œä¸­æœ€å¸¸ç”¨çš„5ç§æœ¬åœ°ç¼“å­˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰è¯´æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T01:58:04.000Z" title="Wed Jan 14 2026 01:58:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä»Šå¤©å’Œå¤§å®¶èŠèŠä¸€ä¸ªå‡ ä¹æ‰€æœ‰Javaå¼€å‘è€…éƒ½ä¼šç”¨åˆ°ï¼Œä½†å¾ˆå¤šäººå¯¹å…¶ç†è§£ä¸å¤Ÿæ·±å…¥çš„æŠ€æœ¯â€”â€”<strong>æœ¬åœ°ç¼“å­˜</strong>ã€‚</p>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨å·¥ä½œä¸­å¯èƒ½é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šç³»ç»Ÿæ€§èƒ½æµ‹è¯•æ—¶ï¼Œå‘ç°æŸä¸ªæ¥å£å“åº”æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œä¸€æŸ¥å‘ç°æ˜¯æ•°æ®åº“æŸ¥è¯¢å¤ªé¢‘ç¹ã€‚</p>
<p>åŠ äº†Redisåˆ†å¸ƒå¼ç¼“å­˜åæœ‰æ‰€æ”¹å–„ï¼Œä½†ç½‘ç»œIOçš„å¼€é”€ä¾ç„¶å­˜åœ¨ï¼Œç‰¹åˆ«æ˜¯å¯¹æ—¶æ•ˆæ€§è¦æ±‚é«˜çš„æ•°æ®ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæœ¬åœ°ç¼“å­˜çš„ä»·å€¼å°±å‡¸æ˜¾å‡ºæ¥äº†ã€‚</p>
<p>æœ¬åœ°ç¼“å­˜æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ç®€å•è¯´å°±æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨<strong>åº”ç”¨è¿›ç¨‹çš„å†…å­˜ä¸­</strong>ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿè®¿é—®ã€‚</p>
<p>å®ƒçš„è®¿é—®é€Ÿåº¦é€šå¸¸æ˜¯çº³ç§’çº§ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚Redisï¼‰æ˜¯æ¯«ç§’çº§ï¼Œæ•°æ®åº“æŸ¥è¯¢æ›´æ˜¯æ¯«ç§’åˆ°ç§’çº§ã€‚</p>
<h2 data-id="heading-1">01 ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°ç¼“å­˜ï¼Ÿ</h2>
<p>åœ¨æ·±å…¥å…·ä½“æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬å…ˆææ¸…æ¥šæœ¬åœ°ç¼“å­˜çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸ªæ²¡æœ‰ç¼“å­˜çš„åœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ²¡æœ‰ç¼“å­˜çš„ç”¨æˆ·æŸ¥è¯¢æœåŠ¡</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryServiceWithoutCache</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CategoryMapper categoryMapper;
    
    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategoryById</span><span class="hljs-params">(Long categoryId)</span> {
        <span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨éƒ½ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</span>
        <span class="hljs-keyword">return</span> categoryMapper.selectById(categoryId);
    }
    
    <span class="hljs-comment">// å‡è®¾è¿™ä¸ªæ¥å£æ¯ç§’è¢«è°ƒç”¨1000æ¬¡</span>
    <span class="hljs-comment">// æ•°æ®åº“å°±è¦æ‰¿å—1000QPSçš„å‹åŠ›</span>
}
</code></pre>
<p>è¿™ç§è®¾è®¡çš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼š</p>
<ol>
<li><strong>æ•°æ®åº“å‹åŠ›å¤§</strong>ï¼šæ¯æ¬¡è¯·æ±‚éƒ½è¦æŸ¥è¯¢æ•°æ®åº“</li>
<li><strong>å“åº”æ—¶é—´é•¿</strong>ï¼šæ•°æ®åº“æŸ¥è¯¢é€šå¸¸éœ€è¦å‡ æ¯«ç§’åˆ°å‡ åæ¯«ç§’</li>
<li><strong>ç³»ç»Ÿå¯æ‰©å±•æ€§å·®</strong>ï¼šæ•°æ®åº“æˆä¸ºå•ç‚¹ç“¶é¢ˆ</li>
</ol>
<p>å¼•å…¥æœ¬åœ°ç¼“å­˜åï¼Œæƒ…å†µä¼šå¤§å¤§æ”¹å–„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç”¨æˆ·æŸ¥è¯¢æœåŠ¡</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryServiceWithCache</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CategoryMapper categoryMapper;
    
    <span class="hljs-comment">// ä½¿ç”¨ConcurrentHashMapä½œä¸ºæœ¬åœ°ç¼“å­˜</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Long, Category&gt; categoryCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategoryById</span><span class="hljs-params">(Long categoryId)</span> {
        <span class="hljs-comment">// 1. å…ˆæŸ¥ç¼“å­˜</span>
        <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryCache.get(categoryId);
        <span class="hljs-keyword">if</span> (category != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> category;  <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›</span>
        }
        
        <span class="hljs-comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
        category = categoryMapper.selectById(categoryId);
        <span class="hljs-keyword">if</span> (category != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 3. å°†æ•°æ®æ”¾å…¥ç¼“å­˜</span>
            categoryCache.put(categoryId, category);
        }
        
        <span class="hljs-keyword">return</span> category;
    }
}
</code></pre>
<p>è¿™æ ·æ”¹é€ åï¼Œå¯¹äºåŒä¸€ä¸ªåˆ†ç±»çš„å¤šæ¬¡æŸ¥è¯¢ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¼šè®¿é—®æ•°æ®åº“ï¼Œåç»­æŸ¥è¯¢éƒ½ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼Œæ€§èƒ½æå‡å‡ ä¸ªæ•°é‡çº§ã€‚</p>
<p>ä½†æ˜¯ï¼Œç®€å•çš„<code>ConcurrentHashMap</code>åªæ˜¯æœ¬åœ°ç¼“å­˜çš„æœ€åŸºç¡€å½¢æ€ã€‚</p>
<p>åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ›´å¤šé—®é¢˜ï¼š<strong>å†…å­˜ç®¡ç†ã€è¿‡æœŸç­–ç•¥ã€ç¼“å­˜æ·˜æ±°ã€å¹¶å‘æ§åˆ¶</strong>ç­‰ã€‚</p>
<p>è¿™å°±æ˜¯å„ç§æœ¬åœ°ç¼“å­˜æ¡†æ¶å­˜åœ¨çš„æ„ä¹‰ã€‚</p>
<h2 data-id="heading-2">02 æœ¬åœ°ç¼“å­˜æ ¸å¿ƒè¦ç´ </h2>
<p>åœ¨ä»‹ç»å…·ä½“æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªä¼˜ç§€æœ¬åœ°ç¼“å­˜åº”è¯¥å…·å¤‡çš„ç‰¹æ€§ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/736f32830d564ed69822e6a33554b731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=D518Bv7IItC1XueNiJvSNxJLNAs%3D" alt="" loading="lazy"/></p>
<p>ç†è§£äº†è¿™äº›æ ¸å¿ƒè¦ç´ ï¼Œæˆ‘ä»¬å°±èƒ½æ›´å¥½åœ°è¯„ä¼°å„ç§ç¼“å­˜æ–¹æ¡ˆã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥åˆ†æ5ç§æœ€å¸¸ç”¨çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-3">03 æ–¹æ¡ˆä¸€ï¼šConcurrentHashMap</h2>
<h3 data-id="heading-4">åŸç†ä¸ç‰¹ç‚¹</h3>
<p><code>ConcurrentHashMap</code>æ˜¯JDKè‡ªå‘çš„çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ï¼Œå®ƒé€šè¿‡<strong>åˆ†æ®µé”</strong>æŠ€æœ¯å®ç°é«˜å¹¶å‘è®¿é—®ã€‚</p>
<p>ä½œä¸ºç¼“å­˜ä½¿ç”¨æ—¶ï¼Œå®ƒæ˜¯æœ€ç®€å•ã€æœ€è½»é‡çº§çš„é€‰æ‹©ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5be2636913c4beabc07f4b0684e5ccf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=5juRf%2Bsq9tThOSeIRLDngc5XS9k%3D" alt="" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p>
<ul>
<li><strong>åˆ†æ®µé”</strong>ï¼šå°†æ•´ä¸ªMapåˆ†æˆå¤šä¸ªSegmentï¼Œæ¯ä¸ªSegmentç‹¬ç«‹åŠ é”</li>
<li><strong>å¹¶å‘åº¦</strong>ï¼šé»˜è®¤16ä¸ªSegmentï¼Œå¯æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘å†™</li>
<li><strong>Java 8ä¼˜åŒ–</strong>ï¼šåœ¨Java 8ä¸­æ”¹ä¸ºä½¿ç”¨<code>synchronized</code>+<code>CAS</code>+çº¢é»‘æ ‘ï¼Œæ€§èƒ½æ›´å¥½</li>
</ul>
<h3 data-id="heading-5">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-comment">/**
 * åŸºäºConcurrentHashMapçš„ç®€æ˜“æœ¬åœ°ç¼“å­˜
 * ç‰¹ç‚¹ï¼šç®€å•ã€è½»é‡ã€æ— è¿‡æœŸç­–ç•¥
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentHashMapCache</span>&lt;K, V&gt; {
    
    <span class="hljs-comment">// æ ¸å¿ƒç¼“å­˜å­˜å‚¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;K, V&gt; cache;
    
    <span class="hljs-comment">// å¯é€‰çš„ç¼“å­˜åŠ è½½å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CacheLoader&lt;K, V&gt; loader;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMapCache</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.loader = <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMapCache</span><span class="hljs-params">(CacheLoader&lt;K, V&gt; loader)</span> {
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.loader = loader;
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å€¼
     * å¦‚æœä¸å­˜åœ¨ä¸”é…ç½®äº†loaderï¼Œåˆ™åŠ è½½æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.get(key);
        
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span> &amp;&amp; loader != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// åŒé‡æ£€æŸ¥é”ï¼Œé˜²æ­¢å¹¶å‘åŠ è½½</span>
            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
                value = cache.get(key);
                <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
                    value = loader.load(key);
                    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
                        cache.put(key, value);
                    }
                }
            }
        }
        
        <span class="hljs-keyword">return</span> value;
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        cache.put(key, value);
    }
    
    <span class="hljs-comment">/**
     * ç§»é™¤ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">return</span> cache.remove(key);
    }
    
    <span class="hljs-comment">/**
     * æ¸…ç©ºç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        cache.clear();
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å¤§å°
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cache.size();
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­æ˜¯å¦åŒ…å«key
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">return</span> cache.containsKey(key);
    }
    
    <span class="hljs-comment">/**
     * ç¼“å­˜åŠ è½½å™¨æ¥å£
     */</span>
    <span class="hljs-meta">@FunctionalInterface</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CacheLoader</span>&lt;K, V&gt; {
        V <span class="hljs-title function_">load</span><span class="hljs-params">(K key)</span>;
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹ï¼šç”¨æˆ·ä¿¡æ¯ç¼“å­˜
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceWithConcurrentHashMap</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMapper userMapper;
    
    <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ConcurrentHashMapç¼“å­˜</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMapCache&lt;Long, User&gt; userCache;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceWithConcurrentHashMap</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆå§‹åŒ–ç¼“å­˜ï¼Œé…ç½®ç¼“å­˜åŠ è½½å™¨</span>
        userCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMapCache</span>&lt;&gt;(userId -&gt; {
            <span class="hljs-comment">// å½“ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•åŠ è½½æ•°æ®</span>
            System.out.println(<span class="hljs-string">"ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: "</span> + userId);
            <span class="hljs-keyword">return</span> userMapper.selectById(userId);
        });
    }
    
    <span class="hljs-comment">/**
     * è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> userCache.get(userId);
    }
    
    <span class="hljs-comment">/**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-comment">// 1. æ›´æ–°æ•°æ®åº“</span>
        userMapper.updateById(user);
        
        <span class="hljs-comment">// 2. æ›´æ–°ç¼“å­˜</span>
        userCache.put(user.getId(), user);
    }
    
    <span class="hljs-comment">/**
     * åˆ é™¤ç”¨æˆ·ï¼ˆåŒæ—¶åˆ é™¤ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 1. åˆ é™¤æ•°æ®åº“è®°å½•</span>
        userMapper.deleteById(userId);
        
        <span class="hljs-comment">// 2. åˆ é™¤ç¼“å­˜</span>
        userCache.remove(userId);
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡è·å–ç”¨æˆ·ï¼ˆä¼˜åŒ–N+1æŸ¥è¯¢ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;Long, User&gt; <span class="hljs-title function_">getUsersByIds</span><span class="hljs-params">(List&lt;Long&gt; userIds)</span> {
        Map&lt;Long, User&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        List&lt;Long&gt; missingIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 1. å…ˆä»ç¼“å­˜è·å–</span>
        <span class="hljs-keyword">for</span> (Long userId : userIds) {
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userCache.get(userId);
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                result.put(userId, user);
            } <span class="hljs-keyword">else</span> {
                missingIds.add(userId);
            }
        }
        
        <span class="hljs-comment">// 2. æ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„æ•°æ®</span>
        <span class="hljs-keyword">if</span> (!missingIds.isEmpty()) {
            List&lt;User&gt; dbUsers = userMapper.selectBatchIds(missingIds);
            <span class="hljs-keyword">for</span> (User user : dbUsers) {
                result.put(user.getId(), user);
                userCache.put(user.getId(), user);  <span class="hljs-comment">// æ”¾å…¥ç¼“å­˜</span>
            }
        }
        
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h3 data-id="heading-6">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>JDKåŸç”Ÿæ”¯æŒ</strong>ï¼šæ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šåˆ†æ®µé”/CASä¿è¯å¹¶å‘å®‰å…¨</li>
<li><strong>æ€§èƒ½ä¼˜ç§€</strong>ï¼šè¯»æ“ä½œå®Œå…¨æ— é”ï¼Œå†™æ“ä½œé”ç²’åº¦å°</li>
<li><strong>ç®€å•è½»é‡</strong>ï¼šä»£ç ç®€å•ï¼Œèµ„æºæ¶ˆè€—å°</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>åŠŸèƒ½æœ‰é™</strong>ï¼šç¼ºä¹è¿‡æœŸã€æ·˜æ±°ç­‰é«˜çº§åŠŸèƒ½</li>
<li><strong>å†…å­˜æ— æ³•é™åˆ¶</strong>ï¼šå¯èƒ½é€ æˆå†…å­˜æº¢å‡º</li>
<li><strong>éœ€è¦æ‰‹åŠ¨ç®¡ç†</strong>ï¼šç¼“å­˜ç­–ç•¥éœ€è¦è‡ªå·±å®ç°</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç¼“å­˜æ•°æ®é‡å°ä¸”å›ºå®š</li>
<li>ä¸éœ€è¦è‡ªåŠ¨è¿‡æœŸåŠŸèƒ½</li>
<li>ä½œä¸ºæ›´å¤æ‚ç¼“å­˜çš„åº•å±‚å®ç°</li>
<li>ä¸´æ—¶æ€§ã€ç®€å•çš„ç¼“å­˜éœ€æ±‚</li>
</ul>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨é¡¹ç›®åˆæœŸå–œæ¬¢ç”¨<code>ConcurrentHashMap</code>åšç¼“å­˜ï¼Œå› ä¸ºå®ƒç®€å•ç›´æ¥ã€‚</p>
<p>ä½†éšç€ä¸šåŠ¡å¤æ‚åŒ–ï¼Œå¾€å¾€ä¼šé‡åˆ°å†…å­˜æº¢å‡ºã€ç¼“å­˜æ¸…ç†ç­‰é—®é¢˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ›´ä¸“ä¸šçš„ç¼“å­˜æ–¹æ¡ˆäº†ã€‚</p>
<h2 data-id="heading-7">04 æ–¹æ¡ˆäºŒï¼šLRUç¼“å­˜</h2>
<h3 data-id="heading-8">åŸç†ä¸ç‰¹ç‚¹</h3>
<p>LRUï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æ˜¯ä¸€ç§ç»å…¸çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚</p>
<p>å½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°<strong>æœ€ä¹…æœªè¢«è®¿é—®</strong>çš„æ•°æ®ã€‚</p>
<p><code>LinkedHashMap</code>æ˜¯JDKæä¾›çš„å®ç°äº†LRUç‰¹æ€§çš„Mapå®ç°ã€‚</p>
<p>å®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>æ¥è®°å½•è®¿é—®é¡ºåºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c128fb17ae84b8ea63d9781a7119c92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=BrFkBAerb9O1DtKwJZGpg6KY1ak%3D" alt="" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p>
<ul>
<li><strong>è®¿é—®é¡ºåº</strong>ï¼š<code>accessOrder=true</code>æ—¶ï¼Œæ¯æ¬¡è®¿é—®ä¼šå°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨</li>
<li><strong>æ·˜æ±°ç­–ç•¥</strong>ï¼šé“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹æ˜¯æœ€ä¹…æœªè®¿é—®çš„</li>
<li><strong>é‡å†™removeEldestEntry</strong>ï¼šæ§åˆ¶ä½•æ—¶åˆ é™¤æœ€è€èŠ‚ç‚¹</li>
</ul>
<h3 data-id="heading-9">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-comment">/**
 * åŸºäºLinkedHashMapçš„LRUç¼“å­˜
 * ç‰¹ç‚¹ï¼šè‡ªåŠ¨æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span>&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;K, V&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxCapacity;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºLRUç¼“å­˜
     * <span class="hljs-doctag">@param</span> maxCapacity æœ€å¤§å®¹é‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> maxCapacity)</span> {
        <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°accessOrderä¸ºtrueè¡¨ç¤ºæŒ‰è®¿é—®é¡ºåºæ’åº</span>
        <span class="hljs-built_in">super</span>(<span class="hljs-number">16</span>, <span class="hljs-number">0.75f</span>, <span class="hljs-literal">true</span>);
        <span class="hljs-built_in">this</span>.maxCapacity = maxCapacity;
    }
    
    <span class="hljs-comment">/**
     * é‡å†™æ­¤æ–¹æ³•å†³å®šä½•æ—¶åˆ é™¤æœ€è€çš„æ¡ç›®
     * <span class="hljs-doctag">@param</span> eldest æœ€è€çš„æ¡ç›®ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰
     * <span class="hljs-doctag">@return</span> trueè¡¨ç¤ºåº”è¯¥åˆ é™¤æœ€è€çš„æ¡ç›®
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;K, V&gt; eldest)</span> {
        <span class="hljs-comment">// å½“å¤§å°è¶…è¿‡æœ€å¤§å®¹é‡æ—¶ï¼Œåˆ é™¤æœ€è€çš„æ¡ç›®</span>
        <span class="hljs-keyword">return</span> size() &gt; maxCapacity;
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å€¼ï¼ˆä¼šæ›´æ–°è®¿é—®é¡ºåºï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.get(key);
        }
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥ç¼“å­˜å€¼
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.put(key, value);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> CacheStats <span class="hljs-title function_">getStats</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheStats</span>(size(), maxCapacity);
    }
    
    <span class="hljs-comment">/**
     * è·å–æœ€è¿‘è®¿é—®çš„Nä¸ªé”®
     */</span>
    <span class="hljs-keyword">public</span> List&lt;K&gt; <span class="hljs-title function_">getRecentlyAccessed</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        List&lt;K&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        Iterator&lt;K&gt; iterator = keySet().iterator();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n &amp;&amp; iterator.hasNext(); i++) {
            result.add(iterator.next());
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheStats</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> currentSize;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxCapacity;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> usageRatio;
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheStats</span><span class="hljs-params">(<span class="hljs-type">int</span> currentSize, <span class="hljs-type">int</span> maxCapacity)</span> {
            <span class="hljs-built_in">this</span>.currentSize = currentSize;
            <span class="hljs-built_in">this</span>.maxCapacity = maxCapacity;
            <span class="hljs-built_in">this</span>.usageRatio = maxCapacity &gt; <span class="hljs-number">0</span> ? (<span class="hljs-type">double</span>) currentSize / maxCapacity : <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-comment">// getters...</span>
    }
}

<span class="hljs-comment">/**
 * çº¿ç¨‹å®‰å…¨çš„LRUç¼“å­˜å®ç°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentLRUCache</span>&lt;K, V&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LRUCache&lt;K, V&gt; cache;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentLRUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> maxCapacity)</span> {
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>&lt;&gt;(maxCapacity);
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å€¼
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.get(key);
        }
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥ç¼“å­˜å€¼
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.put(key, value);
        }
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡æ”¾å…¥ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putAll</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; map)</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            cache.putAll(map);
        }
    }
    
    <span class="hljs-comment">/**
     * ç§»é™¤ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.remove(key);
        }
    }
    
    <span class="hljs-comment">/**
     * æ¸…ç©ºç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            cache.clear();
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å¤§å°
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.size();
        }
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥ç¼“å­˜æ˜¯å¦åŒ…å«key
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsKey</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.containsKey(key);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> LRUCache.CacheStats <span class="hljs-title function_">getStats</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (cache) {
            <span class="hljs-keyword">return</span> cache.getStats();
        }
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹ï¼šå•†å“ä¿¡æ¯ç¼“å­˜
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceWithLRUCache</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;
    
    <span class="hljs-comment">// LRUç¼“å­˜ï¼Œæœ€å¤šç¼“å­˜1000ä¸ªå•†å“</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentLRUCache&lt;Long, Product&gt; productCache;
    
    <span class="hljs-comment">// çƒ­é—¨å•†å“ç¼“å­˜ï¼ˆæ›´å°çš„LRUç¼“å­˜ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentLRUCache&lt;Long, Product&gt; hotProductCache;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProductServiceWithLRUCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸»ç¼“å­˜ï¼š1000ä¸ªå•†å“</span>
        productCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLRUCache</span>&lt;&gt;(<span class="hljs-number">1000</span>);
        
        <span class="hljs-comment">// çƒ­é—¨å•†å“ç¼“å­˜ï¼š100ä¸ªå•†å“</span>
        hotProductCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLRUCache</span>&lt;&gt;(<span class="hljs-number">100</span>);
    }
    
    <span class="hljs-comment">/**
     * è·å–å•†å“ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductById</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-comment">// 1. å…ˆæŸ¥çƒ­é—¨å•†å“ç¼“å­˜</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> hotProductCache.get(productId);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            recordCacheHit(<span class="hljs-string">"hot"</span>);  <span class="hljs-comment">// è®°å½•å‘½ä¸­</span>
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 2. æŸ¥ä¸»ç¼“å­˜</span>
        product = productCache.get(productId);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¦‚æœå•†å“è¢«é¢‘ç¹è®¿é—®ï¼Œç§»åˆ°çƒ­é—¨ç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (isFrequentlyAccessed(productId)) {
                hotProductCache.put(productId, product);
            }
            recordCacheHit(<span class="hljs-string">"main"</span>);
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 3. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
        product = productMapper.selectById(productId);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ”¾å…¥ä¸»ç¼“å­˜</span>
            productCache.put(productId, product);
            recordCacheMiss();
        }
        
        <span class="hljs-keyword">return</span> product;
    }
    
    <span class="hljs-comment">/**
     * è·å–çƒ­é—¨å•†å“åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getHotProducts</span><span class="hljs-params">(<span class="hljs-type">int</span> limit)</span> {
        <span class="hljs-comment">// ç›´æ¥ä»çƒ­é—¨ç¼“å­˜è·å–æœ€è¿‘è®¿é—®çš„å•†å“</span>
        <span class="hljs-comment">// æ³¨æ„ï¼šè¿™åªæ˜¯ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„çƒ­é—¨åº¦è®¡ç®—</span>
        
        List&lt;Product&gt; hotProducts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">synchronized</span> (hotProductCache) {
            <span class="hljs-comment">// è¿™é‡Œéœ€è¦æ‰©å±•ConcurrentLRUCacheä»¥æ”¯æŒè·å–æ‰€æœ‰å€¼</span>
            <span class="hljs-comment">// å®é™…å®ç°ä¸­éœ€è¦ç»´æŠ¤é¢å¤–çš„æ•°æ®ç»“æ„</span>
        }
        
        <span class="hljs-keyword">return</span> hotProducts;
    }
    
    <span class="hljs-comment">/**
     * æ›´æ–°å•†å“ä¿¡æ¯ï¼ˆåŒæ—¶æ›´æ–°ä¸¤ä¸ªç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProduct</span><span class="hljs-params">(Product product)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">productId</span> <span class="hljs-operator">=</span> product.getId();
        
        <span class="hljs-comment">// 1. æ›´æ–°æ•°æ®åº“</span>
        productMapper.updateById(product);
        
        <span class="hljs-comment">// 2. æ›´æ–°ç¼“å­˜</span>
        productCache.put(productId, product);
        hotProductCache.put(productId, product);
        
        <span class="hljs-comment">// 3. è®°å½•æ›´æ–°æ—¥å¿—</span>
        logProductUpdate(productId);
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡å¤±æ•ˆç¼“å­˜ï¼ˆå½“å•†å“åˆ†ç±»æ›´æ–°æ—¶ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invalidateProductsByCategory</span><span class="hljs-params">(Long categoryId)</span> {
        <span class="hljs-comment">// åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦éå†ç¼“å­˜å¹¶åˆ é™¤å¯¹åº”åˆ†ç±»çš„å•†å“</span>
        <span class="hljs-comment">// ä¸ºäº†æ€§èƒ½ï¼Œå¯ä»¥ï¼š</span>
        <span class="hljs-comment">// 1. ä½¿ç”¨åˆ†ä»£ç¼“å­˜</span>
        <span class="hljs-comment">// 2. ä½¿ç”¨å¼‚æ­¥æ¸…ç†</span>
        <span class="hljs-comment">// 3. ä½¿ç”¨æ›´ç»†ç²’åº¦çš„ç¼“å­˜é”®</span>
        
        System.out.println(<span class="hljs-string">"å•†å“åˆ†ç±»æ›´æ–°ï¼Œéœ€è¦æ¸…ç†ç›¸å…³ç¼“å­˜: "</span> + categoryId);
        <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†ï¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒä¸æ¨èï¼‰</span>
        <span class="hljs-comment">// productCache.clear();</span>
        <span class="hljs-comment">// hotProductCache.clear();</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFrequentlyAccessed</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-comment">// ç®€åŒ–å®ç°ï¼šæ€»æ˜¯è¿”å›true</span>
        <span class="hljs-comment">// å®é™…éœ€è¦åŸºäºè®¿é—®é¢‘ç‡çš„çƒ­åº¦ç®—æ³•</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordCacheHit</span><span class="hljs-params">(String cacheType)</span> {
        <span class="hljs-comment">// è®°å½•ç¼“å­˜å‘½ä¸­ï¼Œç”¨äºç›‘æ§å’Œè°ƒä¼˜</span>
        System.out.println(<span class="hljs-string">"ç¼“å­˜å‘½ä¸­ ["</span> + cacheType + <span class="hljs-string">"]: "</span> + System.currentTimeMillis());
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordCacheMiss</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®°å½•ç¼“å­˜æœªå‘½ä¸­</span>
        System.out.println(<span class="hljs-string">"ç¼“å­˜æœªå‘½ä¸­: "</span> + System.currentTimeMillis());
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logProductUpdate</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-comment">// è®°å½•å•†å“æ›´æ–°</span>
        System.out.println(<span class="hljs-string">"å•†å“æ›´æ–°: "</span> + productId + <span class="hljs-string">" at "</span> + System.currentTimeMillis());
    }
}
</code></pre>
<h3 data-id="heading-10">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>è‡ªåŠ¨æ·˜æ±°</strong>ï¼šæ— éœ€æ‰‹åŠ¨æ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</li>
<li><strong>è®¿é—®æ¨¡å¼ä¼˜åŒ–</strong>ï¼šè‡ªåŠ¨å°†çƒ­é—¨æ•°æ®ä¿æŒåœ¨ç¼“å­˜ä¸­</li>
<li><strong>JDKåŸç”Ÿ</strong>ï¼šåŸºäºLinkedHashMapï¼Œæ— éœ€é¢å¤–ä¾èµ–</li>
<li><strong>ç®€å•æœ‰æ•ˆ</strong>ï¼šå¯¹äºè®¿é—®æ¨¡å¼æœ‰æ˜æ˜¾çƒ­ç‚¹çš„åœºæ™¯æ•ˆæœæ˜¾è‘—</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ·˜æ±°ç­–ç•¥å•ä¸€</strong>ï¼šåªåŸºäºè®¿é—®æ—¶é—´ï¼Œä¸è€ƒè™‘è®¿é—®é¢‘ç‡</li>
<li><strong>å¯èƒ½æ·˜æ±°çƒ­ç‚¹æ•°æ®</strong>ï¼šå¦‚æœç¼“å­˜å¤ªå°ï¼Œå¯èƒ½è¯¯æ·˜æ±°</li>
<li><strong>å¹¶å‘æ€§èƒ½</strong>ï¼šéœ€è¦é¢å¤–åŒæ­¥æ¥ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>åŠŸèƒ½æœ‰é™</strong>ï¼šç¼ºä¹è¿‡æœŸæ—¶é—´ç­‰é«˜çº§åŠŸèƒ½</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ•°æ®è®¿é—®æœ‰æ˜æ˜¾çƒ­ç‚¹</li>
<li>ç¼“å­˜å®¹é‡æœ‰é™ï¼Œéœ€è¦è‡ªåŠ¨æ·˜æ±°</li>
<li>æ•°æ®é‡è¦æ€§ç›¸å¯¹å‡åŒ€</li>
<li>ä½œä¸ºç¼“å­˜ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</li>
</ul>
<p>æœ‰äº›å°ä¼™ä¼´ä¼šå‘ç°ï¼ŒLRUç¼“å­˜èƒ½è§£å†³å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œä½†å¯¹äºâ€œçªç„¶è¢«å¤§é‡è®¿é—®çš„å†·æ•°æ®â€åœºæ™¯ï¼Œå¯èƒ½ä¼šæ·˜æ±°æ‰çœŸæ­£çš„çƒ­ç‚¹æ•°æ®ã€‚</p>
<p>è¿™æ—¶å€™å°±éœ€è¦æ›´æ™ºèƒ½çš„æ·˜æ±°ç­–ç•¥äº†ã€‚</p>
<h2 data-id="heading-11">05 æ–¹æ¡ˆä¸‰ï¼šEhcache - ä¼ä¸šçº§æœ¬åœ°ç¼“å­˜</h2>
<h3 data-id="heading-12">åŸç†ä¸ç‰¹ç‚¹</h3>
<p>Ehcacheæ˜¯ä¸€ä¸ªæˆç†Ÿçš„ã€åŠŸèƒ½ä¸°å¯Œçš„Javaç¼“å­˜æ¡†æ¶ï¼Œæœ€åˆä½œä¸ºHibernateçš„ç¼“å­˜æä¾›è€…è€Œé—»åã€‚</p>
<p>å®ƒæ”¯æŒ<strong>å†…å­˜+ç£ç›˜</strong>çš„å¤šçº§ç¼“å­˜ï¼Œé€‚åˆç¼“å­˜å¤§é‡æ•°æ®ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/048e7121958a4439964cf2acdd54b2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=jdC4L79PZK6WqQbe9mKF%2Fi%2FeRzE%3D" alt="" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li><strong>å¤šçº§å­˜å‚¨</strong>ï¼šå †å†…å­˜ â†’ å †å¤–å†…å­˜ â†’ ç£ç›˜</li>
<li><strong>ä¸°å¯Œçš„æ·˜æ±°ç­–ç•¥</strong>ï¼šLRUã€LFUã€FIFO</li>
<li><strong>é›†ç¾¤æ”¯æŒ</strong>ï¼šé€šè¿‡Terracottaå®ç°åˆ†å¸ƒå¼ç¼“å­˜</li>
<li><strong>ç›‘æ§ç®¡ç†</strong>ï¼šJMXæ”¯æŒï¼Œå®Œå–„çš„ç›‘æ§æŒ‡æ ‡</li>
</ul>
<h3 data-id="heading-13">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>
<p>ç”±äºEhcacheåŠŸèƒ½ä¸°å¯Œï¼Œé…ç½®ç›¸å¯¹å¤æ‚ï¼Œè¿™é‡Œå±•ç¤ºå…¶æ ¸å¿ƒç”¨æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> net.sf.ehcache.Cache;
<span class="hljs-keyword">import</span> net.sf.ehcache.CacheManager;
<span class="hljs-keyword">import</span> net.sf.ehcache.Element;
<span class="hljs-keyword">import</span> net.sf.ehcache.config.CacheConfiguration;
<span class="hljs-keyword">import</span> net.sf.ehcache.config.PersistenceConfiguration;
<span class="hljs-keyword">import</span> net.sf.ehcache.store.MemoryStoreEvictionPolicy;

<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-comment">/**
 * Ehcacheç¼“å­˜å·¥å…·ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EhcacheUtil</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CacheManager cacheManager;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºCacheManagerï¼ˆé€šå¸¸ä»é…ç½®æ–‡ä»¶åŠ è½½ï¼‰</span>
        cacheManager = CacheManager.create();
        
        <span class="hljs-comment">// 2. æˆ–è€…ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®</span>
        createUserCache();
        createProductCache();
    }
    
    <span class="hljs-comment">/**
     * åˆ›å»ºç”¨æˆ·ç¼“å­˜
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUserCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¼“å­˜é…ç½®</span>
        <span class="hljs-type">CacheConfiguration</span> <span class="hljs-variable">cacheConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheConfiguration</span>()
            .name(<span class="hljs-string">"userCache"</span>)  <span class="hljs-comment">// ç¼“å­˜åç§°</span>
            .maxEntriesLocalHeap(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// å †å†…å­˜æœ€å¤§æ¡ç›®æ•°</span>
            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LRU)  <span class="hljs-comment">// æ·˜æ±°ç­–ç•¥</span>
            .timeToLiveSeconds(<span class="hljs-number">3600</span>)  <span class="hljs-comment">// å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰</span>
            .timeToIdleSeconds(<span class="hljs-number">600</span>)  <span class="hljs-comment">// ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰</span>
            .diskExpiryThreadIntervalSeconds(<span class="hljs-number">120</span>)  <span class="hljs-comment">// ç£ç›˜è¿‡æœŸæ£€æŸ¥é—´éš”</span>
            .persistence(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistenceConfiguration</span>()
                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));  <span class="hljs-comment">// æŒä¹…åŒ–ç­–ç•¥</span>
        
        <span class="hljs-comment">// åˆ›å»ºç¼“å­˜</span>
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>(cacheConfig);
        
        <span class="hljs-comment">// æ·»åŠ åˆ°CacheManager</span>
        cacheManager.addCache(cache);
    }
    
    <span class="hljs-comment">/**
     * åˆ›å»ºå•†å“ç¼“å­˜ï¼ˆä½¿ç”¨å †å¤–å†…å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createProductCache</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CacheConfiguration</span> <span class="hljs-variable">cacheConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheConfiguration</span>()
            .name(<span class="hljs-string">"productCache"</span>)
            .maxEntriesLocalHeap(<span class="hljs-number">5000</span>)  <span class="hljs-comment">// å †å†…å­˜æ¡ç›®æ•°</span>
            .maxBytesLocalOffHeap(<span class="hljs-number">256</span>, MemoryUnit.MEGABYTES)  <span class="hljs-comment">// å †å¤–å†…å­˜256MB</span>
            .maxBytesLocalDisk(<span class="hljs-number">2</span>, MemoryUnit.GIGABYTES)  <span class="hljs-comment">// ç£ç›˜ç¼“å­˜2GB</span>
            .memoryStoreEvictionPolicy(MemoryStoreEvictionPolicy.LFU)  <span class="hljs-comment">// LFUæ·˜æ±°ç­–ç•¥</span>
            .timeToLiveSeconds(<span class="hljs-number">1800</span>)
            .timeToIdleSeconds(<span class="hljs-number">300</span>)
            .persistence(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistenceConfiguration</span>()
                .strategy(PersistenceConfiguration.Strategy.LOCALTEMPSWAP));
        
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>(cacheConfig);
        cacheManager.addCache(cache);
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å®ä¾‹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Cache <span class="hljs-title function_">getCache</span><span class="hljs-params">(String cacheName)</span> {
        <span class="hljs-keyword">return</span> cacheManager.getCache(cacheName);
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String cacheName, Serializable key, Serializable value)</span> {
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> getCache(cacheName);
        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Element</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(key, value);
            cache.put(element);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å€¼
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String cacheName, Serializable key)</span> {
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> getCache(cacheName);
        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Element</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> cache.get(key);
            <span class="hljs-keyword">return</span> element != <span class="hljs-literal">null</span> ? element.getObjectValue() : <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-comment">/**
     * ç§»é™¤ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(String cacheName, Serializable key)</span> {
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> getCache(cacheName);
        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> cache.remove(key);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStats</span><span class="hljs-params">(String cacheName)</span> {
        <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> getCache(cacheName);
        <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"ç¼“å­˜: %s, å¤§å°: %d, å‘½ä¸­æ•°: %d, æœªå‘½ä¸­æ•°: %d, å‘½ä¸­ç‡: %.2f%%"</span>,
                cacheName,
                cache.getSize(),
                cache.getStatistics().cacheHitCount(),
                cache.getStatistics().cacheMissCount(),
                cache.getStatistics().cacheHitRatio() * <span class="hljs-number">100</span>
            );
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ç¼“å­˜ä¸å­˜åœ¨: "</span> + cacheName;
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹ï¼šè®¢å•æœåŠ¡
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceWithEhcache</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * è·å–è®¢å•è¯¦æƒ…ï¼ˆä½¿ç”¨Ehcacheï¼‰
     */</span>
    <span class="hljs-keyword">public</span> OrderDetail <span class="hljs-title function_">getOrderDetail</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">cacheName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"orderCache"</span>;
        
        <span class="hljs-comment">// 1. å…ˆä»ç¼“å­˜è·å–</span>
        <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> (OrderDetail) EhcacheUtil.get(cacheName, orderId);
        <span class="hljs-keyword">if</span> (detail != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"Ehcacheç¼“å­˜å‘½ä¸­: "</span> + orderId);
            <span class="hljs-keyword">return</span> detail;
        }
        
        <span class="hljs-comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
        System.out.println(<span class="hljs-string">"Ehcacheç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“: "</span> + orderId);
        detail = orderMapper.selectOrderDetail(orderId);
        
        <span class="hljs-keyword">if</span> (detail != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 3. æ”¾å…¥ç¼“å­˜</span>
            EhcacheUtil.put(cacheName, orderId, detail);
            
            <span class="hljs-comment">// 4. å¼‚æ­¥åŠ è½½ç›¸å…³æ•°æ®åˆ°ç¼“å­˜</span>
            loadRelatedDataToCache(detail);
        }
        
        <span class="hljs-keyword">return</span> detail;
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡è·å–è®¢å•ï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> List&lt;OrderDetail&gt; <span class="hljs-title function_">getOrderDetails</span><span class="hljs-params">(List&lt;Long&gt; orderIds)</span> {
        List&lt;OrderDetail&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        List&lt;Long&gt; missingIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 1. æ‰¹é‡ä»ç¼“å­˜è·å–</span>
        <span class="hljs-keyword">for</span> (Long orderId : orderIds) {
            <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> (OrderDetail) EhcacheUtil.get(<span class="hljs-string">"orderCache"</span>, orderId);
            <span class="hljs-keyword">if</span> (detail != <span class="hljs-literal">null</span>) {
                result.add(detail);
            } <span class="hljs-keyword">else</span> {
                missingIds.add(orderId);
            }
        }
        
        <span class="hljs-comment">// 2. æ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„æ•°æ®</span>
        <span class="hljs-keyword">if</span> (!missingIds.isEmpty()) {
            List&lt;OrderDetail&gt; dbDetails = orderMapper.selectOrderDetails(missingIds);
            result.addAll(dbDetails);
            
            <span class="hljs-comment">// 3. æ‰¹é‡æ”¾å…¥ç¼“å­˜</span>
            <span class="hljs-keyword">for</span> (OrderDetail detail : dbDetails) {
                EhcacheUtil.put(<span class="hljs-string">"orderCache"</span>, detail.getOrderId(), detail);
            }
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆåŒæ—¶æ›´æ–°ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateOrderStatus</span><span class="hljs-params">(Long orderId, String status)</span> {
        <span class="hljs-comment">// 1. æ›´æ–°æ•°æ®åº“</span>
        orderMapper.updateOrderStatus(orderId, status);
        
        <span class="hljs-comment">// 2. ä½¿ç¼“å­˜å¤±æ•ˆï¼ˆæˆ–æ›´æ–°ç¼“å­˜ï¼‰</span>
        EhcacheUtil.remove(<span class="hljs-string">"orderCache"</span>, orderId);
        
        <span class="hljs-comment">// 3. å¯ä»¥é€‰æ‹©é‡æ–°åŠ è½½åˆ°ç¼“å­˜</span>
        <span class="hljs-type">OrderDetail</span> <span class="hljs-variable">detail</span> <span class="hljs-operator">=</span> orderMapper.selectOrderDetail(orderId);
        <span class="hljs-keyword">if</span> (detail != <span class="hljs-literal">null</span>) {
            EhcacheUtil.put(<span class="hljs-string">"orderCache"</span>, orderId, detail);
        }
    }
    
    <span class="hljs-comment">/**
     * å¼‚æ­¥åŠ è½½ç›¸å…³æ•°æ®åˆ°ç¼“å­˜
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadRelatedDataToCache</span><span class="hljs-params">(OrderDetail orderDetail)</span> {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å¼‚æ­¥åŠ è½½ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ç­‰</span>
        <span class="hljs-comment">// å‡å°‘åç»­æŸ¥è¯¢çš„ç¼“å­˜æœªå‘½ä¸­</span>
        
        CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ç¼“å­˜ç”¨æˆ·ä¿¡æ¯</span>
                EhcacheUtil.put(<span class="hljs-string">"userCache"</span>, orderDetail.getUserId(), orderDetail.getUserInfo());
                
                <span class="hljs-comment">// ç¼“å­˜å•†å“ä¿¡æ¯</span>
                <span class="hljs-keyword">for</span> (OrderItem item : orderDetail.getItems()) {
                    EhcacheUtil.put(<span class="hljs-string">"productCache"</span>, item.getProductId(), item.getProductInfo());
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// å¼‚æ­¥æ“ä½œï¼Œè®°å½•æ—¥å¿—ä½†ä¸å½±å“ä¸»æµç¨‹</span>
                System.err.println(<span class="hljs-string">"å¼‚æ­¥åŠ è½½ç¼“å­˜å¤±è´¥: "</span> + e.getMessage());
            }
        });
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCacheStats</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"=== ç¼“å­˜ç»Ÿè®¡ ==="</span>);
        System.out.println(EhcacheUtil.getStats(<span class="hljs-string">"orderCache"</span>));
        System.out.println(EhcacheUtil.getStats(<span class="hljs-string">"userCache"</span>));
        System.out.println(EhcacheUtil.getStats(<span class="hljs-string">"productCache"</span>));
    }
}
</code></pre>
<h3 data-id="heading-14">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šæ”¯æŒå¤šçº§ç¼“å­˜ã€å¤šç§æ·˜æ±°ç­–ç•¥</li>
<li><strong>ä¼ä¸šçº§ç‰¹æ€§</strong>ï¼šé›†ç¾¤æ”¯æŒã€æŒä¹…åŒ–ã€äº‹åŠ¡æ”¯æŒ</li>
<li><strong>æˆç†Ÿç¨³å®š</strong>ï¼šç»è¿‡å¤šå¹´ç”Ÿäº§éªŒè¯</li>
<li><strong>ç›‘æ§å®Œå–„</strong>ï¼šJMXæ”¯æŒï¼Œä¾¿äºç›‘æ§ç®¡ç†</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>é…ç½®å¤æ‚</strong>ï¼šåŠŸèƒ½å¤šå¯¼è‡´é…ç½®å¤æ‚</li>
<li><strong>è¾ƒé‡</strong>ï¼šä¾èµ–è¾ƒå¤šï¼Œå¯åŠ¨è¾ƒæ…¢</li>
<li><strong>APIè¾ƒè€</strong>ï¼šéƒ¨åˆ†APIè®¾è®¡ä¸å¤Ÿç°ä»£</li>
<li><strong>ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™</strong>ï¼šç›¸æ¯”Caffeineç­‰æ–°æ¡†æ¶</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>éœ€è¦ç¼“å­˜å¤§é‡æ•°æ®ï¼ˆå†…å­˜+ç£ç›˜ï¼‰</li>
<li>éœ€è¦é›†ç¾¤ç¼“å­˜æ”¯æŒ</li>
<li>ä¼ä¸šçº§åº”ç”¨ï¼Œéœ€è¦å®Œæ•´è§£å†³æ–¹æ¡ˆ</li>
<li>å·²æœ‰Ehcacheä½¿ç”¨ç»éªŒçš„é¡¹ç›®</li>
</ul>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­æ¥è§¦è¿‡Ehcacheï¼Œå®ƒçš„åŠŸèƒ½ç¡®å®å¼ºå¤§ï¼Œä½†å¯¹äºç®€å•çš„ç¼“å­˜éœ€æ±‚æ¥è¯´å¯èƒ½è¿‡äºé‡é‡çº§äº†ã€‚</p>
<h2 data-id="heading-15">06 æ–¹æ¡ˆå››ï¼šCaffeine - é«˜æ€§èƒ½ç°ä»£ç¼“å­˜</h2>
<h3 data-id="heading-16">åŸç†ä¸ç‰¹ç‚¹</h3>
<p>Caffeineæ˜¯ä¸€ä¸ªåŸºäºJava 8çš„é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œç”±Guava Cacheçš„åŸä½œè€…å¼€å‘ã€‚å®ƒæä¾›äº†<strong>è¿‘ä¹æœ€ä¼˜çš„å‘½ä¸­ç‡</strong>å’Œ<strong>å“è¶Šçš„å¹¶å‘æ€§èƒ½</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f786f7249f746d99985be7bba4ea300~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=UxUaayQQGb4weHI8NTFjNot1gpY%3D" alt="" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li><strong>Window-TinyLFU</strong>ï¼šç»“åˆLFUå’ŒLRUä¼˜ç‚¹ï¼Œæä¾›æ›´å¥½çš„å‘½ä¸­ç‡</li>
<li><strong>é¢‘ç‡ç´ æ</strong>ï¼šç”¨æå°ç©ºé—´ç»Ÿè®¡è®¿é—®é¢‘ç‡</li>
<li><strong>å¼‚æ­¥æ“ä½œ</strong>ï¼šè¯»ä¸é˜»å¡å†™ï¼Œå†™ä¸é˜»å¡è¯»</li>
<li><strong>Java 8ä¼˜åŒ–</strong>ï¼šå¤§é‡ä½¿ç”¨<code>CompletableFuture</code>å’Œ<code>StampedLock</code></li>
</ul>
<h3 data-id="heading-17">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.github.benmanes.caffeine.cache.*;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.Executor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * Caffeineç¼“å­˜ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CaffeineCacheService</span> {
    
    <span class="hljs-comment">// 1. åŸºç¡€ç¼“å­˜ç¤ºä¾‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache&lt;Long, User&gt; userCache = Caffeine.newBuilder()
        .maximumSize(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>
        .expireAfterWrite(Duration.ofMinutes(<span class="hljs-number">10</span>))  <span class="hljs-comment">// å†™å…¥å10åˆ†é’Ÿè¿‡æœŸ</span>
        .expireAfterAccess(Duration.ofMinutes(<span class="hljs-number">5</span>))  <span class="hljs-comment">// è®¿é—®å5åˆ†é’Ÿè¿‡æœŸ</span>
        .recordStats()  <span class="hljs-comment">// å¼€å¯ç»Ÿè®¡</span>
        .build();
    
    <span class="hljs-comment">// 2. å¼‚æ­¥åŠ è½½ç¼“å­˜</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsyncLoadingCache&lt;Long, Product&gt; productCache = 
        Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">5000</span>)
            .expireAfterWrite(Duration.ofHours(<span class="hljs-number">1</span>))
            .refreshAfterWrite(Duration.ofMinutes(<span class="hljs-number">30</span>))  <span class="hljs-comment">// å†™å…¥30åˆ†é’Ÿååˆ·æ–°</span>
            .recordStats()
            .buildAsync(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncCacheLoader</span>&lt;Long, Product&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> CompletableFuture&lt;Product&gt; <span class="hljs-title function_">asyncLoad</span><span class="hljs-params">(Long productId, 
                        Executor executor)</span> {
                    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; 
                        loadProductFromDB(productId), executor);
                }
                
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> CompletableFuture&lt;Product&gt; <span class="hljs-title function_">asyncReload</span><span class="hljs-params">(Long productId, 
                        Product oldValue, Executor executor)</span> {
                    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; 
                        reloadProductFromDB(productId), executor);
                }
            });
    
    <span class="hljs-comment">// 3. å¸¦æƒé‡ç¼“å­˜çš„ä¾‹å­ï¼ˆæŒ‰å¯¹è±¡å¤§å°ç¼“å­˜ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache&lt;String, <span class="hljs-type">byte</span>[]&gt; largeDataCache = Caffeine.newBuilder()
        .maximumWeight(<span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)  <span class="hljs-comment">// æœ€å¤§100MB</span>
        .weigher((String key, <span class="hljs-type">byte</span>[] value) -&gt; value.length)  <span class="hljs-comment">// æƒé‡è®¡ç®—å™¨</span>
        .expireAfterWrite(Duration.ofHours(<span class="hljs-number">2</span>))
        .recordStats()
        .build();
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨ç¼“å­˜è·å–ç”¨æˆ·ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserWithCache</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// æ–¹å¼1ï¼šæ‰‹åŠ¨å¤„ç†</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userCache.getIfPresent(userId);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            user = loadUserFromDB(userId);
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                userCache.put(userId, user);
            }
        }
        <span class="hljs-keyword">return</span> user;
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨LoadingCacheè‡ªåŠ¨åŠ è½½
     */</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserAutoLoad</span><span class="hljs-params">(Long userId)</span> {
        LoadingCache&lt;Long, User&gt; loadingCache = Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">1000</span>)
            .expireAfterWrite(Duration.ofMinutes(<span class="hljs-number">10</span>))
            .build(<span class="hljs-built_in">this</span>::loadUserFromDB);  <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨</span>
        
        <span class="hljs-keyword">return</span> loadingCache.get(userId);
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨å¼‚æ­¥ç¼“å­˜è·å–å•†å“ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Product&gt; <span class="hljs-title function_">getProductAsync</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-keyword">return</span> productCache.get(productId);
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡è·å–å•†å“
     */</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Iterable&lt;Product&gt;&gt; <span class="hljs-title function_">getProductsAsync</span><span class="hljs-params">(
            Iterable&lt;Long&gt; productIds)</span> {
        <span class="hljs-keyword">return</span> productCache.getAll(productIds);
    }
    
    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCacheStats</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> userCache.stats();
        
        <span class="hljs-keyword">return</span> String.format(
            <span class="hljs-string">"å‘½ä¸­ç‡: %.2f%%, å‘½ä¸­æ•°: %d, æœªå‘½ä¸­æ•°: %d, åŠ è½½æˆåŠŸ: %d, åŠ è½½å¤±è´¥: %d, æ€»åŠ è½½æ—¶é—´: %dms"</span>,
            stats.hitRate() * <span class="hljs-number">100</span>,
            stats.hitCount(),
            stats.missCount(),
            stats.loadSuccessCount(),
            stats.loadFailureCount(),
            stats.totalLoadTime()
        );
    }
    
    <span class="hljs-comment">/**
     * é«˜çº§ç”¨æ³•ï¼šäº‹ä»¶ç›‘å¬
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setupCacheWithListener</span><span class="hljs-params">()</span> {
        Cache&lt;Long, Order&gt; orderCache = Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">1000</span>)
            .expireAfterWrite(Duration.ofMinutes(<span class="hljs-number">30</span>))
            .removalListener((Long key, Order order, RemovalCause cause) -&gt; {
                <span class="hljs-comment">// ç¼“å­˜æ¡ç›®è¢«ç§»é™¤æ—¶çš„å›è°ƒ</span>
                System.out.printf(<span class="hljs-string">"ç¼“å­˜ç§»é™¤: key=%s, cause=%s%n"</span>, key, cause);
                
                <span class="hljs-comment">// å¯ä»¥æ ¹æ®ä¸åŒçš„åŸå› å¤„ç†</span>
                <span class="hljs-keyword">switch</span> (cause) {
                    <span class="hljs-keyword">case</span> EXPLICIT:  <span class="hljs-comment">// æ˜¾å¼ç§»é™¤</span>
                        System.out.println(<span class="hljs-string">"æ˜¾å¼ç§»é™¤ç¼“å­˜: "</span> + key);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> REPLACED:  <span class="hljs-comment">// è¢«æ›¿æ¢</span>
                        System.out.println(<span class="hljs-string">"ç¼“å­˜è¢«æ›¿æ¢: "</span> + key);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> COLLECTED:  <span class="hljs-comment">// åƒåœ¾å›æ”¶</span>
                        System.out.println(<span class="hljs-string">"ç¼“å­˜è¢«GCå›æ”¶: "</span> + key);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> EXPIRED:  <span class="hljs-comment">// è¿‡æœŸ</span>
                        System.out.println(<span class="hljs-string">"ç¼“å­˜è¿‡æœŸ: "</span> + key);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> SIZE:  <span class="hljs-comment">// å¤§å°é™åˆ¶</span>
                        System.out.println(<span class="hljs-string">"å› å¤§å°é™åˆ¶ç§»é™¤: "</span> + key);
                        <span class="hljs-keyword">break</span>;
                }
            })
            .recordStats()
            .build();
        
        <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
        orderCache.put(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"å¾…æ”¯ä»˜"</span>));
        
        <span class="hljs-comment">// ç§»é™¤ç¼“å­˜ï¼ˆä¼šè§¦å‘EXPLICITäº‹ä»¶ï¼‰</span>
        orderCache.invalidate(<span class="hljs-number">1L</span>);
    }
    
    <span class="hljs-comment">/**
     * å¤æ‚åœºæ™¯ï¼šåˆ†å±‚ç¼“å­˜ç­–ç•¥
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">layeredCacheStrategy</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¬¬ä¸€å±‚ï¼šå°å®¹é‡ï¼Œè¶…å¿«è®¿é—®ï¼ˆä½¿ç”¨ConcurrentHashMapï¼‰</span>
        Cache&lt;Long, User&gt; L1Cache = Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">100</span>)
            .expireAfterWrite(Duration.ofSeconds(<span class="hljs-number">30</span>))
            .build();
        
        <span class="hljs-comment">// ç¬¬äºŒå±‚ï¼šå¤§å®¹é‡ï¼Œè¾ƒæ…¢è®¿é—®ï¼ˆä½¿ç”¨Caffeineï¼‰</span>
        Cache&lt;Long, User&gt; L2Cache = Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">10000</span>)
            .expireAfterWrite(Duration.ofMinutes(<span class="hljs-number">10</span>))
            .build();
        
        <span class="hljs-comment">// ç¬¬ä¸‰å±‚ï¼šå¼‚æ­¥åŠ è½½ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€</span>
        AsyncLoadingCache&lt;Long, User&gt; L3Cache = Caffeine.newBuilder()
            .maximumSize(<span class="hljs-number">50000</span>)
            .expireAfterWrite(Diration.ofHours(<span class="hljs-number">1</span>))
            .buildAsync(key -&gt; loadUserFromDB(key));
        
        <span class="hljs-comment">// ä½¿ç”¨åˆ†å±‚ç¼“å­˜çš„ç¤ºä¾‹</span>
        <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserMultiLevel</span><span class="hljs-params">(Long userId)</span> {
            <span class="hljs-comment">// 1. æŸ¥L1ç¼“å­˜</span>
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> L1Cache.getIfPresent(userId);
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                recordHit(<span class="hljs-string">"L1"</span>);
                <span class="hljs-keyword">return</span> user;
            }
            
            <span class="hljs-comment">// 2. æŸ¥L2ç¼“å­˜</span>
            user = L2Cache.getIfPresent(userId);
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// å›å¡«L1ç¼“å­˜</span>
                L1Cache.put(userId, user);
                recordHit(<span class="hljs-string">"L2"</span>);
                <span class="hljs-keyword">return</span> user;
            }
            
            <span class="hljs-comment">// 3. æŸ¥L3ç¼“å­˜ï¼ˆå¼‚æ­¥åŠ è½½ï¼‰</span>
            <span class="hljs-keyword">try</span> {
                user = L3Cache.get(userId).get(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
                
                <span class="hljs-comment">// å›å¡«L1å’ŒL2</span>
                L1Cache.put(userId, user);
                L2Cache.put(userId, user);
                
                recordHit(<span class="hljs-string">"L3"</span>);
                <span class="hljs-keyword">return</span> user;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// ç¼“å­˜åŠ è½½å¤±è´¥</span>
                recordMiss();
                <span class="hljs-keyword">return</span> loadUserFromDB(userId);  <span class="hljs-comment">// é™çº§åˆ°ç›´æ¥æŸ¥DB</span>
            }
        }
    }
    
    <span class="hljs-keyword">private</span> User <span class="hljs-title function_">loadUserFromDB</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: "</span> + userId);
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userId, <span class="hljs-string">"ç”¨æˆ·"</span> + userId);
    }
    
    <span class="hljs-keyword">private</span> Product <span class="hljs-title function_">loadProductFromDB</span><span class="hljs-params">(Long productId)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“åŠ è½½å•†å“: "</span> + productId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"å•†å“"</span> + productId);
    }
    
    <span class="hljs-keyword">private</span> Product <span class="hljs-title function_">reloadProductFromDB</span><span class="hljs-params">(Long productId)</span> {
        System.out.println(<span class="hljs-string">"åˆ·æ–°å•†å“ç¼“å­˜: "</span> + productId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"åˆ·æ–°åçš„å•†å“"</span> + productId);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordHit</span><span class="hljs-params">(String cacheLevel)</span> {
        <span class="hljs-comment">// è®°å½•å‘½ä¸­ç»Ÿè®¡</span>
        System.out.println(<span class="hljs-string">"ç¼“å­˜å‘½ä¸­ ["</span> + cacheLevel + <span class="hljs-string">"]"</span>);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordMiss</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®°å½•æœªå‘½ä¸­</span>
        System.out.println(<span class="hljs-string">"ç¼“å­˜æœªå‘½ä¸­"</span>);
    }
}
</code></pre>
<h3 data-id="heading-18">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ€§èƒ½å“è¶Š</strong>ï¼šè¯»æ€§èƒ½æ¥è¿‘<code>ConcurrentHashMap</code></li>
<li><strong>é«˜å‘½ä¸­ç‡</strong>ï¼šWindow-TinyLFUç®—æ³•æ˜¾è‘—æå‡å‘½ä¸­ç‡</li>
<li><strong>ç°ä»£API</strong>ï¼šåŸºäºJava 8ï¼Œæ”¯æŒå¼‚æ­¥ã€å‡½æ•°å¼ç¼–ç¨‹</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šæ™ºèƒ½çš„æƒé‡æ§åˆ¶å’Œæ·˜æ±°ç­–ç•¥</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>è¾ƒæ–°</strong>ï¼šç”Ÿæ€ä¸å¦‚Guava Cacheæˆç†Ÿ</li>
<li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šé«˜çº§åŠŸèƒ½éœ€è¦ç†è§£å…¶ç®—æ³•åŸç†</li>
<li><strong>åŠŸèƒ½ä¸“æ³¨</strong>ï¼šä¸»è¦å…³æ³¨å†…å­˜ç¼“å­˜ï¼Œä¸åƒEhcacheæ”¯æŒç£ç›˜</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯</li>
<li>éœ€è¦é«˜å‘½ä¸­ç‡çš„ç¼“å­˜ç­–ç•¥</li>
<li>ç°ä»£Javaé¡¹ç›®ï¼ˆJava 8+ï¼‰</li>
<li>ä½œä¸ºGuava Cacheçš„å‡çº§æ›¿ä»£</li>
</ul>
<p>æœ‰äº›å°ä¼™ä¼´ä»Guava Cacheè¿ç§»åˆ°Caffeineåï¼Œä¼šå‘ç°å‘½ä¸­ç‡æœ‰æ˜æ˜¾æå‡ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®è®¿é—®æ¨¡å¼å¤æ‚å¤šå˜çš„åœºæ™¯ä¸‹ã€‚</p>
<h2 data-id="heading-19">07 æ–¹æ¡ˆäº”ï¼šGuava Cache - ç»å…¸çš„é€‰æ‹©</h2>
<h3 data-id="heading-20">åŸç†ä¸ç‰¹ç‚¹</h3>
<p>Guava Cacheæ˜¯Google Guavaåº“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜é›…ã€åŠŸèƒ½å®Œå–„çš„æœ¬åœ°ç¼“å­˜å®ç°ã€‚</p>
<p>å®ƒæä¾›äº†<strong>ä¸°å¯Œçš„æ„å»ºé€‰é¡¹</strong>å’Œ<strong>çµæ´»çš„è¿‡æœŸç­–ç•¥</strong>ã€‚</p>
<h3 data-id="heading-21">å®æˆ˜ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.cache.*;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * Guava Cacheä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuavaCacheService</span> {
    
    <span class="hljs-comment">// 1. åŸºç¡€ç¼“å­˜ç¤ºä¾‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache&lt;Long, User&gt; userCache = CacheBuilder.newBuilder()
        .maximumSize(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>
        .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// å†™å…¥å10åˆ†é’Ÿè¿‡æœŸ</span>
        .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// è®¿é—®å5åˆ†é’Ÿè¿‡æœŸ</span>
        .concurrencyLevel(<span class="hljs-number">8</span>)  <span class="hljs-comment">// å¹¶å‘çº§åˆ«</span>
        .recordStats()  <span class="hljs-comment">// å¼€å¯ç»Ÿè®¡</span>
        .build();
    
    <span class="hljs-comment">// 2. å¸¦æƒé‡ç¼“å­˜çš„ä¾‹å­</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache&lt;String, <span class="hljs-type">byte</span>[]&gt; weightedCache = CacheBuilder.newBuilder()
        .maximumWeight(<span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)  <span class="hljs-comment">// æœ€å¤§100MB</span>
        .weigher(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Weigher</span>&lt;String, <span class="hljs-type">byte</span>[]&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">weigh</span><span class="hljs-params">(String key, <span class="hljs-type">byte</span>[] value)</span> {
                <span class="hljs-keyword">return</span> value.length;  <span class="hljs-comment">// æŒ‰å­—èŠ‚æ•°ç»„é•¿åº¦è®¡ç®—æƒé‡</span>
            }
        })
        .expireAfterWrite(<span class="hljs-number">2</span>, TimeUnit.HOURS)
        .build();
    
    <span class="hljs-comment">// 3. ä½¿ç”¨CacheLoaderè‡ªåŠ¨åŠ è½½</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()
        .maximumSize(<span class="hljs-number">5000</span>)
        .expireAfterWrite(<span class="hljs-number">1</span>, TimeUnit.HOURS)
        .refreshAfterWrite(<span class="hljs-number">30</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// å†™å…¥30åˆ†é’Ÿååˆ·æ–°</span>
        .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, Product&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">load</span><span class="hljs-params">(Long productId)</span> {
                <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨</span>
                <span class="hljs-keyword">return</span> loadProductFromDB(productId);
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">reload</span><span class="hljs-params">(Long productId, Product oldValue)</span> {
                <span class="hljs-comment">// åˆ·æ–°æ—¶è°ƒç”¨ï¼ˆé»˜è®¤å®ç°è°ƒç”¨loadï¼‰</span>
                <span class="hljs-keyword">return</span> reloadProductFromDB(productId);
            }
        });
    
    <span class="hljs-comment">/**
     * åŸºæœ¬ç”¨æ³•ï¼šæ‰‹åŠ¨put/get
     */</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserManual</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// å°è¯•è·å–ç¼“å­˜</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userCache.getIfPresent(userId);
        
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼ŒåŠ è½½æ•°æ®</span>
            user = loadUserFromDB(userId);
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                userCache.put(userId, user);
            }
        }
        
        <span class="hljs-keyword">return</span> user;
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨CacheLoaderè‡ªåŠ¨åŠ è½½
     */</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductAutoLoad</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨CacheLoader.load()</span>
            <span class="hljs-keyword">return</span> productCache.get(productId);
        } <span class="hljs-keyword">catch</span> (ExecutionException e) {
            <span class="hljs-comment">// å¤„ç†åŠ è½½å¼‚å¸¸</span>
            System.err.println(<span class="hljs-string">"åŠ è½½äº§å“å¤±è´¥: "</span> + productId);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡è·å–
     */</span>
    <span class="hljs-keyword">public</span> Iterable&lt;Product&gt; <span class="hljs-title function_">getProductsAutoLoad</span><span class="hljs-params">(Iterable&lt;Long&gt; productIds)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ‰¹é‡è·å–ï¼Œè‡ªåŠ¨åŠ è½½ç¼ºå¤±çš„æ•°æ®</span>
            <span class="hljs-keyword">return</span> productCache.getAll(productIds).values();
        } <span class="hljs-keyword">catch</span> (ExecutionException e) {
            System.err.println(<span class="hljs-string">"æ‰¹é‡åŠ è½½äº§å“å¤±è´¥"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * ç¼“å­˜åˆ·æ–°ç¤ºä¾‹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshProduct</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-comment">// å•ä¸ªåˆ·æ–°</span>
        productCache.refresh(productId);
        
        <span class="hljs-comment">// æˆ–è€…æ‰¹é‡åˆ·æ–°</span>
        <span class="hljs-comment">// for (Long id : productIds) {</span>
        <span class="hljs-comment">//     productCache.refresh(id);</span>
        <span class="hljs-comment">// }</span>
    }
    
    <span class="hljs-comment">/**
     * äº‹ä»¶ç›‘å¬å™¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setupCacheWithListener</span><span class="hljs-params">()</span> {
        RemovalListener&lt;Long, User&gt; removalListener = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemovalListener</span>&lt;Long, User&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRemoval</span><span class="hljs-params">(RemovalNotification&lt;Long, User&gt; notification)</span> {
                <span class="hljs-type">RemovalCause</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> notification.getCause();
                <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> notification.getKey();
                <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> notification.getValue();
                
                System.out.printf(<span class="hljs-string">"ç¼“å­˜ç§»é™¤: userId=%s, cause=%s%n"</span>, userId, cause);
                
                <span class="hljs-comment">// æ ¹æ®ä¸åŒçš„ç§»é™¤åŸå› å¤„ç†</span>
                <span class="hljs-keyword">switch</span> (cause) {
                    <span class="hljs-keyword">case</span> EXPLICIT:  <span class="hljs-comment">// æ˜¾å¼ç§»é™¤</span>
                        System.out.println(<span class="hljs-string">"ä¸»åŠ¨ç§»é™¤ç”¨æˆ·ç¼“å­˜: "</span> + userId);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> REPLACED:  <span class="hljs-comment">// è¢«æ›¿æ¢</span>
                        System.out.println(<span class="hljs-string">"ç”¨æˆ·ç¼“å­˜è¢«æ›¿æ¢: "</span> + userId);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> COLLECTED:  <span class="hljs-comment">// åƒåœ¾å›æ”¶</span>
                        System.out.println(<span class="hljs-string">"ç”¨æˆ·ç¼“å­˜è¢«GC: "</span> + userId);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> EXPIRED:  <span class="hljs-comment">// è¿‡æœŸ</span>
                        System.out.println(<span class="hljs-string">"ç”¨æˆ·ç¼“å­˜è¿‡æœŸ: "</span> + userId);
                        <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œ</span>
                        cleanupUserResources(user);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> SIZE:  <span class="hljs-comment">// å¤§å°é™åˆ¶</span>
                        System.out.println(<span class="hljs-string">"å› å®¹é‡é™åˆ¶ç§»é™¤ç”¨æˆ·: "</span> + userId);
                        <span class="hljs-keyword">break</span>;
                }
            }
            
            <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanupUserResources</span><span class="hljs-params">(User user)</span> {
                <span class="hljs-comment">// æ¸…ç†ç”¨æˆ·ç›¸å…³èµ„æº</span>
                <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                    System.out.println(<span class="hljs-string">"æ¸…ç†ç”¨æˆ·èµ„æº: "</span> + user.getId());
                }
            }
        };
        
        <span class="hljs-comment">// åˆ›å»ºå¸¦ç›‘å¬å™¨çš„ç¼“å­˜</span>
        Cache&lt;Long, User&gt; cacheWithListener = CacheBuilder.newBuilder()
            .maximumSize(<span class="hljs-number">1000</span>)
            .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
            .removalListener(removalListener)
            .build();
        
        <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
        cacheWithListener.put(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"æµ‹è¯•ç”¨æˆ·"</span>));
        cacheWithListener.invalidate(<span class="hljs-number">1L</span>);  <span class="hljs-comment">// è§¦å‘EXPLICITç§»é™¤</span>
    }
    
    <span class="hljs-comment">/**
     * ç»Ÿè®¡ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCacheStats</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> userCache.stats();
        
        System.out.println(<span class="hljs-string">"=== Guava Cache ç»Ÿè®¡ ==="</span>);
        System.out.println(<span class="hljs-string">"å‘½ä¸­ç‡: "</span> + stats.hitRate());
        System.out.println(<span class="hljs-string">"å‘½ä¸­æ•°: "</span> + stats.hitCount());
        System.out.println(<span class="hljs-string">"æœªå‘½ä¸­æ•°: "</span> + stats.missCount());
        System.out.println(<span class="hljs-string">"åŠ è½½æˆåŠŸæ•°: "</span> + stats.loadSuccessCount());
        System.out.println(<span class="hljs-string">"åŠ è½½å¼‚å¸¸æ•°: "</span> + stats.loadExceptionCount());
        System.out.println(<span class="hljs-string">"æ€»åŠ è½½æ—¶é—´: "</span> + stats.totalLoadTime() + <span class="hljs-string">"ns"</span>);
        System.out.println(<span class="hljs-string">"é©±é€æ•°: "</span> + stats.evictionCount());
    }
    
    <span class="hljs-comment">/**
     * å¤æ‚åœºæ™¯ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">multiLevelCacheExample</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¬¬ä¸€çº§ï¼šé«˜é¢‘å°ç¼“å­˜</span>
        LoadingCache&lt;Long, String&gt; L1Cache = CacheBuilder.newBuilder()
            .maximumSize(<span class="hljs-number">100</span>)
            .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
            .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, String&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(Long key)</span> {
                    <span class="hljs-comment">// L1æœªå‘½ä¸­ï¼ŒæŸ¥L2</span>
                    <span class="hljs-keyword">return</span> L2Cache.get(key);
                }
            });
        
        <span class="hljs-comment">// ç¬¬äºŒçº§ï¼šä½é¢‘å¤§ç¼“å­˜</span>
        LoadingCache&lt;Long, String&gt; L2Cache = CacheBuilder.newBuilder()
            .maximumSize(<span class="hljs-number">10000</span>)
            .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
            .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, String&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(Long key)</span> {
                    <span class="hljs-comment">// L2æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®æº</span>
                    <span class="hljs-keyword">return</span> loadFromDataSource(key);
                }
            });
        
        <span class="hljs-comment">// ä½¿ç”¨å¤šçº§ç¼“å­˜</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValueMultiLevel</span><span class="hljs-params">(Long key)</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> L1Cache.get(key);
            } <span class="hljs-keyword">catch</span> (ExecutionException e) {
                System.err.println(<span class="hljs-string">"å¤šçº§ç¼“å­˜è·å–å¤±è´¥: "</span> + key);
                <span class="hljs-keyword">return</span> loadFromDataSource(key);
            }
        }
    }
    
    <span class="hljs-comment">// è¾…åŠ©æ–¹æ³•</span>
    <span class="hljs-keyword">private</span> User <span class="hljs-title function_">loadUserFromDB</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·: "</span> + userId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userId, <span class="hljs-string">"ç”¨æˆ·"</span> + userId);
    }
    
    <span class="hljs-keyword">private</span> Product <span class="hljs-title function_">loadProductFromDB</span><span class="hljs-params">(Long productId)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“åŠ è½½å•†å“: "</span> + productId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"å•†å“"</span> + productId);
    }
    
    <span class="hljs-keyword">private</span> Product <span class="hljs-title function_">reloadProductFromDB</span><span class="hljs-params">(Long productId)</span> {
        System.out.println(<span class="hljs-string">"åˆ·æ–°å•†å“æ•°æ®: "</span> + productId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"åˆ·æ–°åçš„å•†å“"</span> + productId);
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">loadFromDataSource</span><span class="hljs-params">(Long key)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®æºåŠ è½½: "</span> + key);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ•°æ®"</span> + key;
    }
}
</code></pre>
<h3 data-id="heading-22">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>è®¾è®¡ä¼˜é›…</strong>ï¼šAPIè®¾è®¡ä¸€è‡´ä¸”æ˜“äºä½¿ç”¨</li>
<li><strong>åŠŸèƒ½å®Œå–„</strong>ï¼šæ”¯æŒæƒé‡ã€åˆ·æ–°ã€ç›‘å¬å™¨ç­‰é«˜çº§åŠŸèƒ½</li>
<li><strong>Googleç»´æŠ¤</strong>ï¼šè´¨é‡æœ‰ä¿éšœï¼Œæ–‡æ¡£å®Œå–„</li>
<li><strong>ç”Ÿæ€ä¸°å¯Œ</strong>ï¼šGuavaåº“çš„å…¶ä»–åŠŸèƒ½å¯ä»¥ååŒå·¥ä½œ</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ€§èƒ½ä¸å¦‚Caffeine</strong>ï¼šåœ¨å¹¶å‘æé«˜åœºæ™¯ä¸‹æ€§èƒ½ç¨å·®</li>
<li><strong>åœæ­¢æ¼”è¿›</strong>ï¼šæ–°åŠŸèƒ½å¼€å‘åŸºæœ¬åœæ­¢</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šç»Ÿè®¡ä¿¡æ¯ç­‰å¼€é”€è¾ƒå¤§</li>
<li><strong>Java 8ç‰¹æ€§åˆ©ç”¨ä¸è¶³</strong>ï¼šåŸºäºè¾ƒè€çš„Javaç‰ˆæœ¬è®¾è®¡</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å·²ç»ä½¿ç”¨Guavaåº“çš„é¡¹ç›®</li>
<li>å¯¹APIè®¾è®¡ä¼˜é›…æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li>ä¸éœ€è¦æè‡´æ€§èƒ½çš„ä¸€èˆ¬ç¼“å­˜éœ€æ±‚</li>
<li>ä½œä¸ºCaffeineçš„è¿‡æ¸¡æ–¹æ¡ˆ</li>
</ul>
<p>æœ‰äº›å°ä¼™ä¼´çš„é¡¹ç›®å› ä¸ºå†å²åŸå› ä¸€ç›´åœ¨ç”¨Guava Cacheï¼Œå®ƒçš„ç¨³å®šæ€§å’ŒåŠŸèƒ½æ€§ç¡®å®èƒ½æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ã€‚ä½†å¦‚æœæ˜¯æ–°é¡¹ç›®ï¼ŒCaffeineå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<h2 data-id="heading-23">08 ç»¼åˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ·±å…¥äº†è§£äº†5ç§æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­é€‰æ‹©å‘¢ï¼Ÿä¸‹é¢çš„å¯¹æ¯”å›¾å’Œé€‰å‹æŒ‡å—å¯ä»¥å¸®åŠ©ä½ åšå‡ºå†³ç­–ã€‚</p>
<h3 data-id="heading-24">æ–¹æ¡ˆå¯¹æ¯”æ€»è§ˆ</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44f636cc6371400180eccbcf226cdbc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768960684&amp;x-signature=SZIzQZgFw3qWDF2vCM%2F6Ixk6Wuw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-25">è¯¦ç»†å¯¹æ¯”è¡¨</h3>





























































<table><thead><tr><th>ç»´åº¦</th><th><strong>ConcurrentHashMap</strong></th><th><strong>LRUç¼“å­˜</strong></th><th><strong>Ehcache</strong></th><th><strong>Caffeine</strong></th><th><strong>Guava Cache</strong></th></tr></thead><tbody><tr><td><strong>æ˜“ç”¨æ€§</strong></td><td>æç®€ â­â­â­â­â­</td><td>ç®€å• â­â­â­â­â˜†</td><td>å¤æ‚ â­â­â˜†â˜†â˜†</td><td>ä¸­ç­‰ â­â­â­â˜†â˜†</td><td>è‰¯å¥½ â­â­â­â­â˜†</td></tr><tr><td><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td><td>åŸºç¡€ â­â˜†â˜†â˜†â˜†</td><td>åŸºæœ¬ â­â­â˜†â˜†â˜†</td><td>å…¨é¢ â­â­â­â­â­</td><td>ä¸°å¯Œ â­â­â­â­â˜†</td><td>å®Œå–„ â­â­â­â­â˜†</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æä¼˜ â­â­â­â­â­</td><td>è‰¯å¥½ â­â­â­â˜†â˜†</td><td>ä¸­ç­‰ â­â­â­â˜†â˜†</td><td>å“è¶Š â­â­â­â­â­</td><td>ä¼˜ç§€ â­â­â­â­â˜†</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>æ— è‡ªåŠ¨ç®¡ç† â­â˜†â˜†â˜†â˜†</td><td>LRUæ·˜æ±° â­â­â­â˜†â˜†</td><td>å¤šçº§ç®¡ç† â­â­â­â­â­</td><td>æ™ºèƒ½æ·˜æ±° â­â­â­â­â˜†</td><td>å®Œå–„ç®¡ç† â­â­â­â­â˜†</td></tr><tr><td><strong>ç¤¾åŒºç”Ÿæ€</strong></td><td>JDKè‡ªå¸¦ â­â­â­â­â­</td><td>JDKè‡ªå¸¦ â­â­â­â­â­</td><td>æˆç†Ÿä½†è€ â­â­â­â˜†â˜†</td><td>æ´»è·ƒå¢é•¿ â­â­â­â­â˜†</td><td>ç¨³å®šä½†åœæ» â­â­â­â˜†â˜†</td></tr><tr><td><strong>é€‚ç”¨è§„æ¨¡</strong></td><td>å°å‹ â­â­â˜†â˜†â˜†</td><td>ä¸­å°å‹ â­â­â­â˜†â˜†</td><td>ä¸­å¤§å‹ â­â­â­â­â˜†</td><td>å…¨è§„æ¨¡ â­â­â­â­â­</td><td>ä¸­å°å‹ â­â­â­â˜†â˜†</td></tr></tbody></table>
<h3 data-id="heading-26">é€‰å‹å†³ç­–æŒ‡å—</h3>
<p>æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯è¦æ±‚ï¼Œæˆ‘ç»™å‡ºä»¥ä¸‹é€‰å‹å»ºè®®ï¼š</p>
<ol>
<li>
<p><strong>åˆåˆ›é¡¹ç›®/åŸå‹éªŒè¯</strong> â†’ <strong>ConcurrentHashMap</strong> æˆ– <strong>LRUç¼“å­˜</strong></p>
<ul>
<li>ç†ç”±ï¼šå¿«é€Ÿå®ç°ï¼Œæ— éœ€å¼•å…¥å¤–éƒ¨ä¾èµ–</li>
<li>æ³¨æ„ï¼šéšç€ä¸šåŠ¡å¢é•¿ï¼Œéœ€è¦é‡æ„ä¸ºæ›´ä¸“ä¸šçš„æ–¹æ¡ˆ</li>
</ul>
</li>
<li>
<p><strong>é«˜æ€§èƒ½è¦æ±‚/ç°ä»£Javaé¡¹ç›®</strong> â†’ <strong>Caffeine</strong></p>
<ul>
<li>ç†ç”±ï¼šæœ€ä¼˜çš„æ€§èƒ½å’Œå‘½ä¸­ç‡</li>
<li>æ³¨æ„ï¼šéœ€è¦Java 8+ç¯å¢ƒ</li>
</ul>
</li>
<li>
<p><strong>ä¼ä¸šçº§å¤æ‚éœ€æ±‚</strong> â†’ <strong>Ehcache</strong></p>
<ul>
<li>ç†ç”±ï¼šåŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒé›†ç¾¤å’ŒæŒä¹…åŒ–</li>
<li>æ³¨æ„ï¼šé…ç½®è¾ƒå¤æ‚ï¼Œå­¦ä¹ æˆæœ¬é«˜</li>
</ul>
</li>
<li>
<p><strong>å·²æœ‰Guavaç”Ÿæ€/APIè®¾è®¡ä¼˜å…ˆ</strong> â†’ <strong>Guava Cache</strong></p>
<ul>
<li>ç†ç”±ï¼šä¼˜é›…çš„APIï¼Œè‰¯å¥½çš„å¼€å‘è€…ä½“éªŒ</li>
<li>æ³¨æ„ï¼šæ€§èƒ½ä¸æ˜¯æœ€ä¼˜ï¼Œä¸”ä¸å†ç§¯æå¼€å‘</li>
</ul>
</li>
<li>
<p><strong>ç‰¹å®šåœºæ™¯éœ€æ±‚</strong>ï¼š</p>
<ul>
<li><strong>è®¿é—®æœ‰æ˜æ˜¾çƒ­ç‚¹</strong> â†’ LRUç¼“å­˜</li>
<li><strong>éœ€è¦è‡ªå®šä¹‰æ·˜æ±°ç­–ç•¥</strong> â†’ åŸºäºConcurrentHashMapè‡ªå®ç°</li>
<li><strong>å†…å­˜æ•æ„Ÿåœºæ™¯</strong> â†’ Caffeineï¼ˆæ™ºèƒ½æƒé‡æ§åˆ¶ï¼‰</li>
<li><strong>éœ€è¦ç›‘æ§ç»Ÿè®¡</strong> â†’ Ehcacheæˆ–Caffeine</li>
</ul>
</li>
</ol>
<h2 data-id="heading-27">æ€»ç»“</h2>
<p>æœ¬åœ°ç¼“å­˜æ˜¯Javaåº”ç”¨ä¸­æå‡æ€§èƒ½çš„åˆ©å™¨ï¼Œé€‰æ‹©æ­£ç¡®çš„æ–¹æ¡ˆå¯ä»¥è®©ç³»ç»Ÿæ€§èƒ½å¾—åˆ°è´¨çš„æå‡ã€‚</p>
<p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>ConcurrentHashMap</strong>æ˜¯æœ€åŸºç¡€çš„æ–¹æ¡ˆï¼Œé€‚åˆç®€å•åœºæ™¯æˆ–ä½œä¸ºè‡ªå®šä¹‰ç¼“å­˜çš„åŸºç¡€ã€‚</p>
</li>
<li>
<p><strong>LRUç¼“å­˜</strong>åŸºäºLinkedHashMapï¼Œè§£å†³äº†è‡ªåŠ¨æ·˜æ±°çš„é—®é¢˜ï¼Œé€‚åˆè®¿é—®æœ‰çƒ­ç‚¹çš„åœºæ™¯ã€‚</p>
</li>
<li>
<p><strong>Ehcache</strong>æ˜¯ä¼ä¸šçº§é€‰æ‹©ï¼ŒåŠŸèƒ½å…¨é¢ä½†è¾ƒé‡ï¼Œé€‚åˆå¤æ‚çš„ä¼ä¸šåº”ç”¨ã€‚</p>
</li>
<li>
<p><strong>Caffeine</strong>æ˜¯ç°ä»£é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œæä¾›äº†æœ€ä¼˜çš„å‘½ä¸­ç‡å’Œå¹¶å‘æ€§èƒ½ï¼Œæ˜¯æ–°é¡¹ç›®çš„é¦–é€‰ã€‚</p>
</li>
<li>
<p><strong>Guava Cache</strong>è®¾è®¡ä¼˜é›…ï¼ŒAPIå‹å¥½ï¼Œé€‚åˆå·²ç»ä½¿ç”¨Guavaåº“æˆ–å¯¹APIè®¾è®¡æœ‰è¦æ±‚çš„é¡¹ç›®ã€‚</p>
</li>
</ol>
<p>**è®°ä½ï¼Œæ²¡æœ‰æœ€å¥½çš„ç¼“å­˜æ–¹æ¡ˆï¼Œåªæœ‰æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä¸ªäººçš„å€¾å‘æ˜¯ï¼šå¯¹äºæ–°é¡¹ç›®ï¼Œä¼˜å…ˆè€ƒè™‘<strong>Caffeine</strong>ï¼›å¯¹äºå·²æœ‰Guavaçš„é¡¹ç›®ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨<strong>Guava Cache</strong>ï¼›å¯¹äºç‰¹åˆ«ç®€å•çš„éœ€æ±‚ï¼Œç”¨<strong>ConcurrentHashMap</strong>æˆ–<strong>LRUç¼“å­˜</strong>ï¼›å¯¹äºéœ€è¦ä¼ä¸šçº§ç‰¹æ€§çš„åœºæ™¯ï¼Œé€‰æ‹©<strong>Ehcache</strong>ã€‚</p>
<p>ç¼“å­˜è™½å¥½ï¼Œä½†ä¹Ÿè¦åˆç†ä½¿ç”¨ã€‚è¿‡åº¦ç¼“å­˜ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼Œç¼“å­˜ä¸ä¸€è‡´ä¼šå¯¼è‡´ä¸šåŠ¡é—®é¢˜ã€‚</p>
<h2 data-id="heading-28">æœ€åè¯´ä¸€å¥(æ±‚å…³æ³¨ï¼Œåˆ«ç™½å«–æˆ‘)</h2>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæˆ–è€…æœ‰æ‰€å¯å‘çš„è¯ï¼Œå¸®å¿™å…³æ³¨ä¸€ä¸‹æˆ‘çš„åŒåå…¬ä¼—å·ï¼šè‹ä¸‰è¯´æŠ€æœ¯ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘åšæŒå†™ä½œæœ€å¤§çš„åŠ¨åŠ›ã€‚</p>
<p>æ±‚ä¸€é”®ä¸‰è¿ï¼šç‚¹èµã€è½¬å‘ã€åœ¨çœ‹ã€‚</p>
<p>å…³æ³¨å…¬ä¼—å·ï¼šã€è‹ä¸‰è¯´æŠ€æœ¯ã€‘ï¼Œåœ¨å…¬ä¼—å·ä¸­å›å¤ï¼šè¿›å¤§å‚ï¼Œå¯ä»¥å…è´¹è·å–æˆ‘æœ€è¿‘æ•´ç†çš„10ä¸‡å­—çš„é¢è¯•å®å…¸ï¼Œå¥½å¤šå°ä¼™ä¼´é è¿™ä¸ªå®å…¸æ‹¿åˆ°äº†å¤šå®¶å¤§å‚çš„offerã€‚</p>
<p>æ›´å¤šé¡¹ç›®å®æˆ˜ï¼šsusan.net.cn/project</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€åœºæ™¯ã€æ—¥å¿—ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ç­‰]]></title>    <link>https://juejin.cn/post/7595120207736733730</link>    <guid>https://juejin.cn/post/7595120207736733730</guid>    <pubDate>2026-01-15T05:34:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595120207736733730" data-draft-id="7595043061729148962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€åœºæ™¯ã€æ—¥å¿—ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ç­‰"/> <meta itemprop="keywords" content="äº§å“"/> <meta itemprop="datePublished" content="2026-01-15T05:34:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€åœºæ™¯ã€æ—¥å¿—ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ç­‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:34:09.000Z" title="Thu Jan 15 2026 05:34:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è§‚æµ‹äº‘æ›´æ–°</h2>
<h3 data-id="heading-1">ç›‘æ§</h3>
<p>é¢å‘æµ·å¤–ç«™ç‚¹ï¼Œæ–°å¢Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmonitoring%2Fnotify-target-google-chat%2F" target="_blank" title="https://docs.guance.com/monitoring/notify-target-google-chat/" ref="nofollow noopener noreferrer">Google Chat</a>Â ä¸ºé€šçŸ¥å¯¹è±¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b214ed88edf4886a7230fbe79125bab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=%2Bbp%2FSn859nJIeHdrnVTRpSDAgz8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">APM</h3>
<p>1ã€æœåŠ¡è¯¦æƒ…ï¼š</p>
<ul>
<li>
<p>èµ„æºè°ƒç”¨ &gt; ä¸Šä¸‹æ¸¸è°ƒç”¨ï¼šäº¤äº’æ•ˆæœå¢å¼ºï¼š</p>
<ul>
<li>å¿«æ·æ‰©å±•ï¼šæ‚¬æµ®èµ„æºèŠ‚ç‚¹æ—¶å¯ç‚¹å‡» â€œ+â€ æŒ‰é’®ï¼Œå¿«é€ŸåŠ è½½å…¶ä¸Šä¸‹æ¸¸ã€‚èµ·æ­¢èŠ‚ç‚¹ä¼šæ˜¾ç¤º â€œStartâ€/â€œEndâ€ æ ‡è¯†ã€‚</li>
<li>è¿çº¿æ˜¾ç¤ºæŒ‡æ ‡ï¼šè¿æ¥çº¿ä¸Šç›´æ¥å±•ç¤ºè¯·æ±‚æ•°ã€P99è€—æ—¶ã€é”™è¯¯ç‡ï¼Œå¹¶é…æœ‰å›¾ä¾‹è¯´æ˜ã€‚</li>
<li>æ–°å¢åŠ è½½æç¤ºï¼šæ‰©å±•æ‹“æ‰‘æ—¶æ˜¾ç¤ºâ€œåŠ è½½ä¸­â€çŠ¶æ€ã€‚</li>
<li>ä¸€é”®å…¨å±ï¼šæ–°å¢å…¨å±æŒ‰é’®ï¼Œæ”¯æŒä¸€é”®æ”¾å¤§/è¿˜åŸæ‹“æ‰‘å›¾ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58825ce290a8436eb0c38a005305c95a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=FLqwxQNqXDP7PqCTyiNr7yZFX1s%3D" alt="" loading="lazy"/></p>
<ul>
<li>æœåŠ¡æ‹“æ‰‘ï¼šæ–°å¢â€œåŸºç¡€è®¾æ–½â€é€‰é¡¹ï¼Œç‚¹å‡»åæ”¯æŒåˆ‡æ¢å±•ç¤ºâ€œä¸»æœºâ€æˆ– â€œPodâ€ æ‹“æ‰‘å›¾ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1864199c62f94c3b896a43e769a5af36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=CYxAJwqz6RKaIMqyhaBVqndGOfc%3D" alt="" loading="lazy"/></p>
<ul>
<li>æ–°å¢â€œåŸºç¡€è®¾æ–½â€ tab é¡µï¼šåœ¨ä¸»æœºä¸ Pod è§†å›¾é—´åˆ‡æ¢ï¼Œå±•ç¤ºä¸»æœºè¶‹åŠ¿å›¾ä¸åˆ—è¡¨ï¼Œç‚¹å‡»åˆ—è¡¨é¡¹å¯å±•å¼€è¯¦æƒ…é¡µæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7582194cbc634160863a49672c08841e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=b8s5AOR9ypqZ2v4%2Fjcmnw5z7%2B5Q%3D" alt="" loading="lazy"/></p>
<p>2ã€é“¾è·¯ &gt; è¯¦æƒ…é¡µï¼šå…³è”æ—¥å¿—ï¼šä¼˜åŒ–ç´¢å¼•ç­›é€‰åŠŸèƒ½ï¼Œé»˜è®¤é€‰ä¸­å½“å‰é“¾è·¯å†…æ‰€æœ‰å…³è”æœåŠ¡çš„å…¨éƒ¨ç´¢å¼•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daabf80ad84b4985bfed241d5001c037~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=6HNxNAMZF1f4OQKOWX6MOwFRChQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">åœºæ™¯</h3>
<p>1ã€ä»ªè¡¨æ¿ï¼š</p>
<ul>
<li>æ”¯æŒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fdashboard%2Fconfig-page%2F%23share-dashboard" target="_blank" title="https://docs.guance.com/scene/dashboard/config-page/#share-dashboard" ref="nofollow noopener noreferrer">åˆ†äº«ä»ªè¡¨æ¿</a>ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/595aa18fcb174d458f4e06ef5c42b795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=AsoEndIuG6V6KiOOt2KL%2FcH%2FQLg%3D" alt="" loading="lazy"/></p>
<ul>
<li>æ–°å¢æ”¯æŒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fdashboard%2Fconfig-list%2F%23label" target="_blank" title="https://docs.guance.com/scene/dashboard/config-list/#label" ref="nofollow noopener noreferrer">æ ‡ç­¾æƒé™</a>ç®¡ç†é¡µï¼Œé€šè¿‡æ ‡ç­¾ç»Ÿä¸€æ§åˆ¶ä»ªè¡¨æ¿çš„æŸ¥çœ‹ä¸ç®¡ç†æƒé™ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9aa4343a5444ba8b58b9829cff90953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=wDv5QHI7TDKTR7fmB%2BODI80mRbM%3D" alt="" loading="lazy"/></p>
<p>2ã€å›¾è¡¨æŸ¥è¯¢ï¼šå½“é€‰æ‹© in å’Œ not in ç­›é€‰æ¡ä»¶ï¼Œå¯ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fvisual-chart%2Fchart-simple-query%2F%23filter-query" target="_blank" title="https://docs.guance.com/scene/visual-chart/chart-simple-query/#filter-query" ref="nofollow noopener noreferrer">å­æŸ¥è¯¢</a>çš„ç»“æœä½œä¸ºç­›é€‰å€¼ï¼›</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb43678cd4d9432195ed6e9931546029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=dbAIGGtjrrLNyo6h6Ql%2FpY2oa9A%3D" alt="" loading="lazy"/></p>
<p>3ã€å›¾è¡¨åˆ†äº«ï¼šæ–°å¢æ”¯æŒé€šè¿‡<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fvisual-chart%2F%23link" target="_blank" title="https://docs.guance.com/scene/visual-chart/#link" ref="nofollow noopener noreferrer">é“¾æ¥</a>åˆ†äº«å›¾è¡¨ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/268f47c33a2d491b935b4ea1b8610368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=340ixwBc2WPS9lTd%2FptOVlQPeAE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">æ—¥å¿—</h3>
<p>ç´¢å¼•ï¼šæ–°å¢ç´¢å¼•åç§°æœç´¢åŠŸèƒ½ï¼Œè‡ªåŠ¨ç»Ÿè®¡æœç´¢è¿”å›çš„å„ç´¢å¼•ç±»å‹æ•°é‡ï¼Œå¹¶å®šä½è‡³ç»Ÿè®¡æ•°é‡æœ€å¤šçš„ç´¢å¼•ç±»å‹ tabã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06916b294904c568fa6329c37906925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=F6WiHtDULkt3lhACRfOF1AclIPY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">ç®¡ç†</h3>
<p>1ã€åˆ†äº«ç®¡ç†ï¼š</p>
<ul>
<li>åˆ†äº«å¿«ç…§/ä»ªè¡¨æ¿ï¼šæ–°å¢è¯­è¨€åˆ‡æ¢æŒ‰é’®ï¼Œæ»¡è¶³å…¨çƒç”¨æˆ·ä½¿ç”¨éœ€æ±‚ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b33baa3417044ea9dc023f4a11ac78f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=Aw3FISRjkgpDrC%2FR%2BvcwF%2BRTVnw%3D" alt="" loading="lazy"/></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Fshare-management%2F%23chart" target="_blank" title="https://docs.guance.com/management/share-management/#chart" ref="nofollow noopener noreferrer">åˆ†äº«å›¾è¡¨</a>ï¼šæ–°å¢åµŒå…¥ä»£ç ã€é“¾æ¥åˆ‡æ¢æŒ‰é’®ï¼Œå¯åˆ‡æ¢æŸ¥çœ‹å¯¹åº”çš„å›¾è¡¨ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb991c98cfb24dadbf3dd10611668983~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=1ukKBRCwwHdbMJdwJoAqxVF75QE%3D" alt="" loading="lazy"/></p>
<ul>
<li>æ–°å¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Fshare-management%2F%23dashboard" target="_blank" title="https://docs.guance.com/management/share-management/#dashboard" ref="nofollow noopener noreferrer">åˆ†äº«ä»ªè¡¨æ¿</a>ç®¡ç†é¡µã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd8eb6c4dc7b452ab7507f64db4c06e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=NudaxxJYpQPpu1oyzoJ2laE%2FIZg%3D" alt="" loading="lazy"/></p>
<p>2ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Fapi-key%2F" target="_blank" title="https://docs.guance.com/management/api-key/" ref="nofollow noopener noreferrer">API Key ç®¡ç†</a>ï¼šæ‰©å±• API å¯†é’¥çš„æƒé™ï¼Œä»¥æ»¡è¶³æ‰€æœ‰è€…è§’è‰²çš„é«˜é˜¶æ“ä½œéœ€æ±‚ã€‚</p>
<p>3ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Frole-management%2F%23operations" target="_blank" title="https://docs.guance.com/management/role-management/#operations" ref="nofollow noopener noreferrer">è§’è‰²ç®¡ç†</a>ï¼šæ–°å¢â€œä»…æ˜¾ç¤ºå·²å¯ç”¨çš„æƒé™â€å¼€å…³ã€‚</p>
<h3 data-id="heading-6">RUM</h3>
<p>æ‰©å±• Androidã€iOSã€React Native çš„ SDK æ¥å…¥é…ç½®ï¼Œæ–°å¢ RUMã€é“¾è·¯ã€æ—¥å¿—çš„é«˜é˜¶åŠŸèƒ½é…ç½®é¡¹ï¼Œå¹¶åœ¨å…¶è¢«ä¿®æ”¹æ—¶æä¾›æ˜ç¡®çš„é«˜äº®æç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77959f1bd6904498934e9fb190b73356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060049&amp;x-signature=WJX%2BJ1O8658LzvhIz5yj5n8NBJs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">ä»˜è´¹è®¡åˆ’ä¸è´¦å•</h3>
<p>ä¼˜åŒ–æœˆåº¦è´¦å•çš„èšåˆé€»è¾‘ï¼Œæ–°å¢æ—¥è´¦å•ï¼ˆä» 1 å·åˆ°æŸ¥è¯¢æ—¥æœŸï¼‰çš„æ‰€æœ‰ç´¯è®¡æ¶ˆè´¹ã€‚</p>
<h2 data-id="heading-8">é›†æˆæ›´æ–°</h2>
<ul>
<li>æ–°å¢ OBCloud Oceanbase é›†æˆæ–‡æ¡£ï¼›</li>
<li>zabbix-api/stream æ–¹å¼é›†æˆæ–‡æ¡£ä¼˜åŒ–ï¼›</li>
<li>Go é›†æˆæ–‡æ¡£ä¼˜åŒ–ï¼Œç¼–è¯‘æ—¶æ’æ¡©æ–°å¢ 1.18-2.23 çš„é›†æˆæ–¹å¼ï¼›</li>
<li>æ–°å¢èµ„æºç›®å½•æ¨¡ç‰ˆ tencentcloud_clbï¼Œaliyun_cnapigatewayï¼Œaliyun_slbï¼Œaws_api_gatewayã€‚</li>
</ul>
<h2 data-id="heading-9">DataKit æ›´æ–°</h2>
<h3 data-id="heading-10">æ–°åŠ åŠŸèƒ½</h3>
<ul>
<li>æ–°å¢æ•°æ®é‡‡é›†å¯ç”¨æ€§æŒ‡æ ‡é‡‡é›†</li>
<li>DCA æ–°å¢ DataKit å­˜æ´»æ£€æµ‹</li>
</ul>
<h3 data-id="heading-11">é—®é¢˜ä¿®å¤</h3>
<ul>
<li>ä¿®å¤ Pod å†…å­˜é‡‡é›†æ•°å€¼è™šé«˜é—®é¢˜</li>
<li>ä¿®å¤ Pod é‡å¯å KubernetesPrometheus æœªèƒ½é‡æ–°é‡‡é›†çš„é—®é¢˜</li>
<li>ä¿®å¤æ— æ³•é‡‡é›† DDTrace ä¸­ NodeJS profile çš„é—®é¢˜ï¼Œè¦å®Œæ•´æ”¯æŒ DDTrace NodeJS profile é‡‡é›†ï¼Œåº•åº§ä»éœ€å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬</li>
<li>ä¿®å¤å¤šæ­¥æ‹¨æµ‹é‡è¯•é—®é¢˜</li>
<li>ä¿®å¤ AWS Lambda æ‰©å±•é‡‡é›†å¼‚å¸¸é—®é¢˜</li>
</ul>
<h3 data-id="heading-12">åŠŸèƒ½ä¼˜åŒ–</h3>
<ul>
<li>DataKit æ—¥å¿—è¾“å‡ºä¸­ï¼Œç»™Â <code>ERROR</code>Â çº§åˆ«çš„æ—¥å¿—å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆé»˜è®¤ä¸ºÂ <em>error.log</em>ï¼‰ï¼Œé¿å…å…¶è¢«å…¶å®ƒæ—¥å¿—è¦†ç›–æ‰ï¼ŒåŒæ—¶ bug report ä¸­ä¹Ÿä¼šå¸¦ä¸Šè¿™ä¸ªé”™è¯¯æ—¥å¿—</li>
<li>ä¼˜åŒ–ç£ç›˜ç¼“å­˜æ¨¡å—ï¼ˆWALï¼‰ï¼Œæ–°å¢æ›´å¤šæŒ‡æ ‡å’Œæ—¥å¿—æš´éœ²ï¼ŒåŒæ—¶ä¼˜åŒ–Â  <em>.pos</em>Â æ–‡ä»¶å¯¹ç£ç›˜ io çš„å½±å“</li>
<li>SNMP é‡‡é›†æ–°å¢æ›´å¤š yaml é…ç½®ï¼Œä¿®å¤ä¸€äº›å†å²é—ç•™é—®é¢˜</li>
<li>å®¹å™¨æ—¥å¿—é‡‡é›†å’Œ logfwd æ–°å¢Â <code>from_beginning_threshold_size</code>Â é…ç½®é¡¹</li>
<li>å¤šä¸ªé‡‡é›†å™¨é‡‡é›†çš„æ•°æ®ä¸Šå¢åŠ äº†Â <code>collector_source_ip</code>Â å­—æ®µï¼Œè¡¨ç¤ºå…¶æ•°æ®æ¥æº</li>
</ul>
<h3 data-id="heading-13">å…¼å®¹è°ƒæ•´</h3>
<ul>
<li>SNMP é‡‡é›†çš„æ•°æ®ä¸­ç§»é™¤äº†å¯¹è±¡æ•°æ®ä¸­çš„Â <code>all</code>Â å†—ä½™å­—æ®µ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[`kubectl top nodes` æˆ– `kubectl top pods` è¿”å› `metrics not available yet` çš„æ’æŸ¥ã€è§£å†³]]></title>    <link>https://juejin.cn/post/7595162224899948582</link>    <guid>https://juejin.cn/post/7595162224899948582</guid>    <pubDate>2026-01-15T03:35:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595162224899948582" data-draft-id="7595147871939477550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="`kubectl top nodes` æˆ– `kubectl top pods` è¿”å› `metrics not available yet` çš„æ’æŸ¥ã€è§£å†³"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-15T03:35:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½•è¾¾ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/4206083706979930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            `kubectl top nodes` æˆ– `kubectl top pods` è¿”å› `metrics not available yet` çš„æ’æŸ¥ã€è§£å†³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4206083706979930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½•è¾¾ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T03:35:31.000Z" title="Thu Jan 15 2026 03:35:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><code>kubectl top nodes</code> æˆ– <code>kubectl top pods</code> è¿”å› <code>metrics not available yet</code> çš„æ’æŸ¥ã€è§£å†³</h2>
<p>Metrics Server æ˜¯ Kubernetes é›†ç¾¤ä¸­ç”¨äºæ”¶é›†å’ŒèšåˆèŠ‚ç‚¹ã€Pod çš„èµ„æºä½¿ç”¨æŒ‡æ ‡ï¼ˆMetricsï¼‰ çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦æä¾› CPUã€å†…å­˜ç­‰åŸºç¡€èµ„æºçš„å®æ—¶ä½¿ç”¨ç‡æ•°æ®ã€‚è¿™äº›æ•°æ®æ˜¯ Kubernetes è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰ã€è°ƒåº¦ä¼˜åŒ–ä»¥åŠèµ„æºç›‘æ§çš„åŸºç¡€ã€‚</p>
<p>Metrics Server çš„æ ¸å¿ƒä½œç”¨ï¼š</p>
<ul>
<li>æ”¶é›†æŒ‡æ ‡ï¼šä»é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ <code>kubelet</code> æœåŠ¡ï¼ˆé€šè¿‡ <code>kubelet</code> çš„ Metrics APIï¼Œé»˜è®¤ç«¯å£ <code>10250</code>ï¼‰æ”¶é›†èŠ‚ç‚¹å’Œ Pod çš„èµ„æºä½¿ç”¨æ•°æ®ï¼ˆCPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ï¼‰ã€‚</li>
<li>èšåˆæ•°æ®ï¼šå°†åˆ†æ•£çš„æŒ‡æ ‡æ•°æ®èšåˆåï¼Œé€šè¿‡ Kubernetes APIï¼ˆ<code>metrics.k8s.io</code> ç¾¤ç»„ï¼‰æä¾›ç»Ÿä¸€è®¿é—®æ¥å£ã€‚</li>
<li>æ”¯æ’‘åŠŸèƒ½ï¼šä¸º <code>kubectl top</code> å‘½ä»¤ï¼ˆæŸ¥çœ‹èµ„æºä½¿ç”¨ï¼‰å’Œ <code>HorizontalPodAutoscaler</code>ï¼ˆHPAï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰æä¾›æ•°æ®æ”¯æŒã€‚</li>
</ul>
<p>å®‰è£…éƒ¨ç½² <code>metrics-server</code> åï¼Œä½¿ç”¨ <code>kubectl top nodes</code> æˆ– <code>kubectl top pods</code> æŸ¥çœ‹èµ„æºä½¿ç”¨æ—¶ï¼Œæ˜¾ç¤ºå¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">metrics not available yet
</code></pre>
<h3 data-id="heading-1">åˆæ­¥ç®€å•æ’æŸ¥</h3>
<p>å…ˆåšä¸€ä¸ªç®€å•çš„æ’æŸ¥ï¼Œè·å¾—ä¸€ä¸ªåˆæ­¥çš„åˆ¤æ–­ï¼š</p>
<ul>
<li><code>kubectl logs</code> æ¥æŸ¥çœ‹å¯¹åº”çš„ <code>metrics-server</code> å®¹å™¨æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æœ‰å¼‚å¸¸ä¿¡æ¯ã€‚
<pre><code class="hljs language-bash" lang="bash">kubectl logs -n kube-system deployment/metrics-server
</code></pre>
</li>
<li>æ£€æŸ¥ <code>metrics-server</code> å¯¹åº”çš„ <code>Deployment</code> ä¸­å¯¹åº”å®¹å™¨çš„ <code>args</code> é…ç½®ï¼Œæœ€å°åŒ–ä¿®æ”¹æ¥è§£å†³é—®é¢˜ï¼š
<ul>
<li><code>--kubelet-insecure-tls</code>ï¼Œç¡®è®¤ TLS é…ç½®æ˜¯å¯¹åº”çš„ï¼Œå¯ä»¥å…ˆè·³è¿‡ kubelet çš„ TLS è¯ä¹¦éªŒè¯ï¼ˆæµ‹è¯•ç¯å¢ƒå¸¸ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ï¼‰ï¼Œè¿™ä¸ªæ˜¯å¦é…ç½®ã€‚</li>
<li><code>--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</code>ï¼ŒæŒ‡å®š kubelet è¿æ¥æ—¶ä¼˜å…ˆä½¿ç”¨çš„åœ°å€ç±»å‹ï¼ˆé»˜è®¤æ˜¯ <code>InternalIP</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>å¯¹ç…§å®˜æ–¹ issues æ–‡æ¡£ <code>https://github.com/kubernetes-sigs/metrics-server/blob/master/KNOWN_ISSUES.md</code> æ’æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-2">è¯¦ç»†æ’æŸ¥æµç¨‹</h3>
<p><code>metrics-server</code> è·å¾— nodes å’Œ pods çš„ metrics æ•°æ®çš„å¤§è‡´æµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f7043e7ac643a1863eb1c3465f8a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6L6-57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052931&amp;x-signature=FodLREMbAP8dbKFxhYS0%2BYuPqN4%3D" alt="2026-01-14-11-46-59.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83f67e8fdc6f49889a5a4f92def880f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6L6-57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052931&amp;x-signature=ONMhvh5HkEj89ykeRDTUXCd1dUc%3D" alt="2026-01-14-12-18-35.png" loading="lazy"/></p>
<ul>
<li>cAdvisor: ç”¨äºæ”¶é›†ã€èšåˆå’Œå…¬å¼€ Kubelet ä¸­åŒ…å«çš„å®¹å™¨æŒ‡æ ‡çš„å®ˆæŠ¤ç¨‹åºã€‚</li>
<li>kubelet: ç”¨äºç®¡ç†å®¹å™¨èµ„æºçš„èŠ‚ç‚¹ä»£ç†ã€‚å¯ä»¥ä½¿ç”¨ <code>/metrics/resource</code> å’Œ <code>/stats</code> kubelet API ç«¯ç‚¹è®¿é—®èµ„æºæŒ‡æ ‡ã€‚
<ul>
<li><code>/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/metrics/cadvisor</code>ï¼šç”± cadvisor ç»„ä»¶æä¾›ï¼Œä¸“æ³¨äºå®¹å™¨å’ŒèŠ‚ç‚¹çš„ç»†ç²’åº¦èµ„æºä½¿ç”¨æŒ‡æ ‡ã€‚</li>
<li><code>/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/metrics/resource</code>ï¼šæä¾› èŠ‚ç‚¹å’Œ Pod çš„èµ„æºè¯·æ±‚ï¼ˆrequestï¼‰ã€é™åˆ¶ï¼ˆlimitï¼‰åŠå®é™…ä½¿ç”¨çš„æ±‡æ€»æ•°æ®ï¼Œæ•°æ®æ›´è´´è¿‘ k8s èµ„æºæ¨¡å‹ï¼ˆä¸ <code>requests/limits</code> ç›´æ¥å…³è”ï¼‰ã€‚</li>
<li><code>/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/healthz</code>ï¼šæä¾› kubelet å¥åº·çŠ¶æ€æŒ‡æ ‡ã€‚</li>
<li><code>/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/metrics/probes</code>ï¼šä¸“é—¨è®°å½•å®¹å™¨æ¢é’ˆï¼ˆlivenessã€readinessã€startupï¼‰çš„æ‰§è¡ŒçŠ¶æ€ï¼Œç”¨äºç›‘æ§æ¢é’ˆæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li>
<li><code>/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/stats/summary</code>ï¼šæä¾›èŠ‚ç‚¹çº§åˆ«çš„èµ„æºæŒ‡æ ‡ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€ç½‘ç»œå’Œç£ç›˜ IOã€‚</li>
</ul>
</li>
<li>èŠ‚ç‚¹å±‚é¢èµ„æºæŒ‡æ ‡: kubelet æä¾›çš„ APIï¼Œç”¨äºå‘ç°å’Œæ£€ç´¢å¯é€šè¿‡ <code>/metrics/resource</code> ç«¯ç‚¹è·å¾—çš„æ¯ä¸ªèŠ‚ç‚¹çš„æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>metrics-server: é›†ç¾¤æ’ä»¶ç»„ä»¶ï¼Œç”¨äºæ”¶é›†å’Œèšåˆä»æ¯ä¸ª kubelet ä¸­æå–çš„èµ„æºæŒ‡æ ‡ã€‚API æœåŠ¡å™¨æä¾› Metrics API ä»¥ä¾› HPAã€VPA å’Œ <code>kubectl top</code> å‘½ä»¤ä½¿ç”¨ã€‚Metrics Server æ˜¯ Metrics API çš„å‚è€ƒå®ç°ã€‚</li>
<li>Metrics API: Kubernetes API æ”¯æŒè®¿é—®ç”¨äºå·¥ä½œè´Ÿè½½è‡ªåŠ¨ç¼©æ”¾çš„ CPU å’Œå†…å­˜ã€‚è¦åœ¨ä½ çš„é›†ç¾¤ä¸­è¿›è¡Œè¿™é¡¹å·¥ä½œï¼Œä½ éœ€è¦ä¸€ä¸ªæä¾› Metrics API çš„ API æ‰©å±•æœåŠ¡å™¨ã€‚</li>
</ul>
<p>å›´ç»• â€œæŒ‡æ ‡æ”¶é›†é“¾è·¯â€ï¼ˆå®¹å™¨ -&gt; cadvisor -&gt; metrics-server -&gt; kubectl/HPAï¼‰å±•å¼€ï¼Œé€æ­¥å®šä½æ–­è£‚ç‚¹ï¼š</p>
<ul>
<li>ç¡®è®¤ metrics-server å·²æ­£ç¡®æ³¨å†Œ <code>metrics.k8s.io/v1beta1</code> API æœåŠ¡ã€‚</li>
<li>æ£€æŸ¥ RBAC æƒé™ï¼šç¡®ä¿ metrics-server æœ‰è¶³å¤Ÿæƒé™è¯»å–èŠ‚ç‚¹æŒ‡æ ‡ã€‚</li>
<li>ç¡®è®¤æŒ‡æ ‡æ¥æºï¼šcadvisor æ˜¯å¦ç”Ÿæˆå®¹å™¨æŒ‡æ ‡ã€‚
<ul>
<li>è®¿é—®èŠ‚ç‚¹çš„ cadvisor æŒ‡æ ‡ç«¯ç‚¹ï¼š<code>curl http://&lt;æ§åˆ¶å¹³é¢IP&gt;:8001/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/metrics/cadvisor</code>ã€‚
<ul>
<li>è‹¥ä»…åŒ…å« <code>machine_*</code> ç­‰æœºå™¨çº§æŒ‡æ ‡ï¼Œæ—  <code>container_*</code>ï¼ˆå¸¦ <code>pod_name</code>ã€<code>namespace</code> æ ‡ç­¾ï¼‰æŒ‡æ ‡ï¼Œè¯´æ˜ cadvisor æœªæ”¶é›†åˆ°å®¹å™¨æ•°æ®ï¼Œé—®é¢˜èšç„¦äº cadvisor ä¸å®¹å™¨çš„äº¤äº’ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>cadvisor ä¾èµ– kubelet ä»å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdï¼‰è·å–å®¹å™¨å…ƒæ•°æ®ï¼ˆå¦‚å®¹å™¨ IDï¼‰ï¼Œéœ€ç¡®è®¤ kubelet èƒ½æ­£å¸¸è¯†åˆ«å®¹å™¨ï¼š
<ul>
<li>è®¿é—®èŠ‚ç‚¹çš„ pods ç«¯ç‚¹ï¼š<code>curl http://&lt;æ§åˆ¶å¹³é¢IP&gt;:8001/api/v1/nodes/&lt;èŠ‚ç‚¹å&gt;/proxy/pods | jq '.items[].status.containerStatuses[].containerID'</code>ã€‚
<ul>
<li>è‹¥è¾“å‡º <code>containerd://&lt;å®¹å™¨ID&gt;</code> æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè¯´æ˜ kubelet èƒ½ä»å®¹å™¨è¿è¡Œæ—¶è·å–å®¹å™¨ IDï¼Œæ’é™¤åŸºç¡€é€šä¿¡æ•…éšœã€‚</li>
<li>è‹¥ä¸ºç©ºï¼Œéœ€ä¿®å¤ kubelet ä¸å®¹å™¨è¿è¡Œæ—¶çš„è¿æ¥ï¼ˆå¦‚æ£€æŸ¥ <code>containerRuntimeEndpoint</code> é…ç½®ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>æ’æŸ¥ cgroup é…ç½®ä¸å…¼å®¹æ€§ï¼Œcadvisor é€šè¿‡å®¹å™¨çš„ cgroup è·¯å¾„ï¼ˆå¦‚ <code>/sys/fs/cgroup</code>ï¼‰è·å–èµ„æºæ•°æ®ï¼Œcgroup é©±åŠ¨æˆ–ç‰ˆæœ¬ä¸å…¼å®¹ä¼šå¯¼è‡´è·¯å¾„åŒ¹é…å¤±è´¥ï¼š
<ul>
<li>cgroup é©±åŠ¨ä¸€è‡´æ€§ï¼šç¡®ä¿ kubeletï¼ˆ<code>cgroupDriver: systemd</code>ï¼‰ä¸å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerd çš„ <code>SystemdCgroup: true</code>ï¼‰ä½¿ç”¨ç›¸åŒé©±åŠ¨ï¼Œå°¤å…¶æ˜¯ cgroup2 ç¯å¢ƒå¿…é¡»æ­é… <code>systemd</code> é©±åŠ¨ã€‚</li>
<li>cgroup2 é€‚é…ï¼šè‹¥ä½¿ç”¨ cgroup2ï¼Œéœ€ç¡®è®¤ cadvisorï¼ˆv0.43+ï¼‰ã€kubeletï¼ˆv1.25+ï¼‰ã€å®¹å™¨è¿è¡Œæ—¶ï¼ˆcontainerd v1.6+ï¼‰ç‰ˆæœ¬æ”¯æŒ cgroup2ï¼Œå¹¶éªŒè¯å®¹å™¨çš„ cgroup è·¯å¾„ï¼ˆå¦‚ <code>/sys/fs/cgroup/kubepods.slice/.../&lt;å®¹å™¨ID&gt;.scope</code>ï¼‰å­˜åœ¨ä¸”å¯è®¿é—®ã€‚</li>
</ul>
</li>
<li>æ£€æŸ¥ kubelet é…ç½®å¯¹ cadvisor çš„å½±å“ï¼Œkubelet é…ç½®å¯èƒ½ç»•è¿‡ cadvisor å¯¼è‡´æŒ‡æ ‡ç¼ºå¤±ï¼š
<ul>
<li><code>PodAndContainerStatsFromCRI</code> ç‰¹æ€§å¼€å…³ï¼šè‹¥å¼€å¯ï¼ˆtrueï¼‰ï¼Œkubelet ä¼šä»å®¹å™¨è¿è¡Œæ—¶ç›´æ¥è·å–æŒ‡æ ‡ï¼Œå¯èƒ½å¯¼è‡´ cadvisor ä¸ç”Ÿæˆæ•°æ®ï¼Œéœ€å…³é—­ï¼ˆfalseï¼‰è®© cadvisor æ¥ç®¡ã€‚</li>
<li>cadvisor åˆå§‹åŒ–æ—¥å¿—ï¼šæŸ¥çœ‹ kubelet æ—¥å¿—ï¼ˆ<code>journalctl -u kubelet</code>ï¼‰ï¼Œç¡®è®¤ <code>cadvisor initialization complete</code> æ—¥å¿—å­˜åœ¨ï¼Œæ’é™¤ cadvisor æœªå¯åŠ¨çš„é—®é¢˜ã€‚</li>
</ul>
</li>
<li>éªŒè¯ metrics-server èƒ½å¦æ‹‰å–æŒ‡æ ‡ï¼Œè‹¥ cadvisor æœ‰å®¹å™¨æŒ‡æ ‡ï¼Œä½† <code>kubectl top pods</code> ä»æ— æ•°æ®ï¼Œéœ€æ£€æŸ¥ metrics-server æ˜¯å¦æ­£å¸¸æ‹‰å–ï¼š
<ul>
<li>æŸ¥çœ‹ metrics-server é…ç½®ï¼šç¡®ä¿ <code>--cadvisor-url-prefix</code> æŒ‡å‘æ­£ç¡®çš„ cadvisor ç«¯ç‚¹ï¼ˆå†…ç½® cadvisor ä¸º <code>http://{{.NodeInternalIP}}:10255/metrics/cadvisor</code>ï¼Œç‹¬ç«‹éƒ¨ç½²ä¸º <code>http://{{.NodeInternalIP}}:8080/</code>ï¼‰ã€‚</li>
<li>æŸ¥çœ‹ metrics-server æ—¥å¿—ï¼šæ’æŸ¥æ˜¯å¦æœ‰ <code>no metrics known for pod</code> ç­‰æ‹‰å–å¤±è´¥é”™è¯¯ï¼Œä¿®å¤ç½‘ç»œæˆ–æƒé™é—®é¢˜ï¼ˆå¦‚ <code>--kubelet-insecure-tls</code> ä¸´æ—¶ç»•è¿‡ TLS éªŒè¯ï¼‰ã€‚</li>
</ul>
</li>
<li>è‹¥å†…ç½® cadvisor å› ç‰ˆæœ¬æˆ–ç¯å¢ƒé™åˆ¶æ— æ³•ä¿®å¤ï¼Œå¯ç‹¬ç«‹éƒ¨ç½² cadvisorï¼š
<ul>
<li>é€šè¿‡ DaemonSet éƒ¨ç½²æ”¯æŒ cgroup2 çš„ cadvisorï¼ˆv0.47+ï¼‰ï¼ŒæŒ‚è½½ <code>--volume=/sys/fs/cgroup</code> ç¡®ä¿è®¿é—® cgroup è·¯å¾„ã€‚</li>
<li>é…ç½® metrics-server æŒ‡å‘ç‹¬ç«‹ cadvisor çš„ç«¯ç‚¹ï¼Œç»•å¼€å†…ç½®ç»„ä»¶çš„å…¼å®¹æ€§é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<p>æ ¸å¿ƒé€»è¾‘æ˜¯ â€œä»æŒ‡æ ‡ç”Ÿæˆç«¯ï¼ˆcadvisorï¼‰åˆ°æ¶ˆè´¹ç«¯ï¼ˆkubectlï¼‰é€æ­¥éªŒè¯é“¾è·¯â€ï¼Œé‡ç‚¹æ’æŸ¥ï¼š</p>
<ul>
<li>cadvisor èƒ½å¦é€šè¿‡ cgroup è·¯å¾„è·å–å®¹å™¨æ•°æ®ï¼ˆä¾èµ– cgroup é©±åŠ¨ã€ç‰ˆæœ¬å…¼å®¹ï¼‰ã€‚</li>
<li>å®¹å™¨è¿è¡Œæ—¶ä¸ kubelet çš„é€šä¿¡æ˜¯å¦æ­£å¸¸ï¼ˆç¡®ä¿å®¹å™¨å…ƒæ•°æ®å¯è·å–ï¼‰ã€‚</li>
<li>metrics-server èƒ½å¦æ­£ç¡®æ‹‰å–å¹¶æä¾›æŒ‡æ ‡ï¼ˆé…ç½®æ­£ç¡®çš„ cadvisor ç«¯ç‚¹ï¼‰ã€‚</li>
</ul>
<p>ä¸Šé¢çš„æ’æŸ¥æ€è·¯ä¸ä¸€å®šæ˜¯ä¸²è¡Œæœ‰ç€ä¸¥æ ¼çš„å…ˆåé¡ºåºï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ“ä½œæ¥è¿›è¡Œã€‚</p>
<p>è‹¥èŠ‚ç‚¹å­˜åœ¨å¤šä¸ªé›†ç¾¤å†…éƒ¨ IPï¼Œæ£€æŸ¥æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹çš„ <code>InternalIP</code> æ˜¯å¦æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get nodes -o wide
</code></pre>
<p>ç¡®è®¤ metrics-server å·²æ­£ç¡®æ³¨å†Œ <code>metrics.k8s.io/v1beta1</code> API æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get apiservices v1beta1.metrics.k8s.io -o yaml
</code></pre>
<p>æ£€æŸ¥ RBAC æƒé™ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>kubectl get --raw "/apis/metrics.k8s.io/v1beta1/nodes" | jq</code> çš„æ–¹å¼æŸ¥çœ‹èŠ‚ç‚¹æŒ‡æ ‡ï¼Œè‹¥æ˜¯ç±»ä¼¼çš„è¿”å›ï¼š
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NodeMetricsList"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"apiVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"metrics.k8s.io/v1beta1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>è‹¥çœ‹åˆ° <code>items</code> æ•°ç»„ä¸ºç©ºï¼Œè¯´æ˜ metrics-server å·²æˆåŠŸæ³¨å†Œ APIï¼Œä½†æœªé‡‡é›†åˆ°ä»»ä½•èŠ‚ç‚¹æŒ‡æ ‡æ•°æ®ã€‚</li>
</ul>
</li>
<li>æŸ¥çœ‹ metrics-server ä½¿ç”¨çš„ ServiceAccountã€‚</li>
<li>æ£€æŸ¥ metrics-server çš„ ClusterRoleï¼ˆåŒ…å«èŠ‚ç‚¹æŒ‡æ ‡å¿…éœ€çš„æƒé™ï¼‰å’Œ ClusterRoleBindingï¼ˆå°†æƒé™ç»‘å®šåˆ° metrics-server çš„ ServiceAccountï¼‰ï¼Œæ£€æŸ¥æƒé™æ˜¯å¦è¶³å¤Ÿã€‚</li>
</ul>
<p>å…ˆç¡®ä¿ cgroup èƒ½å·¥ä½œï¼ˆä¸ä»£è¡¨ä¸€åˆ‡æ­£å¸¸ï¼‰ï¼š</p>
<ul>
<li>æ£€æŸ¥å¼‚å¸¸èŠ‚ç‚¹çš„ cgroup çš„ç‰ˆæœ¬ã€‚</li>
<li>ç¡®ä¿ Linux å†…æ ¸ç‰ˆæœ¬ä¸º 5.8 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
</ul>
<p>cgroup v1 å’Œ cgroup v2 æ˜¯ Linux å†…æ ¸ä¸­ä¸¤å¥—ä¸åŒçš„æ§åˆ¶ç»„ï¼ˆcgroupï¼‰å®ç°ï¼Œæ ¸å¿ƒç›®æ ‡éƒ½æ˜¯å¯¹è¿›ç¨‹è¿›è¡Œèµ„æºï¼ˆCPUã€å†…å­˜ã€IO ç­‰ï¼‰çš„é™åˆ¶ã€éš”ç¦»å’Œç›‘æ§ï¼Œä½†åœ¨æ¶æ„è®¾è®¡ã€åŠŸèƒ½ç‰¹æ€§å’Œä½¿ç”¨æ–¹å¼ä¸Šæœ‰æ˜¾è‘—åŒºåˆ«ï¼š</p>
<ul>
<li>
<p>cgroup v1</p>
<ul>
<li>é‡‡ç”¨ â€œæ¯ä¸ªæ§åˆ¶å™¨ç‹¬ç«‹å±‚æ¬¡ç»“æ„â€ è®¾è®¡ï¼Œæ¯ä¸ªèµ„æºæ§åˆ¶å™¨ï¼ˆå¦‚ CPUã€å†…å­˜ã€IO ç­‰ï¼‰æœ‰è‡ªå·±ç‹¬ç«‹çš„æŒ‚è½½ç‚¹å’Œç›®å½•ç»“æ„ã€‚
<pre><code class="hljs language-bash" lang="bash">/sys/fs/cgroup/cpu/      <span class="hljs-comment"># CPU æ§åˆ¶å™¨</span>
/sys/fs/cgroup/memory/   <span class="hljs-comment"># å†…å­˜æ§åˆ¶å™¨</span>
/sys/fs/cgroup/blkio/    <span class="hljs-comment"># IO æ§åˆ¶å™¨</span>
</code></pre>
</li>
<li>å„æ§åˆ¶å™¨çš„èµ„æºé™åˆ¶æ˜¯ç‹¬ç«‹çš„ï¼Œå¯èƒ½å‡ºç°é€»è¾‘å†²çªï¼Œè¿›ç¨‹å¯è·¨å¤šä¸ªå±‚çº§ï¼Œæ¯”å¦‚ä¸ºä¸€ä¸ªè¿›ç¨‹ç»„è®¾ç½®äº† CPU é™åˆ¶ï¼ˆ<code>cpu.cfs_quota_us</code>ï¼‰å’Œå†…å­˜é™åˆ¶ï¼ˆ<code>memory.limit_in_bytes</code>ï¼‰ï¼Œä½†ä¸¤è€…çš„é™åˆ¶é€»è¾‘ä¸äº’é€šï¼Œå¯èƒ½å¯¼è‡´ â€œå†…å­˜è€—å°½ä½† CPU ä»æœ‰å‰©ä½™â€ çš„ä¸åˆç†çŠ¶æ€ã€‚</li>
<li>æƒé™æ§åˆ¶å®½æ¾ï¼Œéç‰¹æƒè¿›ç¨‹ï¼ˆå¦‚å®¹å™¨å†…çš„è¿›ç¨‹ï¼‰å¯èƒ½é€šè¿‡ä¿®æ”¹ cgroup é…ç½®çªç ´èµ„æºé™åˆ¶ï¼ˆä¾‹å¦‚ä¿®æ”¹ <code>memory.limit_in_bytes</code> æ‰©å¤§å†…å­˜é…é¢ï¼‰ï¼Œå­˜åœ¨å®‰å…¨é£é™©ã€‚</li>
</ul>
</li>
<li>
<p>cgroup v2</p>
<ul>
<li>é‡‡ç”¨ â€œç»Ÿä¸€å±‚æ¬¡ç»“æ„â€ è®¾è®¡ï¼Œæ‰€æœ‰èµ„æºæ§åˆ¶å™¨å…±äº«ä¸€ä¸ªæ ¹ç›®å½•ï¼ˆ<code>/sys/fs/cgroup/</code>ï¼‰ï¼Œè¿›ç¨‹ç»„åœ¨å•ä¸€å±‚æ¬¡ç»“æ„ä¸­ç®¡ç†ï¼Œç»Ÿä¸€æ¥å£ï¼ˆ<code>cgroup.controllers</code> ç®¡ç†ï¼‰ï¼Œæ‰€æœ‰èµ„æºé…ç½®é›†ä¸­åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚
<pre><code class="hljs language-bash" lang="bash">/sys/fs/cgroup/          <span class="hljs-comment"># æ‰€æœ‰æ§åˆ¶å™¨å…±äº«çš„æ ¹ç›®å½•</span>
/sys/fs/cgroup/xxx-pod-xxx/  <span class="hljs-comment"># æŸ Pod çš„æ‰€æœ‰èµ„æºé…ç½®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰</span>
</code></pre>
</li>
<li>èµ„æºé™åˆ¶æ˜¯ååŒçš„ï¼Œè¿›ç¨‹ä»…èƒ½å±äºå•ä¸€å±‚çº§çš„å¶å­èŠ‚ç‚¹ï¼Œæ”¯æŒ â€œèµ„æºé—´ä¾èµ–æ§åˆ¶â€ï¼Œæ¯”å¦‚å½“è¿›ç¨‹ç»„è§¦å‘å†…å­˜é™åˆ¶æ—¶ï¼Œv2 ä¼šè‡ªåŠ¨è°ƒæ•´ CPU è°ƒåº¦ï¼Œé¿å…å› å†…å­˜ä¸è¶³å¯¼è‡´çš„ CPU ç©ºè½¬ï¼ŒåŒæ—¶å¼•å…¥ â€œå‹åŠ›åé¦ˆæœºåˆ¶â€ï¼ˆå¦‚å†…å­˜å‹åŠ›è§¦å‘ IO é™åˆ¶ï¼‰ï¼Œæ›´ç¬¦åˆå®é™…åº”ç”¨çš„èµ„æºä½¿ç”¨è§„å¾‹ã€‚</li>
<li>åªæœ‰æ ¹ cgroupï¼ˆ<code>/sys/fs/cgroup/</code>ï¼‰å¯é…ç½®å…¨å±€èµ„æºé™åˆ¶ï¼Œå­ cgroupï¼ˆå¦‚å®¹å™¨çš„ cgroupï¼‰çš„æƒé™è¢«ä¸¥æ ¼é™åˆ¶ï¼Œéç‰¹æƒè¿›ç¨‹æ— æ³•ä¿®æ”¹çˆ¶ cgroup çš„é…ç½®ï¼Œé˜²æ­¢æƒé™é€ƒé€¸ï¼Œæ›´é€‚åˆå¤šç§Ÿæˆ·ç¯å¢ƒï¼ˆå¦‚ Kubernetes é›†ç¾¤ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>æŸ¥çœ‹å½“å‰ cgroups çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">stat</span> -<span class="hljs-built_in">fc</span> %T /sys/fs/cgroup/
</code></pre>
<ul>
<li>è‹¥è¾“å‡º <code>cgroup2fs</code>ï¼Œåˆ™å·²å¯ç”¨ cgroups v2ã€‚</li>
<li>è‹¥è¾“å‡º <code>tmpfs</code> æˆ– <code>cgroup</code>ï¼Œåˆ™å½“å‰ä½¿ç”¨ cgroups v1ã€‚</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‰ç…§ k8s çš„å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼Œä» Kubernetes 1.31 å¼€å§‹å¯¹ cgroup v1 çš„æ”¯æŒè½¬ä¸ºç»´æŠ¤æ¨¡å¼ï¼Œæ¨èä½¿ç”¨ cgroup v2ã€‚</li>
</ul>
<p>ä½¿ç”¨ cgroup v2 çš„è¦æ±‚ï¼š</p>
<ul>
<li>Linux å‘è¡Œç‰ˆæœ¬èº«æ”¯æŒ cgroup v2
<ul>
<li>Ubuntuï¼ˆä» 21.10 å¼€å§‹ï¼Œæ¨è 22.04+ï¼‰</li>
<li>Fedoraï¼ˆä» 31 å¼€å§‹ï¼‰</li>
<li>RHEL å’Œç±»ä¼¼ RHEL çš„å‘è¡Œç‰ˆï¼ˆä» 9 å¼€å§‹ï¼‰</li>
</ul>
</li>
<li>Linux å†…æ ¸ä¸º 5.8 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>å®¹å™¨è¿è¡Œæ—¶æ”¯æŒ cgroup v2
<ul>
<li>containerd v1.4 å’Œæ›´é«˜ç‰ˆæœ¬</li>
<li>cri-o v1.20 å’Œæ›´é«˜ç‰ˆæœ¬</li>
</ul>
</li>
<li>kubelet å’Œå®¹å™¨è¿è¡Œæ—¶è¢«é…ç½®ä¸ºä½¿ç”¨ systemd cgroup é©±åŠ¨
<ul>
<li>å°† <code>systemd</code> è®¾ç½®ä¸º cgroup é©±åŠ¨ï¼Œç¼–è¾‘ <code>kubelet</code> é…ç½®ï¼ˆæ¯”å¦‚ <code>/etc/kubernetes/kubelet/kubelet.conf</code>ï¼‰ä¸­ <code>KubeletConfiguration</code> çš„ cgroupDriver é€‰é¡¹è®¾ç½®ä¸º <code>systemd</code>ï¼š
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubelet.config.k8s.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">KubeletConfiguration</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">systemd</span>
</code></pre>
</li>
<li>ä¿®æ”¹ <code>containerd</code> é…ç½®æ–‡ä»¶ <code>/etc/containerd/config.toml</code>ï¼Œé…ç½® <code>systemd</code> cgroup é©±åŠ¨ï¼š
<ul>
<li>Containerd 1.x ç‰ˆæœ¬ï¼š
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]</span>
  ...
  <span class="hljs-section">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</span>
    <span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">true</span>
</code></pre>
</li>
<li>Containerd 2.x ç‰ˆæœ¬ï¼š
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc]</span>
  ...
  <span class="hljs-section">[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]</span>
    <span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">true</span>
</code></pre>
</li>
</ul>
</li>
<li>è‹¥ä½¿ç”¨ CRI-Oï¼Œç¡®ä¿ <code>/etc/crio/crio.conf</code> æˆ– <code>/etc/crio/crio.conf.d/02-cgroup-manager.conf</code> åŒ…å«é…ç½®ï¼š
[crio.runtime]
conmon_cgroup = "pod"
cgroup_manager = "cgroupfs"</li>
</ul>
</li>
</ul>
<p>å¼‚å¸¸èŠ‚ç‚¹è®© cgroup å·¥ä½œæ­£å¸¸ï¼š</p>
<ul>
<li>åˆ‡æ¢è‡³ cgroup v1 æ¨¡å¼ã€‚
<ul>
<li>ä¿®æ”¹ <code>/etc/default/grub</code> å…³é—­ cgroup v2ï¼Œåœ¨ <code>GRUB_CMDLINE_LINUX</code> ä¸­å»æ‰ <code>systemd.unified_cgroup_hierarchy=1</code>ï¼š
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ GRUB_CMDLINE_LINUX å»æ‰ systemd.unified_cgroup_hierarchy=1</span>
GRUB_CMDLINE_LINUX=<span class="hljs-string">"numa=off transparent_hugepage=never systemd.unified_cgroup_hierarchy=1"</span>
</code></pre>
</li>
<li>æ›´æ–° GRUB é…ç½®å¹¶é‡å¯ï¼š
<pre><code class="hljs language-bash" lang="bash">sudo update-grub
sudo reboot
<span class="hljs-comment"># æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å·²åˆ‡æ¢è‡³ cgroup v1 æ¨¡å¼</span>
<span class="hljs-built_in">stat</span> -<span class="hljs-built_in">fc</span> %T /sys/fs/cgroup/
<span class="hljs-comment"># é¢„æœŸè¾“å‡ºï¼štmpfs</span>

<span class="hljs-comment"># æ£€æŸ¥ v1 æ§åˆ¶å™¨ç›®å½•æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-built_in">ls</span> -d /sys/fs/cgroup/cpu /sys/fs/cgroup/memory /sys/fs/cgroup/pids
<span class="hljs-comment"># é¢„æœŸè¾“å‡ºï¼š/sys/fs/cgroup/cpu  /sys/fs/cgroup/memory  /sys/fs/cgroup/pids</span>
</code></pre>
</li>
<li>ä¿®æ”¹èŠ‚ç‚¹çš„ <code>/etc/kubernetes/kubelet/kubelet.conf</code> é…ç½®æ–‡ä»¶ï¼š
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">cgroupfs</span>
</code></pre>
</li>
<li>ç¼–è¾‘ <code>containerd</code> é…ç½®æ–‡ä»¶ <code>/etc/containerd/config.toml</code>ï¼š
<ul>
<li>æ‰¾åˆ° <code>[plugins."io.containerd.grpc.v1.cri"]</code> éƒ¨åˆ†ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ï¼š
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[plugins."io.containerd.grpc.v1.cri"]</span>
<span class="hljs-attr">cgroup_driver</span> = <span class="hljs-string">"cgroupfs"</span>
</code></pre>
</li>
<li>åœ¨ <code>[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</code>ä¸‹æ·»åŠ ï¼š
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</span>
<span class="hljs-attr">SystemdCgroup</span> = <span class="hljs-literal">false</span>
</code></pre>
</li>
<li>é‡å¯ <code>containerd</code> æœåŠ¡ï¼š
<pre><code class="hljs language-bash" lang="bash">sudo systemctl restart containerd
</code></pre>
</li>
</ul>
</li>
<li>ä¿®æ”¹èŠ‚ç‚¹çš„ <code>/etc/kubernetes/kubelet/kubelet.conf</code> é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ï¼š
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">cgroupfs</span>
</code></pre>
<ul>
<li>é‡å¯ kubelet æœåŠ¡ï¼š
<pre><code class="hljs language-bash" lang="bash">sudo systemctl restart kubelet
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li>å‡çº§å†…æ ¸ï¼ˆæ¨èï¼‰ã€‚</li>
<li>å‡çº§ç³»ç»Ÿï¼ˆä¸æ¨èï¼‰ã€‚</li>
</ul>
<p>ç»è¿‡ä¸Šè¿°æ’æŸ¥ã€æ“ä½œåï¼Œæ‰§è¡Œ <code>kubectl top nodes</code> å¤§æ¦‚ç‡èƒ½æ­£å¸¸è¿”å›èŠ‚ç‚¹æŒ‡æ ‡ï¼Œä½†æ˜¯æ‰§è¡Œ <code>kubectl top pods</code> å¯èƒ½ä¾æ—§ä¼šæç¤º <code>error: metrics not available yet</code>ï¼Œå¯èƒ½æ˜¯éƒ¨åˆ†èŠ‚ç‚¹æˆ–è€…å…¨éƒ¨èŠ‚ç‚¹è¡¨ç°å¼‚å¸¸ã€‚</p>
<p>åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹è®¿é—®å¼‚å¸¸èŠ‚ç‚¹çš„ <code>kubelet</code> æŒ‡æ ‡æ¥å£ï¼ˆ<code>&lt;node-name&gt;</code> ä¸ºå¼‚å¸¸èŠ‚ç‚¹çš„åç§°å¦‚ <code>worker-node-1</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get --raw /api/v1/nodes/&lt;node-name&gt;/proxy/stats/summary
</code></pre>
<ul>
<li>è‹¥è¿”å›åŒ…å« pods åˆ—è¡¨åŠæ¯ä¸ª Pod çš„ <code>cpu</code>/<code>memory</code> æ•°æ®ï¼Œè¯´æ˜ kubelet æŒ‡æ ‡ç”Ÿæˆæ­£å¸¸ï¼Œé—®é¢˜åœ¨ Metrics Server ä¸è¯¥èŠ‚ç‚¹çš„é€šä¿¡ã€‚</li>
<li>è‹¥è¿”å›ç©ºæˆ– 500 Internal Server Errorï¼šè¯´æ˜ kubelet è‡ªèº«æ— æ³•ç”ŸæˆæŒ‡æ ‡ï¼Œéœ€è¦é‡ç‚¹æ’æŸ¥ kubelet æ—¥å¿—ä¸­çš„ cadvisor æˆ– stats é”™è¯¯ï¼‰ã€‚</li>
</ul>
<p>æŸ¥çœ‹èŠ‚ç‚¹çš„ cadvisor æŒ‡æ ‡:</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get --raw /api/v1/nodes/&lt;node-name&gt;/proxy/metrics/cadvisor
</code></pre>
<p>è‹¥çœ‹åˆ°å½“å‰ metrics/cadvisor åªæœ‰æœºå™¨çº§æŒ‡æ ‡ï¼Œå´æ— ä»»ä½•å®¹å™¨/Pod æŒ‡æ ‡ï¼Œéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ã€‚</p>
<p>æŸ¥çœ‹ç›®æ ‡èŠ‚ç‚¹ä¸Šçš„ Pod åŠå®¹å™¨ä¿¡æ¯ï¼ˆcadvisor ä¾èµ–æ­¤æ•°æ®å…³è”å®¹å™¨ï¼‰ï¼Œç¡®è®¤ kubelet æ˜¯å¦èƒ½ä» containerd è·å–å®¹å™¨ IDï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get --raw /api/v1/nodes/&lt;node-name&gt;/proxy/pods | jq <span class="hljs-string">'.items[].status.containerStatuses[].containerID'</span>
</code></pre>
<ul>
<li>è‹¥è¿”å›ç±»ä¼¼çš„ç»“æœï¼Œè¯´æ˜ kubelet ä¸ containerd çš„é€šä¿¡æ˜¯æ­£å¸¸çš„ï¼š
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"containerd://b7fde5066a7ff44ee03e7a7d9e8dd0c2c228d6999691c9d22c551737498707f9"</span>
<span class="hljs-string">"containerd://2fb7393157b064e4dcc0d3f9bd2675c546b5762db0f8b8924e891bb773ec3133"</span>
<span class="hljs-string">"containerd://171a73a37482e107ede2f51c95670ecd769ec0a4c1dc0c025a4f2988bc116cc1"</span>
<span class="hljs-string">"containerd://f1bbb1da3a69eeddd6fafeb60f7680fa21f2afa7f8169eae4049d0e1ffd89582"</span>
<span class="hljs-string">"containerd://cc9dc5100015d55610995c2b73df6d8f116ed25314beb0b0a6d4ed48e7a1093e"</span>
<span class="hljs-string">"containerd://ad1bafd1975205ac7d76c188aa4ee574ae89cb4af07e3479b5524fe7a6e349e8"</span>
...
</code></pre>
</li>
</ul>
<p>æˆ–è€…ç›´æ¥è°ƒç”¨æŒ‡æ ‡ API éªŒè¯å¯¹åº”çš„ pods æ˜¯å¦è¿”å›ç»“æœï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get --raw <span class="hljs-string">"/apis/metrics.k8s.io/v1beta1/namespaces/web-nginx-prod/pods?labelSelector=app%3Dnginx-v1"</span>
</code></pre>
<p>è¦æ˜ç™½cadvisor æ”¶é›†å®¹å™¨æŒ‡æ ‡çš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">å®¹å™¨ ID <span class="hljs-punctuation">-&gt;</span> å¯¹åº” cgroup è·¯å¾„ï¼ˆå¦‚ /sys/fs/cgroup/cpu/&lt;å®¹å™¨ID&gt;ï¼‰<span class="hljs-punctuation">-&gt;</span> è¯»å– cgroup æ–‡ä»¶ï¼ˆå¦‚ cpuacct.usageï¼‰è·å–èµ„æºæ•°æ®
</code></pre>
<ul>
<li>cgroup v1 çš„å®¹å™¨è·¯å¾„é€šå¸¸æ˜¯ <code>/sys/fs/cgroup/cpu/kubepods/.../&lt;å®¹å™¨ID&gt;</code>ï¼ˆæ¯ä¸ªå­ç³»ç»Ÿå•ç‹¬è·¯å¾„ï¼‰ã€‚</li>
<li>cgroup v2 çš„å®¹å™¨è·¯å¾„ç»Ÿä¸€ä¸º <code>/sys/fs/cgroup/kubepods.slice/.../&lt;å®¹å™¨ID&gt;.scope</code>ï¼ˆå•ä¸€å±‚çº§ï¼Œæ‰€æœ‰èµ„æºæ•°æ®åœ¨åŒä¸€ç›®å½•ä¸‹ï¼‰ã€‚</li>
</ul>
<p>è‹¥ä½¿ç”¨ cgroup v2ï¼ŒæŸ¥æ‰¾è¯¥å®¹å™¨åœ¨ cgroup2 ä¸­çš„è·¯å¾„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">find /sys/fs/cgroup -name <span class="hljs-string">"*<span class="hljs-variable">$CONTAINER_ID</span>*.scope"</span>
</code></pre>
<p>è‹¥è¿”å›ç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-python" lang="python">/sys/fs/cgroup/kubepods.<span class="hljs-built_in">slice</span>/kubepods-besteffort.<span class="hljs-built_in">slice</span>/kubepods-besteffort-poda5175edd_e7fc_4e68_870c_5b1befd652ac.<span class="hljs-built_in">slice</span>/cri-containerd-b7fde5066a7ff44ee03e7a7d9e8dd0c2c228d6999691c9d22c551737498707f9.scope
</code></pre>
<p>è¯´æ˜ containerd å·²æ­£ç¡®ä¸ºå®¹å™¨åˆ›å»º cgroup2 ç›®å½•ï¼Œcgroup v2 å·¥ä½œæ­£å¸¸ï¼Œé‚£ä¹ˆé—®é¢˜å¤§æ¦‚åœ¨ cadvisor ä¸ kubelet é…ç½®çš„åŒ¹é…ä¸Šã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªå¹²æ‰°å› ç´ ï¼Œæ£€æŸ¥ kubelet é…ç½®æ˜¯å¦å¯ç”¨äº† CRI å®¹å™¨ç»Ÿè®¡ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">featureGates:</span>
  <span class="hljs-attr">PodAndContainerStatsFromCRI:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># å¯ç”¨äº† CRI å®¹å™¨ç»Ÿè®¡</span>
  <span class="hljs-attr">KubeletCgroupDriverFromCRI:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>ç‰¹æ€§å¼€å…³ <code>PodAndContainerStatsFromCRI</code> å¯ç”¨åï¼Œkubelet ä¼šç›´æ¥ä»å®¹å™¨è¿è¡Œæ—¶ï¼ˆCRIï¼Œå³ containerdï¼‰è·å–å®¹å™¨/Pod çš„ç»Ÿè®¡æ•°æ®ï¼Œè€Œéä¾èµ–å†…ç½®çš„ cadvisorï¼Œè¿™ä¼šå¯¼è‡´ cadvisor è™½ç„¶ä»åœ¨è¿è¡Œï¼Œä½†å¯èƒ½ä¸å†ä¸»åŠ¨æ”¶é›†å®¹å™¨æŒ‡æ ‡ï¼ˆå› ä¸º kubelet å·²é€šè¿‡ CRI æ‹¿åˆ°æ•°æ®ï¼Œæ— éœ€ cadvisor é‡å¤å·¥ä½œï¼‰ï¼Œé€šå¸¸çš„è¡¨ç°æ˜¯æ‰§è¡Œ <code>kubectl top nodes</code> èƒ½æ­£å¸¸è¿”å›èŠ‚ç‚¹çŠ¶æ€ï¼Œä½†æ˜¯æ‰§è¡Œ <code>kubectl top pods</code> æ— æ³•è¿”å›èŠ‚ç‚¹çš„ Pod çŠ¶æ€ã€‚</p>
<p>æŠŠ <code>PodAndContainerStatsFromCRI: true</code> æ³¨é‡Šæ‰æˆ–è€…è®¾ç½®ä¸º <code>false</code>ï¼Œé‡å¯ kubelet æœåŠ¡ï¼Œæ¢å¤æ­£å¸¸ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»æé€Ÿå¤åˆ¶â€œæ­»äº†ä¹ˆâ€APPï¼Œçœ‹AIç¼–ç¨‹æ—¶ä»£çš„æŠ€æœ¯é€‰å‹]]></title>    <link>https://juejin.cn/post/7595040803582394383</link>    <guid>https://juejin.cn/post/7595040803582394383</guid>    <pubDate>2026-01-15T03:30:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595040803582394383" data-draft-id="7595089504618446882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»æé€Ÿå¤åˆ¶â€œæ­»äº†ä¹ˆâ€APPï¼Œçœ‹AIç¼–ç¨‹æ—¶ä»£çš„æŠ€æœ¯é€‰å‹"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-01-15T03:30:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•°æ®åº“é‚£äº›äº‹å„¿"/> <meta itemprop="url" content="https://juejin.cn/user/2331434161540510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»æé€Ÿå¤åˆ¶â€œæ­»äº†ä¹ˆâ€APPï¼Œçœ‹AIç¼–ç¨‹æ—¶ä»£çš„æŠ€æœ¯é€‰å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2331434161540510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•°æ®åº“é‚£äº›äº‹å„¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T03:30:23.000Z" title="Thu Jan 15 2026 03:30:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>2026å¹´åˆï¼Œä¸€æ¬¾åå«"æ­»äº†ä¹ˆ"çš„Appåœ¨AppStoreä»˜è´¹æ¦œç‹‚é”€ã€‚</p>
<p>è¿™ä¸ä»…æ˜¯ä¸€ä¸ªå…³äºäº§å“åˆ›æ„çš„æ•…äº‹ï¼Œè¿˜æ˜¯ä¸€ä¸ªå…³äºæŠ€æœ¯å¦‚ä½•é‡å¡‘åˆ›ä¸šé—¨æ§›çš„æ•…äº‹ã€‚</p>
<p>æ›¾ç»ï¼Œä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„Appéœ€è¦åºå¤§çš„æŠ€æœ¯å›¢é˜Ÿï¼šåç«¯æ¡†æ¶ã€æ•°æ®åº“éƒ¨ç½²ã€ç³»ç»Ÿè®¤è¯ã€å®šæ—¶ä»»åŠ¡ã€é‚®ä»¶æ¨é€ã€åŸºç¡€è®¾æ–½è¿ç»´â€¦â€¦æ•´ä¸ªè¿‡ç¨‹è€—æ—¶å†—é•¿ã€æˆæœ¬é«˜æ˜‚ã€‚è€Œå¦‚ä»Šï¼Œä¸€åˆ‡éƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>ä½¿ç”¨AIç¼–ç¨‹å·¥å…·èƒ½å¿«é€Ÿç”Ÿæˆå‰ç«¯ä»£ç ï¼Œç”¨"æ— æœåŠ¡å™¨åº”ç”¨åç«¯" Supabase å¤„ç†æ‰€æœ‰åç«¯å·¥ä½œï¼Œå¼€å‘è€…ä¸éœ€è¦è‡ªå·±æ­å»ºæœåŠ¡å™¨ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒç³»ç»Ÿç»´æŠ¤ã€‚ä»å‰ç«¯åˆ°åç«¯ã€ä»æ•°æ®åˆ°æ¨¡å‹ï¼Œå…¨é“¾è·¯è½»é‡æ•æ·ã€‚</p>
<p>æœ¬æ–‡é€šè¿‡30åˆ†é’Ÿå¤åˆ»"æ­»äº†ä¹ˆ"APPï¼Œæ·±åº¦åˆ†æåœ¨AIç¼–ç¨‹æ—¶ä»£å¦‚ä½•ä½¿ç”¨æ­£ç¡®çš„æŠ€æœ¯æ ˆå®ç°åº”ç”¨çš„æé€Ÿå¼€å‘ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä¸€ä¸ª8å…ƒAPPä¸ºä½•åœ¨AppStoreç‹‚é”€ï¼Ÿ</h2>
<p>2026 å¹´ç¬¬ä¸€æ¬¾å…¨ç½‘çˆ†ç«çš„ Appã€Œæ­»äº†ä¹ˆã€ï¼Œæ˜¯ä¸€æ¬¾æ ‡ä»·8å…ƒçš„ä»˜è´¹äº§å“ï¼Œå·²ç»è¿ç»­å‡ å¤©å æ®è‹¹æœ AppStore ä»˜è´¹æ¦œç¬¬ä¸€ã€‚Â </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed18c681cb25427eacb9bc3335ded50f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=p67DOOzFc%2Fdq4kUkI5LSEQ%2FpFXE%3D" alt="1.png" loading="lazy"/></p>
<p>è¿™æ¬¾ App çš„åŠŸèƒ½æå…¶ç®€å•ï¼Œè¾“å…¥ä½ çš„åå­—å’Œç´§æ€¥è”ç³»äººé‚®ç®±ï¼Œç„¶åæ¯å¤©ç­¾åˆ°ã€‚å¦‚æœæ²¡ç­¾åˆ°ï¼Œåˆ™ä¼šè‡ªåŠ¨å‘é€é‚®ä»¶è­¦æŠ¥ç»™ç´§æ€¥è”ç³»äººã€‚ è¿™ä¹ˆç®€å•çš„åŠŸèƒ½å´ç²¾å‡†æˆ³ä¸­äº†ç‹¬å±…è€…é¢ä¸´çš„ç”Ÿæ´»éš¾é¢˜ä¹Ÿåˆ‡åˆ‡å®å®åæ˜ äº†åªè¦æˆ³ä¸­ç”¨æˆ·ç—›ç‚¹ï¼Œå†ç®€å•çš„APPä¹Ÿæœ‰å®ƒç‹¬ç‰¹çš„ä»·å€¼ã€‚åŒæ—¶ä½“ç°å‡ºï¼Œåœ¨AIæ—¶ä»£ï¼Œåªè¦æœ‰æƒ³æ³•ï¼Œå°±å¯ä»¥è¿…é€Ÿè½åœ°å®ç°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8f04304097c46e1807c65454943b53d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=SDlHI8iOoi1lxuWZDAlWN9xRMx8%3D" alt="2.png" loading="lazy"/></p>
<p>è™½ç„¶è¿™ä¸ªAppçš„åŠŸèƒ½çœ‹ä¼¼ç®€å•ï¼Œå¼€å‘è€…ä¹Ÿå£°ç§°å¼€å‘æˆæœ¬ä»…å‡ åƒå…ƒã€‚ä½†éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ï¼Œå‰ç«¯ä»…æœ‰çš„ç­¾åˆ°åŠŸèƒ½èƒŒåï¼Œå´åŒ…å«äº†ç”¨æˆ·ç®¡ç†ã€é‚®ä»¶æ¨é€ã€å®šæ—¶ä»»åŠ¡èƒ½åŠ›ã€‚å½“å‰æµè¡Œçš„AIç¼–ç å¯ä»¥è¿…é€Ÿä¸”å®Œæ•´åœ°å®ç°å‰ç«¯èƒ½åŠ›ï¼Œä½†æ¶‰åŠåˆ°åŒ…å«åç«¯èƒ½åŠ›æ—¶å°±ä¼šæœ‰ä¸€å®šæŒ‘æˆ˜ï¼Œä½†æ˜¯è¿™ä¸€çŸ­æ¿å¹¶éä¸èƒ½å…‹æœï¼Œé€šè¿‡Rulesã€Skillså’Œæ­£ç¡®çš„æŠ€æœ¯é€‰å‹ï¼Œåˆ™å¯ä»¥è¿…é€Ÿå®Œæˆå…¨æ ˆè½åœ°ã€‚</p>
<h2 data-id="heading-2">äºŒã€ä»æƒ³æ³•åˆ°ä¸Šçº¿ï¼šç”¨æœ€ä½³æŠ€æœ¯é€‰å‹å®ç°AIå…¨æ ˆç¼–ç¨‹</h2>
<p>ä¸‹é¢æˆ‘ä»¬å°±ä»¥å¤åˆ»æ•´ä¸ªã€Œæ­»äº†ä¹ˆã€ä¸ºä¾‹ï¼Œä½¿ç”¨AIç¼–ç æ—¶ä»£çš„æœ€ä½³æŠ€æœ¯é€‰å‹è¿…é€Ÿå®ç°è½åœ°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c04f591ca6824cde8c84a63e98dd3647~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=qoHs58yh9lba%2FCXzgfkoxgle3nA%3D" alt="3.png" loading="lazy"/></p>
<p>ä½¿ç”¨Qoder 30åˆ†é’Ÿå®Œå…¨å¤åˆ»ç‰ˆï¼ˆåŒ…å«åç«¯ï¼‰</p>
<p>çœ‹ä¸‹é¢çš„è§†é¢‘ï¼Œå·¦è¾¹æˆ‘ä»¬ä½¿ç”¨æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿäº†çœŸæœºæ•ˆæœï¼Œå³è¾¹æ˜¯Supabaseåç«¯dashboardï¼Œå¯ä»¥çœ‹åˆ°åˆšå¼€å§‹åç«¯å¹¶æ²¡æœ‰æ•°æ®ï¼Œå½“æˆ‘ä»¬é€šè¿‡å·¦è¾¹APPå®Œæˆç­¾åˆ°åï¼Œæ•°æ®å†™å…¥åˆ°äº†åç«¯çš„userså’Œcheck_insè¡¨é‡Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd6a5aefa29e4feea69cfaf641becb85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=xrWb3NRNDPwDCK0YFjJpoZWChAs%3D" alt="4.gif" loading="lazy"/></p>
<p>å½“å®Œæˆç­¾åˆ°åï¼Œç­¾åˆ°æ•°æ®ä¼šå­˜å‚¨åœ¨åç«¯ï¼Œåœ¨é‡å¤æ‰“å¼€APPæ—¶ï¼Œä¼šä»åç«¯è·å–ç­¾åˆ°æ•°æ®ï¼Œå¦‚æœå·²ç»å®Œæˆç­¾åˆ°ï¼Œåˆ™ç›´æ¥æ˜¾ç¤ºç­¾åˆ°æˆåŠŸã€‚å¦‚æœ2å¤©æ²¡ç­¾åˆ°åˆ™è§¦å‘é‚®ä»¶å‘é€ä»»åŠ¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2fb60891bd44c6b12bb567d342d281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=Wl2ZDQE4f67pxJf0hQptISjAXD0%3D" alt="5.gif" loading="lazy"/></p>
<h2 data-id="heading-3">ä¸‰ã€å¼€å‘å·¥å…·é€‰å‹</h2>
<p>æ¬²å–„å…¶äº‹ï¼Œå…ˆåˆ©å…¶å™¨ã€‚é€‰æ‹©åˆé€‚çš„å¼€å‘å·¥å…·å¯ä»¥åŠ é€Ÿæ•´ä½“å¼€å‘æ•ˆç‡ï¼Œæ­£æ‰€è°“æœ€çƒ­é—¨çš„ç¼–ç¨‹è¯­è¨€æ˜¯è‹±è¯­ï¼Œå…¶æ¬¡æ˜¯ä¸­æ–‡ï¼ŒAIç¼–ç å·²ç„¶æ˜¯å½“å‰æå‡å¼€å‘æ•ˆç‡çš„ä¸äºŒé€‰æ‹©ã€‚å½“ä¸‹ä¸»æµçš„IDEä¸»è¦æ˜¯Cursorã€Qoder ç­‰ï¼Œå®ƒä»¬è¿˜èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒè‡ªå®šä¹‰çš„ Rules å’Œ Skillsï¼Œè®©AIèƒ½å¤Ÿæ›´åŠ é«˜æ•ˆä¸”å‡†ç¡®åœ°ç¼–ç ã€‚å¹¶ä¸”é€šè¿‡Skillsï¼Œå¯ä»¥è®©AIè‡ªæˆ‘æ€»ç»“ç»éªŒï¼Œé¿å…ç¼–ç è¿‡ç¨‹é‡å¤è¸©å‘ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥Qoderä½œä¸ºç¼–ç å·¥å…·ï¼Œå®ƒä¸ä½†å¯ä»¥ç¼–ç ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Bmad-METHODæ–¹æ³•å¯¹éœ€æ±‚è¿›è¡Œæ¢³ç†å’Œæ‹†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åŸºäºå®ƒå¯¹ã€Œæ­»äº†ä¹ˆã€APPè¿›è¡ŒåŠŸèƒ½åˆ†æå’Œæ¨¡å—æ‹†è§£æ¢³ç†ï¼Œè®©AIå¼€å‘ç¼–ç æµç¨‹æ›´æ¸…æ™°ã€‚</p>
<h3 data-id="heading-4">3.1 BMAD-Methodï¼šä»â€œå…ˆå†™å†æ•‘ç«â€åˆ°â€œå…ˆè§„åˆ’å†è¿­ä»£â€çš„ Agent å¼€å‘èŒƒå¼</h3>
<p>å¦‚æœç›´æ¥è®© AI è¿›å…¥ç¼–ç é˜¶æ®µï¼Œå¾€å¾€åªèƒ½å¿«é€Ÿåšå‡ºä¸€ä¸ªå°å‹ demoï¼›ä½†å½“é¡¹ç›®éœ€è¦æŒç»­è¿­ä»£å’Œæ¼”è¿›æ—¶ï¼Œç»´æŠ¤æˆæœ¬ä¼šè¿…é€Ÿä¸Šå‡ï¼Œå¼€å‘ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ© Mmad Methodï¼šå…ˆè®© AI å¯¹éœ€æ±‚è¿›è¡Œæ•´ä½“è¯„å®¡ï¼Œå†å®Œæˆè§„åˆ’ä¸æ¶æ„è®¾è®¡ï¼Œéšåæ‹†è§£åŠŸèƒ½æ¨¡å—ï¼Œæœ€åæŒ‰æ­¥éª¤é€æ­¥å®ç°ã€‚</p>
<p>è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿åœ¨äºï¼šæ—¢èƒ½è®© AI åœ¨å…·ä½“å¼€å‘æ—¶èšç„¦äºæ¸…æ™°ã€å¯æ‰§è¡Œçš„å°ä»»åŠ¡ï¼Œåˆèƒ½ä¿æŒå…¨å±€è§†è§’ï¼ŒæŒç»­æŒæ§é¡¹ç›®æ–¹å‘ä¸è¿›åº¦ï¼Œä»è€Œé™ä½éšç€ä»£ç é‡å¢é•¿è€Œå¸¦æ¥çš„é”™è¯¯ç‡ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒAI å¯èƒ½åœ¨å®Œæˆ A åŠŸèƒ½åï¼Œå¼€å‘ B åŠŸèƒ½æ—¶æ— æ„ä¸­æ”¹åŠ¨äº† A çš„ä¾èµ–ï¼Œå¯¼è‡´ A å¤±æ•ˆï¼Œæœ€ç»ˆè®©ç³»ç»Ÿæ•´ä½“ä¸å¯ç”¨ï¼›è€Œå½“ä¸Šä¸‹æ–‡å˜é•¿åï¼ŒAI åè€Œæ›´éš¾å‡†ç¡®å®šä½å¹¶ä¿®å¤é—®é¢˜ã€‚é€šè¿‡â€œå…ˆè§„åˆ’ã€å†æ‹†è§£ã€åå®ç°â€çš„æµç¨‹ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘è¿™ç±»è¿é”é—®é¢˜çš„å‘ç”Ÿã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8d5055955ef480399fab111b786963f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=PkOGIDBfVNBxHAJKX7wFNsb1FYU%3D" alt="6.png" loading="lazy"/></p>
<h3 data-id="heading-5">3.2 Agent Skills: ç”¨â€œæ¸è¿›å¼æŠ«éœ²â€æŠŠä¸Šä¸‹æ–‡ç”¨åœ¨åˆ€åˆƒä¸Š</h3>
<p>Agent Skills å¯¹ AI Coding çš„æœ€å¤§ä»·å€¼ï¼Œåœ¨äºé€šè¿‡æ¸è¿›å¼æŠ«éœ²æœºåˆ¶ç³»ç»Ÿæ€§ç¼“è§£â€œä¸Šä¸‹æ–‡ä¸å¤Ÿç”¨â€çš„å·¥ç¨‹é—®é¢˜ï¼šæ™ºèƒ½ä½“å¯åŠ¨æ—¶åªåŠ è½½æ¯ä¸ªæŠ€èƒ½çš„å°‘é‡å…ƒæ•°æ®ï¼ˆé€šå¸¸çº¦ç™¾ token çº§ï¼‰ï¼Œä»è€Œåœ¨å®‰è£…å¤§é‡æŠ€èƒ½çš„æƒ…å†µä¸‹ä»ä¿æŒæä½çš„åˆå§‹ä¸Šä¸‹æ–‡å ç”¨ï¼›å½“æŸä¸ªä»»åŠ¡çœŸæ­£éœ€è¦æŸé¡¹èƒ½åŠ›æ—¶ï¼Œæ‰æŒ‰éœ€åŠ è½½è¯¥æŠ€èƒ½çš„å®Œæ•´æŒ‡ä»¤ä¸ç¤ºä¾‹ï¼ŒæŠŠ token ç²¾å‡†æŠ•å…¥åˆ°å½“å‰è¦åšçš„äº‹ä¸Šï¼Œé¿å…åƒä¼ ç»Ÿ MCP é‚£æ ·åœ¨è¿æ¥æ—¶ä¸€æ¬¡æ€§çŒå…¥å¤§é‡å·¥å…· Schema é€ æˆâ€œå¼€å±€ä¸Šä¸‹æ–‡çˆ†ç‚¸â€ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¤æ‚èƒ½åŠ›è¿˜å¯ä»¥é€šè¿‡è„šæœ¬ä¸å¼•ç”¨èµ„æºå»¶å±•å‡ºå‡ ä¹æ— é™çš„çŸ¥è¯†å®¹é‡ï¼Œå¹¶æŠŠè§£æã€è½¬æ¢ã€è®¡ç®—ç­‰é«˜é£é™©æ­¥éª¤äº¤ç»™ä»£ç ç¡®å®šæ€§æ‰§è¡Œï¼Œå‡å°‘ LLM çš„å¹»è§‰ä¸ä¸ç¨³å®šè¾“å‡ºã€‚æœ€ç»ˆæ•ˆæœæ˜¯ï¼šå¯¹è¯æ›´è½»ã€å†³ç­–æ›´å‡†ã€ä¸Šä¸‹æ–‡æ›´å¹²å‡€ï¼ŒAI åœ¨æŒç»­è¿­ä»£ç¼–ç æ—¶æ›´ä¸å®¹æ˜“é—å¿˜å…³é”®çº¦æŸæˆ–è¯¯æ”¹æ—¢æœ‰é€»è¾‘ï¼Œæ•´ä½“äº¤ä»˜è´¨é‡ä¸è¿­ä»£æ•ˆç‡éƒ½ä¼šæ˜¾è‘—æå‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bde8c01fe014950830795f26f392d47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=gtW072OTKzIxC0N126aGoWxY1t4%3D" alt="7.png" loading="lazy"/></p>
<p>åŒæ—¶å…³äºAI Codingçš„ä¸Šä¸‹æ–‡å·¥ç¨‹ç­‰å…¶ä»–å†…å®¹å·²ç„¶æœ‰å¾ˆå¤šç ”ç©¶ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œæœ¬æ–‡ä¸»è¦èšç„¦äºå¦‚ä½•é€šè¿‡æ›´å‹å¥½çš„æŠ€æœ¯é€‰å‹ï¼Œæå‡AIç¼–ç çš„æ‰§è¡Œç‡ã€‚</p>
<h2 data-id="heading-6">å››ã€æŠ€æœ¯é€‰å‹</h2>
<h3 data-id="heading-7">4.1 åŠŸèƒ½æ‹†è§£ï¼šéº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨</h3>
<p>è¿™æ¬¾APPçœ‹èµ·æ¥åªæœ‰ä¸€ä¸ªç­¾åˆ°æŒ‰é’®ï¼Œä½†èƒŒåæ¶‰åŠçš„æŠ€æœ¯æ¨¡å—å…¶å®ä¸å°‘ã€‚è¿™æ˜¯ä¸€æ¬¾é¢å‘æ—¥å¸¸è‡ªæ£€/æŠ¥å¹³å®‰åœºæ™¯çš„è½»é‡åº”ç”¨ï¼Œé€šè¿‡æ¯æ—¥ç­¾åˆ°å¸®åŠ©ç”¨æˆ·å»ºç«‹æŒç»­çš„çŠ¶æ€ç¡®è®¤æœºåˆ¶ï¼Œå¹¶åœ¨ç¼ºå¸­æ—¶è§¦å‘æé†’ï¼Œé™ä½â€œæ— äººå¯Ÿè§‰â€çš„é£é™©ã€‚å…¶åº•å±‚æŠ€æœ¯æ‹†è§£åä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹å‰åç«¯æ¨¡å—ã€‚</p>
<h4 data-id="heading-8">4.1.1 å‰ç«¯åŠŸèƒ½æ¨¡å—</h4>






























<table><thead><tr><th>åŠŸèƒ½</th><th>ç”¨æˆ·æ“ä½œ</th><th>æŠ€æœ¯è¦æ±‚</th></tr></thead><tbody><tr><td>ä¿¡æ¯å½•å…¥</td><td>è¾“å…¥å§“åå’Œé‚®ç®±</td><td>è¡¨å•éªŒè¯ã€è¾“å…¥æ¡†ç»„ä»¶</td></tr><tr><td>æ¯æ—¥ç­¾åˆ°</td><td>ç‚¹å‡»ç­¾åˆ°æŒ‰é’®</td><td>æŒ‰é’®äº¤äº’ã€çŠ¶æ€ç®¡ç†</td></tr><tr><td>çŠ¶æ€å±•ç¤º</td><td>æ˜¾ç¤º"ä»Šæ—¥å·²ç­¾åˆ°"</td><td>UIçŠ¶æ€åˆ‡æ¢ã€æœ¬åœ°ç¼“å­˜</td></tr><tr><td>æˆåŠŸåé¦ˆ</td><td>ç­¾åˆ°æˆåŠŸåŠ¨ç”»</td><td>åŠ¨ç”»æ•ˆæœã€ç”¨æˆ·ä½“éªŒ</td></tr></tbody></table>
<h4 data-id="heading-9">4.1.2 åç«¯åŠŸèƒ½æ¨¡å—</h4>








































<table><thead><tr><th>åŠŸèƒ½</th><th>ä¸šåŠ¡éœ€æ±‚</th><th>æŠ€æœ¯è¦æ±‚</th></tr></thead><tbody><tr><td>ç”¨æˆ·ç®¡ç†</td><td>è®°å½•ç”¨æˆ·ä¿¡æ¯</td><td>æ•°æ®åº“ã€ç”¨æˆ·è¡¨</td></tr><tr><td>èº«ä»½è¯†åˆ«</td><td>åŒºåˆ†ä¸åŒç”¨æˆ·</td><td>è®¤è¯ç³»ç»Ÿã€Sessionç®¡ç†</td></tr><tr><td>ç­¾åˆ°è®°å½•</td><td>å­˜å‚¨æ¯æ—¥ç­¾åˆ°</td><td>æ•°æ®åº“ã€é˜²é‡å¤æœºåˆ¶</td></tr><tr><td>æ•°æ®éš”ç¦»</td><td>ç”¨æˆ·åªèƒ½çœ‹è‡ªå·±çš„æ•°æ®</td><td>æƒé™æ§åˆ¶ã€å®‰å…¨ç­–ç•¥</td></tr><tr><td>å®šæ—¶æ£€æµ‹</td><td>è‡ªåŠ¨æ£€æŸ¥å“ªäº›ç”¨æˆ·æœªç­¾åˆ°</td><td>å®šæ—¶ä»»åŠ¡ã€ä¸šåŠ¡é€»è¾‘</td></tr><tr><td>é‚®ä»¶é€šçŸ¥</td><td>å‘é€æé†’é‚®ä»¶</td><td>é‚®ä»¶æœåŠ¡ã€æ¶ˆæ¯æ¨é€</td></tr></tbody></table>
<h3 data-id="heading-10">4.2 æ•´ä½“æŠ€æœ¯æ¶æ„</h3>
<p>åŸºäºå‰é¢çš„åŠŸèƒ½åˆ†æä¸æ¨¡å—æ‹†è§£ï¼Œæ¥ä¸‹æ¥è¿›å…¥ APP èƒ½åŠ›çš„æ­£å¼è½åœ°å®ç°ã€‚åœ¨ AI ç¼–ç¨‹æ—¶ä»£ï¼ŒAI å·²ç»èƒ½å¤Ÿå¿«é€Ÿç”Ÿæˆå‰ç«¯ä»£ç ï¼Œé«˜æ•ˆå®Œæˆç•Œé¢æ­å»ºä¸äº¤äº’å®ç°ï¼›ä½†çœŸæ­£çš„æŒ‘æˆ˜å¾€å¾€å‡ºç°åœ¨åç«¯ï¼šæ•°æ®åº“ä¸æ•°æ®ç®¡ç†ã€ç”¨æˆ·è®¤è¯ä¸æƒé™æ§åˆ¶ã€å®šæ—¶ä»»åŠ¡ã€é‚®ä»¶æœåŠ¡ç­‰æ¨¡å—ç¼ºä¸€ä¸å¯ï¼Œè€ŒæŠ€æœ¯é€‰å‹ä¸€æ—¦è¿‡å¤šã€è¿‡é‡ï¼Œä¸ä»…ä¼šæ˜¾è‘—æ‹‰é•¿å¼€å‘å‘¨æœŸï¼Œä¹Ÿä¼šåœ¨ MVP é˜¶æ®µåˆ†æ•£å›¢é˜Ÿæœ€å®è´µçš„æ—¶é—´ä¸æ³¨æ„åŠ›ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€å¥—æ›´é€‚åˆÂ AI åä½œã€ä½è¿ç»´ã€å¯å¿«é€Ÿè¿­ä»£çš„æŠ€æœ¯æ–¹æ¡ˆï¼šå‰ç«¯ä½¿ç”¨ SwiftUIï¼Œåç«¯æ ¸å¿ƒèƒ½åŠ›äº¤ç»™æ‰˜ç®¡çš„é˜¿é‡Œäº‘ AnalyticDB Supabaseï¼ˆä¸‹æ–‡ç®€ç§°ADB Supabaseï¼‰ äº‘æœåŠ¡æ‰¿è½½ã€‚åº”ç”¨é€šè¿‡ HTTPS è·¨åŸŸç›´è¿ Supabaseï¼Œç›´æ¥è°ƒç”¨è®¤è¯ã€æ•°æ®åº“ã€è¾¹ç¼˜å‡½æ•°ç­‰èƒ½åŠ›ï¼Œæ— éœ€è‡ªå»ºåç«¯æœåŠ¡ï¼Œæ›´æ— éœ€æŠ•å…¥æœåŠ¡å™¨éƒ¨ç½²ã€æ‰©ç¼©å®¹ä¸æ—¥å¸¸è¿ç»´ï¼Œä»è€ŒæŠŠç²¾åŠ›é›†ä¸­åœ¨å®¢æˆ·ç«¯ä½“éªŒä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/845cbca613774a1194207f30651ef7fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=SK0awJHu%2B18d06FGzuG%2FpgHvSMA%3D" alt="10.png" loading="lazy"/></p>
<h4 data-id="heading-11">4.2.1 å‰ç«¯é€‰å‹ï¼šSwiftUI</h4>
<p>ä»â€œAI äº²å’Œåº¦â€æ¥çœ‹ï¼ŒTypeScript + React + Vite ç­‰ Web æŠ€æœ¯æ ˆç¡®å®æ›´æ¥è¿‘å½“ä¸‹ä¸»æµæ¨¡å‹çš„è®­ç»ƒè¯­æ–™ä¸ç”Ÿæ€ï¼Œé€‚åˆå¿«é€Ÿæ„å»º Web åº”ç”¨æˆ– AI Native äº§å“ã€‚ä½†æœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯å¤åˆ» iOS ç”Ÿæ€çš„ APPï¼Œå› æ­¤é€‰æ‹© SwiftUI æ›´ç¬¦åˆå¹³å°ä¸€è‡´æ€§ä¸ç”¨æˆ·ä½“éªŒé¢„æœŸã€‚åŒæ—¶ SwiftUI å…·å¤‡å£°æ˜å¼ UIã€ç»„ä»¶åŒ–ç»“æ„æ¸…æ™°ç­‰ç‰¹ç‚¹ï¼Œä¹Ÿéå¸¸åˆ©äº AI ç”Ÿæˆä¸ç»´æŠ¤ä»£ç ã€‚</p>
<h4 data-id="heading-12">4.2.2 åç«¯é€‰å‹ï¼šSupabaseâ€”â€”AI ç¼–ç¨‹æ—¶ä»£çš„ç†æƒ³åç«¯</h4>
<p>Supabase çš„ä¼˜åŠ¿ä¸åªæ˜¯â€œå¼€ç®±å³ç”¨â€ï¼Œæ›´åœ¨äºå®ƒå¤©ç„¶é€‚é… AI çš„å·¥ä½œæ–¹å¼ï¼š</p>
<ul>
<li>å£°æ˜å¼ä¸æ•°æ®åº“ä¼˜å…ˆï¼šæŠŠå¤æ‚åº¦æ”¾åˆ° AI æ›´æ“…é•¿çš„åœ°æ–¹<br/>
ç›¸æ¯”ç¼–å†™å¤§é‡åç«¯ä¸šåŠ¡ä»£ç ï¼ŒAI æ›´æ“…é•¿äº§å‡º SQL ä¸å£°æ˜å¼é…ç½®ï¼šè¡¨ç»“æ„ã€ç´¢å¼•ã€çº¦æŸã€é˜²é‡å¤æœºåˆ¶ã€RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥ç­‰éƒ½å¯ä»¥é€šè¿‡ SQL æ¸…æ™°è¡¨è¾¾ã€‚å°†å…³é”®è§„åˆ™ä¸‹æ²‰åˆ°æ•°æ®åº“å±‚ï¼Œå‰ç«¯é€»è¾‘ä¼šæ›´ç®€å•ã€æ›´å¯æ§ï¼Œä¹Ÿæ›´ä¸æ˜“åœ¨è¿­ä»£ä¸­è¢«æ”¹åã€‚</li>
</ul>

<ul>
<li>ä¸°å¯Œ SDK + è‡ªåŠ¨åŒ– APIï¼šå‡å°‘æ‰‹å†™æ¥å£ä¸æ¶æ„è´Ÿæ‹…<br/>
Supabase æä¾›å¤šè¯­è¨€ SDKï¼Œå¹¶ä»¥ç»Ÿä¸€çš„ <code>.insert()</code>ã€<code>.select()</code>Â ç­‰æ–¹å¼è°ƒç”¨æ•°æ®ä¸è®¤è¯èƒ½åŠ›ï¼Œå¼€å‘è€…æ— éœ€æ‰‹å†™ RESTful æ¥å£ï¼Œä¹Ÿä¸å¿…å…ˆæ­ä¸€å¥—å®Œæ•´åç«¯æ¡†æ¶ã€‚å¯¹ AI è€Œè¨€ï¼Œè¿™æ„å‘³ç€æ›´å°‘çš„ä¸Šä¸‹æ–‡ã€æ›´æ ‡å‡†çš„è°ƒç”¨è·¯å¾„ã€æ›´é«˜çš„å®ç°å‡†ç¡®åº¦ã€‚</li>
</ul>

<ul>
<li>åŸºäºäº‘æ‰˜ç®¡çš„ADB Supabaseï¼Œå®ç°ã€Œæ­»äº†ä¹ˆã€æ‰€æœ‰åŠŸèƒ½ï¼Œéƒ½ä¸éœ€è¦å¼€å‘è€…é¢å¤–å†éƒ¨ç½²åç«¯</li>
</ul>
<p>ä¾æ‰˜ Supabase æ‰˜ç®¡æœåŠ¡ï¼Œã€Œæ­»äº†ä¹ˆã€APPçš„æ ¸å¿ƒåç«¯èƒ½åŠ›æ— éœ€é¢å¤–éƒ¨ç½²ï¼šæ•°æ®åº“ã€è®¤è¯ã€æƒé™æ§åˆ¶ä¸å¯¹å¤– HTTPS è®¿é—®èƒ½åŠ›ä¸€å¹¶æä¾›ã€‚å¼€å‘è€…å¯ä»¥æŠŠæ³¨æ„åŠ›é”å®šåœ¨å®¢æˆ·ç«¯ä¸ä¸šåŠ¡é—­ç¯ä¸Šï¼Œæ˜¾è‘—èŠ‚çœå¼€å‘ä¸è¿ç»´æˆæœ¬ï¼ŒåŠ å¿«è¿­ä»£é€Ÿåº¦ã€‚</p>
<h2 data-id="heading-13">äº”ã€è¯¦ç»†åŠŸèƒ½å®ç°æ‹†è§£</h2>
<h3 data-id="heading-14">5.1 åŒ¿åè®¤è¯ï¼šæ— æ„Ÿèº«ä»½è¯†åˆ«ï¼ˆä¸åšâ€œç”¨æˆ·ä½“ç³»â€ï¼Œä¹Ÿèƒ½å®Œæˆç»‘å®šï¼‰</h3>
<p>â€œæ­»äº†ä¹ˆ â€APPä¸æä¾›æ˜¾å¼çš„æ³¨å†Œ/ç™»å½•å…¥å£ï¼Œä½†ä»éœ€è¦åšåˆ°â€œæ•°æ®å½’å±åˆ°å…·ä½“ç”¨æˆ·â€ã€‚æˆ‘ä»¬é‡‡ç”¨ åŒ¿åè®¤è¯ï¼ˆAnonymous Authï¼‰+ è®¾å¤‡å”¯ä¸€æ ‡è¯† çš„æ–¹å¼å®ç°æ— æ„Ÿç»‘å®šï¼š</p>
<ul>
<li>å®ç°æ€è·¯ï¼šå®¢æˆ·ç«¯é¦–æ¬¡å¯åŠ¨æ—¶è§¦å‘åŒ¿åç™»å½•ï¼ŒSupabase AuthÂ ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„Â <code>user_id</code>ï¼›å®¢æˆ·ç«¯å°†è¯¥èº«ä»½ä¸æœ¬æœºçš„è®¾å¤‡æ ‡è¯†å»ºç«‹å…³è”ï¼Œåç»­ç­¾åˆ°ã€æŸ¥è¯¢éƒ½åœ¨è¯¥Â <code>user_id</code>Â ä¸‹è¿›è¡Œã€‚</li>
<li>æ•ˆæœï¼šç”¨æˆ·ä¸éœ€è¦æ³¨å†Œã€ä¸éœ€è¦è®°å¯†ç ï¼Œå³å¯å®Œæˆèº«ä»½è¯†åˆ«ä¸æ•°æ®éš”ç¦»ï¼ˆé…åˆ RLSï¼‰ã€‚</li>
<li>å·²çŸ¥é™åˆ¶ï¼šç”¨æˆ·æ›´æ¢è®¾å¤‡åä¼šè¢«è§†ä¸ºâ€œæ–°ç”¨æˆ·â€ï¼ˆå› ä¸ºè®¾å¤‡æ ‡è¯†å˜åŒ–ï¼‰ã€‚</li>
</ul>
<p>å¯æ¼”è¿›æ–¹å‘ï¼šå¦‚æœå¸Œæœ›â€œå¤šç«¯åŒä¸€ç”¨æˆ·â€ï¼Œå¯ä»¥ç›´æ¥å‡çº§ä¸º Supabase Auth çš„æ ‡å‡†ç™»å½•ä½“ç³»ã€‚ADB Supabase æä¾›æœ¬åœŸåŒ–å¯ç”¨çš„è®¤è¯èƒ½åŠ›ï¼ˆå¦‚å¾®ä¿¡/æ”¯ä»˜å® OAuthã€é‚®ç®±ç­‰ï¼‰ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜æ•´ä½“æ¶æ„çš„å‰æä¸‹å¼ºåŒ–ç™»å½•ä¸è´¦å·åˆå¹¶èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-15">5.2 Edge Functionsï¼šæŠŠæœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘äº¤ç»™äº‘ç«¯ï¼ˆAI å‹å¥½ã€ä½è¿ç»´ï¼‰</h3>
<p>æœ¬é¡¹ç›®ä¸­ä¸¤ç±»å…³é”®èƒ½åŠ›å¹¶ä¸é€‚åˆæ”¾åœ¨å®¢æˆ·ç«¯å®Œæˆï¼šâ€œå®šæ—¶æ£€æµ‹æœªç­¾åˆ°ç”¨æˆ·â€å’Œâ€œå‘é€é‚®ä»¶é€šçŸ¥ï¼ˆæˆ–å…¶å®ƒé€šçŸ¥æ¸ é“ï¼‰â€</p>
<p>å› æ­¤æˆ‘ä»¬ä½¿ç”¨ ADB Supabase Edge Functions æ‰¿è½½æœåŠ¡ç«¯é€»è¾‘ã€‚Edge Functions æ˜¯è¿è¡Œåœ¨ Supabase äº‘ç«¯çš„ Serverless å‡½æ•°ï¼š</p>
<ul>
<li>è¿è¡Œæ—¶ï¼šDeno</li>
<li>è¯­è¨€ï¼šåŸç”Ÿ TypeScript</li>
<li>èƒ½åŠ›ï¼šå¯ä½œä¸º HTTP æ¥å£æš´éœ²ï¼Œä¹Ÿå¯è¢« Cron Job å®šæ—¶è§¦å‘</li>
</ul>
<p>ä¸ºä»€ä¹ˆEdge Functionså¯¹AIç¼–ç¨‹å‹å¥½ï¼Ÿ</p>









































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿè‡ªå»ºåç«¯</th><th>ADB Supabase Edge Functions</th><th>å¯¹ AI çš„ç›´æ¥æ”¶ç›Š</th></tr></thead><tbody><tr><td>å¼€å‘è¯­è¨€/ç¯å¢ƒ</td><td>Node/æ¡†æ¶/ä¾èµ–ä¸ç¯å¢ƒé…ç½®</td><td>ç›´æ¥å†™ TypeScriptï¼ˆDenoï¼‰</td><td>AI æ›´æ“…é•¿ TSï¼Œå‡å°‘ç¯å¢ƒå‘</td></tr><tr><td>éƒ¨ç½²</td><td>æœåŠ¡å™¨ã€Dockerã€ç½‘å…³ã€è¯ä¹¦</td><td>ä¸€æ¡å‘½ä»¤å‘å¸ƒåˆ°äº‘ç«¯</td><td>AI ä¸ç”¨â€œæŒ‡å¯¼ä½ è¿ç»´â€</td></tr><tr><td>API æš´éœ²</td><td>æ‰‹å†™è·¯ç”±/ç½‘å…³é…ç½®</td><td>è‡ªåŠ¨ç”Ÿæˆ HTTP ç«¯ç‚¹</td><td>AI åªéœ€æŒ‰ URL è°ƒç”¨</td></tr><tr><td>å®šæ—¶ä»»åŠ¡</td><td>é¢å¤– Cron æœåŠ¡/ä»»åŠ¡ç³»ç»Ÿ</td><td>å†…ç½® Cron Jobs è§¦å‘</td><td>AI åªé…ç½® Cron è¡¨è¾¾å¼</td></tr><tr><td>æƒé™ä¸å¯†é’¥</td><td>è‡ªå·±è®¾è®¡é‰´æƒä¸å¯†é’¥ç®¡ç†</td><td>ä½¿ç”¨ <code>service_role key</code>ï¼ˆæœåŠ¡ç«¯ä¸“ç”¨ï¼‰</td><td>æœºå¯†ç•™åœ¨äº‘ç«¯ï¼Œå®¢æˆ·ç«¯æ›´å®‰å…¨</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00ef96366aea44ce9d11a7af7efb4b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=eVPnjitryY3ziSO8yCyfaVJpeTU%3D" alt="12.png" loading="lazy"/></p>
<p>è¿™é‡Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªEdge Functionï¼šcheck-missed-check-inså’Œsend-notification-emailã€‚</p>
<p><strong>Edge Function 1: check-missed-check-ins</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c67db56fa0140df8bcd31cbb83dfe29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=0ORZ13OdoGlHjqh%2FnIs8OVjlAzc%3D" alt="13.png" loading="lazy"/></p>
<p>ç›®æ ‡ï¼šæ¯å¤©æ‰«ææ‰€æœ‰ç”¨æˆ·ï¼Œæ‰¾å‡ºâ€œè¿ç»­ 2 å¤©æœªç­¾åˆ°â€çš„ç”¨æˆ·ï¼Œå¹¶è§¦å‘é€šçŸ¥æµç¨‹ã€‚</p>
<p>è¿™ä¸€ç±»â€œå…¨é‡æ‰«æ + è§„åˆ™åˆ¤æ–­ + æ‰¹é‡è§¦å‘â€çš„é€»è¾‘æ”¾åœ¨å®¢æˆ·ç«¯å‡ ä¹ä¸å¯è¡Œï¼›æ”¾åœ¨ Supabase Edge Functions åˆ™å¤©ç„¶é€‚é…ã€‚</p>
<p><strong>ä¸šåŠ¡æµç¨‹</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44161f4b98b4b60b838e9e19cbc5735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=psMSqd7cLaU%2FY%2Fo3FDjChJPkHV8%3D" alt="14.png" loading="lazy"/></p>
<p>Edge Function 2: send-notification-email</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7572ea96620a4378ad23dfa67be26f51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=GPUfmFOpxQpnXdRTEwztSdBLOHc%3D" alt="15.png" loading="lazy"/></p>
<p>ç›®æ ‡ï¼šæ¥æ”¶ç”¨æˆ·ä¿¡æ¯ä¸ç´§æ€¥è”ç³»äººé‚®ç®±ï¼Œå‘é€æé†’é‚®ä»¶ã€‚</p>
<p>é‚®ä»¶å†…å®¹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs">ä¸»é¢˜ï¼šä¸€æ¡é‡è¦é€šçŸ¥

æˆ‘æ˜¯{username},æˆ‘å·²ç»è¿ç»­å¾ˆå¤šå¤©æ²¡æœ‰æ´»åŠ¨äº†ï¼Œå¿«æ¥æ£€æµ‹ä¸€ä¸‹æˆ‘çš„èº«ä½“çŠ¶æ€ã€‚
</code></pre>
<p>å¯æ‰©å±•æ€§ï¼šç›®å‰å®ç°çš„æ˜¯é‚®ä»¶é€šçŸ¥ï¼›ä½†åŸºäº ADB Supabase Edge Functionsï¼ŒåŒä¸€å¥—æ¨¡å¼å¯ä»¥å¹³æ»‘æ‰©å±•åˆ° å¾®ä¿¡ã€é’‰é’‰ã€çŸ­ä¿¡ç­‰æ¸ é“ã€‚å¹¶ä¸”å› ä¸ºç¬¬ä¸‰æ–¹æ¸ é“çš„å¯†é’¥é…ç½®ä¿å­˜åœ¨äº‘ç«¯ç¯å¢ƒå˜é‡/å¯†é’¥ä½“ç³»ä¸­ï¼Œä¸ä¼šæ³„éœ²åˆ°å®¢æˆ·ç«¯ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6264d1b9e3c44721ad7e80e92d0ecd7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bqT6YKj5Lqb5LqL5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769052623&amp;x-signature=BflH4hpuMXEj1vN1pJeFNdOsQ6U%3D" alt="16.png" loading="lazy"/></p>
<h3 data-id="heading-16">5.3 Cron Jobs - å®šæ—¶ä»»åŠ¡è°ƒåº¦</h3>
<p>å®ç°çš„åŠŸèƒ½æ¨¡å—ï¼šæ¯å¤©è‡ªåŠ¨æ£€æµ‹</p>
<p>åœ¨Supabase Dashboardä¸­åˆ›å»ºCron Jobï¼š</p>



































<table><thead><tr><th>é…ç½®é¡¹</th><th>å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ä»»åŠ¡åç§°</td><td>check-missed-check-ins</td><td>æè¿°æ€§åç§°</td></tr><tr><td>Cronè¡¨è¾¾å¼</td><td><code>0 1 * * *</code></td><td>UTCæ—¶é—´å‡Œæ™¨1ç‚¹ = åŒ—äº¬9ç‚¹</td></tr><tr><td>è§¦å‘æ–¹å¼</td><td>HTTP POST</td><td>è°ƒç”¨Edge Function</td></tr><tr><td>URL</td><td><code>/functions/v1/check-missed-check-ins</code></td><td>å‡½æ•°ç«¯ç‚¹</td></tr><tr><td>è®¤è¯</td><td>Service Role Key</td><td>ç»•è¿‡RLS</td></tr></tbody></table>
<h2 data-id="heading-17">å…­ã€æ€»ç»“ä¸æ€è€ƒ</h2>
<p>è™½ç„¶ã€Œæ­»äº†ä¹ˆã€APPçš„åœºæ™¯å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œä½†æ˜¯ä¹Ÿå‘æˆ‘ä»¬å±•ç¤ºäº†å®Œæ•´çš„AIç¼–ç æŠ€æœ¯é€‰å‹çš„æœ€ä½³å®è·µã€‚AIç¼–ç å‰ç«¯çš„èƒ½åŠ›è¿œè¿œå¼ºäºåç«¯ï¼Œä¸€æ–¹é¢ï¼Œæ¨¡å‹éœ€è¦æé«˜å¯¹åç«¯çš„ç¼–ç èƒ½åŠ›ï¼Œå¦ä¸€æ–¹é¢ï¼Œé€šè¿‡å‡å°‘åç«¯ç¼–ç ï¼Œä¾æ‰˜äºADB Supaseç­‰BaaSæœåŠ¡ï¼Œè®©å‰ç«¯ç›´æ¥å˜æˆå…¨æ ˆï¼Œä¹Ÿä¸å¤±ä¸ºä¸€ç§å›´é­æ•‘èµµçš„è§£æ³•ã€‚å°¤å…¶æ˜¯åœ¨AIæ—¶ä»£ï¼Œå„ç§æƒ³æ³•åŠ é€Ÿè½åœ°MVPï¼Œå°½å¯èƒ½è®©ç ”å‘èšç„¦ä¸šåŠ¡æœ¬èº«é€»è¾‘ï¼Œåè€Œæ˜¾å¾—æ›´åŠ é‡è¦ã€‚</p>
<h3 data-id="heading-18">6.1 AIç¼–ç¨‹æ—¶ä»£çš„æŠ€æœ¯é€‰å‹åŸåˆ™</h3>
<p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æ²‰æ·€äº†å‡ æ¡åœ¨ AI è¾…åŠ©å¼€å‘ / Vibe Coding åœºæ™¯ä¸‹æ›´â€œç¨³â€çš„æŠ€æœ¯é€‰å‹åŸåˆ™â€”â€”æ ¸å¿ƒç›®æ ‡æ˜¯ï¼šè®© AI æ›´å®¹æ˜“å†™å¯¹ã€å†™ç¨³ã€å¹¶ä¸”æ›´å¥½ç»´æŠ¤ã€‚</p>






























<table><thead><tr><th>åŸåˆ™</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>åŸåˆ™1ï¼šä¼˜å…ˆé€‰æ‹©å£°æ˜å¼æŠ€æœ¯æ ˆ</td><td>AI æ›´æ“…é•¿å¤„ç†å£°æ˜å¼ä»£ç </td><td>-   âœ… SwiftUIçš„å£°æ˜å¼UI &gt; UIKitçš„å‘½ä»¤å¼UI âœ… SQLçš„å£°æ˜å¼æŸ¥è¯¢ &gt; ORMçš„å‘½ä»¤å¼æ“ä½œâœ… RLSçš„å£°æ˜å¼ç­–ç•¥ &gt; ä¸­é—´ä»¶çš„å‘½ä»¤å¼é‰´æƒ</td></tr><tr><td>åŸåˆ™2ï¼šé€‰æ‹©æ–‡æ¡£å‹å¥½çš„æŠ€æœ¯</td><td>AI ä¾èµ–é«˜è´¨é‡æ–‡æ¡£ç”Ÿæˆä»£ç </td><td>-   âœ… Supabaseå®˜æ–¹æ–‡æ¡£å®Œå–„âœ… SwiftUIæœ‰å¤§é‡ç¤ºä¾‹ä»£ç âœ… TypeScriptç±»å‹ç³»ç»Ÿå¸®åŠ©AIç†è§£</td></tr><tr><td>åŸåˆ™3ï¼šé€‰æ‹©è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜çš„æœåŠ¡</td><td>å‡å°‘ AI éœ€è¦å¤„ç†çš„é…ç½®ç»†èŠ‚</td><td>-   âœ… Supabaseè‡ªåŠ¨ç”ŸæˆAPIâœ… åŒ¿åè®¤è¯è‡ªåŠ¨ç®¡ç†Sessionâœ… RLSè‡ªåŠ¨åº”ç”¨æƒé™è§„åˆ™</td></tr><tr><td>åŸåˆ™4ï¼šé€‰æ‹©ç±»å‹å®‰å…¨çš„è¯­è¨€</td><td>ç±»å‹ç³»ç»Ÿå‡å°‘ AI ç”Ÿæˆé”™è¯¯</td><td>-   âœ… Swiftå’ŒTypeScriptéƒ½æ˜¯ç±»å‹å®‰å…¨è¯­è¨€âœ… ç¼–è¯‘æ—¶å‘ç°é”™è¯¯ï¼Œè€Œéè¿è¡Œæ—¶âœ… IDEè‡ªåŠ¨æç¤ºï¼ŒAIç”Ÿæˆæ›´å‡†ç¡®</td></tr></tbody></table>
<h3 data-id="heading-19">6.2 Supabase çš„æ ¸å¿ƒä»·å€¼</h3>
<p>Supabase åœ¨ AI ç¼–ç¨‹æ—¶ä»£å±•ç°å‡ºç‹¬ç‰¹ä»·å€¼ï¼Œæ ¸å¿ƒä½“ç°åœ¨ä¸¤ç‚¹ï¼šè®©åç«¯æ›´â€œè½»â€ï¼Œè®©äº¤ä»˜æ›´â€œå¿«â€ã€‚</p>
<p><strong>1.  é™ä½åç«¯å¤æ‚åº¦ï¼šæŠŠé•¿é“¾è·¯å·¥ç¨‹æ”¶æ•›ä¸ºå°‘é‡å£°æ˜å¼è¦ç´ </strong></p>
<p>åœ¨ä¼ ç»Ÿè‡ªå»ºåç«¯ä¸­ï¼ŒAI éœ€è¦å¤„ç†çš„ç¯èŠ‚éå¸¸å¤šï¼Œè€Œä¸”æ¯ä¸€å±‚éƒ½ä¼´éšç€å¤§é‡æ ·æ¿ä»£ç ä¸éšæ€§çº¦å®šï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">æ¡†æ¶é€‰æ‹© â†’ è·¯ç”±è®¾è®¡ â†’ æ§åˆ¶å™¨ â†’ æœåŠ¡å±‚ â†’Â 
æ•°æ®è®¿é—®å±‚ â†’ ORMé…ç½® â†’ æ•°æ®åº“è¿æ¥ â†’Â 
è®¤è¯ä¸­é—´ä»¶ â†’ æƒé™ä¸­é—´ä»¶ â†’ é”™è¯¯å¤„ç† â†’Â 
æ—¥å¿—ç³»ç»Ÿ â†’ éƒ¨ç½²é…ç½® â†’ è´Ÿè½½å‡è¡¡ â†’ ...
</code></pre>
<p>é“¾è·¯è¶Šé•¿ï¼Œè¶Šå®¹æ˜“åœ¨è¿­ä»£ä¸­äº§ç”Ÿå›å½’ä¸è€¦åˆé—®é¢˜ï¼Œä¹Ÿä¼šæ˜¾è‘—æ¶ˆè€—ä¸Šä¸‹æ–‡ä¸è°ƒè¯•æˆæœ¬ã€‚è€Œ Supabase å°†åç«¯èƒ½åŠ›é«˜åº¦æ”¶æ•›ï¼Œå¼€å‘è€…ä¸ AI å¾€å¾€åªéœ€è¦èšç„¦åœ¨ä¸‰ä»¶äº‹ä¸Šï¼š</p>





















<table><thead><tr><th>ç»„ä»¶</th><th>æè¿°</th></tr></thead><tbody><tr><td>SQL Schema</td><td>å®šä¹‰æ•°æ®åº“çš„æ•°æ®æ¨¡å‹ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ã€ç´¢å¼•ã€çº¦æŸç­‰</td></tr><tr><td>RLS ç­–ç•¥</td><td>åœ¨æ•°æ®åº“å±‚å®æ–½è¡Œçº§å®‰å…¨ç­–ç•¥ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®æƒé™ä¸éš”ç¦»è§„åˆ™</td></tr><tr><td>Edge Functions</td><td>æŒ‰éœ€ä½¿ç”¨çš„åç«¯æœåŠ¡ä»£ç ï¼Œå¤„ç†å®šæ—¶ä»»åŠ¡ã€é€šçŸ¥ã€å¤æ‚ä¸šåŠ¡é€»è¾‘</td></tr></tbody></table>
<p><strong>2.  æ‘†è„±åç«¯è¿ç»´ï¼šç”¨æ‰˜ç®¡èƒ½åŠ›æ¢å–æ›´å¿«çš„å¯åŠ¨ä¸è¿­ä»£</strong></p>
<p>ç›¸æ¯”è‡ªå»ºåç«¯ï¼ŒBaaS çš„ä¼˜åŠ¿åœ¨äºâ€œå¿«é€Ÿå¯åŠ¨ã€æŒç»­çœå¿ƒâ€ã€‚ADB Supabase æä¾›æ‰˜ç®¡æ•°æ®åº“ã€è®¤è¯ã€æƒé™æ§åˆ¶ä¸å¯¹å¤– API èƒ½åŠ›ï¼Œé¡¹ç›®ä» 0 åˆ°å¯ç”¨çš„å¯åŠ¨æˆæœ¬æ›´ä½ï¼›ä¸Šçº¿åä¹Ÿæ— éœ€æŠ•å…¥ç²¾åŠ›åœ¨æœåŠ¡å™¨éƒ¨ç½²ã€æ‰©ç¼©å®¹ã€è¯ä¹¦ã€ç½‘å…³ä¸æ—¥å¸¸è¿ç»´ä¸Šã€‚</p>
<p>å¯¹ç§»åŠ¨ App å°¤å…¶å…³é”®ï¼šå¼€å‘è€…å¯ä»¥æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å®¢æˆ·ç«¯ä½“éªŒä¸æ ¸å¿ƒä¸šåŠ¡é—­ç¯ï¼Œé€šè¿‡ HTTPS ç›´è¿äº‘ç«¯èƒ½åŠ›å®Œæˆæ•°æ®è¯»å†™ä¸æƒé™æ§åˆ¶ï¼Œè€Œä¸æ˜¯è¢«åç«¯åŸºç¡€è®¾æ–½ç‰µåˆ¶å¼€å‘èŠ‚å¥ã€‚</p>
<p>æ¬¢è¿é’‰é’‰æœç´¢ç¾¤å·ï¼šâ€œ101930027031â€œï¼ŒåŠ å…¥é’‰ç¾¤è·å–å®Œæ•´æºç èµ„æ–™ã€‚</p>
<p>äº†è§£æ›´å¤šå…³äº<strong>ADB Supabase</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fanalyticdb%2Fanalyticdb-for-postgresql%2Fuser-guide%2Fsupabase%2F" target="_blank" title="https://help.aliyun.com/zh/analyticdb/analyticdb-for-postgresql/user-guide/supabase/" ref="nofollow noopener noreferrer">help.aliyun.com/zh/analyticâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[meterSphereäºŒå¼€é‡åˆ°çš„é—®é¢˜]]></title>    <link>https://juejin.cn/post/7595142737513988123</link>    <guid>https://juejin.cn/post/7595142737513988123</guid>    <pubDate>2026-01-15T04:01:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142737513988123" data-draft-id="7595164177255710746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="meterSphereäºŒå¼€é‡åˆ°çš„é—®é¢˜"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-15T04:01:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœˆå…¥2kæ²¡é’±åƒé¥­æ²¡å¾—æœ‹å‹è¿˜è¢«è¿«åŠ ç­"/> <meta itemprop="url" content="https://juejin.cn/user/2151090609460685"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            meterSphereäºŒå¼€é‡åˆ°çš„é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2151090609460685/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœˆå…¥2kæ²¡é’±åƒé¥­æ²¡å¾—æœ‹å‹è¿˜è¢«è¿«åŠ ç­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T04:01:55.000Z" title="Thu Jan 15 2026 04:01:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmetersphere.io%2Fdocs%2Fv3.x%2Fdev_manual%2Fdev_manual%2F%2322" target="_blank" title="https://metersphere.io/docs/v3.x/dev_manual/dev_manual/#22" ref="nofollow noopener noreferrer">metersphere.io/docs/v3.x/dâ€¦</a></p>
<h2 data-id="heading-0">1. å‰ç«¯æ— æ³•å¯åŠ¨ï¼ŒæŠ¥æ ·å¼é”™è¯¯</h2>
<p>åŒ…ç‰ˆæœ¬ï¼š<code>"less": "^4.2.2"</code> â†’ <code>"less": "4.2.2"</code></p>
<p>ä½¿ç”¨pomä¸­é…ç½®çš„nodeã€npmç‰ˆæœ¬</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">node.version</span>&gt;</span>v20.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">node.version</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">pnpm.version</span>&gt;</span>8.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">pnpm.version</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">2. å‰ç«¯å¯åŠ¨åç¼ºå°‘å›¾ç‰‡èµ„æº</h2>
<p>æŒ‰å®˜æ–¹æ–‡æ¡£å…ˆæ‰“åŒ…,ç¬¬ä¸‰æ­¥testæŠ¥é”™å¯ä»¥åŠ ä¸Š-DskipTests</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#1 ä¾èµ–æ‰“åŒ… </span>
<span class="hljs-comment"># æ­¤å‘½ä»¤ä¼šå°†parent pom å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œå…¶ä»–å¤–éƒ¨å­å·¥ç¨‹å¯ä»¥è·å¾—æœ€æ–°çš„ &lt;properties&gt;&lt;/properties&gt;</span>
./mvnw install -N

<span class="hljs-comment"># æ­¤å‘½ä»¤ä¼šå°† domain sdk ï¼Œå…¶ä»–å¤–éƒ¨å­å·¥ç¨‹å¯ä»¥è·å¾—æœ€æ–°çš„ jar</span>
./mvnw clean install -DskipTests -DskipAntRunForJenkins --file backend/pom.xml

<span class="hljs-comment">#2 æ•´ä½“æ‰“åŒ…</span>
./mvnw clean package
</code></pre>
<h2 data-id="heading-2">3. å‰ç«¯æ‰“åŒ…æŠ¥é”™ï¼ŒtypescriptæŠ¥é”™</h2>
<p>å»æ‰package.jsonä¸­çš„æ‰“åŒ…å‘½ä»¤ä¸­çš„ <code>vue-tsc --noEmit &amp;&amp;</code></p>
<p>tsconfig.jsonä¸­å…³é—­ä¸¥æ ¼<code>"strict": false, // å…³é—­ä¸¥æ ¼æ¨¡å¼</code></p>
<h2 data-id="heading-3">4. metersphereä¸­æ— æ³•è¿è¡Œæµ‹è¯•ç”¨ä¾‹</h2>
<p>éœ€è¦å¯åŠ¨task_runnerï¼Œå‚è€ƒä¸‹æ–¹å®˜æ–¹æ–‡æ¡£</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmetersphere.io%2Fdocs%2Fv3.x%2Finstallation%2Ftask_runner%2F" target="_blank" title="https://metersphere.io/docs/v3.x/installation/task_runner/" ref="nofollow noopener noreferrer">metersphere.io/docs/v3.x/iâ€¦</a></p>
<h2 data-id="heading-4">5. æµ‹è¯•ç”¨ä¾‹æ˜¾ç¤ºè¿è¡ŒæˆåŠŸï¼Œä½†æ˜¯ä»»åŠ¡ä¸€ç›´æ˜¾ç¤ºæ‰§è¡Œä¸­</h2>
<p>éœ€è¦å¯åŠ¨result_hubï¼Œéœ€è¦ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…ï¼Œé€šè¿‡docker composeå¯åŠ¨</p>
<h2 data-id="heading-5">6. é¦–é¡µæŠ¥é”™</h2>
<pre><code class="hljs language-sql" lang="sql"> Cause: java.sql.SQLException: Expression #<span class="hljs-number">1</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> clause <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">SELECT</span> list, <span class="hljs-keyword">references</span> <span class="hljs-keyword">column</span> <span class="hljs-string">'metersphere.urr.create_time'</span> which <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">SELECT</span> list; this <span class="hljs-keyword">is</span> incompatible <span class="hljs-keyword">with</span> <span class="hljs-keyword">DISTINCT</span>
</code></pre>
<p>ä¿®æ”¹ \opt\metersphere\conf æ•°æ®åº“è¿æ¥é…ç½®</p>
<p>åŠ ä¸Š</p>
<p>&amp;sessionVariables=sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'</p>
<h2 data-id="heading-6">7. æ‰“åŒ…åæ— æ³•ä»dockerfileéƒ¨ç½²</h2>
<ul>
<li>ç¼ºå°‘backend/app/target/dependencyç›®å½•åŠæ–‡ä»¶</li>
</ul>
<p>å‚è€ƒé¡¹ç›® Jenkinsfile æ–‡ä»¶ï¼Œæ‰§è¡Œ cd backend/app/target/dependency &amp;&amp; jar -xf ../*.jar</p>
<ul>
<li>
<p>ç¼ºå°‘ /deployments/run-java.sh æ–‡ä»¶</p>
<p>ä»<a href="https://link.juejin.cn?target=http%3A%2F%2Fregistry.fit2cloud.com%2Fmetersphere" target="_blank" title="http://registry.fit2cloud.com/metersphere" ref="nofollow noopener noreferrer">registry.fit2cloud.com/metersphere</a>/metersphere-ceå®¹å™¨ä¸­æå–</p>
</li>
</ul>
<h2 data-id="heading-7">8. æ— æ³•æ–°å¢ç”¨æˆ·</h2>
<ul>
<li>ä»<a href="https://link.juejin.cn?target=http%3A%2F%2Fregistry.fit2cloud.com%2Fmetersphere" target="_blank" title="http://registry.fit2cloud.com/metersphere" ref="nofollow noopener noreferrer">registry.fit2cloud.com/metersphere</a>/metersphere-ceå®¹å™¨ä¸­æå– xpack.jar åŒ…ï¼Œç„¶åæœ¬åœ°å¼•å…¥</li>
</ul>
<h2 data-id="heading-8">9. å¦‚ä½•æŠŠæœ€æ–°ä»£ç æ›¿æ¢è¿›ç¦»çº¿å®‰è£…åŒ…</h2>
<blockquote>
<p>docker load -i metersphere-ce-offline-installer-v3.6.7-lts\metersphere-ce-offline-installer-v3.6.7-lts\images\metersphere.tar</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°taråŒ…å«ä¸‹é¢çš„é•œåƒ</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>æŸ¥çœ‹docker-composeæ–‡ä»¶å¯ä»¥å‘ç°ï¼Œresult_hubã€task_runneråŠ metersphere éƒ½æ˜¯ç”¨çš„åŒä¸ªé•œåƒï¼Œå³ <a href="https://link.juejin.cn?target=http%3A%2F%2Fregistry.fit2cloud.com%2Fmetersphere" target="_blank" title="http://registry.fit2cloud.com/metersphere" ref="nofollow noopener noreferrer">registry.fit2cloud.com/metersphere</a>/metersphere-ce:v3.6.7-lts</p>
<p>æ‰€ä»¥åªéœ€è¦æ›¿æ¢æ‰ metersphere-ce ä¸­äºŒæ¬¡å¼€å‘çš„æœ€æ–°ä»£ç å†æŠŠé•œåƒå¯¼å‡ºå³å¯ï¼Œä½ç½®æ˜¯ /metersphere</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ï¼šExpress + MongoDB æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªåç«¯æœåŠ¡]]></title>    <link>https://juejin.cn/post/7595289498444955674</link>    <guid>https://juejin.cn/post/7595289498444955674</guid>    <pubDate>2026-01-15T04:34:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595289498444955674" data-draft-id="7594854295758405675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ï¼šExpress + MongoDB  æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªåç«¯æœåŠ¡"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T04:34:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="venton"/> <meta itemprop="url" content="https://juejin.cn/user/66443682264973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ï¼šExpress + MongoDB  æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªåç«¯æœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/66443682264973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    venton
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T04:34:46.000Z" title="Thu Jan 15 2026 04:34:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>å¯¹äºå‰ç«¯å¼€å‘è€…è€Œè¨€ï¼Œè‹¥å¸Œæœ›å¿«é€Ÿæ­å»ºä¸€ä¸ªè½»é‡çº§åç«¯æœåŠ¡ï¼ŒExpress é…åˆ MongoDB æ˜¯ä¸€ä¸ªé«˜æ•ˆä¸”æ˜“ä¸Šæ‰‹çš„é€‰æ‹©ã€‚è¯¥æŠ€æœ¯æ ˆç‰¹åˆ«é€‚ç”¨äºå¯¹å¼€å‘æ•ˆç‡è¦æ±‚é«˜ã€ä¸šåŠ¡æ•°æ®ç»“æ„ç›¸å¯¹ç‹¬ç«‹ã€å…³è”æ€§ä¸å¼ºçš„åœºæ™¯ã€‚è‹¥ä½ çš„ä¸šåŠ¡æ¶‰åŠå¤æ‚çš„å…³è”å…³ç³»æˆ–é«˜äº‹åŠ¡ä¸€è‡´æ€§è¦æ±‚ï¼Œå»ºè®®è€ƒè™‘ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰æˆ–æ›´å…¨é¢çš„åç«¯æ¡†æ¶ï¼Œä»¥é¿å…åæœŸç»´æŠ¤ä¸Šçš„å›°éš¾ã€‚</p>
<p>æˆ‘å°†ä»¥ä¸€ä¸ªâ€œè´¦å•ç®¡ç†ç³»ç»Ÿâ€ä¸ºä¾‹ï¼Œå¸¦ä½ ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªå…·å¤‡ç”¨æˆ·è®¤è¯ã€æ•°æ®å¢åˆ æ”¹æŸ¥ç­‰å¸¸è§åŠŸèƒ½çš„ API æœåŠ¡ã€‚æ— è®ºä½ æ˜¯æƒ³å­¦ä¹ åç«¯å¼€å‘ï¼Œè¿˜æ˜¯éœ€è¦ä¸ºè‡ªå·±å‰ç«¯é¡¹ç›®æä¾›æ¥å£æ”¯æŒï¼Œæœ¬æ–‡éƒ½å°†ä¸ºä½ æä¾›æ¸…æ™°çš„å®ç°è·¯å¾„ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€é¡¹ç›®åˆ›å»º</h3>
<p>å®‰è£…express-generatorå·¥å…·åˆ›å»ºExpressé¡¹ç›®éª¨æ¶ï¼Œ</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">express-generator</span> <span class="hljs-selector-tag">-g</span>
<span class="hljs-comment">//ä½¿ç”¨è¯¥å·¥å…·å¿«é€Ÿæ­å»ºé¡¹ç›®ç»“æ„å’ŒåŸºç¡€ä»£ç ã€‚</span>
<span class="hljs-selector-tag">express</span> <span class="hljs-selector-tag">-e</span> <span class="hljs-selector-tag">projectName</span>  <span class="hljs-comment">//-e:æ·»åŠ ejsé¡µé¢æ¨¡æ¿æ”¯æŒ</span>
<span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">install</span> <span class="hljs-comment">//å®‰è£…ä¾èµ–</span>

</code></pre>
<p>æˆ‘ä»¬å°†åœ¨ç”Ÿæˆçš„åŸºç¡€ä¸Šï¼Œè°ƒæ•´ä¸ºä¸€ä¸ªæ›´æ¸…æ™°çš„æœåŠ¡ç«¯ API é¡¹ç›®ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">accounts/
â”œâ”€â”€ app.js              <span class="hljs-comment"># åº”ç”¨å…¥å£</span>
â”œâ”€â”€ bin/www             <span class="hljs-comment"># æœåŠ¡å¯åŠ¨è„šæœ¬</span>
â”œâ”€â”€ config/config.js    <span class="hljs-comment"># é…ç½®æ–‡ä»¶ï¼ˆæ•°æ®åº“ã€JWT å¯†é’¥ç­‰ï¼‰</span>
â”œâ”€â”€ db/db.js            <span class="hljs-comment"># æ•°æ®åº“è¿æ¥</span>
â”œâ”€â”€ models/             <span class="hljs-comment"># æ•°æ®æ¨¡å‹</span>
â”‚   â”œâ”€â”€ AccountModel.js
â”‚   â””â”€â”€ UserModel.js
â”œâ”€â”€ middlewares/        <span class="hljs-comment"># ä¸­é—´ä»¶</span>
â”‚   â””â”€â”€ checkTokenMiddleware.js
â”œâ”€â”€ routes/             <span class="hljs-comment"># è·¯ç”±</span>
â”‚   â”œâ”€â”€ api/            <span class="hljs-comment"># API æ¥å£</span>
â””â”€â”€ public/             <span class="hljs-comment"># é™æ€èµ„æº</span>
</code></pre>
<h2 data-id="heading-2">äºŒã€è·¯ç”±è®¾è®¡</h2>
<h3 data-id="heading-3">2.1 è·¯ç”±æ¨¡å—åŒ–</h3>
<p>è¿™é‡Œå®šä¹‰çš„è·¯ç”±å°±æ˜¯å‰ç«¯è¯·æ±‚çš„æ¥å£ï¼Œä½ è‚¯å®šå†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚Express ä½¿ç”¨ <code>express.Router()</code> å®ç°è·¯ç”±æ¨¡å—åŒ–ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// routes/api/accounts.js</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();

router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/account/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> { id } = req.<span class="hljs-property">params</span>;  <span class="hljs-comment">// è·å–è·¯ç”±å‚æ•°</span>
  <span class="hljs-comment">/* ... */</span> 
});

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/account'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) { <span class="hljs-comment">/* ... */</span> });

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>åœ¨å…¥å£æ–‡ä»¶ä¸­æŒ‚è½½è·¯ç”±ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">var</span> accountRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/api/accounts'</span>);
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api'</span>, accountRouter);  <span class="hljs-comment">// å‰ç¼€ /api</span>
</code></pre>
<h3 data-id="heading-4">2.2 RESTful API è®¾è®¡</h3>
<p>æœ¬é¡¹ç›®çš„ API éµå¾ª RESTful è§„èŒƒï¼š</p>



































<table><thead><tr><th>æ–¹æ³•</th><th>è·¯å¾„</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>GET</td><td>/api/account</td><td>è·å–è´¦å•åˆ—è¡¨</td></tr><tr><td>POST</td><td>/api/account</td><td>åˆ›å»ºè´¦å•</td></tr><tr><td>GET</td><td>/api/account/:id</td><td>è·å–å•ä¸ªè´¦å•</td></tr><tr><td>PATCH</td><td>/api/account/:id</td><td>æ›´æ–°è´¦å•</td></tr><tr><td>DELETE</td><td>/api/account/:id</td><td>åˆ é™¤è´¦å•</td></tr></tbody></table>
<h2 data-id="heading-5">ä¸‰ã€é¡¹ç›®ä¸­çš„ä¸­é—´ä»¶</h2>
<p>æ€ä¹ˆç†è§£ Expressä¸­çš„ä¸­é—´ä»¶ï¼Œä½ è¿˜è®°å¾—vueä¸­çš„æ’ä»¶å—ï¼Ÿ</p>
<p><strong>æˆ‘è§‰å¾—å¯ä»¥å°† Express ä¸­é—´ä»¶çœ‹ä½œæ˜¯ Vue æ’ä»¶çš„"æœåŠ¡å™¨ç«¯ç‰ˆæœ¬"ï¼š</strong></p>
<ul>
<li>éƒ½éµå¾ªÂ  <strong>"å•ä¸€èŒè´£åŸåˆ™"</strong> Â - æ¯ä¸ªä¸­é—´ä»¶/æ’ä»¶åªåšä¸€ä»¶äº‹</li>
<li>éƒ½é€šè¿‡Â  <strong>"æ³¨å…¥"æ–¹å¼</strong>Â å¢å¼ºæ ¸å¿ƒæ¡†æ¶</li>
<li>éƒ½æœ‰Â  <strong>"ç”Ÿå‘½å‘¨æœŸ"</strong> Â æ¦‚å¿µï¼ˆä¸­é—´ä»¶çš„ next() vs æ’ä»¶çš„ installï¼‰</li>
<li>éƒ½æ”¯æŒÂ  <strong>"é“¾å¼ç»„åˆ"</strong> ï¼ˆä¸­é—´ä»¶é“¾ vs æ’ä»¶ç»„åˆï¼‰</li>
</ul>
<p>ä¸è¿‡è®°ä½ï¼ŒExpress ä¸­é—´ä»¶æ›´ä¾§é‡äº<strong>è¯·æ±‚å¤„ç†</strong>ï¼Œè€Œ Vue æ’ä»¶æ›´ä¾§é‡äº<strong>åº”ç”¨æ‰©å±•</strong>ã€‚</p>
<h3 data-id="heading-6">3.1 å…¨å±€ä¸­é—´ä»¶</h3>
<p>æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨å…¥å£app.jsæ–‡ä»¶ä¸­çœ‹åˆ°å¤§é‡ä¸­é—´ä»¶çš„æ³¨å†Œï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">//app.js</span>
<span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-keyword">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">require</span>(<span class="hljs-string">'morgan'</span>);
<span class="hljs-comment">//å¯¼å…¥è·¯ç”±</span>
<span class="hljs-keyword">var</span> accountRouter = <span class="hljs-keyword">require</span>(<span class="hljs-string">'./routes/api/accounts'</span>);
<span class="hljs-keyword">var</span> authApiRouter = <span class="hljs-keyword">require</span>(<span class="hljs-string">'./routes/api/auth'</span>);

<span class="hljs-comment">//å¯¼å…¥æœåŠ¡é…ç½®</span>
<span class="hljs-keyword">const</span> {DBHOST, DBPORT, DBNAME} = <span class="hljs-keyword">require</span>(<span class="hljs-string">'./config/config'</span>);

<span class="hljs-keyword">var</span> app = <span class="hljs-title function_ invoke__">express</span>();

<span class="hljs-comment">// view engine setup</span>
app.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">'views'</span>, path.<span class="hljs-title function_ invoke__">join</span>(__dirname, <span class="hljs-string">'views'</span>));
app.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>);

app.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">logger</span>(<span class="hljs-string">'dev'</span>));
<span class="hljs-comment">// è§£æ JSON è¯·æ±‚ä½“</span>
app.<span class="hljs-keyword">use</span>(express.<span class="hljs-title function_ invoke__">json</span>());
<span class="hljs-comment">// è§£æ URL ç¼–ç çš„è¯·æ±‚ä½“</span>
app.<span class="hljs-keyword">use</span>(express.<span class="hljs-title function_ invoke__">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> }));
<span class="hljs-comment">// æ‰˜ç®¡é™æ€èµ„æº</span>
app.<span class="hljs-keyword">use</span>(express.<span class="hljs-built_in">static</span>(path.<span class="hljs-title function_ invoke__">join</span>(__dirname, <span class="hljs-string">'public'</span>)));

app.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/api'</span>, accountRouter);
app.<span class="hljs-keyword">use</span>(<span class="hljs-string">'/api'</span>, authApiRouter);

<span class="hljs-comment">//é”™è¯¯å¤„ç†</span>
app.<span class="hljs-keyword">use</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
  res.<span class="hljs-title function_ invoke__">render</span>(<span class="hljs-string">'404'</span>);
});

<span class="hljs-comment">//é”™è¯¯å¤„ç†</span>
app.<span class="hljs-keyword">use</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) </span>{
  <span class="hljs-comment">// set locals, only providing error in development</span>
  res.locals.message = err.message;
  res.locals.error = req.app.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'env'</span>) === <span class="hljs-string">'development'</span> ? err : {};

  <span class="hljs-comment">// render the error page</span>
  res.<span class="hljs-title function_ invoke__">status</span>(err.status || <span class="hljs-number">500</span>);
  res.<span class="hljs-title function_ invoke__">render</span>(<span class="hljs-string">'error'</span>);
});

module.exports = app;

</code></pre>
<h3 data-id="heading-7">3.2 åº”ç”¨ä¸­é—´ä»¶åˆ°è·¯ç”±</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºç‰¹å®šè·¯ç”±æ·»åŠ ä¸­é—´ä»¶ï¼Œå®ç°å…¨å±€è·¯ç”±é‰´æƒï¼ˆæ˜¯ä¸æ˜¯å°±è·Ÿvueä¸­çš„è·¯ç”±å®ˆå«å·®ä¸å¤šäº†ï¼ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//routes/api/account.js</span>
<span class="hljs-keyword">let</span> checkTokenMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../middlewares/checkTokenMiddleware'</span>);

<span class="hljs-comment">// æ‰€æœ‰ /account ç›¸å…³è·¯ç”±éƒ½éœ€è¦ token éªŒè¯</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/account'</span>, checkTokenMiddleware, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-comment">// ...</span>
});

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/account'</span>, checkTokenMiddleware, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<p>è¿™é‡Œçš„ä¸­é—´ä»¶å‡½æ•°checkTokenMiddlewareå…·ä½“çš„ä½œç”¨æˆ‘ä»¬åœ¨åé¢ç”¨æˆ·é‰´æƒè¯¦ç»†è®²è§£ã€‚</p>
<h3 data-id="heading-8">å››ã€æ•°æ®åº“MongoDBå®‰è£…</h3>
<p>è®¿é—®mongodbå®˜æ–¹åœ°å€ä¸‹è½½MongoDB Community Server</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Ftry%2Fdownload%2Fcommunity" target="_blank" title="https://www.mongodb.com/try/download/community" ref="nofollow noopener noreferrer">www.mongodb.com/try/downloaâ€¦</a></p>
<p>é€‰æ‹©ç›¸åº”é…ç½®è¿›è¡Œä¸‹è½½</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/351784e550fd4a919a0533116f8e68b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769056486&amp;x-signature=DkdxpKQbjUeIWGJrq1tfWHSDLyQ%3D" alt="image.png" loading="lazy"/></p>
<p>é…ç½®æ­¥éª¤å¦‚ä¸‹:</p>
<ul>
<li>å°†å‹ç¼©åŒ…ç§»åŠ¨åˆ° C:\Program Files ä¸‹ï¼Œç„¶åè§£å‹</li>
<li>åˆ›å»º C:\data\db ç›®å½•ï¼Œmongodb ä¼šå°†æ•°æ®é»˜è®¤ä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹</li>
<li>ä»¥ mongodb ä¸­ bin ç›®å½•ä½œä¸ºå·¥ä½œç›®å½•ï¼Œå¯åŠ¨å‘½ä»¤è¡Œ</li>
<li>è¿è¡Œå‘½ä»¤ mongod</li>
</ul>
<p>å‘½ä»¤è¡Œçª—å£çœ‹åˆ°ä»¥ä¸‹æ•ˆæœåˆ™ä»£è¡¨MongoDBçš„æœåŠ¡å¯åŠ¨æˆåŠŸäº†ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨é¡¹ç›®ä¸­å°†apiå’Œæ•°æ®åº“ç›¸ç»“åˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c57c34d4c6b949a18c3246b44b374c61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769056486&amp;x-signature=cG7LPhOsxUeHI4yZx9%2FhuQ2Xk9E%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">äº”ã€æ•°æ®åº“é›†æˆ</h2>
<blockquote>
<p>npm i mongoose</p>
</blockquote>
<h3 data-id="heading-10">5.1 MongoDB è¿æ¥å°è£…</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// db/db.js</span>
<span class="hljs-comment">//å‚æ•°successæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">success, error</span>) {
  <span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
  <span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">DBHOST</span>, <span class="hljs-variable constant_">DBPORT</span>, <span class="hljs-variable constant_">DBNAME</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/config.js'</span>);

  mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">'strictQuery'</span>, <span class="hljs-literal">true</span>);
  mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">`mongodb://<span class="hljs-subst">${DBHOST}</span>:<span class="hljs-subst">${DBPORT}</span>/<span class="hljs-subst">${DBNAME}</span>`</span>);

  mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">success</span>();
  });

  mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">error</span>();
  });
};
</code></pre>
<p>å°†æœåŠ¡å™¨å¯åŠ¨è„šæœ¬ä½œä¸ºå›è°ƒå‡½æ•°ä¼ å…¥åˆ°dbå°è£…å‡½æ•°ä¸­</p>
<pre><code class="hljs language-ini" lang="ini">```javascript
// bin/wwww
const <span class="hljs-attr">db</span> = require(<span class="hljs-string">'../db/db'</span>)

db(() =&gt; {
  var <span class="hljs-attr">app</span> = require(<span class="hljs-string">'../app'</span>)<span class="hljs-comment">;</span>
  var <span class="hljs-attr">http</span> = require(<span class="hljs-string">'http'</span>)<span class="hljs-comment">;</span>
  //å¯åŠ¨æœåŠ¡ï¼Œç›‘å¬ç«¯å£
  var <span class="hljs-attr">port</span> = normalizePort(process.env.PORT || <span class="hljs-string">'80'</span>)<span class="hljs-comment">;</span>
  app.set('port', port)<span class="hljs-comment">;</span>
  var <span class="hljs-attr">server</span> = http.createServer(app)<span class="hljs-comment">;</span>
  server.listen(port)<span class="hljs-comment">;</span>
  //...
  }
)
 

</code></pre>
<p>é€šè¿‡ä¸Šé¢çš„æ“ä½œæˆ‘ä»¬å€ŸåŠ©mongooseå®Œæˆäº†å¯¹æ•°æ®åº“çš„è¿æ¥</p>
<h3 data-id="heading-11">5.2 Mongoose æ¨¡å‹å®šä¹‰</h3>
<p>/accountè¿™ä¸ªapiæ¨¡å—æ¶‰åŠçš„å­—æ®µã€ç±»å‹æ ¡éªŒå®šä¹‰æˆä¸€ä¸ªæ¨¡å‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// models/AccountModel.js</span>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">let</span> <span class="hljs-title class_">AccountSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">title</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>,
  <span class="hljs-attr">type</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: -<span class="hljs-number">1</span>  <span class="hljs-comment">// -1 æ”¯å‡ºï¼Œ1 æ”¶å…¥</span>
  },
  <span class="hljs-attr">account</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">remarks</span>: <span class="hljs-title class_">String</span>
});

<span class="hljs-keyword">let</span> <span class="hljs-title class_">AccountModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'accounts'</span>, <span class="hljs-title class_">AccountSchema</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">AccountModel</span>;
</code></pre>
<p>ç»“åˆæ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬æœ€åæ¥å®Œå–„apiæ¥å£è·Ÿæ•°æ®åº“çš„äº¤äº’</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//routes/api/account.js</span>
<span class="hljs-comment">//å¯¼å…¥ express</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);

<span class="hljs-comment">//å¯¼å…¥ä¸­é—´ä»¶</span>
<span class="hljs-keyword">let</span> checkTokenMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../middlewares/checkTokenMiddleware'</span>);

<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();
<span class="hljs-comment">//å¯¼å…¥ moment</span>
<span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AccountModel</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../models/AccountModel'</span>);

<span class="hljs-comment">//è®°è´¦æœ¬çš„åˆ—è¡¨</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/account'</span>, checkTokenMiddleware, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-comment">//è¯»å–é›†åˆä¿¡æ¯</span>
  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">sort</span>({ <span class="hljs-attr">time</span>: -<span class="hljs-number">1</span> }).<span class="hljs-title function_">exec</span>(<span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'1001'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'è¯»å–å¤±è´¥~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">//å“åº”æˆåŠŸçš„æç¤º</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-comment">//å“åº”ç¼–å·</span>
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-comment">//å“åº”çš„ä¿¡æ¯</span>
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'è¯»å–æˆåŠŸ'</span>,
      <span class="hljs-comment">//å“åº”çš„æ•°æ®</span>
      <span class="hljs-attr">data</span>: data
    });
  })
});

<span class="hljs-comment">//æ–°å¢è®°å½•</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/account'</span>, checkTokenMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//è¡¨å•éªŒè¯</span>

  <span class="hljs-comment">//æ’å…¥æ•°æ®åº“</span>
  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">create</span>({
    ...req.<span class="hljs-property">body</span>,
    <span class="hljs-comment">//ä¿®æ”¹ time å±æ€§çš„å€¼</span>
    <span class="hljs-attr">time</span>: <span class="hljs-title function_">moment</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">time</span>).<span class="hljs-title function_">toDate</span>()
  }, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'1002'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'åˆ›å»ºå¤±è´¥~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">//æˆåŠŸæé†’</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'åˆ›å»ºæˆåŠŸ'</span>,
      <span class="hljs-attr">data</span>: data
    })
  })
});

<span class="hljs-comment">//åˆ é™¤è®°å½•</span>
router.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'/account/:id'</span>, checkTokenMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//è·å– params çš„ id å‚æ•°</span>
  <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  <span class="hljs-comment">//åˆ é™¤</span>
  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">_id</span>: id }, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'1003'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'åˆ é™¤è´¦å•å¤±è´¥'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">//æé†’</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'åˆ é™¤æˆåŠŸ'</span>,
      <span class="hljs-attr">data</span>: {}
    })
  })
});

<span class="hljs-comment">//è·å–å•ä¸ªè´¦å•ä¿¡æ¯</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/account/:id'</span>, checkTokenMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//è·å– id å‚æ•°</span>
  <span class="hljs-keyword">let</span> { id } = req.<span class="hljs-property">params</span>;
  <span class="hljs-comment">//æŸ¥è¯¢æ•°æ®åº“</span>
  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'1004'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'è¯»å–å¤±è´¥~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
    }
    <span class="hljs-comment">//æˆåŠŸå“åº”</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'è¯»å–æˆåŠŸ'</span>,
      <span class="hljs-attr">data</span>: data
    })
  })
});

<span class="hljs-comment">//æ›´æ–°å•ä¸ªè´¦å•ä¿¡æ¯</span>
router.<span class="hljs-title function_">patch</span>(<span class="hljs-string">'/account/:id'</span>, checkTokenMiddleware, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//è·å– id å‚æ•°å€¼</span>
  <span class="hljs-keyword">let</span> { id } = req.<span class="hljs-property">params</span>;
  <span class="hljs-comment">//æ›´æ–°æ•°æ®åº“</span>
  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">_id</span>: id }, req.<span class="hljs-property">body</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'1005'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'æ›´æ–°å¤±è´¥~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
    }
    <span class="hljs-comment">//å†æ¬¡æŸ¥è¯¢æ•°æ®åº“ è·å–å•æ¡æ•°æ®</span>
    <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">code</span>: <span class="hljs-string">'1004'</span>,
          <span class="hljs-attr">msg</span>: <span class="hljs-string">'è¯»å–å¤±è´¥~~'</span>,
          <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
        })
      }
      <span class="hljs-comment">//æˆåŠŸå“åº”</span>
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'æ›´æ–°æˆåŠŸ'</span>,
        <span class="hljs-attr">data</span>: data
      })
    })

  });
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>åˆ°äº†è¿™ä¸€æ­¥æˆ‘ä»¬å°±çœŸæ­£å®Œæˆäº†ä¸€ä¸ªæ¨¡å—çš„æ¥å£å¼€å‘ï¼Œä½ å°±ä¸å†åªæ˜¯ä¸€ä¸ªå•çº¯çš„å‰ç«¯å¼€å‘è€…äº†ï¼Œå³ä½¿åé¢é“é˜»ä¸”é•¿ï¼</p>
<h2 data-id="heading-12">å…­ã€ç”¨æˆ·è®¤è¯</h2>
<h3 data-id="heading-13">6.1 ç™»å½•åŠŸèƒ½çš„å®ç°ï¼ˆåŸºäº JWTï¼‰</h3>
<blockquote>
<p>npm i jsonwebtoken</p>
</blockquote>
<p>å®šä¹‰userç”¨æˆ·æ¨¡å‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//å¯¼å…¥ mongoose</span>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-comment">//åˆ›å»ºæ–‡æ¡£çš„ç»“æ„å¯¹è±¡</span>
<span class="hljs-comment">//è®¾ç½®é›†åˆä¸­æ–‡æ¡£çš„å±æ€§ä»¥åŠå±æ€§å€¼çš„ç±»å‹</span>
<span class="hljs-keyword">let</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-comment">//æ ‡é¢˜</span>
  <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-title class_">String</span>
});

<span class="hljs-comment">//åˆ›å»ºæ¨¡å‹å¯¹è±¡  å¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡</span>
<span class="hljs-keyword">let</span> <span class="hljs-title class_">UserModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'users'</span>, <span class="hljs-title class_">UserSchema</span>);

<span class="hljs-comment">//æš´éœ²æ¨¡å‹å¯¹è±¡</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">UserModel</span>;

</code></pre>
<p>å®ç°ç™»å½•æ¥å£ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ç­¾å‘ä¸€ä¸ª JWT Token è¿”å›ç»™å®¢æˆ·ç«¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//routes/api/auth.js</span>
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();
<span class="hljs-comment">//å¯¼å…¥ jwt</span>
<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonwebtoken'</span>);
<span class="hljs-comment">//å¯¼å…¥é…ç½®æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> { secret } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../config/config'</span>)
<span class="hljs-comment">//å¯¼å…¥ ç”¨æˆ·çš„æ¨¡å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModel</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../models/UserModel'</span>);
<span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'md5'</span>);

<span class="hljs-comment">//ç™»å½•æ“ä½œ</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//è·å–ç”¨æˆ·åå’Œå¯†ç </span>
  <span class="hljs-keyword">let</span> { username, password } = req.<span class="hljs-property">body</span>;

  <span class="hljs-comment">//æŸ¥è¯¢æ•°æ®åº“</span>
  <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">username</span>: username, <span class="hljs-attr">password</span>: <span class="hljs-title function_">md5</span>(password) }, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-comment">//åˆ¤æ–­</span>
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'2001'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'æ•°æ®åº“è¯»å–å¤±è´¥~~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">//åˆ¤æ–­ data</span>
    <span class="hljs-keyword">if</span> (!data) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'2002'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯~~~'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      })
    }

    <span class="hljs-comment">//åˆ›å»ºå½“å‰ç”¨æˆ·çš„ token</span>
    <span class="hljs-keyword">let</span> token = jwt.<span class="hljs-title function_">sign</span>({
      <span class="hljs-attr">username</span>: data.<span class="hljs-property">username</span>,
      <span class="hljs-attr">_id</span>: data.<span class="hljs-property">_id</span>
    }, secret, {
      <span class="hljs-attr">expiresIn</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>
    });

    <span class="hljs-comment">//å“åº” token</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'ç™»å½•æˆåŠŸ'</span>,
      <span class="hljs-attr">data</span>: token
    })

  })

});

<span class="hljs-comment">//é€€å‡ºç™»å½•</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/logout'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//é”€æ¯ session</span>
  req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-function">() =&gt;</span> {
    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">'success'</span>, { <span class="hljs-attr">msg</span>: <span class="hljs-string">'é€€å‡ºæˆåŠŸ'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'/login'</span> });
  })
});

<span class="hljs-comment">//æ³¨å†Œç”¨æˆ·</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/reg'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">//åšè¡¨å•éªŒè¯</span>
  <span class="hljs-comment">//è·å–è¯·æ±‚ä½“çš„æ•°æ®</span>
  <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">create</span>({ ...req.<span class="hljs-property">body</span>, <span class="hljs-attr">password</span>: <span class="hljs-title function_">md5</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>) }, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'æ³¨å†Œå¤±è´¥, è¯·ç¨åå†è¯•~~'</span>);
      <span class="hljs-keyword">return</span>
    }
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'0000'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'æ³¨å†ŒæˆåŠŸ'</span>,
    })
  })
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;

</code></pre>
<p>å®¢æˆ·ç«¯å°†tokenå­˜æ”¾åœ¨æ¥å£çš„è¯·æ±‚å¤´ä¸­ä¼ é€’ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å®šä¹‰tokenæ ¡éªŒä¸­é—´ä»¶ï¼Œè·¯ç”±è°ƒç”¨è¯¥ä¸­é—´ä»¶ä»è€Œå®ç°åç»­ä¸šåŠ¡æ¥å£çš„ç™»å½•è®¤è¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// middlewares/checkTokenMiddleware.js</span>
<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonwebtoken'</span>);
<span class="hljs-keyword">const</span> { secret } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/config'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// ä»è¯·æ±‚å¤´è·å– token</span>
  <span class="hljs-keyword">let</span> token = req.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);

  <span class="hljs-keyword">if</span> (!token) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-string">'2003'</span>,
      <span class="hljs-attr">msg</span>: <span class="hljs-string">'token ç¼ºå¤±'</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
    });
  }

  <span class="hljs-comment">// æ ¡éªŒ token</span>
  jwt.<span class="hljs-title function_">verify</span>(token, secret, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-string">'2004'</span>,
        <span class="hljs-attr">msg</span>: <span class="hljs-string">'token æ ¡éªŒå¤±è´¥'</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
      });
    }
    <span class="hljs-comment">// ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¯¹è±¡</span>
    req.<span class="hljs-property">user</span> = data;
    <span class="hljs-comment">//æ”¾è¡Œ</span>
    <span class="hljs-title function_">next</span>();
  });
};
</code></pre>
<p>åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬çš„åå°æœåŠ¡å°±å½¢æˆäº†å®Œæˆçš„é—­ç¯ã€‚</p>
<h2 data-id="heading-14">ä¸ƒã€æœåŠ¡å¯åŠ¨</h2>
<blockquote>
<p>npm i nodemon</p>
</blockquote>
<h3 data-id="heading-15">ä½¿ç”¨ Nodemon çƒ­é‡è½½</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nodemon ./bin/www"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>npm start</p>
</blockquote>
<h2 data-id="heading-16">å…«ã€æ¥å£åŠŸèƒ½éªŒè¯</h2>
<p>æˆ‘ä»¬é€šè¿‡æ¥å£ç®¡ç†å·¥å…·apifoxæ¥éªŒè¯ä¸‹</p>
<p>å…ˆè°ƒæ³¨å†Œæ¥å£</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee7b6b08f6db459fa5032ae3572b01d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769056486&amp;x-signature=PKvNcveUHXzlGiUiLyvqUYuTS14%3D" alt="image.png" loading="lazy"/>
ç™»å½•æ¥å£</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c546871102b457daf24f28fa7abe180~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769056486&amp;x-signature=IlrPuIJ08XIfLEq6m0651WYlVpE%3D" alt="image.png" loading="lazy"/>
è¯·æ±‚ä¸šåŠ¡æ¥å£</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5116f12428fb40d49a60e37ed91468d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769056486&amp;x-signature=zXlob802FuXzneGDga7o3WvPk%2BA%3D" alt="image.png" loading="lazy"/></p>
<p>åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬å°±å¤§åŠŸå‘Šæˆäº†ã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®åº”è¯¥å¯ä»¥è®©ä½ ç†è§£åç«¯å¼€å‘çš„åŸºæœ¬æµç¨‹ï¼ŒåŒæ—¶ä¹Ÿä¸ºå‰ç«¯é¡¹ç›®æä¾›äº†å¯æ‰©å±•çš„ API æ”¯æŒï¼Œåç«¯å­¦ä¹ åŠè½¯ä»¶å¼€å‘çš„å­¦ä¹ çš„è·¯æ²¡æœ‰ç»ˆç‚¹ï¼Œå½“ç„¶æˆ‘ä»¬æ¢ç´¢çš„è„šæ­¥ä¹Ÿä¸ä¼šåœä¸‹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç©¿æ­å¼çš„è®¾è®¡æ¨¡å¼-è£…é¥°è€…]]></title>    <link>https://juejin.cn/post/7595115707161755689</link>    <guid>https://juejin.cn/post/7595115707161755689</guid>    <pubDate>2026-01-15T05:17:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595115707161755689" data-draft-id="7595061185424130054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç©¿æ­å¼çš„è®¾è®¡æ¨¡å¼-è£…é¥°è€…"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T05:17:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜å¤©æœ‰ä¸“ä¸šè¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/860253654882618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç©¿æ­å¼çš„è®¾è®¡æ¨¡å¼-è£…é¥°è€…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/860253654882618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜å¤©æœ‰ä¸“ä¸šè¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:17:39.000Z" title="Thu Jan 15 2026 05:17:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è£…é¥°è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ï¼Œæ˜¯åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åŒ…è£…çš„æ–¹å¼åŠ¨æ€çš„ä¸ºå¯¹è±¡æ·»åŠ é¢å¤–èŒè´£ã€‚</p>
<h6 data-id="heading-0">ä»£ç å®ç°</h6>
<p>ä¸¾ä¸ªä¾‹å­, å¦‚æœè¦ç”Ÿæˆä¸åŒè®¢å•çš„ä»·æ ¼ï¼Œæœ‰çš„è®¢å•åªæœ‰åŸºç¡€ä»·ï¼Œæœ‰çš„è®¢å•æ˜¯åŸºç¡€è®¢å•+è¿è´¹ï¼Œ è¿˜æœ‰è®¢å•æ˜¯åŸºç¡€ä»·+ä¼˜æƒ ä»·+è¿è´¹ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼ˆç»§æ‰¿çš„æ–¹å¼ï¼‰ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">/**
 * è®¢å•ä»·æ ¼
 * åŸºç¡€ä»·ï¼šå•†å“æœ¬èº«çš„æ€»ä»·ï¼›
 * å¯é€‰æ‰©å±•ï¼šä¼˜æƒ åˆ¸æŠµæ‰£ã€è¿è´¹ã€æ»¡å‡ä¼˜æƒ ã€ä¼šå‘˜æŠ˜æ‰£ã€ç¨è´¹ç­‰ï¼›
 * ä¸åŒè®¢å•çš„æ‰©å±•è§„åˆ™ç»„åˆä¸åŒï¼ˆæ¯”å¦‚ï¼šæ™®é€šè®¢å• = åŸºç¡€ä»· + è¿è´¹ï¼›ä¼˜æƒ è®¢å• = åŸºç¡€ä»· + ä¼˜æƒ åˆ¸ + æ»¡å‡ï¼‰ã€‚
 */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderService</span> </span>{
 Â  Â public static void main(<span class="hljs-type">String</span>[] args) {
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·</span>
 Â  Â  Â  Â <span class="hljs-type">Order</span> order = <span class="hljs-keyword">new</span> <span class="hljs-type">BaseOrder</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€è´¹ç”¨ï¼š"</span>+order.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+è¿è´¹</span>
 Â  Â  Â  Â <span class="hljs-type">Order</span> freight =<span class="hljs-keyword">new</span> <span class="hljs-type">OrderWithFreight</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>),<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">8</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€è´¹ç”¨+è¿è´¹ï¼š"</span>+freight.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+ä¼˜æƒ å·</span>
 Â  Â  Â  Â <span class="hljs-type">Order</span> coupon =<span class="hljs-keyword">new</span> <span class="hljs-type">OrderWithCoupon</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>),<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">2</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€è´¹ç”¨+è¿è´¹+ä¼˜æƒ å·ï¼š"</span>+coupon.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+è¿è´¹+ä¼˜æƒ å·</span>
 Â  Â  Â  Â <span class="hljs-type">Order</span> freightAndCoupon =<span class="hljs-keyword">new</span> <span class="hljs-type">OrderWithFreightAndCoupon</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>),<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">8</span>),<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">2</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€è´¹ç”¨+è¿è´¹+ä¼˜æƒ å·ï¼š"</span>+freightAndCoupon.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+è¿è´¹+æ»¡å‡ï¼ŒåŸºç¡€ä»·+è¿è´¹+æ»¡å‡+ä¼šå‘˜æŠ˜æ‰£ç­‰ç­‰ï¼Œå¤šç§ä¸åŒç»„åˆçš„</span>
 Â   }
}
â€‹
interface <span class="hljs-type">Order</span> {
 Â  Â <span class="hljs-type">BigDecimal</span> calculateTotalPrice();
}
â€‹
<span class="hljs-comment">//åŸºç¡€ä»·</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseOrder</span> <span class="hljs-title">implements</span> <span class="hljs-title">Order</span> </span>{
â€‹
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-type">BigDecimal</span> basePrice; <span class="hljs-comment">// å•†å“åŸºç¡€ä»·</span>
â€‹
 Â  Â public <span class="hljs-type">BaseOrder</span>(<span class="hljs-type">BigDecimal</span> basePrice) {
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.basePrice = basePrice;
 Â   }
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> basePrice;
 Â   }
}
â€‹
<span class="hljs-comment">// åŸºç¡€ä»·+è¿è´¹</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderWithFreight</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseOrder</span> </span>{
â€‹
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> freight; <span class="hljs-comment">// è¿è´¹</span>
â€‹
 Â  Â public <span class="hljs-type">OrderWithFreight</span>(<span class="hljs-type">BigDecimal</span> basePrice, <span class="hljs-type">BigDecimal</span> freight) {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>(basePrice);
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.freight = freight;
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> basePrice.add(freight);
 Â   }
}
â€‹
<span class="hljs-comment">// åŸºç¡€ä»·+ä¼˜æƒ å·</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderWithCoupon</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseOrder</span> </span>{
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> coupon;<span class="hljs-comment">//ä¼˜æƒ å·</span>
â€‹
 Â  Â public <span class="hljs-type">OrderWithCoupon</span>(<span class="hljs-type">BigDecimal</span> basePrice, <span class="hljs-type">BigDecimal</span> coupon) {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>(basePrice);
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.coupon = coupon;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> basePrice.subtract(coupon);
 Â   }
}
â€‹
<span class="hljs-comment">// åŸºç¡€ä»·+è¿è´¹+ä¼˜æƒ å·</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderWithFreightAndCoupon</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseOrder</span> </span>{
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> freight;<span class="hljs-comment">//è¿è´¹</span>
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">BigDecimal</span> coupon;<span class="hljs-comment">//ä¼˜æƒ å·</span>
 Â  Â public <span class="hljs-type">OrderWithFreightAndCoupon</span>(<span class="hljs-type">BigDecimal</span> basePrice, <span class="hljs-type">BigDecimal</span> freight, <span class="hljs-type">BigDecimal</span> coupon) {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>(basePrice);
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.freight = freight;
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.coupon = coupon;
 Â   }
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> basePrice.add(freight).subtract(coupon);
 Â   }
}
</code></pre>
<p>æ­¤æ—¶æ¥äº†æ–°çš„éœ€æ±‚ï¼Œè¦æ·»åŠ æ»¡å‡æŠ˜æ‰£ã€ä¼šå‘˜æŠ˜æ‰£ã€‚é‚£ä¹ˆä¸Šé¢ä»£ç è¦å†åŠ æ»¡å‡æŠ˜æ‰£å’Œä¼šå‘˜æŠ˜æ‰£ç±»ï¼Œå¦‚æœåç»­è¿˜æœ‰æ›´å¤šçš„æŠ˜æ‰£ç­–ç•¥å’Œç»„åˆï¼Œé‚£ä¹ˆè¿™ä¸ªåŠŸèƒ½ç»§æ‰¿çš„ç±»ä¼šå¤šçš„çˆ†ç‚¸ã€‚</p>
<p>æˆ‘ä»¬æƒ³æƒ³ï¼Œåœ¨ä¸ç”¨ç›´æ¥ç»§æ‰¿BaseOrderç±»ï¼Œä¸æ”¹å˜åŸç±»çš„åŸºç¡€ä¸Šæ€ä¹ˆæ·»åŠ æ–°çš„åŠŸèƒ½ï¼ˆæ»¡å‡æŠ˜æ‰£ã€ä¼šå‘˜æŠ˜æ‰£ï¼‰ã€‚éµå¾ªçš„è®¾è®¡åŸåˆ™ï¼š</p>
<blockquote>
<p>ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥æ–°å¢ä¸€ä¸ªDecoratorçš„æŠ½è±¡ç±»ï¼ˆä¸ºä»€ä¹ˆæ˜¯æŠ½è±¡ç±»ï¼Œå› ä¸ºæ˜¯ä¸ºäº†å…·ä½“çš„è£…é¥°å™¨æä¾›é€šç”¨æ¨¡æ¿ï¼Œæœ¬èº«ä¸æä¾›ä»»ä½•çš„è£…é¥°åŠŸèƒ½ï¼Œæ‰€ä»¥å®ä¾‹åŒ–æ²¡æœ‰æ„ä¹‰ï¼‰ï¼Œç„¶åå­ç±»å»å®ç°è¿™ä¸ªDecoratoræŠ½è±¡ç±»ï¼Œä¼˜æƒ å·ã€è¿è´¹ã€æ»¡å‡éƒ½åˆ†åˆ«å®ç°DecoratoræŠ½è±¡ç±»ã€‚è¿™æ˜¯å°†åŸæ¥å­ç±»ç›´æ¥ç»§æ‰¿çš„æ–¹å¼æ”¹ä¸ºç»§æ‰¿Decoratorè£…é¥°è€…ç±»ï¼ˆåŒ…è£…ç±»ï¼‰ï¼Œç”±è¿™ä¸ªåŒ…è£…ç±»çš„å­ç±»ç»™BaseOrderç±»æ·»åŠ èŒè´£ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç”Ÿæˆè®¢å•ä»·æ ¼çš„æ—¶å€™ï¼Œæ ¹æ®éœ€è¦ç»„åˆè¿™äº›ä¼˜æƒ å·ã€è¿è´¹ã€æ»¡å‡ç­‰ç±»ã€‚æ¯”å¦‚è¯´è¦ç”ŸæˆåŸºç¡€ä»·+è¿è´¹+ä¼˜æƒ å·çš„ä»·æ ¼ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”ŸæˆåŸºç¡€ä»·ï¼Œå†ç”Ÿæˆè¿è´¹ä»·æ ¼ï¼Œæœ€ååŒ…è£¹åŸºç¡€ä»·æ ¼ã€‚åœ¨æ­¤åŸºç¡€ä¸Šè¿˜å¯ä»¥å åŠ ä¼˜æƒ å·çš„ä»·æ ¼ï¼Œç”Ÿæˆä¼˜æƒ ä»·æ ¼ï¼Œæœ€ååœ¨è¿è¡Œæ—¶é€šè¿‡åŒ…è£¹çš„æ–¹å¼æ·»åŠ ä»·æ ¼ï¼Œè¿™æ ·ä¸€å±‚å¥—ä¸€å±‚ï¼Œåƒæ˜¯ç©¿è¡£æœä¸€æ ·çš„å†™æ³•å°±æ˜¯è£…é¥°è€…æ¨¡å¼ã€‚å¦‚ä¸‹å›¾ä»£ç æ‰€ç¤ºï¼ˆè£…é¥°è€…æ¨¡å¼ï¼‰ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">/**
 * è®¢å•è£…é¥°è€…
 */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderDecoratorService</span> </span>{
â€‹
 Â  Â public static void main(<span class="hljs-type">String</span>[] args) {
 Â  Â  Â  Â <span class="hljs-type">Order</span> baseOrder = <span class="hljs-keyword">new</span> <span class="hljs-type">BaseOrder</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€ä»·ï¼š"</span> + baseOrder.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+è¿è´¹</span>
 Â  Â  Â  Â baseOrder = <span class="hljs-keyword">new</span> <span class="hljs-type">FreightDecorator</span>(baseOrder,<span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">10</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€ä»·+è¿è´¹ï¼š"</span> + baseOrder.calculateTotalPrice().toString());
 Â  Â  Â  Â <span class="hljs-comment">//åŸºç¡€ä»·+è¿è´¹+ä¼˜æƒ å·ï¼Œç»„åˆçš„æ–¹å¼ï¼Œä¸€ä¸ªåŒ…è£¹ä¸€ä¸ª</span>
 Â  Â  Â  Â baseOrder = <span class="hljs-keyword">new</span> <span class="hljs-type">CouponDecorator</span>(baseOrder, <span class="hljs-keyword">new</span> <span class="hljs-type">BigDecimal</span>(<span class="hljs-number">6</span>));
 Â  Â  Â  Â <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"åŸºç¡€è´¹ç”¨+è¿è´¹+ä¼˜æƒ å·ï¼š"</span> + baseOrder.calculateTotalPrice().toString());
 Â   }
}
â€‹
<span class="hljs-comment">//åŸæœ‰çš„orderã€BaseOrderç±»ä¸å˜ï¼Œæ–°å¢ä¸åŒä»·æ ¼çš„è£…é¥°å™¨</span>
â€‹
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderDecorator</span> <span class="hljs-title">implements</span> <span class="hljs-title">Order</span> </span>{
â€‹
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-type">Order</span> order;
â€‹
 Â  Â public <span class="hljs-type">OrderDecorator</span>(<span class="hljs-type">Order</span> order) {
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.order = order;
 Â   }
}
â€‹
â€‹
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CouponDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OrderDecorator</span> </span>{
â€‹
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-type">BigDecimal</span> coupon; <span class="hljs-comment">//ä¼˜æƒ ä»·</span>
â€‹
 Â  Â public <span class="hljs-type">CouponDecorator</span>(<span class="hljs-type">Order</span> order, <span class="hljs-type">BigDecimal</span> coupon) {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>(order);
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.coupon = coupon;
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> order.calculateTotalPrice().subtract(coupon);
 Â   }
}
â€‹
â€‹
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreightDecorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OrderDecorator</span> </span>{
â€‹
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-type">BigDecimal</span> freight; <span class="hljs-comment">//è¿è´¹</span>
â€‹
 Â  Â public <span class="hljs-type">FreightDecorator</span>(<span class="hljs-type">Order</span> order, <span class="hljs-type">BigDecimal</span> freight) {
 Â  Â  Â  Â <span class="hljs-keyword">super</span>(order);
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.freight = freight;
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">BigDecimal</span> calculateTotalPrice() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> order.calculateTotalPrice().add(freight);
 Â   }
}
</code></pre>
<p>è¿™æ ·çš„å¥½å¤„åœ¨äºä¸å¿…ç”Ÿæˆä¸åŒç»„åˆä»·æ ¼çš„ç±»ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ç”Ÿæˆæƒ³è¦çš„ä»·æ ¼ï¼Œå¯ä»¥å¸¦æ¥æ›´é«˜çš„æ‰©å±•æ€§ã€‚å¹¶ä¸”å¦‚æœæƒ³åœ¨åŸæœ‰ä¸åŒä»·æ ¼åŸºç¡€ä¸Šå†åŠ ä¸€ç§ä»·æ ¼ï¼Œåªéœ€è¦æ·»åŠ æ–°çš„è£…é¥°è€…ç±»ï¼Œä¸å¿…ä¿®æ”¹å…¶ä»–ç±»ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚æ‰€ä»¥<strong>è£…é¥°è€…æ¨¡å¼åŠ¨æ€åœ°å°†åŠŸèƒ½æ·»åŠ åˆ°å¯¹è±¡ä¸Šï¼Œå¦‚æœéœ€è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æ¨¡å¼æ¯”ç»§æ‰¿æ›´å…·å¼¹æ€§</strong>ã€‚</p>
<h6 data-id="heading-1">æ ¸å¿ƒç»“æ„ï¼ˆUMLç±»å›¾ï¼‰</h6>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2068f16f50454483bff6ea4d626481c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO5aSp5pyJ5LiT5Lia6K--:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769059059&amp;x-signature=EewtkXCeZ%2FtHOHreW8qIUHxEDEs%3D" alt="è£…é¥°è€…-UMLç±»å›¾.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>Component(Order)</strong></p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œå®šä¹‰èŒè´£</li>
</ul>
</li>
<li>
<p><strong>ConcreteComponent(BaseOrder)</strong></p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå®ç°æ¥å£çš„åŸºç¡€èŒè´£</li>
</ul>
</li>
<li>
<p><strong>Decorator(OrderDecorator)</strong></p>
<ul>
<li>å®šä¹‰æŠ½è±¡ç±»ï¼Œç»´æŒä¸€ä¸ªComponentå¯¹è±¡çš„å¼•ç”¨</li>
</ul>
</li>
<li>
<p><strong>ConcreteDecorator(CouponDecorator)</strong></p>
<ul>
<li>å¯¹Componentæ·»åŠ èŒè´£</li>
</ul>
</li>
</ul>
<h6 data-id="heading-2">æ¡†æ¶ä¸­çš„åº”ç”¨</h6>
<p>MyBatisä¸­çš„æ’ä»¶ç³»ç»Ÿå°±æ˜¯åº”ç”¨äº†è£…é¥°è€…æ¨¡å¼, å¯ä»¥æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰æ‰§è¡Œå™¨è£…é¥°å™¨å»å®ç°Interceptoræ¥å£ï¼Œåœ¨SQLæ‰§è¡Œçš„æ—¶å€™åŠ¨æ€çš„æ·»åŠ ç›‘æ§ã€æ€§èƒ½ç»Ÿè®¡ï¼Œæ…¢æŸ¥è¯¢å‘Šè­¦ç­‰ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Mapper</span>
public interface UserMapper {
 Â  Â 
 Â  Â <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT id, username, age FROM user WHERE id = #{id}"</span>)
 Â  Â User <span class="hljs-built_in">getUserById</span>(Long id);
}
â€‹
<span class="hljs-comment">/**
 * è‡ªå®šä¹‰SQLæ‰§è¡Œå™¨è£…é¥°å™¨ - é€šè¿‡MyBatisæ’ä»¶æœºåˆ¶å®ç°
 * åŠŸèƒ½ï¼šæ·»åŠ SQLæ‰§è¡Œç›‘æ§ã€æ€§èƒ½ç»Ÿè®¡ã€æ…¢æŸ¥è¯¢å‘Šè­¦ç­‰
 */</span>
<span class="hljs-variable">@Intercepts</span>({
 Â  Â  Â  Â <span class="hljs-variable">@Signature</span>(type = Executor.class, method = <span class="hljs-string">"update"</span>, args = {MappedStatement.class, Object.class}),
 Â  Â  Â  Â <span class="hljs-variable">@Signature</span>(type = Executor.class, method = <span class="hljs-string">"query"</span>, args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})
<span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Slf4j</span>
public class CustomSqlInterceptor implements Interceptor {
â€‹
 Â  Â <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">slowQueryThreshold</span> = <span class="hljs-number">1000</span>;<span class="hljs-comment">//æ…¢æŸ¥è¯¢é˜ˆå€¼</span>
â€‹
 Â  Â @<span class="hljs-selector-tag">Override</span>
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">intercept</span>(Invocation invocation) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Throwable</span> {
 Â  Â  Â  Â <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">startTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">try</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//è·å–æ–¹æ³•å‚æ•°</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">args</span> = <span class="hljs-selector-tag">invocation</span><span class="hljs-selector-class">.getArgs</span>();
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">MappedStatement</span> <span class="hljs-selector-tag">mappedStatement</span> = (MappedStatement) <span class="hljs-selector-tag">args</span><span class="hljs-selector-attr">[0]</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">sqlId</span> = <span class="hljs-selector-tag">mappedStatement</span><span class="hljs-selector-class">.getId</span>();
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"å¼€å§‹æ‰§è¡ŒSQL: {}"</span>, sqlId);
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//æ‰§è¡ŒåŸæ–¹æ³•</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">invocation</span><span class="hljs-selector-class">.proceed</span>();
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//ç»Ÿè®¡æ—¶é—´</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">executionTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>() <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">startTime</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">if</span> (executionTime &gt; slowQueryThreshold) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.warn</span>(<span class="hljs-string">"æ£€æµ‹åˆ°æ…¢æŸ¥è¯¢ - SQL: {}, æ‰§è¡Œæ—¶é—´: {}ms"</span>, sqlId, executionTime);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å‘Šè­¦é€»è¾‘ï¼Œå¦‚å‘é€é‚®ä»¶ã€å†™å…¥ç›‘æ§ç³»ç»Ÿç­‰</span>
 Â  Â  Â  Â  Â   } <span class="hljs-selector-tag">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"SQLæ‰§è¡Œå®Œæˆ - SQL: {}, æ‰§è¡Œæ—¶é—´: {}ms"</span>, sqlId, executionTime);
 Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//SQL æ‰§è¡ŒæˆåŠŸç»Ÿè®¡</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">result</span>;
 Â  Â  Â   } <span class="hljs-selector-tag">catch</span> (Exception e) {
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">executionTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>() <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">startTime</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">sqlId</span> = ((MappedStatement) invocation.<span class="hljs-built_in">getArgs</span>()[<span class="hljs-number">0</span>])<span class="hljs-selector-class">.getId</span>();
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"SQLæ‰§è¡Œå¤±è´¥ - SQL: {}, æ‰§è¡Œæ—¶é—´: {}ms, é”™è¯¯: {}"</span>,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sqlId, executionTime, e.<span class="hljs-built_in">getMessage</span>());
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// SQLæ‰§è¡Œå¤±è´¥ç»Ÿè®¡</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">e</span>;
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ’ä»¶æ–¹æ³•
 Â  Â  * @param o
 Â  Â  * @return
 Â  Â  */</span>
 Â  Â @<span class="hljs-selector-tag">Override</span>
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">plugin</span>(Object o) {
 Â  Â  Â  Â <span class="hljs-comment">// åªæœ‰å½“ç›®æ ‡å¯¹è±¡æ˜¯Executoræ—¶æ‰è¿›è¡ŒåŒ…è£…</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">if</span> (o instanceof Executor){
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// ä½¿ç”¨Plugin.wrap()æ–¹æ³•åˆ›å»ºè£…é¥°å™¨ä»£ç†</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è¿™å®é™…ä¸Šå°±æ˜¯è£…é¥°å™¨æ¨¡å¼çš„å®ç°</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Plugin</span><span class="hljs-selector-class">.wrap</span>(o, this);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">o</span>;
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">Override</span>
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">setProperties</span>(Properties properties) {
 Â  Â  Â  Â <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶è¯»å–æ…¢æŸ¥è¯¢é˜ˆå€¼</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">slowQueryThreshold</span> = <span class="hljs-selector-tag">properties</span><span class="hljs-selector-class">.getProperty</span>(<span class="hljs-string">"slowQueryThreshold"</span>, <span class="hljs-string">"1000"</span>);
 Â  Â  Â  Â <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.slowQueryThreshold</span> = <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.parseLong</span>(slowQueryThreshold);
 Â   }
}
â€‹
<span class="hljs-comment">//é…ç½®ç±»ä¸­æ³¨å†Œ</span>
@<span class="hljs-selector-tag">Configuration</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MybatisConfig</span> {
â€‹
 Â  Â <span class="hljs-variable">@Bean</span>
 Â  Â public ConfigurationCustomizer <span class="hljs-built_in">configurationCustomizer</span>(){
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">configuration</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">configuration</span><span class="hljs-selector-class">.setDefaultExecutorType</span>(ExecutorType.SIMPLE);
 Â   }
}
â€‹
@<span class="hljs-selector-tag">SpringBootTest</span>
<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">DemoApplicationTests</span> {
 Â  Â <span class="hljs-variable">@Resource</span>
 Â  Â private UserMapper userMapper;
 Â  Â <span class="hljs-variable">@Test</span>
 Â  Â void <span class="hljs-built_in">contextLoads</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">userMapper</span><span class="hljs-selector-class">.getUserById</span>(<span class="hljs-number">1</span>L);
 Â   }
}
</code></pre>
<p>MyBatis åœ¨å¯åŠ¨æ—¶ä¼šæ‰«ææ’ä»¶ï¼Œé€šè¿‡@Interceptsæ³¨è§£æ‰¾åˆ°æ‰€æœ‰æ’ä»¶ï¼Œç„¶ååˆ›å»ºæ‹¦æˆªå™¨é“¾InterceptorChainç®¡ç†æ‰€æœ‰æ’ä»¶ï¼Œæœ€åä¸ºç›®æ ‡å¯¹è±¡åº”ç”¨æ’ä»¶ã€‚æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™å—çš„æºç ã€‚</p>
<p>ä¸Šé¢æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ï¼Œè€Œåœ¨MyBatis-Plusæ¡†æ¶ä¸­ä¹Ÿå†…ç½®äº†ä¸€äº›æ‹¦æˆªå™¨çš„åŠŸèƒ½å¯ä»¥ä¾›æˆ‘ä»¬å‚è€ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db376068905e4ce4b9bf7c962a181b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO5aSp5pyJ5LiT5Lia6K--:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769059059&amp;x-signature=IBCnQubJ1VQPSZ7YLXWlcURH2X4%3D" alt="mybatisæ‹¦æˆªå™¨.png" loading="lazy"/></p>
<h6 data-id="heading-3">æ€»ç»“</h6>
<p>æŠŠè£…é¥°è€…æ¨¡å¼ç±»æ¯”ç”Ÿæ´»ä¸­çš„ç©¿æ­ï¼Œæƒ³è¦æ­£å¼ç‚¹å°±ç©¿è¥¿è£…ã€å»ä¸Šç­å°±è¦ç©¿æ ¼å­è¡«ã€å¤©å†·äº†å°±è¦åŠ è¡£æœã€å¤©çƒ­äº†å°±è¦è„±è¡£æœã€‚æ‰€ä»¥è£…é¥°è€…æ¨¡å¼æ˜¯å¯ä»¥åœ¨ä¸æ”¹å˜å¯¹è±¡ï¼Œä¸ç”Ÿæˆå­ç±»çš„æ–¹å¼ï¼Œä»¥åŠ¨æ€ï¼ˆè¿è¡Œæ—¶ï¼‰ã€é€æ˜ï¼ˆè£…é¥°ç±»ï¼‰çš„æ–¹å¼å¯¹å¯¹è±¡åŠŸèƒ½è¿›è¡Œå¢å¼ºã€‚å¦‚æœæœªæ¥ä¼šæœ‰å¯¹æŸä¸ªå¯¹è±¡æ·»åŠ å¾ˆå¤šåŠŸèƒ½çš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘è£…é¥°è€…æ¨¡å¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•ä½¿ç”¨SpringAIæ¥å®ç°ä¸€ä¸ªRAGåº”ç”¨ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7595164177256005658</link>    <guid>https://juejin.cn/post/7595164177256005658</guid>    <pubDate>2026-01-15T05:34:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595164177256005658" data-draft-id="7595163067904720905" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•ä½¿ç”¨SpringAIæ¥å®ç°ä¸€ä¸ªRAGåº”ç”¨ç³»ç»Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-15T05:34:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç¼–ç¨‹çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•ä½¿ç”¨SpringAIæ¥å®ç°ä¸€ä¸ªRAGåº”ç”¨ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç¼–ç¨‹çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:34:42.000Z" title="Thu Jan 15 2026 05:34:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RAGåŸç†</h2>
<p>å¤§æ¨¡å‹æ²¡æœ‰æœ¬åœ°ç§æœ‰çŸ¥è¯†ï¼Œæ‰€ä»¥ç”¨æˆ·åœ¨å‘å¤§æ¨¡å‹æé—®çš„æ—¶å€™ï¼Œå¤§æ¨¡å‹åªèƒ½åœ¨å®ƒå­¦ä¹ è¿‡çš„çŸ¥è¯†èŒƒå›´å†…è¿›è¡Œå›ç­”ï¼Œè€ŒRAGå°±æ˜¯åœ¨ç”¨æˆ·åœ¨æé—®çš„æ—¶å€™ å°†æœ¬åœ°ä¸é—®é¢˜ç›¸å…³çš„ç§æœ‰çŸ¥è¯†è¿åŒé—®é¢˜ä¸€å—å‘é€ç»™å¤§æ¨¡å‹ï¼Œè¿›è€Œå¤§æ¨¡å‹ä»ç”¨æˆ·æä¾›çš„ç§æœ‰çŸ¥è¯†èŒƒå›´å†…è¿›è¡Œæ›´ç²¾ç¡®çš„å›ç­”ã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒæŠ€æœ¯æ ˆ</h2>
<ul>
<li>SpringAI</li>
<li>MybatisPlus</li>
<li>Chroma</li>
<li>Elasticsearch</li>
<li>MySQL</li>
</ul>
<h2 data-id="heading-2">æ ¸å¿ƒæ­¥éª¤</h2>
<h3 data-id="heading-3">æ–‡æœ¬åˆ†å—å‘é‡åŒ–</h3>
<p>å°†æ–‡æœ¬åˆ‡åˆ†æˆå¤šä¸ªæ–‡æœ¬å—ï¼Œä½œè€…ä½¿ç”¨markdownæ¥å­˜å‚¨æ–‡æœ¬å†…å®¹ï¼Œmarkdownæ ¼å¼çš„æ–‡æœ¬ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå®¹æ˜“ä¸”åˆ†çš„ï¼Œå°†æ–‡æœ¬åˆ‡åˆ†ä¹‹å è¯·æ±‚å‘é‡åŒ–æ¥å£è¿›è¡Œæ–‡æœ¬å‘é‡åŒ–ï¼Œæœ€åå°†å‘é‡çš„ç»“æœå†™å…¥åˆ°åŸæœ¬çš„æ•°æ®å—ä¸­ å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“</p>
<h3 data-id="heading-4">å‘é‡æ•°æ®åº“</h3>
<ul>
<li>Elasticsearch æ··åˆæ£€ç´¢ä½¿ç”¨ï¼ŒçŸ¥è¯†å¬å›å‡†ç¡®åº¦æ¯”è¾ƒé«˜</li>
<li>Chroma æœ¬åœ°æµ‹è¯• æˆ–è€…å°æ•°æ®é›†ä½¿ç”¨ ä¹Ÿèƒ½æ··åˆæ£€ç´¢ ä½†æ˜¯æ— æ³•åƒesé‚£æ ·å¯ä»¥æ¨¡ç³Šæ··åˆæ£€ç´¢</li>
</ul>
<h3 data-id="heading-5">å‘é‡æ£€ç´¢</h3>
<p>å°†ç”¨æˆ·çš„é—®é¢˜è¿›è¡Œå‘é‡åŒ–ï¼Œç„¶åè°ƒç”¨å‘é‡æ•°æ®åº“çš„æ£€ç´¢</p>
<h2 data-id="heading-6">å®ç°</h2>
<h3 data-id="heading-7">æ–‡æœ¬åˆ†å—å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service("docMarkdownFileParseService")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DocMarkdownFileParseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DocFileParseService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">parse</span><span class="hljs-params">(MultipartFile file,Integer kdId)</span> {
        <span class="hljs-comment">// åˆå§‹åŒ–markdowné…ç½®</span>
        <span class="hljs-type">MarkdownDocumentReaderConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> MarkdownDocumentReaderConfig.builder()
                .withHorizontalRuleCreateDocument(<span class="hljs-literal">true</span>)
                .withIncludeCodeBlock(<span class="hljs-literal">true</span>)
                .withIncludeBlockquote(<span class="hljs-literal">true</span>)
                .withAdditionalMetadata(<span class="hljs-string">"knowledgeDocId"</span>, kdId)
                .build();

        <span class="hljs-type">MarkdownDocumentReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkdownDocumentReader</span>(file.getResource(), config);

        <span class="hljs-comment">// æ–‡æ¡£åˆ‡åˆ†è¯»å–</span>
        <span class="hljs-keyword">return</span> reader.get();
    }
}
</code></pre>
<p>åˆ†å—çš„æ—¶å€™ä¼šæ¶‰åŠä¸€äº›metadataï¼Œmetadataç”¨æ¥å­˜å‚¨æ•°æ®å—çš„å…ƒæ•°æ®ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨ä¸€äº›è‡ªå®šä¹‰å­—æ®µï¼Œå¯ä»¥æ›´å¥½çš„ä¸ºæ··åˆæ£€ç´¢æä¾›æ”¯æŒï¼ è¿™é‡Œæˆ‘å­˜å‚¨äº†çŸ¥è¯†æ–‡æœ¬çš„ID</p>
<h4 data-id="heading-8">MarkdownDocumentReader</h4>
<p>æˆ‘åœ¨SpringAIçš„åŸºç¡€ä¸Šæ‰©å±•äº†MarkdownDocumentReaderï¼Œä¸»è¦æ˜¯å°†markdownå„çº§æ ‡é¢˜æå–å‡ºæ¥ç»„åˆæˆtitleExpanderï¼Œæœ€ç»ˆå½¢æˆ ä¸€çº§æ ‡é¢˜-äºŒçº§æ ‡é¢˜-ä¸‰çº§æ ‡é¢˜-å½“å‰æ ‡é¢˜ è¿™æ ·çš„æ ¼å¼ï¼Œè¿›è€Œä¸ºåç»­çš„æ··åˆæ£€ç´¢æä¾›æ”¯æŒ</p>
<p>SpringAIé»˜è®¤æä¾›çš„ç±»æ²¡æœ‰å¯¹è¡¨æ ¼è§£æåšæ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ”¯æŒäº†è¡¨æ ¼çš„è§£æï¼Œæ‰€æœ‰æºç éƒ½ç²˜è´´åˆ°ä¸‹é¢</p>
<pre><code class="hljs language-scss" lang="scss">package cn<span class="hljs-selector-class">.dataling</span><span class="hljs-selector-class">.rag</span><span class="hljs-selector-class">.application</span><span class="hljs-selector-class">.reader</span>;

import org<span class="hljs-selector-class">.commonmark</span><span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.gfm</span><span class="hljs-selector-class">.tables</span>.*;
import org<span class="hljs-selector-class">.commonmark</span><span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.gfm</span><span class="hljs-selector-class">.tables</span><span class="hljs-selector-class">.TableBlock</span>;
import org<span class="hljs-selector-class">.commonmark</span><span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.gfm</span><span class="hljs-selector-class">.tables</span><span class="hljs-selector-class">.TablesExtension</span>;
import org<span class="hljs-selector-class">.commonmark</span><span class="hljs-selector-class">.node</span>.*;
import org<span class="hljs-selector-class">.commonmark</span><span class="hljs-selector-class">.parser</span><span class="hljs-selector-class">.Parser</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.ai</span><span class="hljs-selector-class">.document</span><span class="hljs-selector-class">.Document</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.ai</span><span class="hljs-selector-class">.document</span><span class="hljs-selector-class">.DocumentReader</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.ai</span><span class="hljs-selector-class">.reader</span><span class="hljs-selector-class">.markdown</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.MarkdownDocumentReaderConfig</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.DefaultResourceLoader</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Resource</span>;

import java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.IOException</span>;
import java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.InputStreamReader</span>;
import java<span class="hljs-selector-class">.util</span>.*;

<span class="hljs-comment">/**
 * Reads the given Markdown resource and groups headers, paragraphs, or text divided by
 * horizontal lines (depending on the
 * {@link MarkdownDocumentReaderConfig#horizontalRuleCreateDocument} configuration) into
 * {@link Document}s.
 *
 * @author Piotr Olaszewski
 */</span>
public class MarkdownDocumentReader implements DocumentReader {

    <span class="hljs-comment">/**
     * The resource points to the Markdown document.
     */</span>
    private final Resource markdownResource;

    <span class="hljs-comment">/**
     * Configuration to a parsing process.
     */</span>
    private final MarkdownDocumentReaderConfig config;

    <span class="hljs-comment">/**
     * Markdown parser.
     */</span>
    private final Parser parser;

    <span class="hljs-comment">/**
     * Create a new {@link MarkdownDocumentReader} instance.
     *
     * @param markdownResource the resource to read
     */</span>
    public <span class="hljs-built_in">MarkdownDocumentReader</span>(String markdownResource) {
        <span class="hljs-built_in">this</span>(new DefaultResourceLoader()<span class="hljs-selector-class">.getResource</span>(markdownResource), MarkdownDocumentReaderConfig<span class="hljs-selector-class">.defaultConfig</span>());
    }

    <span class="hljs-comment">/**
     * Create a new {@link MarkdownDocumentReader} instance.
     *
     * @param markdownResource the resource to read
     * @param config           the configuration to use
     */</span>
    public <span class="hljs-built_in">MarkdownDocumentReader</span>(String markdownResource, MarkdownDocumentReaderConfig config) {
        <span class="hljs-built_in">this</span>(new DefaultResourceLoader()<span class="hljs-selector-class">.getResource</span>(markdownResource), config);
    }

    <span class="hljs-comment">/**
     * Create a new {@link MarkdownDocumentReader} instance.
     *
     * @param markdownResource the resource to read
     */</span>
    public <span class="hljs-built_in">MarkdownDocumentReader</span>(Resource markdownResource, MarkdownDocumentReaderConfig config) {
        this<span class="hljs-selector-class">.markdownResource</span> = markdownResource;
        this<span class="hljs-selector-class">.config</span> = config;
        this<span class="hljs-selector-class">.parser</span> = Parser<span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.extensions</span>(Collections.singletonList(TablesExtension.create()))
                <span class="hljs-selector-class">.build</span>();
    }

    <span class="hljs-comment">/**
     * Extracts and returns a list of documents from the resource.
     *
     * @return List of extracted {@link Document}
     */</span>
    <span class="hljs-keyword">@Override</span>
    public List&lt;Document&gt; get() {
        try (var input = this.markdownResource.getInputStream()) {
            Node node = this<span class="hljs-selector-class">.parser</span><span class="hljs-selector-class">.parseReader</span>(new InputStreamReader(input));

            DocumentVisitor documentVisitor = new <span class="hljs-built_in">DocumentVisitor</span>(this.config);
            node<span class="hljs-selector-class">.accept</span>(documentVisitor);

            return documentVisitor<span class="hljs-selector-class">.getDocuments</span>();
        } catch (IOException e) {
            throw new <span class="hljs-built_in">RuntimeException</span>(e);
        }
    }

    <span class="hljs-comment">/**
     * A convenient class for visiting handled nodes in the Markdown document.
     */</span>
    static class DocumentVisitor extends AbstractVisitor {

        private final List&lt;Document&gt; documents = new ArrayList&lt;&gt;();

        private final List&lt;String&gt; currentParagraphs = new ArrayList&lt;&gt;();

        private final MarkdownDocumentReaderConfig config;

        private Document<span class="hljs-selector-class">.Builder</span> currentDocumentBuilder;

        <span class="hljs-comment">/**
         * å­˜å‚¨å„çº§æ ‡é¢˜çš„æ–‡æœ¬å†…å®¹ï¼Œç”¨äºæ„å»ºå±‚çº§title
         * æ•°ç»„ç´¢å¼•å¯¹åº”æ ‡é¢˜çº§åˆ«ï¼ˆ1-6ï¼‰
         */</span>
        private final String<span class="hljs-selector-attr">[]</span> headingLevels = new String<span class="hljs-selector-attr">[7]</span>;

        <span class="hljs-comment">/**
         * ç”¨äºæ„å»ºè¡¨æ ¼å†…å®¹çš„æ„å»ºå™¨
         */</span>
        private final StringBuilder tableBuilder = new <span class="hljs-built_in">StringBuilder</span>();

        <span class="hljs-comment">/**
         * æ˜¯å¦æ­£åœ¨å¤„ç†è¡¨æ ¼
         */</span>
        private boolean inTable = false;

        <span class="hljs-comment">/**
         * å½“å‰è¡¨æ ¼çš„åˆ—æ•°ï¼Œç”¨äºç”Ÿæˆåˆ†éš”è¡Œ
         */</span>
        private int tableColumns = <span class="hljs-number">0</span>;

        <span class="hljs-comment">/**
         * æ˜¯å¦æ­£åœ¨å¤„ç†è¡¨å¤´
         */</span>
        private boolean inTableHeader = false;

        <span class="hljs-built_in">DocumentVisitor</span>(MarkdownDocumentReaderConfig config) {
            this<span class="hljs-selector-class">.config</span> = config;
        }

        <span class="hljs-comment">/**
         * Visits the document node and initializes the current document builder.
         */</span>
        <span class="hljs-keyword">@Override</span>
        public void visit(org.commonmark.node.Document document) {
            this<span class="hljs-selector-class">.currentDocumentBuilder</span> = Document<span class="hljs-selector-class">.builder</span>();
            super<span class="hljs-selector-class">.visit</span>(document);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(Heading heading) {
            <span class="hljs-built_in">buildAndFlush</span>();

            <span class="hljs-comment">// æ›´æ–°å½“å‰çº§åˆ«çš„æ ‡é¢˜æ–‡æœ¬ï¼ˆåœ¨visit(Text)ä¸­è®¾ç½®ï¼‰</span>
            <span class="hljs-comment">// è¿™é‡Œå…ˆè®¾ç½®å½“å‰çº§åˆ«åŠæ›´é«˜çº§åˆ«ä¿æŒä¸å˜ï¼Œæ¸…é™¤æ›´ä½çº§åˆ«çš„æ ‡é¢˜</span>
            int level = heading<span class="hljs-selector-class">.getLevel</span>();
            for (int i = level; i &lt; headingLevels.length; i++) {
                headingLevels<span class="hljs-selector-attr">[i]</span> = null;
            }

            super<span class="hljs-selector-class">.visit</span>(heading);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(ThematicBreak thematicBreak) {
            if (this.config.horizontalRuleCreateDocument) {
                <span class="hljs-built_in">buildAndFlush</span>();
            }
            super<span class="hljs-selector-class">.visit</span>(thematicBreak);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(SoftLineBreak softLineBreak) {
            <span class="hljs-built_in">translateLineBreakToSpace</span>();
            super<span class="hljs-selector-class">.visit</span>(softLineBreak);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(HardLineBreak hardLineBreak) {
            <span class="hljs-built_in">translateLineBreakToSpace</span>();
            super<span class="hljs-selector-class">.visit</span>(hardLineBreak);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(ListItem listItem) {
            <span class="hljs-built_in">translateLineBreakToSpace</span>();
            super<span class="hljs-selector-class">.visit</span>(listItem);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(Image image) {
            String alt = image<span class="hljs-selector-class">.getDestination</span>(); <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œåº”ä¸ºgetTitle()æˆ–getFirstChild()è·å–altæ–‡æœ¬</span>
            String url = image<span class="hljs-selector-class">.getDestination</span>();
            String title = image<span class="hljs-selector-class">.getTitle</span>();

            <span class="hljs-comment">// å°†å›¾ç‰‡ä¿¡æ¯æ ¼å¼åŒ–åæ·»åŠ åˆ°å½“å‰æ®µè½ä¸­</span>
            String imageInfo = String<span class="hljs-selector-class">.format</span>("![%s](%s "%s")", alt, url, title);
            this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(imageInfo);

            super<span class="hljs-selector-class">.visit</span>(image);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(BlockQuote blockQuote) {
            if (!this.config.includeBlockquote) {
                return;
            }

            <span class="hljs-built_in">translateLineBreakToSpace</span>();
            this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("category", "blockquote");
            super<span class="hljs-selector-class">.visit</span>(blockQuote);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(Code code) {
            this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(code.getLiteral());
            this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("category", "code_inline");
            super<span class="hljs-selector-class">.visit</span>(code);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(FencedCodeBlock fencedCodeBlock) {
            if (!this.config.includeCodeBlock) {
                return;
            }

            <span class="hljs-built_in">translateLineBreakToSpace</span>();

            String literal = fencedCodeBlock<span class="hljs-selector-class">.getLiteral</span>();
            Integer openingFenceLength = fencedCodeBlock<span class="hljs-selector-class">.getOpeningFenceLength</span>();
            Integer closingFenceLength = fencedCodeBlock<span class="hljs-selector-class">.getClosingFenceLength</span>();
            StringJoiner literalJoiner = new <span class="hljs-built_in">StringJoiner</span>("");
            literalJoiner<span class="hljs-selector-class">.add</span>("\n");

            <span class="hljs-comment">// æ„å»ºå¼€å¤´çš„ä»£ç å—æ ‡è®°ï¼ŒåŒ…å«è¯­è¨€æ ‡è¯†</span>
            for (int i = <span class="hljs-number">0</span>; i &lt; openingFenceLength; i++) {
                literalJoiner<span class="hljs-selector-class">.add</span>(fencedCodeBlock.getFenceCharacter());
            }

            <span class="hljs-comment">// æ·»åŠ è¯­è¨€æ ‡è¯†ï¼ˆå¦‚æœæœ‰ï¼‰</span>
            String language = fencedCodeBlock<span class="hljs-selector-class">.getInfo</span>();
            if (language != null &amp;&amp; !language.trim()<span class="hljs-selector-class">.isEmpty</span>()) {
                literalJoiner<span class="hljs-selector-class">.add</span>(language);
            }

            literalJoiner<span class="hljs-selector-class">.add</span>("\n");
            literalJoiner<span class="hljs-selector-class">.add</span>(literal);

            <span class="hljs-comment">// æ„å»ºç»“å°¾çš„ä»£ç å—æ ‡è®°</span>
            for (int i = <span class="hljs-number">0</span>; i &lt; closingFenceLength; i++) {
                literalJoiner<span class="hljs-selector-class">.add</span>(fencedCodeBlock.getFenceCharacter());
            }
            literalJoiner<span class="hljs-selector-class">.add</span>("\n");

            this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(literalJoiner.toString());
            this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("category", "code_block");
            this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("lang", language); <span class="hljs-comment">// åŒæ—¶ä¿å­˜åœ¨å…ƒæ•°æ®ä¸­</span>

            super<span class="hljs-selector-class">.visit</span>(fencedCodeBlock);
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(CustomBlock customBlock) {
            if (customBlock instanceof TableBlock tableBlock){

                inTable = true;
                inTableHeader = false;
                tableBuilder<span class="hljs-selector-class">.setLength</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ¸…ç©ºè¡¨æ ¼æ„å»ºå™¨</span>
                tableColumns = <span class="hljs-number">0</span>;

                <span class="hljs-comment">// è®¾ç½®å…ƒæ•°æ®</span>
                this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("category", "table");

                super<span class="hljs-selector-class">.visit</span>(tableBlock); <span class="hljs-comment">// ç»§ç»­è®¿é—®è¡¨æ ¼å­èŠ‚ç‚¹</span>

                <span class="hljs-comment">// è¡¨æ ¼å¤„ç†å®Œæˆ</span>
                if (tableBuilder.length() &gt; <span class="hljs-number">0</span>) {
                    this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(tableBuilder.toString());
                }

                inTable = false;
                inTableHeader = false;
            } else {
                super<span class="hljs-selector-class">.visit</span>(customBlock);
            }
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(CustomNode customNode) {
            if (customNode instanceof TableBody tableBody){
                inTableHeader = false;
                super<span class="hljs-selector-class">.visit</span>(tableBody);
            } else if (customNode instanceof TableRow tableRow){
                if (inTable) {
                    <span class="hljs-comment">// å¤„ç†è¡¨æ ¼è¡Œ</span>
                    int columnCount = <span class="hljs-number">0</span>;
                    StringBuilder rowBuilder = new <span class="hljs-built_in">StringBuilder</span>("|");

                    <span class="hljs-comment">// éå†è¡Œä¸­çš„æ‰€æœ‰å•å…ƒæ ¼</span>
                    Node child = tableRow<span class="hljs-selector-class">.getFirstChild</span>();
                    while (child != null) {
                        if (child instanceof TableCell) {
                            columnCount++;
                            String cellContent = <span class="hljs-built_in">extractCellContent</span>((TableCell) child);
                            rowBuilder<span class="hljs-selector-class">.append</span>(cellContent)<span class="hljs-selector-class">.append</span>("|");
                        }
                        child = child<span class="hljs-selector-class">.getNext</span>();
                    }

                    <span class="hljs-comment">// å¦‚æœæ˜¯è¡¨å¤´è¡Œï¼Œè®°å½•åˆ—æ•°å¹¶æ·»åŠ åˆ†éš”è¡Œ</span>
                    if (inTableHeader &amp;&amp; tableColumns == <span class="hljs-number">0</span>) {
                        tableColumns = columnCount;
                        tableBuilder<span class="hljs-selector-class">.append</span>(rowBuilder)<span class="hljs-selector-class">.append</span>("\n");
                        <span class="hljs-comment">// æ·»åŠ åˆ†éš”è¡Œ</span>
                        tableBuilder<span class="hljs-selector-class">.append</span>("|");
                        tableBuilder<span class="hljs-selector-class">.append</span>("---|".repeat(Math.max(<span class="hljs-number">0</span>, tableColumns)));
                        tableBuilder<span class="hljs-selector-class">.append</span>("\n");
                    } else {
                        tableBuilder<span class="hljs-selector-class">.append</span>(rowBuilder)<span class="hljs-selector-class">.append</span>("\n");
                    }
                }
                super<span class="hljs-selector-class">.visit</span>(tableRow);
            } else if (customNode instanceof TableCell tableCell){
                <span class="hljs-comment">// å•å…ƒæ ¼å†…å®¹åœ¨visit(Text)ä¸­å¤„ç†ï¼Œè¿™é‡Œç›´æ¥ç»§ç»­è®¿é—®</span>
                super<span class="hljs-selector-class">.visit</span>(tableCell);
            } else if (customNode instanceof TableHead tableHead){
                inTableHeader = true;
                super<span class="hljs-selector-class">.visit</span>(tableHead);
            } else {
                super<span class="hljs-selector-class">.visit</span>(customNode);
            }
        }

        <span class="hljs-keyword">@Override</span>
        public void visit(Text text) {
            if (text.getParent() instanceof Heading heading) {
                int level = heading<span class="hljs-selector-class">.getLevel</span>();
                String currentTitle = text<span class="hljs-selector-class">.getLiteral</span>();

                <span class="hljs-comment">// å­˜å‚¨å½“å‰çº§åˆ«çš„æ ‡é¢˜</span>
                headingLevels<span class="hljs-selector-attr">[level]</span> = currentTitle;

                <span class="hljs-comment">// æ„å»ºå±‚çº§title</span>
                String hierarchicalTitle = <span class="hljs-built_in">buildHierarchicalTitle</span>(level);

                this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.metadata</span>("category", "header_%d".formatted(level))
                        <span class="hljs-selector-class">.metadata</span>("title", currentTitle)
                        <span class="hljs-selector-class">.metadata</span>("titleExpander", hierarchicalTitle);

            } else if (!inTable) {
                <span class="hljs-comment">// å¦‚æœä¸æ˜¯åœ¨è¡¨æ ¼ä¸­ï¼Œæ‰æ·»åŠ åˆ°å½“å‰æ®µè½</span>
                this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(text.getLiteral());
            }
            <span class="hljs-comment">// è¡¨æ ¼ä¸­çš„æ–‡æœ¬åœ¨extractCellContentæ–¹æ³•ä¸­å¤„ç†</span>

            super<span class="hljs-selector-class">.visit</span>(text);
        }

        <span class="hljs-comment">/**
         * æ„å»ºå±‚çº§æ ‡é¢˜
         * @param currentLevel å½“å‰æ ‡é¢˜çº§åˆ«
         * @return å±‚çº§æ ‡é¢˜å­—ç¬¦ä¸²ï¼Œå¦‚ "ä¸€çº§æ ‡é¢˜ - äºŒçº§æ ‡é¢˜ - ä¸‰çº§æ ‡é¢˜"
         */</span>
        private String <span class="hljs-built_in">buildHierarchicalTitle</span>(int currentLevel) {
            List&lt;String&gt; titleParts = new ArrayList&lt;&gt;();

            <span class="hljs-comment">// ä»1çº§æ ‡é¢˜å¼€å§‹ï¼Œæ”¶é›†åˆ°å½“å‰çº§åˆ«ä¸ºæ­¢çš„æ‰€æœ‰æ ‡é¢˜</span>
            for (int i = <span class="hljs-number">1</span>; i &lt;= currentLevel; i++) {
                if (headingLevels[i] != null &amp;&amp; !headingLevels[i].trim()<span class="hljs-selector-class">.isEmpty</span>()) {
                    titleParts<span class="hljs-selector-class">.add</span>(headingLevels[i].trim());
                }
            }

            <span class="hljs-comment">// ç”¨ " - " è¿æ¥æ‰€æœ‰æ ‡é¢˜éƒ¨åˆ†</span>
            return String<span class="hljs-selector-class">.join</span>(" - ", titleParts);
        }

        <span class="hljs-comment">/**
         * æå–è¡¨æ ¼å•å…ƒæ ¼å†…å®¹
         */</span>
        private String <span class="hljs-built_in">extractCellContent</span>(TableCell tableCell) {
            StringBuilder cellBuilder = new <span class="hljs-built_in">StringBuilder</span>();
            Node child = tableCell<span class="hljs-selector-class">.getFirstChild</span>();
            while (child != null) {
                cellBuilder<span class="hljs-selector-class">.append</span>(extractNodeText(child));
                child = child<span class="hljs-selector-class">.getNext</span>();
            }

            <span class="hljs-comment">// æ¸…ç†å†…å®¹ï¼šç§»é™¤é¦–å°¾ç©ºæ ¼ï¼Œå°†å†…éƒ¨å¤šä¸ªç©ºæ ¼/æ¢è¡Œæ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼</span>
            String <span class="hljs-attribute">content</span> = cellBuilder<span class="hljs-selector-class">.toString</span>()<span class="hljs-selector-class">.trim</span>();
            <span class="hljs-attribute">content</span> = <span class="hljs-attribute">content</span><span class="hljs-selector-class">.replaceAll</span>("\s+", " ");

            <span class="hljs-comment">// å¦‚æœå•å…ƒæ ¼å†…å®¹ä¸ºç©ºï¼Œæ·»åŠ ä¸€ä¸ªç©ºæ ¼</span>
            if (content.isEmpty()) {
                <span class="hljs-attribute">content</span> = " ";
            }

            return <span class="hljs-attribute">content</span>;
        }

        <span class="hljs-comment">/**
         * é€’å½’æå–èŠ‚ç‚¹æ–‡æœ¬
         */</span>
        private String <span class="hljs-built_in">extractNodeText</span>(Node node) {
            if (node instanceof Text) {
                return ((Text) node)<span class="hljs-selector-class">.getLiteral</span>();
            } else if (node instanceof Code) {
                return ((Code) node)<span class="hljs-selector-class">.getLiteral</span>();
            } else if (node instanceof StrongEmphasis) {
                <span class="hljs-comment">// åŠ ç²—æ–‡æœ¬</span>
                return <span class="hljs-built_in">extractChildrenText</span>(node);
            } else if (node instanceof Emphasis) {
                <span class="hljs-comment">// æ–œä½“æ–‡æœ¬</span>
                return <span class="hljs-built_in">extractChildrenText</span>(node);
            } else if (node instanceof Link) {
                <span class="hljs-comment">// é“¾æ¥ - æå–é“¾æ¥æ–‡æœ¬</span>
                return <span class="hljs-built_in">extractChildrenText</span>(node);
            } else {
                <span class="hljs-comment">// å…¶ä»–èŠ‚ç‚¹ç±»å‹ï¼Œé€’å½’æå–å­èŠ‚ç‚¹æ–‡æœ¬</span>
                return <span class="hljs-built_in">extractChildrenText</span>(node);
            }
        }

        <span class="hljs-comment">/**
         * æå–æ‰€æœ‰å­èŠ‚ç‚¹çš„æ–‡æœ¬
         */</span>
        private String <span class="hljs-built_in">extractChildrenText</span>(Node node) {
            StringBuilder result = new <span class="hljs-built_in">StringBuilder</span>();
            Node child = node<span class="hljs-selector-class">.getFirstChild</span>();
            while (child != null) {
                result<span class="hljs-selector-class">.append</span>(extractNodeText(child));
                child = child<span class="hljs-selector-class">.getNext</span>();
            }
            return result<span class="hljs-selector-class">.toString</span>();
        }

        public List&lt;Document&gt; <span class="hljs-built_in">getDocuments</span>() {
            <span class="hljs-built_in">buildAndFlush</span>();
            return this<span class="hljs-selector-class">.documents</span>;
        }

        private void <span class="hljs-built_in">buildAndFlush</span>() {
            if (!this.currentParagraphs.isEmpty() || (inTable &amp;&amp; tableBuilder.length() &gt; <span class="hljs-number">0</span>)) {
                String <span class="hljs-attribute">content</span>;
                if (inTable &amp;&amp; tableBuilder.length() &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// å¦‚æœæ­£åœ¨å¤„ç†è¡¨æ ¼ï¼Œä½¿ç”¨è¡¨æ ¼å†…å®¹</span>
                    <span class="hljs-attribute">content</span> = tableBuilder<span class="hljs-selector-class">.toString</span>();
                } else {
                    <span class="hljs-comment">// å¦åˆ™ä½¿ç”¨æ®µè½å†…å®¹</span>
                    <span class="hljs-attribute">content</span> = String<span class="hljs-selector-class">.join</span>("\n", this.currentParagraphs);
                }

                Document<span class="hljs-selector-class">.Builder</span> builder = this<span class="hljs-selector-class">.currentDocumentBuilder</span><span class="hljs-selector-class">.text</span>(content);

                this<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.additionalMetadata</span><span class="hljs-selector-class">.forEach</span>(builder::metadata);

                Document document = builder<span class="hljs-selector-class">.build</span>();

                this<span class="hljs-selector-class">.documents</span><span class="hljs-selector-class">.add</span>(document);

                this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.clear</span>();
                tableBuilder<span class="hljs-selector-class">.setLength</span>(<span class="hljs-number">0</span>);
            }
            this<span class="hljs-selector-class">.currentDocumentBuilder</span> = Document<span class="hljs-selector-class">.builder</span>();
        }

        private void <span class="hljs-built_in">translateLineBreakToSpace</span>() {
            if (!this.currentParagraphs.isEmpty() &amp;&amp; !inTable) {
                this<span class="hljs-selector-class">.currentParagraphs</span><span class="hljs-selector-class">.add</span>(" ");
            }
        }
    }
}
</code></pre>
<p>è¡¨æ ¼æ”¯æŒè¿˜éœ€è¦æ·»åŠ ä¸€ä¸‹ä¾èµ–</p>
<pre><code class="hljs language-xml" lang="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.commonmark<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commonmark-ext-gfm-tables<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.22.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ä¸‹é¢æ˜¯æ¥å—å‰ç«¯ä¸Šä¼ çš„markdownæ–‡ä»¶ï¼Œä»¥åŠæ‰€é€‰æ‹©çš„çŸ¥è¯†åº“IDï¼Œç„¶ååšæ–‡æœ¬åˆ‡å— å‘é‡åŒ–å­˜å‚¨</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title">embeddingDocumentsForMarkdown</span>(<span class="hljs-params">Integer kdId, MultipartFile file</span>)</span> {

        String fileExtension = getFileExtension(file);

        <span class="hljs-comment">// æ–‡æ¡£åˆ‡åˆ†è¯»å–</span>
        List&lt;Document&gt; documents = <span class="hljs-keyword">switch</span> (fileExtension) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"md"</span> -&gt; docFileParseServiceMap.<span class="hljs-keyword">get</span>(<span class="hljs-string">"docMarkdownFileParseService"</span>).parse(file, kdId);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"pdf"</span> -&gt; docFileParseServiceMap.<span class="hljs-keyword">get</span>(<span class="hljs-string">"docPdfFileParseService"</span>).parse(file, kdId);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"docx"</span>, <span class="hljs-string">"doc"</span> -&gt; docFileParseServiceMap.<span class="hljs-keyword">get</span>(<span class="hljs-string">"docWordFileParseService"</span>).parse(file, kdId);
            <span class="hljs-literal">default</span> -&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ExceptionCore(<span class="hljs-string">"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹"</span>);
        };

        <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(documents)) {
            <span class="hljs-keyword">return</span> Collections.emptyList();
        }

        vectorStoreComponent.getVectorStore().<span class="hljs-keyword">add</span>(documents);

        <span class="hljs-keyword">return</span> Collections.emptyList();
    }
</code></pre>
<h3 data-id="heading-9">å‘é‡æ•°æ®åº“</h3>
<p>å­˜å‚¨æ–‡æœ¬å‘é‡ ä¸ºå‘é‡æ£€ç´¢æä¾›æ”¯æŒ</p>
<pre><code class="hljs language-typescript" lang="typescript">package cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">provider</span>;

<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ChromaProperties</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ElasticsearchProperties</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">util</span>.<span class="hljs-property">JsonUtils</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">ChromaVectorStore</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">ElasticsearchAiSearchFilterExpressionConverter</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">ElasticsearchVectorStore</span>;
<span class="hljs-keyword">import</span> cn.<span class="hljs-property">dataling</span>.<span class="hljs-property">rag</span>.<span class="hljs-property">application</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">SimpleVectorStore</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">google</span>.<span class="hljs-property">common</span>.<span class="hljs-property">collect</span>.<span class="hljs-property">Lists</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">chroma</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">ChromaApi</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">embedding</span>.<span class="hljs-property">EmbeddingModel</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">vectorstore</span>.<span class="hljs-property">VectorStore</span>;


<span class="hljs-comment">/**
 * å‘é‡å­˜å‚¨æä¾›è€…
 */</span>
<span class="hljs-keyword">public</span> final <span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorStoreProvider</span> {

    <span class="hljs-comment">/**
     * è·å–å‘é‡å­˜å‚¨
     *
     * <span class="hljs-doctag">@param</span> vectorStoreType å‘é‡å­˜å‚¨ç±»å‹
     * <span class="hljs-doctag">@param</span> embeddingModel  åµŒå…¥æ¨¡å‹
     * <span class="hljs-doctag">@param</span> jsonConfig      é…ç½®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">VectorStore</span> <span class="hljs-title function_">getVectorStore</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> vectorStoreType, EmbeddingModel embeddingModel, <span class="hljs-built_in">String</span> jsonConfig</span>) {
        <span class="hljs-title class_">VectorStoreProviderEnum</span> vectorStoreProviderEnum = <span class="hljs-title class_">VectorStoreProviderEnum</span>.<span class="hljs-title function_">valueOf</span>(vectorStoreType);
        <span class="hljs-keyword">switch</span> (vectorStoreProviderEnum) {
            <span class="hljs-keyword">case</span> <span class="hljs-attr">ELASTICSEARCH</span>:
                <span class="hljs-title class_">ElasticsearchProperties</span> elasticsearchProperties = <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-title function_">toObject</span>(jsonConfig, <span class="hljs-title class_">ElasticsearchProperties</span>.<span class="hljs-property">class</span>);
                elasticsearchProperties.<span class="hljs-title function_">setSimilarity</span>(<span class="hljs-title class_">ElasticsearchVectorStore</span>.<span class="hljs-property">SimilarityFunction</span>.<span class="hljs-property">cosine</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">elasticsearchVectorStore</span>(embeddingModel, elasticsearchProperties);
            <span class="hljs-keyword">case</span> <span class="hljs-attr">SIMPLE</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">simpleVectorStore</span>(embeddingModel);
            <span class="hljs-keyword">case</span> <span class="hljs-attr">CHROMA</span>:
                <span class="hljs-title class_">ChromaProperties</span> chromaProperties = <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-title function_">toObject</span>(jsonConfig, <span class="hljs-title class_">ChromaProperties</span>.<span class="hljs-property">class</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">chromaVectorStore</span>(embeddingModel, chromaProperties);
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"vectorStoreType not support"</span>);
        }
    }

    <span class="hljs-comment">/**
     * è·å–ESå‘é‡å­˜å‚¨
     *
     * <span class="hljs-doctag">@param</span> embeddingModel          åµŒå…¥æ¨¡å‹
     * <span class="hljs-doctag">@param</span> elasticsearchProperties esé…ç½®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">VectorStore</span> <span class="hljs-title function_">elasticsearchVectorStore</span>(<span class="hljs-params">EmbeddingModel embeddingModel, ElasticsearchProperties elasticsearchProperties</span>) {

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElasticsearchVectorStore</span>.<span class="hljs-title function_">builder</span>(elasticsearchProperties, embeddingModel)
                .<span class="hljs-title function_">withFilterExpressionConverter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ElasticsearchAiSearchFilterExpressionConverter</span>())
                .<span class="hljs-title function_">batchingStrategy</span>(docs -&gt; <span class="hljs-title class_">Lists</span>.<span class="hljs-title function_">partition</span>(docs, elasticsearchProperties.<span class="hljs-title function_">getBatchSize</span>()))
                .<span class="hljs-title function_">build</span>();
    }

    <span class="hljs-comment">/**
     * è·å–å†…å­˜å‘é‡å­˜å‚¨
     *
     * <span class="hljs-doctag">@param</span> embeddingModel åµŒå…¥æ¨¡å‹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">VectorStore</span> <span class="hljs-title function_">simpleVectorStore</span>(<span class="hljs-params">EmbeddingModel embeddingModel</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">SimpleVectorStore</span>.<span class="hljs-title function_">builder</span>(embeddingModel)
                .<span class="hljs-title function_">batchingStrategy</span>(docs -&gt; <span class="hljs-title class_">Lists</span>.<span class="hljs-title function_">partition</span>(docs, <span class="hljs-number">100</span>))
                .<span class="hljs-title function_">build</span>();
    }

    <span class="hljs-comment">/**
     * è·å–Chromaå‘é‡å­˜å‚¨
     *
     * <span class="hljs-doctag">@param</span> embeddingModel   åµŒå…¥æ¨¡å‹
     * <span class="hljs-doctag">@param</span> chromaProperties chromaé…ç½®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">VectorStore</span> <span class="hljs-title function_">chromaVectorStore</span>(<span class="hljs-params">EmbeddingModel embeddingModel, ChromaProperties chromaProperties</span>) {
        <span class="hljs-title class_">ChromaApi</span> chromaApi = <span class="hljs-title class_">ChromaApi</span>.<span class="hljs-title function_">builder</span>()
                .<span class="hljs-title function_">baseUrl</span>(chromaProperties.<span class="hljs-title function_">getBaseUrl</span>())
                .<span class="hljs-title function_">build</span>();

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ChromaVectorStore</span>.<span class="hljs-title function_">builder</span>(chromaApi, embeddingModel)
                .<span class="hljs-title function_">collectionName</span>(chromaProperties.<span class="hljs-title function_">getCollectionName</span>())
                .<span class="hljs-title function_">tenantName</span>(chromaProperties.<span class="hljs-title function_">getTenantName</span>())
                .<span class="hljs-title function_">batchingStrategy</span>(docs -&gt; <span class="hljs-title class_">Lists</span>.<span class="hljs-title function_">partition</span>(docs, chromaProperties.<span class="hljs-title function_">getBatchSize</span>()))
                .<span class="hljs-title function_">databaseName</span>(chromaProperties.<span class="hljs-title function_">getDatabaseName</span>())
                .<span class="hljs-title function_">initializeSchema</span>(<span class="hljs-literal">true</span>)
                .<span class="hljs-title function_">initializeImmediately</span>(<span class="hljs-literal">true</span>)
                .<span class="hljs-title function_">build</span>();
    }

    <span class="hljs-comment">/**
     * å‘é‡å­˜å‚¨æä¾›è€…æšä¸¾
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">VectorStoreProviderEnum</span> {
        <span class="hljs-title function_">ELASTICSEARCH</span>(<span class="hljs-string">"ES"</span>),
        <span class="hljs-title function_">SIMPLE</span>(<span class="hljs-string">"å†…å­˜"</span>),
        <span class="hljs-title function_">CHROMA</span>(<span class="hljs-string">"Chroma"</span>),

        ;

        <span class="hljs-keyword">private</span> final <span class="hljs-title class_">String</span> value;

        <span class="hljs-title class_">VectorStoreProviderEnum</span>(<span class="hljs-title class_">String</span> value) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> value;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">RAGæ£€ç´¢å¢å¼º</h3>
<pre><code class="hljs language-less" lang="less">    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Flux</span>&lt;<span class="hljs-selector-tag">AssistantMessage</span>&gt; <span class="hljs-selector-tag">chatWithRag</span>(ChatWithRagDTO data) {

        <span class="hljs-comment">// æŸ¥è¯¢çŸ¥è¯†æ–‡æ¡£</span>
        <span class="hljs-selector-tag">KnowledgeDoc</span> <span class="hljs-selector-tag">knowledgeDoc</span> = <span class="hljs-selector-tag">knowledgeDocService</span><span class="hljs-selector-class">.getKnowledgeDocById</span>(data.<span class="hljs-built_in">getKnowledgeDocId</span>());

        <span class="hljs-selector-tag">if</span> (ObjectUtils.<span class="hljs-built_in">isEmpty</span>(knowledgeDoc)) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Flux</span><span class="hljs-selector-class">.just</span>(new <span class="hljs-built_in">AssistantMessage</span>(<span class="hljs-string">"çŸ¥è¯†åº“ä¸å­˜åœ¨"</span>));
        }

        <span class="hljs-comment">// è·å–çŸ¥è¯†æ–‡æ¡£çš„æç¤ºè¯</span>
        <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">promptId</span> = <span class="hljs-selector-tag">knowledgeDoc</span><span class="hljs-selector-class">.getPromptId</span>();
        <span class="hljs-selector-tag">PromptInfo</span> <span class="hljs-selector-tag">promptInfo</span> = <span class="hljs-selector-tag">promptInfoMapper</span><span class="hljs-selector-class">.selectById</span>(promptId);
        <span class="hljs-comment">// æŸ¥è¯¢æ¨¡å‹ä¿¡æ¯</span>
        <span class="hljs-selector-tag">Model</span> <span class="hljs-selector-tag">model</span> = <span class="hljs-selector-tag">modelMapper</span><span class="hljs-selector-class">.selectById</span>(data.<span class="hljs-built_in">getChatModelId</span>());
        <span class="hljs-comment">// è·å–å¯¹è¯å®¢æˆ·ç«¯</span>
        <span class="hljs-selector-tag">ChatClient</span> <span class="hljs-selector-tag">chatClient</span> = <span class="hljs-selector-tag">chatClientProvider</span><span class="hljs-selector-class">.getChatClient</span>(model.<span class="hljs-built_in">getProvider</span>(), model.<span class="hljs-built_in">getName</span>(), model.<span class="hljs-built_in">getApiUrl</span>(), model.<span class="hljs-built_in">getApiKey</span>());

        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">delimiterToken</span> = <span class="hljs-selector-tag">ObjectUtils</span><span class="hljs-selector-class">.isEmpty</span>(promptInfo) ? "{}" : <span class="hljs-selector-tag">promptInfo</span><span class="hljs-selector-class">.getDelimiterToken</span>();

        <span class="hljs-selector-tag">StTemplateRenderer</span> <span class="hljs-selector-tag">stTemplateRenderer</span> = <span class="hljs-selector-tag">ObjectUtils</span><span class="hljs-selector-class">.isEmpty</span>(delimiterToken) ?
                <span class="hljs-selector-tag">StTemplateRenderer</span><span class="hljs-selector-class">.builder</span>()<span class="hljs-selector-class">.startDelimiterToken</span>(<span class="hljs-string">'{'</span>)<span class="hljs-selector-class">.endDelimiterToken</span>(<span class="hljs-string">'}'</span>)<span class="hljs-selector-class">.build</span>() :
                <span class="hljs-selector-tag">StTemplateRenderer</span><span class="hljs-selector-class">.builder</span>()<span class="hljs-selector-class">.startDelimiterToken</span>(delimiterToken.<span class="hljs-built_in">charAt</span>(<span class="hljs-number">0</span>))<span class="hljs-selector-class">.endDelimiterToken</span>(delimiterToken.<span class="hljs-built_in">charAt</span>(<span class="hljs-number">1</span>))<span class="hljs-selector-class">.build</span>();

        <span class="hljs-comment">// æ„å»ºæç¤ºè¯ åŒæ—¶å°†å·¥å…·ä¿¡æ¯æ·»åŠ åˆ°æç¤ºè¯æ¨¡æ¿ä¸­</span>
        <span class="hljs-selector-tag">PromptTemplate</span> <span class="hljs-selector-tag">promptTemplate</span> = <span class="hljs-selector-tag">ObjectUtils</span><span class="hljs-selector-class">.isEmpty</span>(promptId) ? <span class="hljs-selector-tag">defaultPromptTemplate</span> : <span class="hljs-selector-tag">PromptTemplate</span><span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.template</span>(promptInfoService.<span class="hljs-built_in">getPromptInfoById</span>(promptId).<span class="hljs-built_in">getContent</span>())
                <span class="hljs-comment">// è‡ªå®šä¹‰æ¨¡æ¿åˆ†éš”ç¬¦ï¼ˆé¿å…ä¸ JSON å†²çª ) é»˜è®¤åˆ†éš”ç¬¦ {} å¯èƒ½ä¸ JSON è¯­æ³•å†²çªï¼Œå¯ä¿®æ”¹ä¸º &lt;&gt;</span>
                <span class="hljs-selector-class">.renderer</span>(stTemplateRenderer)
                <span class="hljs-selector-class">.variables</span>(Map.<span class="hljs-built_in">of</span>(<span class="hljs-string">"tools"</span>, <span class="hljs-built_in">getMcpToolsDefinition</span>()))
                <span class="hljs-selector-class">.build</span>();

        <span class="hljs-selector-tag">VectorStore</span> <span class="hljs-selector-tag">vectorStore</span> = <span class="hljs-selector-tag">vectorStoreComponent</span><span class="hljs-selector-class">.getVectorStore</span>();

        <span class="hljs-selector-tag">RetrievalAugmentationAdvisor</span> <span class="hljs-selector-tag">augmentationAdvisor</span> = <span class="hljs-selector-tag">RetrievalAugmentationAdvisor</span><span class="hljs-selector-class">.builder</span>()
                <span class="hljs-comment">// é˜¶æ®µä¸€ï¼šä¼˜åŒ–ç”¨æˆ·é—®é¢˜ å°†å•ä¸ªæŸ¥è¯¢æ‰©å±•ä¸ºå¤šä¸ªç›¸å…³æŸ¥è¯¢</span>
                <span class="hljs-selector-class">.queryExpander</span>(query -&gt; data.<span class="hljs-built_in">getQueryExpander</span>() ? <span class="hljs-built_in">queryExpander</span>(chatClient, query.<span class="hljs-built_in">text</span>()) : List.<span class="hljs-built_in">of</span>(query))
                <span class="hljs-comment">// é˜¶æ®µäºŒï¼š æ ¹æ®æŸ¥è¯¢æ£€ç´¢ç›¸å…³æ–‡æ¡£ æ ¹æ®æ‰©å±•åçš„æŸ¥è¯¢è¿›è¡Œæ£€ç´¢ é»˜è®¤ä¼šä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡ŒæŸ¥è¯¢</span>
                <span class="hljs-selector-class">.documentRetriever</span>(query -&gt; <span class="hljs-built_in">similaritySearch</span>(data.<span class="hljs-built_in">getTopK</span>(), data.<span class="hljs-built_in">getSimilarityThreshold</span>(), query.<span class="hljs-built_in">text</span>(), data.<span class="hljs-built_in">getKnowledgeDocId</span>(), vectorStore))
                <span class="hljs-comment">// é˜¶æ®µä¸‰ï¼šåˆå¹¶æ¥è‡ªå¤šä¸ªæŸ¥è¯¢ç»“æœ åˆå¹¶å¤šæŸ¥è¯¢/å¤šæ•°æ®æºçš„æ£€ç´¢ç»“æœï¼Œå»é‡</span>
                <span class="hljs-selector-class">.documentJoiner</span>(new <span class="hljs-built_in">ConcatenationDocumentJoiner</span>())
                <span class="hljs-comment">// é˜¶æ®µå››ï¼šå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œåç½®å¤„ç† å¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œåå¤„ç†ï¼Œå¦‚é‡æ’åº</span>
                <span class="hljs-selector-class">.documentPostProcessors</span>((query, documents) -&gt; data.<span class="hljs-built_in">getRerank</span>() ? <span class="hljs-built_in">documentRerank</span>(documents, query.<span class="hljs-built_in">text</span>()) : documents)
                <span class="hljs-comment">// é˜¶æ®µäº”ï¼šæŸ¥è¯¢å¢å¼ºé˜¶æ®µ å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸Šä¸‹æ–‡èå…¥åŸå§‹æŸ¥è¯¢ ç”Ÿæˆæœ€ç»ˆçš„prompt promptä¸­è¦åŒ…å« context å’Œ query åˆ†åˆ«ä»£è¡¨ä¸Šä¸‹æ–‡å’ŒæŸ¥è¯¢</span>
                <span class="hljs-selector-class">.queryAugmenter</span>(ContextualQueryAugmenter.<span class="hljs-built_in">builder</span>()
                        .<span class="hljs-built_in">documentFormatter</span>(documents -&gt; documents.<span class="hljs-built_in">stream</span>()
                                .<span class="hljs-built_in">map</span>(e -&gt; {
                                    String temp = <span class="hljs-string">""</span>"
                                            æ ‡é¢˜: %s
                                            å†…å®¹: %s
                                            <span class="hljs-string">""</span>";
                                    Map&lt;String, Object&gt; metadata = e.<span class="hljs-built_in">getMetadata</span>();
                                    String titleExpander = CollectionUtils.<span class="hljs-built_in">isEmpty</span>(metadata) ? <span class="hljs-string">"æ— æ ‡é¢˜"</span> : (metadata.<span class="hljs-built_in">containsKey</span>(<span class="hljs-string">"titleExpander"</span>) ? metadata.<span class="hljs-built_in">get</span>(<span class="hljs-string">"titleExpander"</span>).<span class="hljs-built_in">toString</span>() : <span class="hljs-string">"æ— æ ‡é¢˜"</span>);
                                    return String.<span class="hljs-built_in">format</span>(temp, titleExpander, e.<span class="hljs-built_in">getText</span>());
                                })
                                .<span class="hljs-built_in">reduce</span>((a, b) -&gt; a + <span class="hljs-string">"\n\n"</span> + b)
                                .<span class="hljs-built_in">orElse</span>(<span class="hljs-string">"æœªæ£€æµ‹åˆ°ç›¸å…³çŸ¥è¯†"</span>))
                        <span class="hljs-comment">// å…è®¸ç©ºä¸Šä¸‹æ–‡ å¦‚æœä¸ºtrueçš„è¯ å½“ä¸Šä¸‹æ–‡ä¸ºç©º æ¨¡å‹ä¼šè·³è¿‡ä¸Šä¸‹æ–‡ ä½¿ç”¨è‡ªå·±çš„çŸ¥è¯†è¿›è¡Œå›ç­”</span>
                        .<span class="hljs-built_in">allowEmptyContext</span>(false)
                        .<span class="hljs-built_in">emptyContextPromptTemplate</span>(emptyContextPrompt)
                        .<span class="hljs-built_in">promptTemplate</span>(promptTemplate)
                        .<span class="hljs-built_in">build</span>())
                <span class="hljs-selector-class">.build</span>();

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
                <span class="hljs-selector-class">.user</span>(data.<span class="hljs-built_in">getText</span>())
                <span class="hljs-selector-class">.toolCallbacks</span>(toolCallbackProvider)
                <span class="hljs-selector-class">.advisors</span>(MessageChatMemoryAdvisor.<span class="hljs-built_in">builder</span>(jdbcChatMemory).<span class="hljs-built_in">build</span>(), augmentationAdvisor)
                <span class="hljs-selector-class">.advisors</span>(a -&gt; a.<span class="hljs-built_in">param</span>(ChatMemory.CONVERSATION_ID, data.<span class="hljs-built_in">getConversationId</span>()))
                <span class="hljs-selector-class">.stream</span>()
                <span class="hljs-selector-class">.chatResponse</span>()
                <span class="hljs-selector-class">.map</span>(e -&gt; e.<span class="hljs-built_in">getResult</span>().<span class="hljs-built_in">getOutput</span>())
                <span class="hljs-selector-class">.takeWhile</span>(assistantMessage -&gt; IS_STREAM.<span class="hljs-built_in">getOrDefault</span>(data.<span class="hljs-built_in">getConversationId</span>(), true))
                <span class="hljs-selector-class">.onErrorResume</span>(throwable -&gt; Flux.<span class="hljs-built_in">just</span>(AssistantMessage.<span class="hljs-built_in">builder</span>().<span class="hljs-built_in">content</span>(String.<span class="hljs-built_in">format</span>(<span class="hljs-string">"æ¨¡å‹è°ƒç”¨å¼‚å¸¸ %s"</span>, throwable.<span class="hljs-built_in">getCause</span>().<span class="hljs-built_in">getMessage</span>())).<span class="hljs-built_in">build</span>()))
                <span class="hljs-selector-class">.doFinally</span>(d -&gt; IS_STREAM.<span class="hljs-built_in">remove</span>(data.<span class="hljs-built_in">getConversationId</span>()));

    }
</code></pre>
<h2 data-id="heading-11">æœ€åæˆå“</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b81a4065cfdb4fffb7745b2a450d601d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060081&amp;x-signature=cRw81ZS9w8PINwmafbWFwMXdpKM%3D" alt="image" loading="lazy"/><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c11a547d39a1424ab00ae9bcf3485521~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060081&amp;x-signature=SN%2BkeZh0xlj3%2FoxACGqk%2FDz2zso%3D" alt="image" loading="lazy"/><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d69acf16d43148a3a13bac1bbf48026f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769060081&amp;x-signature=%2BL6ZvI2Yz5EgOn1yMoNEoIzgtC0%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[cloudflare+honoæ¡†æ¶å®ç°jwtTokenè®¤è¯ï¼Œå¹¶ä»tokenä¸­æ‹¿åˆ°è®¤è¯ä¿¡æ¯]]></title>    <link>https://juejin.cn/post/7595033052797468713</link>    <guid>https://juejin.cn/post/7595033052797468713</guid>    <pubDate>2026-01-15T03:44:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595033052797468713" data-draft-id="7595056696517410835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="cloudflare+honoæ¡†æ¶å®ç°jwtTokenè®¤è¯ï¼Œå¹¶ä»tokenä¸­æ‹¿åˆ°è®¤è¯ä¿¡æ¯"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-15T03:44:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024å°ç¥"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            cloudflare+honoæ¡†æ¶å®ç°jwtTokenè®¤è¯ï¼Œå¹¶ä»tokenä¸­æ‹¿åˆ°è®¤è¯ä¿¡æ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024å°ç¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T03:44:40.000Z" title="Thu Jan 15 2026 03:44:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘çš„å¼€æºé¡¹ç›®PakePluså¯ä»¥å°†ç½‘é¡µ/Vue/Reacté¡¹ç›®æ‰“åŒ…ä¸ºæ¡Œé¢/æ‰‹æœºåº”ç”¨å¹¶ä¸”å°äº5Måªéœ€å‡ åˆ†é’Ÿï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpakeplus.com" target="_blank" title="https://pakeplus.com" ref="nofollow noopener noreferrer">pakeplus.com</a></p><p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ec935ece46e4797a482aabac9635e05~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1986" loading="lazy"/></p><p/>
<p>é¦–å…ˆæ˜¯ç”¨jwtTokenç”Ÿæˆtokenï¼Œè¿™ä¸ªjwtæ˜¯åœ¨honoä¸­å·²ç»é›†æˆå¥½äº†å¾—ï¼Œç›´æ¥å¼•å…¥å³å¯ä½¿ç”¨ï¼Œä½¿ç”¨çš„æ—¶å€™ä¼ å…¥è¦è®¤è¯çš„ä¿¡æ¯å’Œå¯†é’¥å³å¯ï¼Œç”Ÿæˆtokené€»è¾‘ï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/957c79ffdb50485e89b864c83cbef095~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2482" loading="lazy"/></p>
<p>ä½¿ç”¨çš„æ—¶å€™ï¼šç›´æ¥ä¼ å…¥idå’Œemailï¼Œç„¶åå¯†é’¥æ˜¯é…ç½®åœ¨envç¯å¢ƒå˜é‡ä¸­çš„</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7c6b594138144aa7b3e86c850fb8d710~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2068" loading="lazy"/></p>
<p>è¿™æ ·å°±ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼ŒåŒ…æ‹¬ç™»é™†çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9227f9fb2a154a239b9ac97757ad2a2b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1934" loading="lazy"/></p>
<p>ç”Ÿæˆçš„tokenï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1cf9dc4b0044493b120e196abad70d5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1794" loading="lazy"/></p>
<p/>
<p>ç„¶åå°±æ˜¯é…ç½®è®¤è¯ä¸­é—´ä»¶ï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/03806638f9fc49c2ab1ead1cdfddef7e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1666" loading="lazy"/></p>
<p>åœ¨éœ€è¦è®¤è¯çš„è·¯ç”±ä¸­ï¼Œæ·»åŠ è¿™ä¸ªä¸­é—´ä»¶ï¼Œè¿™ä¸ªè·¯ç”±å°±éœ€è¦æºå¸¦è®¤è¯åçš„tokenæ‰å¯ä»¥è®¿é—®ï¼Œä¸æ·»åŠ è¿™ä¸ªä¸­é—´ä»¶çš„è·¯ç”±ï¼Œå°±ä¸ç”¨æºå¸¦tokenï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e9a48674fda41db82605dbb92bdc094~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1546" loading="lazy"/></p>
<p>è®¤è¯è¿‡åï¼Œå°±å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸­æ‹¿åˆ°è®¤è¯çš„userIdå’Œemailä¿¡æ¯ï¼š</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0670a5d722064faa8b579b11abc47d49~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1872" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç°ä»£ React è·¯ç”±å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7595142737514004507</link>    <guid>https://juejin.cn/post/7595142737514004507</guid>    <pubDate>2026-01-15T04:03:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142737514004507" data-draft-id="7594655863547920436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç°ä»£ React è·¯ç”±å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-15T04:03:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ‰æ„ä¹‰"/> <meta itemprop="url" content="https://juejin.cn/user/1739866211617625"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç°ä»£ React è·¯ç”±å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739866211617625/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ‰æ„ä¹‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T04:03:43.000Z" title="Thu Jan 15 2026 04:03:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»å‰çš„å‰ç«¯</h2>
<p>åœ¨å¾ˆä¹…ä¹‹å‰çš„é¡µé¢ä¸Šï¼Œæˆ‘ä»¬ç‚¹å‡»åï¼Œæµè§ˆå™¨ä¼šæœ‰ç™½å±ä¸€æ®µæ—¶é—´ï¼Œé¡µé¢çš„è·³è½¬æ˜¯åç«¯å¹²çš„äº‹</p>
<p>ä½†æ˜¯åæ¥ï¼Œå‰ç«¯è‡´åŠ›äºç”¨æˆ·çš„ä½“éªŒï¼Œè·¯ç”±æ¸æ¸çš„è½åˆ°äº†å‰ç«¯çš„èº«ä¸Šã€‚ä¸‹é¢æˆ‘ä¼šæ ¹æ®ä¸€ä¸ªtodoså°åº”ç”¨æ¥è¯´æ˜è·¯ç”±çš„ä½œç”¨</p>
<h2 data-id="heading-1">ä¸¤ç§è·¯ç”±å½¢å¼</h2>
<p>åœ¨ React Router ä¸­ï¼Œ<code>HashRouter</code>Â å’ŒÂ <code>BrowserRouter</code>Â æ˜¯ä¸¤ç§å¸¸è§çš„è·¯ç”±å®ç°æ–¹å¼ã€‚</p>
<h3 data-id="heading-2">HashRouter</h3>
<p><code>HashRouter</code>Â çš„ URL ä¼šå¸¦ä¸€ä¸ªÂ <code>#</code>ï¼Œæ¯”å¦‚Â <code>/#/about</code></p>
<p>çœ‹èµ·æ¥æ²¡é‚£ä¹ˆæ¸…çˆ½ï¼Œä½†å®ƒéå¸¸å…¨èƒ½ï¼Œä¸éœ€è¦åç«¯é…åˆï¼Œå…¼å®¹æ€§æå¥½ï¼Œè¿è€æ—§çš„ IE æµè§ˆå™¨éƒ½èƒ½è·‘</p>
<p>ç‰¹åˆ«é€‚åˆéƒ¨ç½²åœ¨ GitHub Pages è¿™ç±»æ— æ³•è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®çš„é™æ€æ‰˜ç®¡ç¯å¢ƒã€‚</p>
<blockquote>
<p>è¿™ä¸ª  â€˜#â€™ çœ‹èµ·æ¥ä¼šä¸ä¼šæœ‰ç‚¹â€˜ä¸‘â€™ï¼Ÿ</p>
</blockquote>
<h3 data-id="heading-3">BroswerRouter</h3>
<p>è€ŒÂ <code>BrowserRouter</code>Â ä½¿ç”¨çš„æ˜¯æ ‡å‡†çš„è·¯å¾„å½¢å¼ï¼Œå¦‚Â <code>/about</code></p>
<p>å’Œä¼ ç»Ÿåç«¯è·¯ç”±ä¸€è‡´ï¼ŒURL æ›´å¹²å‡€ã€å¯è¯»æ€§æ›´å¼ºï¼Œä¹Ÿæ›´åˆ©äº SEO</p>
<p>ä½†å®ƒä¾èµ– HTML5 çš„ History API</p>
<p>IE11 åŠæ›´æ—©ç‰ˆæœ¬ä¸æ”¯æŒï¼ˆä¸è¿‡å¦‚ä»Šä¸»æµæµè§ˆå™¨éƒ½å·²å…¨é¢æ”¯æŒï¼‰</p>
<p>é…åˆè·¯ç”±çš„æ‡’åŠ è½½èƒ½åŠ›ï¼Œæ¯”å¦‚ç”¨Â <code>React.lazy</code>Â +Â <code>Suspense</code>ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°è®¿é—®Â <code>/</code>Â æ—¶åªåŠ è½½ Home ç»„ä»¶ï¼Œè®¿é—®Â <code>/about</code>Â æ—¶æ‰åŠ è½½ About ç»„ä»¶ï¼Œå…¶ä»–é¡µé¢ä»£ç <strong>æŒ‰éœ€åŠ è½½</strong>ï¼Œ<strong>æ—¢æå‡äº†é¦–å±æ€§èƒ½ï¼Œåˆä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒ</strong></p>
<blockquote>
<p>å› æ­¤ï¼Œåœ¨ç°ä»£é¡¹ç›®ä¸­ï¼Œåªè¦èƒ½æ§åˆ¶æœåŠ¡å™¨ï¼ˆæˆ–ä½¿ç”¨ Vercelã€Netlify ç­‰æ™ºèƒ½æ‰˜ç®¡å¹³å°ï¼‰ï¼Œä¼˜å…ˆé€‰æ‹©Â <code>BrowserRouter</code>ï¼›è‹¥ç¯å¢ƒå—é™æˆ–éœ€æè‡´å…¼å®¹ï¼Œå†é€€è€Œä½¿ç”¨Â <code>HashRouter</code>ã€‚</p>
</blockquote>
<h2 data-id="heading-4">æ‡’åŠ è½½</h2>
<blockquote>
<p>æ‡’åŠ è½½ï¼Œå°±æ˜¯<strong>ç”¨åˆ°å†åŠ è½½</strong>ã€‚</p>
</blockquote>
<p>åœ¨ React é¡¹ç›®é‡Œï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œæ‰€æœ‰é¡µé¢çš„ä»£ç ï¼ˆæ¯”å¦‚é¦–é¡µã€ä¸ªäººä¸­å¿ƒã€å•†å“è¯¦æƒ…ç­‰ï¼‰éƒ½ä¼šè¢«æ‰“åŒ…è¿›ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç”¨æˆ·ä¸€æ‰“å¼€ç½‘ç«™å°±å¾—å…ˆä¸‹è½½è¿™ä¸ªå¤§åŒ…ï¼Œå“ªæ€•ä»–åªçœ‹é¦–é¡µã€‚</p>
<p>è€Œç”¨äº†Â <code>React.lazy</code>Â é…åˆÂ <code>import()</code>Â ä¹‹åï¼Œæ¯ä¸ªé¡µé¢ä¼šè¢«æ‹†æˆç‹¬ç«‹çš„å°æ–‡ä»¶ï¼Œåªæœ‰å½“ç”¨æˆ·çœŸæ­£è®¿é—®é‚£ä¸ªè·¯ç”±æ—¶ï¼Œæµè§ˆå™¨æ‰å»è¯·æ±‚å¯¹åº”çš„ä»£ç ã€‚æ¯”å¦‚æˆ‘çš„todos</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/Home'</span>)); <span class="hljs-comment">// åˆ†äº«é“¾æ¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/About'</span>))<span class="hljs-comment">// æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProfile</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/UserProfile'</span>))
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Product</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/product'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductDetail</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/product/ProductDetail'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">NewProduct</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/product/NewProduct'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Login</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/Login'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ProtectRoute</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'../components/ProtectRoute'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Pay</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/Pay'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">NotFound</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/NotFound'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">NewPath</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/NewPath'</span>));
</code></pre>
<p>æ‡’åŠ è½½åï¼Œé¦–å±åŠ è½½å¿«å¤šäº†ï¼Œå°¤å…¶å¯¹ç½‘é€Ÿæ…¢æˆ–è€…ç”¨æ‰‹æœºçš„ç”¨æˆ·ç‰¹åˆ«å‹å¥½ã€‚</p>
<p>é…åˆÂ <code>&lt;Suspense&gt;</code>Â åŒ…ä¸€å±‚ï¼Œè¿˜èƒ½åœ¨åŠ è½½æ—¶æ˜¾ç¤ºä¸ªè½¬åœˆæˆ–æç¤ºï¼Œé¿å…ç™½å±å¡é¡¿ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„ï¼Œ<strong>æ‡’åŠ è½½åªæ”¯æŒé»˜è®¤å¯¼å‡ºï¼ˆ<code>export default</code>ï¼‰</strong>ï¼Œè€Œä¸”ä¸€èˆ¬ç”¨åœ¨è·¯ç”±çº§åˆ«æœ€åˆé€‚</p>
<p>å¤ªç»†äº†  æ¯”å¦‚ä¸€ä¸ªé¡µé¢é‡Œæ¯ä¸ªæŒ‰é’®ã€æ¯ä¸ªå°ç»„ä»¶éƒ½å•ç‹¬æ‡’åŠ è½½ã€‚</p>
<p><strong>ç»“æœï¼šç”¨æˆ·æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œæµè§ˆå™¨è¦å‘ 10 ä¸ªã€20 ä¸ªå°è¯·æ±‚å»åŠ è½½ç¢ç‰‡ä»£ç ï¼Œåè€Œæ›´æ…¢ï¼ˆHTTP è¯·æ±‚æœ¬èº«æœ‰å¼€é”€ï¼‰ã€‚åè€Œä¼šå‘å¤ªå¤šå°è¯·æ±‚</strong></p>
<p>å¤ªç²—æ¯”å¦‚æŠŠæ‰€æœ‰é¡µé¢æ‰“åŒ…æˆä¸¤ä¸‰ä¸ªå¤§å—ï¼Œé‚£é¦–å±è¿˜æ˜¯å¾—ä¸‹å¾ˆå¤šç”¨ä¸åˆ°çš„ä»£ç ï¼Œ</p>
<p><strong>å¤±å»äº†æ‡’åŠ è½½çš„æ„ä¹‰åˆèµ·ä¸åˆ°ä¼˜åŒ–æ•ˆæœã€‚æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ç°ä»£ React åº”ç”¨æå‡æ€§èƒ½ã€ä¼˜åŒ–ä½“éªŒçš„ä¸€ä¸ªåŸºæœ¬æ“ä½œã€‚</strong></p>
<h2 data-id="heading-5">è·¯ç”±çš„ç§ç±»</h2>
<p>åœ¨ä¸€ä¸ªReacté¡¹ç›®ä¸­ï¼Œè·¯ç”±ä¸€èˆ¬æ”¾åœ¨routeræ–‡ä»¶å¤¹ç›®å½•ä¸‹</p>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨å®æˆ˜æ¡ˆä¾‹æ¥è®²è§£ä»¥ä¸‹é›†ä¸­è·¯ç”±ï¼š</p>
<h3 data-id="heading-6">æ™®é€šè·¯ç”±ï¼š</h3>
<p>è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œä¸åŒ…å«å‚æ•°ã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span>} /&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;</span> 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Login</span> /&gt;</span>} /&gt;</span>
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“ç”¨æˆ·è®¿é—®Â <code>/about</code>æ—¶ï¼Œå°±æ˜¾ç¤ºÂ <code>About</code>Â ç»„ä»¶ã€‚</p>
<p>è¿™é‡Œçš„è·¯å¾„æ˜¯å†™æ­»çš„ï¼Œä¸€ä¸€å¯¹åº”ï¼Œæœ€ç®€å•ç›´æ¥ã€‚</p>
<h3 data-id="heading-7">åŠ¨æ€è·¯ç”±ï¼ˆDynamic Routeï¼‰</h3>
<p>è·¯å¾„ä¸­åŒ…å«<strong>å˜é‡å‚æ•°</strong>ï¼Œç”¨Â <code>:å‚æ•°å</code>Â è¡¨ç¤ºã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/user/:id"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span>} /&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">":productId"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">ProductDetail</span> /&gt;</span>}/&gt;</span>
</code></pre>
<p>åœ¨æˆ‘ä»¬è®¿é—®/user/123æ—¶ ï¼šidçš„å€¼å°±æ˜¯123</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶UserProfileæˆ–ProductDetailé‡Œ ï¼Œå¯ä»¥é€šè¿‡useParams()æ‹¿åˆ°å‚æ•°</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12f02aaf296a43fd9630c45f2e139d84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769054669&amp;x-signature=B2InCluM8y5fjOFGgC3uUVaS6t8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">åµŒå¥—è·¯ç”±ï¼ˆNested Routesï¼‰ + Outlet</h3>
<p>çˆ¶è·¯ç”±åŒ…å«å­è·¯ç”±ï¼Œå…±äº«å¸ƒå±€ï¼Œå­è·¯ç”±å†…å®¹é€šè¿‡Â <code>Outlet</code>Â æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/products"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Product</span>/&gt;</span></span>}&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">":productId"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">ProductDetail</span> /&gt;</span>}/&gt;</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"new"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NewProduct</span> /&gt;</span>}/&gt;</span>
&lt;/<span class="hljs-title class_">Route</span>&gt;
</code></pre>
<p>æ¯”å¦‚è¯´æˆ‘ä»¬è®¿é—® /product ä¼šæ˜¾ç¤ºProduct</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a98af0ae6e24092843ab7e3162cb432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769054669&amp;x-signature=eoKeqQq9OEpsEJMxKKx%2FaVVUE7M%3D" alt="image.png" loading="lazy"/></p>
<p>è®¿é—®/product/123 ä»ç„¶æ˜¾ç¤ºProduct</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b084cfb33cc4eb3918ad00909e03015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769054669&amp;x-signature=0qhBv4gTGZ2QBqayi8DxmQ0Xbjk%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>åµŒå¥—è·¯ç”±çš„å¥½å¤„ï¼šå¤ç”¨å¸ƒå±€ï¼ˆæ¯”å¦‚ä¾§è¾¹æ ã€å¯¼èˆªæ ï¼‰ï¼Œé¿å…é‡å¤å†™ç»“æ„ã€‚</p>
</blockquote>
<h3 data-id="heading-9">é‰´æƒè·¯ç”±ï¼ˆProtected Routeï¼‰</h3>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/pay"</span> element={
          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProtectRoute</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Pay</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">ProtectRoute</span>&gt;</span></span>
        }&gt;
        &lt;/<span class="hljs-title class_">Route</span>&gt;
</code></pre>
<p><strong>è®¿é—®å—ä¿æŠ¤é¡µé¢ï¼ˆå¦‚Â <code>/pay</code>ï¼‰</strong></p>
<p>React æ¸²æŸ“Â </p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">ProtectRoute</span>&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Pay</span> /&gt;</span></span>&lt;/<span class="hljs-title class_">ProtectRoute</span>&gt;
</code></pre>
<p>è€Œåœ¨ProtectRouteé‡Œå†™äº†ä»¥ä¸‹é€»è¾‘ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx">  <span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'isLogin'</span>) === <span class="hljs-string">'true'</span>;
  <span class="hljs-keyword">if</span> (!isLoggedIn) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span>/&gt;</span></span>
  }
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{children}<span class="hljs-tag">&lt;/&gt;</span></span>
    )
</code></pre>
<p>ProtectRouteÂ ç«‹åˆ»è¯»å–Â  localStorage.getItem('isLogin')</p>
<p>å¦‚æœå€¼æ˜¯Â <code>'true'</code>Â â†’ æ˜¾ç¤ºÂ <code>&lt;Pay /&gt;</code></p>
<p>å¦‚æœæ˜¯Â <code>null</code>Â æˆ–Â <code>'false'</code>Â â†’ è·³è½¬åˆ°Â <code>/login</code>
è¿™ä¸ªé€»è¾‘å®ç°äº†â€œæœªç™»å½•è·³è½¬åˆ°ç™»å½•é¡µï¼Œå·²ç™»å½•å°±æ˜¾ç¤ºå†…å®¹â€çš„æ ¸å¿ƒåŠŸèƒ½</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¿…é¡»çŸ¥é“ï¼Œè¿™ä¸ªé‰´æƒåªèƒ½é˜²æ­¢ç”¨æˆ·çš„è¯¯æ“ä½œï¼Œå®‰å…¨ç³»æ•°å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œå³ä½¿å‰ç«¯ç”¨äº†æ›´å…ˆè¿›çš„æ–¹æ³•ï¼Œè¿™ä¸ªä¸æ˜¯è¿™ç¯‡æ–‡ç« è¦è®²çš„äº†ã€‚</p>
<h3 data-id="heading-10">é‡å®šå‘è·¯ç”±ï¼ˆRedirect / Navigateï¼‰</h3>
<p>æŠŠç”¨æˆ·ä»ä¸€ä¸ªæ—§è·¯å¾„è‡ªåŠ¨è·³è½¬åˆ°æ–°è·¯å¾„ã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/old-path"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">replace</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/new-path"</span>/&gt;</span></span>}/&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/new-path"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NewPath</span> /&gt;</span>}/&gt;</span>
</code></pre>
<p>æˆ‘ä»¬åœ¨ç‚¹å‡»Â <code>&lt;Navigate replace to="/new-path" /&gt;</code>Â æ—¶</p>
<p>æµè§ˆå™¨ä¸ä¼šæŠŠæ—§è·¯å¾„Â <code>/old-path</code>Â ç•™åœ¨å†å²è®°å½•ä¸­ï¼Œè€Œæ˜¯ç›´æ¥ç”¨æ–°è·¯å¾„Â <code>/new-path</code>Â <strong>æ›¿æ¢å½“å‰è®°å½•</strong>ã€‚</p>
<p>è¿™æ„å‘³ç€ç”¨æˆ·ç‚¹å‡»â€œè¿”å›â€æŒ‰é’®æ—¶ï¼Œä¸ä¼šå›åˆ°Â <code>/old-path</code>ï¼Œè€Œæ˜¯è·³è½¬åˆ°æ›´æ—©çš„é¡µé¢ã€‚</p>
<p>è¿™ç§æœºåˆ¶åŸºäº History API çš„Â <code>replaceState</code>ï¼Œå¸¸ç”¨äºé¡µé¢æ”¹åã€ç™»å½•è·³è½¬æˆ–é¦–é¡µé‡å®šå‘ç­‰åœºæ™¯ï¼Œé¿å…æ— æ•ˆæˆ–å†—ä½™çš„å†å²æ¡ç›®ï¼Œè®©æµè§ˆå™¨çš„å‰è¿›/åé€€è¡Œä¸ºæ›´è‡ªç„¶ã€æ›´ç¬¦åˆé¢„æœŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01948ff8fba0490eba2b141ce548e967~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769054669&amp;x-signature=Kg4YYO03WpkeSCa5QgLaomzmU3E%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p>æˆ‘ä»¬ä»å‰ç«¯æ¥ç®¡è·¯ç”±å¼€å§‹ï¼Œé¡µé¢è·³è½¬ä¸å†ä¾èµ–åç«¯åˆ·æ–°ï¼Œè€Œæ˜¯é€šè¿‡ React Router å®ç°æµç•…çš„æ— åˆ·æ–°å¯¼èˆªã€‚</p>
<p>é…åˆæ‡’åŠ è½½ï¼Œåº”ç”¨æŒ‰éœ€åŠ è½½é¡µé¢ä»£ç ï¼Œ<strong>æ˜¾è‘—æå‡äº†é¦–å±é€Ÿåº¦</strong>ï¼›æ™®é€šè·¯ç”±ã€åŠ¨æ€è·¯ç”±ã€åµŒå¥—è·¯ç”±ç­‰çµæ´»ç»„åˆï¼Œ<strong>æ»¡è¶³å„ç§åœºæ™¯éœ€æ±‚</strong>ï¼›é‰´æƒè·¯ç”±æ‹¦æˆªæœªç™»å½•è®¿é—®ï¼Œé‡å®šå‘è·¯ç”±å¤„ç†è·¯å¾„å˜æ›´</p>
<p>è¿™äº›èƒ½åŠ›å…±åŒæ„å»ºäº†ç°ä»£ React åº”ç”¨é«˜æ•ˆã€å‹å¥½ä¸”ç»“æ„æ¸…æ™°çš„å¯¼èˆªä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cookie åŸç†è¯¦è§£ï¼šDomain / Path / SameSite ä¸€æ­¥é”™ï¼Œç”Ÿäº§ç¯å¢ƒç›´æ¥ç¿»è½¦]]></title>    <link>https://juejin.cn/post/7595033052797403177</link>    <guid>https://juejin.cn/post/7595033052797403177</guid>    <pubDate>2026-01-15T03:35:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595033052797403177" data-draft-id="7595033052797091881" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cookie åŸç†è¯¦è§£ï¼šDomain / Path / SameSite ä¸€æ­¥é”™ï¼Œç”Ÿäº§ç¯å¢ƒç›´æ¥ç¿»è½¦"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨"/> <meta itemprop="datePublished" content="2026-01-15T03:35:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æœ¨æª¾"/> <meta itemprop="url" content="https://juejin.cn/user/2450163496400541"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cookie åŸç†è¯¦è§£ï¼šDomain / Path / SameSite ä¸€æ­¥é”™ï¼Œç”Ÿäº§ç¯å¢ƒç›´æ¥ç¿»è½¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450163496400541/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æœ¨æª¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T03:35:24.000Z" title="Thu Jan 15 2026 03:35:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Cookie åŸç†è¯¦è§£ï¼šDomain / Path / SameSite ä¸€æ­¥é”™ï¼Œç”Ÿäº§ç¯å¢ƒç›´æ¥ç¿»è½¦</h2>
<blockquote>
<p><strong>å…³é”®è¯</strong>ï¼šCookie åŸç†ã€Cookie Domainã€Cookie Pathã€Cookie SameSiteã€ç”Ÿäº§ç¯å¢ƒ Cookie å†²çª</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">æ‘˜è¦</h3>
<p>Cookie æ˜¯å‰ç«¯å’Œåç«¯éƒ½ä¼šé¢‘ç¹ä½¿ç”¨çš„åŸºç¡€æœºåˆ¶ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯<strong>ç”Ÿäº§ç¯å¢ƒäº‹æ•…çš„é«˜å‘åŒº</strong>ã€‚</p>
<p>å¾ˆå¤šå¼€å‘è€…åœ¨è®¾ç½® Cookie æ—¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£ç†è§£ <strong>Cookie çš„ä½œç”¨åŸŸè§„åˆ™</strong>ï¼Œå°¤å…¶æ˜¯ <code>Domain</code>ã€<code>Path</code> å’Œ <code>SameSite</code> çš„çœŸå®è¡Œä¸ºï¼Œæœ€ç»ˆå¯¼è‡´ <strong>ç”Ÿäº§ / æµ‹è¯• Cookie å†²çªã€ç™»å½•æ€å¼‚å¸¸ã€Chrome ä¸‹ Cookie ç¥ç§˜ä¸¢å¤±</strong> ç­‰é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†ä» <strong>æµè§ˆå™¨çœŸå®å®ç°</strong> å‡ºå‘ï¼Œç³»ç»Ÿè®²æ¸… <strong>Cookie åŸç†ã€Cookie Domainã€Cookie SameSite çš„ä½œç”¨å’Œå‘ç‚¹</strong>ï¼Œå¹¶ç»™å‡ºä¸€å¥—å¯ç›´æ¥è½åœ°çš„å·¥ç¨‹å®è·µæ–¹æ¡ˆã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä¸ºä»€ä¹ˆ Cookie æ˜¯ç”Ÿäº§ç¯å¢ƒçš„â€œéšæ€§äº‹æ•…åŒºâ€</h3>
<p>å¾ˆå¤šäººä»¥ä¸º Cookie å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-http" lang="http">Set-Cookie: token=xxx
</code></pre>
<p>ä½†åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œå¸¸è§é—®é¢˜åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒç™»å½•æ€äº’ç›¸è¦†ç›–</li>
<li>æœ‰äº›ç”¨æˆ·æ­£å¸¸ï¼Œæœ‰äº›ç”¨æˆ· 403</li>
<li>Chrome DevTools é‡Œåªçœ‹åˆ°ä¸€æ¡ Cookieï¼Œä½†è¡Œä¸ºä¸å¯¹</li>
<li>SameSite ä¸€åŠ ï¼Œæ•´ä¸ªç³»ç»Ÿç™»å½•æ€æ¶ˆå¤±</li>
</ul>
<p>ğŸ‘‰ <strong>é—®é¢˜ä¸åœ¨ Cookie æœ¬èº«ï¼Œè€Œåœ¨å¯¹ Cookie åŸç†çš„è¯¯è§£ã€‚</strong></p>
<hr/>
<h3 data-id="heading-3">äºŒã€Cookie çš„çœŸå®ä½œç”¨åŸŸï¼šæµè§ˆå™¨åªè®¤è¿™ä¸‰ä»¶äº‹</h3>
<blockquote>
<p><strong>Cookie æ˜¯å¦ä¼šå†²çªï¼Œåªç”±è¿™ä¸‰ä¸ªç»´åº¦å†³å®šï¼š</strong></p>
</blockquote>
<ul>
<li><code>name</code></li>
<li><code>domain</code></li>
<li><code>path</code></li>
</ul>
<p><strong>å®Œå…¨ä¸€è‡´ â†’ è¦†ç›–</strong><br/>
<strong>ä»»æ„ä¸åŒ â†’ å¹¶å­˜</strong></p>
<p>âš ï¸ æµè§ˆå™¨<strong>æ ¹æœ¬ä¸çŸ¥é“</strong>ä»€ä¹ˆæ˜¯ã€Œç”Ÿäº§ / æµ‹è¯•ç¯å¢ƒã€ã€‚</p>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€Cookie Domain çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæœ€å®¹æ˜“å‡ºé—®é¢˜</h3>
<h4 data-id="heading-5">1ï¸âƒ£ ä¸è®¾ç½® Domain â‰  è®¾ç½®å½“å‰åŸŸåï¼ˆåå¸¸è¯†ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">Set-Cookie: <span class="hljs-attr">token</span>=abc
</code></pre>
<p>è¿™æ˜¯ <strong>Host-only Cookie</strong>ï¼š</p>
<ul>
<li>ä»…å½“å‰å®Œæ•´åŸŸåå¯ç”¨</li>
<li>å­åŸŸå®Œå…¨ä¸å¯è®¿é—®</li>
<li>âœ… æœ€å®‰å…¨ã€æœ€æ¨è</li>
</ul>
<p>è€Œä¸‹é¢è¿™ç§å†™æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Set-Cookie: <span class="hljs-attr">token</span>=abc<span class="hljs-comment">; Domain=example.com</span>
</code></pre>
<p>ğŸ‘‰ ä¼šå¯¼è‡´ <strong>æ‰€æœ‰å­åŸŸå…±äº« Cookie</strong></p>
<p>ğŸ“Œ <strong>è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒ Cookie å†²çªçš„ç¬¬ä¸€å¤§æ ¹æºã€‚</strong></p>
<hr/>
<h4 data-id="heading-6">2ï¸âƒ£ Domain=example.com å’Œ Domain=.example.com æœ‰åŒºåˆ«å—ï¼Ÿ</h4>
<p><strong>æ²¡æœ‰ã€‚</strong></p>
<p>åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä¸¤è€…è¡Œä¸ºå®Œå…¨ç­‰ä»·ï¼Œéƒ½ä¼šå˜æˆï¼š</p>
<pre><code class="hljs">.example.com
</code></pre>
<p>ç”Ÿæ•ˆèŒƒå›´åŒ…æ‹¬ï¼š</p>
<ul>
<li>example.com</li>
<li>test.example.com</li>
<li>a.b.example.com</li>
</ul>
<p>ğŸ“Œ å”¯ä¸€åŒºåˆ«åœ¨äºï¼š<br/>
<code>.example.com</code> çš„å¯è¯»æ€§æ›´å¼ºï¼Œä¸å®¹æ˜“è¢«è¯¯è§£ã€‚</p>
<hr/>
<h4 data-id="heading-7">3ï¸âƒ£ ä¸ºä»€ä¹ˆä¸»åŸŸåä¼šå¯¼è‡´ç”Ÿäº§ / æµ‹è¯• Cookie å†²çª</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Domain</span>=.example.com
<span class="hljs-attr">token</span>=xxx
</code></pre>
<p>ç­‰ä»·äºå‘Šè¯‰æµè§ˆå™¨ï¼š</p>
<blockquote>
<p><strong>â€œè¿™æ˜¯ä¸€ä¸ªå…¨åŸŸå…±äº« Cookieâ€</strong></p>
</blockquote>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<ul>
<li>test ç™»å½• â†’ prod æ‰çº¿</li>
<li>prod ç™»å½• â†’ test ä¸²å·</li>
</ul>
<hr/>
<h3 data-id="heading-8">å››ã€Cookie Pathï¼šä½ ä»¥ä¸ºåœ¨éš”ç¦»ï¼Œå…¶å®æ²¡æœ‰</h3>
<pre><code class="hljs language-ini" lang="ini">Set-Cookie: <span class="hljs-attr">token</span>=abc<span class="hljs-comment">; Path=/</span>
</code></pre>
<p>ğŸ‘‰ <code>/api</code>ã€<code>/test</code>ã€<code>/prod</code> éƒ½èƒ½è®¿é—®</p>
<pre><code class="hljs language-ini" lang="ini">Set-Cookie: <span class="hljs-attr">token</span>=abc<span class="hljs-comment">; Path=/test</span>
</code></pre>
<p>ğŸ‘‰ <code>/test/api</code> ä¾ç„¶èƒ½è®¿é—®</p>
<p>âš ï¸ <strong>Path éš”ç¦»éå¸¸è„†å¼±ï¼Œä¸é€‚åˆä½œä¸ºç¯å¢ƒéš”ç¦»æ–¹æ¡ˆã€‚</strong></p>
<hr/>
<h3 data-id="heading-9">äº”ã€Cookie å¹¶ä¸æ€»æ˜¯â€œè¦†ç›–â€ï¼Œè€Œæ˜¯â€œå¹¶å­˜ + éšæœºå‘½ä¸­â€</h3>
<h4 data-id="heading-10">åœºæ™¯ç¤ºä¾‹</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">token</span>=OLD<span class="hljs-comment">; Domain=.example.com</span>
<span class="hljs-attr">token</span>=NEW<span class="hljs-comment">; Path=/</span>
</code></pre>
<p>æµè§ˆå™¨ä¸­ä¼šåŒæ—¶å­˜åœ¨ä¸¤æ¡ Cookieã€‚</p>
<p>è¯·æ±‚æ—¶å¯èƒ½æ˜¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Cookie: <span class="hljs-attr">token</span>=NEW<span class="hljs-comment">; token=OLD</span>
</code></pre>
<p>ä¹Ÿå¯èƒ½æ˜¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Cookie: <span class="hljs-attr">token</span>=OLD<span class="hljs-comment">; token=NEW</span>
</code></pre>
<p>âš ï¸ <strong>é¡ºåºä¸ä¿è¯ä¸€è‡´</strong></p>
<p>å¦‚æœåç«¯ä»£ç æ˜¯ï¼š</p>
<pre><code class="hljs">req.cookies.token
</code></pre>
<p>ğŸ‘‰ <strong>å–å€¼å…·æœ‰éšæœºæ€§ï¼Œçº¿ä¸Šäº‹æ•…å°±æ­¤è¯ç”Ÿã€‚</strong></p>
<hr/>
<h3 data-id="heading-11">å…­ã€ä¸ºä»€ä¹ˆ Chrome DevTools çœ‹ä¸åˆ°å¤šæ¡ Cookieï¼Ÿ</h3>
<blockquote>
<p><strong>Application â†’ Cookies é¢æ¿æ˜¯â€œå¯è§æ€§è§†å›¾â€ï¼Œä¸æ˜¯â€œçœŸå®å­˜å‚¨è§†å›¾â€ã€‚</strong></p>
</blockquote>
<ul>
<li>å…±äº«åŸŸ Cookie ä¼šè¢«æŠ˜å æ˜¾ç¤º</li>
<li>çœ‹èµ·æ¥åªæœ‰ä¸€æ¡</li>
<li><strong>Network é¢æ¿é‡Œçš„ Request Headers æ‰æ˜¯æœ€ç»ˆçœŸç›¸</strong></li>
</ul>
<p>ğŸ“Œ åˆ¤æ–­ Cookie æ˜¯å¦ç”Ÿæ•ˆï¼Œä¸€å®šè¦çœ‹ Networkã€‚</p>
<hr/>
<h3 data-id="heading-12">ä¸ƒã€Cookie SameSite æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸€å†™å°±å‡ºé—®é¢˜</h3>
<h4 data-id="heading-13">1ï¸âƒ£ SameSite çš„ä½œç”¨</h4>
<blockquote>
<p><strong>æ§åˆ¶è·¨ç«™è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨æ˜¯å¦æºå¸¦ Cookie</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-14">2ï¸âƒ£ ä¸‰ç§ SameSite æ¨¡å¼</h4>





















<table><thead><tr><th>SameSite</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td>Strict</td><td>æ‰€æœ‰è·¨ç«™è¯·æ±‚ä¸å¸¦ Cookie</td></tr><tr><td>Laxï¼ˆé»˜è®¤ï¼‰</td><td>å…è®¸å¤–é“¾ GET</td></tr><tr><td>None</td><td>å…¨æ”¾å¼€ï¼ˆå¿…é¡» httpsï¼‰</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-15">3ï¸âƒ£ æœ€å®¹æ˜“è¸©çš„ SameSite å‘</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">SameSite</span>=None
</code></pre>
<p>ä½†å¿˜äº†å†™ï¼š</p>
<pre><code class="hljs">Secure
</code></pre>
<p>ğŸ‘‰ <strong>Cookie ä¼šè¢«æµè§ˆå™¨ç›´æ¥ä¸¢å¼ƒï¼ˆä¸æŠ¥é”™ï¼‰</strong></p>
<p>æµ‹è¯•ç¯å¢ƒ http æ›´æ˜¯ 100% å¤±æ•ˆã€‚</p>
<hr/>
<h3 data-id="heading-16">å…«ã€ä¸€æ¬¡çœŸå®çš„ Cookie Domain è¿ç§»äº‹æ•…å¤ç›˜</h3>
<h4 data-id="heading-17">æ—§ç‰ˆæœ¬</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Domain</span>=.example.com
</code></pre>
<h4 data-id="heading-18">æ–°ç‰ˆæœ¬</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸å†è®¾ç½® Domain</span>
</code></pre>
<p>âš ï¸ å¦‚æœ<strong>æ²¡æœ‰æ¸…ç†å†å² Cookie</strong>ï¼š</p>
<ul>
<li>æ–°è€ Cookie å¹¶å­˜</li>
<li>è€ç”¨æˆ·éšæœºå¼‚å¸¸</li>
<li>æ¸…ç¼“å­˜ç«‹åˆ»å¥½ï¼ˆå‡è±¡ï¼‰</li>
</ul>
<h4 data-id="heading-19">æ­£ç¡®è¿ç§»æ–¹å¼</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å…ˆåˆ é™¤æ—§çš„å…±äº« Cookie</span>
Set-Cookie: <span class="hljs-attr">token</span>=<span class="hljs-comment">; Max-Age=0; Domain=.example.com; Path=/</span>

<span class="hljs-comment"># å†è®¾ç½®æ–°çš„ Host-only Cookie</span>
Set-Cookie: <span class="hljs-attr">token</span>=NEW<span class="hljs-comment">; Path=/</span>
</code></pre>
<hr/>
<h3 data-id="heading-20">ä¹ã€document.cookie è®¾ç½® Cookie èƒ½åšä»€ä¹ˆï¼Ÿ</h3>
<h4 data-id="heading-21">èƒ½åšçš„</h4>
<ul>
<li>è®¾ç½®æ™®é€š Cookie</li>
<li>æ¸…ç†å†å²é—ç•™ Cookie</li>
</ul>
<h4 data-id="heading-22">ä¸èƒ½åšçš„</h4>
<ul>
<li>âŒ HttpOnly</li>
<li>âŒ é«˜å®‰å…¨çº§ç™»å½•æ€</li>
</ul>
<p>ğŸ‘‰ <strong>ç™»å½•æ€ Cookie æ°¸è¿œä¼˜å…ˆåç«¯ Set-Cookieã€‚</strong></p>
<hr/>
<h3 data-id="heading-23">åã€ç”Ÿäº§ç¯å¢ƒ Cookie æœ€ä½³å®è·µï¼ˆå¯ç›´æ¥æŠ„ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">Set-Cookie:
  <span class="hljs-attr">token</span>=xxx<span class="hljs-comment">;</span>
  <span class="hljs-attr">Path</span>=/<span class="hljs-comment">;</span>
  HttpOnly<span class="hljs-comment">;</span>
  Secure<span class="hljs-comment">;</span>
  <span class="hljs-attr">SameSite</span>=Lax
<span class="hljs-comment"># ä¸è®¾ç½® Domain</span>
</code></pre>
<h4 data-id="heading-24">æ°¸è¿œè°¨æ…ä½¿ç”¨</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Domain</span>=.example.com
<span class="hljs-attr">SameSite</span>=None
</code></pre>
<hr/>
<h3 data-id="heading-25">åä¸€ã€æ€»ç»“</h3>
<blockquote>
<p><strong>Cookie ä»æ¥ä¸æŒ‰â€œç¯å¢ƒâ€éš”ç¦»ï¼ŒåªæŒ‰è§„åˆ™éš”ç¦»ã€‚</strong></p>
<p>ä¸€æ¬¡éšæ„çš„ Domain æˆ– SameSite è®¾ç½®ï¼Œè¶³ä»¥åœ¨æœªæ¥æŸä¸ªç‰ˆæœ¬å¼•çˆ†ç”Ÿäº§äº‹æ•…ã€‚</p>
</blockquote>
<hr/>
<p>å¦‚æœä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°è¿‡ <strong>Cookie å†²çªã€Cookie è¦†ç›–ã€Cookie ä¸¢å¤±ã€Cookie SameSite å¤±æ•ˆ</strong> ç­‰é—®é¢˜ï¼Œ<br/>
å‡ ä¹éƒ½å¯ä»¥ä»æœ¬æ–‡æåˆ°çš„ <strong>Cookie Domain å’Œ SameSite åŸç†</strong> ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¸©å‘å®å½•ï¼šæŠŠ useRef å†™è¿› JSX åï¼Œæˆ‘ç»ˆäºåˆ†æ¸…å®ƒå’Œ useState çš„æ ¸å¿ƒå·®å¼‚]]></title>    <link>https://juejin.cn/post/7595142737514266651</link>    <guid>https://juejin.cn/post/7595142737514266651</guid>    <pubDate>2026-01-15T05:03:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142737514266651" data-draft-id="7595163067904589833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¸©å‘å®å½•ï¼šæŠŠ useRef å†™è¿› JSX åï¼Œæˆ‘ç»ˆäºåˆ†æ¸…å®ƒå’Œ useState çš„æ ¸å¿ƒå·®å¼‚"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-15T05:03:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…¨æ ˆæ‰“æ€ªæ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/2269028453720813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¸©å‘å®å½•ï¼šæŠŠ useRef å†™è¿› JSX åï¼Œæˆ‘ç»ˆäºåˆ†æ¸…å®ƒå’Œ useState çš„æ ¸å¿ƒå·®å¼‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2269028453720813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…¨æ ˆæ‰“æ€ªæ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:03:30.000Z" title="Thu Jan 15 2026 05:03:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œä¸º React æ–°æ‰‹ï¼Œåˆšæ¥è§¦ Hooks æ—¶ï¼Œå¾ˆå®¹æ˜“æ··æ·† <code>useState</code> å’Œ <code>useRef</code>â€”â€”ä¸¤è€…éƒ½èƒ½å­˜å‚¨æ•°æ®ï¼Œé‚£åˆ°åº•è¯¥æ€ä¹ˆé€‰ï¼Ÿ</p>
<p>æˆ‘æœ€è¿‘é€šè¿‡ä¸€ä¸ªã€Œç‚¹å‡»è®¡æ•°ã€çš„ç®€å•ç»ƒä¹ ï¼Œç»“åˆä¸€ä¸ªå…³é”®ç–‘é—®ï¼Œå½»åº•ç†æ¸…äº†å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« å°±æŠŠæˆ‘çš„å­¦ä¹ è¿‡ç¨‹å’Œç†è§£åˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›èƒ½å¸®åˆ°åŒæ ·å›°æƒ‘çš„å°ä¼™ä¼´ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å…ˆä»ä¸€ä¸ªæç®€ç»ƒä¹ ç¤ºä¾‹å…¥æ‰‹</h2>
<p>æˆ‘æœ€åˆçš„éœ€æ±‚å¾ˆç®€å•ï¼šåšä¸€ä¸ªç‚¹å‡»è®¡æ•°ç»„ä»¶ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªåŠŸèƒ½ï¼š</p>
<ol>
<li>æ˜¾ç¤ºã€Œå½“å‰è½®æ¬¡ç‚¹å‡»æ•°ã€ï¼Œæ”¯æŒé‡ç½®ï¼›</li>
<li>æ˜¾ç¤ºã€Œé¡µé¢åŠ è½½åçš„æ€»ç‚¹å‡»æ•°ã€ï¼Œé‡ç½®å½“å‰è½®æ¬¡åæ€»æ¬¡æ•°ä¸æ¸…é›¶ã€‚</li>
</ol>
<p>ç»“åˆ <code>useState</code> å’Œ <code>useRef</code>ï¼Œæœ€ç»ˆå†™å‡ºäº†è¿™æ ·çš„ä»£ç ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">import { useState, useRef } from 'react'<span class="hljs-comment">;</span>

function ClickCounter() {
  // useStateï¼šå­˜å‚¨å½“å‰è½®æ¬¡ç‚¹å‡»æ•°ï¼ˆé©±åŠ¨è§†å›¾æ›´æ–°ï¼‰
  const <span class="hljs-section">[currentCount, setCurrentCount]</span> = useState(0)<span class="hljs-comment">;</span>
  
  // useRefï¼šå­˜å‚¨æ€»ç‚¹å‡»æ•°ï¼ˆæŒä¹…åŒ–ä¿å­˜ï¼Œä¿®æ”¹ä¸è§¦å‘é‡æ¸²æŸ“ï¼‰
  const <span class="hljs-attr">totalCountRef</span> = useRef(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>

  // ç‚¹å‡»è®¡æ•°ï¼šåŒæ—¶æ›´æ–°ä¸¤ä¸ªæ•°æ®
  const <span class="hljs-attr">handleClick</span> = () =&gt; {
    // æ›´æ–°å½“å‰è½®æ¬¡è®¡æ•°ï¼ˆè§¦å‘é‡æ¸²æŸ“ï¼‰
    setCurrentCount(<span class="hljs-attr">prev</span> =&gt; prev + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
    
    // æ›´æ–°æ€»è®¡æ•°ï¼ˆç›´æ¥ä¿®æ”¹ currentï¼Œä¸è§¦å‘é‡æ¸²æŸ“ï¼‰
    totalCountRef.current += 1<span class="hljs-comment">;</span>
    
    // æ§åˆ¶å°æ‰“å°æ€»è®¡æ•°ï¼ŒéªŒè¯æ•°æ®
    console.log('æ€»ç‚¹å‡»æ•°ï¼ˆrefï¼‰ï¼š', totalCountRef.current)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  // é‡ç½®å½“å‰è½®æ¬¡è®¡æ•°ï¼ˆæ€»è®¡æ•°ä¸å˜ï¼‰
  const <span class="hljs-attr">handleResetCurrent</span> = () =&gt; {
    setCurrentCount(0)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">style</span>={ç‚¹å‡»è®¡æ•°ç»ƒä¹ å½“å‰è½®æ¬¡ç‚¹å‡»æ•°ï¼š{currentCount}æ€»ç‚¹å‡»æ•°ï¼ˆæŒä¹…åŒ–ï¼‰ï¼š{totalCountRef.current}&lt;button <span class="hljs-literal">on</span>Click={ }}&gt;
        ç‚¹å‡»è®¡æ•°
      &lt;button <span class="hljs-attr">onClick</span>={handleResetCurrent}&gt;
        é‡ç½®å½“å‰è®¡æ•°
      
  )<span class="hljs-comment">;</span>
}

export default function App() {
  return &lt;ClickCounter /&gt;<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-1">äºŒã€æˆ‘çš„æ ¸å¿ƒç–‘é—®ï¼šuseRef ä¸æ˜¯ä¸èƒ½é©±åŠ¨è§†å›¾å—ï¼Ÿä¸ºä»€ä¹ˆèƒ½å†™åœ¨ JSX é‡Œï¼Ÿ</h2>
<p>å†™å®Œä»£ç åï¼Œæˆ‘ç«‹åˆ»äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼š</p>
<blockquote>
<p>ä¹‹å‰å­¦ä¹ æ—¶çŸ¥é“ <code>useRef</code> ç”¨äºå­˜å‚¨ä¸éœ€è¦é©±åŠ¨è§†å›¾æ›´æ–°çš„æ•°æ®ï¼Œä¿®æ”¹ <code>ref.current</code> ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ã€‚ä½†è¿™ä¸ªç¤ºä¾‹é‡Œï¼Œæˆ‘æŠŠ <code>totalCountRef.current</code> ç›´æ¥å†™åœ¨äº† JSX é‡Œï¼Œè¿™éš¾é“ä¸çŸ›ç›¾å—ï¼Ÿè¿™æ ·å†™åˆ°åº•æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>è¿™ä¸ªç–‘é—®ä¹Ÿè®©æˆ‘æ„è¯†åˆ°ï¼Œå¾ˆå¤šæ–°æ‰‹å¯¹ <code>useState</code> å’Œ <code>useRef</code> çš„ç†è§£ï¼Œå¯èƒ½éƒ½åœç•™åœ¨ã€Œè¡¨é¢å®šä¹‰ã€ï¼Œæ²¡æœ‰æ·±å…¥åˆ°ã€Œæ¸²æŸ“é€»è¾‘ã€å±‚é¢ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€å½»åº•ææ‡‚ï¼šuseRef å†™åœ¨ JSX é‡Œåˆ°åº•è¡Œä¸è¡Œï¼Ÿ</h2>
<p>å¸¦ç€ç–‘é—®ï¼Œæˆ‘æ¢³ç†äº†æ ¸å¿ƒç»“è®ºï¼Œå†é€šè¿‡ä»£ç æ‰§è¡Œè¿‡ç¨‹éªŒè¯ï¼Œç»ˆäºå½»åº•æ˜ç™½ï¼š</p>
<h3 data-id="heading-3">1. è¯­æ³•ä¸Šï¼šå®Œå…¨æ²¡é—®é¢˜</h3>
<p>React çš„ JSX æ”¯æŒåµŒå…¥ä»»æ„åˆæ³•çš„ JavaScript è¡¨è¾¾å¼ï¼Œ<code>totalCountRef.current</code> æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JS å˜é‡ï¼ˆæˆ–æ•°å€¼ã€å­—ç¬¦ä¸²ç­‰ï¼‰ï¼Œæ‰€ä»¥æŠŠå®ƒå†™åœ¨ JSX é‡Œä¸ä¼šæŠ¥é”™ï¼Œå±äºåˆæ³•å†™æ³•ã€‚</p>
<h3 data-id="heading-4">2. åŠŸèƒ½ä¸Šï¼šèƒ½æ˜¾ç¤ºä½†ä¸èƒ½ã€Œä¸»åŠ¨é©±åŠ¨æ›´æ–°ã€</h3>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€ç‚¹â€”â€”<code>useRef</code> çš„å€¼å¯ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œä½†ä¿®æ”¹å®ƒä¸ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼Œå› æ­¤é¡µé¢ä¸Šçš„æ˜¾ç¤ºå€¼ä¸ä¼šã€Œå®æ—¶æ›´æ–°ã€ï¼Œåªä¼šæ˜¾ç¤ºç»„ä»¶ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶çš„æ—§å€¼ã€‚</p>
<p>æˆ‘ä»¬ç»“åˆç¤ºä¾‹ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸€æ­¥æ­¥æ‹†è§£ï¼š</p>
<h4 data-id="heading-5">æ­¥éª¤ 1ï¼šç»„ä»¶é¦–æ¬¡æ¸²æŸ“</h4>
<ul>
<li><code>currentCount = 0</code>ï¼ˆ<code>useState</code> åˆå§‹å€¼ï¼‰ï¼›</li>
<li><code>totalCountRef.current = 0</code>ï¼ˆ<code>useRef</code> åˆå§‹å€¼ï¼‰ï¼›</li>
<li>JSX æ¸²æŸ“ç»“æœï¼šå½“å‰è½®æ¬¡ç‚¹å‡»æ•°ï¼š0ï¼Œæ€»ç‚¹å‡»æ•°ï¼š0ã€‚</li>
</ul>
<h4 data-id="heading-6">æ­¥éª¤ 2ï¼šç¬¬ä¸€æ¬¡ç‚¹å‡»ã€Œè®¡æ•°ã€æŒ‰é’®</h4>
<ul>
<li>æ‰§è¡Œ <code>setCurrentCount(prev =&gt; prev + 1)</code>ï¼šä¿®æ”¹ <code>useState</code> çŠ¶æ€ï¼Œ<strong>è§¦å‘ç»„ä»¶é‡æ¸²æŸ“</strong>ï¼›</li>
<li>æ‰§è¡Œ <code>totalCountRef.current += 1</code>ï¼š<code>totalCountRef.current</code> å˜æˆ 1ï¼Œä½†è¿™ä¸ªä¿®æ”¹ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼›</li>
<li>å› ä¸º <code>useState</code> è§¦å‘äº†é‡æ¸²æŸ“ï¼ŒJSX ä¼šé‡æ–°è¯»å–æ‰€æœ‰å€¼ï¼Œæ­¤æ—¶æ€»ç‚¹å‡»æ•°æ˜¾ç¤ºä¸º 1ï¼ˆ<strong>è¿™é‡Œèƒ½æ›´æ–°æ˜¯å› ä¸º useState å¸¦åŠ¨äº†æ¸²æŸ“ï¼Œä¸æ˜¯ useRef è‡ªå·±é©±åŠ¨çš„</strong>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">æ­¥éª¤ 3ï¼šéªŒè¯ã€Œåªæ”¹ useRef ä¸è§¦å‘æ›´æ–°ã€</h4>
<p>ä¸ºäº†æ›´ç›´è§‚éªŒè¯ï¼Œæˆ‘åŠ äº†ä¸€ä¸ªã€Œåªä¿®æ”¹æ€»è®¡æ•°ã€çš„æŒ‰é’®ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{</span> <span class="hljs-attr">totalCountRef.current</span> += <span class="hljs-string">1}</span>&gt;</span>åªæ”¹æ€»è®¡æ•°
</code></pre>
<p>ç‚¹å‡»è¿™ä¸ªæŒ‰é’®åï¼š</p>
<ul>
<li>æ§åˆ¶å°æ‰“å° <code>totalCountRef.current</code>ï¼Œä¼šå‘ç°æ•°å€¼ç¡®å®å¢åŠ äº†ï¼›</li>
<li>ä½†é¡µé¢ä¸Šçš„æ€»ç‚¹å‡»æ•°æ²¡æœ‰ä»»ä½•å˜åŒ–â€”â€”å› ä¸ºæ²¡æœ‰ä¿®æ”¹ <code>useState</code> çŠ¶æ€ï¼Œç»„ä»¶æ²¡æœ‰é‡æ¸²æŸ“ï¼ŒJSX é‡Œçš„ <code>totalCountRef.current</code> è¿˜æ˜¯ä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ—§å€¼ã€‚</li>
</ul>
<h2 data-id="heading-8">å››ã€useState ä¸ useRef çš„æ ¸å¿ƒå·®å¼‚æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸ªç¤ºä¾‹å’Œç–‘é—®ï¼Œæˆ‘ç»ˆäºç†æ¸…äº†ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ï¼Œç”¨è¡¨æ ¼æ€»ç»“æœ€æ¸…æ™°ï¼š</p>



































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>useState</th><th>useRef</th></tr></thead><tbody><tr><td>æ ¸å¿ƒä½œç”¨</td><td>å­˜å‚¨é©±åŠ¨è§†å›¾æ›´æ–°çš„çŠ¶æ€</td><td>å­˜å‚¨æŒä¹…åŒ–ã€ä¸é©±åŠ¨è§†å›¾çš„æ•°æ®</td></tr><tr><td>ä¿®æ”¹åæ˜¯å¦è§¦å‘é‡æ¸²æŸ“</td><td>æ˜¯ï¼ˆè°ƒç”¨ setXxx å¿…è§¦å‘ï¼‰</td><td>å¦ï¼ˆç›´æ¥æ”¹ current ä¸è§¦å‘ï¼‰</td></tr><tr><td>æ•°æ®æ›´æ–°æ–¹å¼</td><td>ä¸å¯å˜æ›´æ–°ï¼ˆå¿…é¡»ç”¨ setXxxï¼‰</td><td>å¯å˜æ›´æ–°ï¼ˆç›´æ¥æ”¹ currentï¼‰</td></tr><tr><td>å†™åœ¨ JSX é‡Œçš„æ•ˆæœ</td><td>å®æ—¶æ›´æ–°æ˜¾ç¤º</td><td>ä¸ä¸»åŠ¨æ›´æ–°ï¼Œéœ€ä¾èµ–å…¶ä»–é€»è¾‘è§¦å‘æ¸²æŸ“</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>é¡µé¢éœ€è¦å®æ—¶æ˜¾ç¤ºçš„æ•°æ®ï¼ˆè®¡æ•°ã€è¡¨å•å€¼ã€åˆ—è¡¨ç­‰ï¼‰</td><td>å®šæ—¶å™¨ IDã€DOM å…ƒç´ å¼•ç”¨ã€æŒä¹…åŒ–ä¸æ˜¾ç¤ºçš„çŠ¶æ€ï¼ˆå¦‚æ€»ç‚¹å‡»æ•°ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-9">äº”ã€æ–°æ‰‹é¿å‘æŒ‡å—</h2>
<p>æ¢³ç†å®Œè¿™äº›å†…å®¹åï¼Œæˆ‘æ€»ç»“äº†å‡ ä¸ªæ–°æ‰‹å®¹æ˜“è¸©çš„å‘ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š</p>
<h3 data-id="heading-10">1. ä¸è¦ç”¨ useRef å­˜å‚¨éœ€è¦å®æ—¶æ˜¾ç¤ºçš„æ•°æ®</h3>
<p>å¦‚æœæ•°æ®éœ€è¦åœ¨é¡µé¢ä¸Šå®æ—¶æ›´æ–°ï¼ˆæ¯”å¦‚å½“å‰è½®æ¬¡ç‚¹å‡»æ•°ï¼‰ï¼Œä¸€å®šè¦ç”¨ <code>useState</code>ã€‚ç”¨ <code>useRef</code> åªä¼šå¯¼è‡´é¡µé¢æ˜¾ç¤ºæ»åã€‚</p>
<h3 data-id="heading-11">2. ä¸è¦è¯¯ä»¥ä¸º useRef ä¸èƒ½å†™åœ¨ JSX é‡Œ</h3>
<p>è¯­æ³•ä¸Šå®Œå…¨å¯ä»¥å†™ï¼Œä½†è¦æ¸…æ¥šå®ƒçš„å±€é™æ€§â€”â€”ä¸èƒ½ä¸»åŠ¨é©±åŠ¨æ›´æ–°ã€‚åªæœ‰æ•°æ®ä¸å¸¸å˜åŒ–ï¼ˆå¦‚å›ºå®š IDã€åˆå§‹åŒ–åçš„å¸¸é‡ï¼‰æ—¶ï¼Œå†™åœ¨ JSX é‡Œæ‰åˆç†ã€‚</p>
<h3 data-id="heading-12">3. é¿å…æ»¥ç”¨ã€Œå¼ºåˆ¶æ›´æ–°ã€è®© useRef å®æ—¶æ˜¾ç¤º</h3>
<p>å¦‚æœéè¦è®© <code>useRef</code> çš„å€¼å®æ—¶æ˜¾ç¤ºï¼Œæœ‰äººä¼šç”¨ã€Œç©º stateã€å¼ºåˆ¶è§¦å‘æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[, forceUpdate]</span> = useState({})<span class="hljs-comment">;</span>
const <span class="hljs-attr">handleClick</span> = () =&gt; {
  totalCountRef.current += 1<span class="hljs-comment">;</span>
  forceUpdate({})<span class="hljs-comment">; // å¼ºåˆ¶è§¦å‘æ¸²æŸ“</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ç§å†™æ³•è™½ç„¶èƒ½å®ç°æ•ˆæœï¼Œä½†ä¸æ¨èâ€”â€”æ—¢ç„¶éœ€è¦å®æ—¶æ›´æ–°ï¼Œç›´æ¥ç”¨ <code>useState</code> ç®¡ç†æ•°æ®æ›´ç¬¦åˆ React è®¾è®¡ç†å¿µï¼Œä»£ç ä¹Ÿæ›´ç®€æ´ã€‚</p>
<h3 data-id="heading-13">4. æ™®é€šå˜é‡æ— æ³•æ›¿ä»£ useRef åšæŒä¹…åŒ–</h3>
<p>æ–°æ‰‹å¯èƒ½ä¼šæƒ³ï¼šâ€œæ—¢ç„¶ useRef åªæ˜¯æŒä¹…åŒ–æ•°æ®ï¼Œç”¨æ™®é€šå˜é‡ä¸è¡Œå—ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ä¸è¡Œâ€”â€”ç»„ä»¶æ¯æ¬¡é‡æ¸²æŸ“æ—¶ï¼Œå‡½æ•°å†…éƒ¨çš„æ™®é€šå˜é‡éƒ½ä¼šé‡æ–°åˆå§‹åŒ–ï¼ˆæ¯”å¦‚ <code>let totalCount = 0</code> ä¼šæ¯æ¬¡é‡ç½®ä¸º 0ï¼‰ï¼Œè€Œ<code>useRef</code> çš„ <code>current</code> åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¼šä¿ç•™æ•°æ®ã€‚</p>
<h2 data-id="heading-14">å…­ã€æ€»ç»“</h2>
<p>å…¶å® <code>useState</code> å’Œ <code>useRef</code> çš„é€‰æ‹©é€»è¾‘å¾ˆç®€å•ï¼š</p>
<p>å¦‚æœæ•°æ®éœ€è¦é©±åŠ¨è§†å›¾æ›´æ–° â†’ ç”¨ useStateï¼›</p>
<p>å¦‚æœæ•°æ®åªéœ€è¦æŒä¹…ä¿å­˜ã€ä¸éœ€è¦é©±åŠ¨è§†å›¾ â†’ ç”¨ useRefã€‚</p>
<p>è¿™æ¬¡é€šè¿‡ä¸€ä¸ªç®€å•çš„ç»ƒä¹ ç¤ºä¾‹ï¼ŒåŠ ä¸Šè‡ªå·±çš„ç–‘é—®å’Œæ¢³ç†ï¼Œè®©æˆ‘å¯¹è¿™ä¸¤ä¸ª Hooks çš„ç†è§£ä»ã€Œè¡¨é¢è®°å¿†ã€å˜æˆäº†ã€Œæ·±å±‚ç†è§£ã€ã€‚å¸Œæœ›æˆ‘çš„å­¦ä¹ è¿‡ç¨‹èƒ½å¸®åˆ°æ›´å¤šæ–°æ‰‹å°ä¼™ä¼´ï½</p>
<p>å¦‚æœæœ‰ç–‘é—®æˆ–ä¸åŒçœ‹æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å¼€å‘é‡Œæœ€å¸¸ç”¨çš„5ç§æœ¬åœ°å­˜å‚¨]]></title>    <link>https://juejin.cn/post/7595089504618922018</link>    <guid>https://juejin.cn/post/7595089504618922018</guid>    <pubDate>2026-01-15T05:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595089504618922018" data-draft-id="7595108457495625743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å¼€å‘é‡Œæœ€å¸¸ç”¨çš„5ç§æœ¬åœ°å­˜å‚¨"/> <meta itemprop="keywords" content="JavaScript,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-15T05:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŠä¸–è½®å›åŠä¸–å¯»"/> <meta itemprop="url" content="https://juejin.cn/user/3646441975987997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å¼€å‘é‡Œæœ€å¸¸ç”¨çš„5ç§æœ¬åœ°å­˜å‚¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3646441975987997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŠä¸–è½®å›åŠä¸–å¯»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:23:31.000Z" title="Thu Jan 15 2026 05:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘é¡¹ç›®é‡Œåˆåœ¨åå¤çº ç»“æœ¬åœ°æ•°æ®æ€ä¹ˆå­˜æœ€åˆé€‚ï¼Œå°±æƒ³æŠŠå‰ç«¯æ—¥å¸¸æœ€å¸¸ç¢°çš„å‡ ç§å­˜å‚¨æ–¹å¼æ‹ä¸€éã€‚</p>
<p>ä¸ºä»€ä¹ˆå‰ç«¯éœ€è¦æœ¬åœ°å­˜å‚¨ï¼Ÿ<br/>
ç®€å•è¯´ï¼šæå‡æ€§èƒ½ã€æ”¯æŒç¦»çº¿ã€è®°ä½ç”¨æˆ·åå¥½ã€å‡å°‘æœåŠ¡å™¨å‹åŠ›ã€‚<br/>
æ¯”å¦‚åˆ—è¡¨é¡µç”¨æˆ·ç¿»äº†å¥½å‡ é¡µï¼Œä¸‹æ¬¡è¿›æ¥è¿˜æƒ³çœ‹åˆ°ä¸Šæ¬¡ä½ç½®å’Œç­›é€‰ï¼›PWAæ²¡ç½‘ä¹Ÿèƒ½çœ‹ç‚¹å†…å®¹ï¼›ä¸»é¢˜æš—é»‘æ¨¡å¼ã€å­—ä½“å¤§å°è¿™äº›å°ä¸œè¥¿ï¼Œä¸æƒ³æ¯æ¬¡è¯·æ±‚æ¥å£ã€‚<br/>
æœåŠ¡å™¨ä¼ å¤ªæ…¢ï¼Œå†…å­˜å…³é¡µå°±ä¸¢ï¼Œæœ¬åœ°å­˜å‚¨å°±æˆäº†æ—¥å¸¸æ ‡é…ã€‚</p>
<p>ä¼˜ç§€çš„å‰ç«¯æœ¬åœ°å­˜å‚¨è¯¥æœ‰å“ªäº›ç‰¹æ€§ï¼Ÿï¼ˆå‚è€ƒåç«¯æ€è·¯ï¼Œæˆ‘è§‰å¾—å‰ç«¯ä¹Ÿå·®ä¸å¤šï¼‰</p>
<ul>
<li>å®¹é‡å¤Ÿç”¨ï¼ˆåˆ«5MBå°±çˆ†ï¼‰</li>
<li>æŒä¹…æ€§ï¼ˆå…³æµè§ˆå™¨è¿˜èƒ½å‰©å¤šå°‘ï¼‰</li>
<li>æ€§èƒ½ï¼ˆè¯»å†™å¿«ä¸å¿«ï¼ŒåŒæ­¥/å¼‚æ­¥ï¼‰</li>
<li>æ˜“ç”¨æ€§ï¼ˆAPIå‹å¥½ä¸ï¼‰</li>
<li>è·¨æ ‡ç­¾å…±äº«ï¼ˆå¤šæ ‡ç­¾èƒ½ä¸èƒ½åŒæ­¥ï¼‰</li>
<li>ç»“æ„åŒ–æ”¯æŒï¼ˆå¯¹è±¡ã€æ•°ç»„ã€Blobã€å¤§æ–‡ä»¶è¡Œä¸è¡Œï¼‰</li>
<li>å®‰å…¨æ€§ï¼ˆåŒæºã€éšç§æ¨¡å¼ï¼‰</li>
</ul>
<p>åŸºäºè¿™äº›ï¼Œ2026å¹´ç°åœ¨å‰ç«¯é¡¹ç›®é‡Œï¼Œæˆ‘æœ€å¸¸ç”¨æ¥å­˜çš„å…¶å®å°±è¿™5ç§ï¼ˆä»ç®€å•åˆ°å¤æ‚æ’ï¼‰ï¼š</p>
<h3 data-id="heading-0">1. localStorage</h3>
<p>æœ€åŸºç¡€ã€æœ€å¸¸ç”¨ï¼Œå‡ ä¹æ¯ä¸ªé¡¹ç›®éƒ½é€ƒä¸å¼€ã€‚</p>
<p><strong>æ€ä¹ˆç”¨</strong>ï¼ˆå¤§å®¶éƒ½çŸ¥é“ï¼Œä½†è¿˜æ˜¯è´´ä»£ç ï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å­˜</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'userTheme'</span>, <span class="hljs-string">'dark'</span>);

<span class="hljs-comment">// å–</span>
<span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'userTheme'</span>);

<span class="hljs-comment">// åˆ </span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'userTheme'</span>);

<span class="hljs-comment">// æ¸…ç©º</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>();
</code></pre>
<p><strong>å®¹é‡</strong>ï¼šä¸€èˆ¬5MBå·¦å³ï¼ˆChromeã€Safariã€Firefoxå·®ä¸å¤šï¼‰<br/>
<strong>æŒä¹…æ€§</strong>ï¼šæ°¸ä¹…ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨æ¸…æµè§ˆå™¨ç¼“å­˜ã€‚<br/>
<strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šAPIæç®€ï¼ŒåŒæ­¥æ“ä½œï¼Œè·¨æ ‡ç­¾å…±äº«ï¼ˆæ”¹ä¸€ä¸ªï¼Œå…¶ä»–æ ‡ç­¾èƒ½é€šè¿‡storageäº‹ä»¶ç›‘å¬åˆ°ï¼‰</li>
<li>ç¼ºç‚¹ï¼šåªèƒ½å­˜å­—ç¬¦ä¸²ï¼ˆå¯¹è±¡è¦JSON.stringifyï¼‰ï¼ŒåŒæ­¥å¤§ç‚¹æ•°æ®ä¼šå¡ä¸»çº¿ç¨‹ï¼Œéšç§æ¨¡å¼ä¸‹å¯èƒ½è¢«æ¸…ï¼ŒiOS Safariæœ‰æ—¶è«åå…¶å¦™ä¸¢æ•°æ®</li>
</ul>
<p><strong>çœŸå®åœºæ™¯</strong>ï¼šç”¨æˆ·è®¾ç½®ï¼ˆä¸»é¢˜ã€ä¾§è¾¹æ çŠ¶æ€ï¼‰ã€tokenåº”æ€¥å­˜ã€ç®€å•è´­ç‰©è½¦è‰ç¨¿</p>
<h3 data-id="heading-1">2. sessionStorage</h3>
<p>è·ŸlocalStorageå‡ ä¹ä¸€æ ·ï¼Œä½†ä¼šè¯çº§ã€‚</p>
<p><strong>ä»£ç </strong>ï¼šæŠŠlocalStorageæ¢æˆsessionStorageå°±è¡Œï¼Œç”¨æ³•ä¸€æ¨¡ä¸€æ ·ã€‚<br/>
<strong>å®¹é‡</strong>ï¼š5MBå·¦å³<br/>
<strong>æŒä¹…æ€§</strong>ï¼šæ ‡ç­¾é¡µå…³äº†å°±æ²¡äº†ï¼ˆåŒçª—å£æ–°tabå…±äº«ï¼‰<br/>
<strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸´æ—¶æ•°æ®ä¸æ±¡æŸ“é•¿æœŸï¼Œå®‰å…¨æ€§ç¨å¥½ï¼ˆè‡ªåŠ¨é”€æ¯ï¼‰</li>
<li>ç¼ºç‚¹ï¼šä¸èƒ½è·¨æ ‡ç­¾æŒä¹…å…±äº«</li>
</ul>
<h3 data-id="heading-2">3. IndexedDB</h3>
<p>å¤§å®¹é‡ã€ç»“æ„åŒ–æ•°æ®çš„ç‹è€…ï¼ŒPWA/ç¦»çº¿å¿…å¤‡ï¼Œç°åœ¨ä¸­å¤§å‹é¡¹ç›®è¶Šæ¥è¶Šå¤šå¾€è¿™å„¿æ¬ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•</strong>ï¼ˆåŸç”ŸAPIå•°å—¦ï¼Œå®é™…æˆ‘åŸºæœ¬ç”¨dexie.jsæˆ–idbå°è£…ï¼Œè¿™é‡Œå…ˆè´´åŸç”Ÿï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ‰“å¼€æ•°æ®åº“</span>
<span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'myAppDB'</span>, <span class="hljs-number">1</span>);

request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
  db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'todos'</span>, { <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span>, <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> });
};

request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
  <span class="hljs-comment">// æ“ä½œ...</span>
};

<span class="hljs-comment">// å­˜æ•°æ®ï¼ˆäº‹åŠ¡ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params">todo</span>) {
  <span class="hljs-keyword">const</span> tx = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'todos'</span>, <span class="hljs-string">'readwrite'</span>);
  <span class="hljs-keyword">const</span> store = tx.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'todos'</span>);
  store.<span class="hljs-title function_">add</span>(todo);
}
</code></pre>
<p><strong>å®¹é‡</strong>ï¼šå¾ˆå¤§ï¼Œé€šå¸¸å‡ ç™¾MBåˆ°GBï¼ˆè§†ç£ç›˜ç©ºé—´ï¼Œæµè§ˆå™¨é…é¢ç®¡ç†ï¼Œè¿œè¶…5MBï¼‰<br/>
<strong>æŒä¹…æ€§</strong>ï¼šæ°¸ä¹…ï¼Œä½†ç©ºé—´ç´§å¼ æ—¶æµè§ˆå™¨å¯èƒ½æ¸…ï¼ˆæ¯”localStorageéš¾æ¸…ï¼‰<br/>
<strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¼‚æ­¥ä¸å¡çº¿ç¨‹ã€æ”¯æŒå¤æ‚å¯¹è±¡/Blob/æ–‡ä»¶ã€ç´¢å¼•æŸ¥è¯¢ã€äº‹åŠ¡</li>
<li>ç¼ºç‚¹ï¼šåŸç”ŸAPIå›è°ƒåœ°ç‹±ï¼Œå­¦ä¹ æ›²çº¿é™¡ï¼ˆæ¨èå°è£…ï¼‰</li>
</ul>
<h3 data-id="heading-3">4. Cache APIï¼ˆé…åˆService Workerï¼‰</h3>
<p>èµ„æºç¼“å­˜ç¥å™¨ï¼ŒPWAæ€§èƒ½æ ¸å¿ƒã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•</strong>ï¼ˆå¿…é¡»åœ¨sw.jsé‡Œï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// sw.js installäº‹ä»¶</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  event.<span class="hljs-title function_">waitUntil</span>(
    caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">'my-app-v1'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">addAll</span>([
        <span class="hljs-string">'/styles.css'</span>,
        <span class="hljs-string">'/app.js'</span>,
        <span class="hljs-string">'/images/logo.png'</span>
      ]);
    })
  );
});

<span class="hljs-comment">// fetchæ‹¦æˆª</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> response || <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
    })
  );
});
</code></pre>
<p><strong>å®¹é‡</strong>ï¼šè·ŸIndexedDBä¸€æ ·ï¼Œå—é…é¢ç®¡ç†ï¼Œå¾ˆå¤§<br/>
<strong>æŒä¹…æ€§</strong>ï¼šæŒä¹…ï¼Œä½†å¯è¢«æµè§ˆå™¨æ¸…ç†<br/>
<strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸“ä¸ºèµ„æºè®¾è®¡ï¼ˆhtml/css/js/imgï¼‰ï¼Œæ‹¦æˆªè¯·æ±‚æ–¹ä¾¿ï¼Œæ”¯æŒç¦»çº¿ç§’å¼€</li>
<li>ç¼ºç‚¹ï¼šåªèƒ½å­˜Request/Responseï¼Œä¸é€‚åˆä¸šåŠ¡JSONï¼›ä¾èµ–Service Workerï¼ˆhttpsæˆ–localhostï¼‰</li>
</ul>
<p><strong>çœŸå®åœºæ™¯</strong>ï¼šPWAå£³å­ã€é™æ€èµ„æºç¦»çº¿ã€å›¾ç‰‡æ‡’åŠ è½½å¤‡ç”¨ã€H5é¡µé¢ç¼“å­˜</p>
<h3 data-id="heading-4">5. å†…å­˜ç¼“å­˜ï¼ˆJSå¯¹è±¡/Map + ç®€å•LRUï¼‰</h3>
<p>é¡µé¢å†…æœ€å¿«ï¼Œä¸´æ—¶æ•°æ®é¦–é€‰ã€‚</p>
<p><strong>ç®€å•å®ç°</strong>ï¼ˆé¡¹ç›®é‡Œå¸¸ç”¨mini LRUï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleLRU</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">max = <span class="hljs-number">100</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> = max;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }
  <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">has</span>(key)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">delete</span>(key);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">set</span>(key, value);
    <span class="hljs-keyword">return</span> value;
  }
  <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">has</span>(key)) <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">delete</span>(key);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">set</span>(key, value);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>) {
      <span class="hljs-keyword">const</span> oldest = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">delete</span>(oldest);
    }
  }
}

<span class="hljs-comment">// ç”¨æ³•</span>
<span class="hljs-keyword">const</span> pageCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleLRU</span>(<span class="hljs-number">50</span>);
pageCache.<span class="hljs-title function_">set</span>(<span class="hljs-string">'userListPage1'</span>, data);
</code></pre>
<p><strong>å®¹é‡</strong>ï¼šå†…å­˜å¤§å°ï¼Œå–å†³äºJSå †<br/>
<strong>æŒä¹…æ€§</strong>ï¼šé¡µé¢åˆ·æ–°/å…³é—­å°±æ²¡äº†<br/>
<strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šçº³ç§’çº§ã€æ— åºåˆ—åŒ–ã€æœ€å¿«</li>
<li>ç¼ºç‚¹ï¼šä¸æŒä¹…ã€å†…å­˜æ³„æ¼é£é™©</li>
</ul>
<p><strong>æ•´ä½“å¯¹æ¯”ä¸€å›¾æ¦‚è§ˆ</strong></p>





























































<table><thead><tr><th>ç»´åº¦</th><th>localStorage</th><th>sessionStorage</th><th>IndexedDB</th><th>Cache API</th><th>å†…å­˜ç¼“å­˜</th></tr></thead><tbody><tr><td>æ˜“ç”¨æ€§</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜†â˜†â˜†</td><td>â˜…â˜…â˜…â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜†</td></tr><tr><td>å®¹é‡</td><td>â˜…â˜…â˜†â˜†â˜† (5MB)</td><td>â˜…â˜…â˜†â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜†â˜†â˜†â˜†</td></tr><tr><td>æŒä¹…æ€§</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜†â˜†â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜…â˜…â˜†</td><td>â˜…â˜†â˜†â˜†â˜†</td></tr><tr><td>æ€§èƒ½</td><td>â˜…â˜…â˜…â˜†â˜†</td><td>â˜…â˜…â˜…â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜†</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜…â˜…â˜…</td></tr><tr><td>ç»“æ„åŒ–æ”¯æŒ</td><td>â˜…â˜†â˜†â˜†â˜†</td><td>â˜…â˜†â˜†â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜…</td><td>â˜…â˜…â˜†â˜†â˜†</td><td>â˜…â˜…â˜…â˜…â˜†</td></tr><tr><td>é€‚ç”¨è§„æ¨¡</td><td>å°é…ç½®</td><td>ä¸´æ—¶ä¼šè¯</td><td>ä¸­å¤§å‹ç¦»çº¿</td><td>èµ„æº/PWA</td><td>é¡µé¢å†…ä¸´æ—¶</td></tr></tbody></table>
<p><strong>æœ€åé€‰å‹å»ºè®®</strong>ï¼ˆæˆ‘è‡ªå·±çš„ç»éªŒï¼‰</p>
<ul>
<li>ç®€å•é…ç½®ã€åå¥½ â†’ localStorage</li>
<li>ä¸´æ—¶è¡¨å•/çŠ¶æ€ â†’ sessionStorage</li>
<li>å¤§é‡ä¸šåŠ¡æ•°æ®ã€ç¦»çº¿ â†’ IndexedDBï¼ˆå¼ºçƒˆæ¨dexie.jsï¼‰</li>
<li>PWA/é™æ€èµ„æº â†’ Cache API + Service Worker</li>
<li>é¡µé¢å†…é«˜é€Ÿå¤ç”¨ â†’ å†…å­˜LRU</li>
</ul>
<p>é¡¹ç›®é‡Œæˆ‘ç°åœ¨åŸºæœ¬è¿™ä¹ˆåˆ†å±‚ï¼šå°é…ç½®localï¼Œä¸´æ—¶sessionï¼Œå¤§æ•°æ®IndexedDBï¼Œèµ„æºCacheï¼Œå†…å­˜åŠ é€Ÿã€‚<br/>
è¦†ç›–äº†95%çš„åœºæ™¯ï¼Œä¸ä¼šå†çº ç»“äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS é€‰æ‹©å™¨æ·±åº¦å®æˆ˜ï¼šä»â€œä¸ªåç™¾åƒâ€æƒé‡æ³•åˆ°é›¶ DOM åŠ¨ç”»çš„é™ç»´æ‰“å‡»]]></title>    <link>https://juejin.cn/post/7595289498445152282</link>    <guid>https://juejin.cn/post/7595289498445152282</guid>    <pubDate>2026-01-15T05:30:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595289498445152282" data-draft-id="7595162224900505638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS é€‰æ‹©å™¨æ·±åº¦å®æˆ˜ï¼šä»â€œä¸ªåç™¾åƒâ€æƒé‡æ³•åˆ°é›¶ DOM åŠ¨ç”»çš„é™ç»´æ‰“å‡»"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2026-01-15T05:30:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS é€‰æ‹©å™¨æ·±åº¦å®æˆ˜ï¼šä»â€œä¸ªåç™¾åƒâ€æƒé‡æ³•åˆ°é›¶ DOM åŠ¨ç”»çš„é™ç»´æ‰“å‡»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:30:05.000Z" title="Thu Jan 15 2026 05:30:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS é€‰æ‹©å™¨å…¨è§£ï¼šä»æƒé‡è®¡ç®—åˆ°ä¼ªå…ƒç´ åŠ¨ç”»çš„â€œé™ç»´æ‰“å‡»â€</h2>
<blockquote>
<p><strong>å‰è¨€</strong>ï¼š<br/>
å¾ˆå¤šåç«¯è½¬å‰ç«¯ï¼Œç”šè‡³å·¥ä½œ 3-5 å¹´çš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œå¯¹ CSS çš„ç†è§£ä»åœç•™åœ¨â€œè°ƒæ ·å¼â€çš„é˜¶æ®µã€‚<br/>
åœ¨æ¶æ„å¸ˆçœ¼ä¸­ï¼ŒCSS é€‰æ‹©å™¨ä¸ä»…ä»…æ˜¯ç”¨æ¥â€œé€‰ä¸­â€å…ƒç´ çš„ï¼Œå®ƒæ˜¯ä¸€å¥—ä¸¥å¯†çš„<strong>é€»è¾‘è§„åˆ™</strong>å’Œ<strong>æ€§èƒ½çº¦æŸ</strong>ã€‚<br/>
ä»Šå¤©ç»“åˆ 7 ä¸ªå®æˆ˜åœºæ™¯ï¼ŒèŠèŠé‚£äº›ä½ å¯èƒ½æ²¡å®Œå…¨å‚é€çš„ CSS æ ¸å¿ƒæœºåˆ¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ æƒé‡çš„æ•°å­¦æ¸¸æˆï¼šä¸ªåç™¾åƒæ³•</h3>
<p>CSS çš„å…¨ç§°æ˜¯Â Cascading Style Sheetsï¼ˆå±‚å æ ·å¼è¡¨ï¼‰ï¼Œâ€œå±‚å â€çš„æ ¸å¿ƒå°±æ˜¯<strong>æƒé‡ï¼ˆSpecificityï¼‰</strong> ã€‚<br/>
å¾ˆå¤šæ—¶å€™æ ·å¼ä¸ç”Ÿæ•ˆï¼Œä¸æ˜¯æµè§ˆå™¨æœ‰ Bugï¼Œè€Œæ˜¯ä½ ç®—é”™äº†æ•°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€å¥—ç»å…¸çš„**â€œä¸ªåç™¾åƒâ€**è®¡ç®—æ³•ï¼š</p>
<ol>
<li><strong>Inline Style (è¡Œå†…æ ·å¼)</strong> ï¼šæƒé‡Â <strong>1000</strong></li>
<li><strong>ID é€‰æ‹©å™¨</strong>Â (#main)ï¼šæƒé‡Â <strong>0100</strong></li>
<li><strong>Class/Attribute/Pseudo-class</strong>Â (.container,Â [type="text"],Â :hover)ï¼šæƒé‡Â <strong>0010</strong></li>
<li><strong>Tag/Pseudo-element</strong>Â (div,Â p,Â ::before)ï¼šæƒé‡Â <strong>0001</strong></li>
</ol>
<h4 data-id="heading-2">å®æˆ˜æ¼”ç»ƒ</h4>
<p>çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼ŒpÂ æ ‡ç­¾æœ€ååˆ°åº•æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ</p>
<p>CSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æƒé‡ï¼š0-0-0-2 (ä¸¤ä¸ªæ ‡ç­¾) */</span>
<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">p</span> { <span class="hljs-attribute">color</span>: blue; }

<span class="hljs-comment">/* æƒé‡ï¼š0-1-1-2 (1ä¸ªID + 1ä¸ªç±» + 2ä¸ªæ ‡ç­¾) -&gt; èƒœå‡º ğŸ”¥ */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-id">#main</span> <span class="hljs-selector-tag">p</span> { <span class="hljs-attribute">color</span>: orange; }

<span class="hljs-comment">/* æƒé‡ï¼š0-0-1-1 (1ä¸ªç±» + 1ä¸ªæ ‡ç­¾) */</span>
<span class="hljs-selector-class">.text</span> <span class="hljs-selector-tag">p</span> { <span class="hljs-attribute">color</span>: red; }
</code></pre>
<p>HTML</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- è¡Œå†…æ ·å¼ï¼Œå°‘ç”¨ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: pink;"</span>&gt;</span>Click<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58da06feb46040319a9e66f5ad9af083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769059805&amp;x-signature=1E4tvWXve1fJdgvgewfk1Ih3oW8%3D" alt="å±å¹•æˆªå›¾ 2026-01-15 132125.png" loading="lazy"/></p>
<p><strong>è§£æ</strong>ï¼š<br/>
æµè§ˆå™¨ä¼šæ¯”è¾ƒæƒé‡å‘é‡ã€‚0-1-1-2Â æ˜¾ç„¶å¤§äºå…¶ä»–ç»„åˆï¼Œæ‰€ä»¥é¢œè‰²æ˜¯Â <strong>Orange</strong>ã€‚<br/>
è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸å»ºè®®æ»¥ç”¨Â !importantã€‚å®ƒä¼šæ‰“ç ´è¿™å¥—ä¼˜é›…çš„æ•°å­¦è§„åˆ™ï¼Œè®©åæœŸçš„ç»´æŠ¤å˜æˆä¸€åœºå™©æ¢¦ã€‚</p>
<hr/>
<h3 data-id="heading-3">äºŒã€ ç²¾å‡†å®šä½çš„è‰ºæœ¯ï¼šå…³ç³»ä¸å±æ€§</h3>
<h4 data-id="heading-4">1. æ‹’ç»Â classÂ çˆ†ç‚¸ï¼šå±æ€§é€‰æ‹©å™¨</h4>
<p>åœ¨åšé€šç”¨ç»„ä»¶åº“æ—¶ï¼Œæˆ‘ä»¬æ— æ³•é¢„çŸ¥ç”¨æˆ·ä¼šåŠ ä»€ä¹ˆç±»åï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°æ®å±æ€§ã€‚<br/>
æ¯”å¦‚ä¹¦ç±åˆ†ç±»åˆ—è¡¨ï¼Œæ— éœ€ç»™æ¯ä¸ª item åŠ Â .book-sci-fiï¼Œç›´æ¥åˆ©ç”¨ DOM æ•°æ®ï¼š</p>
<p>CSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é€‰ä¸­æ‰€æœ‰ category å±æ€§ä¸ºâ€œç§‘å¹»â€çš„å…ƒç´  */</span>
<span class="hljs-selector-attr">[data-category=<span class="hljs-string">"ç§‘å¹»"</span>]</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#007bff</span>;
}

<span class="hljs-comment">/* é«˜é˜¶æŠ€å·§ï¼šé€‰ä¸­ title ä»¥ "å…¥é—¨" å¼€å¤´çš„å…ƒç´  */</span>
<span class="hljs-comment">/* è¿™ç§æ¨¡ç³ŠåŒ¹é…éå¸¸é€‚åˆåŠ¨æ€å›¾æ ‡ç³»ç»Ÿ */</span>
<span class="hljs-selector-attr">[title^=<span class="hljs-string">"å…¥é—¨"</span>]</span> <span class="hljs-selector-tag">h2</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"ã€‚ã€‚ã€‚ã€‚"</span>;
}
</code></pre>
<h4 data-id="heading-5">2. å››å¤§å…³ç³»ç¬¦çš„ç»†å¾®å·®åˆ«</h4>
<p>å¾ˆå¤šæ–°æ‰‹åˆ†ä¸æ¸…Â +Â å’ŒÂ ~Â çš„åŒºåˆ«ï¼š</p>
<ul>
<li><strong>ç©ºæ ¼ (åä»£)</strong> ï¼š.container pÂ â€”â€” é€‰ä¸­é‡Œé¢æ‰€æœ‰çš„Â pï¼Œä¸ç®¡è—å¾—å¤šæ·±ã€‚</li>
<li><strong>&gt;Â (å­ä»£)</strong> ï¼š.container &gt; pÂ â€”â€” åªé€‰ä¸­äº²å„¿å­ã€‚</li>
<li><strong>+Â (ç›¸é‚»å…„å¼Ÿ)</strong> ï¼šh1 + pÂ â€”â€”Â <strong>ç´§è·Ÿ</strong>åœ¨Â h1Â åé¢çš„é‚£ä¸ªÂ pï¼ˆä»…ä¸€ä¸ªï¼‰ã€‚</li>
<li><strong>~Â (é€šç”¨å…„å¼Ÿ)</strong> ï¼šh1 ~ pÂ â€”â€”Â h1Â åé¢<strong>æ‰€æœ‰</strong>åŒçº§çš„Â pã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€ ç»“æ„ä¸çŠ¶æ€çš„é™·é˜±ï¼šnth-child çš„è°è¨€</h3>
<p>è¿™æ˜¯é¢è¯•é¢˜ä¸­çš„é‡ç¾åŒºï¼Œè¯·ä»”ç»†çœ‹çš„ç¿»è½¦ç°åœºã€‚</p>
<h4 data-id="heading-7">åœºæ™¯è¿˜åŸ</h4>
<p>HTML</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>             <span class="hljs-comment">&lt;!-- ç¬¬1ä¸ªå­å…ƒç´  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ®µè½1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>              <span class="hljs-comment">&lt;!-- ç¬¬2ä¸ªå­å…ƒç´  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å¹²æ‰°é¡¹Div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>       <span class="hljs-comment">&lt;!-- ç¬¬3ä¸ªå­å…ƒç´  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ®µè½2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>              <span class="hljs-comment">&lt;!-- ç¬¬4ä¸ªå­å…ƒç´  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æƒ³è¦é€‰ä¸­çš„æ®µè½<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>       <span class="hljs-comment">&lt;!-- ç¬¬5ä¸ªå­å…ƒç´  --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å¦‚æœä½ æƒ³é€‰ä¸­â€œæƒ³è¦é€‰ä¸­çš„æ®µè½â€ï¼ˆå®ƒæ˜¯ç¬¬3ä¸ªÂ pÂ æ ‡ç­¾ï¼‰ï¼Œç›´è§‰å¯èƒ½ä¼šå†™ï¼š</p>
<p>CSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é”™è¯¯å†™æ³• */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) { <span class="hljs-attribute">color</span>: red; }
</code></pre>
<p><strong>ç»“æœ</strong>ï¼šé€‰ä¸­çš„æ˜¯Â </p><div>å¹²æ‰°é¡¹Div</div>ï¼Ÿä¸ï¼Œæ ·å¼å¤±æ•ˆäº†ã€‚å› ä¸ºÂ nth-child(3)Â æŒ‡çš„æ˜¯<strong>ç»“æ„ä¸Šçš„ç¬¬3ä¸ªå­©å­</strong>ï¼ˆå³é‚£ä¸ª Divï¼‰ï¼Œä½†é€‰æ‹©å™¨åˆè¦æ±‚å®ƒæ˜¯Â pï¼Œç±»å‹ä¸åŒ¹é…ï¼Œæ‰€ä»¥æ— æ•ˆã€‚<p/>
<h4 data-id="heading-8">æ­£ç¡®è§£æ³•ï¼šnth-of-type</h4>
<p>CSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ­£ç¡®å†™æ³• */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">:nth-of-type</span>(<span class="hljs-number">3</span>) {
    <span class="hljs-attribute">background-color</span>: yellow;
}
</code></pre>
<p><strong>æ·±åº¦è§£æ</strong>ï¼š</p>
<ul>
<li>nth-child(n)ï¼š<strong>åªçœ‹æ’åï¼Œä¸çœ‹ç±»å‹</strong>ã€‚å…ˆæ•°ç¬¬ n ä¸ªå­©å­ï¼Œå†çœ‹å®ƒæ˜¯ä¸æ˜¯è¯¥æ ‡ç­¾ã€‚</li>
<li>nth-of-type(n)ï¼š<strong>åªçœ‹ç±»å‹ï¼Œå†çœ‹æ’å</strong>ã€‚å…ˆæŠŠå®ƒå…„å¼Ÿé‡Œçš„åŒç±»æ ‡ç­¾æŒ‘å‡ºæ¥ï¼Œå†æ•°ç¬¬ n ä¸ªã€‚</li>
</ul>
<h4 data-id="heading-9">çŠ¶æ€ä¼ªç±»çš„å¦™ç”¨</h4>
<ul>
<li>:not(:last-child)ï¼šç»™åˆ—è¡¨åŠ åˆ†å‰²çº¿æ—¶ï¼Œæœ€åä¸€è¡Œä¸è¦çº¿ï¼Œä¸€è¡Œä»£ç æå®šã€‚</li>
<li>:checked + labelï¼š<strong>CSS å®ç°å¼€å…³é€»è¾‘</strong>çš„æ ¸å¿ƒï¼Œå®Œå…¨ä¸éœ€è¦ JS ä»‹å…¥å³å¯æ”¹å˜æ ·å¼ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">å››ã€ è§†è§‰é­”æ³•ï¼šé›¶ DOM æˆæœ¬çš„åŠ¨ç”»</h3>
<p>é«˜çº§çš„å‰ç«¯å¼€å‘æ‡‚å¾—â€œ<strong>å°‘ç”¨ DOMï¼Œå¤šç”¨ä¼ªå…ƒç´ </strong>â€ã€‚<br/>
::beforeÂ å’ŒÂ ::afterÂ æ˜¯ä¸åœ¨ DOM æ ‘ä¸­çš„å¹½çµèŠ‚ç‚¹ï¼Œéå¸¸é€‚åˆåšè£…é¥°æ•ˆæœã€‚</p>
<h4 data-id="heading-11">å®æˆ˜ï¼šä¼šç”Ÿé•¿çš„ä¸‹åˆ’çº¿</h4>
<p>CSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.more</span> {
    <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* ä¸ºç»å¯¹å®šä½çš„ä¼ªå…ƒç´ å»ºç«‹åŸºå‡† */</span>
}

<span class="hljs-comment">/* åˆå§‹çŠ¶æ€ï¼šå®½åº¦æ»¡ï¼Œä½†ç¼©æ”¾ä¸º0 */</span>
<span class="hljs-selector-class">.more</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">2px</span>;
    <span class="hljs-attribute">background-color</span>: yellow;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">0</span>);       <span class="hljs-comment">/* æ ¸å¿ƒï¼šæ¨ªå‘ç¼©æ”¾ä¸º0 */</span>
    <span class="hljs-attribute">transform-origin</span>: bottom left; <span class="hljs-comment">/* ä»å·¦è¾¹å¼€å§‹é•¿ */</span>
    <span class="hljs-attribute">transition</span>: transform .<span class="hljs-number">3s</span> ease;
}

<span class="hljs-comment">/* æ‚¬åœçŠ¶æ€ï¼šç¼©æ”¾å›1 */</span>
<span class="hljs-selector-class">.more</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<p><strong>æ¶æ„å¸ˆç¬”è®°</strong>ï¼š<br/>
ä¸ºä»€ä¹ˆç”¨Â transform: scaleXÂ è€Œä¸æ˜¯Â widthï¼Ÿ</p>
<ul>
<li><strong>æ€§èƒ½</strong>ï¼šwidthÂ å˜åŒ–ä¼šè§¦å‘Â <strong>Reflow (é‡æ’)</strong> ï¼Œæˆæœ¬é«˜ã€‚</li>
<li><strong>æµç•…åº¦</strong>ï¼štransformÂ åªè§¦å‘Â <strong>Composite (åˆæˆ)</strong> ï¼Œç”± GPU åŠ é€Ÿï¼ŒåŠ¨ç”»å¦‚ä¸èˆ¬é¡ºæ»‘ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-12">äº”ã€ é¿å‘æŒ‡å— (Readme æ±‡æ€»)</h3>
<p>æœ€åï¼Œç»“åˆÂ readme.mdÂ æé†’å‡ ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„åº•å±‚æœºåˆ¶ï¼š</p>
<ol>
<li><strong>Margin é‡å </strong>ï¼šå‚ç›´æ–¹å‘ä¸Šï¼Œä¸¤ä¸ªç›¸é‚»å…ƒç´ çš„ margin ä¼šå‘ç”Ÿé‡å ï¼Œå–<strong>æœ€å¤§å€¼</strong>è€Œä¸æ˜¯ç›¸åŠ ã€‚</li>
<li><strong>Inline å…ƒç´ çš„å±€é™</strong>ï¼šspanÂ ç­‰è¡Œå†…å…ƒç´ ä¸æ”¯æŒÂ transformÂ å’ŒÂ width/heightã€‚å¦‚æœå‘ç°åŠ¨ç”»ä¸ç”Ÿæ•ˆï¼Œè¯·å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº†Â display: inline-blockã€‚</li>
<li><strong>Px å¹¶éç»å¯¹</strong>ï¼šåœ¨é«˜åˆ†å±ä¸‹ï¼Œ1px å¯èƒ½å¯¹åº”å¤šä¸ªç‰©ç†åƒç´ ã€‚ä½†åœ¨ CSS é€»è¾‘ä¸­ï¼Œå®ƒä¾ç„¶æ˜¯è®¡ç®—å•ä½ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-13">æ€»ç»“</h3>
<p>CSS é€‰æ‹©å™¨ä¸ä»…æ˜¯è¯­æ³•çš„å †ç Œï¼Œæ›´æ˜¯<strong>DOM æ ‘çš„æ£€ç´¢é€»è¾‘</strong>ã€‚</p>
<ul>
<li>æƒ³è¦<strong>å‡†ç¡®</strong>ï¼Œè¯·ç”¨Â nth-of-typeÂ å’Œå±æ€§é€‰æ‹©å™¨ï¼›</li>
<li>æƒ³è¦<strong>æ€§èƒ½</strong>ï¼Œè¯·æ§åˆ¶å±‚çº§æ·±åº¦ï¼Œå°‘ç”¨é€šé…ç¬¦ï¼›</li>
<li>æƒ³è¦<strong>ä¼˜é›…</strong>ï¼Œè¯·å¤šç”¨ä¼ªå…ƒç´ å’Œä¼ªç±»ä»£æ›¿ JS é€»è¾‘ã€‚</li>
</ul>
<p>æŒæ¡è¿™äº›ï¼Œä½ çš„ CSS ä»£ç æ‰é…å¾—ä¸Šâ€œæ¶æ„â€äºŒå­—ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>