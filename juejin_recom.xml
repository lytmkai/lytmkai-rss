<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%]]></title>    <link>https://juejin.cn/post/7581870491756052515</link>    <guid>https://juejin.cn/post/7581870491756052515</guid>    <pubDate>2025-12-10T00:16:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491756052515" data-draft-id="7581870491756036131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T00:16:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:16:41.000Z" title="Wed Dec 10 2025 00:16:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%</strong></h3>
<h3 data-id="heading-1">引言</h3>
<p>在现代Web开发中，JavaScript的性能优化一直是开发者关注的重点。随着应用程序变得越来越复杂，代码的效率和可维护性直接影响到用户体验和开发效率。许多开发者仍然在使用过时的模式或冗余的代码结构，这不仅降低了性能，还增加了维护成本。</p>
<p>本文将介绍5个现代JavaScript技巧，这些技巧可以帮助你从混乱的代码过渡到优雅、高效的解决方案。通过合理的优化策略，你可以显著提升代码性能（甚至高达50%），同时保持代码的可读性和可扩展性。</p>
<hr/>
<h3 data-id="heading-2">1. 使用<code>async/await</code>替代回调地狱</h3>
<h4 data-id="heading-3">问题：回调地狱与性能损耗</h4>
<p>传统的回调模式（Callback）虽然简单，但嵌套过多会导致“回调地狱”（Callback Hell），不仅难以阅读，还可能引发内存泄漏和性能问题。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">getData</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-title function_">processData</span>(data, <span class="hljs-keyword">function</span>(<span class="hljs-params">processedData</span>) {
        <span class="hljs-title function_">saveData</span>(processedData, <span class="hljs-keyword">function</span>(<span class="hljs-params">saved</span>) {
            <span class="hljs-comment">// 更多嵌套...</span>
        });
    });
});
</code></pre>
<h4 data-id="heading-4">解决方案：<code>async/await</code></h4>
<p>ES2017引入的<code>async/await</code>语法可以显著改善异步代码的可读性和性能。它基于Promise实现，避免了不必要的嵌套和上下文切换开销。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getData</span>();
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processData</span>(data);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveData</span>(processedData);
}
</code></pre>
<h4 data-id="heading-5">性能优势</h4>
<ul>
<li><strong>减少堆栈开销</strong>：相比多层嵌套的回调，<code>async/await</code>减少了函数调用堆栈的深度。</li>
<li><strong>更好的错误处理</strong>：通过<code>try/catch</code>可以统一捕获错误，避免了回调中的手动错误传递。</li>
<li><strong>V8引擎优化</strong>：现代JavaScript引擎（如V8）对<code>async/await</code>有专门优化，执行效率更高。</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. 利用WeakMap和WeakSet管理内存</h3>
<h4 data-id="heading-7">问题：内存泄漏</h4>
<p>传统的Map和Set会强引用键值，导致即使对象不再需要也无法被垃圾回收（GC）。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processObj</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(obj);
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">heavyComputation</span>(obj);
    cache.<span class="hljs-title function_">set</span>(obj, result); <span class="hljs-comment">// obj会被长期持有</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-8">解决方案：WeakMap和WeakSet</h4>
<p>WeakMap和WeakSet的键是弱引用，不会阻止垃圾回收机制回收对象。适合缓存或临时关联数据场景。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processObj</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(obj);
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">heavyComputation</span>(obj);
    cache.<span class="hljs-title function_">set</span>(obj, result); <span class="hljs-comment">// obj可被GC回收</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-9">性能优势</h4>
<ul>
<li><strong>减少内存占用</strong>：避免无意的内存泄漏，尤其是在长生命周期应用中。</li>
<li><strong>更高效的GC</strong>：垃圾回收器能更快释放不再使用的对象。</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. 使用Array.prototype.at()简化数组访问</h3>
<h4 data-id="heading-11">问题：冗长的负数索引处理</h4>
<p>传统的负数索引需要通过<code>arr.length + index</code>计算，既不直观又容易出错：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> lastItem = arr[arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 3</span>
</code></pre>
<h4 data-id="heading-12">解决方案：Array.prototype.at()</h4>
<p>ES2022引入的<code>at()</code>方法支持直接使用负数索引访问数组元素：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> lastItem = arr.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>); <span class="hljs-comment">// 3</span>
</code></pre>
<h4 data-id="heading-13">性能优势</h4>
<ul>
<li><strong>代码更简洁</strong>：减少冗余计算和潜在的错误风险。</li>
<li><strong>引擎优化</strong>：现代浏览器对内置方法进行了高度优化，执行效率更高。</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. Object.groupBy替代手动分组逻辑</h3>
<h4 data-id="heading-15">问题：低效的手动分组</h4>
<p>开发者通常用reduce或循环实现分组功能，但这类手动实现往往不够高效且难以维护：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [{ <span class="hljs-attr">age</span>:<span class="hljs-number">25</span> }, { <span class="hljs-attr">age</span>:<span class="hljs-number">30</span> }, { <span class="hljs-attr">age</span>:<span class="hljs-number">25</span> }];
<span class="hljs-keyword">const</span> groupedByAge = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
    acc[user.<span class="hljs-property">age</span>] ??= [];
    acc[user.<span class="hljs-property">age</span>].<span class="hljs-title function_">push</span>(user);
    <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-16">ES2024新特性提案中的Object.groupBy方法可以直接完成分组操作：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> groupedByAge = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">groupBy</span>(users , <span class="hljs-function">(<span class="hljs-params">{age}</span>) =&gt;</span> age ) ;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(groupedByAge )
<span class="hljs-comment">/* 
{
   "25": [{"age":25},{"age":25}],
   "30": [{"age":30}]
}
*/</span>
</code></pre>
<h5 data-id="heading-17">Performance Benefits:</h5>
<p>•	Native Implementation Speed - No need for manual iteration logic that may be suboptimal.
•	Cleaner Code - Readability is greatly improved over reduce-based approaches.
•	Future Optimization Potential - As engines optimize this new API further.</p>
<hr/>
<h2 data-id="heading-18">Conclusion</h2>
<p>Mastering modern JavaScript features isn’t just about writing cleaner code – it’s about unlocking significant performance gains while improving maintainability. The five techniques we’ve covered demonstrate how evolving language features can help you:</p>
<ol>
<li>Replace callback hell with streamlined async/await workflows</li>
<li>Prevent memory leaks using WeakMap/WeakSet</li>
<li>Access array elements elegantly with at()</li>
<li>Leverage upcoming APIs like Object.groupBy for common operations</li>
</ol>
<p>Each optimization might seem small individually, but combined they can easily deliver the promised ≥50% performance improvement in real-world applications.</p>
<p>The key takeaway? Regularly update your JavaScript knowledge and challenge old patterns – today’s “best practice” might be tomorrow’s performance bottleneck. By adopting these modern techniques proactively, you’ll stay ahead of the curve while writing faster, more robust applications.</p>
<p>What modern JavaScript optimizations have you found most impactful? Share your experiences in the comments!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战深入理解Promise与async&await]]></title>    <link>https://juejin.cn/post/7581698074362052617</link>    <guid>https://juejin.cn/post/7581698074362052617</guid>    <pubDate>2025-12-10T00:18:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074362052617" data-draft-id="7581888578507079707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战深入理解Promise与async&amp;await"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-10T00:18:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战深入理解Promise与async&amp;await
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:18:46.000Z" title="Wed Dec 10 2025 00:18:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 的异步编程体系中，回调函数虽然简单高效，但也容易造成嵌套复杂、难以维护的“回调地狱”问题。随着 JavaScript 语言标准的发展，Promise 和 async/await 成为了现代 Node.js 异步编程的主流方式。在工程实践中，它们不仅让代码更清晰，也更易调试和扩展。本文将系统解析 Promise 与 async/await 的核心原理、使用方式以及实际开发中的常见模式。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、Promise：解决回调地狱的第一步</h2>
<p>Promise 是一种用于处理异步操作的对象，它代表的是“未来某个时间点才会返回的结果”。相比传统回调，Promise 让异步流程可以更优雅地组织和链式调用。</p>
<h3 data-id="heading-1">1. Promise 的基本语法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"任务完成"</span>);
  }, <span class="hljs-number">1000</span>);
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
});
</code></pre>
<p>Promise 的状态分为：</p>
<ul>
<li>pending（进行中）</li>
<li>fulfilled（已成功）</li>
<li>rejected（已失败）</li>
</ul>
<p>状态一旦改变，就不会再次变化，这让异步处理更稳定。</p>
<h3 data-id="heading-2">2. Promise 链式调用</h3>
<p>多个异步操作可以通过 <code>.then()</code> 串联起来：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultA</span> =&gt;</span> <span class="hljs-title function_">doB</span>(resultA))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultB</span> =&gt;</span> <span class="hljs-title function_">doC</span>(resultB))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultC</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(resultC))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>这种链式结构有效解决了回调的深度嵌套问题。</p>
<hr/>
<h2 data-id="heading-3">二、async/await：异步编程的终极形态</h2>
<p>Promise 虽然好用，但链式结构在复杂逻辑中仍显冗长。因此，ES8 引入了 async/await，让异步写法更接近同步思维。</p>
<h3 data-id="heading-4">1. async/await 用法示例</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始"</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"等待结束"</span>);
}

<span class="hljs-title function_">run</span>();
</code></pre>
<p>使用 <code>await</code> 时，函数必须定义为 <code>async</code>。
其效果相当于暂停代码执行，但不会阻塞 Node.js 主线程，非常适合逻辑清晰的异步流程。</p>
<h3 data-id="heading-5">2. 错误处理更直观</h3>
<p>Promise 中需要 <code>.catch()</code> 来捕获错误，
而 async/await 可以直接使用 try/catch：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFileAsync</span>(<span class="hljs-string">"demo.txt"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败："</span>, err);
  }
}
</code></pre>
<p>这让错误处理方式更加接近同步代码。</p>
<hr/>
<h2 data-id="heading-6">三、Promise 与 async/await 的关系</h2>
<p>很多人会误以为 async/await 可以完全取代 Promise，但本质上 async/await 只是 Promise 的语法糖，底层仍依赖 Promise 的状态机制。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;
}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">123</span>);
}
</code></pre>
<p>理解 Promise 是掌握 async/await 的基础。</p>
<hr/>
<h2 data-id="heading-7">四、实际项目中的常见模式</h2>
<h3 data-id="heading-8">1. 并发执行多个任务</h3>
<p>如果多个任务互不依赖，可以用 <code>Promise.all</code> 提升性能：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> [a, b, c] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">doA</span>(), <span class="hljs-title function_">doB</span>(), <span class="hljs-title function_">doC</span>()]);
</code></pre>
<p>避免这样写：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doA</span>();
<span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doB</span>();
<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doC</span>();
</code></pre>
<p>后者是串行执行，性能更低。</p>
<h3 data-id="heading-9">2. 使用 util.promisify 转换回调 API</h3>
<p>Node.js 原生很多 API 仍然使用回调，例如 fs.readFile。
可以通过 promisify 转换为 Promise 格式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-string">"demo.txt"</span>, <span class="hljs-string">"utf8"</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}
</code></pre>
<p>这样就能自然地使用 async/await。</p>
<h3 data-id="heading-10">3. 处理多个 Promise 的错误</h3>
<p>当你使用 <code>Promise.all</code> 时，有任何一个任务出错，都可能导致整体失败。
更安全的方式是使用 <code>Promise.allSettled</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
</code></pre>
<p>非常适合批量任务处理场景。</p>
<hr/>
<h2 data-id="heading-11">五、常见陷阱与注意事项</h2>
<h3 data-id="heading-12">1. 避免在 forEach 中使用 await</h3>
<p>因为 forEach 不支持异步等待，会导致未按预期执行。</p>
<p>错误示例：</p>
<pre><code class="hljs language-js" lang="js">list.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (item) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
});
</code></pre>
<p>正确方式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> list) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
}
</code></pre>
<h3 data-id="heading-13">2. await 多层嵌套造成性能损耗</h3>
<p>如果任务没有依赖关系，应该使用 Promise 并发而不是 await 来等待每一步。</p>
<h3 data-id="heading-14">3. async 函数默认返回 Promise</h3>
<p>若未显式 return，结果会是 <code>Promise&lt;void&gt;</code>，需要注意函数返回值类型。</p>
<hr/>
<h2 data-id="heading-15">六、总结</h2>
<p>Promise 和 async/await 是现代 Node.js 异步编程的核心。
两者并不是互相替代，而是共同组成完整的异步解决方案：</p>
<ul>
<li>Promise 解决回调地狱、支持链式调用</li>
<li>async/await 让异步代码更清晰、更易维护</li>
<li>Promise 是 async/await 的底层基础</li>
<li>Promise.all 等工具让并发任务更高效</li>
</ul>
<p>掌握它们不仅是写好 Node.js 项目的必要技能，也是理解事件循环与非阻塞 I/O 的前提。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：全面理解异步错误处理]]></title>    <link>https://juejin.cn/post/7581888578507096091</link>    <guid>https://juejin.cn/post/7581888578507096091</guid>    <pubDate>2025-12-10T00:19:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507096091" data-draft-id="7581698074362069001" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：全面理解异步错误处理"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-10T00:19:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：全面理解异步错误处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:19:17.000Z" title="Wed Dec 10 2025 00:19:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 开发中，程序的大部分操作都是异步执行的，例如文件读写、网络请求、数据库操作等。异步带来了高性能的优势，但也让错误处理变得更加复杂。如果处理不当，错误可能悄无声息地被忽略，导致程序异常、资源泄漏，甚至服务崩溃。理解并正确掌握 Node.js 的异步错误处理机制，是构建稳定可靠服务的重要前提。</p>
</blockquote>
<p>本文将系统讲解 Node.js 中的异步错误处理策略，包括回调、Promise、async/await，以及常见陷阱和最佳实践。</p>
<hr/>
<h2 data-id="heading-0">一、为什么异步错误处理更难？</h2>
<p>在同步代码中，只需要 try/catch 即可捕获异常：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">"a.txt"</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
}
</code></pre>
<p>但在异步代码中，异常并不会被外围的 try/catch 捕获。例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"a.txt"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"捕获不到错误"</span>);
}
</code></pre>
<p>原因在于：回调在未来某个时间点执行，已经脱离了 try/catch 的同步范围。</p>
<p>因此，Node.js 引入了不同阶段的错误处理模式。</p>
<hr/>
<h2 data-id="heading-1">二、回调风格中的“错误优先”规则</h2>
<p>Node.js 所有基于回调的 API 都遵循一个约定：回调的第一个参数永远是错误对象。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"demo.txt"</span>, <span class="hljs-string">"utf8"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败："</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
});
</code></pre>
<p>这是处理异步错误的基础方式。
好处是：</p>
<ul>
<li>明确区分成功和失败</li>
<li>调用者必须显式处理错误，避免吞错</li>
<li>提升代码安全性</li>
</ul>
<p>但随着嵌套回调增多，错误处理也会变得重复甚至混乱。</p>
<hr/>
<h2 data-id="heading-2">三、Promise 中的错误捕获</h2>
<p>Promise 的设计让错误处理更清晰，任何抛出的异常都会被 <code>.catch()</code> 捕获。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"失败了"</span>));
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {})
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"捕获到错误："</span>, err);
  });
</code></pre>
<p>Promise 的错误处理有几种特点：</p>
<ol>
<li>只要 reject 或者 then 中抛出异常，都能被 catch 捕获</li>
<li>在链式调用中，只需一个 catch 即可捕获所有上游错误</li>
<li>未处理的 Promise 错误会触发 <code>unhandledRejection</code> 事件</li>
</ol>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未捕获的 Promise 错误："</span>, err);
});
</code></pre>
<p>在生产环境中，这类错误必须记录，否则将难以排查。</p>
<hr/>
<h2 data-id="heading-3">四、async/await 的错误处理方式</h2>
<p>async/await 是构建整洁异步代码的关键，但错误处理仍然要使用 try/catch。</p>
<p>示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFileAsync</span>(<span class="hljs-string">"demo.txt"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"捕获错误："</span>, err);
  }
}
</code></pre>
<p>try/catch 在 async/await 中有几个优势：</p>
<ul>
<li>可读性强，结构和同步逻辑一致</li>
<li>一段代码中可以统一处理多个 await 的错误</li>
<li>调试更方便</li>
</ul>
<p>但常见错误是：把 try/catch 放错位置，导致部分 await 未被包含。</p>
<hr/>
<h2 data-id="heading-4">五、如何处理多个并发任务的错误？</h2>
<p>当多个异步任务同时执行时，错误处理方式更为复杂。</p>
<h3 data-id="heading-5">1. Promise.all：其中一个失败就全部失败</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"其中一个任务失败："</span>, err);
}
</code></pre>
<p>适用于“任务必须同时成功”的场景。</p>
<hr/>
<h3 data-id="heading-6">2. Promise.allSettled：每个任务独立执行</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
</code></pre>
<p>返回结果中：</p>
<ul>
<li>fulfilled 代表成功</li>
<li>rejected 代表失败</li>
</ul>
<p>非常适合批量处理或任务结果不互相依赖的场景。</p>
<hr/>
<h2 data-id="heading-7">六、常见的异步错误陷阱</h2>
<h3 data-id="heading-8">1. 忘记返回 Promise</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>();
    }, <span class="hljs-number">1000</span>);
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"错误"</span>);
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">wrong</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"捕获不到"</span>);
  }
}
</code></pre>
<p>原因：没有 return，导致 run() 无法等待错误抛出。</p>
<hr/>
<h3 data-id="heading-9">2. 在 forEach 中使用 await</h3>
<p>forEach 不能等待异步任务，因此错误难以捕获。</p>
<pre><code class="hljs language-js" lang="js">items.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> item =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item); <span class="hljs-comment">// 错误无法被外层捕获</span>
});
</code></pre>
<p>正确方式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
}
</code></pre>
<hr/>
<h3 data-id="heading-10">3. async 函数中的未处理错误最终会导致 Promise rejection</h3>
<p>如果没有 try/catch，也没有被外层 await 捕获，错误会引发 <code>unhandledRejection</code>。</p>
<hr/>
<h2 data-id="heading-11">七、全局层面的异常处理</h2>
<p>即使处理了大多数错误，仍可能出现未捕获错误。
Node.js 提供全局事件用于兜底：</p>
<h3 data-id="heading-12">1. 未捕获的异常</h3>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"uncaughtException"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未捕获异常："</span>, err);
});
</code></pre>
<h3 data-id="heading-13">2. 未捕获的 Promise 错误</h3>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未处理的 Promise 错误："</span>, err);
});
</code></pre>
<p>在生产环境，通常会记录日志并安全退出，而不是继续运行。</p>
<hr/>
<h2 data-id="heading-14">八、最佳实践总结</h2>
<ol>
<li>回调函数中始终检查 err</li>
<li>Promise 链中使用统一的 catch</li>
<li>async/await 中使用 try/catch 进行局部保护</li>
<li>批量任务优先选择 Promise.allSettled</li>
<li>避免在 forEach 中使用 await</li>
<li>必须监听 unhandledRejection 和 uncaughtException</li>
<li>对外暴露 API 时防止错误被吞掉</li>
</ol>
<p>高质量的异步错误处理不仅提升稳定性，也能显著降低维护成本。</p>
<hr/>
<h2 data-id="heading-15">九、总结</h2>
<p>Node.js 的异步错误处理机制看似复杂，但它遵循清晰规律：
回调依赖错误优先模式，Promise 依赖 catch，async/await 依赖 try/catch。
理解每种模式的特点和适用场景，就能写出可靠、可维护的 Node.js 服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」]]></title>    <link>https://juejin.cn/post/7581738974424088595</link>    <guid>https://juejin.cn/post/7581738974424088595</guid>    <pubDate>2025-12-10T00:21:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581738974424088595" data-draft-id="7581664885862105098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」"/> <meta itemprop="keywords" content="GitHub,开源"/> <meta itemprop="datePublished" content="2025-12-10T00:21:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:21:42.000Z" title="Wed Dec 10 2025 00:21:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a38f2672d0274178bb3dfd04f27f7471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=%2FOUcfcAN3J5vh1A0Ov85W1EAVsI%3D" alt="" loading="lazy"/></p>
<p>如果你的生产环境用了 NextJS——基于 React 的流行开源 Web 开发框架，那上周末可能过得并不轻松。<strong>受 React 高危漏洞的影响，攻击者可以通过 HTTP 请求攻击 NextJS 项目，远程执行任意指令</strong>。如果你不确定项目是否受影响，可以使用官方提供的工具，一条命令 <code>npx fix-react2shell-next</code> 即可检查和修复该安全漏洞。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cfe35892a874321b0333d99670291cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=jGMOyLUCpW%2BAf%2B6anSk7%2FlBn2vA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Ffix-react2shell-next" target="_blank" title="https://github.com/vercel-labs/fix-react2shell-next" ref="nofollow noopener noreferrer">github.com/vercel-labs…</a></p>
</blockquote>
<p>接下来，让我们看看上周 GitHub 又有哪些好玩的开源项目。近期，微软开源的支持 90 分钟高质量长语音合成框架，连续多天登顶热榜。让你在“摸鱼”时学习云架构知识的塔防游戏 server-survival，除了界面有些简陋但真能学到东西。如果你在寻找 Vim 的终端编辑器替代品，可以试试最近很火的新项目 Fresh，没点东西也不可能一周 Star 破千。</p>
<p>最后是无需客户端、浏览器访问就能用的远程桌面工具 CrossDesk，以及完全免费、开源的 Android 白噪音应用 XMSLEEP，帮你放松、助你入眠。</p>
<ul>
<li>本文目录
<ul>
<li>1. 热门开源项目
<ul>
<li>1.1 扮演云架构师的塔防游戏：server-survival</li>
<li>1.2 秒开大文件的终端编辑器：Fresh</li>
<li>1.3 开箱即用的文件传输工具：alt-sendme</li>
<li>1.4 一句话生成小红书的创作工具：RedInk</li>
<li>1.5 长时长多角色语音合成框架：VibeVoice</li>
</ul>
</li>
<li>2. HelloGitHub 热评
<ul>
<li>2.1 支持 Web 端的远程桌面工具：CrossDesk</li>
<li>2.2 开源的 Android 白噪音应用：XMSLEEP</li>
</ul>
</li>
<li>3. 结尾</li>
</ul>
</li>
</ul>
<h2 data-id="heading-0">1. 热门开源项目</h2>
<h3 data-id="heading-1">1.1 扮演云架构师的塔防游戏：server-survival</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeec31c921ac438c9bf4689a4fbaee3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=tIr4k0%2BC6TkEmXS1KuZB9ccWYbw%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：JavaScript</strong>，<strong>Star：2.3k</strong>，<strong>周增长：2k</strong></p>
<p>这是一个基于 Web 的塔防模拟游戏，旨在通过玩游戏的方式学习云架构知识。玩家在游戏中扮演云架构师，利用有限的预算搭建云基础设施。面对持续增长的访问流量和 DDoS 攻击，需要合理规划和部署资源，尽可能延长云服务稳定运行时间（生存更长时间）。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpshenok%2Fserver-survival" target="_blank" title="https://github.com/pshenok/server-survival" ref="nofollow noopener noreferrer">github.com/pshenok/ser…</a></p>
</blockquote>
<h3 data-id="heading-2">1.2 秒开大文件的终端编辑器：Fresh</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/034d60cca1cb434e8b11d007b691bb86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=8deN%2BuY1YLdZ0TrB781mKi1p160%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Rust</strong>，<strong>Star：1.4k</strong>，<strong>周增长：1.3k</strong></p>
<p>这是一款支持鼠标操作的终端文本编辑器，能够流畅编辑 GB 级大文件。它开箱即用、上手简单，内置 LSP 客户端，提供自动补全、跳转到定义等 IDE 功能，以及 TypeScript 插件系统。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinelaw%2Ffresh" target="_blank" title="https://github.com/sinelaw/fresh" ref="nofollow noopener noreferrer">github.com/sinelaw/fre…</a></p>
</blockquote>
<h3 data-id="heading-3">1.3 开箱即用的文件传输工具：alt-sendme</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332202d034154ad59481016bade649b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=XC7NLLecxHewG2aUkhlZXn9l3vk%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Rust、TypeScript</strong>，<strong>Star：4k</strong></p>
<p>这是一款采用 Rust 和 Tauri 构建的开源 P2P 文件传输工具，无需注册和服务器，即可实现端到端的文件传输。用户只需将文件拖入应用，将随机生成的传输凭证发给接收方，对方输入后即可轻松接收文件。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftonyantony300%2Falt-sendme" target="_blank" title="https://github.com/tonyantony300/alt-sendme" ref="nofollow noopener noreferrer">github.com/tonyantony3…</a></p>
</blockquote>
<h3 data-id="heading-4">1.4 一句话生成小红书的创作工具：RedInk</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f63bc2a53904e389e3b5a52fe19e6f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=O7kLsjD9lJ4FOp%2F8SXljV1jY0Q4%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Python</strong>，<strong>Star：3.2k</strong>，<strong>周增长：1k</strong></p>
<p>该项目是基于 AI 的一站式小红书图文生成工具，只需输入一句话描述主题，并上传主页截图作为风格参考，即可自动生成包含封面图和内容的完整图文笔记，支持重新生成单页内容、大纲预览和编辑等功能。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHisMax%2FRedInk" target="_blank" title="https://github.com/HisMax/RedInk" ref="nofollow noopener noreferrer">github.com/HisMax/RedI…</a></p>
</blockquote>
<h3 data-id="heading-5">1.5 长时长多角色语音合成框架：VibeVoice</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6ee558b38c8453ba070539dde9bbe3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=xC6N5981xi%2Fzn91I4PIWax0adnM%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Python</strong>，<strong>Star：14k</strong>，<strong>周增长：4k</strong></p>
<p>该项目是微软开源的文本转语音框架，旨在解决传统 TTS 系统在生成长篇幅、多角色对话时（博客、有声书）的痛点。它能够基于文本，一次性合成长达 90 分钟、4 位不同角色对话的高质量长音频，支持中文、英语等 9 种语言。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FVibeVoice" target="_blank" title="https://github.com/microsoft/VibeVoice" ref="nofollow noopener noreferrer">github.com/microsoft/V…</a></p>
</blockquote>
<h2 data-id="heading-6">2. HelloGitHub 热评</h2>
<p>在此章节中，我们将为大家介绍本周 HelloGitHub 网站上的热门开源项目，希望你能从中收获开源神器和编程知识，更欢迎与我们分享你在使用这些<strong>开源项目的体验和评价</strong>，用最真实反馈为开源项目的作者提供动力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d178ca6ce8c476e86d77f3917be2b82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=TNd0BT9Z9WQ1sijZSQ%2B4XmBnKT8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.1 支持 Web 端的远程桌面工具：CrossDesk</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9336a5651d784fb8ae47da73d1ad3965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=OzA2a2L3Al1gGbiQeUzxPDjkx9w%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：C++</strong></p>
<p>这是一款开源、轻量级的跨平台远程桌面工具，支持不同设备间（Windows、Linux 和 macOS）的远程桌面控制和音视频传输，特点是可直接通过浏览器控制远程设备，无需额外安装任何应用。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2Fkunkundi%2Fcrossdesk" target="_blank" title="https://hellogithub.com/repository/kunkundi/crossdesk" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h3 data-id="heading-8">2.2 开源的 Android 白噪音应用：XMSLEEP</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5afce9f7e134ddb872f46e0dc815171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=34EZEIl2KVQPPrJ4pDdJfTWdvmE%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Kotlin</strong></p>
<p>这是一个专注于白噪音播放的 Android 应用，提供雨声、篝火、雷声、猫咪呼噜、鸟鸣、夜虫等多种自然声音，帮助你放松、冥想和入睡。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2FTosencen%2FXMSLEEP" target="_blank" title="https://hellogithub.com/repository/Tosencen/XMSLEEP" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h2 data-id="heading-9">3. 结尾</h2>
<p>以上就是本期「GitHub 热点速览」的全部内容，我始终坚信：兴趣是最好的老师！希望这些开源项目能激发你的兴趣，让你找到下一个想尝试和学习的开源项目。如果你也发现了好玩、有趣的 GitHub 开源项目想要分享，欢迎来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com" target="_blank" title="https://hellogithub.com" ref="nofollow noopener noreferrer">HelloGitHub</a> 与我们交流、讨论使用体验。</p>
<p><strong>往期回顾</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F44TR75pFspRM3kGf-6gU2Q" target="_blank" title="https://mp.weixin.qq.com/s/44TR75pFspRM3kGf-6gU2Q" ref="nofollow noopener noreferrer">节省 60% Token 的新数据格式</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fn_junef2MC3GTV7leQy-Ww" target="_blank" title="https://mp.weixin.qq.com/s/n_junef2MC3GTV7leQy-Ww" ref="nofollow noopener noreferrer">DIY ChatGPT 一周狂揽 27k Star</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）]]></title>    <link>https://juejin.cn/post/7581888578507128859</link>    <guid>https://juejin.cn/post/7581888578507128859</guid>    <pubDate>2025-12-10T00:23:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507128859" data-draft-id="7581691182003961866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）"/> <meta itemprop="keywords" content="人工智能,GPU,面试"/> <meta itemprop="datePublished" content="2025-12-10T00:23:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:23:08.000Z" title="Wed Dec 10 2025 00:23:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>编者按：</strong> 当大模型的算力需求呈指数级增长，GPU 还是唯一答案吗？在 AI 硬件军备竞赛愈演愈烈的今天，是否存在更高效、更专精、甚至更具颠覆性的替代方案？</p>
<p>我们今天为大家带来的文章，作者的核心观点是：AI 硬件生态正在迅速多元化，除了广为人知的 CPU、GPU 和 TPU 之外，一系列新兴架构 —— 如 ASIC、NPU、IPU、FPGA 乃至存内计算与神经形态芯片，正从不同维度重塑 AI 的算力未来。</p>
<p>文章系统梳理了三大经典处理单元（CPU、GPU、TPU）的原理与局限，并深入剖析了包括 Cerebras 晶圆级引擎、AWS Trainium/Inferentia、AMD APU、NPU 在内的专用芯片设计思路；进而拓展至 IPU、RPU、FPGA 等前沿架构，揭示它们如何针对稀疏计算、图神经网络、边缘推理或存算一体等特定场景提供突破性性能。</p>
</blockquote>
<p><strong>作者 | Ksenia Se and Alyona Vert</strong></p>
<p><strong>编译 | 岳扬</strong></p>
<h2 data-id="heading-0"><strong>目录</strong></h2>
<p><strong>01 CPU、GPU、TPU – 三种核心硬件架构</strong></p>
<p>1.1 中央处理单元（Central Processing Unit, CPU）</p>
<p>1.2 图形处理单元（Graphics Processing Unit, GPU）</p>
<p>1.3 张量处理单元（Tensor Processing Unit, TPU）</p>
<p><strong>02 专用集成电路（Application-Specific Integrated Circuits, ASICs）</strong></p>
<p>2.1 Cerebras 晶圆级引擎（Wafer-Scale Engine, WSE）</p>
<p>2.2 AWS Trainium 与 AWS Inferentia</p>
<p>2.3 加速处理单元（Accelerated Processing Unit, APU）</p>
<p>2.4 神经网络处理单元（Neural Processing Unit, NPU）</p>
<p><strong>03 其他有前景的替代架构</strong></p>
<p>3.1 智能处理单元（Intelligence Processing Unit, IPU）</p>
<p>3.2 阻变处理单元（Resistive Processing Unit, RPU）</p>
<p>3.3 现场可编程门阵列（Field-Programmable Gate Arrays, FPGAs）</p>
<p><strong>04 新兴架构（Emerging Architectures）</strong></p>
<p>4.1 量子处理器（Quantum Processors）</p>
<p>4.2 存内计算（Processing-in-Memory, PIM）与基于 MRAM 的芯片</p>
<p>4.3 神经形态芯片（Neuromorphic Chips）</p>
<p><strong>05 结语（Conclusion）</strong></p>
<hr/>
<p>如今连小孩子都知道 GPU（图形处理单元）是什么了 —— 这得归功于 AI，也归功于英伟达（Nvidia），它始终在不遗余力地推进自家芯片的发展。当然，硬件既是绊脚石，也是推动模型运行及其技术栈的引擎。但为什么人们讨论的焦点只集中在 GPU 上呢？难道没有其他竞争者可能塑造 AI 硬件的未来吗？CPU 和 TPU 当然算 —— 但仅此而已吗？</p>
<p>今天，让我们跳出 GPU 的思维茧房，将视线拓展到 GPU、CPU、TPU 这“老三样”之外。全球开发者一直在探索各类替代设计方案，每一种都承诺带来可观的效率提升和全新的创新路径。</p>
<p>我们希望能各位读者打造一份完整的 AI 硬件指南，因此先从这三大巨头讲起，再转向那些虽不主流却内有乾坤的方案：例如 Cerebras WSE 和 AWS 自研的定制 ASIC；还有 APU、NPU、IPU、RPU 以及 FPGA。我们会帮你厘清这些术语，让你全面掌握 AI 硬件的完整图景。这篇文章必将让你收获满满！</p>
<h2 data-id="heading-1"><strong>01 CPU、GPU、TPU – 三种核心硬件架构</strong></h2>
<p>在探讨其他替代方案之前，先来剖析一下这些我们耳熟能详的 CPU、GPU 和 TPU 到底是什么。</p>
<p>这三大巨头都属于处理单元（Processing Units，简称 PUs） —— 即专门用于执行软件程序指令、进行计算的电子电路。许多人称它们为计算机系统的“大脑”。PUs 执行各类算术、逻辑、控制以及输入/输出操作，将原始数据处理成有用的信息。</p>
<p>不同类型的 PU 针对不同的工作负载进行了优化 →</p>
<h3 data-id="heading-2"><strong>1.1 中央处理单元（Central Processing Unit, CPU）</strong></h3>
<p>中央处理单元（CPU）专为通用计算和顺序任务执行而设计。</p>
<p>CPU 是三者中最古老的。其前身的故事始于 1945 年 —— 约翰·莫奇利（John Mauchly）与 J. 普雷斯珀·埃克特（J. Presper Eckert Jr.）推出了 ENIAC（Electronic Numerical Integrator and Computer）。这是世界上第一台可编程、电子式、通用型的数字计算机，能通过重新编程解决多种数值问题，使用了约 18,000 个真空管。</p>
<p>同年，约翰·冯·诺依曼（John von Neumann）发表了《First Draft of a Report on the EDVAC》，提出将数据和指令存储在同一内存中。这一“存储程序”模型成为现代 CPU 的设计蓝本。</p>
<p>到了 1950 年代中期，真空管被晶体管取代。从那时起，处理器开始由大量基于晶体管的元件组成，并安装在电路板上，使计算机变得更小、更快、更省电。</p>
<p>1960 年代，集成电路（ICs）出现，将多个晶体管集成到单块硅片上。最终在 1971 年，英特尔（Intel）推出了 4004 —— 全球首款商用微处理器，即一颗集成在单一芯片上的 4 位 CPU。这标志着现代 CPU 的真正诞生。</p>
<p>Intel 8086 是如今 x86 CPU 架构的始祖，而目前提升效率的主流方案则是多核处理器 —— 将多个 CPU 核心集成在单一芯片上。</p>
<p>那么，现代 CPU 内部究竟包含什么？它们又是如何工作的？</p>
<p>CPU 的核心是控制单元（control unit），它包含复杂的电路，通过发出电信号来控制整台计算机，并将数据和指令引导至正确的位置。算术逻辑单元（ALU）负责执行数学与逻辑运算，而寄存器（registers）和高速缓存（cache）则提供了极小但极快的存储空间，用于存放处理器频繁需要的数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc7b3f8f98e4060801df745f6f64e59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=H%2BPPAlfo1bekNi7W9JzvALUWH1I%3D" alt="image.png" loading="lazy"/></p>
<p>Image Credit: Wikipedia</p>
<p>CPU 还包含核心（cores） —— 即 CPU 内部的处理单元，每个核心都能独立处理指令；以及线程（threads），允许一个核心同时处理多条指令流。这些组件都按照时钟信号（clock）的节拍运行，时钟提供了同步整个系统所需的节拍。此外，还有总线（buses，用于数据传输）、指令寄存器（instruction register）和指令指针（instruction pointer，用于追踪下一步要执行的内容）等辅助组件，将整个系统紧密连接，使指令能顺畅地从一个步骤流转到下一个。</p>
<p>CPU 的工作遵循一个简单却强大的循环：<strong>取指（fetch）→ 译码（decode）→ 执行（execute）</strong> 。</p>
<ul>
<li>它从内存中取指数据或指令，</li>
<li>将它们译码为硬件能理解的信号，</li>
<li>然后执行所需的操作（例如计算、数值比较，或将数据发送到其他地方）。</li>
</ul>
<p>在现代处理器中，这一过程每秒可发生数十亿次，多个核心与线程并行工作提升性能，使 CPU 如同一个高度协同的组件团队。CPU 核心数量较少（例如 1 到 2 个）时，通常更注重能效（即单位功耗下完成更多有效工作），适合轻量或日常任务，而核心数量较多的 CPU 则用于支撑高性能、高负载的任务。</p>
<p>如今的 CPU 主要来自以下厂商：</p>
<ul>
<li>Intel，产品包括 Core 系列（消费级）、Xeon（服务器/工作站）、Pentium 和 Celeron（入门级）芯片；</li>
<li>AMD，提供 Ryzen（消费级/高性能）和 EPYC（服务器）处理器，以及 APU（Accelerated Processing Unit），它将 CPU 和 GPU 集成在同一颗芯片上（我们稍后会详细讨论）。</li>
</ul>
<p>CPU 用于 AI 时面临的主要问题是：<strong>它针对的是顺序执行的通用任务，而非大规模并行的矩阵运算，因此在速度和能效上远逊于 GPU 或专用芯片。</strong></p>
<p>接下来，让我们转向介绍第二款芯片 —— 著名的 GPU。</p>
<h3 data-id="heading-3"><strong>1.2 图形处理单元（Graphics Processing Unit, GPU）</strong></h3>
<p>图形处理单元（GPU）专为高吞吐量的大规模并行数据处理而优化。GPU 最初被发明用于加速图像和视频中的计算机图形渲染，但后来人们发现它在非图形计算任务中同样大有用武之地。如今，GPU 被广泛应用于可并行化的工作负载，例如处理数据密集型任务和训练 AI 模型。</p>
<p>如今，GPU 是推动 AI 性能提升的核心力量，也是衡量 AI 计算能力的一项关键指标。</p>
<p>“图形处理单元”（GPU）这一术语由 NVIDIA 于 1999 年正式提出，随 GeForce 256 显卡一同发布。NVIDIA 称其为全球首款 GPU，其官方定义为：“集成变换、光照、三角形设置/裁剪及渲染引擎的单芯片处理器。”</p>
<p>那么，这款传奇的 GPU 究竟是如何工作的？→</p>
<p>GPU 内部是一块硅芯片，上面蚀刻着数十亿个微型晶体管，被组织成数千个轻量级处理核心。这些核心通过复杂的布线相互连接，并由高带宽内存和缓存提供支持，使数据能在核心之间高速流动。整个芯片被封装在保护材料中，并配有散热系统来维持稳定运行。</p>
<p>（了解芯片历史的最佳读物之一是克里斯·米勒（Chris Miller）所著的《芯片战争：世界最关键技术的争夺战》（Chip War: The Fight for the World’s Most Critical Technology），强烈推荐。）</p>
<p>与 CPU 不同，GPU 专为并行计算而生 —— 它会将一项大型任务拆分成成千上万个更小、彼此独立的子任务，并将它们分发到各个核心上同步计算。正因如此，GPU 非常适合训练和运行 AI 模型，因为这些模型涉及对海量数据集进行重复的矩阵与张量运算。得益于 GPU 的并行架构，原本需要数月的训练如今几天就能完成，推理速度也足以支撑实时应用 —— 比如聊天机器人。</p>
<p>全球 GPU 生产的领军者是 NVIDIA，它打造了完整的并行计算平台 CUDA（Compute Unified Device Architecture），将 GPU 硬件能力释放到通用计算领域，大幅降低了 GPU 编程的门槛。</p>
<p>NVIDIA 面向 AI 基础设施和行业应用的主要 GPU 产品包括：</p>
<ul>
<li><strong>V100（Volta 架构）</strong>  – 专为深度学习加速而设计，首次引入 Tensor Core（张量核心） —— 专用于加速 AI 训练中矩阵运算的硬件单元。</li>
<li><strong>A100（Ampere 架构）</strong>  – 拥有更多 Tensor Core、更高内存带宽，并支持多实例 GPU（MIG）技术，可将一块物理 GPU 划分为多个逻辑 GPU，提升资源利用效率。</li>
<li><strong>H100、H200（Hopper 架构）</strong>  – 当前 AI 领域的行业标准。H 系列支持 Transformer Engine、超大内存带宽，以及极致的训练与推理速度。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6352519dc001427c80a82a672d7b5a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=tXzzbTwgXULy5EgEQ33J35UX3RU%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：NVIDIA H100 NVL GPU 产品文档</p>
<ul>
<li><strong>Blackwell（例如 B200 和 GB200 Grace-Blackwell “超级芯片”）</strong> 专为下一代拥有数万亿甚至十万亿级参数的 AI 模型而设计。作为 Hopper 架构的继任者，它引入了 FP4 精度，并在推理吞吐量上实现了大幅提升，尤其针对超大规模 Transformer 工作负载。</li>
</ul>
<p>随着行业对 AI 专用处理器的需求日益增长，第三类核心硬件 —— TPU 应运而生。</p>
<h3 data-id="heading-4"><strong>1.3 张量处理单元（Tensor Processing Unit, TPU）</strong></h3>
<p>张量处理单元（TPU）是由 Google 专为加速神经网络运算（尤其是矩阵乘法与机器学习工作流）定制的芯片。它最初在 2016 年 Google I/O 大会上亮相，属于 ASIC（Application-Specific Integrated Circuits，专用集成电路）类别。TPU 的基本架构如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8044bca4ab3747fb968b5a88c360411d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=SKz600s%2FFc6vqntRDUxdvt5H1Yk%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：论文《In-Datacenter Performance Analysis of a Tensor Processing Unit》</p>
<ul>
<li>其核心组件是矩阵乘法单元（Matrix Multiply Unit） —— 一个巨大的 256×256 乘加单元（MAC）阵列，采用脉动阵列（systolic array）结构，数据以“波”的形式在网格中流动。</li>
<li>TPU 还配备了大容量片上存储器：</li>
</ul>

<ul>
<li>
<ul>
<li>统一缓冲区（Unified Buffer，24 MB）：用于存放中间激活值；</li>
<li>权重存储器/ FIFO（Weight Memory/FIFOs）：用于存储神经网络权重；</li>
<li>累加器（Accumulators，4 MB）：用于收集求和结果。</li>
<li>控制逻辑、PCIe 接口和激活单元（用于 ReLU、sigmoid 等函数）为矩阵引擎提供支持，但芯片的大部分面积都用于原始计算和高速数据传输。</li>
</ul>
</li>
</ul>
<p>TPU 的主要特点是作为协处理器工作：</p>
<ul>
<li>主机 CPU 通过 PCIe 向 TPU 发送指令，TPU 直接执行这些指令。</li>
<li>其指令集非常精简（仅约十几条指令），硬件通过流水线设计确保矩阵单元始终处于忙碌状态。</li>
<li>像 TensorFlow 这样的框架会将模型编译成这些底层指令。</li>
</ul>
<p>256 个小型片上存储器（分布式累加器 RAM）用于收集部分和，而脉动阵列则执行乘加（MAC）运算。通过将权重和数据持续流入脉动阵列，并在片上缓冲区中本地复用，TPU 最大限度地减少了对片外内存的访问。因此，大部分计算任务（逐层进行）都能直接在芯片上完成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a12c71695d54079bf56c1fbf1f40991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=bpCoRBbY%2Bb3FKYhivhCZ6c05g4E%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：论文《In-Datacenter Performance Analysis of a Tensor Processing Unit》</p>
<p>总结来说，<strong>TPU 中的每个单元执行小规模计算，并将部分结果传递下去，从而节省功耗，并极大加快 AI 模型背后的数学运算速度。</strong> 这正是 TPU 在相同任务中能实现高吞吐量，同时功耗远低于 CPU/GPU 的原因。根据 Google 2017 年的分析，TPU 在能效比（每瓦性能）上比同期 CPU 和 GPU 高出约 30–80 倍（在推理任务中，拿 TPU 和 K80 这类 GPU 做能效对比）。</p>
<p>然而，仅靠这三种硬件（CPU、GPU、TPU），我们仍无法全面理解驱动 AI 发展的全部技术力量。因此，我们还需梳理整个领域还有哪些技术可供选择。由于 TPU 属于 ASIC 类 AI 芯片，我们将从这一类别出发，探索更多强有力的替代方案。接下来，让我们来深入看看它们如何构想未来 →</p>
<h2 data-id="heading-5"><strong>02 专用集成电路（Application-Specific Integrated Circuits, ASICs）</strong></h2>
<p>ASIC 是完全定制的硅芯片，专为某一种特定的 AI 工作负载而设计。这类芯片既包括云服务巨头的自研芯片，也涵盖初创企业打造的专用 AI 硬件。在这一领域，我们不得不提及……</p>
<h3 data-id="heading-6"><strong>2.1 Cerebras 晶圆级引擎（Wafer-Scale Engine, WSE）</strong></h3>
<p>Cerebras 将未来押注于晶圆级芯片。其最新款 Cerebras WSE-3 芯片实际上是史上尺寸最大的 AI 芯片之一 —— 面积高达 46,255 mm²。其核心技术在于：<strong>Cerebras 将整片硅晶圆直接制成一颗芯片，而不是像传统 CPU 或 GPU 那样将晶圆切割成数百个小处理器。</strong></p>
<p>WSE-3 包含 4 万亿个晶体管、90 万个专为 AI 优化的核心，以及 44 GB 片上 SRAM 内存。每个核心都配备有独立的本地内存，并通过横跨整个晶圆的超高带宽互连网络（fabric）彼此连接，从而大幅缩短计算单元与内存之间的距离。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba80e99b5a4b4e86848ce97984f8a9b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=4uM7jmxiSbfGfGIrrdnzemGJngo%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：Cerebras Wafer-Scale Engine (WSE) 产品手册</p>
<p>Cerebras 的晶圆级理念带来了令人瞩目的成果：</p>
<ul>
<li>单颗 WSE-3 可提供 125 petaFLOPS 的 AI 算力。</li>
<li>据 Cerebras 声称，将 WSE-3 组合成晶圆级集群（Wafer-Scale Cluster, WSC），并集成 MemoryX（用于存储超大模型权重的片外存储）和 SwarmX（用于在节点间广播权重并聚合梯度），即可高效支持数万亿参数模型的训练，且几乎能随硬件规模线性提升性能，同时规避传统 GPU 集群中复杂的通信开销。</li>
</ul>
<p><strong>目前有哪些模型已在 Cerebras WSE 上运行？</strong> 以下是两个典型示例：</p>
<p>1）阿里巴巴的 Qwen3 Coder 480B Instruct，推理速度达到 每秒 2,000 个 token。</p>
<p>2）混合专家模型（Mixture-of-Experts, MoE）：Cerebras 使其大规模训练变得更加简单高效。这类模型可在单个设备上完成训练，无需模型并行（而使用 GPU 时通常必须依赖模型并行）。Cerebras 采用的注意力批处理分块（Batch Tiling on Attention, BTA）技术，解决了稀疏 MoE 模型的计算效率问题 —— 它将注意力层与专家层的批处理需求解耦：注意力层在较小的“分块”（tiles）上运行，以降低内存压力；专家网络则处理更大的有效批次，确保其核心始终处于高利用率状态。</p>
<p>由此可见，这是一项以规模制胜的强大技术。</p>
<h3 data-id="heading-7"><strong>2.2 AWS Trainium 与 AWS Inferentia</strong></h3>
<p>亚马逊同样推出了突破 GPU 垄断的替代方案，并形成了自己对高效硬件的独特构想。其两款自研芯片专为 AI 工作负载设计，并深度集成于 AWS 生态系统之中。</p>
<p>AWS Trainium 专用于模型训练，AWS Inferentia 则面向推理任务。<strong>这两款芯片内部均采用定制的 NeuronCore、高带宽内存（HBM），以及用于张量运算、集合通信和稀疏性加速的专用引擎。</strong></p>
<p>配备 64 颗 Trainium 2 芯片的 Trainium 2 UltraServer 服务器，在处理稀疏模型时，最高可提供 83.2 petaflops 的 FP8 算力；在处理稠密模型时，FP8 算力约为 20.8 petaflops。相比之下，单颗 NVIDIA H100 GPU 的 FP8 算力大约只有 4 petaflops。</p>
<p>AWS Inferentia 2 支持大规模部署大语言模型（LLM）和扩散模型（diffusion models），其每瓦性能比基于 GPU 的同类 EC2 实例（例如 G5 系列）提升约 50 %。</p>
<p>因此，AWS 硬件为生成式 AI 的需求提供了在规模、性能与成本效益三者之间高度平衡的解决方案。</p>
<p>在了解了这些定制化的高效 ASIC 的案例后，我们再回到那些名字中带有 “..PU” 的硬件新锐。接下来是……</p>
<h3 data-id="heading-8"><strong>2.3 加速处理单元（Accelerated Processing Unit, APU）</strong></h3>
<p>如前文所述，<strong>AMD 开发了一种混合型处理单元架构，将 CPU 与 GPU 的能力融合进单一芯片封装中，由此诞生了加速处理单元（APU）。这种设计消除了在独立处理器之间来回传输数据所带来的性能瓶颈。</strong></p>
<p>迄今为止，该理念的最大代表作是 AMD Instinct MI300A。它集成了 24 个 “Zen 4” CPU 核心、228 个 GPU 计算单元，以及高达 128 GB 的 HBM3 内存。</p>
<p>其内部采用 AMD 的 chiplet（小芯片）与 3D 堆叠技术打造。MI300A 的内存能够在 CPU 和 GPU 之间共享，峰值带宽高达 5.3 TB/s。其多芯片架构通过 chiplet 与裸片堆叠，将 CPU 和 GPU 计算单元紧邻高带宽内存布置，并由 AMD 的 Infinity Fabric 与 Infinity Cache 统一互联。此外，该芯片全面支持主流 AI 数据格式，并具备硬件级稀疏性加速能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d36bc4cce34a53bf714f045abdd3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=72ZbDtIgwDa1wq5zLqUGHcUP4W8%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：AMD INSTINCT™ MI300A APU 产品手册</p>
<p>那么问题来了：既然可以拥有“一体式引擎”，又何必在 CPU 和 GPU 之间做选择？</p>
<p>NVIDIA 也在其 NVIDIA Grace Hopper Superchip 中践行了类似理念 —— 这是一款统一模块，将基于 Arm 架构的 Grace CPU 与 Hopper GPU 通过 NVIDIA 自研的 NVLink-C2C 芯片间互连技术紧密耦合。其核心优势与 AMD MI300A 高度一致：</p>
<ul>
<li>CPU 与 GPU 线程可直接访问彼此的内存，</li>
<li>能够执行原子操作，</li>
<li>并实现更高效的同步管理。</li>
</ul>
<p>NVIDIA 表示，Grace Hopper Superchip 在图神经网络（GNN）训练上，速度比通过 PCIe 互联的 H100 GPU 快最多 8 倍；在嵌入向量（embedding）生成任务上，比纯 CPU 方案快约 30 倍。</p>
<p>然而，这种 CPU 与 GPU 的融合也带来了更高的功耗、更低的灵活性以及更复杂的制造工艺。</p>
<p>接下来，我们将转向一些更小巧的硬件类型。</p>
<h3 data-id="heading-9"><strong>2.4 神经网络处理单元（Neural Processing Unit, NPU）</strong></h3>
<p>你可以想象一下，在一颗普通芯片内部专门内置一个用于 AI 任务的加速器 —— 这也正是神经网络处理单元（NPU）的核心理念。NPU 本质上是现代芯片中专为运行 AI 工作负载而打造的小型引擎，用于处理神经网络、图像与语音识别，甚至本地运行的大语言模型（LLM）。通过模拟人脑神经网络架构，NPU 针对 AI 工作负载的计算模式进行专门优化：大量矩阵乘法、激活函数运算，以及在极低功耗下实现高速数据移动。</p>
<p>以下是一些我们如今能在各种设备中实际找到的 NPU 示例：</p>
<ul>
<li>高通（Qualcomm）Snapdragon 芯片中的 Hexagon NPU，为智能手机、汽车、可穿戴设备等提供 AI 功能支持。</li>
<li>Apple Neural Engine：首次亮相于 2017 年的 A11 Bionic 芯片，如今已集成于所有搭载 Apple Silicon 的 iPhone、iPad 和 Mac 中，用于驱动 Face ID、图像处理和 Sir 等功能。</li>
<li>英特尔 NPU（搭载于新一代酷睿 Ultra AI PC 处理器，如 Lunar Lake、Arrow Lake），专为在本地运行 Windows Copilot+ 功能而设计。</li>
<li>AMD 的 XDNA / XDNA 2 NPU：出现在面向笔记本的 Ryzen AI 处理器中，AI 性能高达 55 TOPS。</li>
</ul>
<p><strong>NPUs 非常适合端侧推理，但尚不足以用于训练大语言模型或运行极高负载的任务。</strong> <strong>此外，它们也无法取代 CPU 或 GPU 来执行通用计算任务。</strong> 如果你运行的不是神经网络类负载，NPU 甚至无法正常发挥作用。正是这种高度专精的特性，使 NPU 在众多“PU”中独树一帜。</p>
<h2 data-id="heading-10"><strong>03 其他有前景的替代架构</strong></h2>
<h3 data-id="heading-11"><strong>3.1 智能处理单元（Intelligence Processing Unit, IPU）</strong></h3>
<p>Graphcore 开发的 IPU 是一款具备 1,472 个独立处理器核心的大规模并行处理器，可同时运行近 9,000 个并行线程，并紧密耦合 900 MB 高速片上内存。这意味着数据可以在存储位置直接被处理。IPU 专为机器学习工作负载设计，凭借极高的细粒度并行能力和片上内存架构，它在图计算方面表现出色，能够通过并行处理图中各个节点上的操作，高效应对不规则且稀疏的工作负载。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf8aef48e8f4131b77817255a81a315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=fLjxZaPndgeVEBZRYK8fI%2Fv8mL4%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：Graphcore IPU 博客，《Colossus™ MK2 GC200 IPU》</p>
<h3 data-id="heading-12"><strong>3.2 阻变处理单元（Resistive Processing Unit, RPU）</strong></h3>
<p>RPU 是一种实验性的存内计算（in-memory compute）单元，利用阻变存储器（如忆阻器 memristor 或 RRAM）直接在内存阵列中执行矩阵运算。这种方法极大减少了数据搬运，有望显著降低能耗与延迟。2025 年，IBM 研究人员展示了基于 ReRAM 的模拟存内 AI 加速器，支持片上训练与推理，具备低电压开关特性和多比特存储能力。</p>
<h3 data-id="heading-13"><strong>3.3 现场可编程门阵列（Field-Programmable Gate Arrays, FPGAs）</strong></h3>
<p>FPGA 在可重构 AI 领域具有重要地位，尤其适合需要完全掌控并行性、内存和延迟的场景。与 GPU 或 ASIC 不同，我们可以根据模型的具体需求定制 FPGA 的硬件逻辑，并在架构变更后重新编程。</p>
<p>典型案例如 AMD Versal™ AI Edge 系列 Gen 2，它属于 AMD 的自适应 SoC（System-on-Chip）家族。该芯片在传统 FPGA 可编程逻辑的基础上，进一步在同一裸片上集成了 Arm CPU 和专用 AI 引擎。</p>
<h2 data-id="heading-14"><strong>04 新兴架构（Emerging Architectures）</strong></h2>
<h3 data-id="heading-15"><strong>4.1 量子处理器（Quantum Processors）</strong></h3>
<p>量子芯片使用量子比特（qubits），而非经典比特，利用叠加（superposition）与纠缠（entanglement）等量子特性进行计算。目前，它们正被用于优化、搜索和模拟等任务领域的测试 —— 这些领域在理论上有望借助量子力学实现指数级加速。然而，量子比特仍然极其脆弱且易受噪声干扰，因此当前的量子计算机仅能处理“玩具级”问题。就现阶段而言，它仍是一个长期的“登月计划”，尚无法替代 GPU 或 ASIC。</p>
<h3 data-id="heading-16"><strong>4.2 存内计算（Processing-in-Memory, PIM）与基于 MRAM 的芯片</strong></h3>
<p>AI 面临的一大瓶颈在于内存与计算单元之间的数据搬运。PIM 技术将计算逻辑直接集成到内存阵列中，从而大幅减少这种来回传输。MRAM（磁阻随机存储器）是一种前景广阔的非易失性存储技术，能够支持这一范式转变，助力打造更高密度、更节能的 AI 加速器。三星等大厂以及 Mythic 等初创公司已开始试验相关原型。PIM 并非科幻概念 —— 未来十年内有望实际进入数据中心与边缘设备。</p>
<h3 data-id="heading-17"><strong>4.3 神经形态芯片（Neuromorphic Chips）</strong></h3>
<p>神经形态处理器受人脑脉冲神经元（spiking neurons）启发。与传统依赖密集的、时钟驱动的矩阵乘法不同，它们采用稀疏的、事件驱动的脉冲信号进行计算。例如 Intel 的 Loihi 和 IBM 的 TrueNorth，目标是在传感器、物联网（IoT）和机器人等场景中实现超低功耗的智能。其主要挑战在于：脉冲神经网络（SNN）仍处于早期阶段。尽管神经形态硬件在低功耗边缘 AI 领域潜力巨大，但尚不确定它能否扩展至像大型 Transformer 这类的主流工作负载。</p>
<h2 data-id="heading-18"><strong>05 结语（Conclusion）</strong></h2>
<p>总体而言，各类硬件的定位如下：</p>
<ul>
<li>CPU（中央处理单元）——通用处理器。</li>
<li>GPU（图形处理单元）——专为并行图形计算/数学计算优化。</li>
<li>TPU（张量处理单元）——Google 的 AI 加速器。</li>
<li>ASICs（专用集成电路）——为特定 AI 工作负载定制的芯片。</li>
<li>APU（加速处理单元）——AMD 的 CPU + GPU 融合架构。</li>
<li>NPU（神经网络处理单元）——专为端侧 AI/ML 推理优化的小型芯片。</li>
<li>IPU（智能处理单元）——提供极高细粒度的并行性与片上内存架构。</li>
<li>RPU（阻变处理单元）——基于阻变存储器的存内计算单元。</li>
<li>FPGAs（现场可编程门阵列）——支持对并行性、内存和延迟的完全控制。</li>
</ul>
<p>由此可见，如今“PU”家族选项丰富，GPU 之外也涌现出多种替代方案，这使得硬件生态呈现多样化的态势，并为未来多方向的突破敞开大门。近期，多家科技巨头纷纷宣布正在研发新一代硬件：NVIDIA 正在推进 Rubin 架构，Meta 在测试自研芯片，阿里巴巴及其他中国公司也在开发 AI 推理芯片，以构建自主的硬件生态。这意味着更多全新的技术栈将陆续登场。</p>
<p>若跳出 GPU 和 CPU 的传统框架，我们能清晰看到一个趋势：<strong>AI 硬件市场正加速碎片化，各大厂商都在推动各自的软硬一体化生态。</strong> 这对开发者和企业而言，既是机遇，也是挑战 —— 如何在不断扩张的硬件版图中，有效应对兼容性、软件支持与成本效益等问题，将成为未来的关键课题。</p>
<p><strong>END</strong></p>
<p><strong>本期互动内容 🍻</strong></p>
<p><strong>❓AI 硬件生态正加速碎片化，你认为未来是“一超多强”还是“百花齐放”？</strong></p>
<p><strong>原文链接：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.artificialintelligencemadesimple.com%2Fp%2Finside-the-ai-hardware-race-guest" target="_blank" title="https://www.artificialintelligencemadesimple.com/p/inside-the-ai-hardware-race-guest" ref="nofollow noopener noreferrer">www.artificialintelligencemadesimple.com/p/inside-th…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[量子位：量子计算的支柱]]></title>    <link>https://juejin.cn/post/7581702285563691058</link>    <guid>https://juejin.cn/post/7581702285563691058</guid>    <pubDate>2025-12-10T00:30:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581702285563691058" data-draft-id="7581666412022251529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="量子位：量子计算的支柱"/> <meta itemprop="keywords" content="量子计算"/> <meta itemprop="datePublished" content="2025-12-10T00:30:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天行无忌"/> <meta itemprop="url" content="https://juejin.cn/user/4406498333033918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            量子位：量子计算的支柱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498333033918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天行无忌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:30:06.000Z" title="Wed Dec 10 2025 00:30:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad6e1fa63244f77a5190386cb10fcad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931405&amp;x-signature=Oe144rZShdTHHYtVXo31q%2BSym0E%3D" alt="未标题-1.jpg" loading="lazy"/></p>
<p>量子位是量子信息的基本单位，这是一个既有趣又复杂的概念。这不仅仅是科技领域的另一种趋势；它也是一种趋势。它是即将到来的量子计算时代的革命性基石。</p>
<blockquote>
<p>“量子位代表原子、离子、光子或电子以及它们各自的控制设备，它们一起工作，充当计算机存储器和处理器。” — IBM 量子研究员</p>
</blockquote>
<p>在接下来的几节中，将深入探讨量子位对量子计算领域如此重要的原因。但首先，需要一个基础，首先要了解量子位到底是什么以及为什么它对量子计算的未来至关重要。</p>
<ul>
<li>什么是量子比特？</li>
<li>量子比特如何工作？</li>
<li>为什么量子比特在量子计算中很重要？</li>
</ul>
<p>无论是对这个概念完全陌生还是只是寻求深入的解释，本文都将引导了解量子位的世界并定义其在未来计算中的作用。</p>
<p>首先解释什么是量子位。通俗地说，量子比特，即“量子位”，是量子信息的基本单位。这与经典计算中“位”的概念相似，但有一些重要的差异。</p>
<p>如果熟悉传统计算，就会知道位提供两种可能的状态：<code>0</code> 和 <code>1</code>。这是经典计算机的二进制基础。然而，量子位超越了这种二元性。由于量子物理学的独特性质，量子位不仅可以存在于状态 <code>0</code> 或 <code>1</code>，还可以存在于这些状态的叠加中。这意味着一个量子位可以同时处于 <code>0</code> 和 <code>1</code> 状态，这个概念乍一看似乎很陌生。</p>
<p>当开始将几个量子位以一种称为量子纠缠的方式组合在一起时，真正的魔法就会发生。在这样一个纠缠系统中，量子位可以以经典计算中无法做到的方式相互关联。这些叠加和纠缠释放了巨大的计算能力，这就是量子计算真正发挥作用的时候。</p>
<p>那么，为什么要关心量子位呢？计算的未来在于量子计算及其量子比特的核心。量子计算的潜在应用是巨大的：从以极低的成本和时间创造新药，到破解以前无法破解的代码，到准确预测气候变化等等。了解量子比特是人类实现这一巨大飞跃的一小步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d260ffac2fc4bccb3fba95d10338686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931405&amp;x-signature=3kU%2FmDV1xTR%2BRMcVynBNO%2FCIuTc%3D" alt="image.png" loading="lazy"/></p>
<p>虽然仍处于量子计算技术的早期阶段，但对量子位的理解和操纵正在取得重大进展。通过深入研究量子位的世界，正在为未来铺平道路，在未来，曾经因计算限制而被认为无法解决的问题可以得到正面解决。</p>
<p>当更加深入地探究量子计算的奥秘时，可能会取得的成就令人惊讶。这一切都始于理解不起眼但功能强大的量子位。</p>
<p>通过一个例子来仔细研究一下量子位。想象一下有一个处于 <code>|ψ⟩</code> 状态的量子位。在量子力学中，这种状态可以使用线性代数作为列向量来表示：</p>
<pre><code class="hljs">|ψ⟩ = α | 0 ⟩ + β | 1 ⟩
</code></pre>
<p>在上面的等式中，<code>α</code> 和 <code>β</code> 是复概率幅，其平方后给出量子位处于状态 <code>|0⟩</code> 或状态 <code>|1⟩</code> 的可能性。对于有效的量子态，这些概率的总和必须等于 <code>1</code>。因此，可以写：</p>
<pre><code class="hljs language-css" lang="css">|<span class="hljs-selector-tag">a</span>|^ <span class="hljs-number">2</span> + |<span class="hljs-selector-tag">b</span>|^ <span class="hljs-number">2</span> = <span class="hljs-number">1</span>
</code></pre>
<p>因此，通过这个数学方程，可以计算量子计算中任何给定状态的概率！这不是很迷人吗？</p>
<ul>
<li>与经典计算中的传统位不同，量子位由于叠加的特性可以同时处于两种状态，使其更能够进行复杂的计算。</li>
<li>每增加一个量子位，量子计算机的计算能力就会呈指数级增长，展现出计算能力的巨大飞跃。</li>
<li>纠缠是另一种关键的量子现象，它使纠缠的量子位无论距离如何都能立即相互影响，为超高速、下一代数据传输奠定了基础。</li>
<li>量子纠错是量子计算的另一个关键方面，由于量子位的脆弱性，因此需要它。科学家们全神贯注于开发管理和纠正量子错误的技术。</li>
<li>量子霸权时代是可以​​预见的，即量子计算机在解决复杂问题方面超越经典计算机，但尚未完全到来。我们是量子计算发展的一部分。</li>
<li>最后，虽然量子计算拥有巨大的潜力，但由于其目前处于起步阶段以及与扩大规模相关的技术挑战，它仍然主要存在于实验室环境中。然而，过去十年所取得的进步证明了这项技术不可阻挡的发展。</li>
</ul>
<p>总之，在改变游戏规则的量子信息单位——量子比特的引领下，释放量子计算真正潜力的冒险之旅正在顺利进行。凭借叠加和纠缠等独特功能，量子位有望重新定义计算能力和速度的界限，有望实现量子霸权等突破，这可能会彻底改变从解密到复杂问题解决等许多领域。然而，必须承认所面临的挑战。对有效量子纠错方法的探索和扩大量子系统的任务证明了这条道路的复杂性。然而，不断的进步提醒我们，这个方向的每一步都是计算进化的一步，开启了量子计算不再局限于实验室，而是成为我们日常生活不可或缺的一部分的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个让你爽歪歪的请求工具是怎样的]]></title>    <link>https://juejin.cn/post/7581752787563413544</link>    <guid>https://juejin.cn/post/7581752787563413544</guid>    <pubDate>2025-12-10T00:35:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787563413544" data-draft-id="7578719771588788234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个让你爽歪歪的请求工具是怎样的"/> <meta itemprop="keywords" content="Vue.js,React.js,Node.js"/> <meta itemprop="datePublished" content="2025-12-10T00:35:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古韵"/> <meta itemprop="url" content="https://juejin.cn/user/1538972010422872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个让你爽歪歪的请求工具是怎样的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1538972010422872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古韵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:35:28.000Z" title="Wed Dec 10 2025 00:35:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>各位好，很久没出来发一发alova文章了，现在的alova已经更新到第3个大版本了，看这篇文章可能会让你对它有个全新的认识。</p>
<p>如果你之前了解过alova，那么大概率知道alova是一个轻量级的请求策略库，通过它的客户端请求hooks和缓存高效地处理前端数据请求。</p>
<p>而到今天，alova3在此基础上实现了更大的提升，它不只是在客户端中使用，现在还能在服务端环境下大放异彩，是一个<strong>全栈式的极致高效的请求工具集</strong>，其核心目标是帮助开发团队更高效地集成和调用API，并且完美兼容fetch、axios等HTTP客户端，以及react、vue、svelte等UI框架。</p>
<p>具体来说，alova3相比之前的版本，它带来了以下的大更新。</p>
<ol>
<li>多级缓存：请求效率和减压利器。</li>
<li>全栈的请求策略：帮你大大减少请求代码。</li>
<li>更加现代化的OpenAPI工具：不仅可以自动生成请求代码，还能把api文档搬到编辑器中，交互式地调用api，打破过去的api集成流程。</li>
</ol>
<p><strong>这里我想郑重声明一下，由于ai大模型对alova知识学习的不足，现在网上充斥着各种ai编写的alova的错误使用的文章，建议大家前往<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org" target="_blank" title="https://alova.js.org" ref="nofollow noopener noreferrer">alova官网</a>了解alova的正确使用方法。</strong></p>
<h2 data-id="heading-0">一、多级缓存</h2>
<p>多级缓存机制可以为你的服务端应用提供最快的请求体验。你可以自由选择单级缓存还是多级缓存使用，它们运行机制如下：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户请求] --&gt; B{检查L1缓存}
    B --&gt;|命中| C[返回数据]
    B --&gt;|未命中| D{检查L2缓存}
    D --&gt;|命中| E[更新L1缓存]
    D --&gt;|未命中| F[请求API接口]
    F --&gt; G[更新L2缓存]
    E --&gt; C
    G --&gt; E
    C --&gt; H[结束]
</code></pre>
<p>默认情况下，alova 的一级缓存是简单的 object 以 key-value 的方式缓存，而二级缓存在不同环境下的默认表现也不同，具体看下面。</p>
<h3 data-id="heading-1">客户端</h3>
<p>在客户端环境下，一级缓存一般用于短时的请求数据缓存，例如几分钟或几秒钟的频繁请求相同数据带来的性能消耗，当你在写 todo 详情页的时候，你可能会想到用户会频繁在 todo 列表中点击查看详情，此时使用一级缓存可以大大提升效率，降低服务端压力。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对详情数据设置60秒的一级缓存</span>
alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/todo/detail'</span>, {
  <span class="hljs-attr">params</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span>
  },
  <span class="hljs-attr">cacheFor</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 设置60秒的一级缓存</span>
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<p>而二级缓存可用于一些枚举数据、节日等长期不变的请求为主，默认使用<code>localStorage</code>存储。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对枚举数据设置3天缓存时间</span>
alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/config/enum'</span>, {
  <span class="hljs-attr">params</span>: {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'xxx'</span>
  },
  <span class="hljs-attr">cacheFor</span>: {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'restore'</span>,
    <span class="hljs-attr">expire</span>: <span class="hljs-number">3</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 缓存3天时间</span>
  }, 
});
</code></pre>
<h3 data-id="heading-2">服务端</h3>
<p>在服务端环境下，多级缓存机制特别适用于以下场景：</p>
<ol>
<li>
<p><strong>高访问频率和低延迟需求</strong>：例如热门新闻、商品详情，可以进一步减少网络开销，在网络不稳定时也保持更快的响应。</p>
</li>
<li>
<p><strong>减轻下游服务器压力</strong>：例如有访问高峰期的服务，上层缓存可以有效减少对后端数据库和微服务的压力。</p>
</li>
<li>
<p><strong>整合多个下游服务器的数据合并和处理</strong>：多个串行请求可能导致更长的响应时间，也可能因复杂的数据转换消耗性能，可将转换后的数据进行缓存。</p>
</li>
<li>
<p><strong>API 速率限制和计费</strong>：天气预报服务 API 每小时更新一次天气信息，地理位置数据 API 等。</p>
</li>
<li>
<p><strong>鉴权数据</strong>：用户token等数据缓存到内存中，避免频繁的鉴权操作。</p>
</li>
<li>
<p><strong>请求速率限制等分布式数据</strong>：用户的请求次数限制等数据。</p>
</li>
</ol>
<p>具体可以看<a href="https://juejin.cn/post/7578820431018622991?share_token=0ebefce4-4817-450a-bae9-191040529eb6" target="_blank" title="https://juejin.cn/post/7578820431018622991?share_token=0ebefce4-4817-450a-bae9-191040529eb6">这篇文章</a></p>
<p>以下是一个使用进程间内存共享适配器加 LRU cache 作为一级缓存，redis 作为二级缓存的示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { createPSCAdapter, <span class="hljs-title class_">NodeSyncAdapter</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@alova/psc'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">LRUCache</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lru-cache'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RedisStorageAdapter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./adapter-redis'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">lRUCache</span>(<span class="hljs-params">options = {}</span>) {
  <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>(options);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">set</span>(key, value);
    },

    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(key);
    },

    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">delete</span>(key);
    },

    <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">clear</span>();
    }
  };
}

<span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>

  <span class="hljs-comment">// 进程间共享缓存适配器</span>
  <span class="hljs-attr">l1Cache</span>: <span class="hljs-title function_">createPSCAdapter</span>(
    <span class="hljs-title class_">NodeSyncAdapter</span>(),
    <span class="hljs-title function_">lRUCache</span>({
      <span class="hljs-attr">max</span>: <span class="hljs-number">1000</span>,
      <span class="hljs-attr">ttl</span>: <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">10</span>
    })
  ),

  <span class="hljs-comment">// redis缓存适配器</span>
  <span class="hljs-attr">l2Cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStorageAdapter</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>,
    <span class="hljs-attr">username</span>: <span class="hljs-string">'default'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'my-top-secret'</span>,
    <span class="hljs-attr">db</span>: <span class="hljs-number">0</span>
  })
});
</code></pre>
<p>通过多级缓存机制，alova3能够实现：</p>
<ul>
<li><strong>响应时间减少80%+</strong>：通过内存缓存实现毫秒级响应</li>
<li><strong>服务器负载降低60%+</strong>：减少不必要的API调用</li>
<li><strong>离线体验优化</strong>：持久化缓存支持完整的离线功能</li>
<li><strong>带宽节约</strong>：减少重复数据传输</li>
</ul>
<p>这种多级缓存架构使得alova3特别适合需要高性能数据访问的现代Web应用，在微服务架构和分布式系统中也表现出色。</p>
<h2 data-id="heading-3">二、全栈的请求策略</h2>
<h3 data-id="heading-4">服务端请求策略</h3>
<p>alova3一个关键特性是引入了对服务端的完整支持，你不仅可以在nodejs、deno、bun等运行时中使用，还提供了独有的服务端请求策略，简称server hooks，它可以很方便地处理分布式的BFF、API网关、第三方token管理等，同时还有请求速率限制、请求重试、验证码发送与校验等模块，可以快速实现分布式的特定业务逻辑。</p>
<p>BFF、API网关、第三方token管理等，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.alova.cn%2Fdocs%2Fserver-hooks" target="_blank" title="https://www.alova.cn/docs/server-hooks" ref="nofollow noopener noreferrer">这篇文章</a>中有详细的介绍，这边我们来看看验证码发送校验模块的使用。</p>
<p>按照惯例，首先创建一个alova实例。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { createAlova } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/server'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RedisStorageAdapter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@alova/storage-redis'</span>);
<span class="hljs-keyword">const</span> adapterFetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/fetch'</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">requestAdapter</span>: <span class="hljs-title function_">adapterFetch</span>(),
  <span class="hljs-comment">// redis缓存适配器</span>
  <span class="hljs-attr">l2Cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStorageAdapter</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>,
    <span class="hljs-attr">username</span>: <span class="hljs-string">'default'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'my-top-secret'</span>,
    <span class="hljs-attr">db</span>: <span class="hljs-number">0</span>
  })
});
</code></pre>
<p>然后再创建一个验证码提供者函数，并指定使用redis适配器作为缓存载体，以便实现分布式环境下的使用。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { createCaptchaProvider } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/server'</span>);

<span class="hljs-keyword">const</span> { sendCaptcha, verifyCaptcha } = <span class="hljs-title function_">createCaptchaProvider</span>({
  <span class="hljs-attr">store</span>: alovaInstance.<span class="hljs-property">options</span>.<span class="hljs-property">l2Cache</span>
});

<span class="hljs-keyword">export</span> sendCaptcha;
<span class="hljs-keyword">export</span> verifyCaptcha;
</code></pre>
<p>第三步，再发送验证码，这里我们使用<code>retry</code>来实现重试，提高成功率。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建一个发送验证码的method实例</span>
<span class="hljs-keyword">const</span> createCaptchaMethod = (code, key) = &gt; alovaInstance.<span class="hljs-title class_">Post</span>(<span class="hljs-string">'/api/captcha'</span>, {
  code,
  <span class="hljs-attr">email</span>: key,
});

<span class="hljs-comment">// 使用sendCaptcha hook包装createCaptchaMethod</span>
<span class="hljs-keyword">const</span> captchaMethod = <span class="hljs-title function_">sendCaptcha</span>(createCaptchaMethod, {
  <span class="hljs-attr">key</span>: <span class="hljs-string">'xxx@xxx.com'</span>
});

<span class="hljs-comment">// 使用retry hook包装captchaMethod，并通过await发送请求并获取响应结果</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">retry</span>(captchaMethod, {
  <span class="hljs-attr">retry</span>: <span class="hljs-number">3</span>,
  <span class="hljs-attr">backoff</span>: {
    <span class="hljs-attr">delay</span>: <span class="hljs-number">2000</span>
  }
});
</code></pre>
<p>最后一步，通过用户的提交来验证验证码。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fakeCaptchaFromUserInput = <span class="hljs-string">'1234'</span>;
<span class="hljs-keyword">const</span> isValid = <span class="hljs-keyword">await</span> <span class="hljs-title function_">verifyCaptcha</span>(fakeCaptchaFromUserInput, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid ? <span class="hljs-string">'验证通过'</span> : <span class="hljs-string">'验证码错误'</span>);
</code></pre>
<h3 data-id="heading-5">客户端的请求策略</h3>
<p>alova3的客户端请求策略与之前的版本大相径庭，依然提供了<code>useRequest</code>、<code>useWatcher</code>、<code>usePagination</code>等UI框架相关的hooks，在这里大家应该都很熟悉了，但不同的是，无论你使用react、vue还是svelte，这些hook都由统一的<code>alova/client</code>中导入。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'alova/client'</span>;

<span class="hljs-keyword">const</span> { data, loading, error, send } = <span class="hljs-title function_">useRequest</span>(alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/todo/list'</span>));
</code></pre>
<h3 data-id="heading-6">全栈框架nuxt支持</h3>
<p>虽然在之前的版本中，alova已经支持在next、nuxt、svelitekit等SSR框架中使用，不过在alova3中，提供了一个专门适配nuxt的statesHook，可以在使用<code>useRequest</code>、<code>useWatcher</code>等几乎所有的hooks时不仅可以同步两端的数据，像内置的<code>useFetch</code>一样避免在客户端重复请求，还可以同步例如<code>Date</code>，<code>Error</code>等以及自定义类型的数据，用法也非常简单，设置一下<code>NuxtHook</code>即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createAlova } <span class="hljs-keyword">from</span> <span class="hljs-string">'alova'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NuxtHook</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'alova/nuxt'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">statesHook</span>: <span class="hljs-title class_">NuxtHook</span>({
    <span class="hljs-attr">nuxtApp</span>: useNuxtApp <span class="hljs-comment">// 必须指定useNuxtApp</span>
  })
});
</code></pre>
<h2 data-id="heading-7">三、工具链支持：更加现代化的OpenAPI工具</h2>
<p>除了核心库的增强，alova3还提供了开发工具和vscode扩展来优化工作流。</p>
<p>如果你的项目支持openapi，这些开发工具可以基本消除API文档，让你直接在编辑器中查找接口、查看完整文档并交互式地快速插入接口的调用代码，很大程度地提升了开发效率和体验。</p>
<p>同时，你还可以完全控制openapi在前端生成的内容，例如过滤掉某些接口，新增、删除或修改某个接口的参数等，这些在openapi文件不够规范，或者有错误时非常有用，并且是其他openapi自动生成工具所不具备的。</p>
<p>一起来具体看看怎么回事。</p>
<h3 data-id="heading-8">快速查找和插入调用代码</h3>
<h3 data-id="heading-9">自定义修改生成内容</h3>
<p>在一般情况下，服务端的返回数据格式会外包一层，例如：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>而此时我们希望生成的响应数据类型为<code>response.data</code>，你可以在alova配置文件中使用<code>payloadModifier</code>插件。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@alova/wormhole'</span>;
<span class="hljs-keyword">import</span> { payloadModifier } <span class="hljs-keyword">from</span> <span class="hljs-string">'@alova/wormhole/plugin'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">generator</span>: [
    {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-attr">plugin</span>: [
        <span class="hljs-title function_">payloadModifier</span>([
          {
            <span class="hljs-attr">scope</span>: <span class="hljs-string">'response'</span>,
            <span class="hljs-attr">handler</span>: <span class="hljs-function"><span class="hljs-params">schema</span> =&gt;</span> schema.<span class="hljs-property">data</span>
          }
        ])
      ]
    }
  ]
});
</code></pre>
<p>你也还可以通过<code>handleApi</code>实现完全的自定义，例如以下是一个修改tag的例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">generator</span>: [
    {
      <span class="hljs-attr">handleApi</span>: <span class="hljs-function"><span class="hljs-params">apiDescription</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (apiDescription.<span class="hljs-property">url</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/user'</span>)) {
          apiDescription.<span class="hljs-property">tags</span> = [<span class="hljs-string">'userTag'</span>];
        }
        <span class="hljs-keyword">return</span> apiDescription;
      }
    }
  ]
});
</code></pre>
<h3 data-id="heading-10">边查边接入接口</h3>
<p>使用alova的vscode扩展，你可以直接在编辑器中查找接口，并直接插入调用代码，不仅如此，接口的所有相关信息都可以直接在代码中查看，像这样。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf48e785e23b487eac71aa3b41a98ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931728&amp;x-signature=3QJ%2FgaMng%2FpTCDoERIcQXiTqgi4%3D" alt="image.png" loading="lazy"/></p>
<p>弹框中能清楚的看到接口的描述信息、请求参数、响应参数等，你可以一边看着弹框中的参数，一边在代码中传参，这个点子太棒啦，再也不用在api文档和编辑器中来回切换，然后每次还要重新找对应信息了。</p>
<h3 data-id="heading-11">编辑器中的api文档</h3>
<p>这个vscode扩展还提供了在编辑器中查看接口文档的功能，你可以直接在编辑的侧边栏中查看接口文档，就像这样。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f1d07da3dfe49b7ac83c6401f3b9048~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931728&amp;x-signature=R3G9Glf0284RekqbQLBZ1n3cIPI%3D" alt="" loading="lazy"/></p>
<p>也可以在代码中的调用代码上直接点击“view documentation”打开对应的接口文档，可以实现快速查看接口的描述信息、请求参数、响应参数等。</p>
<h2 data-id="heading-12">写在最后</h2>
<p>到这里，你应该感受到了一点alova3的不同了吧，通过以上的方式让前端在接口集成方向很大程度地提升效率，无论你是前端开发者希望提升应用性能，还是后端工程师需要构建高效的API网关，亦或是全栈开发者追求统一的开发体验，alova3都能为你提供完整的支持。</p>
<p>如果觉得alova还不错，真诚希望你可以<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fexamples" target="_blank" title="https://alova.js.org/examples" ref="nofollow noopener noreferrer">尝试体验一下</a>，也可以给我们来一个免费的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova" target="_blank" title="https://github.com/alovajs/alova" ref="nofollow noopener noreferrer">github stars</a>。</p>
<p>访问alovajs的官网查看更多详细信息：<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org" target="_blank" title="https://alova.js.org" ref="nofollow noopener noreferrer">alovajs官网</a>。</p>
<p>有兴趣可以加入我们的交流社区，在第一时间获取到最新进展，也能直接和开发团队交流，提出你的想法和建议。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fimg%2Fwechat_qrcode.jpg" target="_blank" title="https://alova.js.org/img/wechat_qrcode.jpg" ref="nofollow noopener noreferrer">加入微信群参与交流</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FS47QGJgkVb" target="_blank" title="https://discord.gg/S47QGJgkVb" ref="nofollow noopener noreferrer">加入在 Discord 社区参与交流</a></li>
</ul>
<p>有任何问题，你可以加入以下群聊咨询，也可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova%2Fdiscussions" target="_blank" title="https://github.com/alovajs/alova/discussions" ref="nofollow noopener noreferrer">github 仓库中发布 Discussions</a>，如果遇到问题，也请在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova%2Fissues" target="_blank" title="https://github.com/alovajs/alova/issues" ref="nofollow noopener noreferrer">github 的 issues</a>中提交，我们会在最快的时间解决。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter自定义日历table_calendar完全指南+案例]]></title>    <link>https://juejin.cn/post/7581693431740448831</link>    <guid>https://juejin.cn/post/7581693431740448831</guid>    <pubDate>2025-12-10T00:45:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740448831" data-draft-id="7581097545671376915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Flutter自定义日历table_calendar完全指南+案例"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-10T00:45:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Flutter自定义日历table_calendar完全指南+案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:45:26.000Z" title="Wed Dec 10 2025 00:45:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 简介</h2>
<p><code>table_calendar</code> 是 Flutter 生态中功能强大的日历组件，支持多种视图切换、事件标记、日期范围选择等核心功能，适合需集成日历功能的应用场景（如日程管理、预约系统等）。其高度可定制化的特性使其能适配不同的 UI 需求。</p>
<h2 data-id="heading-1">2. 基础配置</h2>
<h3 data-id="heading-2">安装</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">table_calendar:</span> <span class="hljs-string">^3.0.1</span>  <span class="hljs-comment"># 请使用最新版本</span>
</code></pre>
<h3 data-id="heading-3">最简实现</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:table_calendar/table_calendar.dart'</span>;

TableCalendar(
  firstDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2020</span>),
  lastDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2030</span>),
  focusedDay: <span class="hljs-built_in">DateTime</span>.now(),
  selectedDayPredicate: (day) {
    <span class="hljs-keyword">return</span> isSameDay(_selectedDay, day);
  },
  onDaySelected: (selectedDay, focusedDay) {
    setState(() {
      _selectedDay = selectedDay;
      _focusedDay = focusedDay;
    });
  },
)
</code></pre>
<p>核心参数说明：</p>
<ul>
<li><code>firstDay</code>/<code>lastDay</code>：日历显示范围（必传）</li>
<li><code>focusedDay</code>：当前聚焦的日期（控制滚动位置，必传）</li>
<li><code>selectedDayPredicate</code>：判断日期是否被选中的条件</li>
<li><code>onDaySelected</code>：日期选择回调（返回选中日期和新聚焦日期）</li>
</ul>
<h2 data-id="heading-4">3. 核心属性全解析</h2>
<h3 data-id="heading-5">3.1. 核心基础属性</h3>








































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>firstDay</code></td><td><code>DateTime</code></td><td>日历显示的起始日期（必传）</td></tr><tr><td><code>lastDay</code></td><td><code>DateTime</code></td><td>日历显示的结束日期（必传）</td></tr><tr><td><code>focusedDay</code></td><td><code>DateTime</code></td><td>当前聚焦的日期（必传，控制日历滚动位置）</td></tr><tr><td><code>selectedDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否被选中的条件</td></tr><tr><td><code>onDaySelected</code></td><td><code>void Function(DateTime, DateTime)</code></td><td>单个日期选中回调（选中日期+聚焦日期）</td></tr><tr><td><code>onPageChanged</code></td><td><code>void Function(DateTime)</code></td><td>日历页面切换时回调（返回新聚焦日期）</td></tr></tbody></table>
<h3 data-id="heading-6">3.2. 视图控制属性</h3>








































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarFormat</code></td><td><code>CalendarFormat</code></td><td>日历展示格式（month/week/twoWeeks）</td></tr><tr><td><code>onFormatChanged</code></td><td><code>void Function(CalendarFormat)</code></td><td>视图格式切换回调</td></tr><tr><td><code>availableCalendarFormats</code></td><td><code>Map&lt;CalendarFormat, String&gt;</code></td><td>允许的视图格式及对应显示文本</td></tr><tr><td><code>pageJumpingEnabled</code></td><td><code>bool</code></td><td>是否允许点击表头月份快速跳转页面（默认true）</td></tr><tr><td><code>weekNumbersVisible</code></td><td><code>bool</code></td><td>是否显示周数（默认false）</td></tr><tr><td><code>weekNumberStyle</code></td><td><code>TextStyle</code></td><td>周数文本样式</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  <span class="hljs-comment">// ...基础参数</span>
  calendarFormat: _calendarFormat,
  onFormatChanged: (format) {
    setState(() {
      _calendarFormat = format;
    });
  },
  availableCalendarFormats: {
    CalendarFormat.month: <span class="hljs-string">'月'</span>,
    CalendarFormat.week: <span class="hljs-string">'周'</span>,
    CalendarFormat.twoWeeks: <span class="hljs-string">'两周'</span>,
  },
)
</code></pre>
<h3 data-id="heading-7">3.3. 范围选择属性</h3>



































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>rangeStartDay</code></td><td><code>DateTime?</code></td><td>范围选择的起始日期</td></tr><tr><td><code>rangeEndDay</code></td><td><code>DateTime?</code></td><td>范围选择的结束日期</td></tr><tr><td><code>rangeSelectionMode</code></td><td><code>RangeSelectionMode</code></td><td>范围选择模式（toggledOff/toggledOn/forced）</td></tr><tr><td><code>onRangeSelected</code></td><td><code>void Function(DateTime?, DateTime?, DateTime)</code></td><td>范围选择回调（起始/结束/聚焦日期）</td></tr><tr><td><code>rangeDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否允许被纳入范围选择</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart">RangeSelectionMode _rangeSelectionMode = RangeSelectionMode.toggledOff;
<span class="hljs-built_in">DateTime?</span> _rangeStart;
<span class="hljs-built_in">DateTime?</span> _rangeEnd;

TableCalendar(
  <span class="hljs-comment">// ...基础参数</span>
  rangeStartDay: _rangeStart,
  rangeEndDay: _rangeEnd,
  rangeSelectionMode: _rangeSelectionMode,
  onRangeSelected: (start, end, focusedDay) {
    setState(() {
      _rangeStart = start;
      _rangeEnd = end;
      _rangeSelectionMode = RangeSelectionMode.toggledOn;
      _selectedDay = <span class="hljs-keyword">null</span>;  <span class="hljs-comment">// 清除单个选中</span>
    });
  },
)
</code></pre>
<h3 data-id="heading-8">3.4. 事件与标记属性</h3>






























<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>eventLoader</code></td><td><code>List&lt;Object&gt; Function(DateTime)</code></td><td>加载指定日期的事件数据</td></tr><tr><td><code>calendarBuilders</code></td><td><code>CalendarBuilders</code></td><td>自定义日历元素构建器（标记/日期等）</td></tr><tr><td><code>holidayLoader</code></td><td><code>List&lt;Object&gt; Function(DateTime)</code></td><td>加载指定日期的假日数据</td></tr><tr><td><code>eventFadeTransitionEnabled</code></td><td><code>bool</code></td><td>事件标记是否启用淡入动画（默认true）</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 定义事件数据结构</span>
<span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">DateTime</span>, <span class="hljs-built_in">List</span>&gt; _events = {
  <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>): [<span class="hljs-string">'会议'</span>, <span class="hljs-string">'生日'</span>],
  <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>): [<span class="hljs-string">'deadline'</span>],
};

TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  eventLoader: (day) {
    <span class="hljs-keyword">return</span> _events[day] ?? [];
  },
  calendarBuilders: CalendarBuilders(
    markerBuilder: (context, date, events) {
      <span class="hljs-keyword">if</span> (events.isEmpty) <span class="hljs-keyword">return</span> SizedBox();
      <span class="hljs-keyword">return</span> Positioned(
        bottom: <span class="hljs-number">1</span>,
        child: Container(
          width: <span class="hljs-number">16</span>,
          height: <span class="hljs-number">4</span>,
          decoration: BoxDecoration(
            color: Colors.blue,
            borderRadius: BorderRadius.circular(<span class="hljs-number">2</span>),
          ),
        ),
      );
    },
  ),
)
</code></pre>
<h3 data-id="heading-9">3.5. 样式定制属性</h3>


















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarStyle</code></td><td><code>CalendarStyle</code></td><td>日历主体样式配置</td></tr><tr><td><code>headerStyle</code></td><td><code>HeaderStyle</code></td><td>表头（月份栏）样式配置</td></tr><tr><td><code>daysOfWeekStyle</code></td><td><code>DaysOfWeekStyle</code></td><td>星期标题样式配置</td></tr><tr><td><code>rowHeight</code></td><td><code>double</code></td><td>日历行高（影响整体高度）</td></tr><tr><td><code>columnWidth</code></td><td><code>double?</code></td><td>日历列宽（null时自动计算）</td></tr><tr><td><code>padding</code></td><td><code>EdgeInsets</code></td><td>日历内边距</td></tr><tr><td><code>margin</code></td><td><code>EdgeInsets</code></td><td>日历外边距</td></tr><tr><td><code>clipBehavior</code></td><td><code>Clip</code></td><td>裁剪行为（默认Clip.hardEdge）</td></tr></tbody></table>
<h4 data-id="heading-10">CalendarStyle 子属性</h4>



















































































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>defaultTextStyle</code></td><td><code>TextStyle</code></td><td>默认日期文本样式</td></tr><tr><td><code>selectedTextStyle</code></td><td><code>TextStyle</code></td><td>选中日期文本样式</td></tr><tr><td><code>todayTextStyle</code></td><td><code>TextStyle</code></td><td>今天日期文本样式</td></tr><tr><td><code>weekendTextStyle</code></td><td><code>TextStyle</code></td><td>周末日期文本样式</td></tr><tr><td><code>outsideTextStyle</code></td><td><code>TextStyle</code></td><td>显示范围外日期文本样式</td></tr><tr><td><code>disabledTextStyle</code></td><td><code>TextStyle</code></td><td>禁用日期文本样式</td></tr><tr><td><code>selectedDecoration</code></td><td><code>Decoration</code></td><td>选中日期装饰（背景等）</td></tr><tr><td><code>todayDecoration</code></td><td><code>Decoration</code></td><td>今天日期装饰</td></tr><tr><td><code>defaultDecoration</code></td><td><code>Decoration</code></td><td>默认日期装饰</td></tr><tr><td><code>weekendDecoration</code></td><td><code>Decoration</code></td><td>周末日期装饰</td></tr><tr><td><code>outsideDecoration</code></td><td><code>Decoration</code></td><td>范围外日期装饰</td></tr><tr><td><code>disabledDecoration</code></td><td><code>Decoration</code></td><td>禁用日期装饰</td></tr><tr><td><code>rangeStartDecoration</code></td><td><code>Decoration</code></td><td>范围选择起始日期装饰</td></tr><tr><td><code>rangeEndDecoration</code></td><td><code>Decoration</code></td><td>范围选择结束日期装饰</td></tr><tr><td><code>rangeMiddleDecoration</code></td><td><code>Decoration</code></td><td>范围选择中间日期装饰</td></tr><tr><td><code>markersDecoration</code></td><td><code>Decoration</code></td><td>事件标记容器装饰</td></tr><tr><td><code>markersMaxCount</code></td><td><code>int</code></td><td>最多显示的事件标记数量</td></tr><tr><td><code>markerSize</code></td><td><code>double</code></td><td>事件标记大小</td></tr><tr><td><code>markersOffset</code></td><td><code>PositionedOffset</code></td><td>事件标记偏移量</td></tr><tr><td><code>canMarkersOverflow</code></td><td><code>bool</code></td><td>标记是否允许溢出日期单元格</td></tr><tr><td><code>outsideDaysVisible</code></td><td><code>bool</code></td><td>是否显示范围外的日期（默认true）</td></tr></tbody></table>
<h4 data-id="heading-11">HeaderStyle 子属性</h4>











































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>formatButtonVisible</code></td><td><code>bool</code></td><td>是否显示视图切换按钮（默认true）</td></tr><tr><td><code>formatButtonShowsNext</code></td><td><code>bool</code></td><td>切换按钮是否显示下一个格式（默认true）</td></tr><tr><td><code>formatButtonDecoration</code></td><td><code>BoxDecoration</code></td><td>视图切换按钮装饰</td></tr><tr><td><code>formatButtonTextStyle</code></td><td><code>TextStyle</code></td><td>视图切换按钮文本样式</td></tr><tr><td><code>leftChevronIcon</code></td><td><code>Widget</code></td><td>左箭头图标</td></tr><tr><td><code>rightChevronIcon</code></td><td><code>Widget</code></td><td>右箭头图标</td></tr><tr><td><code>titleTextStyle</code></td><td><code>TextStyle</code></td><td>标题（月份）文本样式</td></tr><tr><td><code>titleCentered</code></td><td><code>bool</code></td><td>标题是否居中（默认false）</td></tr><tr><td><code>titleFormatter</code></td><td><code>String Function(DateTime, dynamic)</code></td><td>标题文本格式化器</td></tr><tr><td><code>headerPadding</code></td><td><code>EdgeInsets</code></td><td>表头内边距</td></tr><tr><td><code>headerMargin</code></td><td><code>EdgeInsets</code></td><td>表头外边距</td></tr><tr><td><code>chevronPadding</code></td><td><code>EdgeInsets</code></td><td>箭头图标内边距</td></tr><tr><td><code>chevronVisible</code></td><td><code>bool</code></td><td>是否显示箭头图标（默认true）</td></tr></tbody></table>
<p>样式定制示例：</p>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  calendarStyle: CalendarStyle(
    <span class="hljs-comment">// 选中日期样式</span>
    selectedDecoration: BoxDecoration(
      color: Colors.blue,
      shape: BoxShape.circle,
    ),
    <span class="hljs-comment">// 今天日期样式</span>
    todayDecoration: BoxDecoration(
      color: Colors.grey[<span class="hljs-number">200</span>],
      shape: BoxShape.circle,
    ),
    <span class="hljs-comment">// 周末样式</span>
    weekendTextStyle: TextStyle(color: Colors.red),
    <span class="hljs-comment">// 事件标记样式</span>
    markersMaxCount: <span class="hljs-number">3</span>,  <span class="hljs-comment">// 最多显示3个标记</span>
    markerSize: <span class="hljs-number">6</span>,
  ),
  <span class="hljs-comment">// 表头样式</span>
  headerStyle: HeaderStyle(
    formatButtonVisible: <span class="hljs-keyword">false</span>,  <span class="hljs-comment">// 隐藏视图切换按钮</span>
    titleCentered: <span class="hljs-keyword">true</span>,
    headerPadding: EdgeInsets.symmetric(vertical: <span class="hljs-number">8</span>),
    titleTextStyle: TextStyle(fontSize: <span class="hljs-number">18</span>, fontWeight: FontWeight.bold),
  ),
)
</code></pre>
<h3 data-id="heading-12">3.6. 本地化属性</h3>






























<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>locale</code></td><td><code>String?</code></td><td>本地化语言代码（如'zh_CN'、'en_US'）</td></tr><tr><td><code>daysOfWeekLabels</code></td><td><code>List&lt;String&gt;</code></td><td>星期标签文本（默认按locale生成）</td></tr><tr><td><code>daysOfWeekLabelsExceptions</code></td><td><code>Map&lt;int, String&gt;</code></td><td>特定星期几的文本覆盖</td></tr><tr><td><code>weekNumberLabel</code></td><td><code>String</code></td><td>周数标签文本（默认'W'）</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:intl/intl.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:intl/date_symbol_data_local.dart'</span>;

<span class="hljs-comment">// 初始化本地化</span>
initializeDateFormatting().then((_) {
  setState(() {});
});

TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  locale: <span class="hljs-string">'zh_CN'</span>,  <span class="hljs-comment">// 支持 'en_US', 'ja_JP' 等</span>
  daysOfWeekStyle: DaysOfWeekStyle(
    weekdayStyle: TextStyle(),
    weekendStyle: TextStyle(color: Colors.red),
  ),
)
</code></pre>
<h3 data-id="heading-13">3.7. 交互控制属性</h3>



































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>enabledDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否可交互（默认全部可交互）</td></tr><tr><td><code>onHeaderTapped</code></td><td><code>void Function(DateTime)</code></td><td>表头点击回调</td></tr><tr><td><code>onHeaderLongPressed</code></td><td><code>void Function(DateTime)</code></td><td>表头长按回调</td></tr><tr><td><code>onDayLongPressed</code></td><td><code>void Function(DateTime, DateTime)</code></td><td>日期长按回调</td></tr><tr><td><code>dragStartBehavior</code></td><td><code>DragStartBehavior</code></td><td>拖拽起始行为（默认start）</td></tr></tbody></table>
<h3 data-id="heading-14">3.8. 高级自定义属性</h3>













































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarBuilders</code></td><td><code>CalendarBuilders</code></td><td>自定义构建器集合（以下为常用子项）</td></tr><tr><td>- <code>dayBuilder</code></td><td><code>Widget Function(BuildContext, DateTime, DateTime, bool, bool, bool, bool, List)</code></td><td>自定义日期单元格</td></tr><tr><td>- <code>markerBuilder</code></td><td><code>Widget Function(BuildContext, DateTime, List)</code></td><td>自定义事件标记</td></tr><tr><td>- <code>headerTitleBuilder</code></td><td><code>Widget Function(BuildContext, DateTime)</code></td><td>自定义表头标题</td></tr><tr><td>- <code>weekNumberBuilder</code></td><td><code>Widget Function(BuildContext, int)</code></td><td>自定义周数显示</td></tr><tr><td><code>transitionDuration</code></td><td><code>Duration</code></td><td>视图切换动画时长（默认200ms）</td></tr><tr><td><code>pageAnimationEnabled</code></td><td><code>bool</code></td><td>是否启用页面切换动画（默认true）</td></tr></tbody></table>
<h2 data-id="heading-15">4. 性能优化</h2>
<ul>
<li>使用 <code>ValueNotifier</code> 管理事件数据，避免不必要重建</li>
<li>复杂标记使用缓存Widget</li>
<li>合理设置 <code>firstDay</code> 和 <code>lastDay</code> 范围</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> ValueNotifier&lt;<span class="hljs-built_in">List</span>&gt; _selectedEvents = ValueNotifier([]);

<span class="hljs-comment">// 监听选中日期变化更新事件</span>
<span class="hljs-keyword">void</span> _updateSelectedEvents() {
  _selectedEvents.value = _events[_selectedDay] ?? [];
}

<span class="hljs-comment">// 构建时使用ValueListenableBuilder</span>
ValueListenableBuilder&lt;<span class="hljs-built_in">List</span>&gt;(
  valueListenable: _selectedEvents,
  builder: (context, value, _) {
    <span class="hljs-keyword">return</span> <span class="hljs-comment">// 事件列表</span>
  },
)
</code></pre>
<h2 data-id="heading-16">5. 完整配置示例</h2>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  firstDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2020</span>),
  lastDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2030</span>),
  focusedDay: _focusedDay,
  selectedDayPredicate: (day) =&gt; isSameDay(_selectedDay, day),
  onDaySelected: (selectedDay, focusedDay) {
    <span class="hljs-keyword">if</span> (!isSameDay(_selectedDay, selectedDay)) {
      setState(() {
        _selectedDay = selectedDay;
        _focusedDay = focusedDay;
      });
    }
  },
  <span class="hljs-comment">// 视图配置</span>
  calendarFormat: _calendarFormat,
  onFormatChanged: (format) =&gt; setState(() =&gt; _calendarFormat = format),
  availableCalendarFormats: <span class="hljs-keyword">const</span> {
    CalendarFormat.month: <span class="hljs-string">'月'</span>,
    CalendarFormat.week: <span class="hljs-string">'周'</span>,
  },
  <span class="hljs-comment">// 范围选择</span>
  rangeStartDay: _rangeStart,
  rangeEndDay: _rangeEnd,
  rangeSelectionMode: _rangeSelectionMode,
  onRangeSelected: (start, end, focusedDay) =&gt; setState(() {
    _rangeStart = start;
    _rangeEnd = end;
    _rangeSelectionMode = RangeSelectionMode.toggledOn;
  }),
  <span class="hljs-comment">// 事件加载</span>
  eventLoader: (day) =&gt; _events[day] ?? [],
  <span class="hljs-comment">// 样式定制</span>
  calendarStyle: CalendarStyle(
    selectedDecoration: <span class="hljs-keyword">const</span> BoxDecoration(
      color: Colors.blue,
      shape: BoxShape.circle,
    ),
    todayDecoration: BoxDecoration(
      color: Colors.grey[<span class="hljs-number">200</span>],
      shape: BoxShape.circle,
    ),
    markersMaxCount: <span class="hljs-number">3</span>,
  ),
  headerStyle: <span class="hljs-keyword">const</span> HeaderStyle(
    titleCentered: <span class="hljs-keyword">true</span>,
    formatButtonVisible: <span class="hljs-keyword">false</span>,
  ),
  <span class="hljs-comment">// 本地化</span>
  locale: <span class="hljs-string">'zh_CN'</span>,
  <span class="hljs-comment">// 自定义构建器</span>
  calendarBuilders: CalendarBuilders(
    markerBuilder: (context, date, events) =&gt; events.isNotEmpty
        ? Container(
            width: <span class="hljs-number">12</span>,
            height: <span class="hljs-number">12</span>,
            decoration: <span class="hljs-keyword">const</span> BoxDecoration(
              color: Colors.red,
              shape: BoxShape.circle,
            ),
          )
        : <span class="hljs-keyword">null</span>,
  ),
)
</code></pre>
<h2 data-id="heading-17">6. 总结</h2>
<p><code>table_calendar</code> 提供了灵活的日历解决方案，核心关注：</p>
<ul>
<li>基础日期选择与范围选择的状态管理</li>
<li>事件标记与自定义样式的视觉定制</li>
<li>视图切换与本地化的用户体验优化</li>
<li>性能优化技巧（如状态隔离、合理设置范围）</li>
</ul>
<p>更复杂功能可参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Ftable_calendar" target="_blank" title="https://pub.dev/packages/table_calendar" ref="nofollow noopener noreferrer">官方文档</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faleksanderwozniak%2Ftable_calendar" target="_blank" title="https://github.com/aleksanderwozniak/table_calendar" ref="nofollow noopener noreferrer">Github仓库</a>实现。使用时需注意范围选择与单个选择的互斥性，以及本地化配置的初始化步骤。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信红包封面制作redbag-cover]]></title>    <link>https://juejin.cn/post/7581728606308073524</link>    <guid>https://juejin.cn/post/7581728606308073524</guid>    <pubDate>2025-12-10T00:56:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606308073524" data-draft-id="7581750252999868451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信红包封面制作redbag-cover"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T00:56:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信红包封面制作redbag-cover
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:56:07.000Z" title="Wed Dec 10 2025 00:56:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年春节，我注意到微信红包封面搜索量暴增，却鲜有便捷的生成工具。于是我决定做一个红包封面生成网站。
借助AI强大开发能力， 仅用一周时间。完成<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.redbagcover.com" target="_blank" title="https://www.redbagcover.com" ref="nofollow noopener noreferrer">www.redbagcover.com</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc6ff12f7de049e9b85749975b6604f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765932967&amp;x-signature=lDyKUN8%2FQ%2BplSiLqdGbI94HZloY%3D" alt="image.png" loading="lazy"/>
产品核心功能：一个<strong>允许用户通过简单提示词快速生成符合微信官方要求的红包封面的工具</strong>
欢迎大家体验！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路]]></title>    <link>https://juejin.cn/post/7581728606308089908</link>    <guid>https://juejin.cn/post/7581728606308089908</guid>    <pubDate>2025-12-10T00:56:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606308089908" data-draft-id="7581741663182962723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-10T00:56:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beordie"/> <meta itemprop="url" content="https://juejin.cn/user/2928754708190679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754708190679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beordie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:56:55.000Z" title="Wed Dec 10 2025 00:56:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为 LeetCode 的第一道入门题，「两数之和」虽然标注为<strong>简单</strong>难度，却是理解数组遍历与哈希表核心思想的经典案例。它不仅是算法新手的入门必修课，更能让我们体会到 <strong>空间换时间</strong> 的优化思维。今天从最基础的暴力解法开始，一步步拆解到时间复杂度 O (n) 的最优解法，带你彻底搞懂这道题的解题逻辑～</p>
<h2 data-id="heading-0">📖 题目重述</h2>
<p>给你一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请在数组中找出<strong>两个不同位置</strong>的整数，使它们的和恰好等于 <code>target</code>，最后返回这两个数的下标。这里有几个关键规则要注意：</p>
<ol>
<li>每个输入都<strong>只有一个正确答案</strong>；</li>
<li>数组中的同一个元素不能被重复使用；</li>
<li>返回的下标顺序没有要求。</li>
</ol>
<p>举个例子，输入数组 <code>[2,7,11,15]</code>、目标值 9，因为 2+7=9，所以返回下标 <code>[0,1]</code> 即可。</p>
<h2 data-id="heading-1">🚶 阶梯思路拆解</h2>
<h3 data-id="heading-2">第一步：暴力枚举所有可能 🥾</h3>
<p>要找两个数的和等于目标值，最直观的想法就是<strong>把数组中所有数两两配对，逐一检查和是否符合要求</strong>。这就是暴力解法的核心逻辑，也是最容易想到的思路。</p>
<h3 data-id="heading-3">💡 核心逻辑</h3>
<p>用两层嵌套的 for 循环遍历数组：</p>
<ul>
<li>外层循环固定一个数 <code>nums[i]</code>，遍历范围是数组的每一个元素；</li>
<li>内层循环遍历 <code>i</code> 之后的所有数 <code>nums[j]</code>（避免重复检查同一对数字）；</li>
<li>若 <code>nums[i] + nums[j] == target</code>，直接返回下标数组 <code>{i, j}</code>。</li>
</ul>
<h3 data-id="heading-4">✅ 代码实现（Java）</h3>
<pre><code class="hljs language-ini" lang="ini">class Solution {
    public int<span class="hljs-section">[]</span> twoSum(int<span class="hljs-section">[]</span> nums, int target) {
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        // 外层循环固定第一个数
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
            // 内层循环遍历第二个数，从i+1开始避免重复
            for (int <span class="hljs-attr">j</span> = i + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt; n; j++) {</span>
                if (nums<span class="hljs-section">[i]</span> + nums<span class="hljs-section">[j]</span> == target) {
                    return new int<span class="hljs-section">[]</span>{i, j}<span class="hljs-comment">;</span>
                }
            }
        }
        // 题目保证有解，此处仅为语法兜底
        return new int<span class="hljs-section">[0]</span><span class="hljs-comment">;</span>
    }
}

// 测试代码
public class Main {
    public static void main(String<span class="hljs-section">[]</span> args) {
        Solution <span class="hljs-attr">solution</span> = new Solution()<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums1</span> = {<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res1</span> = solution.twoSum(nums1, <span class="hljs-number">9</span>)<span class="hljs-comment">;</span>
        System.out.println(res1<span class="hljs-section">[0]</span> + "," + res1<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>

        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums2</span> = {<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res2</span> = solution.twoSum(nums2, <span class="hljs-number">6</span>)<span class="hljs-comment">;</span>
        System.out.println(res2<span class="hljs-section">[0]</span> + "," + res2<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出1,2</span>
    }
}
</code></pre>
<h3 data-id="heading-5">⚙️ 复杂度分析</h3>




















<table><thead><tr><th align="left">复杂度类型</th><th align="left">计算结果</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">时间复杂度</td><td align="left">O(n²)</td><td align="left">两层嵌套循环，最坏情况下需要遍历 n*(n-1)/2 次，n 为数组长度</td></tr><tr><td align="left">空间复杂度</td><td align="left">O(1)</td><td align="left">仅使用了几个临时变量，未开辟额外的数组或集合空间</td></tr></tbody></table>
<h3 data-id="heading-6">🚫 遇到的问题</h3>
<p>暴力解法的逻辑简单，但效率极低。当数组长度 <code>n</code> 达到 10⁴ 时，n² 就是 10⁸ 次运算，会触发 LeetCode 的超时判定；如果是百万级别的数组，这种方法更是完全不可行。问题的核心在于：<strong>内层循环的查找过程重复且耗时</strong>，我们需要找到一种更高效的查找方式。</p>
<h3 data-id="heading-7">第二步：用哈希表优化查找效率 🗺️</h3>
<p>既然暴力解法的痛点是 <strong>查找补数</strong> 的过程太慢，那我们可以用 哈希表（HashMap）来记录已经遍历过的数字和它的下标，把查找操作从 O (n) 降到 O (1)。这是算法优化中典型的 <strong>空间换时间</strong> 策略。</p>
<h3 data-id="heading-8">💡 核心逻辑</h3>
<ol>
<li>初始化一个 <code>HashMap</code>，键存储<strong>遍历过的数字</strong>，值存储该数字对应的<strong>数组下标</strong>；</li>
<li>遍历数组时，对当前数字 <code>nums[i]</code>，计算它的 <code>补数</code> <code>complement = target - nums[i]</code>；</li>
<li>检查补数是否存在于 HashMap 中：
<ul>
<li>若存在，说明之前已经遍历过这个补数，直接返回 <code>{map.get(complement), i}</code>；</li>
<li>若不存在，将当前数字和下标存入 HashMap，继续遍历下一个元素。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">📊 图文演示（以 nums=[2,7,11,15], target=9 为例）</h3>
<p>我们一步步拆解 HashMap 的变化和查找过程，直观感受优化后的逻辑（如图所示）：</p>
<ol>
<li>遍历 i=0，nums [i]=2，补数 = 9-2=7。此时 HashMap 为空，将 <code>2→0</code> 存入 Map：
<pre><code class="hljs language-ini" lang="ini">HashMap：{<span class="hljs-attr">2</span>=<span class="hljs-number">0</span>}
当前遍历：nums<span class="hljs-section">[0]</span>=2 → 补数7不存在 ❌
</code></pre>
</li>
<li>遍历 i=1，nums [i]=7，补数 = 9-7=2。检查 HashMap，发现 2 存在且对应下标 0：
<pre><code class="hljs language-ini" lang="ini">HashMap：{<span class="hljs-attr">2</span>=<span class="hljs-number">0</span>}
当前遍历：nums<span class="hljs-section">[1]</span>=7 → 补数2存在 ✅ → 返回{0,1}
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">✅ 代码实现（Java）</h3>
<pre><code class="hljs language-ini" lang="ini">import java.util.HashMap<span class="hljs-comment">;</span>
import java.util.Map<span class="hljs-comment">;</span>

class Solution {
    public int<span class="hljs-section">[]</span> twoSum(int<span class="hljs-section">[]</span> nums, int target) {
        // 初始化HashMap，键：数字，值：下标
        Map&lt;Integer, Integer&gt; <span class="hljs-attr">numMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
            int <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
            // 检查补数是否在HashMap中
            if (numMap.containsKey(complement)) {
                return new int<span class="hljs-section">[]</span>{numMap.get(complement), i}<span class="hljs-comment">;</span>
            }
            // 若不存在，将当前数字和下标存入Map
            numMap.put(nums<span class="hljs-section">[i]</span>, i)<span class="hljs-comment">;</span>
        }
        // 题目保证有解，此处仅为语法兜底
        return new int<span class="hljs-section">[0]</span><span class="hljs-comment">;</span>
    }
}

// 测试代码
public class Main {
    public static void main(String<span class="hljs-section">[]</span> args) {
        Solution <span class="hljs-attr">solution</span> = new Solution()<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums1</span> = {<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res1</span> = solution.twoSum(nums1, <span class="hljs-number">9</span>)<span class="hljs-comment">;</span>
        System.out.println(res1<span class="hljs-section">[0]</span> + "," + res1<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>

        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums2</span> = {<span class="hljs-number">3</span>,<span class="hljs-number">3</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res2</span> = solution.twoSum(nums2, <span class="hljs-number">6</span>)<span class="hljs-comment">;</span>
        System.out.println(res2<span class="hljs-section">[0]</span> + "," + res2<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>
    }
}
</code></pre>
<h3 data-id="heading-11">⚙️ 复杂度分析</h3>




















<table><thead><tr><th align="left">复杂度类型</th><th align="left">计算结果</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">时间复杂度</td><td align="left">O(n)</td><td align="left">仅需遍历一次数组，HashMap 的查找和插入操作均为 O (1)</td></tr><tr><td align="left">空间复杂度</td><td align="left">O(n)</td><td align="left">最坏情况下，需要将数组中 n 个元素全部存入 HashMap</td></tr></tbody></table>
<h3 data-id="heading-12">✨ 优化亮点</h3>
<p>这种方法通过 HashMap 将原本 O (n) 的查找过程优化为 O (1)，时间复杂度从 O (n²) 骤降到 O (n)，虽然牺牲了部分空间，但在实际开发中，时间效率的提升往往更重要。这也是「两数之和」这道题的<strong>最优解法</strong>。</p>
<h2 data-id="heading-13">📝 总结</h2>
<p>「两数之和」看似简单，却蕴含了算法优化的核心思维：<strong>用合适的数据结构解决性能瓶颈</strong>。我们从暴力枚举的基础思路出发，找到 <strong>重复查找</strong> 的性能问题，再通过<code>哈希表</code>实现高效查找，这个优化路径也是很多数组类算法题的通用解题模板。</p>
<h3 data-id="heading-14">同类题扩展建议</h3>
<p>掌握了这道题的哈希表思路后，可以继续练习这些进阶题目，巩固优化思维：</p>
<ol>
<li><strong>LeetCode 15. 三数之和</strong>：在两数之和的基础上增加一层循环，结合双指针优化去重；</li>
<li><strong>LeetCode 18. 四数之和</strong>：延续三数之和的思路，注意边界条件和去重逻辑；</li>
<li><strong>LeetCode 454. 四数相加 II</strong>：用两个 HashMap 分别存储两组数的和，进一步降低时间复杂度。</li>
</ol>
<p>算法学习不是一蹴而就的，从基础解法开始逐步优化，才能真正理解背后的逻辑。希望这篇文章能帮你吃透「两数之和」，也为后续的算法学习打下坚实的基础～</p>
<h3 data-id="heading-15">📢 关注不迷路，算法学习更高效！</h3>
<p>如果这篇拆解对你有帮助，别忘了<strong>关注我的微信公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEKY2kxsfVxLv6G10wS6rjg" target="_blank" title="https://mp.weixin.qq.com/s/EKY2kxsfVxLv6G10wS6rjg" ref="nofollow noopener noreferrer">【小镇冥想人】</a></strong> ～ 后续会持续更新 LeetCode 高频题的阶梯式解题思路，从暴力到最优解层层递进，每道题都搭配详细图文和代码注释，帮你轻松攻克算法难关。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[费曼学习法：为什么你应该通过写博客来掌握任何知识]]></title>    <link>https://juejin.cn/post/7581676787380355091</link>    <guid>https://juejin.cn/post/7581676787380355091</guid>    <pubDate>2025-12-09T23:27:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787380355091" data-draft-id="7581693431740383295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="费曼学习法：为什么你应该通过写博客来掌握任何知识"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-12-09T23:27:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            费曼学习法：为什么你应该通过写博客来掌握任何知识
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:27:51.000Z" title="Tue Dec 09 2025 23:27:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾花费数小时学习某个概念，却在几天后发现自己几乎忘得一干二净？或者你是否曾试图向他人解释你刚刚学到的知识，却发现自己的理解支离破碎？</p>
<p>理查德·费曼——诺贝尔物理学奖得主、杰出的教育家——提出了一种简单却极其强大的学习方法，它不仅能帮你真正理解知识，还能让你长期记住所学内容。而今天，我要向你推荐一个将费曼学习法效果最大化的实践方式：写博客。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc32f73056664b30a0435c21860b7f63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765927670&amp;x-signature=4ZdCRWTkbCUB9XjhndQH4zZkkP4%3D" alt="v2-44083e9702de380f873f664b40d3ccb7_1440w.jpg" loading="lazy"/></p>
<p>v2-44083e9702de380f873f664b40d3ccb7_1440w.jpg</p>
<h2 data-id="heading-0">什么是费曼学习法？</h2>
<p>费曼学习法的核心思想很简单：<strong>如果你不能简单地解释某件事，你就没有真正理解它。</strong></p>
<p>这个方法包含五个关键步骤：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a438bf373e794a4aaa62fff3b5a5ae3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765927670&amp;x-signature=BCGT%2BRGsLCeXYF2D5FSekQ2d1Jk%3D" alt="_20251210_071503.png" loading="lazy"/></p>
<p>_20251210_071503.png</p>
<ol>
<li><strong>确认目标</strong>：确定你想要理解的主题或概念</li>
<li><strong>开始学习</strong>：学习你确认的目标</li>
<li><strong>教授他人</strong>：假装你在向一个完全没有相关知识的人解释这个概念</li>
<li><strong>反思回顾</strong>：在解释过程中，识别你理解不足的地方</li>
<li><strong>简化吸收</strong>：用更简单的语言和类比重新组织你的解释</li>
</ol>
<h2 data-id="heading-1">🎯 为什么博客是实践费曼学习法的完美载体？</h2>
<h3 data-id="heading-2">1. 写作是思考的延伸</h3>
<p>当你开始将想法转化为文字时，你被迫组织思维、理清逻辑。博客写作要求你按照连贯的结构表达思想，这本身就是一种深度处理信息的过程。</p>
<h3 data-id="heading-3">2. 面向“假想的初学者”</h3>
<p>博客的天然属性是面向读者的，即使你的读者可能只是未来的自己。这种“为他人写作”的心态恰好符合费曼学习法的核心——用简单明了的语言解释复杂概念。</p>
<h3 data-id="heading-4">3. 发现知识缺口的放大镜</h3>
<p>在写作过程中，你会遇到“这里我其实不太确定”或“这两部分如何连接”的困境，这些正是你需要填补的知识缺口。与仅仅在脑中思考不同，文字将这些缺口具象化，让你无法忽视。</p>
<h3 data-id="heading-5">4. 建立可回顾的知识库</h3>
<p>你的博客文章成为个人学习档案，方便日后回顾和更新。这是传统学习方式无法提供的持续价值。</p>
<h2 data-id="heading-6">🚀 如何通过博客实践费曼学习法：四步实操指南</h2>
<h3 data-id="heading-7">第一步：选择主题，开始“学习型写作”</h3>
<p>不要等到完全掌握某个主题后再开始写作。相反，<strong>将写作作为学习过程的一部分</strong>。</p>
<p>例如，假设你想学习机器学习中的“梯度下降”算法：</p>
<ul>
<li>不要等到上完所有课程再写</li>
<li>在学习基本概念后，立即开始撰写博客：“梯度下降：一个初学者的理解尝试”</li>
<li>标题本身就承认了你仍在学习，减轻了完美主义压力</li>
</ul>
<h3 data-id="heading-8">第二步：像教孩子一样写作</h3>
<p>设定你的目标读者是完全的新手：</p>
<ul>
<li>避免专业术语，或至少每次使用时都加以解释</li>
<li>使用类比和比喻（如“梯度下降就像下山找最低点”）</li>
<li>加入简单的图表或示意图</li>
<li>想象你在向一个聪明的12岁孩子解释这个概念</li>
</ul>
<h3 data-id="heading-9">第三步：识别并填补知识缺口</h3>
<p>在写作中，你会自然遇到问题：</p>
<ul>
<li>“这部分我不太确定是否准确”</li>
<li>“这个公式为什么这样推导？”</li>
<li>“这个概念与之前学的那个有什么联系？”</li>
</ul>
<p><strong>不要跳过这些困难部分</strong>。标记它们，然后：</p>
<ol>
<li>回到原始资料深入研究</li>
<li>查找额外的解释资源</li>
<li>向他人请教</li>
<li>更新你的博客文章，包含新的理解</li>
</ol>
<h3 data-id="heading-10">第四步：精简与重构</h3>
<p>完成初稿后，进行费曼式的精简：</p>
<ul>
<li>能否用更少的词语表达？</li>
<li>有没有更简单的类比？</li>
<li>结构是否可以更清晰？ 请他人阅读并提供反馈，特别是那些不熟悉该领域的人。</li>
</ul>
<h2 data-id="heading-11">✨ 克服常见障碍</h2>
<h3 data-id="heading-12">“我不是专家，没资格写”</h3>
<p>记住：<strong>你不需要成为专家才能写作，写作能帮助你成为专家</strong>。你的学习过程本身就是价值——其他初学者正经历同样的困惑。</p>
<h3 data-id="heading-13">“我的理解可能有误”</h3>
<p>这正是重点！公开写作让你更有可能得到纠正。在博客中坦诚你的不确定性：“根据我目前的理解...”或“如果我错了请指正...”</p>
<h3 data-id="heading-14">“没时间同时学习和写作”</h3>
<p>将写作视为学习的一部分，而不是额外任务。每周花1-2小时整理一周所学，这实际上会节省你后期的复习时间。</p>
<h2 data-id="heading-15">开始你的第一个费曼式博客</h2>
<p>今天就可以开始：</p>
<ol>
<li>
<p><strong>选择一个小概念</strong>：选一个你最近学过但感觉不够牢固的概念</p>
</li>
<li>
<p><strong>设定时间限制</strong>：给自己25分钟写初稿</p>
</li>
<li>
<p><strong>使用简单结构</strong>：</p>
<ul>
<li>我想解释什么？</li>
<li>最简单的解释是什么？</li>
<li>最好的类比是什么？</li>
<li>我还有什么疑问？</li>
</ul>
</li>
<li>
<p><strong>发布它</strong>：即使不完美，也要发布。注明“初步理解，持续更新”</p>
</li>
</ol>
<h2 data-id="heading-16">长期回报：超越学习的额外收益</h2>
<p>实践“费曼学习法+博客”不仅加深理解，还带来：</p>
<ul>
<li><strong>个人品牌建设</strong>：展示你的学习能力和专业知识</li>
<li><strong>职业机会</strong>：很多招聘者会查看候选人的技术博客</li>
<li><strong>社区连接</strong>：吸引志同道合者，形成学习网络</li>
<li><strong>思维清晰度提升</strong>：写作训练逻辑思维和表达能力</li>
</ul>
<h2 data-id="heading-17">🤝最后的鼓励</h2>
<p>理查德·费曼曾说：<strong><code>第一原则是不要欺骗自己，而你自己是最容易欺骗的人。</code></strong> 博客写作正是对抗自我欺骗的利器——你无法在清晰的文字面前假装理解。</p>
<p>学习不是被动吸收信息，而是主动建构理解。而写作，尤其是面向他人的写作，是最强大的建构工具之一。</p>
<p>今天，就选择一个你“以为”自己理解的概念，尝试为完全的新手写一篇解释文章。你可能会惊讶地发现那些隐藏的理解缺口，更会惊喜于通过填补这些缺口获得的深刻理解。</p>
<p><strong>真正的理解不是当你能够重复信息时获得的，而是当你能够重塑并传递它时获得的。</strong> 开始写吧，让博客成为你深度学习的见证者和催化剂。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（1）什么是Netty？它的主要特点是什么？]]></title>    <link>https://juejin.cn/post/7581750252999475235</link>    <guid>https://juejin.cn/post/7581750252999475235</guid>    <pubDate>2025-12-09T23:08:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581750252999475235" data-draft-id="7581750252999458851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（1）什么是Netty？它的主要特点是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T23:08:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（1）什么是Netty？它的主要特点是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:08:06.000Z" title="Tue Dec 09 2025 23:08:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty是一个基于Java NIO的网络编程框架，它提供了简单而强大的API，用于快速开发高性能、可扩展的网络应用程序。以下是Netty的一些主要特点：</p>
<ol>
<li>
<p>异步和事件驱动：Netty使用事件驱动的方式处理网络请求和数据传输，通过异步的方式实现高效的处理和响应。</p>
</li>
<li>
<p>高性能和可扩展性：Netty的设计目标之一是提供高性能和可扩展性。它使用了高度优化的数据结构和算法，以及基于事件驱动的模型，使得它能够处理大量的并发连接。</p>
</li>
<li>
<p>灵活的网络协议支持：Netty支持多种网络协议，包括TCP、UDP、HTTP、WebSocket等，可以灵活地构建各种网络应用。</p>
</li>
</ol>
<p>下面是一个简单的示例代码，展示了如何使用Netty创建一个简单的Echo服务器：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">bootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            bootstrap.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO))
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">EchoServerHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> bootstrap.bind(PORT).sync();
            future.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }
}

<span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) msg;
        System.out.println(<span class="hljs-string">"Received message: "</span> + message);
        ctx.write(msg); <span class="hljs-comment">// 将接收到的消息写回给客户端</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelReadComplete</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        ctx.flush(); <span class="hljs-comment">// 将消息发送队列中的消息写入到SocketChannel中发送给对方</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        cause.printStackTrace();
        ctx.close(); <span class="hljs-comment">// 发生异常时关闭连接</span>
    }
}
</code></pre>
<p>在上面的示例中，我们创建了一个Echo服务器，它接收客户端发送的消息，并将其原样返回给客户端。使用Netty，我们可以通过简单的配置和处理器来实现这个功能。在服务器启动时，我们创建了两个EventLoopGroup，一个用于接收连接，一个用于处理连接的I/O操作。然后，我们配置了服务器的引导类(ServerBootstrap)，指定了服务器的通道类型(NioServerSocketChannel)，设置了日志处理器(LoggingHandler)和消息处理器(EchoServerHandler)。最后，我们绑定端口并启动服务器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（2）Netty的核心组件是什么？]]></title>    <link>https://juejin.cn/post/7581752787563249704</link>    <guid>https://juejin.cn/post/7581752787563249704</guid>    <pubDate>2025-12-09T23:09:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787563249704" data-draft-id="7581752787563233320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（2）Netty的核心组件是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T23:09:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（2）Netty的核心组件是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:09:48.000Z" title="Tue Dec 09 2025 23:09:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的核心组件包括：</p>
<ol>
<li>
<p>Channel：表示一个网络连接或一个能够进行I/O操作的实体。它可以用于读取和写入数据，以及进行各种网络操作。在Netty中，Channel是消息传输的载体。</p>
</li>
<li>
<p>EventLoop：是一个处理I/O事件的线程，负责处理所有的I/O操作，如接收连接、读取数据、写入数据等。每个Channel都会关联一个EventLoop，用于处理该Channel的所有事件。</p>
</li>
<li>
<p>ChannelPipeline：是一个处理Channel中事件的处理器链。它包含了一系列的ChannelHandler，用于处理和转换数据。当有数据进入或者出去时，会经过ChannelPipeline中的各个ChannelHandler进行处理。</p>
</li>
<li>
<p>ChannelHandler：是一个用于处理I/O事件和数据的组件。它可以接收事件和数据，对其进行处理，并将结果传递给下一个ChannelHandler。</p>
</li>
</ol>
<p>下面是一个示例代码，展示了如何使用Netty的核心组件：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">bootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            bootstrap.group(group)
                    .channel(NioSocketChannel.class)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO))
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">EchoClientHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> bootstrap.connect(HOST, PORT).sync();
            future.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}

<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, Netty!"</span>;
        ctx.writeAndFlush(message); <span class="hljs-comment">// 发送消息给服务器</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) msg;
        System.out.println(<span class="hljs-string">"Received message: "</span> + message);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        cause.printStackTrace();
        ctx.close(); <span class="hljs-comment">// 发生异常时关闭连接</span>
    }
}
</code></pre>
<p>在上面的示例中，我们创建了一个Echo客户端，它连接到服务器并发送消息。我们使用了与服务器类似的配置，创建了一个EventLoopGroup和一个Bootstrap。然后，我们配置了Bootstrap的通道类型(NioSocketChannel)，设置了日志处理器(LoggingHandler)和消息处理器(EchoClientHandler)。在channelActive方法中，我们发送了一条消息给服务器。在channelRead方法中，我们接收并打印从服务器返回的消息。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！]]></title>    <link>https://juejin.cn/post/7581741663182749731</link>    <guid>https://juejin.cn/post/7581741663182749731</guid>    <pubDate>2025-12-09T23:15:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581741663182749731" data-draft-id="7581406561684963374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！"/> <meta itemprop="keywords" content="人工智能,前端,Trae"/> <meta itemprop="datePublished" content="2025-12-09T23:15:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:15:05.000Z" title="Tue Dec 09 2025 23:15:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>一到年末，撰写年终总结总是绕不开一项费时又费力的任务——绘制图表。作为量化工作成果、直观呈现业务进展的重要方式，图表既要清晰传达信息，又需在视觉上吸引眼球。以往笔者常借助阿里 AntV 团队推出的 <code>mcp-server-chart</code>，通过对话式交互快速生成基础图表，虽然方便，但其样式较为简单，难以在汇报中脱颖而出（关于<code>mcp-server-chart</code>的使用大家可以参考笔者的文章<a href="https://juejin.cn/post/7504142780526723081" target="_blank" title="https://juejin.cn/post/7504142780526723081">推荐一款宝藏MCP Server—mcp-server-chart, 从此再也不发愁绘制图表啦！</a>）。</p>
<p>正为此发愁时笔者偶然发现了 AntV 新推出的信息图可视化引擎——<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2F" target="_blank" title="https://infographic.antv.vision/" ref="nofollow noopener noreferrer">AntV Infographic</a></strong>。它同样出自 AntV 团队，能够通过简洁的配置生成设计感十足、重点突出的信息图表，正好切中了笔者在图表展示上的痛点。</p>
<p>这么好的工具，自然不能独享，本篇分享笔者就把这个工具库分享给大家， 同时作为长期关注智能体开发的博主，笔者更进一步结合 <code>AntV Infographic</code> 与 <code>vibe coding</code> 快速搭建了一个轻量级图表生成智能体。本文将分享整个实现思路与过程，手把手带你用 <strong>AntV + Trae</strong>，在五分钟内构建属于自己的“智能图表生成器”，让大家今年的年终报告，用图表说话，靠颜值出彩！(希望大家可以到<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantvis%2Finfographic" target="_blank" title="https://github.com/antvis/infographic" ref="nofollow noopener noreferrer">github</a>上给Infographic 点 star 打 call，支持antv团队开发出更多实用美丽的可视化图表功能~)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31429ac9e1174724ab3322a4ac4e3141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=fYfCwSi4bmqISpMb%2FgnZYqqONpY%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、AntV Infographic简介</h2>
<h3 data-id="heading-2">1.1 什么是信息图（Infographic）？</h3>
<p>在深入了解 AntV Infographic 之前，首先需要明确一个核心概念：<strong>信息图（Infographic）</strong> 。</p>
<p>传统图表（如折线图、柱状图）的核心目标是精确、标准化地呈现数据。而信息图则更进一步，它融合了<strong>数据可视化</strong>与<strong>视觉设计</strong>，旨在将复杂的数据、信息和知识转化为直观的、富有美感的图形语言。它通过视觉元素来“压缩”信息，突出重点、叙述故事、传达洞察，最终目标是让受众“看得懂、记得住”。</p>
<p>笔者这里通过AntV官网的例子来让大家直观了解信息图，以下是一段关于阿里巴巴技术职级的文字描述：</p>
<pre><code class="hljs language-text" lang="text">在阿里巴巴，技术人的职级从 P5 到 P10，每一级都对应着不同的职责与能力要求。  
P5 是初入职场的执行者，主要负责完成具体任务，在指导下学习和成长；  
P6 是独立贡献者，能够自主解决问题并交付模块级的工作成果；P7 开始承担更复杂的系统设计与项目推进，成为团队中的技术骨干；  
P8 则需要具备架构能力，主导大型项目的实施，并在领域内形成影响力；  
P9 是技术专家或管理者，负责跨团队的战略规划与资源整合，推动业务创新；  
而 P10 作为行业领军人物，不仅要在公司内部引领技术方向，还要在行业内树立标杆，为组织带来深远的技术和商业价值。
</code></pre>
<p>如果将其转化为信息图，效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f96c7b8f10814a618c8793ffa33b8d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=D1GJ5E2uMxmKPxZ0Gefxwj%2BKmmk%3D" alt="1.png" loading="lazy"/></p>
<p>对比可见信息图通过层次化的视觉设计，极大地提升了信息的传达效率与视觉吸引力。</p>
<h3 data-id="heading-3">1.2 AntV Infographic 是什么？</h3>
<p><strong>AntV Infographic</strong> 正是为了解决“如何高效创建精美信息图”而生的新一代前端可视化引擎。它不是一个简单的图表库，将复杂数据转化为优雅、可交互信息图的完整解决方案。该框架的核心思想是：用户只需要通过简洁的声明式JSON配置方式描述数据与想要的视觉呈现，引擎便会自动将其渲染为高质量的信息图，无需你手动计算像素或绘制图形。</p>
<h3 data-id="heading-4">1.3 如何用 Infographic 构建信息图？</h3>
<p>InfoGraphic的使用非常简单，用户只需要按规定传入配置项，定义结构、设计、数据与主题，InfoGraphic即可自动根据用户的配置绘制出精美的信息图。可以说Infographic的整个过程围绕三个核心配置项展开：</p>
<ul>
<li>
<p><strong>设计 (<code>design</code>)</strong> ：定义信息图的视觉样式，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Fdesign" target="_blank" title="https://infographic.antv.vision/learn/design" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/desig…</a> 了解更多。</p>
<ul>
<li><code>structure</code>：布局与组织方式（如列表、网格）。</li>
<li><code>title</code>：标题的样式设计。</li>
<li><code>item</code>：每个数据单元的视觉样式（如卡片、箭头图）。</li>
</ul>
</li>
<li>
<p><strong>数据 (<code>data</code>)</strong> ：填入要展示的具体内容，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Fdata" target="_blank" title="https://infographic.antv.vision/learn/data" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/data</a> 了解更多。</p>
<ul>
<li>支持一维列表数据（如上图示例）和层级数据。</li>
<li>每个数据项可包含标签、描述、时间、图标等字段。</li>
</ul>
</li>
<li>
<p><strong>主题 (<code>theme</code>)</strong> ：控制全局视觉风格，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Ftheme" target="_blank" title="https://infographic.antv.vision/learn/theme" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/theme</a> 了解更多。</p>
<ul>
<li>配置主色、色板、背景等。</li>
<li>自定义文本、图形等元素的样式。</li>
<li>应用手绘风等风格化效果。</li>
</ul>
</li>
</ul>
<p>下面是一个完整的代码示例，它创建了一个包含三个步骤的“计划进展”图:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Infographic</span>,
  registerResourceLoader,
  loadSVGResource,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@antv/infographic'</span>;

<span class="hljs-title function_">registerResourceLoader</span>(<span class="hljs-keyword">async</span> (config) =&gt; {
  <span class="hljs-keyword">const</span> {data} = config;
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.iconify.design/<span class="hljs-subst">${data}</span>.svg`</span>);
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">text</span>();
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">loadSVGResource</span>(text);
});

<span class="hljs-keyword">const</span> infographic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#container'</span>,
  <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">editable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">padding</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">design</span>: {
    <span class="hljs-attr">title</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'default'</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,
    },
    <span class="hljs-attr">structure</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'list-row'</span>,
      <span class="hljs-attr">gap</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">zigzag</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">item</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'horizontal-icon-arrow'</span>,
    },
  },
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
  <span class="hljs-attr">themeConfig</span>: {
    <span class="hljs-attr">palette</span>: [<span class="hljs-string">'#61DDAA'</span>, <span class="hljs-string">'#F6BD16'</span>, <span class="hljs-string">'#F08BB4'</span>],
    <span class="hljs-attr">base</span>: {
      <span class="hljs-attr">text</span>: {
        <span class="hljs-string">'font-family'</span>: <span class="hljs-string">'851tegakizatsu'</span>,
      },
    },
    <span class="hljs-attr">stylize</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'rough'</span>,
    },
  },
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'计划进展'</span>,
    <span class="hljs-attr">items</span>: [
      {
        <span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 1'</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">'开始'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'Last Day'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/rocket-launch'</span>,
      },
      {
        <span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 2'</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">'进行中'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'Today'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/progress-clock'</span>,
      },
      {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 3'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'完成'</span>, <span class="hljs-attr">time</span>: <span class="hljs-string">'Tomorrow'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/trophy'</span>},
    ],
  },
});

infographic.<span class="hljs-title function_">render</span>();
</code></pre>
<p><strong>代码要点解析:</strong></p>
<ul>
<li><strong>资源加载器</strong>：通过 <code>registerResourceLoader</code> 从 Iconify 按需拉取 SVG。</li>
<li><strong>编辑器</strong>：设置 <code>editable: true</code> 启用交互式编辑功能。</li>
<li><strong>设计</strong>：<code>design</code> 字段自定义标题、结构与数据项类型及参数。</li>
<li><strong>主题</strong>：切换暗色主题并用 <code>themeConfig</code> 配置色板、字体、风格化。</li>
<li><strong>数据</strong>：传入标题与数据项（标签、描述、时间、图标）。</li>
</ul>
<p>最终绘制的图片效果如下：</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cd1bd3f21ab4c52b79592ec625d0de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=xHoH%2FrCbJaMrV1JZPvQaPEu29jQ%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-5">1.4 Infographic模板基本介绍</h3>
<p>对于常见的图表类型，每次都从头配置 <code>design</code> 显然效率不高。为此，Infographic 提供了<strong>模板（Template）</strong> 功能。用户可以将一套成熟的 <code>design</code> 配置保存为模板，以便复用。</p>
<ol>
<li>
<p><strong>注册与使用自定义模板:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {registerTemplate, <span class="hljs-title class_">Infographic</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@antv/infographic'</span>;

<span class="hljs-title function_">registerTemplate</span>(<span class="hljs-string">'simple-list'</span>, {
  <span class="hljs-attr">design</span>: {
    <span class="hljs-attr">structure</span>: <span class="hljs-string">'list-row'</span>,
    <span class="hljs-attr">item</span>: <span class="hljs-string">'simple'</span>,
  },
});

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
  <span class="hljs-comment">// 其他配置项...</span>
  <span class="hljs-attr">template</span>: <span class="hljs-string">'simple-list'</span>,
});
</code></pre>
</li>
<li>
<p><strong>使用官方模板:</strong></p>
</li>
</ol>
<p>除了自定义模板的方法外，鉴于现实生活中有许多设计好的信息展示图表组件，大家直接在上面替换数据呈现的效果往往比自定义的图表组件展示效果还要好。基于此AntV 团队已经为我们准备了上百种精心设计的模板，覆盖了时间轴、组织架构、产品路线图等多种场景。你可以在 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fexamples" target="_blank" title="https://infographic.antv.vision/examples" ref="nofollow noopener noreferrer">官方示例库</a></strong> 中浏览并找到心仪的样式，直接复制其模板名称并将数据修改为自己的数据即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7331d4b1fb3437ea537ac1fdc67758c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=pZQ%2BQtPx8Nkb958JLSUufDInK1o%3D" alt="3.png" loading="lazy"/></p>
<p>例如，以下代码使用官方 <code>list-row-simple-horizontal-arrow</code> 模板，在纯HTML环境中快速生成了一个步骤流程图：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Infographic Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/@antv/infographic@latest/dist/infographic.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> {<span class="hljs-title class_">Infographic</span>} = <span class="hljs-title class_">AntVInfographic</span>;
      <span class="hljs-keyword">const</span> infographic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
        <span class="hljs-attr">container</span>: <span class="hljs-string">'#container'</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'list-row-simple-horizontal-arrow'</span>,
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">items</span>: [
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 1'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'开始'</span>},
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 2'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'进行中'</span>},
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 3'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'完成'</span>},
          ],
        },
      });
      infographic.<span class="hljs-title function_">render</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6ac9e0af746441d83865bdf8afc599b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=rww0w%2F8xU6nn4k0oVn0YQGWtwRI%3D" alt="4.png" loading="lazy"/></p>
<p>至此，大家已经掌握了 AntV Infographic 的核心用法。如果你想深入了解其所有功能，建议查阅 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn" target="_blank" title="https://infographic.antv.vision/learn" ref="nofollow noopener noreferrer">官方教程</a></strong>。接下来，笔者将进入实战环节，看看如何将它与智能体（Agent）技术结合，打造一个真正“能说会画”的图表生成器。</p>
<h2 data-id="heading-6">二、基于AntV Infographic的图表生成智能体</h2>
<p>笔者在文章 <a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">LangChain1.0实战之多模态RAG系统（四）——Trae Solo搭建部署多模态RAG前端(附AI编程实践指南)</a>介绍了 <strong>Vibe Coding（氛围编程）</strong>  的理念，并展示了如何利用字节跳动的 <strong>Trae Solo</strong> 模式，仅凭自然语言描述就能快速开发出功能完整的前端应用。</p>
<p>这次笔者同样要借助 Vibe Coding 的力量，并遵循其<a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">最佳实践</a>，快速构建一个能够理解需求、自动生成精美信息图的智能体。</p>
<h3 data-id="heading-7">2.1 核心思路：让大模型“学会”图表配置</h3>
<p>要构建这个智能体，首先要理清它的运作逻辑。<code>AntV Infographic</code> 生成图表高度依赖配置项（<code>data</code>, <code>design</code>, <code>theme</code>），而官方又提供了丰富的模板库。那么一个很自然的想法是：<strong>能否让大模型充当“配置工程师”？</strong>  让大模型从用户输入的自然语言描述中，智能地抽取出关键数据、判断合适的图表类型（选择模板），并生成完整的 <code>Infographic</code> 配置代码。这个想法与 AntV 官方的 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 网站不谋而合。</p>
<p>为了让大模型掌握这项技能笔者需要给它一份“说明书”。最直接的方式就是借鉴官方 AI 功能的提示词（Prompt）。通过浏览器的开发者工具（Network 面板）笔者捕获到 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 网站与大模型交互时使用的提示词模板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8914f3ef01754d01a3e2adafe1fcd722~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=RBIvmVZIU%2FbRda9uUxgvj7xd7Ws%3D" alt="5.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28720350e3284ebfa8f1da006c5f4723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=UTyYsDJO%2FBKGh%2BU1TmedTIyZGaM%3D" alt="6.png" loading="lazy"/></p>
<p>获取到的提示词笔者将其保存在<code>提示词.txt</code>文件中。限于篇幅原因，提示词就不在这里展示啦，感兴趣的小伙伴大家可以关注笔者同名微信公众号：<strong>大模型真好玩</strong>， 并私信 <strong>Infographic智能体</strong> 获得全部源码。</p>
<h3 data-id="heading-8">2.2 编写结构化代码开发提示词</h3>
<p>有了核心思路和提示词基础，接下来就轮到 <strong>Vibe Coding</strong> 上场了。遵循最佳实践的第一步，笔者需要为 <strong>Trae Solo</strong> 撰写一份结构清晰、要素完整的提示词。</p>
<ol>
<li><strong>角色定位：</strong> 明确赋予 Trae Solo 一个专业身份和能力范围</li>
</ol>
<pre><code class="hljs language-text" lang="text">你是一个智能体应用开发人员，熟练掌握使用langchain1.0 python语言开发一个智能体
</code></pre>
<ol start="2">
<li><strong>清晰需求：</strong> 详细描述业务场景与功能点</li>
</ol>
<pre><code class="hljs language-text" lang="text">该智能体可以通过根据用户输入的数据，采用提示词.txt文件中的提示词，生成一个.html文件。
该智能体使用deepseek接口作为大模型服务，api key在.env文件配置中，该智能体会根据用户输入搭配我提示词.txt中的内容，生成相关配置。同时参考example.html中的代码，将其中的infographic配置项替换成你生成的配置项
</code></pre>
<ol start="3">
<li><strong>明确的任务:</strong> 将需求转化为具体的开发指令</li>
</ol>
<pre><code class="hljs language-text" lang="text">请使用Python代码和Langchain1.0版本生成我的需求
</code></pre>
<ol start="4">
<li><strong>代码约束规范:</strong> 因为这里的代码比较简单，属于玩具代码也不是完整项目，这里就不写啦，但大家要系统开发项目还是应该加上。</li>
</ol>
<h3 data-id="heading-9">2.3 DeepSeek提示优化</h3>
<p>原始提示词已经具备了所有要素，但其表述偏向口语化，逻辑连贯性有待加强。现在笔者执行第二步：使用另一个大模型（这里选用 DeepSeek）对提示词进行优化，使其更符合大模型的“阅读习惯”。</p>
<p><strong>原始提示词:</strong></p>
<pre><code class="hljs language-text" lang="text">你是一个智能体应用开发人员，熟练掌握使用langchain1.0 python语言开发一个智能体。该智能体可以通过根据用户输入的数据，采用提示词.txt文件中的提示词，生成一个.html文件。
该智能体使用deepseek接口作为大模型服务，api key在.env文件配置中，该智能体会根据用户输入搭配我提示词.txt中的内容，生成相关配置。同时参考example.html中的代码，将其中的infographic配置项替换成你生成的配置项。
请使用Python代码和Langchain1.0版本生成我的需求
</code></pre>
<p><strong>DeepSeek优化后的结果:</strong></p>
<pre><code class="hljs language-text" lang="text">项目概述：
开发一个基于LangChain的智能体应用，它能够：1. 读取用户输入的文本数据 2. 结合提示词.txt文件中的提示词模板 3. 调用DeepSeek API生成配置项 4. 读取example.html中的代码，使用新生成的配置项替换掉example.html中infographic的配置项，并写入新的名为example-result.html的文件中。
功能详细需求：
输入处理：智能体接收用户输入的文本数据作为内容素材
读取提示词.txt文件作为系统提示词
配置管理：
API密钥从.env文件中读取，变量名建议为DEEPSEEK_API_KEY
支持配置DeepSeek模型参数（如temperature, max_tokens等）
核心功能：
1. 将用户输入与提示词模板智能结合
2. 调用DeepSeek API生成正确的配置
3. 确保替换后的HTML文件可直接在浏览器中打开并正确显示
文件操作：
读取：提示词.txt（提示词模板）
写入：example-result.html（最终生成的HTML文件）
配置：.env（API密钥配置）
所有文件均为utf-8编码格式
智能体设计：
1. 使用LangChain的Agent框架
2. 包含错误处理机制（API调用失败、文件读取错误等）
提供清晰的执行状态反馈
</code></pre>
<p>优化后的提示词层级分明、指令明确，消除了冗余和歧义。此时将其提交给 <strong>Trae Solo</strong>，能够确保指令被最高效、最准确地执行。</p>
<h3 data-id="heading-10">2.4 Trae Solo 自动开发</h3>
<p>将优化后的提示词提交给 <strong>Trae Solo</strong>，它便开始自动进行代码开发。整个过程流畅，<strong>Trae Solo</strong> 依次完成了环境设置、文件读取、API 调用、模板替换等核心模块的编写。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b085f6f37e28408987f5f4581ad62dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=iZvbp7SIV17YYIGfc%2BK6vDwVC0g%3D" alt="8.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feffbf2b7edc4f1c85439b487ac8e6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=PzDLce5D5ciNRcjAODVWN7Kkwfs%3D" alt="9.png" loading="lazy"/></p>
<p>笔者审查一下生成的 <code>infographic_agent.py</code> 核心代码逻辑。虽然 Trae Solo 本次<strong>并未严格使用 LangChain 框架</strong>（这反映了当前 AI 编程工具在精准遵循框架指令上仍有提升空间），但它生成的代码逻辑清晰、功能完整：</p>
<ol>
<li><strong>加载环境</strong>：读取 <code>.env</code> 中的 API Key。</li>
<li><strong>读取知识</strong>：加载 <code>提示词.txt</code> 中的模板。</li>
<li><strong>获取输入</strong>：接收用户描述文本。</li>
<li><strong>调用大模型</strong>：拼接提示词和用户输入，请求 DeepSeek API 生成配置。</li>
<li><strong>替换模板</strong>：读取 <code>example.html</code>，将其中预设的配置替换为新生成的配置。</li>
<li><strong>输出结果</strong>：保存为新的 <code>example-result.html</code> 文件。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ... (代码导入和环境加载部分)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># 1. 加载环境变量</span>
    load_dotenv()
    api_key = os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>)
    <span class="hljs-comment"># ... (校验API Key)</span>

    <span class="hljs-comment"># 2. 读取提示词模板</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"提示词.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        prompt_template = f.read()
    
    <span class="hljs-comment"># 3. 获取用户输入</span>
    user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入文本数据作为内容素材: "</span>)
    
    <span class="hljs-comment"># 4. 调用DeepSeek API生成配置</span>
    headers = {<span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{api_key}</span>"</span>, <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>}
    payload = {
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-chat"</span>,
        <span class="hljs-string">"messages"</span>: [
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: prompt_template},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_input}
        ],
        <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>,
        <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">2048</span>,
        <span class="hljs-string">"response_format"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"json_object"</span>} <span class="hljs-comment"># 关键：要求返回JSON</span>
    }
    response = requests.post(<span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>, ...)
    config = response.json() <span class="hljs-comment"># 解析大模型返回的配置</span>
    
    <span class="hljs-comment"># 5. 读取并替换HTML模板</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"example.html"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        html_content = f.read()
    <span class="hljs-comment"># ... (使用生成的config替换html中的Infographic配置项)</span>
    
    <span class="hljs-comment"># 6. 写入新文件</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"example-result.html"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        f.write(updated_html)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ 操作完成！"</span>)
<span class="hljs-comment"># ... (主函数调用)</span>
</code></pre>
<h3 data-id="heading-11">2.5 测试与效果展示</h3>
<p><strong>测试流程</strong>：</p>
<p>运行 <code>python infographic_agent.py</code>，并输入一段业务描述：</p>
<pre><code class="hljs language-text" lang="text">2020年聚焦亚太市场，营收占比60%。
2021年拓展欧洲市场，占比提升至25%。
2022年进军北美，三大市场形成均衡格局，分别为40%、30%、25%。2023年新兴市场突破，拉美和中东合计贡献15%，全球化布局初步完成。
</code></pre>
<p>程序运行后，成功生成了 <code>example-result.html</code>。在浏览器中打开得到了一个可视化全球市场拓展历程的信息图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c615501220549c2ad4762a4edad43dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=KxWNKXyFCjFYDl%2BVDVN3b4YKOXE%3D" alt="10.png" loading="lazy"/></p>
<p><strong>效果分析</strong>：</p>
<p>智能体成功理解了时间序列数据，并选择了一个合适的时间线模板进行展示。它将各年份的市场分布数据提取并结构化，生成了一份基本可用的信息图。当然，与官方 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 的产出相比，在细节优化、图表精准度和视觉丰富度上还有差距，这可能与提示词的完整性、模型参数调优等因素有关，值得进一步探索和优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39afa3cd4df049acab502a09ada38bbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=URwSgbbf5jYD1kw8b76yR7TiZOI%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-12">三、总结</h2>
<p>本文分享了利用AntV Infographic可视化引擎，通过声明式配置快速生成精美信息图。同时结合Trae Solo与Vibe Coding方法，构建智能体实现自然语言描述自动转换为图表代码。五分钟即可搭建智能图表生成器。想让智能体真正融入日常生活，不必从一开始就追求宏大构想。<strong>从解决一个具体问题的小工具起步</strong>，往往就是最好的开始。当简洁灵巧的小工具遇上大模型的能力，常常能碰撞出令人惊喜的火花！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画]]></title>    <link>https://juejin.cn/post/7581689310643814442</link>    <guid>https://juejin.cn/post/7581689310643814442</guid>    <pubDate>2025-12-09T23:20:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310643814442" data-draft-id="7581676787380338707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-12-09T23:20:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:20:56.000Z" title="Tue Dec 09 2025 23:20:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代单页应用（SPA）开发中，页面切换的流畅体验已成为衡量应用品质的重要标准。用户期望获得媲美原生应用的顺滑感受，而不仅仅是简单的页面跳转。Vue Router 作为 Vue.js 生态中的核心路由解决方案，提供了强大的滚动行为控制和路由过渡动画能力，让我们能够打造出令人印象深刻的用户体验。</p>
<h2 data-id="heading-0">一、掌握滚动行为：让页面“记住”它的位置</h2>
<h3 data-id="heading-1">1.1 什么是滚动行为？</h3>
<p>滚动行为指的是用户在路由切换时，页面滚动位置的智能管理。想象一下这样的场景：您在一个长列表页面滚动到中间位置，点击某个项目进入详情页，然后点击浏览器返回按钮——您是否希望直接回到刚才的列表位置？这正是滚动行为要解决的问题。</p>
<h3 data-id="heading-2">1.2 Vue Router 的滚动行为配置</h3>
<p>Vue Router 提供了 <code>scrollBehavior</code> 选项，让我们可以定义路由切换时的滚动行为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  <span class="hljs-attr">routes</span>: [...],
  <span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
    <span class="hljs-comment">// 返回滚动位置信息</span>
    <span class="hljs-keyword">if</span> (savedPosition) {
      <span class="hljs-comment">// 有保存的位置时（如浏览器前进/后退）</span>
      <span class="hljs-keyword">return</span> savedPosition
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (to.<span class="hljs-property">hash</span>) {
      <span class="hljs-comment">// 存在哈希锚点时</span>
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">el</span>: to.<span class="hljs-property">hash</span>,
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> <span class="hljs-comment">// 平滑滚动</span>
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 默认滚动到顶部</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> }
    }
  }
})
</code></pre>
<h3 data-id="heading-3">1.3 高级滚动控制技巧</h3>
<p><strong>延迟滚动与异步组件结合</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 等待页面渲染完成后再滚动</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (savedPosition) {
        <span class="hljs-title function_">resolve</span>(savedPosition)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (to.<span class="hljs-property">hash</span>) {
        <span class="hljs-title function_">resolve</span>({
          <span class="hljs-attr">el</span>: to.<span class="hljs-property">hash</span>,
          <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
          <span class="hljs-comment">// 添加偏移量，避免被固定导航栏遮挡</span>
          <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>
        })
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> })
      }
    }, <span class="hljs-number">300</span>) <span class="hljs-comment">// 等待300ms，确保动态内容已加载</span>
  })
}
</code></pre>
<p><strong>页面特定滚动策略</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 为特定路由禁用自动滚动</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">noScroll</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
  
  <span class="hljs-comment">// 在特定路由中保持滚动位置</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">keepScroll</span> &amp;&amp; to.<span class="hljs-property">meta</span>.<span class="hljs-property">keepScroll</span>) {
    <span class="hljs-keyword">return</span> {}
  }
  
  <span class="hljs-comment">// 默认行为</span>
  <span class="hljs-keyword">return</span> savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }
}
</code></pre>
<h2 data-id="heading-4">二、打造惊艳的路由切换动画</h2>
<h3 data-id="heading-5">2.1 Vue 过渡系统与路由的完美结合</h3>
<p>Vue 的 <code>&lt;Transition&gt;</code> 和 <code>&lt;TransitionGroup&gt;</code> 组件为路由动画提供了强大的基础。结合 Vue Router，我们可以创建各种炫酷的过渡效果。</p>
<p><strong>基础路由过渡实现</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component }"&gt;
    &lt;Transition name="fade" mode="out-in"&gt;
      &lt;component :is="Component" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;style&gt;
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-6">2.2 进阶动画：滑动过渡效果</h3>
<p><strong>水平滑动动画</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component, route }"&gt;
    &lt;Transition :name="transitionName"&gt;
      &lt;component :is="Component" :key="route.path" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, watch } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()
const transitionName = ref('slide-left')

watch(() =&gt; router.currentRoute.value, (to, from) =&gt; {
  // 根据路由深度判断滑动方向
  const toDepth = to.path.split('/').length
  const fromDepth = from.path.split('/').length
  transitionName.value = toDepth &lt; fromDepth ? 'slide-right' : 'slide-left'
})
&lt;/script&gt;

&lt;style&gt;
.slide-left-enter-active,
.slide-left-leave-active,
.slide-right-enter-active,
.slide-right-leave-active {
  transition: all 0.3s ease;
  position: absolute;
  width: 100%;
}

.slide-left-enter-from {
  transform: translateX(100%);
  opacity: 0;
}

.slide-left-leave-to {
  transform: translateX(-100%);
  opacity: 0;
}

.slide-right-enter-from {
  transform: translateX(-100%);
  opacity: 0;
}

.slide-right-leave-to {
  transform: translateX(100%);
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-7">2.3 基于路由元信息的动态动画</h3>
<p><strong>为不同路由配置不同动画</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 路由配置</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Dashboard</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">transition</span>: <span class="hljs-string">'zoom'</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/settings'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Settings</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">transition</span>: <span class="hljs-string">'fade'</span> }
  }
]
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component, route }"&gt;
    &lt;Transition 
      :name="route.meta.transition || 'fade'"
      mode="out-in"
    &gt;
      &lt;component :is="Component" :key="route.path" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;style&gt;
.zoom-enter-active,
.zoom-leave-active {
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

.zoom-enter-from {
  transform: scale(0.8);
  opacity: 0;
}

.zoom-leave-to {
  transform: scale(1.2);
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-8">三、滚动行为与动画的协同优化</h2>
<h3 data-id="heading-9">3.1 动画期间的滚动管理</h3>
<p>在路由过渡动画期间，合理的滚动控制可以避免视觉混乱：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 如果启用了路由动画，延迟滚动</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">withAnimation</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-comment">// 等待动画完成</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> })
      }, <span class="hljs-number">500</span>) <span class="hljs-comment">// 与动画时长保持一致</span>
    })
  }
  <span class="hljs-keyword">return</span> savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }
}
</code></pre>
<h3 data-id="heading-10">3.2 性能优化建议</h3>
<ol>
<li><strong>硬件加速</strong>：为动画元素添加 <code>transform: translateZ(0)</code> 或 <code>will-change: transform</code> 启用GPU加速</li>
<li><strong>动画简化</strong>：避免同时为过多属性添加动画，优先使用 <code>transform</code> 和 <code>opacity</code></li>
<li><strong>节流处理</strong>：在快速连续导航时，取消未完成的动画</li>
</ol>
<h2 data-id="heading-11">四、实战：完整的用户体验优化方案</h2>
<p>下面是一个综合应用滚动行为和路由动画的完整示例：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app-container"&gt;
    &lt;AppHeader /&gt;
    &lt;main class="main-content"&gt;
      &lt;RouterView v-slot="{ Component, route }"&gt;
        &lt;Transition
          :name="getTransitionName(route, $route)"
          @before-enter="onBeforeEnter"
          @after-enter="onAfterEnter"
          mode="out-in"
        &gt;
          &lt;KeepAlive :include="cachedRoutes"&gt;
            &lt;component
              :is="Component"
              :key="route.fullPath"
              class="page-content"
            /&gt;
          &lt;/KeepAlive&gt;
        &lt;/Transition&gt;
      &lt;/RouterView&gt;
    &lt;/main&gt;
    &lt;AppFooter /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()
const previousRoute = ref(null)

// 动态计算过渡名称
const getTransitionName = (to, from) =&gt; {
  if (!from.name) return 'fade'
  
  const toDepth = to.meta.depth || 0
  const fromDepth = from.meta.depth || 0
  
  if (toDepth &lt; fromDepth) return 'slide-right'
  if (toDepth &gt; fromDepth) return 'slide-left'
  
  return to.meta.transition || 'fade'
}

// 动画生命周期钩子
const onBeforeEnter = () =&gt; {
  // 动画开始前的准备工作
  document.body.style.overflow = 'hidden'
}

const onAfterEnter = () =&gt; {
  // 动画结束后的清理工作
  document.body.style.overflow = ''
}

// 需要缓存的组件
const cachedRoutes = computed(() =&gt; {
  return router.getRoutes()
    .filter(route =&gt; route.meta.keepAlive)
    .map(route =&gt; route.name)
    .filter(Boolean)
})
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-12">结语：打造极致的用户体验</h2>
<p>通过精心设计的滚动行为和流畅的路由过渡动画，我们可以将普通的单页应用提升到新的高度。Vue Router 提供的这些功能不仅仅是技术实现，更是连接用户与内容的桥梁。记住，最好的用户体验往往是用户感受不到的——自然的滚动恢复、流畅的页面过渡，这些细节共同构成了应用的品质感。</p>
<p>从简单的淡入淡出到复杂的多层动画，从基本的滚动定位到智能的位置记忆，每一处优化都是对用户体验的深思熟虑。正如我们开始时提到的，现代用户期待的是丝滑流畅的交互体验。通过掌握 Vue Router 的滚动行为控制与自定义路由动画技术，我们不仅满足了这一期待，更创造了超越用户预期的愉悦体验。</p>
<p>在下一个 Vue 项目中，不妨尝试实现这些技巧，让您的应用在众多竞争者中脱颖而出，用细节打动每一位用户。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择]]></title>    <link>https://juejin.cn/post/7581691182003896330</link>    <guid>https://juejin.cn/post/7581691182003896330</guid>    <pubDate>2025-12-09T23:37:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581691182003896330" data-draft-id="7581888578507046939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-09T23:37:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:37:02.000Z" title="Tue Dec 09 2025 23:37:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>内联数组是 <code>C# 12</code> 和 <code>.NET 8</code> 中引入的一个高级特性，它允许开发者创建固定大小的、在栈上分配或内联在结构体中的数组。这个特性主要用于高性能场景，可以避免堆分配和垃圾回收的开销。</p>
<h4 data-id="heading-1">性能优势</h4>
<p>内联数组的主要优势在于性能：</p>
<ul>
<li>
<p>栈上分配：避免堆分配和垃圾回收</p>
</li>
<li>
<p>内存局部性：元素在内存中连续存储，提高缓存命中率</p>
</li>
<li>
<p>减少指针间接寻址：直接访问元素，不需要通过数组对象引用</p>
</li>
</ul>
<h4 data-id="heading-2">内联数组 vs 传统数组</h4>








































<table><thead><tr><th>特性</th><th>内联数组</th><th>传统数组</th></tr></thead><tbody><tr><td>内存位置</td><td>栈/包含结构体内存</td><td>托管堆</td></tr><tr><td>分配开销</td><td>无额外分配</td><td>需要堆分配</td></tr><tr><td>最大长度</td><td>受栈空间限制（通常≤1MB）</td><td>受GC限制（通常≤2GB）</td></tr><tr><td>适用场景</td><td>高性能计算/嵌入式开发</td><td>通用场景</td></tr><tr><td>灵活性</td><td>固定长度</td><td>动态长度</td></tr><tr><td>C#版本要求</td><td>≥ C# 12 (.NET 8+)</td><td>所有版本</td></tr></tbody></table>
<h3 data-id="heading-3">基本语法</h3>
<p>内联数组使用 <code>InlineArray</code> 特性和特定的模式来定义：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Runtime.CompilerServices;

[<span class="hljs-meta">InlineArray(Size)</span>]
<span class="hljs-keyword">struct</span> InlineArrayStruct
{
    <span class="hljs-keyword">private</span> T _element; <span class="hljs-comment">// 单一字段，表示数组的起点</span>
}
</code></pre>
<ul>
<li>
<p><code>Size</code>：一个编译时常量，表示数组的固定长度。</p>
</li>
<li>
<p><code>T</code>：数组元素的类型（可以是值类型或引用类型）。</p>
</li>
<li>
<p>单一字段：结构体中只能有一个字段，表示数组的起点，编译器会将其扩展为固定大小的连续内存。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">System.Runtime.CompilerServices.InlineArray(10)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> MyInlineArray
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0; <span class="hljs-comment">// 只需要定义一个字段，实际大小由特性指定</span>
}
</code></pre>
<h3 data-id="heading-4">创建和使用内联数组</h3>
<h4 data-id="heading-5">基本定义和使用</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;

<span class="hljs-comment">// 定义包含10个整数的内联数组</span>
[<span class="hljs-meta">InlineArray(10)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> IntArray10
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0;
    
    <span class="hljs-comment">// 可以添加方法或属性来增强功能</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">10</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">Sum</span>()</span>
    {
        <span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Length; i++)
        {
            sum += <span class="hljs-keyword">this</span>[i];
        }
        <span class="hljs-keyword">return</span> sum;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        IntArray10 array = <span class="hljs-keyword">new</span> IntArray10();
        
        <span class="hljs-comment">// 初始化数组</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; array.Length; i++)
        {
            array[i] = i * <span class="hljs-number">2</span>;
        }
        
        <span class="hljs-comment">// 访问元素</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; array.Length; i++)
        {
            Console.WriteLine(<span class="hljs-string">$"array[<span class="hljs-subst">{i}</span>] = <span class="hljs-subst">{array[i]}</span>"</span>);
        }
        
        Console.WriteLine(<span class="hljs-string">$"总和: <span class="hljs-subst">{array.Sum()}</span>"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">与 <code>Span&lt;T&gt;</code> 结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">struct</span> FloatBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element;
}

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> FloatBuffer();
buffer[<span class="hljs-number">0</span>] = <span class="hljs-number">1.5f</span>;
buffer[<span class="hljs-number">1</span>] = <span class="hljs-number">2.5f</span>;

Span&lt;<span class="hljs-built_in">float</span>&gt; span = buffer;
Console.WriteLine(span[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 输出: 1.5</span>
Console.WriteLine(span.Length); <span class="hljs-comment">// 输出: 5</span>
</code></pre>
<h4 data-id="heading-7">泛型内联数组</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> GenericArray&lt;T&gt;
{
    <span class="hljs-keyword">private</span> T _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">5</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">T initialValue</span>)</span>
    {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Length; i++)
        {
            <span class="hljs-keyword">this</span>[i] = initialValue;
        }
    }
}

<span class="hljs-comment">// 使用示例</span>
GenericArray&lt;<span class="hljs-built_in">string</span>&gt; stringArray = <span class="hljs-keyword">new</span> GenericArray&lt;<span class="hljs-built_in">string</span>&gt;();
stringArray.Initialize(<span class="hljs-string">"default"</span>);
</code></pre>
<h4 data-id="heading-8">在性能敏感场景中使用</h4>
<p>内联数组适合需要极致性能的场景，例如处理向量或缓冲区。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(3)</span>]
<span class="hljs-keyword">struct</span> Vector3D
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element;
}

<span class="hljs-function">Vector3D <span class="hljs-title">AddVectors</span>(<span class="hljs-params">Vector3D a, Vector3D b</span>)</span>
{
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> Vector3D();
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)
    {
        result[i] = a[i] + b[i];
    }
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">var</span> v1 = <span class="hljs-keyword">new</span> Vector3D { [<span class="hljs-number">0</span>] = <span class="hljs-number">1.0f</span>, [<span class="hljs-number">1</span>] = <span class="hljs-number">2.0f</span>, [<span class="hljs-number">2</span>] = <span class="hljs-number">3.0f</span> };
<span class="hljs-keyword">var</span> v2 = <span class="hljs-keyword">new</span> Vector3D { [<span class="hljs-number">0</span>] = <span class="hljs-number">4.0f</span>, [<span class="hljs-number">1</span>] = <span class="hljs-number">5.0f</span>, [<span class="hljs-number">2</span>] = <span class="hljs-number">6.0f</span> };
<span class="hljs-keyword">var</span> sum = AddVectors(v1, v2);

Console.WriteLine(<span class="hljs-string">$"(<span class="hljs-subst">{sum[<span class="hljs-number">0</span>]}</span>, <span class="hljs-subst">{sum[<span class="hljs-number">1</span>]}</span>, <span class="hljs-subst">{sum[<span class="hljs-number">2</span>]}</span>"</span>); <span class="hljs-comment">// 输出: (5, 7, 9)</span>
</code></pre>
<ul>
<li>
<p><code>Vector3D</code> 模拟一个三维向量，内联数组确保内存连续。</p>
</li>
<li>
<p>适合游戏开发或科学计算。</p>
</li>
</ul>
<h4 data-id="heading-9">与本机代码交互</h4>
<p>内联数组的连续内存布局使其非常适合与本机代码（如 <code>C/C++</code> ）交互。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Runtime.InteropServices;

[<span class="hljs-meta">InlineArray(8)</span>]
<span class="hljs-keyword">struct</span> CharBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">char</span> _element;
}

[<span class="hljs-meta">DllImport(<span class="hljs-string">"someNativeLib.dll"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ProcessBuffer</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> CharBuffer buffer</span>)</span>;

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> CharBuffer();
buffer[<span class="hljs-number">0</span>] = <span class="hljs-string">'H'</span>;
buffer[<span class="hljs-number">1</span>] = <span class="hljs-string">'e'</span>;
buffer[<span class="hljs-number">2</span>] = <span class="hljs-string">'l'</span>;
buffer[<span class="hljs-number">3</span>] = <span class="hljs-string">'l'</span>;
buffer[<span class="hljs-number">4</span>] = <span class="hljs-string">'o'</span>;
ProcessBuffer(<span class="hljs-keyword">ref</span> buffer);
</code></pre>
<ul>
<li>
<p><code>CharBuffer</code> 的内存布局与 <code>C</code> 语言中的 <code>char[8]</code> 兼容。</p>
</li>
<li>
<p>通过 <code>ref</code> 传递，确保本机代码可以直接操作内存。</p>
</li>
</ul>
<h3 data-id="heading-10">高级用法</h3>
<h4 data-id="heading-11">与不安全代码结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(8)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">struct</span> DoubleArray
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">fixed</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">8</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span>* GetPointer()
    {
        <span class="hljs-keyword">fixed</span> (<span class="hljs-built_in">double</span>* ptr = &amp;<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>])
        {
            <span class="hljs-keyword">return</span> ptr;
        }
    }
}
</code></pre>
<h4 data-id="heading-12">模拟多维数组</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用一维内联数组模拟二维数组</span>
[<span class="hljs-meta">InlineArray(16)</span>] <span class="hljs-comment">// 4x4 矩阵</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Matrix4x4
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Rows =&gt; <span class="hljs-number">4</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Columns =&gt; <span class="hljs-number">4</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> row, <span class="hljs-built_in">int</span> col]
    {
        <span class="hljs-keyword">get</span> =&gt; <span class="hljs-keyword">this</span>[row * Columns + col];
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>[row * Columns + col] = <span class="hljs-keyword">value</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Matrix4x4 <span class="hljs-title">Identity</span>()</span>
    {
        <span class="hljs-keyword">var</span> matrix = <span class="hljs-keyword">new</span> Matrix4x4();
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)
        {
            matrix[i, i] = <span class="hljs-number">1.0f</span>;
        }
        <span class="hljs-keyword">return</span> matrix;
    }
}
</code></pre>
<h4 data-id="heading-13">与 Span 和 Memory 互操作</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(100)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer100
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">100</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Span&lt;<span class="hljs-built_in">byte</span>&gt; <span class="hljs-title">AsSpan</span>()</span>
    {
        <span class="hljs-keyword">return</span> MemoryMarshal.CreateSpan(<span class="hljs-keyword">ref</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], Length);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> ReadOnlySpan&lt;<span class="hljs-built_in">byte</span>&gt; <span class="hljs-title">AsReadOnlySpan</span>()</span>
    {
        <span class="hljs-keyword">return</span> MemoryMarshal.CreateReadOnlySpan(<span class="hljs-keyword">ref</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], Length);
    }
}
</code></pre>
<h3 data-id="heading-14">底层原理</h3>
<h4 data-id="heading-15">编译后代码结构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 原始代码</span>
[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer5 { <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element; }

<span class="hljs-comment">// 近似编译结果</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer5
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element1;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element2;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element3;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element4;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">ref</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> index]
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">uint</span>)index &gt;= <span class="hljs-number">5</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfRangeException();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">ref</span> Unsafe.Add(<span class="hljs-keyword">ref</span> _element0, index);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">适用场景</h3>
<ul>
<li>
<p>高性能计算：游戏引擎、图形处理或科学计算中需要连续内存的场景。</p>
</li>
<li>
<p>缓冲区管理：处理固定大小的缓冲区，如网络数据包或文件读写。</p>
</li>
<li>
<p>与本机代码交互：与 <code>C/C++</code> 或其他本机库交互，传递连续内存块。</p>
</li>
<li>
<p>替代小型数组：在结构体中替代 <code>T[]</code> 字段，减少堆分配。</p>
</li>
<li>
<p>向量/矩阵操作：表示数学向量或矩阵，优化内存访问。</p>
</li>
</ul>
<h3 data-id="heading-17">注意事项</h3>
<h4 data-id="heading-18">仅限结构体：</h4>
<ul>
<li>
<p>只能定义在 <code>struct</code> 中，不能用于 <code>class</code>。</p>
</li>
<li>
<p>这是因为结构体是值类型，内存分配更可控。</p>
</li>
</ul>
<h4 data-id="heading-19">固定大小：</h4>
<ul>
<li>
<p>内联数组的大小在编译时必须是常量，无法动态调整。</p>
</li>
<li>
<p>不适合需要变长数组的场景。</p>
</li>
</ul>
<h4 data-id="heading-20">单一字段限制：</h4>
<ul>
<li>
<p>带有 <code>[InlineArray]</code> 的结构体只能包含一个字段。</p>
</li>
<li>
<p>如果需要其他字段，必须使用嵌套结构体。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(10)</span>]
<span class="hljs-keyword">struct</span> InvalidBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _otherField; <span class="hljs-comment">// 错误：只能有一个字段</span>
}
</code></pre>
<h4 data-id="heading-21">性能优势：</h4>
<ul>
<li>
<p>内联数组分配在栈上（对于局部变量）或嵌入结构体中，减少堆分配。</p>
</li>
<li>
<p>连续内存布局减少缓存未命中（<code>cache miss</code>），提高性能。</p>
</li>
</ul>
<h4 data-id="heading-22">版本要求：</h4>
<ul>
<li>
<p>内联数组是 <code>C# 12（.NET 8）</code>的新特性，需确保项目目标框架为 <code>.NET 8.0</code> 或更高。</p>
</li>
<li>
<p>需要 <code>System.Runtime.CompilerServices.InlineArray</code> 特性。</p>
</li>
</ul>
<h4 data-id="heading-23">索引越界：</h4>
<ul>
<li>
<p>内联数组支持索引访问，但不会自动检查越界。</p>
</li>
<li>
<p>使用 <code>Span&lt;T&gt;</code> 操作时，<code>Span&lt;T&gt;</code> 会提供边界检查。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(2)</span>]
<span class="hljs-keyword">struct</span> SmallBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element;
}

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> SmallBuffer();
buffer[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// 运行时异常：索引越界</span>
</code></pre>
<h4 data-id="heading-24">与普通数组的对比：</h4>
<ul>
<li>
<p>普通数组（<code>T[]</code>）：分配在托管堆上，动态大小，支持垃圾回收。</p>
</li>
<li>
<p>内联数组：固定大小，嵌入结构体，连续内存，适合高性能场景。</p>
</li>
</ul>
<h3 data-id="heading-25">与其他特性的对比</h3>
<h4 data-id="heading-26">与普通数组（T[]）的对比：</h4>
<ul>
<li>
<p>普通数组是引用类型，分配在堆上，大小可动态调整。</p>
</li>
<li>
<p>内联数组是值类型的一部分，固定大小，内存连续，性能更高。</p>
</li>
</ul>
<h4 data-id="heading-27">与固定大小缓冲区（fixed）的对比：</h4>
<ul>
<li>
<p><code>C#</code> 的 <code>fixed</code> 关键字用于在 <code>unsafe</code> 上下文中创建固定大小缓冲区。</p>
</li>
<li>
<p>内联数组是类型安全的，无需 <code>unsafe</code>，更易用。</p>
</li>
</ul>
<h4 data-id="heading-28">与 <code>Span&lt;T&gt;/Memory&lt;T&gt;</code> 的对比：</h4>
<ul>
<li>
<p>内联数组是数据的存储结构，而 <code>Span&lt;T&gt;和Memory&lt;T&gt;</code>是访问视图。</p>
</li>
<li>
<p>内联数组可直接转换为 <code>Span&lt;T&gt;</code>，结合使用效率更高。</p>
</li>
</ul>
<h4 data-id="heading-29">与栈分配（stackalloc）的对比：</h4>
<ul>
<li>
<p><code>stackalloc</code> 在栈上分配临时内存，生命周期短。</p>
</li>
<li>
<p>内联数组嵌入结构体，支持更灵活的生命周期和传递。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣]]></title>    <link>https://juejin.cn/post/7581693431740170303</link>    <guid>https://juejin.cn/post/7581693431740170303</guid>    <pubDate>2025-12-09T15:07:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740170303" data-draft-id="7581669438577442852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣"/> <meta itemprop="keywords" content="前端,Puppeteer,Chrome"/> <meta itemprop="datePublished" content="2025-12-09T15:07:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:07:09.000Z" title="Tue Dec 09 2025 15:07:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Chrome DevTools Protocol (CDP)</strong> 是 Chromium 浏览器调试工具的核心通信协议：它基于 JSON 格式，可以通过 WebSocket 实现客户端与浏览器内核之间的双向实时交互。</p>
<p>基于 CDP 的开源产品有许多，其中最有名的应该是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fdevtools-frontend" target="_blank" title="https://github.com/ChromeDevTools/devtools-frontend" ref="nofollow noopener noreferrer">Chrome Devtools Frontend</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2F" target="_blank" title="https://pptr.dev/" ref="nofollow noopener noreferrer">Puppeteer</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright" target="_blank" title="https://github.com/microsoft/playwright" ref="nofollow noopener noreferrer">Playwright</a> 了。</p>
<p>Chrome Devtools Frontend 就是前端开发者天天按 F12 唤起的调试面板，而 Puppeteer 和 Playwright 是非常有名的浏览器自动化操作工具，如今的 agent browser tool（例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp" target="_blank" title="https://github.com/microsoft/playwright-mcp" ref="nofollow noopener noreferrer">playwright-mcp</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowser-use%2Fbrowser-use" target="_blank" title="https://github.com/browser-use/browser-use" ref="nofollow noopener noreferrer">browser-use</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp" ref="nofollow noopener noreferrer">chrome-devtools-mcp</a>）也是基于它们构建的。可以说每个开发者都在使用 CDP，但因它的定位比较底层，大家常常又意识不到他的存在。</p>













<table><thead><tr><th>Chrome Devtools Frontend</th><th>Puppeteer</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58fc0c7fcb5c43f88206432327f5c557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=H65vL%2Bv7rZanFTzqlwWbj%2F2i9Ig%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b4a23d85cd04ae5b5fc0b49a4845518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=xSvHO2Cb2Njx2ueJxY5wgf5oc%2B4%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<br/>
<p>CDP 有自己的<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2F" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/" ref="nofollow noopener noreferrer">官方文档站</a>和相关的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fdevtools-protocol" target="_blank" title="https://github.com/ChromeDevTools/devtools-protocol" ref="nofollow noopener noreferrer">Github 地址</a>，秉承了 Google 开源项目的一贯风格，简洁，克制，就是没什么可读性。文档和项目都是根据源码变动自动生成的，所以只能用来做 API 的查询，这也导致如果没有相关的领域知识，直接阅读相关文档或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.com%2FChromeDevTools%2Fdevtools-protocol" target="_blank" title="https://deepwiki.com/ChromeDevTools/devtools-protocol" ref="nofollow noopener noreferrer">deepwiki</a> 是拿不到什么有建设性内容的。</p>
<p>上面的那些吐槽，也是我写本文的原因，互联网上介绍 CDP 的博文太少了，也没什么系统性的架构分析，所以不如我自己来写丰富一下 AI 的语料库（bushi）。</p>
<h2 data-id="heading-0">协议格式</h2>
<p>首先 CDP 协议是一个典型的 CS 架构，这里我们拿 Chrome Devtools 为例：</p>
<ul>
<li><strong>Chrome Devtools</strong>：就是 <strong>Client</strong>，用来做调试数据的 UI 展示，方便用户阅读</li>
<li><strong>CDP</strong>：就是连接 Client-Server 的 <strong>Protocol</strong>，定义 API 的各种格式和细节</li>
<li><strong>Chromium/Chrome</strong>：就是 <strong>Server</strong>，用来产生各种数据</li>
</ul>
<p>CDP 协议的格式基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2Fspecification" target="_blank" title="https://www.jsonrpc.org/specification" ref="nofollow noopener noreferrer">JSON-RPC 2.0</a> 做了一些轻量的定制。首先是去掉了 JSON 结构体中的 <code>"jsonrpc": "2.0"</code> 这种每次都要发送的冗余信息。可以看下面几个 CDP 的实际例子：</p>
<p>首先是常规的 JSON RFC Request/Response，细节不用关注，就看整体的格式：</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/404ef253e3e7477e84e80d57dd18f894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=tW6ygST3zI61YPx7bAYtgpXrFpA%3D" width="50%" alt="Target.setDiscoverTargets" loading="lazy"/>
</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client -&gt; Chromium</span>
{
  <span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.setDiscoverTargets"</span>,
  <span class="hljs-string">"params"</span>: {<span class="hljs-string">"discover"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"filter"</span>:[{}]},
}

<span class="hljs-comment">// Chromium -&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-string">"result"</span>: {}
}
</code></pre>
<p>可以看到这就是一个经典的 JSON RFC 调用，用 id 串起 request 和 response 的关系，然后 request 中通过 <code>method</code> 和 <code>params</code> 把请求方法和请求参数带上；response 通过 <code>result</code> 带上响应结果。</p>
<p>关于 JSON RFC Notification（Event）的例子如下，定义也很清晰，就不展开了：</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42364511aa564fbb882c1741747b5ca3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=qpvAhUMxHWvnwa1Bo5IzxmL6zlw%3D" width="50%" alt="Target.targetCreated" loading="lazy"/>
</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.targetCreated"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"targetInfo"</span>: {
      <span class="hljs-string">"targetId"</span>: <span class="hljs-string">"12345"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"browser"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"attached"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"canAccessOpener"</span>: <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<p>众所周知，JSON RFC 只是一套协议标准，它其实可以跑在任意的支持双向通讯的通信协议上。目前 CDP 的主流方案还是跑在 WebSocket 上（也可以用本地 pipe 的方式连接，但用的人少），所以用户可以借助任意的 Websocket 开源库搭建出合适的产品。</p>
<br/>
<h2 data-id="heading-1">Domain 整体分类</h2>
<p>如果直接看 CDP 的文档，会发现它的目录侧边栏只有一列，那就是 Domains，然后下面有一堆看起来很熟悉的名词：DOM，CSS，Console，Debugger 等等...</p>













<table><thead><tr><th>CDP Domains</th><th>Chrome Devtools Frontend</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caaf795166e64422af13c099195561d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=uKibT6F6hhwmV5NF5ueUJl1TIzE%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dc754f66f2e4286a51da6bae6d3787a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=NAdtwX2RUDJTM6sVOhSmONY%2Fsp4%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<p>其实这些 Domain 都可以和 Chrome Devtools 联系起来的。所以我们可以从 Chrome Devtools 的各种功能反推 CDP 中的各种 Domain 作用：</p>
<ul>
<li><strong>Elements</strong>：会用到 DOM，CSS 等 domain 的 API</li>
<li><strong>Console</strong>：会用到 Log，Runtime 等 domain 的 API</li>
<li><strong>Network</strong>：会用到 Network 等 domain 的 API</li>
<li><strong>Performance</strong>：会用到 Performance，Emulation 等 domain 的 API</li>
<li>......</li>
</ul>
<p>那么到这里就有一个比较直观的认识了。我们再返回看 CDP 本身，CDP 其实可以分为两大类，然后下面有不同的 Domain 分类：</p>
<ul>
<li><strong>Browser Protocol</strong>：浏览器相关的协议，之下的 Domain 都是平台相关的，比如说 Page，DOM，CSS，Network，都是和浏览器功能相关</li>
<li><strong>JavaScript Protocol</strong>：JS 引擎相关的协议，主要围绕 JS 引擎功能本身，比如说 Runtime，Debugger，HeapProfiler 等，都是比较纯粹的 JS 语言调试功能</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0f160d77054854bd2820aff7f488a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=OoOCkjRBujMReK%2FcsD4%2BxbEP7vU%3D" alt="deepwiki 给出的 CDP Domains 分类" loading="lazy"/></p>
<p>了解了 Domain 的整体分类，下一步我们探索一下 Domain 内部的运行流程。</p>
<h2 data-id="heading-2">Domain 内部通信</h2>
<p>理解某个 Domain 的运行流程，还是老办法，对照着 <code>Chrome Devtools Frontend</code> 的某个调试面板反推，这样理解起来是最快的。</p>
<p>这里我们拿 Console 面板为例，这个基本上是 Web 开发者日常使用频率最高的功能了。</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a3dd170dfe406c9a62748d1d03addf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=Focsa5DZZEZHPikx8vTgfnYUmU8%3D" width="70%" loading="lazy"/>
</p>
<p>从 UI 面板上看有很多功能，有筛选，分类，分组等各种高级功能，但绝大部分的功能都是前端上的实现，联系到背后和 Console 相关的 CDP 协议，其实主要就 5 条：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23method-enable" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#method-enable" ref="nofollow noopener noreferrer">Method: Log.enable</a>/<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23method-disable" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#method-disable" ref="nofollow noopener noreferrer">Method: <strong>Log</strong>.disable</a>: 开启/关闭当前页面的 log 日志输出功能</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23event-entryAdded" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#event-entryAdded" ref="nofollow noopener noreferrer">Event: Log.entryAdded</a>: 浏览器内部产生日志时触发，比如说一些网络错误，安全错误</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FRuntime%2F%23event-consoleAPICalled" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#event-consoleAPICalled" ref="nofollow noopener noreferrer">Event: Runtime.consoleAPICalled</a>: JS 代码调用 console API 时触发</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FRuntime%2F%23event-exceptionThrown" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#event-exceptionThrown" ref="nofollow noopener noreferrer">Event: Runtime.exceptionThrown</a>: 有未被捕获的 JS 错误时触发</li>
</ul>
<br/>
<p>举一个真实的例子，我们在 Console 面板先发起一个不合规的网络请求，然后再 log 一句话：</p>
<ul>
<li>首先每个页面打开 Devtools 的时候，会默认调用 <code>Log.enable</code> 启动 log 监听</li>
<li>手动 fetch 一个不合规的地址时，浏览器会先做安全检查，通过 <code>Log.entryAdded</code> 提示不合规</li>
<li>发起一个真实的网络请求，失败后会通过 <code>Runtime.exceptionThrown</code> 提示 Failed to fetch</li>
<li>最后手动调用 console API，CDP 会发一个 <code>Runtime.consoleAPICalled</code> 的调用 log event</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80c5622ae54642fe972570dcc41dd180~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=djhVR8%2BMlIDN7xPY2mP9U4gGZao%3D" alt="" loading="lazy"/></p>
<p>把上面的的例子抽象一下，其实<strong>所有的 Domain 的调用流程</strong>基本都是一样的：</p>
<ul>
<li>通过 <code>Domain.enable</code> 开启某个 Domain 的调试功能</li>
<li>开启功能后，就可以在这个阶段发送相关的 methods 调用，也可以监听 Chrome 发来的各种 event</li>
<li>通过 <code>Domain.disable</code> 关闭这个 Domain 的调试功能</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1bddb28db9449489cdf77b998d8c081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=gQPanPxMyKtUwZQ9FoYyiNoWptY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>部分 Domain 并没有 enable/disable 这两个 methods，具体情况具体分析</p>
</blockquote>
<h2 data-id="heading-3">Target: 特殊的 Domain</h2>
<p>上面介绍了 Domain 的分类和 Domain 内部运转的整体流程，但是有一个 Domain 非常的特殊，那就是 <strong>Target</strong>。</p>
<h3 data-id="heading-4">type 分类</h3>
<p>Target 是一个较为抽象的概述，它指的是浏览器中的<strong>可交互实体</strong>：</p>
<ul>
<li>我创建了一个<strong>浏览器</strong>，那么它本身就是一个 type 为「browser」的 Target</li>
<li>浏览器里有一个<strong>标签页</strong>，那么这个页面本身就是一个 type 为「page」的 Target</li>
<li>这个页面里要做一些耗时计算创建了一个 <strong>Worker</strong>，那么它就是一个 type 为「worker」的 Target</li>
</ul>
<p>目前从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.chromium.org%2Fchromium%2Fchromium%2Fsrc%2F%2B%2Fmain%3Acontent%2Fbrowser%2Fdevtools%2Fdevtools_agent_host_impl.cc%3Fss%3Dchromium%26q%3Df%3Adevtools%2520-f%3Aout%2520%2522%3A%3AkTypeTab%255B%255D%2522" target="_blank" title="https://source.chromium.org/chromium/chromium/src/+/main:content/browser/devtools/devtools_agent_host_impl.cc?ss=chromium&amp;q=f:devtools%20-f:out%20%22::kTypeTab%5B%5D%22" ref="nofollow noopener noreferrer">chromium 源码</a>上可以看出，Target 的 type 有以下几种：</p>
<ul>
<li>browser，browser_ui，webview</li>
<li>tab，page，iframe</li>
<li>worker，shared_worker，service_worker</li>
<li>worklet，shared_storage_worklet，auction_worklet</li>
<li>assistive_technology，other</li>
</ul>
<p>从上面的 target type 可以看出，Target 整体是属于一个 scope 比较大的实体，基本上是以<strong>进程/<strong><strong>线程</strong></strong>作为隔离单位</strong>分割的，每个 type 下可能包含多个 CDP domain，比如说 page 下就有 Runtime，Network，Storage，Log 等 domain，其他类型同理。</p>
<h3 data-id="heading-5">交互流程</h3>
<p>Target 的内部分类清晰了，那么还剩重要的一环：<strong>如何和 Target 做交互</strong>？ <br/></p>
<p>CDP 这里的逻辑是，先发个请求，向 Target 发起交互申请，然后 Target 就会给你一个 sessionId，之后的交互就在这个 session 信道上进行。CDP 在这里也对 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2Fspecification" target="_blank" title="https://www.jsonrpc.org/specification" ref="nofollow noopener noreferrer">JSON-RPC 2.0</a> 做了一个轻量定制，它们把 sessionId 放在了 JSON 的最外层，和 id 同一个层级：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">{
  <span class="hljs-attr">method</span>: <span class="hljs-string">"SystemInfo.getInfo"</span>,
  <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>,
  <span class="hljs-attr">sessionId</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
}
</code></pre>
<br/>
<p>我举个实际的例子看 session 的交互流程。</p>
<p>假设我们想从 browser Target 上获取一些系统消息，先假设我们事先已经知道了 browser 的 targetId，那么一个完整的 session 通信如下：</p>
<blockquote>
<p>这里为了聚焦 session 的核心交互逻辑，下面的 CDP message 删除了不必要的信息</p>
</blockquote>
<ol>
<li>Client 通过 <code>Target.attachToTarget</code> API 向 browser 发起会话请求，拿到 sessionId</li>
</ol>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-comment">// Client —&gt; Chromium</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Target.attachToTarget"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"targetId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"31a082d2-ba00-4d8f-b807-9d63522a6112"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// browser targetId</span>
    <span class="hljs-attr">"flatten"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-comment">// 使用 flatten 模式，后续将会把 sessionId 和 id 放在同一层级</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// Chromium —&gt; Client</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span> <span class="hljs-comment">// 拿到这次对话的 sessionId</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="2">
<li>Client 带上上一步给的 sessionId，发送一条获取系统信息的 CDP 调用并获取到相关消息</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client —&gt; Chromium</span>
{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"SystemInfo.getInfo"</span>, <span class="hljs-comment">// 获取系统信息的方法</span>
  <span class="hljs-string">"id"</span>: <span class="hljs-number">9</span>,
  <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span> <span class="hljs-comment">// sessionId 和 id 同级，在最外层</span>
}

<span class="hljs-comment">// Chromium —&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">9</span>,
  <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
  <span class="hljs-string">"result"</span>: { <span class="hljs-comment">/* ... */</span> },
}
</code></pre>
<ol start="3">
<li>不想在这个 session 上聊了，调用 <code>Target.detachFromTarget</code> 直接断开连接，自此这个会话就算销毁了</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client —&gt; Chromium</span>
{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.detachFromTarget"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">11</span>,
  <span class="hljs-string">"sessionId"</span>:<span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
}

<span class="hljs-comment">// Chromium —&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">11</span>,
  <span class="hljs-string">"result"</span>: {}
}
</code></pre>
<p>上面的流程可以用下面的图表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0974656c9a1f4046bcff29d3a2d2f9c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=WouIsCouKtStwX6%2FgwO6zrRkE6I%3D" alt="" loading="lazy"/></p>
<p>当然涉及 Target 生命周期的相关 Methods 和 Event 还有很多，一一讲解也不现实，感兴趣的同学可以自己探索。</p>
<h3 data-id="heading-6">一对多</h3>
<p>除了上述的特性，Target 还有一个特点，那就是<strong>一个 Target 允许多个 session 连接</strong>。这意味着可以有多个 Client 去控制同一个 Target。这在现实中也是很常见的。比如说对于一个网页实体，它既可以被 Chrome Devtools（Client1）调试，也可以同时被 puppeteer（Client2）连接做自动化控制。当然这也会带来了一些资源访问的并发问题，在实际应用场景上需要万分的小心。</p>
<h2 data-id="heading-7">综合案例</h2>
<p>综上所述，我们可以看一个实际的例子，把上面的内容都囊括起来。</p>
<p>下面的案例我是用 puppeteer 创建了一个 url 为 <code>about:blank</code> 的新网页时，底层的 CDP 调用流程。调用的源文件可以访问右边的超链接下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Flf3-static.bytednsdoc.com%2Fobj%2Feden-cn%2Feojfrzeh7vhouloj%2Fagent-infra-browser%2Fcreate_about_blank_page.har" target="_blank" title="https://lf3-static.bytednsdoc.com/obj/eden-cn/eojfrzeh7vhouloj/agent-infra-browser/create_about_blank_page.har" ref="nofollow noopener noreferrer">create_about_blank_page.har</a>，har 文件可用 Chrome Devtools Network 导入查看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddd1bad12f9649579c6df68053b1af15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=gMZOm1cx74%2Fv9liucTtQ0cq3hec%3D" alt="" loading="lazy"/></p>
<br/>
<p>首先是最开始的 Target 创建流程。注意下图红框和红线里的内容：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc4fab4cf1d40ac80e5164547917576~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=0yciZ8XPPsrATzbBVX5%2FYCX62hk%3D" alt="" loading="lazy"/></p>
<ul>
<li>首先调用 <code>Target.createTarget</code> 创建一个 page（在调用 <code>createTarget</code> 时，会同步生成一个 tab Target，我们可以忽略这个行为，不影响后续理解）</li>
<li>page Target 创建好后，在响应 <code>Target.createTarget</code> methods 的同时，还会发送一个 <code>Target.targetCreated</code> 的 event，里面有这个 page Target 的详细 meta info，例如 targetId，url，title 等</li>
<li>page Target 的 meta info 变动时，会下发 <code>Target.targetInfoChanged</code> event 同步信息变化</li>
<li>page Target 下发一个 <code>Target.attachedToTarget</code> 的 event，告知 client 这次连接的 sessionId，这样后续的一些 domain 操作就可以带上 sessionId 保证信道了</li>
</ul>
<br/>
<p>Target 创建好后，就要开启这个 page 下的各个 Domain 了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc124c24e86b47a297fb9a27e2394941~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=3w1fDfS1PLgYbE3x6fKvmLpWwPc%3D" alt="" loading="lazy"/></p>
<ul>
<li>Network.enable：开启 Network Domain 的监听，比如说各种网络请求的 request/response 的细节</li>
<li>Page.enable：开启 Page Domain 的监听，比如说 navigation 行为的操纵</li>
<li>Runtime.enable：开启 Runtime Domain 的监听，比如说要在 page 里 evaluate 一段注入函数</li>
<li>Performance.enable：开启 Performance Domain 的监听，比如说一些 metrics 信息</li>
<li>Log.enable：开启 log 相关信息的监听，比如说各种 console.log 信息</li>
</ul>
<br/>
<p>开启相关 Domain 后，就可以监听这个 page Target 的相关 event 或者主动触发一些方法，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37ea0781e7f54ccf8db57c06f718cd35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=l5KVbjd8QgrWz3MvdWCZ7U8HphY%3D" alt="" loading="lazy"/></p>
<ul>
<li>我们主动执行 <code>Page.getNavigationHistory</code> methods，获取当前页面的 history 导航记录</li>
<li>我们监听到 <code>Runtime.consoleAPICalled</code> event 的触发，拿到了一些 console 信息</li>
</ul>
<p>相关的细节还有很多就不一一列举了，感兴趣的同学可以看上面的 har 源文件，我相信全部看完后就会对 CDP 有个清晰的认知了。</p>
<h2 data-id="heading-8">编码建议</h2>
<p>就目前（2025.12）而言，Code Agent 和 DeepResearch 等常见的 AI 辅助编程工具在 CDP 领域上表现<strong>并不是很好</strong>，主要的原因有 3 点：</p>
<ul>
<li><strong>预训练语料少</strong>：从前文可知，CDP 因为协议过于底层，所以相关的使用案例和代码非常少，模型预训练时语料很少，导致幻觉还是比较严重的</li>
<li><strong>文档质量一般</strong>：CDP 文档写的太简洁了，基本就是根据出入参自动生成的类型文档，只能用来查询核实一下，想从中获得完整的概念，对 AI 和人来说还是太难了</li>
<li><strong>API 动态迭代</strong>：CDP 虽然开源出来了，但其本质还是一个为 Chromium 服务的私有协议，其 latest 版本一直在动态迭代中，所以这种动态变化也影响了 AI 的发挥</li>
</ul>
<br/>
<p>综合以上原因，我的一个策略是「<strong>小步快跑，随时验证</strong>」。方案就是对于自己想实现的功能，先让 AI 出一个大致的方案，但是不要直接在自己的迭代的项目里直接写，而是先生成一个可以快速验证相关功能的最小 DEMO，然后亲自去验证这个方案是否符合预期。</p>
<p>「亲自验证 DEMO 可行性」 这一步非常重要，因为 AI 直出的 CDP 解决方案可靠性并不高，不像 <code>AI -&gt; UI</code> 有较高的容错率和置信度，只有在 DEMO 上验证成功的方案才有迁移到正式项目的价值。</p>
<p>另一个解决方案，就是<strong>从</strong> <strong>puppeteer</strong> <strong>等优秀项目上吸取经验</strong>。puppeteer 底层也是调用 CDP，而且它迭代了十余年，对一些常见案例已经沉淀了一套成熟的解决方案。通过学习它内部的 CDP 调用流程，可以学习到很多文档未曾描述的运用场景。下一篇 Blog，我们就分析一下 puppeteer 的源码架构，让我们在调用过程中更加得心应手。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🕹️ [AI] Chrome DevTools MCP 原理分析]]></title>    <link>https://juejin.cn/post/7581689310643634218</link>    <guid>https://juejin.cn/post/7581689310643634218</guid>    <pubDate>2025-12-09T15:23:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310643634218" data-draft-id="7566946330695139378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🕹️ [AI] Chrome DevTools MCP 原理分析"/> <meta itemprop="keywords" content="前端,MCP"/> <meta itemprop="datePublished" content="2025-12-09T15:23:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🕹️ [AI] Chrome DevTools MCP 原理分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:23:40.000Z" title="Tue Dec 09 2025 15:23:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025.09.23 Google 官方发布了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp" ref="nofollow noopener noreferrer">Chrome DevTools MCP</a>，目前版本号还是 0.9.0，Google 官方对它的定位是协助 AI coding assistants 做调试和性能测试，提高网页编程的 debug 能力，一些使用案例可见官方 blog：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fblog%2Fchrome-devtools-mcp%3Fhl%3Den" target="_blank" title="https://developer.chrome.com/blog/chrome-devtools-mcp?hl=en" ref="nofollow noopener noreferrer">Chrome DevTools (MCP) for your AI agent</a>。</p>
<p>本文主要是结合 源码 和 MCP output 内容，分析 chrome-devtools-mcp 的运行原理，探索它的能力边界。</p>
<h2 data-id="heading-0">Tools 分类</h2>
<p>从它的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp%2Fblob%2Fmain%2Fdocs%2Ftool-reference.md" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp/blob/main/docs/tool-reference.md" ref="nofollow noopener noreferrer">MCP Tools</a> 可以看出，它的 tools 可以分为以下类别：</p>
<ul>
<li>
<p><strong>基础能力</strong>：这部分能力主要是做网页操作，这个是所有的 Browser MCP 的基石，用户也可以不用任何网页调试的能力，只用这部分基础能力做网页自动化操作</p>
<ul>
<li><strong>Navigation</strong>：就是 createPage，closePage 等</li>
<li><strong>Input</strong>：就是 page 内的 click，hover 等操作</li>
</ul>
</li>
<li>
<p><strong>调试能力</strong>：这个其实是 chrome-devtools-mcp 主要定位的地方，提供基础的调试信息透出</p>
<ul>
<li><strong>Emulation</strong>：目前的功能还是比较弱，主要是弱网模拟，CPU 降速模拟，尺寸模拟，其实对应的是这几个功能:
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5fca893091842548301b4b3a4917c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=MMOPBahCOzSReg%2FtyNMdrdhfgNs%3D" alt="cdm-perfs" loading="lazy"/></li>
<li><strong>Performance</strong>：用来收集性能 trace 数据，对标如下的功能：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7401622b47ff4a628a94c8f5a375df0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=2inC47aSzobtuJiQ7oX2DNmh%2FvY%3D" alt="cdm-cpu-network" loading="lazy"/></li>
<li><strong>Network</strong>：获取当前 page 的所有网络信息</li>
<li><strong>Debugging</strong>：获取 console 信息，截图，还可以注入一些代码</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">技术细节</h2>
<p>chrome-devtools-mcp 底层使用的还是 <strong>puppeteer</strong>，所以很多功能直接可以对标到 puppeteer 的操作。我们直接分析 Tools 的一些技术细节。</p>
<h3 data-id="heading-2">Navigation</h3>
<p>Navigation 这块儿包装的内容很少。</p>
<p><strong>首先是 Tabs 管理。</strong></p>
<p>其实就是用了 <code>browser.pages()</code> 这个 API，然后对每个 tab 做一个基础的编号，然后利用 <code>bringToFront()</code> 做 tab 的激活，被激活的 tab 会有一个 <code>[selected]</code> 的标记：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> parts = [<span class="hljs-string">`## Pages`</span>];
<span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> page <span class="hljs-keyword">of</span> context.<span class="hljs-title function_">getPages</span>()) {
  parts.<span class="hljs-title function_">push</span>(
    <span class="hljs-string">`<span class="hljs-subst">${idx}</span>: <span class="hljs-subst">${page.url()}</span><span class="hljs-subst">${idx === context.getSelectedPageIdx() ? <span class="hljs-string">' [selected]'</span> : <span class="hljs-string">''</span>}</span>`</span>,
  );
  idx++;
}
</code></pre>
<p>最后给模型的 response 结构如下：</p>
<pre><code class="hljs language-javascript" lang="javascript">## <span class="hljs-title class_">Pages</span>
<span class="hljs-number">0</span>: <span class="hljs-attr">https</span>:<span class="hljs-comment">//developer.chrome.com/?hl=zh-cn</span>
<span class="hljs-number">1</span>: <span class="hljs-attr">https</span>:<span class="hljs-comment">//www.baidu.com/ [selected]</span>
</code></pre>
<p>chrome-devtools-mcp 这里封装非常浅，其实很多错误处理，超时处理都没有做。</p>
<br/>
<p><strong>然后是页面导航内容。</strong></p>
<p>比如说 <code>new_page</code>，<code>navigate_page</code>，<code>close_page</code> 等，其实都比较简单：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// new_page</span>
<span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();
<span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">url</span>, {
  <span class="hljs-attr">timeout</span>: request.<span class="hljs-property">params</span>.<span class="hljs-property">timeout</span>,
});

<span class="hljs-comment">// navigate_page</span>
<span class="hljs-keyword">const</span> page = context.<span class="hljs-title function_">getSelectedPage</span>();
<span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">url</span>, {
  <span class="hljs-attr">timeout</span>: request.<span class="hljs-property">params</span>.<span class="hljs-property">timeout</span>,
});

<span class="hljs-comment">// close_page</span>
<span class="hljs-keyword">await</span> context.<span class="hljs-title function_">closePage</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">pageIdx</span>);
</code></pre>
<p>这里的封装也是比较浅的，很多健壮性工作都没有做。</p>
<h3 data-id="heading-3">Input</h3>
<p>chrome-devtools-mcp 目前还是基于 DOM 的 snapshot 去做 click/drag/hover 等操作的。这里以百度首页为例，从一个简单的 click 场景分析一下它的运行流程。</p>
<ol>
<li>首先，我们通过 pptr 的可访问性 API 拿到 DOM 的 JSON 树：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rootNode = <span class="hljs-keyword">await</span> page.<span class="hljs-property">accessibility</span>.<span class="hljs-title function_">snapshot</span>({
 <span class="hljs-attr">includeIframes</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<ol start="2">
<li>然后，保存 JSON 树的每个节点，对每个节点做好编号方便后续格式化：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> idCounter = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> idToNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">TextSnapshotNode</span>&gt;();
<span class="hljs-keyword">const</span> assignIds = (<span class="hljs-attr">node</span>: <span class="hljs-title class_">SerializedAXNode</span>): <span class="hljs-function"><span class="hljs-params">TextSnapshotNode</span> =&gt;</span> {
 <span class="hljs-keyword">const</span> <span class="hljs-attr">nodeWithId</span>: <span class="hljs-title class_">TextSnapshotNode</span> = {
   ...node,
   <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${snapshotId}</span>_<span class="hljs-subst">${idCounter++}</span>`</span>, <span class="hljs-comment">// 编号</span>
   <span class="hljs-attr">children</span>: node.<span class="hljs-property">children</span>
     ? node.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">assignIds</span>(child)) <span class="hljs-comment">// 递归处理 dom 树节点</span>
     : [],
 };
 idToNode.<span class="hljs-title function_">set</span>(nodeWithId.<span class="hljs-property">id</span>, nodeWithId);
 <span class="hljs-keyword">return</span> nodeWithId;
};
</code></pre>













<table><thead><tr><th>处理前的 snapshot</th><th>处理后的 snapshot</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7df4e9252394c948e85529de6721c77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=F97%2FU0zuUx%2BNCkynOoT%2BwSiYkjY%3D" alt="" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8388e310df4462bba70d484cf83914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=snfmmiSIvezhMP2EvCFCzD3CnbY%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<ol>
<li>最后，执行相关 action 操作，比如说我要 click「新闻」这个按钮，会定位到 <code>uid=1_1 link "新闻"</code> 这条数据，然后参数传入 <code>1_1</code>，执行如下的代码：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.#textSnapshot?.<span class="hljs-property">idToNode</span>.<span class="hljs-title function_">get</span>(uid); <span class="hljs-comment">// uid="1_1"</span>
<span class="hljs-comment">// pptr 可以根据 node.elementHandle 拿到相关 dom 的 handle</span>
<span class="hljs-keyword">const</span> handle = <span class="hljs-keyword">await</span> node.<span class="hljs-title function_">elementHandle</span>(); 

<span class="hljs-keyword">await</span> handle.<span class="hljs-title function_">asLocator</span>().<span class="hljs-title function_">click</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
</code></pre>
<br/>
<p>其余 action 操作都大差不差，都是 <strong>拿到 snapshot</strong> -&gt; <strong>分析意图拿到 uid</strong> -&gt; <strong>通过 uid 拿到 DOM 执行 action</strong> 的操作。</p>
<p>这一套方案的优势是可以直接通过 pptr 的 accessibility API 拿到 DOM 的信息（而不是 browser-use 注入 JS 代码然后做自定义格式化），封装更浅更通用；劣势是可能最终 snapshot 会构建的比较大，可能会占用不少上下文。</p>
<h3 data-id="heading-4">Emulation</h3>
<p>这个内容比较简单，就是通过 pptr 的 API 调用用来模拟慢速网络，慢速 CPU，调整网页大小。只是把 API MCP 化了，不涉及很多的逻辑和上下文处理，所以略过。</p>
<h3 data-id="heading-5">Performance</h3>
<p>这个是 MCP 主打的一个功能，做性能度量和性能测试。我们先看一下它是怎么做的。</p>
<p>目前 MCP 的实现很简单，其实就是通过 pptr 提供的 API，对相关网页做性能测试的 start/stop 两个操作：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa251eff1c34ecd9011281de0e85ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=SE6UPprylN0rSOdpRmhG0Pb282o%3D" alt="" loading="lazy"/></p>
<p>但是它不会把完整的 trace 交给模型分析（完整的 trace 数据量很大，可能是 10～100 MB的 json 数据，交给模型分析也不现实），而是输出为一份<strong>性能报告模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Summary of Performance trace findings:</span>
URL: https://developer.chrome.com/?hl=zh-cn
Bounds: {min: 771625656677, max: 771629299667}
CPU throttling: none
Network throttling: none
Metrics (lab / observed):
<span class="hljs-bullet">  -</span> LCP: 907 ms, event: (eventKey: r-6881, ts: 771626610159), nodeId: 170
<span class="hljs-bullet">  -</span> LCP breakdown:
<span class="hljs-bullet">    -</span> TTFB: 808 ms, bounds: {min: 771625702955, max: 771626510489}
<span class="hljs-bullet">    -</span> Render delay: 100 ms, bounds: {min: 771626510489, max: 771626610159}
<span class="hljs-bullet">  -</span> CLS: 0.03, event: (eventKey: s--1, ts: 771626595695)
Metrics (field / real users): n/a – no data for this page in CrUX
Available insights:
<span class="hljs-bullet">  -</span> insight name: DocumentLatency
<span class="hljs-code">    description: Your first network request is the most important.  Reduce its latency by avoiding redirects, ensuring a fast server response, and enabling text compression.
    relevant trace bounds: {min: 294, max: 771626579945}
    estimated metric savings: FCP 706 ms, LCP 706 ms
    example question: How do I decrease the initial loading time of my page?
    example question: Did anything slow down the request for this document?
  - insight name: RenderBlocking
    description: Requests are blocking the page's initial render, which may delay LCP. [Deferring or inlining](https://web.dev/learn/performance/understanding-the-critical-path#render-blocking_resources) can move these network requests out of the critical path.
    relevant trace bounds: {min: 771626513396, max: 771626531288}
    estimated metric savings: FCP 90 ms, LCP 90 ms
    example question: Show me the most impactful render blocking requests that I should focus on
    example question: How can I reduce the number of render blocking requests?
  - insight name: LCPBreakdown
    description: Each [subpart has specific improvement strategies](https://web.dev/articles/optimize-lcp#lcp-breakdown). Ideally, most of the LCP time should be spent on loading the resources, not within delays.
    relevant trace bounds: {min: 771625702955, max: 771626610159}
    example question: Help me optimize my LCP score
    example question: Which LCP phase was most problematic?
    example question: What can I do to reduce the LCP time for this page load?
  - insight name: CLSCulprits
    description: Layout shifts occur when elements move absent any user interaction. [Investigate the causes of layout shifts](https://web.dev/articles/optimize-cls), such as elements being added, removed, or their fonts changing as the page loads.
    relevant trace bounds: {min: 771626595695, max: 771628821131}
    example question: Help me optimize my CLS score
    example question: How can I prevent layout shifts on this page?
  - insight name: NetworkDependencyTree
    description: [Avoid chaining critical requests](https://developer.chrome.com/docs/lighthouse/performance/critical-request-chains) by reducing the length of chains, reducing the download size of resources, or deferring the download of unnecessary resources to improve page load.
    relevant trace bounds: {min: 771625703654, max: 771626579945}
    example question: How do I optimize my network dependency tree?
  - insight name: ThirdParties
    description: 3rd party code can significantly impact load performance. [Reduce and defer loading of 3rd party code](https://web.dev/articles/optimizing-content-efficiency-loading-third-party-javascript/) to prioritize your page's content.
    relevant trace bounds: {min: 771626513396, max: 771628820176}
    example question: Which third parties are having the largest impact on my page performance?
</span>
<span class="hljs-section">## Details on call tree &amp; network request formats:</span>
Information on performance traces may contain main thread activity represented as call frames and network requests.

Each call frame is presented in the following format:

'id;eventKey;name;duration;selfTime;urlIndex;childRange;[S]'

Key definitions:

<span class="hljs-bullet">*</span> id: A unique numerical identifier for the call frame. Never mention this id in the output to the user.
<span class="hljs-bullet">*</span> eventKey: String that uniquely identifies this event in the flame chart.
<span class="hljs-bullet">*</span> name: A concise string describing the call frame (e.g., 'Evaluate Script', 'render', 'fetchData').
<span class="hljs-bullet">*</span> duration: The total execution time of the call frame, including its children.
<span class="hljs-bullet">*</span> selfTime: The time spent directly within the call frame, excluding its children's execution.
<span class="hljs-bullet">*</span> urlIndex: Index referencing the \"All URLs\" list. Empty if no specific script URL is associated.
<span class="hljs-bullet">*</span> childRange: Specifies the direct children of this node using their IDs. If empty ('' or 'S' at the end), the node has no children. If a single number (e.g., '4'), the node has one child with that ID. If in the format 'firstId-lastId' (e.g., '4-5'), it indicates a consecutive range of child IDs from 'firstId' to 'lastId', inclusive.
<span class="hljs-bullet">*</span> S: <span class="hljs-emphasis">_Optional_</span>. The letter 'S' terminates the line if that call frame was selected by the user.

Example Call Tree:

1;r-123;main;500;100;;
2;r-124;update;200;50;;3
3;p-49575-15428179-2834-374;animate;150;20;0;4-5;S
4;p-49575-15428179-3505-1162;calculatePosition;80;80;;
5;p-49575-15428179-5391-2767;applyStyles;50;50;;

Network requests are formatted like this:
<span class="hljs-code">`urlIndex;eventKey;queuedTime;requestSentTime;downloadCompleteTime;processingCompleteTime;totalDuration;downloadDuration;mainThreadProcessingDuration;statusCode;mimeType;priority;initialPriority;finalPriority;renderBlocking;protocol;fromServiceWorker;initiators;redirects:[[redirectUrlIndex|startTime|duration]];responseHeaders:[header1Value|header2Value|...]`</span>

<span class="hljs-bullet">-</span> <span class="hljs-code">`urlIndex`</span>: Numerical index for the request's URL, referencing the \"All URLs\" list.
<span class="hljs-bullet">-</span> <span class="hljs-code">`eventKey`</span>: String that uniquely identifies this request's trace event.
Timings (all in milliseconds, relative to navigation start):
<span class="hljs-bullet">-</span> <span class="hljs-code">`queuedTime`</span>: When the request was queued.
<span class="hljs-bullet">-</span> <span class="hljs-code">`requestSentTime`</span>: When the request was sent.
<span class="hljs-bullet">-</span> <span class="hljs-code">`downloadCompleteTime`</span>: When the download completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`processingCompleteTime`</span>: When main thread processing finished.
Durations (all in milliseconds):
<span class="hljs-bullet">-</span> <span class="hljs-code">`totalDuration`</span>: Total time from the request being queued until its main thread processing completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`downloadDuration`</span>: Time spent actively downloading the resource.
<span class="hljs-bullet">-</span> <span class="hljs-code">`mainThreadProcessingDuration`</span>: Time spent on the main thread after the download completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`statusCode`</span>: The HTTP status code of the response (e.g., 200, 404).
<span class="hljs-bullet">-</span> <span class="hljs-code">`mimeType`</span>: The MIME type of the resource (e.g., \"text/html\", \"application/javascript\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`priority`</span>: The final network request priority (e.g., \"VeryHigh\", \"Low\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`initialPriority`</span>: The initial network request priority.
<span class="hljs-bullet">-</span> <span class="hljs-code">`finalPriority`</span>: The final network request priority (redundant if <span class="hljs-code">`priority`</span> is always final, but kept for clarity if <span class="hljs-code">`initialPriority`</span> and <span class="hljs-code">`priority`</span> differ).
<span class="hljs-bullet">-</span> <span class="hljs-code">`renderBlocking`</span>: 't' if the request was render-blocking, 'f' otherwise.
<span class="hljs-bullet">-</span> <span class="hljs-code">`protocol`</span>: The network protocol used (e.g., \"h2\", \"http/1.1\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`fromServiceWorker`</span>: 't' if the request was served from a service worker, 'f' otherwise.
<span class="hljs-bullet">-</span> <span class="hljs-code">`initiators`</span>: A list (separated by ,) of URL indices for the initiator chain of this request. Listed in order starting from the root request to the request that directly loaded this one. This represents the network dependencies necessary to load this request. If there is no initiator, this is empty.
<span class="hljs-bullet">-</span> <span class="hljs-code">`redirects`</span>: A comma-separated list of redirects, enclosed in square brackets. Each redirect is formatted as
<span class="hljs-code">`[redirectUrlIndex|startTime|duration]`</span>, where: <span class="hljs-code">`redirectUrlIndex`</span>: Numerical index for the redirect's URL. <span class="hljs-code">`startTime`</span>: The start time of the redirect in milliseconds, relative to navigation start. <span class="hljs-code">`duration`</span>: The duration of the redirect in milliseconds.
<span class="hljs-bullet">-</span> <span class="hljs-code">`responseHeaders`</span>: A list (separated by '|') of values for specific, pre-defined response headers, enclosed in square brackets.
The order of headers corresponds to an internal fixed list. If a header is not present, its value will be empty.
</code></pre>
<p>从上面这个 Summary 模板可以看出主要是暴露了一些常用的性能数据，可以拿到一个较为完整的性能报告。</p>
<p>另外一个用法是通过 <code>performance_analyze_insight</code> API 拿到具体的指标内容，比如说我想看一下 LCP 的数据，它就会从 trace 数据中拿 LCP 的内容，其实内容也是<strong>预设好的模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># performance<span class="hljs-emphasis">_analyze_</span>insight response</span>

<span class="hljs-section">## Insight Title: LCP breakdown</span>

<span class="hljs-section">## Insight Summary:</span>
This insight is used to analyze the time spent that contributed to the final LCP time and identify which of the 4 phases (or 2 if there was no LCP resource) are contributing most to the delay in rendering the LCP element.

<span class="hljs-section">## Detailed analysis:</span>
The Largest Contentful Paint (LCP) time for this navigation was 4,412 ms.
The LCP element (IMG, nodeId: 6815) is an image fetched from https://contentcms-bj.cdn.bcebos.com/cmspic/dc39f2b27f6e7b4ce3d76a5019276cde.jpeg?x-bce-process=image/crop,x<span class="hljs-emphasis">_0,y_</span>0,w<span class="hljs-emphasis">_665,h_</span>362 (eventKey: s-4377, ts: 779075655743).
<span class="hljs-section">## LCP resource network request: https://contentcms-bj.cdn.bcebos.com/cmspic/dc39f2b27f6e7b4ce3d76a5019276cde.jpeg?x-bce-process=image/crop,x<span class="hljs-emphasis">_0,y_</span>0,w<span class="hljs-emphasis">_665,h_</span>362</span>
eventKey: s-4377
Timings:
<span class="hljs-bullet">-</span> Queued at: 457 ms
<span class="hljs-bullet">-</span> Request sent at: 457 ms
<span class="hljs-bullet">-</span> Download complete at: 457 ms
<span class="hljs-bullet">-</span> Main thread processing completed at: 457 ms
Durations:
<span class="hljs-bullet">-</span> Download time: 0.2 ms
<span class="hljs-bullet">-</span> Main thread processing time: 0 μs
<span class="hljs-bullet">-</span> Total duration: 0.2 ms
Initiator: https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/module_</span>static<span class="hljs-emphasis">_include/module_</span>static<span class="hljs-emphasis">_include_</span>5d6af88.js
Redirects: no redirects
Status code: 200
MIME Type: image/jpeg
Protocol: h2
Priority: Low
Render blocking: No
From a service worker: No
Initiators (root request to the request that directly loaded this one): https://news.baidu.com/, https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/module_</span>static<span class="hljs-emphasis">_include/module_</span>static<span class="hljs-emphasis">_include_</span>5d6af88.js
Response headers
<span class="hljs-bullet">-</span> content-md5: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-flow-control-type: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-image-info: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> age: 10675
<span class="hljs-bullet">-</span> ohc-cache-hit: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> expires: Fri, 17 Oct 2025 04:17:05 GMT
<span class="hljs-bullet">-</span> date: Tue, 14 Oct 2025 07:16:54 GMT
<span class="hljs-bullet">-</span> content-type: image/jpeg
<span class="hljs-bullet">-</span> last-modified: Tue, 14 Oct 2025 04:17:04 GMT
<span class="hljs-bullet">-</span> ohc-cos.ap-shanghai-size: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-cache-status: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-debug-id: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-request-id: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> accept-ranges: bytes
<span class="hljs-bullet">-</span> ohc-global-saved-time: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> content-length: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-is-transition: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> server: nginx
<span class="hljs-bullet">-</span> x-bce-storage-class: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>

We can break this time down into the 4 phases that combine to make the LCP time:

<span class="hljs-bullet">-</span> Time to first byte: 207 ms (4.7% of total LCP time)
<span class="hljs-bullet">-</span> Resource load delay: 250 ms (5.7% of total LCP time)
<span class="hljs-bullet">-</span> Resource load duration: 0.2 ms (0.0% of total LCP time)
<span class="hljs-bullet">-</span> Element render delay: 3,955 ms (89.6% of total LCP time)

<span class="hljs-section">## Estimated savings: none</span>

<span class="hljs-section">## External resources:</span>
<span class="hljs-bullet">-</span> https://web.dev/articles/lcp
<span class="hljs-bullet">-</span> https://web.dev/articles/optimize-lcp
</code></pre>
<p>值得注意的是，上面的模板内容其实都不在 MCP 代码里，而是直接复用的 devtools 里的代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c28f8760a6450498981967e4121ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=QWETjrsQ2o95RcrEqwxpzfuj4%2Fs%3D" alt="" loading="lazy"/></p>
<p>综上所述，MCP 做性能测试时的流程如下：</p>
<ul>
<li>先全量获取一份 trace 数据</li>
<li>然后通过全量的 trace 数据给一份 Summary 内容</li>
<li>如果想看具体的性能指标（比如说 LCP），可以直接指定相关指标拿到一份相关模板数据</li>
</ul>
<br/>
<p>从我个人角度看，chrome-devtools-mcp 的性能测试其实就是<strong>预制菜</strong>。目前它的能力上限就是 Lighthouse。</p>
<p>因为我做过较长时间的性能优化，所以对 devtool 这套 perfs 的使用还是比较有心得的。MCP 提供的这些性能优化，其实都是复用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev" target="_blank" title="https://web.dev" ref="nofollow noopener noreferrer">web.dev</a> 中的性能优化建议（这也是 Google 官方的好处，可以复用相同的资产），如果开发中接入 MCP，可能会修复解决一些初级的性能优化问题。</p>
<p>如果想解决一些非常复杂的性能问题，目前 MCP 提供的能力还是远远不够的，可以这样理解，一个 100MB 的 trace 数据，现在的 MCP 只提供了几个切面（Summary/LCP/FCP 等），从几个切面是无法获取全局理解的。</p>
<h3 data-id="heading-6">Network</h3>
<p>提供了两个 API，<code>list_network_requests</code>，列出网络请求列表，还有一个 <code>get_network_request</code> 查看具体请求的细节信息。</p>
<p>其实 network 能力核心就 1 行代码，pptr page 监听并收集所有的网络数据：</p>
<pre><code class="hljs language-javascript" lang="javascript">page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'request'</span>, <span class="hljs-function"><span class="hljs-params">request</span> =&gt;</span> <span class="hljs-title function_">collect</span>(request));
</code></pre>
<p>拿到所有的网络数据了，那么 全量/筛选/细节 其实都能拿到，然后做格式化即可。</p>
<br/>
<p>下面是百度首页的全量 network response summary 信息：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># list<span class="hljs-emphasis">_network_</span>requests response</span>
<span class="hljs-section">## Network requests</span>
Showing 1-63 of 63 (Page 1 of 1).
https://news.baidu.com/ GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/resource/js/usermonitor_</span>88a158c.js?v=1.2 GET [failed - 304]
https://gss0.bdstatic.com/5foIcy0a2gI2n2jgoY3K/static/fisp<span class="hljs-emphasis">_static/wza/aria.js?appid=c890648bf4dd00d05eb9751dd0548c30 GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/js/jquery-1.8.3.min<span class="hljs-emphasis">_a6ffa58.js GET [failed - 304]
https://efe-h2.cdn.bcebos.com/cliresource/ubc-report-sdk/2.0.8/ubc-web-sdk.umd.min.js GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/module<span class="hljs-emphasis">_static_</span>include/module<span class="hljs-emphasis">_static_</span>include<span class="hljs-emphasis">_326f211.css GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/focustop/focustop<span class="hljs-emphasis">_2701266.css GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/img/sidebar/newErweima<span class="hljs-emphasis">_9fa03e0.png GET [failed - 304]
https://news-bos.cdn.bcebos.com/mvideo/log-news.png GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/img/footer/newErweima<span class="hljs-emphasis">_9fa03e0.png GET [failed - 304]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/lib/mod<span class="hljs-emphasis">_b818356.js GET [failed - 304]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/focustop/focustop<span class="hljs-emphasis">_b924ecb.js GET [success - 200]
</span></code></pre>
<p>下面是某个 HTTP 请求的 request/response 细节：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># get<span class="hljs-emphasis">_network_</span>request response</span>
<span class="hljs-section">## Request https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/news/js/jquery-1.8.3.min_</span>a6ffa58.js</span>
Status:  [failed - 304]
<span class="hljs-section">### Request Headers</span>
<span class="hljs-bullet">-</span> sec-ch-ua-platform:\"macOS\"
<span class="hljs-bullet">-</span> if-none-match:\"a6ffa586a4bd1dc6ac369de9a08c18ef\"
<span class="hljs-bullet">-</span> referer:https://news.baidu.com/
<span class="hljs-bullet">-</span> user-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10<span class="hljs-emphasis">_15_</span>7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
<span class="hljs-bullet">-</span> sec-ch-ua:\"Google Chrome\";v=\"141\", \"Not?A<span class="hljs-emphasis">_Brand\";v=\"8\", \"Chromium\";v=\"141\"
- if-modified-since:Wed, 12 Mar 2025 06:44:26 GMT
- sec-ch-ua-mobile:?0
### Response Headers
- accept-ranges:bytes
- access-control-allow-origin:*
- age:165476
- connection:keep-alive
- content-md5:pv+lhqS9HcasNp3poIwY7w==
- content-type:text/javascript; charset=utf-8
- date:Tue, 14 Oct 2025 07:52:52 GMT
- etag:\"a6ffa586a4bd1dc6ac369de9a08c18ef\"
- expires:Wed, 15 Oct 2025 09:54:56 GMT
- last-modified:Wed, 12 Mar 2025 06:44:26 GMT
- ohc-cache-hit:wzix57 [2]
- ohc-cos.ap-shanghai-size:93010
- ohc-global-saved-time:Sun, 12 Oct 2025 09:54:56 GMT
- server:JSP3/2.0.14
- x-cache-status:HIT
- x-bce-content-crc32:2237621194
- x-bce-debug-id:Rm9nn/ehbuTaGCz6KrvSy6cqmggWUatfykgluv61oqpFxkZl6/I9a7WaPOkKP9v5zCrujYrhMbyf9b2K0sYiUA==
- x-bce-flow-control-type:-1
- x-bce-is-transition:false
- x-bce-request-id:bf31960c-378d-46b8-a13d-95dbbb3741fa
- x-bce-storage-class:STANDARD
### Response Body
!function(e,t){function n(e){var t...
</span></code></pre>
<p>从上面两段 response 可以看出，这部分数据不复杂，也没有做更多的预制处理。基本就是把所有网络请求列出来，把 HTTP 的 Header/Body 打印出来。</p>
<h3 data-id="heading-7">Debugging</h3>
<p>Debugging 的内容比较杂，可以分类说一下。</p>
<h4 data-id="heading-8">evaluate_script</h4>
<p>首先是 <code>evaluate_script</code> 这个 tool，就是向 page 里注入一段 JS 代码做执行，然后拿到结果。</p>
<h4 data-id="heading-9">list_console_messages</h4>
<p>另一个是 <code>list_console_messages</code>，核心两行代码，监听页面的 console 和 error 事件，然后全部收集起来：</p>
<pre><code class="hljs language-javascript" lang="javascript">page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'console'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> <span class="hljs-title function_">collect</span>(event));
page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pageerror'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> <span class="hljs-title function_">collect</span>(event));
</code></pre>
<p>比如说这里我收集到的百度首页信息，从 devtools 控制台和 MCP 的 response 对比，可见内容是一致的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7444f2befd24453aa6337bff2667912d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=5DeL23EDU2DwzK%2B3OCMN3vwmup4%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># list<span class="hljs-emphasis">_console_</span>messages response</span>
<span class="hljs-section">## Console messages</span>
A parser-blocking, cross site (i.e. different eTLD+1) script, https://news-bos.cdn.bcebos.com/mvideo/pcconf<span class="hljs-emphasis">_2019.js?1760428369873, is invoked via document.write. The network request for this script MAY be blocked by the browser in this or a future page load due to poor network connectivity. If blocked in this page load, it will be confirmed in a subsequent console message. See https://www.chromestatus.com/feature/5718547946799104 for more details.
A parser-blocking, cross site (i.e. different eTLD+1) script, https://news-bos.cdn.bcebos.com/mvideo/pcconf_</span>2019.js?1760428369873, is invoked via document.write. The network request for this script MAY be blocked by the browser in this or a future page load due to poor network connectivity. If blocked in this page load, it will be confirmed in a subsequent console message. See https://www.chromestatus.com/feature/5718547946799104 for more details.
Error&gt; Failed to load resource: the server responded with a status of 500 (Internal Server Error)
b.jpg?cmd=1&amp;class=technnews&amp;cy=0&amp;0.4963333576628812:undefined:undefined
Error&gt; Failed to load resource: the server responded with a status of 500 (Internal Server Error)
&amp;refer<span class="hljs-emphasis">_hostname=news.baidu.com&amp;byInputUrl=1&amp;ra=3078942552352606:undefined:undefined
</span></code></pre>
<h4 data-id="heading-10">take_screenshot</h4>
<p>就是对当前页面或某个 DOM 做截图。直接套用 pptr 的 API，没什么特别的。</p>
<h2 data-id="heading-11">总结</h2>
<p>从「<strong>基础能力</strong>」的角度看，如果只是想用 chrome-devtools-mcp 去控制浏览器做一些自动化操作，它其实还是非常基础的，很多能力都是属于入门级别，只能说能用，和其他的 Browser MCP 相比谈不上有什么优势（优势可能是 Google 官方出品？）。但是这些能力如果只是为了方便开发者调试网页，可能也够用了。</p>
<p>从「<strong>调试能力</strong>」的角度看，chrome-devtools-mcp 可以复用 ChromeDevTools 团队的一些工作，在调试能力上可以保证长期维护的稳定性。但目前看调试能力提供的还是<strong>比较少的</strong>：</p>
<ul>
<li>可以感知到 console 控制台的一些  warning/error log，然后反向去优化修改代码</li>
<li>可以感知一些 network 信息，可以做一些网络问题的分析</li>
<li>可以做一些基础的性能优化，目前看分析的上限就是 Lighthouse。但性能优化本身是一个很复杂的事情，目前的形态可能帮助不大</li>
</ul>
<p>其余的基础调试能力其实都没有涉及，比如说 Element 调试，分析一下各种奇形怪状的 CSS，这个还是做不到的，即使是借助 screenshot，也拿不到真正的细节只能纯瞎蒙。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f214e960c265456d8d2a136d25ce3c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=wx%2FIOyj7sylDNzh9W8OLFi9EoGs%3D" alt="" loading="lazy"/></p>
<p>更高级的调试能力（比如说 Animations，Rendering 等能力）预期后续也很难加入，因为基础能力还没有打磨好，还需要大量的时间去完善和优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent 入门科普：从"人工智障"到"数字打工人"的进化史]]></title>    <link>https://juejin.cn/post/7581698074361905161</link>    <guid>https://juejin.cn/post/7581698074361905161</guid>    <pubDate>2025-12-09T15:28:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074361905161" data-draft-id="7581691182003650570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent 入门科普：从&quot;人工智障&quot;到&quot;数字打工人&quot;的进化史"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T15:28:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限大6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent 入门科普：从"人工智障"到"数字打工人"的进化史
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限大6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:28:30.000Z" title="Tue Dec 09 2025 15:28:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🤖 Agent 入门科普：从"人工智障"到"数字打工人"的进化史</h2>
<blockquote>
<p>大家好，欢迎来到无限大的博客，这个专栏是新开的，打算讲一讲Agent，其实早就有学习的打算了</p>
<p>近期在逛<strong>github</strong>的时候看到一个高star项目，叫做<strong>Hello-Agents</strong>，项目地址是[<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatawhalechina%2Fhello-agents" target="_blank" title="https://github.com/datawhalechina/hello-agents" ref="nofollow noopener noreferrer">github.com/datawhalech…</a>]
我的文章也是参考了这个内容写的，这个系列更新比较慢，因为我也是边学边写的，所以会比较慢，但是我会尽量写的详细一些，用更多贴近生活的抽象案例来讲解，希望能帮助到大家</p>
</blockquote>
<h3 data-id="heading-1">引言：当 AI 开始自己"打工"了</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3b157dde39547e18de24c6edf2fcf25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=rGIKFoqmUWCX3PoyqGx4vvcMHaU%3D" alt="6c10b139f9c135dd75cbc5dd7a0493f0.png" loading="lazy"/>
<em>2025年的AI打工人：不仅会干活，还会主动加班（老板狂喜）</em></p>
<p>2025 年的某个清晨，你被手机震醒——不是闹钟，而是你的 AI 助手发来的消息："主人，我已经帮你完成了本周工作报告的初稿（分析了过去 3 个月的销售数据 📊），订好了下周去上海的高铁票 🚄，还顺便帮你给女朋友挑了周年礼物 🎁（根据你们的聊天记录分析她最近喜欢的香水品牌）。对了，我发现你的信用卡账单有点问题，已经帮你联系银行 dispute 了那笔可疑交易 💳。"</p>
<p>你是不是以为这是科幻电影的场景？醒醒！这就是 AI Agent（智能体）正在干的事儿——它们不再是被动等待指令的"人工智障"，而是能主动规划、自己找活儿干的"数字打工人"👷‍♂️。</p>
<p>今天这篇文章，咱们就来聊聊：到底什么是 Agent？它和我们天天聊天的 ChatGPT 有啥不一样？为什么说它可能是未来十年最值得关注的 AI 技术？</p>
<h3 data-id="heading-2">什么是 Agent：会"自己拿主意"的 AI</h3>
<h4 data-id="heading-3">Agent 的官方定义：四要素缺一不可</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/998e1e62cc1f406cb4e017bb6296efac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=E7KfEJOCr17l8njwliH29FjphB0%3D" alt="d3d19d47228b1e6334f3e8f3b770ec51.png" loading="lazy"/>
<em>Agent的四大法宝：少一个都成不了"卷王"</em></p>
<p>用最人话的解释：<strong>Agent 就是能在环境中自主行动的 AI 系统</strong> 。就像《西游记》里的孙悟空 🐒——有火眼金睛（感知环境）、有金箍棒（工具）、有七十二变（行动能力）、还有自己的小算盘（目标和规划）。</p>
<p>学术一点说，Agent 必须具备四个核心要素（敲黑板！考试要考的 📝）：</p>



































<table><thead><tr><th>要素</th><th>解释</th><th>人类对应</th><th>生活例子</th></tr></thead><tbody><tr><td>🧠<strong>感知（Sensors）</strong></td><td>接收环境信息的能力</td><td>眼睛、耳朵、皮肤</td><td>你刷抖音时，手机摄像头感知你的表情变化</td></tr><tr><td>🌍<strong>环境（Environment）</strong></td><td>Agent 所处的"世界"</td><td>现实物理世界</td><td>智能家居系统的环境就是你的房子</td></tr><tr><td>🎯<strong>自主决策（Autonomy）</strong></td><td>不需要人类干预做决定</td><td>大脑思考</td><td>导航软件自动帮你避开拥堵路段</td></tr><tr><td>🦾<strong>行动（Actuators）</strong></td><td>影响环境的能力</td><td>手、脚、嘴巴</td><td>智能音箱帮你开关灯、定闹钟</td></tr></tbody></table>
<h4 data-id="heading-4">Agent 的三种"性格"：从"愣头青"到"老司机"</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ea1e9cb32044ebe8d2eb7f77862005c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=DPb9PjZQxPHaptyBaY%2FDBi9qgV0%3D" alt="c3baf6a25320b011ae4f14a863932e42.png" loading="lazy"/></p>
<p><em>三兄弟各有所长：橙的爱决策，蓝的会执行，紫的专捣乱（不是）</em></p>
<p>就像人有不同性格，Agent 也分三种类型，智商和能力天差地别：</p>
<h5 data-id="heading-5">1. 反应式 Agent：只会"条件反射"的愣头青 🤯</h5>
<p>这是最原始的 Agent，没脑子，只会"if...then..."。比如你家的扫地机器人 🤖，碰到障碍物就拐弯，没电了就回充——它不知道自己在扫地，只是机械执行预设规则。</p>
<p><strong>代码示例（伪代码）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">扫地机器人Agent</span>(<span class="hljs-params">传感器数据</span>):
    <span class="hljs-keyword">if</span> 前方有障碍物:
        随机左转或右转<span class="hljs-number">30</span>度
    <span class="hljs-keyword">elif</span> 电量 &lt; <span class="hljs-number">20</span>%:
        返回充电座
    <span class="hljs-keyword">else</span>:
        向前走并开启吸尘
</code></pre>
<h5 data-id="heading-6">2. 规划式 Agent：会"未雨绸缪"的聪明人 🤓</h5>
<p>这种 Agent 就高级了，它有"脑子"（内部状态），会规划未来。比如你手机里的导航 App🧭，它不仅知道现在的路况，还会预测 1 小时后的交通状况，帮你规划最优路线。</p>
<p><strong>生活案例</strong> ：当你用高德地图导航时，它会告诉你"前方 3 公里拥堵，预计延误 15 分钟，已为你重新规划路线"——这就是规划式 Agent 在工作！</p>
<h5 data-id="heading-7">3. 混合式 Agent："愣头青"和"老司机"的结合体 🚗</h5>
<p>大多数实用的 Agent 都是混合式的。平时用反应式快速处理简单任务，遇到复杂情况就启动规划模式。比如特斯拉的自动驾驶系统 🚘：</p>
<ul>
<li>反应式：突然有车加塞？立刻刹车！</li>
<li>规划式：导航去机场时，会提前规划高速入口、充电站点</li>
</ul>
<h3 data-id="heading-8">Agent vs ChatGPT：到底有啥不一样？</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50c8e03e8a524ee0bd28f4d90d7488e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=NV56xsHEsCKqrGU%2FcF3UkThQN5g%3D" alt="f31290a62ae9cb9256fa70a5577987f4.png" loading="lazy"/></p>
<p><em>左边ChatGPT：只能聊天；右边Agent：自己找工具干活的卷王本王</em></p>
<h4 data-id="heading-9">灵魂拷问：ChatGPT 是 Agent 吗？</h4>
<p>先给结论： <strong>不是！但它可以成为 Agent 的"大脑"</strong> 🧠。</p>
<p>很多人以为 ChatGPT 就是 Agent，这其实是个天大的误会！它们的区别，就像"计算器"和"会计"的区别——计算器很会算，但不会主动帮你报税；会计会用计算器，但更会帮你规划财务、处理复杂事务。</p>
<h4 data-id="heading-10">一张表看懂核心区别</h4>









































<table><thead><tr><th>对比维度</th><th>🤖 ChatGPT（大语言模型）</th><th>🦾 AI Agent（智能体）</th><th>形象比喻</th></tr></thead><tbody><tr><td><strong>工作模式</strong></td><td>被动等待指令，"问一句答一句"</td><td>主动找事做，"自己定 KPI"</td><td>客服 vs 项目经理</td></tr><tr><td><strong>记忆能力</strong></td><td>上下文窗口有限（比如只能记 4096 个词）</td><td>长期记忆，可存储和调用历史数据</td><td>鱼的 7 秒记忆 vs 人的日记本</td></tr><tr><td><strong>工具使用</strong></td><td>原生不支持（需要插件扩展）</td><td>天生会用工具（API 调用是基本功）</td><td>只会口算 vs 会用计算器+Excel</td></tr><tr><td><strong>目标导向</strong></td><td>没有内在目标，完成当前对话即可</td><td>有明确目标，会拆解任务并执行</td><td>外卖员 vs 创业老板</td></tr><tr><td><strong>环境交互</strong></td><td>只能通过文本交互</td><td>可接入各种传感器（摄像头、麦克风等）</td><td>盲人摸象 vs 正常人看世界</td></tr></tbody></table>
<h4 data-id="heading-11">举个栗子 🌰：订机票的区别</h4>
<p><strong>用 ChatGPT 订机票</strong> ：</p>
<ul>
<li>你："帮我查明天北京到上海的机票"</li>
<li>GPT："明天有以下航班：CA185（08:30 起飞）..."</li>
<li>你："选 CA185，经济舱"</li>
<li>GPT："已帮你生成订票链接..."</li>
<li>（全程需要你一步步指挥）</li>
</ul>
<p><strong>用 Agent 订机票</strong> ：</p>
<ul>
<li>你："我明天要去上海开会，帮我安排行程"</li>
<li>Agent："好的，已查询到明天会议时间是 14:00。为你选择了 CA185（08:30 起飞），理由：① 准点率 92% ② 价格比其他航班低 15% ③ 到达后有 2 小时缓冲时间。已帮你完成订票，座位选了靠窗的（根据你的历史偏好），还预约了接机服务。需要我同步发送行程给会议组织者吗？"</li>
<li>（全程无需你操心，它自己就把所有事办了）</li>
</ul>
<h3 data-id="heading-12">Agent 的核心模块：数字打工人的"五脏六腑"</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2175948e5ef4c66a39a8e57518a1ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=TpQdWtSBqCes1S4olrAG%2FEPnDK8%3D" alt="482a718273a4baca012bf28c5e57ba4f.png" loading="lazy"/>
<em>拆开看看Agent的五脏六腑</em></p>
<p>如果把 Agent 比作一个人，那它的"身体构造"是这样的：</p>
<h4 data-id="heading-13">1. 感知模块：Agent 的"五官" 👀👂👃👅👆</h4>
<p>负责接收外界信息，相当于人的眼耳口鼻。比如：</p>
<ul>
<li>智能家居 Agent 通过温湿度传感器感知环境 🌡️</li>
<li>自动驾驶 Agent 通过摄像头和雷达感知路况 🚗</li>
<li>手机助手通过麦克风接收语音指令 🎤</li>
</ul>
<p><strong>代码示例（简单感知模块）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">感知模块</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.摄像头 = 摄像头API()
        self.麦克风 = 麦克风API()
        self.温度传感器 = 温度传感器API()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">获取环境数据</span>(<span class="hljs-params">self</span>):
        图像 = self.摄像头.拍照()
        声音 = self.麦克风.录音(<span class="hljs-number">5</span>秒)
        温度 = self.温度传感器.读取()
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"图像"</span>: 图像,
            <span class="hljs-string">"声音"</span>: 声音,
            <span class="hljs-string">"温度"</span>: 温度
        }
</code></pre>
<h4 data-id="heading-14">2. 记忆模块：Agent 的"大脑硬盘" 💾</h4>
<p>负责存储信息，分两种：</p>
<p><strong>*短期记忆</strong> ：处理当前任务的临时数据（比如你正在和它说的话）</p>
<ul>
<li><strong>长期记忆</strong> ：历史经验、规则库、用户偏好（比如你喜欢喝奶茶不加糖）</li>
</ul>
<p>最酷的是，有些 Agent 还会"反思学习"——就像你写日记总结经验一样，它会分析自己哪里做得好、哪里做得不好，然后改进。</p>
<h4 data-id="heading-15">3. 规划模块：Agent 的"军师" 🧠</h4>
<p>这是 Agent 的核心竞争力！会把大目标拆解成小任务，还会制定详细计划。比如你让 Agent"帮我准备周末野餐"，它会：</p>
<ol>
<li>目标拆解：确定时间 → 选地点 → 列清单 → 采购 → 准备工具</li>
<li>资源规划：查天气预报（如果下雨就改期）→ 查公园开放时间</li>
<li>风险控制：准备备用方案（比如带雨伞、急救包）</li>
</ol>
<h4 data-id="heading-16">4. 工具调用模块：Agent 的"瑞士军刀" 🔧</h4>
<p>Agent 之所以强大，是因为它会用各种工具。就像 007 有万能手表，Agent 有万能 API：</p>
<ul>
<li>查天气？调用天气 API ☁️</li>
<li>订酒店？调用携程 API 🏨</li>
<li>算数据？调用 Python 计算器 🧮</li>
<li>发邮件？调用 SMTP 服务 📧</li>
</ul>
<p><strong>代码示例（工具调用）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">工具调用模块</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.工具库 = {
            <span class="hljs-string">"天气查询"</span>: <span class="hljs-string">"https://api.weather.com/query"</span>,
            <span class="hljs-string">"酒店预订"</span>: <span class="hljs-string">"https://api.ctrip.com/book"</span>,
            <span class="hljs-string">"计算器"</span>: <span class="hljs-string">"https://api.calculator.com/compute"</span>
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">调用工具</span>(<span class="hljs-params">self, 工具名, 参数</span>):
        <span class="hljs-keyword">if</span> 工具名 <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.工具库:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"抱歉，我还不会用这个工具"</span>
        <span class="hljs-comment"># 调用API并返回结果</span>
        <span class="hljs-keyword">return</span> requests.get(self.工具库[工具名], params=参数).json()

<span class="hljs-comment"># 使用示例</span>
agent_tools = 工具调用模块()
天气 = agent_tools.调用工具(<span class="hljs-string">"天气查询"</span>, {<span class="hljs-string">"城市"</span>: <span class="hljs-string">"北京"</span>, <span class="hljs-string">"日期"</span>: <span class="hljs-string">"2025-12-10"</span>})
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"明天天气：<span class="hljs-subst">{天气[<span class="hljs-string">'温度'</span>]}</span>℃，<span class="hljs-subst">{天气[<span class="hljs-string">'状况'</span>]}</span>"</span>)
</code></pre>
<h3 data-id="heading-17">Agent 的应用场景：已经在悄悄改变世界</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70eeb15b9de2471d8dba503ff4bdbff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=HooQ79XhSD1kgceeeOmFecnoMVE%3D" alt="25d2b1e16535cd4f2b1dc5885e657d48.png" loading="lazy"/></p>
<p><em>上班摸鱼带娃炒股全在行，就是不会帮你背锅——毕竟电子打工人也怕失业</em></p>
<p>Agent 不是实验室里的概念，它已经在很多领域"打工"了：</p>
<h4 data-id="heading-18">1. 个人助理：你的"24 小时秘书" 🕵️‍♀️</h4>
<p><strong>*Microsoft Copilot+</strong> ：能帮你管理日程、回复邮件、甚至写代码时主动提示错误</p>
<ul>
<li><strong>Anthropic Claude 3</strong> ：可以分析你的文档，自动生成摘要和待办事项</li>
<li><strong>国内选手</strong> ：字节跳动"豆包 Agent"、阿里"通义千问 Agent"</li>
</ul>
<h4 data-id="heading-19">2. 企业应用：降本增效的"超级员工" 🏢</h4>
<ul>
<li><strong>客服 Agent</strong> ：不仅能回答问题，还能主动发现客户潜在需求（比如"您最近经常查询退货政策，是对产品有什么不满意吗？"）</li>
<li><strong>数据分析 Agent</strong> ：自动从数据库抓取数据、生成报表、发现异常（比如"本月西南地区销售额下降 15%，已帮您定位到 3 个重点问题..."）</li>
<li><strong>供应链 Agent</strong> ：预测库存需求，自动下单补货，甚至和供应商谈判价格</li>
</ul>
<h4 data-id="heading-20">3. 未来畅想：Agent 生态系统 🌐</h4>
<p>想象一下未来：你的个人 Agent 可以和医生 Agent、律师 Agent、老师 Agent"开会"，帮你解决复杂问题。就像现在的 App Store，未来可能会有"Agent Store"——你需要什么功能，下载一个 Agent 就行！</p>
<h3 data-id="heading-21">结语：为什么 Agent 值得你关注？</h3>
<p>看到这里，你可能会说："Agent 这么厉害，会抢我的工作吗？" 😱</p>
<p>我的回答是： <strong>会，但更会创造新工作</strong> 。就像计算机淘汰了打字员，却创造了程序员、产品经理等新职业。未来最吃香的，可能是那些会"管理 Agent 团队"的人 👩‍💼👨‍💼。</p>
<p>记住这个公式： <strong>Agent = 大语言模型（ChatGPT 等） + 记忆 + 规划 + 工具</strong> 。它不是凭空出现的新技术，而是 AI 技术发展到一定阶段的必然产物——就像手机从功能机进化到智能机，AI 正在从"被动工具"进化到"主动助手"。</p>
<blockquote>
<p>如果你觉得这篇文章有用，欢迎点赞 👍 收藏 🌟，关注我的 Agent 系列博客——下一篇我们聊聊： <strong>如何自己动手做一个简单的 Agent</strong> （不需要编程大神，普通人也能学会！）。</p>
<p>最后留个思考题：如果你能拥有一个 Agent，你最想让它帮你做什么？评论区告诉我！👇</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉]]></title>    <link>https://juejin.cn/post/7581693431740252223</link>    <guid>https://juejin.cn/post/7581693431740252223</guid>    <pubDate>2025-12-09T15:48:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740252223" data-draft-id="7581678032336846890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-12-09T15:48:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:48:17.000Z" title="Tue Dec 09 2025 15:48:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">💥告别卡顿！前端性能优化第一课：Google钦点的三大核心指标，你真的懂吗？</h2>
<blockquote>
<p>欢迎来到前端性能优化专栏的第一课！在这个“用户体验至上”的时代，一个卡顿、缓慢、乱跳的网站，就像一辆抛锚在高速公路上的跑车，再酷炫也只会让人抓狂。别担心，Google已经为你准备好了一份“体检报告”——<strong>核心Web指标（Core Web Vitals）</strong> 。</p>
</blockquote>
<p>今天，我们就来揭开这份报告的神秘面纱，用最通俗易懂的方式，让你彻底搞懂这三大指标，迈出性能优化的第一步！</p>
<h3 data-id="heading-1">✨ LCP（Largest Contentful Paint）：最大内容绘制</h3>
<h4 data-id="heading-2">🚀 衡量：加载性能（你的“第一印象”）</h4>
<p>LCP，直译过来是<strong>最大内容绘制</strong>。它衡量的是用户在访问页面时，<strong>视口中最大的那块可见内容（图片或文本块）完成渲染所需的时间</strong>。</p>
<p>简单来说，它回答了一个核心问题：<strong>用户觉得你的页面“加载完成”了吗？</strong></p>
<p>想象一下，你打开一个电商网站，最想看到的是商品大图和价格。LCP就是衡量这个“最重要的东西”多久能出现在你面前。它直接反映了用户对页面加载速度的感知。</p>















<table><thead><tr><th>指标</th><th>衡量维度</th><th>优秀标准</th></tr></thead><tbody><tr><td><strong>LCP</strong></td><td>用户感知的加载速度</td><td><strong>&lt;= 2.5秒</strong></td></tr></tbody></table>
<p>如果你的 LCP 超过 2.5 秒，用户可能就开始感到不耐烦了。优化 LCP，就是让你的“门面”以最快的速度展示给客人！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1672e56406bc47e0aac380547f1f2c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765900097&amp;x-signature=CVcbklCH6NcDWqIjSLFshD4BVxQ%3D" alt="LCP 示意图" loading="lazy"/></p>
<h3 data-id="heading-3">⚠️ CLS（Cumulative Layout Shift）：累积布局偏移</h3>
<h4 data-id="heading-4">🛡️ 衡量：视觉稳定性（告别“鬼畜”跳动）</h4>
<p>CLS，<strong>累积布局偏移</strong>，听起来有点拗口，但它的作用非常直观：<strong>它衡量页面加载过程中元素的非预期移动</strong>。</p>
<p>你一定遇到过这种情况：正准备点击一个按钮，结果它上面的广告突然加载出来，把按钮挤下去了，你点了个空！这就是布局偏移（Layout Shift）。</p>
<p>CLS 的分数就是用来量化这种“鬼畜”跳动有多严重的。分数越低，代表你的页面布局越稳定，用户体验越丝滑。</p>















<table><thead><tr><th>指标</th><th>衡量维度</th><th>理想值</th></tr></thead><tbody><tr><td><strong>CLS</strong></td><td>页面布局稳定性</td><td><strong>&lt; 0.1</strong></td></tr></tbody></table>
<p><strong>小贴士：</strong> 布局偏移通常是由没有设置尺寸的图片、动态插入的广告或内容导致的。想要 CLS 达标，请给你的元素预留好“坑位”！</p>
<h3 data-id="heading-5">⚡️ INP（Interaction to Next Paint）：交互到下次绘制</h3>
<h4 data-id="heading-6">🔄 衡量：整体交互响应性（从“第一印象”到“全程流畅”）</h4>
<p>INP，<strong>交互到下次绘制</strong>，是性能指标家族的新晋“网红”。它衡量的是用户进行<strong>点击、触摸或键盘输入</strong>后，浏览器需要多长时间才能在屏幕上绘制出视觉反馈。</p>
<p>它取代了老前辈 <strong>FID（First Input Delay，首次输入延迟）</strong> ，为什么呢？</p>





















<table><thead><tr><th>为什么用 INP 替代 FID？</th><th>INP 的优势</th></tr></thead><tbody><tr><td><strong>FID 的局限性</strong></td><td>仅测量<strong>首次</strong>输入延迟，忽略了用户在后续操作中遇到的卡顿。</td></tr><tr><td><strong>INP 的全面性</strong></td><td>监控用户<strong>整个访问周期</strong>内的所有交互，更全面。</td></tr><tr><td><strong>更真实的用户体验</strong></td><td>INP 选取<strong>最慢的一次交互</strong>作为代表值，反映了“整个使用过程中”的流畅度，而不是仅仅看“第一印象”。</td></tr></tbody></table>
<p>简单来说，FID 就像面试官只看你的简历，而 INP 则是全程跟拍你的工作表现。一个真正流畅的网站，不应该只是第一次点击快，而是从头到尾都快！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4192b9eb4e4f48b18d13c2a2e6f47295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765900097&amp;x-signature=SB%2Bwny7ENj6Rwl1AohjgzDUAg7w%3D" alt="INP 与 FID 比较图" loading="lazy"/></p>
<h3 data-id="heading-7">🔬 实验室数据 vs. 🌍 现场数据：性能优化的“双重奏”</h3>
<p>搞懂了三大指标，接下来我们聊聊如何获取这些数据。性能数据主要分为两大类：<strong>实验室数据</strong>和<strong>现场数据</strong>。</p>























<table><thead><tr><th>类型</th><th>来源（数据渠道）</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>实验室数据 (Lab Data)</strong></td><td>Lighthouse</td><td>可控、快速、方便复现问题</td><td>非真实用户环境，可能与实际体验有偏差</td></tr><tr><td><strong>现场数据 (Field Data)</strong></td><td>CrUX/Web Vitals</td><td>真实用户体验，数据最可靠</td><td>不易复现问题，需要时间积累数据</td></tr></tbody></table>
<h4 data-id="heading-8">🔧 实验室数据工具</h4>
<p>实验室数据就像你在实验室里用精密仪器做的测试，环境是固定的。</p>
<ul>
<li><strong>Lighthouse (Chrome 内置)</strong> ：Chrome 开发者工具里就能找到，它能快速给你打分，支持 LCP/CLS/INP 评分。</li>
<li><strong>PageSpeed Insights</strong>：Google 官方工具，它会结合<strong>实验室数据</strong>（Lighthouse）和<strong>现场数据</strong>（CrUX），给你一份一站式的性能报告。</li>
</ul>
<h4 data-id="heading-9">🛠️ 现场数据工具</h4>
<p>现场数据则是你的网站在真实用户、真实网络、真实设备上跑出来的“实战成绩”。</p>
<ul>
<li><strong>Google Search Console</strong>：提供网站整体的核心指标健康报告，是 SEO 优化的重要参考。</li>
<li><strong>web-vitals JavaScript 库</strong>：这是前端工程师的“秘密武器”。它是一个轻量级的库，可以让你在用户浏览器中实时收集 LCP、CLS、INP 数据，并上报到你的分析后台。</li>
</ul>
<h4 data-id="heading-10">💡 使用 <code>web-vitals</code> 收集性能数据（实战代码）</h4>
<p>通过这个库，你可以将真实用户的性能数据发送到你的服务器进行分析，建立自己的性能监测体系（RUM，Real User Monitoring）。</p>
<pre><code class="hljs language-scss" lang="scss">import { onLCP, onCLS, onINP } from 'web-vitals'
​
function <span class="hljs-built_in">sendToAnalytics</span>(metric) {
  <span class="hljs-comment">// 将性能指标数据转换为 JSON 字符串</span>
  const <span class="hljs-selector-tag">body</span> = JSON<span class="hljs-selector-class">.stringify</span>(metric)
  
  <span class="hljs-comment">// 使用 navigator.sendBeacon 或 fetch 发送数据，确保在页面关闭前发送成功</span>
  ;(navigator.sendBeacon &amp;&amp; navigator.sendBeacon('/analytics', body)) ||
    <span class="hljs-built_in">fetch</span>('/analytics', { body, method: 'POST', keepalive: true })
}
​
<span class="hljs-comment">// 监听并上报三大核心指标</span>
<span class="hljs-built_in">onLCP</span>(sendToAnalytics)
<span class="hljs-built_in">onCLS</span>(sendToAnalytics)
<span class="hljs-built_in">onINP</span>(sendToAnalytics)
</code></pre>
<h3 data-id="heading-11">✅ 总结：性能优化的“三字真经”</h3>
<p>好了，总结一下我们今天学到的前端性能优化的“三字真经”：</p>
<ol>
<li><strong>LCP：核心内容尽快可见</strong>（加载速度要快！）</li>
<li><strong>CLS：页面布局稳定</strong>（别再乱跳了！）</li>
<li><strong>INP：交互响应及时</strong>（操作要流畅！）</li>
</ol>
<p>通过 <strong>Lighthouse</strong>、<strong>Search Console</strong> 以及 <strong>Web Vitals</strong> 库，我们不仅能建立起一套完善的性能监测体系，还能精准地识别并修复那些让用户抓狂的体验瓶颈。</p>
<p>提升网页质量，不仅能让用户开心，还能让你的网站在 Google 搜索中获得更好的排名。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Firebase CLI 一直关联失败]]></title>    <link>https://juejin.cn/post/7581666412021874697</link>    <guid>https://juejin.cn/post/7581666412021874697</guid>    <pubDate>2025-12-09T14:06:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666412021874697" data-draft-id="7581666412021858313" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Firebase CLI 一直关联失败"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T14:06:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="J船长"/> <meta itemprop="url" content="https://juejin.cn/user/1820446987136903"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Firebase CLI 一直关联失败
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446987136903/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    J船长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:06:03.000Z" title="Tue Dec 09 2025 14:06:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>比如执行`firebase login``然后跳转浏览器，进行关联</p>
<h2 data-id="heading-0">解决办法：</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> https_proxy=http:<span class="hljs-comment">//127.0.0.1:xxxx</span>
<span class="hljs-keyword">export</span> http_proxy=http:<span class="hljs-comment">//127.0.0.1:xxxx</span>
<span class="hljs-keyword">export</span> all_proxy=socks5:<span class="hljs-comment">//127.0.0.1:xxxx</span>
firebase login
</code></pre>
<hr/>
<h2 data-id="heading-1">原因:</h2>
<p>macOS 上开 V 只是让浏览器等应用走代理，但终端默认不走代理。终端里的命令（如 firebase）需要手动设置 http_proxy 和 https_proxy 环境变量才能走代理访问 Google 服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么在 Agent 时代，我选择了 Bun？]]></title>    <link>https://juejin.cn/post/7581678301216964608</link>    <guid>https://juejin.cn/post/7581678301216964608</guid>    <pubDate>2025-12-09T14:04:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581678301216964608" data-draft-id="7581664445241606159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么在 Agent 时代，我选择了 Bun？"/> <meta itemprop="keywords" content="JavaScript,Bun,Agent"/> <meta itemprop="datePublished" content="2025-12-09T14:04:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mCell"/> <meta itemprop="url" content="https://juejin.cn/user/2280829967146779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么在 Agent 时代，我选择了 Bun？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2280829967146779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mCell
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:04:58.000Z" title="Tue Dec 09 2025 14:04:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>同步至个人站点：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Ftopics%2Fbun%2F01_start" target="_blank" title="https://stack.mcell.top/topics/bun/01_start" ref="nofollow noopener noreferrer">为什么在 Agent 时代，我选择了 Bun？ - Bun 指南</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3cd035dbd624c1fbaae35c03f9cd479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=ccCGXokJPpTUBsibIK%2FRWU3KAgI%3D" alt="076.webp" loading="lazy"/></p>
<h2 data-id="heading-0">一切都从那条「收购 Bun」的新闻开始</h2>
<p>上周三，看到 Anthropic 的一则新闻：他们宣布收购 Bun，并在文中明确写到——对 Claude Code 的用户来说，这次收购意味着<strong>更快的性能、更高的稳定性以及全新的能力</strong>。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fanthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" title="https://www.anthropic.com/news/anthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" target="_blank" ref="nofollow noopener noreferrer">Anthropic</a>)</p>
<p>简单翻译一下就是：</p>
<blockquote>
<p>我们要把整个编码 Agent 的基础设施，换成一个更快、更顺手的 JS/TS 运行时。</p>
</blockquote>
<p>这条新闻对我触动很大，至少暴露出两个事实：</p>
<ol>
<li>
<p><strong>Agent 时代的基础设施在变化</strong>
以前我们写 CLI、写后端，Node 足够用了；但到了 Agent 这种「到处起小进程、到处跑工具」的场景里，<strong>启动速度、冷启动性能、all-in-one 工具链</strong>，突然变得非常关键。</p>
</li>
<li>
<p><strong>Bun 不再只是一个「新玩具」</strong>
它已经成为一家头部 AI 公司的底层组件之一：Anthropic 早就在内部用 Bun 跑 Claude Code，现在索性直接收购，把它当作下一代 AI 软件工程的基础设施。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</li>
</ol>
<p>当我再去翻 Bun 的官网时，就会发现：</p>
<blockquote>
<p>这是一个集 <strong>JavaScript/TypeScript 运行时、包管理器、打包器、测试运行器</strong> 于一身的 all-in-one 工具。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</blockquote>
<p>这和我对「传统 JS 运行时」的印象已经完全不一样了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ee9e9a5a084460ea7f346a8a1127782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=zpNVA%2BQw9bpf6xk%2FCO10dMKNzS0%3D" alt="078.webp" loading="lazy"/></p>
<h2 data-id="heading-1">先说说我的技术背景：为什么要写这个专题？</h2>
<p>我平时写代码偏向两类技术栈：</p>
<ul>
<li><strong>TypeScript</strong>：前端、工具脚本、Node 小服务</li>
<li><strong>Go</strong>：服务端、一些偏底层的活</li>
</ul>
<p>很长一段时间里，我对 Node 的使用场景大概就是这几种：</p>
<ul>
<li>写个小脚本：<code>ts-node</code> / <code>tsx</code> + 一点配置，跑完就扔</li>
<li>写个中小型服务端：Express / Nest 这一类</li>
</ul>
<p>这些场景里，一个很明显的感受是：</p>
<ul>
<li>Node <strong>够成熟</strong>：生态庞大，资料多，出了问题很容易搜到坑</li>
<li>但 Node 也<strong>够「厚重」</strong>：一堆配置、各种工具组合、打包测试 lint 各种链路</li>
</ul>
<p>直到我开始认真看 Bun 的文档，第一次有一种很强烈的对比感：</p>
<blockquote>
<p>「哦，原来现在写 JS/TS 后端已经可以这么简单了？」</p>
</blockquote>
<ul>
<li>不用写 <code>tsconfig.json</code>（很多时候默认就很好用）</li>
<li>dev / build / test 基本就是一行命令：
<code>bun run</code> / <code>bun build</code> / <code>bun test</code></li>
<li>起一个 HTTP server，用的还是 JS/TS，但 API 明显更简洁，很多地方甚至不需要 Node 的那一套底层 API</li>
</ul>
<p>再加上我最近在做 Agent 相关的东西，自然就顺势产生了一个问题：</p>
<blockquote>
<p>既然我本来就想用 TS 写一个 ReAct Agent，那为什么不干脆用 Bun 来做 runtime 呢？</p>
</blockquote>
<h2 data-id="heading-2">Agent CLI 的选型：为什么会想到 Bun？</h2>
<p>在开搞之前，我特地去看了一圈现在比较热门的 Agent CLI 都是怎么选技术栈的：</p>
<ul>
<li>Google 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" target="_blank" title="https://github.com/google-gemini/gemini-cli" ref="nofollow noopener noreferrer">Gemini CLI</a>：<strong>Node</strong></li>
<li>OpenAI 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex" target="_blank" title="https://github.com/openai/codex" ref="nofollow noopener noreferrer">Codex CLI</a>：<strong>Rust</strong>写核心逻辑，UI交给<strong>Node和TypeScript</strong></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code" target="_blank" title="https://github.com/anthropics/claude-code" ref="nofollow noopener noreferrer">Claude Code CLI</a> 和基础设施：<strong>Bun</strong>(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reuters.com%2Fbusiness%2Fmedia-telecom%2Fanthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02%2F" title="https://www.reuters.com/business/media-telecom/anthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02/" target="_blank" ref="nofollow noopener noreferrer">Reuters</a>)</li>
</ul>
<p>如果你把这些信息放在一起，会大致看到一个趋势：</p>
<ul>
<li>Rust：更偏向<strong>极致性能、可控性、安全性</strong>，适合那种「我要把一套工具做到很底层、很稳」的团队。</li>
<li>Node：稳定、生态成熟，但随着项目往 AI 工程、Agent 方向发展，在<strong>冷启动、工具链整合</strong>上没有那么「顺手」。</li>
<li>Bun：尝试在 Node 的生态基础上，往前推进一步，做一个<strong>all-in-one、性能极强的 JS/TS 运行时</strong>。</li>
</ul>
<p>而我这个人，有个很明显的偏好：</p>
<blockquote>
<p>能用 TS 解决的，就先别急着上 Rust。</p>
</blockquote>
<p>所以，当我看到：</p>
<ul>
<li>Anthropic 在 Agent 业务上，押注 Bun</li>
<li>Bun 自己的定位又是：<strong>“把你写 Node 的那套事，全部做到更快、更简单”</strong>(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
</ul>
<p>那我心里那个问题就更具体了：</p>
<blockquote>
<p><strong>在「写 Agent」这个具体场景里，Bun 真的比 Node 体验更好吗？</strong></p>
</blockquote>
<p>我不太喜欢只看 benchmark，于是就决定写点实打实的东西来试试看。</p>
<h2 data-id="heading-3">一个不到百行的 ReAct Agent Demo</h2>
<p>为了验证这个问题，我给自己定了一个很小的练习目标：</p>
<blockquote>
<p>用 <strong>Bun + TypeScript</strong>，写一个「不到百行代码」的极简 ReAct Agent Demo。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b908fc9be8984806815ffdb3a53db679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=p1FDHkeA85pyGFzyX%2Bvg%2BAqK684%3D" alt="079.webp" loading="lazy"/></p>
<p>这个 Agent 不追求多复杂的功能，专注这几件事：</p>
<ol>
<li>
<p>维护一个最小可用的 <strong>ReAct loop</strong>（思考 → 行动 → 观察 → 再思考）</p>
</li>
<li>
<p>内置少量工具，比如：</p>
<ul>
<li><code>read</code>：读取文件内容</li>
<li><code>write</code>：写入/更新文件</li>
</ul>
</li>
<li>
<p>整个项目尽量清爽，不做多余封装</p>
</li>
</ol>
<p>写的过程非常「AI 化」：</p>
<ul>
<li>先用 Node 写了一版最朴素的版本</li>
<li>再让 AI 帮我<strong>改写为 Bun 的 API</strong></li>
<li>我负责补坑、重构、整理结构</li>
</ul>
<p>结果出乎意料地顺畅：</p>
<ul>
<li>很多原来需要 <code>fs</code> 模块、各种工具库的地方，在 Bun 里可以用自己的 API 写得更简洁，比如 <code>Bun.file()</code>、<code>Bun.write()</code> 这种。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
<li>dev / build / test 自己都不用纠结，直接 <code>bun xxx</code> 的那一套就行，几乎不需要额外配置。</li>
<li>Agent loop 那段代码本身是比较核心的逻辑，集中精力在这里就好了，不太需要为工程化配置分心。</li>
</ul>
<p>更关键的是：</p>
<blockquote>
<p>整个 Demo 框架搭好后，我有一种「这个东西是可以往前认真维护」的感觉，而不是写完就丢。</p>
</blockquote>
<p>这和我之前写很多 Node 小脚本的心理预期是完全不一样的。</p>
<h2 data-id="heading-4">再聊一句「全栈」：TS 之后，运行时是谁？</h2>
<p>周末刷 X，看到老许的<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fxushiwei%2Fstatus%2F1997328503985852798" target="_blank" title="https://x.com/xushiwei/status/1997328503985852798" ref="nofollow noopener noreferrer">帖子</a>，如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9769d9e9c45f48d8b4e9c60a9497b6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=PDVyJaTf04nuXCHyDoai5h4yKyQ%3D" alt="080.webp" loading="lazy"/></p>
<p>这句话我很认同。
前后端统一 TS 技术栈，对个人开发者来说太友好了：</p>
<ul>
<li>一门语言，从浏览器跑到服务端、再到 CLI、工具链</li>
<li>类型系统本身就成为你的「文档 + 校验器」</li>
</ul>
<p>那顺着这个思路，下一步的问题就自然来了：</p>
<blockquote>
<p>既然语言是 TypeScript，那<strong>运行时</strong>呢？
未来的 TS 运行时，会不会从 Node，逐渐走向 Bun（一部分场景）？</p>
</blockquote>
<p>我不打算在这里给出一个结论——毕竟 Node 的体量、生态、历史沉淀摆在那里，而 Bun 目前也还只是一个「两年多一点」的新 runtime。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
<p>但从我自己的体验看，有两点很值得关注：</p>
<ol>
<li>
<p><strong>Bun 是为「现代 JS/TS 开发」重新设计过的</strong>
它自带 bundler、test runner、包管理器，不再是「一个 runtime + 一堆第三方工具拼装」的模式。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</li>
<li>
<p><strong>Bun 和 Agent、AI 工程这类新场景的契合度异常高</strong></p>
<ul>
<li>CLI 需要冷启动快 → Bun 做得很好</li>
<li>项目喜欢 all-in-one 工具链 → Bun 直接内置</li>
<li>你本来就写 TS → Bun 对 TS 原生友好</li>
</ul>
</li>
</ol>
<p>这些特性，叠加起来就会让人产生那种感觉：</p>
<blockquote>
<p>「如果我要重写一遍现在手里这些 Node 脚本、工具、Agent，那好像真的可以考虑直接上 Bun。」</p>
</blockquote>
<h2 data-id="heading-5">这个专题想写些什么？</h2>
<p>既然已经有了实践的契机（ReAct Agent Demo），再加上我一贯「学新东西喜欢顺手写点东西」的习惯，那干脆就开一个新专题：《Bun 指南》。</p>
<p><strong>这第一篇就是引言，只回答一个问题：为什么要学 Bun？</strong></p>
<p>后面的几篇，我打算按这样的节奏展开（暂定）：</p>
<ol>
<li>
<p><strong>安装与上手：从 Node 迁移到 Bun 有多难？</strong></p>
<ul>
<li>安装 Bun</li>
<li>跑起第一个 <code>bun run</code> / <code>bun dev</code></li>
<li>把一个简单的 Node 脚本迁移到 Bun</li>
</ul>
</li>
<li>
<p><strong>Bun 的 all-in-one 工具链</strong></p>
<ul>
<li>包管理器：<code>bun install</code> vs npm/pnpm</li>
<li><code>bun test</code>：内置测试如何用</li>
<li><code>bun build</code>：打包、构建、单文件可执行</li>
</ul>
</li>
<li>
<p><strong>用 Bun 写 HTTP 服务</strong></p>
<ul>
<li><code>Bun.serve()</code> 的基本用法(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
<li>和 Node / Express 的直观对比</li>
<li>简单的 API 服务实战</li>
</ul>
</li>
<li>
<p><strong>文件、进程与工具脚本：Bun 的标准库体验</strong></p>
<ul>
<li><code>Bun.file()</code> / <code>Bun.write()</code> 等常用 API</li>
<li>用 Bun 写一个实用 CLI 小工具</li>
</ul>
</li>
<li>
<p><strong>实战篇：用 Bun + TS 写一个 ReAct Agent Demo</strong></p>
<ul>
<li>核心 loop 逻辑拆解</li>
<li>如何组织「工具」层（read / write / 调用外部接口）</li>
<li>运行、调试与「AI Coding 助攻」的一些经验</li>
</ul>
</li>
<li>
<p><strong>踩坑记录 &amp; 迁移经验</strong></p>
<ul>
<li>哪些地方真的爽了</li>
<li>哪些地方还不如 Node 成熟</li>
<li>写给准备从 Node 迁到 Bun 的你</li>
</ul>
</li>
</ol>
<p>如果你已经会写 JavaScript / Node，这个专题不会从「什么是 Promise」讲起，而会更聚焦在：</p>
<ul>
<li><strong>从 Node 迁移到 Bun 时，大脑需要切换的那一小部分东西</strong></li>
<li><strong>在 Bun 里，如何用尽量少的代码做更多事</strong></li>
<li><strong>结合 Agent / AI 工程场景，感受下一代 JS/TS runtime 的味道</strong></li>
</ul>
<h2 data-id="heading-6">写在最后</h2>
<p>我并不打算把 Bun 神化成「Node 杀手」——至少短期内，它更像是：</p>
<blockquote>
<p>一个极适合「个人开发者 / 小团队 / 新项目 / Agent 工程」尝鲜的 JS/TS 运行时。</p>
</blockquote>
<p>而这个系列，就是我在这个尝试过程中的「实践笔记」：</p>
<ul>
<li>一部分是 Bun 本身的能力整理</li>
<li>一部分是我做 ReAct Agent 的真实踩坑经验</li>
<li>还有一部分，是在这个过程中我对「全栈 / TS / runtime 演进」的一些小思考</li>
</ul>
<p>如果你：</p>
<ul>
<li>已经会 Node / TS</li>
<li>正在关注 Agent / AI 工程</li>
<li>又对「更快、更简洁的 JS/TS 运行时」有点好奇</li>
</ul>
<p>那欢迎一起把这个系列看下去，也欢迎你在实践中告诉我：
<strong>在你的场景里，Bun 到底是不是一个更好的选择？</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reuters.com%2Fbusiness%2Fmedia-telecom%2Fanthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02%2F" target="_blank" title="https://www.reuters.com/business/media-telecom/anthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02/" ref="nofollow noopener noreferrer">Reuters</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析]]></title>    <link>https://juejin.cn/post/7581666412021891081</link>    <guid>https://juejin.cn/post/7581666412021891081</guid>    <pubDate>2025-12-09T14:21:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666412021891081" data-draft-id="7531888171584897059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-09T14:21:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:21:41.000Z" title="Tue Dec 09 2025 14:21:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">一、先理清核心概念</h2>
<p>在讲解执行顺序前，先明确几个关键概念：</p>
<ol>
<li><strong>宏任务（Macrotask）</strong> ：常见的有 <code>setTimeout</code>、<code>setInterval</code>、I/O 操作、script 整体代码、UI 渲染（注意：渲染是独立阶段，不是宏任务，但和 rAF 强相关）。</li>
<li><strong>微任务（Microtask）</strong> ：<code>Promise.then/catch/finally</code>、<code>queueMicrotask</code>、<code>MutationObserver</code> 等，会在宏任务执行完后、渲染 / 下一个宏任务前立即执行。</li>
<li><strong>requestAnimationFrame</strong>：不属于宏任务 / 微任务，是浏览器专门为动画设计的 API，会在<strong>浏览器重绘（渲染）之前</strong>执行，执行时机在微任务之后、宏任务之前（下一轮）。</li>
</ol>
<h2 data-id="heading-1">二、事件循环的执行流程</h2>
<p>一个完整的事件循环周期执行顺序：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 执行当前宏任务（如 script 主代码）
<span class="hljs-bullet">2.</span> 执行所有微任务（微任务队列清空）
<span class="hljs-bullet">3.</span> 执行 requestAnimationFrame 回调
<span class="hljs-bullet">4.</span> 浏览器进行 UI 渲染（重绘/回流）
<span class="hljs-bullet">5.</span> 取出下一个宏任务执行，重复上述流程
</code></pre>
<h2 data-id="heading-2">三、代码分析</h2>
<p><strong>代码执行优先级</strong>：同步代码 &gt; 微任务 &gt; rAF（当前帧） &gt; 普通宏任务（setTimeout） &gt; rAF（下一帧） &gt; 后续普通宏任务。</p>
<h4 data-id="heading-3">场景 1：基础顺序（script + 微任务 + rAF + 宏任务）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 同步代码（属于第一个宏任务：script 整体）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步代码执行'</span>);

<span class="hljs-comment">// 微任务</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'微任务执行'</span>);
});

<span class="hljs-comment">// requestAnimationFrame</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'requestAnimationFrame 执行'</span>);
});

<span class="hljs-comment">// 宏任务（setTimeout 是宏任务）</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 宏任务执行'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序大部分情况下是这样的：</span>
<span class="hljs-comment">// 同步代码执行</span>
<span class="hljs-comment">// 微任务执行</span>
<span class="hljs-comment">// requestAnimationFrame 执行</span>
<span class="hljs-comment">// setTimeout 宏任务执行</span>
</code></pre>
<p><strong>代码解释1</strong>：</p>
<ul>
<li>第一步：执行同步代码，打印「同步代码执行」；</li>
<li>第二步：微任务队列有 <code>Promise.then</code>，执行并打印「微任务执行」；</li>
<li>第三步：浏览器准备渲染前，执行 rAF 回调，打印「requestAnimationFrame 执行」；</li>
<li>第四步：浏览器完成渲染后，取出下一个宏任务（setTimeout）执行，打印「setTimeout 宏任务执行」。</li>
</ul>
<p><strong>代码解释2</strong>：</p>
<ul>
<li>
<p><strong>正常浏览器环境（60Hz 屏幕，无阻塞）</strong> ：输出顺序是按上方写的先后顺序执行的：</p>
<pre><code class="hljs language-arduino" lang="arduino">同步代码执行
微任务执行
requestAnimationFrame 执行
setTimeout 宏任务执行
</code></pre>
<p>原因：浏览器每 16.7ms 刷新一次，<code>requestAnimationFrame</code> 会在<strong>下一次重绘前</strong>执行，而 <code>setTimeout</code> 即使设为 0，也会有 4ms 左右的最小延迟（浏览器限制），所以 <code>requestAnimationFrame</code> 先执行。</p>
</li>
<li>
<p><strong>极端情况（主线程阻塞 / 浏览器刷新延迟）</strong> ：可能出现顺序互换：</p>
<pre><code class="hljs language-arduino" lang="arduino">同步代码执行
微任务执行
setTimeout 宏任务执行
requestAnimationFrame 执行
</code></pre>
<p><strong>原因</strong>：如果主线程处理完微任务后，<code>requestAnimationFrame</code> 的回调还没到执行时机（比如浏览器还没到重绘节点），但 <code>setTimeout</code> 的最小延迟已到，就会先执行 <code>setTimeout</code>。</p>
</li>
</ul>
<h3 data-id="heading-4">总结</h3>
<ol>
<li>
<p><strong>固定顺序</strong>：同步代码 → 微任务，这两步是绝对固定的，不受任何因素影响。</p>
</li>
<li>
<p><strong>不固定顺序</strong>：<code>requestAnimationFrame</code> 和 <code>setTimeout</code> 的执行先后不绝对，前者优先级更高但依赖渲染时机，后者受最小延迟限制，多数场景下前者先执行，但不能当作 “绝对结论”。</p>
</li>
<li>
<p>核心原则：<code>requestAnimationFrame</code> 属于 “渲染相关回调”，优先级高于普通宏任务（如 <code>setTimeout</code>），但并非 ECMAScript 标准定义的 “微任务 / 宏任务” 范畴，而是浏览器的扩展机制，因此执行时机存在微小不确定性。</p>
</li>
</ol>
<h4 data-id="heading-5">场景 2：嵌套场景（rAF 内嵌套微任务 / 宏任务）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步代码'</span>);

<span class="hljs-comment">// 第一个 rAF</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 执行'</span>);
  
  <span class="hljs-comment">// rAF 内的微任务</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 内的微任务'</span>);
  });
  
  <span class="hljs-comment">// rAF 内的宏任务</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 内的 setTimeout'</span>);
  }, <span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// rAF 内嵌套 rAF</span>
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 2 执行'</span>);
  });
});

<span class="hljs-comment">// 外层微任务</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'外层微任务'</span>);
});

<span class="hljs-comment">// 外层宏任务</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'外层 setTimeout'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序：</span>
<span class="hljs-comment">// 同步代码</span>
<span class="hljs-comment">// 外层微任务</span>
<span class="hljs-comment">// rAF 1 执行</span>
<span class="hljs-comment">// rAF 1 内的微任务</span>
<span class="hljs-comment">// 外层 setTimeout</span>
<span class="hljs-comment">// （浏览器下一次渲染前）</span>
<span class="hljs-comment">// rAF 2 执行</span>
<span class="hljs-comment">// rAF 1 内的 setTimeout</span>
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li>先执行同步代码 → 外层微任务；</li>
<li>执行 rAF 1 → 立即执行 rAF 1 内的微任务（微任务会在当前阶段清空）；</li>
<li>浏览器渲染后，执行下一轮宏任务：外层 setTimeout；</li>
<li>下一次事件循环的渲染阶段，执行嵌套的 rAF 2；</li>
<li>最后执行 rAF 1 内的 setTimeout（下下轮宏任务）。</li>
</ol>
<h4 data-id="heading-6">场景 3：rAF 与多个宏任务对比</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 宏任务1：setTimeout 0</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 1'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// rAF</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 执行'</span>);
});

<span class="hljs-comment">// 宏任务2：setTimeout 0</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 2'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序：</span>
<span class="hljs-comment">// rAF 执行</span>
<span class="hljs-comment">// setTimeout 1</span>
<span class="hljs-comment">// setTimeout 2</span>
</code></pre>
<p><strong>结论</strong>：即使多个宏任务排在前面，rAF 依然会在「微任务后、渲染前」优先执行，然后才执行所有待处理的宏任务。</p>
<h2 data-id="heading-7">四、实际应用</h2>
<p>rAF 的这个执行特性，常用来做高性能动画（比如 DOM 动画），因为它能保证在渲染前执行，避免「布局抖动」：</p>
<pre><code class="hljs language-ini" lang="ini">// 用 rAF 实现平滑移动动画
const <span class="hljs-attr">box</span> = document.getElementById(<span class="hljs-string">'box'</span>)<span class="hljs-comment">;</span>
let <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

function moveBox() {
  left += 1<span class="hljs-comment">;</span>
  <span class="hljs-attr">box.style.left</span> = `<span class="hljs-variable">${left}</span>px`<span class="hljs-comment">;</span>
  
  // 动画未结束则继续调用 rAF
  if (left &lt; 300) {
    requestAnimationFrame(moveBox)<span class="hljs-comment">;</span>
  }
}

// 启动动画
requestAnimationFrame(moveBox)<span class="hljs-comment">;</span>
</code></pre>
<p>这个代码的优势：rAF 会和浏览器的刷新频率（通常 60Hz，每 16.7ms 一次）同步，不会像 <code>setTimeout</code> 那样可能出现丢帧，因为 <code>setTimeout</code> 是宏任务，执行时机不固定，可能错过渲染时机。</p>
<h3 data-id="heading-8">总结</h3>
<ol>
<li><strong>核心执行顺序</strong>：同步代码 → 所有微任务 → requestAnimationFrame → 浏览器渲染 → 下一轮宏任务（setTimeout/setInterval 等）。</li>
<li><strong>rAF 本质</strong>：不属于宏 / 微任务，是浏览器渲染阶段的「专属回调」，优先级高于下一轮宏任务。</li>
<li><strong>实战价值</strong>：rAF 适合做 UI 动画，能保证动画流畅；宏任务（setTimeout）适合非渲染相关的异步操作，避免阻塞渲染。</li>
</ol>
<h2 data-id="heading-9">相比传统的计时器防抖与节流</h2>
<h3 data-id="heading-10">实战代码：rAF 实现节流（最常用）</h3>
<p>rAF 做节流的核心优势：和浏览器渲染同步，不会出现「执行次数超过渲染帧」的无效执行，尤其适合 <code>resize</code>、<code>scroll</code>、<code>mousemove</code> 这类和 UI 相关的高频事件。</p>
<h4 data-id="heading-11">基础版 rAF 节流</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rafThrottle</span>(<span class="hljs-params">callback</span>) {
  <span class="hljs-keyword">let</span> isPending = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已有待执行的回调</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (isPending) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 已有待执行任务，直接返回</span>
    
    isPending = <span class="hljs-literal">true</span>;
    <span class="hljs-comment">// 绑定 this 指向，传递参数</span>
    <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      callback.<span class="hljs-title function_">apply</span>(context, args); <span class="hljs-comment">// 执行回调</span>
      isPending = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 执行完成后重置标记</span>
    });
  };
}

<span class="hljs-comment">// 测试：监听滚动事件</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">rafThrottle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动节流执行'</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>);
}));
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li><code>isPending</code> 标记是否有 rAF 回调待执行，避免同一帧内多次触发；</li>
<li>每次触发事件时，若没有待执行任务，就通过 rAF 注册回调；</li>
<li>rAF 会在<strong>下一次渲染前执行回调</strong>，执行完后重置标记，确保每帧只执行一次。</li>
</ol>
<h4 data-id="heading-12">对比传统 setTimeout 节流</h4>
<pre><code class="hljs language-ini" lang="ini">// 传统 setTimeout 节流（对比用）
function timeoutThrottle(callback, <span class="hljs-attr">delay</span> = <span class="hljs-number">16.7</span>) {
  let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
  return function(...args) {
    if (timer) return<span class="hljs-comment">;</span>
    <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
      callback.apply(this, args)<span class="hljs-comment">;</span>
      <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
    }, delay)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<p>rAF 节流的优势：</p>
<ul>
<li><strong>执行时机和浏览器渲染帧完全同步，不会出现「回调执行了但渲染没跟上」的无效操作</strong>；</li>
<li><strong>无需手动设置延迟（如 16.7ms），自动适配浏览器刷新率（60Hz/144Hz 都能兼容）</strong>。</li>
</ul>
<h3 data-id="heading-13">实战代码：rAF 实现防抖</h3>
<p>rAF 实现防抖需要结合「延迟 + 取消 rAF」的逻辑，核心是「触发事件后，只保留最后一次 rAF 回调」。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rafDebounce</span>(<span class="hljs-params">callback</span>) {
  <span class="hljs-keyword">let</span> rafId = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 保存 rAF 的 ID，用于取消</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
    <span class="hljs-comment">// 若已有待执行的 rAF，先取消</span>
    <span class="hljs-keyword">if</span> (rafId) {
      <span class="hljs-title function_">cancelAnimationFrame</span>(rafId);
    }
    <span class="hljs-comment">// 重新注册 rAF，延迟到下一帧执行</span>
    rafId = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      callback.<span class="hljs-title function_">apply</span>(context, args);
      rafId = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 执行后清空 ID</span>
    });
  };
}

<span class="hljs-comment">// 测试：监听输入框输入</span>
<span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'input'</span>);
input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-title function_">rafDebounce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'输入防抖执行'</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
}));
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li>每次触发事件时，先通过 <code>cancelAnimationFrame</code> 取消上一次未执行的 rAF 回调；</li>
<li>重新注册新的 rAF 回调，确保只有「最后一次触发」的回调会执行；</li>
<li>防抖的延迟本质是「一帧的时间（16.7ms）」，若需要更长延迟，可结合 <code>setTimeout</code>。</li>
</ol>
<h4 data-id="heading-14">带自定义延迟的 rAF 防抖</h4>
<pre><code class="hljs language-ini" lang="ini">function rafDebounceWithDelay(callback, <span class="hljs-attr">delay</span> = <span class="hljs-number">300</span>) {
  let <span class="hljs-attr">rafId</span> = null<span class="hljs-comment">;</span>
  let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
  return function(...args) {
    const <span class="hljs-attr">context</span> = this<span class="hljs-comment">;</span>
    // 取消之前的定时器和 rAF
    if (timer) clearTimeout(timer)<span class="hljs-comment">;</span>
    if (rafId) cancelAnimationFrame(rafId)<span class="hljs-comment">;</span>
    
    // 先延迟，再用 rAF 执行（保证渲染前执行）
    <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
      <span class="hljs-attr">rafId</span> = requestAnimationFrame(() =&gt; {
        callback.apply(context, args)<span class="hljs-comment">;</span>
        <span class="hljs-attr">rafId</span> = null<span class="hljs-comment">;</span>
        <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
    }, delay)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-15">四、适用场景 vs 不适用场景</h3>



































<table><thead><tr><th>场景</th><th>是否适合用 rAF 做防抖 / 节流</th><th>原因</th></tr></thead><tbody><tr><td>scroll/resize 事件</td><td>✅ 非常适合</td><td>和 UI 渲染强相关，rAF 保证每帧只执行一次</td></tr><tr><td>mousemove/mouseover 事件</td><td>✅ 适合</td><td>高频触发，rAF 减少无效执行，提升性能</td></tr><tr><td>输入框 input/change 事件</td><td>✅ 适合（防抖）</td><td>保证输入完成后，在渲染前执行回调（如搜索联想）</td></tr><tr><td>网络请求（如按钮点击提交）</td><td>❌ 不适合</td><td>网络请求和 UI 渲染无关，用传统 setTimeout 防抖更合适</td></tr><tr><td>后端数据处理（无 UI 交互）</td><td>❌ 不适合</td><td>rAF 是浏览器 API，Node.js 环境不支持，且无渲染需求</td></tr></tbody></table>
<h3 data-id="heading-16">总结</h3>
<ol>
<li><strong>rAF 适合做防抖 / 节流</strong>，尤其在「和 UI 交互相关的高频事件」（scroll/resize/mousemove）场景下，性能优于传统 setTimeout；</li>
<li><strong>rAF 节流</strong>：核心是「每帧只执行一次」，利用 <code>isPending</code> 标记避免重复执行；</li>
<li><strong>rAF 防抖</strong>：核心是「取消上一次 rAF，保留最后一次」，可结合 setTimeout 实现自定义延迟；</li>
<li>非 UI 相关的防抖 / 节流（如网络请求），优先用传统 setTimeout，避免依赖浏览器渲染机制。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发提效利器 - 用好Snippets]]></title>    <link>https://juejin.cn/post/7581698074361610249</link>    <guid>https://juejin.cn/post/7581698074361610249</guid>    <pubDate>2025-12-09T14:23:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074361610249" data-draft-id="7581691182003535882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发提效利器 - 用好Snippets"/> <meta itemprop="keywords" content="前端,JavaScript,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-12-09T14:23:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发提效利器 - 用好Snippets
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:23:50.000Z" title="Tue Dec 09 2025 14:23:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><code>snippets</code> 意思是<strong>片段</strong>，在 <code>vscode</code> 中可以通过 <code>Snippets：Configure Snippets</code> 命令，可以定义<code>全局级（global）、项目级（Project）、语言级（Language）</code>代码片段，可以按照自定义的规则来快速生成一段代码，进而大幅提升我们的开发效率，可谓是工作提效利器。</p>
<h2 data-id="heading-1">1、如何创建 snippets？</h2>
<ol>
<li>第一步，在 vscode 按 <code>ctrl/command + shift + p</code>，输入 snippets，选择 <code>Snippets：Configure Snippets</code>，可以看到如下界面。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45813bd7b5e4894bc36283a689f765e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=Qo%2FIsfeXkkAFrp64W3r0DjmhY64%3D" alt="" loading="lazy"/></p>
<p>可根据需要选择 snippets 的创建类型，一般选择 global 全局级别的 snippets 即可。</p>
<ol start="2">
<li>第二步，选择 <code>New Global Snippets file</code>，输入文件名，按 <code>enter</code> 键，即进入 <code>snippets</code> 配置文件设置。</li>
</ol>
<p>snippets 文件以 JSON 编写，里面支持书写注释，并可定义无限数量的 snippets。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"snippet"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"javascript,typescript"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"snippet"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
		<span class="hljs-string">"console.log('$1');"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a simple snippet"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong>prefix</strong>：必填，可以定义一个或多个触发词，由于子字符串匹配不是严格匹配的，类似正则匹配，比如输入 <code>ts</code> 可以匹配到 <code>test</code>。</li>
<li><strong>body</strong>：必填，表示正文，是一行或多行内容，插入时会合并为多行。换行和嵌入的标签页将根据插入摘要的上下文进行格式化。</li>
<li><strong>description</strong>：可选，表示片段的描述。</li>
<li><strong>scope</strong>：可选，表示支持的语言，默认支持所有。</li>
</ul>
<h2 data-id="heading-2">2、snippets 支持语法</h2>
<h3 data-id="heading-3">2.1 光标控制</h3>
<ul>
<li>在 body 正文，它里面可以使用占位符：<code>$0、$1、$2...</code>，代表光标位置，<code>$0</code> 代表光标最后停留的位置，<code>$1</code> 代表光标第一个停留的位置，<code>$2</code> 代表光标第二个停留的位置，以此类推，在使用 <code>prefix</code> 触发词触发词生成代码片段后，可使用 <code>Tab</code> 键跳转到光标位置。</li>
<li>同名光标可以同时使用多个，比如可以使用多个 <code>$1</code>，就可以实现<strong>多光标同时编辑</strong>。</li>
<li>光标也可以加上默认值，比如 <code>${1：element}</code>，默认值为 <code>element</code>，如果触发词触发后，不输入任何内容，则光标位置默认为 <code>element</code>。</li>
<li>光标也可以提供多个值来选择，比如 <code>${1|element1,element2,element3|}</code>，当按 <code>Tab</code> 键移动到对应光标时，会出现下拉框可供选择。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfee01939b7b43a79f3423ce199291c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=R7Qdjzbk7YyVRRQheP8yfSKZ%2Bi8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 Variables 变量</h3>
<p>在 body 正文可以使用变量，语法是 <code>$name</code> 或 <code>${name：default}</code>。其中 <code>default</code> 表示默认值（占位符），当变量未知（即其名称未定义）时，会采用这个默认值。</p>
<p>vscode 中内置一些变量：</p>
<ul>
<li><code>${TM_FILENAME}</code>：当前文件名。</li>
<li><code>${TM_FILENAME_BASE}</code>：当前文件名（不带扩展名）。</li>
<li><code>${TM_DIRECTORY}</code>：当前文件所在目录。</li>
<li><code>${TM_FILEPATH}</code>：当前文件路径。</li>
<li><code>${RELATIVE_FILEPATH}</code>：当前文档的相对（相对于已打开的工作区或文件夹）文件路径。</li>
<li><code>${RELATIVE_FILEPATH}</code>：当前文档的相对（相对于已打开的工作区或文件夹）文件路径。</li>
<li><code>${CLIPBOARD}</code>：剪切板的内容。</li>
<li><code>${TM_SELECTED_TEXT}</code>：当前选择的文本或空字符串。</li>
<li><code>${CURRENT_SECONDS_UNIX}</code>：10位 unix 时间戳。</li>
<li>...等等。</li>
</ul>
<p>更多变量可查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Fediting%2Fuserdefinedsnippets%23_variables" target="_blank" title="https://code.visualstudio.com/docs/editing/userdefinedsnippets#_variables" ref="nofollow noopener noreferrer">vscode snippets 官方文档</a>。</p>
<h3 data-id="heading-5">2.3 Transform 变换</h3>
<p>还支持对变量做正则替换。</p>
<p>举个例子，变量 <code>${TM_FILENAME}</code> 是表示当前文件名，比如当前文件名为 <code>test.js</code>，使用 <code>"${TM_FILENAME/[\\.]/_/}"</code>，表示将文件名中的 <code>.</code> 替换为 <code>_</code>，会把 <code>test.js</code> 变成 <code>test_js</code>。</p>
<p>这个语法怎么理解呢？</p>
<p>拿 js 对比来说，比如当前字符串 s 为 <code>test.js</code>，使用正则替换 <code>s.replace(/(.+)\.js/i, '$1df')</code>，其输出结果为 <code>testdf</code>，而在 vscode 中，如果当前文件名为 <code>test.js</code>，使用 <code>${TM_FILENAME/(.+)\\.js/$1df/i}</code>，也能得到同样的结果。</p>
<p><strong>具体规则差异总结如下</strong>：</p>
<ul>
<li>也就是不用逗号分开，而改为 <code>/</code>。</li>
<li>在以前 <code>\.js</code> 的正则语法中，需要增加一个 <code>\</code> 表示再多转义一次，要不然会报错。</li>
</ul>
<h2 data-id="heading-6">3、多人项目协作时如何实现 snippets 共享？</h2>
<p>之前说过，snippets 可以定义在<strong>全局级、项目级、语言级</strong>，所以，如果多人协作时，可以把 snippets 定义在项目级，这样 vscode 在根目录生成配置配置，目录如下： <code>根目录/.vscode/[snippet名].code-snippets</code>，可以在这个文件提交到 <code>git</code> 仓库中，这样项目成员都可以共享该 <code>snippets</code> 了。</p>
<h2 data-id="heading-7">4、如何在 markdown 文件中使用 vscode snippets?</h2>
<p>默认在 <code>vscode</code> 中，在<code>markdown</code> 文件编写内容是默认不支持 snippets 的，比如我平时写一些 <code>markdown</code> 表格时，会配置一个 <code>markdown</code> 表格的 <code>snippets</code>，但发现在 <code>markdown</code> 文件中输入触发词 <code>prefix</code> 根本无法使用。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"md-table"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"md-table"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
			<span class="hljs-string">"| 列1标题 | 列2标题 | 列3标题 |"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"|---------|---------|---------|"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"| 内容A   | 内容B   | 内容C   |"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"| 内容D   | 内容E   | 内容F   |"</span>
		<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"markdown 表格"</span>
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>后面发现可以手动插入 snippets。在 vscode 按 <code>ctrl/command + shift + p</code>，输入 snippets，选择 <code>Snippets：Insert Snippet</code>，就可以看到所有之前配置好对的 <code>snippets</code> 了，选择对应的 <code>snippet</code> 插入即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad056f39a5e543b0b3666bc72a6634fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=dfiKOIHUCsRPq6fW5PBcp0Z2tNQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">小结</h2>
<ul>
<li>vscode 支持<code>全局级（global）、项目级（Project）、语言级（Language）</code>代码片段，一般个人使用的话为了方便，直接定义<code>全局级</code>即可，需要进行多人协助时，可使用<code>项目级</code> snippets，将生成的配置文件上传到 <code>git</code> 仓库即可。</li>
<li>snippets 支持语法：<strong>光标控制、Variables 变量、Transform 变换</strong>等语法，可按需使用。</li>
<li>markdown 中默认不支持 snippets，但可以通过手动插入 snippets 来使用。</li>
</ul>
<p>最后为了方便，snippets 配置文件的编写可以使用这个工具网站进行生成：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsnippet-generator.app%2F%3Fdescription%3D%26tabtrigger%3D%26snippet%3D%26mode%3Dvscode" target="_blank" title="https://snippet-generator.app/?description=&amp;tabtrigger=&amp;snippet=&amp;mode=vscode" ref="nofollow noopener noreferrer">snippet-generator</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f57013cd7a5845ebaa7061e265696d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=clLBVG8S7xpt%2F243wzD9G5PtyTk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！]]></title>    <link>https://juejin.cn/post/7581693431740022847</link>    <guid>https://juejin.cn/post/7581693431740022847</guid>    <pubDate>2025-12-09T14:24:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740022847" data-draft-id="7581689310643535914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-09T14:24:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:24:36.000Z" title="Tue Dec 09 2025 14:24:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近，在做几个落地的 AI 项目，发现“<strong>隐私</strong>”是无法绕开的一个关键挑战。</p>
<p>不是简单的达到“合规”，而是真正的避免客户的手机号、姓名等个人信息上传到云端大模型。</p>
<blockquote>
<p>本文暂不讨论私有部署大模型和端侧模型——它们虽理想，但并非所有场景都适用。</p>
</blockquote>
<p>我也了解了挺多方案，但是感觉都不那么自然或者简单，直到我看到 <code>OneAIFW</code> （一个AI防火墙？）。</p>
<h2 data-id="heading-0">OneAIFW</h2>
<p>连名字都是那么的朴实无华。</p>
<p><code>OneAIFW</code> 开源在 <code>GitHub</code> 上，采用 <code>MIT</code> 协议。</p>
<p>虽然目前 <code>star</code> 还不多，但我感觉前途可期。</p>
<p>它的原理简单概括就是：</p>
<ol>
<li><strong>脱敏</strong>：将发给大模型的文字中的隐私数据替换为为结构化占位符。</li>
<li>大模型接收的数据依然保留原有结构，不影响语义理解。</li>
<li><strong>还原</strong>：将大模型返回的文字中的为结构化占位符替换为原始文字。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50875c0df15b4c728b911a0e5fc628d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=c%2FflggbAYMLHxS4qfz0fsZhPVlI%3D" alt="" loading="lazy"/></p>
<p>是不是很简单，了解原理后我只有一个感觉：<strong>这么简单的思路，我为什么没有想出来。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e4701f02bd74e4cb5eebd9c16019aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=1ShMAnQSRThZ3JpMCTMmqHKsdPs%3D" alt="屏幕录制 2025-12-09 192135.gif" loading="lazy"/></p>
<h3 data-id="heading-1">保护内容</h3>
<p>目前支持脱敏的内容：</p>
<ul>
<li>物理地址</li>
<li>邮箱地址</li>
<li>姓名 / 用户名</li>
<li>公司 / 组织名</li>
<li>电话号码</li>
<li>银行账户 / 卡号</li>
<li>支付信息</li>
<li>验证码</li>
<li>密码</li>
<li>随机种子</li>
<li>私钥</li>
<li>URL 地址</li>
</ul>
<h2 data-id="heading-2">在线体验</h2>
<p>光说不练假把式，不如直接上手试试。</p>
<p>官方提供了一个线上 <code>demo</code>，可以在线体验。</p>
<p>地址：<code>https://oneaifw.com/</code></p>
<p>可以直接分析敏感信息，也可以直接尝试脱敏的效果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07f6aea8fe9440fd84aa22969f7f670f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=xyNPHdz9Pc6aEPIXKApzYUU%2B5NE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">使用方式</h2>
<p>该项目另一个很赞的点就是，它提供了我们常用的各种方式使用，包括本地 Web、浏览器插件、本地 API、本地命令行。</p>
<h3 data-id="heading-4">本地 Web</h3>
<p>一个轻量前端，依赖 <code>@oneaifw/aifw-js</code> 库，在浏览器里跑完整流程。</p>
<p>适合快速验证或嵌入现有 <code>Web</code> 应用。</p>
<h3 data-id="heading-5">浏览器插件</h3>
<p>提供 <code>Chrome/Edge</code> 扩展示例，可以注入到各类大模型网站，在你点击“发送”前自动脱敏。</p>
<p>这个估计是日常使用最佳的方式了。</p>
<h3 data-id="heading-6">本地 API</h3>
<p>通过 <code>py-origin</code> 或 <code>cli/python</code> 启动一个本地 HTTP 服务，提供 <code>/api/mask_text</code>、<code>/api/restore_text</code>、<code>/api/call</code> 等接口。</p>
<p>如果你和我一样正在开发 AI 项目，可以考虑通过 <code>API</code> 方式接入。</p>
<h3 data-id="heading-7">本地命令行</h3>
<p>装好 Python 包后，支持命令行直接调用，比如：</p>
<pre><code class="hljs language-perl" lang="perl">python -m aifw call <span class="hljs-string">"请把如下文本翻译为中文: My email address is test@example.com, and my phone number is 18744325579."</span>
</code></pre>
<p>非常适合脚本调用或自动化流程。</p>
<h2 data-id="heading-8">结语</h2>
<p>今天主要给大家分享了一个 AI 项目中解决<strong>隐私</strong>问题的产品，重点是设计思路，希望可以帮到大家。</p>
<p>我已经在跑通了 Web 版本，部署体验将在后续更新。</p>
<p>基座模型或许遥不可及，但 AI 时代的真正机会，往往藏在像 <code>OneAIFW</code> 这样的“<strong>小而关键</strong>”的环节里——它不炫技，只是让智能变得更安全、更可用。而这，正是我们每个人都能参与的方向。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件]]></title>    <link>https://juejin.cn/post/7581698635865505818</link>    <guid>https://juejin.cn/post/7581698635865505818</guid>    <pubDate>2025-12-09T14:31:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698635865505818" data-draft-id="7581698074361643017" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件"/> <meta itemprop="keywords" content="后端,.NET,Visual Studio"/> <meta itemprop="datePublished" content="2025-12-09T14:31:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:31:29.000Z" title="Tue Dec 09 2025 14:31:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">EFCore.Visualizer</h2>
<p>EFCore.Visualizer 是一款可以直接在 Visual Studio 中查看 EF Core 查询计划调试器可视化工具（帮助开发者分析和优化数据库查询性能），目前，该可视化工具支持 SQL Server、PostgreSQL、SQLite、MySQL 和 Oracle。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGiorgi%2FEFCore.Visualizer" target="_blank" title="https://github.com/Giorgi/EFCore.Visualizer" ref="nofollow noopener noreferrer">github.com/Giorgi/EFCo…</a></li>
</ul>
<p><strong>SQL Server：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e691787d16a948af9e5d7a8ba5230db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=EX9RWOjdSPUmlm34MLpKQC7ivlQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a0fa37859cb4ebeb2228d9183c4936f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=dTAyyB8FKUyhxA9mEei8GJOQCAA%3D" alt="" loading="lazy"/></p>
<p><strong>PostgreSQL：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c864e10f0dd54195a00034b3a0580080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=HWji9kk5CIz6ibWqFxR%2BWn0JV6k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cd6e9076be42bb85881edfcfa06115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=d5d6tB2MtVqdEaEMFmkQt6NlXao%3D" alt="" loading="lazy"/></p>
<p><strong>MySQL：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba82dafcbe44c5f9fa47ac1ee2e770c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=MNldPXCOcpcNmSW7%2F9sFXgDnnN0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3a918d0160243f1b024aae56c1f4958~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=VAr4mvXtTuSrV9rCo9Ln%2BwrJmzI%3D" alt="" loading="lazy"/></p>
<p><strong>SQLite：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df060161a1de45ea96d7641f21b8eae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=LVYFrHftoPIQZ90gXorkuuZwKiI%3D" alt="" loading="lazy"/></p>
<p><strong>Oracle：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e781551b6adc4046a6e33cc848ea20bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=ZRy3dO7dLM9LuE1FpRWqTrsg%2FjE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4041db549b1418ea151ff96e2d358b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=NBqvhT5ds9JJF2U6tp3XQgrKPN0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">EFCorePowerTools</h2>
<p>EF Core Power Tools 是一款基于 C# 编写、开源免费（MIT license）、在 EF Core 命令行工具的基础上构建的适用于 Visual Studio 2022 中的 EF Core 反向工程和模型可视化扩展插件。它提供了反向工程、迁移和模型可视化、生成关系图、生成SQL语句等功能，旨在降低使用 EF Core 的门槛，并通过图形用户界面（GUI）辅助开发者进行数据库的反向工程和DbContext模型的可视化。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FErikEJ%2FEFCorePowerTools" target="_blank" title="https://github.com/ErikEJ/EFCorePowerTools" ref="nofollow noopener noreferrer">github.com/ErikEJ/EFCo…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f767bde05bfb4a018e63a031b75cca84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=qBIHeZ%2B9tMmVxMS5mTEwIlG4OTs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d76878419950449399eff07f3a51fc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=M9HASn8HCNTk39CHw79CGGYMqB8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">AntDeploy</h2>
<p>AntDeploy 是一款由 .NET 开源、实用的 Visual Studio 发布部署插件，支持部署 Docker、IIS、Windows 和 Linux 服务，同时支持 .NET Framework 和 .NET Core，支持回滚和增量部署，在支持 Visual Studio 2019 和 2022 中使用。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyuzd%2FAntDeploy" target="_blank" title="https://github.com/yuzd/AntDeploy" ref="nofollow noopener noreferrer">github.com/yuzd/AntDep…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef13464ed4e6407f92658906d6b21ace~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=QMKzcsOmoFQlbeTB%2FY31QAWdhL0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af8bc977ac27411a8c48387d41d3aa43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=1EUmS8duA55ynRMHlDoaqErQkuk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">FileEncoding</h2>
<p>FileEncoding 是一个专为 Visual Studio 设计的扩展插件，它能够在 Visual Studio 的文本编辑器右下角实时显示当前打开文档的编码格式。这一功能对于快速识别文件的编码非常有帮助，尤其是在处理来自不同平台或团队的代码时。更重要的是，通过简单的点击操作，用户还可以轻松修改文件的编码格式，无需借助外部工具或进行复杂的设置调整。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgenrwoody%2Fvs_file_encoding" target="_blank" title="https://github.com/genrwoody/vs_file_encoding" ref="nofollow noopener noreferrer">github.com/genrwoody/v…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cdf1686f64422c8a480f4f17c39ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=EnbPlaGqCYDNP0MJPTvZD238VaI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f51f232298ba471b9d36fb101d99fdaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=Cy5IgElvafg7wD5YSAWY9Hjdl3U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。假如你有更好的推荐，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何设置你的 PWN 环境]]></title>    <link>https://juejin.cn/post/7581728606307008564</link>    <guid>https://juejin.cn/post/7581728606307008564</guid>    <pubDate>2025-12-09T14:36:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606307008564" data-draft-id="7581678301217013760" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何设置你的 PWN 环境"/> <meta itemprop="keywords" content="安全"/> <meta itemprop="datePublished" content="2025-12-09T14:36:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCultureBoy"/> <meta itemprop="url" content="https://juejin.cn/user/2664871913355463"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何设置你的 PWN 环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2664871913355463/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCultureBoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:36:17.000Z" title="Tue Dec 09 2025 14:36:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你首先需要的是 <strong>Linux Shell</strong> ，因为大多数 pwn 挑战通常是 <strong>64 位 ELF 可执行文件</strong> 。我会写两个不同的部分，分别针对 Windows 和 MacOS。如果你已经用<strong>过任何 Linux 发行</strong>版，这部分你就没问题了！对于剩下的 Windows/MacOS 用户，我强烈建议安装 <strong>Debian Bookworm</strong> 作为首选发行版，因为它目前使用 <code>glibc 2.36</code>，尚未实现<strong>完整的 RELRO，</strong>  且利用起来稍微容易一些。</p>
<h2 data-id="heading-0">Windows</h2>
<p>对于正在阅读本文的 Windows 用户，你可以按照链接的说明书轻松下载 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fwindows%2Fwsl%2Finstall" target="_blank" title="https://learn.microsoft.com/en-us/windows/wsl/install" ref="nofollow noopener noreferrer">WSL</a></strong>。如果你懒得看，这里有一份你应该执行的命令列表。</p>
<p>安装使用 Debian for WSL</p>
<pre><code class="hljs language-arduino" lang="arduino">wsl.exe --update
wsl --set-<span class="hljs-keyword">default</span>-version <span class="hljs-number">2</span>
wsl install -d Debian
</code></pre>
<p>就是这样！从现在起，你可以通过开始<strong>菜单</strong>中的 <code>Debian 搜索 Debian</code>，或者在命令行中运行 <code>Debian</code>，进入你的 <strong>Debian shell</strong>。关于上述 <strong>WSL 2</strong> 的要求，WSL 2 允许你在 WSL 内部的集成桌面模式下使用 GUI 应用。这其实没什么特别的意义，除了<strong>你可以让你的调试器在一个新窗口里弹出，不用 <code>tmux</code>，这对我来说简直是个大胜利!!</strong></p>
<p>补充一点，你可能需要<strong>更新系统包</strong> ，并下载文本编辑器，以避免在 WSL 终端和其他窗口之间切换。你可以用以下命令完成： <code>sudo apt update &amp;&amp; sudo apt dist-upgrade &amp;&amp; sudo apt(-get) install &lt;editor of choice&gt;</code> 。</p>
<p>如果你想要完全懒散的体验和最少的 Linux shell 作，你可以挂<strong>载你的 Windows 文件系统</strong> ，并在 <strong>Downloads</strong> 目录中使用以下命令（不区分大小写！）： <code>cd /mnt/c/users/your\ name/downloads</code></p>
<h2 data-id="heading-1">macOS</h2>
<p>不幸的是，对于 MacOS 用户来说，我觉得没有像 Windows 用户那样的集成桌面。所以，我建议你按照这个指南作，尽可能多<strong>地在终端里作</strong> ，你会在其中花费比预期更多的时间。好消息是，有 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flima-vm%2Flima" target="_blank" title="https://github.com/lima-vm/lima" ref="nofollow noopener noreferrer">Lima</a></strong>，我们可以用它帮助简化创建 x64 Linux 壳，即使是在 <strong>Apple Silicon</strong> 上。</p>
<p>这里有一份快速入门的推荐清单。</p>
<pre><code class="hljs language-arduino" lang="arduino">brew install lima
limactl start --name=x64-debian <span class="hljs-keyword">template</span>:<span class="hljs-comment">//debian --arch=x86_64</span>
limactl shell x64-debian 
sudo apt install tmux
</code></pre>
<p>你<strong>会</strong>遇到终端颜色的问题，解决方案完全<strong>取决于你的终端模拟器</strong> ，所以你自己找解决方案。</p>
<p>额外加分：可写主机文件系统！</p>
<p><code>LiMactl 编辑 x64-debian</code> 以编辑配置
添加以下不安全的配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">mounts:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">"~"</span>
  <span class="hljs-attr">writable:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>现在你拥有了一个运行在 x64 上的 Linux <strong>Shell</strong> ，可以不受限制地访问你的主机文件系统！
你可以用<code>标签</code>自动补全<strong>你的虚拟机名字</strong>拼写！</p>
<p>恭喜你通过了 Linux 安装！繁琐的部分现在开始了......我们先着手安装调试器和基础工具。</p>
<h3 data-id="heading-2">工具安装</h3>
<hr/>
<p>恭喜你完成了Linux安装！乏味的部分现在开始了...让我们先安装调试器和基本工具。</p>
<h4 data-id="heading-3">实用工具</h4>
<hr/>
<h5 data-id="heading-4">pwntools</h5>
<ol>
<li><code>sudo apt install python3</code> 安装python</li>
<li><code>sudo apt-get install python3-pwntools</code> 安装pwntools</li>
<li><code>pwn checksec /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作</li>
</ol>
<h5 data-id="heading-5">one gadget</h5>
<ol>
<li><code>sudo apt install rubygems</code> 安装gem</li>
<li><code>gem install one_gadget</code> 安装one gadget</li>
<li><code>one_gadget /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作</li>
</ol>
<h5 data-id="heading-6">rop gadget</h5>
<ol>
<li><code>sudo -H python3 -m pip install ROPgadget</code> 安装ROPgadget</li>
<li><code>ROPgadget /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作（警告：输出量很大！！）</li>
</ol>
<h4 data-id="heading-7">调试器</h4>
<hr/>
<p>我<strong>强烈推荐<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbata24%2Fgef" target="_blank" title="https://github.com/bata24/gef" ref="nofollow noopener noreferrer">bata-gef</a></strong>，你也应该使用它！</p>
<p>我不建议盲目运行安装脚本。相反，<strong>克隆仓库</strong>并在你的<code>.gdbinit</code>中source它的<code>gef.py</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~
git <span class="hljs-built_in">clone</span> https://github.com/bata24/gef
vi ~/.gdbinit

<span class="hljs-comment">#.gdbinit</span>
<span class="hljs-built_in">source</span> /path/to/gef.py
</code></pre>
<p>对于没有集成桌面模式的MacOS用户，<strong>使用我们之前安装的tmux</strong>。只需运行以下命令：</p>
<ol>
<li><code>tmux</code> 启动tmux</li>
<li><code>[Ctrl] + B</code> 进入命令模式</li>
<li><code>]</code> 启用滚动</li>
<li><code>[Ctrl] + C</code> 重置状态</li>
<li><code>[Ctrl] + B</code>，然后<code>&lt;arrow&gt;</code> 切换焦点标签页</li>
</ol>
<h4 data-id="heading-8">反编译器/反汇编器</h4>
<hr/>
<p>太好了！现在我们有了开始编写和调试_pwn_脚本所需的一切，这<strong>技术上</strong>就是我们需要的全部，但有时，挑战不提供<strong>源代码</strong>。在这种情况下，需要进行一些<strong>逆向工程工作</strong>。让我们下载**<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fghidra" target="_blank" title="https://github.com/NationalSecurityAgency/ghidra" ref="nofollow noopener noreferrer">Ghidra</a>**。</p>
<p>设置相当简单，你只需要一个<strong>Java运行时</strong>，我推荐<strong>Temurin</strong>，你可以在</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadoptium.net%2Fen-GB%2Ftemurin%2Freleases" target="_blank" title="https://adoptium.net/en-GB/temurin/releases" ref="nofollow noopener noreferrer">这里</a>
找到它。</p>
<p>一旦你安装了运行时，只需运行<code>ghidraRun</code>或<code>ghidraRun.bat</code>来启动<strong>Ghidra</strong>。</p>
<h5 data-id="heading-9">使用Ghidra</h5>
<p>Ghidra实际上相当不错且用户友好，你所要做的就是<strong>创建一个空项目</strong>，然后<strong>拖放</strong>你的挑战二进制文件到其中，并给它一点时间来生成反汇编和反编译！</p>
<h3 data-id="heading-10">容器化和服务器复制</h3>
<hr/>
<p><strong>恭喜</strong>你走到这一步！你已经准备好处理几乎所有pwn挑战了。然而，我们可以做得更好。</p>
<p>有时，善意的挑战作者会提供<strong>libc、ld和/或Dockerfile</strong>。这些文件特别有用，因为它们帮助你确保你的挑战<strong>使用与服务器相同的库</strong>，确保你永远不会遇到_"在我的机器上可以运行"_的问题！所以，我将介绍如何处理这些文件的各种组合。</p>
<h4 data-id="heading-11">给定了Libc、ld和Dockerfile</h4>
<hr/>
<p>这是最好的情况，因为你不需要做太多。这里有一个你可以运行的命令来使用给定的<code>libc</code>和<code>ld</code>：</p>
<p><code>./ld-linux-x86-64.so.2 --library-path . ./chal</code></p>
<p>这将运行<strong>链接器</strong>，并告诉它使用<strong>你目录中的库</strong>来启动挑战。<strong>就这样！</strong> 你现在正在使用给定的库。但是，我们如何复制服务器呢？</p>
<p>首先，我们必须安装<strong>Docker</strong>。过程相当长，但请相信</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Finstall%2Fdebian%2F" target="_blank" title="https://docs.docker.com/engine/install/debian/" ref="nofollow noopener noreferrer">文档</a>
并遵循它。</p>
<p>一旦你安装了<strong>Docker</strong>，你所要做的就是运行以下命令：</p>
<p><code>docker run -p YOUR_PORT:CONTAINER_PORT -d --privileged $(docker build -q .)</code></p>
<p>这将构建容器，然后以<strong>特权</strong>运行它，这通常是_pwn.red/jail_模板所需要的。请将<code>CONTAINER_PORT</code>占位符替换为容器提供挑战的端口，将<code>YOUR_PORT</code>替换为宿主机上的任何未使用端口。默认情况下，这将<strong>绑定到所有接口</strong>。</p>
<p>设置完成后，你可以像这样连接到容器并运行挑战：</p>
<p><code>nc 127.0.0.1 YOUR_PORT</code></p>
<p>就这样！你已经成功复制了服务器使用的库，以及服务器本身！完成后，你应该通过运行<code>docker ps</code>找到容器哈希，然后运行<code>docker stop &lt;hash&gt;</code>来清理正在运行的容器。</p>
<h4 data-id="heading-12">只提供了Dockerfile</h4>
<hr/>
<p>有时，作者只提供<code>Dockerfile</code>。这很糟糕，但没关系，因为我们可以自己提取<code>libc</code>和<code>ld</code>。我们首先使用上述步骤启动容器，然后执行以下操作：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">cp</span> 1a2b:/lib/x86_64-linux-gnu/libc.so.6 ./libc.so.6
docker <span class="hljs-built_in">cp</span> 1a2b:/lib/x86_64-linux-gnu/ld-linux-x86-64 ./ld-linux-x86-64.so.2
</code></pre>
<p>记得将<code>1a2b</code>替换为容器哈希的<strong>前4个字符</strong>，启动时会显示给你。有时，<strong>Dockerfile</strong>会从另一个<strong>Linux发行版</strong>复制文件到一个文件夹来提供服务，以便使用该发行版的<code>libc</code>。在这种情况下，只需在路径前加上前缀。使用一个容器执行<code>COPY --from=debian:bookworm / /srv</code>的例子，我们只需在<code>/lib</code>前加上<code>/srv</code>来从服务器的文件中复制。</p>
<h3 data-id="heading-13">结论</h3>
<hr/>
<p>通过以上所有设置和安装，你应该拥有所有工具，以及开始处理pwn挑战的基本知识。<strong>快乐pwning！</strong> 如果你现在想了解更多关于pwn的一般知识，请阅读我的博客文章</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架]]></title>    <link>https://juejin.cn/post/7581848286387109934</link>    <guid>https://juejin.cn/post/7581848286387109934</guid>    <pubDate>2025-12-09T14:38:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581848286387109934" data-draft-id="7581666412021907465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架"/> <meta itemprop="keywords" content=".NET,AI编程"/> <meta itemprop="datePublished" content="2025-12-09T14:38:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:38:25.000Z" title="Tue Dec 09 2025 14:38:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>如今，AI 应用正以前所未有的速度蓬勃发展，在各行各业展现出巨大的潜力与深远的影响力。今天，大姚为大家精心整理了 8 个基于 .NET 开源、功能强大的 AI 与大语言模型（LLM）相关项目框架，希望能为你的开发和探索提供有价值的参考。如果你有更优秀的项目推荐，欢迎通过提交 PR 或在文末留言分享！</p>
<h2 data-id="heading-1">Microsoft Agent Framework</h2>
<p>Microsoft Agent Framework 是一个面向 .NET 和 Python 的开源开发套件，用于构建 AI 智能体及多智能体工作流。它融合并扩展了 Semantic Kernel 与 AutoGen 项目的核心理念，在结合两者优势的基础上，进一步引入了全新能力。该框架由原班团队打造，将成为未来构建 AI 智能体的统一基础平台。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fagent-framework" target="_blank" title="https://github.com/microsoft/agent-framework" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fagent-framework" target="_blank" title="https://learn.microsoft.com/en-us/agent-framework" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/agent…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/721ddf6a94624cbea1e6e6ad9b461d9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=047CxFYAMCM1u2KPvjO%2BOWjYPOg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c76fa44200c47bf8f3058e2c3d3ddef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=lXbg59XTc99O3T3CrZPwFA4QC%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">AutoGen</h2>
<p>AutoGen 是一个开源编程框架，它通过多个代理进行对话以解决任务，从而实现 LLM 应用的开发。AutoGen 代理可定制、可对话，并且能够无缝地允许人类参与。它们可以在不同的模式下运行，使用 LLM、人类输入和工具的组合。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fautogen" target="_blank" title="https://github.com/microsoft/autogen" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Fautogen" target="_blank" title="https://microsoft.github.io/autogen" ref="nofollow noopener noreferrer">microsoft.github.io/autogen</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c4024230364c5bbb7f04fc77d2bdab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=Oz31D7Rdq43UUYm%2F138Wrdn5AdU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/111d34687c5e45dbb94b82bdc36117c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=P9UKOLBSK3hCrXx%2FsI%2B%2FJrOjAU4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">Semantic Kernel</h2>
<p>Semantic Kernel 是一个开源的软件开发工具包（SDK），旨在将大型语言模型（LLM）如OpenAI、Azure OpenAI和Hugging Face与传统的编程语言如C#、Python和Java集成。这个项目通过提供插件系统，允许开发者轻松地创建能够调用这些大型语言模型的应用程序。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fsemantic-kernel" target="_blank" title="https://github.com/microsoft/semantic-kernel" ref="nofollow noopener noreferrer">github.com/microsoft/s…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fsemantic-kernel%2Foverview%2F" target="_blank" title="https://learn.microsoft.com/zh-cn/semantic-kernel/overview/" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/seman…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70d925378e974620b90b390162ffab19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=wisfEKrq5fYlfWcmXMiHilgWbBc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a5141450d9446bda6c70382130da282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=AwAgKzbhoVVGvCF%2Bd9zoxugNmRY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">BotSharp</h2>
<p>BotSharp 是一个面向企业级 LLM 应用的开源 AI 框架，旨在促进智能机器人助手在面向业务系统中的开发和应用。该项目涉及自然语言理解、计算机视觉和音频处理技术，并旨在推动智能机器人助手在企业级系统中的开发和应用。BotSharp 提供了开箱即用的机器学习算法，使普通程序员能够更快、更轻松地开发人工智能应用程序。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSciSharp%2FBotSharp" target="_blank" title="https://github.com/SciSharp/BotSharp" ref="nofollow noopener noreferrer">github.com/SciSharp/Bo…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbotsharp.readthedocs.io%2F" target="_blank" title="https://botsharp.readthedocs.io/" ref="nofollow noopener noreferrer">botsharp.readthedocs.io/</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aed24fa0fec4f81b70f65063130e852~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=iLc3MViotFGHOoWrTL%2BOH4I%2BWBM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06fec7b98514f2cbec883ba54579c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=FGLjJRFkA4hs6XiTP2jK51KWVDE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421b859bb7b14175b556d390b9e8bb2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=QZYFCD02VZG%2BW2mqiZ1%2BzU39g%2Bc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Kernel Memory</h2>
<p>Kernel Memory（KM）是一种多模态AI服务，RAG 架构，使用 LLM 和自然语言索引和查询任何数据、跟踪来源、显示引用、异步内存模式。该存储库提供了特定 AI 和 LLMs 应用场景中内存的最佳实践和参考架构。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fkernel-memory" target="_blank" title="https://github.com/microsoft/kernel-memory" ref="nofollow noopener noreferrer">github.com/microsoft/k…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Fkernel-memory" target="_blank" title="https://microsoft.github.io/kernel-memory" ref="nofollow noopener noreferrer">microsoft.github.io/kernel-memo…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ab00cb6efaa4d0691566a947bf4ae00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=6MEJ27aRjuDBmgf2tuEKikIS7Bw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09b2ba121b6e4c59a1da017996bffcb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=lDCrMcJTs3%2FV8qdMYAts8EGPPVs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">LLamaSharp</h2>
<p>LLamaSharp是一个跨平台库，用于在本地设备上运行LLaMA/LLaVA模型（以及其他模型）。它基于llama.cpp，能够在CPU和GPU上高效进行推理。通过提供高级API和RAG支持，LLamaSharp使得在应用程序中部署大型语言模型（LLM）变得方便。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSciSharp%2FLLamaSharp" target="_blank" title="https://github.com/SciSharp/LLamaSharp" ref="nofollow noopener noreferrer">github.com/SciSharp/LL…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fscisharp.github.io%2FLLamaSharp%2Flatest%2F" target="_blank" title="https://scisharp.github.io/LLamaSharp/latest/" ref="nofollow noopener noreferrer">scisharp.github.io/LLamaSharp/…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04709de314bb44a0a69e08e970b4afed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=7Kcf3n735ZOundSEVDxMlkYDFu0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f89f47c63c5425db079a6986b749351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=tIwQjqhpTcZ%2FF9E9nrZCnCfdRI8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">AntSK</h2>
<p>AntSK 是一个基于 .NET 9 和 Blazor 技术栈构建的企业级AI知识库和智能体平台，集成了 Semantic Kernel 和 Kernel Memory，提供完整的AI应用开发解决方案。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAIDotNet%2FAntSK" target="_blank" title="https://github.com/AIDotNet/AntSK" ref="nofollow noopener noreferrer">github.com/AIDotNet/An…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6940f925ca824af2a238d97c7693c321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=ikRfhxjUUpfoUnlw5MHkJCipRmI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0913b94e5de149cc9ebf6002fe205ab3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=bPUDCXEd7nzAPv3FM6vL3plAGIo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">OllamaSharp</h2>
<p>OllamaSharp 旨在通过提供.NET绑定，使得开发者能够轻松地在.NET应用程序中使用Ollama API。简化了 .NET 与 Ollama 的本地和远程交互。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fawaescher%2FOllamaSharp" target="_blank" title="https://github.com/awaescher/OllamaSharp" ref="nofollow noopener noreferrer">github.com/awaescher/O…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Follama%2Follama%2Fblob%2Fmain%2Fdocs%2Fapi.md" target="_blank" title="https://github.com/ollama/ollama/blob/main/docs/api.md" ref="nofollow noopener noreferrer">github.com/ollama/olla…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef628a92ca64421981c65fd2a6c347e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=g91D1OTExi53sH1WyvG2gc8DJro%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。假如你有更好的推荐，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突]]></title>    <link>https://juejin.cn/post/7581688255625707572</link>    <guid>https://juejin.cn/post/7581688255625707572</guid>    <pubDate>2025-12-09T14:58:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581688255625707572" data-draft-id="7581728606307057716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突"/> <meta itemprop="keywords" content="Apache,数据库,后端"/> <meta itemprop="datePublished" content="2025-12-09T14:58:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:58:38.000Z" title="Tue Dec 09 2025 14:58:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当前银行业务全面线上化、实时化的驱动下，浙江省头部城商行亟需构建一个能够同时承载海量数据加工与高并发实时查询的数据平台，以支撑精准营销、实时风控和智能决策等关键业务。</p>
<p>在这一数字化转型进程中，我们最终引入了 Apache Doris 作为湖仓一体架构的核心组件。Doris 凭借其卓越的查询性能、高吞吐、对标准 SQL 的完整支持以及高效的实时数据摄入能力，在多个候选方案中脱颖而出。尤其值得一提的是，其架构的灵活度及可扩展性、极大降低了运维难度和成本投入。<strong>截至目前，我们已顺利完成 200TB+ 历史数据的平滑迁移与落地，为后续的深度应用奠定了坚实基础</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f63bef9fcecb4e38962c8b6f95f1133f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=cZtiLPeCAlQb%2FTrqTNYoX9qHwSo%3D" alt="1-整体架构图.PNG" loading="lazy"/></p>
<p>然而，在实践过程中，“算”（批量数据处理）与“查”（业务实时查询）这两种负载在资源需求与业务目标上的根本性矛盾逐渐凸显，解决这一矛盾已成为当下首要目标。</p>
<h2 data-id="heading-0">核心矛盾：“算”与“查”的资源争抢</h2>
<p>当“计算”和“查询”共用一个 Doris 集群时，资源争抢问题十分突出。例如，批量计算任务会在短时间内会占用大量 CPU、内存和 IO 资源，集群负载骤升，直接影响同时运行的业务查询的稳定性。其根本原因在于：</p>
<ul>
<li><strong>“算”的核心是吞吐量与任务交付</strong>。数仓专注于大规模数据的批量加工（如ETL、数据清洗与聚合计算），需要在有限资源下高效处理TB/PB级数据，确保任务在业务时间窗口内完成。其关键指标是任务成功率与产出时效，而对单个任务的响应时间并不敏感，只要能在业务允许的时间窗口内交付结果，即便耗时数小时亦可接受。</li>
<li><strong>“查”的核心是响应速度与服务可用性</strong>。它直接面向一线业务端（如实时风控、客户画像、经营报表），通常是对数仓加工后的结果数据进行即时查询，对查询响应速度和高可用有着严格要求——业务人员往往需要在秒级甚至毫秒级获取查询结果，且不能出现因集群问题导致的查询中断，否则会直接影响业务正常运转。</li>
</ul>
<h2 data-id="heading-1">解决方案：查算分离架构设计</h2>
<p>正因如此，我们意识到，<strong>要兼顾数据仓库“计算”的效率与业务“查询”的性能，“查算分离”架构是必然之选</strong>。该架构旨在将“计算”和“查询”的负载拆分到不同的集群中，使它们在各自专属的资源环境下运行。这样既能够充分发挥数据仓库的计算能力，又能确保业务查询的响应时间和稳定性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77a0e6418dbc4fcf8f35eb075058a46b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=dQcplujt8sVTy0n6PN6PA3wxORs%3D" alt="2-解决方案：查算分离架构设计.PNG" loading="lazy"/></p>
<p>结合上图所示的存算分离架构，我们通过以下四个方面的设计，系统性地实现了查算分离目标：</p>
<ol>
<li><strong>查询低延迟保障</strong>：
为确保查询的低延迟，在 Doris 中部署了独立的查询集群，实现与计算集群的物理资源隔离，从根本上避免批量任务对线上查询的干扰。</li>
<li><strong>数据实时同步</strong>：
为打通计算与查询集群之间的数据链路，引入<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F112" target="_blank" title="https://www.selectdb.com/blog/112" ref="nofollow noopener noreferrer">跨集群数据复制功能 CCR</a>，实现表级数据的近实时同步。<strong>CCR 基于 Doris Binlog 的增量物理复制机制，可确保数据产出后快速同步至查询集群，且不影响线上查询性能。基于该能力，已成功上线 500 张表、30TB 数据， 在跑批高峰期主从延迟也能控制在 15 分钟内</strong>。</li>
<li><strong>高可用与容灾</strong>：
我们构建了双集群热备体系，日常将 95% 的查询流量导向查询集群，5% 流量分流至计算集群。通过持续的流量压测，确保两集群随时具备故障切换能力。</li>
<li><strong>成本投入控制</strong>：
在保障查询性能的前提下，为控制整体投入，我们在计算集群中创建了与查询集群规格相近的 Workload Group（查询 WG），并设置资源软限制策略，允许 ETL 任务弹性复用其闲置资源。该设计在常态下显著节约资源，尽管极端故障场景下全量切流可能引发短暂性能波动，但发生概率极低，风险整体可控。</li>
</ol>
<h2 data-id="heading-2">优化实践：性能提升百倍、 CPU 消耗仅 10%</h2>
<p>查询性能优化向来就是一个复杂的课题，它与 SQL 语句写法、数据量的大小、建表的设计等多个因素共同影响，难以一蹴而就。在业务从原有系统迁移至新环境时， 我们暂未针对 Doris 进行优化，因此在业务上线初期遭遇性能挑战：集群 QPS 仅维持在 10 左右，而 CPU 消耗却高达 90%。这样的表现显然无法满足业务正常运转的需求。</p>
<p>为此，我们从分区裁剪、记录过滤、并发执行和查询结果获取这四个维度进行全面的优化。优化后，<strong>查询性能相比之前提升百倍</strong>；在相同负载下，<strong>集群 CPU 消耗从 90% 下降到 10% 内</strong>，效果十分显著。在这次优化过程中，积累了不少实用经验，在此分享给大家。</p>
<p><strong>01 拆分查询 SQL 、优化分区裁剪，查询性能提升 6 倍</strong></p>
<p>下方代码块展示了我们最常见的 SQL 模板，其典型特征是根据 <code>etl_job_flag</code> 表中记录的数据产出时间筛选最新的业务数据。由于分区字段 <code>data_dt</code> 的查询条件是一个子查询，导致 Doris 在执行时无法动态裁剪分区，只能扫描所有历史分区，从而产生大量无效 IO。</p>
<p>我们对其进行了优化，首先将查询 SQL 拆分成两条 SQL 语句，先获取数据产出时间，再查询目标数据。其次将分区字段 <code>data_dt</code> 的条件调整为常量，限制其只扫描一个分区。<strong>通过该优化，实现了查询性能 6 倍的提升</strong>。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>  原始 <span class="hljs-keyword">SQL</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> data_dt <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(data_dt) <span class="hljs-keyword">from</span> etl_job_flag wehre etl_table <span class="hljs-operator">=</span><span class="hljs-string">'t'</span>) <span class="hljs-keyword">and</span>  其他过滤条件

<span class="hljs-operator">/</span><span class="hljs-operator">/</span>  优化后 <span class="hljs-keyword">SQL</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(busi_dt) <span class="hljs-keyword">from</span> etl_job_flag <span class="hljs-keyword">where</span>  etl_table <span class="hljs-operator">=</span> <span class="hljs-string">'t'</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t  <span class="hljs-keyword">where</span> data_dt  <span class="hljs-operator">=</span> xxx <span class="hljs-keyword">and</span> 其他过滤条件
</code></pre>
<p><strong>02 合理设计 Key 和索引，查询性能提升 6-7 倍</strong></p>
<p>Doris 的记录过滤遵循“成本从低到高”的顺序，依次为 Key Range 、索引过滤、 ZoneMap 和 BloomFilter 等轻量级过滤，最后执行谓词评估。由此可知，合理设计 Key 和索引是提升筛选效率的关键。在实践中，通过补充合适的 Key 和索引，<strong>查询性能获得 6-7 倍的提升</strong>。</p>
<p>以用户信息表 <code>user_info</code> 为例：</p>
<ul>
<li>将高频查询字段 <code>user_id</code>设为 Unique Key 和分桶字段，以利用 Key Range 快速定位数据范围。</li>
<li>对次高频查询字段 <code>user_name</code>建立倒排索引，提高查询效率。</li>
<li>控制分桶大小在 1G～10G，减少 segment 文件数量，提升倒排索引查询速度（Doris 每个 segment 文件对应独立的倒排索引）。</li>
</ul>
<p><strong>03 参数调试， 查询吞吐率提升 2-3 倍</strong></p>
<p>高并发和低响应时间是查询集群的核心需求，适当调整 Doris 的执行相关参数可有效提升查询吞吐量</p>
<ul>
<li><code>parallel_pipeline_task_num</code>：Pipeline task 是 Doris 执行调度的基本单元，<code>parallel_pipeline_task_num</code> 决定了单个查询的最大并发度。该参数的默认值为 0，即 BE CPU 核心数的一半。</li>
<li><code>num_scanner_threads</code>：Scan 算子负责数据扫描，为 Pipeline task 提供数据。<code>num_scanner_threads</code> 是单个 Scan 算子一次性提交到 Scan 线程池的任务数量，它直接影响查询扫描数据的并发度。该参数默认值也为 0，动态计算。</li>
</ul>
<p>如果将两个参数的默认值设置为高值，可能导致单一查询占用过多资源，进而引发 CPU 缓存污染。根据实际应用经验以及测试结果，建议可将 <code>parallel_pipeline_task_num</code> 设置为 8，将 <code>num_scanner_threads</code> 设置为 2，<strong>查询吞吐率可提升 2 - 3 倍</strong>。此处作为参考，具体数值可根据实际业务情况来调整。</p>
<p><strong>04  开启行存、降低 IO 开销，查询性能提升 30%</strong></p>
<p>在业务中，如果存在大量 <code>SELECT *</code> 的全列查询，Doris 将默认采用按列存储的方式，该方式需要读取所有列并拼接成行返回。而对于字段较多的表，这并不是最佳处理方式，会导致极高的 IO 成本。</p>
<p>因此，我们在建表或修改表时配置 <code>"store_row_column" = "true"</code>，开启行存模式。避免了多列拼接的额外开销，<strong>查询性能提升约 30%</strong>。</p>
<h2 data-id="heading-3">优化利器：慢查询监测 + 性能压测</h2>
<p><strong>01 报表 + Profile，全局观测慢查询</strong></p>
<p>在性能优化中，慢查询监测为我们提供了关键的数据洞察。通过对慢查询的持续追踪与分析，我们能够快速定位根因、实施针对性优化，并最终验证策略的有效性，确保我们的工作始终朝着正确的方向推进。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a29113ce156a4a67894fd9ec71f3d465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=XgLjH492%2BSTl%2F9H%2BmDNANoe%2FklA%3D" alt="3-优化利器：慢查询监测 + 性能压测.png" loading="lazy"/></p>
<p>作为监控集群查询状态的核心入口，<strong>查询报表在全局观测中扮演着重要角色</strong>。它基于审计日志（Audit log）及其他系统表构建，包括慢查询榜单、响应时间统计和错误统计等信息。</p>
<p><strong>Doris Profile 能够详细记录查询执行的统计信息</strong>，包括执行计划、每个算子的耗时和数据扫描量等，为定位查询性能问题提供了关键依据。Doris 默认的 Profile 存储机制是保存在内存中，默认保留 500 个；而我们因业务需求，需对 3 天内历史查询问题进行保留，以便问题追溯。因此，<strong>我们基于 Doris Profile 开发了 Profile 归档服务</strong>。</p>
<p><strong>具体工作原理为</strong>：当查询报表识别出慢查询时，Profile 归档服务会自动从 Doris 集群下载对应的 Profile 文件并保存至本地，同时生成专属的 HTTP 链接。管理员在浏览慢查询报表时，只需点击链接，即可直接查看对应的完整 Profile，无需担心因内存中 Profile 被清理而失去关键诊断信息，从而显著提升历史问题追溯的效率。</p>
<p>我们已在集群全局启用 Profile 功能，并将 <code>auto_profile_threshold_ms</code> 设置为 1000ms，这意味着所有执行时长超过 1 秒的查询都会自动记录 Profile，为后续分析提供充分的诊断依据。</p>
<p>查询报表与 Profile 的联动，构建了一套高效的性能优化闭环。一旦集群出现异常，报表会通过内部 IM 自动告警，管理员随即针对慢查询榜单，借助 Profile 进行深度分析、精准定位瓶颈。整个过程形成了从发现问题、精准定位到解决跟踪的完整闭环。</p>
<p><strong>02 查询压测工具，容量评估模拟器</strong></p>
<p>此外，我们基于 Python 开发了查询压测工具，用于上线新业务、扩容集群或优化配置之前，准确评估 Doris 集群的承载能力。</p>
<p>其设计理念是还原真实负载：从 Doris Audit log 中提取历史查询记录，通过多线程随机回放的方式，模拟生产环境中的实际查询压力。在压测过程中，工具会实时统计查询吞吐量、响应时间分布等关键指标。通过这些数据，我们能够评估集群的容量上限，或验证优化措施的有效性，为集群的资源规划与架构调整提供重要依据。</p>
<h2 data-id="heading-4">结束语</h2>
<p>通过以上优化，<strong>Doris 查询集群不仅实现了每日超 700 万次查询的稳定运行，99.95% 的查询响应时间均在 1 秒以内，更在压测中达到了 1500 QPS</strong>，充分验证了其已具备支撑实时查询的高性能与高稳定性，为 Doris 在湖仓一体平台中深度应用中扫清关键障碍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今夜，智谱把“手机贾维斯”的源代码，扔到了GitHub上]]></title>    <link>https://juejin.cn/post/7581698635865604122</link>    <guid>https://juejin.cn/post/7581698635865604122</guid>    <pubDate>2025-12-09T15:00:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698635865604122" data-draft-id="7581698635865587738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今夜，智谱把“手机贾维斯”的源代码，扔到了GitHub上"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-09T15:00:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今夜，智谱把“手机贾维斯”的源代码，扔到了GitHub上
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:00:33.000Z" title="Tue Dec 09 2025 15:00:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年12月9日，科技圈发生了一件可能会被载入AI发展史的大事。</p>
<p>当大部分人还在讨论哪家的大模型写诗更押韵时，智谱AI默默干了一件事：他们把自家的核心AI Agent模型——AutoGLM，正式开源了。</p>
<p>这不仅仅是开源了一个模型，更像是把一把通往“真·智能手机”时代的钥匙，交到了每一个开发者，甚至是普通玩家手里。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasdasf-1.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asdasf-1.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3d85c176f01409eb4443c924789aaa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897233&amp;x-signature=NGPImYzvseZJKORyivXGpSYr%2BZg%3D" alt="asdasf" loading="lazy"/></a></p>
<h3 data-id="heading-0">真的能看懂屏幕的AI</h3>
<p>先别急着划走，我们得搞清楚AutoGLM和Siri、小爱同学到底有什么区别。</p>
<p>传统的语音助手，本质上是在调用APP提供的接口。如果APP不开接口，助手就是个瞎子。但AutoGLM走的是一条完全拟人的路子：<strong>视觉理解</strong>。</p>
<p>简单说，它像人眼一样“看”你的手机屏幕截图，用大模型分析界面上的按钮、文字、输入框在哪里，然后通过ADB指令模拟手指的点击和滑动。</p>
<p>这意味着什么？意味着它不需要微信给你开API，也能帮你回消息；不需要美团授权，也能帮你点外卖。</p>
<p>在智谱放出的演示里，这个9B参数量的模型（AutoGLM-Phone-9B），已经能熟练地在微信、淘宝、抖音、美团等50多个我们每天都在用的APP里“冲浪”。点外卖、订机票、发红包，这些需要跨应用、甚至长达几十步的操作，它都能自己搞定。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fv2-e6b5d85ff6306e3bd6990d1cca6ec2aa_r-1024x756.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/v2-e6b5d85ff6306e3bd6990d1cca6ec2aa_r-1024x756.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e22e6c80543d4f9d950ae9136e7f23b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897233&amp;x-signature=TormdyNj%2B%2Bv8DVN78bedx5G09T8%3D" alt="v2-e6b5d85ff6306e3bd6990d1cca6ec2aa_r" loading="lazy"/></a></p>
<h3 data-id="heading-1">为什么说这是“掀桌子”？</h3>
<p>在前段时间，字节跳动的“豆包手机助手”刚让大家见识了AI操作手机的威力。就在各大巨头准备筑起高墙、圈地自萌的时候，智谱反手就是一个开源。</p>
<p>这一招，直接把技术门槛拉到了地板上。</p>
<p><strong>1. 每个人都能有自己的定制管家</strong> 开源意味着硬件厂商不用从头造轮子，华强北的开发者、甚至是你我这样懂点代码的极客，都可以基于AutoGLM，为自己的设备装上一个“大脑”。想做一个专门帮你抢演唱会门票的Agent？或者一个只在这个点帮你自动领游戏签到奖励的脚本？现在，底座有了。</p>
<p><strong>2. 隐私狂魔的福音</strong> 这是开源最核心的杀手锏。很多人不敢用云端AI操作手机，怕隐私泄露。AutoGLM支持本地部署。只要你的设备跑得动，所有的数据处理、屏幕识别、操作指令，全部都在你本地完成，不需要上传任何一字节的敏感信息给云端服务器。你的手机，完全由你掌控。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-09_22.55.13-811x1024.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-09_22.55.13-811x1024.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e3bdb5386094ef38c78fcf15d03092a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897233&amp;x-signature=bu5%2BX0h7kAEjL8bpQO7DqTlkYn4%3D" alt="iShot_2025-12-09_22.55.13" loading="lazy"/></a></p>
<h3 data-id="heading-2">32个月的磨剑</h3>
<p>这个项目不是一时兴起。据透露，智谱团队从2023年4月就开始折腾这事儿了。</p>
<p>早期的版本很不稳定，像个刚学步的孩子，经常点错或者卡住。经过32个月的打磨，特别是AutoGLM 2.0版本，在数千个虚拟设备里进行了强化学习，现在的它已经具备了相当强悍的泛化能力。也就是说，哪怕APP更新了，界面微调了，它依然能认出“确认支付”的按钮在哪。</p>
<h3 data-id="heading-3">下一代手机的雏形</h3>
<p>我们总在喊“AI手机”元年，但如果AI手机只是多了一个画图功能，那未免太无聊了。</p>
<p>真正的AI手机，应该是你对它说“帮我订张明天去上海的票，要靠窗”，然后你就可以把手机扔一边去洗澡，出来时票已经出好了。AutoGLM的开源，正在把这个场景变成所有安卓设备的标配，而不再是某一款旗舰机的专属。</p>
<p>目前，项目代码已经托管在GitHub，模型权重也上了Hugging Face。虽然现在它可能还不够完美，偶尔也会犯傻，但开源社区的力量是恐怖的。也许下周，就会有大神魔改出更惊艳的版本。</p>
<p>对于开发者来说，这是风口；对于普通用户来说，那个像《钢铁侠》里贾维斯一样的管家，可能真的不远了。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-09_22.55.08.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-09_22.55.08.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5ce46e99ca746499509b606a47c3b9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897233&amp;x-signature=u38J41ooWuF1Itwm8uTDpMakHgw%3D" alt="iShot_2025-12-09_22.55.08" loading="lazy"/></a></p>
<p><strong>最后提个醒：</strong> 虽然代码开源了，但在让AI帮你花钱或者发消息之前，记得把那个“关键操作需人工确认”的开关打开。毕竟，你也不想一觉醒来，发现AI帮你清空了购物车，对吧？</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[屌炸天！一句话搞定一个商用级的商城列表页面]]></title>    <link>https://juejin.cn/post/7581676787380174867</link>    <guid>https://juejin.cn/post/7581676787380174867</guid>    <pubDate>2025-12-09T15:01:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787380174867" data-draft-id="7581678032336764970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="屌炸天！一句话搞定一个商用级的商城列表页面"/> <meta itemprop="keywords" content="Trae,AI编程,HTML"/> <meta itemprop="datePublished" content="2025-12-09T15:01:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="威哥爱编程"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            屌炸天！一句话搞定一个商用级的商城列表页面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    威哥爱编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:01:50.000Z" title="Tue Dec 09 2025 15:01:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 V 哥，TRAE SOLO 实在太好用了，输入一句话，就可以生成一个你想要的程序，上一篇文章，V 哥试了一下一句话生成一个简易版的飞机大战，今天我们来玩一玩生成一个商城商品列表页面，废话不多说，马上开整。</p>
<p>先来看一下最终的效果图：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0defe0a98df34fbc98298684e6e8a67a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897310&amp;x-signature=CfKbgLnm5%2BnA6%2BvtbpUkpYyjAhI%3D" alt="" loading="lazy"/></p>
<p>首先打开 TRAE AI 开发工具，新建一个任务，如下图：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19088870d2554702aa7343d39c997855~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897310&amp;x-signature=Q%2F%2FsB%2BM232Na1BWfAHIHJ4BkSzw%3D" alt="" loading="lazy"/></p>
<p>在聊天窗口输入：请帮我生成一个V哥商城的商品列表页面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7963fc8cda3747cd9a73abe51bb29cbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897310&amp;x-signature=xaWVcB05fmYiTrNrg7i0DRpxvi0%3D" alt="" loading="lazy"/></p>
<p>咔咔咔，RRAE SOLO 就开始工作了，生成的过程是这样的：</p>
<pre><code class="hljs language-markdown" lang="markdown">我需要先了解当前项目的结构和技术栈，然后生成V哥商城的商品列表页面。
<span class="hljs-code">        
            
toolName: view_folder
            
status: success
          
/Users/vince/Trae/demo1
          
让我先查看index.html文件的内容，了解当前页面结构。
        
            
toolName: view_files
            
status: success
          
            
filePath: /Users/vince/Trae/demo1/index.html
          
现在查看script.js文件，了解当前的JavaScript逻辑。
        
            
toolName: view_files
            
status: success
          
            
filePath: /Users/vince/Trae/demo1/script.js
          
现在查看style.css文件，了解当前的样式设计。
        
            
toolName: view_files
            
status: success
          
            
filePath: /Users/vince/Trae/demo1/style.css
          
现在我需要运行项目，查看实际效果，确保页面正常显示。
        
            
toolName: run_command
            
status: running
          
command: python3 -m http.server 8000 undefined
          
服务器已成功启动，现在预览页面效果。
        
            
toolName: open_preview
            
status: success
          
预览
          
页面标题需要从“京东商品列表”修改为“V哥商城”，让我更新index.html文件。
        
            
toolName: edit_file_search_replace
            
status: success
          
            
filePath: /Users/vince/Trae/demo1/index.html
          
changes: undefined
          
我已经成功生成了“V哥商城”的商品列表页面。以下是完成的工作：
</span>
<span class="hljs-section">## 页面特点</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**完整的商城布局**</span>
<span class="hljs-bullet">   -</span> 顶部导航栏（含logo、搜索框、用户功能）
<span class="hljs-bullet">   -</span> 分类导航菜单
<span class="hljs-bullet">   -</span> 商品筛选栏
<span class="hljs-bullet">   -</span> 响应式商品列表
<span class="hljs-bullet">   -</span> 页脚信息

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**丰富的功能**</span>
<span class="hljs-bullet">   -</span> 商品搜索功能
<span class="hljs-bullet">   -</span> 分类筛选功能
<span class="hljs-bullet">   -</span> 排序功能
<span class="hljs-bullet">   -</span> 商品卡片悬停效果
<span class="hljs-bullet">   -</span> 返回顶部按钮
<span class="hljs-bullet">   -</span> 移动端适配（汉堡菜单）

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**美观的设计**</span>
<span class="hljs-bullet">   -</span> 现代化的UI设计
<span class="hljs-bullet">   -</span> 清晰的商品信息展示（图片、标题、价格、销量、店铺）
<span class="hljs-bullet">   -</span> 商品标签（热卖、新品、优惠）
<span class="hljs-bullet">   -</span> 响应式布局，适配各种设备尺寸

<span class="hljs-bullet">4.</span> <span class="hljs-strong">**技术实现**</span>
<span class="hljs-bullet">   -</span> 使用HTML、CSS、JavaScript开发
<span class="hljs-bullet">   -</span> 响应式设计，适配移动端、平板和桌面端
<span class="hljs-bullet">   -</span> 动态生成商品列表
<span class="hljs-bullet">   -</span> 流畅的交互效果

<span class="hljs-section">## 文件修改</span>

<span class="hljs-bullet">-</span> 更新了<span class="hljs-code">`index.html`</span>文件，将页面标题从“京东商品列表”改为“V哥商城”

<span class="hljs-section">## 访问地址</span>

页面已通过本地HTTP服务器启动，您可以通过以下地址访问：
http://localhost:8000

页面已经完全可用，包含了商城商品列表的所有基本功能和美观的设计。
</code></pre>
<p>搞定！</p>
<p>我们来看一下生成的代码，一共是3个文件：</p>
<ol>
<li>index.html页面</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>V哥商城<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"style.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 顶部导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-top"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-shopping-cart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>V 哥商城<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-box"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"搜索商品"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-search"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-info"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-user"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 收藏<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-shopping-bag"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 购物车<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 汉堡菜单按钮 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hamburger-menu"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-bars"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-nav"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>手机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>电脑<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>家电<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>服装<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>美妆<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>食品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>运动<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主体内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 筛选栏 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-bar"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-item"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-label"</span>&gt;</span>分类：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link active"</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>手机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>电脑<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>平板<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-item"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-label"</span>&gt;</span>排序：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link active"</span>&gt;</span>综合<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>销量<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>价格<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-link"</span>&gt;</span>评价<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 商品列表 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-list"</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 商品项将通过JavaScript动态生成 --&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 返回顶部按钮 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"back-to-top"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"backToTop"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-arrow-up"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 底部 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"footer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2024 V 哥商城 版权所有<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ol start="2">
<li>style.css 样式表</li>
</ol>
<pre><code class="hljs language-css" lang="css">* {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, <span class="hljs-string">'Helvetica Neue'</span>, Arial, sans-serif;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
}

<span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">1200px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}

<span class="hljs-comment">/* 顶部导航栏 */</span>
<span class="hljs-selector-class">.header</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">position</span>: sticky;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">100</span>;
}

<span class="hljs-selector-class">.header-top</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: space-between;
}

<span class="hljs-selector-class">.logo</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
}

<span class="hljs-selector-class">.logo</span> <span class="hljs-selector-tag">i</span> {
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.search-box</span> {
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">500px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">display</span>: flex;
}

<span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">input</span> {
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">border-right</span>: none;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">outline</span>: none;
}

<span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">button</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#c81623</span>;
}

<span class="hljs-selector-class">.user-info</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.user-info</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.user-info</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
}

<span class="hljs-selector-class">.user-info</span> <span class="hljs-selector-tag">i</span> {
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5px</span>;
}

<span class="hljs-comment">/* 汉堡菜单 */</span>
<span class="hljs-selector-class">.hamburger-menu</span> {
    <span class="hljs-attribute">display</span>: none;
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.header-nav</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">transition</span>: max-height <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">ul</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">list-style</span>: none;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">li</span> {
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">30px</span>;
}

<span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#c81623</span>;
}

<span class="hljs-comment">/* 主体内容 */</span>
<span class="hljs-selector-class">.main</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">/* 筛选栏 */</span>
<span class="hljs-selector-class">.filter-bar</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">40px</span>;
}

<span class="hljs-selector-class">.filter-item</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">flex-wrap</span>: wrap;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.filter-label</span> {
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.filter-link</span> {
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}

<span class="hljs-selector-class">.filter-link</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.filter-link</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}

<span class="hljs-comment">/* 商品列表 */</span>
<span class="hljs-selector-class">.product-list</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">5</span>, <span class="hljs-number">1</span>fr);
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-selector-class">.product-item</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span>, box-shadow <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
}

<span class="hljs-selector-class">.product-item</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
}

<span class="hljs-selector-class">.product-image</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    aspect-ratio: <span class="hljs-number">1</span> / <span class="hljs-number">1</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-selector-class">.product-image</span> <span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">object-fit</span>: contain;
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
}

<span class="hljs-selector-class">.product-item</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.product-image</span> <span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}

<span class="hljs-selector-class">.product-info</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
}

<span class="hljs-selector-class">.product-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">text-overflow</span>: ellipsis;
    <span class="hljs-attribute">display</span>: -webkit-box;
    -webkit-line-clamp: <span class="hljs-number">2</span>;
    -webkit-box-orient: vertical;
    <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.product-price</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: baseline;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.product-price</span> <span class="hljs-selector-class">.original-price</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    <span class="hljs-attribute">text-decoration</span>: line-through;
    <span class="hljs-attribute">font-weight</span>: normal;
}

<span class="hljs-selector-class">.product-sales</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.sales-count</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.sales-count</span> <span class="hljs-selector-tag">i</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
}

<span class="hljs-selector-class">.shop-name</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.shop-name</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
}

<span class="hljs-selector-class">.product-tags</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-wrap</span>: wrap;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
    <span class="hljs-attribute">margin-top</span>: auto;
}

<span class="hljs-selector-class">.tag</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">3px</span> <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.tag-hot</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff1f0</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#e1251b</span>;
}

<span class="hljs-selector-class">.tag-new</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f6ffed</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#52c41a</span>;
}

<span class="hljs-selector-class">.tag-discount</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff7e6</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#faad14</span>;
}

<span class="hljs-comment">/* 返回顶部按钮 */</span>
<span class="hljs-selector-class">.back-to-top</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">45px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">45px</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e1251b</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">visibility</span>: hidden;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">99</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-selector-class">.back-to-top</span><span class="hljs-selector-class">.visible</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">visibility</span>: visible;
}

<span class="hljs-selector-class">.back-to-top</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#c81623</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">3px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-comment">/* 触摸反馈效果 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-class">.product-item</span>,
    <span class="hljs-selector-class">.filter-link</span>,
    <span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">button</span>,
    <span class="hljs-selector-class">.hamburger-menu</span> {
        -webkit-tap-highlight-<span class="hljs-attribute">color</span>: transparent;
    }
    
    <span class="hljs-selector-class">.product-item</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.98</span>);
    }
    
    <span class="hljs-selector-class">.filter-link</span><span class="hljs-selector-pseudo">:active</span> {
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
    }
}

<span class="hljs-comment">/* 底部 */</span>
<span class="hljs-selector-class">.footer</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">40px</span>;
}

<span class="hljs-comment">/* 响应式设计 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>) {
    <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">95%</span>;
    }
    
    <span class="hljs-selector-class">.product-list</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
    }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">992px</span>) {
    <span class="hljs-selector-class">.product-list</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
    }
    
    <span class="hljs-selector-class">.search-box</span> {
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-class">.header-top</span> {
        <span class="hljs-attribute">flex-direction</span>: row;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.logo</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
    }
    
    <span class="hljs-selector-class">.search-box</span> {
        <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
        <span class="hljs-attribute">max-width</span>: none;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">input</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">35px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
    }
    
    <span class="hljs-selector-class">.search-box</span> <span class="hljs-selector-tag">button</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">35px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    }
    
    <span class="hljs-selector-class">.user-info</span> {
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.user-info</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">span</span> {
        <span class="hljs-attribute">display</span>: none;
    }
    
    <span class="hljs-comment">/* 显示汉堡菜单 */</span>
    <span class="hljs-selector-class">.hamburger-menu</span> {
        <span class="hljs-attribute">display</span>: block;
    }
    
    <span class="hljs-comment">/* 隐藏桌面导航 */</span>
    <span class="hljs-selector-class">.header-nav</span> {
        <span class="hljs-attribute">height</span>: auto;
        <span class="hljs-attribute">max-height</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">overflow</span>: hidden;
    }
    
    <span class="hljs-selector-class">.header-nav</span><span class="hljs-selector-class">.active</span> {
        <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
    }
    
    <span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">ul</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">overflow-x</span>: visible;
        <span class="hljs-attribute">white-space</span>: normal;
    }
    
    <span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">li</span> {
        <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1px</span>;
    }
    
    <span class="hljs-selector-class">.header-nav</span> <span class="hljs-selector-tag">a</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
        <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-class">.filter-bar</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">align-items</span>: flex-start;
    }
    
    <span class="hljs-selector-class">.product-list</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
    }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
    <span class="hljs-selector-class">.product-list</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
    }
}
</code></pre>
<ol start="3">
<li>script.js文件</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟商品数据</span>
<span class="hljs-keyword">const</span> products = [
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'Apple iPhone 15 Pro Max (A3104) 256GB 原色钛金属 支持移动联通电信5G 双卡双待手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">9999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">10999</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">12580</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'Apple官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23FF6B6B%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EiPhone 15%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'hot'</span>, <span class="hljs-string">'discount'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'华为 Mate 60 Pro 麒麟9000S 5G手机 12GB+512GB 雅川青 昆仑玻璃 超可靠玄武架构 卫星通话'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">7999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">8999</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">8920</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'华为官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%234ECDC4%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EMate 60%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>, <span class="hljs-string">'hot'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'小米14 Pro 徕卡光学Summilux镜头 第二代骁龙8 领先版 2K LTPO屏幕 12GB+256GB 钛合金版'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">4999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">5499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">15600</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'小米官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%2345B7D1%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EXiaomi 14%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'hot'</span>, <span class="hljs-string">'discount'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'OPPO Find X7 Ultra 1英寸哈苏影像 第二代骁龙8 2K 120Hz 东方屏 16GB+512GB 大漠银月'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">6499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">6780</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'OPPO官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%2396CEB4%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EFind X7%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'vivo X100 Pro 天玑9300 5G手机 120W闪充 蔡司四摄 12GB+256GB 华夏红 曲面屏'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">4999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">5499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">7890</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'vivo官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23FFEAA7%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22black%22%3Evivo X100%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>, <span class="hljs-string">'hot'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'三星 Galaxy S24 Ultra 5G手机 12GB+256GB 钛灰 骁龙8 Gen3 智能S Pen 2亿像素主摄'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">8999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">9999</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">4560</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'三星官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23DDA0DD%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EGalaxy S24%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'hot'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'荣耀Magic6 Pro 第二代骁龙8旗舰芯片 AI大模型手机 16GB+512GB 燃橙色'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">5699</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">6199</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">5670</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'荣耀官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%2398D8C8%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EMagic6%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'一加 Ace 3 Pro 第二代骁龙8 24GB+1TB 150W超级闪充 120Hz电竞直屏 5G游戏手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">3999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">4499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">9120</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'一加官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23F7DC6F%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22black%22%3EOnePlus Ace3%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'discount'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'realme 真我GT5 Pro 第二代骁龙8 24GB+1TB 240W满级秒充 2K直屏 5G游戏手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">3899</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">4299</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">6780</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'realme官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23BB8FCE%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EGT5 Pro%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'discount'</span>, <span class="hljs-string">'hot'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'Redmi K70 Pro 第二代骁龙8 至尊版 2K 120Hz 中国屏 16GB+512GB 墨羽 5G智能手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">3699</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">3999</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">11230</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'Redmi官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%2385C1E9%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EK70 Pro%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'hot'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">11</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'索尼（SONY）Xperia 1 V 5G智能手机 4K HDR OLED 专业影像 12GB+256GB 黑色'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">8499</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">9499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">2340</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'索尼官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23F8C471%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22black%22%3EXperia 1V%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">12</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'魅族 21 骁龙8 Gen3 无界全面屏 5000mAh电池 12GB+256GB 独白 5G手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">3399</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">3799</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">4560</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'魅族官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%2382E0AA%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3E魅族21%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'discount'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">13</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'努比亚 Z60 Ultra 骁龙8 Gen3 35mm+85mm黄金双焦段 16GB+512GB 黑礁 5G手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">4999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">5499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">3450</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'努比亚官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23F1948A%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EZ60 Ultra%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'new'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">14</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'摩托罗拉 moto edge X50 Pro 骁龙8 Gen3 2K 165Hz 曲屏 12GB+256GB 墨韵黑 5G手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">3999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">4399</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">2890</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'摩托罗拉官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23D2B4DE%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EEdge X50%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'discount'</span>]
    },
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">15</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'iQOO 12 Pro 第二代骁龙8 2K 144Hz E7屏 200W闪充 16GB+512GB 赛道版 5G游戏手机'</span>,
        <span class="hljs-attr">price</span>: <span class="hljs-number">4999</span>,
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-number">5499</span>,
        <span class="hljs-attr">sales</span>: <span class="hljs-number">5670</span>,
        <span class="hljs-attr">shopName</span>: <span class="hljs-string">'iQOO官方旗舰店'</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">'data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23AED6F1%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2224%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22 fill=%22white%22%3EiQOO 12%3C/text%3E%3C/svg%3E'</span>,
        <span class="hljs-attr">tags</span>: [<span class="hljs-string">'hot'</span>]
    }
];

<span class="hljs-comment">// DOM加载完成后执行</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">renderProducts</span>(products);
    <span class="hljs-title function_">initEventListeners</span>();
});

<span class="hljs-comment">// 渲染商品列表</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderProducts</span>(<span class="hljs-params">products</span>) {
    <span class="hljs-keyword">const</span> productList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.product-list'</span>);
    productList.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
    
    products.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> productItem = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
        productItem.<span class="hljs-property">className</span> = <span class="hljs-string">'product-item'</span>;
        
        <span class="hljs-comment">// 生成标签HTML</span>
        <span class="hljs-keyword">const</span> tagsHtml = product.<span class="hljs-property">tags</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> {
            <span class="hljs-keyword">let</span> tagClass = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">switch</span>(tag) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'hot'</span>:
                    tagClass = <span class="hljs-string">'tag-hot'</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'new'</span>:
                    tagClass = <span class="hljs-string">'tag-new'</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'discount'</span>:
                    tagClass = <span class="hljs-string">'tag-discount'</span>;
                    <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;span class="tag <span class="hljs-subst">${tagClass}</span>"&gt;<span class="hljs-subst">${tag === <span class="hljs-string">'hot'</span> ? <span class="hljs-string">'热卖'</span> : tag === <span class="hljs-string">'new'</span> ? <span class="hljs-string">'新品'</span> : <span class="hljs-string">'优惠'</span>}</span>&lt;/span&gt;`</span>;
        }).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
        
        productItem.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="product-image"&gt;
                &lt;img src="<span class="hljs-subst">${product.image}</span>" alt="<span class="hljs-subst">${product.title}</span>"&gt;
            &lt;/div&gt;
            &lt;div class="product-info"&gt;
                &lt;h3 class="product-title"&gt;<span class="hljs-subst">${product.title}</span>&lt;/h3&gt;
                &lt;div class="product-price"&gt;
                    ￥<span class="hljs-subst">${product.price.toFixed(<span class="hljs-number">2</span>)}</span>
                    &lt;span class="original-price"&gt;￥<span class="hljs-subst">${product.originalPrice.toFixed(<span class="hljs-number">2</span>)}</span>&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="product-sales"&gt;
                    &lt;div class="sales-count"&gt;
                        &lt;i class="fas fa-fire"&gt;&lt;/i&gt;
                        已售<span class="hljs-subst">${product.sales.toLocaleString()}</span>
                    &lt;/div&gt;
                    &lt;a href="#" class="shop-name"&gt;<span class="hljs-subst">${product.shopName}</span>&lt;/a&gt;
                &lt;/div&gt;
                &lt;div class="product-tags"&gt;
                    <span class="hljs-subst">${tagsHtml}</span>
                &lt;/div&gt;
            &lt;/div&gt;
        `</span>;
        
        <span class="hljs-comment">// 添加商品点击事件</span>
        productItem.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 这里可以添加商品详情页跳转逻辑</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'商品被点击:'</span>, product.<span class="hljs-property">id</span>);
        });
        
        productList.<span class="hljs-title function_">appendChild</span>(productItem);
    });
}

<span class="hljs-comment">// 初始化事件监听器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initEventListeners</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 汉堡菜单交互</span>
    <span class="hljs-keyword">const</span> hamburgerMenu = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.hamburger-menu'</span>);
    <span class="hljs-keyword">const</span> headerNav = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.header-nav'</span>);
    
    hamburgerMenu.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        headerNav.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'active'</span>);
    });
    
    <span class="hljs-comment">// 筛选链接点击事件</span>
    <span class="hljs-keyword">const</span> filterLinks = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.filter-link'</span>);
    filterLinks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">link</span> =&gt;</span> {
        link.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
            e.<span class="hljs-title function_">preventDefault</span>();
            
            <span class="hljs-comment">// 移除同组其他链接的active类</span>
            <span class="hljs-keyword">const</span> parent = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.filter-item'</span>);
            parent.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.filter-link'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> {
                l.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
            });
            
            <span class="hljs-comment">// 添加当前链接的active类</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
            
            <span class="hljs-comment">// 这里可以添加筛选逻辑</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'筛选:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">textContent</span>);
        });
    });
    
    <span class="hljs-comment">// 导航链接点击事件</span>
    <span class="hljs-keyword">const</span> navLinks = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.header-nav a'</span>);
    navLinks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">link</span> =&gt;</span> {
        link.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
            e.<span class="hljs-title function_">preventDefault</span>();
            
            <span class="hljs-comment">// 移除其他链接的active类</span>
            navLinks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">l</span> =&gt;</span> {
                l.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
            });
            
            <span class="hljs-comment">// 添加当前链接的active类</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
            
            <span class="hljs-comment">// 在移动端点击导航后关闭菜单</span>
            headerNav.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
            
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'导航到:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">textContent</span>);
        });
    });
    
    <span class="hljs-comment">// 搜索功能</span>
    <span class="hljs-keyword">const</span> searchBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.search-box button'</span>);
    <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.search-box input'</span>);
    
    searchBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> keyword = searchInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
        <span class="hljs-keyword">if</span> (keyword) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'搜索:'</span>, keyword);
            <span class="hljs-comment">// 这里可以添加搜索逻辑</span>
            <span class="hljs-keyword">const</span> filteredProducts = products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> 
                product.<span class="hljs-property">title</span>.<span class="hljs-title function_">includes</span>(keyword)
            );
            <span class="hljs-title function_">renderProducts</span>(filteredProducts);
        }
    });
    
    <span class="hljs-comment">// 回车键搜索</span>
    searchInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keypress'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
            searchBtn.<span class="hljs-title function_">click</span>();
        }
    });
    
    <span class="hljs-comment">// 返回顶部按钮功能</span>
    <span class="hljs-keyword">const</span> backToTopBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'backToTop'</span>);
    
    <span class="hljs-comment">// 滚动检测</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span> &gt; <span class="hljs-number">300</span>) {
            backToTopBtn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'visible'</span>);
        } <span class="hljs-keyword">else</span> {
            backToTopBtn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'visible'</span>);
        }
    });
    
    <span class="hljs-comment">// 点击返回顶部</span>
    backToTopBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({
            <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
        });
    });
    

}

<span class="hljs-comment">// 格式化价格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatPrice</span>(<span class="hljs-params">price</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'￥'</span> + price.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
}

<span class="hljs-comment">// 格式化销量</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatSales</span>(<span class="hljs-params">sales</span>) {
    <span class="hljs-keyword">if</span> (sales &gt;= <span class="hljs-number">10000</span>) {
        <span class="hljs-keyword">return</span> (sales / <span class="hljs-number">10000</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">1</span>) + <span class="hljs-string">'万'</span>;
    }
    <span class="hljs-keyword">return</span> sales.<span class="hljs-title function_">toLocaleString</span>();
}
</code></pre>
<p>我们可以看到，图片的位置是用 svg 色块绘制出来的，我们可以很方便的替换成自己想要的图片素材。</p>
<p>生成完成后，我们来看一下最终的页面效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac970f94f8fa4800a6aef1153aefb2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897310&amp;x-signature=MIGXW9QPzpDu37cuPAtsHFGDn9Y%3D" alt="image.png" loading="lazy"/>
页面里自动有了一些简单的交互效果，太棒了！看到这里，你是不是也跟 V 哥一样有相同的想法，我 TMD 再也不用前端给我画页面，后端的小伙伴可以直接把前端开发的活给包了，^_^，这里，有前端的小伙伴一定不服，“想要挤掉我们前端的工作，没门！”，说实话，如果你只会前端，那你的工作真的会被 AI 所取代，AI 时代，让程序员们都成为了全栈开发，如果你是前端，可要抓紧学习后端开发了，要不然真的危险了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌握原型链，写出不翻车的 JS 继承]]></title>    <link>https://juejin.cn/post/7581664445241524239</link>    <guid>https://juejin.cn/post/7581664445241524239</guid>    <pubDate>2025-12-09T13:16:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581664445241524239" data-draft-id="7581670270844665896" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌握原型链，写出不翻车的 JS 继承"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-09T13:16:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="谎言西西里"/> <meta itemprop="url" content="https://juejin.cn/user/332466136029851"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌握原型链，写出不翻车的 JS 继承
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/332466136029851/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    谎言西西里
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T13:16:49.000Z" title="Tue Dec 09 2025 13:16:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">原型与原型链基础</h2>
<p>在学习之前需要回顾一下这些基础知识</p>
<ul>
<li><strong><code>prototype</code></strong> 是<strong>所有函数</strong>都包含的一个属性（对象），而对于内置构造函数通常在上面预定义了部分方法，例如：<code>.push</code>、<code>.toString</code>等。</li>
<li><strong><code>__proto__</code></strong> 是<strong>所有 JS 对象</strong>都有的一个内部属性，指向该对象的原型对象（即父对象的prototype）。</li>
<li><strong><code>constructor</code></strong> <strong>每个 <code>prototype</code> 对象</strong>都有一个默认的 <code>constructor</code> 属性，指回其构造函数。</li>
</ul>
<p>不妨来看个例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 构造函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
} 

<span class="hljs-keyword">const</span> alice = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Alice'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(alice.<span class="hljs-property">__proto__</span>) <span class="hljs-comment">// Person.prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>) <span class="hljs-comment">// Person</span>
</code></pre>
<p>而它的原型链就是：</p>
<pre><code class="hljs language-bash" lang="bash">// --&gt; 代表.__proto__属性
alice --&gt; Person.prototype --&gt; Object.prototype --&gt; null（所有原型链的终点都是 null）
</code></pre>
<h2 data-id="heading-1">四种原型继承方式详解</h2>
<h3 data-id="heading-2">1. 直接赋值父类原型（不推荐）</h3>
<p>先来看一个例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 父类构造函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"动物"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">color, name, age</span>) {
    <span class="hljs-comment">// 继承父类的属性</span>
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [name, age]);
    <span class="hljs-comment">// 使用 .call 也可以</span>
    <span class="hljs-comment">// Animal.call(this, name, age);</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}
        
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>; <span class="hljs-comment">// 指向父类原型</span>
</code></pre>
<blockquote>
<p>补充一下 <code>call</code> 和 <code>apply</code> 的区别：</p>
<ul>
<li><code>call</code> 是 <strong>逐个传参</strong>，即：<code>fn.call(this, arg1, arg2, ...)</code></li>
<li><code>apply</code> 是 <strong>数组传参</strong>，即：<code>fn.apply(this, [arg1, arg2, ...])</code></li>
</ul>
</blockquote>
<p>这样做下来感觉并没有什么不合适，继承了父类的属性，同时也指向了父类的原型对象。但是这样并不完整，因为如果调用子类的<code>prototype</code>上的<code>constructor</code>属性，正确的继承应该是指向子类自身。</p>
<p>而当我们在代码中执行<code>console.log(Cat.prototype.constructor)</code>最后得到的结果却是 <code>Animal</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc0137010d1541eb9a48b216f2d4aba7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891009&amp;x-signature=qsZI2cQm%2BcPZPrhlcTexOBIAIuA%3D" alt="image.png" loading="lazy"/></p>
<p>所以在最后还需要<strong>手动修复构造函数指向</strong>，即添加：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;
</code></pre>
<p>但是这样做并非万无一失，在这里我们需要了解 JS 的一个特性，那就是 <strong>引用式赋值</strong> 。在 JS 中，基本数据类型（8种）是<strong>按值赋值</strong>的，而对象类型是<strong>按引用赋值</strong>的</p>
<p><strong>引用式赋值</strong>：指当我将一个对象赋值给另一个变量时，并不是复制了这个对象本身，而是复制了对象在内存中的地址引用，这样就导致两个变量都指向同一个内存位置，不论修改哪个都会对另一个造成影响。</p>
<p>举个最简单的例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> obj1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> };
<span class="hljs-keyword">let</span> obj2 = obj1;      <span class="hljs-comment">// 引用式赋值</span>
obj2.<span class="hljs-property">name</span> = <span class="hljs-string">'Bob'</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">name</span>); <span class="hljs-comment">// "Bob"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1 === obj2); <span class="hljs-comment">// true（指向同一对象）</span>
</code></pre>
<p>回到我们的继承函数，里面就有一个是引用式赋值</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
</code></pre>
<p>这就导致了当我们在<code>Cat.prototype</code>上添加方法还是什么的，会污染<code>Animal.prototype</code>，所以尽量别使用直接赋值父类原型</p>
<h3 data-id="heading-3">2. 原型链继承（有点缺点）</h3>
<p>我们将上面的例子拿下来</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"动物"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">color, name, age</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [name, age]);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}
</code></pre>
<p>但是我们这里使用原型链式继承</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); 
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>; <span class="hljs-comment">// 修复构造函数指向     </span>
</code></pre>
<p>而这里需要了解一下 <code>new</code> 的伪代码了</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 伪代码 new Animal()</span>
<span class="hljs-keyword">let</span> obj = {};
<span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(obj); <span class="hljs-comment">// 也可以用 apply</span>
obj.<span class="hljs-property">__proto__</span> = <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
<span class="hljs-keyword">return</span> obj
</code></pre>
<p>首先创建一个空对象，再将父类的<code>this</code>指向空对象，并将空对象的<code>__proto__</code>指向父类的<code>prototype</code>，也就是连上原型链，最后再返还这个空对象。</p>
<p>但是需要注意的是，这里后续创建的所有实例都是共享父类的属性的，在任意一个实例中对父类属性进行修改都会对其他实例造成影响，例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span> = [<span class="hljs-string">'red'</span>, <span class="hljs-string">'blue'</span>]; <span class="hljs-comment">// 引用类型属性</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// 所有 Cat 实例共享 colors</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();
cat1.<span class="hljs-property">colors</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'green'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">colors</span>); <span class="hljs-comment">// ['red', 'blue', 'green'] 共享引用</span>
</code></pre>
<h3 data-id="heading-4">3. 空对象中介模式（经典解决方案）</h3>
<p>在直接赋值中，不论怎样都会对父类造成影响，那么如果我们在 父类和子类 中间找一个中介来隔断，是不是就能解决这个问题，而这也是我们最经典的解决方法----空对象中介模式</p>
<p>依旧将前面的例子拿来：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"动物"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">color, name, age</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [name, age]);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}
</code></pre>
<p>不妨来看看中介模式是怎么使用的</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}; <span class="hljs-comment">// 空对象中介</span>
F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;
</code></pre>
<p>其中我们将<code>F.prototype</code>直接继承<code>Animal.prototype</code>，虽然会导致 引用式赋值，但是只要我对<code>Cat.prototype</code>修改不对<code>F</code>造成影响，那么间接对<code>Animal</code>就没有影响。</p>
<p>而最精妙一点就是<code>Cat.prototype = new F();</code>这步，我们根据之前的伪代码可以知道，这步是将<code>Cat.prototype.__proto__ = F.prototype</code>，也就在变相变成<code>Cat.prototype.__proto__ = Animal.prototype</code></p>
<p>那么即使我们对<code>Cat.prototype</code>本身进行重新赋值，或者添加任何其他属性也不会影响<code>Cat.prototype.__proto__</code>，除非我们显示修改它（或者对修改<code>F.prototype</code>）</p>
<h4 data-id="heading-5">拓展：</h4>
<p>当然我们也可以将其写成继承函数（extend），这也算手写题吧 QwQ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">extend</span>(<span class="hljs-params">Parent, Child</span>) {
    <span class="hljs-comment">// 中介函数</span>
    <span class="hljs-keyword">var</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}; <span class="hljs-comment">// 函数表达式（有内存开销，但是因为是空函数问题不大）</span>
    <span class="hljs-comment">// 指向父类原型</span>
    F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    <span class="hljs-comment">// 指向空对象实例</span>
    <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>(); <span class="hljs-comment">// 实例的修改不会影响原型对象</span>
    <span class="hljs-comment">// 修复构造函数指向</span>
    <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>; 
}

<span class="hljs-title function_">extend</span>(<span class="hljs-title class_">Animal</span>, <span class="hljs-title class_">Cat</span>)
</code></pre>
<h3 data-id="heading-6">4. Object.create()（ES5 推荐方式）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;
</code></pre>
<p>以 <code>Animal.prototype</code> 为原型创建新对象，在不污染父类构造函数的前提下，更安全地建立子类到父类的原型链连接，并且更加适配现代继承写法。</p>
<h2 data-id="heading-7">总结</h2>






























<table><thead><tr><th>继承方式</th><th>是否推荐</th><th>说明</th></tr></thead><tbody><tr><td>直接赋值原型</td><td>❌</td><td>污染父类 constructor</td></tr><tr><td>原型链继承</td><td>❌</td><td>引用属性共享问题</td></tr><tr><td>中介函数</td><td>✅（兼容旧环境）</td><td>安全隔离</td></tr><tr><td><code>Object.create()</code></td><td>✅✅</td><td>现代标准，语义清晰</td></tr></tbody></table>
<h3 data-id="heading-8">最佳实践：</h3>
<ol>
<li><strong>属性继承</strong> → 用 <code>Parent.call(this, ...args)</code></li>
<li><strong>方法继承</strong> → 用 <code>Child.prototype = Object.create(Parent.prototype)</code></li>
<li><strong>修复 constructor</strong> → 显式设置 <code>Child.prototype.constructor = Child</code></li>
</ol>
<p>原型继承是 JS 的灵魂。理解 <code>call</code>/<code>apply</code> ，掌握 <code>Object.create</code> 如何安全构建原型链，了解其他构建方法有何不妥，为我们写出健壮的继承结构添一把力</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next AI Draw.io：当AI遇见Draw.io图表绘制]]></title>    <link>https://juejin.cn/post/7581693431739875391</link>    <guid>https://juejin.cn/post/7581693431739875391</guid>    <pubDate>2025-12-09T13:19:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431739875391" data-draft-id="7581678032336650282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next AI Draw.io：当AI遇见Draw.io图表绘制"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2025-12-09T13:19:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next AI Draw.io：当AI遇见Draw.io图表绘制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T13:19:58.000Z" title="Tue Dec 09 2025 13:19:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在AI技术重塑应用格局的时代，智能图表绘制工具正逐渐成为技术文档编写、系统设计与团队协作中不可或缺的利器。过去我常使用 draw.io 制作图表，而最近在 GitHub 上发现了一个为 draw.io 集成 AI 能力的项目——这无疑是为这款工具插上了智能的翅膀。今天，就让我们一起来了解这个令人期待的项目。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5344ca1344ed483486e6f11dd545ae9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891198&amp;x-signature=Hq2ZFHad2lAP55%2BfjN8jf04c5ns%3D" alt="17153200_30108ea40e.png" loading="lazy"/></p>
<p>17153200_30108ea40e.png</p>
<h2 data-id="heading-0">🌟 项目简介</h2>
<p>在当今AI技术飞速发展的背景下，<strong>Next AI Draw.io</strong> 正是一款将人工智能与专业图表绘制完美融合的开源项目。这个基于Next.js的AI驱动图表创建工具，通过自然语言交互，让复杂的技术图表绘制变得前所未有的简单和高效。</p>
<p>想象一下，你只需说“给我画一个云原生微服务架构图”，AI就能在draw.io画布上为你生成专业的架构图表——这正是Next AI Draw.io带给我们的魔法体验。</p>
<p>当前项目在github上已有5.6k star</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">github.com/DayuanJiang…</a></p>
<p>演示地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnext-ai-drawio.jiang.jp%2F" target="_blank" title="https://next-ai-drawio.jiang.jp/" ref="nofollow noopener noreferrer">next-ai-drawio.jiang.jp/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f0a01ae09b346a09db0e27a4662e00f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891198&amp;x-signature=w9Dfq1R1TUXCEUmAqa9qlVvvifc%3D" alt="_20251209_190422.png" loading="lazy"/></p>
<p>_20251209_190422.png</p>
<h2 data-id="heading-1">✨ 核心特性</h2>
<h3 data-id="heading-2">🤖 AI驱动的智能图表创建</h3>
<ul>
<li><strong>自然语言生成图表</strong>：用对话的方式描述你的需求，AI自动生成相应的draw.io图表</li>
<li><strong>多云架构图支持</strong>：特别优化了AWS、GCP、Azure等云服务架构图的生成</li>
<li><strong>图像转图表功能</strong>：上传现有图表或截图，AI帮你自动复制和增强</li>
</ul>
<h3 data-id="heading-3">🎯 专业级图表功能</h3>
<ul>
<li><strong>动画连接器</strong>：在图表元素间创建动态的连接线，让数据流动和关系更直观</li>
<li><strong>完整的版本历史</strong>：每次AI修改都有记录，可以随时回退到之前的版本</li>
<li><strong>多提供商支持</strong>：兼容市面上主流的大语言模型服务</li>
</ul>
<h3 data-id="heading-4">🔧 开发者友好设计</h3>
<ul>
<li><strong>本地API密钥管理</strong>：你的API密钥只保存在浏览器本地，确保数据安全</li>
<li><strong>模块化架构</strong>：清晰的代码结构便于二次开发和定制</li>
<li><strong>完整的类型支持</strong>：基于TypeScript开发，提供优秀的开发体验</li>
</ul>
<h2 data-id="heading-5">🚀 快速部署指南</h2>
<h3 data-id="heading-6">Docker一键部署（推荐）</h3>
<p>对于想要快速体验的用户，Docker是最佳选择：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用OpenAI GPT-4o模型，如果使用代理地址，指定OPENAI_BASE_URL</span>
docker run -d -p 3000:3000 \
  -e <span class="hljs-attr">AI_PROVIDER</span>=openai \
  -e <span class="hljs-attr">AI_MODEL</span>=gpt-<span class="hljs-number">4</span>o \
  -e <span class="hljs-attr">OPENAI_API_KEY</span>=your_openai_key \
  -e <span class="hljs-attr">OPENAI_BASE_URL</span>=your_proxy_url \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>我本地使用的是docker-compose部署，一下是yml内容</p>
<pre><code class="hljs language-ini" lang="ini">services:
  next-ai-draw-io:
  <span class="hljs-comment"># 若官方镜像下载慢，可以使用博主转存的镜像 registry.cn-hangzhou.aliyuncs.com/xjpublic/next-ai-draw-io:latest</span>
    image: ghcr.io/dayuanjiang/next-ai-draw-io:latest 
    container_name: next-ai-draw-io
    restart: unless-stopped
    ports:
      - "3100:3000"
      <span class="hljs-comment"># 我使用的是kimi的模型，OPENAI_BASE_URL改为kimi的地址即可</span>
    environment:
      - <span class="hljs-attr">AI_PROVIDER</span>=openai
      - <span class="hljs-attr">AI_MODEL</span>=kimi-k2-turbo-preview
      - <span class="hljs-attr">OPENAI_BASE_URL</span>=https://api.moonshot.cn/v1
      - <span class="hljs-attr">OPENAI_API_KEY</span>=_API_KEY
</code></pre>
<p>若官方镜像下载慢，可以使用博主转存的镜像 <code>registry.cn-hangzhou.aliyuncs.com/xjpublic/next-ai-draw-io:latest</code></p>
<p>使用以下命令启动项目</p>
<pre><code class="hljs">docker-compose up -d 
</code></pre>
<p>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Fip%3Aport" target="_blank" title="http://ip:port" ref="nofollow noopener noreferrer">http://ip:port</a> 即可使用</p>
<h2 data-id="heading-7">🎨 使用示例</h2>
<h3 data-id="heading-8">创建系统流程图</h3>
<pre><code class="hljs">提示词：设计一个用户登录系统的流程图，包含验证、session管理和错误处理
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43165d4f62346dc8b1c1509c5eff3a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891198&amp;x-signature=9828jyeu%2Fix3HPfjMjto8pB%2Fdmo%3D" alt="ScreenShot_2025-12-09_192048_443.png" loading="lazy"/></p>
<p>ScreenShot_2025-12-09_192048_443.png</p>
<h3 data-id="heading-9">绘制网络拓扑</h3>
<pre><code class="hljs">提示词：绘制一个企业级网络拓扑图，包含防火墙、交换机、路由器和服务器集群
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d6970a5eb9345c1b5f4a9ebf9e00e24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891198&amp;x-signature=ZVGM4DtufbqHXOOM8FIIQztuqn8%3D" alt="ScreenShot_2025-12-09_192735_685.png" loading="lazy"/></p>
<p>ScreenShot_2025-12-09_192735_685.png</p>
<h3 data-id="heading-10">复制和优化现有图表</h3>
<p>上传现有的架构图或设计草图，AI会自动：</p>
<ol>
<li>识别图中的元素和结构</li>
<li>生成规范的draw.io图表</li>
<li>根据需求进行优化和增强</li>
</ol>
<h2 data-id="heading-11">🔌 支持的AI服务商</h2>
<p>Next AI Draw.io支持几乎所有的主流AI服务，让你的选择更加灵活：</p>








































<table><thead><tr><th>服务商</th><th>推荐模型</th><th>特点</th></tr></thead><tbody><tr><td>Anthropic</td><td>Claude 3.5 Sonnet</td><td>对AWS图表特别优化，逻辑推理能力强</td></tr><tr><td>OpenAI</td><td>GPT-4o, GPT-4 Turbo</td><td>通用性强，响应速度快</td></tr><tr><td>Google AI</td><td>Gemini 2.0</td><td>多模态能力强</td></tr><tr><td>DeepSeek</td><td>DeepSeek-R1</td><td>性价比高，中文支持好</td></tr><tr><td>Ollama</td><td>本地模型</td><td>数据安全，完全离线</td></tr><tr><td>Azure OpenAI</td><td>GPT-4</td><td>企业级合规需求</td></tr></tbody></table>
<p>如果你使用的模型不在支持列表中，则可以使用通用openai参照以下配置</p>
<pre><code class="hljs language-ini" lang="ini">- <span class="hljs-attr">AI_PROVIDER</span>=openai     <span class="hljs-comment"># 使用openai，几乎所有模型都兼容openai格式</span>
- <span class="hljs-attr">AI_MODEL</span>=kimi-k2-turbo-preview   <span class="hljs-comment"># 模型名称</span>
- <span class="hljs-attr">OPENAI_BASE_URL</span>=https://api.moonshot.cn/v1 <span class="hljs-comment"># 模型地址</span>
- <span class="hljs-attr">OPENAI_API_KEY</span>=_API_KEY <span class="hljs-comment"># api key</span>
</code></pre>
<h2 data-id="heading-12">💡 使用技巧</h2>
<h3 data-id="heading-13">1. 提供明确的需求</h3>
<p>越详细的描述，AI生成的图表越精准。包括：</p>
<ul>
<li>图表类型（架构图、流程图、时序图等）</li>
<li>使用的图标库（AWS、Azure、GCP或通用）</li>
<li>具体的组件和连接关系</li>
</ul>
<h3 data-id="heading-14">2. 利用版本历史</h3>
<p>每次AI修改都会创建新的版本，你可以：</p>
<ul>
<li>查看每次修改的具体内容</li>
<li>比较不同版本间的差异</li>
<li>随时回退到之前的版本</li>
</ul>
<h3 data-id="heading-15">3. 渐进式优化</h3>
<p>先让AI生成基础框架，然后通过对话逐步优化：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"添加监控告警组件"</span>
<span class="hljs-string">"将所有存储改为SSD"</span>
<span class="hljs-string">"增加灾备恢复流程"</span>
</code></pre>
<h2 data-id="heading-16">🛠️ 开发者进阶</h2>
<h3 data-id="heading-17">项目架构</h3>
<pre><code class="hljs language-bash" lang="bash">app/
├── api/chat/          <span class="hljs-comment"># AI聊天API端点</span>
├── page.tsx           <span class="hljs-comment"># 主页面</span>
components/
├── chat-panel.tsx     <span class="hljs-comment"># 聊天界面</span>
├── history-dialog.tsx <span class="hljs-comment"># 历史记录查看器</span>
lib/
├── ai-providers.ts    <span class="hljs-comment"># AI服务商配置</span>
└── utils.ts           <span class="hljs-comment"># 工具函数</span>
</code></pre>
<h3 data-id="heading-18">添加自定义功能</h3>
<p>如果你想扩展功能，可以：</p>
<ol>
<li>在<code>lib/ai-providers.ts</code>中添加新的AI服务商</li>
<li>修改<code>components/chat-panel.tsx</code>增强用户界面</li>
<li>扩展<code>app/api/chat/route.ts</code>中的AI工具集</li>
</ol>
<h2 data-id="heading-19">📊 性能优化建议</h2>
<h3 data-id="heading-20">模型选择策略</h3>
<ul>
<li><strong>复杂架构图</strong>：推荐使用Claude 3.5 Sonnet或GPT-4</li>
<li><strong>简单流程图</strong>：可以使用GPT-4o或DeepSeek-R1节省成本</li>
<li><strong>本地部署</strong>：考虑使用Ollama+本地模型保证数据安全</li>
</ul>
<h3 data-id="heading-21">成本控制</h3>
<ol>
<li>设置访问密码，防止未授权访问</li>
<li>对于团队使用，考虑配置使用限额</li>
<li>定期检查API使用情况，优化提示词</li>
</ol>
<h2 data-id="heading-22">🔮 未来展望</h2>
<p>随着AI技术的不断发展，Next AI Draw.io也在持续进化：</p>
<ul>
<li><strong>实时协作</strong>：多用户同时编辑和AI辅助</li>
<li><strong>模板库</strong>：预置行业标准图表模板</li>
<li><strong>智能分析</strong>：基于图表内容的智能建议</li>
<li><strong>插件生态</strong>：支持第三方扩展和集成</li>
</ul>
<h2 data-id="heading-23">🎯 结语</h2>
<p>在AI重塑应用的时代，Next AI Draw.io为我们展示了AI如何与传统工具结合，创造出1+1&gt;2的价值。无论你是系统架构师、技术文档工程师，还是项目经理，这个工具都能大幅提升你的工作效率。</p>
<p>通过简单的部署步骤，你就能拥有一个强大的AI图表助手。开源的力量让每个人都能享受到最前沿的技术红利。</p>
<h2 data-id="heading-24">✅ 附: draw-io部署</h2>
<p>docker-compose.yml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">draw:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">jgraph/drawio</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">draw</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">3000</span><span class="hljs-string">:8080</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手动实现 Spring Boot 日志链路追踪，无需引入组件，日志定位更方便！]]></title>    <link>https://juejin.cn/post/7581676787380060179</link>    <guid>https://juejin.cn/post/7581676787380060179</guid>    <pubDate>2025-12-09T13:27:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787380060179" data-draft-id="7581689310643421226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手动实现 Spring Boot 日志链路追踪，无需引入组件，日志定位更方便！"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2025-12-09T13:27:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮皮林551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手动实现 Spring Boot 日志链路追踪，无需引入组件，日志定位更方便！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮皮林551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T13:27:38.000Z" title="Tue Dec 09 2025 13:27:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li>前言</li>
<li>正文</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb5895eea56a4656b663568d1e75a96a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=6S4gnqU5Xr%2FZ94Lw5fsKetV4CLA%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<hr/>
<h2 data-id="heading-0"><strong>前言</strong></h2>
<p>从文章标题就知道，这篇文章是介绍些什么。</p>
<p>这是我一位朋友的问题反馈：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e3908004aa64944b539be89f8692cfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=7EMKwLnTjExdWxrkqRfg%2FAW5nGM%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>好像是的，确实这种现象是普遍存在的。</p>
<p>有时候一个业务调用链场景，很长，调了各种各样的方法，看日志的时候，各个接口的日志穿插，确实让人头大。</p>
<p>模糊匹配搜索日志能解决吗？ 能解决一点点。 但是不能完全呈现出整个链路相关的日志。</p>
<p>那要做到方便，很显然，我们需要的是把同一次的业务调用链上的日志串起来。</p>
<p>什么效果？ 先看一个实现后的效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6ab2ba536984c27a9999c2687177357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=ox7S9MCFXfClrwcQK%2BiZXATyzHM%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>这样下来，我们再配合模糊匹配查找日志，效果不就刚刚的了。</p>
<pre><code class="hljs language-matlab" lang="matlab"><span class="hljs-built_in">cat</span> -n info.<span class="hljs-built_in">log</span> |grep <span class="hljs-string">"a415ad50dbf84e99b1b56a31aacd209c"</span>
</code></pre>
<p>或者</p>
<pre><code class="hljs language-c" lang="c">grep <span class="hljs-number">-10</span> <span class="hljs-string">'a415ad50dbf84e99b1b56a31aacd209c'</span> info.<span class="hljs-built_in">log</span>   （<span class="hljs-number">10</span>是指上下<span class="hljs-number">10</span>行）
</code></pre>
<p>不多说，开整。</p>
<h2 data-id="heading-1"><strong>正文</strong></h2>
<p>惯例，先看一眼这次实战最终工程的结构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eeca86e02240434bb3bc28469f474a37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=Gqm2YBRw7Yn7Hu9G3V1jBjq9k94%3D" alt="185a167e3731a6f0326eae8e559f9c9c.png" loading="lazy"/></p>
<p>图片</p>
<p><strong>①pom.xml 依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--lombok配置--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.16.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<p><strong>②整合logback，打印日志，logback-spring.xml (简单配置下)</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">"false"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--日志存储路径--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"log"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"D:/test/log"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- 控制台输出 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"console"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--输出格式化--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%X{TRACE_ID}]  %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 按天生成日志文件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--日志文件名--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>${log}/%d{yyyy-MM-dd}.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span>
            <span class="hljs-comment">&lt;!--保留天数--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">MaxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">MaxHistory</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%X{TRACE_ID}]  %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
        <span class="hljs-comment">&lt;!--日志文件最大的大小--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">triggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">MaxFileSize</span>&gt;</span>10MB<span class="hljs-tag">&lt;/<span class="hljs-name">MaxFileSize</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">triggeringPolicy</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 日志输出级别 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"console"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"file"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p>application.yml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8826</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">config:</span> <span class="hljs-string">classpath:logback-spring.xml</span>
</code></pre>
<p><strong>③自定义日志拦截器 LogInterceptor.java</strong></p>
<p>用途：每一次链路，线程维度，添加最终的链路ID TRACE_ID。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">MDC</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">lang</span>.<span class="hljs-property">Nullable</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">util</span>.<span class="hljs-property">StringUtils</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">HandlerInterceptor</span>;

<span class="hljs-keyword">import</span> javax.<span class="hljs-property">servlet</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpServletRequest</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">servlet</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpServletResponse</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">UUID</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: JCccc
 * <span class="hljs-doctag">@Date</span>: 2022-5-30 10:45
 * <span class="hljs-doctag">@Description</span>:
 */</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    privatestaticfinal <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">TRACE_ID</span> = <span class="hljs-string">"TRACE_ID"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">preHandle</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> handler</span>) {
        <span class="hljs-title class_">String</span> tid = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        <span class="hljs-comment">//可以考虑让客户端传入链路ID，但需保证一定的复杂度唯一性；如果没使用默认UUID自动生成</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(request.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"TRACE_ID"</span>))){
            tid=request.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"TRACE_ID"</span>);
        }
        <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">TRACE_ID</span>, tid);
        returntrue;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterCompletion</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> handler,
                                <span class="hljs-meta">@Nullable</span> Exception ex</span>) {
        <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-variable constant_">TRACE_ID</span>);
    }

}
</code></pre>
<p>MDC(Mapped Diagnostic Context)诊断上下文映射，是@Slf4j提供的一个支持动态打印日志信息的工具。</p>
<p>WebConfigurerAdapter.java 添加拦截器</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">InterceptorRegistry</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">WebMvcConfigurer</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: JCccc
 * <span class="hljs-doctag">@Date</span>: 2022-5-30 10:47
 * <span class="hljs-doctag">@Description</span>:
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfigurerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">LogInterceptor</span> <span class="hljs-title function_">logInterceptor</span>(<span class="hljs-params"/>) {
        returnnew <span class="hljs-title class_">LogInterceptor</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addInterceptors</span>(<span class="hljs-params">InterceptorRegistry registry</span>) {
        registry.<span class="hljs-title function_">addInterceptor</span>(<span class="hljs-title function_">logInterceptor</span>());
        <span class="hljs-comment">//可以具体制定哪些需要拦截，哪些不拦截，其实也可以使用自定义注解更灵活完成</span>
<span class="hljs-comment">//                .addPathPatterns("/**")</span>
<span class="hljs-comment">//                .excludePathPatterns("/testxx.html");</span>
    }
}
</code></pre>
<p>ps: 其实这个拦截的部分改为使用自定义注解+aop也是很灵活的。</p>
<p>到这时候，其实已经完成，就是这么简单。</p>
<p>我们写个测试接口，看下效果：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"doTest"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">doTest</span>(<span class="hljs-meta">@RequestParam</span>(<span class="hljs-string">"name"</span>) <span class="hljs-title class_">String</span> name) throws <span class="hljs-title class_">InterruptedException</span> {
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"入参 name={}"</span>,name);
    <span class="hljs-title function_">testTrace</span>();
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"调用结束 name={}"</span>,name);
    <span class="hljs-keyword">return</span><span class="hljs-string">"Hello,"</span>+name;
}
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testTrace</span>(<span class="hljs-params"/>){
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"这是一行info日志"</span>);
    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"这是一行error日志"</span>);
    <span class="hljs-title function_">testTrace2</span>();
}
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testTrace2</span>(<span class="hljs-params"/>){
    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"这也是一行info日志"</span>);

}
</code></pre>
<p>效果（OK的）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cb5ab24585640ea96a509db4943ce70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=mYJ4QYjI0%2BRSZQdVAKaz1dq9ebg%3D" alt="942981f88d0519b8db91d48d3bfb7cd4.png" loading="lazy"/></p>
<p>图片</p>
<p>还没完。</p>
<p>接下来看一个场景， 使用子线程的场景：</p>
<p>故意写一个异步线程，加入这个调用里面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b5cbd7125fd45b5b68ba01946d9283c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=PXJMSQcBllC2y9C%2B21TfW7PxYVk%3D" alt="0e36925e12430b60afeec92f33bae252.png" loading="lazy"/></p>
<p>图片</p>
<p>再次执行看开效果，显然子线程丢失了trackId：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76a8b290d2ef4af7ae862c230e7f6cc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=64JskJB6kC4uEaF7uUjCApPYOZw%3D" alt="fd248434242615608dd4494d94c0df56.png" loading="lazy"/></p>
<p>图片</p>
<p>所以我们需要针对子线程使用情形，做调整，思路： 将父线程的trackId传递下去给子线程即可。</p>
<p><strong>①ThreadPoolConfig.java 定义线程池，交给spring管理</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.EnableAsync;
<span class="hljs-keyword">import</span> java.util.concurrent.Executor;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: JCccc
 * <span class="hljs-doctag">@Date</span>: 2022-5-30 11:07
 * <span class="hljs-doctag">@Description</span>:
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> {
    <span class="hljs-comment">/**
     * 声明一个线程池
     *
     * <span class="hljs-doctag">@return</span> 执行器
     */</span>
    <span class="hljs-meta">@Bean(<span class="hljs-string">"MyExecutor"</span>)</span>
    <span class="hljs-keyword">public</span> Executor asyncExecutor() {
        MyThreadPoolTaskExecutor executor = new MyThreadPoolTaskExecutor();
        <span class="hljs-comment">//核心线程数5：线程池创建时候初始化的线程数</span>
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        <span class="hljs-comment">//最大线程数5：线程池最大的线程数，只有在缓冲队列满了之后才会申请超过核心线程数的线程</span>
        executor.setMaxPoolSize(<span class="hljs-number">5</span>);
        <span class="hljs-comment">//缓冲队列500：用来缓冲执行任务的队列</span>
        executor.setQueueCapacity(<span class="hljs-number">500</span>);
        <span class="hljs-comment">//允许线程的空闲时间60秒：当超过了核心线程出之外的线程在空闲时间到达之后会被销毁</span>
        executor.setKeepAliveSeconds(<span class="hljs-number">60</span>);
        <span class="hljs-comment">//线程池名的前缀：设置好了之后可以方便我们定位处理任务所在的线程池</span>
        executor.setThreadNamePrefix(<span class="hljs-string">"asyncJCccc"</span>);
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<p><strong>② MyThreadPoolTaskExecutor.java 是我们自己写的，重写了一些方法：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

<span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.Future;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: JCccc
 * <span class="hljs-doctag">@Date</span>: 2022-5-30 11:13
 * <span class="hljs-doctag">@Description</span>:
 */</span>
publicfinalclass MyThreadPoolTaskExecutor  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>  {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyThreadPoolTaskExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable task)</span> {
        <span class="hljs-built_in">super</span>.execute(ThreadMdcUtil.wrap(task, MDC.getCopyOfContextMap()));
    }


    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; Future&lt;T&gt; <span class="hljs-title function_">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span> {
        returnsuper.submit(ThreadMdcUtil.wrap(task, MDC.getCopyOfContextMap()));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) {
        returnsuper.submit(ThreadMdcUtil.wrap(task, MDC.getCopyOfContextMap()));
    }
}
</code></pre>
<p><strong>③ThreadMdcUtil.java</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">MDC</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">UUID</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">Callable</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: JCccc
 * <span class="hljs-doctag">@Date</span>: 2022-5-30 11:14
 * <span class="hljs-doctag">@Description</span>:
 */</span>
publicfinal<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadMdcUtil</span> {
    privatestaticfinal <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">TRACE_ID</span> = <span class="hljs-string">"TRACE_ID"</span>;

    <span class="hljs-comment">// 获取唯一性标识</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">generateTraceId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTraceIdIfAbsent</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">TRACE_ID</span>) == <span class="hljs-literal">null</span>) {
            <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">TRACE_ID</span>, <span class="hljs-title function_">generateTraceId</span>());
        }
    }

    <span class="hljs-comment">/**
     * 用于父线程向线程池中提交任务时，将自身MDC中的数据复制给子线程
     *
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">callable</span>
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">context</span>
     * <span class="hljs-doctag">@param</span> &lt;T&gt;
     * <span class="hljs-doctag">@return</span>
     */</span>
    publicstatic &lt;T&gt; <span class="hljs-title class_">Callable</span>&lt;T&gt; <span class="hljs-title function_">wrap</span>(<span class="hljs-params">final Callable&lt;T&gt; callable, final <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; context</span>) {
        <span class="hljs-keyword">return</span> () -&gt; {
            <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">clear</span>();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">setContextMap</span>(context);
            }
            <span class="hljs-title function_">setTraceIdIfAbsent</span>();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> callable.<span class="hljs-title function_">call</span>();
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">clear</span>();
            }
        };
    }

    <span class="hljs-comment">/**
     * 用于父线程向线程池中提交任务时，将自身MDC中的数据复制给子线程
     *
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">runnable</span>
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">context</span>
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Runnable</span> <span class="hljs-title function_">wrap</span>(<span class="hljs-params">final Runnable runnable, final <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; context</span>) {
        <span class="hljs-keyword">return</span> () -&gt; {
            <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">clear</span>();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">setContextMap</span>(context);
            }
            <span class="hljs-title function_">setTraceIdIfAbsent</span>();
            <span class="hljs-keyword">try</span> {
                runnable.<span class="hljs-title function_">run</span>();
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-variable constant_">MDC</span>.<span class="hljs-title function_">clear</span>();
            }
        };
    }
}
</code></pre>
<p>OK，重启服务，再看看效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fd7ab3f7bf54acd9a101031b0a87bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765891657&amp;x-signature=aHTSQDW9wKc76Ok4w7uMPglyd4w%3D" alt="50cce9456a6ac156a0f208b5b04ec494.png" loading="lazy"/></p>
<p>图片</p>
<p>可以看的，子线程的日志也被串起来了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[位运算第1篇-异或运算-快速找出重复数字]]></title>    <link>https://juejin.cn/post/7581666815003115571</link>    <guid>https://juejin.cn/post/7581666815003115571</guid>    <pubDate>2025-12-09T12:39:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666815003115571" data-draft-id="7581698074361413641" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="位运算第1篇-异或运算-快速找出重复数字"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-09T12:39:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由生长2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            位运算第1篇-异或运算-快速找出重复数字
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由生长2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T12:39:03.000Z" title="Tue Dec 09 2025 12:39:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：本文介绍了异或运算的特点和运算规律，并通过利用异或运算解决了一个算法题目：找出1-n连续数组中的惟一重复数字。</p>
<h2 data-id="heading-0">异或运算的巧妙应用：快速找出重复数字</h2>
<h3 data-id="heading-1">引言</h3>
<p>异或运算（XOR）是一种基础的二进制运算，在编程面试和算法设计中有着意想不到的妙用。本文将深入探讨如何利用异或运算的数学特性，以 O(n) 时间复杂度和 O(1) 空间复杂度找出数组中的重复数字。</p>
<h3 data-id="heading-2">问题定义</h3>
<p>给定一个长度为 n+1 的数组，包含 1 到 n 之间的整数，<strong>恰好有一个数字重复出现一次</strong>，其余数字各出现一次。例如：</p>
<ul>
<li>输入：<code>[1, 2, 3, 4, 5, 5]</code></li>
<li>输出：<code>5</code></li>
</ul>
<h3 data-id="heading-3">异或运算的基本性质</h3>
<p>在深入解决方案之前，先回顾异或运算的关键特性：</p>
<ol>
<li><strong>交换律</strong>：<code>a ⊕ b = b ⊕ a</code></li>
<li><strong>结合律</strong>：<code>(a ⊕ b) ⊕ c = a ⊕ (b ⊕ c)</code></li>
<li><strong>自反性</strong>：<code>a ⊕ a = 0</code></li>
<li><strong>单位元</strong>：<code>a ⊕ 0 = a</code></li>
<li><strong>消去律</strong>：<code>a ⊕ b ⊕ a = b</code></li>
</ol>
<p>背后是位运算的本质。</p>
<p>0 ⊕ 0 = 0， 0 ⊕ 1 = 1</p>
<p>通俗理解就是： 0和0不相等吗？否，他们相等，否用0表示， 是用1表示，所以前面的0是数字，后面的0是否， 位运算的0和1的双重含义是位运算的基础。</p>
<p>这些性质意味着异或运算可以任意重新组合和抵消相同项。</p>
<h3 data-id="heading-4">常见误区与正确解法</h3>
<h4 data-id="heading-5">误区：直接对数组所有元素进行异或</h4>
<pre><code class="hljs language-python" lang="python">xor_all = <span class="hljs-number">1</span> ⊕ <span class="hljs-number">2</span> ⊕ <span class="hljs-number">3</span> ⊕ <span class="hljs-number">4</span> ⊕ <span class="hljs-number">5</span> ⊕ <span class="hljs-number">5</span>
        = (<span class="hljs-number">1</span> ⊕ <span class="hljs-number">2</span> ⊕ <span class="hljs-number">3</span> ⊕ <span class="hljs-number">4</span>) ⊕ (<span class="hljs-number">5</span> ⊕ <span class="hljs-number">5</span>)
        = (<span class="hljs-number">1</span> ⊕ <span class="hljs-number">2</span> ⊕ <span class="hljs-number">3</span> ⊕ <span class="hljs-number">4</span>) ⊕ <span class="hljs-number">0</span>
        = <span class="hljs-number">4</span>
</code></pre>
<p>结果不是重复数字，而是其他数字的异或值。<strong>直接异或整个数组无法找出重复数</strong>，因为重复数出现两次会相互抵消。</p>
<h4 data-id="heading-6">正确解法：数组异或与范围异或相结合</h4>
<p>设数组为 A，长度为 n+1，包含 1 到 n 的整数，其中一个数字重复。</p>
<p>计算：</p>
<ol>
<li>数组所有元素的异或值：<code>xor_arr = A[0] ⊕ A[1] ⊕ ... ⊕ A[n]</code></li>
<li>1 到 n 的异或值：<code>xor_range = 1 ⊕ 2 ⊕ ... ⊕ n</code></li>
<li>重复数字 = <code>xor_arr ⊕ xor_range</code></li>
</ol>
<h4 data-id="heading-7">原理分析</h4>
<p>将两个异或值合并考虑：</p>
<pre><code class="hljs language-ini" lang="ini">xor_arr ⊕ <span class="hljs-attr">xor_range</span> 
= (每个元素按出现次数异或) ⊕ (1到n各出现一次)
</code></pre>
<ul>
<li><strong>非重复数字</strong>：在数组中出现 1 次，在 1~n 中出现 1 次 → 总共出现 2 次 → 异或抵消</li>
<li><strong>重复数字</strong>：在数组中出现 2 次，在 1~n 中出现 1 次 → 总共出现 3 次 → 保留该数字</li>
</ul>
<p>因为：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span> ⊕ <span class="hljs-selector-tag">a</span> ⊕ <span class="hljs-selector-tag">a</span> = (<span class="hljs-selector-tag">a</span> ⊕ <span class="hljs-selector-tag">a</span>) ⊕ <span class="hljs-selector-tag">a</span> = <span class="hljs-number">0</span> ⊕ <span class="hljs-selector-tag">a</span> = <span class="hljs-selector-tag">a</span>
</code></pre>
<h4 data-id="heading-8">实例验证</h4>
<p>对于数组 <code>[1, 2, 3, 4, 5, 5]</code>（n=5）：</p>
<ol>
<li><code>xor_arr = 1 ⊕ 2 ⊕ 3 ⊕ 4 ⊕ 5 ⊕ 5 = 1 ⊕ 2 ⊕ 3 ⊕ 4 = 4</code></li>
<li><code>xor_range = 1 ⊕ 2 ⊕ 3 ⊕ 4 ⊕ 5</code>
<ul>
<li>逐步计算：<code>1 ⊕ 2 = 3</code>，<code>3 ⊕ 3 = 0</code>，<code>0 ⊕ 4 = 4</code>，<code>4 ⊕ 5 = 1</code></li>
</ul>
</li>
<li>重复数字 = <code>4 ⊕ 1 = 5</code></li>
</ol>
<p>✅ 正确找出重复数字 5。</p>
<h3 data-id="heading-9">算法实现</h3>
<h4 data-id="heading-10">Python 实现</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_duplicate</span>(<span class="hljs-params">nums</span>):
    n = <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span>
    
    <span class="hljs-comment"># 计算数组所有元素的异或</span>
    xor_arr = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> nums:
        xor_arr ^= num
    
    <span class="hljs-comment"># 计算 1 到 n 的异或</span>
    xor_range = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):
        xor_range ^= i
    
    <span class="hljs-comment"># 重复数字</span>
    <span class="hljs-keyword">return</span> xor_arr ^ xor_range

<span class="hljs-comment"># 更简洁的写法</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_duplicate_compact</span>(<span class="hljs-params">nums</span>):
    result = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i, num <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(nums):
        result ^= num ^ (i + <span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> result ^ <span class="hljs-built_in">len</span>(nums)  <span class="hljs-comment"># 修正边界</span>
</code></pre>
<h4 data-id="heading-11">时间复杂度与空间复杂度</h4>
<ul>
<li><strong>时间复杂度</strong>：O(n)，只需遍历数组一次</li>
<li><strong>空间复杂度</strong>：O(1)，只使用常数个额外变量</li>
</ul>
<h3 data-id="heading-12">扩展应用</h3>
<h4 data-id="heading-13">变体问题：找到重复和缺失的数字</h4>
<p>如果数组长度为 n，包含 1 到 n 的数字，但有一个数字重复，一个数字缺失，可以使用类似的异或技巧：</p>
<ol>
<li>计算 <code>xor_all = (所有数组元素异或) ⊕ (1到n异或)</code></li>
<li><code>xor_all</code> 的二进制表示中最低位的 1，表示重复数和缺失数在该位不同</li>
<li>根据该位将数字分成两组，分别异或得到两个数字</li>
<li>判断哪个是重复的，哪个是缺失的</li>
</ol>
<h4 data-id="heading-14">其他应用场景</h4>
<ol>
<li><strong>找出现奇数次的数字</strong>：在一组数字中，只有一个数字出现奇数次，其余出现偶数次</li>
<li><strong>交换两个变量</strong>：不使用临时变量交换两个整数</li>
<li><strong>加密中的简单混淆</strong>：基于异或的简单加密算法</li>
</ol>
<h3 data-id="heading-15">注意事项</h3>
<ol>
<li><strong>前提条件</strong>：该方法要求恰好一个数字重复，且数字范围明确（1 到 n）</li>
<li><strong>边界情况</strong>：注意数组索引和范围的对应关系</li>
<li><strong>溢出问题</strong>：异或运算不会引起溢出问题</li>
</ol>
<h3 data-id="heading-16">总结</h3>
<p>异或运算不仅是一种基本的逻辑运算，更是算法设计中的有力工具。通过巧妙的数学变换，我们可以：</p>
<ol>
<li>利用自反性消除成对出现的数字</li>
<li>结合范围异或来分离重复项</li>
<li>在 O(1) 额外空间内解决问题</li>
</ol>
<p>这种解法体现了计算机科学中一个重要的思想：<strong>通过数学变换将问题转化为更容易处理的形式</strong>。掌握异或运算的特性，对于解决位操作相关问题有着重要意义。</p>
<h3 data-id="heading-17">思考题</h3>
<ol>
<li>如果数组中有两个数字重复，还能用异或法解决吗？</li>
<li>如果数字范围不是从 1 开始，而是从 m 到 n，方法需要如何调整？</li>
<li>如何用异或运算判断一个整数是否是 2 的幂？</li>
</ol>
<hr/>
<p><strong>关键点</strong>：异或运算的抵消特性使其成为处理"成对出现"问题的理想工具，而结合数学范围限制可以进一步分离出异常项。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[百度慧播星数字人技术演进]]></title>    <link>https://juejin.cn/post/7581667332307058726</link>    <guid>https://juejin.cn/post/7581667332307058726</guid>    <pubDate>2025-12-09T11:16:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581667332307058726" data-draft-id="7581448482545729562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="百度慧播星数字人技术演进"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-09T11:16:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="百度Geek说"/> <meta itemprop="url" content="https://juejin.cn/user/4186596000416094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            百度慧播星数字人技术演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4186596000416094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    百度Geek说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T11:16:37.000Z" title="Tue Dec 09 2025 11:16:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导读</h2>
<p>从2023年成立到如今日均服务2万+直播间，百度慧播星已演进为覆盖脚本生成、实时问答、智能决策、音视频克隆的全链路AI直播平台。本文深入解读其技术架构：如何通过检索增强和强化学习生成高转化脚本；如何利用强化学习智能中控动态优化直播策略；以及如何将语音与形象克隆效率提升至“小时级”；如何构建“先验-后验”数据飞轮，让模型自主进化；。罗永浩数字人直播GMV突破5500万的案例，验证了其“超越真人”的带货能力。未来，慧播星正朝着更智能、更拟真、更高效的方向持续迭代。</p>
<h2 data-id="heading-1">01 慧播星介绍</h2>
<p>电商数字人直播（慧播星）正式成立于2023年，是一款汇集了百度在视觉，语音和语言方面AI能力的原生AI应用产品，致力于打造代际领先的超越真人的直播体验。25年底日均开播直播间已达2万多个，覆盖电商、教育、健康、金融、泛知识内容等多个行业。经过两年多的产品打磨和技术突破，慧播星数字人直播已具备超越真人的能力。例如，这些能力支撑了罗永浩2025年6月15 日的数字人直播首秀，吸引了超 1300 万人次观看，GMV（商品交易总额）突破 5500 万元，这一成绩超过了其同年 5 月的真人直播首秀（GMV 5000 万）。</p>
<h3 data-id="heading-2"><strong>1.1 商家业务视角——开播流程</strong></h3>
<p>商家在慧播星获得带货权限后，即可自助开启数字人直播，主要包括如下流程。</p>
<p><strong><strong>1. 商品选择</strong></strong>，可从百度直营店铺（度小店），三方电商平台（京东淘宝拼多多）和百度本地生活的海量商品中选择带货商品</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/557f4c963c6b42179a86199d3abd9ad7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=okGenty3I32z70Li1KGsUP0WESo%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 海量内外部商品一键挂接</strong></strong></p>
<ol start="2">
<li>形象选择或者定制，从7800+公共库形象中选择主播形象，或通过自助录制5分钟视频定制私有形象</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c5e0c560dba4557ac49927efdfd3f71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=a353H7iCTkr%2FH4h2A4M8ZljzuCc%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 形象选择或定制</strong></strong></p>
<ol start="3">
<li>直播间装修，从3600+套直播间模板中选择装修风格和元素，或通过AI自动生成直播间背景图和营销挂件</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b08ad9617da24ef8be731f2cb3c22f3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=KawLZHZw1RSuXEDtT%2FM6furB8O0%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 直播间装修，丰富的模板&amp;组件</strong></strong></p>
<ol start="4">
<li>脚本生成，从多种公共风格中选择脚本带货风格，或自定义目标带货风格，补充少量营销信息，一键生成专业的直播脚本</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6722665ea1442bea61959e6841f8e15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=m0kcnkSRV6NN7XOXUIjmV2w2U10%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 一键脚本生成</strong></strong></p>
<ol start="5">
<li>音色选择，从3200+个公共库音色中选择主播音色，或通过手百自助录制，3天内得到私有定制音色</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02614cedc6004945860e83bfafc51972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=aJBbL4o6oN7dKiC3AigPBXZgx4Q%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 音色选择或制作</strong></strong></p>
<p><strong><strong>6. 直播间互动配置</strong></strong>，一键开启一言问答接管，也支持手动配置预置问答对，补充商家知识</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd27b788b5de4b18af9d1608c304a189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=mMFtu%2BSZNG0OLXLesypCc114C3E%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 直播间互动配置</strong></strong></p>
<h2 data-id="heading-3">02 整体技术架构</h2>
<p>慧播星整体架构主要由商家端、视觉语音和文本各模态模型、实时渲染引擎、站内外分发系统组成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66640862c864ac7a1976c710018e95c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=%2F6HlK1drXxQbDxT6FZdXNJAX8SU%3D" alt="图片" loading="lazy"/></p>
<p>为实现更好的直播体验，数字人采用云端生成方案，云端生成系统主要包括如下几个子系统。</p>
<p><strong><strong>1. 商品理解</strong></strong>，为脚本，问答，互动等各种内容生成模型提供商品知识增强</p>
<p><strong><strong>2. 脚本生成</strong></strong>，围绕商品自动生成风格化口语化的带货脚本</p>
<p><strong><strong>3. 智能问答</strong></strong>，用户提问时实时检索商品知识，生成精准的回复，支持弹幕和口播回复</p>
<p><strong><strong>4. 智能互动</strong></strong>，以直播效果（评论率、用户退场率、观看时长等）为目标主动向用户发起互动</p>
<p><strong><strong>5. 直播间装修</strong></strong>，智能生成直播间背景，合成带营销内容的挂件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8090789c91445938b24846f747de1f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=qK%2FAhl4zvwUzklChgxvYgDuAxC0%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-4">03 内容生成</h2>
<h2 data-id="heading-5"><strong>3.1 风格化脚本生成</strong></h2>
<p>直播脚本水平与带货效果息息相关，优秀主播的脚本能够打动用户，循循善进引导用户成交。由于普通商家的带货营销水平有限，商家希望仅表达学习某某主播，系统自动为其生成风格相似的脚本。在此需求背景下，慧播星利用多模态商品理解富集构建商品知识库，借助EB4/turbo在电商直播语料上进行大规模预训练，结合人工专家精标数据SFT，通用和电商知识增强等手段实现一键风格化仿写。</p>
<ul>
<li>商家仅需选定商品和补充少量营销信息，即可按预设风格或者自定风格（提供最少400字的带货文案）一键生成风格相似的带货脚本。<strong><strong>客户采纳率92%，开播渗透率67%，相比客户脚本转化率+14%。</strong></strong></li>
<li>考虑到风格化脚本创作需求的独立性，慧播星已将脚本生成独立为工具，商家可脱离直播业务流使用工具。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4df0405b9dfe425f88c428dadb9f2a0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=AR1O2ADY3LtIJsw7odYJmK6sTtU%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 风格化脚本生成工具UI</strong></strong></p>
<h4 data-id="heading-6"><strong><strong>技术架构</strong></strong></h4>
<p>整体技术主要包括商品理解、检索增强、强化学习风格化生成和后处理阶段。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f61f0a627b3c4adb8de0de0e556d98e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=MKlRiH1bnNmYjw1xUVOUix%2FCXy8%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>商品理解</strong>。系统通过多模态商品解析技术对商品详情页、海报图、参数图等视觉素材进行 OCR、版面结构识别与多模态模型融合，自动抽取核心卖点、适用人群、功能亮点、使用场景等结构化商品知识。可在单张图里同时捕获“文本内容 + 图示含义 + 排版语义”等特征，并利用 LLM 对解析结果进行归一化和字段对齐，形成高覆盖、高一致性的商品知识库。</li>
<li><strong><strong>检索增强（RAG）链路</strong></strong>。用户输入的风格范文（不少于 400 字）会先经过标签分析模块，由大模型识别出其关键风格维度，如：表达节奏（快/慢）、情绪浓度（热情/克制）、营造气氛策略（故事、对比、疑问句）、用户痛点定位、直播常用带货技巧（强调稀缺、促单压力、利益点递进）等。基于这些风格标签，系统自动生成 Query，用于从通用知识库与电商知识库中检索对应表达方式、句式模板与知识上下文（卖点顺序推荐、商品类别常用话术、场景化句法等）。</li>
<li><strong><strong>风格化生成模型</strong></strong>。模型基于电商专精的电商直播语料预训练能力，并结合海量运营专家的精细化标注数据（SFT），能够在保持范文风格一致性的同时，将内容自动替换为目标商品的卖点和营销逻辑。为确保生成内容既符合直播场景使用习惯，又具备高情绪感染力，系统引入轻量级 RLHF/强化学习优化，通过人类偏好数据持续调优，使模型能够稳定输出“自然、顺畅、带货效果强”的脚本。为持续提升模型能力，通过数据飞轮对该生成模型进行对齐。</li>
<li><strong>标签化与后处理</strong>。脚本被进一步结构化，包括：分镜逻辑、开场引导、利益点铺垫、情绪高点、促单推进、收尾金句等，方便商家在实际直播中灵活调用或进行定制化编辑。</li>
</ul>
<h4 data-id="heading-7"><strong><strong>脚本数据飞轮</strong></strong></h4>
<p>数字人直播的内容绝大部分来自大模型生成，前期领域专家知识为生成标准，脚本、问答、互动场景的生成质量已达到普通真人主播的水平。然而人工先验知识存在主观偏差，且缺乏全面性和快速适应新变化的能力，完全依赖人工只能达到次优水平。为持续攀升超越域内外头部真人主播，需建立业务和大模型的数据飞轮，通过飞轮效应持续提升模型在数字人直播场景的后验效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df2e50ddd78b4d0dac0e8ba425c55d0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=mJxK5DQi%2F528oBm%2FhhV7AizMFlI%3D" alt="图片" loading="lazy"/></p>
<h5 data-id="heading-8">先验对齐</h5>
<p>在真实直播场景中，数字人模型最终追求的是“后验效果最优”——即用户停留、评论增长、转化提升等真实业务指标。然而后验目标往往天然伴随风险：例如激进促单、夸大效果、模糊描述等内容可能在短期内获得更高的用户反馈，却越过事实边界与平台规范，形成安全问题。因此，在模型全面对齐后验之前，必须构建一套稳健、可解释、与平台规范一致的<strong><strong>先验对齐体系</strong></strong>作为基础。先验奖励模型作为“守门人”，以推理专家模型为判断核心，通过结构化的偏好评分与规则奖励引导模型学习合规、高质、可控的内容风格，实现“先验对齐 → 强化学习 → 专精模型 → 回流验证”的闭环。</p>
<p>自动偏好合成。传统先验奖励完全依赖人工标注，成本高且存在主观性。为解决这一问题，我们集成了多个先进推理类基模型（如 EB4-4T、Deepseek-R1/V3、GPT-o 系列等），通过多模型投票、结果对比分级等方式自动合成偏好。这一自动化偏好生成机制能够模拟“专家标注”，但具备：</p>
<ul>
<li><strong>一致性更高</strong>，减少人工主观波动</li>
<li><strong>覆盖范围更广</strong>，数百万级先验数据</li>
<li><strong>适应变化更快</strong>，模型可随平台规范或内容趋势变化即时更新</li>
</ul>
<p>最终形成先验 RM（Reward Model）的核心训练数据。先验 RM 的核心职责是确保模型在任何情况下都不会突破内容安全边界，为后续后验对齐提供稳固底座。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e5b1f71c94046f38e5f3e3badadbefb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=mfgGchxOlC1NJpdZJAX6v%2BNY3Bc%3D" alt="图片" loading="lazy"/></p>
<h5 data-id="heading-9">后验数据飞轮</h5>
<p>为了让模型吸收用户的真实后验反馈，慧播星构建了一套以“内容探索 + 奖励建模”为两条主线的数据飞轮，实现模型的自主进化与持续增强。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a564f0eb435143f3b01088065dff61f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=kSqVL3Hg2kUJ1TlAhH47ImUBQ1g%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>基于后验统计的内容探索</strong></strong>：可控、高解释的偏好数据生成链路。后验统计路径主要面向<strong><strong>高精度、强可控、可解释性强</strong></strong>的偏好数据生产需求，结合在线实验框架，通过真实用户反馈驱动的方式生成偏好样本。通过高频在线实验，系统不断沉淀千级规模的偏好数据，支撑后续的模型偏好对齐训练（如 DPO/IPO 等策略优化方法）。</p>
<p><strong><strong>可泛化的奖励 uplift 建模</strong></strong>：大规模偏好数据的高效补充路径。相比基于后验统计的实验方式，uplift 建模路径旨在解决<strong><strong>用户行为稀疏、实验成本高</strong></strong>的问题，通过泛化模型直接对用户偏好进行预测，生成百万级的偏好数据，实现更高效的数据扩容。采用 S-Learner / T-Learner 等 uplift 方法，构建用户行为因果效应模型，直接预测“某段内容是否会提升用户的互动/评论/停留等关键指标？”</p>
<h3 data-id="heading-10"><strong>3.2 智能问答</strong></h3>
<p>慧播星建设了一套完备的直播场景RAG系统，包括电商领域知识检索模型，通过千亿模型蒸馏的低时延生成模型（12s-&gt;2s)，数据飞轮。目前已实现多模素材调度，高拟真明星问答，客户个性化表达，垂类适配，商家/商品知识库等产品能力。客户可一键开启智能问答，问答端到端可用率95%，优质率90%，客户开启率94%，运营和客户反馈较好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ff151fa418b40c2a4b7c1f249a813de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=54klu3AphX0ojEVY%2FA459XiRJl0%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 智能问答架构</strong></strong></p>
<h4 data-id="heading-11"><strong><strong>技术架构</strong></strong></h4>
<p>慧播星的直播实时问答系统在工程上形成了知识整合 → 领域检索 → 低延迟生成 → 后处理 → 数据飞轮的完整闭环，为超拟真数字人提供了媲美真人的实时互动能力。</p>
<ul>
<li>在<strong><strong>知识整合层</strong></strong>，系统将商家侧的商品图文、卖点、FAQ、视频脚本、类目属性以及运营沉淀的数据统一入库，并通过向量化处理构建高可用的电商知识底座。</li>
<li><strong><strong>领域知识检索模块</strong></strong>结合了千帧蒸馏后的 EB-lite/行业模型与高维向量语义搜索，通过「意图识别 → 精准匹配 → 语义聚类 → 知识召回」的流水线，确保系统能够从复杂直播语境中准确捕捉用户提问意图。直播场景中存在大量口语化、短句化、甚至噪声语料（如： “这个能用多久啊”。“有别的颜色吗？”），系统通过深度语义 embedding（如 ernie embedding）实现高鲁棒性的实时检索，使检索召回的准确率在实时环境下依然保持稳定。</li>
<li><strong><strong>低延时生成模块</strong></strong>。基于千亿模型蒸馏结果构建，针对直播高并发、低时延、强一致性的要求，模型经过结构裁剪、张量并行优化与 Prompt 规约，使单轮响应时延从 12s 压缩到 2s，在保证语义丰富度和口播自然度的同时提升端到端体验。</li>
<li><strong><strong>数据飞轮实现持续自我优化</strong></strong>：运营反馈、用户互动日志、误匹配案例以及高质问答样本会自动回流到数据处理模块，驱动知识库更新与模型重训练。</li>
</ul>
<h3 data-id="heading-12"><strong>3.3 智能中控</strong></h3>
<hr/>
<p>真人主播会根据直播间实时状态决策当前应发起何种动作（action），比如直播间互动氛围差的时候是应该邀评，换卖点讲解还是促单？确定动作后主播知道如何最好的的执行动作，例如怎么把邀评讲出来？说什么话，用什么语气，邀请特定观众还是所有观众。行为决策和行为内容生成两者相结合实现直播间下单，关注，留联等最大化目标。超拟真数字人需要具备上述两种核心能力，即给定一个长期目标（如每场次的订单总数，评论总数，观看时长等），要求数字人1）判断在不同直播间状态下应该做出什么行为，是切换卖点讲解，促单逼单，邀评还是多轮互动？2）确定某种行为后生成适合的的行为内容，如塑品讲解，优惠讲解，促单逼单等的具体口播内容。</p>
<h4 data-id="heading-13"><strong>技术架构</strong></h4>
<p>智能中控架构核心由基于强化学习的决策Agent，和基于一言大模型的多任务融合两个部分组成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/790be0e44cd64c319c3d7e3f8a0ccf6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=L0Aa8%2FwjKUk1f71Hra6IYWqhCjU%3D" alt="图片" loading="lazy"/></p>
<h5 data-id="heading-14"><strong><strong>基于强化学习的行为决策Agent</strong></strong></h5>
<p>行为决策的目标是在不同直播状态下选择最优动作，最大化长期目标（订单、评论、观看时长等）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/186556a5ded14b7689f0e103ad1bd198~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=XCjczdAU7vLnnWd%2FsbTqGNk84PY%3D" alt="图片" loading="lazy"/></p>
<p>上图展示了直播环境与RL决策Agent的交互流程：</p>
<ul>
<li><strong><strong>状态 St</strong></strong>：观看人数、评论频率、当前商品、用户行为序列、是否有提问等</li>
<li><strong><strong>动作 At</strong></strong>：邀评 / 多轮互动 / 促单 / 动态讲解 / 切换卖点 / 回答问题……</li>
<li><strong><strong>奖励 Rt</strong></strong>：订单数变化、评论数增加、停留时长、转化率提升等</li>
<li>Agent 通过不断试错 &amp; 策略迭代，获得最优策略。</li>
</ul>
<p>这使数字人能够像真人主播一样：氛围低时发起互动，用户观望时进行促单，新观众进入时进行商品介绍。RL 的优势在于目标导向：不是优化单句话，而是优化<strong><strong>整场直播的 KPI</strong></strong>。</p>
<h5 data-id="heading-15"><strong><strong>基于大模型的行为内容生成与融合</strong></strong></h5>
<p>当 RL Agent 选择了一个动作后，例如“促单”，还需要生成对应的动作参数：如促单的口播内容，使用什么语气？内容是偏温和还是强节奏？是否引用当前观众的评论？实践中我们通过强化学习训练了一系列action内容生成专精模型，能够生成特定参数指定的直播内容。</p>
<p>未来我们将以语言模型为基座对决策和内容生成任务进行端到端训练，减少分阶段建模带来的累计误差。</p>
<h2 data-id="heading-16">04 语音克隆与合成</h2>
<p>普通商家原声演绎状态不佳，缺乏带货感。慧播星利用风格迁移TTS技术自动合成感染力强，拟真度高的直播音频。经过两年多的迭代TTS开播使用率从<strong><strong>30.3%提升至92.8% <strong><strong><strong><strong>，<strong><strong>制作时效性从</strong></strong>1</strong></strong></strong></strong>月降低到1分钟。</strong></strong></p>
<p>电商TTS发展主要经历两个阶段：</p>
<p><strong>第一阶段（2023.3~2024.Q2)</strong> **：语音定制工牌麦收音，依赖大量人工传导，整个周期长达一个月</p>
<p><strong>第二阶段（2024.Q3至今)</strong> **：小程序自助收音提高收音效率，自动训练架构升级，抑扬顿挫带货效果持续优化</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e131f912caf45d5a80d85c896fd865b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=mT1FtvGBJm4QE1tuyPqbbmsN5kE%3D" alt="8a3ff4868bef454dc11f0b3d563dfd55.png" loading="lazy"/></p>
<p>第一阶段：工牌麦收音效率低下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bff8f71283b4450ebb997c56d0dd19a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=O%2F8xLTP9rpI%2Bxl2xOimUEiUA5TA%3D" alt="9c59c70847e98a944f17b4d9b65d9842.jpg" loading="lazy"/></p>
<p>第二阶段：小程序自助录制</p>
<p>现状：当前慧播星支持原生和激情带货两种音色克隆，客户仅需在手百小程序上录制15分钟语音，系统在1天内自动为客户生成克隆音（对比如下）。目前慧播星已制作12w多个音色，2.7w多个客户定制音色。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/913244b09c984110b1298a69e25cc16d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=mOgLh40EEfc3eyI84ZyVFLBSoPQ%3D" alt="b8fb96d6e796ac2b84b99e0421469492.png" loading="lazy"/></p>
<p>两种音效可选</p>
<p><strong>1. 原声效果</strong>：还原本人说话特点，如语速和语调</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fblob%3Ahttps%3A%2F%2Funitools.fun%2Ffb87134d-97ec-42a5-a0a0-b74980b1cfc3" target="_blank" title="http://blob:https://unitools.fun/fb87134d-97ec-42a5-a0a0-b74980b1cfc3" ref="nofollow noopener noreferrer">http://blob:https://unitools.fun/fb87134d-97ec-42a5-a0a0-b74980b1cfc3</a></p>
<p><strong><strong>2. 激情带货效果</strong></strong>：让整体情绪更激昂，抑扬顿挫</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fblob%3Ahttps%3A%2F%2Funitools.fun%2F85e53903-5672-4988-85ae-19a4c867a607" target="_blank" title="http://blob:https://unitools.fun/85e53903-5672-4988-85ae-19a4c867a607" ref="nofollow noopener noreferrer">http://blob:https://unitools.fun/85e53903-5672-4988-85ae-19a4c867a607</a></p>
<p>未来计划利用海量直播场景的语料数据，进一步<strong>降低克隆门槛</strong>（对齐竞品的30s）、<strong>提升克隆效率</strong>（分钟级可完成克隆进行合成）、<strong>优化朗读效果</strong>（对标直播/视频/讲述/咨询等不同语境的真人） ，同时从单声音的克隆和合成成本达到业内头部领先水平。</p>
<h4 data-id="heading-17">克隆+合成技术架构</h4>
<p>整体架构主要包括离线声纹注册和模型训练，在线合成三个部分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05cafc99d65448928cc873a2fb1c82d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=dxyOPM5pPPM1kaLd1PezrzvNO%2Fk%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 形象克隆及合成架构</strong></strong></p>
<h2 data-id="heading-18">05 形象克隆与合成</h2>
<p>主播形象是直播的核心要素，高拟真形象能够提升用户观看时长，进而提升成单效果。慧播星与视觉技术部深度合作，基于2D数字人技术针对直播场景定制形象克隆和合成能力，建设了接近7800+个公共库形象，有效地支撑商家在慧播星的前期探索，为自建形象做好准备。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2038c211400f4c8782963825c774a053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=ScwJWd6D5YeJ%2FbPGvocNZoUXcgM%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>△ 慧播星形象制作</strong></strong></p>
<p>形象克隆技术发展主要经历了四个阶段：</p>
<p><strong>第一阶段（2023.3~2023Q4)</strong> ：V1版本唇形驱动方案适配电商直播场景，跑通录制约束较多的**闭嘴且无遮挡录制+**形象克隆流程，建立起第一批公共库形象</p>
<p><strong>第二阶段（2024.Q4~2024.Q2)</strong> ：V3V4版本唇形驱动通过数据建设和模型算法优化<strong>实现张嘴录制和更自然的唇动效果</strong></p>
<p><strong>第三阶段（2024.Q3~2025.Q2)</strong> ：进一步降低录制门槛，支持<strong>录制中遮挡、大幅度侧脸和人脸出镜</strong>。</p>
<p>当前阶段客户仅需上传5分钟左右的自然演绎视频，系统在3小时内即可自动为客户生成克隆形象。时至25年底慧播星已累计<strong>制作<strong><strong>32万多</strong></strong>多个形象，8万多个客户定制形象，线上可用率95%</strong> 。</p>
<p><strong>第三阶段（2025.Q3~至今）：<strong>突破唇形驱动，建设</strong>多人出镜，动作驱动，表情驱动，持物驱动</strong>等下一代形象生成能力（多模协同的超级主播）。</p>
<h4 data-id="heading-19"><strong>视觉技术</strong></h4>
<p>实时场景下早期的唇动方案采用单阶段建模（如wav2lip），输入音频直接输出像素空间的唇形图片。实践中单阶段方案无法达到逼真的唇动效果，后来的商用方案几乎都采用两阶段方案：<strong>第一阶段将音频转化为2D关键点或3D人脸模型作为中间表达，第二阶段将中间表达利用GAN网络解码到像素空间。</strong></p>
<p><strong><strong>视觉生成模型</strong></strong></p>
<p>核心由三个模型组成，<strong><strong>3D人脸重建模型</strong></strong>，<strong><strong>音频到3D人脸生成模型</strong></strong>，<strong><strong>3D空间到像素空间人脸生模型。</strong></strong></p>
<ul>
<li>3D人脸重建利用3DMM将人脸图片（像素）转换为3D mesh（三维空间点）</li>
<li>基于Faceformer改进的音频到3D mesh预估模型，mesh作为中间表达携带了丰富的面部动态，使得生成模型能够生成逼真的唇形图片。</li>
<li>基于StyleGan2改进的人脸生成模型，训练目标包括像素空间的重建损失，特征空间的感知损失，以及对抗生成损失。实现个性化增量微调方案，复用预训练底座只学习每个主播的个性化唇动风格，新形象仅需微调，3小时内完成制作。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/327325ef703c4b1796e8d0b243cd1392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=OG5fucWulVDUHuKfkdWhfRI01l8%3D" alt="a257f774f7b3f261f4d91b5ac0fac33c.png" loading="lazy"/></p>
<p>模型pipeline</p>
<p><strong><strong>在线合成架构</strong></strong></p>
<p>形象合成以tts音频、底板视频帧和直播间背景为输入，通过生成模型实时合成主播嘴部区域，最后组装成视频流推送给用户。其中任务队列建立缓冲区，保障了视频流的连续性。目前已实现单卡多路流式渲染，支撑2万多直播间同时开播</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cf3daab00bb4870a0c3ddc5ab65f239~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqmR2Vla-ivtA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883797&amp;x-signature=Xiv9rg4zpDya87Mk7nrz9IHgrsg%3D" alt="f2a61d2b808afc9c277bca6b01b11654.jpg" loading="lazy"/></p>
<p>在线流式合成架构</p>
<h2 data-id="heading-20">06 总结</h2>
<p>历经两年多的持续打磨与技术突破，慧播星已经从一款数字人直播工具，成长为覆盖脚本生成、实时问答、智能中控、语音克隆、形象合成等多模态全链路的原生 AI 直播平台。它不仅复刻了真人主播的内容表达与带货节奏，更通过商品理解增强、强化学习决策、先验—后验数据飞轮、大规模音视频生成模型等关键技术，实现了“超越真人”的直播能力。随着业务规模的快速扩张与技术体系的持续演进，慧播星已在日均2万+直播间、万级定制形象与音色、覆盖电商与泛行业场景的真实生产环境中验证了 AI 直播的成熟度和商业价值。未来慧播星将继续沿着“更智能、更具说服力、更高效”的方向迭代：让脚本更精准、互动更自然、视觉更逼真、声音更生动、决策更智慧，并通过持续运转的数据飞轮不断突破直播体验的天花板。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RabbitMQ 如何保证消息不丢失和不重复消费？掌握这 4 个关键点就够了]]></title>    <link>https://juejin.cn/post/7581688255625052212</link>    <guid>https://juejin.cn/post/7581688255625052212</guid>    <pubDate>2025-12-09T11:44:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581688255625052212" data-draft-id="7573958996668661787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RabbitMQ 如何保证消息不丢失和不重复消费？掌握这 4 个关键点就够了"/> <meta itemprop="keywords" content="后端,Java,RabbitMQ"/> <meta itemprop="datePublished" content="2025-12-09T11:44:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RabbitMQ 如何保证消息不丢失和不重复消费？掌握这 4 个关键点就够了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T11:44:08.000Z" title="Tue Dec 09 2025 11:44:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发中，我们经常用<strong>RabbitMQ</strong>来做系统之间的传话筒。</p>
<p>比如用户下单后，通知库存系统减库存、通知物流系统准备发货。</p>
<p>但问题来了：<strong>万一消息丢了怎么办？或者同一条消息被处理了两次怎么办？</strong></p>
<p>别担心！只要做好以下几点，就能让 RabbitMQ 变得既<strong>可靠</strong>又<strong>安全</strong>。</p>
<hr/>
<h3 data-id="heading-0">消息可能在哪丢？</h3>
<p>假设发快递：</p>
<ul>
<li>你（生产者）把包裹交给快递员（RabbitMQ）；</li>
<li>快递员把包裹送到收件人（消费者）手上。</li>
</ul>
<p>在这个过程中，包裹可能在三个地方出问题：</p>
<ol>
<li><strong>你刚寄出，快递员没收到</strong> → 消息没到 RabbitMQ；</li>
<li><strong>快递员收到了，但仓库门没开</strong> → RabbitMQ 宕机，消息没了；</li>
<li><strong>收件人签收前手机没电了</strong> → 消费者处理失败，消息丢失。</li>
</ol>
<p>所以，我们要从<strong>发送方、中间方、接收方</strong>三处下手！</p>
<h3 data-id="heading-1">先配好配置文件（<code>application.yml</code>）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-comment"># 开启 publisher confirm 和 return</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">template:</span>
      <span class="hljs-attr">mandatory:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 使 returns 生效</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span>  <span class="hljs-comment"># 手动 ACK</span>
        <span class="hljs-attr">retry:</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 我们自己控制重试逻辑</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">1. 声明队列、交换器（持久化！）</h3>
<p>创建队列或交换器时，设置<code>durable=true</code>队列持久化。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMqConfig</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.exchange"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.queue"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.create"</span>;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">orderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// durable = true（默认就是 true）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(ORDER_EXCHANGE, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// durable = true</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(ORDER_QUEUE, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">binding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(orderQueue())
                .to(orderExchange())
                .with(ORDER_ROUTING_KEY);
    }
}
</code></pre>
<h3 data-id="heading-3">2. 生产者发送消息（带唯一 ID + Confirm 回调）</h3>
<p>发送消息时，设置 <code>deliveryMode=2</code> 消息持久化。</p>
<p>同时增加异步非阻塞操作，发完消息立刻返回，RabbitMQ 后台异步确认。支持批量确认、单条确认。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProducer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">// 生成唯一消息ID（实际可用 UUID 或业务ID）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderMessage</span><span class="hljs-params">(String orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">msgId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"msg_"</span> + System.currentTimeMillis(); <span class="hljs-comment">// 简化版唯一ID</span>

        <span class="hljs-type">MessageProperties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageProperties</span>();
        props.setMessageId(msgId); <span class="hljs-comment">// 设置唯一ID，用于幂等</span>
        props.setDeliveryMode(MessageDeliveryMode.PERSISTENT); <span class="hljs-comment">// 持久化</span>

        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>((orderId).getBytes(StandardCharsets.UTF_8), props);

        <span class="hljs-comment">// 发送并监听 confirm</span>
        rabbitTemplate.convertAndSend(
            RabbitMqConfig.ORDER_EXCHANGE,
            RabbitMqConfig.ORDER_ROUTING_KEY,
            message,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(msgId) <span class="hljs-comment">// CorrelationData 用于关联 confirm</span>
        );

        <span class="hljs-comment">// 设置 confirm 回调</span>
        rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt; {
            <span class="hljs-keyword">if</span> (ack) {
                System.out.println(<span class="hljs-string">"消息已确认送达 RabbitMQ: "</span> + correlationData.getId());
            } <span class="hljs-keyword">else</span> {
                System.err.println(<span class="hljs-string">"消息发送失败: "</span> + cause);
                <span class="hljs-comment">// 可在此处记录日志、重发、存 DB 等</span>
            }
        });

        <span class="hljs-comment">// （可选）设置 return 回调，处理路由失败</span>
        rabbitTemplate.setReturnsCallback(returned -&gt; {
            System.err.println(<span class="hljs-string">"消息无法路由: "</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(returned.getMessage().getBody()));
        });
    }
}
</code></pre>
<p><strong>生产环境建议把失败的消息存入数据库，由定时任务补偿重发。</strong></p>
<p>到这里很多人以为只要设置了<code>durable=true</code>和<code>deliveryMode=2</code>，消息就万无一失了。</p>
<p>其实不然！RabbitMQ 收到持久化消息后，会先写入内存缓冲区，再异步刷盘（fsync）。</p>
<p>如果在这之间服务器断电，消息还是会丢！</p>
<h4 data-id="heading-4">解决方案：</h4>
<p><strong>传统方案</strong>：镜像队列（Mirrored Queue）多节点备份，但存在脑裂、数据不一致风险。</p>
<p><strong>现代方案（RabbitMQ 3.8+）</strong>：Quorum Queue（仲裁队列）</p>
<ul>
<li>基于 Raft 共识算法，强一致性；</li>
<li>自动选主、故障转移；</li>
<li>写入多数节点才返回成功，真正防丢。</li>
</ul>
<p>在SpringBoot中声明 <code>Quorum Queue</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">quorumOrderQueue</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> QueueBuilder
        .durable(<span class="hljs-string">"order.quorum.queue"</span>)
        .quorum() <span class="hljs-comment">// 关键！</span>
        .build();
}
</code></pre>
<hr/>
<h3 data-id="heading-5">3.消费者：手动 ACK + 幂等处理（防重复）</h3>
<p><strong>手动 ACK 是什么？</strong>
等待消费者调用<code>basicAck</code>，收到 ACK 后，才从队列中删除消息。</p>
<p><strong>什么是幂等？</strong>
一个操作执行一次和执行多次，结果完全相同。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderConsumer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSUMED_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mq:consumed:"</span>;

    <span class="hljs-meta">@RabbitListener(queues = RabbitMqConfig.ORDER_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrder</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">String</span> <span class="hljs-variable">msgId</span> <span class="hljs-operator">=</span> message.getMessageProperties().getMessageId();
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody(), StandardCharsets.UTF_8);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1.幂等检查：是否已处理过？</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> CONSUMED_KEY_PREFIX + msgId;
            <span class="hljs-type">Boolean</span> <span class="hljs-variable">hasConsumed</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">"1"</span>, Duration.ofHours(<span class="hljs-number">24</span>));
            <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(hasConsumed)) {
                System.out.println(<span class="hljs-string">"重复消息，跳过处理: "</span> + msgId);
                channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 2.处理业务逻辑（比如减库存、发短信）</span>
            System.out.println(<span class="hljs-string">"正在处理订单: "</span> + orderId);

            <span class="hljs-comment">// 模拟业务耗时</span>
            Thread.sleep(<span class="hljs-number">1000</span>);

            <span class="hljs-comment">// 3.业务成功 → 手动 ACK</span>
            channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="hljs-literal">false</span>);
            System.out.println(<span class="hljs-string">"消费成功，已 ACK: "</span> + msgId);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"消费失败: "</span> + e.getMessage());
            <span class="hljs-comment">// 拒绝消息，不 requeue（避免死循环），或根据策略决定是否重试</span>
            channel.basicNack(message.getMessageProperties().getDeliveryTag(), <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
            <span class="hljs-comment">// 或者：basicReject + 记录到死信队列</span>
        }
    }
}
</code></pre>
<p>关键点：</p>
<ul>
<li><code>setIfAbsent</code> 实现 Redis 分布式锁式去重；</li>
<li><strong>先检查幂等，再处理业务，最后 ACK</strong>；</li>
<li>异常时用 <code>basicNack</code> 拒绝消息，避免无限重试。</li>
</ul>
<hr/>
<h3 data-id="heading-6">完整可靠性链路图</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[生产者]</span>
   │
   ├── 开启 Confirm → 确保消息到达 Broker
   └── 消息带唯一ID → 用于后续幂等
        │
        ▼
<span class="hljs-section">[RabbitMQ Broker]</span>
   ├── 队列/交换器持久化
   ├── 消息持久化（<span class="hljs-attr">deliveryMode</span>=<span class="hljs-number">2</span>）
   └── 使用 Quorum Queue（高可用+强一致）
        │
        ▼
<span class="hljs-section">[消费者]</span>
   ├── 手动 ACK（<span class="hljs-attr">autoAck</span>=<span class="hljs-literal">false</span>）
   ├── 先查幂等（Redis/setIfAbsent）
   ├── 再执行业务
   └── 最后 ACK（失败则 NACK 或进死信队列）
</code></pre>
<hr/>
<h3 data-id="heading-7">常见误区</h3>

























<table><thead><tr><th>误区</th><th>正确做法</th></tr></thead><tbody><tr><td>“开了持久化就不会丢”</td><td>还需 Confirm + 高可用队列</td></tr><tr><td>“自动 ACK 更简单”</td><td>自动 ACK 极易丢消息！必须手动</td></tr><tr><td>“RabbitMQ 能保证不重复”</td><td>不能！必须消费者自己幂等</td></tr><tr><td>“消息ID用时间戳就行”</td><td>时间戳可能重复！建议用 UUID 或雪花ID</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">总结</h3>
<p>保证 RabbitMQ 消息不丢和不重复，记住这四个关键点：</p>
<p><strong>1. 生产者确认（Confirm）</strong></p>
<ul>
<li>开启 <code>publisher-confirm</code>，确保消息成功发到 RabbitMQ。</li>
</ul>
<p><strong>2. 消息持久化</strong></p>
<ul>
<li>队列和消息都设置成持久化，防止 RabbitMQ 重启后数据丢失。</li>
</ul>
<p><strong>3. 消费者手动确认（ACK）</strong></p>
<ul>
<li>关闭自动 ACK，业务处理成功后，再手动确认消息。</li>
</ul>
<p><strong>4. 消费幂等性</strong></p>
<ul>
<li>每条消息带唯一 ID，消费者先检查是否处理过，避免重复消费。</li>
</ul>
<p><strong>简单来说：</strong></p>
<ul>
<li><strong>防丢失</strong>：Confirm + 持久化 + 手动 ACK</li>
<li><strong>防重复</strong>：消息唯一 ID + 幂等检查</li>
</ul>
<p>没有100%的不丢失，只有无限接近99.99%的可靠性。</p>
<p>做好这四点，你的 RabbitMQ 就足够可靠了！</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-9">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">《async/await 到底要不要加 try-catch？异步错误处理最佳实践》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">《Vue3 和 Vue2 的核心区别？很多开发者都没完全搞懂的 10 个细节》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">《Java 开发必看：什么时候用 for，什么时候用 Stream？》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqI3TRTdDfRJSH9kCTqAQUw" target="_blank" title="https://mp.weixin.qq.com/s/qI3TRTdDfRJSH9kCTqAQUw" ref="nofollow noopener noreferrer">《这 10 个 MySQL 高级用法，让你的代码又快又好看》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Scheduler为何采用MessageChannel调度?]]></title>    <link>https://juejin.cn/post/7581678032336240682</link>    <guid>https://juejin.cn/post/7581678032336240682</guid>    <pubDate>2025-12-09T09:43:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581678032336240682" data-draft-id="7581428845683884075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Scheduler为何采用MessageChannel调度? "/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-09T09:43:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="原来是小仙女呀"/> <meta itemprop="url" content="https://juejin.cn/user/1239904846362055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Scheduler为何采用MessageChannel调度? 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904846362055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    原来是小仙女呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T09:43:59.000Z" title="Tue Dec 09 2025 09:43:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>





















































<table><thead><tr><th>特性</th><th><strong>setTimeout</strong></th><th><strong>requestAnimationFrame</strong></th><th><strong>requestIdleCallback</strong></th><th><strong>MessageChannel</strong></th></tr></thead><tbody><tr><td><strong>本质</strong></td><td>定时器宏任务</td><td>动画回调钩子</td><td>空闲期回调钩子</td><td>消息通信宏任务</td></tr><tr><td><strong>执行时机</strong></td><td>延迟指定毫秒后（不精确）</td><td><strong>下一帧渲染之前</strong>（与刷新率同步）</td><td><strong>浏览器空闲时</strong>（一帧的末尾）</td><td><strong>下一轮事件循环</strong>（作为宏任务）</td></tr><tr><td><strong>主要设计目的</strong></td><td>延迟执行代码</td><td>实现流畅动画</td><td>执行低优先级后台任务</td><td>不同上下文间通信</td></tr><tr><td><strong>关键优势</strong></td><td>通用、灵活、兼容性好</td><td><strong>动画流畅、节能</strong>（后台暂停）</td><td><strong>不阻塞渲染与交互</strong>，利用空闲时间</td><td><strong>延迟极短且稳定</strong>，可精准控制任务切片</td></tr><tr><td><strong>关键缺陷</strong></td><td><strong>时序不精确</strong>，嵌套有最小延迟（如4ms）</td><td><strong>依赖渲染周期</strong>，执行频率固定（~16.7ms）</td><td><strong>执行时机不可控</strong>，可能长期得不到调用</td><td><strong>非用于调度</strong>，是“创造性”用法</td></tr><tr><td><strong>React调度的适用性</strong></td><td>❌ 延迟不可控，不适合精细调度</td><td>❌ 依赖渲染节奏，无法在帧中多次调度</td><td>❌ 时机不可靠，无法满足及时响应需求</td><td>✅ <strong>在事件循环中及时插入任务，实现可中断调度的理想选择</strong></td></tr></tbody></table>
<h3 data-id="heading-0">📝 各API功能与特性详解</h3>
<p>下面我们来具体看看每个API的核心工作机制和适用场景。</p>
<ol>
<li>
<p><strong>setTimeout</strong></p>
<ul>
<li><strong>功能</strong>：最基础的异步定时器，用于在指定的延迟（毫秒）后，将回调函数推入任务队列等待执行</li>
<li><strong>执行机制</strong>：它设置的是一个“<strong>最小延迟</strong>”，而非精确时间。回调的实际执行时间会受到主线程上其他任务（如同步代码、微任务、UI渲染）的阻塞，延迟可能远大于设定值</li>
<li><strong>使用场景</strong>：适用于对时间精度要求不高的延迟操作，如防抖/节流、轮询检查等。</li>
</ul>
</li>
<li>
<p><strong>requestAnimationFrame</strong></p>
<ul>
<li><strong>功能</strong>：专为动画设计的API，其回调函数会在<strong>浏览器下一次重绘（即绘制下一帧）之前执行</strong></li>
<li><strong>执行机制</strong>：与显示器的刷新率（通常是60Hz，约16.7ms/帧）同步。浏览器会自动优化调用，在页面不可见时（如标签页被隐藏）会自动暂停，以节省资源</li>
<li><strong>使用场景</strong>：<strong>实现任何需要平滑过渡的动画效果</strong>，是替代<code>setTimeout</code>做动画的最佳实践</li>
</ul>
</li>
<li>
<p><strong>requestIdleCallback</strong></p>
<ul>
<li><strong>功能</strong>：允许你在<strong>浏览器空闲时期</strong>调度低优先级任务</li>
<li><strong>执行机制</strong>：在<strong>一帧处理完用户输入、<code>requestAnimationFrame</code>回调、布局和绘制等关键任务后，如果还有剩余时间</strong>，才会执行它的回调回调函数会接收一个<code>IdleDeadline</code>参数，告诉你当前帧还剩余多少空闲时间</li>
<li><strong>使用场景</strong>：适合执行一些非紧急的后台任务，如数据上报、非关键的数据预取等。</li>
</ul>
</li>
<li>
<p><strong>MessageChannel</strong></p>
<ul>
<li><strong>功能</strong>：用于在不同浏览器上下文（如两个iframe、主线程与Web Worker）间建立双向通信的通道</li>
<li><strong>执行机制</strong>：调用<code>port.postMessage()</code>方法，会向<strong>消息队列添加一个宏任务</strong>。这个任务会在当前事件循环的微任务执行完毕后、下一次事件循环中执行。</li>
<li><strong>使用场景</strong>：主要应用于跨上下文通信。它在React调度中的用法，是利用其<strong>能产生一个在下一轮事件循环中尽早执行的宏任务</strong>的特性。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">⚙️ 为什么React最终选择了MessageChannel？</h3>
<p>React调度器的核心目标是：<strong>实现可中断的并发渲染，将长任务切成小片，在每一帧中插入执行，同时能快速响应高优先级更新</strong>。这就要求调度器能主动、及时地“让出”主线程。</p>
<p>结合上表和分析，其他API不适用于此的原因如下：</p>
<ul>
<li><strong><code>setTimeout</code></strong>：<strong>延迟不稳定且不可控</strong>。其最小延迟（如4ms）在密集调度时会造成浪费，更严重的是，延迟时间可能被拉长，导致调度器无法在预期时间内“苏醒”并交还主线程，影响页面响应</li>
<li><strong><code>requestAnimationFrame</code></strong>：<strong>调用频率被锁死在屏幕刷新率（约16.7ms一次）</strong> 。这意味着即便一帧中有大量空闲时间，调度器也无法插入更多任务切片，无法充分利用帧内的空闲资源</li>
<li><strong><code>requestIdleCallback</code></strong>：<strong>执行时机“太被动”且不稳定</strong>。它依赖于浏览器的“空闲通知”，但空闲期可能很短或很久都不出现。对于需要主动、可预测地进行任务切片的调度器来说，这不可靠，同时，其兼容性也不够理想。</li>
</ul>
<p><strong><code>MessageChannel</code>的优势</strong>正在于解决了上述问题：</p>
<ol>
<li><strong>主动且及时的调度</strong>：通过<code>port.postMessage()</code>，React可以<strong>主动</strong>在下一个事件循环中创建一个宏任务来继续工作。这让调度器能精确地在每个5ms左右的时间片（这是React设定的切片时间目标<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.cn%2Fdeveloper%2Farticle%2F2440386" target="_blank" title="https://cloud.tencent.cn/developer/article/2440386" ref="nofollow noopener noreferrer">-7</a>）结束后“中断”自己，及时归还主线程给浏览器进行渲染或处理交互。</li>
<li><strong>更高的执行频率</strong>：它不依赖屏幕刷新率，可以在<strong>同一帧内的多次事件循环中连续调度</strong>，从而更密集、更充分地利用一帧之内的计算资源。</li>
<li><strong>避免微任务的弊端</strong>：为什么不直接用<code>Promise</code>（微任务）？因为微任务会在当前事件循环中<strong>连续执行直到队列清空</strong>，这同样会长时间阻塞主线程，达不到“可中断”的目的</li>
</ol>
<h3 data-id="heading-2">💎 总结</h3>
<p>React选择<code>MessageChannel</code>，是基于其<strong>能产生一个在事件循环中及时、稳定执行的宏任务</strong>这一特性。这为React实现<strong>主动、可中断、基于时间片的任务调度</strong>提供了最合适的底层机制，从而在实现并发渲染的同时，保障了浏览器的渲染和用户交互能获得最高优先级的响应。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[webpack和vite区别及原理实现]]></title>    <link>https://juejin.cn/post/7581698074360971273</link>    <guid>https://juejin.cn/post/7581698074360971273</guid>    <pubDate>2025-12-09T09:52:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074360971273" data-draft-id="7581658157145358386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="webpack和vite区别及原理实现"/> <meta itemprop="keywords" content="Vite,Webpack,掘金·金石计划"/> <meta itemprop="datePublished" content="2025-12-09T09:52:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光影少年"/> <meta itemprop="url" content="https://juejin.cn/user/3184663905962126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            webpack和vite区别及原理实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3184663905962126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光影少年
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T09:52:08.000Z" title="Tue Dec 09 2025 09:52:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Webpack</strong> 和 <strong>Vite</strong> 都是用于构建现代前端应用的构建工具，它们在原理和实现上有显著的区别。下面我将详细比较它们的异同，帮助你了解两者的工作原理以及各自的优势。</p>
<hr/>
<h2 data-id="heading-0">✅ <strong>一、Webpack 和 Vite 的核心区别</strong></h2>








































<table><thead><tr><th>特性</th><th>Webpack</th><th>Vite</th></tr></thead><tbody><tr><td><strong>构建速度</strong></td><td>较慢，特别是大型项目</td><td>快，几乎是即时的</td></tr><tr><td><strong>构建原理</strong></td><td>通过打包所有资源，生成最终的 bundle</td><td>采用按需编译，利用浏览器原生支持 ES 模块</td></tr><tr><td><strong>开发模式</strong></td><td>一开始就进行全部的打包，编译速度较慢</td><td>通过浏览器原生支持 ES Modules，只有请求的模块才会被处理</td></tr><tr><td><strong>构建产物</strong></td><td>生成一个或多个 bundle 文件</td><td>基于 ES Module 按需加载，不同于 Webpack 完整的打包</td></tr><tr><td><strong>支持类型</strong></td><td>支持所有 JavaScript，CSS，图片，字体等</td><td>主要支持 ES 模块，针对现代浏览器优化</td></tr><tr><td><strong>使用体验</strong></td><td>配置复杂，适用于各种需求和优化</td><td>配置简单，适合快速开发，但功能不如 Webpack 灵活</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">✅ <strong>二、Webpack 原理和实现</strong></h2>
<h4 data-id="heading-2"><strong>1. 传统的打包工具</strong></h4>
<p>Webpack 是一个 <strong>模块打包器</strong>，它将所有的静态资源（JavaScript、CSS、图片等）当作模块处理，并生成一个或多个 bundle 文件，最终这些文件将被浏览器加载。</p>
<h4 data-id="heading-3"><strong>2. 打包过程：</strong></h4>
<p>Webpack 的打包过程主要包含以下几个阶段：</p>
<ol>
<li>
<p><strong>解析阶段（Parsing）</strong></p>
<ul>
<li>Webpack 从入口文件（entry）开始，递归地解析每一个依赖，生成依赖图。</li>
<li>在解析时，Webpack 会调用 <strong>loader</strong> 对不同类型的文件进行预处理（如 Babel 转译、Sass 编译等）。</li>
</ul>
</li>
<li>
<p><strong>构建阶段（Building）</strong></p>
<ul>
<li>Webpack 会通过 <strong>loader</strong> 和 <strong>plugin</strong> 处理所有模块，生成最终的 <strong>AST（抽象语法树）</strong> 。</li>
<li>使用 <strong>module bundling</strong> 将所有模块合并成一个或多个文件（bundle）。</li>
</ul>
</li>
<li>
<p><strong>优化阶段（Optimization）</strong></p>
<ul>
<li>Webpack 会对生成的 bundle 进行优化，如：分割代码（Code Splitting）、压缩（Terser）等。</li>
</ul>
</li>
<li>
<p><strong>输出阶段（Output）</strong></p>
<ul>
<li>最终将 bundle 输出到指定的目录，并生成相应的文件供浏览器使用。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4"><strong>3. Webpack 需要时间打包所有资源</strong></h4>
<p>由于 Webpack 会将所有资源都打包成一个或多个文件，所以当你做 <code>webpack --mode development</code> 命令时，它必须编译所有文件，这就导致开发过程中启动时间较长。</p>
<hr/>
<h2 data-id="heading-5">✅ <strong>三、Vite 原理和实现</strong></h2>
<h4 data-id="heading-6"><strong>1. 基于浏览器原生支持的 ES Modules</strong></h4>
<p>Vite 的核心原理是利用浏览器原生支持 <strong>ES Modules</strong>，它并不像 Webpack 那样进行完整的打包，而是通过 <strong>按需加载</strong> 来提高构建速度。</p>
<h4 data-id="heading-7"><strong>2. Vite 开发流程：</strong></h4>
<p>Vite 的开发过程分为两个阶段：</p>
<h5 data-id="heading-8"><strong>开发阶段：</strong></h5>
<ol>
<li>
<p><strong>按需编译</strong>：</p>
<ul>
<li>当你启动 Vite 时，它不会一次性打包整个项目，而是仅对 <strong>首次请求的模块</strong> 进行编译和服务。比如，只有用户第一次访问某个页面时，Vite 才会编译该页面依赖的 JavaScript 和 CSS。</li>
</ul>
</li>
<li>
<p><strong>热模块替换（HMR）</strong> ：</p>
<ul>
<li>Vite 提供了 <strong>即时的热模块替换</strong>，当你在开发过程中修改了某个模块，Vite 会只编译并替换该模块，而不是重新打包整个项目。这大大提高了开发体验。</li>
</ul>
</li>
</ol>
<h5 data-id="heading-9"><strong>构建阶段：</strong></h5>
<ol start="3">
<li>
<p><strong>生产构建（build）</strong> ：</p>
<ul>
<li>在生产环境下，Vite 使用 <strong>Rollup</strong>（一个现代的 JavaScript 打包工具）进行最终的打包，将所有模块合并成一个优化过的 bundle，进行代码拆分，压缩等优化，生成最终的静态文件。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10"><strong>3. 不需要一直打包全部资源</strong></h4>
<p>Vite 的按需编译和快速响应机制，使得开发过程非常迅速。只有在页面访问时，才会处理该页面的依赖，避免了 Webpack 那种完全打包的性能消耗。</p>
<hr/>
<h2 data-id="heading-11">✅ <strong>四、Webpack 与 Vite 优缺点对比</strong></h2>








































<table><thead><tr><th>特性</th><th>Webpack</th><th>Vite</th></tr></thead><tbody><tr><td><strong>构建速度</strong></td><td>较慢（尤其是大型项目时）</td><td>极快，尤其是冷启动和热更新</td></tr><tr><td><strong>配置复杂性</strong></td><td>配置较为复杂，需要处理许多细节</td><td>配置简单，开箱即用，少配置即可</td></tr><tr><td><strong>开发体验</strong></td><td>开发中每次更改都会触发完整编译</td><td>热更新速度快，修改后的内容即时反应</td></tr><tr><td><strong>支持的功能</strong></td><td>功能强大，支持的插件丰富，几乎无所不包</td><td>适合现代前端开发，特性较为简洁和聚焦</td></tr><tr><td><strong>构建产物</strong></td><td>生成一个或多个较大的 bundle</td><td>生成多个按需加载的小文件</td></tr><tr><td><strong>适用场景</strong></td><td>适合中大型复杂项目，支持更多自定义需求</td><td>适合中小型项目、现代前端框架（如 React/Vue）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">✅ <strong>五、总结</strong></h2>
<ol>
<li>
<p><strong>Webpack：</strong></p>
<ul>
<li>适用于复杂的前端项目，支持插件和加载器的灵活扩展。</li>
<li>在开发时，启动和热更新较慢，尤其是大型项目。</li>
<li>配置复杂，需要更多的手动配置来实现项目定制。</li>
</ul>
</li>
<li>
<p><strong>Vite：</strong></p>
<ul>
<li>更适合现代前端开发，特别是对开发速度和用户体验有高要求的场景。</li>
<li>使用浏览器原生的 ES Modules 来实现按需编译和即时热更新，开发体验极佳。</li>
<li>适用于现代前端框架（如 Vue、React），并在生产环境中使用 Rollup 进行高效构建。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-13">📌 <strong>推荐场景：</strong></h2>
<ul>
<li><strong>Webpack</strong> 适合 <strong>大型、复杂的前端项目</strong>，尤其是有多种技术栈、框架，或者需要更多自定义构建的项目。</li>
<li><strong>Vite</strong> 更适合 <strong>快速开发、现代化前端应用</strong>，尤其是小型或中型项目，或者想要享受极速开发体验的团队。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MFC核心架构深度解析]]></title>    <link>https://juejin.cn/post/7581097111896277046</link>    <guid>https://juejin.cn/post/7581097111896277046</guid>    <pubDate>2025-12-08T10:28:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896277046" data-draft-id="7581210455827365924" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MFC核心架构深度解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-08T10:28:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MFC核心架构深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T10:28:39.000Z" title="Mon Dec 08 2025 10:28:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读42分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>尽管MFC（Microsoft Foundation Classes）常被视为“过时”的遗留技术，但其设计思想对理解Windows编程本质和框架设计哲学仍具重要价值。作为一套经典的C++框架，MFC成功将过程式的Win32 API封装为面向对象的类库，其消息映射机制和文档/视图架构体现了早期框架设计者对软件复杂性的深刻思考。本文旨在系统性剖析MFC的核心架构，为开发者提供一个结构化的认知框架。</p>
<h2 data-id="heading-0">第一章：MFC的消息映射机制——Windows事件驱动的革命性封装</h2>
<h3 data-id="heading-1">一、Win32 SDK的原始困境：集中式消息处理的复杂性</h3>
<p>在深入理解MFC的消息映射之前，必须首先审视传统Win32 SDK编程的消息处理模式。这种模式的核心是一个集中式的窗口过程函数（Window Procedure，简称WndProc），它接收并处理发送到窗口的所有消息。</p>
<p>典型的Win32 SDK消息处理代码如下所示：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">LRESULT CALLBACK <span class="hljs-title">WndProc</span><span class="hljs-params">(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-keyword">switch</span> (message)
    {
        <span class="hljs-keyword">case</span> WM_PAINT:
        {
            PAINTSTRUCT ps;
            HDC hdc = <span class="hljs-built_in">BeginPaint</span>(hWnd, &amp;ps);
            <span class="hljs-comment">// 绘图代码...</span>
            <span class="hljs-built_in">EndPaint</span>(hWnd, &amp;ps);
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_MOUSEMOVE:
        {
            <span class="hljs-type">int</span> xPos = <span class="hljs-built_in">LOWORD</span>(lParam);
            <span class="hljs-type">int</span> yPos = <span class="hljs-built_in">HIWORD</span>(lParam);
            <span class="hljs-comment">// 处理鼠标移动...</span>
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_COMMAND:
        {
            <span class="hljs-type">int</span> wmId = <span class="hljs-built_in">LOWORD</span>(wParam);
            <span class="hljs-keyword">switch</span> (wmId)
            {
                <span class="hljs-keyword">case</span> IDM_FILE_OPEN:
                    <span class="hljs-comment">// 处理文件打开...</span>
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> IDM_FILE_SAVE:
                    <span class="hljs-comment">// 处理文件保存...</span>
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-comment">// 更多菜单项...</span>
            }
        }
        <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">case</span> WM_DESTROY:
            <span class="hljs-built_in">PostQuitMessage</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">break</span>;
            
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProc</span>(hWnd, message, wParam, lParam);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这种模式存在几个显著问题：</p>
<ol>
<li><strong>代码膨胀</strong>：随着消息类型的增加，switch-case语句变得异常庞大，一个成熟的应用程序可能处理数百种消息类型，导致代码可读性急剧下降。</li>
<li><strong>高度耦合</strong>：所有消息处理逻辑集中在单一函数中，不同类型的消息处理代码相互交织，难以模块化。</li>
<li><strong>维护困难</strong>：添加新消息处理或修改现有逻辑时，需要在庞大的switch-case结构中定位，容易引入错误。</li>
</ol>
<h3 data-id="heading-2">二、MFC的解决方案：面向对象的消息映射机制</h3>
<p>MFC的消息映射机制是对上述问题的革命性改进。它基于两个核心设计原则：</p>
<ol>
<li><strong>分散处理</strong>：将消息处理分散到各个窗口类中，每个类只处理与自己相关的消息。</li>
<li><strong>编译时绑定</strong>：通过宏在编译时建立消息到处理函数的映射关系，避免运行时的类型判断开销。</li>
</ol>
<h4 data-id="heading-3">2.1 消息映射的实现机制</h4>
<p>消息映射的实现依赖于一组精心设计的宏和静态数据结构。以下是其核心实现机制：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 典型的MFC类消息映射声明</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyWnd</span> : <span class="hljs-keyword">public</span> CWnd
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CMyWnd</span>();
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// 消息处理函数声明</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnPaint</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnFileOpen</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-comment">// 关键：声明消息映射</span>
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};

<span class="hljs-comment">// 实现文件中的消息映射定义</span>
<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyWnd, CWnd)
    <span class="hljs-built_in">ON_WM_PAINT</span>()
    <span class="hljs-built_in">ON_WM_MOUSEMOVE</span>()
    <span class="hljs-built_in">ON_COMMAND</span>(ID_FILE_OPEN, &amp;CMyWnd::OnFileOpen)
<span class="hljs-built_in">END_MESSAGE_MAP</span>()
</code></pre>
<h4 data-id="heading-4">2.2 消息映射表的内部结构</h4>
<p>当编译器处理上述代码时，会生成类似下面的静态数据结构：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 消息映射表条目结构（简化版本）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AFX_MSGMAP_ENTRY</span>
{
    UINT nMessage;      <span class="hljs-comment">// Windows消息ID</span>
    UINT nCode;         <span class="hljs-comment">// 控件通知码或其它</span>
    UINT nID;           <span class="hljs-comment">// 控件ID（命令消息用）</span>
    UINT nLastID;       <span class="hljs-comment">// 控件ID范围结束（用于范围映射）</span>
    UINT nSig;          <span class="hljs-comment">// 函数签名类型</span>
    AFX_PMSG pfn;       <span class="hljs-comment">// 指向成员函数的指针</span>
};

<span class="hljs-comment">// 为CMyWnd类生成的消息映射表</span>
<span class="hljs-type">static</span> <span class="hljs-type">const</span> AFX_MSGMAP_ENTRY _messageEntries[] =
{
    <span class="hljs-comment">// 标准Windows消息</span>
    { WM_PAINT, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_vv, (AFX_PMSG)&amp;CMyWnd::OnPaint },
    { WM_MOUSEMOVE, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_vwp, (AFX_PMSG)&amp;CMyWnd::OnMouseMove },
    
    <span class="hljs-comment">// 命令消息</span>
    { WM_COMMAND, <span class="hljs-number">0</span>, ID_FILE_OPEN, ID_FILE_OPEN, AfxSig_vv, 
      (AFX_PMSG)&amp;CMyWnd::OnFileOpen },
      
    <span class="hljs-comment">// 结束标记</span>
    { <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, AfxSig_end, (AFX_PMSG)<span class="hljs-number">0</span> }
};
</code></pre>
<h4 data-id="heading-5">2.3 消息派发流程</h4>
<p>MFC框架的消息派发过程遵循明确的算法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 伪代码展示MFC消息派发逻辑</span>
<span class="hljs-function">LRESULT <span class="hljs-title">CWnd::WindowProc</span><span class="hljs-params">(UINT message, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-comment">// 1. 获取当前类的消息映射表</span>
    <span class="hljs-type">const</span> AFX_MSGMAP* pMessageMap = <span class="hljs-built_in">GetMessageMap</span>();
    
    <span class="hljs-comment">// 2. 沿着继承链向上查找消息处理函数</span>
    <span class="hljs-keyword">while</span> (pMessageMap != <span class="hljs-literal">NULL</span>)
    {
        <span class="hljs-comment">// 在当前类的消息映射表中查找</span>
        <span class="hljs-type">const</span> AFX_MSGMAP_ENTRY* pEntries = pMessageMap-&gt;lpEntries;
        
        <span class="hljs-keyword">for</span> (; pEntries-&gt;nSig != AfxSig_end; pEntries++)
        {
            <span class="hljs-keyword">if</span> (pEntries-&gt;nMessage == message)
            {
                <span class="hljs-comment">// 找到匹配项，调用处理函数</span>
                <span class="hljs-keyword">union</span> <span class="hljs-title class_">MessageMapFunctions</span> mmf;
                mmf.pfn = pEntries-&gt;pfn;
                
                <span class="hljs-comment">// 根据函数签名调用相应的处理函数</span>
                <span class="hljs-keyword">switch</span> (pEntries-&gt;nSig)
                {
                    <span class="hljs-keyword">case</span> AfxSig_vv:  <span class="hljs-comment">// void func(void)</span>
                        (<span class="hljs-keyword">this</span>-&gt;*mmf.pfn_vv)();
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                        
                    <span class="hljs-keyword">case</span> AfxSig_vwp: <span class="hljs-comment">// void func(UINT, CPoint)</span>
                        (<span class="hljs-keyword">this</span>-&gt;*mmf.pfn_vwp)(wParam, 
                                            <span class="hljs-built_in">CPoint</span>(<span class="hljs-built_in">GET_X_LPARAM</span>(lParam), 
                                                  <span class="hljs-built_in">GET_Y_LPARAM</span>(lParam)));
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    <span class="hljs-comment">// 更多函数签名处理...</span>
                }
            }
        }
        
        <span class="hljs-comment">// 3. 未找到则继续在基类中查找</span>
        pMessageMap = pMessageMap-&gt;pBaseMessageMap;
    }
    
    <span class="hljs-comment">// 4. 未找到任何处理函数，调用默认窗口过程</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProc</span>(message, wParam, lParam);
}
</code></pre>
<h3 data-id="heading-6">三、消息映射的分类与高级特性</h3>
<h4 data-id="heading-7">3.1 四类消息及其处理方式</h4>
<p>MFC将Windows消息系统性地分为四类，每类有不同的映射宏和处理模式：</p>








































<table><thead><tr><th>消息类型</th><th>典型示例</th><th>映射宏</th><th>处理函数特征</th><th>应用场景</th></tr></thead><tbody><tr><td><strong>标准Windows消息</strong></td><td>WM_PAINT, WM_SIZE</td><td><code>ON_WM_XXXX()</code></td><td>固定签名，如<code>OnPaint()</code></td><td>窗口绘制、大小调整等基础操作</td></tr><tr><td><strong>命令消息</strong></td><td>菜单点击、工具栏按钮</td><td><code>ON_COMMAND(id, func)</code></td><td>无参数void函数</td><td>用户命令响应</td></tr><tr><td><strong>控件通知消息</strong></td><td>按钮点击通知、列表项选择</td><td><code>ON_NOTIFY(code, id, func)</code></td><td>接收NMHDR结构体</td><td>复杂控件交互</td></tr><tr><td><strong>反射消息</strong></td><td>WM_CTLCOLOR, WM_DRAWITEM</td><td><code>ON_WM_CTLCOLOR_REFLECT()</code></td><td>子控件自我处理</td><td>控件自定义绘制</td></tr></tbody></table>
<h4 data-id="heading-8">3.2 消息反射机制</h4>
<p>消息反射是MFC中一个巧妙的设计，它允许子控件处理通常由父窗口处理的消息。这种机制通过以下步骤实现：</p>
<ol>
<li>父窗口收到子控件的通知消息（如WM_CTLCOLOR）</li>
<li>MFC框架检查子控件是否能处理反射消息</li>
<li>如果能，将消息反射回子控件</li>
<li>子控件在自己的消息映射表中处理反射消息</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 自定义按钮类处理反射消息的示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyButton</span> : <span class="hljs-keyword">public</span> CButton
{
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">afx_msg HBRUSH <span class="hljs-title">CtlColor</span><span class="hljs-params">(CDC* pDC, UINT nCtlColor)</span></span>;
};

<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyButton, CButton)
    <span class="hljs-built_in">ON_WM_CTLCOLOR_REFLECT</span>()  <span class="hljs-comment">// 反射消息处理</span>
<span class="hljs-built_in">END_MESSAGE_MAP</span>()

<span class="hljs-function">HBRUSH <span class="hljs-title">CMyButton::CtlColor</span><span class="hljs-params">(CDC* pDC, UINT nCtlColor)</span>
</span>{
    <span class="hljs-comment">// 按钮自行决定背景色，而不是由对话框统一控制</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));  <span class="hljs-comment">// 红色文字</span>
    pDC-&gt;<span class="hljs-built_in">SetBkColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>));  <span class="hljs-comment">// 黄色背景</span>
    
    <span class="hljs-function"><span class="hljs-type">static</span> CBrush <span class="hljs-title">yellowBrush</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    <span class="hljs-keyword">return</span> yellowBrush;
}
</code></pre>
<h4 data-id="heading-9">3.3 消息范围映射</h4>
<p>对于处理一系列连续ID的相似命令，MFC提供了消息范围映射机制：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 处理ID从ID_TOOL_BUTTON_FIRST到ID_TOOL_BUTTON_LAST的所有工具栏按钮</span>
<span class="hljs-built_in">BEGIN_MESSAGE_MAP</span>(CMyView, CView)
    <span class="hljs-built_in">ON_COMMAND_RANGE</span>(ID_TOOL_BUTTON_FIRST, ID_TOOL_BUTTON_LAST, OnToolButtonClicked)
<span class="hljs-built_in">END_MESSAGE_MAP</span>()

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnToolButtonClicked</span><span class="hljs-params">(UINT nID)</span>
</span>{
    <span class="hljs-comment">// 根据具体ID执行相应操作</span>
    <span class="hljs-type">int</span> buttonIndex = nID - ID_TOOL_BUTTON_FIRST;
    <span class="hljs-comment">// 处理逻辑...</span>
}
</code></pre>
<h3 data-id="heading-10">四、消息映射的性能与设计权衡</h3>
<h4 data-id="heading-11">4.1 性能分析</h4>
<p>MFC消息映射机制在性能上做出了以下权衡：</p>
<ol>
<li><strong>空间换时间</strong>：为每个窗口类生成静态消息映射表，占用额外内存，但避免了运行时的动态查找开销。</li>
<li><strong>线性查找</strong>：消息映射表通常较小，线性查找效率可接受。对于有大量消息处理的大型类，查找效率可能成为瓶颈。</li>
<li><strong>继承链查找</strong>：当消息在当前类未找到时，需要沿继承链向上查找，这增加了处理未处理消息的开销。</li>
</ol>
<h4 data-id="heading-12">4.2 与替代方案的对比</h4>
<p>与其它框架的消息/事件处理机制相比：</p>








































<table><thead><tr><th>机制</th><th>代表框架</th><th>实现方式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>消息映射</strong></td><td>MFC</td><td>编译时静态绑定，线性查找</td><td>类型安全，编译时检查</td><td>不够灵活，继承链查找开销</td></tr><tr><td><strong>虚函数表</strong></td><td>早期OWL</td><td>每个消息对应虚函数</td><td>直接调用，性能高</td><td>虚函数表膨胀，二进制兼容性差</td></tr><tr><td><strong>信号槽</strong></td><td>Qt</td><td>运行时连接，字符串匹配</td><td>高度灵活，跨线程安全</td><td>运行时开销，类型安全检查弱</td></tr><tr><td><strong>委托/事件</strong></td><td>.NET</td><td>多播委托，引用计数</td><td>类型安全，支持多订阅者</td><td>垃圾回收依赖，非实时系统可能不适合</td></tr></tbody></table>
<h3 data-id="heading-13">五、现代框架中的消息映射遗产</h3>
<p>虽然MFC本身已不再是主流开发框架，但其消息映射的思想影响了后续众多UI框架：</p>
<ol>
<li><strong>.NET WinForms</strong>：事件处理模型借鉴了消息映射的对象化思想</li>
<li><strong>WPF/UWP</strong>：路由事件概念可以视为消息映射的进化形式</li>
<li><strong>Qt信号槽</strong>：虽然实现机制不同，但解决的问题域高度相似</li>
</ol>
<p>在现代C++ UI开发中，我们可以观察到类似的消息处理模式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 现代C++ UI框架中的类似模式（概念示例）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModernButton</span> : <span class="hljs-keyword">public</span> UIWidget
{
    <span class="hljs-comment">// 声明事件处理器</span>
    EventHandler&lt;<span class="hljs-built_in">void</span>()&gt; onClick;
    
    <span class="hljs-comment">// 连接事件</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setupEventHandlers</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// 类似于MFC的消息映射，但更灵活</span>
        onMouseDown += [<span class="hljs-keyword">this</span>](MouseEvent e) { <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">handleMouseDown</span>(e); };
        onClick += []() { <span class="hljs-comment">/* 处理点击 */</span> };
    }
};
</code></pre>
<h3 data-id="heading-14">六、总结：消息映射的设计哲学</h3>
<p>MFC消息映射机制的核心价值在于它成功地将Windows API的过程式消息处理转化为面向对象的范式。这一转化基于以下设计哲学：</p>
<ol>
<li><strong>关注点分离</strong>：不同窗口类只处理自己的消息，符合单一职责原则。</li>
<li><strong>编译时安全</strong>：通过宏在编译时建立映射，早期发现类型不匹配错误。</li>
<li><strong>框架透明性</strong>：开发者只需关注处理函数本身，复杂的消息路由由框架处理。</li>
</ol>
<p>然而，这一机制也有其历史局限性，特别是与现代反射和委托机制相比，它缺乏足够的灵活性和表达能力。理解MFC消息映射不仅有助于维护遗留代码，更重要的是，它展示了框架设计者如何通过抽象和封装来管理平台API的复杂性，这一设计思维对今天的软件开发依然具有启示意义。</p>
<h2 data-id="heading-15">第二章：MFC文档/视图架构——数据与界面的分离实践</h2>
<h3 data-id="heading-16">一、设计起源：从单体应用到模块化架构的演进</h3>
<p>在早期的Windows应用程序中，一个普遍的问题是数据管理、用户界面和业务逻辑高度耦合。以简单的文本编辑器为例，传统设计将文件操作、文本显示和用户输入处理全部混杂在窗口过程中，导致代码难以维护和扩展。</p>
<p>MFC文档/视图架构的提出，是为了解决这种“大泥球”架构问题。该架构的核心思想借鉴了软件工程中的<strong>模型-视图-控制器（MVC）模式</strong>，但根据Windows平台的特点和C++语言的特性进行了调整和优化。</p>
<h3 data-id="heading-17">二、架构组成：四大核心组件的协同工作</h3>
<p>文档/视图架构由四个核心类构成，它们各自承担明确的职责：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 架构核心类关系示意代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDocument</span>;  <span class="hljs-comment">// 数据管理层</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CView</span>;      <span class="hljs-comment">// 数据显示与交互层  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CFrameWnd</span>;  <span class="hljs-comment">// 窗口容器层</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDocTemplate</span>; <span class="hljs-comment">// 工厂与协调层</span>

<span class="hljs-comment">// 应用程序初始化时的典型设置</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyApp::InitInstance</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 1. 创建文档模板（关键粘合剂）</span>
    CSingleDocTemplate* pDocTemplate;
    pDocTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CSingleDocTemplate</span>(
        IDR_MAINFRAME,          <span class="hljs-comment">// 资源ID（菜单、图标等）</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyDoc),  <span class="hljs-comment">// 文档类</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMainFrame), <span class="hljs-comment">// 框架类</span>
        <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyView)  <span class="hljs-comment">// 视图类</span>
    );
    
    <span class="hljs-comment">// 2. 注册模板</span>
    <span class="hljs-built_in">AddDocTemplate</span>(pDocTemplate);
    
    <span class="hljs-comment">// 3. 创建或打开文档</span>
    <span class="hljs-built_in">OnFileNew</span>(); <span class="hljs-comment">// 创建新文档</span>
    
    <span class="hljs-keyword">return</span> TRUE;
}
</code></pre>
<h4 data-id="heading-18">2.1 CDocument：数据的守护者</h4>
<p>文档类是架构中的“模型”部分，负责所有与数据相关的操作：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyDocument</span> : <span class="hljs-keyword">public</span> CDocument
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CMyDocument</span>();
    
<span class="hljs-comment">// 属性</span>
<span class="hljs-keyword">private</span>:
    CString m_strTitle;      <span class="hljs-comment">// 文档标题</span>
    CStringArray m_lines;    <span class="hljs-comment">// 文本行数据</span>
    BOOL m_bModified;        <span class="hljs-comment">// 修改标志</span>
    
<span class="hljs-comment">// 操作</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 数据访问接口</span>
    <span class="hljs-function"><span class="hljs-type">const</span> CString&amp; <span class="hljs-title">GetLine</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> m_lines[nIndex]; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetLineCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> m_lines.<span class="hljs-built_in">GetSize</span>(); }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AddLine</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strLine)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DeleteLine</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span></span>;
    
    <span class="hljs-comment">// 重写基类关键方法</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnNewDocument</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnOpenDocument</span><span class="hljs-params">(LPCTSTR lpszPathName)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnSaveDocument</span><span class="hljs-params">(LPCTSTR lpszPathName)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DeleteContents</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-comment">// 序列化 - 核心数据持久化机制</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span></span>;
    
    <span class="hljs-comment">// 视图通知</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateAllViews</span><span class="hljs-params">(CView* pSender, LPARAM lHint = <span class="hljs-number">0L</span>, CObject* pHint = <span class="hljs-literal">NULL</span>)</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CMyDocument)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<p><strong>文档的关键职责包括：</strong></p>
<ol>
<li><strong>数据存储与管理</strong>：维护应用程序的核心数据结构</li>
<li><strong>持久化支持</strong>：通过Serialize方法实现文件读写</li>
<li><strong>修改追踪</strong>：管理“脏标志”（修改状态）</li>
<li><strong>视图协调</strong>：通知所有关联视图数据变更</li>
</ol>
<h4 data-id="heading-19">2.2 CView：数据的观察者与交互界面</h4>
<p>视图类是架构中的“视图”部分，负责数据的可视化呈现和用户交互：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CMyView</span>();
    
<span class="hljs-comment">// 属性</span>
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> m_nCurrentLine;      <span class="hljs-comment">// 当前选中行</span>
    CFont m_fontText;        <span class="hljs-comment">// 显示字体</span>
    CSize m_sizeChar;        <span class="hljs-comment">// 字符尺寸</span>
    
<span class="hljs-comment">// 操作</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 获取关联文档的强类型指针</span>
    <span class="hljs-function">CMyDocument* <span class="hljs-title">GetDocument</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>
    </span>{
        <span class="hljs-keyword">return</span> (CMyDocument*)m_pDocument;
    }
    
    <span class="hljs-comment">// 重写基类关键方法</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span></span>;           <span class="hljs-comment">// 绘制内容</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnInitialUpdate</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">PreCreateWindow</span><span class="hljs-params">(CREATESTRUCT&amp; cs)</span></span>;
    
    <span class="hljs-comment">// 消息处理</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonDown</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnKeyDown</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditCut</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditCopy</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnEditPaste</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CMyView)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<p>视图通过<code>GetDocument()</code>方法获取文档指针，这是文档与视图通信的主要桥梁。视图不直接存储数据，只持有对文档数据的引用。</p>
<h3 data-id="heading-20">三、文档/视图通信机制</h3>
<h4 data-id="heading-21">3.1 数据流：文档到视图的更新</h4>
<p>文档数据变化时，通过<code>UpdateAllViews()</code>方法通知所有关联的视图：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 文档类中修改数据并通知视图</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDocument::AddLine</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strLine)</span>
</span>{
    m_lines.<span class="hljs-built_in">Add</span>(strLine);
    m_bModified = TRUE;
    
    <span class="hljs-comment">// 通知所有视图数据已更新</span>
    <span class="hljs-built_in">UpdateAllViews</span>(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0L</span>, <span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// 或者携带提示信息，优化更新效率</span>
    <span class="hljs-comment">// UpdateAllViews(NULL, UPDATE_LINE_ADDED, (CObject*)&amp;strLine);</span>
}
</code></pre>
<p>视图接收更新通知并重绘：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 视图类中响应更新通知</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span>
</span>{
    <span class="hljs-comment">// 根据提示信息决定更新策略</span>
    <span class="hljs-keyword">if</span> (lHint == UPDATE_LINE_ADDED)
    {
        <span class="hljs-comment">// 局部更新：只更新新增行区域</span>
        CString* pNewLine = (CString*)pHint;
        CRect rectUpdate = <span class="hljs-built_in">CalculateLineRect</span>(m_lines.<span class="hljs-built_in">GetSize</span>()<span class="hljs-number">-1</span>);
        <span class="hljs-built_in">InvalidateRect</span>(&amp;rectUpdate);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// 完全更新：重绘整个客户区</span>
        <span class="hljs-built_in">Invalidate</span>();
    }
}
</code></pre>
<h4 data-id="heading-22">3.2 交互流：视图到文档的修改</h4>
<p>用户通过视图界面修改数据时，视图调用文档的接口：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 视图处理用户输入并修改文档</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnChar</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span>
</span>{
    CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
    
    <span class="hljs-keyword">if</span> (nChar == VK_RETURN)  <span class="hljs-comment">// 回车键</span>
    {
        pDoc-&gt;<span class="hljs-built_in">AddLine</span>(m_strCurrentLine);  <span class="hljs-comment">// 调用文档方法</span>
        m_strCurrentLine.<span class="hljs-built_in">Empty</span>();
    }
    <span class="hljs-keyword">else</span>
    {
        m_strCurrentLine += (TCHAR)nChar;
    }
    
    <span class="hljs-comment">// 重绘当前行</span>
    CRect rectUpdate = <span class="hljs-built_in">CalculateCurrentLineRect</span>();
    <span class="hljs-built_in">InvalidateRect</span>(&amp;rectUpdate);
    
    CView::<span class="hljs-built_in">OnChar</span>(nChar, nRepCnt, nFlags);
}
</code></pre>
<h3 data-id="heading-23">四、多视图支持：一档多视的实现</h3>
<p>文档/视图架构最强大的特性之一是支持单个文档对应多个视图，这在CAD、图形编辑等应用中特别有用：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 创建同一文档的第二个视图</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMainFrame::OnWindowNewView</span><span class="hljs-params">()</span>
</span>{
    CMyDocument* pDoc = (CMyDocument*)<span class="hljs-built_in">GetActiveDocument</span>();
    
    <span class="hljs-comment">// 创建新的框架窗口</span>
    CChildFrame* pNewFrame = <span class="hljs-keyword">new</span> CChildFrame;
    
    <span class="hljs-comment">// 动态创建新视图</span>
    CCreateContext context;
    context.m_pCurrentDoc = pDoc;
    context.m_pNewViewClass = <span class="hljs-built_in">RUNTIME_CLASS</span>(CMyView);
    
    <span class="hljs-comment">// 创建视图并关联到新框架</span>
    <span class="hljs-keyword">if</span> (!pNewFrame-&gt;<span class="hljs-built_in">LoadFrame</span>(IDR_MYTYPE, WS_OVERLAPPEDWINDOW, 
                              <span class="hljs-keyword">this</span>, &amp;context))
    {
        <span class="hljs-keyword">delete</span> pNewFrame;
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 显示新窗口</span>
    pNewFrame-&gt;<span class="hljs-built_in">InitialUpdateFrame</span>(pDoc, TRUE);
}

<span class="hljs-comment">// 不同类型的视图可以展示同一文档的不同方面</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGraphView</span> : <span class="hljs-keyword">public</span> CView  <span class="hljs-comment">// 图形视图</span>
{
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-comment">// 将文本数据转换为图形展示</span>
        <span class="hljs-built_in">DrawTextAsGraph</span>(pDC, pDoc-&gt;<span class="hljs-built_in">GetAllLines</span>());
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CStatsView</span> : <span class="hljs-keyword">public</span> CView  <span class="hljs-comment">// 统计视图</span>
{
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-comment">// 显示文本的统计信息</span>
        <span class="hljs-built_in">DrawStatistics</span>(pDC, pDoc-&gt;<span class="hljs-built_in">CalculateStats</span>());
    }
};
</code></pre>
<h3 data-id="heading-24">五、序列化：文档持久化的核心机制</h3>
<p>序列化是文档/视图架构的数据持久化基础，它通过<code>CArchive</code>类实现数据的二进制流式读写：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 文档类的序列化实现</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDocument::Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span>
</span>{
    <span class="hljs-keyword">if</span> (ar.<span class="hljs-built_in">IsStoring</span>())  <span class="hljs-comment">// 保存文档</span>
    {
        <span class="hljs-comment">// 写入版本标识</span>
        ar &lt;&lt; (WORD)<span class="hljs-number">0x0001</span>;  <span class="hljs-comment">// 版本1.0</span>
        
        <span class="hljs-comment">// 写入文档属性</span>
        ar &lt;&lt; m_strTitle;
        ar &lt;&lt; m_bModified;
        
        <span class="hljs-comment">// 写入数据内容</span>
        m_lines.<span class="hljs-built_in">Serialize</span>(ar);  <span class="hljs-comment">// CStringArray支持序列化</span>
        
        <span class="hljs-comment">// 写入自定义对象</span>
        <span class="hljs-keyword">if</span> (m_pCustomObj != <span class="hljs-literal">NULL</span>)
        {
            ar &lt;&lt; (WORD)<span class="hljs-number">1</span>;  <span class="hljs-comment">// 标记有对象</span>
            ar.<span class="hljs-built_in">WriteObject</span>(m_pCustomObj);  <span class="hljs-comment">// 写入可序列化对象</span>
        }
        <span class="hljs-keyword">else</span>
        {
            ar &lt;&lt; (WORD)<span class="hljs-number">0</span>;  <span class="hljs-comment">// 标记无对象</span>
        }
    }
    <span class="hljs-keyword">else</span>  <span class="hljs-comment">// 加载文档</span>
    {
        <span class="hljs-comment">// 读取版本标识</span>
        WORD wVersion;
        ar &gt;&gt; wVersion;
        
        <span class="hljs-keyword">if</span> (wVersion == <span class="hljs-number">0x0001</span>)
        {
            <span class="hljs-comment">// 读取文档属性</span>
            ar &gt;&gt; m_strTitle;
            ar &gt;&gt; m_bModified;
            
            <span class="hljs-comment">// 读取数据内容</span>
            m_lines.<span class="hljs-built_in">Serialize</span>(ar);
            
            <span class="hljs-comment">// 读取自定义对象</span>
            WORD wHasObject;
            ar &gt;&gt; wHasObject;
            <span class="hljs-keyword">if</span> (wHasObject == <span class="hljs-number">1</span>)
            {
                m_pCustomObj = (CCustomObject*)ar.<span class="hljs-built_in">ReadObject</span>(
                    <span class="hljs-built_in">RUNTIME_CLASS</span>(CCustomObject));
            }
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// 处理旧版本格式</span>
            <span class="hljs-built_in">LoadOldFormat</span>(ar, wVersion);
        }
    }
}

<span class="hljs-comment">// 自定义可序列化对象的实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CCustomObject</span> : <span class="hljs-keyword">public</span> CObject
{
    <span class="hljs-built_in">DECLARE_SERIAL</span>(CCustomObject)
    
<span class="hljs-keyword">private</span>:
    CString m_strData;
    <span class="hljs-type">int</span> m_nValue;
    CPointArray m_points;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span>
    </span>{
        CObject::<span class="hljs-built_in">Serialize</span>(ar);
        
        <span class="hljs-keyword">if</span> (ar.<span class="hljs-built_in">IsStoring</span>())
        {
            ar &lt;&lt; m_strData &lt;&lt; m_nValue;
            m_points.<span class="hljs-built_in">Serialize</span>(ar);
        }
        <span class="hljs-keyword">else</span>
        {
            ar &gt;&gt; m_strData &gt;&gt; m_nValue;
            m_points.<span class="hljs-built_in">Serialize</span>(ar);
        }
    }
    
    <span class="hljs-comment">// 必须有无参构造函数</span>
    <span class="hljs-built_in">CCustomObject</span>() { }
};

<span class="hljs-built_in">IMPLEMENT_SERIAL</span>(CCustomObject, CObject, VERSIONABLE_SCHEMA | <span class="hljs-number">1</span>)
</code></pre>
<h3 data-id="heading-25">六、与经典MVC架构的深度对比</h3>
<h4 data-id="heading-26">6.1 相似性：分离关注点的共同追求</h4>
<p>文档/视图架构与MVC都遵循了数据与显示分离的原则：</p>





























<table><thead><tr><th>概念对应</th><th>MVC组件</th><th>文档/视图组件</th><th>职责相似度</th></tr></thead><tbody><tr><td>数据层</td><td>Model</td><td>Document</td><td>高：都负责数据管理和业务规则</td></tr><tr><td>显示层</td><td>View</td><td>View</td><td>高：都负责数据可视化</td></tr><tr><td>控制层</td><td>Controller</td><td>分散处理</td><td>低：MVC有独立控制器</td></tr></tbody></table>
<h4 data-id="heading-27">6.2 差异性：架构完整性的本质区别</h4>
<p>关键差异在于控制层的处理方式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MVC的明确控制流</span>
<span class="hljs-comment">// 1. 用户输入 -&gt; Controller</span>
<span class="hljs-comment">// 2. Controller更新Model</span>
<span class="hljs-comment">// 3. Model通知View更新</span>

<span class="hljs-comment">// 文档/视图的混合控制流</span>
<span class="hljs-comment">// 1. 用户输入 -&gt; View（直接处理）</span>
<span class="hljs-comment">// 2. View更新Document（直接调用）</span>
<span class="hljs-comment">// 3. Document通知所有View更新</span>
</code></pre>
<p><strong>架构差异的具体表现：</strong></p>
<ol>
<li>
<p><strong>控制器角色的缺失</strong></p>
<ul>
<li>MVC：Controller是独立的协调者，决定如何响应输入</li>
<li>文档/视图：控制逻辑分散在View和Document中</li>
</ul>
</li>
<li>
<p><strong>通信模式的不同</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MVC：观察者模式，松耦合</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> {
    List&lt;Observer&gt; observers;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">notifyObservers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (obs in observers) obs.<span class="hljs-built_in">update</span>();
    }
};

<span class="hljs-comment">// 文档/视图：直接调用，紧耦合</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> {
    List&lt;View*&gt; views;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateAllViews</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (view in views) view-&gt;<span class="hljs-built_in">OnUpdate</span>(<span class="hljs-keyword">this</span>);
    }
};
</code></pre>
</li>
<li>
<p><strong>可测试性的影响</strong></p>
<ul>
<li>MVC：Model和Controller可独立于View进行单元测试</li>
<li>文档/视图：View和Document紧密耦合，测试困难</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">七、架构的适用场景与局限性</h3>
<h4 data-id="heading-29">7.1 理想适用场景</h4>
<p>文档/视图架构特别适合以下类型的应用：</p>
<ol>
<li><strong>文档中心型应用</strong>：文字处理器、电子表格、代码编辑器</li>
<li><strong>多视图数据展示</strong>：CAD系统、数据分析工具、数据库前端</li>
<li><strong>需要完整文件支持的应用</strong>：支持打开、保存、另存为等标准操作</li>
</ol>
<h4 data-id="heading-30">7.2 架构局限性</h4>
<ol>
<li><strong>学习曲线陡峭</strong>：需要理解大量MFC特定概念和宏</li>
<li><strong>过度设计简单应用</strong>：对于对话框应用过于复杂</li>
<li><strong>平台锁定</strong>：深度绑定Windows和MFC框架</li>
<li><strong>现代性不足</strong>：缺乏对触摸、手势等现代交互的支持</li>
</ol>
<h3 data-id="heading-31">八、实际应用示例：简易文本编辑器</h3>
<p>以下是文档/视图架构在文本编辑器中的完整实现示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 文档类 - 管理文本数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextDocument</span> : <span class="hljs-keyword">public</span> CDocument
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CTextDocument</span>();
    
    <span class="hljs-comment">// 数据存储</span>
    CStringArray m_lines;
    <span class="hljs-type">int</span> m_nTotalChars;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 数据操作接口</span>
    <span class="hljs-function">BOOL <span class="hljs-title">InsertText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">const</span> CString&amp; strText)</span></span>;
    <span class="hljs-function">BOOL <span class="hljs-title">DeleteText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">int</span> nCount)</span></span>;
    <span class="hljs-function">CString <span class="hljs-title">GetText</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos, <span class="hljs-type">int</span> nCount)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-comment">// 重写关键方法</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnNewDocument</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Serialize</span><span class="hljs-params">(CArchive&amp; ar)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DeleteContents</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CTextDocument)
};

<span class="hljs-comment">// 视图类 - 显示和编辑文本</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextView</span> : <span class="hljs-keyword">public</span> CScrollView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-built_in">CTextView</span>();
    
    <span class="hljs-comment">// 编辑状态</span>
    <span class="hljs-type">int</span> m_nCaretLine;    <span class="hljs-comment">// 光标所在行</span>
    <span class="hljs-type">int</span> m_nCaretPos;     <span class="hljs-comment">// 光标在行中的位置</span>
    BOOL m_bSelecting;   <span class="hljs-comment">// 是否在选择文本</span>
    CPoint m_ptSelectStart; <span class="hljs-comment">// 选择起始点</span>
    
    <span class="hljs-comment">// 显示属性</span>
    CFont m_font;
    CSize m_sizeChar;    <span class="hljs-comment">// 字符尺寸</span>
    <span class="hljs-type">int</span> m_nLinesPerPage; <span class="hljs-comment">// 每页行数</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">CTextDocument* <span class="hljs-title">GetDocument</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-comment">// 重写关键方法</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnDraw</span><span class="hljs-params">(CDC* pDC)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnInitialUpdate</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnUpdate</span><span class="hljs-params">(CView* pSender, LPARAM lHint, CObject* pHint)</span></span>;
    
    <span class="hljs-comment">// 消息处理</span>
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonDown</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnLButtonUp</span><span class="hljs-params">(UINT nFlags, CPoint point)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnKeyDown</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnChar</span><span class="hljs-params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;
    <span class="hljs-function">afx_msg <span class="hljs-type">void</span> <span class="hljs-title">OnVScroll</span><span class="hljs-params">(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar)</span></span>;
    
    <span class="hljs-comment">// 计算辅助函数</span>
    <span class="hljs-function">CPoint <span class="hljs-title">CharPosFromPoint</span><span class="hljs-params">(CPoint point)</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function">CPoint <span class="hljs-title">PointFromCharPos</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine, <span class="hljs-type">int</span> nPos)</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function">CRect <span class="hljs-title">GetLineRect</span><span class="hljs-params">(<span class="hljs-type">int</span> nLine)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CTextView)
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<h3 data-id="heading-32">九、现代框架中的演进与启示</h3>
<p>虽然MFC文档/视图架构已逐渐退出主流，但其设计思想在现代框架中仍有体现：</p>
<ol>
<li><strong>数据绑定</strong>：WPF/XAML的数据绑定机制是文档/视图分离的进化</li>
<li><strong>MVVM模式</strong>：Model-View-ViewModel可视为文档/视图的现代化身</li>
<li><strong>响应式编程</strong>：RxJS等库实现了更灵活的数据-视图同步</li>
</ol>
<p><strong>架构演进的启示：</strong></p>
<ul>
<li>关注点分离是永恒的设计原则</li>
<li>框架应该提供清晰的数据流指导</li>
<li>可测试性应该成为架构的核心考量</li>
<li>平台抽象层对于长期维护至关重要</li>
</ul>
<p>文档/视图架构展示了在特定技术约束下（C++、Windows、90年代硬件）如何实现复杂应用的结构化组织。虽然具体技术已过时，但其背后的架构思维——如何管理复杂性、如何分离关注点、如何设计可扩展的系统——对今天的软件开发者仍有重要价值。</p>
<h2 data-id="heading-33">第三章：MFC对话框与DDX/DDV机制——用户界面的标准化封装</h2>
<h3 data-id="heading-34">一、对话框编程的演进：从原始API到MFC封装</h3>
<p>在原始的Windows SDK中，创建和管理对话框是一项繁琐且容易出错的工作。开发者需要手动处理对话框过程函数、控件消息、数据验证等一系列复杂任务。MFC的对话框类（CDialog及其派生类）通过面向对象的封装，极大地简化了这一过程。</p>
<h4 data-id="heading-35">1.1 原始Win32对话框编程的复杂性</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Win32 SDK中的对话框示例</span>
<span class="hljs-function">BOOL CALLBACK <span class="hljs-title">DialogProc</span><span class="hljs-params">(HWND hwndDlg, UINT uMsg, WPARAM wParam, LPARAM lParam)</span>
</span>{
    <span class="hljs-keyword">switch</span> (uMsg)
    {
        <span class="hljs-keyword">case</span> WM_INITDIALOG:
            <span class="hljs-comment">// 初始化控件</span>
            <span class="hljs-built_in">SetDlgItemText</span>(hwndDlg, IDC_EDIT_NAME, <span class="hljs-string">"默认名称"</span>);
            <span class="hljs-built_in">SetDlgItemInt</span>(hwndDlg, IDC_EDIT_AGE, <span class="hljs-number">25</span>, FALSE);
            <span class="hljs-keyword">return</span> TRUE;
            
        <span class="hljs-keyword">case</span> WM_COMMAND:
            <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">LOWORD</span>(wParam))
            {
                <span class="hljs-keyword">case</span> IDOK:
                {
                    <span class="hljs-comment">// 获取数据</span>
                    TCHAR szName[<span class="hljs-number">100</span>];
                    <span class="hljs-built_in">GetDlgItemText</span>(hwndDlg, IDC_EDIT_NAME, szName, <span class="hljs-number">100</span>);
                    
                    <span class="hljs-comment">// 手动验证</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">lstrlen</span>(szName) == <span class="hljs-number">0</span>)
                    {
                        <span class="hljs-built_in">MessageBox</span>(hwndDlg, <span class="hljs-string">"姓名不能为空"</span>, <span class="hljs-string">"错误"</span>, MB_OK);
                        <span class="hljs-keyword">return</span> TRUE;
                    }
                    
                    <span class="hljs-type">int</span> nAge = <span class="hljs-built_in">GetDlgItemInt</span>(hwndDlg, IDC_EDIT_AGE, <span class="hljs-literal">NULL</span>, FALSE);
                    <span class="hljs-keyword">if</span> (nAge &lt; <span class="hljs-number">0</span> || nAge &gt; <span class="hljs-number">150</span>)
                    {
                        <span class="hljs-built_in">MessageBox</span>(hwndDlg, <span class="hljs-string">"年龄必须在0-150之间"</span>, <span class="hljs-string">"错误"</span>, MB_OK);
                        <span class="hljs-keyword">return</span> TRUE;
                    }
                    
                    <span class="hljs-built_in">EndDialog</span>(hwndDlg, IDOK);
                    <span class="hljs-keyword">return</span> TRUE;
                }
                
                <span class="hljs-keyword">case</span> IDCANCEL:
                    <span class="hljs-built_in">EndDialog</span>(hwndDlg, IDCANCEL);
                    <span class="hljs-keyword">return</span> TRUE;
            }
            <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">return</span> FALSE;
}

<span class="hljs-comment">// 调用对话框</span>
<span class="hljs-built_in">DialogBox</span>(hInstance, <span class="hljs-built_in">MAKEINTRESOURCE</span>(IDD_MYDIALOG), hwndParent, DialogProc);
</code></pre>
<p>这种模式存在明显问题：</p>
<ol>
<li><strong>代码冗长</strong>：每个控件都需要单独获取和设置</li>
<li><strong>验证分散</strong>：验证逻辑与UI逻辑混杂</li>
<li><strong>类型不安全</strong>：所有数据都是字符串或整数，需要手动转换</li>
<li><strong>难以维护</strong>：添加新控件需要修改多个地方</li>
</ol>
<h3 data-id="heading-36">二、MFC对话框类的封装架构</h3>
<h4 data-id="heading-37">2.1 CDialog类层次结构</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// MFC对话框类的基本层次</span>
CObject
└── CCmdTarget
    └── CWnd
        └── CDialog
            ├── <span class="hljs-built_in">CCommonDialog</span> (通用对话框基类)
            │   ├── CFileDialog
            │   ├── CColorDialog
            │   ├── CFontDialog
            │   └── ...
            └── <span class="hljs-built_in">CDialogEx</span> (增强功能)

<span class="hljs-comment">// 典型的MFC对话框类定义</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
    <span class="hljs-built_in">DECLARE_DYNAMIC</span>(CMyDialog)

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 标准构造函数</span>
    <span class="hljs-built_in">CMyDialog</span>(CWnd* pParent = <span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// 对话框资源ID</span>
    <span class="hljs-keyword">enum</span> { IDD = IDD_MYDIALOG };

<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// DDX/DDV支持</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span></span>;

    <span class="hljs-comment">// 消息映射</span>
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 控件关联变量</span>
    CString m_strName;
    <span class="hljs-type">int</span> m_nAge;
    BOOL m_bAgree;
    CComboBox m_cboGender;
};
</code></pre>
<h4 data-id="heading-38">2.2 对话框生命周期管理</h4>
<p>MFC对话框的生命周期由以下关键方法控制：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 对话框创建与销毁流程</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyDialog::OnInitDialog</span><span class="hljs-params">()</span>
</span>{
    CDialogEx::<span class="hljs-built_in">OnInitDialog</span>();
    
    <span class="hljs-comment">// 1. 初始化控件</span>
    m_cboGender.<span class="hljs-built_in">AddString</span>(_T(<span class="hljs-string">"男"</span>));
    m_cboGender.<span class="hljs-built_in">AddString</span>(_T(<span class="hljs-string">"女"</span>));
    m_cboGender.<span class="hljs-built_in">SetCurSel</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. 设置初始数据</span>
    m_strName = _T(<span class="hljs-string">"张三"</span>);
    m_nAge = <span class="hljs-number">25</span>;
    m_bAgree = TRUE;
    
    <span class="hljs-comment">// 3. 更新控件显示</span>
    <span class="hljs-built_in">UpdateData</span>(FALSE);
    
    <span class="hljs-comment">// 4. 其他初始化</span>
    <span class="hljs-built_in">CenterWindow</span>();  <span class="hljs-comment">// 居中显示</span>
    
    <span class="hljs-keyword">return</span> TRUE;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnOK</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 1. 从控件获取数据并验证</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// 验证失败，不关闭对话框</span>
    
    <span class="hljs-comment">// 2. 额外的业务逻辑验证</span>
    <span class="hljs-keyword">if</span> (m_strName.<span class="hljs-built_in">GetLength</span>() &lt; <span class="hljs-number">2</span>)
    {
        <span class="hljs-built_in">MessageBox</span>(_T(<span class="hljs-string">"姓名至少需要2个字符"</span>), _T(<span class="hljs-string">"错误"</span>), MB_ICONERROR);
        <span class="hljs-built_in">GetDlgItem</span>(IDC_EDIT_NAME)-&gt;<span class="hljs-built_in">SetFocus</span>();
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 3. 调用基类OnOK关闭对话框</span>
    CDialogEx::<span class="hljs-built_in">OnOK</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnCancel</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 取消前的确认</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">MessageBox</span>(_T(<span class="hljs-string">"确定要取消吗？"</span>), _T(<span class="hljs-string">"确认"</span>), 
                   MB_YESNO | MB_ICONQUESTION) == IDYES)
    {
        CDialogEx::<span class="hljs-built_in">OnCancel</span>();
    }
}
</code></pre>
<h3 data-id="heading-39">三、DDX（对话框数据交换）机制详解</h3>
<h4 data-id="heading-40">3.1 DDX的核心原理</h4>
<p>DDX机制通过<code>DoDataExchange</code>函数和一组预定义的宏，在对话框控件和成员变量之间建立双向数据绑定：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DoDataExchange函数的标准实现</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// 文本控件交换</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-comment">// 数值控件交换</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    
    <span class="hljs-comment">// 复选框交换</span>
    <span class="hljs-built_in">DDX_Check</span>(pDX, IDC_CHECK_AGREE, m_bAgree);
    
    <span class="hljs-comment">// 单选按钮交换</span>
    <span class="hljs-built_in">DDX_Radio</span>(pDX, IDC_RADIO_MALE, m_nGender);
    
    <span class="hljs-comment">// 组合框交换</span>
    <span class="hljs-built_in">DDX_CBIndex</span>(pDX, IDC_COMBO_STATUS, m_nStatusIndex);
    <span class="hljs-built_in">DDX_CBString</span>(pDX, IDC_COMBO_STATUS, m_strStatus);
    
    <span class="hljs-comment">// 列表框交换</span>
    <span class="hljs-built_in">DDX_LBIndex</span>(pDX, IDC_LIST_ITEMS, m_nSelectedItem);
    
    <span class="hljs-comment">// 控件对象交换</span>
    <span class="hljs-built_in">DDX_Control</span>(pDX, IDC_COMBO_GENDER, m_cboGender);
}
</code></pre>
<h4 data-id="heading-41">3.2 DDX宏的编译时展开</h4>
<p>编译器会将DDX宏展开为具体的代码，以下是对<code>DDX_Text</code>宏展开的模拟：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DDX_Text宏的近似展开（概念性代码）</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDX_Text(pDX, nIDC, value) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate) { \
            <span class="hljs-comment">/* 从控件获取数据到变量 */</span> \
            HWND hWndCtrl = ::GetDlgItem((pDX)-&gt;m_pDlgWnd-&gt;m_hWnd, nIDC); \
            <span class="hljs-keyword">if</span> (hWndCtrl != NULL) { \
                int nLen = ::GetWindowTextLength(hWndCtrl); \
                CString strTemp; \
                ::GetWindowText(hWndCtrl, strTemp.GetBuffer(nLen), nLen + 1); \
                strTemp.ReleaseBuffer(); \
                <span class="hljs-comment">/* 类型转换和赋值 */</span> \
                value = _ttoi(strTemp); <span class="hljs-comment">/* 对于int类型 */</span> \
            } \
        } <span class="hljs-keyword">else</span> { \
            <span class="hljs-comment">/* 从变量设置数据到控件 */</span> \
            CString strTemp; \
            strTemp.Format(_T(<span class="hljs-string">"%d"</span>), value); <span class="hljs-comment">/* 对于int类型 */</span> \
            ::SetDlgItemText((pDX)-&gt;m_pDlgWnd-&gt;m_hWnd, nIDC, strTemp); \
        } \
    } while (0)</span>
</code></pre>
<h4 data-id="heading-42">3.3 完整DDX支持的数据类型</h4>
<p>MFC为不同类型的数据提供了专门的DDX宏：</p>













































































<table><thead><tr><th>数据类型</th><th>DDX宏</th><th>示例</th><th>适用控件</th></tr></thead><tbody><tr><td><strong>CString</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_strValue)</code></td><td>编辑框</td></tr><tr><td><strong>int</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_nValue)</code></td><td>编辑框</td></tr><tr><td><strong>UINT</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_uValue)</code></td><td>编辑框</td></tr><tr><td><strong>long</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_lValue)</code></td><td>编辑框</td></tr><tr><td><strong>DWORD</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_dwValue)</code></td><td>编辑框</td></tr><tr><td><strong>float</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_fValue)</code></td><td>编辑框</td></tr><tr><td><strong>double</strong></td><td><code>DDX_Text</code></td><td><code>DDX_Text(pDX, IDC_EDIT, m_dValue)</code></td><td>编辑框</td></tr><tr><td><strong>BOOL</strong></td><td><code>DDX_Check</code></td><td><code>DDX_Check(pDX, IDC_CHECK, m_bValue)</code></td><td>复选框</td></tr><tr><td><strong>int</strong> (单选)</td><td><code>DDX_Radio</code></td><td><code>DDX_Radio(pDX, IDC_RADIO1, m_nIndex)</code></td><td>单选按钮组</td></tr><tr><td><strong>CComboBox</strong></td><td><code>DDX_Control</code></td><td><code>DDX_Control(pDX, IDC_COMBO, m_combo)</code></td><td>组合框对象</td></tr><tr><td><strong>CListBox</strong></td><td><code>DDX_Control</code></td><td><code>DDX_Control(pDX, IDC_LIST, m_list)</code></td><td>列表框对象</td></tr></tbody></table>
<h3 data-id="heading-43">四、DDV（对话框数据验证）机制详解</h3>
<h4 data-id="heading-44">4.1 DDV的工作原理</h4>
<p>DDV在数据交换的同时进行验证，确保数据的有效性：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 带有DDV验证的DoDataExchange示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// 数据交换</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-comment">// 数据验证</span>
    <span class="hljs-built_in">DDV_MaxChars</span>(pDX, m_strName, <span class="hljs-number">50</span>);  <span class="hljs-comment">// 最多50个字符</span>
    
    <span class="hljs-comment">// 数值交换与验证</span>
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    <span class="hljs-built_in">DDV_MinMaxInt</span>(pDX, m_nAge, <span class="hljs-number">0</span>, <span class="hljs-number">150</span>);  <span class="hljs-comment">// 范围0-150</span>
    
    <span class="hljs-comment">// 字符串非空验证</span>
    <span class="hljs-built_in">DDV_NonEmptyString</span>(pDX, m_strName);
}
</code></pre>
<h4 data-id="heading-45">4.2 DDV验证失败的处理机制</h4>
<p>当DDV验证失败时，MFC会抛出异常并自动处理：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// DDV_MinMaxInt宏的内部实现逻辑（概念性）</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDV_MinMaxInt(pDX, value, minVal, maxVal) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate &amp;&amp; (value <span class="hljs-string">&lt; minVal || value &gt;</span> maxVal)) { \
            <span class="hljs-comment">/* 准备错误信息 */</span> \
            CString strError; \
            strError.Format(_T(<span class="hljs-string">"数值必须在%d和%d之间"</span>), minVal, maxVal); \
            \
            <span class="hljs-comment">/* 显示错误对话框 */</span> \
            AfxMessageBox(strError, MB_ICONEXCLAMATION); \
            \
            <span class="hljs-comment">/* 抛出异常停止后续处理 */</span> \
            (pDX)-&gt;Fail(); \
        } \
    } while (0)</span>

<span class="hljs-comment">// CDataExchange::Fail()方法的简化实现</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CDataExchange::Fail</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 设置焦点到问题控件</span>
    <span class="hljs-keyword">if</span> (m_hWndLastControl != <span class="hljs-literal">NULL</span> &amp;&amp; ::<span class="hljs-built_in">IsWindow</span>(m_hWndLastControl))
    {
        ::<span class="hljs-built_in">SetFocus</span>(m_hWndLastControl);
    }
    
    <span class="hljs-comment">// 抛出异常，被MFC框架捕获</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">CUserException</span>();
}
</code></pre>
<h4 data-id="heading-46">4.3 自定义DDV验证</h4>
<p>除了内置的DDV宏，还可以创建自定义验证：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 自定义DDV验证宏</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DDV_Email(pDX, value) \
    do { \
        <span class="hljs-keyword">if</span> ((pDX)-&gt;m_bSaveAndValidate) { \
            <span class="hljs-keyword">if</span> (!IsValidEmail(value)) { \
                AfxMessageBox(_T(<span class="hljs-string">"请输入有效的电子邮件地址"</span>), \
                             MB_ICONEXCLAMATION); \
                (pDX)-&gt;Fail(); \
            } \
        } \
    } while (0)</span>

<span class="hljs-comment">// 使用自定义验证</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_EMAIL, m_strEmail);
    <span class="hljs-built_in">DDV_Email</span>(pDX, m_strEmail);  <span class="hljs-comment">// 自定义验证</span>
}

<span class="hljs-comment">// 电子邮件验证函数</span>
<span class="hljs-function">BOOL <span class="hljs-title">CMyDialog::IsValidEmail</span><span class="hljs-params">(<span class="hljs-type">const</span> CString&amp; strEmail)</span>
</span>{
    <span class="hljs-comment">// 简单的电子邮件验证逻辑</span>
    <span class="hljs-type">int</span> nAtPos = strEmail.<span class="hljs-built_in">Find</span>(<span class="hljs-string">'@'</span>);
    <span class="hljs-type">int</span> nDotPos = strEmail.<span class="hljs-built_in">Find</span>(<span class="hljs-string">'.'</span>, nAtPos);
    
    <span class="hljs-keyword">return</span> (nAtPos &gt; <span class="hljs-number">0</span> &amp;&amp; nDotPos &gt; nAtPos + <span class="hljs-number">1</span> &amp;&amp; 
            nDotPos &lt; strEmail.<span class="hljs-built_in">GetLength</span>() - <span class="hljs-number">1</span>);
}
</code></pre>
<h3 data-id="heading-47">五、模态与非模态对话框的深入对比</h3>
<h4 data-id="heading-48">5.1 模态对话框的完整生命周期</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 模态对话框的创建与使用</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnOpenSettings</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CMyDialog <span class="hljs-title">dlg</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;  <span class="hljs-comment">// 创建对话框对象</span>
    
    <span class="hljs-comment">// 设置初始值</span>
    dlg.m_strName = m_strCurrentName;
    dlg.m_nAge = m_nCurrentAge;
    
    <span class="hljs-comment">// 显示模态对话框</span>
    <span class="hljs-keyword">if</span> (dlg.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// 用户点击了确定</span>
        m_strCurrentName = dlg.m_strName;
        m_nCurrentAge = dlg.m_nAge;
        
        <span class="hljs-comment">// 保存设置</span>
        <span class="hljs-built_in">SaveSettings</span>();
        
        <span class="hljs-comment">// 更新显示</span>
        <span class="hljs-built_in">UpdateDisplay</span>();
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// 用户点击了取消</span>
        <span class="hljs-built_in">AfxMessageBox</span>(_T(<span class="hljs-string">"设置未保存"</span>));
    }
    
    <span class="hljs-comment">// 对话框对象自动销毁</span>
}
</code></pre>
<h4 data-id="heading-49">5.2 非模态对话框的特殊管理</h4>
<p>非模态对话框需要不同的生命周期管理策略：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 非模态对话框的创建与管理</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">private</span>:
    CMyModelessDialog* m_pModelessDlg;  <span class="hljs-comment">// 指针成员</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnOpenModelessDialog</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// 防止重复打开</span>
        <span class="hljs-keyword">if</span> (m_pModelessDlg != <span class="hljs-literal">NULL</span> &amp;&amp; m_pModelessDlg-&gt;<span class="hljs-built_in">GetSafeHwnd</span>() != <span class="hljs-literal">NULL</span>)
        {
            m_pModelessDlg-&gt;<span class="hljs-built_in">SetActiveWindow</span>();
            m_pModelessDlg-&gt;<span class="hljs-built_in">ShowWindow</span>(SW_SHOW);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 创建非模态对话框</span>
        m_pModelessDlg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CMyModelessDialog</span>(<span class="hljs-keyword">this</span>);
        
        <span class="hljs-comment">// 必须指定WS_VISIBLE风格</span>
        <span class="hljs-keyword">if</span> (!m_pModelessDlg-&gt;<span class="hljs-built_in">Create</span>(IDD_MYDIALOG, <span class="hljs-keyword">this</span>))
        {
            <span class="hljs-keyword">delete</span> m_pModelessDlg;
            m_pModelessDlg = <span class="hljs-literal">NULL</span>;
            <span class="hljs-built_in">AfxMessageBox</span>(_T(<span class="hljs-string">"创建对话框失败"</span>));
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 显示对话框</span>
        m_pModelessDlg-&gt;<span class="hljs-built_in">ShowWindow</span>(SW_SHOW);
    }
    
    <span class="hljs-comment">// 对话框关闭时的清理</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnModelessDialogClosed</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_pModelessDlg != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-comment">// 注意：不能调用delete，对话框自己管理生命周期</span>
            m_pModelessDlg = <span class="hljs-literal">NULL</span>;
        }
    }
};

<span class="hljs-comment">// 非模态对话框类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyModelessDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
<span class="hljs-keyword">private</span>:
    CMyView* m_pParentView;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CMyModelessDialog</span>(CMyView* pParent) 
        : <span class="hljs-built_in">CDialogEx</span>(IDD_MYDIALOG, pParent), <span class="hljs-built_in">m_pParentView</span>(pParent) {}
    
    <span class="hljs-comment">// 重写OnOK和OnCancel</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnOK</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
            <span class="hljs-keyword">return</span>;
        
        <span class="hljs-comment">// 通知父视图</span>
        <span class="hljs-keyword">if</span> (m_pParentView != <span class="hljs-literal">NULL</span>)
        {
            m_pParentView-&gt;<span class="hljs-built_in">ApplyDialogSettings</span>(m_strName, m_nAge);
        }
        
        <span class="hljs-comment">// 不调用基类OnOK（不关闭对话框）</span>
        <span class="hljs-comment">// 而是隐藏或执行其他操作</span>
        <span class="hljs-built_in">ShowWindow</span>(SW_HIDE);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnCancel</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// 通知父视图对话框已关闭</span>
        <span class="hljs-keyword">if</span> (m_pParentView != <span class="hljs-literal">NULL</span>)
        {
            m_pParentView-&gt;<span class="hljs-built_in">OnModelessDialogClosed</span>();
        }
        
        <span class="hljs-comment">// 销毁窗口</span>
        <span class="hljs-built_in">DestroyWindow</span>();
    }
    
    <span class="hljs-comment">// 重写PostNcDestroy以删除对象</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PostNcDestroy</span><span class="hljs-params">()</span>
    </span>{
        CDialogEx::<span class="hljs-built_in">PostNcDestroy</span>();
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;  <span class="hljs-comment">// 自我删除</span>
    }
    
    <span class="hljs-built_in">DECLARE_MESSAGE_MAP</span>()
};
</code></pre>
<h3 data-id="heading-50">六、属性表（Property Sheet）与属性页（Property Page）</h3>
<p>对于复杂的设置对话框，MFC提供了属性表机制：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 属性页基类的使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGeneralPage</span> : <span class="hljs-keyword">public</span> CPropertyPage
{
    <span class="hljs-built_in">DECLARE_DYNCREATE</span>(CGeneralPage)
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CGeneralPage</span>() : <span class="hljs-built_in">CPropertyPage</span>(IDD_GENERAL_PAGE)
    {
        m_psp.dwFlags |= PSP_USETITLE;
        m_psp.pszTitle = _T(<span class="hljs-string">"常规设置"</span>);
    }
    
    <span class="hljs-comment">// 数据成员</span>
    CString m_strUserName;
    CString m_strCompany;
    BOOL m_bAutoSave;
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
    </span>{
        CPropertyPage::<span class="hljs-built_in">DoDataExchange</span>(pDX);
        <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_USERNAME, m_strUserName);
        <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_COMPANY, m_strCompany);
        <span class="hljs-built_in">DDX_Check</span>(pDX, IDC_CHECK_AUTOSAVE, m_bAutoSave);
    }
    
    <span class="hljs-comment">// 验证</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">OnApply</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">UpdateData</span>(TRUE))
            <span class="hljs-keyword">return</span> FALSE;
            
        <span class="hljs-comment">// 应用设置</span>
        <span class="hljs-built_in">AfxGetApp</span>()-&gt;<span class="hljs-built_in">WriteProfileString</span>(_T(<span class="hljs-string">"Settings"</span>), _T(<span class="hljs-string">"UserName"</span>), m_strUserName);
        
        <span class="hljs-keyword">return</span> CPropertyPage::<span class="hljs-built_in">OnApply</span>();
    }
};

<span class="hljs-comment">// 属性表的创建与使用</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyApp::OnSettings</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 创建属性表</span>
    <span class="hljs-function">CPropertySheet <span class="hljs-title">sheet</span><span class="hljs-params">(_T(<span class="hljs-string">"应用程序设置"</span>))</span></span>;
    
    <span class="hljs-comment">// 添加属性页</span>
    CGeneralPage pageGeneral;
    CAdvancedPage pageAdvanced;
    
    sheet.<span class="hljs-built_in">AddPage</span>(&amp;pageGeneral);
    sheet.<span class="hljs-built_in">AddPage</span>(&amp;pageAdvanced);
    
    <span class="hljs-comment">// 设置初始值</span>
    pageGeneral.m_strUserName = <span class="hljs-built_in">GetCurrentUserName</span>();
    pageAdvanced.m_nTimeout = <span class="hljs-built_in">GetTimeoutValue</span>();
    
    <span class="hljs-comment">// 显示模态属性表</span>
    <span class="hljs-keyword">if</span> (sheet.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// 保存所有设置</span>
        <span class="hljs-built_in">SaveSettings</span>(pageGeneral, pageAdvanced);
    }
}
</code></pre>
<h3 data-id="heading-51">七、对话框数据交换的高级技巧</h3>
<h4 data-id="heading-52">7.1 动态控件的数据交换</h4>
<p>对于动态创建的控件，需要特殊处理DDX：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDynamicDialog</span> : <span class="hljs-keyword">public</span> CDialogEx
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 动态控件ID起始值（必须大于系统ID）</span>
    <span class="hljs-keyword">enum</span> { IDC_DYNAMIC_START = <span class="hljs-number">0x8000</span> };
    
    <span class="hljs-comment">// 动态控件数组</span>
    CEdit* m_pDynamicEdits[<span class="hljs-number">10</span>];
    CStatic* m_pDynamicLabels[<span class="hljs-number">10</span>];
    <span class="hljs-type">int</span> m_nDynamicValues[<span class="hljs-number">10</span>];
    <span class="hljs-type">int</span> m_nControlCount;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
    </span>{
        CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
        
        <span class="hljs-comment">// 动态控件的DDX</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
        {
            <span class="hljs-keyword">if</span> (m_pDynamicEdits[i] != <span class="hljs-literal">NULL</span> &amp;&amp; m_pDynamicEdits[i]-&gt;<span class="hljs-built_in">GetSafeHwnd</span>() != <span class="hljs-literal">NULL</span>)
            {
                <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_DYNAMIC_START + i, m_nDynamicValues[i]);
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CreateDynamicControls</span><span class="hljs-params">(<span class="hljs-type">int</span> nCount)</span>
    </span>{
        m_nControlCount = nCount;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nCount; i++)
        {
            <span class="hljs-comment">// 创建标签</span>
            m_pDynamicLabels[i] = <span class="hljs-keyword">new</span> CStatic;
            m_pDynamicLabels[i]-&gt;<span class="hljs-built_in">Create</span>(_T(<span class="hljs-string">"动态控件 "</span>) + <span class="hljs-built_in">CString</span>(<span class="hljs-built_in">char</span>(<span class="hljs-string">'A'</span> + i)),
                                       WS_CHILD | WS_VISIBLE,
                                       <span class="hljs-built_in">CRect</span>(<span class="hljs-number">10</span>, <span class="hljs-number">30</span> + i * <span class="hljs-number">30</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span> + i * <span class="hljs-number">30</span>),
                                       <span class="hljs-keyword">this</span>);
            
            <span class="hljs-comment">// 创建编辑框</span>
            m_pDynamicEdits[i] = <span class="hljs-keyword">new</span> CEdit;
            m_pDynamicEdits[i]-&gt;<span class="hljs-built_in">Create</span>(WS_CHILD | WS_VISIBLE | WS_BORDER | ES_AUTOHSCROLL,
                                      <span class="hljs-built_in">CRect</span>(<span class="hljs-number">110</span>, <span class="hljs-number">30</span> + i * <span class="hljs-number">30</span>, <span class="hljs-number">210</span>, <span class="hljs-number">50</span> + i * <span class="hljs-number">30</span>),
                                      <span class="hljs-keyword">this</span>, IDC_DYNAMIC_START + i);
        }
    }
};
</code></pre>
<h4 data-id="heading-53">7.2 数据交换的性能优化</h4>
<p>对于包含大量控件的对话框，可以优化DDX性能：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-comment">// 使用条件编译或标志控制DDX范围</span>
    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> FULL_DATA_EXCHANGE</span>
    <span class="hljs-comment">// 完整的数据交换</span>
    <span class="hljs-built_in">ExchangeAllData</span>(pDX);
    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-comment">// 部分数据交换（根据需求）</span>
    <span class="hljs-keyword">if</span> (pDX-&gt;m_bSaveAndValidate)
    {
        <span class="hljs-comment">// 只验证必要字段</span>
        <span class="hljs-built_in">ExchangeRequiredData</span>(pDX);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// 只更新可见字段</span>
        <span class="hljs-built_in">ExchangeVisibleData</span>(pDX);
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-comment">// 分组数据交换示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::ExchangePersonalData</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_AGE, m_nAge);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_PHONE, m_strPhone);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">COptimizedDialog::ExchangeWorkData</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_COMPANY, m_strCompany);
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_POSITION, m_strPosition);
}
</code></pre>
<h3 data-id="heading-54">八、对话框与文档/视图架构的集成</h3>
<p>对话框可以作为文档/视图架构的补充：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 在文档/视图应用中使用对话框</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnEditPreferences</span><span class="hljs-params">()</span>
</span>{
    CPreferencesDialog dlg;
    
    <span class="hljs-comment">// 从文档获取当前设置</span>
    CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
    dlg.m_strDefaultPath = pDoc-&gt;<span class="hljs-built_in">GetDefaultPath</span>();
    dlg.m_nAutoSaveInterval = pDoc-&gt;<span class="hljs-built_in">GetAutoSaveInterval</span>();
    
    <span class="hljs-keyword">if</span> (dlg.<span class="hljs-built_in">DoModal</span>() == IDOK)
    {
        <span class="hljs-comment">// 更新文档设置</span>
        pDoc-&gt;<span class="hljs-built_in">SetDefaultPath</span>(dlg.m_strDefaultPath);
        pDoc-&gt;<span class="hljs-built_in">SetAutoSaveInterval</span>(dlg.m_nAutoSaveInterval);
        
        <span class="hljs-comment">// 标记文档为已修改</span>
        pDoc-&gt;<span class="hljs-built_in">SetModifiedFlag</span>(TRUE);
        
        <span class="hljs-comment">// 更新所有视图</span>
        pDoc-&gt;<span class="hljs-built_in">UpdateAllViews</span>(<span class="hljs-keyword">this</span>);
    }
}

<span class="hljs-comment">// 对话框数据变化实时更新视图</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CRealTimeDialog::OnChangeEditValue</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 获取当前值</span>
    <span class="hljs-built_in">UpdateData</span>(TRUE);
    
    <span class="hljs-comment">// 实时更新预览</span>
    CPreviewDialog* pPreview = <span class="hljs-built_in">GetPreviewWindow</span>();
    <span class="hljs-keyword">if</span> (pPreview != <span class="hljs-literal">NULL</span>)
    {
        pPreview-&gt;<span class="hljs-built_in">UpdatePreview</span>(m_nValue, m_strText);
    }
}
</code></pre>
<h3 data-id="heading-55">九、常见问题与调试技巧</h3>
<h4 data-id="heading-56">9.1 DDX/DDV常见问题排查</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 调试DDX问题的技巧</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::DoDataExchange</span><span class="hljs-params">(CDataExchange* pDX)</span>
</span>{
    <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"DoDataExchange called, m_bSaveAndValidate = %d\n"</span>), 
          pDX-&gt;m_bSaveAndValidate);
    
    CDialogEx::<span class="hljs-built_in">DoDataExchange</span>(pDX);
    
    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
    <span class="hljs-comment">// 调试模式下添加额外检查</span>
    <span class="hljs-keyword">if</span> (pDX-&gt;m_bSaveAndValidate)
    {
        <span class="hljs-comment">// 检查控件是否存在</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">GetDlgItem</span>(IDC_EDIT_NAME) == <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-built_in">TRACE0</span>(<span class="hljs-string">"错误: IDC_EDIT_NAME 控件不存在!\n"</span>);
            <span class="hljs-built_in">ASSERT</span>(FALSE);
        }
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
    
    <span class="hljs-built_in">DDX_Text</span>(pDX, IDC_EDIT_NAME, m_strName);
    
    <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"m_strName = %s\n"</span>), (LPCTSTR)m_strName);
}
</code></pre>
<h4 data-id="heading-57">9.2 内存泄漏检测</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 检测对话框相关的内存泄漏</span>
<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyDialog::OnDestroy</span><span class="hljs-params">()</span>
</span>{
    CDialogEx::<span class="hljs-built_in">OnDestroy</span>();
    
    <span class="hljs-comment">// 检查动态创建的控件是否被正确删除</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
    {
        <span class="hljs-comment">// 这些指针应该在PostNcDestroy中删除</span>
        <span class="hljs-built_in">ASSERT</span>(m_pDynamicEdits[i] == <span class="hljs-literal">NULL</span>);
    }
}

<span class="hljs-comment">// 重写PostNcDestroy确保资源清理</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyModelessDialog::PostNcDestroy</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// 清理动态控件</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_nControlCount; i++)
    {
        <span class="hljs-keyword">if</span> (m_pDynamicEdits[i] != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-keyword">delete</span> m_pDynamicEdits[i];
            m_pDynamicEdits[i] = <span class="hljs-literal">NULL</span>;
        }
    }
    
    CDialogEx::<span class="hljs-built_in">PostNcDestroy</span>();
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>;
}
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h3 data-id="heading-58">十、现代替代方案与架构启示</h3>
<p>虽然MFC对话框机制有其历史局限性，但其设计思想对现代UI框架仍有影响：</p>
<ol>
<li><strong>数据绑定模式</strong>：WPF/XAML的数据绑定是DDX的进化版本</li>
<li><strong>MVVM模式</strong>：ViewModel作为数据中介，类似于MFC对话框的数据层</li>
<li><strong>响应式表单</strong>：Angular/React中的表单验证机制借鉴了DDV的思想</li>
</ol>
<p><strong>DDX/DDV机制的现代启示</strong>：</p>
<ul>
<li>声明式数据绑定优于命令式数据操作</li>
<li>数据验证应该与UI逻辑分离</li>
<li>类型安全是框架设计的重要目标</li>
<li>开发者体验（DX）直接影响框架的采用率</li>
</ul>
<p>MFC的对话框和DDX/DDV机制展示了如何在C++环境中实现类型安全的UI数据绑定。虽然具体实现已显陈旧，但其核心思想——通过元编程简化开发者工作、确保数据完整性、提供一致的编程模型——仍然是优秀框架设计的重要原则。</p>
<h2 data-id="heading-59">第四章：MFC图形设备接口(GDI)编程——Windows图形渲染的核心引擎</h2>
<h3 data-id="heading-60">一、GDI系统架构：从硬件抽象到应用程序</h3>
<p>Windows GDI（Graphics Device Interface）是Windows操作系统的图形核心子系统，MFC通过CDC类及其派生类对其进行面向对象封装。理解GDI的层次结构是掌握MFC绘图的基础：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c729af5b21c74643a2c392c3667275b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765794519&amp;x-signature=65LtXjXR43RYb9XFc%2BGT1dQD%2BXM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-61">二、设备上下文(CDC)的深入解析</h3>
<h4 data-id="heading-62">2.1 CDC类的基本原理</h4>
<p>设备上下文是GDI的核心概念，它代表了绘图表面的抽象，包含绘图所需的所有状态信息：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// CDC类的关键内部结构（概念性）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CDC</span> : <span class="hljs-keyword">public</span> CObject
{
<span class="hljs-keyword">protected</span>:
    HDC m_hDC;                 <span class="hljs-comment">// Windows设备上下文句柄</span>
    HDC m_hAttribDC;           <span class="hljs-comment">// 属性DC（用于打印等）</span>
    BOOL m_bPrinting;          <span class="hljs-comment">// 是否为打印DC</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 构造函数与析构函数</span>
    <span class="hljs-built_in">CDC</span>();
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CDC</span>();
    
    <span class="hljs-comment">// 设备上下文操作</span>
    <span class="hljs-function">BOOL <span class="hljs-title">Attach</span><span class="hljs-params">(HDC hDC)</span></span>;      <span class="hljs-comment">// 关联现有HDC</span>
    <span class="hljs-function">HDC <span class="hljs-title">Detach</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// 分离HDC</span>
    <span class="hljs-function">HDC <span class="hljs-title">GetSafeHdc</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;    <span class="hljs-comment">// 安全获取HDC</span>
    
    <span class="hljs-comment">// 绘图状态管理</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">SaveDC</span><span class="hljs-params">()</span></span>;              <span class="hljs-comment">// 保存DC状态</span>
    <span class="hljs-function">BOOL <span class="hljs-title">RestoreDC</span><span class="hljs-params">(<span class="hljs-type">int</span> nSavedDC)</span></span>; <span class="hljs-comment">// 恢复DC状态</span>
    
    <span class="hljs-comment">// 坐标与映射模式</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CPoint <span class="hljs-title">GetViewportOrg</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CSize <span class="hljs-title">GetViewportExt</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">SetMapMode</span><span class="hljs-params">(<span class="hljs-type">int</span> nMapMode)</span></span>;
    
    <span class="hljs-comment">// 绘图操作</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">LineTo</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">Rectangle</span><span class="hljs-params">(<span class="hljs-type">int</span> x1, <span class="hljs-type">int</span> y1, <span class="hljs-type">int</span> x2, <span class="hljs-type">int</span> y2)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">Ellipse</span><span class="hljs-params">(<span class="hljs-type">int</span> x1, <span class="hljs-type">int</span> y1, <span class="hljs-type">int</span> x2, <span class="hljs-type">int</span> y2)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> BOOL <span class="hljs-title">TextOut</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, LPCTSTR lpszString, <span class="hljs-type">int</span> nCount)</span></span>;
    
    <span class="hljs-comment">// GDI对象管理</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CGdiObject* <span class="hljs-title">SelectStockObject</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> CGdiObject* <span class="hljs-title">SelectObject</span><span class="hljs-params">(CGdiObject* pObject)</span></span>;
    
    <span class="hljs-comment">// 设备能力查询</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">GetDeviceCaps</span><span class="hljs-params">(<span class="hljs-type">int</span> nIndex)</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-built_in">DECLARE_DYNAMIC</span>(CDC)
};
</code></pre>
<h4 data-id="heading-63">2.2 不同CDC派生类的使用场景</h4>
<p>MFC提供了多种CDC派生类以适应不同绘图需求：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. CPaintDC - 用于WM_PAINT消息处理</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnPaint</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CPaintDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// 自动调用BeginPaint</span>
    
    <span class="hljs-comment">// 获取无效区域</span>
    CRect rectUpdate;
    dc.<span class="hljs-built_in">GetClipBox</span>(&amp;rectUpdate);
    
    <span class="hljs-comment">// 执行绘图操作</span>
    <span class="hljs-built_in">OnDraw</span>(&amp;dc); <span class="hljs-comment">// 通常调用OnDraw进行实际绘制</span>
    
    <span class="hljs-comment">// 析构时自动调用EndPaint</span>
}

<span class="hljs-comment">// 2. CClientDC - 用于客户区即时绘图</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnMouseMove</span><span class="hljs-params">(UINT nFlags, CPoint point)</span>
</span>{
    <span class="hljs-keyword">if</span> (m_bDrawing)
    {
        <span class="hljs-function">CClientDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// 获取客户区DC</span>
        
        <span class="hljs-comment">// 实时绘制反馈</span>
        dc.<span class="hljs-built_in">MoveTo</span>(m_ptLastPos);
        dc.<span class="hljs-built_in">LineTo</span>(point);
        
        m_ptLastPos = point;
    }
    
    CView::<span class="hljs-built_in">OnMouseMove</span>(nFlags, point);
}

<span class="hljs-comment">// 3. CWindowDC - 绘制整个窗口（包括非客户区）</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyFrameWnd::OnDrawBorder</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">CWindowDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>; <span class="hljs-comment">// 获取整个窗口DC</span>
    
    <span class="hljs-comment">// 绘制自定义窗口边框</span>
    CRect rectWindow;
    <span class="hljs-built_in">GetWindowRect</span>(&amp;rectWindow);
    
    <span class="hljs-comment">// 转换为客户区坐标</span>
    <span class="hljs-built_in">ScreenToClient</span>(&amp;rectWindow);
    
    <span class="hljs-comment">// 绘制边框</span>
    <span class="hljs-function">CPen <span class="hljs-title">pen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">3</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
    dc.<span class="hljs-built_in">SelectObject</span>(&amp;pen);
    dc.<span class="hljs-built_in">SelectStockObject</span>(NULL_BRUSH);
    dc.<span class="hljs-built_in">Rectangle</span>(rectWindow);
}

<span class="hljs-comment">// 4. CMetaFileDC - 创建Windows图元文件</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::CreateMetaFile</span><span class="hljs-params">()</span>
</span>{
    CMetaFileDC dcMeta;
    
    <span class="hljs-comment">// 创建图元文件DC</span>
    <span class="hljs-keyword">if</span> (dcMeta.<span class="hljs-built_in">Create</span>())
    {
        <span class="hljs-comment">// 在图元文件中记录绘图命令</span>
        dcMeta.<span class="hljs-built_in">SetMapMode</span>(MM_ANISOTROPIC);
        dcMeta.<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);
        dcMeta.<span class="hljs-built_in">SetViewportExt</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// 记录绘图操作</span>
        dcMeta.<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">500</span>, <span class="hljs-number">500</span>);
        dcMeta.<span class="hljs-built_in">Ellipse</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">400</span>, <span class="hljs-number">400</span>);
        
        <span class="hljs-comment">// 关闭图元文件</span>
        HMETAFILE hMetaFile = dcMeta.<span class="hljs-built_in">Close</span>();
        
        <span class="hljs-keyword">if</span> (hMetaFile != <span class="hljs-literal">NULL</span>)
        {
            <span class="hljs-comment">// 可以保存或回放图元文件</span>
            <span class="hljs-function">CClientDC <span class="hljs-title">dc</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;
            dc.<span class="hljs-built_in">PlayMetaFile</span>(hMetaFile);
            
            <span class="hljs-comment">// 删除图元文件句柄</span>
            ::<span class="hljs-built_in">DeleteMetaFile</span>(hMetaFile);
        }
    }
}
</code></pre>
<h3 data-id="heading-64">三、GDI对象管理与资源生命周期</h3>
<h4 data-id="heading-65">3.1 GDI对象的基本使用模式</h4>
<p>正确的GDI对象管理是防止资源泄漏的关键：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// 1. 创建GDI对象</span>
    <span class="hljs-function">CPen <span class="hljs-title">newPen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">2</span>, RGB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>))</span></span>;
    <span class="hljs-function">CBrush <span class="hljs-title">newBrush</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    CFont newFont;
    
    <span class="hljs-comment">// 创建字体</span>
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-16</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    newFont.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    <span class="hljs-comment">// 2. 保存旧对象并选入新对象</span>
    CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newPen);
    CBrush* pOldBrush = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newBrush);
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;newFont);
    
    <span class="hljs-comment">// 3. 执行绘图操作</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">Ellipse</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">150</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, _T(<span class="hljs-string">"GDI绘图示例"</span>));
    
    <span class="hljs-comment">// 4. 恢复旧对象（按相反顺序）</span>
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldBrush);
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
    
    <span class="hljs-comment">// 5. GDI对象在作用域结束时自动删除</span>
    <span class="hljs-comment">//    注意：如果调用DeleteObject，需确保不再使用该对象</span>
}
</code></pre>
<h4 data-id="heading-66">3.2 GDI对象的创建工厂模式</h4>
<p>对于需要频繁创建相同样式GDI对象的情况，可以使用工厂模式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CGdiObjectFactory</span>
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">static</span> CMap&lt;DWORD, DWORD, CPen*, CPen*&gt; m_mapPens;
    <span class="hljs-type">static</span> CMap&lt;DWORD, DWORD, CBrush*, CBrush*&gt; m_mapBrushes;
    <span class="hljs-type">static</span> CCriticalSection m_cs; <span class="hljs-comment">// 线程保护</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 获取或创建指定样式的画笔</span>
    <span class="hljs-function"><span class="hljs-type">static</span> CPen* <span class="hljs-title">GetPen</span><span class="hljs-params">(<span class="hljs-type">int</span> nStyle, <span class="hljs-type">int</span> nWidth, COLORREF crColor)</span>
    </span>{
        <span class="hljs-function">CSingleLock <span class="hljs-title">lock</span><span class="hljs-params">(&amp;m_cs, TRUE)</span></span>;
        
        <span class="hljs-comment">// 创建唯一键</span>
        DWORD dwKey = (nStyle &lt;&lt; <span class="hljs-number">24</span>) | (nWidth &lt;&lt; <span class="hljs-number">16</span>) | crColor;
        
        CPen* pPen = <span class="hljs-literal">NULL</span>;
        <span class="hljs-keyword">if</span> (!m_mapPens.<span class="hljs-built_in">Lookup</span>(dwKey, pPen))
        {
            <span class="hljs-comment">// 创建新画笔</span>
            pPen = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CPen</span>(nStyle, nWidth, crColor);
            m_mapPens.<span class="hljs-built_in">SetAt</span>(dwKey, pPen);
        }
        
        <span class="hljs-keyword">return</span> pPen;
    }
    
    <span class="hljs-comment">// 清理所有GDI对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">Cleanup</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-function">CSingleLock <span class="hljs-title">lock</span><span class="hljs-params">(&amp;m_cs, TRUE)</span></span>;
        
        <span class="hljs-comment">// 删除所有画笔</span>
        POSITION pos = m_mapPens.<span class="hljs-built_in">GetStartPosition</span>();
        DWORD dwKey;
        CPen* pPen;
        <span class="hljs-keyword">while</span> (pos != <span class="hljs-literal">NULL</span>)
        {
            m_mapPens.<span class="hljs-built_in">GetNextAssoc</span>(pos, dwKey, pPen);
            <span class="hljs-keyword">delete</span> pPen;
        }
        m_mapPens.<span class="hljs-built_in">RemoveAll</span>();
        
        <span class="hljs-comment">// 类似地清理画刷等</span>
    }
};
</code></pre>
<h3 data-id="heading-67">四、高级绘图技术与优化</h3>
<h4 data-id="heading-68">4.1 双缓冲绘图技术</h4>
<p>双缓冲是消除绘图闪烁的关键技术：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDoubleBufferDC</span> : <span class="hljs-keyword">public</span> CDC
{
<span class="hljs-keyword">private</span>:
    CDC* m_pDC;            <span class="hljs-comment">// 原始设备上下文</span>
    CBitmap m_bitmap;      <span class="hljs-comment">// 内存位图</span>
    CBitmap* m_pOldBitmap; <span class="hljs-comment">// 旧位图</span>
    CRect m_rect;          <span class="hljs-comment">// 绘制区域</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CDoubleBufferDC</span>(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)
        : <span class="hljs-built_in">m_pDC</span>(pDC), <span class="hljs-built_in">m_rect</span>(rect)
    {
        <span class="hljs-comment">// 创建兼容的内存DC</span>
        <span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        
        <span class="hljs-comment">// 创建兼容位图</span>
        m_bitmap.<span class="hljs-built_in">CreateCompatibleBitmap</span>(pDC, rect.<span class="hljs-built_in">Width</span>(), rect.<span class="hljs-built_in">Height</span>());
        
        <span class="hljs-comment">// 选入位图</span>
        m_pOldBitmap = <span class="hljs-built_in">SelectObject</span>(&amp;m_bitmap);
        
        <span class="hljs-comment">// 设置原点偏移</span>
        <span class="hljs-built_in">SetViewportOrg</span>(-rect.left, -rect.top);
    }
    
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CDoubleBufferDC</span>()
    {
        <span class="hljs-comment">// 将内存位图拷贝到屏幕</span>
        m_pDC-&gt;<span class="hljs-built_in">BitBlt</span>(m_rect.left, m_rect.top, 
                     m_rect.<span class="hljs-built_in">Width</span>(), m_rect.<span class="hljs-built_in">Height</span>(),
                     <span class="hljs-keyword">this</span>, 
                     m_rect.left, m_rect.top, 
                     SRCCOPY);
        
        <span class="hljs-comment">// 恢复原始位图</span>
        <span class="hljs-built_in">SelectObject</span>(m_pOldBitmap);
        
        <span class="hljs-comment">// 位图对象自动删除</span>
    }
};

<span class="hljs-comment">// 在视图类中使用双缓冲</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::OnDraw</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    CRect rectClient;
    <span class="hljs-built_in">GetClientRect</span>(&amp;rectClient);
    
    <span class="hljs-comment">// 创建双缓冲DC</span>
    <span class="hljs-function">CDoubleBufferDC <span class="hljs-title">dbDC</span><span class="hljs-params">(pDC, rectClient)</span></span>;
    
    <span class="hljs-comment">// 使用dbDC进行所有绘图操作</span>
    <span class="hljs-built_in">DrawBackground</span>(&amp;dbDC, rectClient);
    <span class="hljs-built_in">DrawContent</span>(&amp;dbDC, rectClient);
    <span class="hljs-built_in">DrawOverlay</span>(&amp;dbDC, rectClient);
    
    <span class="hljs-comment">// dbDC析构时自动刷新到屏幕</span>
}
</code></pre>
<h4 data-id="heading-69">4.2 路径与复杂区域操作</h4>
<p>路径提供了一种记录和重用复杂绘图序列的方法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DrawComplexShape</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// 开始路径定义</span>
    pDC-&gt;<span class="hljs-built_in">BeginPath</span>();
    
    <span class="hljs-comment">// 定义路径形状</span>
    pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// 闭合矩形</span>
    
    <span class="hljs-comment">// 添加第二个形状</span>
    pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">150</span>, <span class="hljs-number">50</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">250</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">LineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>);
    pDC-&gt;<span class="hljs-built_in">CloseFigure</span>(); <span class="hljs-comment">// 闭合三角形</span>
    
    <span class="hljs-comment">// 结束路径定义</span>
    pDC-&gt;<span class="hljs-built_in">EndPath</span>();
    
    <span class="hljs-comment">// 1. 绘制路径轮廓</span>
    <span class="hljs-function">CPen <span class="hljs-title">pen</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">2</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
    CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;pen);
    pDC-&gt;<span class="hljs-built_in">StrokePath</span>();
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
    
    <span class="hljs-comment">// 2. 填充路径</span>
    <span class="hljs-function">CBrush <span class="hljs-title">brush</span><span class="hljs-params">(RGB(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>))</span></span>;
    CBrush* pOldBrush = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;brush);
    pDC-&gt;<span class="hljs-built_in">FillPath</span>();
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldBrush);
    
    <span class="hljs-comment">// 3. 将路径转换为区域</span>
    CRgn region;
    <span class="hljs-keyword">if</span> (region.<span class="hljs-built_in">CreateFromPath</span>(pDC))
    {
        <span class="hljs-comment">// 使用区域进行点击测试</span>
        <span class="hljs-function">CPoint <span class="hljs-title">ptTest</span><span class="hljs-params">(<span class="hljs-number">120</span>, <span class="hljs-number">120</span>)</span></span>;
        <span class="hljs-keyword">if</span> (region.<span class="hljs-built_in">PtInRegion</span>(ptTest))
        {
            pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, _T(<span class="hljs-string">"点在区域内"</span>));
        }
        
        <span class="hljs-comment">// 区域也可以用于裁剪</span>
        pDC-&gt;<span class="hljs-built_in">SelectClipRgn</span>(&amp;region);
        <span class="hljs-comment">// ... 在裁剪区域内绘图</span>
        pDC-&gt;<span class="hljs-built_in">SelectClipRgn</span>(<span class="hljs-literal">NULL</span>); <span class="hljs-comment">// 取消裁剪</span>
    }
}
</code></pre>
<h4 data-id="heading-70">4.3 坐标系统与变换</h4>
<p>MFC支持多种坐标映射模式和变换：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DemonstrateCoordinateSystems</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    <span class="hljs-comment">// 保存原始DC状态</span>
    <span class="hljs-type">int</span> nOldMapMode = pDC-&gt;<span class="hljs-built_in">SaveDC</span>();
    
    <span class="hljs-comment">// 示例1：逻辑坐标与设备坐标</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_TEXT); <span class="hljs-comment">// 默认模式，1逻辑单位=1像素</span>
    
    <span class="hljs-comment">// 设置窗口（逻辑）和视口（设备）范围</span>
    pDC-&gt;<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);  <span class="hljs-comment">// 逻辑范围</span>
    pDC-&gt;<span class="hljs-built_in">SetViewportExt</span>(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>);  <span class="hljs-comment">// 设备范围</span>
    
    <span class="hljs-comment">// 示例2：使用MM_ANISOTROPIC模式</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_ANISOTROPIC);
    pDC-&gt;<span class="hljs-built_in">SetWindowExt</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);
    pDC-&gt;<span class="hljs-built_in">SetViewportExt</span>(rectClient.<span class="hljs-built_in">Width</span>(), rectClient.<span class="hljs-built_in">Height</span>());
    
    <span class="hljs-comment">// 绘制随窗口大小缩放的图形</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">900</span>, <span class="hljs-number">900</span>);
    
    <span class="hljs-comment">// 示例3：使用MM_HIMETRIC模式（物理尺寸）</span>
    pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_HIMETRIC); <span class="hljs-comment">// 0.01毫米单位</span>
    pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">-5000</span>); <span class="hljs-comment">// 10cm x 5cm矩形</span>
    
    <span class="hljs-comment">// 坐标转换示例</span>
    <span class="hljs-function">CPoint <span class="hljs-title">ptLogical</span><span class="hljs-params">(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>)</span></span>;
    CPoint ptDevice;
    
    <span class="hljs-comment">// 逻辑坐标转设备坐标</span>
    pDC-&gt;<span class="hljs-built_in">LPtoDP</span>(&amp;ptLogical);
    
    <span class="hljs-comment">// 设备坐标转逻辑坐标</span>
    pDC-&gt;<span class="hljs-built_in">DPtoLP</span>(&amp;ptDevice);
    
    <span class="hljs-comment">// 示例4：世界变换（Windows NT/2000+）</span>
    <span class="hljs-keyword">if</span> (pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(RASTERCAPS) &amp; RC_TRANSFORM)
    {
        XFORM xform;
        
        <span class="hljs-comment">// 设置旋转矩阵（旋转30度）</span>
        <span class="hljs-type">float</span> fAngle = <span class="hljs-number">30.0f</span> * <span class="hljs-number">3.14159f</span> / <span class="hljs-number">180.0f</span>;
        xform.eM11 = <span class="hljs-built_in">cos</span>(fAngle);
        xform.eM12 = <span class="hljs-built_in">sin</span>(fAngle);
        xform.eM21 = -<span class="hljs-built_in">sin</span>(fAngle);
        xform.eM22 = <span class="hljs-built_in">cos</span>(fAngle);
        xform.eDx = <span class="hljs-number">100.0f</span>;  <span class="hljs-comment">// X方向平移</span>
        xform.eDy = <span class="hljs-number">100.0f</span>;  <span class="hljs-comment">// Y方向平移</span>
        
        <span class="hljs-comment">// 设置世界变换</span>
        pDC-&gt;<span class="hljs-built_in">SetGraphicsMode</span>(GM_ADVANCED);
        pDC-&gt;<span class="hljs-built_in">SetWorldTransform</span>(&amp;xform);
        
        <span class="hljs-comment">// 绘制变换后的图形</span>
        pDC-&gt;<span class="hljs-built_in">Rectangle</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// 恢复默认变换</span>
        pDC-&gt;<span class="hljs-built_in">ModifyWorldTransform</span>(<span class="hljs-literal">NULL</span>, MWT_IDENTITY);
    }
    
    <span class="hljs-comment">// 恢复原始DC状态</span>
    pDC-&gt;<span class="hljs-built_in">RestoreDC</span>(nOldMapMode);
}
</code></pre>
<h3 data-id="heading-71">五、字体与文本渲染</h3>
<h4 data-id="heading-72">5.1 字体创建与文本度量</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CTextRenderer</span>
{
<span class="hljs-keyword">private</span>:
    CFont m_fontNormal;
    CFont m_fontBold;
    CFont m_fontItalic;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">BOOL <span class="hljs-title">InitializeFonts</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// 创建不同风格的字体</span>
        LOGFONT lf = {<span class="hljs-number">0</span>};
        
        <span class="hljs-comment">// 标准字体</span>
        lf.lfHeight = <span class="hljs-number">-16</span>; <span class="hljs-comment">// 16像素高（负值表示字符高度）</span>
        lf.lfWeight = FW_NORMAL;
        lf.lfCharSet = DEFAULT_CHARSET;
        <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"微软雅黑"</span>));
        m_fontNormal.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-comment">// 粗体</span>
        lf.lfWeight = FW_BOLD;
        m_fontBold.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-comment">// 斜体</span>
        lf.lfWeight = FW_NORMAL;
        lf.lfItalic = TRUE;
        m_fontItalic.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
        
        <span class="hljs-keyword">return</span> TRUE;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawTextWithMetrics</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, LPCTSTR lpszText)</span>
    </span>{
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontNormal);
        
        <span class="hljs-comment">// 获取文本度量信息</span>
        TEXTMETRIC tm;
        pDC-&gt;<span class="hljs-built_in">GetTextMetrics</span>(&amp;tm);
        
        <span class="hljs-comment">// 计算文本宽度</span>
        CSize sizeText = pDC-&gt;<span class="hljs-built_in">GetTextExtent</span>(lpszText, <span class="hljs-built_in">lstrlen</span>(lpszText));
        
        <span class="hljs-comment">// 绘制背景</span>
        <span class="hljs-function">CRect <span class="hljs-title">rectText</span><span class="hljs-params">(x, y, x + sizeText.cx, y + tm.tmHeight)</span></span>;
        <span class="hljs-function">CBrush <span class="hljs-title">brushBg</span><span class="hljs-params">(RGB(<span class="hljs-number">240</span>, <span class="hljs-number">240</span>, <span class="hljs-number">240</span>))</span></span>;
        pDC-&gt;<span class="hljs-built_in">FillRect</span>(&amp;rectText, &amp;brushBg);
        
        <span class="hljs-comment">// 绘制文本</span>
        pDC-&gt;<span class="hljs-built_in">SetBkMode</span>(TRANSPARENT);
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(x, y, lpszText);
        
        <span class="hljs-comment">// 绘制基线</span>
        <span class="hljs-function">CPen <span class="hljs-title">penBaseline</span><span class="hljs-params">(PS_SOLID, <span class="hljs-number">1</span>, RGB(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>;
        CPen* pOldPen = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;penBaseline);
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(x, y + tm.tmAscent);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(x + sizeText.cx, y + tm.tmAscent);
        
        <span class="hljs-comment">// 绘制边界框</span>
        <span class="hljs-function">CPen <span class="hljs-title">penBorder</span><span class="hljs-params">(PS_DOT, <span class="hljs-number">1</span>, RGB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>))</span></span>;
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;penBorder);
        pDC-&gt;<span class="hljs-built_in">SelectStockObject</span>(NULL_BRUSH);
        pDC-&gt;<span class="hljs-built_in">Rectangle</span>(&amp;rectText);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldPen);
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
    
    <span class="hljs-comment">// 多行文本绘制</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawMultilineText</span><span class="hljs-params">(CDC* pDC, CRect rect, LPCTSTR lpszText)</span>
    </span>{
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontNormal);
        
        <span class="hljs-comment">// 设置文本格式</span>
        UINT uFormat = DT_LEFT | DT_WORDBREAK | DT_NOPREFIX | DT_EDITCONTROL;
        
        <span class="hljs-comment">// 计算需要的矩形高度</span>
        CRect rectCalc = rect;
        pDC-&gt;<span class="hljs-built_in">DrawText</span>(lpszText, <span class="hljs-number">-1</span>, &amp;rectCalc, uFormat | DT_CALCRECT);
        
        <span class="hljs-comment">// 绘制文本</span>
        pDC-&gt;<span class="hljs-built_in">DrawText</span>(lpszText, <span class="hljs-number">-1</span>, &amp;rect, uFormat);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
};
</code></pre>
<h4 data-id="heading-73">5.2 高级文本效果</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CMyView::DrawTextEffects</span><span class="hljs-params">(CDC* pDC)</span>
</span>{
    CRect rectClient;
    <span class="hljs-built_in">GetClientRect</span>(&amp;rectClient);
    
    <span class="hljs-comment">// 1. 阴影文字</span>
    <span class="hljs-built_in">DrawShadowText</span>(pDC, _T(<span class="hljs-string">"阴影效果"</span>), 
                   <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>), 
                   <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>));
    
    <span class="hljs-comment">// 2. 渐变文字</span>
    <span class="hljs-built_in">DrawGradientText</span>(pDC, _T(<span class="hljs-string">"渐变文字"</span>), 
                     <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>), 
                     <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
    
    <span class="hljs-comment">// 3. 轮廓文字</span>
    <span class="hljs-built_in">DrawOutlineText</span>(pDC, _T(<span class="hljs-string">"轮廓文字"</span>), 
                    <span class="hljs-built_in">CPoint</span>(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>), 
                    <span class="hljs-number">3</span>, <span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), <span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawShadowText</span><span class="hljs-params">(CDC* pDC, LPCTSTR lpszText, CPoint pt, 
                    COLORREF crText, COLORREF crShadow)</span>
</span>{
    CFont font;
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-48</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    font.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;font);
    
    <span class="hljs-comment">// 绘制阴影</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(crShadow);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x + <span class="hljs-number">3</span>, pt.y + <span class="hljs-number">3</span>, lpszText);
    
    <span class="hljs-comment">// 绘制前景文字</span>
    pDC-&gt;<span class="hljs-built_in">SetTextColor</span>(crText);
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x, pt.y, lpszText);
    
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawGradientText</span><span class="hljs-params">(CDC* pDC, LPCTSTR lpszText, CPoint pt,
                      COLORREF crStart, COLORREF crEnd)</span>
</span>{
    <span class="hljs-comment">// 创建字体</span>
    CFont font;
    LOGFONT lf = {<span class="hljs-number">0</span>};
    lf.lfHeight = <span class="hljs-number">-48</span>;
    lf.lfWeight = FW_BOLD;
    <span class="hljs-built_in">lstrcpy</span>(lf.lfFaceName, _T(<span class="hljs-string">"Arial"</span>));
    font.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lf);
    
    CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;font);
    
    <span class="hljs-comment">// 获取文本尺寸</span>
    CSize sizeText = pDC-&gt;<span class="hljs-built_in">GetTextExtent</span>(lpszText, <span class="hljs-built_in">lstrlen</span>(lpszText));
    
    <span class="hljs-comment">// 创建渐变画刷</span>
    TRIVERTEX vert[<span class="hljs-number">2</span>] = {<span class="hljs-number">0</span>};
    vert[<span class="hljs-number">0</span>].x = pt.x;
    vert[<span class="hljs-number">0</span>].y = pt.y;
    vert[<span class="hljs-number">0</span>].Red = <span class="hljs-built_in">GetRValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Green = <span class="hljs-built_in">GetGValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Blue = <span class="hljs-built_in">GetBValue</span>(crStart) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">0</span>].Alpha = <span class="hljs-number">0x0000</span>;
    
    vert[<span class="hljs-number">1</span>].x = pt.x + sizeText.cx;
    vert[<span class="hljs-number">1</span>].y = pt.y + sizeText.cy;
    vert[<span class="hljs-number">1</span>].Red = <span class="hljs-built_in">GetRValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Green = <span class="hljs-built_in">GetGValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Blue = <span class="hljs-built_in">GetBValue</span>(crEnd) &lt;&lt; <span class="hljs-number">8</span>;
    vert[<span class="hljs-number">1</span>].Alpha = <span class="hljs-number">0x0000</span>;
    
    GRADIENT_RECT gRect = {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>};
    
    <span class="hljs-comment">// 使用路径创建文本轮廓</span>
    pDC-&gt;<span class="hljs-built_in">BeginPath</span>();
    pDC-&gt;<span class="hljs-built_in">TextOut</span>(pt.x, pt.y, lpszText);
    pDC-&gt;<span class="hljs-built_in">EndPath</span>();
    
    <span class="hljs-comment">// 用渐变填充文本路径</span>
    pDC-&gt;<span class="hljs-built_in">SelectClipPath</span>(RGN_COPY);
    pDC-&gt;<span class="hljs-built_in">GradientFill</span>(vert, <span class="hljs-number">2</span>, &amp;gRect, <span class="hljs-number">1</span>, GRADIENT_FILL_RECT_H);
    
    pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
}
</code></pre>
<h3 data-id="heading-74">六、位图操作与图像处理</h3>
<h4 data-id="heading-75">6.1 位图加载与显示优化</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CBitmapManager</span>
{
<span class="hljs-keyword">private</span>:
    CMap&lt;UINT, UINT, CBitmap*, CBitmap*&gt; m_mapBitmaps;
    CSize m_sizeDisplay; <span class="hljs-comment">// 显示尺寸缓存</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CBitmapManager</span>() : <span class="hljs-built_in">m_sizeDisplay</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) {}
    
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">CBitmapManager</span>()
    {
        <span class="hljs-built_in">Cleanup</span>();
    }
    
    <span class="hljs-comment">// 从资源加载位图</span>
    <span class="hljs-function">CBitmap* <span class="hljs-title">LoadBitmapFromResource</span><span class="hljs-params">(UINT nIDResource, 
                                    CSize sizeTarget = CSize(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span>
    </span>{
        CBitmap* pBitmap = <span class="hljs-literal">NULL</span>;
        
        <span class="hljs-keyword">if</span> (m_mapBitmaps.<span class="hljs-built_in">Lookup</span>(nIDResource, pBitmap))
            <span class="hljs-keyword">return</span> pBitmap;
        
        <span class="hljs-comment">// 加载原始位图</span>
        CBitmap bmpOriginal;
        <span class="hljs-keyword">if</span> (!bmpOriginal.<span class="hljs-built_in">LoadBitmap</span>(nIDResource))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
        
        <span class="hljs-comment">// 获取原始尺寸</span>
        BITMAP bmInfo;
        bmpOriginal.<span class="hljs-built_in">GetBitmap</span>(&amp;bmInfo);
        
        <span class="hljs-function">CSize <span class="hljs-title">sizeSource</span><span class="hljs-params">(bmInfo.bmWidth, bmInfo.bmHeight)</span></span>;
        
        <span class="hljs-comment">// 如果需要缩放</span>
        <span class="hljs-keyword">if</span> (sizeTarget.cx &gt; <span class="hljs-number">0</span> &amp;&amp; sizeTarget.cy &gt; <span class="hljs-number">0</span> &amp;&amp; 
            (sizeTarget != sizeSource))
        {
            pBitmap = <span class="hljs-built_in">ScaleBitmap</span>(&amp;bmpOriginal, sizeSource, sizeTarget);
        }
        <span class="hljs-keyword">else</span>
        {
            pBitmap = <span class="hljs-keyword">new</span> CBitmap;
            pBitmap-&gt;<span class="hljs-built_in">Attach</span>(bmpOriginal.<span class="hljs-built_in">Detach</span>());
        }
        
        m_mapBitmaps.<span class="hljs-built_in">SetAt</span>(nIDResource, pBitmap);
        <span class="hljs-keyword">return</span> pBitmap;
    }
    
    <span class="hljs-comment">// 位图缩放函数</span>
    <span class="hljs-function">CBitmap* <span class="hljs-title">ScaleBitmap</span><span class="hljs-params">(CBitmap* pSrcBitmap, CSize sizeSrc, CSize sizeDst)</span>
    </span>{
        <span class="hljs-comment">// 创建源DC和目标DC</span>
        <span class="hljs-function">CWindowDC <span class="hljs-title">dcScreen</span><span class="hljs-params">(<span class="hljs-literal">NULL</span>)</span></span>;
        CDC dcSrc, dcDst;
        
        dcSrc.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
        dcDst.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
        
        <span class="hljs-comment">// 创建目标位图</span>
        CBitmap* pDstBitmap = <span class="hljs-keyword">new</span> CBitmap;
        pDstBitmap-&gt;<span class="hljs-built_in">CreateCompatibleBitmap</span>(&amp;dcScreen, 
                                          sizeDst.cx, sizeDst.cy);
        
        <span class="hljs-comment">// 选入位图</span>
        CBitmap* pOldSrcBitmap = dcSrc.<span class="hljs-built_in">SelectObject</span>(pSrcBitmap);
        CBitmap* pOldDstBitmap = dcDst.<span class="hljs-built_in">SelectObject</span>(pDstBitmap);
        
        <span class="hljs-comment">// 设置拉伸模式</span>
        dcDst.<span class="hljs-built_in">SetStretchBltMode</span>(HALFTONE);
        dcDst.<span class="hljs-built_in">SetBrushOrg</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        
        <span class="hljs-comment">// 执行缩放</span>
        dcDst.<span class="hljs-built_in">StretchBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sizeDst.cx, sizeDst.cy,
                        &amp;dcSrc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sizeSrc.cx, sizeSrc.cy,
                        SRCCOPY);
        
        <span class="hljs-comment">// 恢复并清理</span>
        dcSrc.<span class="hljs-built_in">SelectObject</span>(pOldSrcBitmap);
        dcDst.<span class="hljs-built_in">SelectObject</span>(pOldDstBitmap);
        
        <span class="hljs-keyword">return</span> pDstBitmap;
    }
    
    <span class="hljs-comment">// 透明位图绘制</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DrawTransparentBitmap</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap, 
                               CPoint ptDest, COLORREF crTransparent)</span>
    </span>{
        <span class="hljs-comment">// 创建内存DC</span>
        CDC dcMem, dcMask;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        dcMask.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        
        <span class="hljs-comment">// 获取位图尺寸</span>
        BITMAP bm;
        pBitmap-&gt;<span class="hljs-built_in">GetBitmap</span>(&amp;bm);
        
        <span class="hljs-comment">// 创建掩码位图</span>
        CBitmap bmpMask;
        bmpMask.<span class="hljs-built_in">CreateBitmap</span>(bm.bmWidth, bm.bmHeight, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);
        
        <span class="hljs-comment">// 选入位图</span>
        CBitmap* pOldMemBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        CBitmap* pOldMaskBitmap = dcMask.<span class="hljs-built_in">SelectObject</span>(&amp;bmpMask);
        
        <span class="hljs-comment">// 设置透明色</span>
        COLORREF crOldBk = dcMem.<span class="hljs-built_in">SetBkColor</span>(crTransparent);
        
        <span class="hljs-comment">// 创建掩码（透明区域为1，非透明区域为0）</span>
        dcMask.<span class="hljs-built_in">BitBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bm.bmWidth, bm.bmHeight, 
                     &amp;dcMem, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCCOPY);
        
        <span class="hljs-comment">// 在目标DC上使用掩码</span>
        pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, bm.bmWidth, bm.bmHeight,
                   &amp;dcMask, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCAND);
        
        <span class="hljs-comment">// 设置背景色并绘制</span>
        dcMem.<span class="hljs-built_in">SetBkColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
        dcMem.<span class="hljs-built_in">SetTextColor</span>(<span class="hljs-built_in">RGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>));
        dcMem.<span class="hljs-built_in">BitBlt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bm.bmWidth, bm.bmHeight,
                    &amp;dcMask, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCAND);
        
        <span class="hljs-comment">// 合并结果</span>
        pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, bm.bmWidth, bm.bmHeight,
                   &amp;dcMem, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCPAINT);
        
        <span class="hljs-comment">// 恢复</span>
        dcMem.<span class="hljs-built_in">SetBkColor</span>(crOldBk);
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldMemBitmap);
        dcMask.<span class="hljs-built_in">SelectObject</span>(pOldMaskBitmap);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cleanup</span><span class="hljs-params">()</span>
    </span>{
        POSITION pos = m_mapBitmaps.<span class="hljs-built_in">GetStartPosition</span>();
        UINT nID;
        CBitmap* pBitmap;
        <span class="hljs-keyword">while</span> (pos != <span class="hljs-literal">NULL</span>)
        {
            m_mapBitmaps.<span class="hljs-built_in">GetNextAssoc</span>(pos, nID, pBitmap);
            <span class="hljs-keyword">delete</span> pBitmap;
        }
        m_mapBitmaps.<span class="hljs-built_in">RemoveAll</span>();
    }
};
</code></pre>
<h4 data-id="heading-76">6.2 图像特效处理</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 简单的图像处理过滤器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CImageFilter</span>
{
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 灰度化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">ConvertToGrayScale</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap, 
                                   <span class="hljs-type">const</span> CRect&amp; rect)</span>
    </span>{
        <span class="hljs-comment">// 获取位图信息</span>
        BITMAP bm;
        pBitmap-&gt;<span class="hljs-built_in">GetBitmap</span>(&amp;bm);
        
        <span class="hljs-comment">// 创建内存DC</span>
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-comment">// 逐像素处理</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                <span class="hljs-comment">// 计算灰度值</span>
                BYTE r = <span class="hljs-built_in">GetRValue</span>(cr);
                BYTE g = <span class="hljs-built_in">GetGValue</span>(cr);
                BYTE b = <span class="hljs-built_in">GetBValue</span>(cr);
                BYTE gray = (BYTE)(<span class="hljs-number">0.299</span> * r + <span class="hljs-number">0.587</span> * g + <span class="hljs-number">0.114</span> * b);
                
                <span class="hljs-comment">// 设置灰度像素</span>
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(gray, gray, gray));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
    <span class="hljs-comment">// 亮度调整</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">AdjustBrightness</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap,
                                 <span class="hljs-type">const</span> CRect&amp; rect, <span class="hljs-type">int</span> nDelta)</span>
    </span>{
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                BYTE r = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetRValue</span>(cr) + nDelta);
                BYTE g = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetGValue</span>(cr) + nDelta);
                BYTE b = <span class="hljs-built_in">Clamp</span>(<span class="hljs-built_in">GetBValue</span>(cr) + nDelta);
                
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(r, g, b));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
    <span class="hljs-comment">// 对比度调整</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">AdjustContrast</span><span class="hljs-params">(CDC* pDC, CBitmap* pBitmap,
                               <span class="hljs-type">const</span> CRect&amp; rect, <span class="hljs-type">double</span> dContrast)</span>
    </span>{
        CDC dcMem;
        dcMem.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
        CBitmap* pOldBitmap = dcMem.<span class="hljs-built_in">SelectObject</span>(pBitmap);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = rect.top; y &lt; rect.bottom; y++)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = rect.left; x &lt; rect.right; x++)
            {
                COLORREF cr = dcMem.<span class="hljs-built_in">GetPixel</span>(x, y);
                
                BYTE r = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetRValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                BYTE g = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetGValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                BYTE b = <span class="hljs-built_in">Clamp</span>((<span class="hljs-type">int</span>)((<span class="hljs-built_in">GetBValue</span>(cr) - <span class="hljs-number">128</span>) * dContrast + <span class="hljs-number">128</span>));
                
                dcMem.<span class="hljs-built_in">SetPixel</span>(x, y, <span class="hljs-built_in">RGB</span>(r, g, b));
            }
        }
        
        dcMem.<span class="hljs-built_in">SelectObject</span>(pOldBitmap);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> BYTE <span class="hljs-title">Clamp</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span>
    </span>{
        <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">255</span>;
        <span class="hljs-keyword">return</span> (BYTE)value;
    }
};
</code></pre>
<h3 data-id="heading-77">七、打印与打印预览</h3>
<h4 data-id="heading-78">7.1 打印架构的实现</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 支持打印的视图类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CPrintableView</span> : <span class="hljs-keyword">public</span> CView
{
<span class="hljs-keyword">protected</span>:
    <span class="hljs-comment">// 打印相关成员</span>
    CPrintInfo m_printInfo;
    <span class="hljs-type">int</span> m_nPageWidth;
    <span class="hljs-type">int</span> m_nPageHeight;
    <span class="hljs-type">int</span> m_nCurPage;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnPreparePrinting</span><span class="hljs-params">(CPrintInfo* pInfo)</span>
    </span>{
        <span class="hljs-comment">// 设置打印对话框默认值</span>
        pInfo-&gt;<span class="hljs-built_in">SetMaxPage</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 假设最多10页</span>
        pInfo-&gt;<span class="hljs-built_in">SetMinPage</span>(<span class="hljs-number">1</span>);
        
        <span class="hljs-comment">// 调用DoPreparePrinting显示打印对话框</span>
        <span class="hljs-built_in">DoPreparePrinting</span>(pInfo);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnBeginPrinting</span><span class="hljs-params">(CDC* pDC, CPrintInfo* pInfo)</span>
    </span>{
        <span class="hljs-comment">// 获取打印机DC能力</span>
        m_nPageWidth = pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(HORZRES);
        m_nPageHeight = pDC-&gt;<span class="hljs-built_in">GetDeviceCaps</span>(VERTRES);
        
        <span class="hljs-comment">// 计算总页数</span>
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        <span class="hljs-type">int</span> nTotalLines = pDoc-&gt;<span class="hljs-built_in">GetLineCount</span>();
        <span class="hljs-type">int</span> nLinesPerPage = m_nPageHeight / <span class="hljs-number">20</span>; <span class="hljs-comment">// 假设每行20像素</span>
        
        pInfo-&gt;<span class="hljs-built_in">SetMaxPage</span>((nTotalLines + nLinesPerPage - <span class="hljs-number">1</span>) / nLinesPerPage);
        
        <span class="hljs-comment">// 创建打印字体</span>
        LOGFONT lfPrint = {<span class="hljs-number">0</span>};
        lfPrint.lfHeight = <span class="hljs-number">-15</span>; <span class="hljs-comment">// 打印字体稍小</span>
        lfPrint.lfWeight = FW_NORMAL;
        <span class="hljs-built_in">lstrcpy</span>(lfPrint.lfFaceName, _T(<span class="hljs-string">"宋体"</span>));
        m_fontPrint.<span class="hljs-built_in">CreateFontIndirect</span>(&amp;lfPrint);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnPrint</span><span class="hljs-params">(CDC* pDC, CPrintInfo* pInfo)</span>
    </span>{
        m_nCurPage = pInfo-&gt;m_nCurPage;
        
        <span class="hljs-comment">// 设置映射模式</span>
        pDC-&gt;<span class="hljs-built_in">SetMapMode</span>(MM_TEXT);
        
        <span class="hljs-comment">// 设置字体</span>
        CFont* pOldFont = pDC-&gt;<span class="hljs-built_in">SelectObject</span>(&amp;m_fontPrint);
        
        <span class="hljs-comment">// 打印页眉</span>
        <span class="hljs-built_in">PrintHeader</span>(pDC);
        
        <span class="hljs-comment">// 打印内容</span>
        <span class="hljs-built_in">PrintPageContent</span>(pDC, pInfo-&gt;m_nCurPage);
        
        <span class="hljs-comment">// 打印页脚</span>
        <span class="hljs-built_in">PrintFooter</span>(pDC);
        
        pDC-&gt;<span class="hljs-built_in">SelectObject</span>(pOldFont);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnEndPrinting</span><span class="hljs-params">(CDC* <span class="hljs-comment">/*pDC*/</span>, CPrintInfo* <span class="hljs-comment">/*pInfo*/</span>)</span>
    </span>{
        <span class="hljs-comment">// 清理打印资源</span>
        m_fontPrint.<span class="hljs-built_in">DeleteObject</span>();
    }
    
<span class="hljs-keyword">protected</span>:
    CFont m_fontPrint;
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintHeader</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CString strHeader;
        strHeader.<span class="hljs-built_in">Format</span>(_T(<span class="hljs-string">"第 %d 页"</span>), m_nCurPage);
        
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, <span class="hljs-number">50</span>, strHeader);
        
        <span class="hljs-comment">// 绘制页眉线</span>
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">80</span>);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(m_nPageWidth - <span class="hljs-number">50</span>, <span class="hljs-number">80</span>);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintPageContent</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">int</span> nPage)</span>
    </span>{
        CMyDocument* pDoc = <span class="hljs-built_in">GetDocument</span>();
        
        <span class="hljs-comment">// 计算本页显示的行范围</span>
        <span class="hljs-type">int</span> nLinesPerPage = (m_nPageHeight - <span class="hljs-number">150</span>) / <span class="hljs-number">20</span>; <span class="hljs-comment">// 考虑页眉页脚</span>
        <span class="hljs-type">int</span> nStartLine = (nPage - <span class="hljs-number">1</span>) * nLinesPerPage;
        <span class="hljs-type">int</span> nEndLine = <span class="hljs-built_in">min</span>(nStartLine + nLinesPerPage, 
                          pDoc-&gt;<span class="hljs-built_in">GetLineCount</span>());
        
        <span class="hljs-comment">// 逐行打印</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = nStartLine; i &lt; nEndLine; i++)
        {
            <span class="hljs-type">int</span> y = <span class="hljs-number">100</span> + (i - nStartLine) * <span class="hljs-number">20</span>;
            pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, y, pDoc-&gt;<span class="hljs-built_in">GetLine</span>(i));
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PrintFooter</span><span class="hljs-params">(CDC* pDC)</span>
    </span>{
        CString strFooter = CTime::<span class="hljs-built_in">GetCurrentTime</span>().<span class="hljs-built_in">Format</span>(_T(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>));
        
        <span class="hljs-comment">// 绘制页脚线</span>
        pDC-&gt;<span class="hljs-built_in">MoveTo</span>(<span class="hljs-number">50</span>, m_nPageHeight - <span class="hljs-number">70</span>);
        pDC-&gt;<span class="hljs-built_in">LineTo</span>(m_nPageWidth - <span class="hljs-number">50</span>, m_nPageHeight - <span class="hljs-number">70</span>);
        
        <span class="hljs-comment">// 打印页脚文本</span>
        pDC-&gt;<span class="hljs-built_in">TextOut</span>(<span class="hljs-number">100</span>, m_nPageHeight - <span class="hljs-number">50</span>, strFooter);
    }
};
</code></pre>
<h3 data-id="heading-79">八、性能优化与最佳实践</h3>
<h4 data-id="heading-80">8.1 GDI资源泄漏检测</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _DEBUG</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CGdiLeakDetector</span>
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> m_nGdiObjectsStart;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CGdiLeakDetector</span>()
    {
        <span class="hljs-comment">// 记录初始GDI对象数量</span>
        m_nGdiObjectsStart = <span class="hljs-built_in">GetGuiResources</span>(<span class="hljs-built_in">GetCurrentProcess</span>(), 
                                            GR_GDIOBJECTS);
    }
    
    ~<span class="hljs-built_in">CGdiLeakDetector</span>()
    {
        <span class="hljs-comment">// 检查GDI对象泄漏</span>
        <span class="hljs-type">int</span> nGdiObjectsEnd = <span class="hljs-built_in">GetGuiResources</span>(<span class="hljs-built_in">GetCurrentProcess</span>(), 
                                            GR_GDIOBJECTS);
        
        <span class="hljs-keyword">if</span> (nGdiObjectsEnd &gt; m_nGdiObjectsStart)
        {
            <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"警告：检测到可能的GDI对象泄漏。\n"</span>));
            <span class="hljs-built_in">TRACE</span>(_T(<span class="hljs-string">"初始: %d, 结束: %d, 泄漏: %d\n"</span>), 
                  m_nGdiObjectsStart, nGdiObjectsEnd,
                  nGdiObjectsEnd - m_nGdiObjectsStart);
            
            <span class="hljs-comment">// 在调试时触发断点</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IsDebuggerPresent</span>())
            {
                <span class="hljs-built_in">DebugBreak</span>();
            }
        }
    }
};

<span class="hljs-comment">// 在应用程序类中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CMyApp</span> : <span class="hljs-keyword">public</span> CWinApp
{
<span class="hljs-keyword">private</span>:
    CGdiLeakDetector m_gdiDetector;
    <span class="hljs-comment">// ...</span>
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-81">8.2 绘图缓存与增量更新</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CDrawingCache</span>
{
<span class="hljs-keyword">private</span>:
    CBitmap m_bmpCache;        <span class="hljs-comment">// 缓存位图</span>
    CRect m_rectCache;         <span class="hljs-comment">// 缓存区域</span>
    BOOL m_bCacheValid;        <span class="hljs-comment">// 缓存有效性标志</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CDrawingCache</span>() : <span class="hljs-built_in">m_bCacheValid</span>(FALSE) {}
    
    <span class="hljs-comment">// 更新缓存</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UpdateCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span>
    </span>{
        <span class="hljs-keyword">if</span> (!m_bCacheValid || m_rectCache != rect)
        {
            <span class="hljs-comment">// 创建或重新创建缓存位图</span>
            <span class="hljs-keyword">if</span> (m_bmpCache.<span class="hljs-built_in">GetSafeHandle</span>() == <span class="hljs-literal">NULL</span> || 
                m_rectCache != rect)
            {
                m_bmpCache.<span class="hljs-built_in">DeleteObject</span>();
                m_bmpCache.<span class="hljs-built_in">CreateCompatibleBitmap</span>(pDC, 
                                                 rect.<span class="hljs-built_in">Width</span>(), 
                                                 rect.<span class="hljs-built_in">Height</span>());
                m_rectCache = rect;
            }
            
            <span class="hljs-comment">// 绘制到缓存</span>
            CDC dcCache;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            <span class="hljs-comment">// 绘制背景和内容到缓存</span>
            <span class="hljs-built_in">DrawToCache</span>(&amp;dcCache, rect);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
            m_bCacheValid = TRUE;
        }
    }
    
    <span class="hljs-comment">// 从缓存绘制到屏幕</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RenderFromCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CPoint&amp; ptDest)</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_bCacheValid)
        {
            CDC dcCache;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(pDC);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            pDC-&gt;<span class="hljs-built_in">BitBlt</span>(ptDest.x, ptDest.y, 
                       m_rectCache.<span class="hljs-built_in">Width</span>(), m_rectCache.<span class="hljs-built_in">Height</span>(),
                       &amp;dcCache, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, SRCCOPY);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
        }
    }
    
    <span class="hljs-comment">// 使缓存失效</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InvalidateCache</span><span class="hljs-params">()</span>
    </span>{
        m_bCacheValid = FALSE;
    }
    
    <span class="hljs-comment">// 部分缓存失效</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InvalidateCacheRect</span><span class="hljs-params">(<span class="hljs-type">const</span> CRect&amp; rectInvalid)</span>
    </span>{
        <span class="hljs-keyword">if</span> (m_bCacheValid &amp;&amp; m_rectCache.<span class="hljs-built_in">IntersectRect</span>(&amp;rectInvalid))
        {
            <span class="hljs-comment">// 只重新绘制受影响的部分</span>
            CDC dcCache;
            <span class="hljs-function">CClientDC <span class="hljs-title">dcScreen</span><span class="hljs-params">(<span class="hljs-literal">NULL</span>)</span></span>;
            dcCache.<span class="hljs-built_in">CreateCompatibleDC</span>(&amp;dcScreen);
            CBitmap* pOldBmp = dcCache.<span class="hljs-built_in">SelectObject</span>(&amp;m_bmpCache);
            
            <span class="hljs-comment">// 清除受影响区域</span>
            <span class="hljs-function">CBrush <span class="hljs-title">brushBg</span><span class="hljs-params">(RGB(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))</span></span>;
            dcCache.<span class="hljs-built_in">FillRect</span>(&amp;rectInvalid, &amp;brushBg);
            
            <span class="hljs-comment">// 重新绘制受影响区域</span>
            <span class="hljs-built_in">RedrawInvalidArea</span>(&amp;dcCache, rectInvalid);
            
            dcCache.<span class="hljs-built_in">SelectObject</span>(pOldBmp);
        }
    }
    
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawToCache</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">RedrawInvalidArea</span><span class="hljs-params">(CDC* pDC, <span class="hljs-type">const</span> CRect&amp; rect)</span> </span>= <span class="hljs-number">0</span>;
};
</code></pre>
<h3 data-id="heading-82">九、与现代图形API的对比</h3>
<p>虽然GDI已经逐渐被Direct2D、DirectWrite等现代图形API取代，但理解GDI的设计仍有价值：</p>
<ol>
<li><strong>设备抽象层</strong>：GDI的设备上下文概念影响了后续API的设计</li>
<li><strong>资源管理模型</strong>：GDI对象的创建/选择/删除模式为后来的资源管理提供了参考</li>
<li><strong>坐标系统</strong>：GDI的映射模式为图形变换奠定了基础</li>
</ol>
<p><strong>迁移策略</strong>：</p>
<ul>
<li>对于新项目，推荐使用Direct2D/DirectWrite或跨平台图形库</li>
<li>对于现有MFC项目，可逐步替换绘图代码，同时保留业务逻辑</li>
<li>GDI仍适用于简单的UI绘制和打印功能</li>
</ul>
<p>MFC的GDI编程代表了Windows图形编程的一个时代，虽然技术已经演进，但其设计思想和问题解决方案仍对理解计算机图形学基本原理有重要价值。掌握GDI不仅有助于维护遗留代码，更能深刻理解图形系统的工作机制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++链表环检测算法完全解析]]></title>    <link>https://juejin.cn/post/7581676787379650579</link>    <guid>https://juejin.cn/post/7581676787379650579</guid>    <pubDate>2025-12-09T10:16:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787379650579" data-draft-id="7581676787379634195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++链表环检测算法完全解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T10:16:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++链表环检测算法完全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T10:16:03.000Z" title="Tue Dec 09 2025 10:16:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题定义</h2>
<h3 data-id="heading-1">1.1 链表环问题</h3>
<p>链表环（Linked List Cycle）指链表中某个节点的 next 指针指向了链表中在它之前出现的节点，导致链表形成闭环结构。检测链表环是数据结构与算法中的经典问题，在内存管理、编译器优化、图算法等领域有广泛应用。</p>
<h3 data-id="heading-2">1.2 问题形式化</h3>
<p>给定一个单链表的头节点 <code>head</code>，要求：</p>
<ol>
<li>判断链表中是否存在环</li>
<li>如果存在环，找到环的入口节点</li>
<li>分析算法的时间和空间复杂度</li>
</ol>
<h2 data-id="heading-3">二、核心算法原理</h2>
<h3 data-id="heading-4">2.1 哈希表法（标记法）</h3>
<h4 data-id="heading-5">2.1.1 基本思想</h4>
<p>遍历链表中的每个节点，将访问过的节点存储在哈希集合中。如果当前节点已经在集合中，说明链表有环；如果遍历到链表末尾（nullptr），则无环。</p>
<h4 data-id="heading-6">2.1.2 算法步骤</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">1.</span> 初始化空哈希集合 visited
<span class="hljs-number">2.</span> 当前指针 <span class="hljs-keyword">current</span> 指向头节点 head
<span class="hljs-number">3.</span> while <span class="hljs-keyword">current</span> <span class="hljs-operator">!=</span> nullptr:
   a. 如果 <span class="hljs-keyword">current</span> 在 visited 中，返回 <span class="hljs-literal">true</span>（有环）
   b. 将 <span class="hljs-keyword">current</span> 加入 visited
   c. <span class="hljs-keyword">current</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">current</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>next
<span class="hljs-number">4.</span> 返回 <span class="hljs-literal">false</span>（无环）
</code></pre>
<h4 data-id="heading-7">2.1.3 复杂度分析</h4>
<ul>
<li><strong>时间复杂度</strong>：O(n)，每个节点最多访问一次</li>
<li><strong>空间复杂度</strong>：O(n)，最坏情况需要存储所有节点</li>
<li><strong>优点</strong>：实现简单，逻辑清晰</li>
<li><strong>缺点</strong>：需要额外空间，不适合内存受限场景</li>
</ul>
<h3 data-id="heading-8">2.2 快慢指针法（Floyd判圈算法）</h3>
<h4 data-id="heading-9">2.2.1 算法发明背景</h4>
<p>由计算机科学家 Robert W. Floyd 于1967年提出，最初用于检测有限状态机中的循环，后被广泛应用于链表环检测。</p>
<h4 data-id="heading-10">2.2.2 核心思想</h4>
<p>使用两个指针，一个快指针（每次移动两步），一个慢指针（每次移动一步）。如果链表中存在环，快指针最终会追上慢指针（相遇）；如果不存在环，快指针会先到达链表末尾。</p>
<h4 data-id="heading-11">2.2.3 算法正确性证明</h4>
<p><strong>定理</strong>：如果链表中存在环，快慢指针一定会相遇。</p>
<p><strong>证明</strong>：
设：</p>
<ul>
<li>环外部分长度为 L（从头节点到环入口）</li>
<li>环长度为 C</li>
<li>慢指针进入环时，快指针在环中的位置为 k（0 ≤ k &lt; C）</li>
</ul>
<p>在环中，快指针相对于慢指针的速度是 1 步/单位时间（快指针速度2，慢指针速度1，相对速度1）。由于环是循环的，快指针最多需要 C-1 时间就能追上慢指针。</p>
<p>因此，最坏情况下，从慢指针进入环开始计算，经过 C-1 次移动，快慢指针必然相遇。</p>
<h2 data-id="heading-12">三、算法详细实现</h2>
<h3 data-id="heading-13">3.1 基础结构定义</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ListNode</span> {
    <span class="hljs-type">int</span> val;
    ListNode* next;
    <span class="hljs-built_in">ListNode</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) {}
    <span class="hljs-built_in">ListNode</span>(<span class="hljs-type">int</span> x, ListNode* next) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">next</span>(next) {}
};
</code></pre>
<h3 data-id="heading-14">3.2 哈希表法实现</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_set&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasCycleHash</span><span class="hljs-params">(ListNode* head)</span> </span>{
        unordered_set&lt;ListNode*&gt; visited;
        
        <span class="hljs-keyword">while</span> (head != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-comment">// 使用count方法检查节点是否已访问</span>
            <span class="hljs-keyword">if</span> (visited.<span class="hljs-built_in">count</span>(head) &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// 发现环</span>
            }
            visited.<span class="hljs-built_in">insert</span>(head);  <span class="hljs-comment">// 标记节点已访问</span>
            head = head-&gt;next;     <span class="hljs-comment">// 移动到下一个节点</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 遍历完成，无环</span>
    }
};
</code></pre>
<p><strong>关键点说明</strong>：</p>
<ul>
<li><code>unordered_set::count(key)</code> 返回元素在集合中的出现次数（0或1）</li>
<li><code>unordered_set::insert(key)</code> 插入元素，如果已存在则不重复插入</li>
<li>哈希表的平均查找和插入时间复杂度为 O(1)</li>
</ul>
<h3 data-id="heading-15">3.3 快慢指针法实现</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasCycle</span><span class="hljs-params">(ListNode* head)</span> </span>{
        <span class="hljs-comment">// 边界情况处理</span>
        <span class="hljs-keyword">if</span> (head == <span class="hljs-literal">nullptr</span> || head-&gt;next == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        ListNode* slow = head;  <span class="hljs-comment">// 慢指针，每次移动一步</span>
        ListNode* fast = head;  <span class="hljs-comment">// 快指针，每次移动两步</span>
        
        <span class="hljs-comment">// 第一阶段：检测环是否存在</span>
        <span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">nullptr</span> &amp;&amp; fast-&gt;next != <span class="hljs-literal">nullptr</span>) {
            slow = slow-&gt;next;           <span class="hljs-comment">// 慢指针移动一步</span>
            fast = fast-&gt;next-&gt;next;     <span class="hljs-comment">// 快指针移动两步</span>
            
            <span class="hljs-keyword">if</span> (slow == fast) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// 快慢指针相遇，存在环</span>
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 快指针到达末尾，不存在环</span>
    }
};
</code></pre>
<h2 data-id="heading-16">四、环入口检测算法</h2>
<h3 data-id="heading-17">4.1 数学原理推导</h3>
<p>这是快慢指针法最精妙的部分。当快慢指针相遇后，如何找到环的入口？</p>
<p><strong>设</strong>：</p>
<ul>
<li>L1：链表头到环入口的距离</li>
<li>L2：环入口到快慢指针相遇点的距离</li>
<li>C：环的长度</li>
<li>n：快指针在相遇前绕环的圈数（n ≥ 1）</li>
</ul>
<p><strong>已知条件</strong>：</p>
<ol>
<li>快指针速度是慢指针的2倍</li>
<li>相遇时，慢指针走了：L1 + L2</li>
<li>快指针走了：L1 + L2 + nC</li>
</ol>
<p><strong>建立方程</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">2(L1 + L2) = L1 + L2 + <span class="hljs-attr">nC</span>
=&gt; L1 + <span class="hljs-attr">L2</span> = nC
=&gt; <span class="hljs-attr">L1</span> = nC - L2
</code></pre>
<p><strong>关键发现</strong>：</p>
<ul>
<li><code>L1 = (n-1)C + (C - L2)</code></li>
<li><code>C - L2</code> 是从相遇点继续走到环入口的距离</li>
<li>因此，从链表头走 L1 步 = 从相遇点走 (n-1)C + (C-L2) 步</li>
</ul>
<p><strong>结论</strong>：一个指针从链表头开始，另一个从相遇点开始，以相同速度前进，它们将在环入口相遇。</p>
<h3 data-id="heading-18">4.2 环入口检测实现</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">ListNode* <span class="hljs-title">detectCycle</span><span class="hljs-params">(ListNode* head)</span> </span>{
        <span class="hljs-keyword">if</span> (head == <span class="hljs-literal">nullptr</span> || head-&gt;next == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
        }
        
        ListNode* slow = head;
        ListNode* fast = head;
        
        <span class="hljs-comment">// 第一阶段：检测环</span>
        <span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">nullptr</span> &amp;&amp; fast-&gt;next != <span class="hljs-literal">nullptr</span>) {
            slow = slow-&gt;next;
            fast = fast-&gt;next-&gt;next;
            
            <span class="hljs-keyword">if</span> (slow == fast) {
                <span class="hljs-comment">// 第二阶段：找到环入口</span>
                ListNode* entry = head;  <span class="hljs-comment">// 新指针从链表头开始</span>
                
                <span class="hljs-keyword">while</span> (entry != slow) {  <span class="hljs-comment">// 两个指针同步前进</span>
                    entry = entry-&gt;next;
                    slow = slow-&gt;next;
                }
                
                <span class="hljs-keyword">return</span> entry;  <span class="hljs-comment">// 相遇点即为环入口</span>
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 无环</span>
    }
};
</code></pre>
<h2 data-id="heading-19">五、算法复杂度对比</h2>


























<table><thead><tr><th>算法</th><th>时间复杂度</th><th>空间复杂度</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>哈希表法</td><td>O(n)</td><td>O(n)</td><td>实现简单，逻辑清晰</td><td>需要额外空间</td></tr><tr><td>快慢指针法</td><td>O(n)</td><td>O(1)</td><td>空间最优，适合内存受限场景</td><td>实现稍复杂，需要数学理解</td></tr></tbody></table>
<p><strong>时间复杂度分析</strong>：</p>
<ul>
<li>哈希表法：每个节点访问一次，哈希操作O(1)，总O(n)</li>
<li>快慢指针法：快指针最多遍历链表两次，总O(n)</li>
</ul>
<p><strong>空间复杂度分析</strong>：</p>
<ul>
<li>哈希表法：最坏存储所有节点，O(n)</li>
<li>快慢指针法：只使用两个指针，O(1)</li>
</ul>
<h2 data-id="heading-20">六、边界情况与注意事项</h2>
<h3 data-id="heading-21">6.1 边界情况处理</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 边界情况测试</span>
vector&lt;ListNode*&gt; test_cases = {
    <span class="hljs-literal">nullptr</span>,                    <span class="hljs-comment">// 空链表</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">1</span>),           <span class="hljs-comment">// 单节点无环</span>
    <span class="hljs-built_in">makeSelfCycle</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">1</span>)), <span class="hljs-comment">// 单节点自环</span>
    <span class="hljs-built_in">makeCycle</span>({<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>}, <span class="hljs-number">0</span>),     <span class="hljs-comment">// 环在头节点</span>
    <span class="hljs-built_in">makeCycle</span>({<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>}, <span class="hljs-number">2</span>), <span class="hljs-comment">// 环在中间</span>
    <span class="hljs-built_in">makeCycle</span>({<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>}, <span class="hljs-number">4</span>)  <span class="hljs-comment">// 环在尾节点</span>
};
</code></pre>
<h3 data-id="heading-22">6.2 内存管理注意事项</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 创建测试链表时需要管理内存</span>
<span class="hljs-function">ListNode* <span class="hljs-title">createTestListWithCycle</span><span class="hljs-params">(<span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;&amp; values, <span class="hljs-type">int</span> cyclePos)</span> </span>{
    <span class="hljs-keyword">if</span> (values.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    vector&lt;ListNode*&gt; nodes;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> val : values) {
        nodes.<span class="hljs-built_in">push_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(val));
    }
    
    <span class="hljs-comment">// 连接节点</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; nodes.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>; i++) {
        nodes[i]-&gt;next = nodes[i + <span class="hljs-number">1</span>];
    }
    
    <span class="hljs-comment">// 创建环</span>
    <span class="hljs-keyword">if</span> (cyclePos &gt;= <span class="hljs-number">0</span> &amp;&amp; cyclePos &lt; values.<span class="hljs-built_in">size</span>()) {
        nodes.<span class="hljs-built_in">back</span>()-&gt;next = nodes[cyclePos];
    }
    
    <span class="hljs-keyword">return</span> nodes[<span class="hljs-number">0</span>];
}

<span class="hljs-comment">// 测试完成后释放内存</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteList</span><span class="hljs-params">(ListNode* head, unordered_set&lt;ListNode*&gt;&amp; visited)</span> </span>{
    <span class="hljs-comment">// 有环链表需要特殊处理，避免无限循环</span>
}
</code></pre>
<h2 data-id="heading-23">七、实际应用场景</h2>
<h3 data-id="heading-24">7.1 内存泄漏检测</h3>
<p>在垃圾回收和内存管理系统中，检测循环引用可以避免内存泄漏：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryManager</span> {
<span class="hljs-keyword">private</span>:
    unordered_set&lt;Object*&gt; visited;
    
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasCycleReference</span><span class="hljs-params">(Object* obj)</span> </span>{
        <span class="hljs-comment">// 使用类似链表判环的算法检测对象引用环</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">detectCycleInReferences</span>(obj);
    }
};
</code></pre>
<h3 data-id="heading-25">7.2 并发死锁检测</h3>
<p>在操作系统中，检测资源分配图中的环可以预防死锁：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadlockDetector</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">detectDeadlock</span><span class="hljs-params">(vector&lt;Process&gt;&amp; processes)</span> </span>{
        <span class="hljs-comment">// 将进程等待关系建模为图，检测环</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">hasCycleInWaitForGraph</span>(processes);
    }
};
</code></pre>
<h3 data-id="heading-26">7.3 编译器优化</h3>
<p>在编译器的数据流分析和控制流分析中，检测循环结构：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompilerOptimizer</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">analyzeControlFlow</span><span class="hljs-params">(CFG* cfg)</span> </span>{
        <span class="hljs-comment">// 检测控制流图中的环（循环结构）</span>
        <span class="hljs-built_in">detectLoopsInCFG</span>(cfg);
    }
};
</code></pre>
<h2 data-id="heading-27">八、扩展与变体</h2>
<h3 data-id="heading-28">8.1 求环的长度</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">cycleLength</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">hasCycle</span>(head)) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    
    ListNode* slow = head;
    ListNode* fast = head;
    
    <span class="hljs-comment">// 第一阶段：找到相遇点</span>
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast-&gt;next) {
        slow = slow-&gt;next;
        fast = fast-&gt;next-&gt;next;
        <span class="hljs-keyword">if</span> (slow == fast) <span class="hljs-keyword">break</span>;
    }
    
    <span class="hljs-comment">// 第二阶段：计算环长</span>
    <span class="hljs-type">int</span> length = <span class="hljs-number">1</span>;
    fast = fast-&gt;next;
    <span class="hljs-keyword">while</span> (fast != slow) {
        fast = fast-&gt;next;
        length++;
    }
    
    <span class="hljs-keyword">return</span> length;
}
</code></pre>
<h3 data-id="heading-29">8.2 判断环的位置类型</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">CycleType</span> {
    NO_CYCLE,
    SELF_CYCLE,      <span class="hljs-comment">// 自环</span>
    SMALL_CYCLE,     <span class="hljs-comment">// 小环（长度≤3）</span>
    LARGE_CYCLE      <span class="hljs-comment">// 大环</span>
};

<span class="hljs-function">CycleType <span class="hljs-title">classifyCycle</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">hasCycle</span>(head)) <span class="hljs-keyword">return</span> NO_CYCLE;
    
    ListNode* entry = <span class="hljs-built_in">detectCycle</span>(head);
    
    <span class="hljs-keyword">if</span> (entry == entry-&gt;next) <span class="hljs-keyword">return</span> SELF_CYCLE;
    
    <span class="hljs-type">int</span> len = <span class="hljs-built_in">cycleLength</span>(head);
    <span class="hljs-keyword">if</span> (len &lt;= <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> SMALL_CYCLE;
    
    <span class="hljs-keyword">return</span> LARGE_CYCLE;
}
</code></pre>
<h2 data-id="heading-30">九、总结与最佳实践</h2>
<h3 data-id="heading-31">9.1 算法选择建议</h3>
<ol>
<li><strong>面试场景</strong>：优先实现快慢指针法，展现算法理解深度</li>
<li><strong>生产环境</strong>：根据内存约束选择，内存充足可用哈希表法（更稳定）</li>
<li><strong>竞赛场景</strong>：快慢指针法（空间效率高）</li>
</ol>
<h3 data-id="heading-32">9.2 编码注意事项</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 良好的编码习惯</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasCycleBestPractice</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-comment">// 1. 优先处理边界情况</span>
    <span class="hljs-keyword">if</span> (head == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 2. 变量命名清晰</span>
    ListNode* slowPointer = head;
    ListNode* fastPointer = head;
    
    <span class="hljs-comment">// 3. 循环条件严谨</span>
    <span class="hljs-keyword">while</span> (fastPointer != <span class="hljs-literal">nullptr</span> &amp;&amp; fastPointer-&gt;next != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-comment">// 4. 移动指针后再比较</span>
        slowPointer = slowPointer-&gt;next;
        fastPointer = fastPointer-&gt;next-&gt;next;
        
        <span class="hljs-comment">// 5. 使用明确的比较</span>
        <span class="hljs-keyword">if</span> (slowPointer == fastPointer) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    
    <span class="hljs-comment">// 6. 明确返回无环</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-33">9.3 学习要点</h3>
<ol>
<li><strong>理解数学原理</strong>：快慢指针法的核心是数学推导</li>
<li><strong>掌握边界处理</strong>：空链表、单节点、自环等特殊情况</li>
<li><strong>分析复杂度</strong>：理解时间-空间权衡</li>
<li><strong>联系实际应用</strong>：了解算法在真实系统中的用途</li>
</ol>
<p>链表环检测算法不仅是面试高频题，更是理解指针操作、算法设计和数学思维的绝佳案例。通过深入理解这个问题的多种解法，可以提升解决复杂问题的能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从误判到精准：游戏社区 AI 审核的工程化实践]]></title>    <link>https://juejin.cn/post/7580606750291951667</link>    <guid>https://juejin.cn/post/7580606750291951667</guid>    <pubDate>2025-12-08T01:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580606750291951667" data-draft-id="7580570363602206772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从误判到精准：游戏社区 AI 审核的工程化实践"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-08T01:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亚马逊云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从误判到精准：游戏社区 AI 审核的工程化实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亚马逊云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T01:58:51.000Z" title="Mon Dec 08 2025 01:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs3.cn-north-1.amazonaws.com.cn%2Fawschinablog%2Fblogbanner-newnew.png" target="_blank" title="https://s3.cn-north-1.amazonaws.com.cn/awschinablog/blogbanner-newnew.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c4a1d8bb6d54df78712ebd5c0284592~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=wF7aKmJvqYKvL53finN92yp%2FX1g%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-0">引言</h2>
<p>游戏社区作为典型的 UGC（用户生成内容）场景，用户遍布全球，涉及中、英、日、韩、俄、西班牙语、阿拉伯语、法语等多种语言。讨论氛围活跃，但其中不可避免会夹杂 辱骂、仇恨、色情、暴力、涉政 等违规言论。</p>
<p>平台需要在不伤害社区氛围的前提下，做到 <strong>及时、准确的内容审核</strong>。但传统规则引擎容易出现“误杀”或“漏判”，直接依赖大语言模型审核又存在 <strong>准确率不高、分类不稳定</strong> 的问题。</p>
<p>我们遇到的客户需求还有一些额外挑战：</p>
<ul>
<li>审核对象是<strong>长文本</strong>（动辄上千字符）；</li>
<li>无法通过向量检索或 RAG 切片，因为长文本拆分后上下文丢失，相关度很差；</li>
<li>模型需要一次性给出 <strong>判定结果（Pass/Reject</strong> <strong>）</strong> ，并在 Reject 时指定 <strong>10</strong> <strong>种违规分类之一</strong>。</li>
</ul>
<p>在这样的背景下，我们为一家游戏公司落地了一套 <strong>提示词工程 + ReAct</strong> <strong>框架 +</strong> <strong>工程化架构</strong> 的 AI 审核方案。最终整体准确率提升到了 <strong>81%</strong> 。需要说明的是，对比基准是客户的人工审核数据，而人工标注过程存在“多人多日、缺乏复核”的情况，口径并不完全统一。因此，我们只能说模型的 81% 一致性<strong>大体上达到了人工审核的水平</strong>，具体效果还需结合更严格的标注体系进一步验证。</p>
<blockquote>
<p>📢限时插播：无需管理基础设施，利用亚马逊技术与生态，快速集成与部署生成式AI模型能力。</p>
<p>✨ 精心设计，旨在引导您深入探索Amazon Bedrock的模型选择与调用、模型自动化评估以及安全围栏(Guardrail)等重要功能。</p>
<p>⏩快快点击进入《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejinhead_0606%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejinhead_0606" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejinhead_0606&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejinhead_0606" ref="nofollow noopener noreferrer">多模一站通 —— Amazon Bedrock 上的基础模型初体验</a>》实验构建无限, 探索启程！</p>
</blockquote>
<h2 data-id="heading-1">整体方案架构</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2854ab2d20944099a84c17bcdd3fd2c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=e8%2BLZkluVgimOQGbAk1aDnH4d30%3D" alt="299042ed769fca693f09795d0e851c31.png" loading="lazy"/></p>
<h2 data-id="heading-2">工程化落地能力</h2>
<p>在文本审核项目中，提示词优化只是其中一步。真正支撑业务落地的，是一整套 <strong>可观测、可回滚、可扩展</strong> 的工程架构：</p>
<ul>
<li><strong>蓝绿部署</strong>：通过 Amazon Bedrock 的多版本部署机制，提示词优化和模型更新可以安全上线，支持灰度/回滚。</li>
<li><strong>日志与判例库</strong>：所有审核请求和结果写入 DynamoDB / OpenSearch，用于后续的回溯分析与提示词再训练。</li>
<li><strong>配置与流控</strong>：Amazon AppConfig + 控制 Lambda，保证在高并发/大流量场景下系统稳定。</li>
<li><strong>端到端可监控</strong>：从请求入口到最终存储都有日志链路，方便快速排查问题。</li>
</ul>
<h2 data-id="heading-3">提示词冷启动阶段：提示词从 0 到 1</h2>
<p>在没有任何“黄金提示词”的前提下，拿到可用的提示词方法有很多种，甚至可以直接让AI生成一个。</p>
<p>但我们这里采用冷启动的办法，先让模型把客户给的几千条样本过一遍。每跑一条，就拿它的结果和人工标注比对，把提示词里有问题的地方修掉。这样循环一轮，等于帮我们凑出了一个“能跑”的初始版本，后面再慢慢打磨。</p>
<p>我们的做法是：</p>
<ol>
<li>让大模型逐条读取客户提供的数千条人工审核样本（每条都包含文本、判定结果以及违规分类）。</li>
<li>在阅读过程中，模型会尝试基于已有样本生成提示词。</li>
<li>每读取一条样本，就对提示词做一次微调，逐步修正不合理的部分。</li>
<li>完成一轮全量样本后，就得到一个 <strong>初始提示词</strong>，作为进一步优化的基线。</li>
</ol>
<p>例如，最初我们生成的提示词大致如下：</p>
<pre><code class="hljs language-erlang" lang="erlang">You are a content moderation model.
## Task
Analyze the following user-generated text.
<span class="hljs-number">1</span>. Classify it as <span class="hljs-string">"Pass"</span> or <span class="hljs-string">"Reject"</span>.
<span class="hljs-number">2</span>. If <span class="hljs-string">"Reject"</span>, assign one <span class="hljs-keyword">of</span> these categories:
   - Hate Speech
   - Sexual Content
   - Violence
   - Political Sensitivity
   - Spam / Ads
   - Self-harm
   ...
## Output Format (JSON)
{<span class="hljs-string">"result"</span>: <span class="hljs-string">"Reject"</span>, <span class="hljs-string">"category"</span>: <span class="hljs-string">"Hate Speech"</span>}
</code></pre>
<p>在冷启动阶段，这个提示词的准确率并不算高，容易出现 <strong>灰色语境误判</strong>（例如把二次元梗误判成色情内容），或者 <strong>多语言覆盖不足</strong>（对阿拉伯语、西班牙语等的判定不稳定）。但它为后续优化奠定了基础。</p>
<h2 data-id="heading-4">ReAct 框架引入：让模型“先思考，再行动”</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F09%2F29%2Fcommunities-2.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/09/29/communities-2.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b41d7b09a65b43c58286207f71bad4e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=WLQZaU4vN9R877rQ5j7QzV4EIXg%3D" alt="" loading="lazy"/></a></p>
<p>冷启动阶段得到的提示词虽然能跑通流程，但在一些关键问题上仍然存在不足：</p>
<ul>
<li><strong>灰色语境</strong>：例如二次元梗、讽刺语气，容易被误判为违规。</li>
<li><strong>多语言一致性</strong>：某些语言（如阿拉伯语、西班牙语）分类不稳定。</li>
<li><strong>输出随机性</strong>：相同输入多次测试，结果可能不同。</li>
</ul>
<p>为了解决这些问题，我们在提示词中引入了 <strong>ReAct</strong> <strong>（Reason + Act</strong> <strong>）框架</strong>。</p>
<p><strong>ReAct</strong> <strong>的核心思想</strong>是让大模型先进行显式的“推理”步骤，再做最终的“行动”输出。这样可以减少随机性，并提高可解释性。</p>
<h3 data-id="heading-5">ReAct 框架在审核场景中的拆解</h3>
<ol>
<li>
<p><strong>Reasoning</strong> <strong>（思考）</strong> ：</p>
<ul>
<li>Step 1: 确定文本语言</li>
<li>Step 2: 提取潜在违规关键词或短语</li>
<li>Step 3: 将关键词与违规类别进行匹配</li>
<li>Step 4: 根据上下文和类别，决定 Pass / Reject</li>
</ul>
</li>
<li>
<p><strong>Action</strong> <strong>（行动）</strong> ：</p>
<ul>
<li>输出最终 JSON 结果（判定 + 类别）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">示例提示词片段</h3>
<p>下面是我们在 ReAct 框架下的一部分提示词（简化版）：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">You are a professional content moderation assistant.  
Follow the steps below before giving the final output:  

<span class="hljs-keyword">Step</span> <span class="hljs-number">1</span>: Identify the language <span class="hljs-keyword">of</span> the <span class="hljs-keyword">text</span>.  
<span class="hljs-keyword">Step</span> <span class="hljs-number">2</span>: Extract any potentially offensive <span class="hljs-built_in">or</span> sensitive words.  
<span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>: Match the extracted words <span class="hljs-keyword">to</span> one <span class="hljs-keyword">of</span> the violation categories.  
<span class="hljs-keyword">Step</span> <span class="hljs-number">4</span>: Decide whether the <span class="hljs-keyword">text</span> <span class="hljs-built_in">is</span> <span class="hljs-string">"Pass"</span> <span class="hljs-built_in">or</span> <span class="hljs-string">"Reject"</span>.  

<span class="hljs-keyword">Finally</span>, output ONLY <span class="hljs-keyword">in</span> the following JSON format:  
{<span class="hljs-string">"result"</span>: <span class="hljs-string">"Reject"</span>, <span class="hljs-string">"category"</span>: <span class="hljs-string">"Hate Speech"</span>}
</code></pre>
<p>这样设计后，准确率虽不高，容易把二次元梗当成色情，或对小语种判定不稳。但它给我们提供了一个起点。</p>
<h3 data-id="heading-7">ReAct 框架下的实现示例（Python 伪代码）</h3>
<p>在工程落地中，我们通过 Agent 框架调用大模型，来执行上述 ReAct 推理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> strands <span class="hljs-keyword">import</span> Agent, tool
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">moderation_tool</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""
    Classify the input text into Pass/Reject and category using ReAct framework.
    """</span>
    reasoning_prompt = <span class="hljs-string">f"""
    Step 1: Identify language.
    Step 2: Extract potentially offensive words or sensitive context.
    Step 3: Match with violation categories.
    Step 4: Decide Pass or Reject.
    Text: <span class="hljs-subst">{text}</span>
    """</span>
    <span class="hljs-comment"># 调用大模型</span>
    result = llm_call(reasoning_prompt)
    <span class="hljs-keyword">return</span> result
<span class="hljs-comment"># 示例调用</span>
<span class="hljs-built_in">print</span>(moderation_tool(<span class="hljs-string">"This game sucks, I hope the devs all die in a fire."</span>))
<span class="hljs-comment"># 输出示例: {"result": "Reject", "category": "Hate Speech"}</span>
</code></pre>
<p>在 ReAct 机制下，我们观察到模型的表现明显更加稳定：</p>
<ul>
<li>对多语言输入的分类一致性增强；</li>
<li>对灰色语境（如“玩梗”）的误判显著减少；</li>
<li>审核理由透明，可以复盘和解释。</li>
</ul>
<h2 data-id="heading-8">多轮循环优化：从 3 轮到 10+ 轮，我们如何选定 5 轮</h2>
<p>在引入 ReAct 之后，我们对“<strong>每轮：全量跑样本 →</strong> <strong>纠错 →</strong> <strong>修提示词</strong>”的闭环进行了系统化实验，对比不同轮数的收益与成本：</p>
<ul>
<li>
<p><strong>3</strong> <strong>轮：欠拟合</strong></p>
<ul>
<li>典型问题：仍然存在多语言一致性不足、灰色语境误判偏多。</li>
<li>现象：指标提升明显低于 5 轮，呈“上升未饱和”状态。</li>
</ul>
</li>
<li>
<p><strong>5</strong> <strong>轮：效果-</strong> <strong>成本最优点</strong></p>
<ul>
<li>进入<strong>收益递减区间</strong>的起点，准确率与稳定性基本收敛。</li>
<li>与 10 轮相比，<strong>增益不明显</strong>，但计算/时间成本显著更低。</li>
</ul>
</li>
<li>
<p><strong>10</strong> <strong>轮：与 5</strong> <strong>轮接近</strong></p>
<ul>
<li>指标接近 5 轮，<strong>差异在统计误差范围内</strong>。</li>
<li>成本约为 5 轮的 2 倍（推理费用、时间占用、并发管理）。</li>
</ul>
</li>
<li>
<p><strong>10</strong> <strong>轮以上：可能出现负面影响</strong></p>
<ul>
<li>过拟合于“特定审核员口径/特定样本簇”，提示词<strong>变窄</strong>。</li>
<li>对跨天、跨审核员、跨语种的泛化能力<strong>略有下降</strong>。</li>
</ul>
</li>
</ul>
<p><strong>结论</strong>：在成本—收益的综合考量下，我们选择 <strong>5</strong> <strong>轮</strong> 作为生产建议，并给出<strong>实践区间</strong> <strong>5–8</strong> <strong>轮</strong>（8 轮用于更严格的场景/关键上线前的稳健性校验）。</p>
<h3 data-id="heading-9">版本对比</h3>





















































<table><thead><tr><th/><th>版本</th><th>轮次</th><th>核心改动</th><th>效果观察</th><th>主要问题</th></tr></thead><tbody><tr><td>1</td><td>v1</td><td>1</td><td>冷启动提示词，直接分类</td><td>基线 72%</td><td>灰色语境误判、多语言不稳</td></tr><tr><td>2</td><td>v2</td><td>3</td><td>加语言识别、关键词提取</td><td>~77–79%</td><td>仍有欠拟合迹象</td></tr><tr><td>3</td><td>v3</td><td>5</td><td>ReAct 推理链条收敛、分类边界精炼</td><td>81%</td><td>标注噪声成为主限因素</td></tr><tr><td>4</td><td>v4</td><td>8</td><td>规则精修、输出一致性增强</td><td>~81%±</td><td>提升接近噪声天花板</td></tr><tr><td>5</td><td>v5</td><td>10+</td><td>更细粒度规则</td><td><strong>收益不增反降</strong></td><td>过拟合风险上升，提示词会过于具象化</td></tr></tbody></table>
<h2 data-id="heading-10">Temperature 调参经验</h2>
<p>在我们反复调提示词的过程中，发现 <strong>temperature</strong> <strong>参数</strong> 对结果影响较大。</p>
<ul>
<li>
<p><strong>在调试和实验阶段</strong><br/>
我们会把 temperature 开得比较高，大概在 <strong>8–1.0</strong>。这样模型会更“活跃”，能从不同角度去理解文本。比如：</p>
<ul>
<li>二次元梗、讽刺话语、跨语种甚至夹杂 emoji 的内容，高 temperature 下模型能给出更多解释；</li>
<li>这对我们来说很有帮助，可以暴露提示词里没考虑到的边角情况，方便我们快速改进。</li>
</ul>
</li>
<li>
<p><strong>在真正上线的时候</strong><br/>
我们把 temperature 拉到 <strong>0–0.1</strong>。</p>
<ul>
<li>这样模型输出会尽量固定，不会同一条内容前后给出不一样的结果；</li>
<li>对审核业务来说，<strong>稳定和可解释</strong>比“有创造力”要重要得多。</li>
</ul>
</li>
</ul>
<p>所以我们的做法是：<strong>调试阶段高</strong> <strong>temperature</strong> <strong>，生产环境低 temperature</strong>，既能探索问题，也能保证上线稳定。</p>
<h2 data-id="heading-11">实验结果（口径与噪声说明）</h2>
<ul>
<li><strong>整体准确率</strong>：<strong>81%</strong></li>
<li><strong>正向召回准确率（合规判定）</strong> ：<strong>76%</strong></li>
<li><strong>负向召回准确率（违规判定）</strong> ：<strong>90%</strong></li>
</ul>
<p><strong>评估口径与数据噪声：</strong></p>
<ul>
<li>基准为客户提供的<strong>人工审核数据</strong>；多人、分多日完成，<strong>未建立双盲复核</strong>，口径存在<strong>天然不一致</strong>。</li>
<li>因此 81% 的一致性，<strong>已经接近甚至可能超过</strong>多人人工的稳定水平。</li>
<li>在多语言与灰色语境（玩梗、反讽）上，<strong>ReAct</strong> <strong>提示词</strong>显著降低了随机误判，并提升了跨语言一致性。</li>
</ul>
<h3 data-id="heading-12">代表性案例（模拟真实数据）</h3>








































<table><thead><tr><th/><th>文本（节选）</th><th>人工标注</th><th>基线模型</th><th>ReAct 提示词</th></tr></thead><tbody><tr><td>1</td><td>“You are stupid, I hate you.”</td><td>仇恨言论</td><td>Pass ❌</td><td>Reject ✅（Hate Speech）</td></tr><tr><td>2</td><td>“This waifu is so hot omg 🔥”</td><td>合规（二次元语境）</td><td>Reject ❌</td><td>Pass ✅</td></tr><tr><td>3</td><td>“The devs are scammers, I hope they burn.”</td><td>仇恨言论</td><td>Reject ✅</td><td>Reject ✅（Hate Speech）</td></tr><tr><td>4</td><td>“Hello”</td><td/><td>Pass✅</td><td/></tr></tbody></table>
<h2 data-id="heading-13">工程实现要点</h2>
<h3 data-id="heading-14">核心代码</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_file_validation</span>(<span class="hljs-params">file_path, prompt_template, client, model_id, temperature, max_tokens, logger</span>):
    <span class="hljs-string">"""Process a single file for validation and return results"""</span>
    file_name = os.path.basename(file_path)
    
    logger.info(<span class="hljs-string">f"Validating file: <span class="hljs-subst">{file_name}</span>"</span>)
    
    <span class="hljs-keyword">try</span>:
        df = pd.read_excel(file_path, engine=<span class="hljs-string">'openpyxl'</span>)
        
        <span class="hljs-comment"># Processing Excel data</span>
        <span class="hljs-comment"># ...</span>
        
        results = []
        
        <span class="hljs-comment"># Counters for detailed metrics</span>
        metrics = {
            <span class="hljs-string">"total"</span>: <span class="hljs-built_in">len</span>(data),
            <span class="hljs-string">"pass_samples"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"reject_samples"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"pass_correct"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"reject_correct"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"category_metrics"</span>: defaultdict(<span class="hljs-keyword">lambda</span>: {<span class="hljs-string">"total"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"correct"</span>: <span class="hljs-number">0</span>})
        }
        
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> tqdm(data, desc=<span class="hljs-string">f"Processing <span class="hljs-subst">{file_name}</span>"</span>):
            <span class="hljs-comment"># ...</span>
            <span class="hljs-comment"># Format the prompt with the current text</span>
            prompt = prompt_template.<span class="hljs-built_in">format</span>(text=text)
            
            <span class="hljs-comment"># Get model response</span>
            response = invoke_claude(client, prompt, model_id, temperature, max_tokens, logger)
            
            <span class="hljs-comment"># Extract prediction (0 or 1) from response</span>
            <span class="hljs-keyword">if</span> response:
                <span class="hljs-comment"># Look for Pass/Reject indicators in the response</span>
                lower_response = response.lower()
                
                <span class="hljs-comment"># Check for explicit "Pass" or "Reject" in the response</span>

                <span class="hljs-comment"># Check for numeric indicators</span>
                
                <span class="hljs-comment"># Default to Reject if unclear</span>
                    
                is_correct = pred_label == true_label
                <span class="hljs-keyword">if</span> is_correct:
                    <span class="hljs-keyword">if</span> true_label == <span class="hljs-number">1</span>:
                        metrics[<span class="hljs-string">"pass_correct"</span>] += <span class="hljs-number">1</span>
                    <span class="hljs-keyword">else</span>:
                        metrics[<span class="hljs-string">"reject_correct"</span>] += <span class="hljs-number">1</span>
                        metrics[<span class="hljs-string">"category_metrics"</span>][category][<span class="hljs-string">"correct"</span>] += <span class="hljs-number">1</span>
                    
                results.append({
                    <span class="hljs-string">"text"</span>: text,
                    <span class="hljs-string">"true_label"</span>: true_label,
                    <span class="hljs-string">"pred_label"</span>: pred_label,
                    <span class="hljs-string">"is_correct"</span>: is_correct,
                    <span class="hljs-string">"response"</span>: response,
                    <span class="hljs-string">"category"</span>: category,
                    <span class="hljs-string">"source_file"</span>: file_name
                })
            
            <span class="hljs-comment"># Add a small delay to avoid rate limiting</span>
            time.sleep(<span class="hljs-number">0.5</span>)
        
        <span class="hljs-comment"># Calculate metrics</span>
        <span class="hljs-comment"># ...</span>
        
        logger.info(<span class="hljs-string">f"Completed <span class="hljs-subst">{file_name}</span>: Accuracy=<span class="hljs-subst">{metrics[<span class="hljs-string">'accuracy'</span>]:<span class="hljs-number">.4</span>f}</span>, "</span>
                   <span class="hljs-string">f"Pass=<span class="hljs-subst">{metrics[<span class="hljs-string">'pass_accuracy'</span>]:<span class="hljs-number">.4</span>f}</span>, Reject=<span class="hljs-subst">{metrics[<span class="hljs-string">'reject_accuracy'</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
        
        <span class="hljs-keyword">return</span> file_name, results, metrics
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"Error processing file <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> file_name, [], {<span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e)}
</code></pre>
<h3 data-id="heading-15">1) 日志与可追溯性</h3>
<ul>
<li>
<p><strong>目的</strong>：记录每个文件、每条样本的判定与指标，支撑问题回溯。</p>
</li>
<li>
<p><strong>实践要点</strong>：</p>
<ul>
<li>文件 + 控制台双通道日志；</li>
<li>关键信息结构化输出（accuracy、pass/reject、category 指标）；</li>
<li>每轮/每版本生成独立 log 文件，便于对比。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-16">2) 数据装载与多文件批处理</h3>
<ul>
<li>
<p><strong>Excel</strong> <strong>列位处理</strong>：文本、标签列提取。</p>
</li>
<li>
<p><strong>要点</strong>：</p>
<ul>
<li><strong>统一 label</strong> <strong>口径</strong>：<code>Pass → 1 / Reject → 0</code>；</li>
<li><strong>类别精度</strong>：对 <code>Reject</code> 的类别进行<strong>单独统计</strong>，便于发现“弱类”。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-17">3) 大模型调用与推理参数（使用botocore调用Bedrock）</h3>
<ul>
<li><strong>默认参数</strong>：<code>temperature=0.0</code>、<code>max_tokens=1000</code>，确保<strong>可重复与稳定输出，</strong> <code>max_tokens</code>过大对效果影响有限;</li>
<li><strong>超时/</strong> <strong>重试</strong>：<code>botocore.config.Config</code>中设置<code>connect_timeout/read_timeout/retries</code>；</li>
</ul>
<h3 data-id="heading-18">4) 提示词模板与占位</h3>
<ul>
<li>通过<code>prompt_template.format(text=...)</code> 注入样本正文。</li>
<li><strong>建议</strong>：模板内统一约束<strong>唯一</strong> <strong>JSON</strong> <strong>输出</strong>，便于解析；输出前置 ReAct 步骤（语言识别、关键词提取、类别匹配、最终判定）。</li>
</ul>
<h3 data-id="heading-19">5) 并发验证与节流</h3>
<ul>
<li><strong>多文件并行</strong>：<code>ThreadPoolExecutor</code> 按文件粒度并发；</li>
<li><strong>速率控制</strong>：<code>time.sleep(0.5)</code> 做基础节流，避免限流，注意您Amazon Web Service账号内Quota；</li>
</ul>
<h3 data-id="heading-20">6) 评估与报表</h3>
<ul>
<li>
<p>输出四个 Sheet：<code>Results / Overall Metrics / File Metrics / Category Metrics</code> + <code>Prompt</code>。</p>
</li>
<li>
<p><strong>好处</strong>：</p>
<ul>
<li><code>Category Metrics</code> 能快速定位<strong>薄弱类别</strong>；</li>
<li><code>Prompt</code> 留存使<strong>版本可复现</strong>；</li>
<li>结合日志快速回放异常样本。</li>
</ul>
</li>
</ul>
<p><strong>评估口径</strong>：统一使用“与人工标注的一致性”为主指标（Overall/Pass/Reject accuracy + Category accuracy），并在文中<strong>显式声明标注噪声</strong>与“多审核员/多日/未复核”的现实约束。</p>
<h2 data-id="heading-21">经验总结（针对轮数选择与成本）</h2>
<ul>
<li>
<p><strong>建议轮数</strong>：<strong>5–8</strong> <strong>轮</strong>；5 轮用于大多数生产场景，8 轮用于上线前稳健性校验。</p>
</li>
<li>
<p><strong>避免过拟合</strong>：10 轮以上容易对某些审核员口径或小样本簇过拟合，泛化变差。</p>
</li>
<li>
<p><strong>成本优化</strong>：</p>
<ul>
<li>串并结合：文件级并行 + 样本级节流；</li>
<li>固定 <code>temperature</code>，保证一致性，减少“返工轮”；</li>
<li>对类别<strong>分层抽样</strong>做小集评估，优先修“弱类”，再全量回归。</li>
<li>在最终工程化实施时，可以将提示词放到system prompt中，同时开启cache，以降低成本。</li>
</ul>
</li>
<li>
<p><strong>JSON</strong> <strong>仅输出与解析健壮性</strong></p>
<ul>
<li>强调输出格式的规范化，降低对输出结果的不统一增加生产系统的不确定性。</li>
<li>部分提示词</li>
</ul>
</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F09%2F29%2Fcommunities-3.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/09/29/communities-3.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce09ff6490fc4094bb656ab04d2d485c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=wSwcENFAjfgJ9IWsuVIxTsR9fGM%3D" alt="" loading="lazy"/></a></p>
<ul>
<li>输出</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F09%2F29%2Fcommunities-4.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/09/29/communities-4.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e04bd15b444a48aad8fe053f93961a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=sljqwQ4T9NXdLfOgfmw%2Bx2p%2F5Rg%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-22">落地经验</h2>
<p>在整个项目落地的过程中，我们积累了几条关键经验：</p>
<ol>
<li><strong>提示词必须贴合业务标注体系:</strong> 通用的“内容安全”提示词远远不够。只有结合客户的 10 类违规分类，并不断对照人工审核样本修正，才能让模型输出结果和业务口径保持一致。</li>
<li><strong>ReAct</strong> <strong>框架带来了可解释性:</strong> 模型先进行“思考”，再给出“行动”，让每一步逻辑更加透明。我们可以展示模型的推理逻辑（语言识别、关键词提取、类别匹配），增强了审核结论的可信度。</li>
<li><strong>数据质量是上限，提示词优化是下限:</strong> 我们使用的人工审核数据存在多人、分多日完成、缺乏复核等问题，导致标注结果本身带有噪声。在这种情况下，模型的准确率“天花板”就会受到影响。换句话说，提示词优化能逼近人工水平，但要进一步突破，还需要客户改善数据标注流程。</li>
<li><strong>成本与效果的权衡:</strong> 我们在实验中验证了 3、5、10 轮迭代的差异，最终选择 5 轮作为最优点。同样地，temperature 参数在调优阶段设置高值，在上线阶段锁定低值，也是平衡创造性与稳定性的工程实践。</li>
</ol>
<h2 data-id="heading-23">未来优化方向</h2>
<ol>
<li>
<p><strong>自动化提示词优化</strong></p>
<ul>
<li>引入 AutoPrompt、RLHF 等方法，让提示词进化不再完全依赖人工试错。</li>
<li>在更多语言、更多语境下持续收敛。</li>
</ul>
</li>
<li>
<p><strong>更细粒度的分类与标签</strong></p>
<ul>
<li>客户的 10 类违规类别是第一层级。</li>
<li>后续可以扩展子类别（如“仇恨言论 → 针对性别 / 种族 / 职业”），满足更精细化的内容治理需求。</li>
</ul>
</li>
<li>
<p><strong>成本优化</strong></p>
<ul>
<li>会结合Bedrock的cache特性，增加对system prompt、user prompt的cache，在保证审核效果的情况下，尽可能优化成本。</li>
<li>成本详情请参阅Amazon Bedrock成本页面（<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fbedrock%2Fpricing%2F" target="_blank" title="https://aws.amazon.com/cn/bedrock/pricing/" ref="nofollow noopener noreferrer">aws.amazon.com/cn/bedrock/…</a>）与Claude模型成本页面（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.claude.com%2Fzh-CN%2Fdocs%2Fabout-claude%2Fpricing" target="_blank" title="https://docs.claude.com/zh-CN/docs/about-claude/pricing" ref="nofollow noopener noreferrer">docs.claude.com/zh-CN/docs/…</a>）</li>
</ul>
</li>
</ol>
<h2 data-id="heading-24">结语</h2>
<p>从最初的“误判频发”，到最终实现 <strong>81%</strong> <strong>的整体准确率</strong>，我们通过 <strong>提示词工程 + ReAct</strong> <strong>框架 +</strong> <strong>工程化架构</strong>，帮助客户构建了一套 <strong>稳定、可观测、可扩展</strong> 的游戏社区审核系统。</p>
<p>这个过程的价值在于：</p>
<ul>
<li>它不仅是一次模型调优尝试，而是一套 <strong>可工程化复制的方法论</strong>；</li>
<li>在 <strong>UGC</strong> <strong>社区、社交平台、直播审核</strong> 等场景，都可以直接复用这套 <strong>提示词优化 +</strong> <strong>架构闭环</strong> 的方案；</li>
<li>通过 <strong>日志、判例库、蓝绿部署</strong> 等工程实践，我们让审核系统具备了 <strong>一致性、可追溯性和快速迭代能力</strong>。</li>
</ul>
<p>最终，这个项目让我们看到了 <strong>大语言模型 +</strong> <strong>工程化落地</strong> 在内容审核领域的潜力：</p>
<ul>
<li><strong>提示词调优</strong> 让模型快速逼近甚至超越人工审核的一致性；</li>
<li><strong>工程化架构</strong> 确保系统在 <strong>高并发、大规模多语言</strong> 审核场景下依旧稳定运行；</li>
<li><strong>端到端闭环</strong> 使审核系统不仅能解决当下问题，还能通过数据回流不断自我进化。</li>
</ul>
<p>*前述特定亚马逊云科技生成式人工智能相关的服务目前在亚马逊云科技海外区域可用。亚马逊云科技中国区域相关云服务由西云数据和光环新网运营，具体信息以中国区域官网为准。</p>
<p><strong>本篇作者</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c97474c05804f76a9aaec207af439bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763948&amp;x-signature=H5SQL8MHEiFJ%2FNbNyzoLqiI0eXE%3D" alt="1.webp" loading="lazy"/></p>
<blockquote>
<p>本期最新实验《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">多模一站通 —— Amazon Bedrock 上的基础模型初体验</a>》</p>
<p>✨ 精心设计，旨在引导您深入探索Amazon Bedrock的模型选择与调用、模型自动化评估以及安全围栏(Guardrail)等重要功能。无需管理基础设施，利用亚马逊技术与生态，快速集成与部署生成式AI模型能力。</p>
<p>⏩️[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">点击进入实验</a>] 即刻开启  AI 开发之旅</p>
<p>构建无限, 探索启程！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据会说谎？三大推断方法帮你“审问”数据真相]]></title>    <link>https://juejin.cn/post/7581097111896571958</link>    <guid>https://juejin.cn/post/7581097111896571958</guid>    <pubDate>2025-12-08T12:26:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896571958" data-draft-id="7581117416811610155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 数据会说谎？三大推断方法帮你“审问”数据真相"/> <meta itemprop="keywords" content="Python,数据分析,后端"/> <meta itemprop="datePublished" content="2025-12-08T12:26:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             数据会说谎？三大推断方法帮你“审问”数据真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:26:42.000Z" title="Mon Dec 08 2025 12:26:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚入行甚至想入行数据分析的朋友，往往会陷入一个<strong>误区</strong>：以为数据分析就是不停地<strong>做报表</strong>、<strong>画饼图</strong>。</p>
<p>其实，数据分析的核心魅力在于 <strong>“推断”——即见微知著</strong>。</p>
<p>在现实生活中，我们很难获取“全量数据”（比如你不可能调查全国每一个人的身高），那么，如何通过手中的“小样本”去推测“大总体”的规律？</p>
<p>这就需要用到统计学中的<strong>推断分析</strong>。</p>
<p>本文将结合代码来介绍<strong>推断分析</strong>中最常用的三大方法：<strong>参数估计</strong>、<strong>假设检验</strong>、<strong>非参数检验</strong>。</p>
<h2 data-id="heading-0">1. 参数估计</h2>
<p>想象你在煮一锅排骨汤。你想知道汤咸不咸，你不会把整锅汤都喝完，而是舀起一勺尝一尝。</p>
<ul>
<li>那一勺汤就是<strong>样本</strong>。</li>
<li>那一勺的咸度就是<strong>样本统计量</strong>。</li>
<li>整锅汤的咸度就是我们要猜的<strong>总体参数</strong>。</li>
</ul>
<p><strong>参数估计</strong>就是：根据样本的特征（比如<strong>样本均值</strong>），去估计总体的特征（比如<strong>总体均值</strong>）。</p>
<p>它通常分为两种：</p>
<ul>
<li><strong>点估计</strong>：直接说“这锅汤是1.5%的盐度”。（但这很容易被打脸，因为太绝对）</li>
<li><strong>区间估计</strong>：说“这锅汤的盐度在1.4%到1.6%之间，我有95%的把握”。（这就是置信区间，更科学）</li>
</ul>
<p><strong>区间估计</strong>是最常使用的方式，下面通过一个示例来演示<strong>参数估计</strong>的具体使用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats

<span class="hljs-comment"># 1. 模拟数据</span>
np.random.seed(<span class="hljs-number">42</span>)
true_mean = <span class="hljs-number">15</span>  <span class="hljs-comment"># 上帝视角的真实均值</span>
sample_salaries = np.random.normal(loc=true_mean, scale=<span class="hljs-number">3</span>, size=<span class="hljs-number">100</span>)  <span class="hljs-comment"># 模拟100个样本</span>

<span class="hljs-comment"># 2. 计算统计量</span>
sample_mean = np.mean(sample_salaries)
sample_std = np.std(sample_salaries, ddof=<span class="hljs-number">1</span>)
n = <span class="hljs-built_in">len</span>(sample_salaries)

<span class="hljs-comment"># 计算95%置信区间</span>
<span class="hljs-comment"># 这里的 scale 使用的是标准误 (Standard Error) = 样本标准差 / sqrt(n)</span>
conf_int = stats.t.interval(
    confidence=<span class="hljs-number">0.95</span>, df=n - <span class="hljs-number">1</span>, loc=sample_mean, scale=sample_std / np.sqrt(n)
)
lower_bound, upper_bound = conf_int

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"样本均值: <span class="hljs-subst">{sample_mean:<span class="hljs-number">.2</span>f}</span>k"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"95%置信区间: [<span class="hljs-subst">{lower_bound:<span class="hljs-number">.2</span>f}</span>k, <span class="hljs-subst">{upper_bound:<span class="hljs-number">.2</span>f}</span>k]"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
样本均值: 14.69k
95%置信区间: [14.15k, 15.23k]
'''</span>
</code></pre>
<p>图形化之后的结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2485481dfd374b6f958cd86bf1d60464~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=jHE5ZnE12Qk9cAi9MC1r1J64vjU%3D" alt="" loading="lazy"/></p>
<p>从图中可以看出：</p>
<ol>
<li><strong>灰色的散点</strong>：是你调研的那100个数据分析师的工资。你会发现有的高有的低，散落在各地。</li>
<li><strong>蓝色的点和横线</strong>：</li>
</ol>
<ul>
<li><strong>蓝点</strong>是你算出来的样本均值（约14.67k），虽然不完全等于真实的15k，但很接近。</li>
<li><strong>蓝色的横线</strong>就是置信区间。它的含义是：“虽然我不知道确切数字，但我敢打赌，真实数字就在这根蓝线的范围内。”</li>
</ul>
<ol start="3">
<li><strong>红色的虚线</strong>：这是真实的总体均值（15k）。</li>
<li><strong>结论</strong>：你可以清楚地看到，红色的虚线确实穿过了蓝色的横线。恭喜你！这次“参数估计”成功捕获了真理！</li>
</ol>
<p>数据分析不是算命，算出来的不是一个死的数字，而是一个科学的范围。</p>
<p>我们就是用<strong>参数估计</strong>的方法，在不确定性中寻找确定性。</p>
<h2 data-id="heading-1">2. 假设检验</h2>
<p><strong>假设检验</strong>是数据分析中最常用的决策工具。它的逻辑是：<strong>先立一个Flag（假设），然后看证据（数据）是否打脸</strong>。</p>
<ul>
<li><strong>原假设</strong> ：通常代表“无事发生”、“没有变化”、“运气好”。</li>
<li><strong>备择假设</strong>：通常代表“有事发生”、“真的有效果”。</li>
<li><strong>P值</strong>：表示原假设成立时，出现当前数据的概率。P值越小，说明原假设越不靠谱（通常以0.05为界限）。</li>
</ul>
<p>下面通过一个电商APP的A/B测试场景，来演示<strong>假设检验</strong>的使用。</p>
<p>假设某电商APP想把 <strong>“购买”</strong> 按钮从 <strong>蓝色</strong> 改成 <strong>红色</strong> 。</p>
<ul>
<li><strong>原假设</strong>：红色按钮和蓝色按钮的转化率没区别（差别纯属偶然）。</li>
<li><strong>备择假设</strong>：红色按钮的转化率显著高于蓝色按钮。</li>
</ul>
<p>我们采集了两组用户的消费金额数据来进行T检验。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 模拟AB测试数据</span>
<span class="hljs-comment"># 蓝色按钮组（对照组）：平均消费 100元</span>
group_blue = np.random.normal(loc=<span class="hljs-number">100</span>, scale=<span class="hljs-number">20</span>, size=<span class="hljs-number">1000</span>)
<span class="hljs-comment"># 红色按钮组（实验组）：平均消费 105元 (我们要检验这个提升是否显著)</span>
group_red = np.random.normal(loc=<span class="hljs-number">105</span>, scale=<span class="hljs-number">25</span>, size=<span class="hljs-number">1000</span>)

<span class="hljs-comment"># 2. 进行独立样本T检验 (T-test)</span>
t_stat, p_val = stats.ttest_ind(group_blue, group_red)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"P值: <span class="hljs-subst">{p_val:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-comment"># 3. 判断结论</span>
alpha = <span class="hljs-number">0.05</span>
<span class="hljs-keyword">if</span> p_val &lt; alpha:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：拒绝原假设。红色按钮带来的消费提升是【统计显著】的，建议全量上线！"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：无法拒绝原假设。两组差异可能是误差导致的，建议维持原状。"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
P值: 0.00000
结论：拒绝原假设。红色按钮带来的消费提升是【统计显著】的，建议全量上线！
'''</span>
</code></pre>
<p>图形化结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/007a998a5b334cc1983d927a81d5cb52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=m5GveoNuTzkuYjkksK1WM8NmpFY%3D" alt="" loading="lazy"/></p>
<p>从图中，我们可以看出，两条曲线（红色和蓝色）其实重叠度很高。</p>
<p>对于新手，看到这个图，可能会陷入一个误区，觉得“这两座山峰看起来差不多嘛，没啥区别”。</p>
<p>但在统计学上，两座山峰的 <strong>“重心”</strong> （均值）发生了 <strong>显著偏移</strong> 。这就是假设检验的威力--在重叠的噪声中识别出偏移的信号。</p>
<h2 data-id="heading-2">3. 非参数估计</h2>
<p>前面的 <strong>“参数估计”</strong> 和 <strong>“T检验”</strong> 都有一个娇气的脾气：它们通常假设数据是服从 <strong>“正态分布”</strong> 的（也就是漂亮的钟形曲线）。</p>
<p>但在现实生活中，很多数据并不正态，或者数据甚至是定序的（比如：非常满意、满意、一般、不满意）。</p>
<p>这时候，传统的 <strong>T检验</strong> 就失效了，我们需要请出 <strong>非参数检验</strong> 。</p>
<p>它不依赖数据的分布形状，非常抗造。</p>
<p>假设我们要对比两款手游《王者荣耀》和《原神》玩家每天的游玩时长。</p>
<p>由于《原神》玩家可能存在大量的“长尾”用户（玩特别久），数据往往是严重右偏的，不符合正态分布。</p>
<p>这时候对比两组数据差异，就不能用<strong>T检验</strong>，我们使用<strong>非参数估计</strong>中的一种方式：曼-惠特尼U检验 (Mann-Whitney U test)。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 模拟非正态分布数据 (使用指数分布模拟由偏数据)</span>
<span class="hljs-comment"># 游戏A：平均时长较短</span>
game_a_hours = np.random.exponential(scale=<span class="hljs-number">1.0</span>, size=<span class="hljs-number">100</span>)
<span class="hljs-comment"># 游戏B：平均时长较长</span>
game_b_hours = np.random.exponential(scale=<span class="hljs-number">1.5</span>, size=<span class="hljs-number">100</span>)

<span class="hljs-comment"># 2. 首先，检查一下正态性 (Shapiro-Wilk检验)</span>
<span class="hljs-comment"># 如果P &lt; 0.05，说明不是正态分布</span>
_, p_norm_a = stats.shapiro(game_a_hours)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"游戏A正态性检验P值: <span class="hljs-subst">{p_norm_a:<span class="hljs-number">.4</span>f}</span> (小于0.05则非正态)"</span>)

<span class="hljs-comment"># 3. 使用非参数检验：Mann-Whitney U检验</span>
<span class="hljs-comment"># 它可以比较两个独立样本的分布是否存在差异（侧重于中位数/秩次的比较）</span>
u_stat, p_val_nonparam = stats.mannwhitneyu(game_a_hours, game_b_hours, alternative=<span class="hljs-string">'two-sided'</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Mann-Whitney U检验 P值: <span class="hljs-subst">{p_val_nonparam:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-keyword">if</span> p_val_nonparam &lt; <span class="hljs-number">0.05</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：两款游戏的玩家游玩时长分布存在显著差异。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：两款游戏玩家游玩时长无显著差异。"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
游戏A正态性检验P值: 0.0000 (小于0.05则非正态)
Mann-Whitney U检验 P值: 0.00003
结论：两款游戏的玩家游玩时长分布存在显著差异。
'''</span>
</code></pre>
<p>可视化结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93946f2319514f0799b428ff9ce98157~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=YIoZEwYKr5SHRNZpgn1OoZhSI24%3D" alt="" loading="lazy"/></p>
<p>尽管数据长得歪瓜裂枣（严重右偏），<strong>U检验</strong>依然稳健地告诉我们：<strong>这两组数据不一样</strong>。</p>
<p><strong>U检验</strong>比较的不仅仅是平均值，它更多是在比较 <strong>“秩次”</strong>（<code>Ranking</code>）。</p>
<p>通俗点说，它发现如果我们把两组玩家混在一起排名，<code>Game B</code>的玩家即使不看具体时长，排名也普遍比<code>Game A</code>的玩家靠前。</p>
<p>从图中来看，你会看到橙色（<code>Game B</code>）的尾巴明显比蓝色（<code>Game A</code>）拖得更长、更厚实。</p>
<p>这说明<code>Game B</code>（比如《原神》）更容易让玩家沉浸更久，或者拥有更多的重度玩家。</p>
<h2 data-id="heading-3">4. 总结</h2>
<p>恭喜你！你已经掌握了数据<strong>推断分析</strong>的核心逻辑：</p>
<ol>
<li><strong>参数估计</strong>：当你只有样本，想知道总体的数值范围时使用。（比如估算平均薪资）</li>
<li><strong>假设检验</strong>：当你数据比较“完美”（正态分布），想判断差异是不是真的时使用。（比如A/B测试）</li>
<li><strong>非参数检验</strong>：当你数据分布奇怪、或者只有排名/等级数据时使用。（比如评分对比、长尾数据分析）</li>
</ol>
<p>这<strong>三板斧</strong>是数据分析师行走江湖的必备技能。掌握了它们，你就不仅仅是一个“做表的”，而是一个能从数据中挖掘真相的“侦探”！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA["讲讲原型链" —— 面试官最爱问的 JavaScript 基础]]></title>    <link>https://juejin.cn/post/7581324171398479918</link>    <guid>https://juejin.cn/post/7581324171398479918</guid>    <pubDate>2025-12-08T14:25:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324171398479918" data-draft-id="7581292270961754122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="&quot;讲讲原型链&quot; —— 面试官最爱问的 JavaScript 基础"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-08T14:25:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            "讲讲原型链" —— 面试官最爱问的 JavaScript 基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:25:25.000Z" title="Mon Dec 08 2025 14:25:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 原型与原型链：从困惑到完全理解</h2>
<p>以前在看 JavaScript 代码的时候，经常会遇到一个问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>);      <span class="hljs-comment">// 4</span>
arr.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>);    <span class="hljs-comment">// "1,2,3,4"</span>
arr.<span class="hljs-title function_">toString</span>();   <span class="hljs-comment">// "1,2,3,4"</span>
</code></pre>
<p>我明明只创建了一个数组，为什么它能调用 <code>push</code>、<code>join</code>、<code>toString</code> 这些方法？这些方法是从哪来的？</p>
<p>再看这段代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'张三'</span>);
person.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// "Hello, I'm 张三"</span>
</code></pre>
<p><code>person</code> 对象本身没有 <code>sayHello</code> 方法，但却能调用它。这背后的机制就是原型链。</p>
<hr/>
<h3 data-id="heading-1">先搞清楚几个概念</h3>
<p>在深入之前，先把几个容易混淆的概念理清楚：</p>
<h4 data-id="heading-2"><code>[[Prototype]]</code>、<code>__proto__</code>、<code>prototype</code> 的区别</h4>





























<table><thead><tr><th>概念</th><th>是什么</th><th>属于谁</th><th>作用</th></tr></thead><tbody><tr><td><code>[[Prototype]]</code></td><td>内部属性</td><td>所有对象</td><td>指向对象的原型，隐藏属性</td></tr><tr><td><code>__proto__</code></td><td>访问器属性</td><td>所有对象</td><td>暴露 <code>[[Prototype]]</code>，非标准但广泛支持</td></tr><tr><td><code>prototype</code></td><td>普通属性</td><td>函数</td><td>存放给实例共享的属性和方法</td></tr></tbody></table>
<p>简单说：</p>
<ul>
<li><strong><code>prototype</code></strong> 是<strong>函数</strong>才有的属性，用来存放共享方法</li>
<li><strong><code>__proto__</code></strong> 是<strong>所有对象</strong>都有的属性，指向它的原型对象</li>
<li><strong><code>[[Prototype]]</code></strong> 是 <code>__proto__</code> 的内部实现</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();

<span class="hljs-comment">// prototype 只有函数才有</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);      <span class="hljs-comment">// {constructor: ƒ}</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);      <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// __proto__ 所有对象都有</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-3">现代写法：Object.getPrototypeOf()</h4>
<p><code>__proto__</code> 虽然好用，但它不是 ECMAScript 标准的一部分，只是各浏览器都实现了。推荐用标准方法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(foo) === <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 设置原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, prototype)

<span class="hljs-comment">// 创建时指定原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(prototype)
</code></pre>
<hr/>
<h3 data-id="heading-4">原型是什么</h3>
<p>JavaScript 里每个函数都有一个 <code>prototype</code> 属性，指向一个对象。这个对象叫做<strong>原型对象</strong>，它的作用是让该函数创建的所有实例共享属性和方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-comment">// 方法定义在原型上，所有实例共享</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">start</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 启动了`</span>);
};

<span class="hljs-keyword">const</span> car1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'丰田'</span>);
<span class="hljs-keyword">const</span> car2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'本田'</span>);

car1.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 丰田 启动了</span>
car2.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 本田 启动了</span>

<span class="hljs-comment">// 两个实例用的是同一个方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car1.<span class="hljs-property">start</span> === car2.<span class="hljs-property">start</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>这就是原型的核心价值：<strong>方法只需要定义一次，所有实例都能用</strong>。</p>
<p>如果把方法定义在构造函数里，每创建一个实例就会新建一个函数，浪费内存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐的写法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BadCar</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {  <span class="hljs-comment">// 每个实例都有一份</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 启动了`</span>);
  };
}

<span class="hljs-keyword">const</span> bad1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadCar</span>(<span class="hljs-string">'丰田'</span>);
<span class="hljs-keyword">const</span> bad2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadCar</span>(<span class="hljs-string">'本田'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bad1.<span class="hljs-property">start</span> === bad2.<span class="hljs-property">start</span>); <span class="hljs-comment">// false，两个不同的函数</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">new 关键字到底做了什么</h3>
<p>理解原型链之前，得先搞清楚 <code>new</code> 的工作原理。当你写 <code>new Foo()</code> 时，JavaScript 引擎会执行以下四个步骤：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A['1. 创建空对象']:::step --&gt; B['2. 设置原型链']:::step
    B --&gt; C['3. 执行构造函数']:::step
    C --&gt; D['4. 返回对象']:::success

    classDef step fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef success fill:#d4edda,stroke:#28a745,color:#155724
</code></pre>
<h4 data-id="heading-6">详细步骤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);
</code></pre>
<p><strong>Step 1：创建一个空对象</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部创建：{}</span>
</code></pre>
<p><strong>Step 2：将空对象的 <code>[[Prototype]]</code> 指向构造函数的 <code>prototype</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部操作：newObj.__proto__ = Person.prototype</span>
</code></pre>
<p><strong>Step 3：用这个空对象作为 <code>this</code> 执行构造函数</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部操作：Person.call(newObj, 'John')</span>
<span class="hljs-comment">// 执行后 newObj 变成 { name: 'John' }</span>
</code></pre>
<p><strong>Step 4：返回对象</strong></p>
<ul>
<li>如果构造函数返回一个对象，就用那个对象</li>
<li>否则返回 Step 1 创建的对象</li>
</ul>
<h4 data-id="heading-7">手写一个 new</h4>
<p>理解了原理，可以自己实现一个：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 1. 创建空对象，原型指向构造函数的 prototype</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. 执行构造函数，this 绑定到新对象</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. 如果构造函数返回对象，就用它；否则用新创建的对象</span>
  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-title function_">myNew</span>(<span class="hljs-title class_">Person</span>, <span class="hljs-string">'Alice'</span>);
p.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// Hi, I'm Alice</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">原型链的查找机制</h3>
<p>当访问对象的属性或方法时，JavaScript 会按照这个顺序查找：</p>
<ol>
<li>先在对象自身找</li>
<li>找不到，去对象的原型 (<code>__proto__</code>) 上找</li>
<li>还找不到，继续往上一级原型找</li>
<li>直到 <code>Object.prototype</code>，再往上就是 <code>null</code> 了</li>
</ol>
<p>这条查找链路就是<strong>原型链</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A["dog 实例&lt;br/&gt;{ name: 'Buddy' }"]:::instance --&gt;|__proto__| B["Dog.prototype&lt;br/&gt;{ bark: ƒ }"]:::proto
    B --&gt;|__proto__| C["Animal.prototype&lt;br/&gt;{ speak: ƒ }"]:::proto
    C --&gt;|__proto__| D["Object.prototype&lt;br/&gt;{ toString: ƒ, ... }"]:::rootProto
    D --&gt;|__proto__| E["null"]:::endNode

    classDef instance fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef proto fill:#d4edda,stroke:#28a745,color:#155724
    classDef rootProto fill:#fff3cd,stroke:#ffc107,color:#856404
    classDef endNode fill:#f8d7da,stroke:#dc3545,color:#721c24
</code></pre>
<h4 data-id="heading-9">代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">speak</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a sound`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
}

<span class="hljs-comment">// 建立原型链：Dog.prototype -&gt; Animal.prototype</span>
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Woof!'</span>);
};

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>);

<span class="hljs-comment">// 查找过程：</span>
dog.<span class="hljs-property">name</span>;    <span class="hljs-comment">// 在 dog 自身找到</span>
dog.<span class="hljs-title function_">bark</span>();  <span class="hljs-comment">// 在 Dog.prototype 找到</span>
dog.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// 在 Animal.prototype 找到</span>
dog.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 在 Object.prototype 找到</span>
</code></pre>
<p>用代码验证这条链：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);                 <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);    <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-literal">null</span>);             <span class="hljs-comment">// true</span>
</code></pre>
<p>这就解释了开头的问题。数组能调用 <code>push</code>、<code>join</code>，是因为这些方法定义在 <code>Array.prototype</code> 上。能调用 <code>toString</code>，是因为顺着原型链能找到 <code>Object.prototype.toString</code>（虽然 Array 重写了这个方法）。</p>
<hr/>
<h3 data-id="heading-10">完整的原型链图谱</h3>
<p>JavaScript 的原型链比想象中更复杂，函数本身也是对象，也有自己的原型链：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph IL[实例层]
        foo["foo 实例"]:::instance
    end

    subgraph PL[原型层]
        FooP["Foo.prototype"]:::proto
        ObjP["Object.prototype"]:::rootProto
    end

    subgraph FL[函数层]
        Foo["Foo 函数"]:::func
        Obj["Object 函数"]:::func
        Func["Function 函数"]:::func
    end

    subgraph FPL[函数原型层]
        FuncP["Function.prototype"]:::funcProto
    end

    foo --&gt;|__proto__| FooP
    FooP --&gt;|__proto__| ObjP
    ObjP --&gt;|__proto__| NULL["null"]:::endNode

    Foo --&gt;|prototype| FooP
    Foo --&gt;|__proto__| FuncP

    Obj --&gt;|prototype| ObjP
    Obj --&gt;|__proto__| FuncP

    Func --&gt;|prototype| FuncP
    Func --&gt;|__proto__| FuncP

    FuncP --&gt;|__proto__| ObjP

    classDef instance fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef proto fill:#d4edda,stroke:#28a745,color:#155724
    classDef rootProto fill:#fff3cd,stroke:#ffc107,color:#856404
    classDef func fill:#e2d9f3,stroke:#6f42c1,color:#432874
    classDef funcProto fill:#fce4ec,stroke:#e91e63,color:#880e4f
    classDef endNode fill:#f8d7da,stroke:#dc3545,color:#721c24

    style IL fill:#e8f4fc,stroke:#0d6efd
    style PL fill:#e8f5e9,stroke:#28a745
    style FL fill:#f3e5f5,stroke:#6f42c1
    style FPL fill:#fce4ec,stroke:#e91e63
</code></pre>
<h4 data-id="heading-11">几个关键点</h4>
<p><strong>1. 所有函数都是 Function 的实例</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);    <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true（自己创建自己）</span>
</code></pre>
<p><strong>2. Function.prototype 也是对象，它的原型是 Object.prototype</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>3. Object.prototype 是原型链的终点</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-literal">null</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>4. 一个有趣的循环</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Object 是函数，所以它的 __proto__ 是 Function.prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Function.prototype 是对象，所以它的 __proto__ 是 Object.prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 这形成了一个有趣的"鸡生蛋蛋生鸡"的关系</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">属性遮蔽（Property Shadowing）</h3>
<p>如果对象自身和原型上有同名属性，会发生什么？</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Default'</span>;
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);

<span class="hljs-comment">// 自身属性遮蔽原型属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'John'，不是 'Default'</span>

<span class="hljs-comment">// 删除自身属性后，原型属性就露出来了</span>
<span class="hljs-keyword">delete</span> john.<span class="hljs-property">name</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'Default'</span>
</code></pre>
<p>这就是<strong>属性遮蔽</strong>：自身属性会"遮住"原型链上的同名属性。</p>
<h4 data-id="heading-13">检查属性来源</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);

<span class="hljs-comment">// hasOwnProperty 只检查自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'name'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'greet'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// in 操作符检查整个原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'name'</span> <span class="hljs-keyword">in</span> john);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'greet'</span> <span class="hljs-keyword">in</span> john); <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">实现继承</h3>
<p>理解了原型链，继承就好办了。核心就两步：</p>
<ol>
<li>调用父构造函数，继承实例属性</li>
<li>设置原型链，继承原型方法</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Vehicle</span>(<span class="hljs-params">type</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = type;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> = <span class="hljs-number">0</span>;
}

<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">amount</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> += amount;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span> 加速到 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.speed}</span> km/h`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-title class_">Vehicle</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'汽车'</span>);  <span class="hljs-comment">// 继承实例属性</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// 继承原型方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Car</span>;

<span class="hljs-comment">// 添加子类特有的方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">honk</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 鸣笛`</span>);
};

<span class="hljs-comment">// 重写父类方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">amount</span>) {
  <span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, amount);
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> &gt; <span class="hljs-number">120</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'超速警告'</span>);
  }
};

<span class="hljs-keyword">const</span> myCar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'丰田'</span>);
myCar.<span class="hljs-title function_">accelerate</span>(<span class="hljs-number">50</span>);   <span class="hljs-comment">// 汽车 加速到 50 km/h</span>
myCar.<span class="hljs-title function_">accelerate</span>(<span class="hljs-number">80</span>);   <span class="hljs-comment">// 汽车 加速到 130 km/h</span>
                        <span class="hljs-comment">// 超速警告</span>
myCar.<span class="hljs-title function_">honk</span>();           <span class="hljs-comment">// 丰田 鸣笛</span>
</code></pre>
<h4 data-id="heading-15">为什么用 Object.create() 而不是直接赋值</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
<span class="hljs-comment">// 问题：修改 Car.prototype 会影响 Vehicle.prototype</span>

<span class="hljs-comment">// 错误写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>();
<span class="hljs-comment">// 问题：会执行 Vehicle 构造函数，可能有副作用</span>

<span class="hljs-comment">// 正确写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-comment">// 创建一个新对象，原型指向 Vehicle.prototype</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">ES6 的 class 语法</h3>
<p>ES6 引入了 <code>class</code> 关键字，写起来更清爽：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a sound`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
  }

  <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Woof!'</span>);
  }
}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>, <span class="hljs-string">'Labrador'</span>);
dog.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Buddy makes a sound</span>
dog.<span class="hljs-title function_">bark</span>();  <span class="hljs-comment">// Woof!</span>
</code></pre>
<p>但要清楚，<code>class</code> 只是语法糖，底层还是原型链那套：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// "function"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-17">class 的一些特性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
  <span class="hljs-comment">// 实例属性（ES2022+）</span>
  instanceProp = <span class="hljs-string">'instance'</span>;

  <span class="hljs-comment">// 私有属性（ES2022+）</span>
  #privateProp = <span class="hljs-string">'private'</span>;

  <span class="hljs-comment">// 静态属性</span>
  <span class="hljs-keyword">static</span> staticProp = <span class="hljs-string">'static'</span>;

  <span class="hljs-comment">// 静态方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'static method'</span>;
  }

  <span class="hljs-comment">// getter/setter</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#privateProp;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-18">几个容易踩的坑</h3>
<h4 data-id="heading-19">1. 引用类型放原型上会共享</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hobbies</span> = [];  <span class="hljs-comment">// 所有实例共享这个数组</span>

<span class="hljs-keyword">const</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-keyword">const</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'李四'</span>);

s1.<span class="hljs-property">hobbies</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'reading'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s2.<span class="hljs-property">hobbies</span>); <span class="hljs-comment">// ['reading']  // s2 也有了，出问题了</span>
</code></pre>
<p>引用类型（数组、对象）应该放在构造函数里：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">hobbies</span> = [];  <span class="hljs-comment">// 每个实例独立</span>
}
</code></pre>
<h4 data-id="heading-20">2. 别直接替换 prototype 对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 直接替换 prototype 会丢失 constructor</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};

<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Foo</span>); <span class="hljs-comment">// false，变成 Object 了</span>
</code></pre>
<p>要么记得补上 constructor，要么用属性添加的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方式一：补上 constructor</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Foo</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};

<span class="hljs-comment">// 方式二：直接添加属性（推荐）</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
</code></pre>
<h4 data-id="heading-21">3. 箭头函数不能用作构造函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Foo</span> = (<span class="hljs-params"/>) =&gt; {};
<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>(); <span class="hljs-comment">// TypeError: Foo is not a constructor</span>
</code></pre>
<p>箭头函数没有 <code>prototype</code> 属性，也没有自己的 <code>this</code>，所以不能用 <code>new</code>。</p>
<h4 data-id="heading-22">4. instanceof 的局限性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// instanceof 检查的是原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 跨 iframe/realm 时会失效</span>
<span class="hljs-comment">// iframe 里的 Array 和主页面的 Array 不是同一个</span>
</code></pre>
<p>更可靠的类型检查：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([]);  <span class="hljs-comment">// "[object Array]"</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([]);  <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">性能考虑</h3>
<h4 data-id="heading-24">原型链查找有开销</h4>
<p>属性查找会沿着原型链向上，链越长开销越大。虽然现代引擎有优化，但还是要注意：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 如果频繁访问原型链上的属性，可以缓存</span>
<span class="hljs-keyword">const</span> method = obj.<span class="hljs-property">someMethod</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
  method.<span class="hljs-title function_">call</span>(obj);  <span class="hljs-comment">// 比 obj.someMethod() 快</span>
}
</code></pre>
<h4 data-id="heading-25">Object.create(null) 创建纯净对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 普通对象会继承 Object.prototype</span>
<span class="hljs-keyword">const</span> obj = {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">toString</span>); <span class="hljs-comment">// ƒ toString() { [native code] }</span>

<span class="hljs-comment">// 纯净对象没有原型链</span>
<span class="hljs-keyword">const</span> pureObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pureObj.<span class="hljs-property">toString</span>); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// 适合用作字典/哈希表，不用担心键名冲突</span>
<span class="hljs-keyword">const</span> dict = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
dict[<span class="hljs-string">'hasOwnProperty'</span>] = <span class="hljs-string">'safe'</span>;  <span class="hljs-comment">// 不会覆盖原型方法</span>
</code></pre>
<hr/>
<h3 data-id="heading-26">小结</h3>
<p>原型链说穿了就是一条查找链：找属性时从对象自身开始，顺着 <code>__proto__</code> 一路往上找，直到 <code>null</code>。</p>
<p>几个要点：</p>
<ul>
<li><code>prototype</code> 是函数的属性，用于存放共享的方法</li>
<li><code>__proto__</code>（或 <code>[[Prototype]]</code>）是对象的属性，指向它的原型</li>
<li>推荐用 <code>Object.getPrototypeOf()</code> 代替 <code>__proto__</code></li>
<li><code>new</code> 关键字做了四件事：创建对象、设置原型、执行构造函数、返回对象</li>
<li>方法定义在原型上，省内存</li>
<li><code>class</code> 是语法糖，底层还是原型链</li>
<li><code>Object.prototype</code> 是原型链的终点，它的 <code>__proto__</code> 是 <code>null</code></li>
</ul>
<p>理解了这个机制，再看 JavaScript 的面向对象就清晰多了。框架源码里大量使用原型链，比如 Vue 2 的响应式系统、各种插件的 mixin 实现，都是基于这套机制。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul>
<hr/>
<h3 data-id="heading-27">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FInheritance_and_the_prototype_chain" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain" ref="nofollow noopener noreferrer">MDN - Inheritance and the prototype chain</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FLearn_web_development%2FExtensions%2FAdvanced_JavaScript_objects%2FObject_prototypes" target="_blank" title="https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Advanced_JavaScript_objects/Object_prototypes" ref="nofollow noopener noreferrer">MDN - Object prototypes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnew" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" ref="nofollow noopener noreferrer">MDN - new operator</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.info%2Fprototype-inheritance" target="_blank" title="https://javascript.info/prototype-inheritance" ref="nofollow noopener noreferrer">JavaScript.info - Prototypal inheritance</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP 网关实战：基于 Higress + Nacos 的零代码工具扩展方案]]></title>    <link>https://juejin.cn/post/7581210455827021860</link>    <guid>https://juejin.cn/post/7581210455827021860</guid>    <pubDate>2025-12-08T09:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827021860" data-draft-id="7581117416810954795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP 网关实战：基于 Higress + Nacos 的零代码工具扩展方案"/> <meta itemprop="keywords" content="云原生,MCP"/> <meta itemprop="datePublished" content="2025-12-08T09:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP 网关实战：基于 Higress + Nacos 的零代码工具扩展方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:15:17.000Z" title="Mon Dec 08 2025 09:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    30
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：陆胤任</p>
<h2 data-id="heading-0">背景</h2>
<p>在 AI 大爆发的时代，已经有非常多的 AI 助手，结合 RAG 通过智能问答帮助用户解答问题。单纯地依靠智能问答帮助客户自助解答是远远不够的，我们需要让 AI 助手能够直接调用已有的丰富接口，朝着更强大的智能体演进。我们选用当下最为火热，且已逐步成为标准的 MCP 作为模型和接口之间通信的传输协议。关于 MCP，已有非常多的介绍文章，本文不再赘述。</p>
<p>在企业对外服务的场景下，MCP Server 需要解决以下几个问题：</p>
<ol>
<li>在服务的多实例高可用场景下，使用 SSE 通信方式如何维护 session；</li>
<li>如何做到动态更新 MCP 工具 Prompt，做到快速更新&amp;调试&amp;验证；</li>
<li>租户隔离的云服务场景下如何对用户的工具调用进行鉴权。</li>
</ol>
<p>Higress 可以很好地解决上面的问题 1，同时还有完善的运维监控体系，可视化易操作的控制台界面。为了解决问题 2，我们引入了 Nacos 负责注册后端服务以及管理维护 MCP 工具的元数据等信息。在整个 MCP 服务中，Higress 担任 MCP Proxy 的角色，Nacos 担任 MCP Registry 的角色。对于问题 3 租户隔离问题，会在下面鉴权章节中进行详细说明。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eba8180a02843ce87ac6f061198089e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=So7bS373hR83Pm%2F3%2BxQzPYdzbww%3D" alt="图片" loading="lazy"/></p>
<p>Higress 和 Nacos 都是云原生的应用，在部署方面，自然选择使用 K8s 集群进行云原生部署。同时很多企业有自己的专属生产网络环境，一般和外网不通，因此本文会围绕如何利用社区版本的 Higress 和 Nacos（Apache-2.0 开源协议）进行私有化部署。因为内部环境的限制，我们没有办法直接通过 Helm 操作 K8s 集群进行部署，因此本文会围绕如何基于 Higress 和 Nacos 的 docker 镜像在 K8s 集群上进行分角色部署。</p>
<p>通过这套自建的网关服务，使用配置即可实现零代码扩展 Tool，新应用的注册、应用下面工具的扩展、工具 prompt 更新验证都能通过服务集成的可视化控制台，更新发布配置快速完成，<strong>接入方式极其简单！更新验证极其快速！</strong> 同时利用 Nacos 的命名空间能力可以做到服务和工具集的隔离，给不同的用户提供不同的 MCP 工具集。</p>
<h2 data-id="heading-1">私有化部署</h2>
<h3 data-id="heading-2">Higress</h3>
<p>Higress 支持三种部署方式：Helm、docker compose 和基于 all-in-one 的 docker 镜像进行部署。Higress 官方推荐使用 Helm 的方式进行生产环境的部署，将依赖的模块部署在不同的 pod 上。而因上述环境原因，这里选择使用第三种基于 all-in-one 的 docker 镜像 Dockerfile <strong>[</strong> <strong>1]</strong> 进行部署，将 Higress 依赖的组件以进程的方式部署在同一 pod 上面，通过多副本的方式实现服务高可用，也实现了对 K8s 集群 Ingress 的无侵入式部署。</p>
<p>我们先尝试直接引用 docker 镜像进行部署时，会报 WASM 的插件错误，查看报错信息是通过 oci 地址去下载 WASM 插件的时候出现了问题。同时 Higress 实现 MCP 功能也依赖了 WASM 插件，这是一个绕不开的问题。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">FROM</span> higress<span class="hljs-operator">-</span>registry.cn<span class="hljs-operator">-</span>hangzhou.cr.aliyuncs.com<span class="hljs-operator">/</span>higress<span class="hljs-operator">/</span><span class="hljs-keyword">all</span><span class="hljs-operator">-</span><span class="hljs-keyword">in</span><span class="hljs-operator">-</span><span class="hljs-keyword">one</span>:latest
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1242b0ea9ed342978a58e041aad988b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=p7%2BTDqnxe1fKmLCkkM2HaXQthOU%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-3">WASM 插件独立部署</h4>
<p>Higress 的 plugin-server <strong>[</strong> <strong>2]</strong> 项目就是为了“解决私有化部署 Higress 网关时拉取插件的痛点，优化了插件的下载与管理效率”，使 Higress 通过 http 的方式去下载独立部署的插件库，而不是通过 oci 去访问外部公开仓库，避免因网络问题导致插件拉取不下来。解决过程主要分为以下三个步骤：</p>
<p><strong>1）私有化部署 plugin-server</strong></p>
<pre><code class="hljs language-bash" lang="bash">FROM higress-registry.cn-hangzhou.cr.aliyuncs.com/higress/plugin-server:1.0.0
</code></pre>
<p><strong>2）为 plugin-server 集群申请 K8s Service（Cluster IP）</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">higress-plugin-server</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">higress-system</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">higress-plugin-server</span>
    <span class="hljs-attr">higress:</span> <span class="hljs-string">higress-plugin-server</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
  <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">higress-plugin-server</span>
    <span class="hljs-attr">higress:</span> <span class="hljs-string">higress-plugin-server</span>
</code></pre>
<p>K8s 集群内置的 DNS 为此创建的域名解析记录的格式为 <code>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code>。</p>
<p>在没有 K8s 的场景下也可以为 plugin-server 集群申请内网 VIP 或者 SLB 做好服务发现和负载均衡。</p>
<p><strong>3）修改 Higress 内置插件下载地址</strong></p>
<p>依照 github 中的示例，在基于 Higress 镜像的项目 Dockerfile 中声明插件的下载地址。这里有个地方需要注意下，readme 中给出的示例是环境变量的格式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deef89984e3f456b86d4fa4f4bb6c730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=FJYl%2FgFANq4CkQ%2F4hLb1ea6osNs%3D" alt="图片" loading="lazy"/></p>
<p>在 Dockerfile 中声明需要转义一下，${name}/${version} 的形式才可以被正确解析。</p>
<pre><code class="hljs language-bash" lang="bash">...
<span class="hljs-comment"># 模版</span>
ENV HIGRESS_ADMIN_WASM_PLUGIN_CUSTOM_IMAGE_URL_PATTERN=http://[申请的k8s service地址]/plugins/\<span class="hljs-variable">${name}</span>/\<span class="hljs-variable">${version}</span>/plugin.wasm
<span class="hljs-comment"># mcp wasm 插件下载地址</span>
ENV MCP_SERVER_WASM_IMAGE_URL=http://[申请的k8s service地址]/plugins/mcp-server/1.0.0/plugin.wasm
...
</code></pre>
<p>配置完独立的插件 HTTP 下载地址后重新部署，在服务器上可以看到 8080 端口以及 8443 端口可以被正常监听，说明 Higress 具备代理和网关功能的核心数据面组件已经可以正常服务了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50a78e0794714d30956da299515be560~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=OPioOJxDmJ%2Bnku7okYzm%2FQYjhw8%3D" alt="图片" loading="lazy"/></p>
<p>解决完 WASM 插件下载问题，基于 docker 镜像的 Higress 服务就可以被成功拉起并运行了。只不过基于这种模式部署的<strong>每个 pod 都是独立、对等、包含全部组件、功能完整的 Higress 服务，需要通过多副本的方式实现高可用。</strong></p>
<p>这种部署模式下，通过 Higress 自身集成的控制台去运维服务&amp;更改配置是不现实的，只能操作一台实例的配置变更，无法让实例间进行配置同步。因此在这种模式下的缺点是，只能通过在项目代码中维护配置文件，需要更改时走发布流程，将配置发布到每台实例上面。不过在我们这个场景下，需要变更配置的情况不多。</p>
<h4 data-id="heading-4">粘性会话</h4>
<p>在 MCP SSE 通信方式下，天然需要解决粘性会话的问题，Higress 基于 Redis 帮我们解决了这个问题。提前部署好 Redis 实例之后，打开 Higress 的 MCP 功能，并将 Redis 配置更新进去，重新部署一下就可以使用 MCP 的功能了。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">...</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">higress:</span> <span class="hljs-string">|-</span>
    <span class="hljs-attr">mcpServer:</span>
      <span class="hljs-string">enable:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">sse_path_suffix:</span> <span class="hljs-string">/sse</span>
      <span class="hljs-attr">redis:</span>
        <span class="hljs-attr">address:</span> <span class="hljs-string">xxx.redis.zhangbei.rds.aliyuncs.com:6379</span>
        <span class="hljs-string">username:</span> <span class="hljs-string">""</span>
        <span class="hljs-string">password:</span> <span class="hljs-string">"xxx"</span>
        <span class="hljs-attr">db:</span> <span class="hljs-number">0</span>
<span class="hljs-string">...</span>
</code></pre>
<p>这份配置文件可以维护在自己的基于 Higress 镜像的项目中，在部署的时候将配置文件 COPY 到指定目录（这种部署模式下，所有的配置文件都应该这么做）。</p>
<pre><code class="hljs language-bash" lang="bash">...
<span class="hljs-comment"># custom config</span>
COPY config/configmaps/higress-config.yaml /data/configmaps/higress-config.yaml
COPY config/mcpbridges/default.yaml /data/mcpbridges/default.yaml
COPY config/secrets/higress-console.yaml /data/secrets/higress-console.yaml
RUN <span class="hljs-built_in">chmod</span> +x /data/configmaps/higress-config.yaml &amp;&amp; \
    <span class="hljs-built_in">chmod</span> +x /data/secrets/higress-console.yaml &amp;&amp; \
    <span class="hljs-built_in">chmod</span> +x /data/mcpbridges/*
...
</code></pre>
<p>当整个 MCP 网关搭建完并使用的时候，在 redis 上通过 PSUBSCRIBE mcp-server-sse:* 命令可以看到如下的调用信息。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f181283db3440f4881d64258ccd6e0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=aIZvWhrez%2Fk6fyxcAJMGlTj3kbk%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-5">自定义构建镜像</h4>
<p>官方构建出来的镜像一般会要求体积小，满足最小运行要求，所以很多功能其实并不集成在 Higress 的镜像中。如果你的企业有自己约定的通用镜像，或者是想在原本的基础上集成一些新的功能，如使用阿里云的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fcms%3Fspm%3Da1z389.11499242.0.0.65452413vvcY0e%26utm_content%3Dg_1000408141" target="_blank" title="https://www.aliyun.com/product/cms?spm=a1z389.11499242.0.0.65452413vvcY0e&amp;utm_content=g_1000408141" ref="nofollow noopener noreferrer">云监控</a>等功能，就需要根据 all-in-one 镜像的 Dockerfile 内容进行自定义构建。这里有个注意的点是，Higress 中的 envoy 模块要求的 glibc 是 2.18 及以上版本。</p>
<p>其实只需要将 Higress 的 Dockerfile 文件内容移植过来就行，然后<strong>再声明下独立部署的 WASM 插件下载地址</strong>，就能实现基于指定镜像进行 Higress 自定义构建打包部署了。</p>
<p>Higress 服务搭建好后，就可以走对外公网访问的流程了：（1）一个是绑定 8001 端口，通过 Higress 控制台进行查看相关配置的域名，限制为只允许内网访问。注：这种模式下无法通过控制台直接去更改配置；（2）另一个是绑定 8080 端口，对外提供 MCP 网关服务的域名。</p>
<p>完整的 Dockerfile 如下：</p>
<pre><code class="hljs language-bash" lang="bash">FROM [企业内部基础镜像]
<span class="hljs-comment"># 下面为 Higress all-in-one dockerfile中的内容</span>
ARG HUB=higress-registry.cn-hangzhou.cr.aliyuncs.com/higress
...
<span class="hljs-comment"># 模版</span>
ENV HIGRESS_ADMIN_WASM_PLUGIN_CUSTOM_IMAGE_URL_PATTERN=http://[申请的k8s service地址]/plugins/\<span class="hljs-variable">${name}</span>/\<span class="hljs-variable">${version}</span>/plugin.wasm
<span class="hljs-comment"># mcp wasm 插件下载地址</span>
ENV MCP_SERVER_WASM_IMAGE_URL=http://[申请的k8s service地址]/plugins/mcp-server/1.0.0/plugin.wasm
...
<span class="hljs-comment"># 注意 dockerfile 中会去 github 下载对应处理器架构下的 yq 模块，企业内网环境下可以提前下载下来</span>
COPY ./yq_linux_[<span class="hljs-built_in">arch</span>] /usr/local/bin/yq
...
<span class="hljs-comment"># custom config</span>
COPY config/configmaps/higress-config.yaml /data/configmaps/higress-config.yaml
COPY config/mcpbridges/default.yaml /data/mcpbridges/default.yaml
COPY config/secrets/higress-console.yaml /data/secrets/higress-console.yaml
RUN <span class="hljs-built_in">chmod</span> +x /data/configmaps/higress-config.yaml &amp;&amp; \
    <span class="hljs-built_in">chmod</span> +x /data/secrets/higress-console.yaml &amp;&amp; \
    <span class="hljs-built_in">chmod</span> +x /data/mcpbridges/*
...
</code></pre>
<h3 data-id="heading-6">Nacos</h3>
<p>Nacos 的部署相对简单，除了通过 kubectl 或者 nacos-operator 工具直接操作 K8s 集群部署外，还可以直接基于 nacos-server 的镜像进行部署 Dockerfile <strong>[</strong> <strong>3]</strong> 。因上文提到的内部环境问题，我们这里选择基于 nacos-server 的镜像，将服务部署于 K8s 集群上面。</p>
<pre><code class="hljs language-bash" lang="bash">FROM nacos-registry.cn-hangzhou.cr.aliyuncs.com/nacos/nacos-server:latest
</code></pre>
<h4 data-id="heading-7">集群模式部署</h4>
<p>Nacos 集群模式下使用的一致性协议是基于 Raft 实现的，因此最小需要部署 3 台实例。</p>
<p>在引用 nacos-server 镜像的 dockerfile 中，声明 cluster 的部署模式。我们查看 nacos 的启动脚本，发现在 peer-finder（插件）目录不存在的情况下，如果定义了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>A</mi><mi>C</mi><mi>O</mi><msub><mi>S</mi><mi>S</mi></msub><mi>E</mi><mi>R</mi><mi>V</mi><mi>E</mi><mi>R</mi><mi>S</mi><mtext>变量，会将</mtext></mrow><annotation encoding="application/x-tex">NACOS_SERVERS 变量，会将 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">CO</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.00773em;">ER</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">ERS</span><span class="mord cjk_fallback">变量，会将</span></span></span></span></span>NACOS_SERVERS 变量中的值写入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>L</mi><mi>U</mi><mi>S</mi><mi>T</mi><mi>E</mi><msub><mi>R</mi><mi>C</mi></msub><mi>O</mi><mi>N</mi><mi>F</mi><mtext>文件中，</mtext></mrow><annotation encoding="application/x-tex">CLUSTER_CONF 文件中，</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.10903em;">LU</span><span class="mord mathnormal" style="margin-right:0.05764em;">STE</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">ONF</span><span class="mord cjk_fallback">文件中，</span></span></span></span></span>CLUSTER_CONF 文件的默认路径是 /home/nacos/conf/cluster.conf，其中定义的就是 Nacos 集群的静态成员地址列表，它在集群首次启动时会被读取，用于告知每个节点“邻居”在哪，从而让它们能够互相发现、建立连接，并初始化 Raft 一致性协议。</p>
<pre><code class="hljs language-bash" lang="bash">...
PLUGINS_DIR=<span class="hljs-string">"/home/nacos/plugins/peer-finder"</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">print_servers</span></span>() {
   <span class="hljs-keyword">if</span> [[ ! -d <span class="hljs-string">"<span class="hljs-variable">${PLUGINS_DIR}</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> &gt;<span class="hljs-string">"<span class="hljs-variable">$CLUSTER_CONF</span>"</span>
    <span class="hljs-keyword">for</span> server <span class="hljs-keyword">in</span> <span class="hljs-variable">${NACOS_SERVERS}</span>; <span class="hljs-keyword">do</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$server</span>"</span> &gt;&gt;<span class="hljs-string">"<span class="hljs-variable">$CLUSTER_CONF</span>"</span>
    <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">else</span>
    bash <span class="hljs-variable">$PLUGINS_DIR</span>/plugin.sh
    <span class="hljs-built_in">sleep</span> 30
  <span class="hljs-keyword">fi</span>
}
...
</code></pre>
<p>因此我们可以在 Dockerfile 中维护当前集群下的 [实例 IP:端口] 列表，供 Nacos 集群启动时读取并初始化。</p>
<pre><code class="hljs language-ini" lang="ini">...
ENV <span class="hljs-attr">MODE</span>=cluster
ENV <span class="hljs-attr">NACOS_AUTH_TOKEN</span>=xxx
ENV <span class="hljs-attr">NACOS_AUTH_IDENTITY_KEY</span>=xxx
ENV <span class="hljs-attr">NACOS_AUTH_IDENTITY_VALUE</span>=xxx
ENV <span class="hljs-attr">NACOS_SERVERS</span>=<span class="hljs-string">"10.0.0.1:8848 10.0.0.2:8848 10.0.0.3:8848"</span>
<span class="hljs-comment"># nacos 用户名密码</span>
ENV <span class="hljs-attr">NACOS_USERNAME</span>=xxx
ENV <span class="hljs-attr">NACOS_PASSWORD</span>=xxx
...
</code></pre>
<h4 data-id="heading-8">实例间动态发现</h4>
<p>上面这种固定 IP 列表的方式<strong>缺点是显而易见的</strong>。它是一个静态的配置，当出现集群的扩缩容时，实例是没有办法自动去更新成员 IP 列表的，需要手动修改并发布，整个过程非常繁琐，严重情况下可能会影响线上服务的稳定性；且在云原生容器化背景下，IP 并不是固定的，随时有可能会因为故障迁移而改变 IP，维护静态 IP 列表与云原生的理念背道而驰。线上生产是完全不推荐这种方式的。</p>
<p>再回到上面 docker-startup.sh 脚本，可以通过 peer-finder 插件来实现集群间实例的发现，取代手动维护 cluster.conf 文件。peer-finder 插件运行依赖于 K8s 集群 Headless Service 域名，会去执行类似于 nslookup 命令查找 Service 下面的所有健康 Pod 的 IP 列表，类比于服务发现的能力 <strong>[</strong> <strong>4]</strong> ，这样就不用再手动去维护实例 IP 列表。</p>
<p>但是 peer-finder 的运行依赖于 StatefulSet 的实例部署模式，需要每个实例有固定的实例名。因为我们内部环境的限制，我们现在部署的都是无状态的实例，所以没有办法通过 peer-finder 来做这个事情。但是我们可以参照 peer-finder 脚本的实现思路，来自己写一个启动脚本。</p>
<p><strong>1）首先为 Nacos 集群申请 Headless 的 Service。</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-headless</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">mcp-nacos</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
    <span class="hljs-attr">nacos:</span> <span class="hljs-string">mcp-nacos</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">clusterIP:</span> <span class="hljs-string">None</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">peer-finder-port</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8848</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
  <span class="hljs-attr">sessionAffinity:</span> <span class="hljs-string">None</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b26974cc4274b4695cdd2fb29d07a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=dYG94x8clr71BpPPG4PWEy5VIFg%3D" alt="图片" loading="lazy"/></p>
<p><strong>2）这里修改下 nacos-docker 的启动脚本，提供一个简单的实现。（仅供参考）</strong></p>
<pre><code class="hljs language-bash" lang="bash">...
原docker-startup.sh内容
...
<span class="hljs-comment"># 新增内容</span>
<span class="hljs-comment"># 注释掉 JAVA启动命令</span>
<span class="hljs-comment"># exec $JAVA ${JAVA_OPT}</span>
<span class="hljs-built_in">export</span> JAVA_OPT <span class="hljs-comment"># export JAVA 启动参数，方面下面读取</span>
HEADLESS_SERVICE_FQDN=<span class="hljs-string">"xxx.svc.cluster.local"</span>
CLUSTER_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf"</span>
UPDATE_SCRIPT=<span class="hljs-string">"/home/nacos/bin/update-cluster.sh"</span> <span class="hljs-comment"># 原子更新脚本</span>
NACOS_START_CMD=<span class="hljs-string">"<span class="hljs-variable">$JAVA</span> <span class="hljs-variable">$JAVA_OPT</span>"</span>
<span class="hljs-comment"># 1. 动态创建 update-cluster.sh 脚本</span>
<span class="hljs-built_in">cat</span> &gt; <span class="hljs-variable">${UPDATE_SCRIPT}</span> &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e
NACOS_PORT=<span class="hljs-variable">${NACOS_APPLICATION_PORT:-8848}</span>
CLUSTER_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf"</span>
TMP_CONF_FILE=<span class="hljs-string">"/home/nacos/conf/cluster.conf.tmp"</span>
&gt; <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-comment"># 从标准输入读取 nslookup 的原始输出</span>
awk <span class="hljs-string">'
/^Name:/ { flag=1; next }
flag &amp;&amp; /^Address:/ { print $2; flag=0 }
'</span> | <span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r ip; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ip}</span>:<span class="hljs-variable">${NACOS_PORT}</span>"</span> &gt;&gt; <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 排序以确保文件内容的一致性，避免不必要的更新</span>
<span class="hljs-built_in">sort</span> -o <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-comment"># 只有在新旧配置不同时才执行更新</span>
<span class="hljs-comment"># 检查旧文件是否存在</span>
<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span> ] || ! cmp -s <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][update-script] Peer list changed. Updating config."</span>
    <span class="hljs-built_in">mv</span> <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][update-script] cluster.conf updated:"</span>
    <span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">rm</span> <span class="hljs-string">"<span class="hljs-variable">${TMP_CONF_FILE}</span>"</span>
<span class="hljs-keyword">fi</span>
EOF
<span class="hljs-built_in">chmod</span> +x <span class="hljs-variable">${UPDATE_SCRIPT}</span>
<span class="hljs-comment"># 2. 启动前的初始化循环</span>
MAX_INIT_RETRIES=30
RETRY_COUNT=0
MIN_PEERS=3 <span class="hljs-comment"># 期望的集群最小副本数量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[INFO] Initializing cluster config. Waiting for at least <span class="hljs-variable">${MIN_PEERS}</span> peers to be available..."</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># 直接将 nslookup 的输出通过管道传给更新脚本</span>
  nslookup <span class="hljs-string">"<span class="hljs-variable">${HEADLESS_SERVICE_FQDN}</span>"</span> | <span class="hljs-variable">${UPDATE_SCRIPT}</span>
  <span class="hljs-comment"># 检查生成的配置文件行数</span>
  LINE_COUNT=$(<span class="hljs-built_in">wc</span> -l &lt; <span class="hljs-string">"<span class="hljs-variable">${CLUSTER_CONF_FILE}</span>"</span>)
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${LINE_COUNT}</span>"</span> -ge <span class="hljs-string">"<span class="hljs-variable">${MIN_PEERS}</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[INFO] Initial cluster.conf is ready with <span class="hljs-variable">${LINE_COUNT}</span> peers."</span>
    <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">fi</span>
  RETRY_COUNT=$((RETRY_COUNT+<span class="hljs-number">1</span>))
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${RETRY_COUNT}</span>"</span> -gt <span class="hljs-string">"<span class="hljs-variable">${MAX_INIT_RETRIES}</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[WARN] Could not find <span class="hljs-variable">${MIN_PEERS}</span> peers after <span class="hljs-variable">${MAX_INIT_RETRIES}</span> retries. Starting with <span class="hljs-variable">${LINE_COUNT}</span> peers found."</span>
    <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"[INFO] Found <span class="hljs-variable">${LINE_COUNT}</span> peers. Waiting for more... Retrying in 5 seconds."</span>
  <span class="hljs-built_in">sleep</span> 5
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 3. 在后台启动我们自己的监控循环</span>
(
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sleep</span> 15 <span class="hljs-comment"># 每 15 秒检查一次</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>][monitor] Checking for peer updates..."</span>
    nslookup <span class="hljs-string">"<span class="hljs-variable">${HEADLESS_SERVICE_FQDN}</span>"</span> | <span class="hljs-variable">${UPDATE_SCRIPT}</span>
  <span class="hljs-keyword">done</span>
) &amp;
<span class="hljs-comment"># 4. 启动 Nacos 主进程</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[INFO] Starting Nacos server..."</span>
<span class="hljs-built_in">exec</span> sh -c <span class="hljs-string">"<span class="hljs-variable">${NACOS_START_CMD}</span>"</span>
</code></pre>
<p>这样我们 cluster.conf 文件中的成员 IP 列表就实现了自动更新。</p>
<p>线上生产环境还是推荐使用有状态 StatefulSet 的部署模式，并结合 peer-finder 的能力实现实例间的互相发现。而不是用无状态的实例，自己去写脚本实现。后续我们也会升级到 StatefulSet 的模式进行部署。</p>
<h4 data-id="heading-9">配置外置 Mysql</h4>
<p>在集群部署模式下，就无法使用 Nacos 内置的不支持数据共享的 Derby 数据库，需要配置外置的 Mysql 数据库。提前部署好 Mysql 实例之后，按照 Nacos 中的 mysql-schema.sql <strong>[</strong> <strong>5]</strong> 数据库配置文件将表初始化，再将 mysql 配置信息写入 Dockerfile 中即可。</p>
<pre><code class="hljs language-ini" lang="ini">...
<span class="hljs-comment"># mysql config</span>
ENV <span class="hljs-attr">SPRING_DATASOURCE_PLATFORM</span>=mysql
ENV <span class="hljs-attr">MYSQL_DATABASE_NUM</span>=<span class="hljs-number">1</span>
ENV <span class="hljs-attr">MYSQL_SERVICE_HOST</span>=xxx.mysql.zhangbei.rds.aliyuncs.com
ENV <span class="hljs-attr">MYSQL_SERVICE_PORT</span>=<span class="hljs-number">3306</span>
ENV <span class="hljs-attr">MYSQL_SERVICE_DB_NAME</span>=nacos
ENV <span class="hljs-attr">MYSQL_SERVICE_USER</span>=xxx
ENV <span class="hljs-attr">MYSQL_SERVICE_PASSWORD</span>=xxx
...
</code></pre>
<p>在为 Nacos 做服务暴露的时候，只需要暴露 Nacos 控制台的 8080 端口，且限制为只允许内网访问即可。因为 Nacos 只是内部作为维护管理 MCP 工具元数据信息的 MCP Registry 使用，对用户侧不感知；且 Higress 和 Nacos 都部署在内网的 K8s 集群上面，内部通信通过 K8s 的 Service 即可，无需将 Nacos 的 8848 端口暴露给公网。</p>
<h4 data-id="heading-10">申请 K8s Service 供 Higress 使用</h4>
<p>注意 Higress 拉取/订阅 Nacos 中的配置会通过 gRPC 的方式调用，这里的 Service 需要<strong>暴露 8848 和 9848 两个端口</strong>给 Higress 使用。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">pre-oss-mcp-nacos-endpoint</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">aso-oss-mcp-nacos</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">mcp-nacos</span>
    <span class="hljs-attr">nacos:</span> <span class="hljs-string">mcp-nacos</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subscribe-port</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8848</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">grpc-port</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">9848</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9848</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
</code></pre>
<p>同理，如果想使用企业内部的镜像，或者是想在原本的基础上即成一些新的功能，如使用阿里云的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fcms%3Fspm%3Da1z389.11499242.0.0.65452413vvcY0e%26utm_content%3Dg_1000408141" target="_blank" title="https://www.aliyun.com/product/cms?spm=a1z389.11499242.0.0.65452413vvcY0e&amp;utm_content=g_1000408141" ref="nofollow noopener noreferrer">云监控</a>等功能，也可根据 Nacos 的 Dockerfile 进行自定义构建部署。</p>
<h2 data-id="heading-11">鉴权</h2>
<p>Higress 自身提供了丰富的鉴权 <strong>[6</strong> <strong>]</strong> 能力，如果你的企业本身就基于 Higress 搭建了自己的网关并使用了 Higress 提供的鉴权能力，这种场景下直接复用原来的方案即可。</p>
<p>另一种场景下，企业中会有多个服务 Provider，每个 Provider 有不同的鉴权方式。如下图所示，某个服务提供者会通过拦截器对请求中携带的用户 Cookie 进行 RAM 鉴权；另一个服务提供者会通过 tengine lua 脚本对请求进行自定义鉴权；以及后续注册的服务可能有其他的鉴权方式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7acd4931beee4a66a5895d49856ed06f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=FlCLlI37yu7YtkE37sOHQtRox18%3D" alt="图片" loading="lazy"/></p>
<p>一方面，我们并不希望使用 Higress 的鉴权能力去覆盖全部的鉴权场景，开发维护成本过高，我们优先考虑直接复用服务提供者已有的鉴权能力；另一方面，如果通过网关层鉴权需要将 AK 或者认证信息存放在 Higress 服务上，在安全层面也不是一个合适的做法。</p>
<p>这里推荐的做法是直接在 MCP 工具调用的时候，将鉴权信息透传给服务提供者，让服务提供者完成鉴权。</p>
<h2 data-id="heading-12">MCP 验证</h2>
<p>根据文档 <strong>[</strong> <strong>7]</strong> 中的操作示例，我们可以简单做个全链路测试验证。主要分为以下三步：</p>
<p><strong>1）在 Nacos 中注册服务，并配置 MCP 工具的元数据信息：</strong></p>
<p>在 public 命名空间下，创建服务信息。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cce81e87f4424e99a857611e3a2859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=rocIeygmJaZ561pnlMZWFcJzTuY%3D" alt="图片" loading="lazy"/></p>
<p>在机器上将自己的服务作为永久实例注册进去。（这里为了快速验证黑屏登陆机器操作，线上生产环境还是须要白屏操作）</p>
<pre><code class="hljs language-ini" lang="ini">curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance?<span class="hljs-attr">namespaceId</span>=[namespace]&amp;serviceName=[service_name]&amp;groupName=[group_name]&amp;ip=[服务域名]&amp;port=[服务端口]&amp;ephemeral=<span class="hljs-literal">false</span><span class="hljs-string">'
</span></code></pre>
<p>注册完之后，就能在 Nacos 控制台上看到注册的服务配置以及健康状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be0472e03b74a07bbd388c7c1d92e98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=fCfGlWrsNMz2SKZaOssffGrhkes%3D" alt="图片" loading="lazy"/></p>
<p>接着在 Nacos 控制台上配置 MCP 工具，添加一个简单工具，可以选择一个无参数 GET 接口，并发布。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0605c476a54633aa18f22b8a6c70ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=X%2Bc%2FOXLZPSJHclqTUgq1Rc3RTIY%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c08d19a2f86d40f6ac93ff1fbd120dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=LsC7KHhRH3Tzr5d99BDORRis73w%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"requestTemplate"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/xxx/list.json"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GET"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"argsToUrlParam"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"responseTemplate"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{{.}}"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2）在 Higress 中配置 MCP Nacos 的服务来源：</strong></p>
<p>这里为了快速测试关闭了 Nacos 的认证，线上环境建议开启 Nacos 的认证。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31950e12263e4c80b2ac2b9391c6a910~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=CY1pfDkMjfCyzh1RzzQzDOj4E3g%3D" alt="图片" loading="lazy"/></p>
<p><strong>3）在 Cursor/Cherry Studio 中配置对外暴露的 Higress 服务地址和 uri，即可使用 MCP 工具：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb0c06bc1fe04cb89931c0c337d67e1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=6Smx6MVRHg56dTsEO%2FKlNEPzqjk%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc7470b810164f83b9b8ca7d89834aae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=jvOuwgiMFNhQsb9FDi99mP73GPA%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-13">设计图</h2>
<h3 data-id="heading-14">容灾架构</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e48188f92d884ebd9159719acf34ae38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=n2kgUuKswot4UITM1wakegf0nBI%3D" alt="图片" loading="lazy"/></p>
<p>进入浏览器查看原图：<a href="https://link.juejin.cn?target=https%3A%2F%2Fimg.alicdn.com%2Fimgextra%2Fi2%2FO1CN0138v82b1L7vNY3RQdo_!!6000000001253-2-tps-6507-5451.png" target="_blank" title="https://img.alicdn.com/imgextra/i2/O1CN0138v82b1L7vNY3RQdo_!!6000000001253-2-tps-6507-5451.png" ref="nofollow noopener noreferrer">img.alicdn.com/imgextra/i2…</a></p>
<p>在整个 MCP 网关中，通过 uri 来路由不同的 MCP 工具，实现工具的隔离。</p>
<h3 data-id="heading-15">逻辑模块图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58740208297546f9bb5f91a6f3fea541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=dcBqJ0pPEgGf9I085GFIzeU9Vgc%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-16">时序图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c3feed715ef439ab853acdd4f56d7d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765870494&amp;x-signature=zwI7xElEp5JbbY6cAc8fSIrdR3g%3D" alt="图片" loading="lazy"/></p>
<p><strong>附录：</strong></p>
<p>[1] 基于 all-in-one 的 docker 镜像</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhigress-standalone%2Fblob%2Fmain%2Fall-in-one%2FDockerfile" target="_blank" title="https://github.com/higress-group/higress-standalone/blob/main/all-in-one/Dockerfile" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[2] higress-plugin-server</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnkirito.moe%2Fhigress-plugin-server%2F" target="_blank" title="https://www.cnkirito.moe/higress-plugin-server/" ref="nofollow noopener noreferrer">www.cnkirito.moe/higress-plu…</a></p>
<p>[3] 基于 nacos-server 的镜像进行部署</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnacos-group%2Fnacos-docker%2Fblob%2Fmaster%2Fbuild%2FDockerfile" target="_blank" title="https://github.com/nacos-group/nacos-docker/blob/master/build/Dockerfile" ref="nofollow noopener noreferrer">github.com/nacos-group…</a></p>
<p>[4] 脚本源码</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkmodules%2Fpeer-finder%2Fblob%2Fmaster%2Fpeer-finder.go" target="_blank" title="https://github.com/kmodules/peer-finder/blob/master/peer-finder.go" ref="nofollow noopener noreferrer">github.com/kmodules/pe…</a></p>
<p>[5] mysql-schema.sql</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fnacos%2Fblob%2Fdevelop%2Fdistribution%2Fconf%2Fmysql-schema.sql" target="_blank" title="https://github.com/alibaba/nacos/blob/develop/distribution/conf/mysql-schema.sql" ref="nofollow noopener noreferrer">github.com/alibaba/nac…</a></p>
<p>[6] Higress 提供丰富鉴权能力</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhigress.cn%2Fdocs%2Flatest%2Fplugins%2Fauthentication%2Fbasic-auth%2F" target="_blank" title="https://higress.cn/docs/latest/plugins/authentication/basic-auth/" ref="nofollow noopener noreferrer">higress.cn/docs/latest…</a></p>
<p>[7] <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUzNzYxNjAzMg%3D%3D%26mid%3D2247575770%26idx%3D1%26sn%3Dca41d8dade57fcf378e1f7c5a5e0dca5%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUzNzYxNjAzMg==&amp;mid=2247575770&amp;idx=1&amp;sn=ca41d8dade57fcf378e1f7c5a5e0dca5&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">基于 Nacos + Higress  的 MCP 开发新范式，手把手教程来了！</a></p>
<p>[8] <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU0MzkyMTgzNg%3D%3D%26mid%3D2247486505%26idx%3D1%26sn%3Db61997531cce196d0b7fc46f79a003be%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU0MzkyMTgzNg==&amp;mid=2247486505&amp;idx=1&amp;sn=b61997531cce196d0b7fc46f79a003be&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Nacos 3.0 正式发布：MCP Registry、安全零信任、链接更多生态</a></p>
<p>[9] 修改内置插件的镜像地址</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhigress.cn%2Fdocs%2Flatest%2Fops%2Fhow-tos%2Fbuiltin-plugin-url%2F" target="_blank" title="https://higress.cn/docs/latest/ops/how-tos/builtin-plugin-url/" ref="nofollow noopener noreferrer">higress.cn/docs/latest…</a></p>
<p>[10] Nacos 集群模式</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnacos.io%2Fdocs%2Flatest%2Fmanual%2Fadmin%2Fdeployment%2Fdeployment-cluster%2F" target="_blank" title="https://nacos.io/docs/latest/manual/admin/deployment/deployment-cluster/" ref="nofollow noopener noreferrer">nacos.io/docs/latest…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UModel 查询：驯服“可观测性混乱”，阿里云的图模型建模利器！]]></title>    <link>https://juejin.cn/post/7581097545670524947</link>    <guid>https://juejin.cn/post/7581097545670524947</guid>    <pubDate>2025-12-08T08:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097545670524947" data-draft-id="7580616979473252358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UModel 查询：驯服“可观测性混乱”，阿里云的图模型建模利器！"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-12-08T08:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UModel 查询：驯服“可观测性混乱”，阿里云的图模型建模利器！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T08:26:00.000Z" title="Mon Dec 08 2025 08:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1AWSxBqEtQ%2F" target="_blank" title="https://www.bilibili.com/video/BV1AWSxBqEtQ/" ref="nofollow noopener noreferrer">点击此处，立即查看视频课程！</a></p>
<h2 data-id="heading-0">背景</h2>
<p>想象一下，你站在一个巨大的图书馆里，这里有成千上万本书，但每本书的目录都散落在不同的房间里，而且每间房间的索引方式都不一样。当你想要找一本关于“服务调用”的书时，你需要在 APM 房间、K8s 房间、云资源房间之间来回奔波，还要记住每个房间不同的查找规则...</p>
<p>这就是很多企业在可观测性领域面临的真实困境。而 UModel 就像是为这个混乱的图书馆建立了一套统一的“智能管理系统”，让你能够轻松探索和理解整个知识图谱的结构。</p>
<h3 data-id="heading-1">1.1 UModel 是什么</h3>
<p>UModel 是一种基于图模型的可观测数据建模方法，旨在解决企业级环境中可观测数据采集、组织和利用的核心挑战。UModel 采用 Node（节点）和 Link（边）组成的图结构来描述 IT 世界，通过标准化的数据建模方式，实现可观测数据的统一表示、存储解耦和智能分析。</p>
<p>作为阿里云可观测体系的数据建模基础，UModel 为企业提供了一套通用的可观测“交互语言”，让人、程序和 AI 都能够理解和分析可观测数据，从而构建真正的全栈可观测能力。</p>
<h4 data-id="heading-2">核心概念</h4>
<p>UModel 采用图论的基本概念，使用 Node（节点）和 Link（边）组成有向图来描述 IT 系统：</p>
<ul>
<li>Node（节点）：核心部分为 Set（数据集），表示同类型实体或数据的集合，如 EntitySet（实体集）、MetricSet（指标集）、LogSet（日志集）等；此外还包含数据集的存储类型（Storage），如 SLS、Prometheus、MySQL 等</li>
<li>Link（关联）：表示 Node 之间的关系，如 EntitySetLink（实体关联）、DataLink（数据关联）、StorageLink（存储关联）等</li>
<li>Field（字段）：用于约束和描述 Set 和 Link 的属性，包含名称、类型、约束规则、分析特性等 20 多种配置项</li>
</ul>
<h3 data-id="heading-3">1.2 UModel 查询是什么</h3>
<p>UModel 查询是 EntityStore 中用于查询知识图谱元数据的专用查询接口，通过 <code>.umodel </code>查询语法，可以探索 EntitySet 定义、EntitySetLink 关系以及完整的知识图谱结构，为数据建模分析和 Schema 管理提供强大支持。</p>
<h4 data-id="heading-4">查询目标区分</h4>
<p>UModel 查询与其他查询类型的区别：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e81bee11eb148fab48965bc2638cd23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765787160&amp;x-signature=9MZwRdZeKJoIEH7d9KARJOznCps%3D" alt="图片" loading="lazy"/></p>
<p>UModel 查询专注于元数据层面的探索，帮助用户理解数据模型的结构和定义，而非具体的运行时数据。</p>
<h2 data-id="heading-5">UModel 查询</h2>
<h3 data-id="heading-6">2.1 数据模型</h3>
<h4 data-id="heading-7">数据结构</h4>
<p>UModel 查询返回的数据具有固定的五字段结构：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccdea893da9a4cbc9d915fc03aa74c3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765787160&amp;x-signature=%2BGPa%2BHguPhM4HkYA1X0SBII8s%2B4%3D" alt="图片" loading="lazy"/></p>
<p>注意：<code>metadata、schema</code>、<code>spec</code> 是 JSON 格式的 string，需要使用 <code>json_extract_scalar</code> 函数进行提取。</p>
<h4 data-id="heading-8">数据示例</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad1bf5346b1a431385b4a2cadd0b6d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765787160&amp;x-signature=w0ZDAJGkyyyN%2FyQuSIJEY4xH%2B1g%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-9">2.2 查询语法</h3>
<h4 data-id="heading-10">基础查询语法</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 基础查询格式</span>
.umodel <span class="hljs-operator">|</span> [SPL操作...]
<span class="hljs-comment">-- 带限制条件的查询</span>
.umodel <span class="hljs-operator">|</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">condition</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">|</span> limit <span class="hljs-operator">&lt;</span>count<span class="hljs-operator">&gt;</span>
</code></pre>
<h4 data-id="heading-11">核心查询模式</h4>
<h5 data-id="heading-12">1. List 场景 - 列表查询</h5>
<p>查询所有 UModel 数据：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-- 列出所有umodel数据（不建议使用）</span>
.umodel
<span class="hljs-deletion">-- 带分页的查询</span>
.umodel | limit 0, 10
</code></pre>
<p>按类型过滤：</p>
<pre><code class="hljs language-bash" lang="bash">-- 查询所有EntitySet定义
.umodel | <span class="hljs-built_in">where</span> kind = <span class="hljs-string">'entity_set'</span> | <span class="hljs-built_in">limit</span> 0, 10
-- 查询所有EntitySetLink定义
.umodel | <span class="hljs-built_in">where</span> kind = <span class="hljs-string">'entity_set_link'</span> | <span class="hljs-built_in">limit</span> 0, 10
-- 查询所有边类型（关系定义）
.umodel | <span class="hljs-built_in">where</span> __type__ = <span class="hljs-string">'link'</span> | <span class="hljs-built_in">limit</span> 0, 10
-- 查询所有节点类型（实体定义）
.umodel | <span class="hljs-built_in">where</span> __type__ = <span class="hljs-string">'node'</span> | <span class="hljs-built_in">limit</span> 0, 10
</code></pre>
<p>按属性过滤：</p>
<pre><code class="hljs language-bash" lang="bash">-- 查询特定名称的实体定义
.umodel | <span class="hljs-built_in">where</span> json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>) = <span class="hljs-string">'acs.ecs.instance'</span> | <span class="hljs-built_in">limit</span> 0, 10
-- 查询特定域的所有定义
.umodel | <span class="hljs-built_in">where</span> json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>) = <span class="hljs-string">'apm'</span> | <span class="hljs-built_in">limit</span> 0, 10
-- 查询多个域的定义
.umodel | <span class="hljs-built_in">where</span> json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>) <span class="hljs-keyword">in</span> (<span class="hljs-string">'acs'</span>, <span class="hljs-string">'apm'</span>, <span class="hljs-string">'k8s'</span>) | <span class="hljs-built_in">limit</span> 0, 10
</code></pre>
<h5 data-id="heading-13">2. 图计算场景 - 关系分析</h5>
<p>UModel 支持基于元数据的图计算，用于分析 EntitySet 之间的关系：</p>
<p>基础图查询语法：</p>
<pre><code class="hljs language-lua" lang="lua">.umodel | graph-<span class="hljs-built_in">match</span> &lt;<span class="hljs-built_in">path</span>&gt; project &lt;<span class="hljs-built_in">output</span>&gt;
</code></pre>
<p>基础概念：</p>
<p>在图查询中，有两个关键性的图概念：</p>
<p>节点类型，即 label 信息，在 UModel 的元数据图查询中，为 <code>&lt;domain&gt;@&lt;kind&gt;</code>，例如 <code>apm@entity_set</code>
节点 ID，即 <code>__entity_id__</code> 信息，在 UModel 的元数据图查询中，为 <code>kind::domain::name</code>，例如 <code>entity_set::apm::apm.service</code></p>
<p>图查询路径（PATH）使用 ASCII 字符描述关系方向：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/992db3f6a27d4e6bb3c9b1b89492762f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765787160&amp;x-signature=T09BDPNmUu3CZtxfjeZDsaTa4cE%3D" alt="图片" loading="lazy"/></p>
<p>查询 EntitySet 的邻居关系：</p>
<pre><code class="hljs language-css" lang="css">-- 查询特定EntitySet的所有关联关系
<span class="hljs-selector-class">.umodel</span> 
| graph-match (s:<span class="hljs-string">"acs@entity_set"</span> {__entity_id__: <span class="hljs-string">'entity_set::acs::acs.ecs.instance'</span>})
              -<span class="hljs-selector-attr">[e]</span>-(d) 
  project s, e, d | limit <span class="hljs-number">0</span>, <span class="hljs-number">10</span>
</code></pre>
<p>方向性关系查询：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 查询指向某个EntitySet的关系</span>
.umodel 
| graph-<span class="hljs-built_in">match</span> (s:<span class="hljs-string">"acs@entity_set"</span> {__entity_id__: <span class="hljs-string">'entity_set::acs::acs.ecs.instance'</span>})
              &lt;<span class="hljs-comment">--(d) </span>
  project s, d | limit <span class="hljs-number">0</span>, <span class="hljs-number">10</span>
<span class="hljs-comment">-- 查询从某个EntitySet出发的关系  </span>
.umodel 
| graph-<span class="hljs-built_in">match</span> (s:<span class="hljs-string">"acs@entity_set"</span> {__entity_id__: <span class="hljs-string">'entity_set::acs::acs.ack.cluster'</span>})
              <span class="hljs-comment">--&gt;(d) </span>
  project s, d | limit <span class="hljs-number">0</span>, <span class="hljs-number">10</span>
</code></pre>
<h3 data-id="heading-14">2.3 高级查询功能</h3>
<h4 data-id="heading-15">JSON 路径提取</h4>
<p>由于 UModel 数据采用 JSON 结构存储，需要使用 JSON 函数进行字段提取：</p>
<pre><code class="hljs language-ini" lang="ini">-- 提取基础信息
.umodel 
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">entity_domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>),
    <span class="hljs-attr">entity_description</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.description.zh_cn'</span>)
| project entity_name, entity_domain, entity_description | limit 0, 100
</code></pre>
<h4 data-id="heading-16">复杂条件筛选</h4>
<pre><code class="hljs language-java" lang="java">-- 多条件组合查询
.umodel 
| <span class="hljs-type">where</span> <span class="hljs-variable">kind</span> <span class="hljs-operator">=</span> <span class="hljs-string">'entity_set'</span>
  and <span class="hljs-title function_">json_extract_scalar</span><span class="hljs-params">(metadata, <span class="hljs-string">'$.domain'</span>)</span> in (<span class="hljs-string">'apm'</span>, <span class="hljs-string">'k8s'</span>)
  and <span class="hljs-title function_">json_array_length</span><span class="hljs-params">(json_extract(spec, <span class="hljs-string">'$.fields'</span>)</span>) &gt; <span class="hljs-number">5</span>
| <span class="hljs-type">extend</span> 
    <span class="hljs-variable">entity_name</span> <span class="hljs-operator">=</span> json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    field_count = json_array_length(json_extract(spec, <span class="hljs-string">'$.fields'</span>))
| sort field_count desc
| limit <span class="hljs-number">20</span>
</code></pre>
<h4 data-id="heading-17">聚合分析</h4>
<pre><code class="hljs language-ini" lang="ini">-- 按域统计EntitySet数量
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
| extend <span class="hljs-attr">domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>)
| stats <span class="hljs-attr">entity_count</span> = count() by domain
| sort entity_count desc
</code></pre>
<h3 data-id="heading-18">2.4 性能优化建议</h3>
<h4 data-id="heading-19">使用精确过滤</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化前：范围过大</span>
.umodel <span class="hljs-operator">|</span> <span class="hljs-keyword">where</span> json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>) <span class="hljs-keyword">like</span> <span class="hljs-string">'%service%'</span>
<span class="hljs-comment">-- 优化后：精确匹配</span>
.umodel <span class="hljs-operator">|</span> <span class="hljs-keyword">where</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'entity_set'</span> 
  <span class="hljs-keyword">and</span> json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>) <span class="hljs-operator">=</span> <span class="hljs-string">'apm'</span>
  <span class="hljs-keyword">and</span> json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>) <span class="hljs-operator">=</span> <span class="hljs-string">'apm.service'</span>
</code></pre>
<h4 data-id="heading-20">过滤前置</h4>
<pre><code class="hljs language-ini" lang="ini">-- 优化前：后期过滤
.umodel 
| extend <span class="hljs-attr">name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>)
| where <span class="hljs-attr">name</span> = <span class="hljs-string">'apm.service'</span>
-- 优化后：过滤前置
.umodel 
| where json_extract_scalar(metadata, '$.name') = 'apm.service'
| extend <span class="hljs-attr">name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>)
</code></pre>
<h4 data-id="heading-21">图查询优化</h4>
<pre><code class="hljs language-scss" lang="scss">-- 优化前：全图搜索
<span class="hljs-selector-class">.umodel</span> | graph-match (s)-<span class="hljs-selector-attr">[e]</span><span class="hljs-built_in">-</span>(d) project s, e, d
-- 优化后：指定起始点
<span class="hljs-selector-class">.umodel</span> 
| graph-match (s:"apm@entity_set" {__entity_id__: 'entity_set::apm::apm.service'})
              -<span class="hljs-selector-attr">[e]</span><span class="hljs-built_in">-</span>(d) 
  project s, e, d
</code></pre>
<h2 data-id="heading-22">UModel 查询具体应用场景</h2>
<p>UModel 查询在实际应用中能够解决多种场景下的问题，为数据建模、Schema 管理和知识图谱分析提供强大支持。</p>
<h3 data-id="heading-23">3.1 Schema 探索与发现</h3>
<h4 data-id="heading-24">场景描述</h4>
<p>在大型可观测性系统中，可能存在数百个 EntitySet 定义，分布在不同的域（domain）中。用户需要快速了解系统中定义了哪些实体类型，以及它们的基本信息。</p>
<h4 data-id="heading-25">应用示例</h4>
<p>探索所有实体类型：</p>
<pre><code class="hljs language-ini" lang="ini">-- 列出所有EntitySet及其基本信息
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">entity_domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>),
    <span class="hljs-attr">description</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.description.zh_cn'</span>)
| project entity_name, entity_domain, description
| sort entity_domain, entity_name
| limit 0, 100
</code></pre>
<p>按域分类查看：</p>
<pre><code class="hljs language-ini" lang="ini">-- 查看特定域（如APM）下的所有实体定义
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span> 
  and json_extract_scalar(metadata, '$.domain') = 'apm'
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">description</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.short_description.zh_cn'</span>)
| project entity_name, description
| limit 0, 50
</code></pre>
<h3 data-id="heading-26">3.2 数据建模分析</h3>
<h4 data-id="heading-27">场景描述</h4>
<p>在进行数据建模优化时，需要分析现有 EntitySet 的字段复杂度、主键设计、索引配置等信息，以便识别需要优化的模型。</p>
<h4 data-id="heading-28">应用示例</h4>
<p>分析字段复杂度：</p>
<pre><code class="hljs language-ini" lang="ini">-- 分析各域下EntitySet的字段数量分布
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
| extend 
    <span class="hljs-attr">domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>),
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">field_count</span> = json_array_length(json_extract(spec, <span class="hljs-string">'$.fields'</span>))
| stats 
    <span class="hljs-attr">avg_fields</span> = avg(field_count),
    <span class="hljs-attr">max_fields</span> = max(field_count),
    <span class="hljs-attr">min_fields</span> = min(field_count),
    <span class="hljs-attr">entity_count</span> = count()
  by domain
| sort entity_count desc
</code></pre>
<p>查找复杂实体：</p>
<pre><code class="hljs language-ini" lang="ini">-- 找出字段数量最多的EntitySet（可能需要优化）
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>),
    <span class="hljs-attr">field_count</span> = json_array_length(json_extract(spec, <span class="hljs-string">'$.fields'</span>))
| sort field_count desc
| limit 20
</code></pre>
<h3 data-id="heading-29">3.3 关系图谱分析</h3>
<h4 data-id="heading-30">场景描述</h4>
<p>理解 EntitySet 之间的关系对于构建完整的知识图谱至关重要。通过图查询可以分析实体间的关联关系，发现数据模型中的依赖和连接。</p>
<h4 data-id="heading-31">应用示例</h4>
<p>查询实体的所有关联关系：</p>
<pre><code class="hljs language-css" lang="css">-- 查询某个EntitySet（如apm<span class="hljs-selector-class">.service</span>）的所有关联关系
<span class="hljs-selector-class">.umodel</span> 
| graph-match (s:<span class="hljs-string">"apm@entity_set"</span> {__entity_id__: <span class="hljs-string">'entity_set::apm::apm.service'</span>})
              -<span class="hljs-selector-attr">[e]</span>-(d) 
  project s, e, d
| limit <span class="hljs-number">0</span>, <span class="hljs-number">50</span>
</code></pre>
<p>分析关系类型分布：</p>
<pre><code class="hljs language-ini" lang="ini">-- 统计不同关系类型的数量
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set_link'</span>
| extend 
    <span class="hljs-attr">link_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">link_type</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.link_type'</span>)
| stats <span class="hljs-attr">limk_count</span> = count() by link_type
| sort limk_count desc
</code></pre>
<p>查找特定关系：</p>
<pre><code class="hljs language-ini" lang="ini">-- 查找所有"runs_on"类型的关系定义
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set_link'</span>
  and json_extract_scalar(metadata, '$.link_type') = 'runs_on'
| extend 
    <span class="hljs-attr">link_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">source</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.source'</span>),
    <span class="hljs-attr">target</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.target'</span>)
| project link_name, source, target
</code></pre>
<h3 data-id="heading-32">3.4 元数据质量检查</h3>
<h4 data-id="heading-33">场景描述</h4>
<p>确保 UModel 元数据的完整性和一致性，检查缺失的描述、未定义的字段等问题。</p>
<h4 data-id="heading-34">应用示例</h4>
<p>检查缺失描述的 EntitySet：</p>
<pre><code class="hljs language-csharp" lang="csharp">-- 找出没有中文描述的EntitySet
.umodel 
| <span class="hljs-keyword">where</span> kind = <span class="hljs-string">'entity_set'</span>
  <span class="hljs-keyword">and</span> (json_extract_scalar(metadata, <span class="hljs-string">'$.description.zh_cn'</span>) = <span class="hljs-string">''</span> 
       <span class="hljs-function"><span class="hljs-keyword">or</span> <span class="hljs-title">json_extract_scalar</span>(<span class="hljs-params">metadata, <span class="hljs-string">'$.description.zh_cn'</span></span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)
| extend 
    entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    domain = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>)
| project entity_name, domain
</code></pre>
<p>验证字段定义完整性：</p>
<pre><code class="hljs language-csharp" lang="csharp">-- 检查没有定义字段的EntitySet
.umodel 
| <span class="hljs-keyword">where</span> kind = <span class="hljs-string">'entity_set'</span>
  <span class="hljs-keyword">and</span> (json_extract(spec, <span class="hljs-string">'$.fields'</span>) <span class="hljs-function"><span class="hljs-keyword">is</span> <span class="hljs-literal">null</span> 
       <span class="hljs-keyword">or</span> <span class="hljs-title">json_array_length</span>(<span class="hljs-params">json_extract(spec, <span class="hljs-string">'$.fields'</span></span>))</span> = <span class="hljs-number">0</span>)
| extend 
    entity_name = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    domain = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>)
| project entity_name, domain
</code></pre>
<h3 data-id="heading-35">3.5 跨域关联分析</h3>
<h4 data-id="heading-36">场景描述</h4>
<p>在复杂的可观测性系统中，不同域（如 APM、K8s、云资源）的实体可能存在关联关系。通过 UModel 查询可以分析这些跨域的关联模式。</p>
<h4 data-id="heading-37">应用示例</h4>
<p>查找跨域关系：</p>
<pre><code class="hljs language-ini" lang="ini">-- 查找连接不同域的EntitySetLink
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set_link'</span>
| extend 
    <span class="hljs-attr">link_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">source_domain</span> = json_extract_scalar(spec, <span class="hljs-string">'$.src.domain'</span>),
    <span class="hljs-attr">target_domain</span> = json_extract_scalar(spec, <span class="hljs-string">'$.dest.domain'</span>)
| where source_domain != target_domain
| project link_name, source_domain, target_domain
| limit 0, 50
</code></pre>
<p>分析域间连接度：</p>
<pre><code class="hljs language-ini" lang="ini">-- 统计各域之间的连接关系数量
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set_link'</span>
| extend 
    <span class="hljs-attr">source_domain</span> = json_extract_scalar(spec, <span class="hljs-string">'$.src.domain'</span>),
    <span class="hljs-attr">target_domain</span> = json_extract_scalar(spec, <span class="hljs-string">'$.dest.domain'</span>)
| stats <span class="hljs-attr">count</span> = count() by source_domain, target_domain
| sort count desc
</code></pre>
<h3 data-id="heading-38">3.6 版本与演进分析</h3>
<h4 data-id="heading-39">场景描述</h4>
<p>UModel Schema 会随着业务发展而演进，需要跟踪 Schema 的版本变化和演进历史。</p>
<h4 data-id="heading-40">应用示例</h4>
<p>查看 Schema 版本信息：</p>
<pre><code class="hljs language-ini" lang="ini">-- 查看所有EntitySet的Schema版本
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">schema_version</span> = json_extract_scalar(schema, <span class="hljs-string">'$.version'</span>),
    <span class="hljs-attr">schema_url</span> = json_extract_scalar(schema, <span class="hljs-string">'$.url'</span>)
| project entity_name, schema_version, schema_url
| limit 0, 100
</code></pre>
<h3 data-id="heading-41">3.7 快速定位与检索</h3>
<h4 data-id="heading-42">场景描述</h4>
<p>在大量元数据中快速找到特定的 EntitySet 或关系定义，支持模糊匹配和精确查询。</p>
<h4 data-id="heading-43">应用示例</h4>
<p>按名称模糊搜索：</p>
<pre><code class="hljs language-ini" lang="ini">-- 搜索包含"service"的EntitySet
.umodel 
| where <span class="hljs-attr">kind</span> = <span class="hljs-string">'entity_set'</span>
  and json_extract_scalar(metadata, '$.name') like '%service%'
| extend 
    <span class="hljs-attr">entity_name</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>),
    <span class="hljs-attr">domain</span> = json_extract_scalar(metadata, <span class="hljs-string">'$.domain'</span>)
| project entity_name, domain
| limit 0, 20
</code></pre>
<p>精确查找特定实体：</p>
<pre><code class="hljs language-bash" lang="bash">-- 精确查找特定EntitySet的完整定义
.umodel 
| <span class="hljs-built_in">where</span> json_extract_scalar(metadata, <span class="hljs-string">'$.name'</span>) = <span class="hljs-string">'apm.service'</span>
| <span class="hljs-built_in">limit</span> 1
</code></pre>
<h2 data-id="heading-44">总结</h2>
<p>UModel 查询作为 EntityStore 中专门用于查询知识图谱元数据的接口，为可观测性数据建模提供了强大的支持能力。通过 UModel 查询可以：</p>
<ol>
<li>探索 Schema 结构：快速了解系统中定义的所有实体类型和关系类型</li>
<li>分析数据模型：深入分析 EntitySet 的字段设计、主键配置、复杂度等</li>
<li>构建关系图谱：通过图查询分析实体间的关联关系，理解知识图谱的拓扑结构</li>
<li>质量检查：验证元数据的完整性和一致性</li>
<li>跨域分析：分析不同域之间的关联模式</li>
<li>快速检索：在大量元数据中快速定位目标定义</li>
</ol>
<p>这些能力使得 UModel 查询成为数据建模分析、Schema 管理和知识图谱探索的不可或缺的工具，为构建和维护高质量的可观测性数据模型提供了坚实的基础。</p>
<p>点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1AWSxBqEtQ%2F" target="_blank" title="https://www.bilibili.com/video/BV1AWSxBqEtQ/" ref="nofollow noopener noreferrer">此处</a>查看视频演示。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[搞定多模态微调只需一杯咖啡的时间？FC DevPod + Llama-Factory 极速实战]]></title>    <link>https://juejin.cn/post/7581678301215817728</link>    <guid>https://juejin.cn/post/7581678301215817728</guid>    <pubDate>2025-12-09T09:24:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581678301215817728" data-draft-id="7581664445240950799" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="搞定多模态微调只需一杯咖啡的时间？FC DevPod + Llama-Factory 极速实战"/> <meta itemprop="keywords" content="云计算,云原生"/> <meta itemprop="datePublished" content="2025-12-09T09:24:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Serverless社区"/> <meta itemprop="url" content="https://juejin.cn/user/1794004139382301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            搞定多模态微调只需一杯咖啡的时间？FC DevPod + Llama-Factory 极速实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1794004139382301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Serverless社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T09:24:47.000Z" title="Tue Dec 09 2025 09:24:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一个 AI 开发者，你一定经历过这样的绝望时刻： 兴致勃勃地下载了最新的 Qwen2-VL 权重，准备用自己的垂直领域数据跑一次 SFT（监督微调）。然而，现实却是残酷的——</p>
<ul>
<li><code>RuntimeError: CUDA out of memory</code> —— 显存不够，模型加载失败。</li>
<li><code>Driver/Library version mismatch</code> —— 驱动版本不对，环境配置陷入死循环。</li>
<li>看着云厂商 GPU 实例高昂的包月账单，犹豫着要不要为了这几小时的实验按下“购买”键。</li>
</ul>
<p>技术的进步本该是为了释放创造力，而不是增加门槛。在 Serverless 时代，算力应该像水电一样，扭开水龙头就有，关上就停，按需付费。</p>
<p>今天，我们将打破“微调=昂贵+麻烦”的刻板印象。不需要囤积显卡，也不需要精通运维，我们将带你体验一套“<strong>DevPod + Llama-Factory的极速组合拳</strong>”。</p>
<h3 data-id="heading-0">一、方案揭秘：FC + Llama-Factory 的“黄金搭档”</h3>
<p>工欲善其事，必先利其器。在开始实战之前，让我们先拆解一下这套“开箱即用”的微调流水线背后的三位主角。当它们在 Serverless 架构下相遇，复杂的模型训练就变成了一场流畅的搭积木游戏。</p>
<h4 data-id="heading-1">1. 主角：Qwen VL 模型 —— 多模态领域的“六边形战士”</h4>
<ul>
<li><strong>看得更清</strong>： 它不仅能识别图片中的物体，还能精准提取复杂的图表数据、阅读密集的文档文字（OCR），甚至理解长视频中的时序逻辑。</li>
<li><strong>懂你所想</strong>： 在指令遵循（Instruction Following）能力上大幅增强，这意味着通过微调，你可以更容易地让它学会你特定业务场景下的“行话”和规则。</li>
<li><strong>价值点</strong>： 选择 Qwen2-VL，意味着你的起点已经是行业顶尖水平，微调只是为了让它更懂你的私有数据。</li>
</ul>
<h4 data-id="heading-2">2. 工具：Llama-Factory —— 微调界的“瑞士军刀”</h4>
<p>对于许多开发者来说，微调最大的门槛不是不懂原理，而是不想写那几千行的 PyTorch 训练代码。Llama-Factory 的出现，完美解决了这个问题。</p>
<ul>
<li><strong>零代码门槛</strong>： 它提供了一个功能完备的 WebUI 界面。加载模型、配置参数、监控 Loss 曲线、评估效果，所有操作都可以在浏览器中通过点击完成。</li>
<li><strong>全流程覆盖</strong>： 从预训练（PT）、指令监督微调（SFT）到奖励模型训练（RM）和 PPO/DPO，它集成了业界最主流的微调方法（如 LoRA、QLoRA）。</li>
<li><strong>价值点</strong>： 它屏蔽了底层 DeepSpeed、Accelerate 等框架的复杂配置，让你能把精力集中在“数据质量”和“模型效果”上。</li>
</ul>
<h4 data-id="heading-3">3. 舞台：阿里云函数计算 FC —— 为 AI 而生的 Serverless 算力</h4>
<p>有了好模型和好工具，我们还需要一个能跑得动它们的“舞台”。传统的 GPU 服务器租赁模式往往面临“部署难、闲置贵”的尴尬，而 <strong>函数计算 FC</strong> 给出了全新的解法：</p>
<ul>
<li><strong>极致弹性，按量付费</strong>： 这是 Serverless 的灵魂。你只需要为训练的那几个小时付费。训练结束，实例可轻松释放，不再产生任何闲置费用。对于实验性质的微调任务，成本可以降低 50% 以上。</li>
<li><strong>环境预置，拒绝“配环境”</strong>： 我们在 FC 的应用中心预置了包含 CUDA、PyTorch 以及 Llama-Factory 依赖的官方镜像。这一步至关重要——它意味着你不需要处理任何驱动冲突，点击部署，环境即刻就绪。</li>
<li><strong>异构算力支持</strong>： FC 提供了丰富的 GPU 规格供你选择，满足不同规模的微调需求。</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920834972-bea889e5-125a-40b0-8c3d-f240f7ee45d7.png" alt="" loading="lazy"/></p>
<p><em>“当 Llama-Factory 的可视化交互遇上 FC 的极致弹性，微调 Qwen2-VL 就变成了一场‘点击即得’的流畅体验。我们不再需要像运维工程师一样盯着黑底白字的终端窗口，而是可以像修图师一样，在 Web 界面上优雅地打磨我们的模型。”</em></p>
<h3 data-id="heading-4">二、极速部署：5分钟搭建微调流水线</h3>
<p>传统微调的第一步通常是“租服务器、装驱动、配环境”，而在 Serverless 架构下，我们直接从“应用”开始。</p>
<p><strong>Step 1：DevPod 开发环境一键拉起</strong></p>
<p>登录 Function AI 控制台 - FunModel - 模型市场，点击页面的「自定义开发」，在「模型环境下」选择「自定义环境」，在容器镜像地址中填入 <code>serverless-registry.cn-hangzhou.cr.aliyuncs.com/functionai/devpod-presets:llama-factory-v0.9.4-v1</code>。该镜像已内置 llama-factory v0.9.4 的版本。</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764309769776-6be9d8e1-42bd-482e-934c-f4c1270a059a.png" alt="" loading="lazy"/></p>
<p><strong>Step 2：资源与存储配置（关键一步）</strong></p>
<p>只需关注 GPU 类型。对于 Qwen3-VL 的 LoRA 微调，推荐选择 GPU 性能型单卡即可满足需求，性价比极高。</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764309771303-bb94fc91-4553-4824-9e16-1aebd786bafb.png" alt="" loading="lazy"/></p>
<p><strong>Step 3：一键拉起环境，点击「DevPod 开发调试」</strong></p>
<p>FC 会自动拉取包含 CUDA 环境和 Llama-Factory 框架的镜像。大约等待 1-3 分钟，页面自动跳转到 DevPod 页面，我们进入 Terminal 下，执行命令 <code>USE_MODELSCOPE_HUB=1 lmf webui</code> 启动 llama-factory 的进程。</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764311554203-e01da0d8-41d7-413a-a475-5574bbbe597e.png" alt="" loading="lazy"/></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764904990655-635739b1-78ea-4d9c-b102-58f29333e330.png" alt="" loading="lazy"/></p>
<p>根据「快速访问」页签的提示，将 uri 中的 <code>{port}</code> 替换为 7860 即可（llama-factory 默认使用 7860 端口）。直接使用该 uri 在浏览器进行访问，进入 llama-factory 的 webui 界面。</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764311896481-61d3a02e-bc06-4376-b7e9-6d1ea0ba451f.png" alt="" loading="lazy"/></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764311983575-ac8fe220-6ffb-4c1a-a4cc-b63f3a1421ae.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">三、实战 SFT：像 P 图一样简单地微调模型</h3>
<p>打开 WebUI 界面，你会发现微调大模型并不比使用 Photoshop 复杂多少。我们不需要敲一行 Python 代码，只需在面板上进行“勾选”和“填空”。</p>
<p><strong>Step 1：模型与数据准备</strong></p>
<ul>
<li><strong>模型名称</strong>： 在下拉菜单中选择 <code>Qwen2-VL</code>（或手动输入模型路径）。</li>
<li><strong>数据集</strong>： Llama-Factory 支持标准的 Alpaca 格式或 ShareGPT 格式。对于多模态任务，确保你的 JSON 文件中包含图片路径。
<ul>
<li>操作： 在 WebUI 的“数据集”选项中选择准备好的数据集，本文的数据集路径如图所示：</li>
</ul>
</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764906712487-485f0c15-df14-4ef3-b93a-a967d71b9232.png" alt="" loading="lazy"/></p>
<p><strong>Step 2：参数配置（LoRA大法好）</strong>
为了在 Serverless 环境下高效微调，我们采用 <strong>LoRA (Low-Rank Adaptation)</strong> 技术。它只训练模型的一小部分参数，却能达到惊人的效果。</p>
<ul>
<li><strong>微调方法</strong>： 勾选 <code>full</code>。</li>
<li><strong>学习率 (Learning Rate)</strong>： 推荐 <code>1e-4</code> 或 <code>5e-5</code>。</li>
<li><strong>轮数 (Epochs)</strong>： 建议先设为 <code>3</code> 或 <code>5</code> 轮，快速验证效果。</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764919107775-84667310-a6a8-486b-81ce-3918aed478f6.png" alt="" loading="lazy"/></p>
<p><strong>Step 3：启动训练与监控</strong>
一切就绪，点击鲜艳的 <strong>“开始训练”</strong> 按钮。 界面下方会自动弹出日志窗口和 Loss（损失）曲线图。看着 Loss 曲线像滑梯一样稳步下降，代表模型正在努力学习你教给它的新知识。</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764907126625-4da053fa-0abb-4632-851b-9b245f8d8cdf.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">四、效果验证与模型导出：见证“专家”诞生</h3>
<p>看着 Loss 曲线收敛只是第一步，真正的考验在于：它真的变聪明了吗？Llama-Factory 贴心地集成了评估与推理模块，让我们能即时验收成果。</p>
<p><strong>Step 1：Chat 页签在线推理</strong>
训练完成后，无需重启服务，直接点击 WebUI 顶部的 <strong>“Chat”</strong> 页签。</p>
<ul>
<li><strong>检查点选择</strong>： 在 <code>Checkpoint</code> 下拉框中，选择刚才训练好的 Adapter 权重。</li>
<li><strong>加载模型</strong>： 点击“加载模型”，几秒钟后，右下角显示“模型加载成功”。</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920037265-e11f655b-19bb-4c0b-b062-1aaa7ac37219.png" alt="" loading="lazy"/></p>
<p><strong>Step 2：微调前后效果“大比武”</strong>
为了验证效果，我们上传一张特定业务场景的图片（例如一张复杂的报销单据），并输入同样的 Prompt：“请提取图中的关键信息”。</p>
<p>微调前：</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920105262-a2df3466-1da2-4c75-bd35-94a92e6b7a18.png" alt="" loading="lazy"/></p>
<p>微调后：</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920206458-2348ce56-3383-4031-98f3-72df874dcd98.png" alt="" loading="lazy"/></p>
<p>这就是 SFT 的魔力——让通用的天才变成垂直领域的专家。</p>
<p><strong>Step 3：模型导出与落地</strong>
验证满意后，点击 <strong>“Export”</strong> 页签。</p>
<ul>
<li><strong>最大分块大小</strong>： 建议设置为 <code>2GB</code> 或 <code>4GB</code>。</li>
<li><strong>导出目录</strong>： 指向你的 OSS 路径或者本地路径。 点击“开始导出”，Llama-Factory 会自动将 LoRA 权重与原始模型合并。现在，你拥有了一个完整的、可直接部署到生产环境的专属 Qwen2-VL 模型。</li>
</ul>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920371970-d03c2468-f7a6-4833-9b3f-9bdb39ba79ed.png" alt="" loading="lazy"/></p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/324184/1764920434175-366c54db-dead-4267-9a98-f9e2fc2afe39.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">五、结语：Serverless AI，让创新触手可及</h3>
<p>至此，我们只用了一杯咖啡的时间，就完成了从环境搭建、模型微调到效果验证的全流程。</p>
<p><strong>最后，让我们算一笔账</strong>： 如果你为了这次实验去租赁一台 L20 服务器，通常需要按月付费，成本可能高达数千元，且大部分时间显卡都在空转。 而在阿里云函数计算（FC）上，你只需要为训练的那 <strong>2 小时</strong> 付费。<strong>按量付费，用完即走，成本可能不到一杯奶茶钱。</strong></p>
<p><strong>Serverless GPU 的核心价值，不仅仅是省钱，更是“解放”。</strong> 它把开发者从繁琐的运维泥潭中解放出来，不再需要担心 CUDA 版本、显存溢出或资源闲置。你只需要关注最核心的资产——<strong>数据</strong>与<strong>创意</strong>。</p>
<p>多模态的时代已经到来，Qwen2-VL 的大门已经敞开。 现在，轮到你了。</p>
<h2 data-id="heading-8">了解函数计算模型服务 FunModel</h2>
<p>FunModel 是一个面向 AI 模型开发、部署与运维的全生命周期管理平台。您只需提供模型文件（例如来自 ModelScope、Hugging Face 等社区的模型仓库），即可利用 FunModel 的自动化工具快速完成模型服务的封装与部署，并获得可直接调用的推理 API。平台在设计上旨在提升资源使用效率并简化开发部署流程。</p>
<p>FunModel 依托 Serverless + GPU，天然提供了简单，轻量，0 门槛的模型集成方案，给个人开发者良好的玩转模型的体验，也让企业级开发者快速高效的部署、运维和迭代模型。</p>
<p>在阿里云 FunModel 平台，开发者可以做到：</p>
<ul>
<li><strong>模型的快速部署上线</strong>：从原来的以周为单位的模型接入周期降低到 5 分钟，0 开发，无排期</li>
<li><strong>一键扩缩容，让运维不再是负担</strong>：多种扩缩容策略高度适配业务流量，实现“无痛运维”</li>
</ul>
<p><strong>技术优势</strong></p>






























<table><thead><tr><th align="left">特性</th><th align="left">FunModel 实现机制</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">资源利用率</td><td align="left">采用 GPU 虚拟化与资源池化技术。</td><td align="left">该设计允许多个任务共享底层硬件资源，旨在提高计算资源的整体使用效率。</td></tr><tr><td align="left">实例就绪时间</td><td align="left">基于快照技术的状态恢复机制。</td><td align="left">实例启动时，可通过快照在毫秒级别恢复运行状态，从而将实例从创建到就绪的时间控制在秒级。</td></tr><tr><td align="left">弹性扩容响应</td><td align="left">结合预热资源池与快速实例恢复能力。</td><td align="left">当负载增加时，系统可以从预热资源池中快速调度并启动新实例，实现秒级的水平扩展响应。</td></tr><tr><td align="left">自动化部署耗时</td><td align="left">提供可一键触发的构建与部署流程。</td><td align="left">一次标准的部署流程（从代码提交到服务上线）通常可在 10 分钟内完成。</td></tr></tbody></table>
<h3 data-id="heading-9">更多内容请参考</h3>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Ffunctioncompute%2Ffc%2Fmodel-service-funmodel%2F" target="_blank" title="https://help.aliyun.com/zh/functioncompute/fc/model-service-funmodel/" ref="nofollow noopener noreferrer">模型服务FunModel 产品文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Ffunctioncompute%2Ffc%2Fquick-start" target="_blank" title="https://help.aliyun.com/zh/functioncompute/fc/quick-start" ref="nofollow noopener noreferrer">FunModel快速入门</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Ffunctioncompute%2Ffc%2Fcustom-model-deployment" target="_blank" title="https://help.aliyun.com/zh/functioncompute/fc/custom-model-deployment" ref="nofollow noopener noreferrer">FunModel 自定义部署</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffcnext.console.aliyun.com%2Ffun-model%2Fcn-hangzhou%2Ffun-model%2Fmodel-market" target="_blank" title="https://fcnext.console.aliyun.com/fun-model/cn-hangzhou/fun-model/model-market" ref="nofollow noopener noreferrer">FunModel 模型广场</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[单链表与双链表专题详解]]></title>    <link>https://juejin.cn/post/7581689310643060778</link>    <guid>https://juejin.cn/post/7581689310643060778</guid>    <pubDate>2025-12-09T10:19:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310643060778" data-draft-id="7581676787379666963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="单链表与双链表专题详解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T10:19:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            单链表与双链表专题详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T10:19:33.000Z" title="Tue Dec 09 2025 10:19:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>链表是<strong>线性数据结构</strong>，但与数组有本质区别。数组是连续的内存空间，支持随机访问；链表则是<strong>离散的内存节点通过指针连接</strong>，只支持顺序访问。理解链表的核心在于掌握<strong>指针操作</strong>和<strong>节点关系管理</strong>。</p>
<h2 data-id="heading-0">一、单链表基础：节点结构与创建</h2>
<h3 data-id="heading-1">1.1 单链表节点结构</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ListNode</span> {
    <span class="hljs-type">int</span> val;         <span class="hljs-comment">// 节点值</span>
    ListNode* next;  <span class="hljs-comment">// 指向下一个节点的指针</span>
    
    <span class="hljs-built_in">ListNode</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) {}
};
</code></pre>
<p><strong>关键理解</strong>：</p>
<ul>
<li>每个节点包含两部分：数据域(val)和指针域(next)</li>
<li><code>next</code>指针指向下一个节点，形成链式结构</li>
<li>最后一个节点的<code>next</code>指向<code>nullptr</code>，表示链表结束</li>
</ul>
<h3 data-id="heading-2">1.2 创建链表的三种方法</h3>
<h4 data-id="heading-3">方法一：手动连接</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 创建三个节点</span>
ListNode* node1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">1</span>);
ListNode* node2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">2</span>);
ListNode* node3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">3</span>);

<span class="hljs-comment">// 手动连接</span>
node1-&gt;next = node2;
node2-&gt;next = node3;
<span class="hljs-comment">// node3-&gt;next 保持为 nullptr</span>
</code></pre>
<h4 data-id="heading-4">方法二：尾插法（最常用）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">createList</span><span class="hljs-params">(<span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>{
    <span class="hljs-function">ListNode <span class="hljs-title">dummy</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;  <span class="hljs-comment">// 哑节点，简化边界处理</span>
    ListNode* tail = &amp;dummy;  <span class="hljs-comment">// 尾指针，始终指向最后一个节点</span>
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) {
        tail-&gt;next = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(num);
        tail = tail-&gt;next;  <span class="hljs-comment">// 移动尾指针</span>
    }
    
    <span class="hljs-keyword">return</span> dummy.next;  <span class="hljs-comment">// 返回真正的头节点</span>
}
</code></pre>
<p><strong>哑节点技巧</strong>：</p>
<ul>
<li>避免处理头节点的特殊情况</li>
<li>代码更简洁，逻辑更清晰</li>
<li>常用在链表操作中</li>
</ul>
<h4 data-id="heading-5">方法三：头插法（创建逆序链表）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">createReverseList</span><span class="hljs-params">(<span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>{
    ListNode* head = <span class="hljs-literal">nullptr</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) {
        ListNode* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(num);
        newNode-&gt;next = head;  <span class="hljs-comment">// 新节点指向原头节点</span>
        head = newNode;        <span class="hljs-comment">// 更新头节点</span>
    }
    
    <span class="hljs-keyword">return</span> head;
}
</code></pre>
<h3 data-id="heading-6">1.3 遍历链表</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printList</span><span class="hljs-params">(ListNode* head)</span> </span>{
    ListNode* curr = head;
    
    <span class="hljs-keyword">while</span> (curr) {
        cout &lt;&lt; curr-&gt;val;
        <span class="hljs-keyword">if</span> (curr-&gt;next) cout &lt;&lt; <span class="hljs-string">" -&gt; "</span>;
        curr = curr-&gt;next;
    }
    cout &lt;&lt; <span class="hljs-string">" -&gt; nullptr"</span> &lt;&lt; endl;
}
</code></pre>
<h2 data-id="heading-7">二、单链表核心操作：反转算法详解</h2>
<h3 data-id="heading-8">2.1 问题分析：为什么要反转链表？</h3>
<p>链表反转是<strong>最经典的链表问题</strong>，考察对指针操作的理解。反转意味着改变节点间的指向关系，将<code>a-&gt;b-&gt;c</code>变为<code>a&lt;-b&lt;-c</code>。</p>
<h3 data-id="heading-9">2.2 迭代反转法（三指针法）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">reverseIterative</span><span class="hljs-params">(ListNode* head)</span> </span>{
    ListNode* prev = <span class="hljs-literal">nullptr</span>;   <span class="hljs-comment">// 前一个节点，初始为nullptr</span>
    ListNode* curr = head;      <span class="hljs-comment">// 当前节点，从头节点开始</span>
    ListNode* next = <span class="hljs-literal">nullptr</span>;   <span class="hljs-comment">// 下一个节点，临时保存</span>
    
    <span class="hljs-keyword">while</span> (curr) {
        <span class="hljs-comment">// 步骤1：保存下一个节点（关键！）</span>
        next = curr-&gt;next;
        
        <span class="hljs-comment">// 步骤2：反转当前节点的指针</span>
        curr-&gt;next = prev;
        
        <span class="hljs-comment">// 步骤3：移动指针，准备下一次循环</span>
        prev = curr;  <span class="hljs-comment">// prev移动到当前节点</span>
        curr = next;  <span class="hljs-comment">// curr移动到下一个节点</span>
    }
    
    <span class="hljs-keyword">return</span> prev;  <span class="hljs-comment">// 循环结束时，prev指向原链表的尾节点，即新链表的头节点</span>
}
</code></pre>
<h4 data-id="heading-10">逐步分析（链表：1-&gt;2-&gt;3-&gt;nullptr）</h4>
<pre><code class="hljs language-ini" lang="ini">初始状态：
<span class="hljs-attr">prev</span> = nullptr
<span class="hljs-attr">curr</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">next</span> = nullptr

第1次循环：
<span class="hljs-attr">next</span> = curr-&gt;next = <span class="hljs-number">2</span>        // 保存节点<span class="hljs-number">2</span>
curr-&gt;<span class="hljs-attr">next</span> = prev = nullptr  // <span class="hljs-number">1</span>-&gt;nullptr
<span class="hljs-attr">prev</span> = curr = <span class="hljs-number">1</span>              // prev指向<span class="hljs-number">1</span>
<span class="hljs-attr">curr</span> = next = <span class="hljs-number">2</span>              // curr指向<span class="hljs-number">2</span>
结果：nullptr &lt;- 1   2-&gt;3-&gt;nullptr

第2次循环：
<span class="hljs-attr">next</span> = curr-&gt;next = <span class="hljs-number">3</span>        // 保存节点<span class="hljs-number">3</span>
curr-&gt;<span class="hljs-attr">next</span> = prev = <span class="hljs-number">1</span>        // <span class="hljs-number">2</span>-&gt;<span class="hljs-number">1</span>
<span class="hljs-attr">prev</span> = curr = <span class="hljs-number">2</span>              // prev指向<span class="hljs-number">2</span>
<span class="hljs-attr">curr</span> = next = <span class="hljs-number">3</span>              // curr指向<span class="hljs-number">3</span>
结果：nullptr &lt;- 1 &lt;- 2   3-&gt;nullptr

第3次循环：
<span class="hljs-attr">next</span> = curr-&gt;next = nullptr  // 保存nullptr
curr-&gt;<span class="hljs-attr">next</span> = prev = <span class="hljs-number">2</span>        // <span class="hljs-number">3</span>-&gt;<span class="hljs-number">2</span>
<span class="hljs-attr">prev</span> = curr = <span class="hljs-number">3</span>              // prev指向<span class="hljs-number">3</span>
<span class="hljs-attr">curr</span> = next = nullptr        // curr指向nullptr，循环结束
结果：nullptr &lt;- 1 &lt;- 2 &lt;- 3

返回<span class="hljs-attr">prev</span> = <span class="hljs-number">3</span>，即新链表的头节点
</code></pre>
<h3 data-id="heading-11">2.3 为什么这个算法正确？</h3>
<ol>
<li><strong>保存next是必须的</strong>：一旦执行<code>curr-&gt;next = prev</code>，就丢失了原链表的下一个节点</li>
<li><strong>移动指针的顺序</strong>：必须先移动prev到curr，再移动curr到next</li>
<li><strong>终止条件</strong>：当curr为nullptr时，prev指向原链表的最后一个节点，即新链表的第一个节点</li>
</ol>
<h3 data-id="heading-12">2.4 递归反转法</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">reverseRecursive</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-comment">// 递归终止条件：空链表或单个节点</span>
    <span class="hljs-keyword">if</span> (!head || !head-&gt;next) {
        <span class="hljs-keyword">return</span> head;
    }
    
    <span class="hljs-comment">// 递归反转剩余部分</span>
    ListNode* newHead = <span class="hljs-built_in">reverseRecursive</span>(head-&gt;next);
    
    <span class="hljs-comment">// 关键操作：让下一个节点指向自己</span>
    head-&gt;next-&gt;next = head;
    <span class="hljs-comment">// 断开自己的next指针（否则会成环）</span>
    head-&gt;next = <span class="hljs-literal">nullptr</span>;
    
    <span class="hljs-keyword">return</span> newHead;
}
</code></pre>
<h4 data-id="heading-13">递归深度分析（链表：1-&gt;2-&gt;3）</h4>
<pre><code class="hljs language-rust" lang="rust">调用栈：
<span class="hljs-title function_ invoke__">reverse</span>(<span class="hljs-number">1</span>)
  <span class="hljs-title function_ invoke__">reverse</span>(<span class="hljs-number">2</span>)
    <span class="hljs-title function_ invoke__">reverse</span>(<span class="hljs-number">3</span>) <span class="hljs-punctuation">-&gt;</span> 返回<span class="hljs-number">3</span>
    
<span class="hljs-title function_ invoke__">reverse</span>(<span class="hljs-number">2</span>)层：
  newHead = <span class="hljs-number">3</span>
  <span class="hljs-number">2</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">3</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">2</span>（形成环）
  <span class="hljs-number">2</span><span class="hljs-punctuation">-&gt;</span>next = nullptr
  返回<span class="hljs-number">3</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">2</span>
    
<span class="hljs-title function_ invoke__">reverse</span>(<span class="hljs-number">1</span>)层：
  newHead = <span class="hljs-number">3</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">2</span>
  <span class="hljs-number">1</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">2</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">1</span>（形成环）
  <span class="hljs-number">1</span><span class="hljs-punctuation">-&gt;</span>next = nullptr
  返回<span class="hljs-number">3</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">2</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-14">2.5 使用栈辅助反转（理解用）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">reverseWithStack</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    stack&lt;ListNode*&gt; st;
    ListNode* curr = head;
    
    <span class="hljs-comment">// 所有节点入栈</span>
    <span class="hljs-keyword">while</span> (curr) {
        st.<span class="hljs-built_in">push</span>(curr);
        curr = curr-&gt;next;
    }
    
    <span class="hljs-comment">// 栈顶是原链表的尾节点，作为新链表的头</span>
    ListNode* newHead = st.<span class="hljs-built_in">top</span>();
    st.<span class="hljs-built_in">pop</span>();
    curr = newHead;
    
    <span class="hljs-comment">// 依次出栈并连接</span>
    <span class="hljs-keyword">while</span> (!st.<span class="hljs-built_in">empty</span>()) {
        curr-&gt;next = st.<span class="hljs-built_in">top</span>();
        st.<span class="hljs-built_in">pop</span>();
        curr = curr-&gt;next;
    }
    
    <span class="hljs-comment">// 关键：最后一个节点的next置空</span>
    curr-&gt;next = <span class="hljs-literal">nullptr</span>;
    
    <span class="hljs-keyword">return</span> newHead;
}
</code></pre>
<p><strong>缺点</strong>：需要O(n)额外空间，效率不如迭代法</p>
<h2 data-id="heading-15">三、双链表详解：双向关系管理</h2>
<h3 data-id="heading-16">3.1 双链表节点结构</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DListNode</span> {
    <span class="hljs-type">int</span> val;
    DListNode* prev;  <span class="hljs-comment">// 指向前一个节点</span>
    DListNode* next;  <span class="hljs-comment">// 指向后一个节点</span>
    
    <span class="hljs-built_in">DListNode</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">prev</span>(<span class="hljs-literal">nullptr</span>), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) {}
};
</code></pre>
<p><strong>与单链表的区别</strong>：</p>
<ul>
<li>多了一个<code>prev</code>指针，指向前驱节点</li>
<li>可以双向遍历：从头到尾或从尾到头</li>
<li>删除操作更简单（不需要找到前驱节点）</li>
</ul>
<h3 data-id="heading-17">3.2 双链表的优势与代价</h3>
<p><strong>优势</strong>：</p>
<ol>
<li>双向遍历：可以从任意节点向前或向后遍历</li>
<li>删除操作简单：不需要寻找前驱节点</li>
<li>某些操作更高效：如删除尾节点只需O(1)</li>
</ol>
<p><strong>代价</strong>：</p>
<ol>
<li>每个节点多一个指针，内存占用增加</li>
<li>插入/删除时需要维护两个指针，代码稍复杂</li>
<li>需要更多的指针操作，容易出错</li>
</ol>
<h3 data-id="heading-18">3.3 双链表插入操作</h3>
<h4 data-id="heading-19">在头部插入</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insertAtHead</span><span class="hljs-params">(DListNode*&amp; head, DListNode*&amp; tail, <span class="hljs-type">int</span> val)</span> </span>{
    DListNode* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DListNode</span>(val);
    
    <span class="hljs-keyword">if</span> (!head) {  <span class="hljs-comment">// 空链表</span>
        head = tail = newNode;
    } <span class="hljs-keyword">else</span> {
        newNode-&gt;next = head;
        head-&gt;prev = newNode;
        head = newNode;
    }
}
</code></pre>
<h4 data-id="heading-20">在尾部插入</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insertAtTail</span><span class="hljs-params">(DListNode*&amp; head, DListNode*&amp; tail, <span class="hljs-type">int</span> val)</span> </span>{
    DListNode* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DListNode</span>(val);
    
    <span class="hljs-keyword">if</span> (!tail) {  <span class="hljs-comment">// 空链表</span>
        head = tail = newNode;
    } <span class="hljs-keyword">else</span> {
        tail-&gt;next = newNode;
        newNode-&gt;prev = tail;
        tail = newNode;
    }
}
</code></pre>
<h4 data-id="heading-21">在指定节点后插入</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">insertAfter</span><span class="hljs-params">(DListNode* node, <span class="hljs-type">int</span> val)</span> </span>{
    <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>;
    
    DListNode* newNode = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DListNode</span>(val);
    
    <span class="hljs-comment">// 连接新节点与后继节点</span>
    newNode-&gt;next = node-&gt;next;
    <span class="hljs-keyword">if</span> (node-&gt;next) {
        node-&gt;next-&gt;prev = newNode;
    }
    
    <span class="hljs-comment">// 连接新节点与前驱节点</span>
    newNode-&gt;prev = node;
    node-&gt;next = newNode;
}
</code></pre>
<h3 data-id="heading-22">3.4 双链表删除操作（重点）</h3>
<h4 data-id="heading-23">删除节点的三种情况</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteNode</span><span class="hljs-params">(DListNode*&amp; head, DListNode*&amp; tail, DListNode* target)</span> </span>{
    <span class="hljs-keyword">if</span> (!head || !target) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// 边界检查</span>
    
    <span class="hljs-comment">// 情况1：删除头节点</span>
    <span class="hljs-keyword">if</span> (target == head) {
        head = head-&gt;next;        <span class="hljs-comment">// 头指针后移</span>
        <span class="hljs-keyword">if</span> (head) {
            head-&gt;prev = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 新头节点的prev置空</span>
        } <span class="hljs-keyword">else</span> {
            tail = <span class="hljs-literal">nullptr</span>;       <span class="hljs-comment">// 链表变空，尾指针也置空</span>
        }
    }
    <span class="hljs-comment">// 情况2：删除尾节点</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target == tail) {
        tail = tail-&gt;prev;        <span class="hljs-comment">// 尾指针前移</span>
        <span class="hljs-keyword">if</span> (tail) {
            tail-&gt;next = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 新尾节点的next置空</span>
        } <span class="hljs-keyword">else</span> {
            head = <span class="hljs-literal">nullptr</span>;       <span class="hljs-comment">// 链表变空，头指针也置空</span>
        }
    }
    <span class="hljs-comment">// 情况3：删除中间节点</span>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 跳过要删除的节点</span>
        target-&gt;prev-&gt;next = target-&gt;next;
        target-&gt;next-&gt;prev = target-&gt;prev;
    }
    
    <span class="hljs-keyword">delete</span> target;  <span class="hljs-comment">// 释放内存</span>
}
</code></pre>
<h4 data-id="heading-24">图解删除过程</h4>
<pre><code class="hljs language-css" lang="css">删除中间节点<span class="hljs-selector-tag">B</span>：<span class="hljs-selector-tag">A</span> &lt;-&gt; <span class="hljs-selector-tag">B</span> &lt;-&gt; C

步骤<span class="hljs-number">1</span>：<span class="hljs-selector-tag">A</span>-&gt;next = C
<span class="hljs-selector-tag">A</span> &lt;-&gt; C  <span class="hljs-selector-tag">B</span> &lt;-&gt; C

步骤<span class="hljs-number">2</span>：C-&gt;prev = <span class="hljs-selector-tag">A</span>
<span class="hljs-selector-tag">A</span> &lt;-&gt; C  <span class="hljs-selector-tag">B</span>孤立

步骤<span class="hljs-number">3</span>：delete <span class="hljs-selector-tag">B</span>
<span class="hljs-selector-tag">A</span> &lt;-&gt; C
</code></pre>
<h4 data-id="heading-25">删除操作的注意事项</h4>
<ol>
<li>
<p><strong>更新相邻节点的指针</strong>：</p>
<ul>
<li>前驱节点的next指向后继节点</li>
<li>后继节点的prev指向前驱节点</li>
</ul>
</li>
<li>
<p><strong>处理边界情况</strong>：</p>
<ul>
<li>删除头节点：更新head指针</li>
<li>删除尾节点：更新tail指针</li>
<li>删除唯一节点：head和tail都置空</li>
</ul>
</li>
<li>
<p><strong>内存管理</strong>：记得delete释放内存</p>
</li>
</ol>
<h3 data-id="heading-26">3.5 按值删除</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteByValue</span><span class="hljs-params">(DListNode*&amp; head, DListNode*&amp; tail, <span class="hljs-type">int</span> val)</span> </span>{
    DListNode* curr = head;
    
    <span class="hljs-keyword">while</span> (curr) {
        <span class="hljs-keyword">if</span> (curr-&gt;val == val) {
            DListNode* toDelete = curr;
            curr = curr-&gt;next;  <span class="hljs-comment">// 先移动到下一个节点</span>
            
            <span class="hljs-built_in">deleteNode</span>(head, tail, toDelete);
        } <span class="hljs-keyword">else</span> {
            curr = curr-&gt;next;
        }
    }
}
</code></pre>
<p><strong>关键点</strong>：在删除节点前，先保存下一个节点，否则删除后无法继续遍历。</p>
<h2 data-id="heading-27">四、链表排序：归并排序的实现</h2>
<h3 data-id="heading-28">4.1 为什么链表排序用归并？</h3>
<p>链表与数组不同：</p>
<ol>
<li><strong>不支持随机访问</strong>：不能像数组那样用下标直接访问任意元素</li>
<li><strong>移动元素代价低</strong>：只需修改指针，不需要复制数据</li>
<li><strong>归并排序特点</strong>：适合顺序访问的数据结构</li>
</ol>
<h3 data-id="heading-29">4.2 归并排序的完整实现</h3>
<h4 data-id="heading-30">步骤1：找到中间节点（快慢指针）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">getMiddle</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    ListNode* slow = head;
    ListNode* fast = head-&gt;next;  <span class="hljs-comment">// fast从head-&gt;next开始</span>
    
    <span class="hljs-comment">// fast走两步，slow走一步</span>
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast-&gt;next) {
        slow = slow-&gt;next;
        fast = fast-&gt;next-&gt;next;
    }
    
    <span class="hljs-keyword">return</span> slow;  <span class="hljs-comment">// slow指向中间节点</span>
}
</code></pre>
<p><strong>为什么fast从head-&gt;next开始？</strong></p>
<ul>
<li>对于偶数个节点：1-&gt;2-&gt;3-&gt;4</li>
<li>fast从head开始：slow指向3（第二个中间节点）</li>
<li>fast从head-&gt;next开始：slow指向2（第一个中间节点）</li>
<li>我们通常希望分割得尽量均匀</li>
</ul>
<h4 data-id="heading-31">步骤2：递归排序</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">mergeSort</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-comment">// 递归终止条件：空链表或单个节点</span>
    <span class="hljs-keyword">if</span> (!head || !head-&gt;next) <span class="hljs-keyword">return</span> head;
    
    <span class="hljs-comment">// 1. 找到中间节点并分割</span>
    ListNode* mid = <span class="hljs-built_in">getMiddle</span>(head);
    ListNode* right = mid-&gt;next;
    mid-&gt;next = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 关键：切断链表</span>
    
    <span class="hljs-comment">// 2. 递归排序左右两部分</span>
    ListNode* leftSorted = <span class="hljs-built_in">mergeSort</span>(head);
    ListNode* rightSorted = <span class="hljs-built_in">mergeSort</span>(right);
    
    <span class="hljs-comment">// 3. 合并两个有序链表</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">merge</span>(leftSorted, rightSorted);
}
</code></pre>
<h4 data-id="heading-32">步骤3：合并有序链表</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">merge</span><span class="hljs-params">(ListNode* l1, ListNode* l2)</span> </span>{
    <span class="hljs-function">ListNode <span class="hljs-title">dummy</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;  <span class="hljs-comment">// 哑节点，简化操作</span>
    ListNode* tail = &amp;dummy;
    
    <span class="hljs-comment">// 比较两个链表的头节点，选择较小的</span>
    <span class="hljs-keyword">while</span> (l1 &amp;&amp; l2) {
        <span class="hljs-keyword">if</span> (l1-&gt;val &lt; l2-&gt;val) {
            tail-&gt;next = l1;
            l1 = l1-&gt;next;
        } <span class="hljs-keyword">else</span> {
            tail-&gt;next = l2;
            l2 = l2-&gt;next;
        }
        tail = tail-&gt;next;
    }
    
    <span class="hljs-comment">// 连接剩余部分</span>
    tail-&gt;next = l1 ? l1 : l2;
    
    <span class="hljs-keyword">return</span> dummy.next;
}
</code></pre>
<h3 data-id="heading-33">4.3 时间复杂度分析</h3>
<ol>
<li>
<p><strong>分割阶段</strong>：</p>
<ul>
<li>每次分割需要找到中间节点：O(n)</li>
<li>共分割log₂n次</li>
<li>总分割时间：O(n log n)</li>
</ul>
</li>
<li>
<p><strong>合并阶段</strong>：</p>
<ul>
<li>每次合并需要遍历所有节点：O(n)</li>
<li>共合并log₂n次</li>
<li>总合并时间：O(n log n)</li>
</ul>
</li>
</ol>
<p><strong>总时间复杂度</strong>：O(n log n)</p>
<p><strong>空间复杂度</strong>：</p>
<ul>
<li>递归栈深度：O(log n)</li>
<li>不需要额外数组：O(1)额外空间</li>
</ul>
<h3 data-id="heading-34">4.4 归并排序的变种：自底向上</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">mergeSortBottomUp</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head || !head-&gt;next) <span class="hljs-keyword">return</span> head;
    
    <span class="hljs-comment">// 1. 计算链表长度</span>
    <span class="hljs-type">int</span> length = <span class="hljs-number">0</span>;
    ListNode* curr = head;
    <span class="hljs-keyword">while</span> (curr) {
        length++;
        curr = curr-&gt;next;
    }
    
    <span class="hljs-function">ListNode <span class="hljs-title">dummy</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
    dummy.next = head;
    
    <span class="hljs-comment">// 2. 从1开始，每次合并相邻的子链表</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> step = <span class="hljs-number">1</span>; step &lt; length; step *= <span class="hljs-number">2</span>) {
        ListNode* prev = &amp;dummy;
        ListNode* curr = dummy.next;
        
        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-comment">// 获取第一个子链表</span>
            ListNode* left = curr;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; step &amp;&amp; curr-&gt;next; i++) {
                curr = curr-&gt;next;
            }
            
            <span class="hljs-comment">// 获取第二个子链表</span>
            ListNode* right = curr-&gt;next;
            curr-&gt;next = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 断开第一个子链表</span>
            curr = right;
            
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; step &amp;&amp; curr &amp;&amp; curr-&gt;next; i++) {
                curr = curr-&gt;next;
            }
            
            <span class="hljs-comment">// 保存下一个子链表的起始位置</span>
            ListNode* next = <span class="hljs-literal">nullptr</span>;
            <span class="hljs-keyword">if</span> (curr) {
                next = curr-&gt;next;
                curr-&gt;next = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 断开第二个子链表</span>
            }
            
            <span class="hljs-comment">// 合并两个子链表</span>
            ListNode* merged = <span class="hljs-built_in">merge</span>(left, right);
            
            <span class="hljs-comment">// 连接到已合并的部分</span>
            prev-&gt;next = merged;
            <span class="hljs-keyword">while</span> (prev-&gt;next) {
                prev = prev-&gt;next;
            }
            
            <span class="hljs-comment">// 继续处理剩余部分</span>
            curr = next;
        }
    }
    
    <span class="hljs-keyword">return</span> dummy.next;
}
</code></pre>
<p><strong>优点</strong>：避免递归，空间复杂度O(1)</p>
<h2 data-id="heading-35">五、链表常见问题与解决方案</h2>
<h3 data-id="heading-36">5.1 检测环（快慢指针）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hasCycle</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head || !head-&gt;next) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    ListNode* slow = head;
    ListNode* fast = head;
    
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast-&gt;next) {
        slow = slow-&gt;next;        <span class="hljs-comment">// 慢指针走一步</span>
        fast = fast-&gt;next-&gt;next;  <span class="hljs-comment">// 快指针走两步</span>
        
        <span class="hljs-keyword">if</span> (slow == fast) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// 相遇说明有环</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 快指针到达nullptr，说明无环</span>
}
</code></pre>
<h3 data-id="heading-37">5.2 找到环的入口</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">detectCycle</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head || !head-&gt;next) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    ListNode* slow = head;
    ListNode* fast = head;
    <span class="hljs-type">bool</span> hasCycle = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 第一步：判断是否有环</span>
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast-&gt;next) {
        slow = slow-&gt;next;
        fast = fast-&gt;next-&gt;next;
        
        <span class="hljs-keyword">if</span> (slow == fast) {
            hasCycle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-keyword">if</span> (!hasCycle) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    <span class="hljs-comment">// 第二步：找到环的入口</span>
    slow = head;
    <span class="hljs-keyword">while</span> (slow != fast) {
        slow = slow-&gt;next;
        fast = fast-&gt;next;
    }
    
    <span class="hljs-keyword">return</span> slow;
}
</code></pre>
<p><strong>原理</strong>（Floyd判圈算法）：</p>
<ol>
<li>设头节点到环入口距离为a，环长度为b</li>
<li>第一次相遇时，慢指针走了a + x，快指针走了a + x + nb</li>
<li>由快指针速度是慢指针两倍：2(a + x) = a + x + nb</li>
<li>得到：a = (n-1)b + (b - x)</li>
<li>让一个指针从head开始，一个从相遇点开始，每次走一步，相遇点就是环入口</li>
</ol>
<h3 data-id="heading-38">5.3 找到倒数第k个节点</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">ListNode* <span class="hljs-title">findKthFromEnd</span><span class="hljs-params">(ListNode* head, <span class="hljs-type">int</span> k)</span> </span>{
    <span class="hljs-keyword">if</span> (!head || k &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    ListNode* fast = head;
    ListNode* slow = head;
    
    <span class="hljs-comment">// fast先走k步</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) {
        <span class="hljs-keyword">if</span> (!fast) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// k大于链表长度</span>
        fast = fast-&gt;next;
    }
    
    <span class="hljs-comment">// fast和slow一起走</span>
    <span class="hljs-keyword">while</span> (fast) {
        slow = slow-&gt;next;
        fast = fast-&gt;next;
    }
    
    <span class="hljs-keyword">return</span> slow;
}
</code></pre>
<h3 data-id="heading-39">5.4 删除重复节点</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 删除排序链表中的重复元素</span>
<span class="hljs-function">ListNode* <span class="hljs-title">deleteDuplicates</span><span class="hljs-params">(ListNode* head)</span> </span>{
    <span class="hljs-keyword">if</span> (!head) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    
    ListNode* curr = head;
    
    <span class="hljs-keyword">while</span> (curr &amp;&amp; curr-&gt;next) {
        <span class="hljs-keyword">if</span> (curr-&gt;val == curr-&gt;next-&gt;val) {
            ListNode* toDelete = curr-&gt;next;
            curr-&gt;next = curr-&gt;next-&gt;next;
            <span class="hljs-keyword">delete</span> toDelete;
        } <span class="hljs-keyword">else</span> {
            curr = curr-&gt;next;
        }
    }
    
    <span class="hljs-keyword">return</span> head;
}
</code></pre>
<h2 data-id="heading-40">六、链表操作的常见错误</h2>
<h3 data-id="heading-41">6.1 指针未初始化</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 错误</span>
ListNode* ptr;
cout &lt;&lt; ptr-&gt;val;  <span class="hljs-comment">// 访问随机内存，段错误</span>

<span class="hljs-comment">// 正确</span>
ListNode* ptr = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 或 = new ListNode(0)</span>
</code></pre>
<h3 data-id="heading-42">6.2 访问已释放的内存</h3>
<pre><code class="hljs language-cpp" lang="cpp">ListNode* node = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">delete</span> node;
cout &lt;&lt; node-&gt;val;  <span class="hljs-comment">// 错误：访问已释放的内存</span>
</code></pre>
<h3 data-id="heading-43">6.3 忘记断开连接（形成环）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 反转链表时忘记断开原连接</span>
ListNode* newHead = <span class="hljs-built_in">reverse</span>(head);
<span class="hljs-comment">// 如果原链表没有正确断开，可能形成环</span>
</code></pre>
<h3 data-id="heading-44">6.4 丢失头指针</h3>
<pre><code class="hljs language-cpp" lang="cpp">ListNode* head = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ListNode</span>(<span class="hljs-number">1</span>);
head = head-&gt;next;  <span class="hljs-comment">// 丢失了原头节点，内存泄漏</span>
</code></pre>
<h2 data-id="heading-45">七、链表与数组的对比</h2>








































<table><thead><tr><th>特性</th><th>数组</th><th>链表</th></tr></thead><tbody><tr><td><strong>内存分配</strong></td><td>连续</td><td>离散</td></tr><tr><td><strong>访问方式</strong></td><td>随机访问</td><td>顺序访问</td></tr><tr><td><strong>访问时间</strong></td><td>O(1)</td><td>O(n)</td></tr><tr><td><strong>插入/删除</strong></td><td>O(n)</td><td>O(1)（已知位置）</td></tr><tr><td><strong>内存使用</strong></td><td>固定大小</td><td>动态增长</td></tr><tr><td><strong>缓存友好</strong></td><td>是</td><td>否</td></tr></tbody></table>
<p><strong>选择原则</strong>：</p>
<ul>
<li>需要快速随机访问 → 数组</li>
<li>需要频繁插入/删除 → 链表</li>
<li>内存使用不确定 → 链表</li>
<li>需要缓存友好 → 数组</li>
</ul>
<p>链表操作的核心是<strong>理解指针关系</strong>和<strong>管理内存生命周期</strong>。掌握链表的基础操作后，复杂问题往往是这些基础操作的组合。多练习、多思考，才能真正掌握链表的精髓。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis集群架构详解：从单机到分布式的扩展之路]]></title>    <link>https://juejin.cn/post/7580564126403248178</link>    <guid>https://juejin.cn/post/7580564126403248178</guid>    <pubDate>2025-12-08T01:11:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580564126403248178" data-draft-id="7490815158190129178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis集群架构详解：从单机到分布式的扩展之路"/> <meta itemprop="keywords" content="Redis,数据库,性能优化"/> <meta itemprop="datePublished" content="2025-12-08T01:11:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis集群架构详解：从单机到分布式的扩展之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T01:11:13.000Z" title="Mon Dec 08 2025 01:11:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言</h2>
<p>Redis，这个名字对于许多开发者来说并不陌生。作为一款高性能的内存数据库，它以低延迟和极简设计赢得了无数开发者的青睐。然而，随着业务规模的增长，单机Redis的局限性逐渐暴露，分布式集群架构应运而生。这篇文章的目标读者是有1-2年Redis开发经验的开发者——你可能已经熟练掌握了<code>SET</code>、<code>GET</code>这些基础命令，也在单机环境下优化过性能，但对于如何将Redis从单机扩展到分布式集群，或许还感到有些迷雾重重。</p>
<p>从单机到分布式的演进，不仅仅是一个技术升级的过程，更是为解决实际业务痛点而生的必然选择。想象一下，单机Redis就像一辆跑车，速度快、操控灵活，但装载能力有限；而集群架构则像一支车队，虽然调度复杂，却能承载更多货物，跑得更远。Redis从最初的单机模式，到支持主从复制、哨兵机制，再到如今的Redis Cluster，每一步都在解决容量、性能和高可用性的难题。那么，这条扩展之路究竟有哪些关键节点？我们又该如何在实践中驾驭它？</p>
<p>在这篇文章中，我将从单机Redis的局限性讲起，逐步剖析Redis集群的核心概念、搭建方法和优化实践。内容不仅基于官方文档和技术原理，更融入了我10年Redis开发经验中的真实案例。比如，我曾在一个电商项目中，面对秒杀流量激增导致单机Redis内存爆满的窘境，最终通过集群架构化险为夷。这些经验教训，将为你提供更接地气的参考。接下来，我们将一起探索Redis集群的奥秘，看看它如何从单兵作战进化到分布式协同的强大阵容。</p>
<hr/>
<h2 data-id="heading-1">2. 单机Redis的局限性与分布式需求</h2>
<h3 data-id="heading-2">单机Redis的优势与瓶颈</h3>
<p>Redis的单机模式之所以广受欢迎，离不开它的几个显著优势。首先是<strong>简单</strong>：无需复杂配置，安装后即可使用，开发者可以快速上手。其次是<strong>高性能</strong>：基于内存操作，单线程模型避免了上下文切换，读写延迟通常在微秒级别。最后是<strong>低延迟</strong>：所有数据都在内存中，响应速度远超磁盘数据库。</p>
<p>然而，天下没有完美的技术。单机Redis的瓶颈也同样明显。<strong>内存容量受限</strong>是首要问题——一台服务器的内存终究有限，当数据量超过物理上限时，你只能眼睁睁看着性能下降甚至宕机。<strong>单点故障</strong>是另一个隐患，一旦服务器宕机，服务就彻底不可用。此外，<strong>QPS上限</strong>也不容忽视，单线程模型虽然高效，但在高并发场景下，单机的处理能力迟早会触碰到天花板。</p>
<h3 data-id="heading-3">实际场景举例</h3>
<p>我曾在早期的一个电商秒杀项目中深刻体会到这些局限性。当时，我们用一台16GB内存的Redis实例存储商品库存和用户订单数据。秒杀开始后，瞬时流量激增，内存使用率迅速飙升到100%，紧接着Redis进程崩溃，服务直接瘫痪。事后分析发现，库存Key的频繁更新和订单数据的快速累积，让单机Redis不堪重负。这次事故让我意识到，单机模式在面对大规模、高并发场景时，实在是“独木难支”。</p>
<h3 data-id="heading-4">分布式需求驱动</h3>
<p>那么，什么样的需求推动了Redis向分布式演进呢？首先是<strong>数据量增长</strong>：业务发展带来用户和数据的指数级增加，单机内存已无法满足存储需求。其次是<strong>高可用性要求</strong>：现代应用对服务中断的容忍度极低，单点故障的风险必须被消除。最后是<strong>负载均衡的必要性</strong>：将请求分散到多个节点，既能提升整体吞吐量，又能避免单节点过载。</p>
<h3 data-id="heading-5">过渡到集群的意义</h3>
<p>从单机到分布式集群的转变，不仅仅是技术层面的升级，更是为业务保驾护航的关键一步。就像从独奏转向交响乐团，单机Redis擅长独当一面，而集群架构则通过协作释放更大的潜力。接下来，我们将深入探讨Redis Cluster的核心概念，看看它如何通过分布式设计解决这些痛点，并为系统扩展打开新的可能性。</p>
<hr/>
<h3 data-id="heading-6">示意图：单机Redis的瓶颈</h3>

























<table><thead><tr><th><strong>维度</strong></th><th><strong>单机Redis</strong></th><th><strong>潜在问题</strong></th></tr></thead><tbody><tr><td>内存容量</td><td>单机物理内存上限</td><td>数据量超限导致溢出或宕机</td></tr><tr><td>可用性</td><td>单点运行</td><td>宕机即服务不可用</td></tr><tr><td>性能</td><td>单线程QPS有限</td><td>高并发下响应变慢</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-7">过渡段</h3>
<p>单机Redis的局限性让我们看到了分布式架构的必要性，但如何实现这一跨越呢？Redis Cluster作为官方提供的分布式解决方案，以其独特的设计和强大的功能，成为了从单机迈向分布式的桥梁。接下来，我们将详细剖析它的核心概念和优势，看看它如何为开发者提供一个既灵活又可靠的工具箱。</p>
<hr/>
<h2 data-id="heading-8">3. Redis集群架构的核心概念与优势</h2>
<p>从单机Redis的局限性中走出来，Redis Cluster为我们打开了一扇通往分布式世界的大门。它不仅解决了容量和可用性的瓶颈，还带来了灵活扩展的能力。那么，Redis Cluster究竟是什么？它有哪些核心优势？又如何在实际项目中发挥作用？让我们一步步揭开它的面纱。</p>
<h3 data-id="heading-9">Redis Cluster简介</h3>
<p>Redis Cluster是Redis官方提供的分布式实现，首次亮相于Redis 3.0版本。它的核心思想是通过<strong>数据分片（Sharding）<strong>将数据分散到多个节点上，从而突破单机内存和性能的限制。Redis Cluster将整个数据空间划分为</strong>16384个槽（slot）</strong>，每个槽负责存储一部分键值对。每个节点则被分配若干槽，通过这种方式实现数据的分布式存储。</p>
<p>形象地说，Redis Cluster就像一个巨大的图书馆，16384个槽是书架上的格子，而每个节点则是负责管理一部分格子的管理员。客户端通过键的哈希值找到对应的槽，再定位到具体的节点完成操作。这种设计既简单又高效，避免了传统代理架构的复杂性。</p>
<h3 data-id="heading-10">核心优势</h3>
<p>Redis Cluster的魅力在于它带来的三大优势：</p>
<ol>
<li>
<p><strong>水平扩展</strong><br/>
单机Redis的容量和性能受限于硬件，而Redis Cluster通过添加节点就能轻松扩展。无论是数据量翻倍还是并发请求激增，只需加入新节点并重新分配槽，就能让系统“长大”。这就像给车队增加车辆，运力自然提升。</p>
</li>
<li>
<p><strong>高可用性</strong><br/>
Redis Cluster支持<strong>主从复制</strong>和<strong>故障转移</strong>。每个主节点可以配置一个或多个从节点，当主节点宕机时，从节点会自动接管。这种机制确保了即使部分节点失效，服务依然可用。</p>
</li>
<li>
<p><strong>去中心化设计</strong><br/>
与一些需要代理（Proxy）分发的分布式系统不同，Redis Cluster采用无代理架构，客户端直接与节点通信。这种设计减少了中间层开销，提升了性能，同时也降低了维护复杂度。</p>
</li>
</ol>
<h3 data-id="heading-11">与单机模式的对比</h3>
<p>为了更直观地理解Redis Cluster的价值，我们可以用下表对比单机模式和集群模式：</p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>单机Redis</strong></th><th><strong>Redis Cluster</strong></th></tr></thead><tbody><tr><td>数据存储</td><td>集中在一台机器</td><td>分片分布多个节点</td></tr><tr><td>容量扩展</td><td>受限于单机内存</td><td>可通过加节点无限扩展</td></tr><tr><td>可用性</td><td>单点故障即不可用</td><td>主从切换保障高可用</td></tr><tr><td>管理方式</td><td>简单集中式</td><td>分布式协同，稍复杂</td></tr></tbody></table>
<p>单机模式像独奏乐手，简单高效但能力有限；集群模式则像交响乐团，协作带来更大的舞台。</p>
<h3 data-id="heading-12">特色功能解析</h3>
<p>Redis Cluster不仅提供了基础的分片能力，还有一些特色功能值得关注：</p>
<ul>
<li>
<p><strong>动态扩缩容</strong><br/>
你可以在集群运行时添加或删除节点，槽会自动迁移到新节点或从旧节点移除。这种在线操作让扩容变得“丝滑”，无需停机。</p>
</li>
<li>
<p><strong>一致性哈希与槽迁移</strong><br/>
Redis Cluster使用哈希槽而非传统一致性哈希。键通过<code>CRC16(key) % 16384</code>计算槽位置，节点变更时只需迁移槽而非全部数据。这种设计在扩缩容时极大减少了数据搬迁成本。</p>
</li>
</ul>
<h3 data-id="heading-13">踩坑经验：槽分配不均的教训</h3>
<p>在实际项目中，我曾遇到过槽分配不均导致的热点问题。当时在一个实时排行榜系统中，初始集群只有3个节点，槽分配默认平均，但某些高频访问的键集中落在同一个节点，导致该节点负载过高，延迟飙升。<br/>
<strong>解决办法</strong>：通过<code>redis-cli --cluster check</code>检查槽分布，发现问题后手动执行<code>CLUSTER ADDSLOTS</code>重新分配槽。同时，我们引入了监控工具（如Prometheus+Grafana），实时跟踪每个节点的QPS和内存使用率，避免类似问题再次发生。<br/>
<strong>经验教训</strong>：集群初始化时，合理规划槽分配并结合业务特点预留冗余，能有效避免热点问题。</p>
<hr/>
<h3 data-id="heading-14">示意图：Redis Cluster数据分片机制</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[客户端]</span> --&gt; <span class="hljs-selector-attr">[Key: <span class="hljs-string">"user:123"</span>]</span> --&gt; <span class="hljs-selector-attr">[CRC16(<span class="hljs-string">"user:123"</span>) % 16384 = Slot 4567]</span>
   |                                    |
   v                                    v
<span class="hljs-selector-attr">[Node A: Slot 0-5460]</span>         <span class="hljs-selector-attr">[Node B: Slot 5461-10922]</span> --&gt; 处理请求
<span class="hljs-selector-attr">[Node C: Slot 10923-16383]</span>
</code></pre>
<p><strong>说明</strong>：客户端根据键计算槽号，定位到对应节点完成操作。</p>
<hr/>
<h3 data-id="heading-15">过渡段</h3>
<p>通过对Redis Cluster核心概念的剖析，我们不难发现，它以分片和高可用为基础，为分布式扩展铺平了道路。但光有理论还不够，如何在实践中搭建并驾驭这个“分布式车队”呢？下一节，我们将深入探讨Redis集群的搭建与配置，结合实际代码和经验，带你从零开始构建一个健壮的集群环境。</p>
<hr/>
<h2 data-id="heading-16">4. Redis集群的搭建与配置</h2>
<p>了解了Redis Cluster的核心概念和优势后，接下来我们要把理论转化为实践，亲手搭建一个属于自己的集群。Redis集群的搭建并不复杂，但细节决定成败。从环境准备到配置优化，每一步都需要用心。本节将带你一步步完成集群搭建，并分享我在实际项目中的经验教训，让你少走弯路。</p>
<h3 data-id="heading-17">环境准备</h3>
<p>在动手之前，先做好功课。Redis Cluster对版本有要求，建议使用<strong>Redis 5.0或以上</strong>，因为新版本在集群管理和稳定性上有了显著改进。硬件方面，至少需要3台服务器（或虚拟机）来模拟多节点环境，每台建议配置至少2GB内存和双核CPU。如果是测试环境，也可以在单机上通过不同端口模拟多个实例。</p>
<p>以我的经验为例，在一个中型项目中，我们为集群规划了6个节点（3主3从），每台服务器16GB内存，确保初期数据量和QPS需求都能轻松应对。这种规划为后续扩容留出了空间。</p>
<h3 data-id="heading-18">手动搭建集群步骤</h3>
<p>假设我们用单机多端口的方式搭建一个小型集群，包含3个主节点（端口7000-7002）。以下是具体步骤：</p>
<ol>
<li>
<p><strong>启动多个Redis实例</strong><br/>
为每个节点创建独立的配置文件（如<code>redis-7000.conf</code>），并启动实例：</p>
<pre><code class="hljs language-bash" lang="bash">redis-server redis-7000.conf
redis-server redis-7001.conf
redis-server redis-7002.conf
</code></pre>
</li>
<li>
<p><strong>使用redis-cli创建集群</strong><br/>
Redis提供了一个便捷的工具<code>redis-cli --cluster</code>，可以快速构建集群。执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 --cluster-replicas 0
</code></pre>
<ul>
<li><strong>注释说明</strong>：
<ul>
<li><code>--cluster-replicas 0</code>：表示暂不配置从节点，仅搭建3个主节点。</li>
<li>命令执行后，系统会自动分配16384个槽，并提示确认分配方案，输入<code>yes</code>即可完成。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>验证集群状态</strong><br/>
检查集群是否正常运行：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -p 7000 cluster info
</code></pre>
<p>输出中<code>cluster_state:ok</code>表示集群已就绪。</p>
</li>
</ol>
<h3 data-id="heading-19">配置文件详解</h3>
<p>Redis Cluster依赖几个关键配置参数，以下是<code>redis-7000.conf</code>的一个示例：</p>
<pre><code class="hljs language-conf" lang="conf">port 7000                # 节点监听端口
cluster-enabled yes      # 启用集群模式
cluster-config-file nodes-7000.conf  # 集群拓扑配置文件，自动生成
cluster-node-timeout 15000  # 节点间通信超时时间（毫秒）
</code></pre>
<ul>
<li><strong><code>cluster-enabled</code></strong>：必须设为<code>yes</code>，否则节点以单机模式运行。</li>
<li><strong><code>cluster-config-file</code></strong>：记录集群状态的文件，每次节点变更时自动更新。</li>
<li><strong><code>cluster-node-timeout</code></strong>：设置过短可能导致频繁误判节点故障，过长则影响故障转移速度，默认15000ms是个折中选择。</li>
</ul>
<h3 data-id="heading-20">最佳实践</h3>
<p>在实际项目中，集群搭建的成功不仅取决于技术实现，还需要一些规划和优化：</p>
<ul>
<li>
<p><strong>初始节点数规划</strong><br/>
我曾在一个社交平台项目中只部署了3个节点，结果不到半年就因数据量增长需要扩容。频繁扩容不仅麻烦，还可能引发槽迁移时的性能抖动。<strong>建议</strong>：根据业务规模预估未来6-12个月的需求，初始部署至少6个节点（3主3从）。</p>
</li>
<li>
<p><strong>工具辅助管理</strong><br/>
除了<code>redis-cli</code>，推荐使用RedisInsight这类可视化工具，可以直观查看槽分布和节点状态，提升运维效率。</p>
</li>
</ul>
<h3 data-id="heading-21">踩坑经验：未开启AOF的教训</h3>
<p>有一次在生产环境中，我忽略了AOF（Append Only File）的配置，默认只启用了RDB快照。结果一台主节点意外宕机重启后，丢失了最近几分钟的数据，导致用户订单状态异常。<br/>
<strong>解决办法</strong>：在集群配置文件中启用AOF（<code>appendonly yes</code>），并定期检查<code>appendfsync everysec</code>的同步策略，确保数据持久化。<br/>
<strong>经验教训</strong>：集群的高可用性不等于数据安全性，RDB和AOF要合理搭配使用。</p>
<hr/>
<h3 data-id="heading-22">示例代码：检查集群状态</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查集群基本信息</span>
redis-cli -p 7000 cluster info
<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># cluster_state:ok</span>
<span class="hljs-comment"># cluster_slots_assigned:16384</span>
<span class="hljs-comment"># cluster_known_nodes:3</span>

<span class="hljs-comment"># 查看槽分配详情</span>
redis-cli -p 7000 cluster slots
<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># 1) 1) (integer) 0</span>
<span class="hljs-comment">#    2) (integer) 5460</span>
<span class="hljs-comment">#    3) 1) "127.0.0.1"</span>
<span class="hljs-comment">#       2) (integer) 7000</span>
</code></pre>
<p><strong>注释</strong>：<code>cluster info</code>显示集群整体状态，<code>cluster slots</code>列出每个节点的槽范围。</p>
<hr/>
<h3 data-id="heading-23">示意图：Redis集群搭建架构</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Node 7000: Slot 0-5460]</span>    <span class="hljs-selector-attr">[Node 7001: Slot 5461-10922]</span>    <span class="hljs-selector-attr">[Node 7002: Slot 10923-16383]</span>
         |                           |                             |
         +---------------------------+-----------------------------+
         |                 redis-cli <span class="hljs-attr">--cluster</span> create              |
         +---------------------------------------------------------+
                     <span class="hljs-selector-attr">[客户端直接访问任意节点]</span>
</code></pre>
<p><strong>说明</strong>：3个节点通过<code>redis-cli</code>连接为集群，槽自动分配。</p>
<hr/>
<h3 data-id="heading-24">过渡段</h3>
<p>通过以上步骤，一个基本的Redis集群已经搭建完成。但从单机到分布式的旅程远未结束，集群只是起点，如何平滑扩展并应对复杂场景才是真正的挑战。下一节，我们将探讨从单机到分布式的完整扩展路径，结合真实案例带你体验集群在项目中的实战应用。</p>
<hr/>
<h2 data-id="heading-25">5. 从单机到分布式的扩展实践</h2>
<p>搭建好Redis集群只是万里长征的第一步，如何从单机模式平滑过渡到分布式架构，并在实际项目中发挥其价值，才是开发者需要面对的真正考验。这一节，我将带你走一遍从单机到分布式的完整扩展路径，并结合两个真实项目案例，分享迁移步骤、优化方案和踩坑经验。希望这些实战内容能为你提供灵感。</p>
<h3 data-id="heading-26">扩展路径</h3>
<p>Redis的扩展并非一蹴而就，而是分阶段演进，每一步都针对特定需求：</p>
<ol>
<li>
<p><strong>单机到主从</strong><br/>
单机Redis性能有限时，第一步通常是配置主从复制。主节点负责写操作，从节点分担读请求，提升读性能。配置简单，只需在从节点配置文件中添加<code>replicaof &lt;master-ip&gt; &lt;master-port&gt;</code>。</p>
</li>
<li>
<p><strong>主从到哨兵（Sentinel）</strong><br/>
主从模式解决了读压力，但主节点宕机仍会导致服务中断。哨兵模式通过多个Sentinel进程监控节点状态，实现自动故障转移。配置哨兵只需指定主节点信息：</p>
<pre><code class="hljs language-conf" lang="conf">sentinel monitor mymaster 127.0.0.1 6379 2
</code></pre>
</li>
<li>
<p><strong>哨兵到集群</strong><br/>
当数据量和并发量进一步增长，哨兵模式仍受限于单主节点的容量。这时，Redis Cluster登场，通过分片解决容量瓶颈，同时保留高可用性。</p>
</li>
</ol>
<p><strong>路径示意图</strong>：</p>
<pre><code class="hljs language-css" lang="css">单机 --&gt; <span class="hljs-selector-attr">[主从复制]</span> --&gt; <span class="hljs-selector-attr">[哨兵高可用]</span> --&gt; <span class="hljs-selector-attr">[集群分布式]</span>
  |          |               |                 |
简单高效   读写分离       自动故障转移       容量与性能扩展
</code></pre>
<h3 data-id="heading-27">实际项目案例</h3>
<h4 data-id="heading-28">案例1：社交平台用户缓存迁移</h4>
<p>在一个社交平台项目中，我们最初使用单机Redis存储用户会话数据。随着用户量从10万增长到100万，单机内存告急，迁移到集群势在必行。<br/>
<strong>迁移步骤</strong>：</p>
<ol>
<li><strong>数据预分片</strong>：在新集群中预先分配槽，运行脚本将单机数据按键哈希分片导入。</li>
<li><strong>客户端切换</strong>：更新Java Jedis客户端为集群模式，逐步切换流量。<br/>
<strong>代码示例</strong>：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.HostAndPort;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisCluster;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisClusterExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Set&lt;HostAndPort&gt; nodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7000</span>));
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7001</span>));
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7002</span>));

        <span class="hljs-keyword">try</span> (<span class="hljs-type">JedisCluster</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(nodes)) {
            jedis.set(<span class="hljs-string">"user:123"</span>, <span class="hljs-string">"session_data"</span>);
            System.out.println(<span class="hljs-string">"Get user:123: "</span> + jedis.get(<span class="hljs-string">"user:123"</span>));
        }
    }
}
</code></pre>
<ul>
<li><strong>注释</strong>：<code>JedisCluster</code>自动处理槽定位和重定向，开发者无需手动干预。<br/>
<strong>结果</strong>：迁移后，系统容量提升3倍，响应时间稳定在1ms以内。</li>
</ul>
<h4 data-id="heading-29">案例2：实时排行榜系统优化</h4>
<p>在一个游戏排行榜系统中，单机Redis因热点Key（如全局排行榜）频繁更新而性能下降。我们迁移到集群并优化热点问题。<br/>
<strong>优化方案</strong>：</p>
<ol>
<li><strong>Key分片</strong>：将排行榜按用户ID分片（如<code>rank:user:123</code>），分散到不同槽。</li>
<li><strong>本地缓存</strong>：客户端引入Guava Cache缓存热点数据，减少Redis请求。<br/>
<strong>效果</strong>：热点节点QPS从10万降到2万，整体性能提升50%。</li>
</ol>
<h3 data-id="heading-30">踩坑经验</h3>
<ol>
<li>
<p><strong>MOVED/ASK重定向问题</strong><br/>
在迁移初期，部分客户端未正确处理集群返回的<code>MOVED</code>或<code>ASK</code>重定向，导致请求失败。<br/>
<strong>解决办法</strong>：确保客户端（如Jedis）支持集群模式，并配置合理的重试策略。<br/>
<strong>教训</strong>：迁移前要充分测试客户端兼容性。</p>
</li>
<li>
<p><strong>Pipeline使用的注意事项</strong><br/>
在集群模式下，Pipeline无法跨槽批量操作，否则会报错。<br/>
<strong>解决办法</strong>：将Pipeline操作拆分为单槽请求，或改用Lua脚本。<br/>
<strong>代码示例</strong>：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua脚本示例：批量操作同一槽的键</span>
<span class="hljs-keyword">local</span> keys = KEYS
<span class="hljs-keyword">for</span> i, key <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(keys) <span class="hljs-keyword">do</span>
    redis.call(<span class="hljs-string">'SET'</span>, key, ARGV[i])
<span class="hljs-keyword">end</span>
<span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>
</code></pre>
<ul>
<li><strong>注释</strong>：确保<code>KEYS</code>中的键属于同一槽，避免跨槽错误。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-31">示意图：从单机到集群的迁移</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[单机Redis]</span> --&gt; <span class="hljs-selector-attr">[数据导出]</span> --&gt; <span class="hljs-selector-attr">[集群预分片]</span> --&gt; <span class="hljs-selector-attr">[客户端切换]</span> --&gt; <span class="hljs-selector-attr">[Redis Cluster]</span>
   |                |               |                 |                 |
内存爆满         分片脚本        槽分配           JedisCluster      高可用扩展
</code></pre>
<hr/>
<h3 data-id="heading-32">对比表格：不同模式的适用场景</h3>



































<table><thead><tr><th><strong>模式</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>单机</td><td>简单、高性能</td><td>容量有限、单点故障</td><td>小型应用、测试环境</td></tr><tr><td>主从</td><td>读写分离</td><td>主节点仍有限制</td><td>中型读多写少场景</td></tr><tr><td>哨兵</td><td>高可用、自动切换</td><td>单主容量瓶颈</td><td>对可用性要求高的应用</td></tr><tr><td>集群</td><td>分布式、高扩展性</td><td>配置稍复杂</td><td>大规模、高并发系统</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-33">过渡段</h3>
<p>通过以上案例和经验，我们看到了Redis从单机到分布式的扩展路径，既有技术的渐进演化，也有实践中的摸索优化。但集群的潜力远不止于此，如何进一步挖掘其高级功能并优化性能，将是我们下一节的重点。让我们继续探索Redis集群的高级应用与优化技巧。</p>
<hr/>
<h2 data-id="heading-34">6. Redis集群的高级应用与优化</h2>
<p>Redis集群搭建完成并投入使用后，仅仅是迈出了分布式实践的第一步。要真正发挥它的潜力，我们需要在高级功能应用和性能优化上下功夫。这一节，我将分享一些集群模式下的进阶用法、优化技巧以及运维经验，帮助你在实际项目中将Redis集群“调教”得更出色。</p>
<h3 data-id="heading-35">高级功能应用</h3>
<ol>
<li>
<p><strong>Lua脚本在集群中的使用与限制</strong><br/>
Lua脚本是Redis的杀手锏之一，能原子化执行复杂逻辑。但在集群模式下，脚本中的所有键必须属于同一槽，否则会报错<code>CROSSSLOT</code>。<br/>
<strong>解决办法</strong>：使用哈希标签（Hash Tag），如<code>{user}.name</code>和<code>{user}.score</code>，确保键映射到同一槽。<br/>
<strong>代码示例</strong>：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 设置用户姓名和分数，确保同一槽</span>
<span class="hljs-keyword">local</span> name_key = KEYS[<span class="hljs-number">1</span>]  <span class="hljs-comment">-- {user:123}.name</span>
<span class="hljs-keyword">local</span> score_key = KEYS[<span class="hljs-number">2</span>] <span class="hljs-comment">-- {user:123}.score</span>
redis.call(<span class="hljs-string">'SET'</span>, name_key, ARGV[<span class="hljs-number">1</span>])
redis.call(<span class="hljs-string">'SET'</span>, score_key, ARGV[<span class="hljs-number">2</span>])
<span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>
</code></pre>
<ul>
<li><strong>注释</strong>：通过<code>{}</code>定义哈希标签，控制槽分配。</li>
</ul>
</li>
<li>
<p><strong>事务（MULTI/EXEC）的替代方案</strong><br/>
集群模式不支持跨槽的事务，传统的<code>MULTI/EXEC</code>受限。<br/>
<strong>替代方案</strong>：将事务逻辑改为Lua脚本，或通过客户端分步操作+补偿机制实现。<br/>
<strong>经验</strong>：对于简单逻辑，优先选择Lua，既高效又原子化。</p>
</li>
</ol>
<h3 data-id="heading-36">性能优化</h3>
<ol>
<li>
<p><strong>批量操作减少网络开销</strong><br/>
单次请求的网络延迟在集群中会被放大，批量操作是优化利器。<br/>
<strong>实践</strong>：用<code>MSET</code>替代多次<code>SET</code>，我在一个日志系统中将写入延迟从5ms降到1ms。<br/>
<strong>代码示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -p 7000 MSET key1 val1 key2 val2 key3 val3
</code></pre>
</li>
<li>
<p><strong>热点Key检测与分散</strong><br/>
热点Key会导致某节点负载过高。<br/>
<strong>解决办法</strong>：</p>
<ul>
<li>通过<code>redis-cli --hotkeys</code>检测热点。</li>
<li>将热点Key拆分为多个子Key（如<code>hotkey:part1</code>、<code>hotkey:part2</code>），分散请求。<br/>
<strong>效果</strong>：一个实时统计项目中，热点节点QPS从8万降到3万，负载均衡显著改善。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-37">监控与运维</h3>
<p>集群的稳定运行离不开监控。以下是几个常用指标和工具：</p>
<ul>
<li><strong>关键指标</strong>：
<ul>
<li><strong>槽分布</strong>：<code>cluster slots</code>检查是否均匀。</li>
<li><strong>节点延迟</strong>：通过<code>PING</code>测试响应时间。</li>
<li><strong>内存使用率</strong>：<code>INFO MEMORY</code>查看<code>used_memory</code>。</li>
</ul>
</li>
<li><strong>代码示例：Python监控脚本</strong>：
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis

<span class="hljs-keyword">def</span> <span class="hljs-title function_">monitor_cluster</span>(<span class="hljs-params">host, port</span>):
    r = redis.Redis(host=host, port=port)
    cluster_info = r.cluster_info()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Cluster State: <span class="hljs-subst">{cluster_info[<span class="hljs-string">'cluster_state'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Slots Assigned: <span class="hljs-subst">{cluster_info[<span class="hljs-string">'cluster_slots_assigned'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Known Nodes: <span class="hljs-subst">{cluster_info[<span class="hljs-string">'cluster_known_nodes'</span>]}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    monitor_cluster(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7000</span>)
</code></pre>
<ul>
<li><strong>注释</strong>：脚本定期检查集群状态，发现异常及时告警。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-38">最佳实践</h3>
<ol>
<li>
<p><strong>预分片降低扩容成本</strong><br/>
在一个广告系统项目中，我们预先部署了6个节点，但只使用3个主节点，槽分配留有余量。后来流量增长时，直接启用备用节点，迁移成本几乎为零。<br/>
<strong>建议</strong>：初期多部署节点，槽分配预留扩展空间。</p>
</li>
<li>
<p><strong>踩坑分享：连接池配置失误</strong><br/>
有一次因客户端连接池配置不当（最大连接数设为10），高峰期请求排队导致延迟激增。<br/>
<strong>解决办法</strong>：调整Jedis连接池参数：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
config.setMaxTotal(<span class="hljs-number">100</span>); <span class="hljs-comment">// 最大连接数</span>
config.setMaxIdle(<span class="hljs-number">20</span>);   <span class="hljs-comment">// 最大空闲连接</span>
</code></pre>
<p><strong>教训</strong>：连接池要根据QPS预估合理配置，避免成为瓶颈。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-39">示意图：热点Key分散策略</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[热点Key: <span class="hljs-string">"stats"</span>]</span> --&gt; 分散为 --&gt; <span class="hljs-selector-attr">[stats:part1]</span> <span class="hljs-selector-attr">[stats:part2]</span> <span class="hljs-selector-attr">[stats:part3]</span>
      |                                 |           |           |
    高负载                            节点<span class="hljs-selector-tag">A</span>       节点<span class="hljs-selector-tag">B</span>       节点C
</code></pre>
<p><strong>说明</strong>：将单一热点Key拆分，负载均匀分布到多个节点。</p>
<hr/>
<h3 data-id="heading-40">优化效果对比表格</h3>





























<table><thead><tr><th><strong>优化手段</strong></th><th><strong>优化前</strong></th><th><strong>优化后</strong></th><th><strong>效果</strong></th></tr></thead><tbody><tr><td>批量操作</td><td>5ms/次</td><td>1ms/次</td><td>延迟降低80%</td></tr><tr><td>热点Key分散</td><td>单节点8万QPS</td><td>各节点3万QPS</td><td>负载均衡提升60%</td></tr><tr><td>预分片扩容</td><td>迁移耗时2小时</td><td>迁移耗时5分钟</td><td>扩容效率提升95%</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-41">过渡段</h3>
<p>通过高级功能和优化技巧，Redis集群的性能和稳定性得到了进一步提升。但技术的价值最终体现在业务支持上。从单机到分布式的这条路，我们已经走了很远，接下来是时候总结经验，并展望Redis的未来发展了。最后一节，我们将回顾这段旅程，并给出实践建议。</p>
<hr/>
<h2 data-id="heading-42">7. 总结与展望</h2>
<p>从单机Redis的简单高效，到分布式集群的强大扩展，我们一路走来，见证了Redis如何从一匹独狼进化为一支协同作战的狼群。这篇文章带你穿越了从单机到分布式的技术演进之路，剖析了Redis Cluster的核心概念、搭建方法和优化实践。现在，让我们停下脚步，回顾这段旅程的收获，并展望Redis在未来的可能性。</p>
<h3 data-id="heading-43">总结</h3>
<p>Redis集群架构的核心价值可以用三个词概括：<strong>高性能、高可用、可扩展</strong>。它通过数据分片突破了单机内存的限制，用主从复制和故障转移保障了服务的稳定性，还以动态扩缩容为业务增长提供了无限可能。从单机到主从，再到哨兵和集群，每一步都在解决特定的痛点：</p>
<ul>
<li>单机模式适合小规模快速开发；</li>
<li>主从复制分担读压力；</li>
<li>哨兵模式提升可用性；</li>
<li>集群模式则为大规模、高并发场景量身定制。</li>
</ul>
<p>在我的10年Redis开发经历中，从早期单机优化到如今驾驭分布式集群，每一次转型都伴随着业务需求的驱动和技术能力的提升。无论是社交平台的用户缓存，还是游戏系统的实时排行榜，Redis集群都以其灵活性和可靠性，成为了不可或缺的基石。</p>
<h3 data-id="heading-44">实践建议</h3>
<p>基于这些经验，我为不同阶段的开发者提几点建议：</p>
<ol>
<li><strong>根据业务规模选择架构</strong>：小型项目用单机或主从即可，中大型系统尽早规划集群，避免后期迁移的麻烦。</li>
<li><strong>关注细节优化</strong>：槽分配、热点Key、连接池配置，这些“小事”往往决定集群的成败。</li>
<li><strong>持续学习新特性</strong>：Redis 7.0引入了多线程I/O和更强的集群管理功能，值得关注和尝试。</li>
</ol>
<h3 data-id="heading-45">展望</h3>
<p>Redis的未来发展与云原生和分布式系统的趋势紧密相连。随着容器化技术的普及，Redis Cluster在Kubernetes等平台上的部署将更加便捷，自动化运维也会成为标配。同时，Redis的模块化设计（如RedisJSON、RedisGraph）让它从单纯的键值存储进化成多功能数据平台，应用场景将进一步拓宽。<br/>
个人预测，未来Redis可能会在边缘计算和AI推理领域崭露头角，比如通过内存加速实时模型预测。这不仅是对性能的挑战，也是对分布式架构的新考验。</p>
<h3 data-id="heading-46">个人心得</h3>
<p>作为一名Redis老用户，我最大的感触是：技术没有银弹，Redis集群虽强大，但并非万能。它的成功应用离不开对业务的深刻理解和对细节的极致追求。每次踩坑都是一次成长，比如热点Key的优化让我学会了“分而治之”，而AOF的教训则提醒我“安全第一”。希望这篇文章能为你点亮一盏灯，无论是初探集群还是优化现有系统，都能少走弯路，多些信心。</p>
<hr/>
<h3 data-id="heading-47">总结表格：Redis演进路径价值</h3>






























<table><thead><tr><th><strong>阶段</strong></th><th><strong>核心价值</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>单机</td><td>简单高效</td><td>小型应用</td></tr><tr><td>主从</td><td>读写分离</td><td>中型读多写少系统</td></tr><tr><td>哨兵</td><td>高可用性</td><td>对中断敏感的应用</td></tr><tr><td>集群</td><td>分布式扩展</td><td>大规模高并发系统</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>