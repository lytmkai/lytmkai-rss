<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[NestJS 鉴权系统实战：从单Token到双Token架构的完整实现]]></title>    <link>https://juejin.cn/post/7600588379106263092</link>    <guid>https://juejin.cn/post/7600588379106263092</guid>    <pubDate>2026-01-29T15:27:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600588379106263092" data-draft-id="7600588379106246708" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS 鉴权系统实战：从单Token到双Token架构的完整实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-29T15:27:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无敌的拖拉斯旋风"/> <meta itemprop="url" content="https://juejin.cn/user/951508170179208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS 鉴权系统实战：从单Token到双Token架构的完整实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/951508170179208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无敌的拖拉斯旋风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:27:27.000Z" title="Thu Jan 29 2026 15:27:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在现代Web应用开发中，身份验证和授权是构建安全系统的基石。随着网络安全威胁日益增多，传统的单一Token机制已无法满足高安全性的需求。本文将详细介绍如何在NestJS框架中实现一个健壮的双Token鉴权系统，并分享我在开发过程中遇到的真实Bug调试经验。</p>
<h2 data-id="heading-1">1. JWT协议基础</h2>
<h3 data-id="heading-2">什么是JWT？</h3>
<p>JWT（JSON Web Token）是一种开放标准（RFC 7519），定义了一种紧凑且自包含的方式，用于在各方之间安全地传输信息作为JSON对象。这种信息可以通过数字签名进行验证和信任。</p>
<p>JWT通常由三部分组成：</p>
<ul>
<li><strong>Header</strong>: 包含令牌类型和签名算法</li>
<li><strong>Payload</strong>: 包含声明（claims）</li>
<li><strong>Signature</strong>: 用于验证消息完整性</li>
</ul>
<h3 data-id="heading-3">NestJS中的JWT实现</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 安装必要的包</span>
npm install <span class="hljs-meta">@nestjs</span>/jwt <span class="hljs-meta">@nestjs</span>/passport passport passport-jwt

<span class="hljs-comment">// JWT服务配置</span>
<span class="hljs-meta">@Module({
  imports: [
    JwtModule.register({
      secret: process.env.JWT_SECRET,
      signOptions: { expiresIn: <span class="hljs-string">'15m'</span> }, // 15分钟过期
    }),
  ],
  providers: [JwtService],
})</span>
export <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthModule</span> {}
</code></pre>
<h2 data-id="heading-4">2. 从单Token到双Token架构</h2>
<h3 data-id="heading-5">为什么要使用双Token机制？</h3>
<p>传统的单Token架构存在以下安全风险：</p>
<ul>
<li><strong>Token劫持风险</strong>：一旦Token被中间人捕获，攻击者可以在整个有效期内进行恶意操作</li>
<li><strong>长时间暴露</strong>：如果Token有效期设置较长，安全风险相应增加</li>
<li><strong>无法灵活控制</strong>：难以实现细粒度的权限管理</li>
</ul>
<h3 data-id="heading-6">双Token设计模式</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Token配置</span>
<span class="hljs-keyword">const</span> ACCESS_TOKEN_EXPIRES_IN = <span class="hljs-string">'15m'</span>;  <span class="hljs-comment">// 15分钟</span>
<span class="hljs-keyword">const</span> REFRESH_TOKEN_EXPIRES_IN = <span class="hljs-string">'7d'</span>;  <span class="hljs-comment">// 7天</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title">TokenPair</span> {
  accessToken: <span class="hljs-built_in">string</span>;
  refreshToken: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>Access Token</strong>（短期Token）：</p>
<ul>
<li>有效期短（如15分钟）</li>
<li>用于日常API请求的身份验证</li>
<li>即使被劫持，影响范围有限</li>
</ul>
<p><strong>Refresh Token</strong>（长期Token）：</p>
<ul>
<li>有效期长（如7天）</li>
<li>仅用于刷新Access Token</li>
<li>存储在安全位置（如HttpOnly Cookie）</li>
</ul>
<h2 data-id="heading-7">3. 实战：双Token生成与验证</h2>
<h3 data-id="heading-8">3.1 Token生成服务</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> jwtService: JwtService,
    <span class="hljs-keyword">private</span> userService: UserService,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-attr">credentials</span>: <span class="hljs-title class_">LoginDto</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TokenPair</span>&gt; {
    <span class="hljs-comment">// 验证用户凭据</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateUser</span>(credentials);
    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">'Invalid credentials'</span>);
    }

    <span class="hljs-comment">// 生成Token对</span>
    <span class="hljs-keyword">const</span> payload = { 
      <span class="hljs-attr">sub</span>: user.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>(), 
      <span class="hljs-attr">name</span>: user.<span class="hljs-property">name</span> 
    };

    <span class="hljs-keyword">const</span> [accessToken, refreshToken] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>(payload, { 
        <span class="hljs-attr">expiresIn</span>: <span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRES_IN</span> 
      }),
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>({
        ...payload,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'refresh'</span>
      }, { 
        <span class="hljs-attr">expiresIn</span>: <span class="hljs-variable constant_">REFRESH_TOKEN_EXPIRES_IN</span> 
      })
    ]);

    <span class="hljs-comment">// 存储Refresh Token（可选：存入数据库）</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">storeRefreshToken</span>(user.<span class="hljs-property">id</span>, refreshToken);

    <span class="hljs-keyword">return</span> {
      accessToken,
      refreshToken
    };
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">refreshTokens</span>(<span class="hljs-attr">refreshToken</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TokenPair</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 验证Refresh Token</span>
      <span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">verifyAsync</span>(refreshToken, {
        <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span>
      });

      <span class="hljs-comment">// 验证Token类型</span>
      <span class="hljs-keyword">if</span> (payload.<span class="hljs-property">type</span> !== <span class="hljs-string">'refresh'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">'Invalid token type'</span>);
      }

      <span class="hljs-comment">// 检查Token是否在数据库中存在（防重放攻击）</span>
      <span class="hljs-keyword">const</span> isValid = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateStoredRefreshToken</span>(payload.<span class="hljs-property">sub</span>, refreshToken);
      <span class="hljs-keyword">if</span> (!isValid) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">'Token not found or invalid'</span>);
      }

      <span class="hljs-comment">// 生成新的Token对</span>
      <span class="hljs-keyword">const</span> newPayload = { 
        <span class="hljs-attr">sub</span>: payload.<span class="hljs-property">sub</span>, 
        <span class="hljs-attr">name</span>: payload.<span class="hljs-property">name</span> 
      };

      <span class="hljs-keyword">const</span> [newAccessToken, newRefreshToken] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>(newPayload, { 
          <span class="hljs-attr">expiresIn</span>: <span class="hljs-variable constant_">ACCESS_TOKEN_EXPIRES_IN</span> 
        }),
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">jwtService</span>.<span class="hljs-title function_">signAsync</span>({
          ...newPayload,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'refresh'</span>
        }, { 
          <span class="hljs-attr">expiresIn</span>: <span class="hljs-variable constant_">REFRESH_TOKEN_EXPIRES_IN</span> 
        })
      ]);

      <span class="hljs-comment">// 更新存储的Refresh Token</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateRefreshToken</span>(payload.<span class="hljs-property">sub</span>, refreshToken, newRefreshToken);

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">accessToken</span>: newAccessToken,
        <span class="hljs-attr">refreshToken</span>: newRefreshToken
      };

    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">'Could not refresh token'</span>);
    }
  }
}
</code></pre>
<h3 data-id="heading-9">3.2 JWT策略配置</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtStrategy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PassportStrategy</span>(<span class="hljs-params"><span class="hljs-type">Strategy</span></span>) </span>{
  constructor(<span class="hljs-keyword">private</span> configService: <span class="hljs-type">ConfigService</span>) {
    <span class="hljs-keyword">super</span>({
      jwtFromRequest: <span class="hljs-type">ExtractJwt</span>.fromAuthHeaderAsBearerToken(),
      ignoreExpiration: <span class="hljs-literal">false</span>,
      secretOrKey: configService.get&lt;string&gt;('<span class="hljs-type">JWT_SECRET</span>'),
    });
  }

  async validate(payload: any) {
    <span class="hljs-comment">// 验证Token类型（确保是Access Token而非Refresh Token）</span>
    <span class="hljs-keyword">if</span> (payload.<span class="hljs-keyword">type</span> === 'refresh') {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">UnauthorizedException</span>('<span class="hljs-type">Invalid</span> token <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">for</span> <span class="hljs-title">access</span>')</span>;
    }

    <span class="hljs-keyword">return</span> { 
      userId: parseInt(payload.sub), 
      username: payload.name 
    };
  }
}
</code></pre>
<h2 data-id="heading-10">4. Guard机制：路由保护的守护者</h2>
<h3 data-id="heading-11">4.1 UseGuards装饰器</h3>
<p><code>UseGuards</code>是NestJS提供的装饰器，用于在控制器或路由处理方法上应用守卫。它会在路由处理方法执行前先执行Guard函数。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Controller</span>(<span class="hljs-string">'posts'</span>)
export class PostsController {
  <span class="hljs-selector-tag">constructor</span>(private <span class="hljs-attribute">postsService</span>: PostsService) {}

  <span class="hljs-variable">@UseGuards</span>(JwtAuthGuard) <span class="hljs-comment">// 应用JWT守卫</span>
  <span class="hljs-variable">@Post</span>()
  async <span class="hljs-built_in">createPost</span>(<span class="hljs-variable">@Body</span>() <span class="hljs-attribute">createPostDto</span>: CreatePostDto, <span class="hljs-variable">@Req</span>() req) {
    <span class="hljs-comment">// 只有通过验证的用户才能创建帖子</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.postsService</span><span class="hljs-selector-class">.createPost</span>(createPostDto, req.user.userId);
  }

  @<span class="hljs-selector-tag">UseGuards</span>(JwtAuthGuard)
  @<span class="hljs-selector-tag">Get</span>()
  <span class="hljs-selector-tag">async</span> <span class="hljs-selector-tag">getPosts</span>(<span class="hljs-variable">@Req</span>() req) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.postsService</span><span class="hljs-selector-class">.getUserPosts</span>(req.user.userId);
  }
}
</code></pre>
<h3 data-id="heading-12">4.2 自定义JWT守卫</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtAuthGuard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthGuard</span>(<span class="hljs-params">'jwt'</span>) </span>{
  canActivate(context: <span class="hljs-type">ExecutionContext</span>) {
    <span class="hljs-comment">// 调用父类的canActivate方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.canActivate(context);
  }

  handleRequest(err, user, info) {
    <span class="hljs-comment">// 处理验证结果</span>
    <span class="hljs-keyword">if</span> (err || !user) {
      <span class="hljs-keyword">throw</span> err || <span class="hljs-keyword">new</span> <span class="hljs-type">UnauthorizedException</span>('<span class="hljs-type">Authentication</span> failed');
    }
    <span class="hljs-keyword">return</span> user;
  }
}
</code></pre>
<h2 data-id="heading-13">5. 客户端集成：Axios请求拦截器</h2>
<h3 data-id="heading-14">5.1 请求拦截器</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// axios配置</span>
<span class="hljs-keyword">const</span> apiClient = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://localhost:3000/api'</span>,
});

<span class="hljs-comment">// 请求拦截器：自动添加Access Token</span>
apiClient.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'accessToken'</span>);
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 响应拦截器：处理Token过期</span>
apiClient.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response,
  <span class="hljs-keyword">async</span> (error) =&gt; {
    <span class="hljs-keyword">const</span> originalRequest = error.<span class="hljs-property">config</span>;

    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> === <span class="hljs-number">401</span> &amp;&amp; !originalRequest.<span class="hljs-property">_retry</span>) {
      originalRequest.<span class="hljs-property">_retry</span> = <span class="hljs-literal">true</span>;

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 使用Refresh Token刷新Access Token</span>
        <span class="hljs-keyword">const</span> refreshToken = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'refreshToken'</span>);
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/auth/refresh'</span>, {
          refreshToken
        });

        <span class="hljs-keyword">const</span> { accessToken } = response.<span class="hljs-property">data</span>;
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'accessToken'</span>, accessToken);

        <span class="hljs-comment">// 重新发起原请求</span>
        originalRequest.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${accessToken}</span>`</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">apiClient</span>(originalRequest);
      } <span class="hljs-keyword">catch</span> (refreshError) {
        <span class="hljs-comment">// 刷新失败，跳转到登录页</span>
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'accessToken'</span>);
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'refreshToken'</span>);
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(refreshError);
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h2 data-id="heading-15">6. 错误处理：优雅的异常响应</h2>
<h3 data-id="heading-16">6.1 NestJS内置异常类</h3>
<p>NestJS提供了丰富的HTTP异常类，用于处理不同类型的错误：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 常见的HTTP异常</span>
BadRequestException    <span class="hljs-comment">// 400 - 请求参数错误</span>
UnauthorizedException  <span class="hljs-comment">// 401 - 未授权</span>
ForbiddenException     <span class="hljs-comment">// 403 - 禁止访问  </span>
NotFoundException      <span class="hljs-comment">// 404 - 资源不存在</span>
InternalServerErrorException <span class="hljs-comment">// 500 - 服务器内部错误</span>
</code></pre>
<h3 data-id="heading-17">6.2 全局异常过滤器</h3>
<pre><code class="hljs language-ini" lang="ini">@Catch()
export class AllExceptionsFilter implements ExceptionFilter {
  catch(exception: any, host: ArgumentsHost) {
    const <span class="hljs-attr">ctx</span> = host.switchToHttp()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">response</span> = ctx.getResponse()<span class="hljs-comment">;</span>
    
    let status, message<span class="hljs-comment">;</span>
    
    if (exception instanceof HttpException) {
      <span class="hljs-attr">status</span> = exception.getStatus()<span class="hljs-comment">;</span>
      <span class="hljs-attr">message</span> = exception.getResponse()<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">status</span> = <span class="hljs-number">500</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">message</span> = {
        statusCode: 500,
        message: 'Internal server error',
        timestamp: new Date().toISOString(),
      }<span class="hljs-comment">;</span>
    }

    response.status(status).json(message)<span class="hljs-comment">;</span>
  }
}

// 在main.ts中注册
async function bootstrap() {
  const <span class="hljs-attr">app</span> = await NestFactory.create(AppModule)<span class="hljs-comment">;</span>
  app.useGlobalFilters(new AllExceptionsFilter())<span class="hljs-comment">;</span>
  await app.listen(3000)<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-18">7. 实战Bug调试：我的真实经历</h2>
<h3 data-id="heading-19">7.1 字段命名不一致导致的500错误</h3>
<p>在我开发过程中，遇到了一个典型的Bug：用户存在但创建帖子时返回500错误。</p>
<p><strong>错误日志</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Null</span> <span class="hljs-keyword">constraint</span> violation <span class="hljs-keyword">on</span> the fields: (<span class="hljs-string">'userId'</span>)
</code></pre>
<p><strong>问题分析</strong>：</p>
<ol>
<li>JWT Payload: <code>{ sub: '30', name: 'admin', ... }</code> ✓</li>
<li>User object: <code>{ id: 30, name: 'admin' }</code> ✓</li>
<li>但 <code>req.user.userId</code> 是 <code>undefined</code></li>
</ol>
<p><strong>根本原因</strong>：<br/>
JWT策略返回的字段名与Controller期望的不匹配</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误的字段名</span>
<span class="hljs-keyword">return</span> { id: payload.sub, name: payload.name };

<span class="hljs-comment">// ✅ 正确的字段名</span>
<span class="hljs-keyword">return</span> { userId: parseInt(payload.sub), username: payload.name };
</code></pre>
<p><strong>调试过程</strong>：</p>
<ol>
<li>添加详细的日志输出</li>
<li>检查JWT Token的有效性</li>
<li>验证字段命名的一致性</li>
<li>确认数据流向的每个环节</li>
</ol>
<h3 data-id="heading-20">7.2 Token验证失败的排查</h3>
<p><strong>错误信息</strong>：<code>Unknown authentication strategy "jwt"</code></p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>确保正确导入 <code>@nestjs/passport</code></li>
<li>检查JWT策略是否正确注册</li>
<li>验证Passport模块的配置</li>
</ol>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// app.module.ts</span>
<span class="hljs-variable">@Module</span>({
  <span class="hljs-attribute">imports</span>: [
    PassportModule,
    JwtModule.<span class="hljs-built_in">register</span>({
      <span class="hljs-attribute">secret</span>: process.env.JWT_SECRET,
    }),
  ],
  <span class="hljs-attribute">providers</span>: [
    AuthService,
    JwtStrategy, <span class="hljs-comment">// 确保注册策略</span>
  ],
})
export class AppModule {}
</code></pre>
<h2 data-id="heading-21">8. 性能优化：Promise.all的实际应用</h2>
<p>在实际项目中，经常需要并发执行多个异步操作。例如，在获取文章列表时同时获取总数：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Controller</span>(<span class="hljs-string">'posts'</span>)
export class PostsController {
  <span class="hljs-variable">@UseGuards</span>(JwtAuthGuard)
  <span class="hljs-variable">@Get</span>()
  async <span class="hljs-built_in">getPosts</span>(
    <span class="hljs-variable">@Query</span>(<span class="hljs-string">'page'</span>) page = <span class="hljs-number">1</span>,
    <span class="hljs-variable">@Query</span>(<span class="hljs-string">'limit'</span>) limit = <span class="hljs-number">10</span>,
    <span class="hljs-variable">@Req</span>() req
  ) {
    <span class="hljs-comment">// 使用Promise.all并行执行，提高性能</span>
    <span class="hljs-selector-tag">const</span> <span class="hljs-selector-attr">[posts, totalCount]</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">Promise</span><span class="hljs-selector-class">.all</span>([
      this.postsService.<span class="hljs-built_in">findMany</span>({
        <span class="hljs-attribute">where</span>: { <span class="hljs-attribute">userId</span>: req.user.userId },
        <span class="hljs-attribute">skip</span>: (page - <span class="hljs-number">1</span>) * limit,
        <span class="hljs-attribute">take</span>: limit,
      }),
      this.postsService.<span class="hljs-built_in">count</span>({ <span class="hljs-attribute">where</span>: { <span class="hljs-attribute">userId</span>: req.user.userId } })
    ]);

    <span class="hljs-selector-tag">return</span> {
      data: posts,
      pagination: {
        page: parseInt(page),
        limit: parseInt(limit),
        total: totalCount,
        pages: Math.ceil(totalCount / limit)
      }
    };
  }
}
</code></pre>
<h2 data-id="heading-22">9. 安全最佳实践</h2>
<h3 data-id="heading-23">9.1 Token存储安全</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 设置安全的Cookie选项</span>
res.<span class="hljs-built_in">cookie</span>(<span class="hljs-string">'refreshToken'</span>, refreshToken, {
  httpOnly: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 防止XSS攻击</span>
  secure: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// HTTPS only</span>
  sameSite: <span class="hljs-string">'strict'</span>,<span class="hljs-comment">// CSRF protection</span>
  maxAge: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 7天</span>
});
</code></pre>
<h3 data-id="heading-24">9.2 防重放攻击</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 验证Token是否已被使用</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">validateStoredRefreshToken</span>(<span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
  <span class="hljs-keyword">const</span> storedToken = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">refreshToken</span>.<span class="hljs-title function_">findFirst</span>({
    <span class="hljs-attr">where</span>: {
      userId,
      token,
      <span class="hljs-attr">expiresAt</span>: { <span class="hljs-attr">gt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() },
      <span class="hljs-attr">used</span>: <span class="hljs-literal">false</span>
    }
  });
  
  <span class="hljs-keyword">return</span> !!storedToken;
}
</code></pre>
<h2 data-id="heading-25">10. 总结</h2>
<p>通过本文的详细阐述，我们深入了解了NestJS中双Token鉴权系统的完整实现：</p>
<ol>
<li><strong>架构设计</strong>：双Token机制提供了更好的安全性</li>
<li><strong>技术实现</strong>：从Token生成到验证的完整流程</li>
<li><strong>错误处理</strong>：优雅的异常响应和调试技巧</li>
<li><strong>性能优化</strong>：合理使用并发提升用户体验</li>
<li><strong>安全实践</strong>：多种安全措施保障系统安全</li>
</ol>
<p>在实际开发中，安全性和用户体验往往需要平衡考虑。双Token机制虽然增加了系统复杂度，但显著提升了安全性。通过合理的架构设计和完善的错误处理，我们可以构建既安全又高效的Web应用。</p>
<p>记住，安全是一个持续的过程，需要不断地学习、实践和完善。希望这篇文章能为你的鉴权系统开发提供有价值的参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 作用域与提升（学习笔记）]]></title>    <link>https://juejin.cn/post/7600622206268817418</link>    <guid>https://juejin.cn/post/7600622206268817418</guid>    <pubDate>2026-01-29T14:32:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206268817418" data-draft-id="7600628279215570970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 作用域与提升（学习笔记）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-29T14:32:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户575730334624"/> <meta itemprop="url" content="https://juejin.cn/user/2860271309712009"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 作用域与提升（学习笔记）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2860271309712009/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户575730334624
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:32:13.000Z" title="Thu Jan 29 2026 14:32:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 作用域与提升：从函数作用域到块级作用域的演进</h2>
<p>在 JavaScript 的世界中，<strong>作用域（Scope）</strong> 和 <strong>提升（Hoisting）</strong> 是理解变量生命周期、函数行为以及内存管理的核心基础。本文将系统梳理 JavaScript 中的作用域机制（包括函数作用域与块级作用域）、变量/函数提升规则，并结合典型示例与最佳实践，帮助开发者写出更安全、可维护的代码。</p>
<hr/>
<h3 data-id="heading-1">一、提升（Hoisting）：JavaScript 的“编译阶段”行为</h3>
<p>JavaScript 引擎在执行代码前会经历一个<strong>编译阶段</strong>，用于收集变量和函数声明。这一过程导致了“提升”现象——<strong>声明被移动到其所在作用域的顶部</strong>，但赋值操作保留在原地。</p>
<h4 data-id="heading-2">1. 变量提升（<code>var</code>）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// undefined（不是报错！）</span>
<span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> a;           <span class="hljs-comment">// 声明被提升</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// undefined</span>
a = <span class="hljs-number">1</span>;           <span class="hljs-comment">// 赋值未提升</span>
</code></pre>
<ul>
<li><code>var</code> 声明会被提升到<strong>当前函数作用域</strong>顶部。</li>
<li>提升后变量初始化为 <code>undefined</code>，因此提前访问不会报错，但值不可用。</li>
</ul>
<h4 data-id="heading-3">2. 函数提升（Function Declaration）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// "Hello!" —— 可直接调用！</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello!"</span>);
}
</code></pre>
<ul>
<li><strong>函数声明（<code>function foo() {}</code>）会被完整提升（包括函数体）到当前函数作用域顶部</strong>。</li>
<li>这使得函数可以在声明前被调用。</li>
</ul>
<h4 data-id="heading-4">3. <code>let</code> / <code>const</code> 与暂时性死区（TDZ）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b); <span class="hljs-comment">// ReferenceError: Cannot access 'b' before initialization</span>
<span class="hljs-keyword">let</span> b = <span class="hljs-number">2</span>;
</code></pre>
<ul>
<li><code>let</code> 和 <code>const</code> 也会被“提升”，但在声明前处于 <strong>暂时性死区（Temporal Dead Zone, TDZ）</strong>。</li>
<li>在 TDZ 中访问变量会抛出 <code>ReferenceError</code>，强制开发者“先声明后使用”。</li>
</ul>
<blockquote>
<p>✅ <strong>关键总结</strong>：</p>
<ul>
<li><strong>函数作用域是第一作用域</strong>：提升只发生在当前函数作用域内，不会跨作用域。</li>
<li><code>var</code> 提升 → 值为 <code>undefined</code></li>
<li>函数声明提升 → 完整函数体可用</li>
<li><code>let</code>/<code>const</code> 提升 → TDZ，禁止提前访问</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-5">二、函数作用域：JavaScript 的传统作用域模型</h3>
<p>在 ES6 之前，JavaScript <strong>只有函数作用域</strong>。这意味着：</p>
<blockquote>
<p><strong>每声明一个函数，就自动创建一层新的作用域；其他结构（如 <code>if</code>、<code>for</code>）不会创建作用域。</strong></p>
</blockquote>
<h4 data-id="heading-6">示例解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>) {
    <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> c = <span class="hljs-number">2</span>;
    }
}
</code></pre>
<ul>
<li><code>foo</code> 创建了一个函数作用域，包含参数 <code>a</code> 和变量 <code>b</code>。</li>
<li><code>bar</code> 在 <code>foo</code> 内部声明，<strong>自身又创建了一个新的函数作用域</strong>，包含 <code>c</code>。</li>
<li><code>a</code>、<code>b</code>、<code>c</code> 均<strong>不能在全局作用域中访问</strong>，实现了封装。</li>
</ul>
<h4 data-id="heading-7">易错点提醒</h4>
<ul>
<li><code>var b</code> 的提升仅限于 <code>foo</code> 作用域顶部，不会影响全局。</li>
<li><code>bar</code> 的函数提升也仅限于 <code>foo</code> 作用域顶部，外部无法调用。</li>
</ul>
<hr/>
<h3 data-id="heading-8">三、隐藏内部实现：利用函数作用域实现私有化</h3>
<p>函数作用域的自包含特性，使其成为<strong>隐藏内部实现</strong>的理想工具，符合 <strong>最小特权原则</strong>（Least Privilege Principle）：</p>
<blockquote>
<p><strong>一个程序、用户或组件，只应拥有完成任务所必需的最小权限。</strong></p>
</blockquote>
<h4 data-id="heading-9">避免命名冲突</h4>
<p>当多个脚本或第三方库共存时，全局变量极易冲突：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 库 A</span>
<span class="hljs-keyword">var</span> config = { <span class="hljs-attr">url</span>: <span class="hljs-string">"api.a.com"</span> };

<span class="hljs-comment">// 库 B</span>
<span class="hljs-keyword">var</span> config = { <span class="hljs-attr">url</span>: <span class="hljs-string">"api.b.com"</span> }; <span class="hljs-comment">// 覆盖了 A！</span>
</code></pre>
<h5 data-id="heading-10">解决方案 1：全局命名空间</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 库 A</span>
<span class="hljs-keyword">var</span> <span class="hljs-title class_">LibA</span> = {
    <span class="hljs-attr">config</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">"api.a.com"</span> },
    <span class="hljs-attr">init</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
};

<span class="hljs-comment">// 库 B</span>
<span class="hljs-keyword">var</span> <span class="hljs-title class_">LibB</span> = {
    <span class="hljs-attr">config</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">"api.b.com"</span> },
    <span class="hljs-attr">start</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
};
</code></pre>
<p>→ 所有功能打包为对象属性，避免污染全局。</p>
<h5 data-id="heading-11">解决方案 2：模块管理（现代方案）</h5>
<p>使用 ES6 模块或 CommonJS，通过 <code>import</code>/<code>require</code> 显式导入依赖，天然隔离作用域。</p>
<hr/>
<h3 data-id="heading-12">四、函数表达式 vs 函数声明：私有化的演进</h3>
<p>虽然函数声明能创建作用域，但它本身会<strong>污染所在作用域</strong>（函数名可见）。而<strong>函数表达式</strong>提供了更灵活的私有化方式。</p>
<h4 data-id="heading-13">函数表达式的优点</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 匿名函数表达式作为 IIFE</span>
(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> privateVar = <span class="hljs-string">"secret"</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">privateFn</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
    <span class="hljs-comment">// 外部无法访问 privateVar 或 privateFn</span>
})();
</code></pre>
<ul>
<li>不创建额外的函数名标识符。</li>
<li>可立即执行，无需显式调用。</li>
</ul>
<h4 data-id="heading-14">函数表达式的弊端与解决</h4>





















<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>栈追踪无意义函数名</td><td>使用<strong>具名函数表达式</strong>：<code>const f = function meaningfulName() {}</code></td></tr><tr><td>无法递归引用自身</td><td>具名后可在内部调用 <code>meaningfulName()</code></td></tr><tr><td>可读性差</td><td>避免过度使用匿名函数；复杂逻辑提取为命名函数</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>行内函数表达式</strong>：强调“定义和使用在同一处”，常用于回调、事件处理等场景。</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">五、立即执行函数表达式（IIFE）：作用域隔离的经典模式</h3>
<p>IIFE（Immediately Invoked Function Expression）是利用函数表达式实现<strong>一次性私有作用域</strong>的典范。</p>
<h4 data-id="heading-16">基本语法</h4>
<pre><code class="hljs language-javascript" lang="javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 私有作用域</span>
})();
</code></pre>
<ul>
<li>第一个 <code>()</code>：将函数声明转为<strong>函数表达式</strong>。</li>
<li>第二个 <code>()</code>：<strong>立即调用</strong>该函数。</li>
</ul>
<h4 data-id="heading-17">箭头函数版 IIFE（ES6+）</h4>
<pre><code class="hljs language-javascript" lang="javascript">(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello, "</span> + name);
})(<span class="hljs-string">"Alice"</span>);
</code></pre>
<ul>
<li>同样创建私有作用域。</li>
<li>更简洁，但注意箭头函数无 <code>this</code> 和 <code>arguments</code>。</li>
</ul>
<h4 data-id="heading-18">IIFE 的用途</h4>
<ol>
<li><strong>避免全局污染</strong></li>
<li><strong>模拟私有变量</strong>（在无模块系统时）</li>
<li><strong>一次性初始化逻辑</strong></li>
</ol>
<blockquote>
<p>✅ <strong>最佳实践</strong>：即使在 ES6 模块时代，IIFE 在书签脚本、广告代码等单文件场景中仍非常实用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-19">六、块级作用域：ES6 的革命性改进</h3>
<p>ES6 引入 <code>let</code> 和 <code>const</code>，带来了真正的<strong>块级作用域（Block Scope）</strong>：</p>
<blockquote>
<p><strong>任何由 <code>{}</code> 包裹的代码块（如 <code>if</code>、<code>for</code>、<code>{}</code>）都能形成独立作用域。</strong></p>
</blockquote>
<h4 data-id="heading-20">经典问题：循环中的闭包</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// var 的问题</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i), <span class="hljs-number">100</span>); <span class="hljs-comment">// 输出 3,3,3</span>
}

<span class="hljs-comment">// let 的解决方案</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i), <span class="hljs-number">100</span>); <span class="hljs-comment">// 输出 0,1,2</span>
}
</code></pre>
<ul>
<li><code>let</code> 为每次循环迭代<strong>创建新的块级作用域</strong>，每个回调捕获自己的 <code>i</code>。</li>
</ul>
<h4 data-id="heading-21">块级作用域的其他形式</h4>
<ul>
<li><code>try...catch</code> 中的 <code>catch</code> 块</li>
<li><code>with</code> 语句（不推荐使用）</li>
<li>任意 <code>{}</code> 代码块</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> y = <span class="hljs-number">2</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// ReferenceError</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">七、垃圾收集与作用域</h3>
<p>JavaScript 的<strong>垃圾收集（Garbage Collection）</strong> 机制依赖<strong>可达性（Reachability）</strong> 判断对象是否可回收。</p>
<h4 data-id="heading-23">块级作用域助力内存管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"/>) {
    {
        <span class="hljs-keyword">let</span> bigData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>);
        <span class="hljs-comment">// 处理数据...</span>
    } <span class="hljs-comment">// bigData 超出块作用域 → 可被 GC 回收</span>
    <span class="hljs-comment">// 其他逻辑...</span>
}
</code></pre>
<ul>
<li>引擎能更早识别 <code>bigData</code> 不再需要，及时释放内存。</li>
<li>相比 <code>var</code>（函数作用域），<code>let</code>/<code>const</code> 让内存生命周期更精确。</li>
</ul>
<blockquote>
<p>⚠️ <strong>注意</strong>：闭包会阻止外部变量被回收。合理使用块作用域可减少不必要的闭包引用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-24">八、<code>var</code> vs <code>let</code> vs <code>const</code>：作用域与提升对比</h3>









































<table><thead><tr><th>特性</th><th><code>var</code></th><th><code>let</code></th><th><code>const</code></th></tr></thead><tbody><tr><td><strong>作用域</strong></td><td>函数作用域</td><td>块级作用域</td><td>块级作用域</td></tr><tr><td><strong>提升</strong></td><td>是（初始化为 <code>undefined</code>）</td><td>是（TDZ）</td><td>是（TDZ）</td></tr><tr><td><strong>重复声明</strong></td><td>允许</td><td>禁止</td><td>禁止</td></tr><tr><td><strong>重新赋值</strong></td><td>允许</td><td>允许</td><td>禁止（绑定不可变）</td></tr><tr><td><strong>全局属性</strong></td><td>是（如 <code>window.a</code>）</td><td>否</td><td>否</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>现代开发建议</strong>：</p>
<ul>
<li>默认使用 <code>const</code></li>
<li>需要重赋值时用 <code>let</code></li>
<li>彻底避免 <code>var</code></li>
</ul>
</blockquote>
<h3 data-id="heading-25">详见：文章：<a href="https://juejin.cn/post/7598127455133220864" target="_blank" title="https://juejin.cn/post/7598127455133220864">juejin.cn/post/759812…</a></h3>
<h3 data-id="heading-26">九、结语：从混乱到规范</h3>
<p>从 <code>var</code> 的函数作用域到 <code>let</code>/<code>const</code> 的块级作用域，JavaScript 完成了作用域模型的一次重要进化。这一变化不仅修复了历史遗留问题（如变量泄漏、循环闭包陷阱），更推动了开发者编写更安全、可预测的代码。</p>
<p><strong>记住口诀</strong>：</p>
<blockquote>
<p><code>const</code> 优先，不变就用它；<br/>
需要重赋值，<code>let</code> 来保驾；<br/>
<code>var</code> 已过时，坚决不使用；<br/>
作用域清晰，bug 远离我！</p>
</blockquote>
<p>掌握这些原理，你不仅能写出正确的代码，更能深入理解 JavaScript 的执行机制，为学习闭包、异步、模块化等高级主题打下坚实基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【React-4/Lesson79(2025-12-22)】React 组件化开发详解：Greeting、Card、Modal 的完整实践🧩]]></title>    <link>https://juejin.cn/post/7600663744192823332</link>    <guid>https://juejin.cn/post/7600663744192823332</guid>    <pubDate>2026-01-29T15:30:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744192823332" data-draft-id="7600606150733004843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【React-4/Lesson79(2025-12-22)】React 组件化开发详解：Greeting、Card、Modal 的完整实践🧩"/> <meta itemprop="keywords" content="React.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2026-01-29T15:30:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【React-4/Lesson79(2025-12-22)】React 组件化开发详解：Greeting、Card、Modal 的完整实践🧩
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:30:12.000Z" title="Thu Jan 29 2026 15:30:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🧩在现代前端工程中，React 以其声明式、组件化的思想成为构建用户界面的主流框架之一。本文将深入剖析一个典型 React 项目中的核心组件设计与实现，涵盖 <strong>Greeting</strong>、<strong>Card</strong> 和 <strong>Modal</strong> 三大组件，并结合样式、Props 校验、children 渲染机制、CSS-in-JS 与 CSS 模块化等关键知识点，全面展示 React 开发的最佳实践。</p>
<hr/>
<h2 data-id="heading-0">👋 Greeting 组件：Props 传递与默认值设定</h2>
<p><code>Greeting.jsx</code> 是一个典型的函数式组件，用于向用户打招呼。其核心在于 <strong>props 的接收与使用</strong>：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Greeting</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { name, message, showIcon } = props
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {showIcon &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>👋<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {name}!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-1">🔍 Props 解构与条件渲染</h3>
<ul>
<li>使用解构赋值从 <code>props</code> 中提取 <code>name</code>、<code>message</code> 和 <code>showIcon</code>。</li>
<li><code>showIcon &amp;&amp; &lt;span&gt;👋&lt;/span&gt;</code> 实现了<strong>条件渲染</strong>：只有当 <code>showIcon</code> 为 <code>true</code> 时才显示挥手 emoji。</li>
</ul>
<h3 data-id="heading-2">📦 PropTypes 与 defaultProps</h3>
<p>通过 <code>prop-types</code> 库进行类型校验和默认值设置：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title class_">Greeting</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>,
  <span class="hljs-attr">showIcon</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>
};

<span class="hljs-title class_">Greeting</span>.<span class="hljs-property">defaultProps</span> = {
  <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello, I am default message! Welcome to join ByteDance!'</span>,
  <span class="hljs-attr">showIcon</span>: <span class="hljs-literal">false</span>
};
</code></pre>
<blockquote>
<p>⚠️ 注意：原文中 <code>defaultProps</code> 被错误地写在了 <code>propTypes</code> 内部（如 <code>message: PropTypes.string.defaultProps = ...</code>），这是语法错误。正确做法是<strong>单独定义 <code>defaultProps</code> 对象</strong>，如上所示。</p>
</blockquote>
<h3 data-id="heading-3">✅ 最佳实践建议</h3>
<ul>
<li>所有非必需 prop 都应提供 <code>defaultProps</code>。</li>
<li>必需 prop 使用 <code>.isRequired</code> 明确约束。</li>
<li>在开发环境下，PropTypes 会在控制台输出警告，帮助开发者快速定位问题。</li>
</ul>
<hr/>
<h2 data-id="heading-4">🃏 Card 组件：样式封装与 children 复用</h2>
<p><code>Card.jsx</code> 展示了如何构建一个<strong>可复用的 UI 容器组件</strong>：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Card</span> = (<span class="hljs-params">{ children, className = <span class="hljs-string">''</span> }</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">card</span> ${<span class="hljs-attr">className</span>}`}&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<h3 data-id="heading-5">🎨 样式来源：CSS 模块化</h3>
<p>配套的 <code>Card.css</code> 提供了完整的视觉样式：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffffff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">4px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.15</span>);
}
</code></pre>
<h3 data-id="heading-6">🔁 children 模式：高度灵活的内容注入</h3>
<ul>
<li><code>children</code> 是 React 的特殊 prop，代表组件标签之间的内容。</li>
<li>在 <code>App.jsx</code> 中使用：</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Card</span> className=<span class="hljs-string">"user-card"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>小王<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>AI+全栈工程师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Card</span>&gt;
</code></pre>
<p>这使得 <code>Card</code> 成为一个<strong>布局容器</strong>，内部结构完全由使用者决定，极大提升复用性。</p>
<h3 data-id="heading-7">🧱 为什么用 <code>className</code> 而不是 <code>class</code>？</h3>
<ul>
<li>JSX 是 JavaScript 的语法扩展，最终编译为 <code>React.createElement()</code>。</li>
<li><code>class</code> 是 JavaScript 保留关键字，因此在 JSX 中必须使用 <code>className</code>。</li>
<li>这是 React 的约定，所有 DOM 属性在 JSX 中都采用驼峰命名（如 <code>onClick</code>, <code>tabIndex</code>）。</li>
</ul>
<hr/>
<h2 data-id="heading-8">🪟 Modal 组件：高阶组件组合与自定义头部/底部</h2>
<p><code>Modal.jsx</code> 是一个<strong>复合型弹窗组件</strong>，展示了如何通过 props 传入自定义组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">HeaderComponent</span>, <span class="hljs-title class_">FooterComponent</span>, children } = props
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.overlay}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.modal}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">HeaderComponent</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.content}</span>&gt;</span>
          {children}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">FooterComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-9">🧩 组件作为 Prop 传递</h3>
<ul>
<li><code>HeaderComponent</code> 和 <code>FooterComponent</code> 是函数组件（无状态组件）。</li>
<li>在 <code>App.jsx</code> 中定义并传入：</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyHeader</span> = (<span class="hljs-params"/>) =&gt; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> <span class="hljs-attr">0</span>, <span class="hljs-attr">color:</span> '<span class="hljs-attr">blue</span>' }}&gt;</span>自定义标题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyFooter</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">right</span>', <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> alert('关闭')} style={{ backgroundColor: 'pink' }}&gt;
      关闭
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
)

<span class="hljs-comment">// 使用</span>
&lt;<span class="hljs-title class_">Modal</span> <span class="hljs-title class_">HeaderComponent</span>={<span class="hljs-title class_">MyHeader</span>} <span class="hljs-title class_">FooterComponent</span>={<span class="hljs-title class_">MyFooter</span>}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>你可以在这里显示任何JSX<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Modal</span>&gt;
</code></pre>
<blockquote>
<p>💡 注意：<code>HeaderComponent</code> 和 <code>FooterComponent</code> 是<strong>组件类型（函数）</strong> ，不是 JSX 元素（即不是 <code>&lt;MyHeader /&gt;</code>）。因此在 Modal 内部需以 <code>&lt;HeaderComponent /&gt;</code> 形式调用。</p>
</blockquote>
<h3 data-id="heading-10">🎨 CSS-in-JS 实现样式隔离</h3>
<p><code>Modal</code> 使用内联样式对象（CSS-in-JS 模式）：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> styles = {
  <span class="hljs-attr">overlay</span>: {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.5)'</span>,
    <span class="hljs-attr">position</span>: <span class="hljs-string">'fixed'</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">display</span>: <span class="hljs-string">'flex'</span>,
    <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>
  },
  <span class="hljs-attr">modal</span>: {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'white'</span>,
    <span class="hljs-attr">padding</span>: <span class="hljs-string">'1rem'</span>,
    <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'8px'</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-string">'400px'</span>
  },
  <span class="hljs-attr">content</span>: {
    <span class="hljs-attr">margin</span>: <span class="hljs-string">'1rem 0'</span>
  }
}
</code></pre>
<h4 data-id="heading-11">✅ CSS-in-JS 优缺点</h4>
<ul>
<li><strong>优点</strong>：样式与组件逻辑紧耦合，避免全局污染；支持动态样式（如根据 props 改变颜色）。</li>
<li><strong>缺点</strong>：无法使用伪类（<code>:hover</code>）、媒体查询较繁琐（需额外库如 styled-components）；性能略低于原生 CSS。</li>
</ul>
<hr/>
<h2 data-id="heading-12">🏗️ App.jsx：组件组合的“乐高积木”</h2>
<p><code>App.jsx</code> 是整个应用的根组件，体现了 <strong>“组合优于继承”</strong> 的 React 哲学：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"王老板"</span> <span class="hljs-attr">message</span>=<span class="hljs-string">"欢迎加入字节！！！"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"王员工"</span> <span class="hljs-attr">message</span>=<span class="hljs-string">"欢迎加入阿里！！！"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"小王"</span> <span class="hljs-attr">message</span>=<span class="hljs-string">"欢迎加入字节！！！"</span> <span class="hljs-attr">showIcon</span> /&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>小王<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>AI+全栈工程师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-13">🔗 组件通信：单向数据流</h3>
<ul>
<li>父组件（App）持有数据（如 <code>name</code>, <code>message</code>）。</li>
<li>通过 props 向子组件（Greeting, Card）传递数据。</li>
<li>子组件<strong>不能直接修改 props</strong>，若需交互（如 Modal 关闭），需通过回调函数（callback）通知父组件。</li>
</ul>
<blockquote>
<p>📌 虽然当前 Modal 的关闭按钮使用 <code>alert</code>，但在真实场景中应通过 <code>onClose</code> prop 触发父组件的状态更新（如 <code>setIsOpen(false)</code>）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">🛠️ 工程结构与协作规范</h2>
<p>根据 <code>readme.md</code> 的提示，项目遵循以下规范：</p>
<ul>
<li>
<p><strong>组件分类</strong>：</p>
<ul>
<li><code>components/</code>：通用 UI 组件（如 Greeting, Card, Modal）</li>
<li><code>pages/</code>：页面级组件（未展示，但通常包含路由和业务逻辑）</li>
</ul>
</li>
<li>
<p><strong>最小开发单元</strong>：每个组件是一个独立功能块，可像“乐高积木”一样拼装。</p>
</li>
<li>
<p><strong>协作方式</strong>：通过清晰的 props 接口定义，团队成员可并行开发不同组件。</p>
</li>
</ul>
<h3 data-id="heading-15">📦 依赖管理</h3>
<ul>
<li>
<p>使用 <code>prop-types</code> 进行运行时类型检查：</p>
<pre><code class="hljs language-csharp" lang="csharp">npm install prop-types
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> prop-types
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-16">🌐 全局样式与响应式设计</h2>
<p><code>index.css</code> 和 <code>App.css</code> 提供了基础样式：</p>
<h3 data-id="heading-17">🎨 主题与色彩</h3>
<ul>
<li>使用 <code>:root</code> 定义全局变量（虽未显式使用 CSS 变量，但设置了字体、颜色等）。</li>
<li>支持 <strong>prefers-color-scheme</strong> 媒体查询，自动适配系统亮/暗模式。</li>
</ul>
<h3 data-id="heading-18">📱 响应式布局</h3>
<ul>
<li><code>body</code> 使用 <code>min-height: 100vh</code> 和 <code>place-items: center</code> 实现垂直水平居中。</li>
<li><code>Card</code> 设置 <code>max-width: 400px</code> 和 <code>margin: 16px auto</code> 确保在移动端良好显示。</li>
</ul>
<hr/>
<h2 data-id="heading-19">🔚 总结：React 组件化的核心思想</h2>
<ol>
<li><strong>单一职责</strong>：每个组件只做一件事（Greeting 负责打招呼，Card 负责卡片布局）。</li>
<li><strong>可组合性</strong>：通过 <code>children</code> 和组件作为 prop，实现灵活嵌套。</li>
<li><strong>可配置性</strong>：通过 props 控制行为和外观（如 <code>showIcon</code>, <code>className</code>）。</li>
<li><strong>可维护性</strong>：样式隔离（CSS 模块 / CSS-in-JS）、类型校验（PropTypes）降低 bug 风险。</li>
<li><strong>工程化思维</strong>：目录结构清晰，组件分层，便于团队协作与长期迭代。</li>
</ol>
<p>通过以上实践，我们不仅构建了功能完整的 UI 组件，更掌握了 React 开发的底层逻辑与工程方法论。未来可进一步引入 <strong>Hooks（useState/useEffect）</strong> 管理状态、<strong>Context</strong> 实现跨层级通信、<strong>TypeScript</strong> 替代 PropTypes 实现编译期类型安全，持续提升代码质量与开发体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《Vue.js前端开发实战》学习笔记 第2章 单文件组件、数据绑定]]></title>    <link>https://juejin.cn/post/7600588379106230324</link>    <guid>https://juejin.cn/post/7600588379106230324</guid>    <pubDate>2026-01-29T15:07:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600588379106230324" data-draft-id="7600600904095416354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《Vue.js前端开发实战》学习笔记 第2章 单文件组件、数据绑定"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-29T15:07:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="滕青山"/> <meta itemprop="url" content="https://juejin.cn/user/3206601805674094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《Vue.js前端开发实战》学习笔记 第2章 单文件组件、数据绑定
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3206601805674094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    滕青山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:07:39.000Z" title="Thu Jan 29 2026 15:07:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、单文件组件（.vue）核心定义与结构</h2>
<p>每个<code>.vue</code>文件对应一个Vue单文件组件，是Vue组件的专属文件格式，由<strong>模板、样式、逻辑</strong>三部分构成，各部分各司其职且结构固定。</p>
<h3 data-id="heading-1">1. 三大组成部分说明</h3>





























<table><thead><tr><th>组成部分</th><th>对应标签</th><th>核心功能</th><th>关键注意点</th></tr></thead><tbody><tr><td>模板</td><td><code>&lt;template&gt;</code></td><td>搭建当前组件的DOM结构，仅作为包裹容器，不会被渲染为真实DOM元素</td><td>每个组件最多1个顶层<code>&lt;template&gt;</code>；Vue3支持<strong>多根节点</strong>，Vue2仅支持<strong>单根节点</strong>（必须有唯一外层根标签包裹）</td></tr><tr><td>样式</td><td><code>&lt;style&gt;</code></td><td>通过CSS代码为当前组件设置样式</td><td>可添加<code>scoped</code>属性实现组件样式隔离，避免样式污染</td></tr><tr><td>逻辑</td><td><code>&lt;script&gt;</code></td><td>通过JavaScript代码处理组件的数据定义、业务逻辑</td><td>Vue3提供<code>setup</code>语法糖，简化数据和方法的定义与暴露</td></tr></tbody></table>
<h2 data-id="heading-2">二、数据绑定核心内容</h2>
<p>Vue通过数据绑定实现<strong>数据与页面分离</strong>，最终达成<strong>数据驱动视图</strong>的效果，核心解决重复编写页面模板的问题（如图书商城复用图书详情页模板，仅修改数据展示不同内容）。
数据绑定分为<strong>定义数据</strong>和<strong>输出数据</strong>两个核心步骤，且普通数据无响应式，需通过专属函数处理为响应式数据，才能实现数据变化视图同步更新。</p>
<h3 data-id="heading-3">1. 初识数据绑定</h3>
<h4 data-id="heading-4">1.1 定义数据</h4>
<p>Vue3提供<strong>基础写法</strong>和<strong>setup语法糖写法</strong>（推荐），语法糖可大幅简化代码，提高开发效率。</p>
<h5 data-id="heading-5">写法1：基础写法（setup函数）</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script&gt;
export default {
	setup() {
		return {
			数据名: 数据值,
			// 可定义多个数据，以键值对形式存在
			...
		}
	}
}
&lt;/script&gt;
</code></pre>
<ul>
<li>核心要点：<code>export default</code>是模块导出语法；<code>setup()</code>是Vue3组合式API的起点，需通过<code>return</code>暴露数据给模板；组件实例创建时执行该代码。</li>
</ul>
<h5 data-id="heading-6">写法2：setup语法糖写法（推荐）</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 直接定义变量即可，无需export和return，自动暴露给模板
const 数据名 = 数据值;
&lt;/script&gt;
</code></pre>
<ul>
<li>核心要点：在<code>&lt;script&gt;</code>标签添加<code>setup</code>属性即可使用，代码更简洁，是Vue3开发首选方式。</li>
</ul>
<h4 data-id="heading-7">1.2 输出数据</h4>
<p>使用Vue提供的<strong>Mustache语法（双大括号语法）</strong>，在<code>&lt;template&gt;</code>中作为占位符，页面渲染时会被替换为实际数据。</p>
<h5 data-id="heading-8">基本语法</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  {{ 数据名 }}
&lt;/template&gt;
</code></pre>
<h5 data-id="heading-9">支持的表达式类型</h5>
<p>Mustache语法可直接解析表达式，返回结果作为输出内容，示例如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  {{ 'Hello Vue.js' }}       &lt;!-- 字符串表达式 --&gt;
  {{ number + 1 }}            &lt;!-- 算术运算表达式 --&gt;
  {{ obj.name }}              &lt;!-- 对象属性取值表达式 --&gt;
  {{ ok ? 'YES' : 'NO' }}     &lt;!-- 三元运算符表达式 --&gt;
  {{ '&lt;div&gt;HTML标签&lt;/div&gt;' }} &lt;!-- HTML字符串（会被当作纯文本输出，不解析标签） --&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-10">1.3 基础数据绑定实操示例</h4>
<p><strong>步骤1</strong>：创建<code>src\components\Message.vue</code>文件，编写代码</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;{{ message }}&lt;/template&gt;
&lt;script setup&gt;
const message = '不积跬步,无以至千里'
&lt;/script&gt;
</code></pre>
<p><strong>步骤2</strong>：修改<code>src\main.js</code>文件，切换展示组件</p>
<pre><code class="hljs language-vue" lang="vue">import { createApp } from 'vue'
import './style.css'
// 替换为自定义的Message组件
import App from './components/Message.vue'

createApp(App).mount('#app')
</code></pre>
<h3 data-id="heading-11">2. 响应式数据绑定</h3>
<h4 data-id="heading-12">2.1 普通数据的问题</h4>
<p>直接定义的普通数据，修改后<strong>数据本身会变化，但页面视图不会同步更新</strong>，示例验证如下：
修改<code>src\components\Message.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;{{ message }}&lt;/template&gt;
&lt;script setup&gt;
let message = '不积跬步,无以至千里'
// 2秒后修改数据
setTimeout(() =&gt; {
    console.log("更新前的message:" + message)
    message = '长风破浪会有时, 直挂云帆济沧海'
    console.log('更新后的message:' + message)
}, 2000)
&lt;/script&gt;
</code></pre>
<ul>
<li>控制台：能打印出更新前、后的数据值，说明数据本身已修改；</li>
<li>页面：始终显示原始数据，说明视图未同步更新。</li>
</ul>
<h4 data-id="heading-13">2.2 响应式数据定义函数</h4>
<p>Vue3提供<code>ref()</code>、<code>reactive()</code>、<code>toRef()</code>、<code>toRefs()</code>四个函数，用于将普通数据处理为<strong>响应式数据</strong>，实现<strong>数据变化 → 视图自动同步更新</strong>，四个函数适用场景不同，需按需选择。</p>
<h5 data-id="heading-14">函数1：ref()</h5>
<ul>
<li><strong>作用</strong>：将<strong>基本类型数据/引用类型数据</strong>转换为响应式数据，是Vue3中最常用的响应式函数；</li>
<li><strong>语法</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入ref函数</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 定义响应式数据</span>
<span class="hljs-keyword">const</span> 响应式数据 = <span class="hljs-title function_">ref</span>(初始数据值)
<span class="hljs-comment">// 修改响应式数据（必须通过.value属性）</span>
响应式数据.<span class="hljs-property">value</span> = 新值
</code></pre>
</li>
<li><strong>实操示例</strong>：
① 创建<code>src\components\Ref.vue</code>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;{{ message }}&lt;/template&gt;
&lt;script setup&gt;
// 导入ref函数
import { ref } from 'vue'
// 定义ref响应式数据
const message = ref('会当凌绝顶,一览众山小')
// 2秒后修改数据
setTimeout(() =&gt; {
    message.value = '锲而不舍,金石可镂'
}, 2000)
&lt;/script&gt;
</code></pre>
② 修改<code>src\main.js</code>切换组件
<pre><code class="hljs language-vue" lang="vue">import App from './components/Ref.vue'
</code></pre>
</li>
</ul>
<h5 data-id="heading-15">函数2：reactive()</h5>
<ul>
<li><strong>作用</strong>：专门创建<strong>响应式对象/响应式数组</strong>，仅支持引用类型（对象、数组），不支持基本类型；</li>
<li><strong>语法</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入reactive函数</span>
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 定义响应式对象/数组</span>
<span class="hljs-keyword">const</span> 响应式对象 = <span class="hljs-title function_">reactive</span>(普通对象/普通数组)
<span class="hljs-comment">// 修改响应式数据（直接修改属性/元素，无需.value）</span>
响应式对象.属性名 = 新值
</code></pre>
</li>
<li><strong>实操示例</strong>：
① 创建<code>src\components\Reactive.vue</code>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;{{ obj.message }}&lt;/template&gt;
&lt;script setup&gt;
// 导入reactive函数
import { reactive } from 'vue'
// 定义reactive响应式对象
const obj = reactive({ message: '不畏浮云遮望眼,自缘身在最高层' })
// 2秒后修改数据
setTimeout(() =&gt; {
    obj.message = '欲穷千里目,更上一层楼'
}, 2000)
&lt;/script&gt;
</code></pre>
② 修改<code>src\main.js</code>切换组件
<pre><code class="hljs language-vue" lang="vue">import App from './components/Reactive.vue'
</code></pre>
</li>
</ul>
<h5 data-id="heading-16">函数3：toRef()</h5>
<ul>
<li><strong>作用</strong>：将<strong>响应式对象中的单个属性</strong>转换为独立的响应式数据，修改该数据会同步更新原响应式对象；</li>
<li><strong>语法</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入reactive、toRef函数</span>
<span class="hljs-keyword">import</span> { reactive, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 先定义基础响应式对象</span>
<span class="hljs-keyword">const</span> 响应式对象 = <span class="hljs-title function_">reactive</span>({ 属性<span class="hljs-number">1</span>: 值<span class="hljs-number">1</span>, 属性<span class="hljs-number">2</span>: 值<span class="hljs-number">2</span> })
<span class="hljs-comment">// 将单个属性转为响应式数据</span>
<span class="hljs-keyword">const</span> 响应式属性 = <span class="hljs-title function_">toRef</span>(响应式对象, <span class="hljs-string">'属性名'</span>)
<span class="hljs-comment">// 修改数据（需通过.value）</span>
响应式属性.<span class="hljs-property">value</span> = 新值
</code></pre>
</li>
<li><strong>实操示例</strong>：
① 创建<code>src\components\ToRef.vue</code>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
    &lt;div&gt;message的值:{{ message }}&lt;/div&gt;
    &lt;div&gt;obj.message的值:{{ obj.message }}&lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
// 导入所需函数
import { reactive, toRef } from 'vue'
// 定义基础响应式对象
const obj = reactive({ message: '黑发不知勤学早,白首方悔读书迟' })
// 将obj的message属性转为独立响应式数据
const message = toRef(obj, 'message')
// 2秒后修改数据
setTimeout(() =&gt; {
    message.value = '少壮不努力,老大徒伤悲'
}, 2000)
&lt;/script&gt;
</code></pre>
② 修改<code>src\main.js</code>切换组件
<pre><code class="hljs language-vue" lang="vue">import App from './components/ToRef.vue'
</code></pre>
</li>
</ul>
<h5 data-id="heading-17">函数4：toRefs()</h5>
<ul>
<li><strong>作用</strong>：将<strong>响应式对象中的所有属性</strong>一次性转换为独立的响应式数据，返回一个包含所有响应式属性的对象，可通过解构赋值快速使用，修改属性会同步更新原响应式对象；</li>
<li><strong>语法</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入reactive、toRefs函数</span>
<span class="hljs-keyword">import</span> { reactive, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 先定义基础响应式对象</span>
<span class="hljs-keyword">const</span> 响应式对象 = <span class="hljs-title function_">reactive</span>({ 属性<span class="hljs-number">1</span>: 值<span class="hljs-number">1</span>, 属性<span class="hljs-number">2</span>: 值<span class="hljs-number">2</span> })
<span class="hljs-comment">// 将所有属性转为响应式数据，解构赋值获取</span>
<span class="hljs-keyword">const</span> { 属性<span class="hljs-number">1</span>, 属性<span class="hljs-number">2</span> } = <span class="hljs-title function_">toRefs</span>(响应式对象)
<span class="hljs-comment">// 修改数据（需通过.value）</span>
属性<span class="hljs-number">1.</span>value = 新值
</code></pre>
</li>
<li><strong>实操示例</strong>：
① 创建<code>src\components\ToRefs.vue</code>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
    &lt;div&gt;message的值:{{ message }}&lt;/div&gt;
    &lt;div&gt;obj.message的值:{{ obj.message }}&lt;/div&gt;
&lt;/template&gt;
&lt;script setup&gt;
// 导入所需函数
import { reactive, toRefs } from 'vue'
// 定义基础响应式对象
const obj = reactive({ message: '盛年不重来,一日难再晨' })
// 将obj的所有属性转为响应式数据，解构获取message
let { message } = toRefs(obj)
// 2秒后修改数据
setTimeout(() =&gt; {
    message.value = '及时当勉励,岁月不待人'
}, 2000)
&lt;/script&gt;
</code></pre>
② 修改<code>src\main.js</code>切换组件
<pre><code class="hljs language-vue" lang="vue">import App from './components/ToRefs.vue'
</code></pre>
</li>
</ul>
<h2 data-id="heading-18">三、核心知识点总结</h2>
<h3 data-id="heading-19">1. 单文件组件关键</h3>
<ol>
<li>Vue3 对<code>&lt;template&gt;</code>的根节点限制放宽，支持多根节点，解决Vue2外层根标签的冗余问题；</li>
<li><code>&lt;script setup&gt;</code>是Vue3推荐写法，无需<code>export default</code>和<code>return</code>，直接定义数据/方法即可暴露给模板；</li>
<li><code>&lt;style scoped&gt;</code>是组件样式隔离的核心方式，开发中建议默认添加。</li>
</ol>
<h3 data-id="heading-20">2. 数据绑定关键</h3>
<ol>
<li>基础数据绑定通过**定义数据（setup）+ 输出数据（双大括号）**实现，仅能完成数据的初始展示；</li>
<li>Mustache语法支持各类简单表达式，但会将HTML字符串解析为纯文本，无法渲染DOM。</li>
</ol>
<h3 data-id="heading-21">3. 响应式数据核心</h3>
<ol>
<li>响应式是Vue数据驱动视图的<strong>核心底层</strong>，普通数据需通过Vue3专属函数处理后才具备响应式；</li>
<li><code>ref()</code>是通用响应式函数，支持所有数据类型，修改时<strong>必须加.value</strong>（模板中使用无需加）；</li>
<li><code>reactive()</code>仅支持对象/数组，修改时直接操作属性/元素，<strong>无需.value</strong>；</li>
<li><code>toRef()</code>和<code>toRefs()</code>基于<strong>已有响应式对象</strong>创建，用于拆分对象属性，实现属性的独立响应式，修改后会同步更新原对象；</li>
<li>所有响应式函数使用前<strong>必须先从vue中导入</strong>，否则会报错。</li>
</ol>
<h3 data-id="heading-22">4. 开发实操注意</h3>
<ol>
<li>切换组件的核心方式是修改<code>src\main.js</code>中<code>import App from 'xxx'</code>的导入路径；</li>
<li>定时器是验证响应式的常用方式，可直观看到数据和视图的更新效果；</li>
<li>开发中优先使用<code>setup</code>语法糖，简化代码编写；优先使用<code>ref()</code>定义响应式数据，通用性更强。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React19 渲染流程]]></title>    <link>https://juejin.cn/post/7600663744192888868</link>    <guid>https://juejin.cn/post/7600663744192888868</guid>    <pubDate>2026-01-29T15:43:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744192888868" data-draft-id="7600663744192872484" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React19 渲染流程"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-29T15:43:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秀秀不只会前端"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React19 渲染流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秀秀不只会前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:43:06.000Z" title="Thu Jan 29 2026 15:43:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、React 渲染架构</h2>
<p>底层渲染流程大致可以分为两大阶段：render 阶段（Scheduler -&gt; Reconciler）、commit 阶段（Renderer）</p>
<blockquote>
<p>注意这里的 render 阶段和 Renderer 渲染器是两个东西！！！</p>
</blockquote>
<p>主要的阶段可以总结为两个公式：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reconcile</span>(update); <span class="hljs-comment">// 通过 reconciler 计算出最新的状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">UI</span> = <span class="hljs-title function_">commit</span>(state); <span class="hljs-comment">// 通过最新的 state 渲染出 UI</span>
</code></pre>
<h2 data-id="heading-1">二、调度器（Scheduler）：渲染的入口与优先级控制</h2>
<blockquote>
<p>Scheduler 类似于浏览器的原生 API requestIdleCallback。React 团队没有使用 requestIdleCallback 是因为考虑为兼容性问题。</p>
</blockquote>
<p>Scheduler 是整个渲染执行链条的入口，负责：</p>
<ol>
<li>将变更转化为任务</li>
<li>按优先级调度任务执行</li>
<li>支持时间切片与可中断渲染</li>
</ol>
<blockquote>
<p>虽然每一帧绘制时间约为 16.66ms，但是如果屏幕没有刷新，那么浏览器会安排长度为 50ms 左右的空闲时间。</p>
<p>研究表明，用户操作之后，100ms 以内的响应给用户的感觉都是瞬间发生，也就是说不会感受到延迟感，因此将空闲时间设置为 50，浏览器依然还剩下 50ms 可以处理用户的操作响应，不会让用户感到延迟，这就是我们面试题中常看到的浏览器渲染每帧的空闲时间。</p>
</blockquote>
<ol>
<li>
<h3 data-id="heading-2">更新任务被排队</h3>
</li>
</ol>
<p>当你调用 <code>setState</code>、<code>dispatch</code>、<code>startTransition</code>、事件触发更新时，React 内部会：</p>
<pre><code class="hljs language-Plain" lang="Plain">scheduleUpdateOnFiber(fiber, lane, eventTime)
</code></pre>
<p>这个函数是调度入口，它将更新附着在对应的 Fiber 上，并根据任务的 <em>lane（内部优先级）</em> 更新任务队列。</p>
<ol start="2">
<li>
<h3 data-id="heading-3">任务优先级系统（Lanes）</h3>
</li>
</ol>
<p>React 内部并不使用单一队列，而是用<strong>多 lane 机制。</strong></p>
<blockquote>
<p>优先级由 Scheduler 根据事件来源与延迟（expiration time）决定。</p>
</blockquote>
<ol start="3">
<li>
<h3 data-id="heading-4">时间切片（Time Slicing）</h3>
</li>
</ol>
<p>Scheduler 会根据浏览器的空闲时间，决定是在当前帧继续执行还是 yield 给浏览器，这样协调器起点也是不同的：</p>
<ul>
<li>performSyncWorkOnRoot（同步更新流程）</li>
<li>performConcurrentWorkOnRoot（并发更新流程）</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// performSyncWorkOnRoot 会执行该方法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoopSync</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">while</span>(workInProgress !== <span class="hljs-literal">null</span>){
    <span class="hljs-title function_">performUnitOfWork</span>(workInProgress)
  }
}
<span class="hljs-comment">// performConcurrentWorkOnRoot 会执行该方法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoopConcurrent</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// shouldYield 表明任务是否可以中断</span>
  <span class="hljs-comment">// 如果 workInProgress 为 null，说明已经没有下一个 FiberNode，也就是说明整颗 Fiber tree 树构建完毕</span>
  <span class="hljs-keyword">while</span> (workInProgress !== <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-title function_">shouldYield</span>()) {
    <span class="hljs-comment">// performUnitOfWork创建下一个 FiberNode，并且将已创建的 FiberNode 连接起来（child、return、sibling），形成一个链表结构的 Fiber tree</span>
    workInProgress = <span class="hljs-title function_">performUnitOfWork</span>(workInProgress); 
  }
}
</code></pre>
<p><code>shouldYield</code> 判断当前帧是否该让出，避免阻塞主线程。</p>
<ol start="4">
<li>
<h3 data-id="heading-5">中断 + 恢复机制</h3>
</li>
</ol>
<p>如果有更高优先级的任务，中断当前 render，后续在合适时机 ​<em>恢复执行</em>​。这样能确保交互响应不会被大更新阻塞。</p>
<h2 data-id="heading-6">三、协调器（Reconciler）：Fiber 树的 diff 与标记</h2>
<p>协调器的核心任务是：</p>
<ol>
<li>对比新旧树，确定哪些节点变化</li>
<li>生成 <strong>workInProgress Fiber 树</strong></li>
<li>标记变化（Placement、Update、Deletion）</li>
<li>不直接修改 DOM，而是将变化收集起来</li>
<li>
<h3 data-id="heading-7">Fiber 数据结构</h3>
</li>
</ol>
<p>每一个组件在运行时都有一个 Fiber 节点：</p>
<ul>
<li>指向真实 DOM 实例</li>
<li>链接 child / sibling / return 三个方向</li>
<li>记录当前组件状态、props、更新队列、优先级等属性</li>
</ul>
<blockquote>
<p>这种结构不同于简单递归栈，它更像一颗​<strong>可分片执行的链表树</strong>​。</p>
</blockquote>
<ol start="2">
<li>
<h3 data-id="heading-8">Reconciler 工作循环 —— render 阶段</h3>
</li>
</ol>
<p>协调器是由 Scheduler 调度后执行的。React 会从 Root Fiber 开始 traverse。</p>
<h4 data-id="heading-9">a. beginWork</h4>
<p>处理当前节点逻辑，根据类型（函数组件 / 类组件 / Fragment 等）判断需要构建哪些子 Fiber。</p>
<h4 data-id="heading-10">b. completeWork</h4>
<p>在子节点构建完成后整合变化，把节点的更改标记写入 <code>flags</code>。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 深度优先遍历</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">performUnitOfWork</span>(<span class="hljs-params">fiberNode</span>){
  <span class="hljs-comment">// 省略 beginWork </span>
  <span class="hljs-keyword">if</span>(fiberNode.<span class="hljs-property">child</span>){
    <span class="hljs-title function_">performUnitOfWork</span>(fiberNode.<span class="hljs-property">child</span>);
  }
  <span class="hljs-comment">// 省略 CompleteWork </span>
  <span class="hljs-keyword">if</span>(fiberNode.<span class="hljs-property">sibling</span>){
    <span class="hljs-title function_">performUnitOfWork</span>(fiberNode.<span class="hljs-property">sibling</span>);
  }
}
</code></pre>
<p>整个过程构成一个 ​<strong>双缓冲机制</strong>​：</p>
<ul>
<li>current Fiber（当前渲染状态）</li>
<li>workInProgress Fiber（正在构建的树）</li>
</ul>
<p>最终 <code>workInProgress</code> 树会用于提交阶段。</p>
<ol start="3">
<li>
<h3 data-id="heading-11">标记变化</h3>
</li>
</ol>
<p>协调器不会直接操作 DOM，而是根据差异为每个节点打上 flags：</p>
<ul>
<li>​<strong>Placement</strong>​：新节点插入</li>
<li>​<strong>Update</strong>​：属性/文本内容更新</li>
<li>​<strong>Deletion</strong>​：删除节点</li>
</ul>
<p>这些标记会在提交阶段被 Renderer 读取。</p>
<h2 data-id="heading-12">四、渲染器（Renderer）：真实环境应用变化</h2>
<p>Renderer 是把协调阶段生成的变化<strong>同步</strong>应用到最终环境，比如：</p>
<ul>
<li>浏览器的 DOM</li>
<li>React Native 原生视图</li>
<li>其他自定义渲染平台</li>
</ul>
<p>React 通过隔离平台实现了 Renderer 的可插拔。相较于 render 阶段，此时 commit 阶段不可中断恢复。</p>
<ol>
<li>
<h3 data-id="heading-13">提交阶段的三个子阶段</h3>
</li>
</ol>
<p>协调阶段完成后进入 ​<strong>commit 阶段</strong>​：</p>
<h4 data-id="heading-14">a. Before Mutation</h4>
<p>执行 <code>getSnapshotBeforeUpdate</code>（类组件），记录焦点、selection（输入框光标）等。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title function_">commitBeforeMutationEffects</span>(root, finishedWork)
<span class="hljs-comment">// 读取旧的 DOM 状态</span>
</code></pre>
<h4 data-id="heading-15">b. Mutation</h4>
<p>​<strong>真实 DOM 操作发生位置</strong>​，根据 <code>flags</code> 做：appendChild、removeChild、update 属性、插入节点等。</p>
<p>然后切换 Fiber Tree（也就是上面提到的双缓冲机制，两棵树互换）。</p>
<h4 data-id="heading-16">c. Layout</h4>
<blockquote>
<p>useLayoutEffect 的意义是：在 DOM 更新完成后，浏览器绘制之前，同步读取或修改布局。</p>
</blockquote>
<p>执行 <code>useLayoutEffect、componentDidMount、componentDidUpdate</code> 的回调。</p>
<blockquote>
<p>注意哦！！！这里虽然 DOM 已经变更了，但是浏览器页面​<strong>还没有 paint，下一步才是绘制</strong>​。</p>
</blockquote>
<ol start="2">
<li>
<h3 data-id="heading-17">渲染器应用 DOM 改变</h3>
</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title function_">commitUpdate</span>(domElement, updatePayload, type, oldProps, newProps)
<span class="hljs-comment">// 调用一系列 DOM API 为元素属性更新赋值</span>
</code></pre>
<blockquote>
<p>这里 paint 之后，才会执行 useEffect（异步）的回调。</p>
<p>所以如果需要操作 DOM ，要在 useLayoutEffect 钩子执行。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 单例模式的简单了解]]></title>    <link>https://juejin.cn/post/7600622206268899338</link>    <guid>https://juejin.cn/post/7600622206268899338</guid>    <pubDate>2026-01-29T15:13:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206268899338" data-draft-id="7600615229995188274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 单例模式的简单了解"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-29T15:13:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yen"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426633214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 单例模式的简单了解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426633214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:13:10.000Z" title="Thu Jan 29 2026 15:13:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、基本概念</h2>
<h3 data-id="heading-1">定义</h3>
<p>确保一个类只有一个实例，并提供一个全局访问点来访问这个实例。</p>
<h3 data-id="heading-2">核心思想</h3>
<ul>
<li><strong>私有构造器</strong>：防止外部通过new创建实例</li>
<li><strong>静态实例引用</strong>：类自身持有唯一实例</li>
<li><strong>全局访问点</strong>：提供静态方法获取唯一实例</li>
</ul>
<h2 data-id="heading-3">二、实现方式详解</h2>
<h3 data-id="heading-4">1. 饿汉式 (Eager Initialization)</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin实现</span>
<span class="hljs-keyword">object</span> Singleton {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"饿汉式单例"</span>)
    }
}

<span class="hljs-comment">// 使用</span>
Singleton.doSomething()

<span class="hljs-comment">// Java实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EagerSingleton</span> {
    <span class="hljs-comment">// 类加载时就初始化</span>
    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> EagerSingleton INSTANCE = new EagerSingleton();
    
    <span class="hljs-keyword">private</span> EagerSingleton() {
        <span class="hljs-comment">// 防止反射攻击</span>
        <span class="hljs-keyword">if</span> (INSTANCE != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> new RuntimeException(<span class="hljs-string">"单例模式禁止反射创建"</span>);
        }
    }
    
    <span class="hljs-keyword">public</span> static EagerSingleton getInstance() {
        <span class="hljs-keyword">return</span> INSTANCE;
    }
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>线程安全（类加载时初始化）</li>
<li>不支持延迟加载</li>
<li>可能浪费内存（即使不用也会创建）</li>
</ul>
<h3 data-id="heading-5">2. 懒汉式 (Lazy Initialization)</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 线程不安全版本</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeLazySingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: UnsafeLazySingleton? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: UnsafeLazySingleton {
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                instance = UnsafeLazySingleton() <span class="hljs-comment">// 多线程下可能创建多个实例</span>
            }
            <span class="hljs-keyword">return</span> instance!!
        }
    }
}

<span class="hljs-comment">// 线程安全版本 - 同步方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedLazySingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: SynchronizedLazySingleton? = <span class="hljs-literal">null</span>
        
        <span class="hljs-meta">@Synchronized</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: SynchronizedLazySingleton {
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                instance = SynchronizedLazySingleton()
            }
            <span class="hljs-keyword">return</span> instance!!
        }
    }
}
</code></pre>
<h3 data-id="heading-6">3. 双重检查锁定 (Double-Checked Locking)</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DoubleCheckedSingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@Volatile</span> <span class="hljs-comment">// 确保可见性，防止指令重排序</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: DoubleCheckedSingleton? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: DoubleCheckedSingleton {
            <span class="hljs-comment">// 第一次检查：不加锁，提高性能</span>
            <span class="hljs-keyword">return</span> instance ?: synchronized(<span class="hljs-keyword">this</span>) {
                <span class="hljs-comment">// 第二次检查：加锁，确保线程安全</span>
                instance ?: DoubleCheckedSingleton().also {
                    instance = it
                }
            }
        }
    }
}

<span class="hljs-comment">// Java实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DoubleCheckedSingleton</span> {
    <span class="hljs-comment">// volatile关键字防止指令重排序</span>
    <span class="hljs-keyword">private</span> static volatile DoubleCheckedSingleton instance;
    
    <span class="hljs-keyword">private</span> DoubleCheckedSingleton() {}
    
    <span class="hljs-keyword">public</span> static DoubleCheckedSingleton getInstance() {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// 第一次检查</span>
            synchronized (DoubleCheckedSingleton.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// 第二次检查</span>
                    instance = new DoubleCheckedSingleton();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p><strong>原理分析</strong>：</p>
<ul>
<li><strong>第一次检查</strong>：避免不必要的同步</li>
<li><strong>同步块</strong>：确保只有一个线程进入</li>
<li><strong>第二次检查</strong>：防止多个线程通过第一次检查</li>
<li><strong>volatile</strong>：防止指令重排序，确保可见性</li>
</ul>
<h3 data-id="heading-7">4. 静态内部类 (Static Inner Class)</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerClassSingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span> = Holder.INSTANCE
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> Holder {
        <span class="hljs-keyword">val</span> INSTANCE = InnerClassSingleton()
    }
}

<span class="hljs-comment">// Java实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticInnerClassSingleton</span> {
    <span class="hljs-keyword">private</span> StaticInnerClassSingleton() {}
    
    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> {
        <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> StaticInnerClassSingleton INSTANCE = 
            new StaticInnerClassSingleton();
    }
    
    <span class="hljs-keyword">public</span> static StaticInnerClassSingleton getInstance() {
        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;
    }
}
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>懒加载（只有调用getInstance时才加载内部类）</li>
<li>线程安全（类加载机制保证）</li>
<li>实现简单，性能好</li>
</ul>
<h3 data-id="heading-8">5. 枚举实现 (Enum Singleton) - 《Effective Java》推荐</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnumSingleton</span> {
    INSTANCE;
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"枚举单例"</span>)
    }
}

<span class="hljs-comment">// 使用</span>
EnumSingleton.INSTANCE.doSomething()

<span class="hljs-comment">// Java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> EnumSingleton {
    INSTANCE;
    
    <span class="hljs-keyword">public</span> void doSomething() {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"枚举单例"</span>);
    }
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>绝对防止反射攻击</li>
<li>防止反序列化创建新实例</li>
<li>线程安全</li>
<li>实现简单</li>
</ul>
<h2 data-id="heading-9">三、单例模式的高级应用</h2>
<h3 data-id="heading-10">1. 参数化单例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigManager</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> configName: String
) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> properties = mutableMapOf&lt;String, Any&gt;()
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> instances = mutableMapOf&lt;String, ConfigManager&gt;()
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">(configName: <span class="hljs-type">String</span>)</span></span>: ConfigManager {
            <span class="hljs-keyword">return</span> instances[configName] ?: synchronized(<span class="hljs-keyword">this</span>) {
                instances[configName] ?: ConfigManager(configName).also {
                    instances[configName] = it
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setProperty</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, value: <span class="hljs-type">Any</span>)</span></span> {
        properties[key] = value
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getProperty</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: Any? {
        <span class="hljs-keyword">return</span> properties[key]
    }
}

<span class="hljs-comment">// 使用不同的配置实例</span>
<span class="hljs-keyword">val</span> userConfig = ConfigManager.getInstance(<span class="hljs-string">"user"</span>)
<span class="hljs-keyword">val</span> systemConfig = ConfigManager.getInstance(<span class="hljs-string">"system"</span>)
</code></pre>
<h3 data-id="heading-11">2. 单例工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonFactory</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> instances = mutableMapOf&lt;String, T&gt;()
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: T
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: T {
        <span class="hljs-keyword">return</span> instances[key] ?: synchronized(<span class="hljs-keyword">this</span>) {
            instances[key] ?: create(key).also {
                instances[key] = it
            }
        }
    }
}

<span class="hljs-comment">// 具体实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseFactory</span> : <span class="hljs-type">SingletonFactory</span>&lt;<span class="hljs-type">Database</span>&gt;() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: Database {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (key) {
            <span class="hljs-string">"user"</span> -&gt; UserDatabase()
            <span class="hljs-string">"product"</span> -&gt; ProductDatabase()
            <span class="hljs-keyword">else</span> -&gt; DefaultDatabase()
        }
    }
}
</code></pre>
<h2 data-id="heading-12">四、单例模式的问题与解决方案</h2>
<h3 data-id="heading-13">1. 内存泄漏问题</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 错误示例：单例持有Activity引用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakySingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> activity: Activity) {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: LeakySingleton? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">(activity: <span class="hljs-type">Activity</span>)</span></span> {
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                instance = LeakySingleton(activity) <span class="hljs-comment">// 持有Activity引用！</span>
            }
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: LeakySingleton? = instance
    }
}

<span class="hljs-comment">// 正确做法：使用Application Context</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeSingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(context: Context) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> appContext = context.applicationContext
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@Volatile</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: SafeSingleton? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: SafeSingleton {
            <span class="hljs-keyword">return</span> instance ?: synchronized(<span class="hljs-keyword">this</span>) {
                instance ?: SafeSingleton(context.applicationContext).also {
                    instance = it
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-14">2. 测试困难 - 使用依赖注入解决</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 传统单例 - 难以测试</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnalyticsManager</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> instance: AnalyticsManager? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: AnalyticsManager {
            <span class="hljs-keyword">return</span> instance ?: synchronized(<span class="hljs-keyword">this</span>) {
                instance ?: AnalyticsManager().also {
                    instance = it
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trackEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 发送到服务器 - 测试时难以模拟</span>
    }
}

<span class="hljs-comment">// 使用接口和依赖注入</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Analytics</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trackEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnalyticsImpl</span> : <span class="hljs-type">Analytics</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trackEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 真实实现</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MockAnalytics</span> : <span class="hljs-type">Analytics</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trackEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 测试实现</span>
    }
}

<span class="hljs-comment">// 使用Dagger/Hilt依赖注入</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> AnalyticsModule {
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span> <span class="hljs-comment">// Dagger会处理单例</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideAnalytics</span><span class="hljs-params">()</span></span>: Analytics = AnalyticsImpl()
}

<span class="hljs-comment">// ViewModel中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> analytics: Analytics  <span class="hljs-comment">// 由Dagger注入单例</span>
) : ViewModel() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onButtonClick</span><span class="hljs-params">()</span></span> {
        analytics.trackEvent(<span class="hljs-string">"button_click"</span>)
    }
}
</code></pre>
<h2 data-id="heading-15">五、Kotlin特有的单例特性</h2>
<h3 data-id="heading-16">1. object声明</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> NetworkManager {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TIMEOUT = <span class="hljs-number">5000L</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">makeRequest</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 网络请求</span>
    }
    
    <span class="hljs-comment">// object可以有init块</span>
    <span class="hljs-keyword">init</span> {
        println(<span class="hljs-string">"NetworkManager初始化"</span>)
    }
}

<span class="hljs-comment">// 反编译为Java看本质</span>
<span class="hljs-comment">/*
public final class NetworkManager {
    public static final NetworkManager INSTANCE;
    
    static {
        NetworkManager var0 = new NetworkManager();
        INSTANCE = var0;
        System.out.println("NetworkManager初始化");
    }
    
    private NetworkManager() {}
}
*/</span>
</code></pre>
<h3 data-id="heading-17">2. by lazy实现懒加载</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySingleton</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">val</span> instance: LazySingleton <span class="hljs-keyword">by</span> lazy(LazyThreadSafetyMode.SYNCHRONIZED) {
            println(<span class="hljs-string">"初始化LazySingleton"</span>)
            LazySingleton()
        }
    }
}

<span class="hljs-comment">// 不同的线程安全模式</span>
<span class="hljs-keyword">val</span> unsafeInstance <span class="hljs-keyword">by</span> lazy(LazyThreadSafetyMode.NONE) { <span class="hljs-comment">/* 线程不安全 */</span> }
<span class="hljs-keyword">val</span> synchronizedInstance <span class="hljs-keyword">by</span> lazy(LazyThreadSafetyMode.SYNCHRONIZED) { <span class="hljs-comment">/* 线程安全 */</span> }
<span class="hljs-keyword">val</span> publicationInstance <span class="hljs-keyword">by</span> lazy(LazyThreadSafetyMode.PUBLICATION) { <span class="hljs-comment">/* 允许重复初始化 */</span> }
</code></pre>
<h2 data-id="heading-18">六、最佳实践指南</h2>
<h3 data-id="heading-19">何时使用单例模式？</h3>
<p>✅ <strong>适用场景</strong>：</p>
<ol>
<li>全局配置管理（如AppConfig）</li>
<li>日志记录器（如Logger）</li>
<li>数据库访问对象</li>
<li>网络请求客户端</li>
<li>缓存管理器</li>
<li>工具类（如DateFormatter）</li>
</ol>
<p>❌ <strong>避免使用场景</strong>：</p>
<ol>
<li>需要大量测试的类</li>
<li>可能有多态需求的类</li>
<li>需要参数化配置的类</li>
<li>状态频繁变化的类</li>
</ol>
<h3 data-id="heading-20">Android开发建议</h3>
<ul>
<li><strong>优先使用依赖注入</strong>（Dagger/Hilt）管理单例</li>
<li><strong>避免持有Context引用</strong>，必须使用时用Application Context</li>
<li><strong>注意生命周期</strong>，及时清理资源</li>
<li><strong>使用Kotlin object</strong>简化单例实现</li>
</ul>
<h3 data-id="heading-21">代码示例：完整的Android单例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用Kotlin object + 依赖注入思想</span>
<span class="hljs-keyword">object</span> ImageLoader {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> MEMORY_CACHE_SIZE = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> <span class="hljs-comment">// 10MB</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> memoryCache: LruCache&lt;String, Bitmap&gt;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> executor: ExecutorService
    
    <span class="hljs-keyword">init</span> {
        memoryCache = <span class="hljs-keyword">object</span> : LruCache&lt;String, Bitmap&gt;(MEMORY_CACHE_SIZE) {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sizeOf</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, value: <span class="hljs-type">Bitmap</span>)</span></span>: <span class="hljs-built_in">Int</span> {
                <span class="hljs-keyword">return</span> value.byteCount
            }
        }
        
        executor = Executors.newFixedThreadPool(<span class="hljs-number">4</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImage</span><span class="hljs-params">(url: <span class="hljs-type">String</span>, imageView: <span class="hljs-type">ImageView</span>)</span></span> {
        <span class="hljs-comment">// 检查内存缓存</span>
        <span class="hljs-keyword">val</span> cachedBitmap = memoryCache.<span class="hljs-keyword">get</span>(url)
        <span class="hljs-keyword">if</span> (cachedBitmap != <span class="hljs-literal">null</span>) {
            imageView.setImageBitmap(cachedBitmap)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 异步加载</span>
        executor.submit {
            <span class="hljs-keyword">val</span> bitmap = downloadImage(url)
            bitmap?.let {
                memoryCache.put(url, it)
                
                <span class="hljs-comment">// 切回主线程更新UI</span>
                Handler(Looper.getMainLooper()).post {
                    imageView.setImageBitmap(it)
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clearCache</span><span class="hljs-params">()</span></span> {
        memoryCache.evictAll()
    }
}

<span class="hljs-comment">// 使用</span>
ImageLoader.loadImage(<span class="hljs-string">"https://example.com/image.jpg"</span>, imageView)
</code></pre>
<h2 data-id="heading-22">七、总结</h2>
<p>单例模式是Android开发中最常用的设计模式之一，但也是最容易被滥用的模式。正确使用单例模式需要注意：</p>
<ol>
<li><strong>线程安全</strong>：根据需求选择合适的线程安全方案</li>
<li><strong>内存管理</strong>：避免内存泄漏，特别是Context引用</li>
<li><strong>测试友好</strong>：考虑使用依赖注入提高可测试性</li>
<li><strong>Kotlin特性</strong>：充分利用object、by lazy等语言特性</li>
<li><strong>架构考虑</strong>：在MVVM等架构中合理使用单例</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[保姆级教程：十分钟快速搭建部署你的专属Moltbot！]]></title>    <link>https://juejin.cn/post/7600628279214931994</link>    <guid>https://juejin.cn/post/7600628279214931994</guid>    <pubDate>2026-01-29T10:51:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279214931994" data-draft-id="7600601482690363438" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="保姆级教程：十分钟快速搭建部署你的专属Moltbot！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T10:51:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LiDayDay"/> <meta itemprop="url" content="https://juejin.cn/user/4464446331950568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            保姆级教程：十分钟快速搭建部署你的专属Moltbot！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4464446331950568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LiDayDay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:51:26.000Z" title="Thu Jan 29 2026 10:51:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    59
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>写在前面：</strong></p>
<p>🟡 快速体验 &amp; 项目反馈
欢迎大家下载并体验我们最新版本的 OpenChat，亲自感受本地多模型调度与智能助手融合的强大能力。</p>
<p>🌐 <strong>官方主页</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffastaistack.github.io%2FOpenChat%2F" target="_blank" title="https://fastaistack.github.io/OpenChat/" ref="nofollow noopener noreferrer">欢迎访问 OpenChat 官方网站，了解更多关于我们的团队愿景、产品动态与最新公告</a></p>
<p>🧩 <strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffastaistack%2FOpenChat" target="_blank" title="https://github.com/fastaistack/OpenChat" ref="nofollow noopener noreferrer">访问 OpenChat github 主页</a>  |  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ffastaistack%2Fopenchat" target="_blank" title="https://gitee.com/fastaistack/openchat" ref="nofollow noopener noreferrer">访问 OpenChat gitee 主页</a></p>
<p>🔗 <strong>下载应用</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffastaistack.github.io%2FOpenChat%2F" target="_blank" title="https://fastaistack.github.io/OpenChat/" ref="nofollow noopener noreferrer">点击下载OpenChat最新版本</a></p>
</blockquote>
<blockquote>
<p>我们非常期待您的宝贵反馈，无论是功能建议、使用体验，还是 Bug 报告，都将是我们持续优化的重要动力。下面我将介绍OpenChat与DeepSeek-OCR集成后具体的使用方式。</p>
</blockquote>
<h2 data-id="heading-0">一、快速介绍什么是Moltbot</h2>
<p align="left">Moltbot（原名 clawdbot）是一个运行在你自己设备上的开源高权限个人 AI 助手，深度集成 WhatsApp、Telegram、Discord、Slack、Signal、iMessage 等主流消息平台。它不是那种只能被动聊天的 AI，而是一个可以主动行动的 Agent：通过你最熟悉的聊天窗口，就能完成发邮件、排日程、做系统监控等自动化操作。</p>
<p align="left">Moltbot 支持多代理路由和高度可定制的技能系统，你可以像搭积木一样组合能力，把整个数字工作流交给它调度。它既可以跑在本地，完全掌控数据和权限，也可以部署到云端，实现 7×24 小时在线的长期运行，适合当成你真正的“常驻数字助手”。</p>
<p align="left">Moltbot 本身具备较高的系统操作权限。为降低安全风险、避免对本地环境产生直接影响，推荐在独立的云端隔离环境中进行部署和运行。通过将 Moltbot 与个人电脑或生产环境进行物理与权限层面的隔离，可以有效防止误操作带来的文件修改、配置污染等问题，使敏感操作更加可控、更加安心。</p>
<p align="left">接下来，我们将详细介绍如何在服务器上快速搭建属于你的 Moltbot 实例，并提供一个可直接使用的 Telegram 示例配置，帮助你在隔离环境中完成部署、连接与验证，快速体验 Moltbot 的完整能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b5681693a9f4a779a44d965b404efe3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=WjOaEoxl7p5OxXCqkUpJQJ8EeM8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、服务器搭建你的moltbot</h2>
<h3 data-id="heading-2">1.准备一台服务器</h3>
<p>操作系统建议为 CentOS 或 Ubuntu。服务器基础配置建议为 4 核 CPU、16GB 内存（可根据实际业务负载进行调整）。
在服务器上提前完成 Docker 环境的安装与配置，以支持后续服务的容器化部署。 以下是为你需要的Dockfile，你可以依此构建容器。</p>
<pre><code class="hljs language-Dockfile" lang="Dockfile">FROM docker.m.daocloud.io/library/node:22-bookworm

# Use Aliyun APT mirror for faster package downloads in China
RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources

# Update package list and install OpenSSH Server and essential tools
RUN apt-get update &amp;&amp; \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
    openssh-server \
    vim \
    curl \
    ca-certificates \
    procps \
    tmux &amp;&amp; \
    apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/* /var/cache/apt/archives/*

# Enable pnpm via corepack
RUN corepack enable

# Use Aliyun npm mirror for faster package downloads
RUN npm config set registry https://registry.npmmirror.com

# Install moltbot globally
RUN npm install -g moltbot@latest

# Create SSH runtime directory
RUN mkdir -p /var/run/sshd

# Configure SSH Server
# - Change port to 2222
# - Allow root login
# - Enable password authentication
RUN sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config &amp;&amp; \
    sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config &amp;&amp; \
    sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Set root password (⚠️  CHANGE THIS IN PRODUCTION!)
RUN echo "root:moltbot123" | chpasswd

# Expose SSH port
EXPOSE 2222
EXPOSE 18789

# Set working directory
WORKDIR /root

# Start SSH daemon in foreground mode to keep container running
CMD ["/usr/sbin/sshd", "-D", "-p", "2222"]
</code></pre>
<h3 data-id="heading-3">2.构建你的专属容器</h3>
<p>端口号支持完全自定义，你可以根据现有网络环境或安全策略自由配置监听端口，避免与本机或服务器上已有服务产生冲突。通过自定义端口，不仅可以更好地融入现有的反向代理、防火墙或内网访问体系，也便于在多实例、多环境（如测试 / 生产）场景下同时运行 Moltbot，提高整体部署的灵活性与可控性。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 根据dockerfile构建容器</span>
docker build -f Dockerfile.ssh -t moltbot-ssh:latest .

docker run -d -p 2222:2222 --name moltbot-ssh moltbot-ssh:latest

<span class="hljs-comment"># ssh连接你的容器</span>
ssh root@&lt;ip&gt; -p 2222
<span class="hljs-comment"># 密码为：moltbot123 你可以按需在Dockerfile中配置你的密码</span>
</code></pre>
<h2 data-id="heading-4">3.进入你的moltbot内配置</h2>
<p>以下操作均在通过 SSH 连接至服务器后进行。请确保已成功登录目标主机，并具备相应的系统权限（如普通用户或 sudo 权限）。所有配置与运行过程均在远程服务器环境中完成，不会直接影响本地设备的文件系统或运行环境，适合用于云端隔离部署或长期在线运行场景。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化配置文件和工作目录</span>
moltbot setup

moltbot config <span class="hljs-built_in">set</span> gateway.port 18789
moltbot config <span class="hljs-built_in">set</span> gateway.mode <span class="hljs-string">"local"</span>
moltbot config <span class="hljs-built_in">set</span> gateway.bind <span class="hljs-string">"lan"</span>
moltbot config <span class="hljs-built_in">set</span> agents.defaults.workspace <span class="hljs-string">"/root/molt"</span>

<span class="hljs-comment"># 此命令可选（如果你需要自定义模型，编辑moltbot.json）</span>
vim .moltbot/moltbot.json

<span class="hljs-comment"># 修复一下moltbot.json以免失败</span>
moltbot doctor --fix

<span class="hljs-comment"># 禁用配置自动重载（推荐） 或者moltbot config set gateway.reload.mode "hot" 热加载不重启</span>
moltbot config <span class="hljs-built_in">set</span> gateway.reload.mode <span class="hljs-string">"off"</span>

<span class="hljs-comment"># 创建新的窗口，启动gateway(控制平面)</span>
tmux new -s molt
moltbot gateway run --<span class="hljs-built_in">bind</span> lan --port 18789
<span class="hljs-comment"># 使用ctrl+B 再按D退出，再次进入使用tmux attach -t molt</span>

<span class="hljs-comment"># 运行配置向导，你可以按需配置skills和其他选项</span>
moltbot onboard --install-daemon

<span class="hljs-comment"># 你可以依次选择</span>
-&gt; I understand this is powerful and inherently risky. Continue? (Yes)
-&gt; Onboarding mode (QuickStart)
-&gt; Config handling (Use existing values)
-&gt; Model/auth provider (Skip <span class="hljs-keyword">for</span> now) <span class="hljs-comment"># 或者选择你的模型</span>
-&gt; Filter models by provider (deepseek) <span class="hljs-comment"># 或者选择你自定义的模型</span>
-&gt; Default model (Keep current (deepseek/deepseek-chat))
-&gt; Select channel (QuickStart) (Skip <span class="hljs-keyword">for</span> now)
-&gt; Configure skills now? (No) 按需配置
-&gt; Enable hooks? (Skip <span class="hljs-keyword">for</span> now)
-&gt; How <span class="hljs-keyword">do</span> you want to hatch your bot? (Hatch <span class="hljs-keyword">in</span> TUI (recommended))
</code></pre>
<h3 data-id="heading-5">4.配置成功</h3>
<p>当出现如下界面时，你的机器人配置成功了，现在你可以跟他对话了！
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ff20680e8e849acbd5bf2ef23a95a12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=ek%2FXS2SisT%2F%2F3BNpMv3FKBZ9oZs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-6">5.注意事项</h3>
<p>如果你的模型在moltbot内未支持或者你想使用你自定义的模型，比如deepseek、kimi等，你可以编辑.moltbot/moltbot.json，将agents和models替换为如下内容.</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek/deepseek-chat"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"deepseek/deepseek-chat"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DeepSeek Chat"</span>
                <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"merge"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"deepseek"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.deepseek.com/v1"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"YOUR_DEEPSEEK_API_KEY"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek-chat"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DeepSeek Chat"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"reasoning"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"text"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"cost"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                            <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"cacheRead"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"cacheWrite"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
                        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">64000</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">三、创建你的专属Telegram回复机器人</h2>
<ol>
<li>打开 Telegram，在聊天列表页面下拉搜索 @BotFather，并进入官方 Bot 管理对话。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5eab9b585ba470eae07852acb384d73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=o4Z9g90O%2Bm0ASUZbyYe5D6AxwXg%3D" alt="在这里插入图片描述" loading="lazy"/></li>
<li>在对话中发送 /newbot 指令，用于创建一个新的 Telegram 机器人。</li>
<li>按照 BotFather 的提示，为你的机器人设置显示名称和用户名。
○ 用户名必须以 bot 结尾
○ 且不能与现有机器人重复</li>
<li>创建完成后，BotFather 会向你发送机器人的 访问链接 和 Bot API Token。
请妥善保存该 Token，它将用于 Moltbot 与 Telegram 的连接，格式类似：</li>
</ol>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">1234567890:ABCdefGHIjklMNOpqrsTUVwxyz</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f15e03f62d7849c6bbde01c7f1cb0811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=vN6RoTsj7UXUHYLP8LEPNyHRz%2Fo%3D" alt="在这里插入图片描述" loading="lazy"/>
5.打开 Moltbot 的配置界面，选择 Telegram（Bot API） 作为消息通道，并将上一步获得的 API Token 填入对应配置项中，保存配置。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb1205be61fb4d0db9a94283bcd27b7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=ABwwkuQ7bfM9%2BqQ6KXsYn3zlLhA%3D" alt="在这里插入图片描述" loading="lazy"/>
将API Token填入下面，填入后继续执行，可能需要重启一下gatewey和TUI
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a762d9992a4a4eb439a0f75035cb95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=b%2FQWd%2FatoBXPcn8gYq1gvXfqjQ4%3D" alt="在这里插入图片描述" loading="lazy"/>
6.配置完成后，在 Telegram 中进入该机器人的聊天页面，发送 /start 指令。机器人将返回一个 pairing code。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60407a74d36d40f89d9fd0a5d804a881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=xcwwHFEDAOatYXFXE4%2FzQb%2Bchs0%3D" alt="在这里插入图片描述" loading="lazy"/>
○ 将该 code 直接复制并粘贴到 Moltbot 的聊天回复配置中
○ 或使用命令：</p>
<pre><code class="hljs language-css" lang="css">moltbot pairing approve telegram &lt;<span class="hljs-selector-tag">code</span>&gt;
</code></pre>
<p>完成配对后重新进入即可生效。
7. 配对成功后，在 Telegram 中向该机器人发送测试消息，若 Moltbot 能正常回复，即表示 Telegram 通道已成功关联。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/194a5e21fb4e43ada05b03cb912fa883~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=bPyR29PWK8qHO%2FgnfIBHLdq9UmY%3D" alt="在这里插入图片描述" loading="lazy"/>
8.进行文件传输等功能测试，确认消息与文件均可正常收发，说明机器人已配置完成并运行正常。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af7eca119250470d967e967a16c8a45a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlEYXlEYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770338616&amp;x-signature=STGXg%2BMJnjPFgA3pFrkWVJ1js%2BI%3D" alt="在这里插入图片描述" loading="lazy"/>至此，Moltbot 已完成部署并成功接入 Telegram。你现在可以仅通过手机上的聊天软件，对服务器和个人数字工作流进行集中控制：下发指令、触发自动化任务、接收系统状态与实时通知，所有操作都无需再直接登录服务器或打开电脑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[强化学习比你想象的还要更为低效...]]></title>    <link>https://juejin.cn/post/7600622206269947914</link>    <guid>https://juejin.cn/post/7600622206269947914</guid>    <pubDate>2026-01-30T02:20:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206269947914" data-draft-id="7600678255041396745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="强化学习比你想象的还要更为低效..."/> <meta itemprop="keywords" content="人工智能,LLM"/> <meta itemprop="datePublished" content="2026-01-30T02:20:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            强化学习比你想象的还要更为低效...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:20:52.000Z" title="Fri Jan 30 2026 02:20:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>编者按：</strong> 为什么在强化学习（RL）中，模型往往需要消耗比有监督学习多出数个数量级的计算资源，却只能换来看似微薄的性能提升，且常常陷入训练不稳定的泥潭？</p>
<p>本文从信息论角度出发，对比了有监督学习与强化学习在单位样本中可获取信息量的根本差异：前者通过明确的正确标签直接提供高信息密度的学习信号，而后者仅依赖二元的成功/失败反馈，其信息熵在通过率极低或极高时趋近于零。作者进一步指出，只有当模型的“通过率”处于约 50% 的“金发姑娘区”时，RL 才能高效学习，而这通常只出现在训练末期。此外，文章还剖析了 RL 中梯度估计方差巨大、容易被简单启发式策略主导、难以培养通用推理能力等深层问题，并反思了人类学习机制与当前 model-free RL 的本质差距。</p>
<p>这篇文章提醒我们：若想让强化学习真正释放其潜力，不能仅靠堆算力，而必须重新思考如何设计更密集、更结构化的反馈机制 —— 否则，我们可能只是在用极其昂贵的方式，重复确认一个早已写在预训练权重里的答案。</p>
</blockquote>
<p><strong>作者 | Dwarkesh Patel</strong></p>
<p><strong>编译 | 岳扬</strong></p>
<p>最近，人们[1]一直在讨论[2]：在强化学习（RL）中生成单个样本所需的计算量（FLOPs）远高于有监督学习（supervised learning）。<strong>在预训练阶段</strong>，模型对每一个用于训练的 token 都能立即获得一个学习信号；<strong>而在 RL 中</strong>，必须展开一整条长达数万 tokens 的推理思维链，才能在最后得到一个奖励信号（例如，我写的代码单元测试是否通过？这道数学题的答案是否正确？等等）。</p>
<p>但这只是问题的一半。这里有一种简单的方法可以比较强化学习与有监督学习的学习效率：</p>
<p><strong>Bits/FLOP = Samples/Flop × Bits/Sample</strong></p>
<p>我还没听到有人讨论我们公式中的这一项：Bits/Sample（每个样本包含多少有用信息）。而且在训练的大部分阶段，强化学习的每一个样本所包含的“有效学习信息量”比有监督学习要低得多。</p>
<h2 data-id="heading-0"><strong>01 用大白话来说</strong></h2>
<p>在有监督学习（也就是预训练）中，模型只是在疯狂吸收信息（bits）。每一个 token 都像是一条线索，它不仅能帮你理解语言本身的构造，还能让你窥见创造这段语言的思维过程，以及那个思维所感知的现实世界。在训练初期，当你用一个完全随机初始化的模型时，你对这些内容都处于最大程度的不确定状态。因此，每个 token 都会让你“恍然大悟”。<strong>而且你会立刻得到一个精确的信号，知道自己对正确答案的预测错得多离谱，以及需要调整哪些参数来减少错误。</strong></p>
<p>假设你从一个随机初始化的模型开始，并启动训练。如果你使用有监督学习对 “The sky is” 这个短语做 next-token-prediction，那么训练循环会这样工作：“正确答案其实是 ‘blue’。你预测 ‘blue’ 的概率只有 0.001%。现在，请大幅加强那些本该指向 ‘blue’ 的连接权重。好了，下一个 token。”</p>
<p>而在使用策略梯度（policy gradient）的强化学习中，你会增加所有回答正确的轨迹的权重，并降低所有回答错误的轨迹的权重。<strong>但问题是，一个还没怎么学会东西的模型，几乎不可能凭运气就答对。</strong></p>
<p>如果你用 RL 来做“The sky is”的 next-token-prediction，训练循环大概会是这样：“好吧，‘halcyon’ 是错的，别再做导致输出‘halcyon’的操作了…… 好吧，‘serendipity’ 也是错的……” 然后就这样反复试错，猜错的次数差不多得有词汇表总量那么多（约 10 万次）。</p>
<h2 data-id="heading-1"><strong>02 详细分析</strong></h2>
<p>让我们思考一下：随着通过率（p）的变化，每个样本所能获得的最大信息量（bits/sample）会如何变化。<strong>这里的“通过率”指的是你给出正确答案的概率。</strong> 为简化起见，我们假设答案长度只有一个词元。那么，对于一个完全未经训练的模型，其通过率仅仅是 1/（词汇表大小）。</p>
<p>在有监督学习中，每个样本都会明确告诉你正确标签是什么。你学到的新信息量，取决于你看到正确答案时有多“惊讶” —— 你的通过率越低（即正确答案的先验概率越小），你从这个标签中学到的东西就越多。信息熵的基本公式告诉我们：在有监督学习中，你从每个样本中最多可以学到 -log(p) bits 的信息。</p>
<p>而在强化学习中，你只会被告知答案是否正确。你能从中提取的信息量，受限于你对这个二元结果（对/错）的不确定性。如果你几乎总是通过（p ≈ 1）或几乎总是失败（p ≈ 0），那么每次试验都很难让你感到意外。<strong>当通过的概率像抛硬币一样时（p ≈ 0.5），你学到的东西最多。</strong> 对于一个二元随机变量，其信息量的上限由熵公式给出：在 RL 中，你从每个样本中最多能学到 Entropy(p) = -p log(p) - (1-p) log(1-p)1 bits 的信息。</p>
<p>好，我们来画图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be618892de2c417da02b7fd8800fd17b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344453&amp;x-signature=42XXY9MFT003sVxHT4DsOctjcxc%3D" alt="image.png" loading="lazy"/></p>
<p>看起来还不算太糟。是的，在通过率前 50% 的范围内，预训练明显更好，但在后 50% 的范围内，强化学习表现更佳。然而，这张图极具误导性。<strong>根据缩放定律（scaling laws）中的幂律关系，每当你想把“通过率”（pass rate）提升一个数量级，你都需要投入大致相同量级的计算资源。</strong> 如果你花了 X FLOPs 将通过率从 1/100,000 提升到 1/10,000，那么你也需要 X FLOPs 才能将通过率从 1/10,000 提升到 1/1,000。因此，我们应该使用对数刻度来表示通过率 —— 以便使 X 轴的每一单位增量对应于相同数量的计算开销（FLOPs）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ab30a2cbed14b66b6d0a07d6a6db7b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344453&amp;x-signature=MApSMnaiAdk9mtHZs8t3dXF582U%3D" alt="image.png" loading="lazy"/></p>
<p>这张图看起来真令人沮丧。强化学习在样本信息密度上与预训练相当的区域，仅仅是训练末期的一小段，而且此时模型本身已经相当不错了。</p>
<p>再次强调，这一问题完全独立于另一个观点：即从强化学习中获取单个样本（也就是在得到任何信号前必须完整展开一整条推理轨迹）可能需要耗费高出数百万倍的计算量。</p>
<h2 data-id="heading-2"><strong>03 方差（variance）让实</strong> <strong>际情况甚至比这更糟</strong></h2>
<p>训练初期的强化学习，实际情况其实比上面描述的更为严峻。<strong>当通过率很低时，对梯度的估计会变得极其混乱且难以预测。</strong> 要么在当前 batch 生成的样本中，根本就没有采样到正确答案，在这种情况下，几乎得不到任何有用的学习信号。要么碰巧采样到了一次，然后就会得到一个巨大的梯度峰值。模型的训练过程会被剧烈地、不规则地“拉扯”（梯度忽大忽小、方向混乱），如果要追求高效、稳定的训练，这样是非常糟糕的。2</p>
<p>有趣的是，预训练的问题恰好相反，方差（variance）在训练末期会变得非常高。随着预训练的推进，你会逐渐耗尽那些可约损失（reducible loss，即模型实际能从数据中学到的东西）。剩下的主要都是不可约损失（irreducible loss），不可约损失指的是网络文本数据固有的不可预测性。</p>
<p>提示词 “Bob’s favorite color is” 应该怎么结尾？这完全取决于 Bob 是谁。对于这种问题，并不存在什么标准正确答案能让你的超级智能模型通过训练达到很高的预测准确率。但是，模型仍然会根据某人在网上留下的随机答案，获得梯度更新（gradient update）。而这种噪音，会淹没当前 batch 中少数几个真正可学习的词元为我们提供的真实信号。<strong>我不知道这是否准确，但预训练阶段末期出现的这种方差激增，似乎与为什么在预训练过程中需要增大 batch sizes 有关。</strong></p>
<h2 data-id="heading-3"><strong>04 进入 RL 的“金发姑娘区”（Goldilocks zone）</strong></h2>
<p>如果 RL 在通过率远高于 1% 时效果最佳，那么这就引出了一个问题：我们该如何设计 RL 训练过程，才能让模型进入并维持在这个高效学习的状态中？</p>
<p>例如，在进行强化学习（RL）时，我们可以通过“预训练更多的数据”和“增加推理时的计算量（比如让模型想得更久）”这两种方式，来让模型变得更聪明、回答得更准确，提高模型的“通过率”，从而让每个样本带来更多的有效信息（bits）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6380dc2f9c57455e89d4d6c3db19deb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344453&amp;x-signature=BGIQcG2NS%2Fx%2BrPJ%2BploUTRs85cA%3D" alt="image.png" loading="lazy"/></p>
<p>有观点指出，课程学习（curriculum learning）在预训练中作用不大[3]，但在 RL 中却常常不可或缺[4]。这完全说得通 —— 因为 RL 只有在通过率处于这个“金发姑娘区”时，每个样本才能带来有意义的信息量。<strong>因此，为了训练效果好，你必须精心安排学习内容的顺序，要保证问题的难度是随着模型能力的提升而同步加难的，不要一下子给太难的题，也不要一直做太简单的题。</strong></p>
<p>作者提出的“通过率”理论可以很好地解释为什么“自我对弈”（像 AlphaGo 那样自己跟自己下棋）在强化学习历史上特别管用。因为当你跟一个水平旗鼓相当的对手比赛时，你赢的概率大约就是 50%。在这个理论中，50%是一个最佳状态，意味着每次比赛结果（输或赢）带给你的信息量是最大的，能让你学得最快。</p>
<p>但自我对弈并不是唯一能让训练过程中保持高通过率的方法。我们还可以设计出一种“proxy evaluation”机制，这种机制能提供更密集的反馈信息。这里的“密集”具体指以下两种情况之一：</p>
<p>1）Samples/FLOP 密度：通过“proxy evaluation”方法，我们可以在一个强化学习回合刚开始不久时就估算出最终的奖励，而不必真的把整个过程跑完，从而省去了后续的大量计算消耗。这种机制其实就是所谓的“价值函数”。</p>
<p>2）Bits/Sample 密度：我们可以设计一个比最终目标更易达成的 proxy objectives 来指导模型。我能想到的最简单例子是过程奖励模型（process-reward model），它会这样说：“嘿，这次生成的答案虽然错了，但我看得出来，它一开始的推理方向是对的。那我们就给这些早期的 token 增加一点权重。”</p>
<p>Deepseek R1[5] 论文的 4.2 节讨论并解释了，为什么直到现在，要为大语言模型开发出像这样好用的 proxy objectives 依然是一件很难的事情。</p>
<h2 data-id="heading-4"><strong>05 信息量虽少，但价值高</strong></h2>
<p>虽然在强化学习中，每单位计算量（FLOP）学到的 bits 确实少得多，<strong>但这些 bits 却非常重要，它们与预训练中获得的 bits 信息不能简单地相提并论。</strong> 这其中主要有两个关键原因：</p>
<ul>
<li>预训练就像是让模型把互联网上现有的数据全记下来，但这种知识与“如何完成具有经济价值的任务”只有部分且间接的关联；而强化学习则是直接教模型怎么去解决那些真正有用、能产生价值的实际问题。</li>
<li>即使预训练语料中包含了完成某项任务的“操作说明”（比如教程、具体步骤或答案），它也缺少一种关键的东西 —— “思维轨迹”（thinking trace）。也就是说，数据里没有展示模型犯错时是怎么自我纠正的，也没有展示如何利用模型独特的、非人类的方式去组合技能来解决问题。而这些深层的思考痕迹，正是强化学习能提供的东西。</li>
</ul>
<p>反驳的观点认为，虽然这些信息很有价值，但它们只在一个非常窄的通过率范围内（比如模型已经挺聪明了，但还没完全学会的时候）才能被获取。之所以要强调这一点，是因为在训练的大部分时间里，模型的通过率都极低（接近0），在对数尺度上看，这些低通过率的阶段占据了很大的比重，这意味着真正能高效学习的窗口期其实很短。</p>
<p>现在我们就能理解那些关于 RLHF/RL 仅能激发预训练模型中已有的潜在能力的说法了[6]。事实当然如此。<strong>如果预训练模型初始的通过率不够高，那么强化学习的 bits/sample 就会低得可怜，从而根本无法进行有效学习。</strong> 围棋对战中的“第 37 手”是一个非常著名的案例，它证明了强化学习确实能教给模型一种全新的、前所未有的策略。值得注意的是，AlphaGo 是通过自我对弈训练出来的（见上文关于自我对弈如何提高通过率的论述），而且以当时的标准来看[7]，其计算消耗之巨令人吃惊。</p>
<h2 data-id="heading-5"><strong>06 强化学习的不均衡</strong></h2>
<p>人们指出，从经验上看，RLVR（强化学习 + 可验证奖励）实际上只是让模型将某种思维模式与特定问题类型关联起来，而并未真正培养出一种更通用的策略 —— 比如先退一步，再仔细思考最佳解法。</p>
<p>仔细想想。怎么会有模型在国际编程竞赛中达到世界顶尖水平，却同时在代码库中留下了大量本可预见的 Bug 和技术债务？</p>
<p>这种奇怪的不均衡该如何解释？也许 RLVR 无法区分一条成功的推理轨迹到底是模型通过某种通用的推理能力（举一反三）做出来的，还是仅仅靠死记硬背某种特定的解题模板（“看到这个形状就用这个套路”）做出来的。因为它没法区分这两种过程，所以模型可能学会了后者（简单的套路），而不是前者（通用的能力）。</p>
<p>当你使用策略梯度（policy gradient）进行 rollout（即让模型生成完整的行为序列）时，那种更复杂、更具泛化能力的策略几乎不可能被采样到；而简单的启发式策略却很容易被采样到，并随着训练不断被强化，出现频率越来越高，最终完全主导模型的行为（即达到“固定”状态）。<strong>与此同时，真正的通用策略则越来越难以被观察到，逐渐从训练过程中消失。</strong></p>
<p>那么问题来了，我们该如何搭建一座“短桥”，把简单的启发式解法，和那种更复杂、更具泛化能力的通用策略连接起来？而且，这座桥会不会随着任务时间跨度（time horizons）自然拉长而自动出现 —— 从而迫使模型发展出真正的泛化能力？</p>
<p>我担心的是，那种“先退一步、基于对世界的理解做出明智判断”的通用策略，即使在更长周期的任务中，也依然很难通过“可验证的奖励”（verifiable rewards）被有效识别和强化。<strong>因此，要解决这种不均衡问题，不能只靠扩大 RLVR 的规模，而必须设计更鲁棒的训练方法。</strong></p>
<h2 data-id="heading-6"><strong>07 人类的学习方式</strong></h2>
<p>本节我们讨论的只是 model-free RL —— 也就是仅从一个强化学习周期结束时的二元结果（成功/失败）中获得的信息量（bits/sample）。但显然，人类的学习效率远高于此。想想假如有一位连续创业者，我们会说她拥有大量来之不易的智慧和经验。而这些学习成果中，极少部分真正来自上一次创业的“one bit”结果（即创业成功与否）。</p>
<p><strong>目前还不清楚，在机器学习中，人类这种从经验中学习的方式对应的是什么机制。</strong> 显然，我们的观察与反思会不断更新我们的世界模型（world model） —— 而且这种更新并不依赖于最终结果是成功还是失败。这在人类学习过程中起着非常重要的作用。</p>
<p>也许我们不该只是想着“如何把 model-free RL 的通过率调到 50% 左右，因为这样做仅仅是试图从一个单一的“成功/失败”结果中，挤出那么一点点微薄的信息。也许我们应该转换思路，去研究人类是如何从环境中获取海量信息的。<strong>人类并不像现在的机器那样，只盯着最终的结果（成功或失败），而是能从过程、观察和反思中吸收大量的经验和教训。</strong></p>
<p>1 这个公式的意思是：从一个二元结果中学到的信息量 ＝p(样本正确) × (样本正确时获得的信息量) ＋p(样本错误) × (样本错误时获得的信息量)。</p>
<p>2 感谢 Lukas Berglund 指出我此前在这一点上的阐述有误。</p>
<p><strong>END</strong></p>
<p><strong>本期互动内容 🍻</strong></p>
<p><strong>❓人类从失败中能学到远不止“0/1”的反馈——你觉得 AI 系统要如何模拟这种过程性反思能力？</strong></p>
<p><strong>文中链接</strong></p>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tobyord.com%2Fwriting%2Finefficiency-of-reinforcement-learning" target="_blank" title="https://www.tobyord.com/writing/inefficiency-of-reinforcement-learning" ref="nofollow noopener noreferrer">www.tobyord.com/writing/ine…</a></p>
<p>[2]<a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Fblog%2Flora%2F%23how-much-capacity-is-needed-by-supervised-and-reinforcement-learning" target="_blank" title="https://thinkingmachines.ai/blog/lora/#how-much-capacity-is-needed-by-supervised-and-reinforcement-learning" ref="nofollow noopener noreferrer">thinkingmachines.ai/blog/lora/#…</a></p>
<p>[3]<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2012.03107" target="_blank" title="https://arxiv.org/pdf/2012.03107" ref="nofollow noopener noreferrer">arxiv.org/pdf/2012.03…</a></p>
<p>[4]<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F1707.05300" target="_blank" title="https://arxiv.org/pdf/1707.05300" ref="nofollow noopener noreferrer">arxiv.org/pdf/1707.05…</a></p>
<p>[5]<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2501.12948" target="_blank" title="https://arxiv.org/abs/2501.12948" ref="nofollow noopener noreferrer">arxiv.org/abs/2501.12…</a></p>
<p>[6]<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2510.07364v3" target="_blank" title="https://arxiv.org/abs/2510.07364v3" ref="nofollow noopener noreferrer">arxiv.org/abs/2510.07…</a></p>
<p>[7]<a href="https://link.juejin.cn?target=https%3A%2F%2Fepoch.ai%2Fdata%2Fai-models" target="_blank" title="https://epoch.ai/data/ai-models" ref="nofollow noopener noreferrer">epoch.ai/data/ai-mod…</a></p>
<p><strong>原文链接：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.dwarkesh.com%2Fp%2Fbits-per-sample" target="_blank" title="https://www.dwarkesh.com/p/bits-per-sample" ref="nofollow noopener noreferrer">www.dwarkesh.com/p/bits-per-…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[96%准确率！中科院提出ACLNet，攻克骨架动作识别最难问题：相似动作区分]]></title>    <link>https://juejin.cn/post/7600665529112641536</link>    <guid>https://juejin.cn/post/7600665529112641536</guid>    <pubDate>2026-01-30T02:28:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600665529112641536" data-draft-id="7600607462585565219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="96%准确率！中科院提出ACLNet，攻克骨架动作识别最难问题：相似动作区分"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2026-01-30T02:28:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            96%准确率！中科院提出ACLNet，攻克骨架动作识别最难问题：相似动作区分
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:28:52.000Z" title="Fri Jan 30 2026 02:28:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在计算机视觉领域，基于骨架的人体动作识别一直备受关注。相比传统视频流，骨架数据不仅计算高效，还对环境光照、背景干扰有着天然的免疫力。然而，骨架模型也有自己的“心病”：由于缺乏物体信息和精细的体型特征，它很难分清那些动作极其相似的行为，比如“读书”和“写字”、“喝水”和“擦嘴”。</p>
<p>为了解决这一难题，中国科学院、中国科学院大学、北京邮电大学以及月之暗面等机构的研究者们联合提出了一种名为 ACLNet 的新框架，全称为 亲和对比学习网络。</p>
<p>该研究已被IEEE生物识别、行为与身份科学汇刊（T-BIOM 2026）录用，相关代码已在GitHub开源。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfcda1a54fe340f09afe23b827e26240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=4WiRvWgUS%2BcbKNRhOTz1Q%2BiWhzY%3D" alt="图片1.png" loading="lazy"/></p>
<blockquote>
<p><strong>论文地址：</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.16694" target="_blank" title="https://arxiv.org/abs/2601.16694" ref="nofollow noopener noreferrer">arxiv.org/abs/2601.16…</a></strong></p>
<p><strong>代码仓库：</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffirework8%2FACLNet" target="_blank" title="https://github.com/firework8/ACLNet" ref="nofollow noopener noreferrer">github.com/firework8/A…</a></strong></p>
</blockquote>
<h2 data-id="heading-0"><strong>传统对比学习的局限</strong></h2>
<p>当前的骨架识别方法大多采用通用对比学习范式：让同类样本靠拢，异类样本远离。这种看似完美的方案在实际应用中存在两个关键痛点：</p>
<ol>
<li><strong>忽视了类间的结构共性：</strong> 有些动作虽然类别不同，但运动模式高度相似。比如“读书”和“喝水”都有手部向头部靠拢的轨迹。如果只是简单地把它们推开，模型很难学到真正细微的判别特征。</li>
<li><strong>类内异常样本的干扰：</strong> 由于拍摄角度、动作幅度差异，同一类动作里可能存在“离群”的正样本。这些样本容易与相似类别的负样本混淆，导致模型在特征空间中产生错误的聚类。</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3237dc1d0824d1791b72bf7a1d01e8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=Q4JJg8qB2djrpdN91TMEeXtRKnI%3D" alt="图片2.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>ACLNet：引入“亲和力”的新视角</strong></h2>
<p>为了应对上述挑战，ACLNet提出了两套核心策略：<strong>类间亲和对比学习</strong> 和 <strong>类内边缘对比学习。</strong></p>
<ul>
<li><strong>核心架构与流程</strong></li>
</ul>
<p>ACLNet的整体流程清晰明了：</p>
<p>输入：包含N帧、V个关节、每关节C维特征的原始骨架序列</p>
<p>处理：利用图卷积网络提取时空特征，通过投影层映射到256维对比特征空间</p>
<p>输出：一方面通过分类头输出动作预测标签，另一方面通过亲和对比学习损失函数优化特征分布</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ded09da5d94856a5d35f13d87df891~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=ITQ7J%2BAcupPlFXvYK0WZR%2Bykdxg%3D" alt="图片3.png" loading="lazy"/></p>
<ul>
<li><strong>创新点1：寻找“动作家族”</strong></li>
</ul>
<p>ACLNet的妙招在于引入亲和相似度概念，不再只看两个类别是否直接混淆，还会考察它们是否拥有共同的“朋友圈”。</p>
<p>具体计算分两步：</p>
<p>直接关联：通过混淆矩阵统计易混淆类别</p>
<p>间接关联：如果类别A和B都经常被误判为类别C，则A和B存在隐藏的结构共性</p>
<p>通过这种方式，模型将具有相似运动模式的类别聚合成一个个动作家族。在训练时，模型会针对家族内部成员进行更有针对性的对比优化。</p>
<p>配合这一概念，作者还设计了族群感知温度调度：当家族规模较小时，使用较小温度值放大硬负样本差异；家族规模较大时，适当放宽条件保持聚类稳定性。这种“因材施教”的策略让模型在不同粒度上都能保持敏锐。</p>
<ul>
<li><strong>创新点2：强力分离硬样本</strong></li>
</ul>
<p>针对类内异常样本，ACLNet引入类内边缘对比损失。它在正负样本之间强行加入边缘约束，即使某个正样本长得很像负样本，模型也会强制拉开它们之间的距离，实现更稳健的特征分离。</p>
<h2 data-id="heading-2"><strong>性能表现：刷榜多项主流数据集</strong></h2>
<p>ACLNet在六大主流基准数据集上展现出稳健性能：</p>
<ul>
<li><strong>动作识别任务</strong></li>
</ul>

<ul>
<li>NTU RGB+D 60：X-Sub准确率93.6%，刷新SOTA记录</li>
<li>NTU RGB+D 120：X-Sub准确率90.7%，同样达到SOTA水平</li>
<li>Kinetics-Skeleton：Top-1准确率52.1%，相比之前的SOTA方法DS-GCN有明显提升</li>
<li>FineGYM：细粒度动作识别准确率达96.0%，证明其在区分极细微动作差异方面的卓越能力</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a35cee1a479a4502b513e4e3484695c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=d%2FYPWzM0udVtzZHCZnoz5vaEERM%3D" alt="图片4.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60496918ae334ad3ae9b056fdee1bafc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=ZC1xJaRRCQBqaVe6WoVMHQQqGtg%3D" alt="图片5.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/377bf9e20ada4e929a7572e4b50a73bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=ta%2FBFvfMm3HtXPGKfSSCrdkDWVs%3D" alt="图片6.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ffab2a9c88643d6a8b60578e1d538c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=W3oBOhBXfucCrO%2BJOpsMFWWOLME%3D" alt="图片7.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ee0fbe8efac4e5295089a11951351e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=OS0fgRjTbdoSHgbLORaew8V%2BilM%3D" alt="图片8.png" loading="lazy"/></p>
<ul>
<li><strong>生物特征识别任务</strong></li>
</ul>

<ul>
<li>CASIA-B步态识别：平均准确率88.5%</li>
<li>行人重识别：N-N设置下达到82.8%</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faaf501790eb4f63ac9e163161bb24ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=%2Fj6uEafeqpWLdDXwu8ZwsY%2FzBn8%3D" alt="图片9.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492e1190051b4f918574fe63d41e6fec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=2uWyaGQbVd2NvQ3GlDXAA4P6WcM%3D" alt="图片10.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>实验中的有趣发现</strong></h2>
<ul>
<li><strong>“动作家族”可视化</strong></li>
</ul>
<p>消融实验中展示了“动作家族”的直观案例。比如“读书”和“穿夹克”这两个动作，模型通过亲和力建模，精准捕捉到了它们在手部和手臂轨迹上的结构共性。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59cbb453b2204ccea6799c80344664ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=QXz1IibTxioKFWSv5yxU82AH42k%3D" alt="图片11.png" loading="lazy"/></p>
<ul>
<li><strong>超参数敏感性</strong></li>
</ul>
<p>模型对边缘约束和损失权重的选择非常讲究。实验表明，当边缘约束设为0.3且权重为0.1时，模型能达到最优平衡。这说明适度的约束比过度惩罚更能引导模型学习到泛化性强的特征。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f9fa74e974c49f3851150b18fb6c3c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=PKQPXOInVp2CHpp8GysnfKXUZWI%3D" alt="图片12.png" loading="lazy"/></p>
<ul>
<li><strong>对噪声数据的鲁棒性</strong></li>
</ul>
<p>ACLNet对噪声数据表现出极强的鲁棒性。在模拟遮挡的极端情况下（如缺少双臂或双腿），ACLNet的识别准确率依然大幅领先传统模型。</p>
<p>例如在缺少“双手”的情况下，ACLNet仍能保持79.6%的准确率，而经典模型MS-G3D仅剩17.1%。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19c7c90ba4f8484babfa17963907cbe1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=YGP7KgUru7hzc98M5NtnrSBIRv8%3D" alt="图片13.png" loading="lazy"/></p>
<ul>
<li><strong>攻克相似动作“深水区”</strong></li>
</ul>
<p>类间改进差异分析显示，ACLNet提升最明显的正是传统模型最头疼的“重灾区”，如“打喷嚏/咳嗽”、“读书”和“打字”。这些动作在骨架空间中极其接近，但ACLNet通过亲和力约束，在特征空间中开辟了专属领地。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d49d9ae5df8b4748929fb3ada505e768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=js5TqckvwkdX2SQ3v6lxvnpsL8U%3D" alt="图片14.png" loading="lazy"/></p>
<p>t-SNE可视化显示，随着训练进行，原本混杂的相似动作在特征空间中逐渐分离，聚类变得更加紧凑清晰。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4ae6446813441383fc3b7ca138a096~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770344931&amp;x-signature=bTnnzAtDT%2BSwNV4lTE2wph1CyuM%3D" alt="图片15.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>结论</strong></h2>
<p>本文提出ACLNet——一种基于骨架的人类活动理解亲和对比学习网络。具体而言，我们的方法通过两大创新突破了现有技术的局限：首先引入亲和相似性概念，用于建模难分类别的语义关系，并通过跨类亲和学习实现针对性优化； 其次，我们提出边缘对比策略，通过显式控制困难正样本与负样本的分离度，增强了模型对类内变异的鲁棒性。在六个基准数据集上的广泛实验验证了ACLNet在骨架动作识别、步态识别及人脸再识别任务中的有效性。所提出的亲和建模范式为精细化活动分析与行为生物特征识别开辟了新路径，在安全防护、医疗健康及人机交互领域具有广阔应用前景。  </p>
<h2 data-id="heading-5"><strong>技术实现与开源</strong></h2>
<p>该项目已在GitHub开源，使用单张RTX 3090即可复现实验。代码结构清晰，模块化设计便于扩展和修改，为从事行为识别、步态分析或生物特征识别的研究者提供了一个扎实的基准模型。</p>
<p>ACLNet的突破在于告诉我们：对比学习不应只是简单地“拉近”和“推开”。通过引入“亲和力”这一维度，模型能够像人类一样理解动作之间的逻辑关联，从而在细微处见真章。</p>
<p>这一创新不仅提升了骨架动作识别的准确性，更为对比学习在复杂场景下的应用提供了新思路。随着相关代码的开源，我们期待看到更多研究者在此基础上开发出更加强大和智能的动作理解系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文档切分实战：5种方法详解，打造高效RAG系统的第一步]]></title>    <link>https://juejin.cn/post/7600600904095006754</link>    <guid>https://juejin.cn/post/7600600904095006754</guid>    <pubDate>2026-01-29T12:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600600904095006754" data-draft-id="7600600904094941218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文档切分实战：5种方法详解，打造高效RAG系统的第一步"/> <meta itemprop="keywords" content="机器学习"/> <meta itemprop="datePublished" content="2026-01-29T12:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狸猫算君"/> <meta itemprop="url" content="https://juejin.cn/user/643654644149178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文档切分实战：5种方法详解，打造高效RAG系统的第一步
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/643654644149178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狸猫算君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:00:39.000Z" title="Thu Jan 29 2026 12:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为什么文档切分是RAG的“灵魂一步”？</h2>
<p>大家好，我是专注于AI技术实践分享的博主狸猫算君~今天我们来聊聊RAG（检索增强生成）技术中那个看似简单却至关重要的环节——<strong>文档切分</strong>。</p>
<p>想象一下这个场景：你有一个几百页的产品手册，想让AI助手根据手册内容回答用户问题。如果直接把整个手册扔给模型，就像让人一眼看完百科全书再答题，效果可想而知。而文档切分，就是把这本“百科全书”拆分成一个个有逻辑的“知识点卡片”，让模型能快速找到最相关的那几页。</p>
<p>在实际应用中，文档切分质量直接决定了：</p>
<ul>
<li><strong>问答准确性</strong>：切得不好，模型可能检索到不完整的上下文</li>
<li><strong>响应速度</strong>：合理的分块能提升检索效率</li>
<li><strong>成本控制</strong>：减少不必要的token消耗</li>
</ul>
<p>无论是构建企业知识库、智能客服还是个人AI助手，掌握文档切分都是让大模型真正“理解”你专属数据的关键第一步。</p>
<h2 data-id="heading-1">技术原理：五大切分策略，哪种适合你的场景？</h2>
<h3 data-id="heading-2">1. 按句子切分：最自然的语义单元</h3>
<p><strong>核心思想</strong>：按照自然语言的标点符号（句号、感叹号、问号等）进行分割。<br/>
<strong>优点</strong>：保持了完整的语义边界，最符合人类阅读习惯<br/>
<strong>适用场景</strong>：普通文章、报告、邮件等自然语言文档</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re

<span class="hljs-keyword">def</span> <span class="hljs-title function_">split_by_sentences</span>(<span class="hljs-params">text</span>):
    <span class="hljs-comment"># 匹配中英文句末标点</span>
    pattern = <span class="hljs-string">r"[。！？.!?]+"</span>
    sentences = re.split(pattern, text)
    <span class="hljs-keyword">return</span> [s.strip() <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> sentences <span class="hljs-keyword">if</span> s.strip()]

<span class="hljs-comment"># 示例：一段描述春节的文字</span>
text = <span class="hljs-string">"春节的脚步越来越近，大街小巷都布满了节日的气氛。商店门口挂满了红灯笼和春联..."</span>
chunks = split_by_sentences(text)
</code></pre>
<h3 data-id="heading-3">2. 固定字符数切分：简单粗暴的均匀分割</h3>
<p><strong>核心思想</strong>：像切香肠一样，每段固定长度，不考虑语义完整性。<br/>
<strong>优缺点</strong>：实现简单，但可能从句子中间切断<br/>
<strong>适用场景</strong>：日志文件、代码、结构化数据</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_by_length</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">100</span></span>):
    <span class="hljs-keyword">return</span> [text[i:i+chunk_size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(text), chunk_size)]
</code></pre>
<h3 data-id="heading-4">3. 固定字符数+重叠窗口：平衡的折中方案</h3>
<p><strong>核心思想</strong>：在固定长度的基础上，让相邻块有一定重叠，防止关键信息被切断。</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">def split_with_overlap(text, <span class="hljs-attr">chunk_size</span>=<span class="hljs-number">100</span>, overlap=<span class="hljs-number">20</span>):
    <span class="hljs-attr">chunks</span> = []
    <span class="hljs-attr">start</span> = <span class="hljs-number">0</span>
    while start &lt; len(text):
        <span class="hljs-attr">end</span> = start + chunk_size
        chunks.append(text<span class="hljs-section">[start:end]</span>)
        start += chunk_size - overlap  <span class="hljs-comment"># 滑动窗口，保留重叠部分</span>
    return chunks
</code></pre>
<p><strong>为什么需要重叠？</strong><br/>
假设我们查询“小朋友们在做什么”，如果关键信息“看到小朋友们手持烟花棒，欢笑声此起彼伏”刚好被切到两个块之间，没有重叠就会丢失上下文。有重叠窗口能确保关键信息在至少一个块中完整存在。</p>
<h3 data-id="heading-5">4. 递归切分：LangChain的默认选择</h3>
<p><strong>核心思想</strong>：智能分层切割，优先用换行符分割，不行再用空格，最后用字符。<br/>
<strong>工作流程</strong>：</p>
<ol>
<li>先用<code>\n\n</code>（空行）尝试分割</li>
<li>如果块还太大，用<code>\n</code>（换行）分割</li>
<li>继续用空格分割，最后用字符分割</li>
<li>确保每个块接近但不超预设大小</li>
</ol>
<p><strong>优势</strong>：在保持语义和均匀大小之间取得最佳平衡</p>
<h3 data-id="heading-6">5. 语义切分：未来方向</h3>
<p><strong>核心思想</strong>：用嵌入模型计算语义相似度，在语义变化处切分。<br/>
<strong>技术实现</strong>：计算句子向量，检测向量距离突变点<br/>
<strong>现状</strong>：效果最好但计算成本高，适合对质量要求极高的场景</p>
<h2 data-id="heading-7">实践步骤：从零开始实现文档切分</h2>
<h3 data-id="heading-8">环境准备</h3>
<p>python</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基础环境</span>
pip install langchain langchain-text-splitters

<span class="hljs-comment"># 可选：用于处理特定格式</span>
pip install pypdf markdown
</code></pre>
<h3 data-id="heading-9">步骤一：处理普通文本文件</h3>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from langchain.text_splitter import RecursiveCharacterTextSplitter

<span class="hljs-comment"># 1. 读取文档</span>
with open("document.txt", "r", <span class="hljs-attr">encoding</span>=<span class="hljs-string">"utf-8"</span>) as f:
    <span class="hljs-attr">text</span> = f.read()

<span class="hljs-comment"># 2. 初始化分割器（推荐参数）</span>
<span class="hljs-attr">splitter</span> = RecursiveCharacterTextSplitter(
    <span class="hljs-attr">chunk_size</span>=<span class="hljs-number">500</span>,      <span class="hljs-comment"># 每个块约500字符</span>
    <span class="hljs-attr">chunk_overlap</span>=<span class="hljs-number">50</span>,    <span class="hljs-comment"># 重叠50字符保持连贯</span>
    <span class="hljs-attr">separators</span>=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>]  <span class="hljs-comment"># 分层分割策略</span>
)

<span class="hljs-comment"># 3. 执行分割</span>
<span class="hljs-attr">chunks</span> = splitter.split_text(text)
print(f"总文档切分为 {len(chunks)} 个块")
</code></pre>
<h3 data-id="heading-10">步骤二：处理特殊格式文档</h3>
<p>不同的文档类型需要不同的处理策略：</p>
<p><strong>Markdown文档</strong>（保持标题结构）：</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from langchain.text_splitter import MarkdownHeaderTextSplitter

<span class="hljs-attr">headers_to_split_on</span> = [
    (<span class="hljs-string">"#"</span>, <span class="hljs-string">"主标题"</span>),
    (<span class="hljs-string">"##"</span>, <span class="hljs-string">"二级标题"</span>),
    (<span class="hljs-string">"###"</span>, <span class="hljs-string">"三级标题"</span>),
]

<span class="hljs-attr">splitter</span> = MarkdownHeaderTextSplitter(headers_to_split_on)
<span class="hljs-attr">md_chunks</span> = splitter.split_text(markdown_content)
</code></pre>
<p><strong>PDF文档</strong>（先提取文本）：</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from PyPDF2 import PdfReader
from langchain.text_splitter import RecursiveCharacterTextSplitter

<span class="hljs-attr">reader</span> = PdfReader(<span class="hljs-string">"document.pdf"</span>)
<span class="hljs-attr">text</span> = <span class="hljs-string">""</span>
for page in reader.pages:
    text += page.extract_text()

<span class="hljs-attr">splitter</span> = RecursiveCharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>)
<span class="hljs-attr">pdf_chunks</span> = splitter.split_text(text)
</code></pre>
<p><strong>代码文件</strong>（按语言特性分割）：</p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">from langchain.text_splitter import Language, RecursiveCharacterTextSplitter

<span class="hljs-comment"># 支持Python、Java、JavaScript等15种语言</span>
<span class="hljs-attr">python_splitter</span> = RecursiveCharacterTextSplitter.from_language(
    <span class="hljs-attr">language</span>=Language.PYTHON,
    <span class="hljs-attr">chunk_size</span>=<span class="hljs-number">400</span>,
    <span class="hljs-attr">chunk_overlap</span>=<span class="hljs-number">40</span>
)
<span class="hljs-attr">code_chunks</span> = python_splitter.split_text(python_code)
</code></pre>
<h3 data-id="heading-11">步骤三：参数调优实战</h3>
<p>参数选择没有“银弹”，需要根据数据特点调整：</p>
<ol>
<li>
<p><strong>chunk_size选择指南</strong>：</p>
<ul>
<li>问答系统：200-500字符（精准匹配）</li>
<li>文档总结：800-1500字符（上下文完整）</li>
<li>代码分析：300-600字符（函数级完整）</li>
</ul>
</li>
<li>
<p><strong>chunk_overlap经验值</strong>：</p>
<ul>
<li>一般为chunk_size的10%-20%</li>
<li>重要文档可以增加到25%</li>
</ul>
</li>
<li>
<p><strong>快速测试脚本</strong>：</p>
</li>
</ol>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_chunking_params</span>(<span class="hljs-params">text, size, overlap</span>):
    splitter = RecursiveCharacterTextSplitter(
        chunk_size=size,
        chunk_overlap=overlap
    )
    chunks = splitter.split_text(text)
    
    <span class="hljs-comment"># 统计信息</span>
    avg_len = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chunks) / <span class="hljs-built_in">len</span>(chunks)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"参数：size=<span class="hljs-subst">{size}</span>, overlap=<span class="hljs-subst">{overlap}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"块数：<span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span>，平均长度：<span class="hljs-subst">{avg_len:<span class="hljs-number">.0</span>f}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"前3个块示例：\n<span class="hljs-subst">{chunks[:<span class="hljs-number">3</span>]}</span>\n"</span>)
    
    <span class="hljs-keyword">return</span> chunks

<span class="hljs-comment"># 测试不同参数</span>
test_chunking_params(your_text, <span class="hljs-number">300</span>, <span class="hljs-number">30</span>)
test_chunking_params(your_text, <span class="hljs-number">500</span>, <span class="hljs-number">50</span>)
</code></pre>
<h3 data-id="heading-12">步骤四：质量检查与修复</h3>
<p>切分后务必人工检查：</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_chunk_quality</span>(<span class="hljs-params">chunks</span>):
    issues = []
    <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):
        <span class="hljs-comment"># 检查是否从句子中间切断</span>
        <span class="hljs-keyword">if</span> chunk <span class="hljs-keyword">and</span> chunk[-<span class="hljs-number">1</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-string">"。.?!！？"</span>:
            issues.append(<span class="hljs-string">f"块<span class="hljs-subst">{i}</span>可能不完整"</span>)
        
        <span class="hljs-comment"># 检查长度是否异常</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &lt; <span class="hljs-number">50</span>:
            issues.append(<span class="hljs-string">f"块<span class="hljs-subst">{i}</span>过短：<span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunk)}</span>字符"</span>)
    
    <span class="hljs-keyword">return</span> issues

<span class="hljs-comment"># 执行检查</span>
issues = check_chunk_quality(chunks)
<span class="hljs-keyword">if</span> issues:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"发现以下问题："</span>)
    <span class="hljs-keyword">for</span> issue <span class="hljs-keyword">in</span> issues:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - <span class="hljs-subst">{issue}</span>"</span>)
</code></pre>
<h2 data-id="heading-13">效果评估：如何验证切分质量？</h2>
<p><img src="https://p3-volc-community-sign.byteimg.com/tos-cn-i-tlddhu82om/0bc57c98decf457e85fb9dbf2a9227e1~tplv-tlddhu82om-image.image?=&amp;rk3s=8031ce6d&amp;x-expires=1769774406&amp;x-signature=dahzJTYc91sz6dwnjYUl1GobSLo%3D" alt="13414161591326003.jpeg" loading="lazy"/></p>
<h3 data-id="heading-14">量化评估指标</h3>
<ol>
<li><strong>检索准确率测试</strong>：</li>
</ol>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟查询测试</span>
test_queries = [<span class="hljs-string">"文档提到哪些关键点？"</span>, <span class="hljs-string">"具体操作步骤是什么？"</span>]
<span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> test_queries:
    <span class="hljs-comment"># 检索相关块（简单模拟）</span>
    relevant_chunks = retrieve_chunks(query, chunks)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"查询：<span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"检索到<span class="hljs-subst">{<span class="hljs-built_in">len</span>(relevant_chunks)}</span>个相关块"</span>)
    <span class="hljs-comment"># 人工评估相关性...</span>
</code></pre>
<ol start="2">
<li>
<p><strong>块完整性评分</strong>（0-1分）：</p>
<ul>
<li>1分：完整句子/段落</li>
<li>0.5分：语义基本完整</li>
<li>0分：明显截断</li>
</ul>
</li>
<li>
<p><strong>重叠必要性分析</strong>：</p>
<ul>
<li>统计有多少查询需要跨块信息</li>
<li>计算重叠部分的使用频率</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">真实场景测试建议</h3>
<ol>
<li><strong>准备测试集</strong>：包含各种类型的查询</li>
<li><strong>A/B测试</strong>：比较不同切分策略的问答效果</li>
<li><strong>用户反馈收集</strong>：实际使用中的准确率</li>
</ol>
<p><strong>经验法则</strong>：好的切分应该让AI回答时像“引用书中的某一页”，而不是“复述整本书”。</p>
<h2 data-id="heading-16">总结与展望</h2>
<h3 data-id="heading-17">核心要点回顾</h3>
<ol>
<li><strong>没有最好，只有最适合</strong>：根据文档类型选择切分策略</li>
<li><strong>参数需要调优</strong>：chunk_size和overlap需要实验确定</li>
<li><strong>格式感知</strong>：不同格式文档使用专用分割器</li>
<li><strong>质量检查必不可少</strong>：自动检查+人工抽样</li>
</ol>
<h3 data-id="heading-18">常见误区提醒</h3>
<ul>
<li>❌ 盲目追求小块：可能导致上下文不足</li>
<li>❌ 忽视重叠窗口：可能切断关键信息</li>
<li>❌ 一成不变：不同文档可能需要不同策略</li>
<li>❌ 忽视格式：PDF、Word需要先正确提取文本</li>
</ul>
<h3 data-id="heading-19">未来发展趋势</h3>
<ol>
<li><strong>自适应切分</strong>：AI自动学习最佳切分参数</li>
<li><strong>多模态切分</strong>：同时处理文本、表格、图片</li>
<li><strong>实时动态切分</strong>：根据查询动态调整块大小</li>
</ol>
<p>掌握了文档切分的理论基础后，如果你想快速实践一个完整的RAG应用，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamafactory.com.cn%2Fregister%3Futm_source%3Djslt_xtjj_wsy" target="_blank" title="https://www.llamafactory.com.cn/register?utm_source=jslt_xtjj_wsy" ref="nofollow noopener noreferrer"><strong>LLaMA-Factory Online</strong></a>提供了从文档上传、智能切分、向量化存储到模型微调的全流程支持。即使没有编程基础，也能通过可视化界面完成整个流程，真正实现“把自己的数据喂给大模型”，打造出理解你业务场景的专属AI助手。</p>
<h3 data-id="heading-20">动手实践建议</h3>
<ol>
<li><strong>从小开始</strong>：先用100KB以内的文档测试</li>
<li><strong>多样化测试</strong>：尝试不同参数组合</li>
<li><strong>记录结果</strong>：建立自己的参数经验库</li>
<li><strong>持续迭代</strong>：随着数据变化调整策略</li>
</ol>
<p>文档切分是连接原始数据与智能应用的桥梁。掌握好这项技术，你就能让大模型真正“读懂”你的数据，释放私有数据的最大价值。记住，好的开始是成功的一半，在RAG系统中，好的文档切分就是那个“好的开始”。</p>
<p>有任何问题或实践心得，欢迎在评论区交流讨论。下次我们将深入探讨向量化存储的最佳实践，敬请期待！</p>
<hr/>
<p><strong>声明</strong>：本文所有代码示例均可直接运行，建议在Jupyter Notebook中逐步实践。技术细节基于LangChain 0.1.x版本，具体实现可能随版本更新有所变化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[认识论的数学表示——梯度下降算法]]></title>    <link>https://juejin.cn/post/7600597995768610825</link>    <guid>https://juejin.cn/post/7600597995768610825</guid>    <pubDate>2026-01-29T12:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995768610825" data-draft-id="7600628279215144986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="认识论的数学表示——梯度下降算法"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T12:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="在路上的达"/> <meta itemprop="url" content="https://juejin.cn/user/1628822092128964"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            认识论的数学表示——梯度下降算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1628822092128964/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    在路上的达
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:52:58.000Z" title="Thu Jan 29 2026 12:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一篇一位学习者学习梯度下降算法时的一点思考与想法，记录了在此阶段的初步理解和认识。依照马克思主义认识论的观点，认识是一个从感性认识到理性认识不断上升，不断发展的过程。因此，我深知我对梯度下降算法的理解尚处于初级阶段，受限于知识背景和实践水平，文中可能或多或少出现理解上的不准确和局限性。</p>
<p>算法从根本上说，还是一个”工具“，工具无论如何”高大上“，都是为了”目的“服务的。那么，梯度下降的算法要解决的是一个什么问题呢？</p>
<p>在现实生活中，我们知道，它被用于训练机器学习模型。但是这对我们来说有些复杂，我们先来看一个简单的数学问题：二元线性回归。</p>
<p>数学是对现实世界的抽象，用抽象的符号和公式，反应现实世界的某种规律，但是在从现实事物到符号的抽象过程中，不可避免的出现”失真“的情况，换句话说，数学讨论的是一种理想情况。</p>
<h3 data-id="heading-0">文章结构</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">文章脉络:</span>
├── 问题概述 (二元线性回归、数学抽象与失真、待处理数据)
├── 梯度下降算法核心思想 (损失函数、下山比喻、偏导数与步长、参数迭代更新)
├── 梯度下降算法的四个要素 (初始值、计算梯度、迭代更新参数、停止条件)
├── 回到问题 - 实践篇
│   ├── 初始化参数 (w, lr, num_iterations)
│   └── 梯度下降核心步骤 (数学公式推导与Python代码实现)
│       ├── 计算预测值
│       ├── 计算损失
│       ├── 计算梯度 (w0, w1, w2)
│       └── 更新参数 (w0, w1, w2)
└── 结语
</code></pre>
<h3 data-id="heading-1">问题概述：二元线性回归</h3>
<p>首先什么是”线性回归“？线性回归是一个预测模型，也就是说，它会根据已有的信息总结出一个规律——用数学的语言表达就是：拟合出一条曲线——然后利用这个规律对未来的事情进行预测。所谓”二元“，就是变量有两个，有两个事情会对最终的结果产生影响。现在用数学公式对这个事情进行表达：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\hat{y} = w_{0} + w_{1}x_{1} + w_{2}x_{2} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mn>0</mn><mo>−</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">w_{0-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span></span></span></span></span> 叫做参数，是训练过程中由算法调整的，也就是输入到底经历了什么样的运算才到输出，我们究竟根据已有的经验建构了什么样的规律。</p>
<p>我们已有的数据如下：</p>













































<table><thead><tr><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></th></tr></thead><tbody><tr><td>10</td><td>3</td><td>60</td></tr><tr><td>20</td><td>3</td><td>85</td></tr><tr><td>25</td><td>3</td><td>100</td></tr><tr><td>28</td><td>2.5</td><td>120</td></tr><tr><td>30</td><td>2</td><td>140</td></tr><tr><td>35</td><td>2.5</td><td>145</td></tr><tr><td>40</td><td>2.5</td><td>163</td></tr></tbody></table>
<p>我们就是要从这堆数据中找到一个规律，一个从x到y的规律，以便于当我们遇到新的x时，可以预测出一个尽可能接近真实y的<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span></span></span></span>。</p>
<h3 data-id="heading-2">梯度下降算法</h3>
<p>那么怎么找到这个规律呢？（怎么拟合这个曲线呢？）
利用这个规律得出的结果尽可能贴近现实情况就是一个”好“的规律，也就是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span></span></span></span> 与 y 之间的差值越小，就越好。描述这个差值的东西数学上叫做：损失函数，公式如下</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msup><mi>y</mi><mi>i</mi></msup><mo>−</mo><mover accent="true"><msup><mi>y</mi><mi>i</mi></msup><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L(w_{0},w_{1},w_{2}) = \frac{1}{n}\sum_{i = 1}^{n}(y^{i}-\hat{y^{i}})^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2641em;vertical-align:-0.25em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0141em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7507em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span><span style="top:-3.3197em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>这个例子中，需要调整的参数有三个，可能不太好理解，我们先考虑只有两个参数的损失函数，理解其精髓，然后类比理解三个参数。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msup><mi>y</mi><mi>i</mi></msup><mo>−</mo><mover accent="true"><msup><mi>y</mi><mi>i</mi></msup><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L(w_{0},w_{1}) = \frac{1}{n}\sum_{i = 1}^{n}(y^{i}-\hat{y^{i}})^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2641em;vertical-align:-0.25em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0141em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7507em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span><span style="top:-3.3197em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48bed548736146d093a6d30b853e7925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295983&amp;x-signature=Jg6sBT404S%2BjeML1C29z%2Fxe7vFs%3D" alt="Pasted image 20251026175436.png" loading="lazy"/></p>
<p>假如说你现在在一座浓雾弥漫的山上，想要尽快下山，奈何看不清远处的路，如何选择最快的下山路径呢？梯度下降的算法就是在当前位置选择最陡峭的一个方向走一步，然后再看哪个方向陡峭，再走一步，直到走到山底。</p>
<p>在随机给定一组参数的情况下<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(w_{0},w_{1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，判断哪个方向最陡峭使用的数学工具是偏导<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>1</mn></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>2</mn></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\frac{\partial f}{\partial w_{1}}(w_{0},w_{1}),\frac{\partial f}{\partial w_{2}}(w_{1},w_{2})]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3773em;vertical-align:-0.4451em;"/><span class="mopen">[</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)]</span></span></span></span></span>，步长则使用导数值的负数乘一个小于1的数——这个小于1的数被称为学习率<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">lr</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></span>。</p>
<p>即</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mn>0</mn></msub><mo>=</mo><msub><mi>w</mi><mn>0</mn></msub><mo>−</mo><mi>l</mi><mi>r</mi><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>0</mn></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_{0} = w_{0} - lr \frac{\partial f}{\partial w_{0}}(w_{0},w_{1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo>−</mo><mi>l</mi><mi>r</mi><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>1</mn></msub></mrow></mfrac><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_{1} = w_{1} - lr \frac{\partial f}{\partial w_{1}}(w_{0},w_{1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p>经过不断地迭代，就可以下山了，也就是找到<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">Loss</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span></span></span></span></span>最小的参数<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(w_{0},w_{1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>。</p>
<p>以上是两个参数的梯度下降，三个参数，多个参数的也是同理。</p>
<h3 data-id="heading-3">梯度下降算法的四个要素</h3>
<p>这四个要素是在具体使用这个算法进行计算时，必须要注意的事情：</p>
<h4 data-id="heading-4">初始值</h4>
<p>每一个参数，都要随机化一个初始值。</p>
<h4 data-id="heading-5">计算梯度</h4>
<p>梯度就是前文所提到的偏导值，需要计算梯度才能为接下来的迭代更新参数做准备。</p>
<h4 data-id="heading-6">迭代更新参数</h4>
<p>利用梯度值和学习率的乘积更新参数，不断减小Loss值。</p>
<h4 data-id="heading-7">停止条件</h4>
<p>可以预先设定一个迭代次数，也可以设置若连续更新参数Loss值不改变为停止条件。</p>
<h3 data-id="heading-8">回到问题</h3>
<p>对梯度下降算法有了一个整体的感性认识后，便可以动手实践检验我们的理论了，回到我们的问题，我们要利用这些数据拟合出来一条曲线，便于遇到新的输入值x时可以预测出来近似的y值。用生活化的语言表达就是：我们要根据已有的经验归纳总结出来一条规律，一个知识，便于我们遇到新情况的时候可以灵活应对，游刃有余。</p>













































<table><thead><tr><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">x_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></th></tr></thead><tbody><tr><td>10</td><td>3</td><td>60</td></tr><tr><td>20</td><td>3</td><td>85</td></tr><tr><td>25</td><td>3</td><td>100</td></tr><tr><td>28</td><td>2.5</td><td>120</td></tr><tr><td>30</td><td>2</td><td>140</td></tr><tr><td>35</td><td>2.5</td><td>145</td></tr><tr><td>40</td><td>2.5</td><td>163</td></tr></tbody></table>
<h4 data-id="heading-9">初始化参数</h4>
<p>根据前文的分析，在进行拟合之前，我们要对参数进行初始化，并设定一个学习率和迭代的次数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Feature 数据</span>
X = [[<span class="hljs-number">10</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">20</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">28</span>, <span class="hljs-number">2.5</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">35</span>, <span class="hljs-number">2.5</span>], [<span class="hljs-number">40</span>, <span class="hljs-number">2.5</span>]]
y = [<span class="hljs-number">60</span>, <span class="hljs-number">85</span>, <span class="hljs-number">100</span>, <span class="hljs-number">120</span>, <span class="hljs-number">140</span>, <span class="hljs-number">145</span>, <span class="hljs-number">163</span>]  <span class="hljs-comment"># Label 数据</span>
<span class="hljs-comment"># 初始化参数</span>
w = [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]  <span class="hljs-comment"># w0, w1, w2</span>
lr = <span class="hljs-number">0.0001</span>  <span class="hljs-comment"># 学习率</span>
num_iterations = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 迭代次数</span>
</code></pre>
<h4 data-id="heading-10">梯度下降核心步骤</h4>
<p>整体上，这是一个不断迭代的过程，用编程的语言表达就是：这是一个循环。</p>
<p>为了实时看到机器学习这个规律的过程，每次迭代我们都计算一下预测值，并利用预测值和实际值计算出来Loss值。</p>
<p>也就是说，这个循环分为四个步骤，先用数学形式表达一下</p>
<ol>
<li>计算预测值</li>
</ol>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\hat{y} = w_{0} + w_{1}x_{1} + w_{2}x_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<ol start="2">
<li>计算Loss值</li>
</ol>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msup><mo>−</mo><msup><mi>y</mi><mi>i</mi></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">loss = \frac{1}{n}\sum_{i = 1}^{n}(\hat{y}^{i} - y^{i})^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1247em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msubsup><mi>x</mi><mn>1</mn><mi>i</mi></msubsup><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msubsup><mi>x</mi><mn>2</mn><mi>i</mi></msubsup><mo>−</mo><msup><mi>y</mi><mi>i</mi></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">loss = \frac{1}{n}\sum_{i = 1}^{n}(w_{0} + w_{1}x_{1}^{i} + w_{2}x_{2}^{i}-y^{i})^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1247em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<ol start="3">
<li>计算梯度</li>
</ol>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>0</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msubsup><mi>x</mi><mn>1</mn><mi>i</mi></msubsup><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msubsup><mi>x</mi><mn>2</mn><mi>i</mi></msubsup><mo>−</mo><msup><mi>y</mi><mi>i</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{\partial loss}{\partial w_{0}} = \frac{2}{n}\sum_{i = 1}^{n}(w_{0} + w_{1}x_{1}^{i} + w_{2}x^{i}_{2} - y^{i})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1247em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>1</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msubsup><mi>x</mi><mn>1</mn><mi>i</mi></msubsup><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msubsup><mi>x</mi><mn>2</mn><mi>i</mi></msubsup><mo>−</mo><msup><mi>y</mi><mi>i</mi></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mn>1</mn><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial loss}{\partial w_{1}} = \frac{2}{n}\sum_{i = 1}^{n}(w_{0} + w_{1}x_{1}^{i} + w_{2}x_{2}^{i} - y^{i}) \cdot x_{1}^{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1247em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>2</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><msubsup><mi>x</mi><mn>1</mn><mi>i</mi></msubsup><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msubsup><mi>x</mi><mn>2</mn><mi>i</mi></msubsup><mo>−</mo><msup><mi>y</mi><mi>i</mi></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mn>2</mn><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial loss}{\partial w_{2}} = \frac{2}{n}\sum_{i = 1}^{n}(w_{0} + w_{1}x_{1}^{i} + w_{2}x_{2}^{i} - y^{i}) \cdot x_{2}^{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1247em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1217em;vertical-align:-0.247em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span></span></span></span></span></div>
<ol start="4">
<li>更新参数</li>
</ol>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mn>0</mn></msub><mo>=</mo><msub><mi>w</mi><mn>0</mn></msub><mo>−</mo><mi>l</mi><mi>r</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>0</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{0} = w_{0} - lr \cdot \frac{\partial loss}{\partial w_{0}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo>−</mo><mi>l</mi><mi>r</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>1</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{1} = w_{1} - lr \cdot \frac{\partial loss}{\partial w_{1}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mn>2</mn></msub><mo>=</mo><msub><mi>w</mi><mn>2</mn></msub><mo>−</mo><mi>l</mi><mi>r</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>2</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{2} = w_{2} - lr \cdot \frac{\partial loss}{\partial w_{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>然后把数学语言转化成python语言就行了：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 梯度下降</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_iterations):
    <span class="hljs-comment"># 计算预测值</span>
    y_pred = [w[<span class="hljs-number">0</span>] + w[<span class="hljs-number">1</span>] * x[<span class="hljs-number">0</span>] + w[<span class="hljs-number">2</span>] * x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X]
    <span class="hljs-comment"># 计算损失</span>
    loss = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) / <span class="hljs-built_in">len</span>(y)
    <span class="hljs-comment"># 计算梯度</span>
    grad_w0 = <span class="hljs-built_in">sum</span>(y_pred[j] - y[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    grad_w1 = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) * X[j][<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    grad_w2 = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) * X[j][<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    <span class="hljs-comment"># 更新参数</span>
    w[<span class="hljs-number">0</span>] -= lr * grad_w0
    w[<span class="hljs-number">1</span>] -= lr * grad_w1
    w[<span class="hljs-number">2</span>] -= lr * grad_w2
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-keyword">if</span> i % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Iteration <span class="hljs-subst">{i}</span>: Loss = <span class="hljs-subst">{loss}</span>, w = <span class="hljs-subst">{w}</span>'</span>)
<span class="hljs-comment"># 输出最终参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'final parameters: w = <span class="hljs-subst">{w}</span>'</span>)
</code></pre>
<p>完整的代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Feature 数据</span>
X = [[<span class="hljs-number">10</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">20</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">28</span>, <span class="hljs-number">2.5</span>], [<span class="hljs-number">30</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">35</span>, <span class="hljs-number">2.5</span>], [<span class="hljs-number">40</span>, <span class="hljs-number">2.5</span>]]
y = [<span class="hljs-number">60</span>, <span class="hljs-number">85</span>, <span class="hljs-number">100</span>, <span class="hljs-number">120</span>, <span class="hljs-number">140</span>, <span class="hljs-number">145</span>, <span class="hljs-number">163</span>]  <span class="hljs-comment"># Label 数据</span>
<span class="hljs-comment"># 初始化参数</span>
w = [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]  <span class="hljs-comment"># w0, w1, w2</span>
lr = <span class="hljs-number">0.0001</span>  <span class="hljs-comment"># 学习率</span>
num_iterations = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 迭代次数</span>
<span class="hljs-comment"># 梯度下降</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_iterations):
    <span class="hljs-comment"># 计算预测值</span>
    y_pred = [w[<span class="hljs-number">0</span>] + w[<span class="hljs-number">1</span>] * x[<span class="hljs-number">0</span>] + w[<span class="hljs-number">2</span>] * x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X]
    <span class="hljs-comment"># 计算损失</span>
    loss = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) / <span class="hljs-built_in">len</span>(y)
    <span class="hljs-comment"># 计算梯度</span>
    grad_w0 = <span class="hljs-built_in">sum</span>(y_pred[j] - y[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    grad_w1 = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) * X[j][<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    grad_w2 = <span class="hljs-built_in">sum</span>((y_pred[j] - y[j]) * X[j][<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(y))) * <span class="hljs-number">2</span> / <span class="hljs-built_in">len</span>(y)
    <span class="hljs-comment"># 更新参数</span>
    w[<span class="hljs-number">0</span>] -= lr * grad_w0
    w[<span class="hljs-number">1</span>] -= lr * grad_w1
    w[<span class="hljs-number">2</span>] -= lr * grad_w2
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-keyword">if</span> i % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Iteration <span class="hljs-subst">{i}</span>: Loss = <span class="hljs-subst">{loss}</span>, w = <span class="hljs-subst">{w}</span>'</span>)
<span class="hljs-comment"># 输出最终参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'final parameters: w = <span class="hljs-subst">{w}</span>'</span>)
</code></pre>
<p>至此我们用过往经验归纳出来了一条规律，至于这条规律如何，实践是检验真理的唯一标准，我们还需要在不断地实践-认识-实践的循环中加深理解，不断调整，趋近真理。</p>
<p>更多内容，关注同名公众号：“在路上的达”</p>
<p>参考：
[1] <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rethink.fun%2F" target="_blank" title="https://www.rethink.fun/" ref="nofollow noopener noreferrer">www.rethink.fun/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[导数的双重身份：从商业决策到反向传播——反向传播算法]]></title>    <link>https://juejin.cn/post/7600601482690674734</link>    <guid>https://juejin.cn/post/7600601482690674734</guid>    <pubDate>2026-01-29T12:57:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600601482690674734" data-draft-id="7600628279215226906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="导数的双重身份：从商业决策到反向传播——反向传播算法"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T12:57:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="在路上的达"/> <meta itemprop="url" content="https://juejin.cn/user/1628822092128964"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            导数的双重身份：从商业决策到反向传播——反向传播算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1628822092128964/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    在路上的达
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:57:44.000Z" title="Thu Jan 29 2026 12:57:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在深度学习领域，梯度下降算法告诉我们训练模型的目标：调整参数，使得Loss最小；而反向传播算法则告诉我们如何做：如何高效调整参数。</p>
<p>从数学上来说：反向传播算法是数学中计算复合函数的导数，即链式法则的应用。</p>
<p>这里我们先来回忆一下高中学习的导数，这个让无数高考生头疼的数学工具，在现实生活中究竟有怎样的意义和价值，将理想概念世界的数学拉回到世俗的“泥潭”。</p>
<h3 data-id="heading-0">文章脉络</h3>
<pre><code class="hljs language-markdown" lang="markdown">文章脉络:
├── 反向传播算法概述 (梯度下降的目标与方法、数学本质)
├── 现实视角下的导数意义
│ ├── 速度和加速度
│ └── 商业中的决策 (边际效应、数学与现实的张力)
├── 计算图：反向传播的可视化工具
│ ├── 如何使用计算图 (超市购物例子)
│ ├── 计算图的局部计算特征 (信息流与流水线)
│ └── 导数在计算图中的表现
├── 计算图的反向传播——链式法则
│ ├── 链式法则原理 (复合函数求导)
│ ├── 乘法节点的反向传播
│ ├── 加法节点的反向传播
│ └── Python实现
│ ├── 乘法层
│ └── 加法层
├── 实践：回到超市
│ ├── 构建计算图
│ ├── 前向传播
│ └── 反向传播
├── 一些思考 (敏感度量化、因果逻辑、数学与现实的距离)
└── 参考资料
</code></pre>
<h3 data-id="heading-1">现实视角下的导数意义</h3>
<p>我们来看几个导数的应用场景，便可从中窥见一些导数在现实世界的“模样”。</p>
<h4 data-id="heading-2">速度和加速度</h4>
<p>速度和加速度是最广为人知的导数的意义：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>v</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>s</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">v = \frac{ds}{dt}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>v</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">a = \frac{dv}{dt}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>当时间无限趋于0时，取这么一小段时间行驶的距离作为一个新的物理量：速度。它告诉我们在一个固定的时间的变化量下，位移能够变化多少。这样说比较抽象，因为”导数“是一个概念，但是我们却用了一句话，即两个概念间关系来表达这个事情，这让我们的大脑有些”痛苦“，能否有”一个“现实生活中的概念能对应”导数“这个概念呢？导数描述的是A概念对B概念的影响程度，即B概念对A概念的”敏感度“，导数值越大，就说明越敏感，反之亦然。</p>
<h4 data-id="heading-3">商业中的决策</h4>
<p>我们再来看一个更加生活化的例子：</p>
<p>想象你是一家工厂的老板，这是你面临的情况：</p>


















































<table><thead><tr><th>项目</th><th>数值</th><th>单位</th></tr></thead><tbody><tr><td><strong>定价与销量</strong></td><td/><td/></tr><tr><td>销售价格</td><td>500</td><td>元/件</td></tr><tr><td>月销售量</td><td>10,000</td><td>件</td></tr><tr><td><strong>成本</strong></td><td/><td/></tr><tr><td>原材料单价</td><td>150</td><td>元/件</td></tr><tr><td>工人数量</td><td>50</td><td>人</td></tr><tr><td>月人工成本</td><td>4,000</td><td>元/人</td></tr><tr><td>月固定运输费</td><td>20</td><td>万元</td></tr></tbody></table>
<p>这是你的获利情况：</p>



































<table><thead><tr><th>项目</th><th>计算方式</th><th>数值</th></tr></thead><tbody><tr><td>销售额</td><td>500 元/件 × 10,000 件</td><td>500 万元</td></tr><tr><td>原材料成本</td><td>150 元/件 × 10,000 件</td><td>150 万元</td></tr><tr><td>人工成本</td><td>4,000 元/人 × 50 人</td><td>20 万元</td></tr><tr><td>固定运输费</td><td>—</td><td>20 万元</td></tr><tr><td><strong>月利润</strong></td><td><strong>500 - 150 - 20 - 20</strong></td><td><strong>310 万元</strong></td></tr></tbody></table>
<p>现在你想知道改变一下原材料的成本能带来多少的利润的变化，即你想知道月利润对原材料成本的敏感度。</p>
<p>通过计算得到：原材料成本每提高1元，月利润会下降10000元。</p>
<p>在经济学中，这种思考的模式叫做：边际效应。比如著名的边际递减效应就是运用了导数的这种数学工具。</p>
<p>在这个例子中，我们看到导数可以帮助我们在多个影响因素问题中仅仅关注于其中某个因素的对最终结果的影响情况，但是同时，直觉告诉我们，仅靠数学工具来进行决策好像会带来一丝不安，原材料成本的提高，不一定会带来月利润的下降，真实的生活中还有更多需要考虑的因素，比如品质的提高带来了更多的客户的青睐，这里先埋下一个伏笔，最后讲完反向传播算法后我们会回到这个问题探讨一些算法之外的思考。</p>
<h3 data-id="heading-4">反向传播算法的可视化工具</h3>
<p>为了更加清晰地理解反向传播算法，我们需要首先学会使用一个思考工具：计算图。</p>
<h4 data-id="heading-5">如何使用可视化工具：计算图</h4>
<p>我们来看一个生活化的例子：你到超市买东西，买了六瓶饮料，一瓶是10元，会员卡可以打八折</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d7ecc333424452884e27404d572a30a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=FYGL%2BlTvbxiMTM%2Fv1cVVRTUrAYM%3D" alt="Drawing 2025-11-16 01.44.27.excalidraw.png" loading="lazy"/></p>
<p>图中的圆圈表示计算方式，横线上计算的输入和输出</p>
<p>如果不仅买饮料，还买20支圆珠笔，每支笔是5元，同样可以打八折，那么这个计算图就会变成这个样子</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c1c1e53d804757bff959144d300869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=zuo4hj7VgAeeKRShiJv1HH6U50Q%3D" alt="Drawing 2025-11-16 01.58.47.excalidraw.png" loading="lazy"/></p>
<h4 data-id="heading-6">计算图的局部计算特征</h4>
<p>基于我目前对计算图这个工具的认识：我认为计算图通过一种整体上的信息流的设计使得独立的计算过程的效果得以累积。这句话有两个意思，其一是每一步计算的结果都对最终的结果产生一定的影响，即有整体效应；其二是，具体计算时不用关注整体发生了什么，只需要拿到上游的信息数据，做好本环节的计算，并向下游传递数据即可，就好像流水线上的工人一样，他们可能不知道公司的整体愿景，但是只要在流水线上做好自己分内的工作就会对最终的结果产生相应的效果。</p>
<h4 data-id="heading-7">一个小问题，回到导数的现实意义</h4>
<p>假设现在我们想要知道饮料单价的上涨多大程度上会影响最后的消费金额，即消费金额对饮料单价的”敏感度“，方便起见，我们先来看这个简单一点的计算图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c583b249a00e40f0ac722ebc7cb2b472~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=%2BY3ax4CB%2B7i6N5uJhDiLz%2BhNa2c%3D" alt="Drawing 2025-11-16 01.44.27.excalidraw.png" loading="lazy"/>
数学上，我们知道是计算消费金额对饮料的导数，用计算图如何表示呢，我们看看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ae44c77e0f94ac4b3a30b5e6c0b8ad6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=Kk0asP0A2yMqs2WdmYR46VceFwc%3D" alt="Drawing 2025-11-16 01.44.27.excalidraw 1.png" loading="lazy"/>
反向的横线就是求导数的过程，传递的是”局部的反向导数“，这也是反向传播算法名字的来由：与正向算法的信息流的方向是相反的。
从这个结果可知，消费金额对饮料单价的导数是4.8，即如果饮料的单价上涨1元，最终的消费金额会上涨4.8元。</p>
<p>现在你可能并不能理解计算图局部计算的强大之处，如果我继续问你，最终的消费金额对饮料个数的导数是多少，或者最终消费金额对折扣的导数是多少，你就会慢慢理解这种工具的强大了，下面再用一幅图感受一下清晰化的计算结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f44dac374ab494d8c6fd60d7bd65935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=dv2vaILCcj5Whh8isr5l6lgS5o4%3D" alt="Drawing 2025-11-16 01.44.27.excalidraw 2.png" loading="lazy"/>
可以清晰地从反向箭头看出来消费金额对饮料个数的导数是8，而对折扣的导数是60（不过这里折扣和饮料单价的量纲不同，所以60这个数可能会有些奇怪）</p>
<p>可能你还是没有理解这到底是什么意思，其实这里只是简单展示了一下计算图和反向传播算法的效果，后面会对具体的计算过程进行详细的介绍：即链式法则。</p>
<h3 data-id="heading-8">计算图的反向传播——链式法则</h3>
<p>关于链式法则，这里直接摘录百度百科的解释：“链式法则是微积分中的求导法则，用于求一个复合函数的导数，是在微积分的求导运算中一种常用的方法。复合函数的导数将是构成复合这有限个函数在相应点的导数的乘积，就像锁链一样一环套一环，故称链式法则。”</p>
<p>用一个例子来表示就是：现在有两个函数</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>z</mi><mo>=</mo><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">z = t^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><mi>x</mi><mo>+</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">t = x + y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></div>
<p>那么求 z 对 x 的导数就是先求外层函数的导数，再求内层函数的导数</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi>d</mi><mi>t</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{dz}{dx} = \frac{dz}{dt} \cdot \frac{dt}{dx}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>如果要简单从原理上理解一下的话就是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><menclose notation="updiagonalstrike"><mrow><mi>d</mi><mi>t</mi></mrow></menclose></mfrac><mo>⋅</mo><mfrac><menclose notation="updiagonalstrike"><mrow><mi>d</mi><mi>t</mi></mrow></menclose><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{dz}{dx} = \frac{dz}{\cancel{dt}} \cdot \frac{\cancel{dt}}{dx}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord cancel-lap"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord cancel-pad"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span style="height:0.6944em;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="0.6944em"><line x1="0" y1="100%" x2="100%" y2="0" stroke-width="0.046em"/></svg></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord cancel-lap"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord cancel-pad"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span style="height:0.6944em;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="0.6944em"><line x1="0" y1="100%" x2="100%" y2="0" stroke-width="0.046em"/></svg></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>求得的结果就是</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>2</mn><mi>t</mi><mo>⋅</mo><mn>1</mn><mo>=</mo><mn>2</mn><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{dz}{dx} = 2t \cdot 1 = 2(x + y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></div>
<p>而 z 对 y 的导数则是</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>y</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>d</mi><mi>z</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi>d</mi><mi>t</mi></mrow><mrow><mi>d</mi><mi>y</mi></mrow></mfrac><mo>=</mo><mn>2</mn><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{dz}{dy} = \frac{dz}{dt} \cdot \frac{dt}{dy} = 2(x + y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></div>
<p>而计算图中的反向计算公式如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce5b05127190420b979f6f904fc00d94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=CoLFZ2uS0%2BKZv1Vr%2BWDk0gbHFWo%3D" alt="Drawing 2025-11-16 10.22.35.excalidraw.png" loading="lazy"/>
将反向输入的信号E乘上节点的局部导数f'(x)，然后将结果传给下一个节点</p>
<p>现在我们把刚才的符复合函数用计算图的方式表示一下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56f80ead01bb47ce8eec12065d085f59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=Et59oGjwjQTvThNiMP71Zz1mb5A%3D" alt="Drawing 2025-11-16 10.31.06.excalidraw.png" loading="lazy"/>
在计算时，只需要把反向传递的上游的信息，乘上该节点的局部导数值即可，不需要考虑全局</p>
<h4 data-id="heading-9">乘、加法节点的反向传播</h4>
<h5 data-id="heading-10">乘法节点的反向传播</h5>
<p>毕竟节点的计算方法非常有限，研究清楚常见的几个算法，封装成“规律”，便可以省去每次都在底层原理上的纠结与挣扎。</p>
<p>乘法公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>z</mi><mo>=</mo><mi>x</mi><mo>⋅</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">z = x \cdot y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4445em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></div>
<p>求导结果：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">\frac{\partial z}{\partial x} = y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\frac{\partial z}{\partial y} = x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span></div>
<p>计算图表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac3e1d55045f4ef0995565e7601c0099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=WF1u1GfPmUcYuLdxnjvWGHjuFx0%3D" alt="Drawing 2025-11-16 10.45.41.excalidraw.png" loading="lazy"/>
反向上游传过来的信息是E，发现向下游传递时，传递的是“翻转值”，x这条路反向时乘上y，y这条路反向时乘上x。</p>
<h5 data-id="heading-11">加法节点的反向传播</h5>
<p>加法公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>z</mi><mo>=</mo><mi>x</mi><mo>+</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">z = x + y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></div>
<p>求导结果：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\frac{\partial z}{\partial x} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\frac{\partial z}{\partial y} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<p>计算图表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b08e81a8f6d84f49bbde2a30d1a1c592~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zyo6Lev5LiK55qE6L6-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296319&amp;x-signature=5wzXtZFzOseCBpjF5wCxvm3FQDE%3D" alt="Drawing 2025-11-16 10.51.55.excalidraw.png" loading="lazy"/>
结果也非常简单：就是原封不动地传递反向上游的信息即可</p>
<h4 data-id="heading-12">Python实现两种简单层</h4>
<p>这里把计算图的乘法节点和加法节点分别叫做“乘法层”和“加法层”，并根据上文总结的规律进行简单的实现</p>
<h5 data-id="heading-13">乘法层</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MulLayer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.x = <span class="hljs-literal">None</span>
        self.y = <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self,x,y</span>):
        self.x = x
        self.y = y
        out = x * y
        <span class="hljs-keyword">return</span> out

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">backward</span>(<span class="hljs-params">self,dout</span>): <span class="hljs-comment"># dout 是从反向上游传过来的导数值</span>
        dx = dout * self.y <span class="hljs-comment"># 翻转x和y</span>
        dy = dout * self.x
        <span class="hljs-keyword">return</span> dx, dy
</code></pre>
<h5 data-id="heading-14">加法层</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AddLayer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span> <span class="hljs-comment"># 由于反向计算不依赖正向计算的值，因此不需要任何成员变量</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self,x,y</span>):
        out = x + y
        <span class="hljs-keyword">return</span> out

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">backward</span>(<span class="hljs-params">self,dout</span>):
        dx = dout * <span class="hljs-number">1</span>
        dy = dout * <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> dx, dy
</code></pre>
<h3 data-id="heading-15">回到超市</h3>
<p>还记得买饮料和圆珠笔的那个问题吗？之前我们用计算图表示了一遍，现在我们用代码实践一下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义乘法层和加法层</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MulLayer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.x = <span class="hljs-literal">None</span>
        self.y = <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, y</span>):
        self.x = x
        self.y = y
        out = x * y
        <span class="hljs-keyword">return</span> out

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">backward</span>(<span class="hljs-params">self, dout</span>):
        dx = dout * self.y
        dy = dout * self.x
        <span class="hljs-keyword">return</span> dx, dy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AddLayer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, y</span>):
        out = x + y
        <span class="hljs-keyword">return</span> out
  
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">backward</span>(<span class="hljs-params">self, dout</span>):
        dx = dout * <span class="hljs-number">1</span>
        dy = dout * <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> dx, dy



<span class="hljs-comment"># 构建计算图</span>
<span class="hljs-comment"># 创建层对象</span>
mul_drink = MulLayer()  
mul_pen = MulLayer()    
add_layer = AddLayer()  
mul_discount = MulLayer()  
  
  

<span class="hljs-comment"># 前向传播</span>
<span class="hljs-comment"># 1. 计算饮料总价</span>
drink_price = <span class="hljs-number">10</span>  
drink_num = <span class="hljs-number">6</span>    
drink_total = mul_drink.forward(drink_price, drink_num)
<span class="hljs-comment"># 2. 计算笔的总价</span>
pen_price = <span class="hljs-number">5</span>    
pen_num = <span class="hljs-number">20</span>      
pen_total = mul_pen.forward(pen_price, pen_num)
total_cost = add_layer.forward(drink_total, pen_total) 
<span class="hljs-comment"># 3. 应用折扣</span>
discount_rate = <span class="hljs-number">0.8</span>  
final_price = mul_discount.forward(total_cost, discount_rate)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"消费金额：<span class="hljs-subst">{final_price}</span>元"</span>)

  

<span class="hljs-comment"># 反向传播</span>
<span class="hljs-comment"># 以计算消费金额对饮料单价的导数为例</span>
<span class="hljs-comment"># 初始梯度</span>
dout = <span class="hljs-number">1</span>
<span class="hljs-comment"># 反向传播通过折扣层</span>
d_total_cost, d_discount_rate = mul_discount.backward(dout)
<span class="hljs-comment"># 反向传播通过加法层</span>
d_drink_total, d_pen_total = add_layer.backward(d_total_cost)
<span class="hljs-comment"># 反向传播通过饮料乘法层</span>
d_drink_price, d_drink_num = mul_drink.backward(d_drink_total)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"饮料单价每增加1元，最终价格增加<span class="hljs-subst">{d_drink_price:<span class="hljs-number">.2</span>f}</span>元"</span>)
</code></pre>
<p>最终输出结果如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">消费金额：128.0元
饮料单价每增加1元，最终价格增加4.80元
</code></pre>
<p>符合预期</p>
<h3 data-id="heading-16">一些思考</h3>
<p>反向传播求的每一个节点的局部导数，前面我们提到过导数是“敏感度”，是最终结果对当前这个局部节点的敏感度，也就是这个局部对全局的影响程度，反向传播算法量化了这个程度，让我们不仅可以看出正或负的影响效果，还能精确知道具体有多大的影响，指导我们下一步调整参数，使得Loss最小。</p>
<p>不过能够如此清晰地明确调整方向建立在一个基础上，就是计算图体现出来的：清晰严谨的因果逻辑，一张计算图，把所有的数据因果关系全部都描述清楚了，这里我想强调“关系”这个词，在没有具体的数据进入计算图的时候，计算图已经存在了，也就是数据的关系先于数据存在；也正因为有如此严谨的因果逻辑使得局部计算时不需要考虑全局，因为关系已经定“死”了。</p>
<p>有的人可能会把反向传播的逻辑应用到生活中，就像是有的人把导数引入到商业中辅助决策，但是绝对不能期望在商业中的应用能到达在计算图中这样“清晰严谨”的效果，现实不是数学，尽管数学非常复杂，但是数学只考虑了能被思维捕捉的影响因素和关系，现实可没有已经设定好的“计算图”。</p>
<p>还记得前文介绍导数现实意义时提到的商业决策的例子吗？当时的“不安”在这里是不是根本没有得到缓解呢？（哈哈哈）星空需要仰望，对待现实需要时刻谨慎。</p>
<p>更多内容，关注同名公众号：“在路上的达”</p>
<h3 data-id="heading-17">参考资料</h3>
<p>[1] <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rethink.fun%2F" target="_blank" title="https://www.rethink.fun/" ref="nofollow noopener noreferrer">www.rethink.fun/</a>
[2] 斋藤康毅[日] . 深度学习入门：基于Python的理论与实现 . 人民邮电出版社 . 2018 .</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[黄啊码-耗时N天打磨的AI漫剧神器，创作变现一条龙，今天正式开源！]]></title>    <link>https://juejin.cn/post/7600705405595648063</link>    <guid>https://juejin.cn/post/7600705405595648063</guid>    <pubDate>2026-01-30T02:37:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600705405595648063" data-draft-id="7600709805468385323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="黄啊码-耗时N天打磨的AI漫剧神器，创作变现一条龙，今天正式开源！"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-30T02:37:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄啊码"/> <meta itemprop="url" content="https://juejin.cn/user/3910302505908312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            黄啊码-耗时N天打磨的AI漫剧神器，创作变现一条龙，今天正式开源！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3910302505908312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄啊码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:37:39.000Z" title="Fri Jan 30 2026 02:37:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近这么安静，相信很多人都觉得我在偷懒了吧</p>
<p>相反，“暴风雨来之前肯定会比较安静的”。今天，黄啊码又来了，我把耗时一个多月打磨的AI漫剧神器正式开源。</p>
<p>没错，就是那个能让你的脑洞秒变爆款漫剧的产品！不信？先看我用自家产品搓出来的漫剧本视频感受下👇
<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Fvideo%2F85014" target="_blank" title="https://cloud.tencent.com/developer/video/85014" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/v…</a>
🤯 传统漫剧制作？熬秃头也难产！</p>
<p>编剧挠破头写剧本？分镜师肝到凌晨画场景？后期合成配字幕配解说累成狗？<strong>停！</strong> 这套苦情戏，今天该说拜拜了。</p>
<p>黄啊码的AI漫剧神器，把 <strong>“小说生成 <strong>→</strong> <strong>剧本创作</strong>→ <strong>角色定制</strong> → 分镜绘制 → 视频合成”</strong> 全流程打包搞定。<strong>你，只需要动动鼠标</strong></p>
<p>📖 <strong>第一步：小说，AI给你现编！</strong></p>
<p>打开神器首页，选好题材风格，输入核心情节关键描述内容</p>
<p><strong>卡文了？</strong> 右下角点“随机生成情节”，灵感秒来</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23a27902d48f4e979ba2864b5332fa5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=yqWK8NMGmjGINe9wtgESJzduw1c%3D" alt="图片" loading="lazy"/>​</p>
<p><strong>有梗不会写？</strong> 点“优化情节描述”</p>
<p>AI帮你润色成专业编剧水准（亲测：比我这程序员写的强多了😂）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c8c5b94b6aa4ae68ecb7c975d90d13b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=XEl8XavtIsI5%2BPmVFGTFqQ0J1%2Bk%3D" alt="图片" loading="lazy"/>​</p>
<p>选好篇幅（漫剧建议短篇起步）、设定角色和背景，<strong>点击创作</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f787c6a861a4ba48d2b97436da8c9bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=7Xfu%2B%2BoK1NCniFCCxQ7kdBhFQr8%3D" alt="图片" loading="lazy"/>​</p>
<p>几分钟后，1w+字完整小说出炉！某茄小说码半年？AI几分钟搞定！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/994d519319e7464d8a2d648c3593fc94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=lihundEkly8KU4B9HQwuxTHFVPE%3D" alt="图片" loading="lazy"/>​</p>
<p>生成不满意？太正常了！点进【个人中心】</p>
<p>点击个人中心</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2410fb2bbe28414c8d99184c20fb4d12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=yj8Yvr%2FYJEINkU3breMGaUz4Xbw%3D" alt="图片" loading="lazy"/>​</p>
<p>点击编辑作品</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bde4bb912a794a9bb6c51caf075463ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=zrFLZjMP%2FVgtJ0Qw5YX%2F6pDbTTQ%3D" alt="图片" loading="lazy"/>​</p>
<p>扩写、润色、改写随意调教，AI不完美，但绝对是你最强辅助</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2eab3689fb548ac976bd33680ed11e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=sj6zD9xzpLH14XXNmO2udHuzm4c%3D" alt="图片" loading="lazy"/>​</p>
<p>如果你只是想写一篇属于自己的小说，可以到此为止了</p>
<p>可是，我相信你打开我这篇文章不可能只是单纯为了写小说那么简单吧，生成自己的漫剧才是最终目的吧？所以，咱们开始吧。</p>
<p>🎬 <strong>第二步：小说一键智能转化</strong>剧本****</p>
<p>点击菜单栏上的码上做剧本，选择刚出炉的小说章节</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bd685f96dc447ca82d09d1637ad4835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=9aEK6Mc1bsIe693pPOvnsmDy8nw%3D" alt="图片" loading="lazy"/>​</p>
<p>选择章节，点击生成剧本，我这里直接选择全部</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b07d4b153274ebcaa7105420e51c3a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=SgNUyqtbgzCyddo3OG7A7ZG1c4I%3D" alt="图片" loading="lazy"/>​</p>
<p><strong>Duang~</strong> 几分钟，文字自动变身专业分场剧本！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58f7ae474f374426a0dcd19a155ceee4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=MHlwX1zFi34J3dB5KghjZSnpU2M%3D" alt="图片" loading="lazy"/>​</p>
<p>剧本都生成完毕了，是否该直接进行分镜生成呢？</p>
<p>🎨 <strong>第三步：服化道？AI全包圆！</strong></p>
<p>黄啊码并没有这么着急，有没有想到一个段子【道具！！！】对，布景和道具、演员的衣着都要安排一下。</p>
<p>点【码上准备】→ 分析剧本，AI瞬间输出：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39581ffbc2864d40a1c7d048aac42a9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=prHJ5NY1gML4YTzj5HyjNpl93FY%3D" alt="图片" loading="lazy"/>​</p>
<p>✅ 角色服装设计图+说明</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3860464e3d8a4236bfdd6e5847e6f5f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=CAW45d4togp1HB%2FUUqTCHX5ikus%3D" alt="图片" loading="lazy"/>​</p>
<p>✅ 场景布景参考+清单</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16329526307f40b99408c8b582b3c44c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=xgISEa1iW%2BGU1D2j1JmpnA80es8%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09b292b5028e4aa9a04548b74c3f7bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=vglUyaz5Eq%2FzmLx6b8IXJxg7X8E%3D" alt="图片" loading="lazy"/>​</p>
<p>✅ 道具细节清单+图示</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02de88cd05ac4d8c9427c88c9d3a3a22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=pflXct5BVi5cCk91WkuQaW0Iq30%3D" alt="图片" loading="lazy"/>​</p>
<p>不懂美术？不懂道具？没关系！你只管点鼠标，专业级方案AI全给！</p>
<p>接下来，重磅功能开启，生成漫剧</p>
<p>👤 <strong>第四步：角色&amp;分镜？精准拿捏！</strong></p>
<p>生成角色：从个人中心找到这本小说，点击继续创作</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9abb67697b9a4c5dbeb3fa2d9751cdc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=uqSMgSKT1bb5wwFu2iTRqkvLanM%3D" alt="图片" loading="lazy"/>​</p>
<p>小说都是AI生成的，让自己创建角色肯定是不可能的，所以黄啊码特地安排让AI自动提取角色</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b992072f2ef045858f5dd0c5f36e65f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=SEtuv3kfop3MUCdwbqLd3CyBLuA%3D" alt="图片" loading="lazy"/>​</p>
<p>提取完毕后点击选中，应用会自动将相关信息写入表单中</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24d04d7b55764371b8ba629b61620688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=KAvScrXV8%2FuVnZnyQUSXew2uUXI%3D" alt="图片" loading="lazy"/>​</p>
<p>你只需要动动鼠标，点击生成角色形象即可【额，黄啊码没有这么年轻】</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1693909d487b439db9397ae62e5658b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=8MQ6dDAVIHzhyVtV8etI6iS5EyQ%3D" alt="图片" loading="lazy"/>​</p>
<p>生成分镜：点击菜单栏的码上拍戏，选择小说和相关章节</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2d51ae98ded405f838aa3262e342cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=WG74WA6tUpb6IYc%2B6O6JPraIL3Y%3D" alt="图片" loading="lazy"/>​</p>
<p>章节对应的剧本会显示出来，然后你可以根据章节的场景内容布置内容</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7787031848224cd0ab2c1ecc214a0722~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=MYePWDw24Jrinde6HPfWhttudGw%3D" alt="图片" loading="lazy"/>​</p>
<p>点击场景描述提示词旁边的查看参考内容，把想做的场景画面直接复制到文本框，点击生成图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc42e1b7918c47af822a0eaa17e4cdce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=ZbCto4H%2BzVeMqcqAv4NwlXI5K9U%3D" alt="图片" loading="lazy"/>​</p>
<p>你就会看到对应的分镜图片生成完毕，多个场景图就生成多张图片</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72bace283c024a6998217bb73201f0d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=zzP9gm8GIquLLDCFeUVCePWWdOs%3D" alt="图片" loading="lazy"/>​</p>
<p>接着点击生成视频，默认是直接采用场景画面的提示词，如果你想自己改造也是没问题的，均有支持</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b0f234b71d7455a988ded51f5a34b4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=K6%2F3gEE3jKOBxTaioSvfj9I9pOs%3D" alt="图片" loading="lazy"/>​</p>
<p>画面丝滑衔接，告别跳戏</p>
<p>当然很多人肯定想画面更具连贯性的，黄啊码肯定也要安排的，我在生成的视频采用了提取尾帧，只要点击后，你就可以在上边的画布中看到相关画面，然后你就可以在里边布置道具或者继续加人物，保证画面连贯性</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98170dc192b64534976f750904468ce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=kVp9Pt1KOuIqke0pznSB%2F08BrOA%3D" alt="图片" loading="lazy"/>​</p>
<p>同场景批量生成，效率翻倍</p>
<p>如果你多个视频都打算用同个场景或画面，只需要点击批量生成通常同场景图片或视频，然后选择想要批量生成的场景，生成分镜图片和视频的逻辑跟上边的会保持一致</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fbaed6789b146a984ab1cf5cba63eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=HbOYmyOYwXcW3BUOMpBCgQJV4B0%3D" alt="图片" loading="lazy"/>​</p>
<p>到此，生成视频全部完毕，你肯定会说：黄啊码，不够！不够！你这样生成的视频都是片段，我还要专门打开剪辑工具。</p>
<p>🎙️ <strong>第五步：合成大片，连剪辑软件都省了</strong></p>
<p><strong>怎么可能，片段有了，但还要导来导去剪？<strong>黄啊码连这步都给你省了。</strong></strong></p>
<p>点“生成视频解说”+“生成配音”，将他们分别复制，丢到黄啊码开发的视频合成工具里边。【工具在视频合成按钮跳转的链接里边，绝对免费】</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e935fc8681d24b86b3e9aaf55e62fb95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=h4lkr1Slg%2Fw%2Fo2E%2B%2FNqyOu30hK4%3D" alt="图片" loading="lazy"/>​</p>
<p>点击开始合成</p>
<p>【注意：视频链接的数量、频频数量、场景数量要保持一致】</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d42185e7459493a99f079f28fa1276d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=8WfITLUPYGehujO7kjkFyJsTKY4%3D" alt="图片" loading="lazy"/>​</p>
<p>粘贴→对齐→点击合成， <strong>2分钟！</strong> 带解说、字幕、画面的完整漫剧诞生。</p>
<p>当然如果你觉得生成的图片视频质量差，也可以在秒哒创建插件对接相关接口，比如苍何大佬推荐的Atlas平台，各种图片视频模型一应俱全，链接在此，需要自取即可<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.atlascloud.ai%2F%3Fref%3D6XTNXA" target="_blank" title="https://www.atlascloud.ai/?ref=6XTNXA" ref="nofollow noopener noreferrer">www.atlascloud.ai/?ref=6XTNXA</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b3fd852b07f48f3b8e94fa7b07355b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=b%2BaTioSocqjWiRJmvtutrgiM87M%3D" alt="图片" loading="lazy"/>​</p>
<p><strong>💰 <strong>第六步：完成商业化闭环</strong></strong></p>
<p>项目复制过去怎么使用？<strong>别急，神器连商业闭环都给你铺好了，系统自带</strong> <strong>会员功能 + 灵活积分体系（码分）</strong> ，让你轻松实现创作变现。</p>
<p>点击进入管理后台，点击码分设置</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228e4205c1654e17b028217050856bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=kNscjRNTU36cLRUrBWn5sX9kozE%3D" alt="图片" loading="lazy"/>​</p>
<p>设置会员套餐</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ef821b36f624fb3b3fb0385718b1205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=aOINYYewOe6FDYs13jjHm6eSpBc%3D" alt="图片" loading="lazy"/>​</p>
<p>设置功能码分消耗</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8519ae50573468b83cc75551537807e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=%2F0UqOjfYswToLj9S%2FB2B8x6WT%2Fo%3D" alt="图片" loading="lazy"/>​</p>
<p>然后自己在秒哒里边对接微信支付，用户就可以通过购买升级会员让你获得变现。【自己对接哦，别偷懒】</p>
<p>微信支付对接的说明文档</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.baidu.com%2Fdoc%2FMIAODA%2Fs%2FZmg4xp3fz" target="_blank" title="https://cloud.baidu.com/doc/MIAODA/s/Zmg4xp3fz" ref="nofollow noopener noreferrer">cloud.baidu.com/doc/MIAODA/…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a76b4e1fc4e4c31b5297fd9a17d4e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=RJP29TuU9vx%2Fu1hzMKIZoQ5txrI%3D" alt="图片" loading="lazy"/>​</p>
<p><strong>划重点：</strong></p>
<p>你不仅是创作者，更是平台规则的制定者，用码分控制成本，用会员锁定用户，用产品收割流量，<strong>这才是真正的睡后收入。</strong></p>
<p><strong>【额外话题】</strong></p>
<p><strong>🌌 <strong>第七步：平行世界和社区创作</strong></strong></p>
<p><strong><strong>独乐乐不如众乐乐，厌倦了单线剧情？想搞点颠覆性的如果？在这个平台，用户也可以直接Copy别人的热门小说</strong></strong></p>
<p><strong><strong>方法：点击进入平行世界，选择别人公开的小说或者你在社区购买的小说，然后选择你想要另写分支的小说章节，并写入接下来要发生的剧情</strong></strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/139b9ca9ebe1489eba599793fa919a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=W3hRu8MbEe2MuXDxy86RBXTv3t8%3D" alt="图片" loading="lazy"/>​</p>
<p>从此刻起，副本正式启动，我的小说我做主</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28015f8182164ea2a12ec905b90f86ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=LD5E1up3fb5hGhXGVkwMaQK9oBI%3D" alt="图片" loading="lazy"/>​</p>
<p>为什么要创造社区模块？</p>
<p>你肯定会问，为什么有社区广场？因为AI生成的内容具有一定的不可复刻性，同一段提示词生成的内容都有可能千差万别，如果用户生成的小说非常好，却因为平台的原因或者不想免费无法分享，那是非常可惜的。</p>
<p>这一点是构成整个平台运营变现不可或缺的一部分，黄啊码当然也想到了，所以你只需要在小说列表中，把对应小说设置收费就可以公开出去了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09dbca0e326c48f58db5773d682e83bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=ym%2Fbao1FyaQ1lf09dRRDi6gLxzg%3D" alt="图片" loading="lazy"/>​</p>
<p>并且设置了码分兑换现金的机制，让用户花不出去的码分变成现金流</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be6a8cecbd6a4da9a2ae07d33684b68d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=JWR%2FbD3VN2R7sDyzDFSETgVzYfw%3D" alt="图片" loading="lazy"/>​</p>
<p>以及还有邀请获取积分等一系列促进用户拉新和老用户持续活跃且变现的功能，需要你们仔细去查看，黄啊码在此就不一一说明了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64dada7341d1442f9d3c6a1f3dc6ab32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=kdVp8uxouk15bonBz93EgoDmucA%3D" alt="图片" loading="lazy"/>​</p>
<p>怎么获取？</p>
<p>输入网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.miaoda.cn%2F%3Finvitecode%3Duser-6r6xw83yl62o" target="_blank" title="https://www.miaoda.cn/?invitecode=user-6r6xw83yl62o" ref="nofollow noopener noreferrer">www.miaoda.cn/?invitecode…</a></p>
<p>搜索码上制片厂，点击详情【可以的话给我点个赞更好】</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff8cdab25e4249ea95d96fa6b59c0d2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=7wUbitzusjNC%2BBdDI%2FVRe97mFIk%3D" alt="图片" loading="lazy"/>​</p>
<p>点击复制应用</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1224ca076e754a57a899f83b6e3cd81d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=c%2BD7Hq7hKKmD1Fpdn98SXYcnFig%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb196196a73d47cea80007153bc20e0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=U%2B%2BRu9P%2B%2B%2BGNROQIsRMvKe8q8wQ%3D" alt="图片" loading="lazy"/>​</p>
<p>然后在你的个人应用就可以找到你copy的作品啦</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d74bec01d8544199691145e7205cb02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=erd8weTqhQK6GB6faLPjk8%2FmSZo%3D" alt="图片" loading="lazy"/>​</p>
<p>网友：黄啊码，你没开源源代码，属于伪开源。</p>
<p>what？我立马甩出来一个github链接堵住网友的嘴巴，是的，github同步开源。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuangama666%2Faimanju%25C2%25A0" target="_blank" title="https://github.com/huangama666/aimanju%C2%A0" ref="nofollow noopener noreferrer">github.com/huangama666…</a> 遵循的是Apache-2.0 license，意思就是可商用，可随便改</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fad771fea4ce48ba97771fa0aa89f790~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5ZWK56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770345726&amp;x-signature=K5%2FvL%2FJ%2FnDdmzQmPLI3ruX68qkA%3D" alt="图片" loading="lazy"/>​</p>
<p>最后说一句，风口从不等人，红利期永远是短暂的，AI漫剧当前正是风口期，跟你说机会，你说没工具，现在有工具，你不要跟我说连鼠标都不想动吧？</p>
<p>我是黄啊码，码字的码，如果觉得受用，欢迎一键三连，另外如果想进入私人交流群一起交流学习，也可以扫码V我。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在AI时代下，程序员的2HourBuilder最小版本]]></title>    <link>https://juejin.cn/post/7600615229996400690</link>    <guid>https://juejin.cn/post/7600615229996400690</guid>    <pubDate>2026-01-30T02:40:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600615229996400690" data-draft-id="7600678255041626121" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在AI时代下，程序员的2HourBuilder最小版本"/> <meta itemprop="keywords" content="前端,Vue.js,程序员"/> <meta itemprop="datePublished" content="2026-01-30T02:40:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小酒星小杜"/> <meta itemprop="url" content="https://juejin.cn/user/1512542215093479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在AI时代下，程序员的2HourBuilder最小版本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1512542215093479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小酒星小杜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:40:04.000Z" title="Fri Jan 30 2026 02:40:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#36ace1;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{color:#36ace1}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"";display:block;position:absolute;left:0;top:0;bottom:0;margin:auto;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAF8UlEQVRIS71Wa2wUVRT+7r0zu9t2t/RBaSioPCpYbIUfaEIQUogSAwZDAlUSGwgg/CBATExMCJH1D2hIfOEjFEUEhViCgBgIUCH44OkjPAMGBVqhpUCfW3Zn5z7MuQOE0hYxMdxJdmd25s53vnO+851leMCLPWA8/CfA2TsvL8n7q+nTFfNLG+4VqInHOeJLDQMzdz/3r4DGGDb9lxu+aPcE7U61JHDMDePcuv0O21ShugOefqDdtBie3Dk6K/O+Ab+qOjJiz7Ahv6c8hbDDwRiQlgYGDOcaWyEcjg8On+j71IpJndjGt9XO+jM7+pkywNvbazIfercieSdoJ4bE5sWjyZqMpDdeaQNXMNC34ME3LV8B56+1w3AOgk+EXe/Ub6uiLB6XdH/G/mYjeBCcFwnt3zQqWt4t4NjjnhzQ1CGkBhwOCMFAB71U0qsYgRlwBtQ1tiEJAy44OBdQUmFK3aWS06NLT+ukZAQoKCCjsfbDmk6p78RwX3ncWffmIj8U4kh6GpEwh+9rGy23LDU4GBrrm9DsuDYIGMAYIC/EUNQ7Cq1hn+WM2TI8f+jEyCmvjfn1FssuojHx6tDkyZOaCzr8TNpASzDAk8amlRIrEylcSGsYrcGIstIYWhgDDIM2BiGH3ywFkGAC1U9n38bpVqWGdk6r4HMWrZZaG1D5KLn0qYyBEAKnG1otAxLR8L7Z9nfP13CJHQ/ST4vK8sVHe8JsU0U6uO5hlexo8PI7vNDQomwoBRAwpSmtgJAAztS3QLsOsmBQlBtFJMQhlbbPUBBUR7o2hqHVddLbRsfCPQJ+u3TPw8uGl1yklAlHIJZKo3//XEhlLCtifPFyM7xwCI/lZ8IKTTBbS7pPLIggZZsSQ+zXbT4UYSsnet3UMM5HPT5LGbrDGYQroClyT2Jwnyj9aN949e8mDCwuRFoqKxRHUJ21BSDRELuQYGhvbMVV32Dp2RuxcfHSRBfAYTsbU9nJdFj5EiLkglHkRInC1xoxKbH9hQJIaTDvxxTCUddWl4wg0dCCtqSPDmoVx4Eitpxh64ZtsT6b5ie6pPRkfF90TllxOzEwmipMKRRgHODGgCuJkqIcvDdC2BZ5Y+tlHHMzkAKghbAxcQqQDiKrFBxhqg5MHTivS1tQ+sdsvaQl5Yd6yfdRXNQLsQwXnq/AQFLXEIIjzBSuNaaR0SuEtkQKl9IKjAsbJaWfzo1USDsM6zceDJfeVGgnhhN2N7YOyo5kJz1pa2AbgfrO1gRwXW6vSRQNtddR+EhvKGmseskgTtY2Q7kucYWWgToPHzyUyXry0iXfnBtfl5f/PaWPvPNW/zkOAQegJHltFE5dSaCskHqPVEnqpMAMEgkPtR1pKxyh/N0/vTToubtH1G3RmLjhM8ubKXfWB2mRa9ySOaWS2uT8lTZ0cI6I52Ngv7zAbW9mQVm1cpytu441P38XeXTlQu+e46nyh+bjLkMZRU0MCYTCJWZSG1y7cBWNURpxBlxqFBfEwGnGGhaYPSNwhpSv4DK+/vPynBk9MqRIiOWs8a2WJTm9a+cgh6SaMIMz9W1WjYHHMtv0wSmZdWB9gdsya/rcYVg7JoffCdqlD6ceTpiY59tM0PhJp5WNvra+BQkejCMyBarr8KKYDcZi8sDaCDKYFIGRk+FnSVXzyTO9JxBwF8DLc1dlLn65ooNEYN0fBsu21fTvL6PXnhxXlnLIqqhYYBian4lQ2Lk9ogiALsimiLC1QYfhlV1Hnxh7JfcMqxrpd7U2GFa5t9nOd7Kr+kg4uWvnCpromlJeXlq3Os3ZLOlrZBmNQf1ybVqpxhbA7mRIOCy1+esDOWhIyDv/+3Q7LRbsqH+rKRJ+nba+/+WW7II1s9vvVBuNr7KNF1WUM1bSt5f1Vq01jUVkKfnx8uoti3Or5rbd9782M61azJz/rFywYU/OyKqK1p5G2MS1Z18tGFDwTkvIxcK9RwaMP3a9/tbc62lPj/Nw5B9ey9Ehy/MY4oEqelgNleuyCgdXJlmc3fO5Ll56r5f+n/f+AWFf9jvBgaHpAAAAAElFTkSuQmCC);animation:spin 2s linear 1s infinite}.markdown-body h1{position:relative;font-size:30px;padding:12px 38px;margin:30px 0}.markdown-body h1:before{width:30px;height:30px;background-size:30px 30px}.markdown-body h2{position:relative;font-size:24px;padding:12px 36px;margin:28px 0}.markdown-body h2:before{width:28px;height:28px;background-size:28px 28px}.markdown-body h3{position:relative;font-size:18px;padding:4px 32px;margin:26px 0}.markdown-body h3:before{width:24px;height:24px;background-size:24px 24px}.markdown-body h4{position:relative;padding:4px 28px;font-size:16px;margin:22px 0}.markdown-body h4:before{width:20px;height:20px;background-size:20px 20px}.markdown-body h5{position:relative;padding:4px 26px;font-size:15px;margin:20px 0}.markdown-body h5:before{width:18px;height:18px;background-size:18px 18px}.markdown-body h6{position:relative;padding:4px 22px;font-size:14px;margin:16px 0}.markdown-body h6:before{width:16px;height:16px;background-size:16px 16px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#36ace1,#dff0fe,#36ace1);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:50px;height:24px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAEgElEQVRIS72Va0xbZRjH/z2FcimbchEQFDYRCIRAAWFQ2MaCXBwmUxYDLGGEcRFkH9wmk04zG0Bo2dwNIisERANqhjqdEmhd4nRbuwpsXDYWLLoRgeG4Chu9QHvMOQ0dpTAKH3y/tDnv8/5/z/Oc//scBv6nxdgoJ14gVYPEuITHdTdHY12gRIH0T0KljlqwthqUFHGtzAEsxqwLtPvkdc+FeeI3BgMeAMEhdOqR1mM7xswBrgmKE8pfIUhtm7fbZsft/i7wc98MtrUFxmbU6ByYgFwxjtFp5Q+WpF1mCy9wajXoqqD4E91saOf603e+5B7t99xTkyZJEiKJAl2DE9Xio1HvrBS8IuhVwVUP503swdJ9QWAw1izaoDs6pQT/655BMS9yy3KYiUoM/7adu7NmtnQfx5zWm8Q8Ui3gyGcddyU8rv/STRNQouDGP5/mhTubX4dpPv3DMzh1qS9LwuPWr+i63WVyn5QYj/4d/i4bqmbpoQ+auvBlQYghX6PE4wTSOzV5EUYlb5Q4MDqLk9/3cMRF27spDSNQamUnWZ4ebNB+OKNCyYVeFCZ5wZ5tiePN/UiP2YoQL0cUX+iFt4sNUiLdcaVvHJLecQiWnKVE8s5LvxAXRWeYgHLre0hecgAN0sxr0XBZgbJUP6OiLnaM4ivZCBrzOWBZEIY9rY5E8pl2nM0KMzzLq5aPiXmRzgbQm2VyR8KGGK/ICAFB6IusbvsDwhRf+n/jtSHc/nsGgjR9V6/1TyLa1wGU+FtnO1CbHQTHTSzIFJOYJ1jwcGLTccMTcyhp7oW4KFJ/SV4/IScrc55kQj07WNuOn94Lpw8kCm/Qv3W5HLjbWxsyfuNUO1TzWjAJBloKt2FBS+Jz6ShiA12NupBdLWugQcmn28lPMkONNql3U5cTSD9Lq+qEUqPFt++G0aKL687wDAqb+pAU7IKCuK2493AOPQ9UCNpib6T1tkg+RZ9KKJcNn8sJc1vac8o16jklLWLuOiDqwvHUIKPw7vtTON+iCDKkl/Cx9FeSYET5um1mHt6jN0Dz9ftwYjORudNjTdaBmi7kxvvA1d6Gjs0X/Q5Sp3tMEMSHre9HnDEZAPFCWUNVdliGJVPvqEP1Hbh4yPj9LadSY6fu6gPsCX+B3mq7NYLv2od8fj4aoViMNQGFijos/XVMTXGavgUisQIle71hwVx9KFEutLVjw8GORTuxoEbeJS7iPrmQyy/sIj2hQpqYHO7ZGs95nnZS4y8K8Pfqrb58UZ+IlKqbqNgfQm8da+pC9xjLqo8foFkau2qaCeXSyvzXfA9SDrp1bxJ/DU/jSJKXEWdBR2J/9U0UpwXTFZ/+8S76h/71FvO4A8sTeuqQThDKalOiPLN3BbhiYlaNsm964elkCztrC4xMqeDqYIus2JdB3cbS5l4MTag44qJt9GxbF4gKThRKY59lW13+KCUQ1pZMEwHKviKx4pFSqXzxCn/X9Gr2NO+zw+cTiTbxmUyCqH3GlsWg2kRNhOnHmhlrFkIvHTZt1borWvMCmRnwH4usn58STiycAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body del{color:#36ace1}.markdown-body code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#282c34;color:#4ec9b0;padding:.24em .46em;margin:0 4px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:12px;border-radius:10px;padding:15px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#4ec9b0;background:#282c34}.markdown-body a{text-decoration:none;color:#409eff;border-bottom:1px solid #409eff}.markdown-body a:active,.markdown-body a:hover{color:#007bff;border-bottom:1px solid #007bff}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;padding:8px 26px;background-color:rgba(54,172,225,.75);margin:16px 0;border-left:4px solid #409eff;border-radius:5px}.markdown-body blockquote:before{content:"❝";top:10px;left:8px;color:#409eff;font-size:20px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:20px;position:absolute;right:8px;bottom:0;color:#409eff;opacity:.7}.markdown-body blockquote&gt;p{color:#fff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Builder 的一周节律（直接可执行）</h2>
<h3 data-id="heading-1">2-Hour 的真实用途</h3>
<p>先说明，这2小时不是用来“把事情做完”的。</p>
<p>它的用户是确保你<strong>每天至少发生一次“现实接触”。</strong></p>
<hr/>
<h3 data-id="heading-2">推荐的周节律</h3>
<p>这是一个可以直接复制的最小节奏：</p>
<p>1️⃣ 2天用于构建/思考</p>
<p>2️⃣ 2天公开输出</p>
<p>3️⃣ 1天对话和转化</p>
<p>4️⃣ 2天休息和输入</p>
<p>你可以调整顺序和天数，<strong>但是一定要保持输入日的存在。</strong></p>
<p>一周里必须有明确的对外输出时间，</p>
<p>否则你只是一个准备得很认真的隐形人。</p>
<hr/>
<h2 data-id="heading-3">为什么这个 OS 能避免“反 Demo 地狱”</h2>
<h3 data-id="heading-4">Demo 地狱的本质</h3>
<p>不是技术问题，而是：</p>
<blockquote>
<p><strong>你一直在为“未来的观众”准备内容。</strong></p>
</blockquote>
<p>一直在等待，从来不发布，<strong>于是永远在为一个不存在的时刻服务。</strong></p>
<hr/>
<h3 data-id="heading-5">OS 如何强制你面对现实</h3>
<p>Builder OS 直接切断这一条退路</p>
<ul>
<li><strong>输出必须公开</strong></li>
<li><strong>反馈必须发生</strong></li>
<li><strong>交易必须尝试</strong></li>
</ul>
<p>没有“等一等”，你每天都要站在现实面前，哪怕是半成品。</p>
<hr/>
<h2 data-id="heading-6">Builder OS 的最低实现版本</h2>
<h3 data-id="heading-7">你只需要 3 个东西</h3>
<p>1️⃣ 一个记录假设的地方</p>
<ul>
<li>我在解决什么？</li>
<li>我假设谁在乎</li>
<li>我今天验证了没有？</li>
</ul>
<p>2️⃣ 一个固定输出渠道</p>
<ul>
<li>永远是同一个地方</li>
<li>不纠结平台，不追热点</li>
</ul>
<p>3️⃣ 一个能收钱的入口</p>
<ul>
<li>哪怕今天没人付款</li>
<li>但“可以付”这件事必须存在</li>
</ul>
<p>📌 重点：</p>
<blockquote>
<p><strong>工具选型不重要，行为结构才重要。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-8">OS 失败的唯一原因</h3>
<p>Builder OS 只会因为一件事失败：</p>
<p><strong>你允许自己，今天不面对现实。</strong></p>
<p>不是你不够聪明，</p>
<p>不是你资源不好， 不是你状态不好。</p>
<p><strong>而是你给了自己一个“今天可以不发布”的特权。</strong></p>
<hr/>
<h2 data-id="heading-9">本章总结</h2>
<h3 data-id="heading-10">Builder OS 的一句话版本</h3>
<blockquote>
<p><strong>把每天的一小段时间，</strong> <strong>稳定转换为：</strong> <strong>一次公开表达 + 一次现实反馈。</strong></p>
</blockquote>
<p>只要这件事发生了，这一天就是成功的。</p>
<hr/>
<h3 data-id="heading-11">你不需要再“优化系统”</h3>
<p>你只需要回答一个问题：</p>
<blockquote>
<p><strong>这个系统，明天会不会逼我再次暴露？</strong></p>
</blockquote>
<p>如果答案是“会”，它就是对的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude 3.5 Sonnet 在 SWE-bench Verified 上的性能突破]]></title>    <link>https://juejin.cn/post/7600663744192725028</link>    <guid>https://juejin.cn/post/7600663744192725028</guid>    <pubDate>2026-01-29T14:33:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744192725028" data-draft-id="7600606150732922923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude 3.5 Sonnet 在 SWE-bench Verified 上的性能突破"/> <meta itemprop="keywords" content="LLM,Agent"/> <meta itemprop="datePublished" content="2026-01-29T14:33:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户53021213292"/> <meta itemprop="url" content="https://juejin.cn/user/3054878532050676"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude 3.5 Sonnet 在 SWE-bench Verified 上的性能突破
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3054878532050676/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户53021213292
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:33:20.000Z" title="Thu Jan 29 2026 14:33:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Claude 3.5 Sonnet 在 SWE-bench Verified 上的性能突破</h2>
<blockquote>
<p>原文链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fswe-bench-sonnet" target="_blank" title="https://www.anthropic.com/engineering/swe-bench-sonnet" ref="nofollow noopener noreferrer">www.anthropic.com/engineering…</a></p>
<p>发布日期: 2025年1月6日</p>
</blockquote>
<h3 data-id="heading-1">核心成果概述</h3>
<p>Anthropic 2025年1月发布的升级版 Claude 3.5 Sonnet 在 SWE-bench Verified 软件工程评估基准测试中取得了 <strong>49%</strong> 的成绩，超越了此前最先进模型的 45% 的表现。本文详细解释了围绕该模型构建的"智能体"（agent）系统，旨在帮助开发者从 Claude 3.5 Sonnet 中获得最佳性能。</p>
<hr/>
<h3 data-id="heading-2">什么是 SWE-bench</h3>
<p>SWE-bench 是一个 AI 评估基准，用于评估模型完成真实世界软件工程任务的能力。具体来说，它测试模型如何解决来自流行开源 Python 仓库的 GitHub 问题。对于基准测试中的每个任务，AI 模型会获得一个已配置好的 Python 环境，以及该问题解决之前的仓库检出（本地工作副本）。然后，模型需要理解、修改和测试代码，最后提交其提议的解决方案。</p>
<p>每个解决方案都会根据关闭原始 GitHub 问题的拉取请求中的真实单元测试进行评分。这测试了 AI 模型是否能够实现与原始 PR 人类作者相同的功能。</p>
<p>SWE-bench 不仅仅是孤立地评估 AI 模型，而是评估整个"智能体"系统。在这个上下文中，"智能体"指的是 AI 模型与其周围软件脚手架的组合。这个脚手架负责生成输入模型的提示词、解析模型的输出以采取行动，以及管理交互循环（将模型先前行动的结果纳入其下一个提示词中）。即使使用相同的底层 AI 模型，智能体在 SWE-bench 上的性能也会因这个脚手架而有显著差异。</p>
<p><strong>💡 SWE-bench 评估流程</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[GitHub Issue] --&gt; B[AI 模型接收任务]
    B --&gt; C[Python 环境 + 仓库检出]
    C --&gt; D[模型理解问题]
    D --&gt; E[修改代码]
    E --&gt; F[测试代码]
    F --&gt; G{通过测试?}
    G --&gt;|否| D
    G --&gt;|是| H[提交解决方案]
    H --&gt; I[运行真实单元测试]
    I --&gt; J[评分]
</code></pre>
<hr/>
<h3 data-id="heading-3">SWE-bench 的独特优势</h3>
<p>虽然有许多其他用于评估大型语言模型编码能力的基准测试，但 SWE-bench 因以下几个原因而越来越受欢迎：</p>
<ol>
<li>
<p><strong>真实工程任务</strong>：它使用来自实际项目的真实工程任务，而不是竞赛或面试式问题；</p>
</li>
<li>
<p><strong>尚未饱和</strong>：仍有充足的改进空间。还没有模型在 SWE-bench Verified 上超过 50% 的完成率（尽管截至2025年1月时，升级版 Claude 3.5 Sonnet 达到了 49%）；</p>
</li>
<li>
<p><strong>整体评估</strong>：它衡量的是整个"智能体"，而不是孤立的模型。开源开发者和初创公司在优化脚手架方面取得了巨大成功，大幅提升了相同模型的性能。</p>
</li>
</ol>
<p><strong>💡 SWE-bench 三大优势</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Root((SWE-bench 优势))
    Root --&gt; A[真实任务]
    Root --&gt; B[未饱和]
    Root --&gt; C[整体评估]
    
    A --&gt; A1[实际项目]
    A --&gt; A2[GitHub Issues]
    
    B --&gt; B1[最高 49%]
    B --&gt; B2[改进空间大]
    
    C --&gt; C1[模型+脚手架]
    C --&gt; C2[完整系统]
</code></pre>
<hr/>
<h3 data-id="heading-4">SWE-bench Verified 数据集说明</h3>
<p>需要注意的是，原始 SWE-bench 数据集包含一些在没有 GitHub 问题之外的额外上下文（例如关于要返回的特定错误消息）的情况下无法解决的任务。<strong>SWE-bench Verified</strong> 是 SWE-bench 的一个包含 500 个问题的子集，经过人工审查以确保它们是可解决的，因此提供了编码智能体性能最清晰的衡量标准。本文将主要参考这个基准测试。</p>
<hr/>
<h3 data-id="heading-5">实现最先进性能的方法</h3>
<h4 data-id="heading-6">工具使用智能体架构</h4>
<p>在为升级版 Claude 3.5 Sonnet 优化智能体脚手架时，我们的设计理念是<strong>尽可能多地将控制权交给语言模型本身，并保持脚手架最小化</strong>。该智能体包含：</p>
<ul>
<li>一个<strong>提示词</strong></li>
<li>一个用于执行 bash 命令的 <strong>Bash 工具</strong></li>
<li>一个用于查看和编辑文件和目录的<strong>编辑工具</strong></li>
</ul>
<p>我们持续采样，直到模型决定完成任务，或超过其 200k 上下文长度限制。这种脚手架允许模型根据自己的判断来处理问题，而不是被硬编码到特定的模式或工作流程中。</p>
<p>提示词概述了模型的建议方法，但对于这项任务来说，它并不太长或过于详细。模型可以自由选择如何从一个步骤过渡到另一个步骤，而不是有严格和离散的转换。如果你对令牌（token）不敏感，明确鼓励模型产生长响应会有所帮助。</p>
<p><strong>💡 智能体架构设计</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Agent((智能体系统))
    
    Agent --&gt; Model[AI 模型]
    Agent --&gt; Scaffold[脚手架]
    
    Model --&gt; M1[Claude 3.5 Sonnet]
    Model --&gt; M2[200k 上下文窗口]
    Model --&gt; M3[自主决策能力]
    
    Scaffold --&gt; S1[提示词]
    Scaffold --&gt; S2[Bash 工具]
    Scaffold --&gt; S3[编辑工具]
    
    S1 --&gt; P1[建议方法]
    S1 --&gt; P2[灵活步骤]
    
    S2 --&gt; B1[执行命令]
    S2 --&gt; B2[环境管理]
    
    S3 --&gt; E1[查看文件]
    S3 --&gt; E2[编辑文件]
    S3 --&gt; E3[字符串替换]
</code></pre>
<hr/>
<h4 data-id="heading-7">智能体提示词</h4>
<p>以下代码展示了我们智能体脚手架的提示词：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">&lt;uploaded_files&gt;
{location}
&lt;/uploaded_files&gt;
I<span class="hljs-comment">'ve uploaded a python code repository in the directory {location} (not in /tmp/inputs). Consider the following PR description:</span>

&lt;pr_description&gt;
{pr_description}
&lt;/pr_description&gt;

Can you help <span class="hljs-keyword">me</span> implement the necessary changes <span class="hljs-keyword">to</span> the repository so that the requirements specified <span class="hljs-keyword">in</span> the &lt;pr_description&gt; are met?
I<span class="hljs-comment">'ve already taken care of all changes to any of the test files described in the &lt;pr_description&gt;. This means you DON'T have to modify the testing logic or any of the tests in any way!</span>

Your task <span class="hljs-built_in">is</span> <span class="hljs-keyword">to</span> make the minimal changes <span class="hljs-keyword">to</span> non-tests files <span class="hljs-keyword">in</span> the {location} directory <span class="hljs-keyword">to</span> ensure the &lt;pr_description&gt; <span class="hljs-built_in">is</span> satisfied.

Follow these steps <span class="hljs-keyword">to</span> resolve the issue:
<span class="hljs-number">1</span>. <span class="hljs-keyword">As</span> a first <span class="hljs-keyword">step</span>, it might be a good idea <span class="hljs-keyword">to</span> explore the repo <span class="hljs-keyword">to</span> familiarize yourself <span class="hljs-keyword">with</span> its <span class="hljs-keyword">structure</span>.
<span class="hljs-number">2</span>. Create a script <span class="hljs-keyword">to</span> reproduce the <span class="hljs-keyword">error</span> <span class="hljs-built_in">and</span> execute it <span class="hljs-keyword">with</span> `python &lt;filename.py&gt;` <span class="hljs-keyword">using</span> the BashTool, <span class="hljs-keyword">to</span> confirm the <span class="hljs-keyword">error</span>
<span class="hljs-number">3</span>. Edit the sourcecode <span class="hljs-keyword">of</span> the repo <span class="hljs-keyword">to</span> resolve the issue
<span class="hljs-number">4</span>. Rerun your reproduce script <span class="hljs-built_in">and</span> confirm that the <span class="hljs-keyword">error</span> <span class="hljs-built_in">is</span> fixed!
<span class="hljs-number">5</span>. Think about edgecases <span class="hljs-built_in">and</span> make sure your fix <span class="hljs-keyword">handles</span> them <span class="hljs-keyword">as</span> well

Your thinking should be thorough <span class="hljs-built_in">and</span> so it<span class="hljs-comment">'s fine if it's very long.</span>
</code></pre>
<p><strong>💡 建议的问题解决步骤</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[1. 探索仓库结构] --&gt; B[2. 创建重现脚本]
    B --&gt; C[3. 确认错误]
    C --&gt; D[4. 修改源代码]
    D --&gt; E[5. 重新测试]
    E --&gt; F{修复成功?}
    F --&gt;|否| D
    F --&gt;|是| G[6. 检查边界情况]
    G --&gt; H[完成]
</code></pre>
<hr/>
<h4 data-id="heading-8">Bash 工具规范</h4>
<p>模型的第一个工具执行 Bash 命令。架构很简单，只需要在环境中运行的命令。然而，工具的描述更重要。它包含了对模型的更详细说明，包括转义输入、缺乏互联网访问，以及如何在后台运行命令。</p>
<p>以下是 Bash 工具的规范：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bash"</span><span class="hljs-punctuation">,</span>
   <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Run commands in a bash shell\n
* When invoking this tool, the contents of the \"command\" parameter does NOT need to be XML-escaped.\n
* You don't have access to the internet via this tool.\n
* You do have access to a mirror of common linux and python packages via apt and pip.\n
* State is persistent across command calls and discussions with the user.\n
* To inspect a particular line range of a file, e.g. lines 10-25, try 'sed -n 10,25p /path/to/the/file'.\n
* Please avoid commands that may produce a very large amount of output.\n
* Please run long lived commands in the background, e.g. 'sleep 10 &amp;' or start a server in the background."</span><span class="hljs-punctuation">,</span>
   <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
           <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The bash command to run."</span>
           <span class="hljs-punctuation">}</span>
       <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"command"</span><span class="hljs-punctuation">]</span>
   <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>💡 Bash 工具关键说明</strong></p>

































<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>XML 转义</td><td>命令参数不需要 XML 转义</td></tr><tr><td>网络访问</td><td>❌ 无互联网访问</td></tr><tr><td>包管理</td><td>✅ 可通过 apt 和 pip 安装常用包</td></tr><tr><td>状态持久化</td><td>✅ 跨命令调用保持状态</td></tr><tr><td>输出限制</td><td>避免产生大量输出的命令</td></tr><tr><td>后台运行</td><td>支持后台运行长时命令</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-9">编辑工具规范</h4>
<p>模型的第二个工具（编辑工具）要复杂得多，包含了模型查看、创建和编辑文件所需的一切。同样，我们的工具描述包含了关于如何使用该工具的详细信息。</p>
<p>我们在各种智能体任务中对这些工具的描述和规范投入了大量精力。我们对它们进行了测试，以发现模型可能误解规范的任何方式，或使用工具的可能陷阱，然后编辑描述以预防这些问题。<strong>我们认为，应该像对设计人类工具界面投入大量关注一样，对为模型设计工具界面投入更多关注。</strong></p>
<p>以下代码展示了编辑工具的描述：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"str_replace_editor"</span><span class="hljs-punctuation">,</span>
   <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Custom editing tool for viewing, creating and editing files\n
* State is persistent across command calls and discussions with the user\n
* If `path` is a file, `view` displays the result of applying `cat -n`. If `path` is a directory, `view` lists non-hidden files and directories up to 2 levels deep\n
* The `create` command cannot be used if the specified `path` already exists as a file\n
* If a `command` generates a long output, it will be truncated and marked with `&lt;response clipped&gt;` \n
* The `undo_edit` command will revert the last edit made to the file at `path`\n
\n
Notes for using the `str_replace` command:\n
* The `old_str` parameter should match EXACTLY one or more consecutive lines from the original file. Be mindful of whitespaces!\n
* If the `old_str` parameter is not unique in the file, the replacement will not be performed. Make sure to include enough context in `old_str` to make it unique\n
* The `new_str` parameter should contain the edited lines that should replace the `old_str`"</span><span class="hljs-punctuation">,</span>
...
<span class="hljs-punctuation">}</span>
</code></pre>
<p>编辑工具的完整输入规范如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
           <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"enum"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"view"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"create"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"str_replace"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"insert"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"undo_edit"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The commands to run. Allowed options are: `view`, `create`, `str_replace`, `insert`, `undo_edit`."</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"file_text"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Required parameter of `create` command, with the content of the file to be created."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"insert_line"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Required parameter of `insert` command. The `new_str` will be inserted AFTER the line `insert_line` of `path`."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"new_str"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Required parameter of `str_replace` command containing the new string. Required parameter of `insert` command containing the string to insert."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"old_str"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Required parameter of `str_replace` command containing the string in `path` to replace."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Absolute path to file or directory, e.g. `/repo/file.py` or `/repo`."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
           <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
           <span class="hljs-attr">"view_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
               <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Optional parameter of `view` command when `path` points to a file. If none is given, the full file is shown. If provided, the file will be shown in the indicated line number range, e.g. [11, 12] will show lines 11 and 12. Indexing at 1 to start. Setting `[start_line, -1]` shows all lines from `start_line` to the end of the file."</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                   <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span>
               <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
               <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"array"</span>
           <span class="hljs-punctuation">}</span>
       <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"path"</span><span class="hljs-punctuation">]</span>
   <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>💡 编辑工具命令对比</strong></p>









































<table><thead><tr><th>命令</th><th>用途</th><th>必需参数</th><th>说明</th></tr></thead><tbody><tr><td><code>view</code></td><td>查看文件/目录</td><td>path</td><td>文件显示带行号，目录显示2级深度</td></tr><tr><td><code>create</code></td><td>创建新文件</td><td>path, file_text</td><td>文件已存在时不可用</td></tr><tr><td><code>str_replace</code></td><td>替换字符串</td><td>path, old_str, new_str</td><td>old_str 必须唯一匹配</td></tr><tr><td><code>insert</code></td><td>插入内容</td><td>path, insert_line, new_str</td><td>在指定行后插入</td></tr><tr><td><code>undo_edit</code></td><td>撤销编辑</td><td>path</td><td>撤销最后一次编辑</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-10">工具改进：错误防护</h4>
<p>我们改进性能的一个方法是让我们的工具"防错"。例如，有时模型在智能体移出根目录后可能会搞乱相对文件路径。为了防止这种情况，我们简单地<strong>让工具始终要求使用绝对路径</strong>。</p>
<p>我们尝试了几种不同的策略来指定对现有文件的编辑，并发现<strong>字符串替换</strong>的可靠性最高，其中模型在给定文件中指定要用 <code>new_str</code> 替换的 <code>old_str</code>。只有当 <code>old_str</code> 恰好有一个匹配时，才会进行替换。如果匹配数量更多或更少，模型会看到适当的错误消息以便重试。</p>
<p><strong>💡 防错设计原则</strong></p>






























<table><thead><tr><th>问题</th><th>解决方案</th><th>效果</th></tr></thead><tbody><tr><td>相对路径混乱</td><td>强制使用绝对路径</td><td>消除路径歧义</td></tr><tr><td>多处匹配</td><td>要求唯一匹配</td><td>精确定位修改</td></tr><tr><td>匹配失败</td><td>显示错误消息</td><td>允许重试</td></tr><tr><td>状态丢失</td><td>跨调用持久化</td><td>保持上下文</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">性能结果</h3>
<p>总体而言，升级版 Claude 3.5 Sonnet 展示了比我们之前的模型和之前最先进的模型更高的推理、编码和数学能力。它还展示了改进的智能体能力：工具和脚手架有助于将这些改进的能力发挥到最佳用途。</p>
<h4 data-id="heading-12">性能对比表</h4>

























<table><thead><tr><th>模型</th><th>SWE-bench Verified 得分</th></tr></thead><tbody><tr><td><strong>Claude 3.5 Sonnet (升级版)</strong></td><td><strong>49%</strong></td></tr><tr><td>之前的 SOTA</td><td>45%</td></tr><tr><td>Claude 3.5 Sonnet (旧版)</td><td>33%</td></tr><tr><td>Claude 3 Opus</td><td>22%</td></tr></tbody></table>
<p><em>所有模型均使用此智能体脚手架在 SWE-bench Verified 上的得分</em></p>
<p><strong>💡 性能提升路径</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[Claude 3 Opus&lt;br/&gt;22%] --&gt;|+11%| B[Sonnet 旧版&lt;br/&gt;33%]
    B --&gt;|+12%| C[之前 SOTA&lt;br/&gt;45%]
    C --&gt;|+4%| D[Sonnet 新版&lt;br/&gt;49%]
    D -.-&gt;|目标| E[50% 里程碑]
    
    style D fill:#90EE90
    style E fill:#FFD700
</code></pre>
<hr/>
<h3 data-id="heading-13">智能体行为示例</h3>
<p>为了运行基准测试，我们使用 <strong>SWE-Agent</strong> 框架作为智能体代码的基础。在下面的日志中，我们将智能体的文本输出、工具调用和工具响应呈现为 THOUGHT（思考）、ACTION（行动）和 OBSERVATION（观察），尽管我们并没有将模型限制在固定的顺序中。</p>
<p>以下代码块将演示 Sonnet 3.5 解决 SWE-bench 问题的典型案例。</p>
<h4 data-id="heading-14">步骤 1：初始提示和问题描述</h4>
<p>在第一个代码块中，你可以看到给模型的部分初始提示，其中 <code>{pr_description}</code> 被填充为来自 SWE-bench 任务的实际值。重要的是，此任务包含重现问题的步骤，这将为模型提供宝贵的调查起点。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">&lt;uploaded_files&gt;
/repo
&lt;/uploaded_files&gt;
I<span class="hljs-comment">'ve uploaded a python code repository in the directory /repo (not in /tmp/inputs). Consider the following PR description:</span>

&lt;pr_description&gt;
linear_model.RidgeClassifierCV<span class="hljs-comment">'s Parameter store_cv_values issue</span>

#### Description
Parameter store_cv_values <span class="hljs-keyword">error</span> <span class="hljs-keyword">on</span> sklearn.linear_model.RidgeClassifierCV

#### Steps/Code <span class="hljs-keyword">to</span> Reproduce
import numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> sklearn import linear_model <span class="hljs-keyword">as</span> lm

#test database
n = <span class="hljs-number">100</span>
x = np.random.randn(n, <span class="hljs-number">30</span>)
y = np.random.normal(size = n)

rr = lm.RidgeClassifierCV(alphas = np.arange(<span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">0.1</span>), normalize = <span class="hljs-literal">True</span>, 
                                         store_cv_values = <span class="hljs-literal">True</span>).fit(x, y)

#### Expected Results
Expected <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> the usual ridge regression model output, keeping the cross validation predictions <span class="hljs-keyword">as</span> attribute.

#### Actual Results
<span class="hljs-symbol">TypeError:</span> __init__() got an unexpected keyword argument <span class="hljs-comment">'store_cv_values'</span>

lm.RidgeClassifierCV actually has no parameter store_cv_values, even though some attributes depends <span class="hljs-keyword">on</span> it.
&lt;/pr_description&gt;
</code></pre>
<h4 data-id="heading-15">步骤 2：探索仓库结构</h4>
<p>模型首先使用编辑工具查看仓库结构：</p>
<pre><code class="hljs language-bash" lang="bash">THOUGHT:
I<span class="hljs-string">'ll help you implement the changes to satisfy the PR description. Let'</span>s follow the steps you outlined.

1. First, <span class="hljs-built_in">let</span><span class="hljs-string">'s explore the repo structure:

ACTION (str_replace_editor):
command: view
path: /repo

OBSERVATION:
Here'</span>s the files and directories up to 2 levels deep <span class="hljs-keyword">in</span> /repo, excluding hidden items:
/repo
/repo/PULL_REQUEST_TEMPLATE.md
/repo/ISSUE_TEMPLATE.md
/repo/sklearn
/repo/sklearn/decomposition
/repo/sklearn/kernel_ridge.py
/repo/sklearn/model_selection
/repo/sklearn/covariance
/repo/sklearn/cluster
/repo/sklearn/base.py
/repo/sklearn/dummy.py
/repo/sklearn/naive_bayes.py
...
</code></pre>
<h4 data-id="heading-16">步骤 3：创建重现脚本</h4>
<p>模型使用编辑工具创建一个新脚本，用于重现问题并测试其修复：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">THOUGHT:</span>
Based <span class="hljs-keyword">on</span> the repository <span class="hljs-keyword">structure</span>, we<span class="hljs-comment">'ll need to modify the Ridge Classifier in the `sklearn/linear_model` directory.</span>

<span class="hljs-keyword">Let</span><span class="hljs-comment">'s create a script to reproduce the error:</span>

ACTION (str_replace_editor):
<span class="hljs-symbol">command:</span> create
<span class="hljs-symbol">path:</span> /repo/reproduce_error.py
<span class="hljs-symbol">file_text:</span>
import numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> sklearn import linear_model <span class="hljs-keyword">as</span> lm

#test database
n = <span class="hljs-number">100</span>
x = np.random.randn(n, <span class="hljs-number">30</span>)
y = np.random.normal(size = n)

rr = lm.RidgeClassifierCV(alphas=np.arange(<span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">0.1</span>), normalize=<span class="hljs-literal">True</span>, 
                         store_cv_values=<span class="hljs-literal">True</span>).fit(x, y)

<span class="hljs-symbol">OBSERVATION:</span>
File created successfully at: /repo/reproduce_error.py
</code></pre>
<h4 data-id="heading-17">步骤 4：执行脚本确认错误</h4>
<p>模型使用 Bash 工具执行脚本，成功重现问题：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">THOUGHT:</span>
<span class="hljs-keyword">Let</span><span class="hljs-comment">'s verify that we can reproduce the error:</span>

ACTION (bash):
<span class="hljs-symbol">command:</span> python3 /repo/reproduce_error.py

<span class="hljs-symbol">OBSERVATION:</span>
Traceback (most recent <span class="hljs-keyword">call</span> last):
  File <span class="hljs-string">"/repo/reproduce_error.py"</span>, line <span class="hljs-number">10</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
    store_cv_values=<span class="hljs-literal">True</span>).fit(x, y)
<span class="hljs-symbol">TypeError:</span> __init__() got an unexpected keyword argument <span class="hljs-comment">'store_cv_values'</span>
</code></pre>
<h4 data-id="heading-18">步骤 5：修复源代码</h4>
<p>模型使用编辑工具更改仓库中的源代码：</p>
<pre><code class="hljs language-ini" lang="ini">THOUGHT:
The error is reproducible. Looking at the code, I can see that the issue is that while the `RidgeClassifierCV` class inherits from `_BaseRidgeCV`, it fails to pass the `store_cv_values` parameter from its constructor through to the base class constructor.

Let's fix this:

ACTION (str_replace_editor):
command: str_replace
path: /repo/sklearn/linear_model/ridge.py
old_str:
    def __init__(self, <span class="hljs-attr">alphas</span>=(<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">10.0</span>), fit_intercept=<span class="hljs-literal">True</span>,
                 <span class="hljs-attr">normalize</span>=<span class="hljs-literal">False</span>, scoring=None, cv=None, class_weight=None):
        super(RidgeClassifierCV, self).__init__(
            <span class="hljs-attr">alphas</span>=alphas, fit_intercept=fit_intercept, normalize=normalize,
            <span class="hljs-attr">scoring</span>=scoring, cv=cv)
        <span class="hljs-attr">self.class_weight</span> = class_weight

new_str:
    def __init__(self, <span class="hljs-attr">alphas</span>=(<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">10.0</span>), fit_intercept=<span class="hljs-literal">True</span>,
                 <span class="hljs-attr">normalize</span>=<span class="hljs-literal">False</span>, scoring=None, cv=None, class_weight=None,
                 <span class="hljs-attr">store_cv_values</span>=<span class="hljs-literal">False</span>):
        super(RidgeClassifierCV, self).__init__(
            <span class="hljs-attr">alphas</span>=alphas, fit_intercept=fit_intercept, normalize=normalize,
            <span class="hljs-attr">scoring</span>=scoring, cv=cv, store_cv_values=store_cv_values)
        <span class="hljs-attr">self.class_weight</span> = class_weight
</code></pre>
<p><strong>💡 问题解决工作流</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Model as Claude 模型
    participant Edit as 编辑工具
    participant Bash as Bash 工具
    participant Test as 测试系统

    Model-&gt;&gt;Edit: 查看仓库结构
    Edit--&gt;&gt;Model: 返回目录树
    Model-&gt;&gt;Edit: 创建重现脚本
    Edit--&gt;&gt;Model: 脚本创建成功
    Model-&gt;&gt;Bash: 执行重现脚本
    Bash--&gt;&gt;Model: 返回错误信息
    Model-&gt;&gt;Model: 分析问题根因
    Model-&gt;&gt;Edit: 修改源代码 (str_replace)
    Edit--&gt;&gt;Model: 修改成功
    Model-&gt;&gt;Bash: 重新运行测试
    Bash--&gt;&gt;Model: 测试通过
    Model-&gt;&gt;Test: 提交解决方案
</code></pre>
<h4 data-id="heading-19">任务完成</h4>
<p>在这个特定示例中，模型工作了 <strong>12 个步骤</strong>后决定准备提交。然后任务的测试成功运行，验证了模型的解决方案解决了问题。一些任务在模型提交解决方案之前花费了<strong>超过 100 个回合</strong>；在其他任务中，模型一直尝试直到耗尽上下文。</p>
<p>从审查升级版 Claude 3.5 Sonnet 与旧模型的尝试中，我们发现升级版 3.5 Sonnet <strong>更频繁地自我纠正</strong>。它还显示出尝试多种不同解决方案的能力，而不是一遍又一遍地犯同样的错误。</p>
<hr/>
<h3 data-id="heading-20">面临的挑战</h3>
<p>SWE-bench Verified 是一个强大的评估，但它运行起来也比简单的单轮评估更复杂。以下是我们在使用它时面临的一些挑战——其他 AI 开发者也可能会遇到这些挑战。</p>
<h4 data-id="heading-21">1. 持续时间和高令牌成本</h4>
<p>上面的示例来自一个在 12 个步骤中成功完成的案例。然而，许多成功的运行需要数百个回合才能解决，并且使用了<strong>超过 10 万个令牌</strong>。升级版 Claude 3.5 Sonnet 非常坚韧：如果有足够的时间，它通常可以找到解决问题的方法，但这可能很昂贵。</p>
<h4 data-id="heading-22">2. 评分问题</h4>
<p>在检查失败的任务时，我们发现了一些模型行为正确但存在环境设置问题，或安装补丁被应用两次的问题的情况。解决这些系统问题对于准确了解 AI 智能体的性能至关重要。</p>
<h4 data-id="heading-23">3. 隐藏测试</h4>
<p>由于模型无法看到它被评分的测试，它经常"认为"自己已经成功，但任务实际上是失败的。其中一些失败是因为模型在错误的抽象级别上解决了问题（打补丁而不是更深层次的重构）。其他失败感觉不太公平：它们解决了问题，但与原始任务的单元测试不匹配。</p>
<h4 data-id="heading-24">4. 多模态能力未充分利用</h4>
<p>尽管升级版 Claude 3.5 Sonnet 具有出色的视觉和多模态能力，但我们没有实现让它查看保存到文件系统或作为 URL 引用的文件的方法。这使得调试某些任务（特别是来自 Matplotlib 的任务）特别困难，并且也容易导致模型产生幻觉。这里对于开发者来说肯定有唾手可得的成果可以改进——而且 SWE-bench 已经推出了一个专注于多模态任务的新评估。我们期待看到开发者在不久的将来使用 Claude 在这个评估上取得更高的分数。</p>
<p><strong>💡 挑战与应对策略</strong></p>



































<table><thead><tr><th>挑战</th><th>具体表现</th><th>影响</th><th>潜在解决方案</th></tr></thead><tbody><tr><td><strong>高成本</strong></td><td>100+ 回合，10万+ tokens</td><td>资源密集</td><td>优化提示词，减少无效尝试</td></tr><tr><td><strong>评分复杂性</strong></td><td>环境问题，补丁重复</td><td>误判性能</td><td>标准化环境，改进测试流程</td></tr><tr><td><strong>隐藏测试</strong></td><td>模型无法看到评分标准</td><td>误判成功</td><td>提供测试提示，改进反馈</td></tr><tr><td><strong>多模态受限</strong></td><td>无法查看图片/可视化</td><td>调试困难</td><td>集成视觉能力，支持文件预览</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-25">总结与展望</h3>
<p>升级版 Claude 3.5 Sonnet 在 SWE-bench Verified 上取得了 <strong>49%</strong> 的成绩，超越了之前最先进的 45%，仅使用了一个简单的提示词和两个通用工具。我们相信，使用新的 Claude 3.5 Sonnet 进行构建的开发者将很快找到新的、更好的方法来提高 SWE-bench 分数，超过我们在这里最初展示的水平。</p>
<hr/>
<h3 data-id="heading-26">致谢</h3>
<p>Erik Schluntz 优化了 SWE-bench 智能体并撰写了这篇博客文章。Simon Biggs、Dawn Drain 和 Eric Christiansen 帮助实现了基准测试。Shauna Kravec、Dawn Drain、Felipe Rosso、Nova DasSarma、Ven Chandrasekaran 以及许多其他人为训练 Claude 3.5 Sonnet 在智能体编码方面表现出色做出了贡献。</p>
<hr/>
<h3 data-id="heading-27">📝 总结</h3>
<h4 data-id="heading-28">核心要点</h4>
<ol>
<li>
<p><strong>性能里程碑</strong>：Claude 3.5 Sonnet 达到 49%，距离 50% 里程碑仅一步之遥</p>
</li>
<li>
<p><strong>架构创新</strong>：最小化脚手架 + 最大化模型自主权的设计理念</p>
</li>
<li>
<p><strong>工具设计</strong>：两个精心设计的通用工具（Bash + 编辑）胜过复杂系统</p>
</li>
<li>
<p><strong>设计哲学</strong>：</p>
<ul>
<li>让 AI 自主决策工作流程，而非硬编码固定模式</li>
<li>绝对路径、精确匹配等设计减少错误</li>
<li>像设计人机界面一样精心设计 AI-工具界面</li>
</ul>
</li>
<li>
<p><strong>智能体能力</strong>：</p>
<ul>
<li>能够尝试多种方案，不重复犯错</li>
<li>可以进行 100+ 回合的长期问题解决</li>
<li>在实际工程任务上表现出色</li>
</ul>
</li>
</ol>
<hr/>
<p><strong>原文作者</strong>: Erik Schluntz (Anthropic Engineering Team)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[git版本控制]公钥和私钥是如何建立安全身份认证的]]></title>    <link>https://juejin.cn/post/7600628279215652890</link>    <guid>https://juejin.cn/post/7600628279215652890</guid>    <pubDate>2026-01-29T14:41:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215652890" data-draft-id="7600615229995171890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[git版本控制]公钥和私钥是如何建立安全身份认证的"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-29T14:41:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [git版本控制]公钥和私钥是如何建立安全身份认证的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:41:17.000Z" title="Thu Jan 29 2026 14:41:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. <strong>目的：建立安全的身份认证通道</strong></h2>
<p>将公钥填写到GitHub账户的SSH Keys设置中，核心目的是：<strong>允许你的本地Git客户端通过SSH协议安全地向GitHub证明“你就是你”，而无需每次输入密码。</strong></p>
<p>这解决了两个问题：</p>
<ul>
<li><strong>安全性</strong>：使用非对称加密，比密码更安全（抗暴力破解）。</li>
<li><strong>便捷性</strong>：配置一次后，后续的<code>git push</code>、<code>git pull</code>等操作无需再输入凭证。</li>
</ul>
<h2 data-id="heading-1">2. <strong>匹配机制：不是简单的“存储-比对”</strong></h2>
<p>你的理解“GitHub会根据这个公钥和本地的私钥进行匹配”<strong>不完全准确</strong>。更精确的流程是：</p>
<p>GitHub<strong>不会主动</strong>去尝试匹配你的私钥。它只是<strong>将你提供的公钥与你账户绑定并存储起来</strong>。</p>
<p>当你（客户端）尝试连接时，会触发一个<strong>加密挑战-应答流程</strong>：</p>
<ol>
<li>你执行 <code>git push origin main</code>。</li>
<li>GitHub服务器收到连接请求，发现连接尝试来自一个声称拥有某个公钥对应身份的客户端。</li>
<li>GitHub会生成一个随机字符串（挑战），并用你之前存储在它那里的<strong>公钥</strong>对这个字符串进行<strong>加密</strong>，然后将加密后的数据发回给你的客户端。</li>
<li>你的本地Git/SSH客户端收到这个加密的挑战后，必须使用你本地计算机上对应的、且保密的<strong>私钥</strong>来<strong>解密</strong>这个字符串。</li>
<li>客户端将解密出的原始字符串发回给GitHub服务器。</li>
<li>GitHub服务器验证发回来的字符串是否与自己最初生成的随机字符串一致。</li>
</ol>
<p><strong>关键点</strong>：</p>
<ul>
<li><strong>只有拥有正确私钥的客户端</strong>才能完成第4步的解密。因为公钥加密的数据，只有配对的私钥能解开。</li>
<li>GitHub<strong>永远不会看到或收到你的私钥</strong>，私钥始终只存在于你的本地机器上。这是非对称加密安全性的基石。</li>
<li>验证的核心是**“能否用私钥解开用对应公钥加密的信息”**，而不是直接比对密钥本身。</li>
</ul>
<h2 data-id="heading-2">3. <strong>验证成功的结果</strong></h2>
<p>如果上述挑战-应答成功（即你证明了拥有私钥），GitHub就确认了“操作者是与该公钥绑定的账户所有者”，于是允许你执行相应的操作（如推送代码到你有权限的仓库）。</p>
<p>你的理解“如果匹配上了就算验证成功了”从这个意义上说是对的，但需要明确这个“匹配”是指<strong>成功通过了加密挑战</strong>，而非简单的字符串比对。</p>
<hr/>
<h2 data-id="heading-3"><strong>总结与类比</strong></h2>
<p>可以把整个流程想象成一个高科技的<strong>门禁系统</strong>：</p>
<ol>
<li><strong>登记公钥</strong>：你把一个特制的、只能加密不能解密的“锁”（公钥）交给GitHub管理员，并告诉他：“以后拿这把锁锁住的信息，我能打开”。</li>
<li><strong>发起访问</strong>：你去访问仓库大门。</li>
<li><strong>发起挑战</strong>：门禁系统（GitHub）随机写一张小纸条（挑战码），用你给它的那把“锁”（公钥）把纸条锁进一个盒子，然后把盒子递给你。</li>
<li><strong>证明身份</strong>：你用自己的、独一无二的“钥匙”（私钥）打开这个盒子，取出纸条，把纸条内容给门禁看。</li>
<li><strong>授权通过</strong>：门禁验证纸条内容正确，就确信你是钥匙的主人，为你开门。</li>
</ol>
<p><strong>流程图如下：</strong></p>
<pre><code class="hljs language-lua" lang="lua">你的本地机器                          GitHub服务器
    |                                    |
    | <span class="hljs-number">1.</span> git push (发起连接)              |
    |<span class="hljs-comment">-----------------------------------&gt;|</span>
    |                                    |
    |     <span class="hljs-number">2.</span> 找到关联公钥，生成随机挑战R    |
    |     <span class="hljs-number">3.</span> 用公钥加密挑战: {R}_公钥      |
    |&lt;<span class="hljs-comment">-----------------------------------|</span>
    |                                    |
    | <span class="hljs-number">4.</span> 用私钥解密得到: R                 |
    |                                    |
    | <span class="hljs-number">5.</span> 发送解密后的挑战 R                |
    |<span class="hljs-comment">-----------------------------------&gt;|</span>
    |                                    |
    |     <span class="hljs-number">6.</span> 验证 R 是否匹配               |
    |     <span class="hljs-number">7.</span> 验证成功，允许操作            |
    |&lt;<span class="hljs-comment">-----------------------------------|</span>
    |                                    |
</code></pre>
<p>所以，你的理解方向是对的，核心是<strong>通过加密和解密操作来完成身份验证</strong>，而不是简单的存储和匹配。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习OpenGL——第十一天]]></title>    <link>https://juejin.cn/post/7600663744191954980</link>    <guid>https://juejin.cn/post/7600663744191954980</guid>    <pubDate>2026-01-29T11:14:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744191954980" data-draft-id="7600560664407605311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习OpenGL——第十一天"/> <meta itemprop="keywords" content="OpenGL"/> <meta itemprop="datePublished" content="2026-01-29T11:14:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Kimoro"/> <meta itemprop="url" content="https://juejin.cn/user/3889451248137260"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习OpenGL——第十一天
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3889451248137260/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Kimoro
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:14:04.000Z" title="Thu Jan 29 2026 11:14:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">光照模型详解：定向光、点光源与聚光</h2>
<hr/>
<h3 data-id="heading-1">一、平行光（定向光）</h3>
<p>当光源距离极远时，光线近似为平行，这种理想化的光源称为定向光。此时，无论物体或观察者的位置如何，场景中的所有光线都来自同一方向，与光源具体位置无关。</p>
<ul>
<li>典型例子：太阳。虽然太阳不是无限远，但在光照计算中可视为无限远，因此可将太阳光近似为平行光线。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c35d140d2754fb884133f2bd2e14ab2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2ltb3Jv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770290043&amp;x-signature=1lryktFB06GKtj8mnnR1XUfoWrE%3D" alt="image.png" loading="lazy"/></p>
<p>定向光的特点：</p>
<ul>
<li>所有光线方向一致，物体与光源的相对位置不影响光照方向。</li>
<li>着色时可直接定义光的方向向量，无需光源位置。</li>
</ul>
<p>实现方式：</p>
<ul>
<li>在着色器中定义光的方向向量（direction），而非位置向量。</li>
<li>计算光照时，需将方向向量取反，并进行标准化。</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DirLight</span> {</span>
vec3 direction;
    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
};

vec3 <span class="hljs-title function_">CalcDirLight</span><span class="hljs-params">(DirLight light, vec3 normal, vec3 viewDir)</span>{
    vec3 lightDir = normalize(-light.direction);
    <span class="hljs-type">float</span> diff = max(dot(normal, lightDir), <span class="hljs-number">0.0</span>);
    vec3 reflectDir = reflect(-lightDir, normal);
    <span class="hljs-type">float</span> spec = <span class="hljs-built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="hljs-number">0.0</span>), material.shininess);
    vec3 ambient = light.ambient * vec3(texture(material.diffuseMap, TexCoords));
    vec3 diffuse = light.diffuse * diff * vec3(texture(material.diffuseMap, TexCoords));
    vec3 specular = light.specular * spec * vec3(texture(material.specularMap, TexCoords));
    <span class="hljs-keyword">return</span> (ambient + diffuse + specular);
}
</code></pre>
<p>注意事项：</p>
<ul>
<li>光线方向需取反（从片段指向光源）。</li>
<li>向量需标准化，避免错误计算。</li>
<li>使用vec4表示向量时，方向向量的w分量应为0.0，位置向量为1.0，可用于区分光照类型。</li>
</ul>
<blockquote>
<p>旧OpenGL通过检测w分量判断光源类型：w=0为定向光，w=1为位置光源。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、点光源</h3>
<p>点光源位于世界中的某一点，向四周均匀发射光线，光强随距离递减。常见的点光源包括灯泡、火把等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/609decd6e5654744bfe8572227a36c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2ltb3Jv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770290043&amp;x-signature=7zUS6533E0ZcEhdxBfa4RgdtlJw%3D" alt="image.png" loading="lazy"/></p>
<p>点光源特点：</p>
<ul>
<li>光照随距离衰减，称为Attenuation（衰减）。</li>
<li>实际中，采用二次方程进行光强衰减以更真实地模拟物理现象。</li>
</ul>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mn>1.0</mn><mrow><msub><mi>K</mi><mi>c</mi></msub><mo>+</mo><msub><mi>K</mi><mi>i</mi></msub><mo>∗</mo><mi>d</mi><mo>+</mo><msub><mi>K</mi><mi>d</mi></msub><mo>∗</mo><msup><mi>d</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">F_{att} = \frac{1.0}{K_c+K_i*d+K_d*d^2} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.296em;vertical-align:-0.4509em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">d</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span><span class="mbin mtight">∗</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1.0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4509em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>衰减参数说明：</p>
<ul>
<li>常数项（Kc）：通常为1.0，保证分母不小于1，防止光强异常。</li>
<li>一次项（Kl）：与距离成正比，线性递减光强。</li>
<li>二次项（Kq）：与距离的平方成正比，远距离时影响更大。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c290ca36416b48588ff1445b252c1598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2ltb3Jv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770290043&amp;x-signature=zMa5%2By9JEbYOz5mn59Svt9NV258%3D" alt="image.png" loading="lazy"/></p>
<p>点光源结构体定义：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PointLight</span> {</span>
    vec3 position;

    <span class="hljs-type">float</span> constant;
    <span class="hljs-type">float</span> linear;
    <span class="hljs-type">float</span> quadratic;

    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
}; 
</code></pre>
<p>实现方式：</p>
<ul>
<li>计算片段与光源距离，代入衰减公式，分别作用于环境光、漫反射和镜面光分量。</li>
</ul>
<pre><code class="hljs language-c" lang="c">vec3 <span class="hljs-title function_">CalcPointLight</span><span class="hljs-params">(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir)</span>{
    vec3 lightDir = normalize(light.position - fragPos);
    <span class="hljs-type">float</span> diff = max(dot(normal, lightDir), <span class="hljs-number">0.0</span>);
    vec3 reflectDir = reflect(-lightDir, normal);
    <span class="hljs-type">float</span> spec = <span class="hljs-built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="hljs-number">0.0</span>), material.shininess);
    <span class="hljs-type">float</span> distance = length(light.position - fragPos);
    <span class="hljs-type">float</span> attenuation = <span class="hljs-number">1.0</span> / (light.constant + light.linear * distance + light.quadratic * (distance * distance));    
    vec3 ambient  = light.ambient  * vec3(texture(material.diffuseMap, TexCoords));
    vec3 diffuse  = light.diffuse  * diff * vec3(texture(material.diffuseMap, TexCoords));
    vec3 specular = light.specular * spec * vec3(texture(material.specularMap, TexCoords));
    <span class="hljs-keyword">return</span> (ambient + diffuse + specular) * attenuation;
}
</code></pre>
<hr/>
<h3 data-id="heading-3">三、聚光（Spotlight）</h3>
<p>聚光是一种只在某一方向、特定角度范围内发射光线的光源，类似于路灯或手电筒。只有位于聚光锥体内的物体会被照亮，其余部分保持黑暗。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bdc1625252c40d3ae1935755c0616b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2ltb3Jv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770290043&amp;x-signature=XnT%2B4dLXOex2w0BoOhQaTrU5svE%3D" alt="image.png" loading="lazy"/></p>
<p>聚光参数说明：</p>
<ul>
<li>LightDir：从片段指向光源的向量。</li>
<li>SpotDir：聚光方向向量。</li>
<li>Cutoff Angle（切光角）：决定聚光锥体的半径。</li>
<li>Theta：LightDir与SpotDir的夹角，判断片段是否在锥体内。</li>
</ul>
<p>结构体定义：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SpotLight</span> {</span>
    vec3 position;
    vec3 direction;
    <span class="hljs-type">float</span> cutOff;
    <span class="hljs-type">float</span> outerCutOff;

    <span class="hljs-type">float</span> constant;
    <span class="hljs-type">float</span> linear;
    <span class="hljs-type">float</span> quadratic;

    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
};
</code></pre>
<p>边缘平滑处理：</p>
<ul>
<li>定义内圆锥（cutOff）和外圆锥（outerCutOff），在二者之间，光强平滑过渡。</li>
</ul>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mfrac><mrow><mi>θ</mi><mo>−</mo><mi>γ</mi></mrow><mi>ϵ</mi></mfrac></mrow><annotation encoding="application/x-tex">I=\frac{θ-γ}{ϵ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2772em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ϵ</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05556em;">γ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li>通过计算theta与cutOff、outerCutOff的关系，利用clamp函数将强度约束在0到1之间。</li>
</ul>
<p>聚光实现示例：</p>
<pre><code class="hljs language-c" lang="c">vec3 <span class="hljs-title function_">CalcSpotLight</span><span class="hljs-params">(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir)</span>{
    vec3 lightDir = normalize(light.position - fragPos);
    <span class="hljs-type">float</span> diff = max(dot(normal, lightDir), <span class="hljs-number">0.0</span>);
    vec3 reflectDir = reflect(-lightDir, normal);
    <span class="hljs-type">float</span> spec = <span class="hljs-built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="hljs-number">0.0</span>), material.shininess);
    <span class="hljs-type">float</span> distance = length(light.position - fragPos);
    <span class="hljs-type">float</span> attenuation = <span class="hljs-number">1.0</span> / (light.constant + light.linear * distance + light.quadratic * (distance * distance));    
    vec3 ambient  = light.ambient  * vec3(texture(material.diffuseMap, TexCoords));
    vec3 diffuse  = light.diffuse  * diff * vec3(texture(material.diffuseMap, TexCoords));
    vec3 specular = light.specular * spec * vec3(texture(material.specularMap, TexCoords));
    <span class="hljs-type">float</span> theta     = dot(lightDir, normalize(-light.direction));
    <span class="hljs-type">float</span> epsilon   = light.cutOff - light.outerCutOff;
    <span class="hljs-type">float</span> intensity = clamp((theta - light.outerCutOff) / epsilon, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    <span class="hljs-keyword">return</span> (ambient + diffuse + specular) * attenuation * intensity;
}
</code></pre>
<blockquote>
<p>提示：clamp函数确保强度值始终在0~1之间，保证光照过渡自然。</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[STM32之GPIO输出]]></title>    <link>https://juejin.cn/post/7600615229994909746</link>    <guid>https://juejin.cn/post/7600615229994909746</guid>    <pubDate>2026-01-29T12:36:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600615229994909746" data-draft-id="7600489282840068106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="STM32之GPIO输出"/> <meta itemprop="keywords" content="嵌入式"/> <meta itemprop="datePublished" content="2026-01-29T12:36:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RobotMu"/> <meta itemprop="url" content="https://juejin.cn/user/2684353293115578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            STM32之GPIO输出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2684353293115578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RobotMu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:36:00.000Z" title="Thu Jan 29 2026 12:36:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>达成成就：点灯大师！！！</strong> 记录下学到的一些要点</p>
<h2 data-id="heading-0">操作 GPIO 步骤分解</h2>
<blockquote>
<p><strong>总共涉及了<code>RCC</code>和<code>GPIO</code>两个外设</strong></p>
<ol>
<li>使用<code>RCC</code>开启<code>GPIO</code>的时钟</li>
<li>使用<code>GPIO_Init</code>函数初始化<code>GPIO</code></li>
<li>使用输出或者输入的函数控制<code>GPIO</code>口</li>
</ol>
<p><strong>两个外设的库函数</strong></p>
<blockquote>
<p><code>RCC</code>最主要的只有三个函数：<code>RCC AHB</code>外设时钟控制 || <code>RCC APB2</code>外设时钟控制 || <code>RCC APB1</code>外设时钟控制</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8be63970f236482c8cf77800d4b2509a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ib3RNdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294963&amp;x-signature=%2FWVeNDuPnZXC3X%2F5WgZAZByF2MA%3D" alt="image-20260129095454888.png" loading="lazy"/></p>
<p><code>GPIO</code>最主要的是<code>GPIO_Init</code>和八个读写函数</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4496c8613874e7f804437edf80ae524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ib3RNdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294963&amp;x-signature=Gxxh7Nj8h7zlDI3AI8dUD7TNzj0%3D" alt="image-20260129100330064.png" loading="lazy"/></p>
</blockquote>
</blockquote>
<h2 data-id="heading-1">点亮 LED 代码</h2>
<blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#include "stm32f10x.h"                  // Device header</span>
​
int main(void)
{
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE)<span class="hljs-comment">;</span>
    
    GPIO_InitTypeDef GPIO_InitStruct<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Mode</span> = GPIO_Mode_Out_PP<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Pin</span> = GPIO_Pin_0<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Speed</span> = GPIO_Speed_50MHz<span class="hljs-comment">;</span>
    
    GPIO_Init(GPIOA, &amp;GPIO_InitStruct)<span class="hljs-comment">;</span>
    
    GPIO_ResetBits(GPIOA, GPIO_Pin_0)<span class="hljs-comment">;</span>
    
    while (1)
    {
    
    }
}
​
</code></pre>
<p>这里学到了一些新东西，主要在第一行<code>RCC</code>开启时钟</p>
<p><code>RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);</code>可以翻译成：请 <code>RCC</code> 给 <strong>APB2 总线上的 GPIOA 外设</strong> 打开时钟，让它开始工作</p>
<ul>
<li>
<p><code>RCC</code>的三个函数<code>RCC_AHBPeriphClockCmd、RCC_APB1PeriphClockCmd、RCC_APB2PeriphClockCmd</code>表示的是要开启时钟的外设在哪条<strong>总线</strong>上</p>
<p><strong>不记得没关系</strong>，可以跳转到定义查看，以<code>RCC_APB2PeriphClockCmd</code>为例，其定义如下（<strong>可以看到 GPIOA 外设在这上面</strong>）</p>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27da1c71d2dd4f94988fc00fb6d5e15c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ib3RNdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294963&amp;x-signature=nDAei0tn7UcqtuCRrPPx7EO1LFY%3D" alt="image-20260129104023111.png" loading="lazy"/></p>
</blockquote>
</li>
<li>
<p>时钟是给外设的，不是给某个引脚的。这里我们要操作的是<code>GPIOA</code>上的<code>0</code>号引脚，所以用<code>RCC</code>开启<code>GPIOA</code>的时钟</p>
</li>
</ul>
</blockquote>
<h2 data-id="heading-2">LED 闪烁代码</h2>
<blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#include "stm32f10x.h"                  // Device header</span>
<span class="hljs-comment">#include "Delay.h"</span>
​
int main(void)
{
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE)<span class="hljs-comment">;</span>
    
    GPIO_InitTypeDef GPIO_InitStruct<span class="hljs-comment">;</span>
    
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Mode</span> = GPIO_Mode_Out_PP<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Pin</span> = GPIO_Pin_0<span class="hljs-comment">;</span>
    <span class="hljs-attr">GPIO_InitStruct.GPIO_Speed</span> = GPIO_Speed_50MHz<span class="hljs-comment">;</span>
    
    GPIO_Init(GPIOA, &amp;GPIO_InitStruct)<span class="hljs-comment">;</span>
    
    while (1)
    {
        GPIO_WriteBit(GPIOA, GPIO_Pin_0, Bit_RESET)<span class="hljs-comment">;</span>
        Delay_ms(500)<span class="hljs-comment">;</span>
        GPIO_WriteBit(GPIOA, GPIO_Pin_0, Bit_SET)<span class="hljs-comment">;</span>
        Delay_ms(2000)<span class="hljs-comment">;</span>
    }
}
​
</code></pre>
<p>这里并没有什么特别的，新学了<code>GPIO</code>的写函数<code>GPIO_WriteBit(GPIOA, GPIO_Pin_0, Bit_SET);</code>功能上感觉和<code>GPIO_SetBits</code>、<code>GPIO_ResetBits</code>没什么区别，这个函数可以通过<strong>第三个参数来决定高/低电平</strong></p>
</blockquote>
<h2 data-id="heading-3">LED 流水灯代码</h2>
<blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-id">#include</span> "stm32f10x<span class="hljs-selector-class">.h</span>"                  <span class="hljs-comment">// Device header</span>
<span class="hljs-selector-id">#include</span> "Delay<span class="hljs-selector-class">.h</span>"
​
int <span class="hljs-selector-tag">main</span>(void)
{
    <span class="hljs-built_in">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_GPIOA, ENABLE);
    
    GPIO_InitTypeDef GPIO_InitStruct;
    GPIO_InitStruct<span class="hljs-selector-class">.GPIO_Mode</span> = GPIO_Mode_Out_PP;
    GPIO_InitStruct<span class="hljs-selector-class">.GPIO_Pin</span> = GPIO_Pin_All;
    GPIO_InitStruct<span class="hljs-selector-class">.GPIO_Speed</span> = GPIO_Speed_50MHz;
    
    <span class="hljs-built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStruct);
    
    while (<span class="hljs-number">1</span>)
    {
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0001); <span class="hljs-comment">// 0000 0000 0000 0001</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0002); <span class="hljs-comment">// 0000 0000 0000 0010</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0004); <span class="hljs-comment">// 0000 0000 0000 0100</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0008); <span class="hljs-comment">// 0000 0000 0000 1000</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0010); <span class="hljs-comment">// 0000 0000 0001 0000</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0020); <span class="hljs-comment">// 0000 0000 0010 0000</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0040); <span class="hljs-comment">// 0000 0000 0100 0000</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">GPIO_Write</span>(GPIOA, ~<span class="hljs-number">0</span>x0080); <span class="hljs-comment">// 0000 0000 1000 0000</span>
        <span class="hljs-built_in">Delay_ms</span>(<span class="hljs-number">500</span>);
    }
}
​
</code></pre>
<ul>
<li>这里获得了非常重要的印象：<strong>一个比特位控制一个引脚</strong></li>
<li><code>GPIO_Write(GPIOA, ~0x0001);</code>是<code>GPIO</code>的第四个写函数，它的特别之处在于通过<code>16</code>进制数据（第二个参数）来一次设置指定的<code>GPIO</code>外设的全部引脚的电平</li>
</ul>
<p><strong>思考与体会</strong></p>
<p>我现在觉得很好玩的一点是我点亮了<code>8</code>个<code>LED</code>组成的流水灯，改动一下程序不就可以传各种信息了吗，只要有对应的协议，比如摩斯密码这种（想到了寄生虫电影里的情节，也是通过灯亮和频率来传递信息的）。所以这相当于是硬件之间通信的一种外显对吗，其实原理是差不多的</p>
<p>所以后面要学的各种通信协议也都像这个小灯一样吗？<strong>保留这种印象学习吧</strong></p>
<p><strong>给自己准备的小练习</strong></p>
<p>我们可以用这个流水灯写一个这样的小程序，来输出字符串，比如 <code>hello world</code></p>
<p>英文单词一共26个，只需要用5个流水灯来表示，后3个流水灯来指示输出的开始、结束、单词拼写的开始、结束</p>
<p><strong>实现代码如下：</strong></p>
</blockquote>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"stm32f10x.h"</span>                  <span class="hljs-comment">// Device header</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Delay.h"</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
	
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;
	GPIO_InitStruct.GPIO_Pin = GPIO_Pin_All;
	GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
	
	GPIO_Init(GPIOA, &amp;GPIO_InitStruct);
        
	<span class="hljs-comment">// 字母对应的16进制码</span>
	<span class="hljs-type">uint16_t</span> letter_table[<span class="hljs-number">26</span>] = {
		<span class="hljs-number">0x0001</span>, <span class="hljs-comment">// a 0000 0001</span>
		<span class="hljs-number">0x0002</span>, <span class="hljs-comment">// b 0000 0010</span>
		<span class="hljs-number">0x0003</span>, <span class="hljs-comment">// c 0000 0011</span>
		<span class="hljs-number">0x0004</span>, <span class="hljs-comment">// d 0000 0100</span>
		<span class="hljs-number">0x0005</span>, <span class="hljs-comment">// e 0000 0101</span>
		<span class="hljs-number">0x0006</span>, <span class="hljs-comment">// f 0000 0110</span>
		<span class="hljs-number">0x0007</span>, <span class="hljs-comment">// g 0000 0111</span>
		<span class="hljs-number">0x0008</span>, <span class="hljs-comment">// h 0000 1000</span>
		<span class="hljs-number">0x0009</span>, <span class="hljs-comment">// i 0000 1001</span>
		<span class="hljs-number">0x000A</span>, <span class="hljs-comment">// j 0000 1010</span>
		<span class="hljs-number">0x000B</span>, <span class="hljs-comment">// k 0000 1011</span>
		<span class="hljs-number">0x000C</span>, <span class="hljs-comment">// l 0000 1100</span>
		<span class="hljs-number">0x000D</span>, <span class="hljs-comment">// m 0000 1101</span>
		<span class="hljs-number">0x000E</span>, <span class="hljs-comment">// n 0000 1110</span>
		<span class="hljs-number">0x000F</span>, <span class="hljs-comment">// o 0000 1111</span>
		<span class="hljs-number">0x0010</span>, <span class="hljs-comment">// p 0001 0000</span>
		<span class="hljs-number">0x0011</span>, <span class="hljs-comment">// q 0001 0001</span>
		<span class="hljs-number">0x0012</span>, <span class="hljs-comment">// r 0001 0010</span>
		<span class="hljs-number">0x0013</span>, <span class="hljs-comment">// s 0001 0011</span>
		<span class="hljs-number">0x0014</span>, <span class="hljs-comment">// t 0001 0100</span>
		<span class="hljs-number">0x0015</span>, <span class="hljs-comment">// u 0001 0101</span>
		<span class="hljs-number">0x0016</span>, <span class="hljs-comment">// v 0001 0110</span>
		<span class="hljs-number">0x0017</span>, <span class="hljs-comment">// w 0001 0111</span>
		<span class="hljs-number">0x0018</span>, <span class="hljs-comment">// x 0001 1000</span>
		<span class="hljs-number">0x0019</span>, <span class="hljs-comment">// y 0001 1001</span>
		<span class="hljs-number">0x001A</span>  <span class="hljs-comment">// z 0001 1010</span>
};
	
	<span class="hljs-comment">// 准备好要输出的字符串</span>
	<span class="hljs-type">char</span> str[] = <span class="hljs-string">"hello world and world peace"</span>;
	
	<span class="hljs-comment">// 后三个灯全亮表示开始</span>
	GPIO_Write(GPIOA, ~<span class="hljs-number">0x00E0</span>);
	Delay_ms(<span class="hljs-number">2000</span>);
	
	<span class="hljs-comment">// 遍历的方式用前5个LED灯逐个输出字符</span>
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; str[i] != <span class="hljs-string">'\0'</span>; i++)
	{
		<span class="hljs-type">char</span> c = str[i];
		
		<span class="hljs-comment">// 用空格来标记单词的结束，配合尾灯特效</span>
		<span class="hljs-keyword">if</span>(c == <span class="hljs-string">' '</span>) 
		{
			GPIO_Write(GPIOA, ~<span class="hljs-number">0x0020</span>);
			Delay_ms(<span class="hljs-number">500</span>);
			GPIO_Write(GPIOA, ~<span class="hljs-number">0x0040</span>);
			Delay_ms(<span class="hljs-number">500</span>);
			GPIO_Write(GPIOA, ~<span class="hljs-number">0x0080</span>);
			Delay_ms(<span class="hljs-number">500</span>);
		}
		<span class="hljs-keyword">else</span> 
		{
			<span class="hljs-type">int</span> num = c - <span class="hljs-string">'a'</span>;
			<span class="hljs-type">uint16_t</span> code = letter_table[num];
			GPIO_Write(GPIOA, ~code);
			Delay_ms(<span class="hljs-number">1000</span>);
		
			<span class="hljs-comment">// 全暗表示一个字符输出结束</span>
			GPIO_Write(GPIOA, <span class="hljs-number">0xFFFF</span>);
			Delay_ms(<span class="hljs-number">500</span>);
		}
		
	}
	
	<span class="hljs-comment">// 后三个灯第二次全亮表示结束</span>
	GPIO_Write(GPIOA, ~<span class="hljs-number">0x00E0</span>);
	Delay_ms(<span class="hljs-number">2000</span>);
	
	GPIO_Write(GPIOA, <span class="hljs-number">0xFFFF</span>);
		
	<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)
	{
		
	}
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入揭秘 Linux 虚拟文件系统 VFS （下）]]></title>    <link>https://juejin.cn/post/7600426046425907235</link>    <guid>https://juejin.cn/post/7600426046425907235</guid>    <pubDate>2026-01-29T12:20:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600426046425907235" data-draft-id="7600588379105787956" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 深入揭秘 Linux 虚拟文件系统 VFS （下）"/> <meta itemprop="keywords" content="Linux,面试"/> <meta itemprop="datePublished" content="2026-01-29T12:20:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             深入揭秘 Linux 虚拟文件系统 VFS （下）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:20:57.000Z" title="Thu Jan 29 2026 12:20:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前言</h2>
<p>上一篇文章我们逐个学习了 VFS 的四大核心对象，那么本篇文章我们将更加深入内核，深度拆解这些对象是如何通过路径查找、接口多态来协作完成一次真实的文件操作的。</p>
<p>我们话不多说，直接进入正题。</p>
<h2 data-id="heading-1">2. 路径查找</h2>
<p>我们在写代码时，通常像下面这样打开一个文件：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> fd = open(<span class="hljs-string">"/home/user/a.txt"</span>, O_RDONLY);
</code></pre>
<p>这里使用的路径是绝对路径，也可以使用相对路径。</p>
<p>对于用户程序来说，我们只是提供了一个冷冰冰的<strong>字符串</strong>路径，但是对于内核来说，它只认识 <strong>Inode</strong>。</p>
<p>那么，内核究竟是如何把这个字符串 <code>/home/user/a.txt</code>，一步步转换成内存中具体的 <code>struct inode</code> 的？其实这个过程在 Linux 内核中被称为 <strong>Path Walking（路径查找）</strong> 。</p>
<p>具有一定编程思维的人可能在阅读内核源码之前就已经有思路了：只需要把字符串按 <code>/</code> 切分，一级一级找不就行了。</p>
<p>这个思路其实很简单，逻辑上也确实是这样的。但在工程实现上，为了保证极致的性能和功能的灵活性，就不能每切分一级目录就去读一次磁盘，还要做好对挂载点的处理，因此 Linux 在这里设计了极其精妙的机制。</p>
<h3 data-id="heading-2">2.1 目录项缓存 Dcache</h3>
<p>如果真的像最原始的逻辑那样，每查找一级目录，都要去读一次物理磁盘，那么 Linux 的 I/O 性能将慢得令人崩溃。</p>
<p>我们按照这个原始逻辑感受一下，查找 <code>/usr/bin/vim</code> 这个路径：</p>
<ol>
<li>读取根目录 <code>/</code> 的 Inode，这是磁盘 IO。然后解析数据块，再找到 <code>usr</code> 的位置。</li>
<li>读取 <code>usr</code> 的 Inode，这是磁盘 IO。然后解析数据块，找到 <code>bin</code> 的位置。</li>
<li>读取 <code>bin</code> 的 Inode，这是磁盘 IO。解析数据块，最后找到 <code>vim</code> 的位置。</li>
</ol>
<p>每一次磁盘 IO 都是毫秒级的开销，为了避免这种耗时的操作，VFS 引入了 <strong>Dcache (Dentry Cache)</strong> 。</p>
<p>还记得我们上篇文章讲的<code>struct dentry</code>吗？它不仅仅代表路径，在内存中它还是一个<strong>哈希表节点</strong>。</p>
<p>当内核开始解析路径时，它的第一反应绝不是读磁盘，而是查内存：<strong>看看 Dcache 里有没有缓存过 usr 这个目录项？</strong></p>
<p>如果 <strong>Cache Hit（缓存命中）</strong> ：直接拿到 <code>dentry</code>，不需要读盘，<strong>纳秒级</strong>完成。</p>
<p>如果 <strong>Cache Miss（缓存未命中）</strong> ：就调用具体文件系统的 <code>lookup</code> 接口，去磁盘读取元数据，构建一个新的 <code>dentry</code> 放入缓存，以便下次高效查找。</p>
<p>这里讲一个冷知识：Linux 系统中 90% 以上的空闲内存往往都被 Page Cache 和 Dcache 占据。当你发现系统内存占用很高但运行流畅时，通常就是它们在替你加速。</p>
<h3 data-id="heading-3">2.2 路径解析的详细流程</h3>
<p>让我们模拟一下内核解析 <code>/home/user/a.txt</code> 的全过程。虽然内核源码中负责此工作的 <code>filename_lookup</code> 函数非常复杂，但逻辑上我们分析个大概还是没有什么难度的。</p>
<ol>
<li>
<p><strong>确定起点</strong></p>
<p>内核首先要判断从用户层接收到的字符串路径到底是<strong>绝对路径</strong>还是<strong>相对路径</strong>。这就是前面提到的<code>open</code>中不论填绝对路径还是相对路径都可以，内核中已经把判断的逻辑写好了。</p>
<p>如果字符串以<code>/</code>开头，那就说明是绝对路径，从 <code>current-&gt;fs-&gt;root</code>开始走。</p>
<p>如果字符串不以 / 开头，那就说明是相对路径，从<code>current-&gt;fs-&gt;pwd</code>开始走。</p>
<p>本例中，我们是绝对路径，从根目录 <code>/</code> 出发。 这里补充一点：可能有不少人知道<code>current-&gt;fs-&gt;root</code>大致是什么意思，但疑惑它到底是个什么，这部分内容将会放在本章小结中为大家解释。</p>
</li>
<li>
<p><strong>逐级解析路径</strong> 内核会将路径字符串拆解为三个分量，即 <code>home</code>、<code>user</code>、<code>a.txt</code>，然后开始一个循环。</p>
<p>第一步：拿根目录的 <code>dentry</code> 和字符串 <code>"home"</code> 计算哈希值，在 Dcache 中查找。如果没找到，就让 EXT4 去磁盘把 <code>home</code> 目录读出来，生成一个 <code>dentry</code> 放在内存里。此外还会检查该进程有没有权限访问<code>home</code>目录。 第二步：拿着刚才找到的 <code>home</code> 的 <code>dentry</code>，在下面查找 <code>"user"</code>，查找步骤与第一步相同。 第三步：同理，可以查找到<code>"a.txt"</code>。最终找到了目标文件的 <code>dentry</code> 和对应的 <code>inode</code>。</p>
</li>
<li>
<p><strong>穿越挂载点</strong></p>
<p>这可以说是路径查找中最让人摸不着头脑的地方。 假设你的系统里挂载了一个 U 盘，挂载点是 <code>/mnt/usb</code>。当你访问路径 <code>/mnt/usb/photo.jpg</code> 时，内核在解析到 <code>usb</code> 这一层时，会发现<code>usb</code> 这个目录项被打上了一个特殊的标记——<strong><code>DCACHE_MOUNTED</code></strong>。 这时 VFS 会意识到：<strong>这里虽然叫 usb，以及虽然是从 /mnt 走过来的，但它已经不是原来的那个目录了，它是另一个文件系统的入口</strong>。</p>
<p>此时，内核会根据挂载记录，<strong>自动跳转</strong>到对应文件系统的<strong>根目录 Dentry</strong> 上。</p>
</li>
</ol>
<p>这些操作对用户是完全透明的，用户根本感觉不到自己已经跨越了文件系统的边界，从一个文件系统的地盘跳到了另一个文件系统的地盘。这就是 VFS 屏蔽底层差异的核心手段之一。</p>
<h3 data-id="heading-4">2.3 路径查找进入尾声</h3>
<p>截至现在，VFS 终于找到了 <code>a.txt</code> 对应的 <code>struct inode</code>。</p>
<p>但 <code>open()</code> 系统调用返回给用户的，却是一个简单的整数 <code>fd</code>。虽然大家都知道这就是文件描述符，但我还是想讲一下它到底是怎么来的？</p>
<p>内核在创建 <strong>File 对象</strong>时，会分配一个全新的 <code>struct file</code>，将 <code>f_path.dentry</code> 指向刚才找到的 <code>dentry</code>，将 <code>f_path.mnt</code> 指向对应的挂载点，再初始化 <code>f_pos</code> 为 0。</p>
<p>然后在当前进程的文件描述符表<code>fd_array</code>中，找一个最小的空闲下标，作为文件描述符<code>fd</code>。</p>
<p>接着建立文件描述符表中相应位置与<code>struct file</code>指针的关系：</p>
<pre><code class="hljs language-arduino" lang="arduino">fd_array[fd] = 这个新的 <span class="hljs-keyword">struct</span> file 指针
</code></pre>
<p>最后将<code>fd</code>返回给用户。</p>
<p>正因为 <code>open</code> 做了繁重的路径查找工作，并建立好了 <code>fd</code> 到 <code>struct file</code> 的映射，所以后续的 <code>read</code> 操作才能极其高效。内核直接通过 <code>fd</code> 就能拿到 <code>file</code> 和 <code>inode</code>，再也不用去解析那长长的字符串路径了。</p>
<h3 data-id="heading-5">2.4 小结</h3>
<p>下面我们来讲一下<code>current-&gt;fs-&gt;root</code>到底在干什么。</p>
<p><code>current</code>是内核中最重要的宏之一，它始终指向<strong>当前正在 CPU 上运行的那个进程</strong>的进程控制块（<code>struct task_struct</code>）。</p>
<p><code>fs</code>是<code>struct task_struct</code>中的一个成员<code>struct fs_struct</code>，专门用来存储<strong>该进程与文件系统相关的上下文信息</strong>。它记录了根目录在哪、当前工作目录在哪。</p>
<p><code>root</code>指向了该进程认为的根目录的<code>dentry</code>。</p>
<p><code>pwd</code>指向了该进程认为的当前工作目录的<code>dentry</code>。</p>
<p>根目录作为一个所有进程都可能访问的目录，为什么要放在进程里面，而不是作为一个全局变量呢？</p>
<p>实际上，通常情况下所有进程的 <code>root</code> 都指向真正的系统根目录 <code>/</code>。但是，Linux 允许我们修改这个指向，这就是 <strong>chroot 命令</strong> 以及现代 <strong>容器技术（Docker）</strong> 的核心原理。</p>
<ol>
<li><strong>对于宿主机进程</strong>：<code>current-&gt;fs-&gt;root</code> 指向真正的磁盘根目录 <code>/</code>。</li>
<li><strong>对于 Docker 容器内的进程</strong>：内核把它的 <code>current-&gt;fs-&gt;root</code> 修改指向了宿主机上的某个子目录，作为 Docker 内进程的根目录。</li>
</ol>
<p>结果当容器内的进程去访问 <code>/etc/passwd</code> 时，内核从它的 <code>fs-&gt;root</code> 开始找，实际上找到的是宿主机那个子目录下的文件。容器进程就像被关在了一个小黑屋里，它以为自己看到了全世界（根目录），其实它看到的只是宿主机的一个角落，也就是我们想让它看到的东西。</p>
<h2 data-id="heading-6">3. 接口与多态</h2>
<p>VFS 作为一个抽象层，它自己是<strong>不存储数据</strong>的。它不知道数据是在磁盘的第几个扇区，也不知道网卡收到了什么包。真正干活的，是底层的 EXT4，FAT32 或者 TCP/IP 协议栈。</p>
<p>而 VFS 在这个过程中要做的就只有<strong>标准化接口</strong>。</p>
<p>用面向对象的语言来说，这叫做<strong>多态</strong>。但 C 语言没有 <code>interface</code> 关键字，Linux 内核的大佬们就用<strong>函数指针</strong>手搓了一套多态机制。</p>
<h3 data-id="heading-7">3.1 三个操作集</h3>
<p>这三个操作集结构体的内容都是比较多的，我就不放源码了，下文中只介绍关键成员，想看完整内核源码可以去源码目录<code>/include/linux/fs.h</code>中找，三个结构体连着定义的，很好找。</p>
<h4 data-id="heading-8">3.1.1 文件内容操作</h4>
<p>文件内容操作<code>struct file_operations</code>：这是平时写应用程序时最常用的接口，它定义了<strong>对打开的文件内容</strong>可以做哪些操作。</p>
<p>该结构体的核心成员包括：<code>read</code>读文件内容，<code>write</code>写文件内容，<code>mmap</code>内存映射，<code>open</code>打开，<code>release</code>关闭。</p>
<p>下面具体描述一下：</p>
<p>如果我们要读的是 EXT4 文件，就将<code>read</code>对应的函数指针初始化为 <code>ext4_file_read_iter</code>，而<code>ext4_file_read_iter</code>的实现并不属于 VFS 的管理范畴，它是 EXT4 文件系统底层需要完成的。</p>
<p>如果是 Socket 套接字，函数指针就初始化为 <code>sock_read_iter</code>。</p>
<p>这就是将操作与相应函数对应起来的方法。</p>
<h4 data-id="heading-9">3.1.2 元数据操作</h4>
<p><code>struct inode_operations</code>这组接口关注的是文件<strong>本身</strong>或者说是目录项的操作，而不是文件里面的内容。</p>
<p>核心成员有：<code>create</code>创建新文件，<code>mkdir</code>创建目录，<code>lookup</code>在目录中查找文件，<code>setattr</code>修改权限和时间戳。</p>
<p>这里 <strong>file_op 和 inode_op</strong> 一定要区分开，有些操作是不需要打开文件就可以执行的。比如 <code>mkdir</code>，你不需要打开一个目录就能创建它。比如 <code>rm</code> (调用 <code>unlink</code>)，你删除文件时也不需要先 <code>open</code> 它。这些操作针对的是 Inode（文件实体）而非 File（句柄）。</p>
<h4 data-id="heading-10">3.1.3 文件系统整体操作</h4>
<p><code>struct super_operations</code>管理的是<strong>整个文件系统</strong>的生命周期。</p>
<p>核心成员：</p>
<ol>
<li><code>alloc_inode</code>: 为这个文件系统分配一个 <code>inode</code>。</li>
<li><code>write_inode</code>: 把内存里的 <code>inode</code> 刷回磁盘。</li>
<li><code>sync_fs</code>: 把所有脏数据刷盘。</li>
</ol>
<h3 data-id="heading-11">3.2 具体场景演示</h3>
<p>下面让我们看看当用户执行 <code>read</code> 时，内核里发生了什么？</p>
<p>在 VFS 层（源码目录<code>fs/read_write.c</code>），代码逻辑非常简洁，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e04967ec9884be78f3c06beb2b711b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=YXK81v1S1g%2BHAvRX6%2BhRIgtdseo%3D" alt="1. read源码.png" loading="lazy"/></p>
<p>核心逻辑我们从第 493 行开始看，VFS 层直接调用函数指针，根本不关心它是 EXT4 文件系统还是 FAT32 文件系统。为什么可以这样做呢？</p>
<p>实际上，当 EXT4 文件创建时，内核把 <code>inode-&gt;i_fop</code> 指向了全局变量 <code>ext4_file_operations</code>，一个具体文件打开时，<code>struct file</code>出现了，<code>file-&gt;f_op</code>会继承 <code>inode-&gt;i_fop</code>，然后<code>vfs_read</code> 调用 <code>file-&gt;f_op-&gt;read</code>，实际上执行的是 <code>ext4_file_read_iter</code>。这就是 VFS 层调用再通向某个文件系统具体调用的过程。下面我们来看看这个过程在内核源码中的体现。</p>
<p>当 EXT4 从磁盘读出一个 Inode 时。如果发现这个 Inode 是个普通文件<code>S_ISREG</code>，就把 <code>ext4_file_operations</code> 挂上去，这样以后对它的 <code>read</code> 就会调用 EXT4 的读函数。如果发现它是个目录<code>S_ISDIR</code>，就把 <code>ext4_dir_operations</code> 挂上去，这样对它的 <code>read</code>就会去读取目录项列表。这个过程在函数<code>__ext4_iget</code>中实现，该函数位于内核源码<code>/fs/ext4/inode.c</code>中，这个函数有好几百行，我只截取了重要的几行，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82ebba3acaaf44c3b1c50d5713e8fe94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=GEB8MvqIIER3P5UUcZKVW9GdgPY%3D" alt="2. ext4_iget函数.png" loading="lazy"/>
两个操作集的实现在<code>/fs/ext4/file.c</code>中，如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a44e21303ed4ecc93fa90ca4fdc2ec4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=R%2FgfNICj%2BiCUOPJM0cK0pg6IAR8%3D" alt="3. ext4操作集.png" loading="lazy"/></p>
<p>就是在这里完成 VFS 层的读操作到EXT4文件系统读函数的映射的。</p>
<p>到此，我们已经把用户层调用<code>read</code>到具体的文件系统执行相关读函数这条线捋清了。</p>
<h2 data-id="heading-12">4. 全链路追踪一个read请求</h2>
<p>假设应用程序执行了这样一行简单的代码：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">ssize_t</span> n = read(<span class="hljs-number">3</span>, buf, <span class="hljs-number">4096</span>);
</code></pre>
<p>这是一个极其普通的调用，但在 Linux 内核的微观世界里，却相当复杂。</p>
<p>让我们结合内核源码，一行行追踪数据的流向。</p>
<h3 data-id="heading-13">4.1 系统调用入口</h3>
<p>当用户程序执行 <code>read</code> 时，CPU 发生模式切换，通过系统调用表跳转到内核入口。在 Linux 源码中，系统调用的定义通常使用 <code>SYSCALL_DEFINE</code> 宏。</p>
<p>源码位于<code>fs/read_write.c</code>中，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72c5f2abefc345f08769016542bb1d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=IvihhaROD3LVkrVYWN%2B0sn5tu3I%3D" alt="4. 系统调用入口（1）.png" loading="lazy"/></p>
<p>宏展开后就是 <code>sys_read</code> 函数，调用 <code>ksys_read</code>，这是内核内部的通用入口。</p>
<p>在<code>ksys_read</code>内部，根据用户传入的 <code>fd</code> 获取 <code>struct file</code> 指针，其实<code>fdget_pos</code> 就是去当前进程的 <code>files_struct</code>文件描述符表里查，把整数 <code>fd</code>变成了 <code>struct file *</code> 指针。第 629 行获取当前文件的读取位置。第 634 行进入 VFS 的通用读取逻辑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7047f51a5e5c43159067b5f6a36a9606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=dFzgwqFPrLYWOS4pI006pXQKd9U%3D" alt="5. ksys_read.png" loading="lazy"/></p>
<p>到此，我们已经踏入 VFS 的大门了。</p>
<h3 data-id="heading-14">4.2 VFS 分发</h3>
<p><code>vfs_read</code> 可以理解为一个具有分发功能的函数，它不负责具体的读写，只负责<strong>路由分发</strong>。它要根据文件系统的实现情况，决定调用哪个函数。源码位置：<code>fs/read_write.c</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/724b73c085ae40ce8cdd11c20a5686cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=9Pc%2BwHThLACN0KYJ%2BLmc6e8cN%2Fg%3D" alt="6. vfs_read.png" loading="lazy"/></p>
<p>前面都是一些权限检查之类的操作，核心逻辑从 493 行开始。</p>
<p>第 493 行可以看到，VFS 会优先调用 <code>read</code>，没有<code>read</code>则调用 <code>read_iter</code>，区别在于<code>read_iter</code>比较现代，EXT4，XFS 等现代文件系统都在这里。</p>
<p>这里体现了 C 语言的多态。EXT4 没有实现 <code>.read</code>，而是实现了 <code>.read_iter</code>，所以逻辑会走到 <code>new_sync_read</code>。</p>
<p>该函数实现如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c33d0846ff14536a3ac0f528c38d247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=bAW2ep%2BqkfG7v2zxoa28oxeuBtw%3D" alt="7. new_read.png" loading="lazy"/></p>
<p>可以看到它最终调用了<code>call_read_iter</code>，它位于<code>include/linux/fs.h</code>，我们继续跳转：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d2ae8b4014c4ef3b566fc2089b90ebd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=nDKJ%2B%2Fdst0qZlK6yOANVLYGUH1E%3D" alt="8. call_read_iter.png" loading="lazy"/></p>
<p>到这里是不是有点熟悉的感觉。继续：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8f83e9fa0904d038fdf189dde011167~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=J0fUKbX4ebffcdN4bGtAFZ4fqTU%3D" alt="9. op.png" loading="lazy"/></p>
<p>不管是<code>read</code>还是<code>read_iter</code>，兜兜转转都是来到了这里。</p>
<p>下一步我们将会离开 VFS，进入 EXT4 的领地。</p>
<h3 data-id="heading-15">4.3 进入EXT4</h3>
<p>经过 VFS 的分发，控制权终于来到了具体的文件系统手中。源码位置<code>fs/ext4/file.c</code>。</p>
<p>我们来看看这个函数的具体实现：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcf00f850c134b8abf8dbd280146a979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=gs6ZiWyKanM60rskj1vqxAFkg9I%3D" alt="10. ext4_read.png" loading="lazy"/></p>
<p>这个函数最后又调用了<code>generic_file_read_iter</code>函数，EXT4 最终又把脏活累活都外包给了 Linux 的<strong>内存管理子系统</strong>。</p>
<p>这其实正是 Linux 设计精妙之处，对于基于磁盘的文件系统，读取逻辑高度相似，<strong>都是查 Page Cache，没有就读盘</strong>，所以内核在 <code>mm</code>内存管理子系统里提供了一套通用的标准实现。</p>
<h3 data-id="heading-16">4.4 页缓存 Page Cache</h3>
<p>这是 IO 性能的关键点，<code>generic_file_read_iter</code> 会去查询页缓存，该函数的实现位于<code>mm/filemap.c</code>。该函数依然只贴出关键部分的截图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eece88f56b3462b81b44d2d24845f1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=DRFm1bPrXfUoig4hmhbsb4AonHc%3D" alt="11. read_iter.png" loading="lazy"/></p>
<p>第 2525 行到第 2535 行是 Direct I/O 的执行逻辑，如果用户在 <code>open</code> 时加了 <code>O_DIRECT</code> 标志，<code>iocb-&gt;ki_flags</code> 就会有 <code>IOCB_DIRECT</code>，这样会绕过 Page Cache，直接调用文件系统的 <code>direct_IO</code> 接口。如果在这里读取成功，或者读完了，就直接在<code>goto out</code>，不走下面的缓存逻辑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7723896603e44e27b428c89c69d6481a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=9ouO1csjtG3WCOQQJLbkvMHSJ6Y%3D" alt="12. 非direct.png" loading="lazy"/></p>
<p>其实绝大多数都是走查缓存逻辑的，代码会执行 2560 行的<code>generic_file_buffered_read</code>。</p>
<p>这个函数极长，好几百行，这里就不贴代码了，这么多代码主要做了两件事。第一件是<strong>查缓存</strong>，去找有没有现成的页。第二件事是<strong>预读</strong>，如果没有现成的页，它不仅会把当前需要的页读进来，还会把后面几页也顺便读进来，以提高性能。</p>
<h3 data-id="heading-17">4.5 查找物理块</h3>
<p>当内存子系统决定要从磁盘读数据时，它会问 EXT4 文件的第 0 页对应磁盘的哪个块。</p>
<p>该部分源码位置<code>fs/ext4/inode.c</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47b92779538e4df0afd415a34ac01c19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770294059&amp;x-signature=KbnLOO6RBGoxlD0r3wT6oRjbDdM%3D" alt="13. 读盘.png" loading="lazy"/></p>
<p>将逻辑偏移量转换为物理扇区号，最终<code>map-&gt;m_pblk</code> 存储了物理磁盘块号。</p>
<p>拿到了物理块号，内核将其封装成一个 <code>struct bio</code> (Block IO) 请求，提交给通用块层。</p>
<p><code>submit_bio</code> 会将请求放入<strong>电梯调度队列</strong>，最终由 NVMe 或 SATA 驱动通过 DMA 将数据搬运到内存。</p>
<h3 data-id="heading-18">4.6 小结</h3>
<p>看到这里，你应该明白了，<strong>Linux 的 VFS 不仅仅是一层接口，它更像是一套精密的流水线。</strong> 上层的 <code>read_write.c</code> 负责接待，中层的 <code>filemap.c</code> 负责缓存加速，底层的 <code>ext4</code> 负责物理寻址，分工很明确。</p>
<h2 data-id="heading-19">5. 总结</h2>
<p>至此，我们完成了对 Linux VFS 的拆解。</p>
<p>无论底层是 EXT4、FAT32 还是网络 NFS，VFS 都把它们伪装成统一的 <code>struct file</code> 和 <code>struct inode</code>。使得应用开发变的如此简单。</p>
<p>Linux 内核用最古老的 C 语言，通过结构体和函数指针，实现了最极致的<strong>多态</strong>与<strong>抽象</strong>，Linux 内核本身就是一本教科书。</p>
<p>希望通过这个系列文章，当你下次敲下 <code>open()</code> 或 <code>read()</code> 时，脑海中不再只是枯燥的 API 和记不完的参数，而是能浮现出那张巨大的关系图：从 <code>fd</code> 到 <code>dentry</code>，从 <code>inode</code> 到驱动，真真切切地感受内核中的数据漂流。</p>
<p>本文完。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[godot-rust（gdext）你的第一个2D游戏 - 4]]></title>    <link>https://juejin.cn/post/7600587732992229418</link>    <guid>https://juejin.cn/post/7600587732992229418</guid>    <pubDate>2026-01-29T13:12:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732992229418" data-draft-id="7600469605476089898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="godot-rust（gdext）你的第一个2D游戏 - 4"/> <meta itemprop="keywords" content="游戏"/> <meta itemprop="datePublished" content="2026-01-29T13:12:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柚要做甚码"/> <meta itemprop="url" content="https://juejin.cn/user/2200546203156138"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            godot-rust（gdext）你的第一个2D游戏 - 4
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200546203156138/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柚要做甚码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T13:12:08.000Z" title="Thu Jan 29 2026 13:12:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简介</h2>
<p>本文以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a>为蓝本撰写，godot-rust提供了该教程的一个rust的实现<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">dodge-the-creeps</a>，与本文方法会稍有不同。如果你对rust、godot等内容比较生疏或感到疑惑，可以先阅读<a href="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" title="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" target="_blank">godot-rust入门文档</a>。</p>
<p>本文搭建在<a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目</a>的基础之上，如果你对该部分内容感到生疏，可以先阅读这部分内容，为接下来的操作做好准备。</p>
<p><strong>注意，本文使用的godot版本为4.5.1，godot版本的变化可能会导致一些内容失效</strong>。</p>
<p>本文操作均在Windows上执行。</p>
<h2 data-id="heading-1">正文</h2>
<h3 data-id="heading-2">创建敌人场景</h3>
<p>如你在创建<code>Player</code>时所做的工作一样，在rust中创建<code>Mob</code>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[derive(GodotClass)]</span>
<span class="hljs-meta">#[class(base=RigidBody2D)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Mob</span> {
    base: Base&lt;RigidBody2D&gt;,
}
<span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">IRigidBody2D</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Mob</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init</span>(base: Base&lt;RigidBody2D&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { base }
    }
}
</code></pre>
<p>编译rust</p>
<pre><code class="hljs">cargo build
</code></pre>
<p>回到godot编辑器，在左上角点击<strong>场景</strong>-&gt;<strong>新建场景</strong>-&gt;<strong>其他节点</strong>，创建<code>Mob</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/046ec1c3e7004de495b4bdded7301e2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=PTDJfVL%2FcVDPjmtQjYtRQhLmnkI%3D" alt="创建Mob" loading="lazy"/></p>
<p>为<code>Mob</code>添加以下子节点:</p>
<ul>
<li><code>AnimatedSprite2D</code></li>
<li><code>CollisionShape2D</code></li>
<li><code>VisibleOnScreenNotifier2D</code></li>
</ul>
<p>同样将Mob<strong>编组</strong>，这时你的<code>Mob</code>节点看上去应该像这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9979437cfec4482fa3219da1c1abfd82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=K8yIgH2VqDGuDHhybRuLBHPDHng%3D" alt="Mob和子节点" loading="lazy"/></p>
<p>选中<code>Mob</code>节点，在检查器的<code>RigidBody2D</code>面板中把<code>Gravity Scale</code>设置为<code>0</code>，这样可以防止怪物自由落体。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a9cde415eb44865820e5e4d4ea7d0e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=6o6uKJ4nvcizWnuuWpuOvopAlEw%3D" alt="修改Mob的Gravity Scale" loading="lazy"/></p>
<p>在<code>RigidBody2D</code>下方的<code>CollisionObject2D</code>面板中，展开<code>Collision</code>分组并取消选中<code>Mask</code>属性里的<code>1</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70a423060aee4fd99c66c61ca3fba2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=SSt%2FxwuWq2fw5%2FqjnaQQ3neAL7M%3D" alt="确保Mob之前不会碰撞" loading="lazy"/></p>
<blockquote>
<p>这将确保怪物们不会相互碰撞。</p>
</blockquote>
<p><em>原文中这句话中文翻译有歧义，通常我们会理解成字面意思，即怪物之间不会发生碰撞。但通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Ftutorials%2Fphysics%2Fphysics_introduction.html%23collision-layers-and-masks" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/tutorials/physics/physics_introduction.html#collision-layers-and-masks" ref="nofollow noopener noreferrer">手册物理介绍</a>条目可知，取消遮罩层<code>1</code>是<code>Mob</code>忽略<code>Layer 1</code>中任何碰撞检测，推测这是优化设置，但<strong>注意<code>Mob</code>自己依然在<code>Layer 1</code></strong></em></p>
<p>选中<code>AnimatedSprite2D</code>子节点，和之前一样操作设置三个动画，<code>fly</code>、<code>swim</code>、<code>walk</code>，将三个动画的对应动画速度值都调整为<code>3 FPS</code>，从文件夹<strong>art</strong>中拖动对应的图片：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad69f7fdde48415faf6cb57c541841de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=xGSjLCAqjukcozY3GXpn2%2FIB0nQ%3D" alt="fly动画" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf56ffbd27b4303b1b510b94c3ceb6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=cB2uUFHlvuOuBJSCvx51WbA9yC0%3D" alt="swim动画" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f839020779a4d35b6e7290cfa6e0f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=Czrvug0m%2FnnjrDj6coNvEXd%2FzyY%3D" alt="walk动画" loading="lazy"/></p>
<p>然后将<code>AnimatedSprite2D</code>的<code>Scale</code>属性设为<code>x = 0.75, y = 0.75</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21880db28d974bef9e2cd1020e9aa302~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=sHIGzyyhPpck9SwksD2fVTDOGeA%3D" alt="调整AnimatedSprite2D的Scale" loading="lazy"/></p>
<p>像在<code>Player</code>一样，选中<code>CollisionShape2D</code>，为其添加一个<code>CapsuleShape2D</code>，并在<strong>Transform</strong>-&gt;<strong>Rotation</strong>为<code>90</code>。由于三个动画大小不一，我们折中调整碰撞形状大小。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ab1f968aab4878803ef8a83f99e91e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=wzJJJZFm9FITo%2BXTHRP9sMbuwTI%3D" alt="调整CapsuleShape2D的Rotation" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/812a3127e7c34143a6b6ace2cfbc9754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=BXhqE%2FINyg3PCfPqEFrreFygtVo%3D" alt="调增CapsuleShape2D的碰撞形状" loading="lazy"/></p>
<p>保存<code>Mob</code>场景，这时你的<strong>文件系统</strong>面板中应该像这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b123eeca48bf46f68fb7ef4dad243686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=DtJ07Ib75U91fiYobiigMG33mRQ%3D" alt="保存Mob" loading="lazy"/></p>
<h3 data-id="heading-3">编写敌人代码</h3>
<p>原文的<code>gdscript</code>代码是这样的：</p>
<pre><code class="hljs language-gdscript" lang="gdscript">func _ready():
    var mob_types = Array($AnimatedSprite2D.sprite_frames.get_animation_names())
    $AnimatedSprite2D.animation = mob_types.pick_random()
    $AnimatedSprite2D.play()
</code></pre>
<p>这段代码的逻辑是，从<code>AnimatedSprite2D</code>中获取全部动画名称，随机选择一个动画并播放。但rust中获得的<code>mob_types</code>数据结构中并没有<code>pick_random()</code>这个方法。在godot-rust给出的demo中使用了这样的代码：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">sprite</span> = <span class="hljs-keyword">self</span>
    .<span class="hljs-title function_ invoke__">base</span>()
    .get_node_as::&lt;AnimatedSprite2D&gt;(<span class="hljs-string">"AnimatedSprite2D"</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">anim_names</span> = sprite.<span class="hljs-title function_ invoke__">get_sprite_frames</span>().<span class="hljs-title function_ invoke__">unwrap</span>().<span class="hljs-title function_ invoke__">get_animation_names</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">anim_names</span> = anim_names.<span class="hljs-title function_ invoke__">to_typed_array</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">animation_name</span> = anim_names.<span class="hljs-title function_ invoke__">pick_random</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
</code></pre>
<p>而实际上编译器会在<code>to_typed_array()</code>方法这里报错。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bccd06d07d54852b5a7d20768a6e49a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770297128&amp;x-signature=aCUzMwAciU%2FDd2%2FpN1KvvS6O4xg%3D" alt="代码无效" loading="lazy"/></p>
<p>不着急，我们自己实现一个<code>pick_random()</code>，为rust添加<code>rand crate</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp">cargo <span class="hljs-keyword">add</span> rand
</code></pre>
<p>为godot-rust编写一个trait：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> godot::{builtin::PackedArray, meta::PackedArrayElement};
<span class="hljs-keyword">use</span> rand::Rng;

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">PickRandom</span>&lt;T: PackedArrayElement&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">pick_random</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T;
}
<span class="hljs-keyword">impl</span>&lt;T: PackedArrayElement&gt; PickRandom&lt;T&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">PackedArray</span>&lt;T&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">pick_random</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> T {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">rng</span> = rand::<span class="hljs-title function_ invoke__">rng</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">index</span> = rng.<span class="hljs-title function_ invoke__">random_range</span>(<span class="hljs-number">0</span>..<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">len</span>());

        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">get</span>(index).<span class="hljs-title function_ invoke__">unwrap</span>()
    }
}
</code></pre>
<p>我们的<code>ready()</code>方法就应该是这样:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ready</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">sprite</span> = <span class="hljs-keyword">self</span>
        .<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;AnimatedSprite2D&gt;(<span class="hljs-string">"AnimatedSprite2D"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">random_name</span> = sprite
        .<span class="hljs-title function_ invoke__">get_sprite_frames</span>()
        .<span class="hljs-title function_ invoke__">unwrap</span>()
        .<span class="hljs-title function_ invoke__">get_animation_names</span>()
        .<span class="hljs-title function_ invoke__">pick_random</span>();

    sprite.<span class="hljs-title function_ invoke__">set_animation</span>(random_name.<span class="hljs-title function_ invoke__">arg</span>());
    sprite.<span class="hljs-title function_ invoke__">play</span>();
}
</code></pre>
<p>最后，我们需要在<code>Mob</code>离开屏幕时删除自己，这需要调用<code>VisibleOnScreenNotifier2D</code>节点的<code>screen_exited()</code>信号。我们先写<code>handle</code>。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Mob</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_screen_exited</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base_mut</span>().<span class="hljs-title function_ invoke__">queue_free</span>();
    }
}
</code></pre>
<p>在<code>ready()</code>后面将<strong>信号</strong>和<code>handle</code>连接起来：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ready</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    ......

    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;VisibleOnScreenNotifier2D&gt;(<span class="hljs-string">"VisibleOnScreenNotifier2D"</span>)
        .<span class="hljs-title function_ invoke__">signals</span>()
        .<span class="hljs-title function_ invoke__">screen_exited</span>()
        .<span class="hljs-title function_ invoke__">connect_other</span>(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">Self</span>::on_screen_exited);
}
</code></pre>
<p>敌人场景就创建完了，接下来我们需要一个游戏场景把<code>Player</code>和<code>Mob</code>联系起来。</p>
<h2 data-id="heading-4">参考</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a></li>
<li><a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目 - 掘金</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rs%2Fgodot%2F0.4.5%2Fgodot%2F" target="_blank" title="https://docs.rs/godot/0.4.5/godot/" ref="nofollow noopener noreferrer">godot - Rust</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">demo-projects/dodge-the-creeps at master · godot-rust/demo-projects · GitHub</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flowable工作流：从入门到实战]]></title>    <link>https://juejin.cn/post/7600622206269440010</link>    <guid>https://juejin.cn/post/7600622206269440010</guid>    <pubDate>2026-01-30T01:10:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206269440010" data-draft-id="7600606150732890155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flowable工作流：从入门到实战"/> <meta itemprop="keywords" content="工作流引擎"/> <meta itemprop="datePublished" content="2026-01-30T01:10:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flowable工作流：从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:10:21.000Z" title="Fri Jan 30 2026 01:10:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flowable工作流：从入门到实战</h2>
<h3 data-id="heading-1">一、什么是Flowable</h3>
<p>Flowable是一个开源的轻量级业务流程引擎（BPMN 2.0），它起源于Activiti项目，是Activiti的继任者。Flowable提供了完整的工作流和业务流程管理（BPM）平台，支持流程定义、部署、执行、监控等全生命周期管理。</p>
<h4 data-id="heading-2">1.1 核心特性</h4>
<ul>
<li><strong>BPMN 2.0标准支持</strong>：完全符合BPMN 2.0规范</li>
<li><strong>轻量级</strong>：可嵌入到任何Java应用中</li>
<li><strong>高性能</strong>：支持高并发场景</li>
<li><strong>灵活扩展</strong>：提供丰富的扩展点</li>
<li><strong>云原生</strong>：支持微服务架构</li>
</ul>
<h4 data-id="heading-3">1.2 核心组件</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3311a7a20cf6442b94326a9b3ce2b7a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=VCt%2F22i6HOeSLnLRLvIH8LUDybY%3D" alt="" loading="lazy"/></p>
<p>Flowable主要由以下核心组件构成：</p>
<ul>
<li><strong>Flowable Engine</strong>：核心流程引擎</li>
<li><strong>Flowable Modeler</strong>：流程建模工具</li>
<li><strong>Flowable Task</strong>：任务管理应用</li>
<li><strong>Flowable Admin</strong>：管理监控界面</li>
<li><strong>Flowable REST</strong>：REST API接口</li>
</ul>
<h3 data-id="heading-4">二、核心概念详解</h3>
<h4 data-id="heading-5">2.1 BPMN 2.0基础</h4>
<p>BPMN（Business Process Model and Notation）是业务流程建模与 notation 的标准。BPMN 2.0定义了一套标准的图形符号来表示业务流程。</p>
<h5 data-id="heading-6">基本元素</h5>
<ul>
<li><strong>事件（Event）</strong>：流程中发生的事情，如开始事件、结束事件</li>
<li><strong>活动（Activity）</strong>：流程中的工作单元，如用户任务、服务任务</li>
<li><strong>网关（Gateway）</strong>：控制流程分支，如排他网关、并行网关</li>
<li><strong>连接线（Sequence Flow）</strong>：连接各个元素</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15604c79c6764d2e8122efbc1be76eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=4gXyatOBhMRV5Ex%2BUPQHEvlHXpU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">2.2 流程定义</h4>
<p>流程定义是业务流程的静态描述，使用BPMN XML格式定义。一个典型的请假流程定义如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
             <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"Examples"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"请假流程"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 开始事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"开始"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 员工填写请假单 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"employeeTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"填写请假单"</span>
                  <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${employee}"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 部门经理审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"经理审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 排他网关：根据天数决定是否需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"gateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- HR审批（超过3天需要） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hrTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HR审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"hr"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 结束事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"endEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"结束"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 连接线 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"employeeTask"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"employeeTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"managerTask"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"gateway"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"gateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"hrTask"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${days &gt; 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"gateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"endEvent"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${days &lt;= 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"hrTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"endEvent"</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">2.3 流程实例与执行</h4>
<p>流程实例是流程定义的一次具体执行。一个流程定义可以创建多个流程实例，每个实例有独立的执行状态和变量。</p>
<h3 data-id="heading-9">三、快速入门</h3>
<h4 data-id="heading-10">3.1 环境搭建</h4>
<p>首先创建Maven项目，添加Flowable依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Flowable核心引擎 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flowable<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flowable-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Flowable REST API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flowable<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flowable-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 数据库连接 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.224<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 日志 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">3.2 初始化流程引擎</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowableEngineConfig</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ProcessEngine processEngine;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ProcessEngine <span class="hljs-title function_">getProcessEngine</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (processEngine == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (FlowableEngineConfig.class) {
                <span class="hljs-keyword">if</span> (processEngine == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 配置流程引擎</span>
                    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> ProcessEngineConfiguration
                            .createStandaloneProcessEngineConfiguration();

                    <span class="hljs-comment">// 配置数据库连接</span>
                    configuration.setJdbcDriver(<span class="hljs-string">"org.h2.Driver"</span>);
                    configuration.setJdbcUrl(<span class="hljs-string">"jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1"</span>);
                    configuration.setJdbcUsername(<span class="hljs-string">"sa"</span>);
                    configuration.setJdbcPassword(<span class="hljs-string">""</span>);

                    <span class="hljs-comment">// 自动创建/更新数据库表结构</span>
                    configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);

                    <span class="hljs-comment">// 创建流程引擎</span>
                    processEngine = configuration.buildProcessEngine();
                }
            }
        }
        <span class="hljs-keyword">return</span> processEngine;
    }

    <span class="hljs-comment">// 获取各个服务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RepositoryService <span class="hljs-title function_">getRepositoryService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getRepositoryService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RuntimeService <span class="hljs-title function_">getRuntimeService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getRuntimeService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TaskService <span class="hljs-title function_">getTaskService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getTaskService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HistoryService <span class="hljs-title function_">getHistoryService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getHistoryService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ManagementService <span class="hljs-title function_">getManagementService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getManagementService();
    }
}
</code></pre>
<h4 data-id="heading-12">3.3 部署流程定义</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessDeploymentService</span> {

    <span class="hljs-comment">/**
     * 部署流程定义
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deployProcess</span><span class="hljs-params">(String processName, String resourcePath)</span> {
        <span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> FlowableEngineConfig.getRepositoryService()
                .createDeployment()
                .name(processName)
                .addClasspathResource(resourcePath)
                .deploy();

        System.out.println(<span class="hljs-string">"流程部署成功，部署ID: "</span> + deployment.getId());
        <span class="hljs-keyword">return</span> deployment.getId();
    }

    <span class="hljs-comment">/**
     * 查询已部署的流程列表
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessDefinition&gt; <span class="hljs-title function_">listProcesses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FlowableEngineConfig.getRepositoryService()
                .createProcessDefinitionQuery()
                .orderByProcessDefinitionName()
                .asc()
                .list();
    }
}
</code></pre>
<h4 data-id="heading-13">3.4 启动流程实例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessInstanceService</span> {

    <span class="hljs-comment">/**
     * 启动流程实例
     */</span>
    <span class="hljs-keyword">public</span> ProcessInstance <span class="hljs-title function_">startProcess</span><span class="hljs-params">(String processDefinitionKey, Map&lt;String, Object&gt; variables)</span> {
        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> FlowableEngineConfig.getRuntimeService()
                .startProcessInstanceByKey(processDefinitionKey, variables);

        System.out.println(<span class="hljs-string">"流程实例启动成功，实例ID: "</span> + processInstance.getId());
        System.out.println(<span class="hljs-string">"业务Key: "</span> + processInstance.getBusinessKey());

        <span class="hljs-keyword">return</span> processInstance;
    }

    <span class="hljs-comment">/**
     * 查询运行中的流程实例
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessInstance&gt; <span class="hljs-title function_">listRunningInstances</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FlowableEngineConfig.getRuntimeService()
                .createProcessInstanceQuery()
                .orderByStartTime()
                .desc()
                .list();
    }
}
</code></pre>
<h3 data-id="heading-14">四、核心服务详解</h3>
<p>Flowable通过服务层对外提供功能，主要包括以下服务：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac5929ac76274dec9c565013fda3fceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=8CBrIwwOVEd%2FyU2lwRFlgZPr2Ck%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">4.1 RepositoryService（仓库服务）</h4>
<p>管理流程定义和部署对象：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 部署流程</span>
<span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> repositoryService.createDeployment()
    .name(<span class="hljs-string">"请假流程"</span>)
    .addClasspathResource(<span class="hljs-string">"processes/leave-request.bpmn20.xml"</span>)
    .deploy();

<span class="hljs-comment">// 查询流程定义</span>
<span class="hljs-type">ProcessDefinition</span> <span class="hljs-variable">processDefinition</span> <span class="hljs-operator">=</span> repositoryService
    .createProcessDefinitionQuery()
    .processDefinitionKey(<span class="hljs-string">"leaveRequest"</span>)
    .singleResult();

<span class="hljs-comment">// 挂起/激活流程定义</span>
repositoryService.suspendProcessDefinitionById(processDefinitionId);
repositoryService.activateProcessDefinitionById(processDefinitionId);

<span class="hljs-comment">// 删除流程定义</span>
repositoryService.deleteDeployment(deploymentId, <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-16">4.2 RuntimeService（运行时服务）</h4>
<p>管理流程实例和执行：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 启动流程实例</span>
<span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService
    .startProcessInstanceByKey(<span class="hljs-string">"leaveRequest"</span>, variables);

<span class="hljs-comment">// 设置流程变量</span>
runtimeService.setVariable(processInstanceId, <span class="hljs-string">"days"</span>, <span class="hljs-number">5</span>);
runtimeService.setVariable(processInstanceId, <span class="hljs-string">"reason"</span>, <span class="hljs-string">"休息"</span>);

<span class="hljs-comment">// 获取流程变量</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">days</span> <span class="hljs-operator">=</span> (Integer) runtimeService.getVariable(processInstanceId, <span class="hljs-string">"days"</span>);

<span class="hljs-comment">// 触发流程执行</span>
runtimeService.trigger(executionId);

<span class="hljs-comment">// 挂起/激活流程实例</span>
runtimeService.suspendProcessInstanceById(processInstanceId);
runtimeService.activateProcessInstanceById(processInstanceId);

<span class="hljs-comment">// 删除流程实例</span>
runtimeService.deleteProcessInstance(processInstanceId, <span class="hljs-string">"取消申请"</span>);
</code></pre>
<h4 data-id="heading-17">4.3 TaskService（任务服务）</h4>
<p>管理用户任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询用户的待办任务</span>
List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee(<span class="hljs-string">"zhangsan"</span>)
    .orderByTaskCreateTime()
    .desc()
    .list();

<span class="hljs-comment">// 完成任务</span>
taskService.complete(taskId);

<span class="hljs-comment">// 带变量完成任务</span>
Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
variables.put(<span class="hljs-string">"approved"</span>, <span class="hljs-literal">true</span>);
taskService.complete(taskId, variables);

<span class="hljs-comment">// 认领任务（候选任务）</span>
taskService.claim(taskId, <span class="hljs-string">"lisi"</span>);

<span class="hljs-comment">// 委派任务</span>
taskService.delegateTask(taskId, <span class="hljs-string">"wangwu"</span>);

<span class="hljs-comment">// 设置任务优先级</span>
taskService.setPriority(taskId, <span class="hljs-number">50</span>);
</code></pre>
<h4 data-id="heading-18">4.4 HistoryService（历史服务）</h4>
<p>查询历史数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询已完成的流程实例</span>
List&lt;HistoricProcessInstance&gt; finishedInstances = historyService
    .createHistoricProcessInstanceQuery()
    .finished()
    .orderByProcessInstanceEndTime()
    .desc()
    .list();

<span class="hljs-comment">// 查询历史任务</span>
List&lt;HistoricTaskInstance&gt; historicTasks = historyService
    .createHistoricTaskInstanceQuery()
    .taskAssignee(<span class="hljs-string">"zhangsan"</span>)
    .finished()
    .list();

<span class="hljs-comment">// 查询历史变量</span>
List&lt;HistoricVariableInstance&gt; variables = historyService
    .createHistoricVariableInstanceQuery()
    .processInstanceId(processInstanceId)
    .list();

<span class="hljs-comment">// 查询流程实例历史（按时间线）</span>
List&lt;HistoricActivityInstance&gt; activities = historyService
    .createHistoricActivityInstanceQuery()
    .processInstanceId(processInstanceId)
    .orderByHistoricActivityInstanceStartTime()
    .asc()
    .list();
</code></pre>
<h4 data-id="heading-19">4.5 ManagementService（管理服务）</h4>
<p>执行管理操作：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 获取数据库表信息</span>
<span class="hljs-type">TableMetaData</span> <span class="hljs-variable">tableMetaData</span> <span class="hljs-operator">=</span> managementService
    .getTablesMetaData()
    .get(<span class="hljs-string">"ACT_RU_TASK"</span>);

<span class="hljs-comment">// 执行自定义SQL</span>
List&lt;Map&lt;String, Object&gt;&gt; results = managementService
    .executeCustomSql(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractCustomSqlExecution</span>&lt;CustomQuery, List&lt;Map&lt;String, Object&gt;&gt;&gt;(CustomQuery.class) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">(Configuration configuration)</span> {
                <span class="hljs-comment">// 自定义SQL执行逻辑</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        }
    );

<span class="hljs-comment">// 获取作业列表</span>
List&lt;Job&gt; jobs = managementService.createJobQuery().list();
</code></pre>
<h3 data-id="heading-20">五、实战案例：请假审批系统</h3>
<h4 data-id="heading-21">5.1 业务需求</h4>
<p>实现一个企业内部请假审批系统，支持以下功能：</p>
<ol>
<li>员工提交请假申请</li>
<li>部门经理审批（1-3天直接通过）</li>
<li>HR审批（超过3天需要HR审批）</li>
<li>审批通过/驳回</li>
<li>查询请假记录</li>
</ol>
<h4 data-id="heading-22">5.2 系统架构设计</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc2e5a1e5e58411d87e458289074bf86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=MOQYdYbaqMfA0OKE9XEDVJKkGpE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-23">5.3 流程定义</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
             <span class="hljs-attr">xmlns:flowable</span>=<span class="hljs-string">"http://flowable.org/bpmn"</span>
             <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"Examples"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"请假审批流程"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 开始事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"提交申请"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 员工填写请假单 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"submitLeave"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"填写请假单"</span>
                  <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${initiator}"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>员工填写请假信息，包括请假天数、原因等<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 部门经理审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerApproval"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"经理审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>部门经理审批请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 排他网关：根据审批结果和天数决定流程走向 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approvalGateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 驳回处理 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectHandler"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"处理驳回"</span>
                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.RejectDelegate"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- HR审批（超过3天） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hrApproval"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HR审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"hr"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>HR审批长期请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 通知员工 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"发送通知"</span>
                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.NotifyDelegate"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 结束事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveEnd"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批通过"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectEnd"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批驳回"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 连接线 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow1"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"submitLeave"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow2"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"submitLeave"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"managerApproval"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow3"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"managerApproval"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approvalGateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 驳回 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow4"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == false}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow5"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"rejectHandler"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow6"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectEnd"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 通过但需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow7"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"hrApproval"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == true &amp;&amp; days &gt; 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow8"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"hrApproval"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow9"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 通过且不需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow10"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == true &amp;&amp; days &lt;= 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow11"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">5.4 服务层实现</h4>
<h5 data-id="heading-25">请假服务</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeaveRequestService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TaskService taskService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> HistoryService historyService;

    <span class="hljs-comment">/**
     * 创建请假申请
     */</span>
    <span class="hljs-keyword">public</span> LeaveRequest <span class="hljs-title function_">createLeaveRequest</span><span class="hljs-params">(LeaveRequest request)</span> {
        <span class="hljs-comment">// 设置流程变量</span>
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"initiator"</span>, request.getEmployeeId());
        variables.put(<span class="hljs-string">"days"</span>, request.getDays());
        variables.put(<span class="hljs-string">"reason"</span>, request.getReason());
        variables.put(<span class="hljs-string">"startDate"</span>, request.getStartDate());
        variables.put(<span class="hljs-string">"endDate"</span>, request.getEndDate());

        <span class="hljs-comment">// 启动流程实例</span>
        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService
                .startProcessInstanceByKey(<span class="hljs-string">"leaveRequest"</span>, request.getBusinessKey(), variables);

        <span class="hljs-comment">// 完成填写请假单任务，自动流转到经理审批</span>
        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()
                .processInstanceId(processInstance.getId())
                .taskAssignee(request.getEmployeeId())
                .singleResult();

        <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) {
            taskService.complete(task.getId());
        }

        <span class="hljs-comment">// 保存流程实例ID</span>
        request.setProcessInstanceId(processInstance.getId());
        request.setStatus(<span class="hljs-string">"pending"</span>);

        <span class="hljs-keyword">return</span> request;
    }

    <span class="hljs-comment">/**
     * 经理审批
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">managerApproval</span><span class="hljs-params">(String taskId, <span class="hljs-type">boolean</span> approved, String comment)</span> {
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"approved"</span>, approved);
        variables.put(<span class="hljs-string">"managerComment"</span>, comment);

        <span class="hljs-comment">// 添加审批意见</span>
        taskService.addComment(taskId, <span class="hljs-literal">null</span>, comment);

        <span class="hljs-comment">// 完成任务</span>
        taskService.complete(taskId, variables);
    }

    <span class="hljs-comment">/**
     * HR审批
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hrApproval</span><span class="hljs-params">(String taskId, <span class="hljs-type">boolean</span> approved, String comment)</span> {
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"approved"</span>, approved);
        variables.put(<span class="hljs-string">"hrComment"</span>, comment);

        taskService.addComment(taskId, <span class="hljs-literal">null</span>, comment);
        taskService.complete(taskId, variables);
    }

    <span class="hljs-comment">/**
     * 获取用户的待办任务
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TaskDTO&gt; <span class="hljs-title function_">getMyTasks</span><span class="hljs-params">(String userId)</span> {
        List&lt;Task&gt; tasks = taskService.createTaskQuery()
                .taskAssignee(userId)
                .orderByTaskCreateTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> tasks.stream()
                .map(<span class="hljs-built_in">this</span>::convertToDTO)
                .collect(Collectors.toList());
    }

    <span class="hljs-comment">/**
     * 获取组任务（候选任务）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TaskDTO&gt; <span class="hljs-title function_">getCandidateTasks</span><span class="hljs-params">(String groupId)</span> {
        List&lt;Task&gt; tasks = taskService.createTaskQuery()
                .taskCandidateGroup(groupId)
                .orderByTaskCreateTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> tasks.stream()
                .map(<span class="hljs-built_in">this</span>::convertToDTO)
                .collect(Collectors.toList());
    }

    <span class="hljs-comment">/**
     * 认领任务
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">claimTask</span><span class="hljs-params">(String taskId, String userId)</span> {
        taskService.claim(taskId, userId);
    }

    <span class="hljs-comment">/**
     * 查询请假历史记录
     */</span>
    <span class="hljs-keyword">public</span> List&lt;LeaveRequestHistory&gt; <span class="hljs-title function_">getLeaveHistory</span><span class="hljs-params">(String employeeId)</span> {
        List&lt;HistoricProcessInstance&gt; instances = historyService
                .createHistoricProcessInstanceQuery()
                .variableValueEquals(<span class="hljs-string">"initiator"</span>, employeeId)
                .orderByProcessInstanceStartTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> instances.stream()
                .map(<span class="hljs-built_in">this</span>::convertToHistory)
                .collect(Collectors.toList());
    }

    <span class="hljs-keyword">private</span> TaskDTO <span class="hljs-title function_">convertToDTO</span><span class="hljs-params">(Task task)</span> {
        <span class="hljs-type">TaskDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskDTO</span>();
        dto.setTaskId(task.getId());
        dto.setTaskName(task.getName());
        dto.setProcessInstanceId(task.getProcessInstanceId());
        dto.setCreateTime(task.getCreateTime());
        dto.setAssignee(task.getAssignee());

        <span class="hljs-comment">// 获取流程变量</span>
        Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
        dto.setVariables(variables);

        <span class="hljs-keyword">return</span> dto;
    }
}
</code></pre>
<h5 data-id="heading-26">驳回处理委托</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RejectDelegate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JavaDelegate</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processInstanceId</span> <span class="hljs-operator">=</span> execution.getProcessInstanceId();
        <span class="hljs-type">String</span> <span class="hljs-variable">initiator</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"initiator"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">reason</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"reason"</span>);

        <span class="hljs-comment">// 记录驳回原因</span>
        execution.setVariable(<span class="hljs-string">"rejectReason"</span>, <span class="hljs-string">"请假申请被驳回"</span>);

        <span class="hljs-comment">// 这里可以发送通知、更新业务系统状态等</span>
        System.out.println(<span class="hljs-string">"驳回请假申请: "</span> + processInstanceId);
        System.out.println(<span class="hljs-string">"申请人: "</span> + initiator);
        System.out.println(<span class="hljs-string">"请假原因: "</span> + reason);

        <span class="hljs-comment">// 可以调用外部服务发送邮件、短信通知</span>
        <span class="hljs-comment">// notificationService.sendRejectNotification(initiator);</span>
    }
}
</code></pre>
<h5 data-id="heading-27">通知委托</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotifyDelegate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JavaDelegate</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processInstanceId</span> <span class="hljs-operator">=</span> execution.getProcessInstanceId();
        <span class="hljs-type">String</span> <span class="hljs-variable">initiator</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"initiator"</span>);
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">approved</span> <span class="hljs-operator">=</span> (Boolean) execution.getVariable(<span class="hljs-string">"approved"</span>);

        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(approved)) {
            System.out.println(<span class="hljs-string">"审批通过通知: "</span> + processInstanceId);
            <span class="hljs-comment">// 发送通过通知</span>
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"审批驳回通知: "</span> + processInstanceId);
            <span class="hljs-comment">// 发送驳回通知</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-28">5.5 REST API</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/leave")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeaveRequestController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LeaveRequestService leaveRequestService;

    <span class="hljs-comment">/**
     * 提交请假申请
     */</span>
    <span class="hljs-meta">@PostMapping("/submit")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;LeaveRequest&gt; <span class="hljs-title function_">submitLeave</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> LeaveRequest request)</span> {
        <span class="hljs-type">LeaveRequest</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> leaveRequestService.createLeaveRequest(request);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">/**
     * 获取我的待办任务
     */</span>
    <span class="hljs-meta">@GetMapping("/my-tasks")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;TaskDTO&gt;&gt; <span class="hljs-title function_">getMyTasks</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String userId)</span> {
        List&lt;TaskDTO&gt; tasks = leaveRequestService.getMyTasks(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(tasks);
    }

    <span class="hljs-comment">/**
     * 获取候选任务
     */</span>
    <span class="hljs-meta">@GetMapping("/candidate-tasks")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;TaskDTO&gt;&gt; <span class="hljs-title function_">getCandidateTasks</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String groupId)</span> {
        List&lt;TaskDTO&gt; tasks = leaveRequestService.getCandidateTasks(groupId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(tasks);
    }

    <span class="hljs-comment">/**
     * 认领任务
     */</span>
    <span class="hljs-meta">@PostMapping("/tasks/{taskId}/claim")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">claimTask</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String taskId,
            <span class="hljs-meta">@RequestParam</span> String userId)</span> {
        leaveRequestService.claimTask(taskId, userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-comment">/**
     * 完成审批
     */</span>
    <span class="hljs-meta">@PostMapping("/tasks/{taskId}/complete")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">completeTask</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String taskId,
            <span class="hljs-meta">@RequestBody</span> ApprovalRequest approval)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"managerApproval"</span>.equals(approval.getTaskName())) {
            leaveRequestService.managerApproval(taskId, approval.isApproved(), approval.getComment());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"hrApproval"</span>.equals(approval.getTaskName())) {
            leaveRequestService.hrApproval(taskId, approval.isApproved(), approval.getComment());
        }
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-comment">/**
     * 查询请假历史
     */</span>
    <span class="hljs-meta">@GetMapping("/history")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;LeaveRequestHistory&gt;&gt; <span class="hljs-title function_">getHistory</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String employeeId)</span> {
        List&lt;LeaveRequestHistory&gt; history = leaveRequestService.getLeaveHistory(employeeId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(history);
    }
}
</code></pre>
<h3 data-id="heading-29">六、高级特性</h3>
<h4 data-id="heading-30">6.1 并行网关</h4>
<p>并行网关用于处理多个并发任务：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parallelGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fork"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">parallelGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支1 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task1"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务1"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task1"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task1"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支2 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task2"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务2"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task2"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task2"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支3 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task3"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务3"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task3"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task3"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/538e42783af64a28b77a4692a8aac1e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=PcjUBaboK3BzAJmkrZU3us3snvE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-31">6.2 子流程</h4>
<p>子流程用于封装可重用的流程片段：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">subProcess</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subProcess"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批子流程"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subStart"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"子流程任务"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subEnd"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"subStart"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"subTask"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"subTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"subEnd"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">subProcess</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">callActivity</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"callSubProcess"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"调用子流程"</span>
               <span class="hljs-attr">calledElement</span>=<span class="hljs-string">"subProcess"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-32">6.3 事件机制</h4>
<p>Flowable支持多种事件类型：</p>
<ul>
<li><strong>定时器事件</strong>：基于时间的触发</li>
<li><strong>消息事件</strong>：异步消息传递</li>
<li><strong>信号事件</strong>：广播式通知</li>
<li><strong>错误事件</strong>：异常处理</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 定时器事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">intermediateCatchEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"timerEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"等待通知"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">timerEventDefinition</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">timeDuration</span>&gt;</span>PT2H<span class="hljs-tag">&lt;/<span class="hljs-name">timeDuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">timerEventDefinition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intermediateCatchEvent</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 消息事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">intermediateCatchEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messageEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"接收消息"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">messageEventDefinition</span> <span class="hljs-attr">messageRef</span>=<span class="hljs-string">"approvalMessage"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intermediateCatchEvent</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 边界定时器事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">boundaryEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"boundaryTimer"</span> <span class="hljs-attr">attachedToRef</span>=<span class="hljs-string">"userTask"</span>
               <span class="hljs-attr">cancelActivity</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">timerEventDefinition</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">timeDuration</span>&gt;</span>PT1H<span class="hljs-tag">&lt;/<span class="hljs-name">timeDuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">timerEventDefinition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">boundaryEvent</span>&gt;</span>
</code></pre>
<h4 data-id="heading-33">6.4 监听器</h4>
<p>通过监听器实现业务逻辑的扩展：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 流程启动监听器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessStartListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ExecutionListener</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionId</span> <span class="hljs-operator">=</span> execution.getProcessDefinitionId();
        System.out.println(<span class="hljs-string">"流程启动: "</span> + processDefinitionId);

        <span class="hljs-comment">// 记录日志、发送通知等</span>
    }
}

<span class="hljs-comment">// 任务创建监听器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskCreateListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskListener</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(DelegateTask delegateTask)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> delegateTask.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">assignee</span> <span class="hljs-operator">=</span> delegateTask.getAssignee();
        System.out.println(<span class="hljs-string">"任务创建: "</span> + taskName + <span class="hljs-string">", 分配给: "</span> + assignee);

        <span class="hljs-comment">// 发送任务通知</span>
    }
}
</code></pre>
<p>配置监听器：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">flowable:executionListener</span> <span class="hljs-attr">event</span>=<span class="hljs-string">"start"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.flowable.listener.ProcessStartListener"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${manager}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">flowable:taskListener</span> <span class="hljs-attr">event</span>=<span class="hljs-string">"create"</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.flowable.listener.TaskCreateListener"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">七、生产环境最佳实践</h3>
<h4 data-id="heading-35">7.1 数据库优化</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 为常用查询字段添加索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_ru_task_ASSIGNEE <span class="hljs-keyword">ON</span> ACT_RU_TASK(ASSIGNEE_);
<span class="hljs-keyword">CREATE</span> INDEX idx_ru_task_PROC_INST <span class="hljs-keyword">ON</span> ACT_RU_TASK(PROC_INST_ID_);
<span class="hljs-keyword">CREATE</span> INDEX idx_hi_procinst_BUS_KEY <span class="hljs-keyword">ON</span> ACT_HI_PROCINST(BUS_KEY_);
<span class="hljs-keyword">CREATE</span> INDEX idx_hi_actinst_PROC_INST <span class="hljs-keyword">ON</span> ACT_HI_ACTINST(PROC_INST_ID_);

<span class="hljs-comment">-- 定期清理历史数据（根据业务需求配置保留时长）</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> ACT_HI_VARINST <span class="hljs-keyword">WHERE</span> END_TIME_ <span class="hljs-operator">&lt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">YEAR</span>);
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> ACT_HI_DETAIL <span class="hljs-keyword">WHERE</span> TIME_ <span class="hljs-operator">&lt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">YEAR</span>);
</code></pre>
<h4 data-id="heading-36">7.2 性能优化</h4>
<ol>
<li><strong>异步执行</strong>：对耗时操作使用异步任务</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"asyncTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"异步任务"</span>
             <span class="hljs-attr">flowable:async</span>=<span class="hljs-string">"true"</span>
             <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.AsyncTaskDelegate"</span>/&gt;</span>
</code></pre>
<ol start="2">
<li><strong>批量操作</strong>：使用批量查询和操作API</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 批量查询任务</span>
List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee(<span class="hljs-string">"user1"</span>)
    .listPage(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);

<span class="hljs-comment">// 批量完成任务</span>
List&lt;String&gt; taskIds = Arrays.asList(<span class="hljs-string">"task1"</span>, <span class="hljs-string">"task2"</span>, <span class="hljs-string">"task3"</span>);
taskService.completeBatchTasks(taskIds);
</code></pre>
<ol start="3">
<li><strong>缓存配置</strong>：启用流程定义缓存</li>
</ol>
<pre><code class="hljs language-java" lang="java">configuration.setProcessDefinitionCacheSize(<span class="hljs-number">100</span>);
configuration.setEnableProcessDefinitionInfoCache(<span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-37">7.3 安全配置</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 配置用户权限管理</span>
<span class="hljs-type">IdentityService</span> <span class="hljs-variable">identityService</span> <span class="hljs-operator">=</span> processEngine.getIdentityService();

<span class="hljs-comment">// 创建用户</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> identityService.newUser(<span class="hljs-string">"zhangsan"</span>);
user.setFirstName(<span class="hljs-string">"三"</span>);
user.setLastName(<span class="hljs-string">"张"</span>);
user.setEmail(<span class="hljs-string">"zhangsan@example.com"</span>);
identityService.saveUser(user);

<span class="hljs-comment">// 创建组</span>
<span class="hljs-type">Group</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> identityService.newGroup(<span class="hljs-string">"managers"</span>);
group.setName(<span class="hljs-string">"经理组"</span>);
identityService.saveGroup(group);

<span class="hljs-comment">// 分配用户到组</span>
identityService.createMembership(<span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"managers"</span>);
</code></pre>
<h4 data-id="heading-38">7.4 监控与告警</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb1d0cda076c485e921861d27222f888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=Jf5%2Fh9ldNIll%2FjRcknHzxtFRikw%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowableMonitorService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ManagementService managementService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-comment">/**
     * 获取运行中的流程统计
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Long&gt; <span class="hljs-title function_">getProcessStatistics</span><span class="hljs-params">()</span> {
        Map&lt;String, Long&gt; stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// 各流程运行实例数</span>
        List&lt;ProcessInstance&gt; instances = runtimeService.createProcessInstanceQuery().list();
        Map&lt;String, Long&gt; countByProcess = instances.stream()
            .collect(Collectors.groupingBy(
                ProcessInstance::getProcessDefinitionKey,
                Collectors.counting()
            ));
        stats.putAll(countByProcess);

        <span class="hljs-comment">// 待办任务统计</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">pendingTasks</span> <span class="hljs-operator">=</span> managementService.createTaskQuery().count();
        stats.put(<span class="hljs-string">"pendingTasks"</span>, pendingTasks);

        <span class="hljs-keyword">return</span> stats;
    }

    <span class="hljs-comment">/**
     * 检测异常流程（运行时间过长）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessInstance&gt; <span class="hljs-title function_">detectLongRunningProcesses</span><span class="hljs-params">(<span class="hljs-type">int</span> thresholdHours)</span> {
        <span class="hljs-type">Date</span> <span class="hljs-variable">threshold</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() - thresholdHours * <span class="hljs-number">3600000L</span>);

        <span class="hljs-keyword">return</span> runtimeService.createProcessInstanceQuery()
            .startedBefore(threshold)
            .list();
    }

    <span class="hljs-comment">/**
     * 获取数据库表信息
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getDatabaseInfo</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// 获取各表记录数</span>
        String[] tables = {<span class="hljs-string">"ACT_RU_EXECUTION"</span>, <span class="hljs-string">"ACT_RU_TASK"</span>, <span class="hljs-string">"ACT_HI_PROCINST"</span>};
        <span class="hljs-keyword">for</span> (String table : tables) {
            <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> managementService.createTablePageQuery()
                .tableName(table)
                .listPage(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
                .getTotal();
            info.put(table, count);
        }

        <span class="hljs-keyword">return</span> info;
    }
}
</code></pre>
<h3 data-id="heading-39">八、微服务集成</h3>
<p>在微服务架构中使用Flowable：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml配置</span>
<span class="hljs-attr">flowable:</span>
  <span class="hljs-comment"># 数据库配置</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/flowable?useSSL=false</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">flowable</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">flowable</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>

  <span class="hljs-comment"># 异步执行器配置</span>
  <span class="hljs-attr">async-executor-activate:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">async-executor-max-jobs-per-acquisition:</span> <span class="hljs-number">10</span>
  <span class="hljs-attr">async-executor-default-queue-size:</span> <span class="hljs-number">100</span>

  <span class="hljs-comment"># REST API配置</span>
  <span class="hljs-attr">rest:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment"># 邮件服务器配置</span>
  <span class="hljs-attr">mail:</span>
    <span class="hljs-attr">server:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">smtp.example.com</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">587</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">noreply@example.com</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">password</span>
</code></pre>
<p>服务间通信示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowIntegrationService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;

    <span class="hljs-comment">/**
     * 跨服务启动流程
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCrossServiceProcess</span><span class="hljs-params">(WorkflowRequest request)</span> {
        <span class="hljs-comment">// 调用其他服务获取数据</span>
        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> restTemplate.getForObject(
            <span class="hljs-string">"http://user-service/api/users/"</span> + request.getUserId(),
            UserDTO.class
        );

        <span class="hljs-comment">// 设置流程变量</span>
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"user"</span>, user);
        variables.put(<span class="hljs-string">"request"</span>, request);

        <span class="hljs-comment">// 启动流程</span>
        runtimeService.startProcessInstanceByKey(
            <span class="hljs-string">"crossServiceProcess"</span>,
            request.getBusinessKey(),
            variables
        );
    }

    <span class="hljs-comment">/**
     * 流程回调处理
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleProcessCallback</span><span class="hljs-params">(String processInstanceId, String eventType)</span> {
        <span class="hljs-comment">// 根据事件类型执行不同操作</span>
        <span class="hljs-keyword">switch</span> (eventType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"completed"</span>:
                <span class="hljs-comment">// 流程完成后的处理</span>
                handleProcessCompleted(processInstanceId);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"cancelled"</span>:
                <span class="hljs-comment">// 流程取消后的处理</span>
                handleProcessCancelled(processInstanceId);
                <span class="hljs-keyword">break</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-40">九、总结</h3>
<p>Flowable作为一款优秀的开源工作流引擎，具有以下优势：</p>
<ol>
<li><strong>标准化</strong>：完全符合BPMN 2.0标准，学习成本低</li>
<li><strong>轻量级</strong>：可嵌入任何Java应用，部署简单</li>
<li><strong>高性能</strong>：支持高并发场景，适合企业级应用</li>
<li><strong>灵活扩展</strong>：提供丰富的扩展点，易于定制</li>
<li><strong>社区活跃</strong>：文档完善，社区支持良好</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升]]></title>    <link>https://juejin.cn/post/7600616270003650598</link>    <guid>https://juejin.cn/post/7600616270003650598</guid>    <pubDate>2026-01-30T01:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270003650598" data-draft-id="7600684978352979995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升"/> <meta itemprop="keywords" content="Kotlin,Android,Android Jetpack"/> <meta itemprop="datePublished" content="2026-01-30T01:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:24:23.000Z" title="Fri Jan 30 2026 01:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026 年 1 月 29 日，Kotlin 2.3.20-Beta2 发布。这次更新虽然还是 Beta 版，但带来了一个<strong>实验性但意义重大</strong>的变化：<strong>Kotlin/Native 的垃圾回收器（GC）默认启用了并发标记（Concurrent Marking）</strong>。</p>
<h2 data-id="heading-0">一、什么是并发标记 GC？</h2>
<h3 data-id="heading-1">先说问题</h3>
<p>在之前的默认配置 PMCS（Parallel Mark Concurrent Sweep）中：</p>
<blockquote>
<p>GC 标记阶段必须暂停所有应用线程。</p>
</blockquote>
<p>这意味着什么？当 GC 需要标记堆中的对象时，<strong>你的应用会停下来等待</strong>。</p>
<p>对于延迟敏感的应用——尤其是 UI 应用，这种"暂停"直接表现为<strong>卡顿、掉帧</strong>。</p>
<h3 data-id="heading-2">再说解决</h3>
<p>CMS（Concurrent Mark and Sweep）的核心改进：</p>
<blockquote>
<p><strong>标记阶段可以与应用线程并发执行！</strong></p>
</blockquote>
<p>简单来说：GC 标记对象时，你的应用可以继续运行。</p>
<h2 data-id="heading-3">二、实际效果</h2>
<p>官方已经用 Compose Multiplatform UI 应用做了基准测试：</p>
<blockquote>
<p><strong>CMS 显著改善了性能表现。</strong></p>
</blockquote>
<p>这意味着：</p>
<ul>
<li>更短的 GC 暂停时间</li>
<li>更流畅的用户界面</li>
<li>更好的响应速度</li>
</ul>
<h2 data-id="heading-4">三、如何使用</h2>
<h3 data-id="heading-5">默认启用（Beta 版）</h3>
<p>在 Kotlin 2.3.20-Beta1 和 Beta2 中，<strong>CMS 已经是默认配置</strong>。</p>
<p>你什么都不用改，直接升级版本就能体验：</p>
<pre><code class="hljs language-gradle" lang="gradle">kotlin("multiplatform") version "2.3.20-Beta2"
</code></pre>
<h3 data-id="heading-6">如果遇到问题</h3>
<p>CMS 仍然是<strong>实验性功能</strong>，在某些情况下可能导致：</p>
<ul>
<li>运行时崩溃</li>
<li>吞吐量下降</li>
<li>内存占用增加</li>
</ul>
<p>如果遇到回归问题，可以手动切回 PMCS：</p>
<pre><code class="hljs language-properties" lang="properties"># gradle.properties
kotlin.native.useNativeCms=false
</code></pre>
<h2 data-id="heading-7">四、开发者的谨慎</h2>
<p>Kotlin 团队采取的是<strong>渐进式发布策略</strong>：</p>





















<table><thead><tr><th>版本</th><th>GC 模式</th></tr></thead><tbody><tr><td>2.3.20-Beta1/2</td><td>CMS（默认，收集反馈）</td></tr><tr><td>2.3.20-RC</td><td>回滚到 PMCS</td></tr><tr><td>2.3.20 正式版</td><td>待定</td></tr></tbody></table>
<p><strong>为什么这么做？</strong></p>
<p>官方说得很直白：</p>
<blockquote>
<p>需要收集更多反馈，确保发现所有问题。</p>
</blockquote>
<p>这是负责任的态度——先在 Beta 版让广大开发者帮忙"压力测试"，收集足够数据后再决定正式版是否默认启用。</p>
<h2 data-id="heading-8">五、其他更新亮点</h2>
<h3 data-id="heading-9">1. C/Obj-C 互操作新模式</h3>
<p>如果你在 Kotlin Multiplatform 中使用 C 或 Objective-C 库，可以尝试新的互操作模式：</p>
<pre><code class="hljs language-gradle" lang="gradle">kotlin {
    targets.withType&lt;org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget&gt;().configureEach {
        compilations.configureEach {
            cinterops.configureEach {
                extraOpts += listOf("-Xccall-mode", "direct")
            }
        }
    }
}
</code></pre>
<blockquote>
<p>注意：新模式仍是实验性，<strong>不要用此模式发布库</strong>。</p>
</blockquote>
<h3 data-id="heading-10">2. JPA 插件增强</h3>
<p><code>kotlin.plugin.jpa</code> 现在自动应用 <code>all-open</code> 插件的 JPA 预设：</p>
<pre><code class="hljs language-gradle" lang="gradle">plugins {
    kotlin("plugin.jpa") version "2.3.20-Beta2"
}
</code></pre>
<p>JPA 实体类自动变成 <code>open</code>，无需手动配置 <code>all-open</code>。</p>
<p>支持的注解：</p>
<ul>
<li><code>javax.persistence.Entity</code></li>
<li><code>javax.persistence.Embeddable</code></li>
<li><code>javax.persistence.MappedSuperclass</code></li>
<li><code>jakarta.persistence.Entity</code></li>
<li><code>jakarta.persistence.Embeddable</code></li>
<li><code>jakarta.persistence.MappedSuperclass</code></li>
</ul>
<h3 data-id="heading-11">3. Maven 配置简化</h3>
<p>新建 Kotlin Maven 项目时，不再需要手动：</p>
<ul>
<li>创建源码目录</li>
<li>添加 <code>kotlin-stdlib</code> 依赖</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sourceRootsAutoDetection</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">sourceRootsAutoDetection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-12">4. Gradle 9.3.0 兼容</h3>
<p>支持 Gradle 7.6.3 到 9.3.0。</p>
<p>Kotlin/JVM 编译默认使用 Build tools API (BTA)。</p>
<h3 data-id="heading-13">5. 标准库新增 API</h3>
<p><code>Map.Entry.copy()</code> 扩展函数，用于创建 <code>Map.Entry</code> 的不可变副本：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalStdlibApi::class)</span>
<span class="hljs-keyword">val</span> mutableMap = mutableMapOf(<span class="hljs-string">"key"</span> to <span class="hljs-string">"value"</span>)
<span class="hljs-keyword">val</span> entry = mutableMap.entries.first()
<span class="hljs-keyword">val</span> copy = entry.copy() <span class="hljs-comment">// 创建不可变副本</span>
</code></pre>
<h2 data-id="heading-14">六、写到最后</h2>
<p>Kotlin 2.3 的 GC 改进，对 Kotlin/Native 生态——尤其是 Compose Multiplatform 开发者来说，是一个<strong>值得期待的进步</strong>。</p>
<p>虽然目前还是 Beta 实验，但：</p>
<ul>
<li>如果你开发 UI 应用</li>
<li>你在意用户体验</li>
<li>你受够了 GC 卡顿</li>
</ul>
<p><strong>不妨现在就试试 Beta 版，把你的反馈提交给官方。</strong></p>
<p>你的每一个问题报告，都是在帮 Kotlin 变得更好。</p>
<hr/>
<h2 data-id="heading-15">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fwhatsnew-eap.html" target="_blank" title="https://kotlinlang.org/docs/whatsnew-eap.html" ref="nofollow noopener noreferrer">Kotlin 2.3.20-Beta2 发布说明</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fyoutrack.jetbrains.com%2Fissues%2FKT" target="_blank" title="https://youtrack.jetbrains.com/issues/KT" ref="nofollow noopener noreferrer">YouTrack 问题追踪</a></li>
</ul>
<p><strong>升级提醒</strong>：IDE 支持 Kotlin 2.3.20-Beta2 的插件已捆绑在最新版 IntelliJ IDEA 和 Android Studio 中，只需修改 <code>build.gradle.kts</code> 中的版本号即可。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当AI取代客服、设计师、程序员，我们还剩下什么？]]></title>    <link>https://juejin.cn/post/7600597995769348105</link>    <guid>https://juejin.cn/post/7600597995769348105</guid>    <pubDate>2026-01-30T01:26:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995769348105" data-draft-id="7600684978353012763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当AI取代客服、设计师、程序员，我们还剩下什么？"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T01:26:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当AI取代客服、设计师、程序员，我们还剩下什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:26:03.000Z" title="Fri Jan 30 2026 01:26:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0"><strong>引言</strong></h2>
<p>人工智能（AI）的狂飙突进正深刻改变我们的工作方式：<br/>
AI客服能与百万用户同时对话，平面设计AI在几分钟内产出海报，代码生成模型甚至能自动构建应用。</p>
<p>这一切令人惊叹，却也让人不安。<br/>
当AI逐步取代客服、设计师、程序员等曾被认为“创造性强”或“技术门槛高”的岗位，人类在生产体系中还剩下什么？<br/>
本文将从<strong>技术原理、替代机制与未来趋势</strong>三个角度剖析这一问题，并探讨人类在AI主导时代中的新定位。</p>
<hr/>
<h2 data-id="heading-1"><strong>一、背景：AI的“技能渗透”现象</strong></h2>
<p>过去十年，AI从感知智能（识图、识音）发展到生成智能（文本、图像、代码），核心驱动力在于 <strong>Transformer架构与大模型（LLM）技术的演进</strong>。</p>

























<table><thead><tr><th>领域</th><th>曾被认为“人类专属”的任务</th><th>当前AI能力体现</th></tr></thead><tbody><tr><td>客服</td><td>情绪识别、语言应答、复杂查询</td><td>Chatbot + 情感分析模型</td></tr><tr><td>设计</td><td>概念创意、配色、空间构图</td><td>文生图模型（如Stable Diffusion、DALL·E）</td></tr><tr><td>程序开发</td><td>程序逻辑设计、调试、算法落地</td><td>AI编程助手（如GitHub Copilot、Code Llama）</td></tr></tbody></table>
<p>这意味着AI已经从“自动化重复劳动”迈向“认知性劳动”替代阶段。</p>
<hr/>
<h2 data-id="heading-2"><strong>二、技术逻辑：AI如何“取代人类工作”</strong></h2>
<h3 data-id="heading-3"><strong>1. 客服领域：语言模型 + 知识检索</strong></h3>
<p>AI客服的核心技术包括两部分：</p>
<ul>
<li><strong>自然语言理解（NLU）</strong> ：负责理解用户意图；</li>
<li><strong>知识增强生成（RAG）</strong> ：让语言模型接入实时知识库回答复杂问题。</li>
</ul>
<p><strong>示例：Python实现一个极简AI客服系统</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

qa = pipeline(<span class="hljs-string">"question-answering"</span>, model=<span class="hljs-string">"deepset/roberta-base-squad2"</span>)

context = <span class="hljs-string">"""
公司提供AI SaaS服务，包括文本生成、语音识别和知识图谱分析。
客服支持时间为周一至周五9:00-18:00。
"""</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">ai_customer_service</span>(<span class="hljs-params">question</span>):
    result = qa(question=question, context=context)
    <span class="hljs-keyword">return</span> result[<span class="hljs-string">"answer"</span>]

<span class="hljs-built_in">print</span>(ai_customer_service(<span class="hljs-string">"你们的客服什么时候上线？"</span>))
</code></pre>
<p>🔹 技术要点：<br/>
这种AI客服基于<strong>语义匹配与上下文理解</strong>，能够自动回答FAQ、引导用户操作，甚至进行表情与情感识别。</p>
<hr/>
<h3 data-id="heading-4"><strong>2. 设计领域：Diffusion模型 + Prompt工程</strong></h3>
<p>AI设计核心逻辑是 <strong>从文本生成视觉表达</strong>。<br/>
其技术基石是 <strong>扩散模型（Diffusion Model）</strong> ，通过逐步反噪还原高维视觉信息。</p>
<p>生成流程如下：</p>
<ol>
<li>输入文本提示词（Prompt）</li>
<li>语言模型解析语义 → 形成视觉特征向量</li>
<li>扩散模型生成对应图像</li>
</ol>
<p><strong>伪代码展示流程：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> torch
from diffusers <span class="hljs-keyword">import</span> StableDiffusionPipeline

pipe = StableDiffusionPipeline.<span class="hljs-built_in">from_pretrained</span>(<span class="hljs-string">"CompVis/stable-diffusion-v1-4"</span>)
pipe.<span class="hljs-built_in">to</span>(<span class="hljs-string">"cuda"</span>)

prompt = <span class="hljs-string">"A futuristic workspace with robots and humans collaborating, cyberpunk style"</span>
image = <span class="hljs-built_in">pipe</span>(prompt, guidance_scale=<span class="hljs-number">7.5</span>).images[<span class="hljs-number">0</span>]
image.<span class="hljs-built_in">save</span>(<span class="hljs-string">"future_workspace.png"</span>)
</code></pre>
<p>🔹 当前AI设计已可实现：</p>
<ul>
<li>LOGO生成、广告视觉构图；</li>
<li>工业设计草图草拟；</li>
<li>UI自动化设计（通过文本描述生成交互界面）。</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>3. 编程领域：语言模型 + 语义执行</strong></h3>
<p>AI编程助手的典型工作流程如下：</p>
<ol>
<li>用户输入需求（自然语言）；</li>
<li>模型分析语义 → 生成代码；</li>
<li>工具化环境自动执行与调试；</li>
<li>模型根据执行反馈自我修正。</li>
</ol>
<p><strong>示例：自动生成一个计算平均成绩的Python脚本</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user_prompt</span> = <span class="hljs-string">"写一个Python脚本，读取学生成绩，并计算平均分"</span>

<span class="hljs-comment"># AI模型推理结果（简化示例）</span>
<span class="hljs-attr">generated_code</span> = <span class="hljs-string">"""
scores = [89, 92, 76, 84]
avg = sum(scores) / len(scores)
print(f"Average score: {avg}")
"""</span>
exec(generated_code)
</code></pre>
<p>🔹 实际上，AI编程模型（如GPT-4/CodeLlama）不仅能写代码，还能进行：</p>
<ul>
<li>Debug与代码审查；</li>
<li>单元测试生成；</li>
<li>系统架构推理（结合自然语言设计大型系统）。</li>
</ul>
<hr/>
<h2 data-id="heading-6"><strong>三、AI“取代”的底层逻辑</strong></h2>
<p>AI并非“理解”世界，而是在<strong>统计意义上接近人类认知过程的预测系统</strong>。<br/>
它能：</p>
<ul>
<li>模拟语言（通过上下文预测单词）；</li>
<li>模拟设计（通过学习视觉分布）；</li>
<li>模拟编程（通过语义到逻辑的映射）。</li>
</ul>
<p>这使它能快速复制人类劳动的“结果形态”，但其创造动机与伦理判断仍然缺位。</p>
<hr/>
<h2 data-id="heading-7"><strong>四、AI替代的优缺点与人类再定位</strong></h2>






























<table><thead><tr><th>维度</th><th>AI的优势</th><th>AI的局限</th></tr></thead><tbody><tr><td>效率</td><td>可同时服务百万用户</td><td>缺乏真正的情感理解</td></tr><tr><td>创造力</td><td>快速生成多样方案</td><td>缺乏文化与上下文美学</td></tr><tr><td>成本</td><td>极低的人力与时间成本</td><td>技术维护与偏差风险高</td></tr><tr><td>责任归属</td><td>可自动执行任务</td><td>决策透明性不足</td></tr></tbody></table>
<h3 data-id="heading-8"><strong>实践建议</strong></h3>
<ol>
<li>
<p><strong>人机协同，而非对抗</strong><br/>
未来的核心竞争力不是“抗AI”，而是“用AI”：</p>
<ul>
<li>客服 → 客户体验管理师</li>
<li>设计师 → Prompt艺术家</li>
<li>程序员 → AI系统工程师</li>
</ul>
</li>
<li>
<p><strong>强化人类软技能（Meta Skill）</strong><br/>
包括系统思维、跨领域整合与价值判断，这些仍是AI无法直接学习的认知层。</p>
</li>
<li>
<p><strong>建立AI伦理与验证机制</strong><br/>
为AI产出建立可溯源的审核与安全标准。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-9"><strong>五、结论：人类的地位将重回“意义制造者”</strong></h2>
<p>AI正在重塑“劳动”的定义。<br/>
未来十年，AI不是仅仅“取代岗位”，而是将 <strong>人从执行者转变为设计者、监督者与意义创造者</strong>。</p>
<blockquote>
<p>“当AI取代我们的技能，我们需要培养的不是新的技能，而是新的认知层次。”</p>
</blockquote>
<p>在AI生产力浪潮中，人类真正不可替代的，将是：</p>
<ul>
<li>对价值的理解；</li>
<li>对社会伦理的把握；</li>
<li>对未知世界的想象力。</li>
</ul>
<hr/>
<h2 data-id="heading-10"><strong>参考资料</strong></h2>
<ol>
<li>Vaswani et al., <em>“Attention is All You Need”</em> , NeurIPS, 2017.</li>
<li>OpenAI, <em>ChatGPT Technical Report</em>, 2023.</li>
<li>Stability AI, <em>Stable Diffusion Model Card</em>, 2022.</li>
<li>DeepMind, <em>AlphaCode: Generating Code with LLMs</em>, 2022.</li>
<li>哈弗商业评论，《AI不是威胁，而是人类能力的倍增器》，2024年。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt艺术家（Prompt Engineer / Prompt Artist）]]></title>    <link>https://juejin.cn/post/7600675515150385179</link>    <guid>https://juejin.cn/post/7600675515150385179</guid>    <pubDate>2026-01-30T01:29:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600675515150385179" data-draft-id="7600597995769380873" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt艺术家（Prompt Engineer / Prompt Artist）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T01:29:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt艺术家（Prompt Engineer / Prompt Artist）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:29:27.000Z" title="Fri Jan 30 2026 01:29:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>通过语言、结构与思维技巧，<strong>引导人工智能生成理想化的创作输出</strong> —— 就像导演指导演员、作曲家操控乐器，只不过他们的“画笔”是指令文字。</p>
</blockquote>
<p>下面我们从技术、技能、流程和未来发展四个维度，系统拆解这个职业。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、什么是Prompt艺术家？</strong></h2>
<h3 data-id="heading-1">✅ <strong>定义</strong></h3>
<p><strong>Prompt艺术家</strong>是指能够设计、编排和优化文本提示（Prompt），以高效地让生成式AI（如GPT、Midjourney、DALL·E、Stable Diffusion）产生符合特定需求内容的专业人士。</p>
<p>他们的工作不在于手动创造图像、文案或代码，而在于：</p>
<ul>
<li><strong>定义意图（Intention）</strong></li>
<li><strong>描述约束（Constraint）</strong></li>
<li><strong>控制风格（Style）</strong></li>
<li><strong>引导AI输出所需的创意结果（Guidance）</strong></li>
</ul>
<p>简单来说：</p>
<blockquote>
<p>Prompt艺术家是“对AI说话的艺术家”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2"><strong>二、工作内容与职责</strong></h2>



































<table><thead><tr><th>工作内容</th><th>说明</th><th>典型工具</th></tr></thead><tbody><tr><td><strong>1. 需求理解与语义分解</strong></td><td>把客户或团队的模糊需求转化为可在Prompt中描述的参数（风格、场景、光影、语气等）。</td><td>ChatGPT、Claude、Midjourney</td></tr><tr><td><strong>2. Prompt编写与优化</strong></td><td>编写结构化Prompt，对AI输出结果进行多轮调试与Re-Prompt。</td><td>LangChain、PromptLayer、FlowGPT</td></tr><tr><td><strong>3. Prompt模板化与复用</strong></td><td>设计可重复的模板（如品牌视觉风格、岗位招聘Prompt库）。</td><td>Notion / Airtable / JSON脚本</td></tr><tr><td><strong>4. 数据反馈与风格一致性调优</strong></td><td>分析AI生成内容表现，持续改进Prompt逻辑，形成“风格资产”。</td><td>TensorBoard、Embedding分析工具</td></tr><tr><td><strong>5. 教育与标准化</strong></td><td>指导公司或创意团队培训AI使用标准，撰写Prompt指南或规则库。</td><td>文档系统、教学视频</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3"><strong>三、技术原理：为什么Prompt能控制AI？</strong></h2>
<p>Prompt工程背后的本质是 <strong>“条件概率调控”</strong> 。<br/>
对大语言模型（LLM）而言，Prompt并非命令，而是<strong>语义条件约束</strong>，AI通过概率分布预测下一个最可能的token。</p>
<p>例如，输入：</p>
<blockquote>
<p>“写一篇具有村上春树风格的夜晚咖啡馆故事。”</p>
</blockquote>
<p>AI会自动在训练语料中调用“村上春树 + 夜晚 + 都市 + 内心独白”相关的语言模式，从而生成相符的文本。</p>
<p><strong>对图像生成模型而言：</strong></p>
<p>Prompt 相当于 “高维语义编码器的可控输入”。<br/>
在 Stable Diffusion 模型中，Prompt通过 CLIP 模块转化为特征向量，引导扩散解码器生成特定风格图像。</p>
<pre><code class="hljs language-css" lang="css">Prompt → <span class="hljs-attribute">CLIP</span>文本编码器 → 语义向量 → 噪声反向扩散 → 图像输出
</code></pre>
<p>这就是为什么不同词序、句式、权重符号（如 <code>::</code>、<code>--ar</code>, <code>--v</code>）都会显著改变生成效果。</p>
<hr/>
<h2 data-id="heading-4"><strong>四、技能要求：成为Prompt艺术家需要什么能力？</strong></h2>





























<table><thead><tr><th>能力领域</th><th>关键技能</th></tr></thead><tbody><tr><td><strong>语言理解与逻辑表达</strong></td><td>能够清晰定义意图、风格、语气及约束条件。</td></tr><tr><td><strong>美学与创意感知</strong></td><td>对画面、配色、节奏、叙事有独特判断。</td></tr><tr><td><strong>AI模型机制理解</strong></td><td>理解文本到图像/语音/代码生成的底层逻辑。</td></tr><tr><td><strong>批判性思维与实验精神</strong></td><td>善于A/B测试Prompt差异、分析结果。</td></tr><tr><td><strong>多模态跨界能力</strong></td><td>能结合文字+图像+音频Prompt进行联合生成（如视频创意脚本）。</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5"><strong>五、Prompt编写的实际案例</strong></h2>
<h3 data-id="heading-6"><strong>案例1：AI绘画</strong></h3>
<p><strong>目标：</strong><br/>
让AI生成一张“未来城市中孤独少年的科幻插画”。</p>
<p><strong>Prompt示例（英文版，适合Midjourney）：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">a lone teenager standing <span class="hljs-keyword">on</span> a futuristic skyscraper rooftop at night, neon lights reflecting <span class="hljs-keyword">on</span> glass, cyberpunk style, atmospheric lighting, cinematic mood, highly detailed, <span class="hljs-number">8</span>K, <span class="hljs-keyword">by</span> syd mead
</code></pre>
<p><strong>解释：</strong></p>
<ul>
<li><code>a lone teenager...</code> → 主体定义</li>
<li><code>cyberpunk style</code> → 风格约束</li>
<li><code>by syd mead</code> → 模仿艺术家风格</li>
<li><code>8K, highly detailed</code> → 输出质量</li>
</ul>
<p>一位专业Prompt艺术家会通过反复调整这些描述，控制光影结构、情绪张力或画面构图。</p>
<hr/>
<h3 data-id="heading-7"><strong>案例2：AI文案</strong></h3>
<p><strong>目标：</strong><br/>
为一款智能家居灯具撰写广告语。</p>
<p><strong>Prompt示例：</strong></p>
<blockquote>
<p>"请以苹果公司广告的极简风格，撰写10条关于智能照明灯具的中文宣传语，每条不超过12字，情感基调温暖、科技感强。"</p>
</blockquote>
<p>输出示例：</p>
<ul>
<li>“光懂你心意。”</li>
<li>“让夜有温度。”</li>
<li>“点亮的不止空间。”</li>
</ul>
<p>Prompt艺术家的任务不仅仅是写Prompt，还包括评估输出中是否符合品牌语调，并持续微调。</p>
<hr/>
<h3 data-id="heading-8"><strong>案例3：AI编程辅助</strong></h3>
<p><strong>目标：</strong><br/>
让AI根据业务逻辑自动生成API接口文档。</p>
<p><strong>Prompt示例：</strong></p>
<blockquote>
<p>“根据以下函数定义，生成一份Swagger风格的API文档，包括参数解释、返回值示例和错误码说明。”</p>
</blockquote>
<p>Prompt艺术家在此既要掌握技术语言，也要知道如何控制输出格式与结构化内容。</p>
<hr/>
<h2 data-id="heading-9"><strong>六、职业价值与发展方向</strong></h2>

























<table><thead><tr><th>方向</th><th>描述</th></tr></thead><tbody><tr><td><strong>Prompt设计顾问（Prompt Consultant）</strong></td><td>为企业AI应用场景定制Prompt模板与自动化指令系统。</td></tr><tr><td><strong>AI内容创意导演（AI Creative Director）</strong></td><td>统筹AI生成视觉、文案、视频等跨媒体创意项目。</td></tr><tr><td><strong>Prompt系统工程师（Prompt System Engineer）</strong></td><td>用语言 + 程序构建动态Prompt（如在LangChain中编排多AI模块）。</td></tr><tr><td><strong>数据与风格归档师（AI Styling Curator）</strong></td><td>对Prompt版本进行管理，沉淀企业AI风格资产。</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10"><strong>七、AI支持下的Prompt工作流示意</strong></h2>
<pre><code class="hljs">需求输入 → 意图分解 → Prompt编写与测试
   ↓
AI生成内容 → 输出评估 → Prompt改进与优化
   ↓
最终交付 / 模板沉淀 / 知识复用
</code></pre>
<hr/>
<h2 data-id="heading-11"><strong>八、未来展望</strong></h2>
<p>随着多模态AI（如GPT-5、Gemini、Sora）的发展，<br/>
Prompt艺术家的工作将从“写指令”上升到“设计语义结构”，即：</p>
<ul>
<li>不再仅局限于命令，而是<strong>语言 + 上下文 + 知识结构的整体编排</strong>；</li>
<li>AI会逐渐理解“Prompt意图”，Prompt艺术家则成为“AI思维设计师（Cognitive Designer）”。</li>
</ul>
<p>未来，这个职位可能演化为：</p>
<blockquote>
<ul>
<li>人类与AI之间的“语义翻译官”；</li>
<li>数字创作流程中的“导演级思维设计者”。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-12"><strong>参考资料</strong></h2>
<ol>
<li>OpenAI，《Prompt Engineering Guide》，2024</li>
<li>Anthropic，《Effective Prompting for Claude》，2025</li>
<li>Stability AI，《Prompt Design in Diffusion Models》，2023</li>
<li>LangChain 文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2F" target="_blank" title="https://python.langchain.com/" ref="nofollow noopener noreferrer">python.langchain.com/</a></li>
<li>Simon Willison，《The emerging profession of Prompt Engineering》，2024</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring依赖注入神器：ObjectProvider深度解析]]></title>    <link>https://juejin.cn/post/7600606150732382251</link>    <guid>https://juejin.cn/post/7600606150732382251</guid>    <pubDate>2026-01-29T11:12:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600606150732382251" data-draft-id="7600562816458883114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring依赖注入神器：ObjectProvider深度解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T11:12:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ffmenw"/> <meta itemprop="url" content="https://juejin.cn/user/2738248275727619"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring依赖注入神器：ObjectProvider深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2738248275727619/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ffmenw
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:12:18.000Z" title="Thu Jan 29 2026 11:12:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Spring生态中，依赖注入（DI）是核心特性之一，但传统依赖注入的“刚性问题”（Bean不存在必报错、多实例冲突、启动加载冗余），曾是开发者频繁踩坑的痛点。Spring 4.3版本引入的<code>ObjectProvider</code>，作为<code>ObjectFactory</code>的增强子接口，专为解决这些痛点而生，成为Spring容器中Bean延迟查找、柔性依赖注入的核心工具，广泛应用于Spring Boot、Spring Cloud等主流开发场景。</p>
<p>本文将从核心定位、设计初衷、核心特性、API详解、实战场景、对比区别、注意事项7个维度，深度拆解<code>ObjectProvider</code>，帮你彻底掌握其原理与实战技巧，规避使用误区。</p>
<h2 data-id="heading-0">一、核心定位与设计初衷</h2>
<h3 data-id="heading-1">1. 核心定位：Spring容器的“柔性Bean查找器”</h3>
<p><code>ObjectProvider</code>隶属于<code>org.springframework.beans.factory</code>包，是<code>ObjectFactory</code>的子接口并做了功能增强。其核心定位是「Bean查找代理」——注入到目标类中的并非实际Bean实例，而是<code>ObjectProvider</code>代理对象；目标类可在<strong>需要时</strong>通过该代理获取Bean，实现“按需加载”，同时具备丰富的容错、批量处理能力，打破了传统依赖注入的刚性限制。</p>
<h3 data-id="heading-2">2. 设计初衷：解决传统@Autowired的3大痛点</h3>
<p>传统<code>@Autowired</code>依赖注入虽便捷，但存在3个难以规避的刚性问题，<code>ObjectProvider</code>的设计初衷就是精准破解这些痛点：</p>
<ul>
<li>
<p><strong>即时注入冗余</strong>：容器启动时即解析所有依赖并初始化Bean，若Bean初始化成本高（如加载大文件、连接第三方数据源）且非启动必需，会严重拖慢容器启动速度；</p>
</li>
<li>
<p><strong>强依赖必报错</strong>：默认情况下，被注入的Bean不存在则直接抛出<code>NoSuchBeanDefinitionException</code>，无法实现“可选依赖”（Bean不存在时不影响程序运行）；</p>
</li>
<li>
<p><strong>多实例冲突</strong>：当存在多个同类型Bean时，未指定<code>@Qualifier</code>则抛出<code>NoUniqueBeanDefinitionException</code>，无原生批量处理能力，需手动编写大量判空、筛选逻辑。</p>
</li>
</ul>
<h2 data-id="heading-3">二、核心特性：柔性+延迟，碾压传统注入/ObjectFactory</h2>
<p><code>ObjectProvider</code>的核心价值的在于「柔性依赖」和「延迟加载」，相比传统<code>@Autowired</code>和父接口<code>ObjectFactory</code>，其优势更突出，核心特性可概括为4点：</p>
<h3 data-id="heading-4">1. 延迟查找与延迟注入（核心特性）</h3>
<p>这是<code>ObjectProvider</code>最核心的能力，也是区别于传统<code>@Autowired</code>的关键：</p>
<ul>
<li>
<p>传统<code>@Autowired</code>：容器启动阶段完成Bean实例化和依赖注入，属于「即时注入」，无论Bean是否被使用，都会提前初始化；</p>
</li>
<li>
<p><code>ObjectProvider</code>：注入的是<code>ObjectProvider</code>代理对象，实际Bean的获取延迟到调用<code>getObject()</code>、<code>getIfAvailable()</code>等方法时，真正实现“按需加载”，大幅降低容器启动时的依赖解析压力。</p>
</li>
</ul>
<h3 data-id="heading-5">2. 非唯一Bean的优雅处理</h3>
<p>针对“多个同类型Bean存在”的场景，<code>ObjectProvider</code>无需额外配置<code>@Qualifier</code>，提供「有序获取、批量流式处理」能力，避免直接抛出冲突异常：</p>
<p>支持通过<code>stream()</code>获取所有同类型Bean的流式实例，通过<code>orderedStream()</code>按优先级（<code>@Order</code>注解/<code>Ordered</code>接口）获取，可直接结合Lambda表达式完成筛选、遍历，代码更简洁优雅。</p>
<h3 data-id="heading-6">3. 不存在Bean的容错处理（柔性依赖核心）</h3>
<p>提供非侵入式的可选依赖支持，彻底替代传统<code>@Autowired(required = false)</code>的繁琐判空逻辑：</p>
<p>通过<code>getIfAvailable()</code>、<code>getIfUnique()</code>等专属方法，实现“Bean存在则获取，不存在则返回null/默认值”，无需手动检查Bean是否为<code>null</code>，大幅简化代码。</p>
<h3 data-id="heading-7">4. JDK8+流式API原生支持</h3>
<p>适配JDK8及以上的流式编程风格，原生提供<code>stream()</code>/<code>orderedStream()</code>方法，直接返回<code>Stream&lt;T&gt;</code>，可结合Lambda表达式对多实例Bean进行高效批量处理（过滤、映射、遍历等），符合现代Java编程习惯，大幅提升开发效率。</p>
<h2 data-id="heading-8">三、核心API方法详解（Spring 5.x+全量支持）</h2>
<p><code>ObjectProvider</code>继承了<code>ObjectFactory</code>的唯一方法<code>getObject()</code>，并扩展了一系列实用方法，按功能可分为4大类，重点掌握“容错获取”和“批量获取”方法，避免滥用无容错能力的基础方法。</p>
<h3 data-id="heading-9">1. 基础获取（继承自ObjectFactory，慎用）</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">T <span class="hljs-title">getObject</span>() throws BeansException</span>;
</code></pre>
<ul>
<li>
<p>功能：获取唯一的Bean实例，<strong>无任何容错能力</strong>；</p>
</li>
<li>
<p>异常场景：Bean不存在、存在多个同类型Bean时，直接抛出传统Spring异常（与<code>ObjectFactory</code>行为完全一致）；</p>
</li>
<li>
<p>适用场景：明确Bean唯一且必存在，仅需要延迟加载时使用（不推荐，优先用容错方法）。</p>
</li>
</ul>
<h3 data-id="heading-10">2. 容错获取（核心推荐，实现可选依赖）</h3>
<p>这类方法是<code>ObjectProvider</code>的核心价值所在，彻底解决“Bean不存在必报错”的问题，推荐日常开发优先使用：</p>
<p>（1）<code>T getIfAvailable() throws BeansException;</code></p>
<ul>
<li>
<p>核心功能：Bean存在则返回实例，不存在则返回<code>null</code>，<strong>无异常抛出</strong>；</p>
</li>
<li>
<p>价值：替代<code>@Autowired(required = false)</code>，无需手动判空，实现优雅的可选依赖。</p>
</li>
</ul>
<p>（2）<code>T getIfAvailable(Supplier&lt;T&gt; defaultSupplier) throws BeansException;</code></p>
<ul>
<li>核心功能：Bean存在则返回实例，<strong><code>Supplier</code></strong> <strong>不存在则执行获取默认值</strong>；</li>
</ul>
<p>（3）<code>T getIfUnique() throws BeansException;</code></p>
<ul>
<li>核心功能：<strong><code>null</code></strong> <strong>仅当存在唯一的同类型Bean时返回实例，否则返回</strong>（0个或多个同类型Bean均返回<code>null</code>）；</li>
</ul>
<p>（4）<code>T getOrDefault(T defaultInstance) throws BeansException;</code></p>
<ul>
<li>
<p>核心功能：Bean存在则返回实例，不存在则返回指定的默认实例；</p>
</li>
<li>
<p>与<code>getIfAvailable(Supplier)</code>区别：直接传入默认实例（即时创建），而非延迟创建的<code>Supplier</code>（按需创建），根据默认实例的创建成本选择使用。</p>
</li>
</ul>
<h3 data-id="heading-11">3. 有序/批量获取（处理多同类型Bean）</h3>
<p>针对多同类型Bean场景，提供批量获取能力，支持有序排列，无需手动筛选：</p>
<p>（1）<code>Stream&lt;T&gt; stream() throws BeansException;</code></p>
<ul>
<li>
<p>功能：返回所有同类型Bean的流式实例，<strong>无顺序保证</strong>（按容器注册顺序返回）；</p>
</li>
<li>
<p>适用场景：批量处理所有同类型Bean，无需区分优先级（如批量执行所有处理器）。</p>
</li>
</ul>
<p>（2）<code>Stream&lt;T&gt; orderedStream() throws BeansException;</code></p>
<ul>
<li>
<p>功能：返回按优先级排序后的同类型Bean流式实例；</p>
</li>
<li>
<p>排序规则：遵循Spring的有序机制，优先按<code>@Order</code>注解值（值越小优先级越高），其次按<code>Ordered</code>接口的<code>getOrder()</code>方法返回值；</p>
</li>
<li>
<p>适用场景：需要按优先级执行多实例Bean的场景（如拦截器、处理器链）。</p>
</li>
</ul>
<h3 data-id="heading-12">4. 带参数创建（动态传参实例化Bean）</h3>
<pre><code class="hljs language-java" lang="java">T <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object... args)</span> <span class="hljs-keyword">throws</span> BeansException;
</code></pre>
<ul>
<li>
<p>核心功能：获取Bean时，<strong>动态传入构造器/工厂方法参数</strong>，实现Bean的动态实例化；</p>
</li>
<li>
<p>适用场景：Bean的创建需要运行时动态参数（如根据用户请求参数创建实例），传统注入无法支持此场景（传统注入仅支持容器启动时的固定参数）。</p>
</li>
</ul>
<h2 data-id="heading-13">四、典型实战场景（附优化后代码示例）</h2>
<p><code>ObjectProvider</code>的使用需结合Spring依赖注入（推荐构造器注入，符合Spring最佳实践），注入后按需调用对应方法。以下是4个最常用、最高频的实战场景，代码示例简洁可直接套用。</p>
<h3 data-id="heading-14">场景1：可选依赖注入（替代@Autowired(required = false)）</h3>
<p>需求：某个服务依赖的配置类/处理器为可选，存在则使用，不存在则执行默认逻辑，无需手动判空。</p>
<pre><code class="hljs language-csharp" lang="csharp">@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> {
    <span class="hljs-comment">// 注入ObjectProvider，目标Bean为OptionalHandler（可选）</span>
    <span class="hljs-keyword">private</span> final ObjectProvider&lt;OptionalHandler&gt; optionalHandlerProvider;

    <span class="hljs-comment">// 推荐构造器注入（保证对象不可变，符合Spring最佳实践）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span>(<span class="hljs-params">ObjectProvider&lt;OptionalHandler&gt; optionalHandlerProvider</span>)</span> {
        <span class="hljs-keyword">this</span>.optionalHandlerProvider = optionalHandlerProvider;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doHandle</span>()</span> {
        <span class="hljs-comment">// 场景1：存在则使用，不存在则执行默认逻辑（无需判空）</span>
        optionalHandlerProvider.ifAvailable(OptionalHandler::handle, 
            () -&gt; System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"可选处理器不存在，执行默认逻辑"</span>));

        <span class="hljs-comment">// 进阶：不存在则使用默认实现（Lambda提供默认Bean）</span>
        OptionalHandler defaultHandler = optionalHandlerProvider.getIfAvailable(DefaultOptionalHandler::<span class="hljs-keyword">new</span>);
        defaultHandler.handle();
    }
}

<span class="hljs-comment">// 可选处理器（可不存在）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">OptionalHandler</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handle</span>()</span>;
}

<span class="hljs-comment">// 默认实现类（Bean不存在时使用）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DefaultOptionalHandler</span> <span class="hljs-title">implements</span> <span class="hljs-title">OptionalHandler</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"默认处理器执行逻辑"</span>);
    }
}
</code></pre>
<h3 data-id="heading-15">场景2：多同类型Bean批量处理（按优先级执行）</h3>
<p>需求：存在多个<code>Handler</code>接口实现类，需按优先级批量执行所有处理器，无需手动筛选排序。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 处理器接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 实现类1：优先级1（值越小优先级越高）</span>
<span class="hljs-meta">@Order(1)</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"优先级1：FirstHandler 执行"</span>);
    }
}

<span class="hljs-comment">// 实现类2：优先级2</span>
<span class="hljs-meta">@Order(2)</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"优先级2：SecondHandler 执行"</span>);
    }
}

<span class="hljs-comment">// 业务服务：批量执行所有处理器（按优先级）</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectProvider&lt;Handler&gt; handlerProvider;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HandlerService</span><span class="hljs-params">(ObjectProvider&lt;Handler&gt; handlerProvider)</span> {
        <span class="hljs-built_in">this</span>.handlerProvider = handlerProvider;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeAll</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 按@Order排序后，批量执行所有处理器（核心代码，简洁高效）</span>
        handlerProvider.orderedStream().forEach(Handler::execute);
    }
}
</code></pre>
<h3 data-id="heading-16">场景3：延迟加载Bean（减少容器启动耗时）</h3>
<p>需求：某个Bean（如大数据初始化的<code>DataLoader</code>）初始化成本高，且非容器启动必需，仅在首次调用数据查询时才初始化。</p>
<pre><code class="hljs language-csharp" lang="csharp">​<span class="hljs-comment">// 初始化成本高的Bean（如加载大文件、连接第三方数据源）</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataLoader</span> {
    <span class="hljs-comment">// 模拟高成本初始化逻辑</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataLoader</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"DataLoader 延迟初始化（仅首次调用时执行）..."</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadData</span>()</span> {
        <span class="hljs-comment">// 数据加载核心逻辑</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"数据加载完成"</span>);
    }
}

<span class="hljs-comment">// 业务服务：仅在查询数据时初始化DataLoader</span>
@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataQueryService</span> {
    <span class="hljs-keyword">private</span> final ObjectProvider&lt;DataLoader&gt; dataLoaderProvider;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataQueryService</span>(<span class="hljs-params">ObjectProvider&lt;DataLoader&gt; dataLoaderProvider</span>)</span> {
        <span class="hljs-keyword">this</span>.dataLoaderProvider = dataLoaderProvider;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">queryData</span>(<span class="hljs-params">String id</span>)</span> {
        <span class="hljs-comment">// 首次调用时初始化DataLoader，后续调用复用单例实例（遵循Bean作用域）</span>
        DataLoader dataLoader = dataLoaderProvider.getObject();
        dataLoader.loadData();
        <span class="hljs-comment">// 后续查询逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"查询结果："</span> + id;
    }
}
</code></pre>
<h3 data-id="heading-17">场景4：动态传参创建Bean（运行时参数注入）</h3>
<p>需求：Bean的创建需要运行时动态参数（如根据用户请求参数创建实例），传统注入无法支持，需通过<code>ObjectProvider</code>动态传参。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 需动态传参的Bean（无需@Component注解，由容器动态创建）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicBean</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> runtimeParam;

    <span class="hljs-comment">// 构造器需要运行时动态参数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DynamicBean</span><span class="hljs-params">(<span class="hljs-type">String</span> runtimeParam)</span> </span>{
        <span class="hljs-keyword">this</span>.runtimeParam = runtimeParam;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"运行时动态参数："</span> + runtimeParam);
    }
}

<span class="hljs-comment">// 业务服务：动态传参创建Bean</span>
@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectProvider&lt;DynamicBean&gt; dynamicBeanProvider;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DynamicService</span><span class="hljs-params">(ObjectProvider&lt;DynamicBean&gt; dynamicBeanProvider)</span> </span>{
        <span class="hljs-keyword">this</span>.dynamicBeanProvider = dynamicBeanProvider;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-type">String</span> userParam)</span> </span>{
        <span class="hljs-comment">// 运行时传入参数，动态创建Bean实例（每次传参可创建不同实例，遵循原型作用域）</span>
        DynamicBean dynamicBean = dynamicBeanProvider.<span class="hljs-built_in">getObject</span>(userParam);
        dynamicBean.<span class="hljs-built_in">doSomething</span>();
    }
}
</code></pre>
<h2 data-id="heading-18">五、与ObjectFactory的核心对比（官方推荐优先用ObjectProvider）</h2>
<p><code>ObjectProvider</code>是<code>ObjectFactory</code>的子接口和增强版，Spring官方明确推荐优先使用<code>ObjectProvider</code>替代<code>ObjectFactory</code>，二者的核心差异体现在多个维度：</p>
<ol>
<li>
<p>继承关系：<code>ObjectFactory</code>是基础工厂接口，无父接口；<code>ObjectProvider</code>作为其子接口，继承了<code>ObjectFactory</code>并完整保留了其基础能力。</p>
</li>
<li>
<p>API丰富度：<code>ObjectFactory</code>仅提供1个方法<code>getObject()</code>，功能单一；<code>ObjectProvider</code>拥有丰富的方法体系，包含容错、批量、流式等类型，可覆盖多种开发场景。</p>
</li>
<li>
<p>容错能力：<code>ObjectFactory</code>无容错设计，当目标Bean不存在或存在多实例时会直接报错；<code>ObjectProvider</code>的容错能力<strong>强，支持getIfAvailable/getIfUnique等容错方法（核心优势）</strong>，可妥善处理Bean不存在、多实例等异常场景。</p>
</li>
<li>
<p>流式支持：<code>ObjectFactory</code>无流式处理能力，无法对多实例Bean进行批量处理；<code>ObjectProvider</code><strong>原生支持stream/orderedStream，适配流式编程</strong>，便捷实现多实例的流式处理。</p>
</li>
<li>
<p>多实例处理：<code>ObjectFactory</code>仅能获取单个Bean实例，遇到多实例场景会直接报错，无对应处理能力；<code>ObjectProvider</code><strong>支持批量、有序获取多实例，无需额外配置</strong>，可高效处理多实例Bean场景。</p>
</li>
<li>
<p>延迟加载：二者均支持该能力，这是<code>ObjectFactory</code>的核心能力，仅能实现基础的Bean延迟获取；<code>ObjectProvider</code>在继承该能力的基础上做了增强，结合自身的容错、批量等特性，让延迟加载的实际业务价值更大。</p>
</li>
<li>
<p>使用场景：<code>ObjectFactory</code>仅适用于简单的Bean延迟创建场景，且场景中无容错、多实例的相关需求；<code>ObjectProvider</code>的适用场景更广泛，可满足<strong>可选依赖、多实例批量处理、高成本Bean延迟加载、动态传参（主流场景）等</strong>开发需求。</p>
</li>
</ol>
<p>核心结论：<code>ObjectFactory</code>是Spring的基础工厂接口，仅提供最基础的Bean延迟创建能力；<code>ObjectProvider</code>在继承其基础能力的前提下，补充了「容错、批量、流式」等核心功能，更适配现代Spring开发的复杂场景，是Spring中处理Bean依赖的首选工具。</p>
<h2 data-id="heading-19">六、关键注意事项（规避90%的使用误区）</h2>
<p>掌握<code>ObjectProvider</code>的同时，需规避以下5个高频误区，避免踩坑：</p>
<h3 data-id="heading-20">1. 版本依赖：仅Spring 4.3及以上支持</h3>
<p>若项目基于Spring 4.3以下版本（如Spring 4.2及更低），无<code>ObjectProvider</code>接口，需使用<code>ObjectFactory</code>结合手动判空，实现类似可选依赖、延迟加载功能。</p>
<h3 data-id="heading-21">2. 注入方式：优先选择构造器注入</h3>
<p><code>ObjectProvider</code>支持<code>@Autowired</code>字段注入、构造器注入、setter注入，但<strong>推荐构造器注入</strong>：</p>
<p>构造器注入可保证目标对象不可变（final修饰），符合Spring官方依赖注入最佳实践，同时避免字段注入可能出现的空指针异常（注入时机问题）。</p>
<h3 data-id="heading-22">3. 慎用getObject()方法，避免失去柔性优势</h3>
<p><code>getObject()</code>继承自<code>ObjectFactory</code>，无任何容错能力，使用前需确保Bean「唯一且必存在」，否则会抛出传统Spring异常（失去<code>ObjectProvider</code>的柔性优势）。</p>
<p>日常开发优先使用<code>getIfAvailable()</code>、<code>orderedStream()</code>等容错、批量方法。</p>
<h3 data-id="heading-23">4. 遵循Bean作用域，不可忽视实例复用逻辑</h3>
<p>通过<code>ObjectProvider</code>获取的Bean实例，完全遵循其在Spring容器中配置的作用域：</p>
<ul>
<li>
<p>单例（singleton）：每次获取的是同一个实例，即使多次调用<code>getObject()</code>，也不会重新初始化；</p>
</li>
<li>
<p>原型（prototype）：每次获取的是新实例，多次调用<code>getObject()</code>会创建多个实例，需注意资源释放。</p>
</li>
</ul>
<h3 data-id="heading-24">5. 区分ObjectProvider与Optional（避免混淆使用）</h3>
<p>很多开发者会混淆二者，其实二者定位完全不同，可结合使用但不可替代：</p>
<ul>
<li>
<p><code>ObjectProvider</code>：<strong>Spring容器层面的Bean查找工具</strong>，结合了容器的依赖管理、作用域控制，核心是“Bean查找+柔性容错”；</p>
</li>
<li>
<p><code>java.util.Optional</code>：<strong>JDK的空值包装类</strong>，仅用于空值处理，无Bean查找能力，不依赖Spring容器。</p>
</li>
</ul>
<p>推荐结合使用：<code>Optional.ofNullable(provider.getIfAvailable())</code>，既利用<code>ObjectProvider</code>的Bean查找能力，又利用<code>Optional</code>的空值处理能力，代码更优雅。</p>
<h2 data-id="heading-25">七、总结：ObjectProvider的核心价值与应用场景</h2>
<p><code>ObjectProvider</code>作为Spring 4.3引入的增强型工厂接口，核心是解决「传统依赖注入的刚性问题」，其价值可概括为「延迟加载+柔性依赖」，是现代Spring开发中处理Bean依赖的核心工具：</p>
<ol>
<li>
<p>核心定位：<code>ObjectFactory</code>的增强子接口，Spring容器的“柔性Bean查找器”，实现Bean的按需加载与容错注入；</p>
</li>
<li>
<p>核心优势：解决了<code>@Autowired</code>即时注入、强依赖、多实例冲突的三大痛点，补充了容错、批量、流式、动态传参等核心功能；</p>
</li>
<li>
<p>高频场景：可选依赖注入、多同类型Bean批量处理、高成本Bean延迟加载、运行时动态传参创建Bean；</p>
</li>
<li>
<p>官方推荐：优先使用<code>ObjectProvider</code>替代<code>ObjectFactory</code>，契合Spring依赖注入的最佳实践，大幅提升代码简洁度与健壮性。</p>
</li>
</ol>
<p>掌握<code>ObjectProvider</code>，不仅能规避传统依赖注入的高频踩坑点，还能让Bean依赖管理更灵活、更高效，尤其在Spring Boot、Spring Cloud等主流框架开发中，其应用场景极为广泛，是Spring开发者必备的核心技能之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[清华开源！GitHub 上 4600 人 Star 的 RAG 应用神器更新了。]]></title>    <link>https://juejin.cn/post/7600674821308006436</link>    <guid>https://juejin.cn/post/7600674821308006436</guid>    <pubDate>2026-01-30T01:56:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600674821308006436" data-draft-id="7600706866784550955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="清华开源！GitHub 上 4600 人 Star 的 RAG 应用神器更新了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-30T01:56:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            清华开源！GitHub 上 4600 人 Star 的 RAG 应用神器更新了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:56:10.000Z" title="Fri Jan 30 2026 01:56:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个叫 UltraRAG 的开源项目，已经在 GitHub 上获得 4600+ 的 Star 了。</p>
<p>它由<strong>清华大学 THUNLP 实验室、东北大学 NEUIR 实验室、OpenBMB 、面壁智能与 AI9Stars 等联合发布的，是首个基于 MCP 的轻量级 RAG 开发框架。</strong> <strong>简单总结就是</strong>用 YAML 配置逻辑，用 MCP 做组件，用 UI 打通从「算法」到「应用」的最后一公里。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed64dfec4004dc0849d74a53b6a2cbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770342969&amp;x-signature=Ir4I4drgSnAlxG3%2BKlgia%2FP6g3Q%3D" alt="图片" loading="lazy"/></p>
<p>最近，它们发布了 UltraRAG 3.0。</p>
<p>直接把定位写得非常激进：拒绝“盲盒”开发，让每一行推理逻辑都清晰可见。</p>
<p>如果你正在做知识库问答、DeepResearch、多轮复杂推理，又被各种 Agent + RAG 的黑盒流水线折磨，UltraRAG 3.0 值得你认真看一眼。</p>
<p>而且目前已经登上了 GitHub 开源热榜的 TOP 3 了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e00658689eac435082320b31f5773a4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770342969&amp;x-signature=gCslVSEQ2GlX1ehXHjyZJvnxWBw%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/OpenBMB/UltraRAG</span>
</code></pre>
<p>01</p>
<p><strong>UltraRAG 3.0 发布了</strong></p>
<p><strong>下面就重点看看刚更新的 3.0 有哪些东西，整体来说还是比较顶的。</strong></p>
<p>① 逻辑即应用</p>
<p>说白了就是不需要你自己写对话界面的 UI 了。以前是：</p>
<p>想一个算法 → 写个 pipeline → 跑通 → 再自己写个前端 UI 包一层 → 再调交互细节。</p>
<p>在 UltraRAG 3.0 里，不用这么麻烦了：</p>
<p>写 YAML / 画流程 → 一键 Build → 自动生成对话式 Web 界面。</p>
<p>可以看到，你只需定义好 YAML pipeline，框架就能自动把它变成一套标准交互 demo。</p>
<p>在 UI 上拖拽、连线组件，像搭积木一样画流程。直接改 YAML，画布视图也能实时跟进。</p>
<p>直观感受：你写好的逻辑，本质上就是一个可运行的产品雏形，不再只是伪 demo。</p>
<p>② 全链路白盒化</p>
<p>Show Thinking，把每一步想法摊开给你看。</p>
<p>UltraRAG 3.0 把 Chat 界面升级成了一个 推理过程观察窗。它有一个 Show Thinking 面板，可以流式展示每个 Step：</p>
<p>比如哪次检索召回了哪些 chunk、哪个 Tool 被调用了几次，在第几轮循环里分支走向了哪边。</p>
<p>结构化、时间顺序很清晰。</p>
<p>多轮查询改写、多次检索、多工具协作，以前真的很难一眼看全流程，有了这个能力，问题定位变得非常直接。</p>
<p>之前发现答案错了，需要通过打 log 或者其它办法来看是检索问题还是模型幻觉。</p>
<p>现在直接在界面上看就行了。对复杂任务尤其有价值，比如 DeepResearch 场景。UltraRAG 3.0 把整个「思考过程」完全展开出来，确实方便很多。</p>
<p>③ 内置智能开发助手</p>
<p>UltraRAG 3.0 直接把开发文档和最佳实践塞进了一个内置的智能助手里。</p>
<p>从看文档→理解→翻译成配置这一整段心智负担都帮你省了。</p>
<p>下面这个图就是内置的开发助手能做的一些事情：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/643ede440db24d0d9547285b65bd3465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770342969&amp;x-signature=7SCsTz3pKfZrgMyWkOcuWTjCMZA%3D" alt="图片" loading="lazy"/></p>
<p>02</p>
<p><strong>如何使用</strong></p>
<p>如果你是第一次接触 UltraRAG，可以按这条路线来：</p>
<h3 data-id="heading-0">第一步：安装 &amp; 验证</h3>
<p><strong>本地安装，推荐 uv：</strong></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/OpenBMB/UltraRAG.git --depth 1cd UltraRAG<span class="hljs-comment"># 同步全部依赖uv sync --all-extras# 激活环境（以 macOS/Linux 为例）source .venv/bin/activate# 跑个最简单的例子ultrarag run examples/sayhello.yaml# 预期输出：Hello, UltraRAG v3!</span>
</code></pre>
<p><strong>Docker 快速体验 UI：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"># 拉镜像 / 或者本地构建docker build -t ultrarag:v0<span class="hljs-number">.3</span><span class="hljs-number">.0</span> .# 跑起来（默认 <span class="hljs-number">5050</span> 端口）docker run -it --gpus all -p <span class="hljs-number">5050</span>:<span class="hljs-number">5050</span> ultrarag:v0<span class="hljs-number">.3</span><span class="hljs-number">.0</span># 浏览器打开 http:<span class="hljs-comment">//localhost:5050</span>
</code></pre>
<p>先随便玩几个官方示例 pipeline，感受一下「Show Thinking」和可视化 builder 的味道。</p>
<p>第二步：学会读/写一份简单的 YAML Pipeline</p>
<p>你至少要掌握：</p>
<p>servers: 部分：声明你会用到哪些 MCP Servers（retriever / generation / evaluation…）</p>
<p>pipeline: 部分：声明执行的步骤，以及循环/分支逻辑</p>
<p>典型结构大概是这样的：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">servers:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">generation</span>    <span class="hljs-attr">type:</span> <span class="hljs-string">generation</span>    <span class="hljs-string">params:</span>      <span class="hljs-attr">model:</span> <span class="hljs-string">qwen3-7b</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">retriever</span>    <span class="hljs-attr">type:</span> <span class="hljs-string">retriever</span>    <span class="hljs-string">params:</span>      <span class="hljs-attr">index:</span> <span class="hljs-string">milvuspipeline:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">init_query</span>    <span class="hljs-attr">server:</span> <span class="hljs-string">generation</span>    <span class="hljs-attr">input:</span> <span class="hljs-string">user_question</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">search_loop</span>    <span class="hljs-string">loop:</span>      <span class="hljs-attr">times:</span> <span class="hljs-number">5</span>      <span class="hljs-string">steps:</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">server:</span> <span class="hljs-string">retriever</span>        <span class="hljs-bullet">-</span> <span class="hljs-attr">server:</span> <span class="hljs-string">generation</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">decide</span>    <span class="hljs-string">branch:</span>      <span class="hljs-string">condition:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{need_more}}</span>"</span>      <span class="hljs-attr">true:</span> <span class="hljs-string">search_loop</span>      <span class="hljs-attr">false:</span> <span class="hljs-string">final_answer</span>
</code></pre>
<p>可以先在 UI 里用画布模式拖出一个流程，再去看同步生成的 YAML 长什么样。有任何不懂的字段，直接问内置智能助手，比翻文档快。</p>
<p>接下来，你就能把你已有的 RAG 逻辑迁到 UltraRAG。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[VertexColor节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7600684978353471515</link>    <guid>https://juejin.cn/post/7600684978353471515</guid>    <pubDate>2026-01-30T02:00:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600684978353471515" data-draft-id="7600615229996007474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[VertexColor节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2026-01-30T02:00:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[VertexColor节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:00:40.000Z" title="Fri Jan 30 2026 02:00:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>VertexColor节点是Unity URP Shader Graph中一个基础且功能强大的节点，它允许着色器访问网格的顶点颜色数据。顶点颜色是存储在网格每个顶点上的颜色信息，可以用于各种视觉效果和着色技术。在实时渲染中，顶点颜色提供了一种高效的方式来为模型添加颜色变化、遮罩信息或其他每顶点数据，而无需额外的纹理采样。</p>
<p>顶点颜色数据通常由3D建模软件（如Blender、Maya、3ds Max）创建并导出，或者在Unity中通过脚本动态修改。每个顶点可以存储RGBA（红、绿、蓝、透明度）四个通道的颜色值，这些值在顶点之间进行插值，然后在片元着色器中使用。</p>
<p>在Shader Graph中，VertexColor节点是连接网格数据与着色器逻辑的重要桥梁。理解并熟练使用这个节点，可以大大扩展着色器的创作可能性，从简单的颜色着色到复杂的动态效果都能实现。</p>
<h2 data-id="heading-0">VertexColor节点基本概念</h2>
<p>顶点颜色是直接存储在网格顶点上的颜色信息，与纹理贴图不同，它不依赖于UV坐标映射，而是与网格的顶点结构紧密相关。当渲染网格时，顶点颜色会在三角形表面进行平滑插值，创造出渐变效果。</p>
<h3 data-id="heading-1">顶点颜色的工作原理</h3>
<p>在计算机图形学中，网格由顶点和三角形组成。每个顶点除了包含位置坐标外，还可以存储其他属性，如法线、纹理坐标和颜色。当Shader Graph使用VertexColor节点时，它实际上是在访问这些预存的顶点颜色数据。</p>
<p>顶点颜色的处理发生在图形管线的不同阶段：</p>
<ul>
<li>在顶点着色器阶段，可以访问原始的顶点颜色值</li>
<li>在光栅化过程中，顶点颜色会在三角形表面进行插值</li>
<li>在片元着色器阶段，可以访问插值后的顶点颜色</li>
</ul>
<p>这种插值机制意味着即使网格的顶点数量相对较少，也能呈现出平滑的颜色过渡效果。</p>
<h3 data-id="heading-2">顶点颜色与纹理的对比</h3>
<p>顶点颜色和纹理贴图都是为模型添加颜色信息的方法，但它们各有优缺点：</p>
<ul>
<li>顶点颜色的优势：
<ul>
<li>性能开销低，不需要纹理采样</li>
<li>不受UV映射问题影响</li>
<li>适合表示大面积的平滑渐变</li>
<li>可以与其他顶点数据（如位置、法线）结合使用</li>
</ul>
</li>
<li>顶点颜色的局限性：
<ul>
<li>分辨率受顶点密度限制</li>
<li>难以表现复杂的图案和细节</li>
<li>修改颜色需要更改网格数据</li>
</ul>
</li>
<li>纹理贴图的优势：
<ul>
<li>可以表现高度复杂的图案和细节</li>
<li>分辨率独立于网格密度</li>
<li>可以重复使用在不同模型上</li>
</ul>
</li>
<li>纹理贴图的局限性：
<ul>
<li>需要额外的内存存储纹理</li>
<li>需要纹理采样操作，有一定性能开销</li>
<li>需要正确的UV映射</li>
</ul>
</li>
</ul>
<p>在实际项目中，顶点颜色和纹理贴图经常结合使用，以发挥各自的优势。</p>
<h2 data-id="heading-3">VertexColor节点端口详解</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/VertexColorNodeThumb.png" alt="" loading="lazy"/></p>
<p>VertexColor节点只有一个输出端口，但理解这个端口的特性和使用方法至关重要。</p>
<h3 data-id="heading-4">输出端口特性</h3>
<p>VertexColor节点的输出端口标记为"Out"，类型为Vector 4，对应RGBA四个通道的颜色值：</p>
<ul>
<li>R通道：红色分量，取值范围通常为[0,1]</li>
<li>G通道：绿色分量，取值范围通常为[0,1]</li>
<li>B通道：蓝色分量，取值范围通常为[0,1]</li>
<li>A通道：透明度分量，取值范围通常为[0,1]</li>
</ul>
<p>输出值取决于当前处理的顶点或片元位置，以及网格的顶点颜色数据。如果网格没有顶点颜色数据，Unity通常会使用默认值（通常是白色或黑色，取决于导入设置）。</p>
<h3 data-id="heading-5">数据类型与精度</h3>
<p>VertexColor节点输出的Vector 4数据类型在Shader Graph中具有完整的浮点精度，这意味着它可以表示非常细微的颜色变化。这种高精度使得顶点颜色适合用于各种计算，而不仅仅是简单的颜色显示。</p>
<p>在内部，顶点颜色数据通常以8位每通道的精度存储（即0-255整数值），但在着色器中被标准化为0-1的浮点值。当在着色器中进行计算时，这些值会以全浮点精度处理，只有在最终输出到帧缓冲区时才会根据显示设备的限制进行量化。</p>
<h2 data-id="heading-6">顶点颜色的创建与导入</h2>
<p>要在Shader Graph中使用VertexColor节点，首先需要确保网格包含顶点颜色数据。有多种方法可以为网格创建和添加顶点颜色。</p>
<h3 data-id="heading-7">在3D建模软件中创建顶点颜色</h3>
<p>大多数专业3D建模软件都支持顶点颜色的创建和编辑：</p>
<ul>
<li>Blender：
<ul>
<li>进入顶点绘制模式（Vertex Paint Mode）</li>
<li>使用画笔工具直接在模型上绘制颜色</li>
<li>可以调整笔刷大小、强度和颜色</li>
<li>支持图层和遮罩等高级功能</li>
</ul>
</li>
<li>Maya：
<ul>
<li>使用顶点颜色集（Vertex Color Sets）</li>
<li>通过颜色绘画工具（Color Paint Tool）直接绘制</li>
<li>支持通过属性编辑器调整颜色值</li>
</ul>
</li>
<li>3ds Max：
<ul>
<li>使用顶点绘制修改器（Vertex Paint Modifier）</li>
<li>提供直观的绘制界面和多种笔刷选项</li>
<li>支持将顶点颜色转换为纹理</li>
</ul>
</li>
</ul>
<p>在导出模型时，确保选择支持顶点颜色的文件格式（如FBX），并检查导出设置中已启用顶点颜色选项。</p>
<h3 data-id="heading-8">在Unity中处理顶点颜色</h3>
<p>将带有顶点颜色的模型导入Unity后，需要检查导入设置以确保顶点颜色被正确识别：</p>
<ul>
<li>在Project窗口中选择模型文件</li>
<li>在Inspector窗口中查看Model选项卡</li>
<li>确保"Import Vertex Colors"选项被启用</li>
<li>检查"Bake IK"和"Optimize Mesh"等选项是否会影响顶点颜色数据</li>
</ul>
<p>如果模型不包含顶点颜色，或者需要修改现有的顶点颜色，可以使用Unity的脚本API动态处理：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 为网格添加顶点颜色的示例代码</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">AddVertexColors</span>(<span class="hljs-params">Mesh mesh, Color[] colors</span>)</span>
{
    <span class="hljs-keyword">if</span> (mesh.vertexCount != colors.Length)
    {
        Debug.LogError(<span class="hljs-string">"顶点颜色数量必须与顶点数量匹配"</span>);
        <span class="hljs-keyword">return</span>;
    }

    mesh.colors = colors;
}

<span class="hljs-comment">// 创建渐变顶点颜色的示例</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CreateGradientVertexColors</span>(<span class="hljs-params">Mesh mesh, Color topColor, Color bottomColor</span>)</span>
{
    Vector3[] vertices = mesh.vertices;
    Color[] colors = <span class="hljs-keyword">new</span> Color[vertices.Length];

    <span class="hljs-comment">// 找到Y轴的最小和最大值</span>
    <span class="hljs-built_in">float</span> minY = <span class="hljs-built_in">float</span>.MaxValue;
    <span class="hljs-built_in">float</span> maxY = <span class="hljs-built_in">float</span>.MinValue;

    <span class="hljs-keyword">foreach</span> (Vector3 vertex <span class="hljs-keyword">in</span> vertices)
    {
        <span class="hljs-keyword">if</span> (vertex.y &lt; minY) minY = vertex.y;
        <span class="hljs-keyword">if</span> (vertex.y &gt; maxY) maxY = vertex.y;
    }

    <span class="hljs-comment">// 根据Y值分配颜色</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; vertices.Length; i++)
    {
        <span class="hljs-built_in">float</span> t = (vertices[i].y - minY) / (maxY - minY);
        colors[i] = Color.Lerp(bottomColor, topColor, t);
    }

    mesh.colors = colors;
}
</code></pre>
<p>这种方法特别适用于程序化生成的网格或需要运行时修改顶点颜色的情况。</p>
<h2 data-id="heading-9">VertexColor节点的基本应用</h2>
<p>VertexColor节点在Shader Graph中有多种基本应用方式，从简单的颜色显示到复杂的材质效果都能实现。</p>
<h3 data-id="heading-10">直接显示顶点颜色</h3>
<p>最简单的应用是直接将顶点颜色输出到材质的基色：</p>
<ul>
<li>创建新的PBR Graph或Unlit Graph</li>
<li>添加VertexColor节点到图中</li>
<li>将VertexColor节点的输出连接到Master节点的Base Color输入</li>
<li>保存并应用材质到带有顶点颜色的模型</li>
</ul>
<p>这种设置会完全按照网格的顶点颜色数据显示模型，适用于展示艺术家的原始设计或验证顶点颜色数据是否正确导入。</p>
<h3 data-id="heading-11">与纹理结合使用</h3>
<p>顶点颜色经常与纹理贴图结合使用，以创建更复杂的材质效果：</p>
<ul>
<li>乘法混合：将顶点颜色与纹理颜色相乘，常用于色调调整或局部变暗/变亮</li>
<li>加法混合：将顶点颜色与纹理颜色相加，常用于发光效果或高光增强</li>
<li>插值混合：使用顶点颜色的某个通道（如Alpha）在两种纹理间进行插值</li>
</ul>
<p>以下是一个乘法混合的示例设置：</p>
<ul>
<li>添加Texture2D节点并分配纹理</li>
<li>添加VertexColor节点</li>
<li>添加Multiply节点</li>
<li>将Texture2D和VertexColor连接到Multiply的输入</li>
<li>将Multiply的输出连接到Base Color</li>
</ul>
<p>这种技术常用于为环境资产添加变化，比如使地面纹理在不同区域呈现不同的色调。</p>
<h3 data-id="heading-12">作为遮罩数据使用</h3>
<p>顶点颜色的各个通道可以单独提取并用作遮罩，控制材质的不同方面：</p>
<ul>
<li>R通道：控制漫反射强度或特殊效果区域</li>
<li>G通道：控制高光强度或金属度</li>
<li>B通道：控制自发光或透明度</li>
<li>A通道：通常用于透明度混合或边缘褪色</li>
</ul>
<p>例如，可以使用顶点颜色的红色通道控制材质的金属度：</p>
<ul>
<li>添加VertexColor节点</li>
<li>使用Split节点分离RGBA通道</li>
<li>将R通道输出连接到Master节点的Metallic输入</li>
<li>调整连接强度可能需要使用Multiply节点进行标量乘法</li>
</ul>
<p>这种方法在角色材质中特别常见，比如在不同部位表现不同的材质属性（皮肤、布料、金属等）。</p>
<h2 data-id="heading-13">高级技巧与创意应用</h2>
<p>除了基本应用，VertexColor节点还可以用于实现各种高级效果和创意着色器。</p>
<h3 data-id="heading-14">动态效果与动画</h3>
<p>顶点颜色可以与时间节点结合，创建动态材质效果：</p>
<ul>
<li>脉动效果：使用正弦函数随时间改变顶点颜色的强度</li>
<li>颜色循环：使用时间节点循环变换顶点颜色的色调</li>
<li>扫描效果：结合顶点位置和顶点颜色创建移动的光带</li>
</ul>
<p>以下是一个简单的脉动效果示例：</p>
<ul>
<li>添加Time节点</li>
<li>添加Sine节点连接到Time</li>
<li>添加Multiply节点调整脉动幅度和频率</li>
<li>添加VertexColor节点</li>
<li>将Sine和VertexColor的输出相乘</li>
<li>连接到Base Color输入</li>
</ul>
<p>这种技术可以用于创建呼吸效果的发光物体、脉动的能量场等动态场景元素。</p>
<h3 data-id="heading-15">程序化地形着色</h3>
<p>在大型地形系统中，顶点颜色常用于混合多种纹理：</p>
<ul>
<li>使用红色通道控制草地纹理的强度</li>
<li>使用绿色通道控制岩石纹理的强度</li>
<li>使用蓝色通道控制沙地纹理的强度</li>
<li>使用Alpha通道控制雪地纹理的强度</li>
</ul>
<p>设置方法：</p>
<ul>
<li>添加多个Texture2D节点，分别代表不同地形类型的纹理</li>
<li>添加VertexColor节点并使用Split分离通道</li>
<li>使用多个Lerp节点根据顶点颜色通道混合纹理</li>
<li>最终混合结果连接到Base Color</li>
</ul>
<p>这种方法允许美术师在3D软件中绘制地形分布，并在Unity中实现复杂的多纹理混合，而无需使用高分辨率的重量纹理。</p>
<h3 data-id="heading-16">特效与粒子系统</h3>
<p>顶点颜色在粒子系统和特效着色器中尤为重要：</p>
<ul>
<li>使用顶点颜色控制粒子生命周期中的颜色变化</li>
<li>结合顶点Alpha通道实现软粒子效果</li>
<li>使用RGB通道存储自定义数据，如速度、大小或旋转</li>
</ul>
<p>在Visual Effect Graph或旧版粒子系统中，可以在着色器中使用VertexColor节点访问粒子颜色数据，实现复杂的粒子行为。</p>
<h2 data-id="heading-17">性能优化与最佳实践</h2>
<p>正确使用VertexColor节点不仅可以创造出色的视觉效果，还能保持高性能。</p>
<h3 data-id="heading-18">性能考量</h3>
<p>顶点颜色数据对性能的影响主要取决于几个因素：</p>
<ul>
<li>网格复杂度：顶点数量越多，需要传输和处理的颜色数据也越多</li>
<li>平台限制：移动设备对顶点数据有更严格的限制</li>
<li>带宽使用：顶点颜色会增加顶点缓冲区的大小，影响内存带宽</li>
</ul>
<p>优化建议：</p>
<ul>
<li>在不需要顶点颜色的模型上禁用顶点颜色导入</li>
<li>使用适当的LOD（Level of Detail）系统，在远距离模型上使用简化的顶点数据</li>
<li>考虑使用顶点颜色与纹理的组合，而不是完全依赖顶点颜色表现细节</li>
</ul>
<h3 data-id="heading-19">工作流程最佳实践</h3>
<p>为了确保顶点颜色工作流程的顺畅，建议遵循以下最佳实践：</p>
<ul>
<li>在3D建模软件中明确命名顶点颜色层，便于识别和管理</li>
<li>在团队中建立统一的顶点颜色通道规范（如R通道总是表示某种特定遮罩）</li>
<li>在Unity中创建材质模板，预设常用的顶点颜色应用模式</li>
<li>使用自定义Shader Graph子图封装复杂的顶点颜色逻辑，提高复用性</li>
</ul>
<h3 data-id="heading-20">调试与问题解决</h3>
<p>当顶点颜色不按预期显示时，可以采取以下调试步骤：</p>
<ul>
<li>检查模型导入设置中的顶点颜色选项是否启用</li>
<li>在Scene视图中使用Vertex Color显示模式可视化顶点颜色数据</li>
<li>在Shader Graph中使用Preview节点检查VertexColor节点的输出值</li>
<li>确保材质正确应用到了目标模型上</li>
<li>检查是否有其他着色器功能（如光照、雾效）覆盖了顶点颜色效果</li>
</ul>
<p>常见问题及解决方案：</p>
<ul>
<li>顶点颜色显示为黑色或白色：可能是模型没有顶点颜色数据，或导入设置不正确</li>
<li>颜色插值不连续：检查网格是否有重复顶点或UV接缝问题</li>
<li>性能突然下降：检查是否在低端设备上使用了高顶点数的网格配合顶点颜色</li>
</ul>
<h2 data-id="heading-21">实际案例分析与实现</h2>
<p>通过具体案例更好地理解VertexColor节点的应用。</p>
<h3 data-id="heading-22">案例一：风格化水体着色器</h3>
<p>创建一个使用顶点颜色控制的水体着色器：</p>
<ul>
<li>使用顶点颜色的蓝色通道控制水深</li>
<li>使用顶点颜色的绿色通道控制水体清澈度</li>
<li>使用顶点颜色的红色通道控制波浪强度</li>
<li>使用顶点Alpha通道控制泡沫分布</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>创建新的PBR Graph</li>
<li>添加VertexColor节点并分离各通道</li>
<li>使用蓝色通道与深度纹理结合计算水下效果</li>
<li>使用绿色通道调整水体透明度</li>
<li>使用红色通道控制法线贴图的强度，模拟波浪</li>
<li>使用Alpha通道混合泡沫纹理</li>
<li>将所有效果组合到Base Color、Normal和Emission输出</li>
</ol>
<p>这种技术允许美术师通过绘制顶点颜色直接控制水体的视觉效果，无需编写复杂的水体着色器代码。</p>
<h3 data-id="heading-23">案例二：可交互的熔岩材质</h3>
<p>创建一个使用顶点颜色和顶点动画的熔岩材质：</p>
<ul>
<li>使用顶点颜色的红色通道控制熔岩温度</li>
<li>使用绿色通道控制熔岩流速</li>
<li>使用蓝色通道控制熔岩发光强度</li>
<li>结合时间节点创建流动效果</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>创建Unlit Graph以完全控制颜色输出</li>
<li>添加VertexColor节点和Time节点</li>
<li>使用噪声纹理和绿色通道创建流动图案</li>
<li>使用红色通道调整熔岩基础颜色（从暗红到亮黄）</li>
<li>使用蓝色通道控制自发光强度</li>
<li>添加顶点偏移模拟熔岩表面的轻微起伏</li>
<li>将所有组件组合到最终颜色输出</li>
</ol>
<p>这种材质可以应用于火山环境、魔法效果或科幻场景中的能量流体。</p>
<h3 data-id="heading-24">案例三：动态植被着色器</h3>
<p>创建响应风效和季节变化的植被着色器：</p>
<ul>
<li>使用顶点红色通道标记树叶位置</li>
<li>使用绿色通道控制树枝弯曲强度</li>
<li>使用蓝色通道控制颜色变化（如季节更替）</li>
<li>使用Alpha通道控制叶片透明度</li>
</ul>
<p>实现步骤：</p>
<ol>
<li>创建PBR Graph支持真实感渲染</li>
<li>添加VertexColor节点并分离通道</li>
<li>使用绿色通道与风效节点结合，实现基于顶点颜色的差异化弯曲</li>
<li>使用蓝色通道与时间节点结合，模拟季节颜色变化</li>
<li>使用红色通道标记的树叶区域应用特殊的透光效果</li>
<li>使用Alpha通道实现叶片边缘透明，减少视觉锯齿</li>
<li>组合所有效果输出到PBR主节点</li>
</ol>
<p>这种着色器可以让植被更加生动自然，同时保持较低的性能开销。</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从内存到磁盘：数据结构选型——ArrayList、HashMap]]></title>    <link>https://juejin.cn/post/7600628279215112218</link>    <guid>https://juejin.cn/post/7600628279215112218</guid>    <pubDate>2026-01-29T12:45:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215112218" data-draft-id="7600628279215095834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从内存到磁盘：数据结构选型——ArrayList、HashMap"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-29T12:45:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SereneDream"/> <meta itemprop="url" content="https://juejin.cn/user/4250057782345273"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从内存到磁盘：数据结构选型——ArrayList、HashMap
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4250057782345273/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SereneDream
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:45:53.000Z" title="Thu Jan 29 2026 12:45:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：数据结构没有好坏，只有场景。</h2>
<p>世界上没有绝对的事情，所有事情，所有的东西都是相对而言。</p>
<p>就像是选择笔记本电脑一样，</p>
<p>轻薄本 不能兼顾太多的性能，但是轻薄本易于携带，更加轻便</p>
<p>游戏本/性能本 重量较大，不方便携带，但是提供了更强大的性能</p>
<p>不同场景中有不同的选择，没有绝对一说</p>
<h2 data-id="heading-1">CPU 缓存的“偏爱”</h2>
<h3 data-id="heading-2">内存与缓存</h3>
<p>相关文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hello-algo.com%2Fchapter_array_and_linkedlist%2Fram_and_cache%2F" target="_blank" title="https://www.hello-algo.com/chapter_array_and_linkedlist/ram_and_cache/" ref="nofollow noopener noreferrer">Hello 算法 - 内存与缓存*</a></p>
<p>我们知道，数据结构中的“数组”与“链表”由于它们采用两种相反的存储策略，因此各种性质和操作效率也呈现对立的特点。</p>
<p>在计算机物理层中，硬盘，内存，缓存 都能够存储数据，但是他们都有对应的特点</p>



































<table><thead><tr><th>****</th><th><strong>硬盘</strong></th><th><strong>内存</strong></th><th><strong>缓存</strong></th></tr></thead><tbody><tr><td>用途</td><td>长期存储数据，包括操作系统、程序、文件等</td><td>临时存储当前运行的程序和正在处理的数据</td><td>存储经常访问的数据和指令，减少 CPU 访问内存的次数</td></tr><tr><td>易失性</td><td>断电后数据不会丢失</td><td>断电后数据会丢失</td><td>断电后数据会丢失</td></tr><tr><td>容量</td><td>较大，TB 级别</td><td>较小，GB 级别</td><td>非常小，MB 级别</td></tr><tr><td>速度</td><td>较慢，几百到几千 MB/s</td><td>较快，几十 GB/s</td><td>非常快，几十到几百 GB/s</td></tr></tbody></table>
<p>多层级的设计并非偶然，而是计算机科学家和工程师们经过深思熟虑的结果。</p>
<ul>
<li><strong>硬盘难以被内存取代</strong>。内存中的数据在断电后会丢失，它不适合长期存储数据。</li>
<li><strong>缓存的大容量和高速度难以兼得</strong>。随着缓存的容量逐步增大，其物理尺寸会变大，与 CPU 核心之间的物理距离会变远，从而导致数据传输时间增加，元素访问延迟变高。</li>
</ul>
<p>而为了使得 CPU 的读写效率更高，CPU 会采取算法，将内存中的可能需要，或者频繁访问的数据加入缓存（内存同理）</p>
<p>如果 CPU 加入缓存的数据恰好是需要使用的数据则叫做 缓存命中</p>
<p>相反叫做 缓存未命中，若是缓存未命中就意味着 CPU 需要再耗费时间和性能从内存，甚至是硬盘中获取对应的数据，那样子太耗费时间和性能</p>
<p>这也引申出了 缓存命中率（即 CPU 从缓存中获取成功数据的比例）</p>
<h3 data-id="heading-3">缓存的数据结构</h3>
<p>缓存的底层既可以使用数组，也可以使用链表，以下是在 Java 中使用数组和链表构建的缓存亲和度对比，实验记录了 CPU 使用不同底层数据结构（底层是数组或链表）进行相同活动（插入数据）所损耗的时间</p>
<p>代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ArrayList 的底层使用【数组】实现</span>
        List&lt;Integer&gt; arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// 记录开始前时间</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().getTime();

        <span class="hljs-comment">// 往当前 arrayList 中插入巨量数据</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
            arrayList.add(i);
        }

        <span class="hljs-comment">// 记录结束时间</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">nowTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().getTime();

        System.out.printf(<span class="hljs-string">"当前使用的数据结构底层使用【数组】，使用了百万次插入方法消耗的时间为 %d "</span>, nowTime - time);
    }
}
</code></pre>
<p>运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85607a0c2a3b4d5a937d3b56edccf595~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=osTW33V3VnVWNbXJFhk%2FB3r5jiE%3D" alt="" loading="lazy"/></p>
<p>代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// linkedList 的底层使用【链表】实现</span>
        List&lt;Integer&gt; linkedList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();

        <span class="hljs-comment">// 记录开始前时间</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().getTime();

        <span class="hljs-comment">// 往当前 linkedList 中插入巨量数据</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
            linkedList.add(i);
        }

        <span class="hljs-comment">// 记录结束时间</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">nowTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().getTime();

        System.out.printf(<span class="hljs-string">"当前使用的数据结构底层使用【链表】，使用了百万次插入方法消耗的时间为 %d "</span>, nowTime - time);
    }
}
</code></pre>
<p>运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53329c72b0064f778d73065ca2df2f73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=X2iGn%2BO56RNq7IktyFZKVd1bliQ%3D" alt="" loading="lazy"/></p>
<p>对比两次实验我们不难发现，使用数组所损耗的时间远小于链表</p>
<h4 data-id="heading-4">为什么数组的缓存亲和度会比链表高？</h4>
<p>无论是数据还是链表，当在创建之后，他都会进入内存，而 CPU 会根据缓存命中算法来提高效率</p>
<p><strong>缓存中数组和链表的利用效率是不同的</strong></p>
<ul>
<li><strong>占用空间</strong>：链表元素比数组元素占用空间更多（链表除去本身存储的数据除外还需要存储下一个链表的地址值），导致缓存中容纳的有效数据量更少。</li>
<li><strong>缓存行</strong>：链表数据分散在内存各处，而缓存是“按行加载”的，因此加载到无效数据的比例更高。</li>
<li><strong>预取机制</strong>：数组比链表的数据访问模式更具“可预测性”（因为数组在内存中的地址是连续的），即系统更容易猜出即将被加载的数据。</li>
<li><strong>空间局部性</strong>：数组被存储在集中的内存空间中，因此被加载数据附近的数据更有可能即将被访问。</li>
</ul>
<p>总体而言，<strong>数组具有更高的缓存命中率，因此它在操作效率上通常优于链表</strong>。这使得在解决算法问题时，基于数组实现的数据结构往往更受欢迎。</p>
<h2 data-id="heading-5">内存中 JDK 哈希奇闻：链表会进化成红黑树？</h2>
<h3 data-id="heading-6">哈希表是什么？</h3>
<p>哈希表，是一个键（key）对应一个值（value）的键值对散列表。字典/映射/map 通常使用哈希表来实现</p>
<p>“桶”是存储数据的基本单元。哈希函数将一个键转换成一个数组索引，这个索引对应的位置就是一个“桶”。</p>
<p>桶可以简单理解成哈希表中对应的值（value）</p>
<h4 data-id="heading-7">如何实现</h4>
<p>从本质上看，哈希函数的作用是将所有 <code>key</code> 构成的输入空间映射到数组所有索引构成的输出空间，而输入空间往往远大于输出空间。</p>
<p>注意！这里的空间指的是地址值，举一个简单的例子：</p>
<p>我们使用数组来模拟哈希表，那么数组若是在内存中的地址为 0~255，则代表哈希表的 value 必须映射到对应的地址，而数组中的偏移量（下标）刚好与数组内的数据唯一对应，所以我们可以采取 - 想存入哈希表的元素地址，我们对 255 取余，余后就是需要被放入数组的地址值</p>
<h3 data-id="heading-8">哈希冲突！</h3>
<p>由于输入的空间往往远大于输入空间，因此，<strong>理论上一定存在“多个输入对应相同输出”的情况</strong></p>
<p>哈希冲突，由此产生</p>
<h4 data-id="heading-9">如何解决哈希冲突</h4>
<h5 data-id="heading-10">最笨的方式：扩容</h5>
<p>哈希表容量越大，多个 <code>key</code> 被分配到同一个桶中的概率就越低，冲突就越少。因此，<strong>我们可以通过扩容哈希表来减少哈希冲突</strong>。</p>
<p>但是我们不难想到频繁扩容带来的后果：</p>
<ol>
<li>哈希表的构建需要哈希值 / 哈希表中每个值（value）都需要 键（key）% 对应的哈希表长度（初始数组长度）</li>
<li>产生冲突之后进行扩容会改变哈希表长度（初始数组长度被改变）</li>
</ol>
<p>这样子会引发一些问题：哈希表一旦扩容，内部的键值对需要重新洗牌存入，这样子做即耗时又损耗性能</p>
<h5 data-id="heading-11">JDK 底层是如何解决哈希冲突的</h5>
<p>以下是 JDK 源码 HashMap 注释文档部分，我进行了机翻和转述，其中讲述了 JDK 底层对于 哈希表 的各种操作，提及了线程安全和负载因子</p>
<pre><code class="hljs language-markdown" lang="markdown">/**
<span class="hljs-bullet"> *</span> Hash table based implementation of the {@code Map} interface.  This
<span class="hljs-bullet"> *</span> implementation provides all of the optional map operations, and permits
<span class="hljs-bullet"> *</span> {@code null} values and the {@code null} key.  (The {@code HashMap}
<span class="hljs-bullet"> *</span> class is roughly equivalent to {@code Hashtable}, except that it is
<span class="hljs-bullet"> *</span> unsynchronized and permits nulls.)  This class makes no guarantees as to
<span class="hljs-bullet"> *</span> the order of the map; in particular, it does not guarantee that the order
<span class="hljs-bullet"> *</span> will remain constant over time.
<span class="hljs-bullet"> *</span> 【第一段讲解了相关与 HashMap 类实现的相关内容】
<span class="hljs-bullet"> *</span> 基于哈希表的Map接口实现。
<span class="hljs-bullet"> *</span> 此实现提供了所有可选的映射操作，并允许使用null值和null键。
<span class="hljs-bullet"> *</span> （HashMap类大致等同于Hashtable，但它是非同步的，且允许使用null值。）
<span class="hljs-bullet"> *</span> 此类不对映射的顺序做出任何保证；特别是，它不保证顺序会随时间保持不变。
<span class="hljs-bullet"> *</span> 【即： HashMap 在 push 后不保证数据在物理地址以及逻辑地址上的先后性】
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>This implementation provides constant-time performance for the basic
<span class="hljs-bullet"> *</span> operations ({@code get} and {@code put}), assuming the hash function
<span class="hljs-bullet"> *</span> disperses the elements properly among the buckets.  Iteration over
<span class="hljs-bullet"> *</span> collection views requires time proportional to the "capacity" of the
<span class="hljs-bullet"> *</span> {@code HashMap} instance (the number of buckets) plus its size (the number
<span class="hljs-bullet"> *</span> of key-value mappings).  Thus, it's very important not to set the initial
<span class="hljs-bullet"> *</span> capacity too high (or the load factor too low) if iteration performance is
<span class="hljs-bullet"> *</span> important.
<span class="hljs-bullet"> *</span> 此实现为基本操作（get 和 put）提供了常数时间性能【即：时间复杂度为 O(1)】，
<span class="hljs-bullet"> *</span> 前提是哈希函数【即：哈希算法】能在桶【②桶可以简单理解成哈希表中对应的值（value）】之间正确分散元素。
<span class="hljs-bullet"> *</span> 【即：如果发生了错误导致哈希冲突，所有的数据都堆砌到同一个桶中，虽然 JDK 会将对应的链表转为红黑树，但是会使得查找和添加的时间复杂度上升】
<span class="hljs-bullet"> *</span> 遍历集合视图所需的时间与 HashMap 实例的“容量”（桶的数量）加上其大小（键值映射的数量）成正比。
<span class="hljs-bullet"> *</span> 【①遍历 HashMap 的时间 与 HashMap 底层哈希表（组成哈希表的数组）的大小和哈希表中存储的值的数量 成正比】
<span class="hljs-bullet"> *</span> 因此，如果遍历性能很重要，则不要将初始容量【即哈希表初始大小】设置得太高（或将负载因子设置得太低），这一点非常重要。
<span class="hljs-bullet"> *</span> 【负载因子是一个数值，为哈希表的元素数量除以桶数量】
<span class="hljs-bullet"> *</span> 【这里提及了负载因子和初始容量，初始容量设置得过高会使得遍历性能下降，】
<span class="hljs-bullet"> *</span> 【而负载因子设置的太低会导致 HashMap 底层的哈希表扩容的频率提高（引发初始容量升高）】
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>An instance of {@code HashMap} has two parameters that affect its
<span class="hljs-bullet"> *</span> performance: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>initial capacity<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span> and <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>load factor<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span>.  The
<span class="hljs-bullet"> *</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>capacity<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span> is the number of buckets in the hash table, and the initial
<span class="hljs-bullet"> *</span> capacity is simply the capacity at the time the hash table is created.  The
<span class="hljs-bullet"> *</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>load factor<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span> is a measure of how full the hash table is allowed to
<span class="hljs-bullet"> *</span> get before its capacity is automatically increased.  When the number of
<span class="hljs-bullet"> *</span> entries in the hash table exceeds the product of the load factor and the
<span class="hljs-bullet"> *</span> current capacity, the hash table is <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>rehashed<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span> (that is, internal data
<span class="hljs-bullet"> *</span> structures are rebuilt) so that the hash table has approximately twice the
<span class="hljs-bullet"> *</span> number of buckets.
<span class="hljs-bullet"> *</span> HashMap的一个实例有两个影响其性能的参数：初始容量【即哈希表初始大小】和负载因子（翻译可能会翻译成加载因子，需要注意）。
<span class="hljs-bullet"> *</span> 【即：哈希表的底层有两个参数会影响其性能，可能是遍历（容量越大遍历时间越长，在上一段①处标明成正比关系）】
<span class="hljs-bullet"> *</span> 【也可能是说当哈希表重新哈希化增加哈希表容量这一过程（在重新哈希化的过程中需要耗费额外性能进行操作）】
<span class="hljs-bullet"> *</span> 容量是指哈希表中的桶数【哈希表中能容纳多少的桶】，而初始容量则是指哈希表创建时的容量。
<span class="hljs-bullet"> *</span> 负载因子是衡量哈希表在自动增加容量之前允许达到的满载程度的一个指标。
<span class="hljs-bullet"> *</span> 【JDK 底层会使用一个哈希表扩容算法，其中 负载因子 到达一定的数值时哈希表会扩容】
<span class="hljs-bullet"> *</span> 当哈希表中的元素数超过负载因子与当前容量的乘积时，哈希表会被重新哈希化（即重建内部数据结构），以便哈希表中的桶数大约增加一倍。
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>As a general rule, the default load factor (.75) offers a good
<span class="hljs-bullet"> *</span> tradeoff between time and space costs.  Higher values decrease the
<span class="hljs-bullet"> *</span> space overhead but increase the lookup cost (reflected in most of
<span class="hljs-bullet"> *</span> the operations of the {@code HashMap} class, including
<span class="hljs-bullet"> *</span> {@code get} and {@code put}).  The expected number of entries in
<span class="hljs-bullet"> *</span> the map and its load factor should be taken into account when
<span class="hljs-bullet"> *</span> setting its initial capacity, so as to minimize the number of
<span class="hljs-bullet"> *</span> rehash operations.  If the initial capacity is greater than the
<span class="hljs-bullet"> *</span> maximum number of entries divided by the load factor, no rehash
<span class="hljs-bullet"> *</span> operations will ever occur.
<span class="hljs-bullet"> *</span> 通常，默认的负载因子（0.75）在时间和空间成本之间取得了良好的平衡。
<span class="hljs-bullet"> *</span> 更高的值会减少空间开销，但会增加查找成本（体现在HashMap类的大多数操作中，包括get和put）。
<span class="hljs-bullet"> *</span> 【当哈希表固定大小时只有固定的几个桶存储数据，在 JDK 中会采取链表 -&gt; 红黑树 来进行桶扩容操作，本意是降低查找成本】
<span class="hljs-bullet"> *</span> 【但当这个红黑树过大时，相对于直接扩容哈希表，查找成本较高】
<span class="hljs-bullet"> *</span> 在设置其初始容量时，应考虑映射中预期的元素数及其负载因子，以尽量减少重新哈希操作的数量。
<span class="hljs-bullet"> *</span> 【上文提及，频繁哈希化很影响性能】
<span class="hljs-bullet"> *</span> 如果初始容量大于元素最大数量除以负载因子所得的值，则永远不会发生重新哈希操作。
<span class="hljs-bullet"> *</span> 【哈希表的元素数量 / 桶数量 = 负载因子的值】
<span class="hljs-bullet"> *</span> 【元素最大数量除以负载因子所得的值 是 负载因子的逆推公式，仅此而已】
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>If many mappings are to be stored in a {@code HashMap}
<span class="hljs-bullet"> *</span> instance, creating it with a sufficiently large capacity will allow
<span class="hljs-bullet"> *</span> the mappings to be stored more efficiently than letting it perform
<span class="hljs-bullet"> *</span> automatic rehashing as needed to grow the table.  Note that using
<span class="hljs-bullet"> *</span> many keys with the same {@code hashCode()} is a sure way to slow
<span class="hljs-bullet"> *</span> down performance of any hash table. To ameliorate impact, when keys
<span class="hljs-bullet"> *</span> are {@link Comparable}, this class may use comparison order among
<span class="hljs-bullet"> *</span> keys to help break ties.
<span class="hljs-bullet"> *</span> 如果要在HashMap实例中存储多个映射，那么使用足够大的容量来创建它，相比于让它根据需要自动重新散列以扩展表，将能更高效地存储这些映射。
<span class="hljs-bullet"> *</span> 【这里 JDK 底层提及了：如果使用了足够大的容量去创建哈希表（引起哈希冲突的概率无限小），这会比让哈希表的桶生成链表更高效（单指时间复杂度）】
<span class="hljs-bullet"> *</span> 请注意，使用多个具有相同hashCode()的键肯定会降低任何哈希表的性能。
<span class="hljs-bullet"> *</span> 【即如果存在两个相同映射的键值对存入一个桶中，那么这个存在重复映射的哈希表 比 一个重复映射都没有的哈希表 性能低】
<span class="hljs-bullet"> *</span> 为了减轻影响，当键是Comparable时，这个类可能会使用键之间的比较顺序来帮助打破平局
<span class="hljs-bullet"> *</span> 【减轻重复键值对的影响】
<span class="hljs-bullet"> *</span> 【这里 JDK 创建了一个新的类 - Comparable，这是一个接口，只有一个方法：compareTo 比较的意思】
<span class="hljs-bullet"> *</span> 【打破平局的意思是： 单纯比较的意思】
<span class="hljs-bullet"> *</span> 【注：目前还不知道为什么比较，以及比较什么东西，再往下看看】
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span></span>Note that this implementation is not synchronized.<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span></span>
<span class="hljs-bullet"> *</span> If multiple threads access a hash map concurrently, and at least one of
<span class="hljs-bullet"> *</span> the threads modifies the map structurally, it <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>must<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span> be
<span class="hljs-bullet"> *</span> synchronized externally.  (A structural modification is any operation
<span class="hljs-bullet"> *</span> that adds or deletes one or more mappings; merely changing the value
<span class="hljs-bullet"> *</span> associated with a key that an instance already contains is not a
<span class="hljs-bullet"> *</span> structural modification.)  This is typically accomplished by
<span class="hljs-bullet"> *</span> synchronizing on some object that naturally encapsulates the map.
<span class="hljs-bullet"> *</span> If no such object exists, the map should be "wrapped" using the
<span class="hljs-bullet"> *</span> {@link Collections#synchronizedMap Collections.synchronizedMap}
<span class="hljs-bullet"> *</span> method.  This is best done at creation time, to prevent accidental
<span class="hljs-bullet"> *</span> unsynchronized access to the map:<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span></span>
<span class="hljs-bullet"> *</span>   Map m = Collections.synchronizedMap(new HashMap(...));<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span></span>
<span class="hljs-bullet"> *</span> 【这段话表达了，为了保障 HashMap 的线程安全性，不允许多个线程同时访问，所以给他加了锁】
<span class="hljs-bullet"> *</span> 请注意，此实现不是同步的。
<span class="hljs-bullet"> *</span> 如果多个线程同时访问 HashMap，并且至少有一个线程在结构上修改了映射，
<span class="hljs-bullet"> *</span> 则必须在外部进行同步。
<span class="hljs-bullet"> *</span> 【这段话的意思是，如果上述情况可能会发生，那么我们必须要对其进行互斥操作，也就是加锁】
<span class="hljs-bullet"> *</span> （结构修改是添加或删除一个或多个映射的任何操作；仅仅更改与实例已包含的键关联的值不是结构修改。）
<span class="hljs-bullet"> *</span> 这通常是通过在自然封装映射的某个对象上同步来实现的。
<span class="hljs-bullet"> *</span> 如果不存在这样的对象，则应使用Collections.synchronizedMap方法对映射进行“包装”。
<span class="hljs-bullet"> *</span> 这最好在创建时完成，以防止意外不同步地访问 map
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>The iterators returned by all of this class's "collection view methods"
<span class="hljs-bullet"> *</span> are <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>fail-fast<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span>: if the map is structurally modified at any time after
<span class="hljs-bullet"> *</span> the iterator is created, in any way except through the iterator's own
<span class="hljs-bullet"> *</span> {@code remove} method, the iterator will throw a
<span class="hljs-bullet"> *</span> {@link ConcurrentModificationException}.  Thus, in the face of concurrent
<span class="hljs-bullet"> *</span> modification, the iterator fails quickly and cleanly, rather than risking
<span class="hljs-bullet"> *</span> arbitrary, non-deterministic behavior at an undetermined time in the
<span class="hljs-bullet"> *</span> future.
<span class="hljs-bullet"> *</span> 【即：当 HashMap 被一个进程使用时，另一个进程想要访问，会使得前一个进程报错】
<span class="hljs-bullet"> *</span> 此类所有“集合视图方法”返回的迭代器都是快速失败的：
<span class="hljs-bullet"> *</span> 如果在迭代器创建后的任何时候，
<span class="hljs-bullet"> *</span> 以除迭代器自身的remove方法外的任何方式对映射进行结构修改，
<span class="hljs-bullet"> *</span> 迭代器将抛出ConcurrentModificationException。
<span class="hljs-bullet"> *</span> 因此，面对并发修改，迭代器会快速且干净地失败，而不是冒着在未来不确定的时间产生任意、非确定性行为的风险。
<span class="hljs-bullet"> *</span> 【这一段话的含义是： 倘若一个线程正在访问 HashMap 时，另一个线程也想访问，则会返回 ConcurrentModificationException 错误，并终止两个线程】
<span class="hljs-bullet"> *</span> 【详情请见实验 makeConcurrentModificationException 见本文最下方附件】
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>Note that the fail-fast behavior of an iterator cannot be guaranteed
<span class="hljs-bullet"> *</span> as it is, generally speaking, impossible to make any hard guarantees in the
<span class="hljs-bullet"> *</span> presence of unsynchronized concurrent modification.  Fail-fast iterators
<span class="hljs-bullet"> *</span> throw {@code ConcurrentModificationException} on a best-effort basis.
<span class="hljs-bullet"> *</span> Therefore, it would be wrong to write a program that depended on this
<span class="hljs-bullet"> *</span> exception for its correctness: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span></span>the fail-fast behavior of iterators
<span class="hljs-bullet"> *</span> should be used only to detect bugs.<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span>
<span class="hljs-bullet"> *</span> 【还是那句话，为了保障 HashMap 的线程安全， JDK 做了什么】
<span class="hljs-bullet"> *</span> 请注意，此实现不是同步的。
<span class="hljs-bullet"> *</span> 如果多个线程同时访问哈希映射，
<span class="hljs-bullet"> *</span> 并且至少有一个线程在结构上修改了映射，则必须在外部进行同步。
<span class="hljs-bullet"> *</span> （结构修改是添加或删除一个或多个映射的任何操作；仅仅更改与实例已包含的键关联的值不是结构修改。）
<span class="hljs-bullet"> *</span> 这通常是通过在自然封装映射的某个对象上同步来实现的。
<span class="hljs-bullet"> *</span> 如果不存在这样的对象，则应使用Collections.synchronizedMap方法对映射进行“包装”。
<span class="hljs-bullet"> *</span> 这最好在创建时完成，以防止意外不同步地访问地图：
<span class="hljs-bullet"> *</span>
 * <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span>This class is a member of the
<span class="hljs-bullet"> *</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{@docRoot}/java.base/java/util/package-summary.html#CollectionsFramework"</span>&gt;</span></span>
<span class="hljs-bullet"> *</span> Java Collections Framework<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>.
<span class="hljs-bullet"> *</span>
 * @param <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">K</span>&gt;</span></span> the type of keys maintained by this map
<span class="hljs-bullet"> *</span> @param <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">V</span>&gt;</span></span> the type of mapped values
<span class="hljs-bullet"> *</span> @author Doug Lea
<span class="hljs-bullet"> *</span> @author Josh Bloch
<span class="hljs-bullet"> *</span> @author Arthur van Hoff
<span class="hljs-bullet"> *</span> @author Neal Gafter
<span class="hljs-bullet"> *</span> @see Object#hashCode()
<span class="hljs-bullet"> *</span> @see Collection
<span class="hljs-bullet"> *</span> @see Map
<span class="hljs-bullet"> *</span> @see TreeMap
<span class="hljs-bullet"> *</span> @see Hashtable
<span class="hljs-bullet"> *</span> @since 1.2
 <span class="hljs-emphasis">*/
</span></code></pre>
<p>以下仍是 JDK 源码，简述了 JDK 对于哈希表的策略</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*
 * Implementation notes.
 *
 * This map usually acts as a binned (bucketed) hash table, but
 * when bins get too large, they are transformed into bins of
 * TreeNodes, each structured similarly to those in
 * java.util.TreeMap. Most methods try to use normal bins, but
 * relay to TreeNode methods when applicable (simply by checking
 * instanceof a node).  Bins of TreeNodes may be traversed and
 * used like any others, but additionally support faster lookup
 * when overpopulated. However, since the vast majority of bins in
 * normal use are not overpopulated, checking for existence of
 * tree bins may be delayed in the course of table methods.
 * 此映射通常充当一个分箱（bucketed）哈希表，
 * 【分箱可以简单理解为 桶】
 * 但当分箱太大时，它们会被转换为 TreeNodes 的分箱，每个分箱的结构都类似于java.util.中的分箱、树状图。
 * 【当 哈希表 桶内链表太大了，就会被转成树】
 * 大多数方法都尝试使用普通的容器，但在适用的情况下会中继到TreeNode方法（只需检查节点的实例）。
 * 【大多数时候都会采取链表，或者其他的普通桶，但是在合适的时候会转变成树】
 * TreeNodes的Bins【桶】可以像其他任何Bins一样被遍历和使用，但在过度填充时还支持更快的查找。
 * 然而，由于正常使用中的绝大多数桶都没有“人满为患”，在表格方法的过程中可能会延迟检查树箱的存在。
 *
 * Tree bins (i.e., bins whose elements are all TreeNodes) are
 * ordered primarily by hashCode, but in the case of ties, if two
 * elements are of the same "class C implements Comparable&lt;C&gt;",
 * type then their compareTo method is used for ordering. (We
 * conservatively check generic types via reflection to validate
 * this -- see method comparableClassFor).  The added complexity
 * of tree bins is worthwhile in providing worst-case O(log n)
 * operations when keys either have distinct hashes or are
 * orderable, Thus, performance degrades gracefully under
 * accidental or malicious usages in which hashCode() methods
 * return values that are poorly distributed, as well as those in
 * which many keys share a hashCode, so long as they are also
 * Comparable. (If neither of these apply, we may waste about a
 * factor of two in time and space compared to taking no
 * precautions. But the only known cases stem from poor user
 * programming practices that are already so slow that this makes
 * little difference.)
 * 树容器（即其元素都是TreeNode的容器）主要按hashCode排序，
 * 但在关系的情况下，如果两个元素属于相同的“类C实现Comparable&lt;C&gt;”，则使用其compareTo方法进行排序。
 * 【这里能发现 JDK 转变的是红黑树 - 从根节点开始，大于当前节点的树向向右，小于当前节点的树向左】
 * （我们通过反射保守地检查泛型类型以验证这一点——请参阅方法compareClassFor）。
 * 当键具有不同的哈希值或可排序时，树箱的额外复杂性在提供最坏情况下的O（log n）操作方面是值得的。
 * 【当发生哈希冲突过多，导致链表过长时，转变为红黑树会降低时间复杂度】
 * 因此，在意外或恶意使用下，性能会优雅地下降，
 * 【这里说，如果有人想要恶意使用相同的键值对想要搞崩哈希表，转变为红黑树的桶能降低性能损耗】
 * 其中hashCode()方法返回分布不均的值，以及许多键共享hashCode的值，只要它们也是可比的。
 * 【这里说，只要 桶 内元素的哈希值是可比的，红黑树就塞得下】
 * （如果这两种情况都不适用，与不采取预防措施相比，我们可能会浪费大约两倍的时间和空间。
 * 【如果这两个策略都不去使用，那就会浪费大概两倍的空间和时间】
 * 但唯一已知的情况源于糟糕的用户编程实践，这些实践已经非常缓慢，几乎没有什么区别。）
 * 【这里 JDK 开发者在吐槽】
 *
 * Because TreeNodes are about twice the size of regular nodes, we
 * use them only when bins contain enough nodes to warrant use
 * (see TREEIFY_THRESHOLD). And when they become too small (due to
 * removal or resizing) they are converted back to plain bins.  In
 * usages with well-distributed user hashCodes, tree bins are
 * rarely used.  Ideally, under random hashCodes, the frequency of
 * nodes in bins follows a Poisson distribution
 * (http://en.wikipedia.org/wiki/Poisson_distribution) with a
 * parameter of about 0.5 on average for the default resizing
 * threshold of 0.75, although with a large variance because of
 * resizing granularity. Ignoring variance, the expected
 * occurrences of list size k are (exp(-0.5) * pow(0.5, k) /
 * factorial(k)).
 * 因为TreeNodes的大小大约是常规节点的两倍，所以我们只在容器包含足够的节点时才使用它们（请参阅TREEIFY_THRESHOLD）。
 * 【这里说树的空间更大，只有空间足够时才会用】
 * 当它们变得太小（由于删除或调整大小）时，它们会被转换回普通垃圾箱。
 * 【这里说，如果树变小了，那可能会调整回链表】
 * 在使用分布良好的用户hashCode时，很少使用树箱。
 * 理想情况下，在随机hashCode下，bin中节点的频率遵循泊松分布默认的调整大小阈值0.75的参数平均约为0.5，尽管由于调整大小的粒度存在较大的差异。
 * 忽略方差，列表大小k的预期出现次数为（exp（-0.5）*pow（0.5，k）/阶乘（k））。
 * 【这里说产生树最大子节点的概率】
 *
 * The first values are:
 *
 * 0:    0.60653066
 * 1:    0.30326533
 * 2:    0.07581633
 * 3:    0.01263606
 * 4:    0.00157952
 * 5:    0.00015795
 * 6:    0.00001316
 * 7:    0.00000094
 * 8:    0.00000006
 * more: less than 1 in ten million
 *
 * The root of a tree bin is normally its first node.  However,
 * sometimes (currently only upon Iterator.remove), the root might
 * be elsewhere, but can be recovered following parent links
 * (method TreeNode.root()).
 * 树bin的根通常是它的第一个节点。
 * 然而，有时（目前仅在Iterator.remove时），根可能在其他地方，但可以在父链接后恢复（方法TreeNode.root（））。
 *
 * All applicable internal methods accept a hash code as an
 * argument (as normally supplied from a public method), allowing
 * them to call each other without recomputing user hashCodes.
 * Most internal methods also accept a "tab" argument, that is
 * normally the current table, but may be a new or old one when
 * resizing or converting.
 * 所有适用的内部方法都接受哈希码作为参数（通常由公共方法提供），允许它们在不重新计算用户哈希码的情况下相互调用。
 * 大多数内部方法也接受“tab”参数，通常是当前表，但在调整大小或转换时可能是新的或旧的。
 *
 * When bin lists are treeified, split, or untreeified, we keep
 * them in the same relative access/traversal order (i.e., field
 * Node.next) to better preserve locality, and to slightly
 * simplify handling of splits and traversals that invoke
 * iterator.remove. When using comparators on insertion, to keep a
 * total ordering (or as close as is required here) across
 * rebalancings, we compare classes and identityHashCodes as
 * tie-breakers.
 * 当bin列表被树化、拆分或未经测试时，
 * 我们将它们保持在相同的相对访问/遍历顺序中（即字段Node.next），以更好地保持局部性，并稍微简化对调用itera.remove的拆分和遍历的处理。
 * 当在插入时使用比较器时，为了在重新平衡过程中保持总顺序（或尽可能接近此处要求的顺序），
 * 我们将类和identityHashCodes作为连接断路器进行比较。
 *
 * The use and transitions among plain vs tree modes is
 * complicated by the existence of subclass LinkedHashMap. See
 * below for hook methods defined to be invoked upon insertion,
 * removal and access that allow LinkedHashMap internals to
 * otherwise remain independent of these mechanics. (This also
 * requires that a map instance be passed to some utility methods
 * that may create new nodes.)
 * 子类LinkedHashMap的存在使纯模式与树模式之间的使用和转换变得复杂。
 * 请参阅下文，了解在插入、删除和访问时定义的钩子方法，这些方法允许LinkedHashMap内部保持独立于这些机制。
 * （这也要求将映射实例传递给一些可能创建新节点的实用方法。）
 *
 * The concurrent-programming-like SSA-based coding style helps
 * avoid aliasing errors amid all of the twisty pointer operations.
 */</span>
</code></pre>
<p>以下是 JDK 怎么使用这些策略的</p>
<p>其中的重要分支（下图红色方框），则代表 判断链表长度是否满足创建树的条件，当条件满足时创建树，而这个创建树的条件是，链表长度大于 8</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/864e025aa47f424889113c1ad13a5148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=qUpyVU0Xs%2FxMozFTfrqTo2d3FUM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">哈希算法</h3>
<p>哈希算法在源码中及其精简</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8537970af06a472f8f7c6f6278e104e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=kPTH8Qck4SN3mvOLiqilYFSbPao%3D" alt="" loading="lazy"/></p>
<p>你敢相信，这一段就是哈希算法吗？</p>
<p>让我们分割一下每一段运算，我们首先得知道：哈希值二进制是 32 位</p>
<ul>
<li>三元运算符：先判断 key 是否为 null 如果是 返回 0，如果不是 返回后面这一大段看起来很复杂的运算式</li>
<li>获取当前 key 的哈希值，并将它赋值给 h</li>
<li>将 h (32 位) 右移 16 位</li>
<li>按位异或 两个 32 位数</li>
</ul>
<p>着重讲一下为什么右移 bit 位、按位异或是什么以及为什么要按位异或</p>
<ul>
<li>右移 16 位的原因：结合哈希表的计算公式(哈希值对桶数量（数组长度）<code>capacity</code> 取模，从而获取该 <code>key</code> 对应的桶（数组索引）<code>index</code>)和桶数量不会过大这两个我们能知道，哈希表计算时基本上只有低位在进行运算，右移 16 位是获取当前哈希值的最高位。</li>
<li>什么是按位异或： 异或的规则非常简单：两个位相同则为 0，不同则为 1。</li>
<li>为什么要按位异或：为了扰动函数 (Perturbation) ，能让哈希值的高位与低位都参与运算，让高位的信息也参与到下标计算中，把“冲突”的概率降到最低。</li>
</ul>
<h5 data-id="heading-13">扩容机制</h5>
<p>扩容机制在 JDK 1.7 之前和 JDK 1.8 之后有着天壤之别</p>
<ul>
<li>JDK 1.7 之前： 扩容时需要重新计算每个元素的 Hash 值再塞到新表里，非常耗性能。</li>
<li>JDK 1.8 之后：👇</li>
</ul>
<p>利用了“扩容是 2 倍”的特性，不需要重新计算 Hash。它只需要检查 Hash 值中新增的那一个二进制位。</p>
<p>如果是 0：下标不变。</p>
<p>如果是 1：下标变为 原下标 + 原容量。</p>
<p>这极其高效，因为这只是一个简单的位运算判断，避免了大量的取模运算。这就是计算机底层位运算的魅力！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3d8697299684d5a82b9de4d269dce61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=8K0SyytFXENONg76C%2BEShxt9Dc8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">总结：</h2>
<p>内存里追求 CPU 缓存命中（用数组）。</p>
<p>复杂计算追求时间复杂度（用红黑树）。</p>
<p>磁盘存储追求减少 I/O（用 B+ 树）。</p>
<h2 data-id="heading-15">附件</h2>
<h3 data-id="heading-16">makeConcurrentModificationException</h3>
<p>代码：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-comment">/**
 * Writer: Serene Dream
 * Time: 2025/11/25 : 19:58
 * Explanation:
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">makeConcurrentModificationException</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        <span class="hljs-comment">// 先在 map 中增加一些数据</span>
        HashMap&lt;Integer, Integer&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
            map.<span class="hljs-built_in">put</span>(i, i);
        }
        <span class="hljs-comment">// 两个进程，一个进程在使用 HashMap 还未完成时，另一个进程插入会发生什么</span>

        Thread t1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Thread</span>(() -&gt; {
            <span class="hljs-comment">// 第一个进程对 map 内容进行访问，遍历</span>
            <span class="hljs-comment">// 我发现 map 中没有迭代器，只有对应的 Set 中才有，但是迭代器的作用就是循环，所以我认为迭代器的意思就是循环遍历</span>
            <span class="hljs-comment">// 文档中迭代器的意思可能代指正在遍历访问 HashMap 或者修改其中数据</span>
            Set&lt;Integer&gt; set = map.<span class="hljs-built_in">keySet</span>();
            <span class="hljs-keyword">for</span> (Integer key : set) {
                Integer value = map.<span class="hljs-built_in">get</span>(key);
                System.out.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"key = %d， value = %d"</span>, key, value);

                <span class="hljs-comment">// 让进程循环中开始睡眠，模拟还在占用 HashMap</span>
                <span class="hljs-keyword">try</span> {
                    Thread.<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1000</span>);
                } <span class="hljs-built_in">catch</span> (InterruptedException e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(e);
                }
            }
        });

        Thread t2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Thread</span>(() -&gt; {
            <span class="hljs-comment">// 让进程二睡眠一会，保证进程二在访问 HashMap 时 HashMap 必须被 t1 占用</span>
            <span class="hljs-keyword">try</span> {
                Thread.<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1000</span>);
            } <span class="hljs-built_in">catch</span> (InterruptedException e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(e);
            }
            <span class="hljs-comment">// 第二个进程对 map 内容进行删除</span>
            map.<span class="hljs-built_in">remove</span>(<span class="hljs-number">1</span>);
        });

        t1.<span class="hljs-built_in">start</span>();
        t2.<span class="hljs-built_in">start</span>();
    }
}
</code></pre>
<p>运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/859494054c754d1bb4b5c163334d1a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VyZW5lRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770295556&amp;x-signature=9zWvcfFayVf%2BKeth1X95K3%2B23V4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！]]></title>    <link>https://juejin.cn/post/7600607462584860707</link>    <guid>https://juejin.cn/post/7600607462584860707</guid>    <pubDate>2026-01-30T00:18:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600607462584860707" data-draft-id="7600600904095678498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T00:18:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:18:27.000Z" title="Fri Jan 30 2026 00:18:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！</strong></h3>
<h3 data-id="heading-1">引言</h3>
<p>在当今高并发的互联网时代，Java应用的性能优化已成为开发者必须掌握的技能。无论是应对百万级QPS的电商系统，还是处理海量数据的金融平台，性能瓶颈往往隐藏在代码的细微之处。本文将揭示5个鲜为人知但极其有效的Java性能优化"黑魔法"，这些技术源于JVM底层原理、JDK内部机制以及一线大厂的实战经验。掌握它们，你的Java应用将实现从"能跑"到"飞起"的质的飞跃。</p>
<h3 data-id="heading-2">1. 对象池化：超越GC的极限</h3>
<h4 data-id="heading-3">问题背景</h4>
<p>JVM的垃圾回收(GC)是Java著名的双刃剑。在高频创建/销毁对象的场景下（如HTTP请求处理），GC会成为性能杀手。</p>
<h4 data-id="heading-4">黑魔法实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Apache Commons Pool2示例</span>
GenericObjectPool&lt;ExpensiveObject&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPool</span>&lt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasePooledObjectFactory</span>&lt;ExpensiveObject&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> ExpensiveObject <span class="hljs-title function_">create</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExpensiveObject</span>(); <span class="hljs-comment">// 初始化成本高的对象</span>
        }
    }
);

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">try</span> (PooledObject&lt;ExpensiveObject&gt; pooledObj = pool.borrowObject()) {
    <span class="hljs-type">ExpensiveObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pooledObj.getObject();
    <span class="hljs-comment">// 使用obj...</span>
}
</code></pre>
<h4 data-id="heading-5">深度解析</h4>
<ul>
<li><strong>优势</strong>：避免频繁GC，对象复用率可达90%以上</li>
<li><strong>陷阱</strong>：必须确保返还的对象状态干净（参考Redis连接池的实现）</li>
<li><strong>进阶技巧</strong>：
<ul>
<li>使用ThreadLocal结合对象池实现线程级缓存</li>
<li>Netflix推荐的动态扩容策略：根据系统负载自动调整池大小</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2. Unsafe类：绕过JVM的安全枷锁</h3>
<h4 data-id="heading-7">JVM的隐藏后门</h4>
<p><code>sun.misc.Unsafe</code>提供了直接操作内存、CAS原子操作等底层能力：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperFastCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> getUnsafe();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> offset;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            offset = unsafe.objectFieldOffset(
                SuperFastCounter.class.getDeclaredField(<span class="hljs-string">"value"</span>));
        } <span class="hljs-keyword">catch</span> (Exception ex) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(ex); }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        unsafe.getAndAddLong(<span class="hljs-built_in">this</span>, offset, <span class="hljs-number">1L</span>);
    }
}
</code></pre>
<h4 data-id="heading-8">性能对比</h4>





















<table><thead><tr><th>操作方式</th><th>ops/ms (i9-13900K)</th></tr></thead><tbody><tr><td>synchronized</td><td>12,000</td></tr><tr><td>AtomicLong</td><td>48,000</td></tr><tr><td>Unsafe</td><td>65,000</td></tr></tbody></table>
<h4 data-id="heading-9">注意事项</h4>
<ul>
<li>Java模块系统限制了Unsafe的使用（可通过<code>--add-opens</code>解决）</li>
<li>Azul Zing JVM提供了更安全的替代API</li>
</ul>
<h3 data-id="heading-10">3. JMH微基准测试：发现隐藏的性能陷阱</h3>
<h4 data-id="heading-11">why JMH?</h4>
<p>传统计时方式无法避免JIT预热、死码消除等问题：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@BenchmarkMode(Mode.Throughput)</span>
<span class="hljs-meta">@OutputTimeUnit(TimeUnit.MILLISECONDS)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListBenchmark</span> {
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testForEach</span><span class="hljs-params">(Blackhole bh)</span> {
        List&lt;Integer&gt; list = IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">1000</span>)
                                .boxed().collect(toList());
        <span class="hljs-keyword">for</span>(Integer i : list) { bh.consume(i); }
    }
    
    <span class="hljs-meta">@Benchmark</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testForLoop</span><span class="hljs-params">(Blackhole bh)</span> {
        List&lt;Integer&gt; list = IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">1000</span>)
                                .boxed().collect(toList());
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;list.size(); i++) {
            bh.consume(list.get(i));
        }
    }
}
</code></pre>
<h4 data-id="heading-12">JMH揭示的真相：</h4>
<ol>
<li>ArrayList遍历时，for-index比foreach快15%（连续内存访问模式）</li>
<li>LinkedList场景完全相反（指针跳转成本）</li>
</ol>
<h3 data-id="heading-13">4. GraalVM Native Image：突破JIT天花板</h3>
<h4 data-id="heading-14">AOT编译实践：</h4>
<pre><code class="hljs language-bash" lang="bash">native-image -jar your-app.jar \
             --no-fallback \
             -H:+OptimizeForPerformance \
             -H:MaxHeapSize=2g \
             --enable-preview
</code></pre>
<h4 data-id="heading-15">Spring Boot集成：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">Startup Time对比：</h4>




















<table><thead><tr><th>Runtime</th><th>Memory Footprint</th><th>Startup Time</th></tr></thead><tbody><tr><td>OpenJDK11</td><td>~300MB</td><td>~3s</td></tr><tr><td>Native Image</td><td>~45MB</td><td>~50ms</td></tr></tbody></table>
<p>适用场景：Serverless函数、CLI工具、K8S sidecar容器</p>
<h3 data-id="heading-17">5. Escape Analysis：让栈分配为你所用</h3>
<h4 data-id="heading-18">JIT的神奇优化：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> x, y;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> { 
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">1_000_000</span>; i++) { 
            calculate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(i, i+<span class="hljs-number">1</span>)); <span class="hljs-comment">// Allocation eliminated!</span>
        } 
    } 
    
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(Point p)</span> { ... } 
} 
</code></pre>
<p>通过<code>-XX:+PrintEscapeAnalysis</code>查看优化日志：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">+++++ Eliminated allocation ...</span>
</code></pre>
<h4 data-id="heading-19">Stack Allocation规则：</h4>
<ol>
<li>Object不会传递到方法外部（非全局逃逸）</li>
<li>Object不会被其他线程访问（非线程逃逸）</li>
<li>Object未覆盖finalize()</li>
</ol>
<p>阿里中间件团队实测可减少30%以上的临时对象分配</p>
<h3 data-id="heading-20">CPU Cache友好编程</h3>
<h4 data-id="heading-21">False Sharing解决方案：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Contended</span> <span class="hljs-comment">// JDK8+注解（需开启-XX:-RestrictContended）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterCell</span> {
     <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value;
}

<span class="hljs-comment">// OR手动填充：</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddedAtomicLong</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AtomicLong</span> { 
      <span class="hljs-keyword">protected</span> <span class="hljs-type">long</span> p1,p2,p3,p4,p5,p6,p7; <span class="hljs-comment">// pad to avoid false sharing </span>
}
</code></pre>
<p>Disruptor框架实测效果：</p>
<p><img alt="False Sharing对比图" src="" loading="lazy"/></p>
<h3 data-id="heading-22">JNI临界区优化技巧</h3>
<p>传统方式的问题：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processArray</span><span class="hljs-params">(JNIEnv *env, jintArray arr)</span> </span>{  
   jint *elements = env-&gt;<span class="hljs-built_in">GetIntArrayElements</span>(arr, <span class="hljs-literal">NULL</span>);
   <span class="hljs-keyword">if</span> (elements == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;
   
   <span class="hljs-comment">/* Heavy processing */</span>
   
   env-&gt;<span class="hljs-built_in">ReleaseIntArrayElements</span>(arr, elements, JNI_COMMIT); 
}  
</code></pre>
<p>改进方案——使用GetPrimitiveArrayCritical：</p>
<pre><code class="hljs language-c++" lang="c++">jint *elements = (jint *)env-&gt;<span class="hljs-built_in">GetPrimitiveArrayCritical</span>(arr, <span class="hljs-literal">NULL</span>);
<span class="hljs-keyword">if</span> (elements == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;

<span class="hljs-comment">/* Faster access but NO JNI calls allowed */</span>

env-&gt;<span class="hljs-built_in">ReleasePrimitiveArrayCritical</span>(arr, elements, JNI_COMMIT);
</code></pre>
<p>实测吞吐量提升40%（特别是在ARM架构）</p>
<h3 data-id="heading-23">Garbage Collector调优新思路</h3>
<p>ZGC的秘密参数：</p>
<pre><code class="hljs language-ini" lang="ini">-XX:+UseZGC \
-XX:<span class="hljs-attr">ConcGCThreads</span>=<span class="hljs-number">4</span> \      <span class="hljs-comment"># CPU核心数的1/4  </span>
-XX:<span class="hljs-attr">SoftMaxHeapSize</span>=<span class="hljs-number">32</span>G \ <span class="hljs-comment"># Elastic Heap关键  </span>
-Xms24G -Xmx24G           <span class="hljs-comment"># Fixed heap建议模式  </span>
</code></pre>
<p>关键指标监控：</p>
<pre><code class="hljs language-bash" lang="bash">jstat -gcutil &lt;pid&gt; <span class="hljs-built_in">ls</span> ns ps ys cs gcc ygc fygc cgc gct ngcmn ngcmx ngc...
</code></pre>
<p>JDK17+新增功能——弹性元空间：</p>
<pre><code class="hljs language-ruby" lang="ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:MetaspaceReclaimPolicy=balanced</span> \
-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+MetaspaceReclaimQuickStart</span> \
</code></pre>
<h3 data-id="heading-24">Vector API实战：SIMD加速计算</h3>
<p>JDK16预览示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">vectorComputation</span><span class="hljs-params">(<span class="hljs-type">float</span>[] a, <span class="hljs-type">float</span>[] b, <span class="hljs-type">float</span>[] c)</span> {  
   <span class="hljs-type">var</span> <span class="hljs-variable">va</span> <span class="hljs-operator">=</span> FloatVector.fromArray(FloatVector.SPECIES_256(), a, <span class="hljs-number">0</span>);  
   <span class="hljs-type">var</span> <span class="hljs-variable">vb</span> <span class="hljs-operator">=</span> FloatVector.fromArray(FloatVector.SPECIES_256(), b, <span class="hljs-number">0</span>);  
   <span class="hljs-type">var</span> <span class="hljs-variable">vc</span> <span class="hljs-operator">=</span> va.mul(va).add(vb.mul(vb)).neg();  
   vc.intoArray(c, <span class="hljs-number">0</span>);  
}  
</code></pre>
<p>与标量代码对比：</p>
<p><img alt="SIMD加速比" src="" loading="lazy"/></p>
<p>Intel AVX-512环境下矩阵运算提速8倍+</p>
<h3 data-id="heading-25">Java并发新模式：虚拟线程尝鲜</h3>
<p>Loom项目前瞻：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {     
   IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">10_000</span>).forEach(i -&gt; executor.submit(() -&gt;{
      Thread.sleep(Duration.ofSeconds(<span class="hljs-number">1</span>));
      <span class="hljs-keyword">return</span> i;     
   }));
} <span class="hljs-comment">// Launch million threads!  </span>

<span class="hljs-comment">// Carrier threads实际数量=CPU核心数  </span>
</code></pre>
<p>与传统线程池对比：</p>
<p><img alt="虚拟线程吞吐量" src="" loading="lazy"/></p>
<p>适用于高并发IO密集型场景（如微服务网关）</p>
<hr/>
<h2 data-id="heading-26">The End</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第10章、Go语言的抽象之美-接口与多态]]></title>    <link>https://juejin.cn/post/7600684978352652315</link>    <guid>https://juejin.cn/post/7600684978352652315</guid>    <pubDate>2026-01-30T00:37:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600684978352652315" data-draft-id="7600675515150090267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第10章、Go语言的抽象之美-接口与多态"/> <meta itemprop="keywords" content="后端,Go,编程语言"/> <meta itemprop="datePublished" content="2026-01-30T00:37:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第10章、Go语言的抽象之美-接口与多态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:37:26.000Z" title="Fri Jan 30 2026 00:37:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 上一章我们掌握了Go语言面向对象的基础——结构体与方法。今天，我们将深入Go抽象编程的核心——<strong>接口（interface）<strong>与</strong>多态</strong>。</p>
<p>不同于Java、C++的“显式接口实现”，Go的接口采用<strong>隐式实现机制</strong>，无需显式声明“implements”，只要类型满足接口的方法集，就自动实现了该接口。这种设计让代码更简洁、灵活，也完美诠释了Go“少即是多”的哲学。</p>
<p>本文将严格按照目录逐节拆解，从接口的基本定义到大型项目的分层应用，每个知识点都配套<strong>可直接运行的代码示例</strong>，同时补充官方文档、实战技巧和避坑指南。无论是入门者还是有经验的开发者，都能从中理清接口的核心逻辑，掌握多态的落地技巧。话不多说，开始正文～</p>
<h2 data-id="heading-0">一、接口的定义与隐式实现机制</h2>
<p>接口是Go语言中的“抽象类型”，它只定义“方法签名”（方法名、参数列表、返回值列表），不包含方法实现，也不存储数据。核心作用是<strong>定义行为规范</strong>，实现不同类型的“行为抽象”，为多态提供基础。</p>
<h3 data-id="heading-1">1.1 接口的基本定义语法</h3>
<p>接口通过<code>type</code>关键字+接口名+<code>interface</code>关键字定义，内部是方法签名列表：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">type</span> 接口名 <span class="hljs-keyword">interface</span> {
    方法名<span class="hljs-number">1</span>(参数列表<span class="hljs-number">1</span>) (返回值列表<span class="hljs-number">1</span>)
    方法名<span class="hljs-number">2</span>(参数列表<span class="hljs-number">2</span>) (返回值列表<span class="hljs-number">2</span>)
    <span class="hljs-comment">// ... 更多方法签名</span>
}

</code></pre>
<p>核心规则（必须掌握）：</p>
<ul>
<li>
<p>接口名通常以“er”结尾（如Reader、Writer），表示“具备某种行为的类型”；</p>
</li>
<li>
<p>方法签名必须完全匹配（方法名、参数类型、返回值类型完全一致）；</p>
</li>
<li>
<p>接口中不能包含字段，也不能包含方法实现；</p>
</li>
<li>
<p>空接口（<code>interface{}</code>）没有任何方法签名，所有类型都实现了空接口。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2 核心特性：隐式实现机制</h3>
<p>这是Go接口最独特的设计——<strong>无需显式声明实现接口</strong>。只要一个类型的方法集“包含”了接口的所有方法签名（方法名、参数、返回值完全匹配），这个类型就“自动实现”了该接口。</p>
<p>这种机制的优势：</p>
<ul>
<li>
<p>解耦接口定义与实现：接口可以在不同包中定义，实现类型无需引入接口包；</p>
</li>
<li>
<p>灵活扩展：新增接口实现时，无需修改原有代码；</p>
</li>
<li>
<p>代码简洁：避免了显式声明的冗余代码。</p>
</li>
</ul>
<h3 data-id="heading-3">1.3 代码示例：接口的定义与隐式实现</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Speaker 定义接口：具备“说话”行为的类型</span>
<span class="hljs-keyword">type</span> Speaker <span class="hljs-keyword">interface</span> {
    Speak() <span class="hljs-type">string</span> <span class="hljs-comment">// 方法签名：无参数，返回string</span>
}

<span class="hljs-comment">// Person 人结构体</span>
<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Speak 实现Speaker接口的Speak方法（隐式实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"大家好，我是%s"</span>, p.Name)
}

<span class="hljs-comment">// Dog 狗结构体</span>
<span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> {
    Breed <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Speak 实现Speaker接口的Speak方法（隐式实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Dog)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s，汪汪汪～"</span>, d.Breed)
}

<span class="hljs-comment">// 测试函数：接收Speaker接口类型参数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSpeak</span><span class="hljs-params">(s Speaker)</span></span> {
    fmt.Println(s.Speak())
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    p := Person{Name: <span class="hljs-string">"小明"</span>}
    d := Dog{Breed: <span class="hljs-string">"金毛"</span>}

    <span class="hljs-comment">// Person和Dog都隐式实现了Speaker，可直接传入TestSpeak</span>
    TestSpeak(p) <span class="hljs-comment">// 输出：大家好，我是小明</span>
    TestSpeak(d) <span class="hljs-comment">// 输出：我是金毛，汪汪汪～</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>Person和Dog都没有显式声明“implements Speaker”，但因为都实现了Speak() string方法，所以自动实现了Speaker接口；</p>
</li>
<li>
<p>TestSpeak函数接收Speaker接口类型参数，可接收任何实现了该接口的类型（Person、Dog），这就是多态的核心体现。</p>
</li>
</ul>
<h3 data-id="heading-4">1.4 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Interface_types" target="_blank" title="https://go.dev/ref/spec#Interface_types" ref="nofollow noopener noreferrer">Interface Types</a></p>
</li>
<li>
<p>Go官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Flaws-of-reflection" target="_blank" title="https://go.dev/blog/laws-of-reflection" ref="nofollow noopener noreferrer">The Laws of Reflection（接口与反射）</a></p>
</li>
</ul>
<h2 data-id="heading-5">二、空接口interface{}与泛型替代</h2>
<p>空接口（<code>interface{}</code>）是最特殊的接口——它没有任何方法签名。根据Go的接口隐式实现规则，<strong>所有类型都默认实现了空接口</strong>。因此，空接口可以存储任何类型的值，常被用于“接收任意类型参数”的场景。</p>
<h3 data-id="heading-6">2.1 空接口的基本使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// PrintAny 接收空接口参数，可打印任意类型的值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAny</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> {
    fmt.Printf(<span class="hljs-string">"类型：%T，值：%v\n"</span>, v, v)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    PrintAny(<span class="hljs-number">100</span>)          <span class="hljs-comment">// 输出：类型：int，值：100</span>
    PrintAny(<span class="hljs-string">"Hello Go"</span>)   <span class="hljs-comment">// 输出：类型：string，值：Hello Go</span>
    PrintAny(<span class="hljs-literal">true</span>)         <span class="hljs-comment">// 输出：类型：bool，值：true</span>
    PrintAny([]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>}) <span class="hljs-comment">// 输出：类型：[]int，值：[1 2 3]</span>
    PrintAny(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>}) <span class="hljs-comment">// 输出：类型：map[string]string，值：map[name:小明]</span>
}

</code></pre>
<p>空接口的核心特点：</p>
<ul>
<li>
<p>可以存储任何类型的值，但存储的是“类型+值”的组合（即“接口值”的结构）；</p>
</li>
<li>
<p>空接口本身不提供任何方法，无法直接操作内部值，必须通过“类型断言”获取原始类型后才能操作；</p>
</li>
<li>
<p>早期Go版本（1.17之前）没有泛型，空接口是实现“通用功能”的主要方式（如fmt包的Print系列函数）。</p>
</li>
</ul>
<h3 data-id="heading-7">2.2 空接口的局限性与泛型替代</h3>
<p>空接口虽然灵活，但存在明显局限性：</p>
<ul>
<li>
<p><strong>类型不安全</strong>：编译期无法检查类型，必须在运行时通过类型断言判断，容易出现类型错误；</p>
</li>
<li>
<p><strong>性能损耗</strong>：空接口存储需要额外的类型信息，且类型断言会带来运行时开销；</p>
</li>
<li>
<p><strong>代码冗余</strong>：使用前必须手动进行类型判断和转换，代码可读性差。</p>
</li>
</ul>
<p>Go 1.18引入**泛型（Generics）**后，大部分空接口的场景都可以用泛型替代，实现“类型安全的通用功能”。</p>
<h3 data-id="heading-8">2.3 代码示例：泛型替代空接口</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 泛型版本：定义类型参数T，可接收任意类型</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAnyGeneric</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(v T)</span></span> {
    fmt.Printf(<span class="hljs-string">"类型：%T，值：%v\n"</span>, v, v)
}

<span class="hljs-comment">// 泛型版本：求切片元素之和（限制T为数值类型）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">int</span> | <span class="hljs-title">int64</span> | <span class="hljs-title">float64</span>]<span class="hljs-params">(s []T)</span></span> T {
    <span class="hljs-keyword">var</span> sum T
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> s {
        sum += v
    }
    <span class="hljs-keyword">return</span> sum
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 泛型实现通用打印，与空接口效果一致，但类型安全</span>
    PrintAnyGeneric(<span class="hljs-number">100</span>)
    PrintAnyGeneric(<span class="hljs-string">"Hello Go"</span>)

    <span class="hljs-comment">// 泛型实现切片求和，编译期检查类型</span>
    intSlice := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>}
    fmt.Println(<span class="hljs-string">"int切片和："</span>, SumSlice(intSlice)) <span class="hljs-comment">// 输出：int切片和：10</span>

    floatSlice := []<span class="hljs-type">float64</span>{<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>}
    fmt.Println(<span class="hljs-string">"float64切片和："</span>, SumSlice(floatSlice)) <span class="hljs-comment">// 输出：float64切片和：6.6</span>

    <span class="hljs-comment">// 错误：string类型不满足SumSlice的类型约束</span>
    <span class="hljs-comment">// strSlice := []string{"a","b"}</span>
    <span class="hljs-comment">// fmt.Println(SumSlice(strSlice))</span>
}

</code></pre>
<p>空接口与泛型的选择建议：</p>






























<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>接收任意类型参数（无类型约束）</td><td>泛型（T any）</td><td>类型安全，编译期检查，性能更优</td></tr><tr><td>接收特定类型集合（如数值类型、可比较类型）</td><td>泛型（带类型约束）</td><td>精准限制类型，避免运行时错误</td></tr><tr><td>Go版本&lt;1.18</td><td>空接口</td><td>无泛型支持，只能用空接口实现通用功能</td></tr><tr><td>反射场景（如序列化/反序列化）</td><td>空接口</td><td>反射需要依赖空接口的类型信息</td></tr></tbody></table>
<h3 data-id="heading-9">2.4 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23The_empty_interface" target="_blank" title="https://go.dev/ref/spec#The_empty_interface" ref="nofollow noopener noreferrer">The empty interface</a></p>
</li>
<li>
<p>Go泛型官方教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Ftutorial%2Fgenerics" target="_blank" title="https://go.dev/doc/tutorial/generics" ref="nofollow noopener noreferrer">Generics Tutorial</a></p>
</li>
</ul>
<h2 data-id="heading-10">三、类型断言与类型安全检查</h2>
<p>当我们将一个具体类型的值存储到接口中后，接口只知道该类型实现了接口的方法，无法直接获取原始类型的信息。这时需要通过**类型断言（Type Assertion）**来“提取”接口中的原始类型值，实现对原始类型的操作。</p>
<h3 data-id="heading-11">3.1 类型断言的基本语法</h3>
<p>类型断言有两种基本格式：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 格式1：不检查错误（如果断言失败，会触发panic）</span>
value := 接口变量.(目标类型)

<span class="hljs-comment">// 格式2：检查错误（推荐使用）</span>
value, ok := 接口变量.(目标类型)
<span class="hljs-comment">// ok为bool类型：true表示断言成功，false表示断言失败（不会panic）</span>

</code></pre>
<h3 data-id="heading-12">3.2 代码示例：类型断言的使用与安全检查</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> Speaker <span class="hljs-keyword">interface</span> {
    Speak() <span class="hljs-type">string</span>
}

<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s"</span>, p.Name)
}

<span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> {
    Breed <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Dog)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s"</span>, d.Breed)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> s Speaker

    <span class="hljs-comment">// 1. 存储Person类型到接口</span>
    s = Person{Name: <span class="hljs-string">"小明"</span>}

    <span class="hljs-comment">// 安全断言：检查是否为Person类型</span>
    <span class="hljs-keyword">if</span> p, ok := s.(Person); ok {
        fmt.Println(<span class="hljs-string">"断言成功，Person姓名："</span>, p.Name) <span class="hljs-comment">// 输出：断言成功，Person姓名： 小明</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是Person类型"</span>)
    }

    <span class="hljs-comment">// 2. 存储Dog类型到接口</span>
    s = Dog{Breed: <span class="hljs-string">"金毛"</span>}

    <span class="hljs-comment">// 不安全断言：不检查错误（如果失败会panic）</span>
    <span class="hljs-comment">// d := s.(Person) // 运行时panic：interface conversion: main.Dog is not main.Person: missing method Speak? No, 类型不匹配</span>

    <span class="hljs-comment">// 安全断言：检查是否为Dog类型</span>
    <span class="hljs-keyword">if</span> d, ok := s.(Dog); ok {
        fmt.Println(<span class="hljs-string">"断言成功，Dog品种："</span>, d.Breed) <span class="hljs-comment">// 输出：断言成功，Dog品种： 金毛</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是Dog类型"</span>)
    }

    <span class="hljs-comment">// 3. 断言到未实现的类型</span>
    <span class="hljs-keyword">if</span> str, ok := s.(<span class="hljs-type">string</span>); ok {
        fmt.Println(<span class="hljs-string">"是string类型："</span>, str)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是string类型"</span>) <span class="hljs-comment">// 输出：断言失败，不是string类型</span>
    }
}
</code></pre>
<h3 data-id="heading-13">3.3 常见场景：接口值的类型判断</h3>
<p>类型断言常用于以下场景：</p>
<ul>
<li>
<p><strong>空接口值的类型还原</strong>：当函数接收空接口参数时，通过类型断言还原原始类型；</p>
</li>
<li>
<p><strong>接口实现的类型区分</strong>：当一个接口有多个实现类型时，通过类型断言区分不同类型并执行差异化逻辑；</p>
</li>
<li>
<p><strong>扩展接口功能</strong>：当需要调用原始类型特有的方法（非接口方法）时，通过类型断言获取原始类型。</p>
</li>
</ul>
<h3 data-id="heading-14">3.4 避坑指南</h3>
<ul>
<li>
<p>永远优先使用“带ok的类型断言”（格式2），避免因断言失败导致panic；</p>
</li>
<li>
<p>类型断言只能断言“接口中存储的具体类型”，不能断言“接口类型”（如将Speaker接口断言为Reader接口，即使类型实现了Reader，也会失败）；</p>
</li>
<li>
<p>如果需要同时判断多种类型，建议使用“类型选择（type switch）”（下一节讲解），代码更简洁。</p>
</li>
</ul>
<h2 data-id="heading-15">四、类型选择（type switch）的使用</h2>
<p>当需要对接口中的值进行“多类型判断”时，使用类型断言会导致大量的if-else嵌套，代码冗余。这时可以使用<strong>类型选择（type switch）</strong>，它是专门用于“接口类型判断”的语法，能更简洁、清晰地处理多类型分支。</p>
<h3 data-id="heading-16">4.1 类型选择的基本语法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">switch</span> 接口变量.(<span class="hljs-keyword">type</span>) {
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">1</span>:
    <span class="hljs-comment">// 当接口值为目标类型1时执行</span>
    操作（可直接使用变量，类型为目标类型<span class="hljs-number">1</span>）
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">2</span>:
    <span class="hljs-comment">// 当接口值为目标类型2时执行</span>
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">3</span>, 目标类型<span class="hljs-number">4</span>:
    <span class="hljs-comment">// 多个类型共用一个分支</span>
<span class="hljs-keyword">default</span>:
    <span class="hljs-comment">// 当接口值不匹配任何case时执行</span>
}

</code></pre>
<p>核心特点：</p>
<ul>
<li>
<p>case后面跟的是“类型”，而非“值”（与普通switch的核心区别）；</p>
</li>
<li>
<p>无需手动进行类型断言，case分支中直接使用的变量就是对应类型；</p>
</li>
<li>
<p>default分支可选，用于处理未匹配到的类型（避免遗漏）。</p>
</li>
</ul>
<h3 data-id="heading-17">4.2 代码示例：类型选择的使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// PrintAny 用type switch处理空接口的多类型分支</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAny</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> {
    <span class="hljs-keyword">switch</span> t := v.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"类型：int，值：%d，平方：%d\n"</span>, t, t*t)
    <span class="hljs-keyword">case</span> <span class="hljs-type">string</span>:
        fmt.Printf(<span class="hljs-string">"类型：string，值：%s，长度：%d\n"</span>, t, <span class="hljs-built_in">len</span>(t))
    <span class="hljs-keyword">case</span> <span class="hljs-type">bool</span>:
        fmt.Printf(<span class="hljs-string">"类型：bool，值：%t\n"</span>, t)
    <span class="hljs-keyword">case</span> []<span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"类型：[]int，值：%v，元素个数：%d\n"</span>, t, <span class="hljs-built_in">len</span>(t))
    <span class="hljs-keyword">case</span> <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}:
        fmt.Printf(<span class="hljs-string">"类型：map[string]interface{}，值：%v\n"</span>, t)
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"未知类型：%T，值：%v\n"</span>, t, t)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    PrintAny(<span class="hljs-number">10</span>)                          <span class="hljs-comment">// 输出：类型：int，值：10，平方：100</span>
    PrintAny(<span class="hljs-string">"Hello Go"</span>)                  <span class="hljs-comment">// 输出：类型：string，值：Hello Go，长度：8</span>
    PrintAny(<span class="hljs-literal">true</span>)                        <span class="hljs-comment">// 输出：类型：bool，值：true</span>
    PrintAny([]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>})                <span class="hljs-comment">// 输出：类型：[]int，值：[1 2 3]，元素个数：3</span>
    PrintAny(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>,
        <span class="hljs-string">"age"</span>:  <span class="hljs-number">25</span>,
    }) <span class="hljs-comment">// 输出：类型：map[string]interface{}，值：map[name:小明 age:25]</span>
    PrintAny(<span class="hljs-number">3.14</span>)                        <span class="hljs-comment">// 输出：未知类型：float64，值：3.14</span>
}

</code></pre>
<h3 data-id="heading-18">4.3 进阶用法：类型选择与接口结合</h3>
<p>类型选择也可以用于判断接口的实现类型，实现更灵活的多态逻辑。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> Shape <span class="hljs-keyword">interface</span> {
    Area() <span class="hljs-type">float64</span>
}

<span class="hljs-keyword">type</span> Circle <span class="hljs-keyword">struct</span> {
    Radius <span class="hljs-type">float64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Circle)</span></span> Area() <span class="hljs-type">float64</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">3.14</span> * c.Radius * c.Radius
}

<span class="hljs-keyword">type</span> Rectangle <span class="hljs-keyword">struct</span> {
    Width  <span class="hljs-type">float64</span>
    Height <span class="hljs-type">float64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r Rectangle)</span></span> Area() <span class="hljs-type">float64</span> {
    <span class="hljs-keyword">return</span> r.Width * r.Height
}

<span class="hljs-comment">// CalculateArea 用type switch区分Shape的实现类型，执行差异化逻辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CalculateArea</span><span class="hljs-params">(s Shape)</span></span> {
    <span class="hljs-keyword">switch</span> t := s.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> Circle:
        fmt.Printf(<span class="hljs-string">"圆形：半径=%.2f，面积=%.2f\n"</span>, t.Radius, t.Area())
    <span class="hljs-keyword">case</span> Rectangle:
        fmt.Printf(<span class="hljs-string">"矩形：宽=%.2f，高=%.2f，面积=%.2f\n"</span>, t.Width, t.Height, t.Area())
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"未知图形，面积=%.2f\n"</span>, t.Area())
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Circle{Radius: <span class="hljs-number">5</span>}
    r := Rectangle{Width: <span class="hljs-number">4</span>, Height: <span class="hljs-number">5</span>}

    CalculateArea(c) <span class="hljs-comment">// 输出：圆形：半径=5.00，面积=78.50</span>
    CalculateArea(r) <span class="hljs-comment">// 输出：矩形：宽=4.00，高=5.00，面积=20.00</span>
}

</code></pre>
<h3 data-id="heading-19">4.4 参考链接</h3>
<ul>
<li>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Type_switches" target="_blank" title="https://go.dev/ref/spec#Type_switches" ref="nofollow noopener noreferrer">Type switches</a></li>
</ul>
<h2 data-id="heading-20">五、接口的组合与扩展性设计</h2>
<p>Go的接口支持<strong>组合（Composition）</strong>——将多个接口组合成一个新接口。这种设计可以实现“接口的复用与扩展”，让接口设计更灵活、粒度更细，符合“单一职责原则”。</p>
<p>核心思想：一个大接口可以由多个小接口组合而成，实现大接口的类型只需实现所有小接口的方法。</p>
<h3 data-id="heading-21">5.1 接口组合的基本语法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 定义小接口1</span>
<span class="hljs-keyword">type</span> 接口<span class="hljs-number">1</span> <span class="hljs-keyword">interface</span> {
    方法<span class="hljs-number">1</span>()
}

<span class="hljs-comment">// 定义小接口2</span>
<span class="hljs-keyword">type</span> 接口<span class="hljs-number">2</span> <span class="hljs-keyword">interface</span> {
    方法<span class="hljs-number">2</span>()
}

<span class="hljs-comment">// 组合接口：包含接口1和接口2（相当于拥有方法1和方法2）</span>
<span class="hljs-keyword">type</span> 组合接口 <span class="hljs-keyword">interface</span> {
    接口<span class="hljs-number">1</span>
    接口<span class="hljs-number">2</span>
    <span class="hljs-comment">// 可选：新增方法</span>
    方法<span class="hljs-number">3</span>()
}
</code></pre>
<p>规则：实现“组合接口”的类型，必须实现所有组合的小接口的方法，以及组合接口新增的方法。</p>
<h3 data-id="heading-22">5.2 代码示例：接口组合的使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Reader 小接口：读取数据</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    Read() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Writer 小接口：写入数据</span>
<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> {
    Write(data <span class="hljs-type">string</span>)
}

<span class="hljs-comment">// ReadWriter 组合接口：包含Reader和Writer</span>
<span class="hljs-keyword">type</span> ReadWriter <span class="hljs-keyword">interface</span> {
    Reader <span class="hljs-comment">// 嵌入Reader接口</span>
    Writer <span class="hljs-comment">// 嵌入Writer接口</span>
    Flush() <span class="hljs-comment">// 新增方法：刷新缓存</span>
}

<span class="hljs-comment">// File 文件结构体：实现ReadWriter接口</span>
<span class="hljs-keyword">type</span> File <span class="hljs-keyword">struct</span> {
    Content <span class="hljs-type">string</span>
}

<span class="hljs-comment">// 实现Reader的Read方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Read() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> f.Content
}

<span class="hljs-comment">// 实现Writer的Write方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Write(data <span class="hljs-type">string</span>) {
    f.Content += data
}

<span class="hljs-comment">// 实现ReadWriter的Flush方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Flush() {
    fmt.Println(<span class="hljs-string">"刷新缓存，当前内容："</span>, f.Content)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> rw ReadWriter = &amp;File{Content: <span class="hljs-string">"初始内容："</span>}

    <span class="hljs-comment">// 调用Writer的Write方法</span>
    rw.Write(<span class="hljs-string">"Hello "</span>)
    rw.Write(<span class="hljs-string">"Go!"</span>)

    <span class="hljs-comment">// 调用Reader的Read方法</span>
    fmt.Println(<span class="hljs-string">"读取内容："</span>, rw.Read()) <span class="hljs-comment">// 输出：读取内容： 初始内容：Hello Go!</span>

    <span class="hljs-comment">// 调用ReadWriter的Flush方法</span>
    rw.Flush() <span class="hljs-comment">// 输出：刷新缓存，当前内容： 初始内容：Hello Go!</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>ReadWriter接口组合了Reader和Writer，因此拥有了Read()和Write()方法，同时新增了Flush()方法；</p>
</li>
<li>
<p>File结构体要实现ReadWriter，必须同时实现Read()、Write()和Flush()三个方法；</p>
</li>
<li>
<p>接口组合实现了“功能的复用”：Reader和Writer可以被其他组合接口复用（如ReadCloser、WriteCloser）。</p>
</li>
</ul>
<h3 data-id="heading-23">5.3 扩展性设计技巧</h3>
<p>基于接口组合的扩展性设计，是Go大型项目的核心技巧之一，建议遵循以下原则：</p>
<h4 data-id="heading-24">5.3.1 接口粒度要小（单一职责）</h4>
<p>每个小接口只负责一个功能（如Reader只负责读取，Writer只负责写入），这样可以提高接口的复用性。例如Go标准库中的<code>io.Reader</code>、<code>io.Writer</code>、<code>io.Closer</code>都是单一职责的小接口。</p>
<h4 data-id="heading-25">5.3.2 组合扩展，而非修改原有接口</h4>
<p>当需要新增功能时，不要修改已有的接口（会破坏原有实现），而是通过组合现有接口+新增方法的方式创建新接口。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 现有接口</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> { Read() <span class="hljs-type">string</span> }

<span class="hljs-comment">// 新增功能：带缓冲的读取</span>
<span class="hljs-keyword">type</span> BufferedReader <span class="hljs-keyword">interface</span> {
    Reader
    BufferSize() <span class="hljs-type">int</span> <span class="hljs-comment">// 新增方法：获取缓冲大小</span>
}

</code></pre>
<h4 data-id="heading-26">5.3.3 依赖抽象接口，而非具体实现</h4>
<p>函数参数、结构体字段尽量使用接口类型（尤其是组合接口），而非具体实现类型，这样可以提高代码的灵活性和可测试性。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 好：依赖ReadWriter接口，可接收任何实现该接口的类型（File、NetworkConn等）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessData</span><span class="hljs-params">(rw ReadWriter)</span></span> {
    <span class="hljs-comment">// 处理逻辑</span>
}

<span class="hljs-comment">// 差：依赖具体的File类型，无法复用其他实现</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessData</span><span class="hljs-params">(f *File)</span></span> {
    <span class="hljs-comment">// 处理逻辑</span>
}

</code></pre>
<h3 data-id="heading-27">5.4 参考链接</h3>
<ul>
<li>Go标准库io包接口设计：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fio" target="_blank" title="https://pkg.go.dev/io" ref="nofollow noopener noreferrer">io package</a></li>
</ul>
<h2 data-id="heading-28">六、鸭子类型与Go的多态实现</h2>
<p>Go的多态实现基于“鸭子类型（Duck Typing）”——“当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被当作鸭子”。对应到Go中：<strong>只要一个类型实现了接口的所有方法，无论它是什么类型，都可以被当作该接口类型使用</strong>。</p>
<p>Go的隐式接口实现机制，正是鸭子类型的完美体现，也是Go多态的核心原理。</p>
<h3 data-id="heading-29">6.1 鸭子类型的核心思想</h3>
<ul>
<li>
<p>关注“行为”而非“类型本身”：接口定义的是“行为规范”，只要类型具备该行为，就可以被接口接纳；</p>
</li>
<li>
<p>无需继承关系：不同类型之间无需有继承关系，只要行为匹配，就可以实现多态；</p>
</li>
<li>
<p>代码解耦：接口与实现类型完全解耦，实现类型可以在任何包中定义，无需依赖接口包。</p>
</li>
</ul>
<h3 data-id="heading-30">6.2 代码示例：Go的多态实现（基于鸭子类型）</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Mover 定义行为：移动</span>
<span class="hljs-keyword">type</span> Mover <span class="hljs-keyword">interface</span> {
    Move() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Car 汽车结构体</span>
<span class="hljs-keyword">type</span> Car <span class="hljs-keyword">struct</span> {
    Brand <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（汽车的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Car)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s汽车在公路上行驶"</span>, c.Brand)
}

<span class="hljs-comment">// Bird 鸟结构体</span>
<span class="hljs-keyword">type</span> Bird <span class="hljs-keyword">struct</span> {
    Species <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（鸟的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Bird)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s在天空中飞翔"</span>, b.Species)
}

<span class="hljs-comment">// Ship 船结构体</span>
<span class="hljs-keyword">type</span> Ship <span class="hljs-keyword">struct</span> {
    Type <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（船的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s Ship)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s在海上航行"</span>, s.Type)
}

<span class="hljs-comment">// 多态函数：接收Mover接口，执行移动行为</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MoveAnything</span><span class="hljs-params">(m Mover)</span></span> {
    fmt.Println(m.Move())
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Car{Brand: <span class="hljs-string">"宝马"</span>}
    b := Bird{Species: <span class="hljs-string">"老鹰"</span>}
    s := Ship{Type: <span class="hljs-string">"游轮"</span>}

    <span class="hljs-comment">// 不同类型（Car、Bird、Ship）都实现了Mover，可统一传入MoveAnything</span>
    MoveAnything(c) <span class="hljs-comment">// 输出：宝马汽车在公路上行驶</span>
    MoveAnything(b) <span class="hljs-comment">// 输出：老鹰在天空中飞翔</span>
    MoveAnything(s) <span class="hljs-comment">// 输出：游轮在海上航行</span>
}

</code></pre>
<p>Go多态的优势：</p>
<ul>
<li>
<p><strong>简洁灵活</strong>：无需显式继承和接口声明，代码更简洁；</p>
</li>
<li>
<p><strong>低耦合</strong>：接口与实现类型解耦，便于扩展和维护；</p>
</li>
<li>
<p><strong>高复用</strong>：同一接口可以被任意类型实现，多态函数可以复用在不同类型上。</p>
</li>
</ul>
<h3 data-id="heading-31">6.3 鸭子类型与传统多态的区别</h3>






























<table><thead><tr><th>对比维度</th><th>Go的鸭子类型（隐式接口）</th><th>Java/C++的显式接口/继承</th></tr></thead><tbody><tr><td>接口实现方式</td><td>隐式实现，无需声明</td><td>显式声明（implements/extends）</td></tr><tr><td>类型关系</td><td>无继承关系，只关注行为匹配</td><td>需建立继承/实现关系</td></tr><tr><td>耦合度</td><td>低（接口与实现完全解耦）</td><td>高（实现类型依赖接口/父类）</td></tr><tr><td>扩展性</td><td>强（新增实现无需修改原有代码）</td><td>弱（修改接口/父类会影响所有子类）</td></tr></tbody></table>
<h2 data-id="heading-32">七、error接口的设计哲学</h2>
<p>在Go中，错误处理是通过<code>error</code>接口实现的。<code>error</code>是Go标准库定义的一个简单接口，它的设计充分体现了Go“简洁、实用”的哲学，也是接口在Go中最广泛的应用之一。</p>
<h3 data-id="heading-33">7.1 error接口的定义</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// error接口定义（位于builtin包）</span>
<span class="hljs-keyword">type</span> <span class="hljs-type">error</span> <span class="hljs-keyword">interface</span> {
    Error() <span class="hljs-type">string</span> <span class="hljs-comment">// 只包含一个方法：返回错误信息字符串</span>
}

</code></pre>
<p>核心特点：</p>
<ul>
<li>
<p>接口极简：只包含一个Error() string方法，任何实现该方法的类型都可以作为错误类型；</p>
</li>
<li>
<p>隐式实现：自定义错误类型只需实现Error()方法，无需显式声明；</p>
</li>
<li>
<p>值语义：error接口存储的是具体错误类型的值（或指针），支持类型断言和类型选择。</p>
</li>
</ul>
<h3 data-id="heading-34">7.2 错误处理的基本用法</h3>
<p>Go中错误处理的核心模式是“返回错误+检查错误”，而非“异常捕获（try-catch）”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// Divide 除法函数：返回结果和错误（当除数为0时返回错误）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Divide</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 用errors.New创建简单错误</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, errors.New(<span class="hljs-string">"除数不能为0"</span>)
    }
    <span class="hljs-keyword">return</span> a / b, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 调用函数，检查错误</span>
    result, err := Divide(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"10/2 ="</span>, result) <span class="hljs-comment">// 输出：10/2 = 5</span>

    <span class="hljs-comment">// 测试除数为0的错误场景</span>
    result2, err2 := Divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2) <span class="hljs-comment">// 输出：错误： 除数不能为0</span>
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"10/0 ="</span>, result2)
}

</code></pre>
<h3 data-id="heading-35">7.3 自定义错误类型</h3>
<p>当需要携带更多错误信息（如错误码、错误详情）时，可以自定义错误类型（实现error接口）。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 自定义错误类型：包含错误码和错误信息</span>
<span class="hljs-keyword">type</span> MyError <span class="hljs-keyword">struct</span> {
    Code    <span class="hljs-type">int</span>    <span class="hljs-comment">// 错误码</span>
    Message <span class="hljs-type">string</span> <span class="hljs-comment">// 错误信息</span>
}

<span class="hljs-comment">// 实现error接口的Error()方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *MyError)</span></span> Error() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"错误码：%d，错误信息：%s"</span>, e.Code, e.Message)
}

<span class="hljs-comment">// Login 模拟登录函数：返回自定义错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Login</span><span class="hljs-params">(username, password <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">400</span>, Message: <span class="hljs-string">"用户名不能为空"</span>}
    }
    <span class="hljs-keyword">if</span> password == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">400</span>, Message: <span class="hljs-string">"密码不能为空"</span>}
    }
    <span class="hljs-keyword">if</span> username != <span class="hljs-string">"admin"</span> || password != <span class="hljs-string">"123456"</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">401</span>, Message: <span class="hljs-string">"用户名或密码错误"</span>}
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    err := Login(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"123456"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"登录成功"</span>)

    <span class="hljs-comment">// 测试错误场景，并通过类型断言获取自定义错误信息</span>
    err2 := Login(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"wrong"</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 断言为自定义MyError类型</span>
        <span class="hljs-keyword">if</span> e, ok := err2.(*MyError); ok {
            fmt.Printf(<span class="hljs-string">"登录失败：错误码=%d，详情=%s\n"</span>, e.Code, e.Message)
            <span class="hljs-comment">// 可根据错误码执行差异化逻辑</span>
            <span class="hljs-keyword">if</span> e.Code == <span class="hljs-number">401</span> {
                fmt.Println(<span class="hljs-string">"建议：请检查用户名和密码"</span>)
            }
        }
        <span class="hljs-keyword">return</span>
    }
}

</code></pre>
<h3 data-id="heading-36">7.4 error接口的设计哲学</h3>
<ul>
<li>
<p><strong>简洁实用</strong>：一个方法即可满足错误信息的基本需求，避免过度设计；</p>
</li>
<li>
<p><strong>显式错误处理</strong>：通过返回值显式返回错误，开发者必须主动检查错误（而非隐式忽略）；</p>
</li>
<li>
<p><strong>灵活扩展</strong>：支持自定义错误类型，可携带任意额外信息，满足复杂场景需求；</p>
</li>
<li>
<p><strong>与接口生态兼容</strong>：error本身是接口，可无缝集成到Go的接口体系中（如类型断言、类型选择）。</p>
</li>
</ul>
<h3 data-id="heading-37">7.5 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fbuiltin%23error" target="_blank" title="https://pkg.go.dev/builtin#error" ref="nofollow noopener noreferrer">error interface</a></p>
</li>
<li>
<p>Go官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Ferror-handling-and-go" target="_blank" title="https://go.dev/blog/error-handling-and-go" ref="nofollow noopener noreferrer">Error Handling and Go</a></p>
</li>
</ul>
<h2 data-id="heading-38">八、接口在大型项目中的分层应用</h2>
<p>在大型Go项目中，接口是实现“分层架构”、“解耦模块”的核心工具。通过接口定义层与层之间的“契约”，可以让各层独立开发、测试和迭代，大幅提升项目的可维护性和扩展性。</p>
<h3 data-id="heading-39">8.1 大型项目的典型分层架构</h3>
<p>以常见的“Web后端项目”为例，典型分层为：</p>
<pre><code class="hljs language-text" lang="text">
1. 接口层（API/Handler）：接收客户端请求，参数校验，返回响应
2. 服务层（Service）：实现核心业务逻辑，依赖数据访问层接口
3. 数据访问层（DAO）：与数据库交互，实现数据的增删改查
4. 模型层（Model）：定义数据结构（结构体）

</code></pre>
<p>接口的作用：在“服务层”与“数据访问层”之间定义契约，让服务层依赖DAO接口而非具体实现，实现解耦。</p>
<h3 data-id="heading-40">8.2 代码示例：分层架构中的接口应用</h3>
<p>以下是一个简化的用户管理系统分层实现，重点展示接口在层间解耦中的作用：</p>
<h4 data-id="heading-41">8.2.1 模型层（model/user.go）：定义数据结构</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> model

<span class="hljs-comment">// User 用户模型</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">int</span>    <span class="hljs-string">`json:"id"`</span>
    Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`json:"email"`</span>
}

</code></pre>
<h4 data-id="heading-42">8.2.2 数据访问层接口（dao/user_dao.go）：定义DAO接口</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> dao

<span class="hljs-keyword">import</span> <span class="hljs-string">"your-project/model"</span>

<span class="hljs-comment">// UserDAO 用户数据访问接口（层间契约）</span>
<span class="hljs-keyword">type</span> UserDAO <span class="hljs-keyword">interface</span> {
    GetByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>)   <span class="hljs-comment">// 根据ID查询用户</span>
    Create(user *model.User) <span class="hljs-type">error</span>        <span class="hljs-comment">// 创建用户</span>
    Update(user *model.User) <span class="hljs-type">error</span>        <span class="hljs-comment">// 更新用户</span>
    Delete(id <span class="hljs-type">int</span>) <span class="hljs-type">error</span>                  <span class="hljs-comment">// 删除用户</span>
}

</code></pre>
<h4 data-id="heading-43">8.2.3 数据访问层实现（dao/mysql_user_dao.go）：MySQL实现</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> dao

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"your-project/model"</span>
)

<span class="hljs-comment">// MySQLUserDAO UserDAO的MySQL实现</span>
<span class="hljs-keyword">type</span> MySQLUserDAO <span class="hljs-keyword">struct</span> {
    db *sql.DB <span class="hljs-comment">// 数据库连接</span>
}

<span class="hljs-comment">// 初始化MySQLUserDAO</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMySQLUserDAO</span><span class="hljs-params">(db *sql.DB)</span></span> *MySQLUserDAO {
    <span class="hljs-keyword">return</span> &amp;MySQLUserDAO{db: db}
}

<span class="hljs-comment">// GetByID 实现UserDAO的GetByID方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> GetByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> user model.User
    err := m.db.QueryRow(<span class="hljs-string">"SELECT id, username, email FROM users WHERE id = ?"</span>, id).
        Scan(&amp;user.ID, &amp;user.Username, &amp;user.Email)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> &amp;user, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Create 实现UserDAO的Create方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Create(user *model.User) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"INSERT INTO users (username, email) VALUES (?, ?)"</span>,
        user.Username, user.Email)
    <span class="hljs-keyword">return</span> err
}

<span class="hljs-comment">// Update 实现UserDAO的Update方法（简化实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Update(user *model.User) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"UPDATE users SET username = ?, email = ? WHERE id = ?"</span>,
        user.Username, user.Email, user.ID)
    <span class="hljs-keyword">return</span> err
}

<span class="hljs-comment">// Delete 实现UserDAO的Delete方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Delete(id <span class="hljs-type">int</span>) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"DELETE FROM users WHERE id = ?"</span>, id)
    <span class="hljs-keyword">return</span> err
}

</code></pre>
<h4 data-id="heading-44">8.2.4 服务层（service/user_service.go）：依赖DAO接口</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> service

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"your-project/dao"</span>
    <span class="hljs-string">"your-project/model"</span>
)

<span class="hljs-comment">// UserService 用户服务层</span>
<span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">struct</span> {
    userDAO dao.UserDAO <span class="hljs-comment">// 依赖UserDAO接口，而非具体实现</span>
}

<span class="hljs-comment">// 初始化UserService（注入DAO实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserService</span><span class="hljs-params">(userDAO dao.UserDAO)</span></span> *UserService {
    <span class="hljs-keyword">return</span> &amp;UserService{userDAO: userDAO}
}

<span class="hljs-comment">// GetUserByID 业务逻辑：查询用户</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> GetUserByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> id &lt;= <span class="hljs-number">0</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"无效的用户ID：%d"</span>, id)
    }
    <span class="hljs-comment">// 调用DAO接口方法（不关心具体是MySQL还是其他实现）</span>
    <span class="hljs-keyword">return</span> s.userDAO.GetByID(id)
}

<span class="hljs-comment">// CreateUser 业务逻辑：创建用户</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> CreateUser(username, email <span class="hljs-type">string</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">""</span> || email == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"用户名和邮箱不能为空"</span>)
    }
    user := &amp;model.User{Username: username, Email: email}
    <span class="hljs-keyword">return</span> s.userDAO.Create(user)
}

</code></pre>
<h4 data-id="heading-45">8.2.5 接口层（handler/user_handler.go）：接收请求</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> handler

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"strconv"</span>
    <span class="hljs-string">"your-project/service"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

<span class="hljs-comment">// UserHandler 用户接口层</span>
<span class="hljs-keyword">type</span> UserHandler <span class="hljs-keyword">struct</span> {
    userService *service.UserService
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserHandler</span><span class="hljs-params">(userService *service.UserService)</span></span> *UserHandler {
    <span class="hljs-keyword">return</span> &amp;UserHandler{userService: userService}
}

<span class="hljs-comment">// GetUserByIDHandler 处理查询用户请求</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *UserHandler)</span></span> GetUserByIDHandler(c *gin.Context) {
    idStr := c.Param(<span class="hljs-string">"id"</span>)
    id, err := strconv.Atoi(idStr)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        c.JSON(http.StatusBadRequest, gin.H{<span class="hljs-string">"error"</span>: <span class="hljs-string">"无效的用户ID"</span>})
        <span class="hljs-keyword">return</span>
    }

    user, err := h.userService.GetUserByID(id)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        c.JSON(http.StatusInternalServerError, gin.H{<span class="hljs-string">"error"</span>: err.Error()})
        <span class="hljs-keyword">return</span>
    }

    c.JSON(http.StatusOK, gin.H{<span class="hljs-string">"data"</span>: user})
}

</code></pre>
<h4 data-id="heading-46">8.2.6 初始化与依赖注入（main.go）</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"your-project/dao"</span>
    <span class="hljs-string">"your-project/handler"</span>
    <span class="hljs-string">"your-project/service"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
    _ <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 初始化数据库连接</span>
    db, err := sql.Open(<span class="hljs-string">"mysql"</span>, <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test_db"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    <span class="hljs-keyword">defer</span> db.Close()

    <span class="hljs-comment">// 2. 初始化DAO实现（MySQL）</span>
    userDAO := dao.NewMySQLUserDAO(db)

    <span class="hljs-comment">// 3. 初始化服务层（注入DAO接口）</span>
    userService := service.NewUserService(userDAO)

    <span class="hljs-comment">// 4. 初始化接口层（注入服务层）</span>
    userHandler := handler.NewUserHandler(userService)

    <span class="hljs-comment">// 5. 启动HTTP服务</span>
    r := gin.Default()
    r.GET(<span class="hljs-string">"/users/:id"</span>, userHandler.GetUserByIDHandler)
    r.Run(<span class="hljs-string">":8080"</span>)
}

</code></pre>
<h3 data-id="heading-47">8.3 接口分层应用的核心优势</h3>
<ul>
<li>
<p><strong>解耦模块</strong>：服务层依赖DAO接口，不依赖具体实现，更换数据存储（如从MySQL改为PostgreSQL）时，只需修改DAO实现，无需修改服务层代码；</p>
</li>
<li>
<p><strong>便于测试</strong>：可以为DAO接口编写“模拟实现（Mock）”，在单元测试时隔离数据库，提高测试效率；</p>
</li>
<li>
<p><strong>并行开发</strong>：DAO接口定义完成后，服务层和DAO实现层可以并行开发（服务层基于接口编写逻辑，DAO层实现接口）；</p>
</li>
<li>
<p><strong>扩展性强</strong>：新增功能时，只需新增接口和实现，不影响原有代码，符合“开闭原则”。</p>
</li>
</ul>
<h3 data-id="heading-48">8.4 分层应用的最佳实践</h3>
<ul>
<li>
<p><strong>接口定义在“依赖方”所在的包</strong>：如UserDAO接口定义在service包（依赖方），而非dao包（实现方），避免循环依赖；</p>
</li>
<li>
<p><strong>依赖注入（DI）</strong>：通过构造函数将接口实现注入到依赖方（如UserService的NewUserService注入UserDAO），而非在依赖方内部直接创建实现；</p>
</li>
<li>
<p><strong>接口粒度适中</strong>：层间接口的粒度要平衡“复用性</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OoderAgent Next 项目 （1月29日）TRAE自动化测试报告]]></title>    <link>https://juejin.cn/post/7600642904383406086</link>    <guid>https://juejin.cn/post/7600642904383406086</guid>    <pubDate>2026-01-30T00:45:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600642904383406086" data-draft-id="7600705405594714175" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OoderAgent Next 项目 （1月29日）TRAE自动化测试报告"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T00:45:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OoderAgent Next 项目 （1月29日）TRAE自动化测试报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:45:28.000Z" title="Fri Jan 30 2026 00:45:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本人使用TRAE作为测试工具，预装java 和maven环境。从git库拉代码到完整运行118个功能测试用例，实测大约需要6-8分钟完成。现有版本测试用例通过率100%。这次版本测试主要是针对，多网UDP分发命令脱机等待等异常情形进行时间和容错方面的优化。下面是完整报告供参考。</p>
<h2 data-id="heading-1">1. 项目概述</h2>
<p>Super-Agent 是一套基于 MIT 协议的开源企业级 AI 能力分发与自动化协作框架，采用 P2P 网络架构和无状态技能分发机制，为企业提供从简单任务到复杂流程的全场景自动化解决方案。</p>
<p><strong>核心组件</strong>：</p>
<ul>
<li>agent-sdk：核心 SDK 实现，包含完整的 Agent 接口体系</li>
<li>agent-skillcenter：技能中心实现</li>
<li>skill-a/b/c：不同类型的技能实现</li>
<li>skill-vfs：虚拟文件系统管理</li>
<li>skills-a2ui：AI 辅助 UI 生成</li>
</ul>
<h2 data-id="heading-2">2. 环境要求</h2>



































<table><thead><tr><th>环境项</th><th>版本/要求</th><th>备注</th></tr></thead><tbody><tr><td>JDK</td><td>1.8+</td><td>必须支持 Java 8</td></tr><tr><td>Maven</td><td>3.6+</td><td>推荐 3.8.6</td></tr><tr><td>操作系统</td><td>Windows/Linux/macOS</td><td>本攻略基于 Windows 环境</td></tr><tr><td>网络</td><td>本地网络</td><td>支持 UDP 广播（用于服务发现）</td></tr><tr><td>内存</td><td>8GB+</td><td>推荐 16GB 以上</td></tr></tbody></table>
<h2 data-id="heading-3">3. 详细步骤与耗时统计</h2>
<h3 data-id="heading-4">步骤 1：克隆项目仓库</h3>
<p><strong>命令</strong>：<code>git clone https://gitee.com/ooderCN/super-agent.git</code><br/>
<strong>耗时</strong>：约 2-3 分钟（取决于网络速度）<br/>
<strong>结果</strong>：成功克隆 5031 个对象和 3182 个文件</p>
<h3 data-id="heading-5">步骤 2：分析项目结构</h3>
<p><strong>操作</strong>：查看项目目录结构和测试用例文档<br/>
<strong>耗时</strong>：约 5 分钟<br/>
<strong>结果</strong>：了解项目的 9 个模块结构和 23 个测试用例</p>
<h3 data-id="heading-6">步骤 3：安装项目依赖</h3>
<p><strong>命令</strong>：<code>mvn dependency:resolve</code><br/>
<strong>耗时</strong>：约 22.87 秒<br/>
<strong>结果</strong>：成功解析所有依赖，10 个模块构建成功</p>
<h3 data-id="heading-7">步骤 4：编译项目</h3>
<p><strong>命令</strong>：<code>mvn compile</code><br/>
<strong>耗时</strong>：约 36.04 秒<br/>
<strong>结果</strong>：成功编译所有 10 个模块，出现一些警告但不影响运行</p>
<h3 data-id="heading-8">步骤 5：运行测试用例</h3>
<p><strong>命令</strong>：<code>mvn test -pl agent-sdk</code><br/>
<strong>耗时</strong>：约 1 分 22 秒<br/>
<strong>结果</strong>：成功运行 118 个测试用例，全部通过</p>
<h2 data-id="heading-9">4. 遇到的问题与解决方案</h2>





























<table><thead><tr><th>问题</th><th>现象</th><th>原因</th><th>解决方案</th></tr></thead><tbody><tr><td>端口冲突</td><td>测试时出现端口已被占用的警告</td><td>默认端口 9001 被其他服务占用</td><td>系统自动分配备用端口（9046-9048）</td></tr><tr><td>编译警告</td><td>编译时出现未经检查或不安全的操作警告</td><td>代码中使用了泛型等未指定类型参数</td><td>不影响运行，可使用 <code>-Xlint:unchecked</code> 查看详细信息</td></tr><tr><td>依赖解析</td><td>首次构建时依赖下载较慢</td><td>从中央仓库下载依赖</td><td>配置了阿里云 Maven 镜像，加速依赖下载</td></tr></tbody></table>
<h2 data-id="heading-10">5. 测试结果分析</h2>
<h3 data-id="heading-11">测试覆盖范围</h3>
<ul>
<li><strong>核心功能</strong>：AgentSDK 初始化、技能注册与管理</li>
<li><strong>网络通信</strong>：UDP 通信、端口管理、性能优化</li>
<li><strong>存储系统</strong>：本地 JSON 存储、异步操作</li>
<li><strong>系统组件</strong>：重试策略、睡眠策略、参数验证</li>
</ul>
<h3 data-id="heading-12">测试统计</h3>

































<table><thead><tr><th>指标</th><th>数值</th></tr></thead><tbody><tr><td>总测试用例数</td><td>118</td></tr><tr><td>通过率</td><td>100%</td></tr><tr><td>失败数</td><td>0</td></tr><tr><td>错误数</td><td>0</td></tr><tr><td>跳过数</td><td>0</td></tr><tr><td>平均测试时间</td><td>~0.69 秒/用例</td></tr></tbody></table>
<h3 data-id="heading-13">关键测试模块</h3>
<ol>
<li><strong>AgentSDKTest</strong>：测试核心 SDK 功能</li>
<li><strong>UDPSDKTest</strong>：测试 UDP 网络通信</li>
<li><strong>SkillManagementTest</strong>：测试技能管理</li>
<li><strong>LocalJsonStorageTest</strong>：测试本地存储</li>
<li><strong>ParamValidatorTest</strong>：测试参数验证</li>
</ol>
<h2 data-id="heading-14">6. 技术亮点与架构分析</h2>
<h3 data-id="heading-15">核心设计理念</h3>
<ul>
<li><strong>无状态无中心分发</strong>：技能的无状态封装和按需获取</li>
<li><strong>P2P 网络架构</strong>：支持设备间技能和数据共享</li>
<li><strong>自组织网络</strong>：节点自动发现、动态拓扑和负载均衡</li>
<li><strong>本地优先执行</strong>：保护用户隐私，支持离线使用</li>
</ul>
<h3 data-id="heading-16">技术实现</h3>
<ul>
<li><strong>模块化架构</strong>：接口与实现分离，便于扩展和测试</li>
<li><strong>异步执行机制</strong>：使用 CompletableFuture 实现高效异步操作</li>
<li><strong>安全加密传输</strong>：保障通信安全</li>
<li><strong>性能优化</strong>：UDP 通信性能优化，支持高并发场景</li>
</ul>
<h2 data-id="heading-17">7. 部署建议与最佳实践</h2>
<h3 data-id="heading-18">部署方式</h3>
<ol>
<li><strong>本地开发环境</strong>：适合开发和测试</li>
<li><strong>测试环境</strong>：多台服务器组成的测试网络</li>
<li><strong>生产环境</strong>：根据业务需求进行集群部署</li>
</ol>
<h3 data-id="heading-19">最佳实践</h3>
<ol>
<li><strong>端口管理</strong>：确保不同服务使用不同端口，避免冲突</li>
<li><strong>网络配置</strong>：确保网络环境支持 UDP 广播（企业内网可能需要特殊配置）</li>
<li><strong>监控告警</strong>：部署监控系统，及时发现和处理异常</li>
<li><strong>版本管理</strong>：使用 Git 进行版本控制，定期更新依赖</li>
<li><strong>测试策略</strong>：定期运行测试用例，确保系统稳定性</li>
</ol>
<h2 data-id="heading-20">8. 总结与展望</h2>
<h3 data-id="heading-21">完成情况</h3>
<ul>
<li>✅ 成功克隆项目仓库</li>
<li>✅ 成功安装所有依赖</li>
<li>✅ 成功编译所有模块</li>
<li>✅ 成功运行测试用例（100% 通过）</li>
<li>✅ 验证了核心功能的稳定性</li>
</ul>
<h3 data-id="heading-22">技术价值</h3>
<p>Super-Agent 项目展示了一套完整的 AI 能力分发与自动化协作框架，其核心价值在于：</p>
<ol>
<li><strong>标准化</strong>：定义了统一的 AI 能力接口规范</li>
<li><strong>模块化</strong>：支持技能的模块化开发和管理</li>
<li><strong>可扩展</strong>：支持水平扩展，适应不同规模的应用场景</li>
<li><strong>安全可靠</strong>：基于 RBAC 的权限管理，确保系统安全</li>
</ol>
<h3 data-id="heading-23">未来发展建议</h3>
<ol>
<li><strong>技能生态</strong>：构建更丰富的技能生态，支持更多应用场景</li>
<li><strong>性能优化</strong>：进一步优化网络通信和存储性能</li>
<li><strong>可视化工具</strong>：开发更多可视化管理工具，降低使用门槛</li>
<li><strong>云原生支持</strong>：增强容器化和云原生部署能力</li>
<li><strong>社区建设</strong>：活跃社区，吸引更多开发者参与</li>
</ol>
<h2 data-id="heading-24">9. 附录：常用命令参考</h2>



































<table><thead><tr><th>命令</th><th>功能</th><th>适用场景</th></tr></thead><tbody><tr><td><code>mvn clean</code></td><td>清理构建产物</td><td>重新构建前</td></tr><tr><td><code>mvn package</code></td><td>打包项目</td><td>部署前</td></tr><tr><td><code>mvn spring-boot:run -pl skill-a</code></td><td>启动单个技能服务</td><td>功能测试</td></tr><tr><td><code>mvn test -Dtest=AgentSDKTest</code></td><td>运行指定测试类</td><td>针对性测试</td></tr><tr><td><code>mvn dependency:tree</code></td><td>查看依赖树</td><td>依赖分析</td></tr></tbody></table>
<hr/>
<p><strong>总耗时统计</strong>：约 5-6 分钟（不包含网络下载时间）</p>
<ul>
<li>准备阶段：5 分钟</li>
<li>构建阶段：约 59 秒</li>
<li>测试阶段：约 82 秒</li>
<li>分析总结：10 分钟</li>
</ul>
<p><strong>测试结论</strong>：Super-Agent 项目代码质量良好，核心功能稳定，测试覆盖率高，适合在生产环境中部署使用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌握前端权衡：2026 高级开发者指南]]></title>    <link>https://juejin.cn/post/7600684978352750619</link>    <guid>https://juejin.cn/post/7600684978352750619</guid>    <pubDate>2026-01-30T00:50:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600684978352750619" data-draft-id="7600684978352668699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌握前端权衡：2026 高级开发者指南"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-30T00:50:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌握前端权衡：2026 高级开发者指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:50:17.000Z" title="Fri Jan 30 2026 00:50:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fmastering-frontend-tradeoffs-the-2026-guide-for-senior-devs%2F" target="_blank" title="https://thenewstack.io/mastering-frontend-tradeoffs-the-2026-guide-for-senior-devs/" ref="nofollow noopener noreferrer">Mastering Frontend Tradeoffs: The 2026 Guide for Senior Devs</a></p>
<p>翻译：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.heyfe.org%2Fblog" target="_blank" title="https://blog.heyfe.org/blog" ref="nofollow noopener noreferrer">嘿嘿</a></p>
<p>项目来源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">前端周刊</a>（每周更新国外论坛的前端热门文章，推荐大家阅读/翻译，紧跟时事，掌握前端技术动态）</p>
<p>网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendweekly.cn%2F" target="_blank" title="https://frontendweekly.cn/" ref="nofollow noopener noreferrer">frontendweekly.cn/</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/545f14651c954e5d989ccc1a769b21ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770339018&amp;x-signature=489aihgWiSnKpcT37K3irtwwPFU%3D" alt="f2f1571449cd7e20ef5b559c7e7220de.png" loading="lazy"/></p>
<p>如今的前端生态不再仅仅由新鲜感驱动。团队现在更看重性能预算、招聘信号、维护成本，以及当需求变动时产品的响应速度。</p>
<p>大家评价一个库的标准，已经从“够不够火”转向了它在复杂、混乱的真实系统中的表现。这种观念的转变，也改变了开发者们的学习重心。</p>
<p>如果你已经具备了构建大型前端系统的能力，那么问题就不再是“今天流行什么”，而是哪些工具能磨练你的直觉、扩展你的架构选择，并且在两年后依然屹立不倒。这就是这份清单的切入点。</p>
<h2 data-id="heading-0">1. React 不再是选修课，但它的进化已接近终点</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%231-react-%25E4%25B8%258D%25E5%2586%258D%25E6%2598%25AF%25E9%2580%2589%25E4%25BF%25AE%25E8%25AF%25BE%25E4%25BD%2586%25E5%25AE%2583%25E7%259A%2584%25E8%25BF%259B%25E5%258C%2596%25E5%25B7%25B2%25E6%258E%25A5%25E8%25BF%2591%25E7%25BB%2588%25E7%2582%25B9" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#1-react-%E4%B8%8D%E5%86%8D%E6%98%AF%E9%80%89%E4%BF%AE%E8%AF%BE%E4%BD%86%E5%AE%83%E7%9A%84%E8%BF%9B%E5%8C%96%E5%B7%B2%E6%8E%A5%E8%BF%91%E7%BB%88%E7%82%B9" ref="nofollow noopener noreferrer"/></p>
<p>React 已经跨过了一个重要的门槛。它不再是一个快速更迭的实验品，也不是那种学完就能随手替换的框架。它已经成为了“基础设施”。到 2026 年，学习 React 的重点不再是追逐新特性，而是<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fwhy-react-is-no-longer-the-undisputed-champion-of-javascript%2F" target="_blank" title="https://thenewstack.io/why-react-is-no-longer-the-undisputed-champion-of-javascript/" ref="nofollow noopener noreferrer">理解其成熟生态系统中蕴含的权衡取舍</a>。</p>
<p>最大的变化在于哲学层面。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.developerway.com%2Fposts%2Freact-state-management-2025" target="_blank" title="https://www.developerway.com/posts/react-state-management-2025" ref="nofollow noopener noreferrer">React 的核心 API 相对稳定</a>，但周边的开发模式一直在变。服务端组件（Server Components）、流式渲染（Streaming Rendering），以及像 Next.js 这种越来越“有主见”的框架，已经把 React 从一个独立的库变成了一个平台。资深开发者需要理解这些碎片是如何拼凑在一起的，而不仅仅是掌握 Hooks 的用法。</p>
<blockquote>
<p>React 依然是前端领域最强有力的招聘信号。</p>
</blockquote>
<p>此外，React 依然是前端最强有力的招聘信号。不管你喜不喜欢，这都很现实。即便是在尝试替代方案的团队，依然希望资深工程师能用 React 的思维去思考，因为它在设计系统、共享组件库和内部工具中占据主导地位。</p>
<p>在 2026 年学习 React 意味着向深度钻研，而非广度。多关注性能特性、水合（Hydration）边界、状态归属权以及抽象的成本。把 React 当作一门你已经说得很流利的语言，然后去精修你的“口音”。</p>
<p><strong>热门故事：</strong></p>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fwhy-platform-companies-keep-buying-frontend-framework-teams%2F" target="_blank" title="https://thenewstack.io/why-platform-companies-keep-buying-frontend-framework-teams/" ref="nofollow noopener noreferrer">为什么平台公司不断收购前端框架团队</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fcloudflare-acquires-team-behind-open-source-framework-astro%2F" target="_blank" title="https://thenewstack.io/cloudflare-acquires-team-behind-open-source-framework-astro/" ref="nofollow noopener noreferrer">Cloudflare 收购开源框架 Astro 背后的团队</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Finferno-vet-creates-frontend-framework-built-with-ai-in-mind%2F" target="_blank" title="https://thenewstack.io/inferno-vet-creates-frontend-framework-built-with-ai-in-mind/" ref="nofollow noopener noreferrer">Inferno 老兵创建了专为 AI 设计的前端框架</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fastro-redesigns-its-development-server%2F" target="_blank" title="https://thenewstack.io/astro-redesigns-its-development-server/" ref="nofollow noopener noreferrer">Astro 重新设计其开发服务器</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fmastering-frontend-tradeoffs-the-2026-guide-for-senior-devs%2F" target="_blank" title="https://thenewstack.io/mastering-frontend-tradeoffs-the-2026-guide-for-senior-devs/" ref="nofollow noopener noreferrer">掌握前端权衡：2026 高级开发者指南</a></li>
</ol>
<h2 data-id="heading-1">2. Vue 是“无尘室”级别的框架</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%232-vue-%25E6%2598%25AF%25E6%2597%25A0%25E5%25B0%2598%25E5%25AE%25A4%25E7%25BA%25A7%25E5%2588%25AB%25E7%259A%2584%25E6%25A1%2586%25E6%259E%25B6" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#2-vue-%E6%98%AF%E6%97%A0%E5%B0%98%E5%AE%A4%E7%BA%A7%E5%88%AB%E7%9A%84%E6%A1%86%E6%9E%B6" ref="nofollow noopener noreferrer"/></p>
<p>Vue 在 2026 年的吸引力微妙而强大。它不再试图赢得框架之争，而是将自己定位为<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fa-peek-at-whats-next-for-vue%2F" target="_blank" title="https://thenewstack.io/a-peek-at-whats-next-for-vue/" ref="nofollow noopener noreferrer">构建低摩擦、可维护前端</a>的最纯净方式。对于资深开发者来说，这种克制恰恰是其价值所在。</p>
<p>Vue 的单文件组件（SFC）和响应式模型依然直观，但其真正的价值在于大型 Vue 代码库的极高可预测性。它的约定很强，但不会让你感到窒息，而且新成员的学习曲线异常平滑。这使得 Vue 对于长期维护的产品（而非实验性项目）极具吸引力。</p>
<blockquote>
<p>Vue 能强化良好的习惯。</p>
</blockquote>
<p>Vue 的生态系统在沉默中走向成熟。工具链非常稳定，状态管理不再混乱，基于 Vue 的元框架（Meta-frameworks）也在灵活性和结构化之间找到了舒适的平衡点。你可以花更少的时间去折腾配置，花更多的时间去思考真正的 UI 问题。</p>
<p>对于资深开发者，Vue 值得学习不是因为它时髦，而是<a href="https://link.juejin.cn?target=https%3A%2F%2Fvueschool.io%2Farticles%2Fnews%2Fthe-human-side-of-vue-js-how-learning-vue-changes-your-life-as-a-developer%2F" target="_blank" title="https://vueschool.io/articles/news/the-human-side-of-vue-js-how-learning-vue-changes-your-life-as-a-developer/" ref="nofollow noopener noreferrer">因为它能强化良好的习惯</a>。清晰的数据流、可读性强的模板和刻意的组件组合模式，在任何框架中都是通用的。即使你日常不用 Vue，学习它也能磨练你设计接口的能力。</p>
<h2 data-id="heading-2">3. Svelte/SvelteKit 回馈那些关注“产出”的开发者</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%233-sveltesveltekit-%25E5%259B%259E%25E9%25A6%2588%25E9%2582%25A3%25E4%25BA%259B%25E5%2585%25B3%25E6%25B3%25A8%25E4%25BA%25A7%25E5%2587%25BA%25E7%259A%2584%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#3-sveltesveltekit-%E5%9B%9E%E9%A6%88%E9%82%A3%E4%BA%9B%E5%85%B3%E6%B3%A8%E4%BA%A7%E5%87%BA%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85" ref="nofollow noopener noreferrer"/></p>
<p>Svelte 持续吸引着那些深切关注“最终交付给浏览器了什么”的开发者。其“编译器优先”的模型迫使你少去关注运行时的各种操作，多去关注用户收到的实际 JS 和 CSS。在 2026 年，这种思维方式越来越重要。</p>
<p>对于老练的工程师来说，它的学习曲线让人耳目一新。你不用花大量时间去背诵框架特有的心智模型，只需编写符合预期的代码。它的响应式是显式的，而非隐式生成的，这<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fall-about-svelte-the-much-loved-state-driven-web-framework%2F" target="_blank" title="https://thenewstack.io/all-about-svelte-the-much-loved-state-driven-web-framework/" ref="nofollow noopener noreferrer">降低了复杂组件的认知负担</a>。</p>
<blockquote>
<p>Svelte 影响着优秀开发者的思考方式。</p>
</blockquote>
<p>SvelteKit 已经<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Frich-harris-talks-sveltekit-and-whats-next-for-svelte%2F" target="_blank" title="https://thenewstack.io/rich-harris-talks-sveltekit-and-whats-next-for-svelte/" ref="nofollow noopener noreferrer">成熟为一个严肃的应用框架</a>。路由、数据加载和部署等问题的整合非常连贯，没有那种东拼西凑的感觉。这使得它完全能胜任生产环境系统，而不仅仅是玩具项目或 Demo。</p>
<p>Svelte 可能永远不会在招聘职位数上占据统治地位，但它会影响优秀开发者的思考方式。学习它可以重新校准你对性能、打包和非必要抽象的直觉。即便你之后回到了 React，也会带回更敏锐的直觉。</p>
<h2 data-id="heading-3">4. Solid 和 Qwik 代表了 Web 的未来方向</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%234-solid-%25E5%2592%258C-qwik-%25E4%25BB%25A3%25E8%25A1%25A8%25E4%25BA%2586-web-%25E7%259A%2584%25E6%259C%25AA%25E6%259D%25A5%25E6%2596%25B9%25E5%2590%2591" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#4-solid-%E5%92%8C-qwik-%E4%BB%A3%E8%A1%A8%E4%BA%86-web-%E7%9A%84%E6%9C%AA%E6%9D%A5%E6%96%B9%E5%90%91" ref="nofollow noopener noreferrer"/></p>
<p>有些库的存在不是为了市场份额，而是为了传递思想。Solid 和 Qwik 就属于这一类。在 2026 年，它们的重要性不在于普及率，而在于它们预示了前端架构的演进方向。</p>
<p>Solid 展示了在不牺牲开发体验的前提下，细粒度响应式（Fine-grained reactivity）能走多远。它的性能表现挑战了虚拟 DOM 时代的固有思维，<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fsolidjs-creator-on-fine-grained-reactivity-as-next-frontier%2F" target="_blank" title="https://thenewstack.io/solidjs-creator-on-fine-grained-reactivity-as-next-frontier/" ref="nofollow noopener noreferrer">同时对 React 开发者来说依然感到亲切</a>。这种组合使其成为资深工程师绝佳的学习工具。</p>
<blockquote>
<p>这些库扮演着“概念训练场”的角色。</p>
</blockquote>
<p>Qwik 则更进一步，从底层重新思考了水合和执行逻辑。它对“可恢复性”（Resumability）的关注迫使你直面<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fjavascript-on-demand-how-qwik-differs-from-react-hydration%2F" target="_blank" title="https://thenewstack.io/javascript-on-demand-how-qwik-differs-from-react-hydration/" ref="nofollow noopener noreferrer">在启动时到底需要运行多少 JavaScript</a>。随着性能预算越来越紧，这种视角变得越来越重要。</p>
<p>你可能永远不会去交付一个大型的 Qwik 应用，但理解它的模型会改变你对加载、交互和用户感知速度的认知。这些库不仅仅是生产工具，更是思想实验场。</p>
<h2 data-id="heading-4">5. Web Components：不再是尴尬的“中间派”</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%235-web-components%25E4%25B8%258D%25E5%2586%258D%25E6%2598%25AF%25E5%25B0%25B4%25E5%25B0%25AC%25E7%259A%2584%25E4%25B8%25AD%25E9%2597%25B4%25E6%25B4%25BE" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#5-web-components%E4%B8%8D%E5%86%8D%E6%98%AF%E5%B0%B4%E5%B0%AC%E7%9A%84%E4%B8%AD%E9%97%B4%E6%B4%BE" ref="nofollow noopener noreferrer"/></p>
<p>Web Components 已经<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fweb-components-are-the-comeback-nobody-saw-coming%2F" target="_blank" title="https://thenewstack.io/web-components-are-the-comeback-nobody-saw-coming/" ref="nofollow noopener noreferrer">悄无声息地获得了正统地位</a>。浏览器支持已经非常稳固，工具链也得到了改善，团队终于开始在它们最擅长的领域使用它们：构建持久的、框架无关的 UI 原型。在 2026 年，这使得它们<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fhow-to-build-framework-agnostic-uis-with-web-components%2F" target="_blank" title="https://thenewstack.io/how-to-build-framework-agnostic-uis-with-web-components/" ref="nofollow noopener noreferrer">对资深开发者尤为重要</a>。</p>
<p>其魅力不在于用自定义元素构建整个应用，而在于创建那些能挺过框架更迭周期的共享组件。设计系统、嵌入式小部件和跨团队组件库都能从这种方式中获益匪浅。</p>
<blockquote>
<p>学习 Web Components 能加深你对 Web 平台本身的理解。</p>
</blockquote>
<p>现代工具链已经消除了大部分原始痛点。编写代码不再那么啰嗦，互操作性得到了提升，框架对自定义元素的支持也比几年前友好得多。曾经让团队望而却步的阻力大半已经消失。</p>
<p>学习 Web Components 能加深你对 Web 平台本身的理解。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb%255Fcomponents%2FUsing%255Fshadow%255FDOM" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Web%5Fcomponents/Using%5Fshadow%5FDOM" ref="nofollow noopener noreferrer">Shadow DOM</a>、插槽（Slots）和生命周期钩子迫使你在更底层进行思考。无论你最后在上面套了哪个框架，这些底层知识都会让你受益终身。</p>
<h2 data-id="heading-5">核心要点：掌握前端权衡</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn%2Fblob%2Fmain%2Fweekly%2F449%2F%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1%25EF%25BC%259A2026%2520%25E9%25AB%2598%25E7%25BA%25A7%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E6%258C%2587%25E5%258D%2597%2Findex.md%23%25E6%25A0%25B8%25E5%25BF%2583%25E8%25A6%2581%25E7%2582%25B9%25E6%258E%258C%25E6%258F%25A1%25E5%2589%258D%25E7%25AB%25AF%25E6%259D%2583%25E8%25A1%25A1" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn/blob/main/weekly/449/%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1%EF%BC%9A2026%20%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/index.md#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9%E6%8E%8C%E6%8F%A1%E5%89%8D%E7%AB%AF%E6%9D%83%E8%A1%A1" ref="nofollow noopener noreferrer"/></p>
<p>在 2026 年，最优秀的前端开发者并不是看谁掌握的库多，而是看谁更懂得权衡。这份清单上的每一个工具，都是因为它们提供了一种思考 UI、性能和长期维护性的不同方式，才赢得了自己的一席之地。</p>
<p>React 依然是通用语言，Vue 回馈清晰，Svelte 强调产出，实验性框架扩展心智模型，而 Web Components 让你重新拥抱底层平台。这些选择并非互斥。</p>
<p>去选择那些能挑战你的假设并提升你思维方式的库，而不仅仅是那些能让你写代码的库。无论前端生态下次又折腾出什么新花样，这些能力才是你对抗技术周期和架构重组的终极武器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 最佳实践发布：Vercel 官方出品的性能优化指南]]></title>    <link>https://juejin.cn/post/7600622206269374474</link>    <guid>https://juejin.cn/post/7600622206269374474</guid>    <pubDate>2026-01-30T00:55:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206269374474" data-draft-id="7600597995769200649" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 最佳实践发布：Vercel 官方出品的性能优化指南"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-30T00:55:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 最佳实践发布：Vercel 官方出品的性能优化指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:55:40.000Z" title="Fri Jan 30 2026 00:55:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fintroducing-react-best-practices" target="_blank" title="https://vercel.com/blog/introducing-react-best-practices" ref="nofollow noopener noreferrer">Introducing: React Best Practices</a></p>
<p>翻译：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.heyfe.org%2Fblog" target="_blank" title="https://blog.heyfe.org/blog" ref="nofollow noopener noreferrer">嘿嘿</a></p>
<p>来源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">前端周刊</a>（每周更新国外论坛的前端热门文章，推荐大家阅读/翻译，紧跟时事，掌握前端技术动态）</p>
<p>网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendweekly.cn%2F" target="_blank" title="https://frontendweekly.cn/" ref="nofollow noopener noreferrer">frontendweekly.cn/</a></p>
</blockquote>
<p>我们将 10 多年来在 React 和 Next.js 优化方面积累的知识，浓缩成了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fagent-skills%2Ftree%2Fmain%2Fskills%2Freact-best-practices" target="_blank" title="https://github.com/vercel-labs/agent-skills/tree/main/skills/react-best-practices" ref="nofollow noopener noreferrer">react-best-practices</a> 项目。这是一个专门为 AI Agent 和大语言模型（LLM）优化的结构化知识库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2ef8750e32546e58a2eded133d87fec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770339340&amp;x-signature=U1VgQBgQZCP0dGbP63QPvYNTLqc%3D" alt="image.png" loading="lazy"/></p>
<p>实话说，React 的性能优化工作通常都是“被动”的：版本发布了，发现应用变慢了，然后团队开始到处“救火”，去排查各种症状。这种方式不仅成本高昂，而且很容易优化错地方，导致事倍功半。</p>
<p>在过去十年的生产环境代码库中，我们反复看到同样的性能“病灶”：</p>
<ul>
<li>异步任务不小心变成了串行（Sequential）执行。</li>
<li>客户端 Bundle 随着时间推移变得越来越臃肿。</li>
<li>组件进行了大量不必要的重复渲染。</li>
</ul>
<p>其中的道理很简单：这些并不是什么“微优化”。它们会直接转化为用户的等待时间、页面卡顿以及每次用户访问时的重复成本。</p>
<p>因此，我们整理了这套 React 最佳实践框架，旨在让这些问题更容易被发现，并能更快速地得到解决。</p>
<h3 data-id="heading-0">核心理念：优先级顺序</h3>
<p>大多数性能优化工作之所以失败，是因为切入点太低了。</p>
<p>如果一个请求瀑布流（Waterfall）增加了 600ms 的等待时间，那你再怎么优化 <code>useMemo</code> 也是白搭。如果你给每个页面都多发了 300KB 的 JavaScript，在循环里省下那几微秒根本无关痛痒。</p>
<p>性能问题是会累积的。你今天引入的一个细微的性能退化，在有人来清理这笔债务之前，都会变成每一次用户访问的长期“负担”。</p>
<p>所以，这套框架从两个最能显著提升现实指标的优化点开始：</p>
<ol>
<li><strong>消除瀑布流</strong></li>
<li><strong>减小 Bundle 体积</strong></li>
</ol>
<p>接着，它会延伸到服务端性能、客户端数据获取以及重复渲染优化。</p>
<p>该框架包含 8 个类别的 40 多条规则，按影响力从“至关重要（CRITICAL）”（如消除瀑布流、减小包体积）到“增量提升（INCREMENTAL）”（如高级模式）进行排序。</p>
<h2 data-id="heading-1">里面还有什么？</h2>
<p>该仓库涵盖了八个性能类别：</p>
<ul>
<li>消除异步瀑布流</li>
<li>Bundle 体积优化</li>
<li>服务端性能</li>
<li>客户端数据获取</li>
<li>重复渲染优化</li>
<li>渲染性能</li>
<li>高级模式</li>
<li>JavaScript 性能</li>
</ul>
<p>每条规则都包含影响力评级（从 CRITICAL 到 LOW），帮助你排好修复的优先级，并附带代码示例，展示哪些写法会出问题以及该如何修复。</p>
<p>例如，下面是一个阻碍代码 Tree-shaking（无用代码消除）的常见模式：</p>
<p><em>错误写法（两个分支都会被阻塞）：</em></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, skipProcessing: <span class="hljs-built_in">boolean</span></span>) {
  <span class="hljs-comment">// 即使 skipProcessing 为 true，也会等待 fetchUserData</span>
  <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId)
  
  <span class="hljs-keyword">if</span> (skipProcessing) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">skipped</span>: <span class="hljs-literal">true</span> }
  }
  
  <span class="hljs-comment">// 只有这个分支才真正需要 userData</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">processUserData</span>(userData)
}
</code></pre>
<p><em>正确写法（仅在需要时阻塞）：</em></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, skipProcessing: <span class="hljs-built_in">boolean</span></span>) {
  <span class="hljs-keyword">if</span> (skipProcessing) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">skipped</span>: <span class="hljs-literal">true</span> }
  }
  
  <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId)
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">processUserData</span>(userData)
}
</code></pre>
<p>这些独立的规则文件会编译成 <code>AGENTS.md</code>，这是一个单一文档，你的 AI Agent 在审查代码或提供优化建议时可以随时查阅。它的设计初衷就是为了被持续遵循（包括执行代码重构的 AI Agent），这样团队就能在大规模代码库中应用一致的决策标准。</p>
<h2 data-id="heading-2">这些实践是如何收集的？</h2>
<p>这些规则并非纸上谈兵，它们全都源自生产环境代码库的真实性能优化案例。</p>
<p>举几个例子：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a327aed11f6f44ebbeef8e68a75895b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770339340&amp;x-signature=Dlr040%2BkzeDbfq64dC78d9ed3nE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>合并循环迭代</strong></p>
<p>在一个聊天页面中，代码竟然对同一组消息列表进行了 8 次独立的遍历扫描。我们将其合并为一次遍历，当你有数千条消息时，这个提升是非常可观的。</p>
<p><strong>并行化 await</strong></p>
<p>某个 API 在等待一个数据库调用完成后才开始下一个，尽管它们之间并没有依赖关系。通过让它们同时运行，总等待时间直接减半。</p>
<p><strong>状态惰性初始化（Lazy State Initialization）</strong></p>
<p>一个组件在每次渲染时都会从 <code>localStorage</code> 解析一次 JSON 配置，尽管它只在初始化状态时需要它一次。通过将解析过程包裹在回调函数中（<code>useState(() =&gt; JSON.parse(...))</code>），成功消除了这些无用功。</p>
<h3 data-id="heading-3">在你的编程 Agent 中使用 <code>react-best-practices</code></h3>
<p>这些最佳实践也被打包成了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fagent-skills" target="_blank" title="https://github.com/vercel-labs/agent-skills" ref="nofollow noopener noreferrer">Agent Skills</a>，可以安装到 Opencode、Codex、Claude Code、Cursor 以及其他编程 Agent 中。当你的 Agent 发现级联的 <code>useEffect</code> 调用或沉重的客户端导入时，它可以引用这些模式并给出修复建议。</p>
<pre><code class="hljs language-bash" lang="bash">npx add-skill vercel-labs/agent-skills
</code></pre>
<p>快去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fagent-skills%2Ftree%2Fmain%2Fskills%2Freact-best-practices" target="_blank" title="https://github.com/vercel-labs/agent-skills/tree/main/skills/react-best-practices" ref="nofollow noopener noreferrer">react-best-practices</a> 仓库看看吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个好的开发可能用不好 AI]]></title>    <link>https://juejin.cn/post/7600665529112150016</link>    <guid>https://juejin.cn/post/7600665529112150016</guid>    <pubDate>2026-01-30T00:55:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600665529112150016" data-draft-id="7598938568431927311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个好的开发可能用不好 AI"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-30T00:55:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个好的开发可能用不好 AI
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:55:13.000Z" title="Fri Jan 30 2026 00:55:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e35903dfdf842d39a51c38736757fae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770339315&amp;x-signature=yfC2trG7QMJKWN%2F3b06JpmbjTLg%3D" alt="0.png" loading="lazy"/></p>
<p>我用了大概半年的 cursor，我发现以目前的 AI 技术，还不能指望 AI 能神奇地替自己干活。</p>
<p>也就是说，现在还不能做到，我告诉他成品的效果，然后我出门玩儿，让他干活儿，回家就奇迹般的完成的整个产品的创作。</p>
<p>开发者们逐渐达成了一种更务实的共识：<strong>AI 更像是个实习生，而不是资深开发者的替代品</strong>。但既然如此，其推论也同样成立：<strong>如果你把 AI 当作实习生，那你就是它的经理</strong>。</p>
<p>可惜的是，大多数开发者并不擅长当经理。</p>
<p>这也就是我题目的观点，一个好的开发可能用不好 AI。</p>
<p>这一点在日常使用 Cluade、Cursor 或 ChatGPT 等工具时随处可见。</p>
<p>我们常常抛出模糊、草率的指令，比如“把按钮改成蓝色”或“修一下数据库连接”，然后又对 AI 的胡编乱造感到惊讶——它可能凭空引用一个 2019 年就已废弃的库，或者把关键的身份验证流程重构成了一个公开的安全漏洞。</p>
<p>我们责怪模型，说它还不够聪明。</p>
<p>但问题通常不在于模型的智能程度，而在于<strong>我们缺乏清晰的表达</strong>。</p>
<p>要想从这些工具中获得价值，我们不需要更多花哨的提示工程技巧，而是需要<strong>更好的需求规格说明</strong>（specification）。</p>
<p>我们必须把与 AI 的交互看作一种正式的委派过程，而不是念咒施法。</p>
<p>换句话说，我们需要成为更好的经理。</p>
<h2 data-id="heading-0">被忽视的关键技能：写好规格说明</h2>
<p>Google 工程经理 Addy Osmani 最近发表了一篇题为《如何为 AI 智能体写出一份好规格说明》（<a href="https://link.juejin.cn?target=https%3A%2F%2Faddyosmani.com%2Fblog%2Fgood-spec%2F" target="_blank" title="https://addyosmani.com/blog/good-spec/" ref="nofollow noopener noreferrer">How to write a good spec for AI agents</a>）的教程，堪称这一主题的典范。这是我见过的关于“如何当好 AI 经理”最实用的操作指南，也很好地延伸了我最近提出的一些核心原则。</p>
<p>Osmani 并不是在兜售“全自动编码”的科幻愿景。他关注的是如何防止 AI 智能体迷失方向、遗忘上下文，或被信息淹没。</p>
<p>他的核心观点简单却深刻：<strong>向智能体丢出一个庞大、单体式的规格文档往往行不通，因为上下文窗口限制和模型的注意力预算会成为障碍</strong>。</p>
<p>他的解决方案是所谓“<strong>智能规格</strong>”（smart specs）——这些规格要对智能体真正有用、能在多个会话中持久有效，并且结构清晰，让模型能迅速抓住重点。</p>
<p>这正是当前“AI 将使开发者效率提升 10 倍”这类讨论中普遍缺失的一环。<strong>杠杆效应并非来自模型本身，而是来自那个能把意图转化为约束、再把输出转化为可运行软件的人</strong>。生成式 AI 实际上提高了对“资深工程师”的要求，而非降低，因为它需要资深工程师掌握另一项技能，<strong>了解你的项目，并说出来</strong>。</p>
<h2 data-id="heading-1">从提示词到产品管理</h2>
<p>如果你带过初级开发者或者实习生，你一定早就明白这个道理。你肯定不会只说一句“做个登录功能”，而是会明确细节：“创建一个新的登录页面，两个输入框，居中对齐，然后最下面一个发送验证码，一个登录按钮，使用服务端提供的 API 触发登录。”</p>
<p>或者是：“用 OAuth，支持 Google 和 GitHub 登录，会话状态必须保存在服务端，不要碰支付模块，写好集成测试，并为接口写文档。”</p>
<p>诸如此类...</p>
<p>你会提供示例，指出雷区，还会要求提交小的 PR，以便及时检查工作。</p>
<p>Osmani 正是将这种管理纪律迁移到了 AI 智能体的工作流中。他建议先给出高层愿景，让模型扩展成更详细的规格，再由你反复修改，直到这份规格成为双方共享的“唯一真相源”。</p>
<p>这种“<strong>先写规格</strong>（spec-first）”的方法正迅速成为主流，从博客文章走向实际工具。</p>
<p>GitHub 的 AI 团队大力倡导规格驱动开发，并推出了 <strong>Spec Kit</strong>，要求智能体在执行任务前必须有明确的规格、计划和任务分解。</p>
<p>JetBrains 也持相同观点，建议在智能体开始修改代码前设置审查检查点。</p>
<p>Thoughtworks 的 Birgitta Böckeler 甚至提出了一个许多团队悄悄回避的尖锐问题：她指出，规格驱动的演示往往默认开发者会完成大量需求分析工作——即使问题本身模糊不清，或规模大到本应由产品经理和利益相关方主导。</p>
<p>换句话说：<strong>如果你连给人类讲清楚需求都困难，AI 不会救你，只会以更高的 token 消耗放大混乱</strong>。</p>
<p><em>换更多的钱，办更小的事儿！</em></p>
<h2 data-id="heading-2">一份真正有效的 AI 规格模板</h2>
<p>一份好的 AI 规格不是 RFC（征求意见稿），而是一种<strong>让偏离成本高昂、正确实现成本低廉的工具</strong>。</p>
<p>Osmani 建议从简洁的产品简报开始，让 AI 起草详细规格，再由你修正为可在多个会话中复用的“活文档”。这很好，但真正的价值在于你包含的具体内容。</p>
<p>基于 Osmani 的工作和我对高效团队的观察，一份可用的 AI 规格必须包含几个不可或缺的要素：</p>
<ol>
<li><strong>目标与非目标</strong>（Objectives and Non-goals）<br/>
仅用一段话描述目标远远不够。你必须明确列出<strong>哪些内容不在范围内</strong>。“非目标”能防止 AI 在修复一个拼写错误时，自作主张地重写整个 CSS 框架。</li>
<li><strong>模型无法自行推断的上下文</strong><br/>
包括架构约束、领域规则、安全要求和集成点。只要影响业务逻辑，你就得写清楚。AI 无法猜出你的合规边界。</li>
<li><strong>明确的边界</strong>（Boundaries）——这是最关键的<br/>
你需要一份“<strong>禁止触碰</strong>”清单。这些护栏能防止“实习生”误删生产数据库配置、提交密钥，或修改那些维系系统运转的老旧供应商目录。</li>
<li><strong>验收标准</strong>（Acceptance Criteria）<br/>
“完成”到底意味着什么？这应该体现为具体的检查项：测试用例、不变量，以及几个常被忽略的边界情况。如果你觉得这听起来像“良好的工程实践”（甚至“良好的管理”），那是因为它本来就是。我们只是借新工具之名，重新拾起了曾被忽视的基本功。</li>
</ol>
<p>发现了吗？如果用 AI 开发产品，开发者必须要了解产品，了解业务，了解目标，去成为 Product Owner！</p>
<h2 data-id="heading-3">上下文是一种产品，不是一条提示</h2>
<p>开发者对 AI 智能体感到沮丧的一个原因是：我们总把提示当作一次性操作，但它其实不是。它更像是<strong>搭建一个工作环境</strong>。</p>
<p>Osmani 指出，长提示失败不仅因为上下文长度限制，更因为模型在同时接收太多指令时表现会变差。</p>
<p>Anthropic 将这种能力称为“<strong>上下文工程</strong>”（context engineering）——你必须将背景信息、指令、约束、工具和期望输出结构化组织，让模型能可靠地聚焦于最重要的部分。</p>
<p>这实际上改变了开发者的角色定位——从“API 调用专家”转变为“<strong>上下文架构师</strong>”。</p>
<p>你的价值不再是你记得某个 API 的语法（AI 比你更熟），而在于你知道<strong>哪个 API 与当前业务问题相关</strong>，并确保 AI 也清楚这一点。</p>
<p>Ethan Mollick 在《给你的 AI 实习生办理入职》（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oneusefulthing.org%2Fp%2Fon-boarding-your-ai-intern" target="_blank" title="https://www.oneusefulthing.org/p/on-boarding-your-ai-intern" ref="nofollow noopener noreferrer">On-boarding your AI intern</a>）一文中说得更直白：你必须搞清楚实习生在哪方面有用、在哪方面烦人、在哪方面根本不该委派（因为出错代价太高）。这说白了就是<strong>判断力</strong>——而判断力的本质，就是<strong>专业经验</strong>。</p>
<h2 data-id="heading-4">代码所有权的陷阱</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd41c6e8fa945d8a63de1233ecd5c58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770339315&amp;x-signature=RM1zkQGD3pnyCXAzvhUkMBxXGfc%3D" alt="1.png" loading="lazy"/></p>
<p>当然，这里也存在风险。如果我们把实现完全交给 AI，只专注于写规格，就可能<strong>脱离软件的真实世界</strong>。</p>
<p>Honeycomb 的 CTO Charity Majors 一直在警告这一特定风险。她区分了“<strong>代码创作</strong>”（authorship）和“<strong>代码所有权</strong>”（ownership）：AI 让创作变得近乎零成本，但<strong>所有权</strong>（即在生产环境中调试、维护和理解代码的能力）却变得更昂贵。</p>
<p>Majors 认为：“当你过度依赖 AI 工具，只做监督而不亲自动手时，你自己的专业能力会迅速退化。”这给“开发者即经理”的模式带来了悖论：<strong>要写出 Osmani 所倡导的好规格，你需要深厚的技术理解；但如果你整天只写规格、让 AI 写代码，你可能会慢慢失去这种理解</strong>。</p>
<p>你要明白，你是雇佣 AI 来帮你完成工作，而不是让 AI 成为代码的主人</p>
<p>解决方案很可能是<strong>混合模式</strong>。</p>
<p>开发者 Sankalp Shubham 将其称为“<strong>低档位驾驶</strong>”（driving in lower gears）。他用手动挡汽车打比方：对于简单、样板化的任务，你可以挂高档，让 AI 快速推进（高自动化，低控制）；但对于复杂、新颖的问题，你必须降档——你可能自己写伪代码，或亲手实现核心算法，只让 AI 生成测试用例。</p>
<p><strong>你始终是驾驶员。AI 是引擎，不是司机</strong>。</p>
<h2 data-id="heading-5">未来属于规格驱动</h2>
<p>颇具讽刺意味的是，许多开发者当初选择编程，正是因为想避开管理职责。他们喜欢代码，因为它是确定性的——计算机（大部分时候）会照你说的做。而人类（以及实习生）则混乱、模糊，需要指导。</p>
<p>如今，开发者最核心的工具本身变得混乱而模糊。</p>
<p>这也是为什么我说，“一个好的开发可能用不好 AI” 的原因。</p>
<p>要在这种新环境中成功，开发者必须培养那些看似“软”实则极难的技能：<strong>清晰表达愿景的能力，将复杂问题拆解为 AI 可处理的、上下文隔离的模块化任务的能力</strong>。</p>
<p>在这个时代脱颖而出的开发者，未必是打字最快或背诵标准库最多的人，而是那些能把业务需求转化为技术约束、清晰到连一只“随机鹦鹉”都无法搞砸的人。</p>
<p>AI 时代，说明白你的需求比写明白你的需求更重要！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给 AI 对话装个"行车记录仪"：opencode-autosave-conversation 开发手记]]></title>    <link>https://juejin.cn/post/7600600904095531042</link>    <guid>https://juejin.cn/post/7600600904095531042</guid>    <pubDate>2026-01-29T15:58:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600600904095531042" data-draft-id="7600588379106345012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给 AI 对话装个&quot;行车记录仪&quot;：opencode-autosave-conversation 开发手记"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T15:58:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大橙子打游戏"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170907086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给 AI 对话装个"行车记录仪"：opencode-autosave-conversation 开发手记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170907086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大橙子打游戏
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:58:36.000Z" title="Thu Jan 29 2026 15:58:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>凌晨三点，你跟 AI 聊得热火朝天，它刚帮你写完一段绝世好代码。结果手一抖，终端崩了。对话记录？没了。代码？飞了。你？裂开了。</p>
</blockquote>
<p>如果你有过这种经历，那这篇文章就是为你写的。</p>
<h2 data-id="heading-0">痛点：AI 对话的"阅后即焚"困境</h2>
<p>用 OpenCode 这类 AI 编程助手久了，你会发现一个尴尬的问题：<strong>对话记录像金鱼的记忆一样短暂</strong>。</p>
<p>当然，OpenCode 本身是有会话管理的，但问题在于：</p>
<ol>
<li><strong>不够持久</strong> —— 会话多了，旧的就被清理了</li>
<li><strong>不够直观</strong> —— 想回顾某次对话？祝你在一堆 session ID 里大海捞针</li>
<li><strong>不够便携</strong> —— 想把对话分享给同事或存档到知识库？没门</li>
</ol>
<p>于是我决定造一个轮子：<strong>opencode-autosave-conversation</strong>。</p>
<h2 data-id="heading-1">设计理念：润物细无声</h2>
<p>在动手之前，我给自己定了几条原则：</p>
<h3 data-id="heading-2">1. 零配置启动</h3>
<p>安装完就能用，不需要用户填一堆配置项。毕竟，谁愿意为了"自动保存"这么简单的功能去研究配置文档呢？</p>
<h3 data-id="heading-3">2. 静默执行</h3>
<p>插件在后台默默干活，不弹窗、不刷日志、不打扰用户。就像一个专业的速记员——你说话我记录，全程零存在感。</p>
<h3 data-id="heading-4">3. 输出要"人类可读"</h3>
<p>保存的不是什么 JSON 数据库，而是<strong>格式优美的 Markdown 文件</strong>。直接用任何编辑器打开就能阅读，还能无缝接入你的笔记系统（Obsidian、Notion、语雀，随便你）。</p>
<h2 data-id="heading-5">核心功能一览</h2>
<h3 data-id="heading-6">自动文件创建与命名</h3>
<p>当你开始一段新对话，插件会自动在项目目录下创建 <code>conversations</code> 文件夹，然后按照这个格式命名文件：</p>
<pre><code class="hljs">YYYYMMDD-HH-MM-SS-话题.md
</code></pre>
<p>比如你问 AI "怎么修复这个该死的 bug"，就会生成：</p>
<pre><code class="hljs">20260129-02-30-45-怎么修复这个该死的bug.md
</code></pre>
<p>话题从你的第一条消息中自动提取，最多 30 个字符。简直就是电子版的"案发现场记录"。</p>
<h3 data-id="heading-7">智能防抖保存</h3>
<p>采用 <strong>2 秒空闲检测机制</strong>：当你停止输入 2 秒后，插件就偷偷保存一次。</p>
<p>为什么是 2 秒？太短了会频繁写盘（SSD 表示不服），太长了又怕丢数据。2 秒是个甜蜜点。</p>
<h3 data-id="heading-8">图片独立存储</h3>
<p>如果你在对话中发送了截图，插件<strong>不会</strong>把 base64 编码那一坨"乱码艺术"塞进 Markdown 里。</p>
<p>而是把图片单独存到 <code>conversations/images/</code> 目录，Markdown 里只留一个优雅的引用：</p>
<pre><code class="hljs language-markdown" lang="markdown">![<span class="hljs-string">screenshot</span>](<span class="hljs-link">images/20260129-02-30-45-修复bug-0.png</span>)
</code></pre>
<p>强迫症狂喜。Git diff 也不会被一万行 base64 搞崩。</p>
<h3 data-id="heading-9">完整的工具调用记录</h3>
<p>AI 助手用了什么工具、读了哪个文件、输入是什么、输出是什么——<strong>全部记录在案</strong>。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">#### Tool: Read</span>
<span class="hljs-strong">**Status:**</span> completed

<span class="hljs-strong">**Input:**</span>
​<span class="hljs-code">```json
{
  "filePath": "src/auth.ts"
}
​```</span>

<span class="hljs-strong">**Output:**</span>
​<span class="hljs-code">```typescript
export function validateToken(token: string) {
  // ...
}
​```</span>
</code></pre>
<p>这意味着你可以回溯 AI 的"思考过程"，就像看侦探片一样："原来它是这样一步步找到答案的！"</p>
<h3 data-id="heading-10">子会话内联</h3>
<p>如果你的 AI 助手调用了子代理（subagent），这些子会话的内容也会被记录在主文件的 <strong>Child Sessions</strong> 章节里。一个文件看全貌，不用满世界找碎片。</p>
<h2 data-id="heading-11">技术实现</h2>
<p>代码架构很简单，四个核心模块：</p>
<pre><code class="hljs language-bash" lang="bash">src/
├── index.ts          <span class="hljs-comment"># 插件入口，注册事件钩子</span>
├── session-tracker.ts <span class="hljs-comment"># 会话追踪器，管理会话生命周期</span>
├── file-manager.ts    <span class="hljs-comment"># 文件管理器，负责读写文件</span>
└── formatter.ts       <span class="hljs-comment"># 格式化器，把对话数据转成 Markdown</span>
</code></pre>
<h3 data-id="heading-12">事件驱动架构</h3>
<p>插件利用 OpenCode 的插件系统，监听三个关键事件：</p>

























<table><thead><tr><th>事件</th><th>触发时机</th><th>处理逻辑</th></tr></thead><tbody><tr><td><code>session.create</code></td><td>新会话创建</td><td>初始化文件路径，准备写入</td></tr><tr><td><code>message.update</code></td><td>消息更新</td><td>防抖 2 秒后保存到文件</td></tr><tr><td><code>session.delete</code></td><td>会话结束</td><td>最终保存，清理追踪器</td></tr></tbody></table>
<h3 data-id="heading-13">防抖实现</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 简化版防抖逻辑</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEBOUNCE_MS</span> = <span class="hljs-number">2000</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">saveTimer</span>: <span class="hljs-title class_">NodeJS</span>.<span class="hljs-property">Timeout</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">scheduleSave</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (saveTimer) <span class="hljs-built_in">clearTimeout</span>(saveTimer);
  saveTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">saveSession</span>(sessionId);
  }, <span class="hljs-variable constant_">DEBOUNCE_MS</span>);
}
</code></pre>
<h3 data-id="heading-14">Markdown 格式化</h3>
<p>格式化器负责把 OpenCode 的消息对象转成人类可读的 Markdown。核心挑战是处理各种消息类型：</p>
<ul>
<li>纯文本消息 → 直接输出</li>
<li>图片消息 → 提取 base64，保存为文件，返回引用链接</li>
<li>工具调用 → 格式化为代码块，保留输入输出</li>
</ul>
<h2 data-id="heading-15">安装与使用</h2>
<p><strong>安装：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g opencode-autosave-conversation
</code></pre>
<p><strong>配置：</strong></p>
<p>在 <code>opencode.json</code>（项目级或 <code>~/.config/opencode/opencode.json</code>）中添加：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"opencode-autosave-conversation"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>没了。就这两步。比泡面还快。</p>
<h2 data-id="heading-16">使用场景</h2>
<h3 data-id="heading-17">场景一：知识沉淀</h3>
<p>三个月后，你遇到一个似曾相识的问题。与其重新问一遍 AI，不如直接搜索你的对话记录库：</p>
<pre><code class="hljs language-bash" lang="bash">grep -r <span class="hljs-string">"JWT 认证"</span> ./conversations/
</code></pre>
<p>省 token，省时间，省脑子。</p>
<h3 data-id="heading-18">场景二：学习复盘</h3>
<p>想学习 AI 是怎么解决某类问题的？翻开历史记录，研究它的"思路"，比看教程生动多了。这是真正的 <strong>Learning by Observing AI</strong>。</p>
<h3 data-id="heading-19">场景三：团队协作</h3>
<p>把 <code>conversations/</code> 目录提交到 Git 仓库，同事就能看到你是怎么跟 AI 协作完成某个功能的。比写需求文档香多了。</p>
<h3 data-id="heading-20">场景四：甩锅现场</h3>
<p>产品经理："这功能不是我要的啊！"</p>
<p>你："来，让我们看看 1 月 15 日的对话记录，第 47 行，你原话是……"</p>
<p>产品经理："……我先去接个电话。"</p>
<h2 data-id="heading-21">目录结构</h2>
<p>最终生成的文件结构长这样：</p>
<pre><code class="hljs language-css" lang="css">your-project/
├── conversations/
│   ├── images/
│   │   ├── <span class="hljs-number">20260129</span>-<span class="hljs-number">10</span>-<span class="hljs-number">30</span>-<span class="hljs-number">45</span>-实现认证-<span class="hljs-number">0</span><span class="hljs-selector-class">.png</span>
│   │   └── <span class="hljs-number">20260129</span>-<span class="hljs-number">10</span>-<span class="hljs-number">30</span>-<span class="hljs-number">45</span>-实现认证-<span class="hljs-number">1</span><span class="hljs-selector-class">.jpg</span>
│   ├── <span class="hljs-number">20260129</span>-<span class="hljs-number">10</span>-<span class="hljs-number">30</span>-<span class="hljs-number">45</span>-实现用户认证<span class="hljs-selector-class">.md</span>
│   └── <span class="hljs-number">20260129</span>-<span class="hljs-number">14</span>-<span class="hljs-number">22</span>-<span class="hljs-number">30</span>-修复解析器bug<span class="hljs-selector-class">.md</span>
├── <span class="hljs-attribute">src</span>/
└── ...
</code></pre>
<h2 data-id="heading-22">写在最后</h2>
<p>这个项目的初衷很简单：<strong>让 AI 对话不再是一次性消耗品</strong>。</p>
<p>每一次与 AI 的深度交流，都是一次思维碰撞。这些碰撞的火花值得被记录下来，而不是随着会话关闭而消散。</p>
<p>项目已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flearningpro%2Fopencode-autosave-conversation" target="_blank" title="https://github.com/learningpro/opencode-autosave-conversation" ref="nofollow noopener noreferrer">github.com/learningpro…</a></p>
<p>如果你也有"对话丢失 PTSD"，不妨试试。</p>
<p>顺便，如果好用的话，给个 Star ⭐ 呗。毕竟，一个愿意帮你"记笔记"的工具，值得你的认可。</p>
<hr/>
<p><em>作者：Orange</em>
<em>首发于：2026 年 1 月</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchain学习笔记（二）：工具的调用]]></title>    <link>https://juejin.cn/post/7600642904382636038</link>    <guid>https://juejin.cn/post/7600642904382636038</guid>    <pubDate>2026-01-29T17:10:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600642904382636038" data-draft-id="7600637595944976426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchain学习笔记（二）：工具的调用"/> <meta itemprop="keywords" content="后端,LangChain,LLM"/> <meta itemprop="datePublished" content="2026-01-29T17:10:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_Shawn"/> <meta itemprop="url" content="https://juejin.cn/user/1855631358965384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchain学习笔记（二）：工具的调用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631358965384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_Shawn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T17:10:54.000Z" title="Thu Jan 29 2026 17:10:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Tool Calling</h3>
<h4 data-id="heading-1">定义简单tool</h4>
<p>创建工具最简单的方法是使用 <code>@tool</code> 装饰器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool(<span class="hljs-params">description=<span class="hljs-string">"Returns the current time in yyyy-MM-dd HH:mm:ss format."</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_time</span>(<span class="hljs-params">*args, **kwargs</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    获取当前系统时间。
    格式为：yyyy-MM-dd HH:mm:ss
    """</span>
    now = datetime.datetime.now()
    <span class="hljs-keyword">return</span> now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
</code></pre>
<p>如果description不写，则默认注释里的就是描述信息，否则则使用description，描述信息需要易于大模型的理解。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
获取当前系统时间。
格式为：yyyy-MM-dd HH:mm:ss
"""</span>
</code></pre>
<h4 data-id="heading-2">llm绑定tool</h4>
<p>借助 <code>bind_tools</code>，实现llm与工具的绑定，在底层，这些都会被转换为 OpenAI 工具模式，其格式如下：</p>
<pre><code class="hljs language-python" lang="python">{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-string">"parameters"</span>: {...}  <span class="hljs-comment"># JSONSchema</span>
}
</code></pre>
<p>代码示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 方式1：自动工具调用（推荐） ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_simple_tool_calling</span>():
    <span class="hljs-string">"""
    方式1：使用 bind_tools + 手动执行
    特点：需要手动处理工具调用和结果
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 方式1：bind_tools + 手动执行工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    llm_tools = llm.bind_tools(tools=[get_current_time])
    messages = [
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请获取当前时间"</span>}
    ]

    <span class="hljs-comment"># 第一步：LLM 返回工具调用请求</span>
    result = llm_tools.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n📤 LLM 响应类型: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(result)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📤 LLM 内容: <span class="hljs-subst">{result.content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📤 工具调用请求: <span class="hljs-subst">{result.tool_calls}</span>"</span>)

    <span class="hljs-comment"># 第二步：手动执行工具，判断大模型的reponse是不是tool_call，如果是tool_call类型，则真正执行工具的调用</span>
    <span class="hljs-keyword">if</span> result.tool_calls:
        <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> result.tool_calls:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔧 执行工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🔧 工具参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

            <span class="hljs-keyword">if</span> tool_call[<span class="hljs-string">'name'</span>] == <span class="hljs-string">'get_current_time'</span>:
                <span class="hljs-comment"># 手动调用工具</span>
                tool_result = get_current_time.invoke(tool_call[<span class="hljs-string">'args'</span>])
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 工具执行结果: <span class="hljs-subst">{tool_result}</span>"</span>)

                <span class="hljs-comment"># 第三步：将工具结果返回给 LLM（可选）</span>
                messages.append(result)  <span class="hljs-comment"># 添加 AI 的工具调用消息</span>
                messages.append(ToolMessage(
                    content=tool_result,
                    tool_call_id=tool_call[<span class="hljs-string">'id'</span>]
                ))

                <span class="hljs-comment"># 让 LLM 根据工具结果生成最终回答</span>
                final_response = llm_tools.invoke(messages)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n💬 最终回答: <span class="hljs-subst">{final_response.content}</span>"</span>)
</code></pre>
<p>模拟工具调用流程，通过ToolMessage</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_simple_tool_calling_2</span>():
    <span class="hljs-string">"""
    方式2：手动构造 AIMessage 和 ToolMessage
    特点：完全手动控制消息流，适合测试和调试
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 方式2：手动构造消息流"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    <span class="hljs-comment"># 手动构造 AI 的工具调用消息</span>
    ai_message = AIMessage(
        content=<span class="hljs-string">""</span>,  <span class="hljs-comment"># 通常为空，因为 AI 选择调用工具而不是直接回答</span>
        tool_calls=[{
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"get_current_time"</span>,
            <span class="hljs-string">"args"</span>: {},
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span>
        }]
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n📤 模拟 AI 工具调用: <span class="hljs-subst">{ai_message.tool_calls}</span>"</span>)

    <span class="hljs-comment"># 执行工具并创建结果消息</span>
    tool_result = get_current_time.invoke({})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 工具执行结果: <span class="hljs-subst">{tool_result}</span>"</span>)

    tool_message = ToolMessage(
        content=tool_result,
        tool_call_id=<span class="hljs-string">"call_123"</span>
    )

    <span class="hljs-comment"># 构造完整的消息历史</span>
    messages = [
        HumanMessage(<span class="hljs-string">"请获取当前时间"</span>),
        ai_message,  <span class="hljs-comment"># AI 的工具调用</span>
        tool_message,  <span class="hljs-comment"># 工具执行结果</span>
    ]

    <span class="hljs-comment"># LLM 根据工具结果生成最终回答</span>
    response = llm.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n💬 最终回答: <span class="hljs-subst">{response.content}</span>"</span>)
</code></pre>
<h4 data-id="heading-3">多工具调用</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 额外示例：多个工具 ==========</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""计算数学表达式。"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算结果: <span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_multiple_tools</span>():
    <span class="hljs-string">"""演示多个工具的使用"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 多工具示例"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    llm_tools = llm.bind_tools(tools=[get_current_time, calculate])
    tool_map = {
        <span class="hljs-string">"get_current_time"</span>: get_current_time,
        <span class="hljs-string">"calculate"</span>: calculate
    }

    messages = [HumanMessage(content=<span class="hljs-string">"现在几点？然后帮我计算 15 * 8"</span>)]

    max_iterations = <span class="hljs-number">10</span>
    iteration = <span class="hljs-number">0</span>

    <span class="hljs-keyword">while</span> iteration &lt; max_iterations:
        iteration += <span class="hljs-number">1</span>
        response = llm_tools.invoke(messages)
        messages.append(response)

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> response.tool_calls:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 最终回答: <span class="hljs-subst">{response.content}</span>"</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> response.tool_calls:
            tool_name = tool_call[<span class="hljs-string">'name'</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔧 调用工具: <span class="hljs-subst">{tool_name}</span>"</span>)

            tool_result = tool_map[tool_name].invoke(tool_call[<span class="hljs-string">'args'</span>])
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 结果: <span class="hljs-subst">{tool_result}</span>"</span>)

            messages.append(ToolMessage(
                content=tool_result,
                tool_call_id=tool_call[<span class="hljs-string">'id'</span>]
            ))
</code></pre>
<h4 data-id="heading-4">结构化入参</h4>
<p>tool 装饰器里，有个 args_schema 参数，可以配置结构化的类</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 1. 基础结构化入参 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""搜索工具的输入参数"""</span>
    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"搜索关键词"</span>)
    max_results: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"最大返回结果数"</span>, ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">100</span>)
    language: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"zh"</span>, description=<span class="hljs-string">"语言代码，如 zh, en"</span>)


<span class="hljs-meta">@tool(<span class="hljs-params">args_schema=SearchInput</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, max_results: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>, language: <span class="hljs-built_in">str</span> = <span class="hljs-string">"zh"</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""在网络上搜索信息。"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"搜索 '<span class="hljs-subst">{query}</span>'，返回 <span class="hljs-subst">{max_results}</span> 条 <span class="hljs-subst">{language}</span> 结果"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_basic_structured_input</span>():
    <span class="hljs-string">"""演示基础结构化入参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例1：基础结构化入参"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    llm_tools = llm.bind_tools([search_web])
    messages = [HumanMessage(<span class="hljs-string">"搜索 LangChain 相关信息，返回5条结果"</span>)]

    response = llm_tools.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🤖 LLM 工具调用:"</span>)
    <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> response.tool_calls:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

        <span class="hljs-comment"># 执行工具</span>
        result = search_web.invoke(tool_call[<span class="hljs-string">'args'</span>])
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<p>嵌套复杂的结构化入参</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 2. 复杂结构化入参（嵌套对象） ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""地址信息"""</span>
    street: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"街道地址"</span>)
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市"</span>)
    country: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"中国"</span>, description=<span class="hljs-string">"国家"</span>)
    postal_code: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"邮政编码"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""用户信息"""</span>
    name: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"用户姓名"</span>)
    age: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">"年龄"</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">150</span>)
    email: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"邮箱地址"</span>)
    address: Address = Field(description=<span class="hljs-string">"地址信息"</span>)
    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Field(default=[], description=<span class="hljs-string">"用户标签"</span>)

<span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">'email'</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_email</span>(<span class="hljs-params">cls, v</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> v:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'邮箱格式不正确'</span>)
        <span class="hljs-keyword">return</span> v


<span class="hljs-meta">@tool(<span class="hljs-params">args_schema=UserInfo</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span>, email: <span class="hljs-built_in">str</span>, address: Address, tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""创建新用户。"""</span>
    tags = tags <span class="hljs-keyword">or</span> []
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"创建用户: <span class="hljs-subst">{name}</span>, <span class="hljs-subst">{age}</span>岁, <span class="hljs-subst">{email}</span>, 地址: <span class="hljs-subst">{address.city}</span>, 标签: <span class="hljs-subst">{tags}</span>"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_nested_structured_input</span>():
    <span class="hljs-string">"""演示嵌套结构化入参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例2：嵌套结构化入参"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    <span class="hljs-comment"># 手动测试</span>
    user_data = {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
        <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
        <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhangsan@example.com"</span>,
        <span class="hljs-string">"address"</span>: {
            <span class="hljs-string">"street"</span>: <span class="hljs-string">"中关村大街1号"</span>,
            <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>,
            <span class="hljs-string">"country"</span>: <span class="hljs-string">"中国"</span>,
            <span class="hljs-string">"postal_code"</span>: <span class="hljs-string">"100000"</span>
        },
        <span class="hljs-string">"tags"</span>: [<span class="hljs-string">"VIP"</span>, <span class="hljs-string">"技术"</span>]
    }

    tool_call = {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"create_user"</span>,
        <span class="hljs-string">"args"</span>: user_data,
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span>,  <span class="hljs-comment"># 必须提供 tool_call_id</span>
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>
    }

    result = create_user.invoke(tool_call)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 执行结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-5">结构化输出</h4>
<p><code>response_format</code> 是 <code>@tool</code> 装饰器的一个重要参数，用于控制工具返回值的格式和处理方式。</p>




















<table><thead><tr><th>值</th><th>描述</th><th>返回类型</th></tr></thead><tbody><tr><td><code>"content"</code></td><td><strong>默认值</strong>，工具返回值直接作为内容</td><td>执行返回一个<code>str</code></td></tr><tr><td><code>"content_and_artifact"</code></td><td>返回内容和原始数据（artifact）</td><td>工具必须返回一个元组 <code>(content, artifact)</code>：-   <strong>content</strong>: 给 LLM 看的简洁文本描述-   <strong>artifact</strong>: 完整的原始数据（可以是任意类型）</td></tr></tbody></table>
<p>代码示例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 4. 结构化出参 (content_and_artifact) ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductInfo</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""产品信息"""</span>
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>
    stock: <span class="hljs-built_in">int</span>
    category: <span class="hljs-built_in">str</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchResult</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""搜索结果"""</span>
    total: <span class="hljs-built_in">int</span>
    products: <span class="hljs-type">List</span>[ProductInfo]
    page: <span class="hljs-built_in">int</span>
    page_size: <span class="hljs-built_in">int</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductSearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""产品搜索输入"""</span>
    keyword: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"搜索关键词"</span>)
    category: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"产品分类"</span>)
    min_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"最低价格"</span>)
    max_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"最高价格"</span>)
    page: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">1</span>, description=<span class="hljs-string">"页码"</span>, ge=<span class="hljs-number">1</span>)
    page_size: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"每页数量"</span>, ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">100</span>)


<span class="hljs-meta">@tool(<span class="hljs-params">
    args_schema=ProductSearchInput,
    response_format=<span class="hljs-string">"content_and_artifact"</span>
</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_products</span>(<span class="hljs-params">
        keyword: <span class="hljs-built_in">str</span>,
        category: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,
        min_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span>,
        max_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span>,
        page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,
        page_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>
</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, SearchResult]:
    <span class="hljs-string">"""搜索产品。"""</span>
    <span class="hljs-comment"># 模拟数据库查询</span>
    mock_products = [
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">"iPhone 15"</span>, price=<span class="hljs-number">6999</span>, stock=<span class="hljs-number">50</span>, category=<span class="hljs-string">"手机"</span>),
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>, name=<span class="hljs-string">"MacBook Pro"</span>, price=<span class="hljs-number">12999</span>, stock=<span class="hljs-number">30</span>, category=<span class="hljs-string">"电脑"</span>),
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>, name=<span class="hljs-string">"AirPods Pro"</span>, price=<span class="hljs-number">1999</span>, stock=<span class="hljs-number">100</span>, category=<span class="hljs-string">"耳机"</span>),
    ]

    <span class="hljs-comment"># 过滤产品</span>
    filtered = mock_products
    <span class="hljs-keyword">if</span> category:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.category == category]
    <span class="hljs-keyword">if</span> min_price:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.price &gt;= min_price]
    <span class="hljs-keyword">if</span> max_price:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.price &lt;= max_price]

    <span class="hljs-comment"># 构造结果</span>
    result = SearchResult(
        total=<span class="hljs-built_in">len</span>(filtered),
        products=filtered,
        page=page,
        page_size=page_size
    )

    <span class="hljs-comment"># content: 给 LLM 的简洁描述</span>
    content = <span class="hljs-string">f"找到 <span class="hljs-subst">{result.total}</span> 个产品"</span>
    <span class="hljs-keyword">if</span> category:
        content += <span class="hljs-string">f"，分类: <span class="hljs-subst">{category}</span>"</span>

    <span class="hljs-comment"># artifact: 完整的结构化数据</span>
    <span class="hljs-keyword">return</span> content, result


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_structured_output</span>():
    <span class="hljs-string">"""演示结构化出参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例4：结构化出参 (content_and_artifact)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    llm_with_tools = llm.bind_tools([search_products])

    messages = [HumanMessage(content=<span class="hljs-string">"搜索价格在5000以上的手机"</span>)]

    <span class="hljs-comment"># LLM 决策</span>
    response = llm_with_tools.invoke(messages)

    <span class="hljs-keyword">if</span> response.tool_calls:
        tool_call = response.tool_calls[<span class="hljs-number">0</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🤖 LLM 决定调用工具:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

        <span class="hljs-comment"># 执行工具</span>
        <span class="hljs-comment">## 这里返回的是ToolMessage</span>
        result = search_products.invoke(tool_call)

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 工具执行结果:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   Content: <span class="hljs-subst">{result.content}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   Artifact 类型: <span class="hljs-subst">{result.artifact}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   产品数量: <span class="hljs-subst">{result.artifact.total}</span>"</span>)
</code></pre>
<h4 data-id="heading-6">structure_tool</h4>
<p>StructuredTool 是 LangChain 里的一个类，专门用于处理多参数输入的工具。 与基础的 Tool 类（通常只接受一个字符串输入）不同，StructuredTool 利用 Pydantic 来定义和校验复杂的输入结构（Schema）。</p>
<p>相比 @tool 装饰器提供了更多的灵活性和控制能力。</p>


















































<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>func</code></td><td><code>Callable</code></td><td>同步执行函数</td></tr><tr><td><code>coroutine</code></td><td><code>Callable</code></td><td>异步执行函数</td></tr><tr><td><code>name</code></td><td><code>str</code></td><td>工具名称（LLM 看到的名称）</td></tr><tr><td><code>description</code></td><td><code>str</code></td><td>工具描述（LLM 用来决定是否调用）</td></tr><tr><td><code>args_schema</code></td><td><code>Type[BaseModel]</code></td><td>Pydantic 模型定义输入参数</td></tr><tr><td><code>return_direct</code></td><td><code>bool</code></td><td><code>True</code>时直接返回给用户，不经过 LLM</td></tr><tr><td><code>handle_tool_error</code></td><td><code>bool/str/Callable</code></td><td>错误处理方式</td></tr><tr><td><code>response_format</code></td><td><code>str</code></td><td><code>"content"</code>或 <code>"content_and_artifact"</code></td></tr></tbody></table>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 5. 使用 StructuredTool 创建工具 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""计算器输入"""</span>
    expression: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"数学表达式，如 '2 + 3 * 4'"</span>)
    precision: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">2</span>, description=<span class="hljs-string">"小数精度"</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">10</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorOutput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""计算器输出"""</span>
    expression: <span class="hljs-built_in">str</span>
    result: <span class="hljs-built_in">float</span>
    formatted_result: <span class="hljs-built_in">str</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_func</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span>, precision: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
    <span class="hljs-string">"""计算数学表达式"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression)
        formatted = <span class="hljs-string">f"<span class="hljs-subst">{result:.{precision}</span>f}"</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"expression"</span>: expression,
            <span class="hljs-string">"result"</span>: result,
            <span class="hljs-string">"formatted_result"</span>: formatted
        }
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"expression"</span>: expression,
            <span class="hljs-string">"result"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"formatted_result"</span>: <span class="hljs-string">f"错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
        }


calculator_tool = StructuredTool.from_function(
    func=calculate_func,
    name=<span class="hljs-string">"calculator"</span>,
    description=<span class="hljs-string">"计算数学表达式"</span>,
    args_schema=CalculatorInput,
    return_direct=<span class="hljs-literal">False</span>
)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_structured_tool</span>():
    <span class="hljs-string">"""演示 StructuredTool"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例5：StructuredTool 创建工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    test_cases = [
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"15 + 25 * 3"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">2</span>},
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"100 / 3"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">4</span>},
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"2 ** 10"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">0</span>}
    ]

    <span class="hljs-keyword">for</span> params <span class="hljs-keyword">in</span> test_cases:
        result = calculator_tool.invoke(params)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n表达式: <span class="hljs-subst">{params[<span class="hljs-string">'expression'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-7">base_tool</h4>
<p>BaseTool 是 LangChain 中所有工具的基类。通过继承它可以创建完全自定义的工具，拥有最大的灵活性和控制能力。</p>





























<table><thead><tr><th>方式</th><th>灵活性</th><th>复杂度</th><th>适用场景</th></tr></thead><tbody><tr><td><code>@tool</code></td><td>低</td><td>简单</td><td>快速定义简单工具</td></tr><tr><td><code>StructuredTool</code></td><td>中</td><td>中等</td><td>动态创建、自定义配置</td></tr><tr><td><code>BaseTool</code></td><td>高</td><td>复杂</td><td>完全自定义、复杂逻辑</td></tr></tbody></table>
<p>核心参数与方法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> BaseTool
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Type</span>, <span class="hljs-type">Any</span>, <span class="hljs-type">Optional</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyToolInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""工具输入参数 Schema"""</span>
    param1: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"参数1描述"</span>)
    param2: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"参数2描述"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTool</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    <span class="hljs-string">"""自定义工具"""</span>
    
    <span class="hljs-comment"># ========== 必须定义的属性 ==========</span>
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"my_tool"</span>                    <span class="hljs-comment"># 工具名称</span>
    description: <span class="hljs-built_in">str</span> = <span class="hljs-string">"这是一个自定义工具"</span>    <span class="hljs-comment"># 工具描述</span>
    args_schema: <span class="hljs-type">Type</span>[BaseModel] = MyToolInput  <span class="hljs-comment"># 输入参数 Schema</span>
    
    <span class="hljs-comment"># ========== 可选属性 ==========</span>
    return_direct: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>              <span class="hljs-comment"># 是否直接返回结果</span>
    response_format: <span class="hljs-built_in">str</span> = <span class="hljs-string">"content"</span>         <span class="hljs-comment"># 响应格式</span>
    
    <span class="hljs-comment"># ========== 自定义属性 ==========</span>
    custom_config: <span class="hljs-built_in">str</span> = <span class="hljs-string">"default"</span>           <span class="hljs-comment"># 可以添加任意自定义属性</span>
    
    <span class="hljs-comment"># ========== 必须实现的方法 ==========</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params">self, param1: <span class="hljs-built_in">str</span>, param2: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""同步执行方法（必须实现）"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"执行结果: <span class="hljs-subst">{param1}</span>, <span class="hljs-subst">{param2}</span>"</span>
    
    <span class="hljs-comment"># ========== 可选实现的方法 ==========</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params">self, param1: <span class="hljs-built_in">str</span>, param2: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""异步执行方法（可选）"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"异步执行结果: <span class="hljs-subst">{param1}</span>, <span class="hljs-subst">{param2}</span>"</span>
</code></pre>
<p>代码示例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 6. 继承 BaseTool 实现完全自定义 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""天气查询输入"""</span>
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市名称"</span>)
    date: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"日期 (YYYY-MM-DD)，默认今天"</span>)
    unit: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"celsius"</span>, description=<span class="hljs-string">"温度单位: celsius 或 fahrenheit"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherOutput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""天气查询输出"""</span>
    city: <span class="hljs-built_in">str</span>
    date: <span class="hljs-built_in">str</span>
    temperature: <span class="hljs-built_in">float</span>
    condition: <span class="hljs-built_in">str</span>
    humidity: <span class="hljs-built_in">int</span>
    wind_speed: <span class="hljs-built_in">float</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherTool</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"get_weather"</span>
    description: <span class="hljs-built_in">str</span> = <span class="hljs-string">"获取指定城市的天气信息"</span>
    args_schema: <span class="hljs-built_in">type</span>[BaseModel] = WeatherInput
    response_format: <span class="hljs-built_in">str</span> = <span class="hljs-string">"content_and_artifact"</span>

    <span class="hljs-comment"># 自定义属性</span>
    api_key: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params">
            self,
            city: <span class="hljs-built_in">str</span>,
            date: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,
            unit: <span class="hljs-built_in">str</span> = <span class="hljs-string">"celsius"</span>
    </span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, WeatherOutput]:
        <span class="hljs-string">"""同步执行"""</span>
        <span class="hljs-comment"># 模拟 API 调用</span>
        date = date <span class="hljs-keyword">or</span> datetime.datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d"</span>)

        weather_data = {
            <span class="hljs-string">"北京"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">25</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"晴天"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">45</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">3.5</span>},
            <span class="hljs-string">"上海"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">28</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"多云"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">60</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">4.2</span>},
            <span class="hljs-string">"广州"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">32</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"小雨"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">75</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">2.8</span>},
        }

        data = weather_data.get(city, {<span class="hljs-string">"temp"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"未知"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">50</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">3.0</span>})
        temp = data[<span class="hljs-string">"temp"</span>]

        <span class="hljs-keyword">if</span> unit == <span class="hljs-string">"fahrenheit"</span>:
            temp = temp * <span class="hljs-number">9</span> / <span class="hljs-number">5</span> + <span class="hljs-number">32</span>

        output = WeatherOutput(
            city=city,
            date=date,
            temperature=temp,
            condition=data[<span class="hljs-string">"condition"</span>],
            humidity=data[<span class="hljs-string">"humidity"</span>],
            wind_speed=data[<span class="hljs-string">"wind"</span>]
        )

        content = <span class="hljs-string">f"<span class="hljs-subst">{city}</span> <span class="hljs-subst">{date}</span>: <span class="hljs-subst">{output.condition}</span>, <span class="hljs-subst">{temp}</span>°<span class="hljs-subst">{<span class="hljs-string">'F'</span> <span class="hljs-keyword">if</span> unit == <span class="hljs-string">'fahrenheit'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'C'</span>}</span>"</span>

        <span class="hljs-keyword">return</span> content, output

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params">self, *args, **kwargs</span>):
        <span class="hljs-string">"""异步执行"""</span>
        <span class="hljs-keyword">return</span> self._run(*args, **kwargs)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_base_tool</span>():
    <span class="hljs-string">"""演示继承 BaseTool"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例6：继承 BaseTool 实现自定义工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    weather_tool = WeatherTool(api_key=<span class="hljs-string">"your-api-key"</span>)

    test_cases = [
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>},
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"上海"</span>, <span class="hljs-string">"unit"</span>: <span class="hljs-string">"fahrenheit"</span>},
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"广州"</span>, <span class="hljs-string">"date"</span>: <span class="hljs-string">"2024-01-15"</span>}
    ]

    <span class="hljs-keyword">for</span> params <span class="hljs-keyword">in</span> test_cases:
        tool_call = {
            <span class="hljs-string">"name"</span>: weather_tool.name,
            <span class="hljs-string">"args"</span>: params,
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span> + params[<span class="hljs-string">"city"</span>],
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>
        }
        result = weather_tool.invoke(tool_call)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n查询: <span class="hljs-subst">{params}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Content: <span class="hljs-subst">{result.content}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Artifact: <span class="hljs-subst">{result.artifact.model_dump()}</span>"</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring注解秘籍：优雅地使用 @RequestHeader]]></title>    <link>https://juejin.cn/post/7600597995769004041</link>    <guid>https://juejin.cn/post/7600597995769004041</guid>    <pubDate>2026-01-29T16:51:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995769004041" data-draft-id="7600622206269079562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring注解秘籍：优雅地使用 @RequestHeader"/> <meta itemprop="keywords" content="Spring"/> <meta itemprop="datePublished" content="2026-01-29T16:51:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="独泪了无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2981531265546328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring注解秘籍：优雅地使用 @RequestHeader
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2981531265546328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    独泪了无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T16:51:20.000Z" title="Thu Jan 29 2026 16:51:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa3cf0396d1e41b5b456e8f588b4ec0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770310280&amp;x-signature=ZD74ap9%2FHChEl%2FOU89z%2F6izv6s0%3D" alt="image" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>  在 Spring Boot 开发中，HTTP 请求头（Header）是客户端和服务器之间传递元数据的重要方式。通过请求头，客户端可以传递认证信息、内容类型、语言偏好等数据。Spring Boot 提供了 @RequestHeader 注解，用于方便地从 HTTP 请求头中提取数据。本文将详细介绍 @RequestHeader 注解的使用方法，包括基本用法、默认值处理、多值头处理以及实际应用场景。</p>
<h2 data-id="heading-1">一、注解定义与核心属性</h2>
<h3 data-id="heading-2">1.1  @RequestHeader 是什么</h3>
<p>  在构建现代 Web 应用或 RESTful API 时，我们经常需要从 HTTP 请求中提取元数据信息。其中，请求头（Request Headers） 是传递客户端身份、认证令牌、内容类型、语言偏好等关键信息的重要载体。@RequestHeader 是 Spring Framework 提供的一个<strong>方法参数注解</strong>，用于将 HTTP 请求头中的特定字段值<strong>自动绑定到控制器方法的参数上</strong>。它属于 Spring MVC 的<strong>数据绑定机制</strong>的一部分，与 @RequestParam、@PathVariable、@RequestBody 等注解共同构成 Spring 对 HTTP 请求的结构化解析能力。</p>
<blockquote>
<p>⚠️注意：@RequestHeader <strong>仅在 Spring MVC 的控制器方法（@Controller、@RestController）中有效</strong>，在 Service、Util 或普通 Bean 方法中使用将被忽略。</p>
</blockquote>
<h3 data-id="heading-3">1.2 源码定义</h3>
<p>  @RequestHeader 注解的实现基于Spring MVC的参数绑定机制，它通过 @Target 和 @Retention 注解指定其作用于方法参数级别，并在运行时通过 Spring 的内部机制将请求头的值注入到相应的参数上。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ElementType.PARAMETER})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RequestHeader {
    <span class="hljs-meta">@AliasFor("name")</span>
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;

    <span class="hljs-meta">@AliasFor("value")</span>
    String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;

    <span class="hljs-type">boolean</span> <span class="hljs-title function_">required</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;

    String <span class="hljs-title function_">defaultValue</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ValueConstants.DEFAULT_NONE;
}
</code></pre>



































<table><thead><tr><th align="left">属性</th><th align="left">类型</th><th align="left">默认值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">value</td><td align="left">String</td><td align="left"/><td align="left">指定要绑定的请求头的名称</td></tr><tr><td align="left">name</td><td align="left">String</td><td align="left"/><td align="left"/></tr><tr><td align="left">required</td><td align="left">boolean</td><td align="left">true</td><td align="left">是否必须提供该请求头，如果为 true 且请求头不存在，则会抛出 400 异常。<br/>如果设置为false时，当请求中没有此参数，将会默认为 null。<br/>而对于基本数据类型的变量，则必须有值，这时会抛出空指针异常。<br/>如果允许空值，则接口中变量需要使用包装类来声明。</td></tr><tr><td align="left">defaultValue</td><td align="left">String</td><td align="left"><code>ValueConstants.DEFAULT_NONE</code></td><td align="left">当请求头不存在时的默认值，仅在 required = false 时生效</td></tr></tbody></table>
<p>  需要注意的是，value() 和 name() 是别名关系，二者等价，通常使用 value。如果方法参数的名称与请求头名称相同，那么可以省略 value 元素。然而，需要注意的是，某些请求头名称（如User-Agent）并不是有效的Java变量名，因此在这种情况下，我们不能省略value元素。</p>
<h2 data-id="heading-4">二、工作原理与请求处理流程</h2>
<h3 data-id="heading-5">2.1 请求头处理流程</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/859f5e4def5b4c0f8990c01543c8bd0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770310280&amp;x-signature=FQ%2BCALH2oizRVK8PpD%2FFlnFeZJ8%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-6">2.2 核心处理阶段</h3>
<ol>
<li>
<p><strong>参数解析器选择</strong>：RequestHeaderMethodArgumentResolver 处理带有 @RequestHeader 的参数</p>
</li>
<li>
<p><strong>请求头获取</strong>：从 HttpServletRequest 获取指定请求头值</p>
</li>
<li>
<p><strong>类型转换</strong>：使用 ConversionService 转换为目标类型</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultFormattingConversionService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConversionService</span> {
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">convert</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object source, Class&lt;T&gt; targetType)</span> {
        <span class="hljs-comment">// 查找合适的转换器</span>
        <span class="hljs-type">GenericConverter</span> <span class="hljs-variable">converter</span> <span class="hljs-operator">=</span> getConverter(sourceType, targetType);
        <span class="hljs-keyword">return</span> (T) converter.convert(source, sourceType, targetType);
    }
}
</code></pre>
</li>
<li>
<p><strong>默认值处理</strong>：当请求头缺失且存在默认值时应用</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter, 
                                ModelAndViewContainer mavContainer,
                                NativeWebRequest webRequest, 
                                WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {
    
    <span class="hljs-type">Object</span> <span class="hljs-variable">arg</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.resolveArgument(parameter, mavContainer, webRequest, binderFactory);
    
    <span class="hljs-comment">// 处理默认值</span>
    <span class="hljs-keyword">if</span> (arg == <span class="hljs-literal">null</span> &amp;&amp; !ValueConstants.DEFAULT_NONE.equals(namedValueInfo.defaultValue())) {
        arg = resolveDefaultValue(namedValueInfo.defaultValue());
    }
    <span class="hljs-keyword">return</span> arg;
}
</code></pre>
</li>
<li>
<p><strong>必填校验</strong>：检查必需请求头是否存在</p>
</li>
</ol>
<h2 data-id="heading-7">三、使用场景与最佳实践</h2>
<h3 data-id="heading-8">3.1 基本用法</h3>
<p>  如果只需要获取某个特定的请求头，可以使用 @RequestHeader 注解并指定 Header 名称。假设我们需要根据用户的 Accept-Language 请求头来返回不同语言的响应，使用 @RequestHeader 可以轻松实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/locale")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProfile</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("Accept-Language")</span> String language)</span> {
  <span class="hljs-comment">// 根据locale返回不同语言的响应</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">"response in "</span> + language;
}
</code></pre>
<blockquote>
<p>⚠️注意：如果请求中没有 accept-language 这个 Header，默认会返回 400 错误。</p>
</blockquote>
<p>  如上这段代码用于根据客户端的 Accept-Language 请求头返回相应语言的响应，其功能是根据客户端的 HTTP 请求头 Accept-Language 来返回不同语言的响应。使用这种方式代码简洁、语义清晰，无需注入 HttpServletRequest，自动完成字符串转换（支持基本类型、枚举等）。在某些情况下，可能会过度依赖Spring框架的注解，导致代码难以移植。</p>
<h3 data-id="heading-9">3.2 可选参数与默认值</h3>
<p>  默认情况下，Header 是必须的。如果请求中没有该 Header，将抛出异常并返回 400。如果希望在请求头缺失时不出现异常，可以将 required 设置为 false，此时需要手动判断。或者设置 Header 默认值，required 会自动设置为 false，这样即使请求中没有该 Header，也会使用默认值，避免 null 判断。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/submit")</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; submit(
    <span class="hljs-meta">@RequestHeader(value = "X-Request-Id", required = false)</span> String requestId,
    <span class="hljs-meta">@RequestHeader(value = "User-Agent", defaultValue = "unknown")</span> String userAgent) {
  <span class="hljs-keyword">if</span>(traceId == <span class="hljs-literal">null</span>){
    <span class="hljs-comment">// 自动生成</span>
    traceId = generateTraceId(); 
  }
    <span class="hljs-keyword">return</span> AppInfo(traceId, userAgent);
}
</code></pre>
<p>  defaultValue 仅在 <code>required = false</code> 且请求头缺失时生效，若同时设置 <code>required = true</code> 和 defaultValue，defaultValue <strong>不会被使用</strong>（因为 Spring 认为该头必须存在）。</p>
<h3 data-id="heading-10">3.3 获取所有 Headers</h3>
<p>  @RequestHeader 可以获取单个请求头的值，也可以获取所有请求头，并将其作为 MultiValueMap 或 Map 类型传递给方法参数。如果不确定请求中会包含哪些 Headers，或者不希望方法参数列表太长，可以使用 @RequestHeader 不指定名称，直接获取所有 Headers，可以选择使用以下几种类型接收：</p>
<ul>
<li>
<p>使用 Map 接收所有请求头，只获取每个 Header 的第一个值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/analytics")</span>
<span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">analyzeHeaders</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader</span> Map&lt;String, String&gt; headers)</span> {
  <span class="hljs-comment">// headers 包含所有请求头（key 不区分大小写，统一转为小写。注意：实际保留原始大小写）</span>
  <span class="hljs-keyword">return</span> headers;
}
</code></pre>
</li>
<li>
<p>使用 MultiValueMap 接收请求头，可以获取多个值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("/listHeaders")</span>
<span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">listHeaders</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader</span> MultiValueMap&lt;String, String&gt; headers)</span> {
  Map&lt;String, Object&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
  headers.forEach((key, value) -&gt; {
       <span class="hljs-comment">// 日志中输出所有请求头</span>
      System.out.println(String.format(<span class="hljs-string">"Header '%s' = %s"</span>, key, value));
  });
  result.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">0</span>);
  result.put(<span class="hljs-string">"msg"</span>, <span class="hljs-string">"success"</span>);
  result.put(<span class="hljs-string">"headers"</span>, headers);
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
</li>
<li>
<p>使用 HttpHeaders 接收请求头，这是Spring提供的一个专门用于处理请求头的类，它实现了 MultiValueMap&lt;String, String&gt; 接口，主要用于获取标准 Header。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RequestMapping("/getAllHttpHeaders")</span>
<span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getAllHttpHeaders</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader</span> HttpHeaders headers)</span> {
  headers.forEach((key, value) -&gt; {
       <span class="hljs-comment">// 日志中输出所有请求头</span>
      System.out.println(String.format(<span class="hljs-string">"getAllHttpHeaders '%s' = %s"</span>, key, value));
  });
  Map&lt;String, Object&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
  result.put(<span class="hljs-string">"code"</span>, <span class="hljs-number">0</span>);
  result.put(<span class="hljs-string">"msg"</span>, <span class="hljs-string">"success"</span>);
  result.put(<span class="hljs-string">"headers"</span>, headers);
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
</li>
</ul>
<blockquote>
<p>⚠️ 注意：如果指定的 Header 不存在，从 Map、MultiValueMap 或 HttpHeaders 获取时会返回 null。</p>
</blockquote>
<h3 data-id="heading-11">3.4 处理多值请求头</h3>
<p>  某些请求头可能包含多个值（如 Accept 头），可以使用 List&lt;String&gt; 或 MultiValueMap&lt;String, String&gt; 来提取。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@GetMapping("/accept-header")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAcceptHeader</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("Accept")</span> List&lt;String&gt; acceptHeaders)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Accept Headers: "</span> + acceptHeaders.toString();
}
</code></pre>
<h2 data-id="heading-12">四、最佳实践总结</h2>
<h3 data-id="heading-13">4.1 请求头使用规范</h3>


















































<table><thead><tr><th align="left">请求头</th><th align="left">典型用途</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Authorization</td><td align="left">身份认证</td><td align="left">Bearer令牌</td></tr><tr><td align="left">Accept</td><td align="left">内容协商</td><td align="left">application/json</td></tr><tr><td align="left">Content-Type</td><td align="left">请求体类型</td><td align="left">application/json</td></tr><tr><td align="left">User-Agent</td><td align="left">客户端识别</td><td align="left">浏览器信息</td></tr><tr><td align="left">X-Request-ID</td><td align="left">请求追踪</td><td align="left">UUID</td></tr><tr><td align="left">If-Modified-Since</td><td align="left">缓存控制</td><td align="left">HTTP日期格式</td></tr><tr><td align="left">Accept-Language</td><td align="left">语言选择</td><td align="left">en-US</td></tr><tr><td align="left">API-Version</td><td align="left">版本控制</td><td align="left">v2</td></tr></tbody></table>
<h3 data-id="heading-14">4.2 与 HttpServletRequest.getHeader() 的对比</h3>








































<table><thead><tr><th align="left">特性</th><th align="left">@RequestHeader</th><th align="left">request.getHeader()</th></tr></thead><tbody><tr><td align="left">代码位置</td><td align="left">Controller 方法参数</td><td align="left">任意有 request 的地方</td></tr><tr><td align="left">类型安全</td><td align="left">✅ 支持自动转换</td><td align="left">❌ 仅返回 String</td></tr><tr><td align="left">可读性</td><td align="left">✅ 声明式，意图明确</td><td align="left">❌ 命令式，需查找 key</td></tr><tr><td align="left">校验能力</td><td align="left">✅ 内置 required/default</td><td align="left">❌ 需手动判空</td></tr><tr><td align="left">测试友好性</td><td align="left">✅ 易于 Mock 参数</td><td align="left">❌ 需 Mock HttpServletRequest</td></tr><tr><td align="left">耦合度</td><td align="left">低（无 Servlet API 依赖）</td><td align="left">高（强依赖 Servlet API）</td></tr></tbody></table>
<h2 data-id="heading-15">五、总结</h2>
<p>  在现代Web应用程序中，安全性是一个至关重要的方面，特别是当我们处理敏感数据或执行受限操作时。@RequestHeader 注解在这方面发挥了重要作用，它允许开发者轻松地从HTTP请求头中提取信息，例如认证令牌，并据此进行安全决策。通过这种方式，我们能够精确控制对受限端点的访问，仅允许通过身份验证的用户访问敏感数据。这不仅增强了应用程序的安全性，还提供了一种灵活的方法来处理各种基于请求头的逻辑。</p>
<p>  然而，合理使用这一工具的同时，开发者也需要关注安全性的其它方面，比如确保敏感信息的加密存储、使用HTTPS来保护数据传输的安全等。此外，实现鲁棒的身份验证逻辑和错误处理机制也是至关重要的，以确保应用程序能够妥善处理无效或恶意的请求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d3faf367a6b462daac38015d62d6a19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770310280&amp;x-signature=SPdPdWvr7nH2Yx6o050wj7Gs4DU%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 8 - 对象部分属性只读]]></title>    <link>https://juejin.cn/post/7600616270003306534</link>    <guid>https://juejin.cn/post/7600616270003306534</guid>    <pubDate>2026-01-29T15:11:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270003306534" data-draft-id="7600601482691035182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 8 - 对象部分属性只读"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-29T15:11:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 8 - 对象部分属性只读
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:11:24.000Z" title="Thu Jan 29 2026 15:11:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">8 - 对象部分属性只读</h2>
<p>by Anthony Fu (@antfu) #中等 #readonly #object-keys</p>
<h3 data-id="heading-1">题目</h3>
<p>实现一个泛型<code>MyReadonly2&lt;T, K&gt;</code>，它带有两种类型的参数<code>T</code>和<code>K</code>。</p>
<p>类型 <code>K</code> 指定 <code>T</code> 中要被设置为只读 (readonly) 的属性。如果未提供<code>K</code>，则应使所有属性都变为只读，就像普通的<code>Readonly&lt;T&gt;</code>一样。</p>
<p>例如</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">todo</span>: <span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span>&gt; = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">"Hey"</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">"foobar"</span>,
  <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
}

todo.<span class="hljs-property">title</span> = <span class="hljs-string">"Hello"</span> <span class="hljs-comment">// Error: cannot reassign a readonly property</span>
todo.<span class="hljs-property">description</span> = <span class="hljs-string">"barFoo"</span> <span class="hljs-comment">// Error: cannot reassign a readonly property</span>
todo.<span class="hljs-property">completed</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// OK</span>
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F8%2Fzh-CN" target="_blank" title="https://tsch.js.org/8/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/8/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">代码</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyReadonly2</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T = keyof T&gt; = {
  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> K]: T[P]
} &amp; <span class="hljs-title class_">Omit</span>&lt;T, K&gt;

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>MyReadonly2&lt;T, K extends keyof T = keyof T&gt;</code> 表示 <code>MyReadonly2</code> 是一个泛型，它有两个类型参数 <code>T</code> 和 <code>K</code>。</li>
<li><code>K extends keyof T = keyof T</code> 表示 <code>K</code> 是 <code>T</code> 的属性名的子类型，默认值为 <code>keyof T</code>，即所有属性都为只读。</li>
<li><code>readonly [P in K]: T[P]</code> 表示将 <code>K</code> 中的属性名 <code>P</code> 转换为只读属性，属性值为 <code>T[P]</code>。</li>
<li><code>&amp; Omit&lt;T, K&gt;</code> 表示将 <code>T</code> 中除了 <code>K</code> 中的属性名外的其他属性保留下来。</li>
</ul>
<h3 data-id="heading-3">相关知识点</h3>
<h4 data-id="heading-4"><code>extends</code></h4>




















<table><thead><tr><th>使用维度</th><th>核心作用</th><th>示例场景</th></tr></thead><tbody><tr><td>类型维度</td><td>做类型约束或条件判断（类型编程核心）</td><td>限定泛型范围、判断类型是否兼容、提取类型片段</td></tr><tr><td>语法维度</td><td>做继承（复用已有结构）</td><td>接口继承、类继承</td></tr></tbody></table>
<h5 data-id="heading-5"><code>extends</code> 做类型约束或条件判断</h5>
<ol>
<li>泛型约束：限定泛型的取值范围</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 约束 T 必须是「拥有 length 属性」的类型（比如 string/数组）</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// 合法调用（符合约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ✅ string 有 length，返回 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// ✅ 数组有 length，返回 3</span>

<span class="hljs-comment">// 非法调用（超出约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// ❌ 报错：number 没有 length 属性</span>
</code></pre>
<ol start="2">
<li>条件类型：类型版 <strong>三元运算符</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础示例：判断类型是否为字符串</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// true（符合）</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// false（不符合）</span>
</code></pre>
<p>分布式条件类型（联合类型专用）: 当 <code>T</code> 是联合类型时，<code>extends</code> 会自动拆分联合类型的每个成员，逐个判断后再合并结果。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// 拆分逻辑：string→string，number→never，boolean→never → 合并为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>注意：只有泛型参数是 裸类型（没有被 []/{} 包裹）时，才会触发分布式判断：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 包裹后不触发分布式，整体判断 [string|number] 是否兼容 [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// never（整体不兼容）</span>
</code></pre>
<ol start="3">
<li>配合 <code>infer</code>：提取类型片段（黄金组合）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 提取 Promise 的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string（提取成功）</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number（不满足条件，返回原类型）</span>
</code></pre>
<h5 data-id="heading-6"><code>extends</code> 做继承（复用已有结构）</h5>
<ol>
<li>接口继承：复用 + 扩展属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 继承 User，并扩展新属性</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// 新增权限属性</span>
}

<span class="hljs-comment">// 必须包含继承的 + 扩展的所有属性</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// 多接口继承</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 同时继承 User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>类继承：复用父类的属性 / 方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// 继承 Parent 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 必须调用父类构造函数（初始化父类属性）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// 重写父类方法</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 调用父类原方法</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 输出：Hi, 李四 → I'm 10 years old</span>
</code></pre>
<p>补充：类实现接口用 <code>implements</code>（不是 <code>extends</code>）</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义接口（契约：规定必须有 id、name 属性，以及 greet 方法）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 仅定义方法签名，无实现</span>
}

<span class="hljs-comment">// 类实现接口（必须严格遵守契约）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// 必须实现接口的所有属性</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数初始化属性</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 必须实现接口的 greet 方法（具体实现由类自己定义）</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// 实例化使用</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// 输出：Hi, I'm 张三, ID: 1</span>


<span class="hljs-comment">// 接口1：基础信息</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 接口2：可打印</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 类同时实现两个接口（必须实现所有接口的成员）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 类可扩展接口外的属性</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 实现 Identifiable 的方法</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// 实现 Printable 的方法</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"手机"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: 手机, ID: 100</span>
</code></pre>
<h4 data-id="heading-7"><code>readonly</code></h4>
<ul>
<li>核心作用：标记后，目标（属性 / 数组 / 元组）只能在初始化阶段赋值（比如接口实例化、类构造函数、变量声明时），后续任何修改操作都会被 TS 编译器拦截报错；</li>
<li>运行时特性：<code>readonly</code> 仅做编译时检查，不会生成任何额外 JS 代码，也无法真正阻止运行时的修改（比如通过类型断言绕开的话，运行时仍能改）；</li>
<li>与 <code>const</code> 的区别：<code>const</code> 是变量层面的不可重新赋值（但变量指向的对象 / 数组内部属性仍可改），<code>readonly</code> 是属性 / 类型层面的不可修改（变量本身可重新赋值，除非变量也用 <code>const</code>）。</li>
</ul>
<p>常用使用场景：</p>
<ol>
<li>作用于接口 / 类型别名的属性（最基础）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义带只读属性的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性：只能初始化赋值，后续不可改</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 普通属性：可修改</span>
}

<span class="hljs-comment">// 初始化时赋值（合法）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span> };

<span class="hljs-comment">// 尝试修改只读属性（报错）</span>
user.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// ❌ 报错：无法分配到 "id"，因为它是只读属性</span>
<span class="hljs-comment">// 修改普通属性（合法）</span>
user.<span class="hljs-property">name</span> = <span class="hljs-string">"李四"</span>; <span class="hljs-comment">// ✅ 合法</span>
</code></pre>
<ol start="2">
<li>作用于类的属性: 类中使用 <code>readonly</code> 标记属性，只能在<strong>声明时</strong>或<strong>构造函数中</strong>赋值，后续无法修改</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数中给 readonly 属性赋值（唯一合法的后续赋值方式）</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">updateInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// ❌ 报错：id 是只读属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"王五"</span>; <span class="hljs-comment">// ✅ 合法</span>
  }
}

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"赵六"</span>);
person.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// ❌ 报错：只读属性不可修改</span>
</code></pre>
<ol start="3">
<li>作用于数组 / 元组（只读数组）: <code>readonly</code> 可标记数组为 “只读数组”，禁止修改数组元素、调用 <code>push/pop</code> 等修改方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 方式1：使用 readonly 修饰数组类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr1</span>: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr1.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// ❌ 报错：readonly 数组不存在 push 方法</span>
arr1[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>; <span class="hljs-comment">// ❌ 报错：无法修改只读数组的元素</span>

<span class="hljs-comment">// 方式2：使用 ReadonlyArray&lt;T&gt; 类型（等价于 readonly T[]）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr2</span>: <span class="hljs-title class_">ReadonlyArray</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>];
arr2.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// ❌ 报错</span>

<span class="hljs-comment">// 作用于元组（只读元组）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Point</span> = <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>];
<span class="hljs-keyword">const</span> <span class="hljs-attr">point</span>: <span class="hljs-title class_">Point</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>];
point[<span class="hljs-number">0</span>] = <span class="hljs-number">30</span>; <span class="hljs-comment">// ❌ 报错：只读元组元素不可修改</span>
</code></pre>
<ol start="4">
<li>结合 <code>keyof</code> + <code>in</code> 批量创建只读类型（映射类型）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">stock</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 批量创建只读版本的 Product（TS 内置的 Readonly&lt;T&gt; 就是这么实现的）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyProduct</span> = {
  <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Product</span>]: <span class="hljs-title class_">Product</span>[K];
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">product</span>: <span class="hljs-title class_">ReadonlyProduct</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"手机"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">2999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span> };
product.<span class="hljs-property">price</span> = <span class="hljs-number">3999</span>; <span class="hljs-comment">// ❌ 报错：price 是只读属性</span>

<span class="hljs-comment">// TS 内置了 Readonly&lt;T&gt;，可直接使用（无需手动写映射类型）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">product2</span>: <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Product</span>&gt; = { <span class="hljs-attr">name</span>: <span class="hljs-string">"电脑"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">50</span> };
product2.<span class="hljs-property">stock</span> = <span class="hljs-number">60</span>; <span class="hljs-comment">// ❌ 报错</span>
</code></pre>
<ol start="5">
<li>只读索引签名：如果类型使用索引签名，也可以标记为 <code>readonly</code>，禁止通过索引修改属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 只读索引签名：只能读取，不能修改</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyDict</span> = {
  <span class="hljs-keyword">readonly</span> [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">dict</span>: <span class="hljs-title class_">ReadonlyDict</span> = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
dict[<span class="hljs-string">"a"</span>] = <span class="hljs-number">3</span>; <span class="hljs-comment">// ❌ 报错：索引签名是只读的</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dict[<span class="hljs-string">"b"</span>]); <span class="hljs-comment">// ✅ 合法：仅读取</span>
</code></pre>
<h4 data-id="heading-8"><code>keyof</code></h4>
<p><code>keyof</code> 操作符用于获取对象类型的所有属性名（包括索引签名），并将其转换为联合类型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = keyof <span class="hljs-title class_">Todo</span> <span class="hljs-comment">// "title" | "description" | "completed"</span>
</code></pre>
<h4 data-id="heading-9"><code>in</code></h4>
<p><code>in</code> 操作符用于遍历联合类型中的每个成员。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span>]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   description: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-10"><code>Omit&lt;T, K&gt;</code></h4>
<p><code>Omit&lt;T, K&gt;</code> 用于从类型 <code>T</code> 中排除 <code>K</code> 中的属性，返回一个新类型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span>&gt;
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-11"><code>&amp;</code></h4>
<p><code>&amp;</code> 交叉类型运算符用于将多个类型合并为一个新类型，它会将所有属性合并到新类型中。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span>&gt; &amp; {
  <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">//   time: Date</span>
<span class="hljs-comment">// }</span>
</code></pre>
<p>基础类型的交叉，只有类型完全一致时才会保留原类型，类型不一致时会得到 <code>never</code> 。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> A = <span class="hljs-built_in">number</span> &amp; <span class="hljs-built_in">string</span> <span class="hljs-comment">// never</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-built_in">number</span> &amp; <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// never</span>
<span class="hljs-keyword">type</span> C = <span class="hljs-built_in">number</span> &amp; <span class="hljs-built_in">symbol</span> <span class="hljs-comment">// never</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-built_in">string</span> &amp; <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// never</span>
<span class="hljs-keyword">type</span> E = <span class="hljs-built_in">string</span> &amp; <span class="hljs-built_in">symbol</span> <span class="hljs-comment">// never</span>
<span class="hljs-keyword">type</span> F = <span class="hljs-built_in">boolean</span> &amp; <span class="hljs-built_in">symbol</span> <span class="hljs-comment">// never</span>
</code></pre>
<p>同名属性的类型冲突时，会得到 <code>never</code> 。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> A {
  <span class="hljs-attr">x</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 同名属性，类型 string</span>
}
<span class="hljs-keyword">interface</span> B {
  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 同名属性，类型 number</span>
}

<span class="hljs-keyword">type</span> C = A &amp; B;
<span class="hljs-comment">// C 的 x 类型为 string &amp; number → never</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">c</span>: C = {
  <span class="hljs-attr">x</span>: <span class="hljs-number">123</span>, <span class="hljs-comment">// 报错：类型 number 不能赋值给 never</span>
  <span class="hljs-attr">x</span>: <span class="hljs-string">"abc"</span> <span class="hljs-comment">// 同样报错</span>
};
</code></pre>
<h3 data-id="heading-12">测试用例</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Alike</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Alike</span>&lt;<span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo1</span>&gt;, <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Todo1</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Alike</span>&lt;<span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo1</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span>&gt;, <span class="hljs-title class_">Expected</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Alike</span>&lt;<span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo2</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span>&gt;, <span class="hljs-title class_">Expected</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Alike</span>&lt;<span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo2</span>, <span class="hljs-string">'description'</span> &gt;, <span class="hljs-title class_">Expected</span>&gt;&gt;,
]

<span class="hljs-comment">// @ts-expect-error</span>
<span class="hljs-keyword">type</span> error = <span class="hljs-title class_">MyReadonly2</span>&lt;<span class="hljs-title class_">Todo1</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'invalid'</span>&gt;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo1</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  description?: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo2</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  description?: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-keyword">readonly</span> description?: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

</code></pre>
<h3 data-id="heading-13">相关链接</h3>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F8%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/8/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/8/answer/zh…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F8%2Fsolutions" target="_blank" title="https://tsch.js.org/8/solutions" ref="nofollow noopener noreferrer">tsch.js.org/8/solutions</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770304284&amp;x-signature=cSVn2S1Kbu7J%2B23al8OC94g7xG0%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 9 - 对象属性只读（递归）]]></title>    <link>https://juejin.cn/post/7600616270003339302</link>    <guid>https://juejin.cn/post/7600616270003339302</guid>    <pubDate>2026-01-29T15:18:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270003339302" data-draft-id="7600622206268915722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 9 - 对象属性只读（递归）"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-29T15:18:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 9 - 对象属性只读（递归）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:18:02.000Z" title="Thu Jan 29 2026 15:18:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">9 - 对象属性只读（递归）</h2>
<p>by Anthony Fu (@antfu) #中等 #readonly #object-keys #deep</p>
<h3 data-id="heading-1">题目</h3>
<p>实现一个泛型 <code>DeepReadonly&lt;T&gt;</code>，它将对象的每个参数及其子对象递归地设为只读。</p>
<p>您可以假设在此挑战中我们仅处理对象。不考虑数组、函数、类等。但是，您仍然可以通过覆盖尽可能多的不同案例来挑战自己。</p>
<p>例如</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> X = {
  <span class="hljs-attr">x</span>: {
    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>
    <span class="hljs-attr">b</span>: <span class="hljs-string">'hi'</span>
  }
  <span class="hljs-attr">y</span>: <span class="hljs-string">'hey'</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Expected</span> = {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">x</span>: {
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">b</span>: <span class="hljs-string">'hi'</span>
  }
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">y</span>: <span class="hljs-string">'hey'</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Todo</span> = <span class="hljs-title class_">DeepReadonly</span>&lt;X&gt; <span class="hljs-comment">// should be same as `Expected`</span>
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F9%2Fzh-CN" target="_blank" title="https://tsch.js.org/9/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/9/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">代码</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = {
  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: keyof T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">never</span> ? T[P] : <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt;
}

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>readonly [P in keyof T]: ...</code> 用于将对象的每个属性设为只读。</li>
<li><code>keyof T[P] extends never ? T[P] : DeepReadonly&lt;T[P]&gt;</code> 用于递归处理子对象。</li>
<li><code>keyof T[P] extends never</code> 用于判断 <code>T[P]</code> 是否为基础类型（不包含子对象）。</li>
<li><code>T[P]</code> 用于获取属性的类型。</li>
<li><code>DeepReadonly&lt;T[P]&gt;</code> 用于递归处理子对象。</li>
</ul>
<h3 data-id="heading-3">相关知识点</h3>
<h4 data-id="heading-4"><code>readonly</code></h4>
<ul>
<li>核心作用：标记后，目标（属性 / 数组 / 元组）只能在初始化阶段赋值（比如接口实例化、类构造函数、变量声明时），后续任何修改操作都会被 TS 编译器拦截报错；</li>
<li>运行时特性：<code>readonly</code> 仅做编译时检查，不会生成任何额外 JS 代码，也无法真正阻止运行时的修改（比如通过类型断言绕开的话，运行时仍能改）；</li>
<li>与 <code>const</code> 的区别：<code>const</code> 是变量层面的不可重新赋值（但变量指向的对象 / 数组内部属性仍可改），<code>readonly</code> 是属性 / 类型层面的不可修改（变量本身可重新赋值，除非变量也用 <code>const</code>）。</li>
</ul>
<p>常用使用场景：</p>
<ol>
<li>作用于接口 / 类型别名的属性（最基础）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义带只读属性的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性：只能初始化赋值，后续不可改</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 普通属性：可修改</span>
}

<span class="hljs-comment">// 初始化时赋值（合法）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span> };

<span class="hljs-comment">// 尝试修改只读属性（报错）</span>
user.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// ❌ 报错：无法分配到 "id"，因为它是只读属性</span>
<span class="hljs-comment">// 修改普通属性（合法）</span>
user.<span class="hljs-property">name</span> = <span class="hljs-string">"李四"</span>; <span class="hljs-comment">// ✅ 合法</span>
</code></pre>
<ol start="2">
<li>作用于类的属性: 类中使用 <code>readonly</code> 标记属性，只能在<strong>声明时</strong>或<strong>构造函数中</strong>赋值，后续无法修改</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数中给 readonly 属性赋值（唯一合法的后续赋值方式）</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">updateInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// ❌ 报错：id 是只读属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"王五"</span>; <span class="hljs-comment">// ✅ 合法</span>
  }
}

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"赵六"</span>);
person.<span class="hljs-property">id</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// ❌ 报错：只读属性不可修改</span>
</code></pre>
<ol start="3">
<li>作用于数组 / 元组（只读数组）: <code>readonly</code> 可标记数组为 “只读数组”，禁止修改数组元素、调用 <code>push/pop</code> 等修改方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 方式1：使用 readonly 修饰数组类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr1</span>: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr1.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// ❌ 报错：readonly 数组不存在 push 方法</span>
arr1[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>; <span class="hljs-comment">// ❌ 报错：无法修改只读数组的元素</span>

<span class="hljs-comment">// 方式2：使用 ReadonlyArray&lt;T&gt; 类型（等价于 readonly T[]）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">arr2</span>: <span class="hljs-title class_">ReadonlyArray</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>];
arr2.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// ❌ 报错</span>

<span class="hljs-comment">// 作用于元组（只读元组）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Point</span> = <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>];
<span class="hljs-keyword">const</span> <span class="hljs-attr">point</span>: <span class="hljs-title class_">Point</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>];
point[<span class="hljs-number">0</span>] = <span class="hljs-number">30</span>; <span class="hljs-comment">// ❌ 报错：只读元组元素不可修改</span>
</code></pre>
<ol start="4">
<li>结合 <code>keyof</code> + <code>in</code> 批量创建只读类型（映射类型）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">stock</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 批量创建只读版本的 Product（TS 内置的 Readonly&lt;T&gt; 就是这么实现的）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyProduct</span> = {
  <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Product</span>]: <span class="hljs-title class_">Product</span>[K];
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">product</span>: <span class="hljs-title class_">ReadonlyProduct</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"手机"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">2999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span> };
product.<span class="hljs-property">price</span> = <span class="hljs-number">3999</span>; <span class="hljs-comment">// ❌ 报错：price 是只读属性</span>

<span class="hljs-comment">// TS 内置了 Readonly&lt;T&gt;，可直接使用（无需手动写映射类型）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">product2</span>: <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Product</span>&gt; = { <span class="hljs-attr">name</span>: <span class="hljs-string">"电脑"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">50</span> };
product2.<span class="hljs-property">stock</span> = <span class="hljs-number">60</span>; <span class="hljs-comment">// ❌ 报错</span>
</code></pre>
<ol start="5">
<li>只读索引签名：如果类型使用索引签名，也可以标记为 <code>readonly</code>，禁止通过索引修改属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 只读索引签名：只能读取，不能修改</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyDict</span> = {
  <span class="hljs-keyword">readonly</span> [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">dict</span>: <span class="hljs-title class_">ReadonlyDict</span> = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
dict[<span class="hljs-string">"a"</span>] = <span class="hljs-number">3</span>; <span class="hljs-comment">// ❌ 报错：索引签名是只读的</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dict[<span class="hljs-string">"b"</span>]); <span class="hljs-comment">// ✅ 合法：仅读取</span>
</code></pre>
<h4 data-id="heading-5"><code>keyof</code></h4>
<p><code>keyof</code> 操作符用于获取对象类型的所有属性名（包括索引签名），并将其转换为联合类型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = keyof <span class="hljs-title class_">Todo</span> <span class="hljs-comment">// "title" | "description" | "completed"</span>
</code></pre>
<h4 data-id="heading-6"><code>in</code></h4>
<p><code>in</code> 操作符用于遍历联合类型中的每个成员。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span>]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   description: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-7"><code>extends</code></h4>




















<table><thead><tr><th>使用维度</th><th>核心作用</th><th>示例场景</th></tr></thead><tbody><tr><td>类型维度</td><td>做类型约束或条件判断（类型编程核心）</td><td>限定泛型范围、判断类型是否兼容、提取类型片段</td></tr><tr><td>语法维度</td><td>做继承（复用已有结构）</td><td>接口继承、类继承</td></tr></tbody></table>
<h5 data-id="heading-8"><code>extends</code> 做类型约束或条件判断</h5>
<ol>
<li>泛型约束：限定泛型的取值范围</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 约束 T 必须是「拥有 length 属性」的类型（比如 string/数组）</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// 合法调用（符合约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ✅ string 有 length，返回 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// ✅ 数组有 length，返回 3</span>

<span class="hljs-comment">// 非法调用（超出约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// ❌ 报错：number 没有 length 属性</span>
</code></pre>
<ol start="2">
<li>条件类型：类型版 <strong>三元运算符</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础示例：判断类型是否为字符串</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// true（符合）</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// false（不符合）</span>
</code></pre>
<p>分布式条件类型（联合类型专用）: 当 <code>T</code> 是联合类型时，<code>extends</code> 会自动拆分联合类型的每个成员，逐个判断后再合并结果。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// 拆分逻辑：string→string，number→never，boolean→never → 合并为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>注意：只有泛型参数是 裸类型（没有被 []/{} 包裹）时，才会触发分布式判断：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 包裹后不触发分布式，整体判断 [string|number] 是否兼容 [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// never（整体不兼容）</span>
</code></pre>
<ol start="3">
<li>配合 <code>infer</code>：提取类型片段（黄金组合）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 提取 Promise 的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string（提取成功）</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number（不满足条件，返回原类型）</span>
</code></pre>
<h5 data-id="heading-9"><code>extends</code> 做继承（复用已有结构）</h5>
<ol>
<li>接口继承：复用 + 扩展属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 继承 User，并扩展新属性</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// 新增权限属性</span>
}

<span class="hljs-comment">// 必须包含继承的 + 扩展的所有属性</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// 多接口继承</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 同时继承 User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>类继承：复用父类的属性 / 方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// 继承 Parent 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 必须调用父类构造函数（初始化父类属性）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// 重写父类方法</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 调用父类原方法</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 输出：Hi, 李四 → I'm 10 years old</span>
</code></pre>
<p>补充：类实现接口用 <code>implements</code>（不是 <code>extends</code>）</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义接口（契约：规定必须有 id、name 属性，以及 greet 方法）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 仅定义方法签名，无实现</span>
}

<span class="hljs-comment">// 类实现接口（必须严格遵守契约）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// 必须实现接口的所有属性</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数初始化属性</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 必须实现接口的 greet 方法（具体实现由类自己定义）</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// 实例化使用</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// 输出：Hi, I'm 张三, ID: 1</span>


<span class="hljs-comment">// 接口1：基础信息</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 接口2：可打印</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 类同时实现两个接口（必须实现所有接口的成员）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 类可扩展接口外的属性</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 实现 Identifiable 的方法</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// 实现 Printable 的方法</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"手机"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: 手机, ID: 100</span>
</code></pre>
<h3 data-id="heading-10">测试用例</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-variable constant_">X1</span>&gt;, <span class="hljs-title class_">Expected1</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-variable constant_">X2</span>&gt;, <span class="hljs-title class_">Expected2</span>&gt;&gt;,
]

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">X1</span> = {
  <span class="hljs-attr">a</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-number">22</span>
  <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">c</span>: {
    <span class="hljs-attr">d</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">e</span>: {
      <span class="hljs-attr">g</span>: {
        <span class="hljs-attr">h</span>: {
          <span class="hljs-attr">i</span>: <span class="hljs-literal">true</span>
          <span class="hljs-attr">j</span>: <span class="hljs-string">'string'</span>
        }
        <span class="hljs-attr">k</span>: <span class="hljs-string">'hello'</span>
      }
      <span class="hljs-attr">l</span>: [
        <span class="hljs-string">'hi'</span>,
        {
          <span class="hljs-attr">m</span>: [<span class="hljs-string">'hey'</span>]
        },
      ]
    }
  }
}

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">X2</span> = { <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> } | { <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> }

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Expected1</span> = {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">a</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-number">22</span>
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">c</span>: {
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">d</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">e</span>: {
      <span class="hljs-keyword">readonly</span> <span class="hljs-attr">g</span>: {
        <span class="hljs-keyword">readonly</span> <span class="hljs-attr">h</span>: {
          <span class="hljs-keyword">readonly</span> <span class="hljs-attr">i</span>: <span class="hljs-literal">true</span>
          <span class="hljs-keyword">readonly</span> <span class="hljs-attr">j</span>: <span class="hljs-string">'string'</span>
        }
        <span class="hljs-keyword">readonly</span> <span class="hljs-attr">k</span>: <span class="hljs-string">'hello'</span>
      }
      <span class="hljs-keyword">readonly</span> <span class="hljs-attr">l</span>: <span class="hljs-keyword">readonly</span> [
        <span class="hljs-string">'hi'</span>,
        {
          <span class="hljs-keyword">readonly</span> <span class="hljs-attr">m</span>: <span class="hljs-keyword">readonly</span> [<span class="hljs-string">'hey'</span>]
        },
      ]
    }
  }
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Expected2</span> = { <span class="hljs-keyword">readonly</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> } | { <span class="hljs-keyword">readonly</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> }

</code></pre>
<h3 data-id="heading-11">相关链接</h3>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F9%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/9/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/9/answer/zh…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F9%2Fsolutions" target="_blank" title="https://tsch.js.org/9/solutions" ref="nofollow noopener noreferrer">tsch.js.org/9/solutions</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770304684&amp;x-signature=JxYELhQkfRIq7svnRYSERWmSmXQ%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[万字长文！搞懂机器学习中的分类|回归|聚类任务都有哪些常用的评估指标！]]></title>    <link>https://juejin.cn/post/7600616270003355686</link>    <guid>https://juejin.cn/post/7600616270003355686</guid>    <pubDate>2026-01-29T15:23:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270003355686" data-draft-id="7600628279215702042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="万字长文！搞懂机器学习中的分类|回归|聚类任务都有哪些常用的评估指标！"/> <meta itemprop="keywords" content="面试,算法"/> <meta itemprop="datePublished" content="2026-01-29T15:23:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            万字长文！搞懂机器学习中的分类|回归|聚类任务都有哪些常用的评估指标！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:23:19.000Z" title="Thu Jan 29 2026 15:23:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn" target="_blank" title="https://aicoting.cn" ref="nofollow noopener noreferrer">aicoting.cn</a></p>
</blockquote>
<p>在机器学习中，评估指标用于量化模型在不同任务上的性能，是模型选择与调优的重要依据。不同类型的任务对应不同的指标：分类任务常用准确率、精确率、召回率、F1 值以及 ROC-AUC 等，用于衡量模型对不同类别的识别能力；回归任务常用均方误差（MSE）、平均绝对误差（MAE）和决定系数（R²）来评价预测值与真实值的偏差；聚类任务则可采用轮廓系数、归一化互信息（NMI）和调整兰德指数（ARI）来衡量聚类结果的紧密性和一致性。通过合理选择和综合使用这些评估指标，可以全面反映模型性能，指导模型优化和应用。</p>
<h2 data-id="heading-0">分类</h2>
<p>在分类任务中，模型的目标是将样本正确地划分到预定义类别。为了全面评估模型性能，研究者通常使用一系列分类评估指标。不同指标关注的方面不同，合理选择指标可以帮助发现模型的优势与不足，并指导模型调优。</p>
<h3 data-id="heading-1">混淆矩阵（Confusion Matrix）</h3>
<p>混淆矩阵是分类模型评估的基础工具，它以表格形式展示模型预测结果与真实标签的对应关系。对于二分类问题，矩阵通常包含四个元素：</p>
<ul>
<li>TP（True Positive）：真实为正例，预测为正例的样本数。</li>
<li>TN（True Negative）：真实为负例，预测为负例的样本数。</li>
<li>FP（False Positive）：真实为负例，预测为正例的样本数。</li>
<li>FN（False Negative）：真实为正例，预测为负例的样本数。</li>
</ul>
<p>混淆矩阵不仅能够直观展示分类错误类型，还为后续指标计算提供基础。</p>
<h3 data-id="heading-2">准确率（Accuracy）</h3>
<p>准确率是模型正确预测样本的比例。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Accuracy</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">Accuracy</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>这个很直观，就是别管我预测负样本对了，还是预测正样本对了，都算进来，算的就是预测对的样本占总样本的比例，但是对于类别不平衡的数据，准确率可能具有误导性。例如在正负样本比例严重不平衡时，模型即使总是预测多数类也能获得高准确率。</p>
<h3 data-id="heading-3">精确率（Precision）</h3>
<p>精确率的定义是在所有被模型预测为正例的样本中，实际为正例的比例。
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Precision</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Precision} = \frac{TP}{TP + FP}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Precision</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>精确率关注模型预测为正类的样本中，实际为正类的比例，是对模型“猜对”正类的能力的衡量。</p>
<h3 data-id="heading-4">召回率（Recall）或敏感度（Sensitivity）</h3>
<p>召回率是在所有真实正例中，被模型正确预测为正例的比例。
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Recall</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Recall} = \frac{TP}{TP + FN}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">Recall</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>召回率用于衡量模型对正类样本的覆盖能力，高召回率意味着漏报少，比如疾病筛查中，尽量保证病人被正确识别，即使可能出现少量误报。</p>
<h3 data-id="heading-5">F1 值（F1 Score）</h3>
<p>F1 值是精确率和召回率的调和平均数，用于综合衡量模型在精确性和召回性上的表现。
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>F1</mtext><mo>=</mo><mn>2</mn><mo>⋅</mo><mfrac><mrow><mtext>Precision</mtext><mo>⋅</mo><mtext>Recall</mtext></mrow><mrow><mtext>Precision</mtext><mo>+</mo><mtext>Recall</mtext></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{F1} = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">F1</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2834em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Precision</span></span><span class="mbin mtight">+</span><span class="mord text mtight"><span class="mord mtight">Recall</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Precision</span></span><span class="mbin mtight">⋅</span><span class="mord text mtight"><span class="mord mtight">Recall</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>当精确率和召回率不均衡时，F1 值提供了一个综合指标，更适合类别不平衡问题。</p>
<p>劈里啪啦说了一大堆，是不是不太好理解，现在我们还是用鸢尾花分类举一个例子： 我们假设做一个二分类任务：将 Iris-versicolor 视为正类（1），其它两类视为负类（0）。</p>








































<table><thead><tr><th>样本</th><th>真实类别</th><th>模型预测</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td></tr><tr><td>2</td><td>1</td><td>1</td></tr><tr><td>3</td><td>1</td><td>0</td></tr><tr><td>4</td><td>0</td><td>0</td></tr><tr><td>5</td><td>0</td><td>1</td></tr><tr><td>6</td><td>0</td><td>0</td></tr></tbody></table>
<p>根据上表，计算 TP、TN、FP、FN：</p>
<ul>
<li>TP（True Positive） = 2 （预测为 1，真实为 1）</li>
<li>TN（True Negative） = 2 （预测为 0，真实为 0）</li>
<li>FP（False Positive） = 1 （预测为 1，真实为 0）</li>
<li>FN（False Negative） = 1 （预测为 0，真实为 1）</li>
</ul>
<p>说人话，也就是：</p>
<ul>
<li>TP：模型成功抓到正类，比如正确识别出一朵 Iris-versicolor。</li>
<li>FP：模型“误抓”，把其他种类误认为 Iris-versicolor。</li>
<li>FN：模型“漏抓”，把正类当成了负类。</li>
<li>TN：模型正确拒绝，负类预测为负类。</li>
</ul>
<p>混淆矩阵如下：</p>




















<table><thead><tr><th/><th>预测 0</th><th>预测 1</th></tr></thead><tbody><tr><td>真实 0</td><td>TN = 2</td><td>FP = 1</td></tr><tr><td>真实 1</td><td>FN = 1</td><td>TP = 2</td></tr></tbody></table>
<p><strong>准确率</strong></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Accuracy</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>2</mn><mo>+</mo><mn>2</mn></mrow><mrow><mn>2</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>0.6667</mn></mrow><annotation encoding="application/x-tex">\text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN} = \frac{2+2}{2+2+1+1} = 0.6667</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">Accuracy</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.6667</span></span></span></span></span></p>
<p>模型总体正确率约 66.7%。</p>
<p><strong>精确率</strong></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Precision</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mrow><mn>2</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>0.6667</mn></mrow><annotation encoding="application/x-tex">\text{Precision} = \frac{TP}{TP + FP} = \frac{2}{2+1} = 0.6667</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Precision</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.6667</span></span></span></span></span></p>
<p>也就是在模型预测为 Iris-versicolor 的样本中，有 2⁄3 是正确的。</p>
<p><strong>召回率</strong></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Recall</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac><mo>=</mo><mfrac><mn>2</mn><mrow><mn>2</mn><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mn>0.6667</mn></mrow><annotation encoding="application/x-tex">\text{Recall} = \frac{TP}{TP + FN} = \frac{2}{2+1} = 0.6667</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">Recall</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.6667</span></span></span></span></span></p>
<p>模型找出了 2⁄3 的真实 Iris-versicolor 样本，还有 1 个漏掉。</p>
<p><strong>F1 值</strong></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>F1</mtext><mo>=</mo><mn>2</mn><mo>⋅</mo><mfrac><mrow><mtext>Precision</mtext><mo>⋅</mo><mtext>Recall</mtext></mrow><mrow><mtext>Precision</mtext><mo>+</mo><mtext>Recall</mtext></mrow></mfrac><mo>=</mo><mn>0.6667</mn></mrow><annotation encoding="application/x-tex">\text{F1} = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}} = 0.6667</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">F1</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2834em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Precision</span></span><span class="mbin mtight">+</span><span class="mord text mtight"><span class="mord mtight">Recall</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Precision</span></span><span class="mbin mtight">⋅</span><span class="mord text mtight"><span class="mord mtight">Recall</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.6667</span></span></span></span></span></p>
<p>F1 值综合考虑了精确率和召回率，用一个数衡量模型整体性能。</p>
<p>通过混淆矩阵和这些指标，你可以直观地看到模型在哪些样本上表现好，哪些样本容易出错，从而决定是否需要调参或改进特征。</p>
<h3 data-id="heading-6">ROC 曲线与 AUC</h3>
<ul>
<li>ROC 曲线（Receiver Operating Characteristic）：横轴为假阳性率（FPR），纵轴为真正率（TPR），展示分类器在不同阈值下的性能。</li>
</ul>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>FPR</mtext><mo>=</mo><mfrac><mrow><mi>F</mi><mi>P</mi></mrow><mrow><mi>F</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow></mfrac><mo separator="true">,</mo><mspace width="1em"/><mtext>TPR</mtext><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{FPR} = \frac{FP}{FP + TN}, \quad \text{TPR} = \frac{TP}{TP + FN}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">FPR</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">TN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord text"><span class="mord">TPR</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2757em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>

<ul>
<li>AUC（Area Under Curve）：ROC 曲线下的面积，范围在 0.5（随机猜测）到 1（完美分类）之间。</li>
</ul>
<p>AUC 可以衡量分类器对正负样本的区分能力，不依赖特定阈值，适合模型比较。</p>
<p>下面我们使用 scikit-learn 绘制 ROC 曲线并计算 AUC，我们以 Iris 数据集的二分类任务 为例，将 Iris-versicolor 作为正类。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要库</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_iris
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LogisticRegression
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> roc_curve, roc_auc_score

<span class="hljs-comment"># 1. 加载数据</span>
iris = load_iris()
X = iris.data
y = (iris.target == <span class="hljs-number">1</span>).astype(<span class="hljs-built_in">int</span>)  <span class="hljs-comment"># 将 Iris-versicolor 作为正类</span>

<span class="hljs-comment"># 2. 划分训练集和测试集</span>
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 3. 训练逻辑回归模型</span>
model = LogisticRegression(solver=<span class="hljs-string">'liblinear'</span>)
model.fit(X_train, y_train)

<span class="hljs-comment"># 4. 获取预测概率（正类概率）</span>
y_prob = model.predict_proba(X_test)[:, <span class="hljs-number">1</span>]

<span class="hljs-comment"># 5. 计算 ROC 曲线</span>
fpr, tpr, thresholds = roc_curve(y_test, y_prob)

<span class="hljs-comment"># 6. 计算 AUC</span>
auc_score = roc_auc_score(y_test, y_prob)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"AUC = <span class="hljs-subst">{auc_score:<span class="hljs-number">.4</span>f}</span>"</span>)

<span class="hljs-comment"># 7. 可视化 ROC 曲线</span>
plt.figure(figsize=(<span class="hljs-number">6</span>,<span class="hljs-number">6</span>))
plt.plot(fpr, tpr, color=<span class="hljs-string">'blue'</span>, lw=<span class="hljs-number">2</span>, label=<span class="hljs-string">f'ROC curve (AUC = <span class="hljs-subst">{auc_score:<span class="hljs-number">.4</span>f}</span>)'</span>)
plt.plot([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], color=<span class="hljs-string">'gray'</span>, linestyle=<span class="hljs-string">'--'</span>, label=<span class="hljs-string">'Random Guess'</span>)
plt.xlim([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>])
plt.ylim([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.05</span>])
plt.xlabel(<span class="hljs-string">'False Positive Rate'</span>)
plt.ylabel(<span class="hljs-string">'True Positive Rate'</span>)
plt.title(<span class="hljs-string">'ROC Curve'</span>)
plt.legend(loc=<span class="hljs-string">'lower right'</span>)
plt.grid(<span class="hljs-literal">True</span>)
plt.show()
</code></pre>
<p>结果如下图，ROC 曲线展示模型在不同阈值下的分类能力。曲线越靠近左上角，说明模型越好。AUC=0.81 表示模型区分正负类的能力较强。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c86ecf4f0ac403ba0c09b4fb61416c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305001&amp;x-signature=VYOsjo6EdxJhOVbAHBR9ScXTiRQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">多分类指标</h2>
<p>对于多分类任务，常用方法有：</p>
<ul>
<li>宏平均（Macro Average）：对每个类别计算指标，再取平均，关注每个类别的重要性相同。</li>
<li>微平均（Micro Average）：对所有样本统计总的 TP、FP、FN，再计算指标，适合类别样本不均衡时使用。</li>
</ul>
<p>对于类别均衡的数据，准确率可以作为主要指标。对于类别不平衡的数据，应关注 精确率、召回率、F1 值，必要时使用 ROC-AUC。</p>
<p>分类评估指标提供了从不同角度衡量模型性能的工具。从混淆矩阵到精确率、召回率、F1 值，再到 ROC-AUC，多维度评估可以帮助研究者理解模型优势与不足，为模型优化、调参和选择提供依据。合理的指标选择能够确保模型在实际应用中既准确又可靠。</p>
<h3 data-id="heading-8">回归</h3>
<p>在回归任务中，模型的目标是预测连续数值。为了衡量回归模型的性能，通常采用一系列量化指标，这些指标可以反映预测值与真实值之间的差异和模型的拟合能力。合理选择和理解回归评估指标，有助于优化模型和提升预测精度。</p>
<h3 data-id="heading-9">均方误差（Mean Squared Error, MSE）</h3>
<p>MSE 是预测值与真实值误差平方的平均值，计算公式为</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>MSE</mtext><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\text{MSE} = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">MSE</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中为真实值，为预测值，为样本数。</p>
<p>非常好理解，MSE就是计算真实值与预测值之间的差异大小，越大肯定预测的越不准，MSE对较大误差更敏感，适合对异常值敏感的场景，比如线性回归、神经网络的损失函数。</p>
<h3 data-id="heading-10">均方根误差（Root Mean Squared Error, RMSE）</h3>
<p>RMSE 是 MSE 的平方根，使指标与原始数据单位一致，更易解释。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>RMSE</mtext><mo>=</mo><msqrt><mtext>MSE</mtext></msqrt></mrow><annotation encoding="application/x-tex">\text{RMSE} = \sqrt{\text{MSE}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">RMSE</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1133em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9267em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord text"><span class="mord">MSE</span></span></span></span><span style="top:-2.8867em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1133em;"><span/></span></span></span></span></span></span></span></span></p>
<p>RMSE保留了 MSE 对大误差敏感的特性，同时量纲与原数据一致，直观反映预测误差大小。</p>
<h3 data-id="heading-11">平均绝对误差（Mean Absolute Error, MAE）</h3>
<p>MAE 是预测值与真实值误差绝对值的平均值。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>MAE</mtext><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi mathvariant="normal">∣</mi><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">\text{MAE} = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">MAE</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span></span></span></span></span></p>
<p>它对异常值不如 MSE 敏感，更稳健，适用于异常值较多或希望均衡衡量误差的场景。</p>
<h3 data-id="heading-12">决定系数（R² Score, Coefficient of Determination）</h3>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>衡量模型对数据方差的解释能力，取值范围通常在 0 到 1 之间，越接近 1 表示模型拟合越好。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn><mo>−</mo><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mover accent="true"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>y</mi><mo>ˉ</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">R^2 = 1 - \frac{\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}{\sum_{i=1}^{n}(y_i - \bar{y})^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.7289em;vertical-align:-0.57em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1589em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7047em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord mtight">ˉ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.535em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord mtight">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.57em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>其中为真实值平均数。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R^2 = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>表示模型仅预测均值， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R^2 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>表示预测完全正确。</p>
<p>注意，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>对异常值敏感，负值可能出现，表示模型表现比均值预测还差。</p>
<h3 data-id="heading-13">平均绝对百分比误差（Mean Absolute Percentage Error, MAPE）</h3>
<p>MAPE 衡量预测误差占真实值的百分比，适合对相对误差关注的场景。</p>
<p>MAPE可以直观显示预测偏离真实值的比例，但是当真实值接近 0 时，MAPE 会非常大甚至无法计算。</p>
<p>光说不练瞎把式，下面我们使用 波士顿房价数据集 算一下上面的常用回归评估指标。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要库</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_boston  <span class="hljs-comment"># 新版本可用 fetch_california_housing</span>
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegression
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> mean_squared_error, mean_absolute_error, r2_score

<span class="hljs-comment"># 1. 加载数据</span>
<span class="hljs-keyword">try</span>:
    boston = load_boston()
    X, y = boston.data, boston.target
<span class="hljs-keyword">except</span>:
    <span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> fetch_california_housing
    cali = fetch_california_housing()
    X, y = cali.data, cali.target

<span class="hljs-comment"># 2. 划分训练集和测试集</span>
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 3. 训练线性回归模型</span>
model = LinearRegression()
model.fit(X_train, y_train)
y_pred = model.predict(X_test)

<span class="hljs-comment"># 4. 计算回归评估指标</span>
mse = mean_squared_error(y_test, y_pred)
rmse = np.sqrt(mse)
mae = mean_absolute_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)
mape = np.mean(np.<span class="hljs-built_in">abs</span>((y_test - y_pred) / y_test)) * <span class="hljs-number">100</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"MSE: <span class="hljs-subst">{mse:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"RMSE: <span class="hljs-subst">{rmse:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"MAE: <span class="hljs-subst">{mae:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"R²: <span class="hljs-subst">{r2:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"MAPE: <span class="hljs-subst">{mape:<span class="hljs-number">.2</span>f}</span>%"</span>)

<span class="hljs-comment"># 5. 可视化预测误差</span>
plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
plt.scatter(y_test, y_pred, color=<span class="hljs-string">'skyblue'</span>, edgecolor=<span class="hljs-string">'k'</span>)
plt.plot([<span class="hljs-built_in">min</span>(y_test), <span class="hljs-built_in">max</span>(y_test)], [<span class="hljs-built_in">min</span>(y_test), <span class="hljs-built_in">max</span>(y_test)], color=<span class="hljs-string">'red'</span>, lw=<span class="hljs-number">2</span>, linestyle=<span class="hljs-string">'--'</span>)
plt.xlabel(<span class="hljs-string">"True Values"</span>)
plt.ylabel(<span class="hljs-string">"Predicted Values"</span>)
plt.title(<span class="hljs-string">"True vs Predicted Values"</span>)
plt.grid(<span class="hljs-literal">True</span>)
plt.show()

<span class="hljs-comment"># 6. 可视化误差分布</span>
errors = y_test - y_pred
plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
plt.hist(errors, bins=<span class="hljs-number">20</span>, color=<span class="hljs-string">'lightcoral'</span>, edgecolor=<span class="hljs-string">'k'</span>)
plt.xlabel(<span class="hljs-string">"Prediction Error"</span>)
plt.ylabel(<span class="hljs-string">"Frequency"</span>)
plt.title(<span class="hljs-string">"Distribution of Prediction Errors"</span>)
plt.grid(<span class="hljs-literal">True</span>)
plt.show()
</code></pre>
<p>结果如下，第一个图中预测点落在红色虚线</p>
<p>附近表示预测的准确，偏离线越远表示误差越大，第二个误差分布直方图展示预测误差的分布，中心集中表示模型预测稳定，偏离大表示存在异常预测。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf64b2f571dc45ae8a57d2eee8dd905e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305001&amp;x-signature=o2oNZEYumxGGPAmR1yDSlMcjU%2Bc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29c30d3fc46143ba9ac29247a5c26a96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305001&amp;x-signature=v1r4j%2BJz5dn4%2FM7Kio3xN1wUU8Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dae703079564e8aae7ca5113d2a7d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305001&amp;x-signature=BWLqjKVz%2BORogOzyIFb61CmUNho%3D" alt="" loading="lazy"/></p>
<p>总结一下，回归评估指标提供了从不同角度衡量模型预测效果的工具。从绝对误差（MAE）、平方误差（MSE、RMSE）到解释方差的<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> ，再到相对误差 MAPE，每种指标都有其特点和适用场景。</p>
<h2 data-id="heading-14">聚类</h2>
<p>聚类是一种无监督学习方法，其目标是将数据样本划分为若干组，使得同一组内部的样本相似度尽可能高，而不同组之间的样本差异尽可能大。由于聚类通常没有真实标签，评估聚类质量需要使用专门的指标。根据是否依赖真实标签，聚类评估指标可以分为 外部指标 和 内部指标。</p>
<h3 data-id="heading-15">内部指标（Internal Metrics）</h3>
<p>内部指标只使用数据本身和聚类结果进行评估，不依赖真实标签，主要关注簇内紧密度和簇间分离度。</p>
<h4 data-id="heading-16">轮廓系数（Silhouette Coefficient）</h4>
<p>定义：衡量每个样本与自身簇内其他样本的相似度，与其与最近簇样本的相似度差异。
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>b</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>−</mo><mi>a</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>a</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">s(i) = \frac{b(i) - a(i)}{\max\{a(i), b(i)\}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span><span class="mopen mtight">{</span><span class="mord mathnormal mtight">a</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)}</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">a</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span></span>  ：样本<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span> 到同簇内其他样本的平均距离。</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span></span> ：样本<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>  到最近簇的平均距离。</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">s(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span></span> 范围：[-1, 1]，越接近 1 表示聚类效果越好。 高轮廓系数表示簇内样本紧密且簇间分离明显，负值表示样本可能被错误分配。</li>
</ul>
<h4 data-id="heading-17">Calinski-Harabasz 指数（CH Index）</h4>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>CH</mtext><mo>=</mo><mfrac><mrow><mtext>Tr</mtext><mo stretchy="false">(</mo><msub><mi>B</mi><mi>k</mi></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mtext>Tr</mtext><mo stretchy="false">(</mo><msub><mi>W</mi><mi>k</mi></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{CH} = \frac{\text{Tr}(B_k) / (k-1)}{\text{Tr}(W_k) / (n-k)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">CH</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Tr</span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Tr</span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0502em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span><span class="mclose mtight">)</span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>定义：衡量簇间离散度与簇内紧密度之比。</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">B_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>  ：簇间散布矩阵</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>  ：簇内散布矩阵</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span> ：簇数，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">n</span></span></span></span></span>：样本总数 CH指数值越大表示聚类分离度高、紧密度好。适合评估不同簇数的选择。</li>
</ul>
<h4 data-id="heading-18">Davies-Bouldin 指数（DB Index）</h4>
<p>定义：衡量簇间相似性与簇内散布的比值。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>B</mi><mo>=</mo><mfrac><mn>1</mn><mi>k</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>j</mi><mo mathvariant="normal">≠</mo><mi>i</mi></mrow></msub><mfrac><mrow><msub><mi>σ</mi><mi>i</mi></msub><mo>+</mo><msub><mi>σ</mi><mi>j</mi></msub></mrow><mrow><mi>d</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">DB = \frac{1}{k} \sum_{i=1}^{k} \max_{j \neq i} \frac{\sigma_i + \sigma_j}{d(c_i, c_j)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.5313em;vertical-align:-0.5423em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.989em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"/></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9157em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>  ：簇<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex"> i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>内样本的平均距离</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(c_i, c_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> ：簇心<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>与簇心<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> 的距离</li>
</ul>
<p>DB指数的值越小表示簇分离良好，紧密度高。</p>
<h3 data-id="heading-19">外部指标（External Metrics）</h3>
<p>外部指标依赖真实标签（如果已知），用于比较聚类结果与真实类别的一致性。</p>
<h4 data-id="heading-20">归一化互信息（Normalized Mutual Information, NMI）</h4>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>NMI</mtext><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mn>2</mn><mi>I</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">;</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>U</mi><mo stretchy="false">)</mo><mo>+</mo><mi>H</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{NMI}(U,V) = \frac{2 I(U;V)}{H(U) + H(V)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">NMI</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mpunct mtight">;</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>定义：衡量聚类结果与真实标签之间的信息共享程度，范围 [0, 1]，1 表示完全一致。</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">;</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">I(U;V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span></span> ：互信息</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>U</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>H</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> H(U) , H(V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span></span>：聚类与真实标签的熵</li>
</ul>
<p>特点：对簇数量敏感，能够有效衡量标签一致性。</p>
<h4 data-id="heading-21">调整兰德指数（Adjusted Rand Index, ARI）</h4>
<p>定义：基于样本对的匹配关系衡量聚类质量，并对随机结果进行了校正。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>R</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>R</mi><mi>I</mi><mo>−</mo><mi>E</mi><mo stretchy="false">[</mo><mi>R</mi><mi>I</mi><mo stretchy="false">]</mo></mrow><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>R</mi><mi>I</mi><mo stretchy="false">)</mo><mo>−</mo><mi>E</mi><mo stretchy="false">[</mo><mi>R</mi><mi>I</mi><mo stretchy="false">]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">ARI = \frac{RI - E[RI]}{\max(RI) - E[RI]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mopen mtight">[</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mclose mtight">]</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mopen mtight">[</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mclose mtight">]</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">RI</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span>  ：Rand Index</li>
<li>ARI 范围 [-1, 1]，1 表示完全一致，0 表示随机聚类效果。</li>
</ul>
<h4 data-id="heading-22">Fowlkes-Mallows 指数（FMI）</h4>
<p>定义：基于 TP、FP、FN 计算聚类与真实标签的相似度。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>M</mi><mi>I</mi><mo>=</mo><msqrt><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow></msqrt></mrow><annotation encoding="application/x-tex">FMI = \sqrt{\frac{TP}{TP+FP} \cdot \frac{TP}{TP+FN}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">FM</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6205em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2195em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">FP</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">FN</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">TP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-3.1795em;"><span class="pstrut" style="height:3.8em;"/><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.88em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"><path d="M983 90&#10;l0 -0&#10;c4,-6.7,10,-10,18,-10 H400000v40&#10;H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7&#10;s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744&#10;c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30&#10;c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722&#10;c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5&#10;c53.7,-170.3,84.5,-266.8,92.5,-289.5z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6205em;"><span/></span></span></span></span></span></span></span></span></p>
<ul>
<li>TP：同簇且同类的样本对</li>
<li>FP：同簇但不同类样本对</li>
<li>FN：不同簇但同类样本对</li>
</ul>
<p>FMI值越接近 1 表示聚类与真实标签越一致。</p>
<p>下面我们使用 Iris 数据集进行聚类，计算以上的聚类评估指标</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要库</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_iris
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> KMeans
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> silhouette_score, calinski_harabasz_score, davies_bouldin_score
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> normalized_mutual_info_score, adjusted_rand_score
<span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> PCA

<span class="hljs-comment"># 1. 加载 Iris 数据集</span>
iris = load_iris()
X = iris.data
y_true = iris.target  <span class="hljs-comment"># 真实类别</span>

<span class="hljs-comment"># 2. 数据标准化</span>
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

<span class="hljs-comment"># 3. 使用 KMeans 聚类</span>
k = <span class="hljs-number">3</span>  <span class="hljs-comment"># 聚类簇数</span>
kmeans = KMeans(n_clusters=k, random_state=<span class="hljs-number">42</span>)
y_pred = kmeans.fit_predict(X_scaled)

<span class="hljs-comment"># 4. 计算聚类评估指标</span>
sil_score = silhouette_score(X_scaled, y_pred)
ch_score = calinski_harabasz_score(X_scaled, y_pred)
db_score = davies_bouldin_score(X_scaled, y_pred)
nmi_score = normalized_mutual_info_score(y_true, y_pred)
ari_score = adjusted_rand_score(y_true, y_pred)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Silhouette Score: <span class="hljs-subst">{sil_score:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Calinski-Harabasz Index: <span class="hljs-subst">{ch_score:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Davies-Bouldin Index: <span class="hljs-subst">{db_score:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"NMI (Normalized Mutual Information): <span class="hljs-subst">{nmi_score:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ARI (Adjusted Rand Index): <span class="hljs-subst">{ari_score:<span class="hljs-number">.4</span>f}</span>"</span>)

<span class="hljs-comment"># 5. 可视化聚类结果（使用 PCA 降到 2D）</span>
pca = PCA(n_components=<span class="hljs-number">2</span>)
X_pca = pca.fit_transform(X_scaled)

plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
colors = [<span class="hljs-string">'red'</span>, <span class="hljs-string">'green'</span>, <span class="hljs-string">'blue'</span>]
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):
    plt.scatter(X_pca[y_pred==i, <span class="hljs-number">0</span>], X_pca[y_pred==i, <span class="hljs-number">1</span>], 
                color=colors[i], label=<span class="hljs-string">f'Cluster <span class="hljs-subst">{i}</span>'</span>, alpha=<span class="hljs-number">0.6</span>, edgecolor=<span class="hljs-string">'k'</span>)

<span class="hljs-comment"># 标记真实类别中心</span>
plt.xlabel(<span class="hljs-string">"PCA Component 1"</span>)
plt.ylabel(<span class="hljs-string">"PCA Component 2"</span>)
plt.title(<span class="hljs-string">"KMeans Clustering of Iris Dataset (PCA 2D Visualization)"</span>)
plt.legend()
plt.grid(<span class="hljs-literal">True</span>)
plt.show()
</code></pre>
<p>结果如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/944ecafd791347ea98f2796f2d08a3e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305001&amp;x-signature=AxJxIOlUFLCWQrWhzhvi6tbY17c%3D" alt="" loading="lazy"/></p>
<p>在选择指标的时候，无标签数据使用内部指标如轮廓系数、Calinski-Harabasz、Davies-Bouldin 来评估聚类质量。有标签数据可以使用外部指标 NMI、ARI、FMI，评估聚类结果与真实类别的一致性。</p>
<p>总结一下，聚类评估指标为无监督学习提供了量化工具。从内部指标评估紧密度和分离度，到外部指标衡量与真实标签的一致性，不同指标适用于不同场景。综合使用多种指标可以全面理解聚类效果，帮助选择最佳模型与簇数，从而提升聚类任务的实际应用价值。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[机器学习中都有哪些经典的模型调优方法？]]></title>    <link>https://juejin.cn/post/7600601482691084334</link>    <guid>https://juejin.cn/post/7600601482691084334</guid>    <pubDate>2026-01-29T15:33:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600601482691084334" data-draft-id="7600597995768954889" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="机器学习中都有哪些经典的模型调优方法？"/> <meta itemprop="keywords" content="算法,面试"/> <meta itemprop="datePublished" content="2026-01-29T15:33:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            机器学习中都有哪些经典的模型调优方法？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:33:56.000Z" title="Thu Jan 29 2026 15:33:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn%2F" target="_blank" title="https://aicoting.cn/" ref="nofollow noopener noreferrer">aicoting.cn</a></p>
</blockquote>
<p>模型调优是机器学习中提升模型性能的重要环节，其核心目标是通过优化模型的超参数和结构，使模型在训练数据上学习充分，同时在未见过的数据上具有良好的泛化能力。</p>
<p>调优通常包括 超参数搜索、正则化 和 早停（Early Stopping） 等方法，通过合理的模型调优，不仅可以提升模型预测精度，还能增强其稳定性和鲁棒性，是机器学习实践中不可或缺的一步。</p>
<h2 data-id="heading-0">超参数搜索</h2>
<p>在机器学习模型训练中，超参数（Hyperparameters） 是在训练前设置的参数，它们不会通过训练数据自动学习，而对模型性能有重要影响。例如，决策树的最大深度、随机森林的树数量、支持向量机的正则化系数 C 或核函数参数都是超参数。合理选择超参数是 模型调优 的关键步骤。</p>
<h3 data-id="heading-1">超参数搜索的目标</h3>
<p>超参数搜索的目标是找到一组最优超参数，使模型在验证数据上的性能达到最佳，同时保证良好的泛化能力。不同的超参数组合可能导致模型表现差异很大，因此系统化搜索和评估超参数至关重要。</p>
<h3 data-id="heading-2">常用的超参数搜索方法</h3>
<h4 data-id="heading-3">网格搜索（Grid Search）</h4>
<p>定义：在预设的超参数值网格上进行穷举搜索，训练模型并评估每组组合的性能，选择最佳组合。</p>
<p>特点：</p>
<ul>
<li>优点：简单直观，适合超参数空间较小的情况。</li>
<li>缺点：超参数空间大时计算量非常大。</li>
</ul>
<p>示例：</p>
<ul>
<li>决策树的超参数：max_depth = [3, 5, 7]，min_samples_split = [2, 4, 6]</li>
<li>网格搜索会训练 3 × 3 = 9 个模型，选择验证集性能最优的组合。</li>
</ul>
<h4 data-id="heading-4">随机搜索（Random Search）</h4>
<p>定义：从预设的超参数空间随机抽取若干组合进行训练和评估，而不是穷举所有可能值。</p>
<p>特点：</p>
<ul>
<li>优点：在大空间中比网格搜索更高效，可发现更优解。</li>
<li>缺点：搜索结果有一定随机性，需要设置足够的迭代次数。</li>
</ul>
<p>适用场景：超参数空间维度高且每个超参数可取值众多的情况。</p>
<h4 data-id="heading-5">贝叶斯优化（Bayesian Optimization）</h4>
<p>定义：利用贝叶斯理论构建超参数和模型性能的概率模型，通过最大化性能期望选择下一组超参数。</p>
<p>特点：</p>
<ul>
<li>优点：高效、智能，适合复杂、高维的超参数优化。</li>
<li>缺点：实现相对复杂，需要额外的概率模型支持。</li>
</ul>
<p>应用：适合深度学习模型或计算成本高的机器学习模型超参数调优。</p>
<h3 data-id="heading-6">超参数搜索中的注意事项</h3>
<ol>
<li>选择合理的超参数空间：过大或过小都会影响搜索效率和效果。</li>
<li>结合交叉验证：在每组超参数上进行 k 折交叉验证，可获得更稳定的性能评估。</li>
<li>计算成本：特别是深度学习模型，搜索方法应兼顾精度与训练时间。</li>
<li>并行化加速：网格搜索和随机搜索可以使用多核或分布式训练加速搜索过程。</li>
</ol>
<p>下面我们使用 随机森林在 Iris 数据集上做网格搜索和随机搜索调优超参数，输出最佳参数和评分结果</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要库</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_iris
<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestClassifier
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV, RandomizedSearchCV, train_test_split

<span class="hljs-comment"># 1. 加载数据</span>
iris = load_iris()
X = iris.data
y = iris.target

<span class="hljs-comment"># 2. 划分训练集和测试集</span>
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 3. 定义随机森林模型</span>
rf = RandomForestClassifier(random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># ---------------------------</span>
<span class="hljs-comment"># 网格搜索 Grid Search</span>
<span class="hljs-comment"># ---------------------------</span>
param_grid = {
    <span class="hljs-string">'n_estimators'</span>: [<span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">150</span>],
    <span class="hljs-string">'max_depth'</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>],
    <span class="hljs-string">'min_samples_split'</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>]
}

grid_search = GridSearchCV(rf, param_grid, cv=<span class="hljs-number">5</span>, scoring=<span class="hljs-string">'accuracy'</span>, return_train_score=<span class="hljs-literal">True</span>)
grid_search.fit(X_train, y_train)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Grid Search Best Parameters:"</span>, grid_search.best_params_)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Grid Search Best Score:"</span>, grid_search.best_score_)

<span class="hljs-comment"># 可视化网格搜索结果</span>
results = grid_search.cv_results_
mean_test_scores = results[<span class="hljs-string">'mean_test_score'</span>]
plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(mean_test_scores)), mean_test_scores, marker=<span class="hljs-string">'o'</span>, linestyle=<span class="hljs-string">'-'</span>)
plt.xlabel(<span class="hljs-string">"Parameter Combination Index"</span>)
plt.ylabel(<span class="hljs-string">"Mean CV Accuracy"</span>)
plt.title(<span class="hljs-string">"Grid Search Performance"</span>)
plt.grid(<span class="hljs-literal">True</span>)
plt.show()

<span class="hljs-comment"># ---------------------------</span>
<span class="hljs-comment"># 随机搜索 Random Search</span>
<span class="hljs-comment"># ---------------------------</span>
<span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> randint

param_dist = {
    <span class="hljs-string">'n_estimators'</span>: randint(<span class="hljs-number">50</span>, <span class="hljs-number">200</span>),
    <span class="hljs-string">'max_depth'</span>: randint(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>),
    <span class="hljs-string">'min_samples_split'</span>: randint(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>)
}

random_search = RandomizedSearchCV(rf, param_distributions=param_dist, n_iter=<span class="hljs-number">20</span>, cv=<span class="hljs-number">5</span>, scoring=<span class="hljs-string">'accuracy'</span>, random_state=<span class="hljs-number">42</span>, return_train_score=<span class="hljs-literal">True</span>)
random_search.fit(X_train, y_train)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Random Search Best Parameters:"</span>, random_search.best_params_)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Random Search Best Score:"</span>, random_search.best_score_)

<span class="hljs-comment"># 可视化随机搜索结果</span>
results = random_search.cv_results_
mean_test_scores = results[<span class="hljs-string">'mean_test_score'</span>]
plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(mean_test_scores)), mean_test_scores, marker=<span class="hljs-string">'o'</span>, linestyle=<span class="hljs-string">'-'</span>, color=<span class="hljs-string">'orange'</span>)
plt.xlabel(<span class="hljs-string">"Random Parameter Sample Index"</span>)
plt.ylabel(<span class="hljs-string">"Mean CV Accuracy"</span>)
plt.title(<span class="hljs-string">"Random Search Performance"</span>)
plt.grid(<span class="hljs-literal">True</span>)
plt.show()
</code></pre>
<p>输出如下图所示，x 轴表示不同超参数组合的索引，y 轴为平均交叉验证准确率，网格搜索和随机搜索分别可视化，便于直观比较性能分布。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7e1b8ef0e514872b6cef13b40017e0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305638&amp;x-signature=Z6DdKOLPasEcwRQkPhoV9qoMZ8o%3D" alt="" loading="lazy"/></p>
<p>超参数搜索是提升模型性能的核心环节。通过系统化的方法（网格搜索、随机搜索、贝叶斯优化），结合交叉验证和合理的搜索空间，可以有效找到模型的最优配置，提高预测精度和泛化能力。不同搜索方法适用于不同规模的超参数空间和计算资源，实践中需根据任务需求选择合适策略。</p>
<h2 data-id="heading-7">正则化</h2>
<p>在机器学习中，模型的目标是通过训练数据学习规律，以便对未知数据进行准确预测。然而，复杂模型容易在训练数据上表现过好，但在新数据上表现不佳，这种现象称为 过拟合（Overfitting）。为了解决过拟合问题，提高模型的泛化能力，引入了 正则化（Regularization） 技术。</p>
<h3 data-id="heading-8">正则化的核心思想</h3>
<p>正则化通过在损失函数中加入对模型复杂度的惩罚项，使模型在追求预测准确性的同时，避免参数过大或模型过于复杂。</p>
<p>通用形式的正则化损失函数：J(θ)=L(θ)+λ⋅Ω(θ)</p>
<ul>
<li>L(θ)：原始损失函数（如均方误差 MSE、交叉熵 CE）</li>
<li>Ω(θ)：正则化项，用于约束模型复杂度</li>
<li>λ：正则化强度系数，控制惩罚力度</li>
</ul>
<h3 data-id="heading-9">常见正则化方法</h3>
<h4 data-id="heading-10">L1 正则化（Lasso）</h4>
<p>L1正则化的定义是在损失函数中加入模型权重的绝对值和：Ω(θ)=∑i|θi|</p>
<p>可以产生稀疏模型（部分权重为 0），实现 特征选择，并且对异常值不敏感，常用于线性回归和逻辑回归。 应用示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> Lasso
model = Lasso(alpha=<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># alpha 控制正则化强度</span>
model.fit(X_train, y_train)
</code></pre>
<h4 data-id="heading-11">L2 正则化（Ridge）</h4>
<p>L2正则化在损失函数中加入模型权重的平方和：Ω(θ)=∑iθi2</p>
<p>惩罚大权重，使模型权重分布均衡，不会产生稀疏模型，常用于线性回归、逻辑回归及神经网络权重约束。</p>
<p>应用示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> Ridge
model = Ridge(alpha=<span class="hljs-number">1.0</span>)
model.fit(X_train, y_train)
</code></pre>
<h4 data-id="heading-12">Elastic Net（L1 + L2 结合）</h4>
<p>Elastic Net结合了 L1 和 L2 正则化的优点：</p>
<p>Ω(θ)=λ1∑i|θi|+λ2∑iθi2</p>
<p>同时实现特征选择和权重约束，在高维稀疏数据中表现更好。</p>
<p>应用示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> ElasticNet
model = ElasticNet(alpha=<span class="hljs-number">0.1</span>, l1_ratio=<span class="hljs-number">0.5</span>)
model.fit(X_train, y_train)
</code></pre>
<h4 data-id="heading-13">Dropout（神经网络特有）</h4>
<p>Dropout在训练神经网络时，随机“丢弃”部分神经元，使网络不依赖单一特征，防止神经网络过拟合，可理解为训练多个子网络的集成。</p>
<p>应用示例（PyTorch）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
dropout_layer = nn.Dropout(p=<span class="hljs-number">0.5</span>)  <span class="hljs-comment"># 训练时随机丢弃50%神经元</span>
</code></pre>
<h3 data-id="heading-14">正则化的效果与选择</h3>
<p>控制模型复杂度：正则化限制了参数幅度，使模型不过分拟合训练数据。</p>
<p>提高泛化能力：通过减少过拟合，使模型在新数据上表现更稳定。</p>
<p>选择方法：</p>
<ul>
<li>高维稀疏数据：优先 L1 或 Elastic Net。</li>
<li>普通回归或神经网络：L2 或 Dropout 更适合。</li>
</ul>
<p>调节强度：正则化系数 λ 是关键参数，可通过 网格搜索或随机搜索 调优。</p>
<p>正则化是机器学习模型优化的重要手段，通过对模型复杂度的约束，有效缓解过拟合问题，提高模型泛化能力。不同方法（L1、L2、Elastic Net、Dropout）适用于不同模型和场景，结合超参数搜索可以找到最优正则化策略，从而提升预测精度和稳定性。</p>
<h3 data-id="heading-15">Early Stopping</h3>
<p>在机器学习和深度学习训练过程中，模型往往会经历一个从欠拟合到过拟合的过程。Early Stopping（早停） 是一种常用的正则化技术，它通过在训练过程中监控模型在验证集上的性能，提前停止训练，从而防止过拟合，提高模型的泛化能力。</p>
<p>Early Stopping 的基本思想是：</p>
<ol>
<li>在每个训练轮（epoch）结束后，计算模型在验证集上的性能指标（如验证损失或准确率）。</li>
<li>当验证集性能在连续若干轮没有改善时，停止训练，并使用性能最优的模型参数作为最终模型。</li>
</ol>
<p>这样可以避免模型在训练集上继续优化而导致在未见过数据上性能下降的情况。</p>
<p>Early Stopping 的实现要素包括三个方面：</p>
<ol>
<li>监控指标（Monitor Metric）</li>
</ol>
<ul>
<li>通常选择验证集的损失（loss）或准确率（accuracy）作为监控指标。</li>
<li>对于回归任务，一般监控验证损失；对于分类任务，可监控验证损失或准确率。</li>
</ul>
<ol start="2">
<li>耐心值（Patience）</li>
</ol>
<ul>
<li>指模型在连续若干轮（epoch）没有提升时，才触发早停。</li>
<li>避免因偶然波动过早停止训练。</li>
</ul>
<ol start="3">
<li>最优模型保存</li>
</ol>
<ul>
<li>在训练过程中，保存验证集性能最优的模型参数，训练结束后加载该参数作为最终模型。</li>
</ul>
<p>Early Stopping 可以防止过拟合，当模型在验证集性能不再提升时停止训练，避免在训练集上过度拟合。并且不必训练到预设的最大轮次，尤其在深度学习中可以显著节省计算资源。同时保留验证集性能最优的参数，提高模型在未见过数据上的表现。</p>
<p>下面我们通过一段示例代码看一下early stopping的使用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Sequential
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dense
<span class="hljs-keyword">from</span> tensorflow.keras.callbacks <span class="hljs-keyword">import</span> EarlyStopping
<span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_iris
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> OneHotEncoder, StandardScaler

<span class="hljs-comment"># 1. 加载数据</span>
iris = load_iris()
X = iris.data
y = iris.target.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)

<span class="hljs-comment"># 独热编码</span>
encoder = OneHotEncoder(sparse=<span class="hljs-literal">False</span>)
y_encoded = encoder.fit_transform(y)

<span class="hljs-comment"># 数据标准化</span>
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

<span class="hljs-comment"># 划分训练集和验证集</span>
X_train, X_val, y_train, y_val = train_test_split(X_scaled, y_encoded, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 2. 构建简单神经网络</span>
model = Sequential([
    Dense(<span class="hljs-number">16</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(X_train.shape[<span class="hljs-number">1</span>],)),
    Dense(<span class="hljs-number">16</span>, activation=<span class="hljs-string">'relu'</span>),
    Dense(y_encoded.shape[<span class="hljs-number">1</span>], activation=<span class="hljs-string">'softmax'</span>)
])

model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'categorical_crossentropy'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])

<span class="hljs-comment"># 3. 设置 Early Stopping</span>
early_stop = EarlyStopping(monitor=<span class="hljs-string">'val_loss'</span>, patience=<span class="hljs-number">10</span>, restore_best_weights=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 4. 模型训练</span>
history = model.fit(
    X_train, y_train,
    validation_data=(X_val, y_val),
    epochs=<span class="hljs-number">100</span>,
    batch_size=<span class="hljs-number">16</span>,
    callbacks=[early_stop],
    verbose=<span class="hljs-number">1</span>
)

<span class="hljs-comment"># 5. 可视化训练过程</span>
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.plot(history.history[<span class="hljs-string">'loss'</span>], label=<span class="hljs-string">'Train Loss'</span>)
plt.plot(history.history[<span class="hljs-string">'val_loss'</span>], label=<span class="hljs-string">'Validation Loss'</span>)
plt.xlabel(<span class="hljs-string">'Epoch'</span>)
plt.ylabel(<span class="hljs-string">'Loss'</span>)
plt.title(<span class="hljs-string">'Training and Validation Loss with Early Stopping'</span>)
plt.legend()
plt.show()
</code></pre>
<p>其中使用 EarlyStopping 回调函数监控验证损失 val_loss。patience=10 表示如果验证损失连续 10 个 epoch 不再下降，则停止训练。</p>
<p>restore_best_weights=True 表示训练结束后，恢复验证集上性能最优的模型参数。</p>
<p>训练损失和验证损失如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d29b0df6aa140c6ac0fdd39e69a13bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305638&amp;x-signature=NWAlbemkCvf9K8s7%2Fk%2Fg5Cd6zgw%3D" alt="" loading="lazy"/></p>
<p>Early Stopping 是一种简单有效的正则化方法，通过在训练过程中监控验证集性能，提前停止训练，防止过拟合并节省计算资源。在深度学习和梯度提升模型中尤为常用，与其他正则化方法（如 L1/L2、Dropout）结合使用，可以显著提升模型的泛化能力和训练效率。</p>
<p>最新的文章都在aicoting公众号更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker 部署 PicGo：一次配置,随处使用]]></title>    <link>https://juejin.cn/post/7600622206268964874</link>    <guid>https://juejin.cn/post/7600622206268964874</guid>    <pubDate>2026-01-29T15:35:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206268964874" data-draft-id="7600628279215751194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker 部署 PicGo：一次配置,随处使用"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-29T15:35:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker 部署 PicGo：一次配置,随处使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:35:20.000Z" title="Thu Jan 29 2026 15:35:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>简介：通过Docker部署PicGo Server版，实现一次配置、随处可用的高效图片管理方案。本文详细介绍了从构建自定义镜像到启动容器的完整流程，涵盖插件安装、图床配置等关键步骤，并特别提醒了安全注意事项。这一部署方式解决了多设备间配置不同步的痛点，让用户在公司、家庭等多场景下都能使用统一的图床服务，真正做到上传记录集中管理、配置云端同步。无论是个人创作者还是团队协作，都能通过Docker化部署获得更灵活、稳定的图片上传体验。</p>
</blockquote>
<p>在前面的文章中，我们详细介绍了 PicGo 的各种强大功能。不过，许多用户在实际使用中会遇到一个共同的痛点：每台电脑都需要单独配置，对于经常在多台设备间切换的用户来说，确实不够方便。</p>
<p>今天，我将分享如何通过 Docker 在服务器上部署 PicGo 的 Server 版本，实现“一次配置，随处上传”，彻底解决多设备同步难题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3755ed52d03c4adab6e9cd9af40ab70b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=PIiFWJK40NAwWKnz0hX6Cnm4B6M%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">🐳 Docker 部署实战</h2>
<h3 data-id="heading-1">🛠️ 构建自定义镜像</h3>
<p>我选择 <code>node:22.11.0-alpine</code> 作为基础镜像进行构建，以下为完整的 Dockerfile 内容：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用轻量级 Node.js 镜像</span>
FROM node:22.11.0-alpine
<span class="hljs-comment"># 维护者信息</span>
LABEL maintainer=<span class="hljs-string">"xj"</span>
<span class="hljs-comment"># 全局安装 PicGo</span>
RUN npm install picgo -g
<span class="hljs-comment"># 暴露容器 HTTP 端口</span>
EXPOSE 36677
<span class="hljs-comment"># 设置容器启动命令</span>
CMD [<span class="hljs-string">"picgo"</span>, <span class="hljs-string">"server"</span>, <span class="hljs-string">"--host"</span>, <span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-string">"--port"</span>, <span class="hljs-string">"36677"</span>]
</code></pre>
<p>构建镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t xj/picgo:2.0.0 .
</code></pre>
<p>镜像构建完成后，我已将其上传至阿里云镜像仓库。你也可以直接使用该镜像：<br/>
<code>registry.cn-hangzhou.aliyuncs.com/xjpublic/picgo:2.0.0</code></p>
<h3 data-id="heading-2">⚙️ 启动容器</h3>
<p>创建 <code>docker-compose.yml</code> 文件，内容如下：</p>
<pre><code class="hljs language-bash" lang="bash">services:
  picgo:
    <span class="hljs-comment"># 可替换为阿里云镜像：registry.cn-hangzhou.aliyuncs.com/xjpublic/picgo:2.0.0</span>
    image: xj/picgo:2.0.0
    container_name: picgo
    restart: unless-stopped
    ports:
      - <span class="hljs-string">"36677:36677"</span>
    volumes:
      - ./data:/root/.picgo  <span class="hljs-comment"># 挂载配置文件、插件等数据</span>
</code></pre>
<p>在 <code>docker-compose.yml</code> 同级目录下执行以下命令启动容器：</p>
<pre><code class="hljs">docker-compose up -d
</code></pre>
<p>至此，PicGo 服务已成功启动。</p>
<h3 data-id="heading-3">🧩 插件下载与配置</h3>
<p>服务启动后，我们需要进入容器内部下载并配置插件。执行以下命令进入容器：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it &lt;container_id&gt; /bin/sh
</code></pre>
<p>使用 <code>picgo -v</code> 查看 PicGo 版本，也可通过 <code>picgo help</code> 查看更多命令用法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b7490b504cd4ead8417698ccdcf238f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=hisEgl79bKrrmhKkXUFIQOMDF6g%3D" alt="" loading="lazy"/></p>
<p>以我使用的 Chevereto 图床为例，我下载了两个插件：Chevereto 上传插件和文件重命名插件 <code>hashname</code>。具体操作如下：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 下载 Chevereto 插件</span>
picgo install chevereto
<span class="hljs-comment"># 选择插件</span>
picgo <span class="hljs-keyword">use</span> plugins
<span class="hljs-comment"># 设置上传器为 Chevereto</span>
picgo set uploader chevereto
<span class="hljs-comment"># 将 Chevereto 设为主图床</span>
picgo <span class="hljs-keyword">use</span> uploader chevereto
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b212e7fba34815a3f21c1dcb6f5b4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=XidqP0HMRg6uUdv83Ye9y%2FPUci0%3D" alt="" loading="lazy"/></p>
<p>配置完成后，重启容器以使配置生效：</p>
<pre><code class="hljs">docker-compose restart
</code></pre>
<p>现在，你就可以在 Postman 或其他第三方工具中，通过配置 PicGo 服务地址来使用图床功能了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1588e8db61384b9398ca8bbd47c3ef71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=yDcSzjg2%2FYkNAILd3RzEqi2qj6o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fa6a63e7144babbd8a746ec7ae1dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=Wf%2Foo4Iy4MJZ%2BQYsjj6cPuuQnDs%3D" alt="" loading="lazy"/></p>
<p>若需启用文件重命名功能，可配置 <code>hashname</code> 插件：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 下载 Hashname 插件</span>
picgo install hashname
<span class="hljs-comment"># 启用插件作为 Transformer</span>
picgo <span class="hljs-keyword">use</span> transformer hashname
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de6c235e297948e3a7b2f12328072ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=Uv2TF64MCkdMVBYEpl9TVzLWIbY%3D" alt="" loading="lazy"/></p>
<p>至此，基于 Docker 的 PicGo 服务部署与基础配置已全部完成。</p>
<h2 data-id="heading-4">🚨 安全注意事项</h2>
<ol>
<li>1. <strong>请勿在公网直接暴露服务</strong>：除非仅用于临时测试，否则务必配置身份验证。</li>
<li>2. <strong>定期更新镜像</strong>：确保获得最新的安全修复与功能优化。</li>
<li>3. <strong>限制访问 IP</strong>：若仅在内部网络使用，建议设置 IP 白名单。</li>
<li>4. <strong>定期备份配置</strong>：避免因意外导致配置丢失。</li>
</ol>
<h2 data-id="heading-5">🎉 总结</h2>
<p>通过 Docker 部署 PicGo Server 版，我们彻底解决了多设备配置同步的痛点。现在，无论是在公司的办公电脑，还是家里的个人笔记本，只需访问统一的 PicGo 服务地址，即可实现：</p>
<ul>
<li>• <strong>统一配置</strong>：所有设备共用一套图床与插件设置。</li>
<li>• <strong>集中管理</strong>：上传历史与图片库集中存储，便于查找与管理。</li>
</ul>
<p>无论是个人创作还是团队协作，Docker 化部署让 PicGo 的使用变得更加灵活、稳定与高效。现在就动手部署属于你自己的 PicGo 服务吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[远程Ubuntu部署deb包]]></title>    <link>https://juejin.cn/post/7600607462584664099</link>    <guid>https://juejin.cn/post/7600607462584664099</guid>    <pubDate>2026-01-29T15:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600607462584664099" data-draft-id="7600607462584631331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="远程Ubuntu部署deb包"/> <meta itemprop="keywords" content="Ubuntu"/> <meta itemprop="datePublished" content="2026-01-29T15:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节逆旅"/> <meta itemprop="url" content="https://juejin.cn/user/2471357871561214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            远程Ubuntu部署deb包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2471357871561214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节逆旅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:39:19.000Z" title="Thu Jan 29 2026 15:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你的前端应用deb包部署在远程Ubuntu环境， 掌握如何远程部署及监控状态在特殊情况下还是很必要的。</p>
<hr/>
<h2 data-id="heading-0">一、 软件包的安装：从报错到成功</h2>
<h3 data-id="heading-1">1. 基础安装命令</h3>
<p>在远程终端，推荐使用 <code>apt</code> 而非 <code>dpkg</code>，因为 <code>apt</code> 会自动处理依赖。</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt update &amp;&amp; sudo apt install ./your_package.deb

</code></pre>
<h3 data-id="heading-2">2. 常见坑点：404 错误</h3>
<p>按上面的指令执行一般没啥问题，不过由于有的包在安装过程中会下载相关依赖，可能会报错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb8afe167ac49029d6c6eb6d457fed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6YCG5peF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305958&amp;x-signature=jymWjgkYiuayB0XfvDaNqZR9zGw%3D" alt="" loading="lazy"/></p>
<p>比如： 这里提示 <code>Failed to fetch... 404 Not Found</code>。
<strong>原因：</strong> 你的本地包索引太旧，系统找不到对应的远程依赖文件。</p>
<p><strong>解决方法：</strong></p>
<ul>
<li>先执行 <code>sudo apt update</code> 更新索引。</li>
<li>再执行 <code>sudo apt --fix-broken install</code> 修复缺失的依赖。</li>
</ul>
<hr/>
<p>修复后再执行上面安装包的命令就可以正常安装了。</p>
<h2 data-id="heading-3">二、 桌面图标：如何保证安装后能被“发现”</h2>
<p>安装完包不代表桌面就一定会有图标。Linux 的桌面图标依赖于 <code>.desktop</code> 文件。</p>
<h3 data-id="heading-4">1. 自动发现</h3>
<p>标准的 <code>.deb</code> 包会将快捷方式存放在 <code>/usr/share/applications/</code>。你可以通过命令检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> /usr/share/applications/ | grep -i linuxApp

</code></pre>
<p>如果能搜到类似 <code>linuxApp.desktop</code>的结果，那恭喜你，在 Ubuntu 桌面按下 <code>Super</code> 键（Windows键）搜索即可找到。</p>
<h3 data-id="heading-5">2. 将应用图标发送到桌面</h3>
<p>如果你想把这个应用的快捷启动图标放到桌面也是可以的。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> /usr/share/applications/linuxApp.desktop ~/Desktop/
<span class="hljs-built_in">chmod</span> +x ~/Desktop/linuxApp.desktop
</code></pre>
<p>不过不要忘记你现在是用xshell在远程操作，所以继续往下走，看怎么实现"盲开应用"。</p>
<h3 data-id="heading-6">2. 获取启动“真名”</h3>
<p>如果你要在命令行启动它，必须查出它背后的执行命令要用到的“真名”，执行这条命令：</p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"Exec"</span> /usr/share/applications/linuxApp.desktop

</code></pre>
<p>你会得到类似 <code>Exec=linux-myApp</code> 的结果，这才是你要用的“启动真名”，后面的操作都会用到这个名字。</p>
<hr/>
<h2 data-id="heading-7">三、 远程启动：如何实现“永不挂断”</h2>
<p>既然已经找到了应用真名，可以用Xshell启动吗？答案是可以的。可如果你直接在 Xshell 里输入命令启动，当前这个窗口关掉后，程序就挂了。所以得用远程持久开启的方案。</p>
<h3 data-id="heading-8">持久化启动</h3>
<p>使用 <code>nohup</code> 命令，让程序脱离 Xshell 会话运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nohup</span> linux-myApp --no-sandbox &gt; /dev/null 2&gt;&amp;1 &amp;

</code></pre>
<p>我来解释一下这些命令的含义：</p>
<ul>
<li><strong><code>nohup</code></strong>：关掉 Xshell，程序不挂断。</li>
<li><strong><code>--no-sandbox</code></strong>：解决远程环境下 Electron 程序的权限报错。</li>
<li><strong><code>&gt; /dev/null 2&gt;&amp;1</code></strong>：丢弃日志，保持终端整洁。</li>
<li><strong><code>&amp;</code></strong>：让程序在后台飞一会儿。</li>
</ul>
<p>也就是说，执行这条命令后，你可以放心地把xshell关闭了，应用不会关闭。</p>
<hr/>
<h2 data-id="heading-9">四、 状态监控：如何知道它是正常的还是“白屏”状态？</h2>
<p>到这一步还没有结束！由于是远程状态，在看不到屏幕的情况下，我如何知道应用程序是否活得好好的呢？你得找到应用进程然后再查它的状态，也可以查它的后台日志，linux都为你准备好了。</p>
<h3 data-id="heading-10">1. 确认进程状态</h3>
<pre><code class="hljs language-bash" lang="bash">ps -ef | grep linux-myApp

</code></pre>
<p>这个命令会输出应用的进程ID、应用名称、PPID等信息；注意看进程信息中的 PPID（第二列数字）是 1。这代表该程序的父进程是系统守护进程，而不是你的 Xshell 会话。</p>
<h3 data-id="heading-11">2. 确认是否卡死</h3>
<p>使用 <code>top</code> 命令监控实时占用：</p>
<pre><code class="hljs language-bash" lang="bash">top -p [进程PID]

</code></pre>
<p>这一步会输出多条数据，可以录个屏确认一下当时的状态。可以根据以下状态分类来判断应用的运行状态：</p>
<ul>
<li><strong>正常</strong>：CPU 有小幅跳动，内存（RES）稳定。</li>
<li><strong>异常（白屏或卡死）</strong>：CPU 长期 0% 或持续 100%。</li>
<li><strong>退出小贴士</strong>：在 <code>top</code> 界面按 <strong><code>q</code></strong> 即可退出。</li>
</ul>
<h3 data-id="heading-12">3. 查看后台日志</h3>
<p>如果还是不放心，直接看软件的“心跳”记录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -f ~/.config/linux-myApp/logs/main.log

</code></pre>
<p>到这里，基本上你的这次远程盲操部署算是圆满成功了，晚上可以给自己加鸡腿了！</p>
<hr/>
<h2 data-id="heading-13">💡 总结建议</h2>
<p>想成为 Ubuntu 玩家，都得记住这套公式：<strong><code>apt install</code> 安装 -&gt; <code>grep Exec</code> 找应用真名 -&gt; <code>nohup</code> 启动 -&gt; <code>top</code> 找到进程ID后看状态。</strong></p>
<p>希望对你有用！</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1分钟轻松玩转AI | 规范驱动开发]]></title>    <link>https://juejin.cn/post/7600629210156007430</link>    <guid>https://juejin.cn/post/7600629210156007430</guid>    <pubDate>2026-01-29T15:51:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600629210156007430" data-draft-id="7600606150733037611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1分钟轻松玩转AI | 规范驱动开发"/> <meta itemprop="keywords" content="后端,Java,AI编程"/> <meta itemprop="datePublished" content="2026-01-29T15:51:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mars酱"/> <meta itemprop="url" content="https://juejin.cn/user/1714893869821278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1分钟轻松玩转AI | 规范驱动开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893869821278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mars酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:51:10.000Z" title="Thu Jan 29 2026 15:51:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：Mars酱</p>
<p>声明：本文章由Mars酱原创，部分内容来源于网络，如有疑问请联系本人。</p>
<p>转载：欢迎转载，转载前先请联系我！</p>
</blockquote>
<h2 data-id="heading-0">为什么我们需要“规范”？</h2>
<p>想象一个场景：两支篮球队比赛，队员都穿着自己觉得舒服的衣服上场。结果会怎样？传球时可能把对手误认为队友，配合变得混乱，甚至不敢传球，最终演变成各自为战，战术彻底失效。</p>
<p><strong>软件开发亦是如此</strong>，尤其是在与AI协作时。我们常常发现，AI并不能完全理解我们模糊的需求描述，反而会基于自己的“猜测”去生成代码——这就是所谓的“AI幻觉”。这种不确定性，让AI生成的代码质量难以保证，后期维护成本剧增。</p>
<p><strong>解决方案就是：引入“规范”</strong>。\ 这个规范，是用来明确告诉AI：<strong>要做什么、怎么做、用什么数据格式、遵循什么编码风格</strong>。而实现这一理念的工具，正是 <strong>OpenSpec</strong>。</p>
<blockquote>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFission-AI%2FOpenSpec" target="_blank" title="https://github.com/Fission-AI/OpenSpec" ref="nofollow noopener noreferrer">github.com/Fission-AI/…</a></p>
</blockquote>
<h2 data-id="heading-1">OpenSpec可以让AI“照图施工”</h2>
<p>OpenSpec 的核心思想很简单：<strong>先画草图，确认无误，再正式施工</strong>。</p>
<p>它在人与AI之间建立了一套标准化的协作流程：</p>
<ol>
<li><strong>写成规范文档</strong>：将需求、场景、数据结构等明确下来。</li>
<li><strong>人机达成共识</strong>：开发者审查并批准AI提出的实现方案。</li>
<li><strong>按规范实现</strong>：AI严格依据批准的规范生成代码。</li>
<li><strong>留下完整记录</strong>：所有决策和变更都有据可查，便于追溯。</li>
</ol>
<p>这不仅提升了代码的可靠性，也让整个开发过程变得透明、可控。</p>
<h2 data-id="heading-2">快速上手 OpenSpec</h2>
<h3 data-id="heading-3">安装准备</h3>
<p>确保你的系统已安装 <strong>Node.js（版本 &gt;= 20.19.0）</strong>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看node版本，如果没有安装，需要自行安装node</span>
node --version

</code></pre>
<p>接着，全局安装 OpenSpec CLI：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装OpenSpec</span>
npm install -g @fission-ai/openspec@latest
</code></pre>
<blockquote>
<p><strong>提示</strong>：部分系统（如 macOS）可能需要重启终端才能使新命令生效。安装完成后，可通过 <code>openspec --version</code> 验证。</p>
</blockquote>
<p>安装好之后，可能需要关闭命令行窗口，重新打开才会生效，也可能不用，我的mac是需要关闭才能生效的，最后使用查看版本的命令，来验证是否安装成功。</p>
<pre><code class="hljs language-bash" lang="bash">openspec --version
</code></pre>
<h3 data-id="heading-4">在新项目中使用</h3>
<p>新建一个工程，类似这样：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/297612c53d0d42488ea48fa908a0fec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=m3L%2BzVG%2FboO%2FXJlb52m4VcIGNtw%3D" alt="" loading="lazy"/></p>
<p>然后在idea的命令行工具里面输入：</p>
<pre><code class="hljs language-bash" lang="bash">openspec init
</code></pre>
<p>你会看到类似这样的提示：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bca4f1d174eb41cab7c72dbb26f0e2f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=sYpu%2FgCoQGpmyxHhNunyB3y%2F810%3D" alt="" loading="lazy"/></p>
<p>按下回车进入下一个画面：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c3f6905cfa540b69b732cf63c4a1c25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=U8oI9uSGB3%2B5bhxyvTGsPB4q%2Bcw%3D" alt="" loading="lazy"/></p>
<p>这个页面是让你选择在电脑中使用的AI编码工具是什么，多数人应该用的是Claude Code，我用的IFlow，这是个免费开源的国产工具，所以我就输入‘iFlow’</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d0c1bd4e1ee4e029dcd6bdd8105bccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=0IDNPfxgTe5xZcmXT8XaKnprb%2Bs%3D" alt="" loading="lazy"/></p>
<p>选中iFlow后会高亮，然后按Tab键确认选择，确认之后openspec就开始初始化了，会在工程中生成两个文件夹，一个是.iflow，一个是openspec，iflow里面是这样的：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d23e97b48acf478a97139a309b11ca16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=DeHvfrr6%2FyOzAtD2mU4mtTd%2FjcU%3D" alt="" loading="lazy"/></p>
<p>这些看看就好了，大致这些东西都是openspec为增强iFlow功能的，另外一个是openspec，结构这个样子：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efae5dcfa75843999d94e57ad5ae08eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=M9YSgK2geaI6l7a4N67QETQksL8%3D" alt="" loading="lazy"/></p>
<p>changes里面都是变更提案，specs里面都是规范文档，现在刚刚初始化，所以这里面是空的。</p>
<p>我们打开iFlow，进入之后给它提示词，这一步的作用尽可能的描述清楚，最好大概包括这些内容：</p>
<ul>
<li>项目用途</li>
<li>技术栈</li>
<li>代码规范</li>
<li>领域知识</li>
<li>约束条件</li>
</ul>
<p>我的提示词这么写的：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5be78797f06475b84a8f4b9ec84e5b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=kPF1mUkyErmx10koHBACUXZWH0c%3D" alt="" loading="lazy"/></p>
<p>写到project.md中作用是遵循openspec的约定规范，这样是让AI充分理解你的项目背景。回车之后等待一会，代码就会写好，然后生成project.md文件，类似如下：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9279c6518a194b08b1e37342960eb54f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=U6T2qG7ZbyS50dIPhC0E3LP326o%3D" alt="" loading="lazy"/></p>
<p>把这个工程的大致作用都描述清楚了，后续就方便AI理解整个工程，当然在搭建这个工程的时候，最好按照约定好的全部描述清晰完成，越细致越好。</p>
<h3 data-id="heading-5">在已有的项目中迭代</h3>
<p>工程建立好之后，后续就会有各种功能的变更和迭代了，假设我们要为项目“添加一个自定义专注时长的功能”。</p>
<ol>
<li>在 AI 工具（如 iFlow）中输入你的需求：</li>
</ol>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76799d66ecaf4b439b26887ce21e642d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=Fjzodyw%2FTEd19a0mJitEryYVFc4%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>AI 不会立刻写代码，而是会主动提问以澄清细节（如：“单位是分钟还是秒？”、“是否需要保存用户上次设置？”）：</li>
</ol>
<p>我的回答类似这样：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02fbc122486e46cd8c7e1d3414865064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=ltWpSA%2BJzIHKlcoxbwZPHbH5ik8%3D" alt="" loading="lazy"/></p>
<p>确认无误后，执行提案：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0870a39bd1f34f4eb829e204203e4115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=7pSLDOdy%2BbXzXp%2F%2F9vyaQZWVgoI%3D" alt="" loading="lazy"/></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25b4d1dc893340e482fc997ae4a0093c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=lwlH5dJOC2tyJfZCsmrmVtz1DF4%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>你回答后，AI 会生成一份<strong>变更提案</strong>（Change Proposal），并自动存入 <code>openspec/changes/</code> 目录下，包含：</li>
</ol>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/820c7950524048fd9c94ae739a9356ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=VSIU%2B417N1Bh2HsdQokERQ5ZFZw%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">-</span> 一个 <span class="hljs-code">`.yaml`</span> 文件：机器可读的配置。
<span class="hljs-bullet">-</span> 一个 <span class="hljs-code">`.md`</span> 文件：人类可读的需求说明。
</code></pre>
<p>到这里，我们的规范就制作完成了，我们可以通过openspec的命令来审核和检查这个规范是不是可以被AI执行，在命令行工具里面输入命令（不是iFlow对话框），如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看活跃的变更，这里会列出变更单名字</span>
openspec list

<span class="hljs-comment"># 验证提案格式</span>
openspec validate add-custom-interval

<span class="hljs-comment"># 查看提案详情</span>
openspec show add-custom-interval

</code></pre>
<p>到这里，我们制作完了一个新增功能的规范，这个规范是可以让AI直接执行的，我们也可以继续添加其他功能的规范，待我们的需求全部提完，再一并执行也可以，这里我们直接执行这个规范。我们在iFlow的命令行里面输入：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30a9c323b61a4eed88aa16d017b0de3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=5praga7TeapXwl7Silw8BBmg2r8%3D" alt="" loading="lazy"/></p>
<p>按回车之后，就开始执行了</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7812d62a099045c39311cd6ad3c04b71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=6eJY1NF4bhplFE7JXBHyqWmVyvg%3D" alt="" loading="lazy"/></p>
<p>执行完毕之后，会提示完成。至此，规范驱动AI成功完成了编码，执行之后成功输出内容：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/216033430e4444629c7e9e635462cd41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=8vqWjYPzrzyOZ99lk2MKc0hovjA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">归档与沉淀</h3>
<p>功能开发完成后，别忘了归档，以便更新项目整体规范：<strong>s</strong>编辑</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 应用提案</span>
openspec apply add-custom-focus-duration
</code></pre>
<p>或者在iFlow中执行：</p>
<pre><code class="hljs language-bash" lang="bash">/openspec:archive add-custom-interval
</code></pre>
<p>归档后，该功能的规范会被合并到主规范中，成为项目知识库的一部分，为后续开发提供坚实基础。</p>
<p>回车之后等待一会得到结果如下：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6224e4a46c0c4ab4ad5d819e9b3a9788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=j%2FrlKSSojTCyZhvqJXijnE31dVM%3D" alt="" loading="lazy"/></p>
<p>在通过几个确认之后，iFlow就开始给你执行，执行完毕之后如下</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b127f88368904b7d9f7cb241d6642bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770306906&amp;x-signature=yCiNvpnAaldlPzTgY5i1WQjpsKg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">总结：四步工作流，高效又安心</h3>
<p>使用 OpenSpec 进行规范驱动开发，只需记住这四个核心步骤：</p>
<ol>
<li><strong>创建提案</strong>：<code>openspec new "你的功能名称"</code></li>
<li><strong>审查验证</strong>：<code>openspec validate &lt;提案目录&gt;</code></li>
<li><strong>执行实现</strong>：<code>openspec apply &lt;提案目录&gt;</code></li>
<li><strong>归档沉淀</strong>：<code>openspec archive &lt;提案目录&gt;</code></li>
</ol>
<p><strong>AI 正在深刻改变软件开发，但它并非万能。它需要清晰的指令，更需要人类的引导。<strong>OpenSpec 的目标，就是让</strong>人与AI的协作变得更高效、更可靠、更可持续</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[10分钟带你用Three.js手搓一个3D世界，代码少得离谱！]]></title>    <link>https://juejin.cn/post/7600607462584434723</link>    <guid>https://juejin.cn/post/7600607462584434723</guid>    <pubDate>2026-01-29T14:14:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600607462584434723" data-draft-id="7599963665040048178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="10分钟带你用Three.js手搓一个3D世界，代码少得离谱！"/> <meta itemprop="keywords" content="JavaScript,three.js,WebGL"/> <meta itemprop="datePublished" content="2026-01-29T14:14:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            10分钟带你用Three.js手搓一个3D世界，代码少得离谱！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:14:42.000Z" title="Thu Jan 29 2026 14:14:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎬 核心概念：上帝的“片场”</h2>
<p>在 Three.js 的世界里，想要画面动起来，你只需要凑齐这“四大金刚”：</p>
<h3 data-id="heading-1">1. 场景 (Scene) —— 你的片场</h3>
<p>想象你是一个导演，首先你得有个场地。在 Three.js 里，<code>Scene</code> 就是这个场地。它是一个容器，用来放置所有的物体、灯光和摄像机。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>(); <span class="hljs-comment">//（这就开辟了一个场地）</span>
</code></pre>
<h3 data-id="heading-2">2. 摄像机 (Camera) —— 你的眼睛</h3>
<p>片场有了，观众怎么看？得架摄像机。
Three.js 里最常用的是 <strong>透视摄像机 (PerspectiveCamera)</strong>。
这就好比人的眼睛，<strong>近大远小</strong>。</p>
<ul>
<li>你需要告诉它：
<ul>
<li><strong>视角 (FOV)</strong>：镜头是广角还是长焦？</li>
<li><strong>长宽比 (Aspect)</strong>：电影是 16:9 还是 4:3？</li>
<li><strong>近剪切面 &amp; 远剪切面</strong>：太近看不见，太远也看不见。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">3. 渲染器 (Renderer) —— 你的放映机</h3>
<p>场景布置好了，摄像机架好了，谁把画面画到屏幕（Canvas）上？这就是渲染器的工作。它负责计算每一帧画面，把 3D 的数据“拍扁”成 2D 的像素点显示在网页上。</p>
<h3 data-id="heading-4">4. 网格 (Mesh) —— 你的演员 🕺</h3>
<p>这是最关键的部分！片场不能是空的，得有东西。在 Three.js 里，一个可见的物体通常被称为 <strong>Mesh (网格)</strong>。
一个 Mesh 由两部分组成（缺一不可）：</p>
<ul>
<li><strong>几何体 (Geometry)</strong>：<strong>演员的身材</strong>。是方的？圆的？还是复杂的角色模型？（比如 <code>BoxGeometry</code> 就是个立方体骨架）。</li>
<li><strong>材质 (Material)</strong>：<strong>演员的衣服</strong>。是金属质感？塑料质感？还是发光的？什么颜色？（比如 <code>MeshPhongMaterial</code> 就是一种这就好比给骨架穿上了皮肤）。</li>
</ul>
<hr/>
<h2 data-id="heading-5">⚡️ 实战：3分钟手搓一个旋转立方体</h2>
<p>别眨眼，核心代码真的少得离谱。我们来把上面的概念串起来：</p>
<h3 data-id="heading-6">第一步：搭建舞台（初始化）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 创建场景</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();

<span class="hljs-comment">// 2. 创建摄像机 (视角75度, 宽高比, 近距0.1, 远距1000)</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
<span class="hljs-comment">// 把摄像机往后拉一点，不然就在物体肚子里了</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;

<span class="hljs-comment">// 3. 创建渲染器</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-comment">// 把渲染出来的 canvas 塞到页面里</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);
</code></pre>
<h3 data-id="heading-7">第二步：请演员入场（创建物体）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 骨架：一个 1x1x1 的立方体</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

<span class="hljs-comment">// 2. 皮肤：绿色的，对光照有反应的材质</span>
<span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x44aa88</span> });

<span class="hljs-comment">// 3. 合体：创建网格</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);

<span class="hljs-comment">// 4. 放到场景里！</span>
scene.<span class="hljs-title function_">add</span>(cube);
</code></pre>
<h3 data-id="heading-8">第三步：打光（Light）</h3>
<p>如果你用的是 <code>MeshPhongMaterial</code> 这种高级材质，没有光就是漆黑一片。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个平行光（类似太阳光）</span>
<span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xFFFFFF</span>, <span class="hljs-number">1</span>);
light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>);
scene.<span class="hljs-title function_">add</span>(light);
</code></pre>
<h3 data-id="heading-9">第四步：Action！(动画循环)</h3>
<p>电影是每秒 24 帧的静态图，Three.js 也一样。我们需要一个循环，不停地让渲染器“拍照”。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">requestAnimationFrame</span>(animate); <span class="hljs-comment">// 浏览器下次重绘前调用我</span>

    <span class="hljs-comment">// 让立方体动起来</span>
    cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
    cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;

    <span class="hljs-comment">// 咔嚓！渲染一帧</span>
    renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-title function_">animate</span>(); <span class="hljs-comment">// 开始循环</span>
</code></pre>
<p>📂 <strong>核心代码与完整示例：</strong>  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqq790git%2Fmy-three-app.git" target="_blank" title="https://github.com/qq790git/my-three-app.git" ref="nofollow noopener noreferrer">my-three-app</a></p>
<h3 data-id="heading-10">总结</h3>
<p><strong>如果你喜欢本教程，记得点赞+收藏！关注我获取更多Three.js开发干货</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[视频生成圈炸了：SkyReels-V3开源，三大功能硬刚商业模型]]></title>    <link>https://juejin.cn/post/7600642904382308358</link>    <guid>https://juejin.cn/post/7600642904382308358</guid>    <pubDate>2026-01-29T14:20:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600642904382308358" data-draft-id="7600663744192692260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="视频生成圈炸了：SkyReels-V3开源，三大功能硬刚商业模型"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-29T14:20:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            视频生成圈炸了：SkyReels-V3开源，三大功能硬刚商业模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:20:25.000Z" title="Thu Jan 29 2026 14:20:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年1月29日，对于AI视频生成社区来说，是一个值得标记的日子。</p>
<p>就在各家大厂还在把高质量视频模型藏在付费墙后面的时候，昆仑万维旗下的Skywork AI团队做了一个相当极客的决定：把他们最新的“全能型”视频生成大模型——SkyReels-V3，彻底开源了。</p>
<p>如果你是长期关注这个领域的开发者或创作者，你应该深知当下的痛点：想做个好视频，往往需要在Midjourney里画图，去Runway或Kling里动起来，最后还得找个LipSync工具对口型。流程割裂，风格难统一。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2F640-6-1024x418.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/640-6-1024x418.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee8eb31e3b9f435c97b378a07441c4f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770301226&amp;x-signature=U8Ug%2FmDy4yjquCLfeEAP9u8vakM%3D" alt="640" loading="lazy"/></a></p>
<p>而SkyReels-V3这次最大的看点，就是它在一个统一的架构里，硬是塞进了三大核心能力：参考图生视频、视频无限延长、以及音频驱动虚拟人。</p>
<p>这不是一次简单的版本更新，这是一次对“全流程AI视频制作”门槛的降维打击。</p>
<h2 data-id="heading-0">从“抽卡”到“精准控制”：参考图生视频</h2>
<p>在这个赛道，大家最怕的就是“崩坏”。你给了一张主角图，生成的视频里主角换了张脸，这在以前是常态。</p>
<p>SkyReels-V3在这个环节下了狠手。它支持输入1到4张参考图像。这意味着什么？你可以同时把人物的正脸、侧脸、甚至特定的服装细节喂给模型。</p>
<p>根据官方放出的硬核评测数据，在“参考一致性”这一指标上，SkyReels-V3拿到了0.6698的分数。为了让你对这个数字有概念，目前市面上的商业强手Vidu Q2得分是0.5961，而备受好评的Kling 1.6则是0.6630。也就是说，在保持人物长得像、衣服不乱变这件事上，这个开源模型已经略微领先了第一梯队的商业闭源模型。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-29_21.05.29-1024x355.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-29_21.05.29-1024x355.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0adf9a377efc46b7b875aae3cd2e8829~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770301226&amp;x-signature=NyJR%2B9AGV0LhH6PhrVLY1IULqeM%3D" alt="iShot_2026-01-29_21.05.29" loading="lazy"/></a></p>
<p>同时，在视觉质量（Visual Quality）上，它以0.8119的得分压过了PixVerse V5和Kling 1.6。对于做电商广告或者影视预演的人来说，这不仅仅是参数的胜利，而是工作流可用的开始。</p>
<h2 data-id="heading-1">不再是5秒真男人：电影级的视频延长</h2>
<p>短视频生成最大的尴尬在于时长。大多数模型只能跑个3到5秒，再长就变形。</p>
<p>SkyReels-V3引入了更符合影视逻辑的“视频延长”功能。它不仅能把5秒的镜头拉长到30秒，更关键的是它懂“镜头语言”。它内置了切入、切出、正反打等5种专业电影转场逻辑。</p>
<p>这意味着模型不是在机械地预测下一帧像素，而是在理解叙事。它知道什么时候该给特写，什么时候该切全景。通过统一的多分段位置编码技术，即使是复杂的运动场景，画面也能保持物理逻辑的连贯。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-29_21.05.37-1024x377.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-29_21.05.37-1024x377.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e17e08b9aff4ddba4dc8b46f2d0ba19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770301226&amp;x-signature=VllbGKVbuek01mVB4kx%2FAUEGB4w%3D" alt="iShot_2026-01-29_21.05.37" loading="lazy"/></a></p>
<h2 data-id="heading-2">把数字人做进模型里：音频驱动虚拟形象</h2>
<p>以前做“会说话的头像”（Talking Avatar），通常需要专门的独立模型。SkyReels-V3把这项能力也整合了进来。</p>
<p>只需要一张肖像图和一段音频，它就能生成口型精准、表情自然的视频，而且支持分钟级的长视频生成。这直接切中了数字人直播和在线教育的命门。</p>
<p>在评测中，它的音视频同步性得分高达8.18，视觉质量4.60。这个数据基本和垂直领域的霸主OmniHuman 1.5持平（OmniHuman同步性8.25）。但在SkyReels-V3里，这只是它众多功能中的一项而已。更炸裂的是，它是业内首个支持单镜头内“多角色多轮对话”的模型，这让生成双人访谈类内容成为了可能。</p>
<h2 data-id="heading-3">开源的诚意与野心</h2>
<p>这次Skywork AI没有玩虚的。模型权重、推理代码在GitHub和Hugging Face上全部放出。</p>
<p>他们采用了一种“一核多支”的训练框架，通过高质量的混合数据训练，让模型具备了多模态的理解力。对于开发者而言，这意味着你可以下载模型，在本地（只要显存够，据悉优化到了24G显存以下）部署，甚至进行二次开发和微调。</p>
<p>除了硬核的代码，他们还提供了限时免费的API，并将这些能力集成到了自家的SkyReels平台上，让普通用户通过拖拽也能用上这些技术。</p>
<p>总的来说，SkyReels-V3的出现，打破了高性能视频模型必须闭源收费的刻板印象。它不仅在各项参数上硬刚主流商业模型，更重要的是，它把“做图+动效+口型”这三座大山铲平，铺成了一条通往全自动视频生成的平路。</p>
<p>对于内容创作者和开发者来说，2026年的开年大礼，确实够分量。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析 Vercel Skill：跨 Agent 的技能包管理器]]></title>    <link>https://juejin.cn/post/7600628279215669274</link>    <guid>https://juejin.cn/post/7600628279215669274</guid>    <pubDate>2026-01-29T14:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215669274" data-draft-id="7600597995768791049" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析 Vercel Skill：跨 Agent 的技能包管理器"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-01-29T14:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="candyTong"/> <meta itemprop="url" content="https://juejin.cn/user/2242659449576952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析 Vercel Skill：跨 Agent 的技能包管理器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659449576952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    candyTong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:49:37.000Z" title="Thu Jan 29 2026 14:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>1. 背景：技能检索与部署的挑战</strong></h2>
<p>在利用 AI Agent（如 Claude Code, Cursor, Trae）进行开发时，开发者面临的核心挑战在于技能（Skill）的 <strong>检索效率</strong> 与 <strong>安装成本</strong>：</p>
<ul>
<li><strong>发现困难</strong>：优质的 Prompt 和指令集散落在 GitHub、博客或社区中，缺乏标准化的中心化检索入口。</li>
<li><strong>安装繁琐</strong>：手动将指令内容配置到不同 Agent 的特定目录中，操作路径长且低效。</li>
<li><strong>配置不统一</strong>：不同 Agent 的配置标准不统一，难以实现跨平台的技能同步与管理。</li>
</ul>
<p><strong>Vercel Skill</strong> 定位于 <strong>跨 Agent 的技能包管理器</strong>。它通过 <code>find</code> 命令建立标准化的检索机制，通过 <code>add</code> 命令实现自动化部署，将 Agent 的能力扩展过程标准化。</p>
<hr/>
<h2 data-id="heading-1"><strong>2. 核心功能：<code>find</code> 与 <code>add</code></strong></h2>
<h3 data-id="heading-2"><strong><code>find</code>：检索与发现</strong></h3>
<pre><code class="hljs language-bash" lang="bash">npx skills find react
</code></pre>
<p>用于在官方资源库中交互式搜索技能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c14f3c36ab4357bcc2fa5f103ecc16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=qDTS%2Bni9A1iSFbFj%2FS49rWEr7x8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3"><strong><code>add</code>：安装与同步</strong></h3>
<pre><code class="hljs language-bash" lang="bash">npx skills add https://github.com/vercel-labs/skills --skill find-skills
</code></pre>
<p>用于从远程仓库、URL 或本地路径安装技能。它能自动识别本地已安装的 Agent（如 Claude Code, Cursor, Trae）并实现一键同步配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c92e79fb4238453e85243104c466e0ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=DDjtHYzyJqkLkYoSVTVUCoOwmLw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>find-skills：赋予 Agent 搜索 skill 能力</strong></h2>
<p>除了 CLI 工具，官方还提供了一个名为 <code>find-skills</code> 的内置技能，专门用于辅助 Agent 发现新能力。</p>
<ul>
<li><strong>核心功能</strong>：让 Agent 能够根据用户的模糊需求（如“帮我找个写测试的工具”），自主调用检索逻辑。</li>
<li><strong>多轮检索机制</strong>：Agent 会根据初始反馈，自动尝试多轮查找，并生成更精准的关键词进行二次搜索，直到找到最匹配的技能。</li>
<li><strong>决策辅助</strong>：Agent 会对比搜索结果，向用户解释每个技能的用途，并给出安装建议，从而降低用户的决策成本。</li>
<li><strong>安装方式</strong>：
<pre><code class="hljs language-bash" lang="bash">npx skills add vercel-labs/skills@find-skills
</code></pre>
</li>
</ul>
<p>使用效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29adece6e2024acd92f396c75ea4539a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=CfPodfcDVb8fkkxvN%2FcWM3dDbk4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>3. 实现原理</strong></h2>
<p>Vercel Skill 采用“协调者”架构。<code>find</code> 与 <code>add</code> 既可以独立运行，也可以在交互模式下链式调用。</p>
<h3 data-id="heading-6"><strong><code>find</code> 检索流程时序图</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant CLI as Vercel Skill CLI (find.ts)
    participant Registry as skills.sh API

    User-&gt;&gt;CLI: npx skills find "react"
    loop 交互式输入
        CLI-&gt;&gt;Registry: GET /api/search (携带 query)
        Registry--&gt;&gt;CLI: 返回技能元数据列表 (包含名称、仓库源、安装量等)
        CLI-&gt;&gt;User: 动态渲染交互界面 (显示名称与 Source)
    end
    User-&gt;&gt;CLI: 确认选择项 (提取 Source 标识符)
    Note over CLI: 内部调用 runAdd(source)
</code></pre>
<h3 data-id="heading-7"><strong><code>add</code> 部署流程时序图</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant CLI as Vercel Skill CLI (add.ts)
    participant Source as 源码托管 (GitHub/Local)
    participant Agent as AI Agent (如 Claude Code)

    User-&gt;&gt;CLI: npx skills add &lt;source&gt;
    CLI-&gt;&gt;CLI: 解析 Source (标准 URL 或 简写)

    alt 远程源 (GitHub/GitLab)
        CLI-&gt;&gt;Source: 克隆仓库至临时目录
    else 本地源
        CLI-&gt;&gt;Source: 读取本地路径
    end

    CLI-&gt;&gt;CLI: 发现并解析 SKILL.md
    CLI-&gt;&gt;Agent: 自动探测已安装的 Agent 环境
    User-&gt;&gt;CLI: 确认安装范围与方式 (Symlink/Copy)

    loop 遍历目标 Agent
        CLI-&gt;&gt;Agent: 写入配置或创建软链接
    end
    Agent--&gt;&gt;User: 部署完成并打印路径
</code></pre>
<ol>
<li><strong>源解析</strong>：将用户输入的简写（如 <code>owner/repo</code>）或标准 URL 解析为统一的结构。</li>
<li><strong>资源获取</strong>：针对远程仓库，CLI 自动克隆源码至临时目录；针对本地路径则直接读取。</li>
<li><strong>环境探测</strong>：扫描系统预定义的 Agent 配置路径（如 Claude Code、Cursor、Trae 等），识别当前活跃环境。</li>
<li><strong>自动化部署</strong>：根据用户选择的范围（全局/项目）和方式（软链接/复制），CLI 批量在目标 Agent 的技能目录下建立关联。</li>
</ol>
<hr/>
<h2 data-id="heading-8"><strong>4. 企业内部 skill 平台的接入方式</strong></h2>
<h3 data-id="heading-9"><strong>Search 功能接入</strong></h3>
<p>对于企业内部环境，Vercel Skill 提供了 <code>SKILLS_API_URL</code> 环境变量，用于修改请求的域名；只要域名提供对应的接口，并保持入参出参一致即可。</p>
<pre><code class="hljs language-bash" lang="bash">SKILLS_API_URL=https://your-internal-api.com npx skills find react
</code></pre>
<p><strong>企业内部搜索接入时序图：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant CLI as Skills CLI
    participant IntAPI as 企业内部 API (SKILLS_API_URL)
    participant Registry as 内部 Skill 注册表
    participant ExtAPI as 外部公开 API (skills.sh)

    CLI-&gt;&gt;IntAPI: GET /api/search?q=...
    activate IntAPI
    IntAPI-&gt;&gt;Registry: 检索企业私有 Skill
    Registry--&gt;&gt;IntAPI: 返回私有 Skill 列表

    rect rgb(240, 240, 240)
    Note over IntAPI, ExtAPI: 可选：聚合外部搜索
    IntAPI-&gt;&gt;ExtAPI: GET /api/search?q=...
    ExtAPI--&gt;&gt;IntAPI: 返回公开 Skill 列表
    end

    IntAPI-&gt;&gt;IntAPI: 合并并转换格式
    IntAPI--&gt;&gt;CLI: 返回统一格式的技能列表
    deactivate IntAPI
</code></pre>
<p><strong>接口伪代码示例（同时支持搜索企业内和企业外部的 skill）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 企业内部 Skill 搜索接口示例 (Next.js / Vercel Route Handler)</span>
<span class="hljs-comment">// GET /api/search?q=...</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GET</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">const</span> { searchParams } = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>);
  <span class="hljs-keyword">const</span> query = searchParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'q'</span>);

  <span class="hljs-comment">// 1. 搜索企业内部私有 Skill 仓库</span>
  <span class="hljs-keyword">const</span> internalSkills = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchInternalRegistry</span>(query);

  <span class="hljs-comment">// 2. 搜索企业外部公开 Skill (可选，实现聚合搜索)</span>
  <span class="hljs-keyword">const</span> publicSkills = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://skills.sh/api/search?q=<span class="hljs-subst">${query}</span>`</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-property">skills</span>)
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> []);

  <span class="hljs-comment">// 3. 统一转换格式并合并结果</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">skills</span>: [
      ...internalSkills.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
        <span class="hljs-attr">id</span>: s.<span class="hljs-property">id</span>,
        <span class="hljs-attr">name</span>: s.<span class="hljs-property">name</span>,
        <span class="hljs-attr">installs</span>: s.<span class="hljs-property">downloads</span>,
        <span class="hljs-attr">topSource</span>: s.<span class="hljs-property">gitUrl</span>, <span class="hljs-comment">// 内部 Git 地址</span>
      })),
      ...publicSkills,
    ],
  });
}
</code></pre>
<h3 data-id="heading-10"><strong>Add 功能接入与权限处理</strong></h3>
<p>针对企业内部 <code>add</code> 功能，主要有以下两种接入方案：</p>
<h4 data-id="heading-11"><strong>方案一：无改造直接接入 (Direct Clone)</strong></h4>
<p>不需要任何改造，直接传入 Git 仓库进行下载。</p>
<ul>
<li><strong>原理</strong>：直接利用本地 Git 环境进行 <code>Clone</code> 内部仓库。</li>
<li><strong>优点</strong>：实现成本低，完全复用现有逻辑。</li>
<li><strong>缺点</strong>：受限于用户本地权限，对于没有仓库访问权限的用户会安装失败。</li>
</ul>
<h4 data-id="heading-12"><strong>方案二：平台中间层接入 (Well-known Proxy)</strong></h4>
<p>如果要做到通用且安全，可以通过引入一个<strong>平台中间层 (Proxy Layer)</strong>。此时 <code>add</code> 命令传入不再是内部 Git 地址，而是中间层的 HTTP 域名。</p>
<ul>
<li>
<p><strong>原理</strong>：</p>
<ol>
<li><strong>屏蔽权限复杂性</strong>：服务端统一持有 Git Token/SSH Key，负责克隆内部私有仓库。终端用户无需配置 Git 权限。</li>
<li><strong>协议转换</strong>：将复杂的 Git 结构转换为标准的 <strong>Well-known (RFC 8615)</strong> 静态文件接口。</li>
<li><strong>按需发现</strong>：支持通过子路径（如 <code>middleware.com/org-name</code>）实现多团队的技能发现。</li>
</ol>
</li>
<li>
<p><strong>实现细节</strong>：</p>
<ul>
<li><strong>接口规范</strong>：需实现 <code>GET /.well-known/skills/index.json</code> 索引接口。</li>
<li><strong>单个文件下载</strong>：CLI 在解析 <code>index.json</code> 后，会根据 <code>files</code> 数组中的路径，拼接完整的 URL 逐个下载文件（例如：<code>GET /.well-known/skills/db-helper/SKILL.md</code>）。</li>
<li><strong>数据结构示例</strong>：
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"internal-db-helper"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"企业内部数据库查询助手"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"SKILL.md"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"handler.ts"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>工作流时序图</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户 (CLI)
    participant Proxy as 中间层 (Well-known Server)
    participant Git as 内部 Git (GitLab/Bitbucket)

    User-&gt;&gt;Proxy: npx skills add https://proxy.com/skills
    Proxy-&gt;&gt;Proxy: 鉴权并解析目标技能
    Proxy-&gt;&gt;Git: 服务端 Clone (使用预设 Token)
    Proxy-&gt;&gt;Proxy: 提取 SKILL.md 并生成 index.json
    Proxy--&gt;&gt;User: 返回 index.json 索引
    User-&gt;&gt;Proxy: GET /.well-known/skills/db-helper/SKILL.md
    Proxy--&gt;&gt;User: 返回文件流
    Note over User: CLI 完成本地安装
</code></pre>
</li>
</ul>
<p>这种方案将“仓库访问控制”转化为了“Web API 访问控制”，极大地降低了企业内部推广技能包的门槛。</p>
<hr/>
<h2 data-id="heading-13"><strong>总结</strong></h2>
<p><strong>Vercel Skill</strong> 通过标准化的 CLI 工具，打破了 AI Agent 技能发现与部署的壁垒：</p>
<ol>
<li><strong>用户侧</strong>：提供了类似 <code>npm</code> 的丝滑体验，实现了一次安装、多 Agent 同步。</li>
<li><strong>开发者侧</strong>：通过简单的 <code>SKILL.md</code> 规范即可发布技能，支持 Git、本地路径及 Web URL 等多种源。</li>
<li><strong>企业侧</strong>：通过灵活的 API 环境变量及 <strong>Well-known 代理模式</strong>，在确保安全与权限受控的前提下，实现了企业内部私有技能的高效分发。</li>
</ol>
<p>随着 AI Agent 生态的爆发，这种<strong>跨平台、标准化的技能包管理方案</strong>将成为提升开发者生产力的关键基础设施。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[月省$50！个人开发者如何0成本拥抱向量数据库？]]></title>    <link>https://juejin.cn/post/7600629210155909126</link>    <guid>https://juejin.cn/post/7600629210155909126</guid>    <pubDate>2026-01-29T14:51:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600629210155909126" data-draft-id="7600637595944730666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="月省$50！个人开发者如何0成本拥抱向量数据库？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T14:51:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            月省$50！个人开发者如何0成本拥抱向量数据库？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:51:43.000Z" title="Thu Jan 29 2026 14:51:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cef3f1a6c9d74582a25bd18eaa9e900d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770303105&amp;x-signature=%2FwPu8FOnPOdcQskMalwsgs695zY%3D" alt="10.jpg" loading="lazy"/></p>
<p>上周想给自己的博客加个智能搜索功能，搜了一圈发现Pinecone最便宜也要50美元一个月。手指悬在"开始免费试用"按钮上好几秒，最后还是关掉了网页——一个月50刀对个人项目来说真的肉疼。
说实话，那会儿挺沮丧的。向量数据库听起来那么酷：能理解语义、找相似内容、给AI喂知识库，但咋就这么贵呢？后来无意中发现了Cloudflare Vectorize，试了试发现免费额度完全够用，100万个向量查询3万次才花0.31美元。这价格差距有点离谱吧？
如果你也在找低成本的向量数据库方案，或者对"语义搜索"这个概念感兴趣却不知道从哪儿下手，那这篇文章来得正好。接下来我会用大白话讲清楚Vectorize是啥、为啥便宜、怎么用，最后带你30分钟跑通一个完整的语义搜索Demo。不装高深，就聊点实在的。</p>
<h2 data-id="heading-0">第一部分：概念扫盲</h2>
<h3 data-id="heading-1">向量数据库到底是啥？3句话说清楚</h3>
<p>我第一次看到"768维向量"这个词的时候也是懵的，听起来像高中数学课的噩梦。不过别慌,其实这玩意儿没那么玄乎。
传统数据库存的是文字、数字、日期这些直观的东西。但向量数据库不一样，它存的是"语义"——也就是文字背后的意思。打个比方，你在搜索框里输入"苹果手机"，传统搜索只能找到完全匹配"苹果手机"这四个字的结果。但向量搜索能理解"iPhone"、"苹果新款"、"Apple旗舰机"说的都是同一回事。
这魔法是怎么变出来的？简单说就是：把文字丢给AI模型（比如OpenAI的嵌入模型），它会吐出一串数字，比如<code>[0.23, -0.45, 0.78, ...]</code>这种，一共768个数。这串数字就是"向量"，可以理解为把文字的意思量化成了坐标。两段意思相近的文字，它们的向量在数学上也会靠得很近。
举个实际例子：我在博客上试了下，搜"便宜的笔记本电脑"能匹配到"性价比高的laptop"这篇文章，虽然关键词一个都没重合，但意思对上了。这就是语义搜索的魔力。</p>
<h3 data-id="heading-2">为啥选Vectorize？对比3大主流方案</h3>
<p>你可能会想，市面上向量数据库那么多，Pinecone、Weaviate、Milvus听起来都挺专业，为啥偏偏要选Vectorize？我当时也纠结过，后来对比了一圈发现，对小项目和个人开发者来说，Vectorize真的香。
<strong>先聊聊成本，这是最实在的</strong>
Pinecone算是最有名的了，但价格劝退。最便宜的标准计划每月最低消费50美元，存100万个向量大概要41美元/月。Weaviate的无服务器版本起步价25美元/月，如果你存100万个1536维的向量还要查询，账单能飙到153美元（压缩版便宜点，25美元）。
Vectorize呢？我实测了一下：100万个768维向量，每天查询1000次（一个月就是3万次），总共才0.31美元。对，你没看错，零点三一美元。Cloudflare官方博客说查询成本降了75%，存储成本降了98%，这数字不是吹的。</p>
<p/>
<p>更爽的是，Vectorize有免费额度，够跑一个小型项目或者做MVP验证。等真用起来再考虑付费，这才叫良心。
<strong>再说说集成难度</strong>
Pinecone和Weaviate都需要你单独注册账号、管理API密钥、配置网络访问。如果你已经在用Cloudflare Workers部署应用，Vectorize就是"拎包入住"——在<code>wrangler.toml</code>里加几行配置就绑定好了，代码里直接调用<code>env.VECTORIZE_INDEX</code>，连环境变量都不用配。
我之前折腾Pinecone的时候，光是搞清楚怎么在Workers里安全存API密钥就花了半小时。Vectorize完全没这烦恼。
<strong>最后看适用场景</strong>
这里得实话实说，Vectorize不是万能的：</p>
<ul>
<li><strong>小型项目、MVP、个人博客</strong>：Vectorize完胜，成本低、上手快</li>
<li><strong>企业级、超大规模（亿级向量）</strong>：Pinecone更合适，它的基础设施和企业支持更成熟</li>
<li><strong>多模态需求（图片、视频、音频）</strong>：Weaviate功能更全，原生支持多模态输入
Cloudflare官方数据说Vectorize现在支持最多500万向量的索引。对大多数应用来说，500万条数据已经很够用了——我的个人博客写了三年也就200多篇文章，离上限还远着呢。</li>
</ul>
<p>说了这么多，其实就一个核心逻辑：<strong>如果你刚开始尝试向量搜索，或者预算有限，Vectorize绝对是最佳起点</strong>。等业务真做大了，再考虑迁移也不迟。</p>
<h3 data-id="heading-3">Vectorize能干啥？4个实战场景</h3>
<p>讲了半天理论，你肯定想知道这东西到底能干啥。我列几个我见过或者自己试过的真实场景，都挺实用的。
<strong>1. 智能文档搜索</strong>
最常见的用法。比如公司有几百份技术文档、产品手册、法律条文，用传统的Ctrl+F根本找不准。用Vectorize搭个语义搜索，员工输入"怎么申请报销"就能匹配到"费用报销流程"、"差旅费用提交指南"这些相关文档。我之前给团队做过一个内部知识库，上线第一周就省了不少"这个文档在哪"的重复提问。
<strong>2. 文章推荐系统</strong>
"相关阅读"功能大家都见过,但很多网站的推荐要么是硬编码标签匹配,要么就随机推几篇。Vectorize能根据当前文章内容自动找到真正相关的文章。比如用户在看"React Hooks最佳实践"，系统能推荐"useEffect常见陷阱"而不是"Vue入门教程"。这个我在博客上跑了一个月，点击率比之前的随机推荐高了40%。
<strong>3. RAG应用（给AI喂知识库）</strong>
RAG是Retrieval-Augmented Generation的缩写，说人话就是：让ChatGPT能回答你私有数据的问题。比如你有100篇产品文档,用户问"这个功能支持批量导入吗"，系统先从Vectorize里找到相关的那几篇文档，再把内容喂给GPT生成回答。这样AI就不会瞎编了，回答都基于你的真实文档。现在很多客服机器人都是这么做的。
<strong>4. 内容去重和归类</strong>
假如你做用户反馈管理，每天收到几百条留言，很多其实说的是同一个问题。用Vectorize能自动把"登录失败"、"无法登陆"、"登不上去"这些归为一类，省得人工一条条看。或者做内容审核的时候，快速找出重复发布的文章、相似的营销文案等等。
这几个场景覆盖了向量数据库大部分常见用法。说白了，只要你需要"找相似内容"这个能力，向量数据库就派得上用场。</p>
<h2 data-id="heading-4">第二部分：动手实战</h2>
<h3 data-id="heading-5">准备工作：5分钟环境搭建</h3>
<p>好了，理论讲完该动手了。先别慌着写代码，咱们先把环境搞好。整个过程也就5分钟，跟着做就行。
<strong>第一步：注册Cloudflare账号</strong>
去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloudflare.com" target="_blank" title="https://cloudflare.com" ref="nofollow noopener noreferrer">cloudflare.com</a> 注册个账号，免费的。如果你已经在用Cloudflare的其他服务（比如CDN、DNS），直接用现有账号就行。
<strong>第二步：安装Wrangler CLI</strong>
Wrangler是Cloudflare的命令行工具，用来管理Workers和Vectorize。打开终端，运行：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g wrangler
</code></pre>
<p>如果你用的是yarn或pnpm，换成对应的命令就行。装完之后验证一下：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler --version
</code></pre>
<p>能看到版本号就说明装好了。
<strong>第三步：登录Cloudflare</strong>
在终端运行：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler login
</code></pre>
<p>会自动打开浏览器要你授权，点"允许"就行。回到终端应该能看到"Successfully logged in"。
<strong>第四步：创建项目</strong>
找个地方新建项目文件夹：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> vectorize-demo
<span class="hljs-built_in">cd</span> vectorize-demo
wrangler init
</code></pre>
<p>Wrangler会问你一堆问题，直接按回车用默认值就行。如果问要不要用TypeScript，建议选"Yes"（当然JavaScript也完全没问题）。
这时候项目目录里应该有这些文件：</p>
<ul>
<li><code>wrangler.toml</code> - 配置文件</li>
<li><code>src/index.ts</code> - Workers代码</li>
<li><code>package.json</code> - 依赖管理
到这里环境就算搭好了。是不是比想象中简单？接下来咱们创建第一个向量索引。</li>
</ul>
<h3 data-id="heading-6">核心步骤：创建第一个向量索引</h3>
<p>索引就是向量的"家"，所有向量都要存在索引里。创建索引超简单，一行命令搞定。
<strong>创建索引</strong>
在项目目录下运行：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler vectorize create my-search-index --preset @cf/baai/bge-small-en-v1.5
</code></pre>
<p>这里<code>my-search-index</code>是你给索引起的名字，随便起，只要是英文字母、数字、连字符就行。<code>--preset</code>参数指定用哪个嵌入模型，这里用的是Cloudflare内置的BGE模型（768维）。
跑完之后你应该能看到类似这样的输出：</p>
<pre><code class="hljs language-perl" lang="perl">✅ Successfully created <span class="hljs-keyword">index</span> <span class="hljs-keyword">my</span>-search-<span class="hljs-keyword">index</span>
</code></pre>
<p>简单解释下preset：Cloudflare内置了几个常用的嵌入模型，直接用就行，不用自己去OpenAI买API。<code>bge-small-en-v1.5</code>是个性能不错的小模型，768维，速度快还省钱。如果你要做中文搜索,建议用<code>@cf/baai/bge-base-zh-v1.5</code>。
<strong>配置wrangler.toml</strong>
接下来要告诉Workers这个索引怎么用。打开<code>wrangler.toml</code>文件，在最后加上这几行：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[[vectorize]]</span>
<span class="hljs-attr">binding</span> = <span class="hljs-string">"VECTORIZE_INDEX"</span>
<span class="hljs-attr">index_name</span> = <span class="hljs-string">"my-search-index"</span>
</code></pre>
<p><code>binding</code>是你在代码里调用索引的变量名，<code>index_name</code>要和刚才创建的索引名字一致。
<strong>验证一下</strong>
想确认索引创建成功，可以列出所有索引：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler vectorize list
</code></pre>
<p>应该能看到你刚才创建的<code>my-search-index</code>。
<strong>常见错误提示</strong>
我刚开始用的时候踩过几个坑，提前说说：</p>
<ul>
<li>如果提示"Index already exists"，说明你之前创建过同名索引，换个名字或者用<code>wrangler vectorize delete</code>删掉旧的</li>
<li>如果<code>wrangler.toml</code>里忘了加<code>[[vectorize]]</code>配置，代码里调用<code>env.VECTORIZE_INDEX</code>会报"undefined"错误</li>
<li>preset里的模型名不能写错，官方支持的模型列表可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fvectorize%2F" target="_blank" title="https://developers.cloudflare.com/vectorize/" ref="nofollow noopener noreferrer">Cloudflare文档</a>里找到
到这一步，索引就算建好了。下一步咱们写代码往里面塞数据、然后搜索。</li>
</ul>
<h3 data-id="heading-7">写代码：30行实现语义搜索</h3>
<p>重头戏来了！咱们用最简单的方式实现一个完整的语义搜索。我会把代码拆成几块讲，每一步都能跑通。
<strong>第一步：插入数据</strong>
假如你有几篇博客文章，想让用户能语义搜索。先把文章内容转成向量存进去。
打开<code>src/index.ts</code>，写入这段代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Env</span> {
  <span class="hljs-attr">VECTORIZE_INDEX</span>: <span class="hljs-title class_">VectorizeIndex</span>;
  <span class="hljs-attr">AI</span>: <span class="hljs-title class_">Ai</span>; <span class="hljs-comment">// Cloudflare Workers AI</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-attr">request</span>: <span class="hljs-title class_">Request</span>, <span class="hljs-attr">env</span>: <span class="hljs-title class_">Env</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt; {
    <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>);
    <span class="hljs-comment">// 插入数据的接口</span>
    <span class="hljs-keyword">if</span> (url.<span class="hljs-property">pathname</span> === <span class="hljs-string">'/insert'</span>) {
      <span class="hljs-keyword">const</span> articles = [
        {
          <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,
          <span class="hljs-attr">title</span>: <span class="hljs-string">'Cloudflare Workers入门'</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">'Cloudflare Workers是一个无服务器计算平台，让你能在边缘节点运行代码'</span>
        },
        {
          <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>,
          <span class="hljs-attr">title</span>: <span class="hljs-string">'Serverless架构指南'</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">'Serverless computing让部署和扩展变得非常简单，你不用管服务器'</span>
        },
        {
          <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>,
          <span class="hljs-attr">title</span>: <span class="hljs-string">'JavaScript异步编程'</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">'Promise和async/await是处理异步操作的现代方式'</span>
        }
      ];
      <span class="hljs-comment">// 批量生成向量</span>
      <span class="hljs-keyword">const</span> embeddings = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
        articles.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (article) =&gt; {
          <span class="hljs-keyword">const</span> embedding = <span class="hljs-keyword">await</span> env.<span class="hljs-property">AI</span>.<span class="hljs-title function_">run</span>(<span class="hljs-string">'@cf/baai/bge-small-en-v1.5'</span>, {
            <span class="hljs-attr">text</span>: <span class="hljs-string">`<span class="hljs-subst">${article.title}</span> <span class="hljs-subst">${article.content}</span>`</span>
          });
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">id</span>: article.<span class="hljs-property">id</span>,
            <span class="hljs-attr">values</span>: embedding.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>], <span class="hljs-comment">// 768维向量</span>
            <span class="hljs-attr">metadata</span>: {
              <span class="hljs-attr">title</span>: article.<span class="hljs-property">title</span>,
              <span class="hljs-attr">content</span>: article.<span class="hljs-property">content</span>
            }
          };
        })
      );
      <span class="hljs-comment">// 插入到Vectorize</span>
      <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">upsert</span>(embeddings);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'插入成功！'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">200</span> });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'Not found'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">404</span> });
  }
};
</code></pre>
<p>这段代码干了啥？</p>
<ol>
<li>定义了3篇示例文章</li>
<li>用Cloudflare的AI模型把每篇文章转成768维向量</li>
<li>调用<code>upsert</code>方法把向量存进Vectorize索引
注意<code>metadata</code>字段，这里可以存原始的标题和内容，搜索时能直接拿到。
<strong>第二步：搜索查询</strong>
现在数据有了，咱们加个搜索接口：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 fetch 函数里加上这段</span>
<span class="hljs-keyword">if</span> (url.<span class="hljs-property">pathname</span> === <span class="hljs-string">'/search'</span>) {
  <span class="hljs-keyword">const</span> query = url.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'q'</span>);
  <span class="hljs-keyword">if</span> (!query) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">'缺少查询参数 q'</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> });
  }
  <span class="hljs-comment">// 把查询文本转成向量</span>
  <span class="hljs-keyword">const</span> queryEmbedding = <span class="hljs-keyword">await</span> env.<span class="hljs-property">AI</span>.<span class="hljs-title function_">run</span>(<span class="hljs-string">'@cf/baai/bge-small-en-v1.5'</span>, {
    <span class="hljs-attr">text</span>: query
  });
  <span class="hljs-comment">// 在索引里搜索最相似的5条</span>
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">query</span>(queryEmbedding.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>], {
    <span class="hljs-attr">topK</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">returnMetadata</span>: <span class="hljs-literal">true</span>
  });
  <span class="hljs-comment">// 格式化结果</span>
  <span class="hljs-keyword">const</span> formattedResults = results.<span class="hljs-property">matches</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: match.<span class="hljs-property">id</span>,
    <span class="hljs-attr">score</span>: match.<span class="hljs-property">score</span>, <span class="hljs-comment">// 相似度分数，0-1之间</span>
    <span class="hljs-attr">title</span>: match.<span class="hljs-property">metadata</span>?.<span class="hljs-property">title</span>,
    <span class="hljs-attr">content</span>: match.<span class="hljs-property">metadata</span>?.<span class="hljs-property">content</span>
  }));
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(formattedResults, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), {
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  });
}
</code></pre>
<p>这个接口干了啥？</p>
<ol>
<li>接收查询参数<code>q</code>（比如用户输入"无服务器"）</li>
<li>把查询文本转成向量</li>
<li>调用<code>query</code>方法找最相似的5条结果</li>
<li>返回带分数的搜索结果
<strong>第三步：本地测试</strong>
代码写完了，跑起来试试：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">wrangler dev
</code></pre>
<p>Wrangler会启动一个本地服务器，通常是<code>http://localhost:8787</code>。
先插入数据：</p>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8787/insert
</code></pre>
<p>看到"插入成功！"就OK了。
然后试试搜索：</p>
<pre><code class="hljs language-bash" lang="bash">curl <span class="hljs-string">"http://localhost:8787/search?q=无服务器平台"</span>
</code></pre>
<p>你应该能看到类似这样的结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.89</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Cloudflare Workers入门"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Cloudflare Workers是一个无服务器计算平台..."</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.85</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Serverless架构指南"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Serverless computing让部署和扩展变得非常简单..."</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>注意看<code>score</code>字段，这是相似度分数，越高越相关。虽然查询的是"无服务器平台"，但成功匹配到了"Cloudflare Workers"和"Serverless"相关的文章——这就是语义搜索的魔力！
<strong>代码说明</strong>
你可能会好奇几个点：</p>
<ul>
<li><strong>为啥不用OpenAI的API</strong>？Cloudflare Workers AI内置了嵌入模型，免费额度足够用，也不用管API密钥</li>
<li><strong>upsert是啥</strong>？就是"更新或插入"，如果ID已存在就更新，不存在就插入</li>
<li><strong>topK设置多少合适</strong>？一般5-10条就够了，太多了用户也看不过来
好了，到这里你已经掌握了80%的核心用法。接下来讲几个进阶技巧，让搜索更精准。</li>
</ul>
<h3 data-id="heading-8">进阶技巧：3个优化建议</h3>
<p>基础功能跑通了，但想要搜索效果更好，还有几个小技巧值得试试。
<strong>1. 元数据过滤：精准圈定搜索范围</strong>
假如你的博客有分类，比如"技术"、"生活"、"读书笔记"，用户搜索"Python"的时候肯定只想看技术类文章。这时候就用上元数据过滤了。
修改插入代码，给每篇文章加个分类：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">metadata</span>: {
  <span class="hljs-attr">title</span>: article.<span class="hljs-property">title</span>,
  <span class="hljs-attr">content</span>: article.<span class="hljs-property">content</span>,
  <span class="hljs-attr">category</span>: <span class="hljs-string">'tech'</span> <span class="hljs-comment">// 新增分类字段</span>
}
</code></pre>
<p>搜索的时候加上过滤条件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">query</span>(queryEmbedding.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>], {
  <span class="hljs-attr">topK</span>: <span class="hljs-number">5</span>,
  <span class="hljs-attr">returnMetadata</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">filter</span>: { <span class="hljs-attr">category</span>: <span class="hljs-string">'tech'</span> } <span class="hljs-comment">// 只搜索技术类</span>
});
</code></pre>
<p>这样就能避免搜"Python"的时候跳出来"我养了一条蟒蛇"这种生活类文章了。
<strong>2. 混合搜索：语义+关键词双保险</strong>
有时候纯语义搜索会漏掉一些精确匹配的结果。比如搜"React 18"，你肯定希望标题里带"React 18"的文章排在前面。
这时候可以结合传统关键词筛选：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 先做语义搜索</span>
<span class="hljs-keyword">const</span> vectorResults = <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">query</span>(queryEmbedding.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>], {
  <span class="hljs-attr">topK</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 多取点候选</span>
  <span class="hljs-attr">returnMetadata</span>: <span class="hljs-literal">true</span>
});
<span class="hljs-comment">// 再做关键词过滤和加权</span>
<span class="hljs-keyword">const</span> finalResults = vectorResults.<span class="hljs-property">matches</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> boostedScore = match.<span class="hljs-property">score</span>;
    <span class="hljs-comment">// 如果标题完全匹配关键词，加分</span>
    <span class="hljs-keyword">if</span> (match.<span class="hljs-property">metadata</span>?.<span class="hljs-property">title</span>.<span class="hljs-title function_">includes</span>(query)) {
      boostedScore += <span class="hljs-number">0.2</span>;
    }
    <span class="hljs-keyword">return</span> { ...match, <span class="hljs-attr">score</span>: boostedScore };
  })
  .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">score</span> - a.<span class="hljs-property">score</span>)
  .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// 取前5条</span>
</code></pre>
<p>这种"语义找相关+关键词加权"的组合拳，能让搜索结果更精准。
<strong>3. 批量操作：提升性能</strong>
如果你要一次插入几百上千条数据，一条条insert会很慢。Vectorize支持批量操作，性能能提升好几倍。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 把文章分批，每批100条</span>
<span class="hljs-keyword">const</span> batchSize = <span class="hljs-number">100</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; allArticles.<span class="hljs-property">length</span>; i += batchSize) {
  <span class="hljs-keyword">const</span> batch = allArticles.<span class="hljs-title function_">slice</span>(i, i + batchSize);
  <span class="hljs-keyword">const</span> embeddings = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
    batch.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (article) =&gt; {
      <span class="hljs-comment">// ... 生成向量</span>
    })
  );
  <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">upsert</span>(embeddings);
}
</code></pre>
<p>我之前导入500篇文章，单条插入花了20分钟，改成批量之后3分钟就搞定了。
还有个小技巧：如果你用Workers KV存了热门查询的结果，可以加个缓存层，重复查询直接从KV读，省得每次都跑向量计算。</p>
<h2 data-id="heading-9">第三部分：避坑指南</h2>
<h3 data-id="heading-10">常见问题及解决方案</h3>
<p>用Vectorize过程中我踩过不少坑，这里总结几个高频问题，能帮你少走弯路。
<strong>问题1：向量维度不匹配错误</strong>
报错信息：<code>Dimension mismatch: expected 768, got 1536</code>
原因很简单：你创建索引时用的是768维的模型（bge-small），但后来生成向量时换成了1536维的模型（比如OpenAI的text-embedding-3-small）。Vectorize要求同一个索引里所有向量维度必须一致。
<strong>解决办法</strong>：</p>
<ul>
<li>方案一：重新创建索引，用和嵌入模型匹配的preset</li>
<li>方案二：换嵌入模型，保证维度对得上
我的建议是一开始就想好用哪个模型，别中途换。
<strong>问题2：免费额度到底够不够用</strong>
这是大家最关心的。Cloudflare官方没给特别明确的免费额度数字，但根据定价公式可以算出来：
存储：免费额度大概能存500万个768维向量
查询：每月大概300万次查询
听起来很多对吧？实际上对小项目完全够了。我的博客200篇文章，每天访问量300，搜索量大概30次，跑了一个月账单是0美元（在免费额度内）。
如果真超了免费额度，按量付费也便宜得离谱——100万向量查询3万次才0.31美元。
<strong>问题3：该选哪个嵌入模型</strong>
Cloudflare支持好几个内置模型，选哪个要看场景：</li>
<li><strong>中文内容</strong>：<code>@cf/baai/bge-base-zh-v1.5</code>（专门针对中文优化）</li>
<li><strong>英文内容</strong>：<code>@cf/baai/bge-small-en-v1.5</code>（性能和成本平衡）</li>
<li><strong>多语言混合</strong>：<code>@cf/baai/bge-m3</code>（支持100多种语言）
如果你追求极致效果，也可以用OpenAI的<code>text-embedding-3-small</code>（1536维），但要自己调用API，成本会高一点。
我的经验是：大部分情况Cloudflare内置的BGE模型就够用了，质量已经很不错。
<strong>问题4：从其他向量数据库迁移数据</strong>
假如你之前用的Pinecone，现在想省钱换Vectorize，怎么迁移数据？
思路很简单：</li>
</ul>
<ol>
<li>从Pinecone导出所有向量和metadata</li>
<li>转换成Vectorize的格式</li>
<li>批量upsert到新索引
我写了个简单的迁移脚本（伪代码）：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从Pinecone获取所有向量</span>
<span class="hljs-keyword">const</span> pineconeVectors = <span class="hljs-keyword">await</span> pineconeIndex.<span class="hljs-title function_">fetch</span>({ <span class="hljs-attr">ids</span>: allIds });
<span class="hljs-comment">// 转换格式</span>
<span class="hljs-keyword">const</span> vectorizeFormat = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(pineconeVectors.<span class="hljs-property">vectors</span>).<span class="hljs-title function_">map</span>(
  <span class="hljs-function">(<span class="hljs-params">[id, vector]</span>) =&gt;</span> ({
    id,
    <span class="hljs-attr">values</span>: vector.<span class="hljs-property">values</span>,
    <span class="hljs-attr">metadata</span>: vector.<span class="hljs-property">metadata</span>
  })
);
<span class="hljs-comment">// 批量插入Vectorize</span>
<span class="hljs-keyword">const</span> batchSize = <span class="hljs-number">100</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; vectorizeFormat.<span class="hljs-property">length</span>; i += batchSize) {
  <span class="hljs-keyword">const</span> batch = vectorizeFormat.<span class="hljs-title function_">slice</span>(i, i + batchSize);
  <span class="hljs-keyword">await</span> env.<span class="hljs-property">VECTORIZE_INDEX</span>.<span class="hljs-title function_">upsert</span>(batch);
}
</code></pre>
<p>注意：向量维度必须一致！如果Pinecone用的1536维，Vectorize索引也得用1536维的preset。
<strong>问题5：搜索结果不准怎么办</strong>
有时候搜索结果跟预期差很远，可能是这几个原因：</p>
<ol>
<li><strong>嵌入模型不适合你的领域</strong>：比如你做医疗内容，通用模型可能效果不好，考虑用领域专用模型</li>
<li><strong>输入文本太短</strong>：向量需要足够的上下文才能准确表达语义，标题+摘要比只用标题效果好</li>
<li><strong>没做数据清洗</strong>：文本里有大量HTML标签、特殊字符会影响向量质量
我的做法是：把标题、摘要、正文前200字合在一起生成向量，效果明显比只用标题好。</li>
</ol>
<h3 data-id="heading-11">什么时候该升级方案</h3>
<p>Vectorize虽然香,但不是万能的。有几种情况你可能需要考虑其他方案。
<strong>信号1：向量数超过500万</strong>
Vectorize目前单个索引最多支持500万向量。如果你的数据规模更大，比如电商平台有几千万商品，那就得考虑Pinecone或者自建Milvus集群了。不过说实话，大多数应用根本到不了这个量级。
<strong>信号2：需要多模态搜索</strong>
假如你除了文本还要搜索图片、音频、视频，Vectorize目前只支持文本向量。这种情况Weaviate是更好的选择，它原生支持多模态数据。
<strong>信号3：复杂的图数据库需求</strong>
如果你的应用需要结合知识图谱，比如"找出所有和XX相关的、发布在2024年的、作者是YY的文章"，这种复杂查询Vectorize不太够用。可以考虑GraphRAG方案，结合Neo4j这种图数据库和向量搜索。
<strong>信号4：对延迟要求极高</strong>
Vectorize的查询延迟一般在50-200ms，对大多数应用已经很快了。但如果你做实时推荐系统，要求10ms内返回结果，可能需要Redis + Faiss这种内存方案。
<strong>我的建议</strong>
别一上来就追求完美方案。先用Vectorize把功能跑通，验证产品方向。等业务真做大了、遇到瓶颈了，再考虑升级。过早优化是万恶之源，更何况迁移成本也不高——向量数据格式都差不多，写个脚本几小时就能搬完。
我见过不少人纠结选型纠结了一个月，最后项目还没开始做。不如先动手，有问题再调整。</p>
<h2 data-id="heading-12">结论</h2>
<p>说了这么多，回到最开始那个问题：向量数据库到底贵不贵？
答案是：看你选什么。Pinecone最低50美元/月，但Vectorize的免费额度足够跑一个有一定规模的应用。我自己的博客语义搜索跑了两个月，账单还是0美元。
这篇文章从概念讲到实战，从基础用法讲到进阶技巧，希望能帮你快速上手Vectorize。如果你也想给自己的项目加上语义搜索功能，不妨试试看——30分钟就能跑通一个Demo，成本几乎为零，试错成本比点一杯咖啡还低。</p>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Feastondev.com%2Fblog%2Fzh%2Fposts%2Fdev%2F20251201-vectorize-tutorial%2F" target="_blank" title="https://eastondev.com/blog/zh/posts/dev/20251201-vectorize-tutorial/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mysql中的union关键字详解]]></title>    <link>https://juejin.cn/post/7600588379106181172</link>    <guid>https://juejin.cn/post/7600588379106181172</guid>    <pubDate>2026-01-29T14:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600588379106181172" data-draft-id="7600622813457006607" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mysql中的union关键字详解"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2026-01-29T14:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mysql中的union关键字详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:58:23.000Z" title="Thu Jan 29 2026 14:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MySQL 的 <code>UNION</code> 用于<strong>合并两个或多个 <code>SELECT</code> 语句的结果集</strong>，并自动去除重复行（相当于对结果集执行 <code>DISTINCT</code>）。</p>
<h2 data-id="heading-0">1. 基本语法与核心规则</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> column1, column2 <span class="hljs-keyword">FROM</span> table1
<span class="hljs-keyword">UNION</span> [<span class="hljs-keyword">ALL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DISTINCT</span>]
<span class="hljs-keyword">SELECT</span> column1, column2 <span class="hljs-keyword">FROM</span> table2;
</code></pre>
<p><strong>强制性规则</strong>：</p>
<ul>
<li><strong>列数必须相同</strong>：两个 SELECT 返回的列数必须一致</li>
<li><strong>数据类型兼容</strong>：对应位置的列类型不必完全相同，但必须可隐式转换（如 INT 和 DECIMAL）</li>
<li><strong>列名继承</strong>：结果集的列名取自<strong>第一个</strong> SELECT 语句</li>
<li><strong>ORDER BY 位置</strong>：只能放在最后一个 SELECT 之后，且排序依据必须是第一个 SELECT 的列名或别名</li>
</ul>
<h2 data-id="heading-1">2. UNION vs UNION ALL</h2>

























<table><thead><tr><th>特性</th><th><code>UNION</code> (DISTINCT)</th><th><code>UNION ALL</code></th></tr></thead><tbody><tr><td><strong>去重</strong></td><td>自动去重，行唯一</td><td>保留所有行，包括重复</td></tr><tr><td><strong>性能</strong></td><td>需要临时表+哈希排序去重，较慢</td><td>直接追加结果，极快</td></tr><tr><td><strong>使用场景</strong></td><td>必须确保唯一性时</td><td>确定无重复或需要保留重复时</td></tr></tbody></table>
<p><strong>性能建议</strong>：除非业务需要去重，否则<strong>优先使用 <code>UNION ALL</code></strong>。去重操作需要创建临时表、哈希比较和额外排序，大数据量时性能差距巨大。</p>
<h2 data-id="heading-2">3. 实际应用场景</h2>
<h3 data-id="heading-3">场景 A：合并相似结构表（如分表）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询 2023 和 2024 年的订单（假设按年分表）</span>
<span class="hljs-keyword">SELECT</span> order_id, amount, created_at <span class="hljs-keyword">FROM</span> orders_2023
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> order_id, amount, created_at <span class="hljs-keyword">FROM</span> orders_2024
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<h3 data-id="heading-4">场景 B：多维度统计报表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">'VIP用户'</span> <span class="hljs-keyword">as</span> user_type, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> cnt <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-operator">&gt;=</span> <span class="hljs-number">8</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'普通用户'</span>, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">7</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'访客'</span>, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<h3 data-id="heading-5">场景 C：数据补全与兜底查询</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先查缓存表，若无结果再查主表（常见于配置表）</span>
<span class="hljs-keyword">SELECT</span> config_value <span class="hljs-keyword">FROM</span> config_cache <span class="hljs-keyword">WHERE</span> config_key <span class="hljs-operator">=</span> <span class="hljs-string">'site_name'</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> config_value <span class="hljs-keyword">FROM</span> config <span class="hljs-keyword">WHERE</span> config_key <span class="hljs-operator">=</span> <span class="hljs-string">'site_name'</span>
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-6">4. 进阶用法</h2>
<h3 data-id="heading-7">带排序和分页</h3>
<pre><code class="hljs language-sql" lang="sql">(<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>)
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
(<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'B'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>注意</strong>：子查询中的 <code>ORDER BY</code> 必须配合 <code>LIMIT</code> 才生效，否则会被优化器忽略。</p>
<h3 data-id="heading-8">混合聚合与明细</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> city, sales_amount, <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">as</span> detail <span class="hljs-keyword">FROM</span> sales_summary
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> city, amount, CONCAT(product_name, <span class="hljs-string">':'</span>, quantity) <span class="hljs-keyword">FROM</span> sales_detail;
</code></pre>
<h2 data-id="heading-9">5. 性能优化要点</h2>
<ol>
<li><strong>索引利用</strong>：每个 SELECT 独立使用索引，UNION 本身不走索引</li>
<li><strong>减少数据集</strong>：在子查询中先 <code>WHERE</code> 过滤，避免传递大量数据到 UNION 层</li>
<li><strong>避免临时表写入</strong>：<code>UNION DISTINCT</code> 会创建内存临时表（或磁盘临时表，若过大），可通过 <code>SET tmp_table_size</code> 调优</li>
<li><strong>并行执行</strong>：MySQL 8.0.19+ 对非相关子查询的 UNION 可能启用并行查询</li>
</ol>
<h2 data-id="heading-10">6. 常见陷阱</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ❌ 错误：列数不匹配</span>
<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> t1
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t2;  <span class="hljs-comment">-- ERROR 1222</span>

<span class="hljs-comment">-- ❌ 错误：ORDER BY 位置错误</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t2;  <span class="hljs-comment">-- ERROR 1221</span>

<span class="hljs-comment">-- ✅ 正确写法</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t2
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id;  <span class="hljs-comment">-- 使用第一个 SELECT 的列名排序</span>
</code></pre>
<h2 data-id="heading-11">7. Django ORM 中的 UNION</h2>
<p>如果你在使用 Django（看你之前关注过 Django 源码），可以这样使用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q

<span class="hljs-comment"># QuerySet.union() 默认使用 UNION ALL</span>
qs1 = User.objects.<span class="hljs-built_in">filter</span>(status=<span class="hljs-string">'active'</span>).values(<span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)
qs2 = User.objects.<span class="hljs-built_in">filter</span>(is_staff=<span class="hljs-literal">True</span>).values(<span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)

<span class="hljs-comment"># UNION ALL</span>
combined = qs1.union(qs2, <span class="hljs-built_in">all</span>=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># UNION (去重)</span>
combined_distinct = qs1.union(qs2)  <span class="hljs-comment"># 或 all=False</span>
</code></pre>
<p><strong>注意</strong>：Django 的 <code>union()</code> 会强制转换为 SQL 的 <code>UNION</code>，且 QuerySet 被求值后返回的是列表而非 QuerySet，无法继续链式过滤。</p>
<hr/>
<p><strong>总结</strong>：<code>UNION ALL</code> 是合并结果集的高性能首选，<code>UNION</code> (DISTINCT) 仅在需要去重时使用。始终确保子查询列数一致，并在应用层处理复杂的排序逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>