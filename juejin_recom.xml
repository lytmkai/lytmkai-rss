<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚]]></title>    <link>https://juejin.cn/post/7598587406695022635</link>    <guid>https://juejin.cn/post/7598587406695022635</guid>    <pubDate>2026-01-24T06:01:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406695022635" data-draft-id="7598587406694924331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚"/> <meta itemprop="keywords" content="Go,åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-24T06:01:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="maoæ¯›"/> <meta itemprop="url" content="https://juejin.cn/user/1146138854949790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146138854949790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    maoæ¯›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:01:41.000Z" title="Sat Jan 24 2026 06:01:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">robfig/cron v3 æœªå®ç°recover</h2>
<p>å®šæ—¶ä»»åŠ¡paincä¼šå¯¼è‡´ç¨‹åºå†…å­˜æ•°æ®ä¸¢å¤±ï¼Œå‘ç”Ÿé‡å¯ï¼Œæœ¬æ•™ç¨‹æ˜¯å®ç°cronçš„recoveræœºåˆ¶ã€‚åŒæ ·ä¹Ÿé€‚ç”¨äºé•¿è¿æ¥åœºæ™¯ï¼Œæ¯”å¦‚tcpé“¾æ¥åï¼Œç”¨æˆ·å‘ç”Ÿè¡Œä¸ºè°ƒç”¨rpcæœåŠ¡ï¼Œä½†æ˜¯åœ¨è°ƒç”¨å‰çš„æŸäº›æ“ä½œï¼Œè¢«æŠ½è±¡å‡ºæ¥äº†ï¼Œç¼–ç¨‹ä¸åˆç†ç­‰åœºæ™¯ï¼Œå‘ç”Ÿpaincï¼Œä¼šå¯¼è‡´å½“å‰ç”¨æˆ·æ–­å¼€é“¾æ¥ï¼Œæ•°æ®ä¸¢å¤±ã€‚</p>
<h2 data-id="heading-1">ç»´æŠ¤handlerï¼Œdefer å¤„ç†recover</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CornDesc <span class="hljs-keyword">struct</span> {
    Name    <span class="hljs-type">string</span>
    Spec    <span class="hljs-type">string</span>
    NewFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CornDesc)</span></span> Handle() {
    <span class="hljs-keyword">defer</span> c.final()
    c.NewFunc()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CornDesc)</span></span> final() {
    <span class="hljs-keyword">if</span> err := <span class="hljs-built_in">recover</span>(); err != <span class="hljs-literal">nil</span> {
       fmt.Printf(<span class="hljs-string">"%s æ•è·è¿è¡Œå¼‚å¸¸! err :%v stack %s\n"</span>, c.Name, err, debug.Stack())
    }
}

</code></pre>
<h2 data-id="heading-2">cmd å¯¼å…¥åŸåˆ™ï¼Œæ­¤éƒ¨åˆ†å¯ä»¥ä¿®æ”¹</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> _Machine *Machine

<span class="hljs-keyword">type</span> Machine <span class="hljs-keyword">struct</span> {
    *cron.Cron
    exist <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitMachine</span><span class="hljs-params">(c *cron.Cron)</span></span> *Machine {
    <span class="hljs-keyword">if</span> _Machine == <span class="hljs-literal">nil</span> {
       _Machine = &amp;Machine{
          Cron:  c,
          exist: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>),
       }
    }
    <span class="hljs-keyword">return</span> _Machine
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BaseMachine</span><span class="hljs-params">()</span></span> *Machine {
    <span class="hljs-keyword">return</span> _Machine
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> Run() {
    m.Cron.Run()
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> verify(cronDesc *CornDesc) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> id, ok := m.exist[cronDesc.Name]; ok {
       <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"ä»»åŠ¡å·²å­˜åœ¨,name %s id %d"</span>, cronDesc.Name, id)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> Register(cornDesc *CornDesc) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> err := m.verify(cornDesc); err != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> err
    }
    id, err := m.Cron.AddFunc(cornDesc.Spec, cornDesc.Handle)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> err
    }
    m.exist[cornDesc.Name] = <span class="hljs-type">int</span>(id)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’]]></title>    <link>https://juejin.cn/post/7598389448147664906</link>    <guid>https://juejin.cn/post/7598389448147664906</guid>    <pubDate>2026-01-24T03:17:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598389448147664906" data-draft-id="7598445152158171187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-24T03:17:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:17:45.000Z" title="Sat Jan 24 2026 03:17:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨ DOM æ ‘ä¸­ï¼Œ<code>Element</code> ç±»å‹æ˜¯æˆ‘ä»¬äº¤äº’æœ€é¢‘ç¹çš„èŠ‚ç‚¹ã€‚æ— è®ºæ˜¯ä¿®æ”¹æ ·å¼ã€ç›‘å¬ç„¦ç‚¹ï¼Œè¿˜æ˜¯åŠ¨æ€æ’å…¥å†…å®¹ï¼Œéƒ½ç¦»ä¸å¼€å®ƒã€‚æœ¬æ–‡å°†å¸¦ä½ ç³»ç»Ÿå¤ä¹  <code>Element</code> çš„æ ¸å¿ƒ APIï¼Œå¹¶æ­ç¤ºä¸€äº›åœ¨å®é™…å¼€å‘ä¸­å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚ä¸é™·é˜±ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ Element èŠ‚ç‚¹åŸºç¡€</h2>
<p><code>Element</code> è¡¨ç¤º HTML ä¸­çš„å…ƒç´ èŠ‚ç‚¹ã€‚é€šè¿‡ <code>document.createElement()</code> å¯ä»¥åŠ¨æ€åˆ›å»ºã€‚</p>
<ul>
<li><strong><code>nodeType</code></strong>: <strong>1</strong></li>
<li><strong><code>nodeName</code></strong>: è¿”å›å¤§å†™æ ‡ç­¾åï¼ˆå¦‚ <code>"DIV"</code>ï¼‰ã€‚</li>
<li><strong><code>nodeValue</code></strong>: å§‹ç»ˆä¸º <code>null</code>ã€‚</li>
</ul>
<h3 data-id="heading-2">1. æ ‡å‡†å±æ€§</h3>
<p>å¯ä»¥ç›´æ¥é€šè¿‡ç‚¹è¯­æ³•ï¼ˆ<code>.</code>ï¼‰è®¿é—®çš„å¸¸è§å±æ€§ï¼š<code>id</code>ã€<code>title</code>ã€<code>lang</code>ã€<code>dir</code>è¯­è¨€çš„ä¹¦å†™æ–¹å‘ï¼ˆ"ltr"è¡¨ç¤ºä»å·¦åˆ°å³ï¼Œ"rtl"è¡¨ç¤ºä»å³åˆ°å·¦)ã€‚</p>
<ul>
<li><strong><code>className</code></strong>: å¯¹åº” HTML çš„ <code>class</code> å±æ€§ã€‚ç”±äº <code>class</code> æ˜¯ JS å…³é”®å­—ï¼Œæ•…å±æ€§ååšäº†è½¬æ¢ã€‚</li>
</ul>
<h3 data-id="heading-3">2. è‡ªå®šä¹‰å±æ€§ï¼šdataset</h3>
<p>HTML5 è§„èŒƒäº† <code>data-</code> å‰ç¼€çš„è‡ªå®šä¹‰å±æ€§ï¼Œé€šè¿‡ <code>dataset</code> å¯¹è±¡å¯ä»¥ä¼˜é›…åœ°è¯»å†™ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;div id=<span class="hljs-string">"myDiv"</span> data-app-id=<span class="hljs-string">"12345"</span>&gt;&lt;/div&gt;

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"myDiv"</span>);

<span class="hljs-comment">// è·å–ï¼šæ³¨æ„ camelCase è½¬æ¢ï¼ˆdata-app-id -&gt; appIdï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-property">dataset</span>.<span class="hljs-property">appId</span>); 

<span class="hljs-comment">// è®¾ç½®</span>
div.<span class="hljs-property">dataset</span>.<span class="hljs-property">userName</span> = <span class="hljs-string">"Nicholas"</span>; <span class="hljs-comment">// è‡ªåŠ¨å˜ä¸º data-user-name="Nicholas"</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">äºŒã€ å±æ€§æ“ä½œï¼šAttribute vs Property</h2>
<p>è¿™æ˜¯æœ€å®¹æ˜“æ··æ·†çš„åœ°æ–¹ï¼š<code>getAttribute</code> æ“ä½œçš„æ˜¯ HTML æ–‡æ¡£ä¸­çš„<strong>ç‰¹æ€§</strong>ï¼Œè€Œç›´æ¥èµ‹å€¼æ“ä½œçš„æ˜¯ JS å¯¹è±¡çš„<strong>å±æ€§</strong>ã€‚</p>

























<table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>æè¿°</strong></th><th><strong>ç‰¹ç‚¹</strong></th></tr></thead><tbody><tr><td><strong><code>getAttribute(name)</code></strong></td><td>è·å– HTML ç‰¹æ€§</td><td>å§‹ç»ˆè¿”å›å­—ç¬¦ä¸²ï¼›è·å–ç±»åéœ€ä¼  <code>"class"</code></td></tr><tr><td><strong><code>setAttribute(name, v)</code></strong></td><td>è®¾ç½® HTML ç‰¹æ€§</td><td>ä¼šåŒæ­¥åˆ° HTML ç»“æ„ä¸­</td></tr><tr><td><strong><code>removeAttribute(name)</code></strong></td><td>å½»åº•åˆ é™¤ç‰¹æ€§</td><td>ä¸ä»…ä»…æ˜¯æ¸…ç©ºå€¼</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ å»ºè®®ï¼š</strong> å¯¹äº <code>id</code>ã€<code>className</code> ç­‰æ ‡å‡†å±æ€§ï¼Œç›´æ¥ä½¿ç”¨ç‚¹è¯­æ³•æ€§èƒ½æ›´å¥½ï¼›å¯¹äºéæ ‡å‡†çš„è‡ªå®šä¹‰å±æ€§ï¼Œä½¿ç”¨ <code>dataset</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ å†…å®¹æ“æ§ï¼šå®‰å…¨ä¸æ€§èƒ½</h2>
<h3 data-id="heading-6">1. innerHTML vs textContent</h3>
<ul>
<li><strong><code>innerHTML</code></strong>: è¯»å†™ HTMLï¼Œä¼šè§£ææ ‡ç­¾ã€‚<strong>æ³¨æ„ï¼š</strong> å­˜åœ¨ XSS æ”»å‡»é£é™©ã€‚</li>
<li><strong><code>textContent</code></strong>: è¯»å†™çº¯æ–‡æœ¬ã€‚æ€§èƒ½æ›´å¥½ä¸”æ›´å®‰å…¨ã€‚</li>
</ul>
<h3 data-id="heading-7">2. é«˜æ€§èƒ½æ’å…¥ï¼šinsertAdjacentHTML</h3>
<ul>
<li>è¯­æ³•ï¼š<code>insertAdjacentText(first,sencond)</code>
<ul>
<li><code>second</code>ï¼šæ’å…¥å†…å®¹</li>
<li><code>first</code>ï¼šè¦æ’å…¥çš„ä½ç½®
<ul>
<li><code>beforebegin</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å‰é¢ï¼Œä½œä¸ºå‰ä¸€ä¸ªåŒèƒèŠ‚ç‚¹</li>
<li><code>afterbegin</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å‰é¢</li>
<li><code>beforeend</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨æœ€åä¸€ä¸ªå­èŠ‚ç‚¹åé¢</li>
<li><code>afterend</code>ï¼šæ’å…¥å½“å‰å…ƒç´ åé¢ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªåŒèƒèŠ‚ç‚¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ç›¸æ¯”äº <code>innerHTML += '...'</code>ï¼ˆä¼šå¯¼è‡´æ•´ä¸ªå­æ ‘é‡æ–°æ¸²æŸ“ï¼‰ï¼Œ<code>insertAdjacentHTML</code> å¯ä»¥å°†å­—ç¬¦ä¸²è§£æä¸º DOM å¹¶ç²¾ç¡®æ’å…¥ï¼Œæ€§èƒ½æé«˜ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// è¯­æ³•ï¼šelement.insertAdjacentHTML(position, html)</span>
element.<span class="hljs-title function_">insertAdjacentHTML</span>(<span class="hljs-string">"afterbegin"</span>, <span class="hljs-string">"&lt;span&gt;New Content&lt;/span&gt;"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-8">å››ã€ ç±»åç®¡ç†ï¼šclassList API</h2>
<p>ä»¥å‰æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ“ä½œ <code>className</code> å­—ç¬¦ä¸²ï¼Œç°åœ¨æœ‰äº† <code>classList</code> è¿™ä¸ªç¥å™¨ã€‚</p>
<ul>
<li><strong><code>add(value)</code></strong> : æ·»åŠ ç±»åã€‚</li>
<li><strong><code>remove(value)</code></strong> : åˆ é™¤ç±»åã€‚</li>
<li><strong><code>contains(value)</code></strong> : åˆ¤æ–­æ˜¯å¦å­˜åœ¨ã€‚</li>
<li><strong><code>toggle(value)</code></strong> : åˆ‡æ¢ï¼ˆæœ‰åˆ™åˆ ï¼Œæ— åˆ™åŠ ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">äº”ã€ å‡ ä½•å°ºå¯¸ï¼šå½»åº•ææ‡‚å„ç§ Height/Width</h2>
<p>åœ¨å¤„ç†æ»šåŠ¨å’Œå¸ƒå±€æ—¶ï¼Œè¿™äº›å±æ€§éå¸¸å…³é”®ã€‚</p>





















<table><thead><tr><th><strong>å±æ€§</strong></th><th><strong>åŒ…å«èŒƒå›´</strong></th></tr></thead><tbody><tr><td><strong><code>clientWidth / clientHeight</code></strong></td><td>å†…å®¹ + å†…è¾¹è· (Padding)</td></tr><tr><td><strong><code>offsetWidth / offsetHeight</code></strong></td><td>å†…å®¹ + å†…è¾¹è· + <strong>è¾¹æ¡† (Border)</strong></td></tr><tr><td><strong><code>scrollWidth / scrollHeight</code></strong></td><td>åŒ…å«æ»šåŠ¨æ¡æ»šå‡ºçš„<strong>éšè—éƒ¨åˆ†</strong>çš„å®Œæ•´å°ºå¯¸</td></tr></tbody></table>
<p><strong>è¿›é˜¶ï¼šè·å–ç²¾ç¡®ä½ç½®</strong></p>
<p><code>getBoundingClientRect()</code> è¿”å›å…ƒç´ ç›¸å¯¹äº<strong>æµè§ˆå™¨è§†å£</strong>çš„ <code>top</code>, <code>left</code>, <code>right</code>, <code>bottom</code>, <code>width</code>, <code>height</code>ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€ ç„¦ç‚¹ç®¡ç†</h2>
<ul>
<li><strong><code>document.activeElement</code></strong>: æŒ‡å‘å½“å‰è·å¾—ç„¦ç‚¹çš„å…ƒç´ ï¼ˆå¦‚æ­£å¤„åœ¨è¾“å…¥çŠ¶æ€çš„ <code>input</code>ï¼‰ã€‚</li>
<li><strong><code>element.focus()</code></strong> : å¼ºåˆ¶è®©å…ƒç´ è·å¾—ç„¦ç‚¹ã€‚</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"myButton"</span>);
button.<span class="hljs-title function_">focus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span> === button); <span class="hljs-comment">// true </span>
</code></pre>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€ é¢è¯•æ¨¡æ‹Ÿé¢˜</h2>
<h3 data-id="heading-12">Q1ï¼š<code>isSameNode()</code> å’Œ <code>isEqualNode()</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<ul>
<li><code>isSameNode()</code> (ç­‰åŒäº <code>===</code>): æ£€æŸ¥ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨<strong>åŒä¸€ä¸ª</strong> DOM å®ä¾‹ã€‚</li>
<li><code>isEqualNode()</code>: æ£€æŸ¥ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦<strong>é•¿å¾—ä¸€æ ·</strong>ï¼ˆç±»å‹ç›¸åŒã€å±æ€§ç›¸åŒã€å­èŠ‚ç‚¹ç»“æ„ä¹Ÿç›¸åŒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">Q2ï¼šä¸ºä»€ä¹ˆé€šè¿‡ <code>innerHTML</code> æ’å…¥çš„ <code>&lt;script&gt;</code> ä¸ä¼šæ‰§è¡Œï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<p>è¿™æ˜¯æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ã€‚å¦‚æœéœ€è¦æ‰§è¡Œè„šæœ¬ï¼Œå¿…é¡»é€šè¿‡ <code>document.createElement('script')</code> æ‰‹åŠ¨åˆ›å»ºå¹¶æ’å…¥åˆ°æ–‡æ¡£ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼]]></title>    <link>https://juejin.cn/post/7598464972912181288</link>    <guid>https://juejin.cn/post/7598464972912181288</guid>    <pubDate>2026-01-24T06:10:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972912181288" data-draft-id="7598401650857017344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼"/> <meta itemprop="keywords" content="Coze,Agent,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T06:10:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åç«¯å°è‚¥è‚ "/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åç«¯å°è‚¥è‚ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:10:46.000Z" title="Sat Jan 24 2026 06:10:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°è‚¥è‚ ï¼ä»Šå¤©åˆ†äº«ä¸€ä¸ªé€‚åˆå°ç™½çš„å‰¯ä¸šæ–°é£å£ã€‚æˆ‘ç”¨ Coze 2.0 è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸ç”¨å†™ä»£ç ï¼Œä»…å‡­è‡ªç„¶è¯­è¨€å°±èƒ½åšä¸€ä¸ª<strong>å°çº¢ä¹¦æ¨æ–‡ç”Ÿæˆå™¨</strong>ï¼Œä¸ä»…æ•ˆç‡ç¿»å€ï¼Œè¿˜èƒ½ä¸Šæ¶æŠ€èƒ½å•†åº—è·å–æ”¶ç›Šã€‚æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ æ€ä¹ˆç©ï¼</p>
<h2 data-id="heading-0">1. å‰è¨€</h2>
<p>è¿™ä¸¤å¤©ç¾¤é‡Œå°ä¼™ä¼´è·Ÿæˆ‘è¯´æƒ³åšå°çº¢ä¹¦å°è¯´æ¨æ–‡ï¼Œä½†æ˜¯ä»–å·¥ä½œæµä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œé—®æˆ‘æœ‰ä»€ä¹ˆå¿«çš„æ–¹å¼èƒ½å®ç°è¾“å…¥å°è¯´å†…å®¹å°±ç”Ÿæˆå°è¯´æ¨æ–‡å¡ç‰‡ã€‚æœ€è¿‘Coze Skillsé£å¾ˆå¤§ï¼Œæˆ‘å°±ç”¨å®ƒè¯•ç€ç”Ÿæˆäº†ä¸€ä¸‹ï¼Œç»“æœå‡ºä¹æ„å¤–åœ°å¥½ï¼Œä»…ç”¨çº¯è‡ªç„¶è¯­è¨€ï¼Œå°±å®ç°äº†å°è¯´æ¨æ–‡å¡ç‰‡çš„ç”Ÿæˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f5034bf72b4c8089ac7d34518d9f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=BeDKJraJzTMWGMh7WqKoZ9s6Z3A%3D" alt="" loading="lazy"/></p>
<p>æ›´å…³é”®çš„æ˜¯ï¼ŒCoze Skills ç°åœ¨æ”¯æŒ<strong>ä¸Šæ¶å’Œé…ç½®è®¢é˜…æœºåˆ¶</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå“ªæ€•æ˜¯å®Œå…¨ä¸æ‡‚ä»£ç çš„å°ç™½ï¼Œä¹Ÿèƒ½é€šè¿‡åˆ›æ„æ„å»º Skillï¼Œä¸ä»…èƒ½è‡ªå·±ç”¨ï¼Œè¿˜èƒ½ä¸Šæ¶è·å–æ”¶ç›Šã€‚è¿™æ‰æ˜¯çœŸæ­£çš„æŠ€æœ¯å¹³æƒï¼š<strong>è®©æˆ‘ä»¬ä¸å†è¢«æŠ€æœ¯ç»†èŠ‚æ†ç»‘ï¼Œè€Œæ˜¯æŠŠç²¾åŠ›èšç„¦äºå†…å®¹ä¸åˆ›æ„çš„ç”Ÿäº§ã€‚</strong> ä»Šå¤©å°±æ‰‹æŠŠæ‰‹æ•™å¤§å®¶æ€ä¹ˆåšã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/041c8ba7bbc4420b827ce1b2b9ec7d5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=NKUJsDGHDgtyNGfVcFU5iMU59O4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2. Coze Skillæ„å»ºå°çº¢ä¹¦æ¨æ–‡å¡ç‰‡ç”Ÿæˆå·¥å…·</h2>
<h3 data-id="heading-2">2.1 Coze Skill æ­å»º</h3>
<p>æ¥åˆ°Cozeå®˜ç½‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coze.cn%2F" target="_blank" title="https://www.coze.cn/" ref="nofollow noopener noreferrer">www.coze.cn/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b986497e4c6742789cf16bcc1f7682ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=ebKp7mAcllrPWiBn3TJnyJugyfs%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»ã€æŠ€èƒ½å•†åº—ã€‘ï¼Œæ¥åˆ°é¡µé¢åå¯ä»¥çœ‹åˆ°å·²ç»æœ‰å¾ˆå¤šä¼˜ç§€æ¡ˆä¾‹ã€‚ç‚¹å‡»å³ä¸Šè§’ã€+åˆ›å»ºæŠ€èƒ½ã€‘æŒ‰é’®ï¼Œè·³è½¬åˆ°æ–°ç•Œé¢åè¾“å…¥ä½ çš„éœ€æ±‚ã€‚æˆ‘ç”¨å¤§ç™½è¯å†™äº†ä¸€å¥ï¼š</p>
<pre><code class="hljs">å®ç°è¾“å…¥å°è¯´å†…å®¹ï¼Œç”Ÿæˆå¡ç‰‡åˆ—è¡¨
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c39b80bf6cf42b084b68d1454a7f381~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=fEC%2Bd9hd3n%2B5dQha%2FdqpHb6mfrs%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»å‘é€æŒ‰é’®åä¼šè·³è½¬åˆ°æŠ€èƒ½ç”Ÿæˆé¡µé¢ï¼Œç¨ç­‰ç‰‡åˆ»å°±å¯ä»¥ä½¿ç”¨ï¼Œç°åœ¨æˆ‘åªè¦åœ¨å³ä¾§å·¥ä½œåŒºåº•éƒ¨å¯¹è¯æ¡†è¾“å…¥å°è¯´å†…å®¹ï¼Œå¾ˆå¿«å°±èƒ½é¡ºåˆ©ç”Ÿæˆå°è¯´æ¨æ–‡å¡ç‰‡äº†ï¼ˆæˆ‘éšä¾¿åœ¨æ¨æ–‡å¹³å°æ‰¾äº†ä¸€ä¸ªå°è¯´ç« èŠ‚ç²˜è´´è¿›å»ï¼‰ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99c3d7dc4a84606bf2206307ec17aa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=Fz0puVf2q8sJNAScjoLmcc9K6yg%3D" alt="" loading="lazy"/></p>
<p>ç­‰å¾…1åˆ†é’Ÿï¼Œå°è¯´æ¨æ–‡å¡ç‰‡å°±ç”Ÿæˆäº†ï¼Œå¦‚æœä¸æ»¡æ„å¯ä»¥åœ¨å³ä¾§å·¥ä½œåŒºåº•éƒ¨å¯¹è¯æ¡†è¾“å…¥ä¿®æ”¹æ„è§ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29288e529399450ba75ef754c714a1c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=8wfky%2BDXNXYpAFCfcC3o%2F7IyeeE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. Skilléƒ¨ç½²åŠä¸Šæ¶</h3>
<p>Skillå®Œæˆåå°±å¯ä»¥ç‚¹å‡»å³ä¸Šè§’éƒ¨ç½²æŒ‰é’®è¿›è¡Œéƒ¨ç½²äº†ï¼Œç‚¹å‡»ã€å¼€å§‹éƒ¨ç½²ã€‘æŒ‰é’®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce816ec1f24e4d36b721e9b86d9f5dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=HAlGmbSIuRpB04oYUiNEsHILF2Q%3D" alt="" loading="lazy"/></p>
<p>å‡ ç§’åå°±éƒ¨ç½²æˆåŠŸäº†ï¼Œç‚¹å‡»ã€ç«‹å³ä½“éªŒã€‘å°±èƒ½ä½“éªŒæˆ‘ä»¬å·²ç»åšå¥½çš„skillã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51e98cb200f841c8956ea1f47ca247c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=sG4wWYQtPDrHDuEuHzLxFlStlKo%3D" alt="" loading="lazy"/></p>
<p>ä¾ç„¶è¾“å…¥å°è¯´ç‰‡æ®µï¼Œç‚¹å‡»å‘é€æŒ‰é’®ã€‚ç­‰å¾…å‡ åˆ†é’Ÿå¯ä»¥çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç‚¹å‡»ã€åˆ†äº«è¯¥ä»»åŠ¡ã€‘æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„æ°”æ³¡ä¸­ç‚¹å‡»ã€å¤åˆ¶é“¾æ¥ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7c2adedc2c4f7aafd601fd0e7bada6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=cnO2ES6i3daxI4hJSDVdqW9xYvg%3D" alt="" loading="lazy"/></p>
<p>å›åˆ°æŠ€èƒ½å•†åº—ï¼Œè¿›å…¥ã€æˆ‘çš„æŠ€èƒ½ã€‘é¡µé¢ï¼Œç‚¹å‡»ã€æˆ‘åˆ›å»ºçš„ã€‘ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘åˆšåˆšåˆ›å»ºå®Œæˆçš„å°çº¢ä¹¦å°è¯´æ¨æ–‡æŠ€èƒ½ï¼Œç‚¹å‡»å³ä¸‹è§’å›¾æ ‡ï¼Œé€‰æ‹©ã€ä¸Šæ¶åˆ°å•†åº—ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74db14def568487a93dd5b835d90237e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=%2FvgroKrKa0cZUSNCyRC7r5ZGtHQ%3D" alt="" loading="lazy"/></p>
<p>å¡«å†™è¯¦ç»†æè¿°ï¼Œè¿›è¡Œæ¡ˆä¾‹é…ç½®ï¼Œå°†å‰é¢å¤åˆ¶çš„é“¾æ¥é…ç½®åˆ°ã€ä»»åŠ¡åˆ†äº«é“¾æ¥ã€‘ï¼Œå¡«å†™æ¡ˆä¾‹åç§°ï¼Œä¸Šä¼ é…å›¾ï¼Œç‚¹å‡»ã€ä¿å­˜ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8feb843a8f5747e683977a3e1192f5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=3cWDhJGBtWdA%2FST9TMyEvs0plLI%3D" alt="" loading="lazy"/></p>
<p>è®¾ç½®ã€ä»˜è´¹è®¾ç½®ã€‘å’Œã€æ˜¯å¦å¼€æºã€‘åå°±å¯ä»¥ç‚¹å‡»ä¸Šæ¶åˆ°å•†åº—äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a77d418cf9141e99247282a2fc4fb09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=ElnkhActpCshLM7W%2FLaHNbIrYEs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. ç»“è¯­</h2>
<p>ç»è¿‡è¿™æ¬¡ Coze Skill çš„åˆ›ä½œä½“éªŒï¼Œæƒ³å¿…å¤§å®¶éƒ½èƒ½ç›´è§‚åœ°æ„Ÿå—åˆ°ï¼š<strong>æ™ºèƒ½ä½“</strong> <strong>çš„åˆ›å»ºæ­£åœ¨ç»å†ä»â€œæ‹¼ä¹é«˜â€åˆ°â€œè¯´å¥è¯â€çš„æç®€è¿›åŒ–ã€‚</strong> æ­£å¦‚æˆ‘åœ¨å‰è¨€æ‰€è¯´ï¼ŒæŠ€æœ¯å¹³æƒçš„æ—¶ä»£å·²ç»å…¨é¢æ¥ä¸´ã€‚åœ¨è¿™ä¸ªæ—¶ä»£ï¼Œä»£ç ä¸å†æ˜¯é«˜å¢™ï¼Œæƒ³è±¡åŠ›æ‰æ˜¯å”¯ä¸€çš„è¾¹ç•Œã€‚</p>
<p><strong>å¦‚æœ¬æ¬¡åˆ†äº«å¯¹ä½ æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ä¸€é”®ä¸‰è¿æ”¯æŒä¸€ä¸‹å°è‚¥è‚ ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§~</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bd32351449444028b868768dc5ff9a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=KvbOEylDUZgusktwrm%2BLwbT7FC4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus]]></title>    <link>https://juejin.cn/post/7598447519823183913</link>    <guid>https://juejin.cn/post/7598447519823183913</guid>    <pubDate>2026-01-24T03:50:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519823183913" data-draft-id="7598418891401297974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus "/> <meta itemprop="keywords" content="Vue.js,Node.js,Vite"/> <meta itemprop="datePublished" content="2026-01-24T03:50:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£è§è§å½’å°˜_"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963754887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963754887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£è§è§å½’å°˜_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:50:02.000Z" title="Sat Jan 24 2026 03:50:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å¼„è¿™ä¸ªé¡¹ç›®ç¼˜ç”±</h3>
<p>æœ¬æƒ³å­¦ä¹ ä¸‹vue3 çš„åå°ç®¡ç†é¡¹ç›®, å€Ÿé‰´äº†vbtn-admin <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvbenjs%2Fvue-vben-admin" target="_blank" title="https://github.com/vbenjs/vue-vben-admin" ref="nofollow noopener noreferrer">githubåœ°å€</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.vben.pro%2F%23%2Fanalytics" target="_blank" title="https://www.vben.pro/#/analytics" ref="nofollow noopener noreferrer">çº¿ä¸Šåœ°å€</a>, é¢œå€¼åœ¨çº¿, ä½†æ˜¯å°è£…å¤ªéªšäº†æ”¹ä»£ç å¤ªç´¯ã€‚å°±è‡ªå·±é¢å¤–å¤„ç†äº†ä¸‹ã€‚</p>
<p>åšåˆ°ç®€å•æ˜“æ‡‚ å¼€ç®±å³ç”¨</p>
<p>è¿™æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„ monorepo ç¤ºä¾‹é¡¹ç›®ï¼Œä½¿ç”¨ <strong>pnpm workspace</strong> ç®¡ç†å‰ç«¯ï¼ˆVite + Tailwind + shadcn-uiï¼‰å’Œåç«¯ï¼ˆNode/Express æˆ–è‡ªå®šä¹‰åç«¯ï¼‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhangfengnice%2Fvite-admin-ele" target="_blank" title="https://github.com/hangfengnice/vite-admin-ele" ref="nofollow noopener noreferrer">githubæºç åœ°å€</a></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F112.124.38.17%2Fauth%2Flogin" target="_blank" title="http://112.124.38.17/auth/login" ref="nofollow noopener noreferrer">å½“å‰é¡¹ç›®å…¬ç½‘åœ°å€</a></p>
<h2 data-id="heading-1">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-csharp" lang="csharp">.
â”œâ”€â”€ ğŸ“ backend/                    <span class="hljs-meta"># åç«¯é¡¹ç›®</span>
â”œâ”€â”€ ğŸ“ frontend/                   <span class="hljs-meta"># å‰ç«¯é¡¹ç›®</span>
â”œâ”€â”€ ğŸ“„ deploy.sh                   <span class="hljs-meta"># éƒ¨ç½²è„šæœ¬</span>
â”œâ”€â”€ ğŸ“„ pnpm-<span class="hljs-keyword">lock</span>.yaml              <span class="hljs-meta"># pnpm é”æ–‡ä»¶</span>
â””â”€â”€ ğŸ“„ pnpm-workspace.yaml         <span class="hljs-meta"># pnpm å·¥ä½œåŒºé…ç½®</span>
</code></pre>
<h2 data-id="heading-2">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<h3 data-id="heading-3">1. å…‹éš†ä»“åº“</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/hangfengnice/vite-admin-ele.git
<span class="hljs-built_in">cd</span> vite-admin-ele
</code></pre>
<h3 data-id="heading-4">2. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g pnpm
pnpm install
</code></pre>
<h3 data-id="heading-5">3. å¯åŠ¨é¡¹ç›®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#åŒæ—¶å¯åŠ¨å‰åç«¯</span>
pnpm run all

<span class="hljs-comment">#å¯åŠ¨å‰ç«¯</span>
pnpm run dev
<span class="hljs-comment"># æˆ–è€…</span>
pnpm --filter frontend dev

<span class="hljs-comment">#å¯åŠ¨åç«¯</span>
pnpm run back
<span class="hljs-comment"># æˆ–è€…</span>
pnpm --filter backend dev
</code></pre>
<h3 data-id="heading-6">4. ä¸€é”®éƒ¨ç½²é˜¿é‡Œäº‘</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ chmod æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆç¬¬ä¸€æ¬¡ï¼‰</span>
<span class="hljs-built_in">chmod</span> +x deploy.sh

<span class="hljs-comment"># éƒ¨ç½²</span>
./deploy.sh
</code></pre>
<h3 data-id="heading-7">5. å¼€å‘é…ç½®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fbenefit%3Fspm%3D5176.28536895.J_4VYgf18xNlTAyFFbOuOQe.d_menu_3.53a4586c0rEqbG%26tid%3Dcloud" target="_blank" title="https://www.aliyun.com/benefit?spm=5176.28536895.J_4VYgf18xNlTAyFFbOuOQe.d_menu_3.53a4586c0rEqbG&amp;tid=cloud" ref="nofollow noopener noreferrer">é˜¿é‡Œäº‘åœ°å€ è·å–æœåŠ¡å™¨ ä»˜è´¹</a></p>
<p>é˜¿é‡Œäº‘éœ€è¦è£…</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é•œåƒ Ubuntu Server 24.04 LTS</span>

<span class="hljs-comment"># å®‰è£… Node.js 24 LTS</span>
curl -fsSL https://deb.nodesource.com/setup_24.x | bash -
sudo apt install -y nodejs

<span class="hljs-comment"># å®‰è£… PM2</span>
sudo npm install -g pm2

<span class="hljs-comment"># å®‰è£… Nginx</span>
sudo apt install -y nginx

<span class="hljs-comment"># å®‰è£… myswl</span>
sudo apt install -y mysql-server
</code></pre>
<h3 data-id="heading-8">6.æœ¬åœ°é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”µè„‘ mac</span>

<span class="hljs-comment"># node -v</span>
<span class="hljs-comment"># v24.12.0</span>

<span class="hljs-comment"># pnpm -v</span>
<span class="hljs-comment"># 10.28.1</span>

<span class="hljs-comment"># æœ¬åœ°é¢å¤–è£…äº†mysql</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)]]></title>    <link>https://juejin.cn/post/7598465042968018984</link>    <guid>https://juejin.cn/post/7598465042968018984</guid>    <pubDate>2026-01-24T06:11:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042968018984" data-draft-id="7598083101361586182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-01-24T06:11:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€æ±Ÿä¸œæµæ°´"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€æ±Ÿä¸œæµæ°´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:11:55.000Z" title="Sat Jan 24 2026 06:11:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ ¹æ¨¡å—</h2>
<p>é¦–å…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼šæ‰€æœ‰çš„åˆ›å»ºçš„æ¨¡å—éƒ½éœ€è¦åœ¨<code>AppModule</code>ä¸­<code>import</code>å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œåªæœ‰ä¸‹é¢ä¸‰ç§æƒ…å†µéœ€è¦åœ¨<code>AppModule</code>ä¸­å¼•å…¥ã€‚</p>
<p><strong>1. AppModule è‡ªèº«è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½</strong></p>
<p>å¦‚æœ AppModule é‡Œçš„ç»„ä»¶ï¼ˆæ¯”å¦‚ AppControllerã€AppServiceï¼‰éœ€è¦ç”¨ AaaModule å¯¼å‡ºçš„æœåŠ¡ï¼Œé‚£å¿…é¡»åœ¨ AppModule çš„ imports é‡ŒåŠ  AaaModuleã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa/aaa.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">AaaModule</span>], <span class="hljs-comment">// å› ä¸ºAppServiceè¦ç”¨åˆ°AaaService</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}

<span class="hljs-comment">// app.service.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa/aaa.service'</span>;

@<span class="hljs-title class_">Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppService</span> {
  <span class="hljs-comment">// AppServiceä¾èµ–AaaServiceï¼Œæ‰€ä»¥AppModuleå¿…é¡»å¯¼å…¥AaaModule</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly aaaService: AaaService</span>) {}

  <span class="hljs-title function_">getHello</span>(): string {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">aaaService</span>.<span class="hljs-title function_">doSomething</span>(); <span class="hljs-comment">// è°ƒç”¨AaaModuleçš„åŠŸèƒ½</span>
  }
}
</code></pre>
<p>å¦‚æœ AppModule é‡Œçš„ä»»ä½• provider/controller è¦ç”¨åˆ° AaaModule çš„åŠŸèƒ½ï¼Œå°±å¿…é¡»åœ¨ AppModule é‡Œå¯¼å…¥å®ƒ â€”â€” è¿™å’Œ BbbModule è¦ç”¨å°±å¿…é¡»è‡ªå·±å¯¼å…¥çš„é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯ AppModule æ˜¯æ ¹æ¨¡å—è€Œå·²ã€‚</p>
<p><strong>2. æ³¨å†Œå…¨å±€ç”Ÿæ•ˆçš„æ ¸å¿ƒæ¨¡å—</strong></p>
<p>æœ‰äº›æ¨¡å—æœ¬èº«æ˜¯ â€œåŸºç¡€è®¾æ–½â€ï¼Œéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åˆå§‹åŒ–ï¼Œå“ªæ€• AppModule è‡ªèº«ä¸ç”¨ï¼Œä¹Ÿå¾—åœ¨ AppModule é‡Œå¯¼å…¥ â€”â€” æ¯”å¦‚æ•°æ®åº“æ¨¡å—ï¼ˆTypeOrmModuleï¼‰ã€é…ç½®æ¨¡å—ï¼ˆConfigModuleï¼‰ã€è®¤è¯æ¨¡å—ï¼ˆPassportModuleï¼‰ç­‰ã€‚</p>
<p>è¿™äº›æ¨¡å—çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å®ƒä»¬çš„åˆå§‹åŒ–æ˜¯åº”ç”¨å¯åŠ¨çš„å‰æï¼Œå¿…é¡»åœ¨æ ¹æ¨¡å—å¯¼å…¥æ‰èƒ½ç”Ÿæ•ˆ</strong>ï¼Œä½†è¿™ä¸ä»£è¡¨å…¶ä»–æ¨¡å—èƒ½ç›´æ¥ç”¨ï¼ˆé™¤éåŠ  @Globalï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TypeOrmModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/typeorm'</span>; <span class="hljs-comment">// æ•°æ®åº“æ¨¡å—</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb/bbb.module'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼ˆåº”ç”¨å¯åŠ¨çš„æ ¸å¿ƒæ­¥éª¤ï¼‰</span>
    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRoot</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'mysql'</span>,
      <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
      <span class="hljs-attr">database</span>: <span class="hljs-string">'test'</span>,
      <span class="hljs-comment">// ...å…¶ä»–é…ç½®</span>
    }),
    <span class="hljs-title class_">BbbModule</span>,
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p>è¿™é‡Œ TypeOrmModule.forRoot () æ˜¯ â€œå…¨å±€åˆå§‹åŒ–æ•°æ®åº“è¿æ¥â€ï¼Œå¿…é¡»åœ¨ AppModule é‡Œå¯¼å…¥ â€”â€” å¦åˆ™æ•´ä¸ªåº”ç”¨è¿ä¸ä¸Šæ•°æ®åº“ã€‚ä½†å¦‚æœ BbbModule é‡Œè¦æ“ä½œæ•°æ®åº“è¡¨ï¼Œè¿˜æ˜¯è¦è‡ªå·±å¯¼å…¥<code>TypeOrmModule.forFeature([User])</code>ï¼Œè¿™å°±æ˜¯ <strong>æ ¹æ¨¡å—åšå…¨å±€åˆå§‹åŒ–ï¼Œå­æ¨¡å—åšå±€éƒ¨ä½¿ç”¨</strong>ã€‚</p>
<p><strong>3ï¼šæŠŠå­æ¨¡å—çº³å…¥åº”ç”¨çš„å¯åŠ¨èŒƒå›´</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// é”™è¯¯å†™æ³•ï¼šBbbModuleæ²¡è¢«ä»»ä½•æ¨¡å—å¯¼å…¥</span>
<span class="hljs-comment">// app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [], <span class="hljs-comment">// æ²¡å¯¼å…¥BbbModule</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}

<span class="hljs-comment">// bbb.controller.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">'bbb'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbController</span> {
  @<span class="hljs-title class_">Get</span>()
  <span class="hljs-title function_">getHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello Bbb!'</span>;
  }
}
</code></pre>
<p>æ­¤æ—¶è®¿é—®<code>/bbb</code>æ¥å£ä¼š 404ï¼Œå› ä¸º BbbModule æ²¡è¢« AppModule å¯¼å…¥ï¼ŒNestJS å¯åŠ¨æ—¶æ ¹æœ¬æ²¡åŠ è½½è¿™ä¸ªæ¨¡å—ã€‚</p>
<p><strong>æ­£ç¡®é€»è¾‘ï¼šAppModule å¯¼å…¥ BbbModuleï¼Œæ˜¯ä¸ºäº†è®© BbbModule è¢«åº”ç”¨è¯†åˆ«å¹¶å¯åŠ¨ã€‚</strong></p>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ ·çš„æ¨¡å—ä¸éœ€è¦åœ¨<code>AppModule</code>ä¸­importå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šé™¤äº†ä¸Šé¢ä¸‰ç§æƒ…å†µå¤–ï¼Œå…¶ä½™çš„æ¨¡å—å…¶å®éƒ½ä¸éœ€è¦åœ¨<code>AppModule</code>ä¸­å¼•å…¥ï¼Œåªæœ‰åœ¨éœ€è¦å®ƒçš„æ¨¡å—ä¸­å¼•å…¥å³å¯ã€‚</p>
<p>å‡è®¾ï¼š</p>
<ul>
<li>AaaModuleï¼šå°è£…äº† â€œç”¨æˆ·ç§¯åˆ†è®¡ç®—â€ çš„åŠŸèƒ½ï¼ˆAaaServiceï¼‰ã€‚</li>
<li>BbbModuleï¼šå¤„ç† â€œè®¢å•ç›¸å…³â€ çš„ä¸šåŠ¡ï¼Œåªæœ‰ä¸‹å•æ—¶éœ€è¦è®¡ç®—ç§¯åˆ†ï¼Œæ‰€ä»¥åªæœ‰ BbbModule éœ€è¦ç”¨ AaaModuleã€‚</li>
<li>CccModuleï¼šå¤„ç† â€œå•†å“å±•ç¤ºâ€ çš„ä¸šåŠ¡ï¼Œå®Œå…¨ç”¨ä¸åˆ°ç§¯åˆ†åŠŸèƒ½ã€‚</li>
</ul>
<p>æ­£ç¡®å†™æ³•ï¼ˆ<strong>æŒ‰éœ€å¯¼å…¥</strong>ï¼‰</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// aaa.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa.service'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AaaService</span>],
  <span class="hljs-comment">// å…³é”®ï¼šè¦æŠŠAaaServiceå¯¼å‡ºï¼Œå…¶ä»–Moduleæ‰èƒ½ç”¨</span>
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">AaaService</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AaaModule</span> {}

<span class="hljs-comment">// bbb.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../aaa/aaa.module'</span>; <span class="hljs-comment">// åªåœ¨éœ€è¦çš„åœ°æ–¹å¯¼å…¥</span>

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">AaaModule</span>], <span class="hljs-comment">// å¯¼å…¥AaaModule</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">BbbService</span>],
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">BbbController</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbModule</span> {}

<span class="hljs-comment">// app.module.tsï¼ˆæ ¹æ¨¡å—ï¼‰</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb/bbb.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CccModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ccc/ccc.module'</span>;
<span class="hljs-comment">// è¿™é‡Œä¸ç”¨å¯¼å…¥AaaModuleï¼Œå› ä¸ºåªæœ‰BbbModuleéœ€è¦</span>

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">BbbModule</span>, <span class="hljs-title class_">CccModule</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p><strong>å¦‚æœæŠŠ AaaModule ä¹ŸåŠ åˆ° AppModule çš„ imports é‡Œï¼Œè™½ç„¶åŠŸèƒ½èƒ½è·‘ï¼Œä½†å°±åƒä½ åœ¨å‰ç«¯æ ¹ç»„ä»¶é‡Œå¯¼å…¥äº†ä¸€ä¸ªåªæœ‰æŸä¸ªå­ç»„ä»¶æ‰ç”¨çš„å°å·¥å…·ï¼Œå®Œå…¨æ²¡å¿…è¦ï¼Œè¿˜ä¼šè®©æ ¹æ¨¡å—å˜è‡ƒè‚¿ã€‚</strong></p>
<h2 data-id="heading-1">å…¨å±€æ¨¡å—</h2>
<p>æ¨¡å—å¯¼å‡º providerï¼Œå¦ä¸€ä¸ªæ¨¡å—éœ€è¦ imports å®ƒæ‰èƒ½ç”¨è¿™äº› providerã€‚</p>
<p>ä½†å¦‚æœè¿™ä¸ªæ¨¡å—è¢«å¾ˆå¤šæ¨¡å—ä¾èµ–äº†ï¼Œé‚£æ¯æ¬¡éƒ½è¦ imports å°±å¾ˆéº»çƒ¦ã€‚</p>
<p>èƒ½ä¸èƒ½è®¾ç½®æˆå…¨å±€çš„ï¼Œå®ƒå¯¼å‡ºçš„ provider ç›´æ¥å¯ç”¨å‘¢ï¼Ÿ</p>
<p>åœ¨ AaaModule é‡ŒæŒ‡å®š exports çš„ providerï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95542b1e86db4b4cbfe4790340e11437~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=KubD9W1nvYUCiWJFdW7anMShqkI%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶ååœ¨ BbbModule é‡Œ importsï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f0c2a6a2df427086d3978561c26ad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=04d4szh5TNbzBnOGW3cVR0u4fe0%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·å°±å¯ä»¥åœ¨ BbbModule å†…æ³¨å…¥ AaaService äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/932791defbcd465b9294e0b2ed63cabe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=PErt9UufMxpYCDbyBhJJl5pJ8lU%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å¼•å…¥ Module çš„æ–¹å¼ã€‚</p>
<p>ä½†å¦‚æœè¿™ä¸ª AaaModule è¢«å¾ˆå¤šåœ°æ–¹å¼•ç”¨å‘¢ï¼Ÿ</p>
<p>æ¯ä¸ªæ¨¡å—éƒ½ imports å¤ªéº»çƒ¦äº†ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æŠŠå®ƒå£°æ˜ä¸ºå…¨å±€çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/726b7b8a2b7849c9a8c5d1c847617b83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=r4vbLQfD7v5LSaxX1K6uc2QR8FU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ AaaModule ä¸ŠåŠ ä¸€ä¸ª @Global çš„è£…é¥°å™¨ï¼Œç„¶ååœ¨ BbbModule é‡ŒæŠŠ AaaModule çš„ imports å»æ‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e44f1e4661d407f908853dca9f8330c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=YJ1eXx8zIDIbWfWdkaNxm0GZ8D4%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·ä¾ç„¶æ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚</p>
<p>è¿™å°±æ˜¯å…¨å±€æ¨¡å—ã€‚</p>
<p>ä¸è¿‡å…¨å±€æ¨¡å—è¿˜æ˜¯å°½é‡å°‘ç”¨ï¼Œä¸ç„¶æ³¨å…¥çš„å¾ˆå¤š provider éƒ½ä¸çŸ¥é“æ¥æºï¼Œä¼šé™ä½ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-2">åŠ¨æ€æ¨¡å—</h2>
<p>å‰é¢è®²è¿‡ï¼ŒProvider æ˜¯å¯ä»¥é€šè¿‡ useFactory åŠ¨æ€äº§ç”Ÿçš„ï¼Œé‚£ Module å¯ä¸å¯ä»¥å‘¢ï¼Ÿ</p>
<p>è‡ªç„¶æ˜¯å¯ä»¥çš„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/735b10f01ec043c3adc1c0e6df176195~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=NKS08YjOaLYtLFyWP1ZVYI%2FJQfQ%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ä¸ªæ¨¡å—æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„å†…å®¹æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ¯æ¬¡ import éƒ½æ˜¯ä¸€æ ·ã€‚</p>
<p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ› import çš„æ—¶å€™ç»™è¿™ä¸ªæ¨¡å—ä¼ ä¸€äº›å‚æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆæ¨¡å—çš„å†…å®¹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è¿™æ—¶å€™å°±éœ€è¦ Dynamic Module äº†ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DynamicModule</span>, <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.controller'</span>;

@<span class="hljs-title class_">Module</span>({})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbModule</span> {

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">register</span>(<span class="hljs-attr">options</span>: <span class="hljs-title class_">Record</span>&lt;string, any&gt;): <span class="hljs-title class_">DynamicModule</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">module</span>: <span class="hljs-title class_">BbbModule</span>,
      <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">BbbController</span>],
      <span class="hljs-attr">providers</span>: [
        {
          <span class="hljs-attr">provide</span>: <span class="hljs-string">'CONFIG_OPTIONS'</span>,
          <span class="hljs-attr">useValue</span>: options,
        },
        <span class="hljs-title class_">BbbService</span>,
      ],
      <span class="hljs-attr">exports</span>: []
    };
  }
}
</code></pre>
<p>æˆ‘ä»¬ç»™ BbbModule åŠ ä¸€ä¸ª register çš„é™æ€æ–¹æ³•ï¼Œè¿”å›æ¨¡å—å®šä¹‰çš„å¯¹è±¡ã€‚</p>
<p>å’Œåœ¨è£…é¥°å™¨é‡Œå®šä¹‰çš„æ—¶å€™çš„åŒºåˆ«ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª module å±æ€§ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006f3cfdaa6a462b971cca7f5b5e5368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=0CL7VdvswPR%2BfTuwMU1gQBTO4G0%3D" alt="image.png" loading="lazy"/></p>
<p>è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå‚æ•°ä¼ å…¥çš„ options å¯¹è±¡ä½œä¸ºä¸€ä¸ªæ–°çš„ providerã€‚</p>
<p>import çš„æ—¶å€™å°±å¾—è¿™æ ·ç”¨äº†ï¼Œé€šè¿‡ register æ–¹æ³•ä¼ å…¥å‚æ•°ï¼Œè¿”å›å€¼å°±æ˜¯æ¨¡å—å®šä¹‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80e39cfb2de48319b5f4682b91bac67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=vglqaTdIlk7cCnSvvZETPNIkuYs%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬æŠŠä¼ å…¥çš„ options é€šè¿‡ useValue åˆ›å»ºäº†ä¸ª providerï¼Œè¿™æ ·æ¨¡å—å†…éƒ¨å°±å¯ä»¥æ³¨å…¥å®ƒäº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bb5b5c5539540e7a5a3e078f33f7f66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=4xxHk5Hg5nYE9rmKv%2BgdFUlXebw%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘åœ¨ BbbController é‡Œé¢é€šè¿‡ token æ³¨å…¥è¿™ä¸ª providerï¼Œæ‰“å°ä¸‹å®ƒçš„å€¼ã€‚</p>
<p>æ”¹ä¸€ä¸‹ register çš„å‚æ•°ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/799eeede40f54d7eabbd35f13c47e972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=LS2URzsUeOVUyk%2FE%2BLU0N7VFzBI%3D" alt="image.png" loading="lazy"/></p>
<p>æµè§ˆå™¨å†è®¿é—®ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº† config å¯¹è±¡ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ import ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œä¼ å…¥å‚æ•°ï¼Œç„¶ååŠ¨æ€ç”Ÿæˆæ¨¡å—çš„å†…å®¹ã€‚</p>
<p>è¿™å°±æ˜¯ Dynamic Moduleã€‚</p>
<p>è¿™é‡Œçš„ register æ–¹æ³•å…¶å®å«å•¥éƒ½è¡Œï¼Œä½† nest çº¦å®šäº† 3 ç§æ–¹æ³•åï¼š</p>
<ul>
<li>register</li>
<li>forRoot</li>
<li>forFeature</li>
</ul>
<p>æˆ‘ä»¬çº¦å®šå®ƒä»¬åˆ†åˆ«ç”¨æ¥åšä¸åŒçš„äº‹æƒ…ï¼š</p>
<ul>
<li>registerï¼šç”¨ä¸€æ¬¡æ¨¡å—ä¼ ä¸€æ¬¡é…ç½®ï¼Œæ¯”å¦‚è¿™æ¬¡è°ƒç”¨æ˜¯ BbbModule.register({aaa:1})ï¼Œä¸‹ä¸€æ¬¡å°±æ˜¯ BbbModule.register({aaa:2}) äº†</li>
<li>forRootï¼šé…ç½®ä¸€æ¬¡æ¨¡å—ç”¨å¤šæ¬¡ï¼Œæ¯”å¦‚ XxxModule.forRoot({}) ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸€ç›´ç”¨è¿™ä¸ª Moduleï¼Œä¸€èˆ¬åœ¨ AppModule é‡Œ import</li>
<li>forFeatureï¼šç”¨äº† forRoot å›ºå®šäº†æ•´ä½“æ¨¡å—ï¼Œç”¨äºå±€éƒ¨çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦å†ä¼ ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚ç”¨ forRoot æŒ‡å®šäº†æ•°æ®åº“é“¾æ¥ä¿¡æ¯ï¼Œå†ç”¨ forFeature æŒ‡å®šæŸä¸ªæ¨¡å—è®¿é—®å“ªä¸ªæ•°æ®åº“å’Œè¡¨ã€‚</li>
</ul>
<p>å…‰è¿™ä¹ˆè¯´å¯èƒ½ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªçœŸå®çš„åŠ¨æ€æ¨¡å—å°±æ‡‚äº†ã€‚</p>
<p>æ¯”å¦‚ @nestjs/typeorm çš„åŠ¨æ€æ¨¡å—ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fecd81f45d74f679cf3c1fbbead0b36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=nuSHCwbpPeYXh6cRzAN61yMWWsQ%3D" alt="image.png" loading="lazy"/></p>
<p>forRoot ä¼ å…¥é…ç½®ï¼Œç„¶åè°ƒç”¨äº†<code>TypeOrmCoreModule</code>æ¨¡å—çš„<code>forRoot</code>æ–¹æ³•ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4459558010b0447b8ccca850fa3a63fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=Jd166PC0IhXXXNCfT8NWbUJyCeQ%3D" alt="image.png" loading="lazy"/></p>
<p>å®ƒåŠ¨æ€äº§ç”Ÿ provider å’Œ exportsï¼Œè¿”å›æ¨¡å—å®šä¹‰ã€‚</p>
<p>forFeature åˆ™æ˜¯ä¼ å…¥å±€éƒ¨çš„ä¸€äº›é…ç½®ï¼Œæ¥åŠ¨æ€äº§ç”Ÿå±€éƒ¨ç”¨çš„æ¨¡å—ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8be65f9f0f4c978e1e25ba67c95392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=LJKmlQHwXQ4b3puQy3THV8wtqcU%3D" alt="image.png" loading="lazy"/></p>
<p>typeorm çš„æ¨¡å—ç”¨èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d8574a6cd674b618a6d81f4543e4e6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=6bVzbyCXW2ntvULN1st8twcn7ck%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/408b967e346040f594f21eb3532b9b68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=9f9kdNNrm7bRqsiso0BmZBosIFk%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ AppModule é‡Œ import é€šè¿‡ forRoot åŠ¨æ€äº§ç”Ÿçš„æ¨¡å—ï¼Œåœ¨å…·ä½“çš„ä¸šåŠ¡ Module é‡Œï¼Œé€šè¿‡ forFeature ä¼ å…¥å…·ä½“å®ä½“ç±»çš„é…ç½®ã€‚</p>
<p>å…¶å® forRootã€forFeatureã€register æœ‰åŒºåˆ«ä¹ˆï¼Ÿ</p>
<p><strong>æœ¬è´¨ä¸Šæ²¡åŒºåˆ«ï¼Œåªæ˜¯æˆ‘ä»¬çº¦å®šäº†å®ƒä»¬ä½¿ç”¨ä¸Šçš„ä¸€äº›åŒºåˆ«</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™]]></title>    <link>https://juejin.cn/post/7598499504170188838</link>    <guid>https://juejin.cn/post/7598499504170188838</guid>    <pubDate>2026-01-24T04:05:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170188838" data-draft-id="7597083743555895339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-24T04:05:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:05:45.000Z" title="Sat Jan 24 2026 04:05:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰è¨€</p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–¹æ¡ˆç¯‡ä¸­ï¼Œæˆ‘ä»¬æ„æ€äº†â€œAI é€»è¾‘æ²™ç›’â€çš„åŒå±‚å®å¥‘çº¦ï¼šé€šè¿‡Â <code>define</code>Â ä¸Â <code>apply</code>Â æ¨¡å¼ï¼Œå°† AI çš„ç ´ååŠå¾„é”æ­»åœ¨å—é™çš„ç¯å¢ƒä¸­ã€‚</p>
<p>ä½†æ¶æ„è®¾è®¡å¦‚æœä¸è½å®ä¸ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå°±åªæ˜¯çº¸ä¸Šè°ˆå…µã€‚åœ¨ 2026 å¹´çš„å¼€å‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬è¿½æ±‚çš„æ˜¯ <strong>â€œå¼€å‘æ€æé«˜å‹çº¦æŸï¼Œè¿è¡Œæ€é›¶å¼€é”€è„±ç¦»â€</strong> ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¿›å…¥æ·±æ°´åŒºï¼Œæ¢è®¨å¦‚ä½•åˆ©ç”¨Â <strong>TypeScript Compiler APIã€ESLint å®šåˆ¶è§„åˆ™ä»¥åŠç¼–è¯‘æ—¶å®å¤„ç†</strong>ï¼Œå°†è¿™å¥—é€»è¾‘æ‰“é€ æˆä¸€å¥—é—­ç¯çš„è‡ªåŠ¨åŒ–å‡†å…¥ä½“ç³»ã€‚</p>
<hr/>
<p>ä¸€ã€ è‡ªåŠ¨åŒ–åŸºçŸ³ï¼šä»â€œå®å£°æ˜â€åˆ°â€œè§„åˆ™æ˜ å°„â€</p>
<p>æ‰‹åŠ¨ç»´æŠ¤æ¯ä¸ª AI æ–‡ä»¶å¤¹çš„é…ç½®æ˜¯ä¸å¯æŒç»­çš„ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š<strong>æ¶æ„å¸ˆä¿®æ”¹ä¸€è¡Œ TS ç±»å‹å®šä¹‰ï¼Œå·¥ç¨‹ç¯å¢ƒè‡ªåŠ¨å®Œæˆâ€œå¸ƒé˜²â€ã€‚</strong></p>
<ol>
<li>é™æ€æ‰«æå™¨ (The Scanner)</li>
</ol>
<p>æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª Node.js è„šæœ¬ï¼ˆåˆ©ç”¨Â <code>ts-morph</code>Â æˆ– SWC çš„è§£æèƒ½åŠ›ï¼‰ï¼Œä¸“é—¨æ‰«æå®¿ä¸»ä¾§çš„æƒé™å£°æ˜ã€‚</p>
<ul>
<li>
<p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<ol>
<li>è¯†åˆ«Â <code>defineEnvContext&lt;T&gt;</code>Â è°ƒç”¨çš„ä½ç½®ã€‚</li>
<li>é™æ€è§£ææ³›å‹Â <code>T</code>Â ä¸­çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœÂ <code>T</code>Â æ˜¯Â <code>Pick&lt;Window, 'addEventListener' | 'removeEventListener'&gt;</code>ï¼Œè„šæœ¬å°†æå–å‡ºÂ <code>window</code>Â åŠå…¶æˆå¯¹çš„æˆæƒå±æ€§ã€‚<strong>è¿™ç§æˆå¯¹æˆæƒæ˜¯å¿…é¡»çš„ï¼Œå®ƒç¡®ä¿äº† AI å…·å¤‡æ¸…ç†å‰¯ä½œç”¨çš„èƒ½åŠ›ï¼Œä»æ ¹æºè§„é¿å†…å­˜æ³„éœ²ã€‚</strong></li>
<li>è§£æÂ <code>defineImportContext&lt;T&gt;</code>Â ä¸­å®šä¹‰çš„å¤–éƒ¨æ¨¡å—æ˜ å°„è·¯å¾„ã€‚</li>
</ol>
</li>
</ul>
<ol start="2">
<li>é…ç½®è‡ªåŠ¨ç”Ÿæˆ (The Generator)</li>
</ol>
<p>è„šæœ¬æ‰«æå®Œæˆåï¼Œä¼šç«‹å³åœ¨å¯¹åº”çš„Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ/æ›´æ–°ä¸¤ä¸ªå…³é”®çš„â€œå›´å¢™â€æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p><strong>ç”ŸæˆÂ <code>.eslintrc.js</code></strong>ï¼š<br/>
<strong>å¿…é¡»è®¾ç½®Â <code>root: true</code></strong>ã€‚è¿™æ˜¯ä¸ºäº†å½»åº•åˆ‡æ–­çˆ¶çº§ç›®å½•ä¸­å¯èƒ½å­˜åœ¨çš„â€œå®½æ¾è§„åˆ™â€å¹²æ‰°ï¼Œç¡®ä¿æ²™ç›’è§„åˆ™çš„çº¯å‡€ã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// /src/ai_modules/xxx/.eslintrc.js</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  root: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ ¸å¿ƒï¼šæ–­ç»çˆ¶çº§è§„åˆ™åˆå¹¶ï¼Œå»ºç«‹ç‹¬ç«‹â€œæ³•å¾‹ä½“ç³»â€</span>
  env: {
    browser: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç¦ç”¨é»˜è®¤ç¯å¢ƒï¼Œé˜²æ­¢éšå¼é€ƒé€¸</span>
    es2022: <span class="hljs-literal">true</span>
  },
  rules: {
    <span class="hljs-string">"no-undef"</span>: <span class="hljs-string">"error"</span>, <span class="hljs-comment">// é…åˆæŠ¹é™¤ DOM åº“ï¼Œç¦æ­¢ç›´æ¥è®¿é—®å…¨å±€å˜é‡</span>
    <span class="hljs-comment">// è¿™é‡Œçš„ "error" æ˜¯ç­‰çº§ï¼ˆSeverityï¼‰ï¼Œç¡®ä¿ä»»ä½•è¿è§„ä»£ç éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘</span>
    <span class="hljs-string">"no-restricted-globals"</span>: [<span class="hljs-string">"error"</span>, <span class="hljs-string">"window"</span>, <span class="hljs-string">"document"</span>, <span class="hljs-string">"location"</span>, <span class="hljs-string">"localStorage"</span>], 
    <span class="hljs-string">"no-restricted-syntax"</span>: [
      <span class="hljs-string">"error"</span>,
      {
        <span class="hljs-comment">// ä»…å…è®¸ä»æˆ‘ä»¬çš„å®è§£æ„å‡ºçš„å˜é‡ï¼Œç¦æ­¢ç»•è¿‡å®ç›´æ¥è°ƒç”¨</span>
        <span class="hljs-string">"selector"</span>: <span class="hljs-string">"VariableDeclarator[init.callee.name='applyEnvContext'] &gt; ObjectPattern &gt; Property"</span>,
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"è§£æ„å˜é‡æœªåœ¨å®¿ä¸» define å®ä¸­æˆæƒã€‚"</span>
      }
    ]
  }
};
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
</li>
<li>
<p><strong>ç”ŸæˆÂ <code>tsconfig.json</code></strong>ï¼š<br/>
é€šè¿‡Â <code>compilerOptions.paths</code>Â å°†å…¨å±€ç±»å‹é‡å®šå‘åˆ°æˆ‘ä»¬ç”Ÿæˆçš„<strong>å—é™ .d.ts å®šä¹‰</strong>ï¼Œç¡®ä¿ AI ç¼–å†™æ—¶ IDE æç¤ºä»…åŒ…å«è¢«Â <code>Pick</code>Â å‡ºæ¥çš„å®‰å…¨å±æ€§ã€‚</p>
</li>
</ul>
<hr/>
<p>äºŒã€ ç¼–è¯‘æ—¶é­”æ³•ï¼šå®çš„â€œå½»åº•æ¶ˆå¤±æœ¯â€</p>
<p>å®ï¼ˆMacrosï¼‰çš„æœ¬è´¨æ˜¯â€œå¼€å‘æ€çš„ä¸¥æ ¼çº¦æŸï¼Œç”Ÿäº§æ€çš„çº¯å‡€å¹»è§‰â€ã€‚åœ¨æ„å»ºé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç¼–è¯‘å™¨æ’ä»¶è¿›è¡Œç‰©ç†å¤„ç†ã€‚</p>
<p>1.Â <code>applyEnvContext</code>Â çš„è¿è¡Œæ—¶è„±é™¤</p>
<p>è¿™æ˜¯æ–¹æ¡ˆæœ€ä¼˜é›…ä¹‹å¤„ï¼š<strong>ç”±äºå®¿ä¸»ç¯å¢ƒå¤©ç„¶å­˜åœ¨å…¨å±€å¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¼–è¯‘æ—¶æŠŠå®â€œåˆ æ‰â€å³å¯ã€‚</strong></p>
<ul>
<li><strong>è½¬æ¢å‰ï¼ˆAI æºç ï¼‰</strong> ï¼š<br/>
<code>const { window } = applyEnvContext&lt;GlobalApi&gt;();</code></li>
<li><strong>è½¬æ¢åï¼ˆäº§ç‰©ä»£ç ï¼‰</strong> ï¼š<br/>
<code>const { window } = globalThis;</code>ï¼ˆæˆ–ç›´æ¥ç‰©ç†ç§»é™¤ï¼Œè®©å˜é‡å¼•ç”¨å›é€€åˆ°åŸç”Ÿå…¨å±€è®¿é—®ï¼‰ã€‚</li>
<li><strong>å·¥ç¨‹æ„ä¹‰</strong>ï¼šå¼€å‘æ€é€šè¿‡å®å®ç°<strong>è§£æ„å˜é‡</strong>å¹¶<strong>èµ‹äºˆå—é™ç±»å‹</strong>ä»¥é€šè¿‡å®¡è®¡ï¼›æ„å»ºæ€åˆ™è®©å…¶æ¶ˆå¤±ï¼Œä¿è¯äº§ç‰©é›¶å¼€é”€ã€‚</li>
</ul>
<p>2.Â <code>applyImportContext</code>Â çš„é€»è¾‘æå‡</p>
<p>ä¸ç¯å¢ƒå®ä¸åŒï¼Œç¬¬ä¸‰æ–¹æ¨¡å—éœ€è¦çœŸå®çš„å¼•å…¥é€»è¾‘ã€‚</p>
<ul>
<li><strong>å¤„ç†é€»è¾‘</strong>ï¼šç¼–è¯‘å™¨æ‰«æè¯¥å®ï¼Œæ ¹æ®æ˜ å°„å…³ç³»åœ¨æ–‡ä»¶é¡¶éƒ¨æ’å…¥Â <code>import debounce from 'lodash/debounce'</code>ï¼Œéšååˆ é™¤åŸå§‹å®è°ƒç”¨è¡Œã€‚</li>
</ul>
<hr/>
<p>ä¸‰ã€ é˜²å¾¡æ€§å®¡è®¡ï¼šå¦‚ä½•é˜²æ­¢ AI â€œé€ƒé€¸â€ï¼Ÿ</p>
<p>AI å¯èƒ½ä¼šå°è¯•åˆ©ç”¨å…ˆéªŒçŸ¥è¯†ï¼Œé€šè¿‡Â <code>window['loc' + 'ation']</code>Â è¿™ç§æ‰‹æ®µç»•è¿‡é™æ€æ‹¦æˆªã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â å†…å®æ–½Â  <strong>â€œé›¶ä¿¡ä»»å®¡è®¡â€</strong> ï¼š</p>
<ol>
<li><strong>ç¦æ­¢æˆå‘˜è¡¨è¾¾å¼åŠ¨æ€è®¿é—®</strong>ï¼šé€šè¿‡ ESLint æ‹¦æˆªÂ <code>MemberExpression</code>Â çš„è®¡ç®—å±æ€§è®¿é—®ï¼Œå¼ºåˆ¶è¦æ±‚ API è°ƒç”¨å¿…é¡»æ˜¯é™æ€å¯è§çš„ã€‚</li>
<li><strong>å¼ºåˆ¶å•ä¸€å…¥å£</strong>ï¼šç¦æ­¢ä»»ä½•éå®å£°æ˜çš„å¤–éƒ¨Â <code>import</code>ã€‚æ‰€æœ‰ä¾èµ–å¿…é¡»é€šè¿‡Â <code>applyImportContext</code>Â ç”³è¯·ã€‚</li>
<li><strong>äºŒæ¬¡ç¼–è¯‘æ ¡éªŒ</strong>ï¼šåœ¨æ„å»ºæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹è§£æ„çš„å±æ€§è¿›è¡ŒäºŒæ¬¡æ ¸å¯¹ã€‚å¦‚æœ AI è¯•å›¾è§£æ„ä¸€ä¸ªæœªç»Â <code>define</code>Â æˆæƒçš„å±æ€§ï¼Œ<strong>æ„å»ºå°†ç›´æ¥é˜»æ–­</strong>ã€‚</li>
</ol>
<hr/>
<p>å››ã€ æ¶æ„æ€»ç»“ï¼šå°†æƒåŠ›å…³è¿›â€œåŸºå»ºâ€çš„ç¬¼å­</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€å¥—å®Œæ•´çš„Â <strong>AI åŸç”Ÿå·¥ç¨‹æ²»ç†æµæ°´çº¿</strong>ï¼š</p>
<ol>
<li><strong>æ¶æ„å¸ˆï¼ˆäººï¼‰</strong> ï¼šåœ¨å®¿ä¸»å±‚é€šè¿‡Â <code>define</code>Â å®æ‹¨å‘å¾®å°çš„ã€ç»è¿‡Â <code>Pick</code>Â è£å‰ªçš„æƒé™ã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>ï¼šå°†æƒé™å®æ—¶æ˜ å°„ä¸ºæ²™ç›’å†…éƒ¨çš„Â <code>root: true</code>Â çš„ ESLint è§„åˆ™ä¸Â <code>TSConfig</code>ã€‚</li>
<li><strong>AIï¼ˆæ‰§è¡Œè€…ï¼‰</strong> ï¼šåœ¨å—é™çš„Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â å†…ï¼Œé€šè¿‡Â <code>apply</code>Â å®è¡Œä½¿èƒ½åŠ›ã€‚</li>
<li><strong>ç¼–è¯‘å™¨ï¼ˆæ‹¦æˆªè€…ï¼‰</strong> ï¼šåœ¨æ„å»ºæ—¶æ ¡éªŒå¹¶æŠ¹é™¤æ‰€æœ‰å®é€»è¾‘ï¼Œäº§å‡ºçº¯å‡€ä»£ç ã€‚</li>
</ol>
<p><strong>åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œäººæ‹…è´£çš„å‹åŠ›è¢«é™åˆ°äº†æœ€ä½ã€‚</strong> Â ä½ ä¸å†éœ€è¦æ­»ç£•ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦å®¡è®¡é‚£å‡ è¡Œâ€œå¥‘çº¦â€ã€‚ä¾‹å¦‚ï¼š <strong>â€œAI ç”³è¯·äº† addEventListener ä½†æ²¡æœ‰ç”³è¯· removeEventListenerï¼Œè¿™æ˜¯å¦ä¼šå¼•å…¥å†…å­˜é£é™©ï¼Ÿâ€</strong> Â è¿™ç§åŸºäºæƒé™è¾¹ç•Œçš„å®¡è®¡ï¼Œæ‰æ˜¯çœŸæ­£çš„é«˜æ•ˆã€‚</p>
<hr/>
<p>ç»“è¯­</p>
<p>ã€ŒAI é€»è¾‘æ²™ç›’ã€ä¸ä»…æ˜¯ä¸€å¥—å·¥å…·ï¼Œå®ƒä»£è¡¨äº†æˆ‘ä»¬åœ¨ 2026 å¹´å¯¹<strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>çš„ç»ˆæå®è·µã€‚</p>
<p>æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªåˆ†æ°´å²­ï¼šä¸€è¾¹æ˜¯ Vibe Coding å¸¦æ¥çš„ç”Ÿäº§åŠ›ç‹‚æ¬¢ï¼Œä¸€è¾¹æ˜¯å·¥ç¨‹ä¸¥è°¨æ€§çš„å´©å¡Œã€‚è€Œè¿™å¥—æ–¹æ¡ˆè¯•å›¾åœ¨ä¸¤è€…ä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ï¼š<strong>ç”¨æœ€ç¡¬æ ¸çš„åŸºå»ºï¼Œå»æ‹¥æŠ±æœ€ä¸ç¡®å®šçš„ AI ç”Ÿäº§åŠ›ã€‚</strong></p>
<p>æ„Ÿè°¢é˜…è¯»ç³»åˆ—æ–‡ç« ã€ŠAI åŸç”Ÿå·¥ç¨‹ï¼šé€»è¾‘æ²™ç›’ä¸é›¶ä¿¡ä»»ä»£ç æ²»ç†ã€‹ã€‚è¿™åœºå…³äº AI å‡†å…¥çš„é©å‘½ï¼Œæ‰åˆšåˆšå¼€å§‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼]]></title>    <link>https://juejin.cn/post/7598418891401379894</link>    <guid>https://juejin.cn/post/7598418891401379894</guid>    <pubDate>2026-01-24T04:08:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598418891401379894" data-draft-id="7593292445301047315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-24T04:08:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éœæµ¦å°ç å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/1996368847058071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1996368847058071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éœæµ¦å°ç å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:08:32.000Z" title="Sat Jan 24 2026 04:08:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸€ä¸ªå†™äº†å¤šå¹´ TypeScript çš„å‰ç«¯å¼€å‘è€é¸Ÿã€‚ä»Šå¤©ï¼Œæˆ‘è¦å’Œå¤§å®¶åˆ†äº«ä¸€äº›å…³äº TypeScript çš„æœ€ä½³å®è·µã€‚è¿™äº›ç»éªŒéƒ½æ˜¯æˆ‘åœ¨æ— æ•°æ¬¡è¸©å‘åæ€»ç»“å‡ºæ¥çš„ï¼Œå¸Œæœ›èƒ½è®©ä½ å°‘èµ°å¼¯è·¯ï¼Œç›´æ¥æˆä¸º TypeScript çš„å¤§ä½¬ã€‚å½“ç„¶ï¼Œåˆ†äº«çš„è¿‡ç¨‹ä¹Ÿä¸ä¼šæ¯ç‡¥æ— å‘³ï¼Œæ¯•ç«Ÿç¼–ç¨‹å˜›ï¼Œå¼€å¿ƒæœ€é‡è¦ï¼</p>
<h2 data-id="heading-0">TypeScript æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h2>
<p>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å¬è¯´ TypeScriptï¼Œå¯èƒ½ä¼šæœ‰ç‚¹æ‡µï¼šâ€œTypeScriptï¼Ÿè¿™åå­—å¬èµ·æ¥å¥½é«˜å¤§ä¸Šï¼Œä½†åˆ°åº•æ˜¯å•¥ï¼Ÿâ€</p>
<p>ç®€å•æ¥è¯´ï¼ŒTypeScript æ˜¯ JavaScript çš„è¶…é›†ï¼Œå®ƒåœ¨ JS çš„åŸºç¡€ä¸Šå¢åŠ äº†<strong>é™æ€ç±»å‹æ£€æŸ¥</strong>ã€‚è¿™å°±åƒåœ¨ä½ å†™ä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªè´´å¿ƒçš„â€œä¿å§†â€åœ¨æ—è¾¹æé†’ä½ ï¼šâ€œå˜¿ï¼Œè¿™ä¸ªå˜é‡ç±»å‹ä¸å¯¹å“¦ï¼â€æˆ–è€…â€œä½ ç¡®å®šè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ•°å­—å—ï¼Ÿâ€æœ‰äº† TypeScriptï¼Œä½ å°±å¯ä»¥åœ¨å†™ä»£ç æ—¶å‡å°‘å¾ˆå¤šä½çº§é”™è¯¯ã€‚</p>
<p>ä¸è¿‡ï¼ŒTypeScript ä¹Ÿæœ‰ä¸€ä¸ªâ€œå‘çˆ¹â€çš„åœ°æ–¹â€”â€”å®ƒå¤ªä¸¥æ ¼äº†ï¼åˆšå¼€å§‹ç”¨çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è‡ªå·±è¢«ç»‘æ‰‹ç»‘è„šã€‚ä½†æ…¢æ…¢åœ°ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ç§â€œä¸¥æ ¼â€å…¶å®æ˜¯å¯¹ä½ çš„çˆ±å•Šï¼å®ƒèƒ½å¸®ä½ å†™å‡ºæ›´å¥å£®ã€æ›´å®‰å…¨çš„ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-1">å…¥é—¨å¿…å¤‡ï¼šTypeScript çš„æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µã€‚å¦‚æœä½ å·²ç»æ˜¯è€æ‰‹ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€èŠ‚ï¼ˆä½†æˆ‘çŒœä½ ä¸ä¼šï¼Œå› ä¸ºæˆ‘çš„æ–‡ç« è¿™ä¹ˆæœ‰è¶£ï¼‰ã€‚</p>
<h3 data-id="heading-2">1. ç±»å‹ï¼ˆTypeï¼‰</h3>
<p>TypeScript æœ€æ ¸å¿ƒçš„å°±æ˜¯<strong>ç±»å‹</strong>ã€‚å®ƒä¼šè®©ä½ çš„ä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// age æ˜¯ä¸€ä¸ªæ•°å­—</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'å°æ˜'</span>; <span class="hljs-comment">// name æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">isHappy</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// isHappy æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼</span>
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½†å¦‚æœä½ å†™æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-string">'25'</span>; <span class="hljs-comment">// æŠ¥é”™ï¼å­—ç¬¦ä¸²ä¸èƒ½èµ‹å€¼ç»™æ•°å­—ç±»å‹</span>
</code></pre>
<p>TypeScript ä¼šç«‹åˆ»è·³å‡ºæ¥ï¼šâ€œå…„å¼Ÿï¼Œä½ æ˜¯ä¸æ˜¯å†™é”™äº†ï¼Ÿâ€è¿™å°±æ˜¯å®ƒçš„é­…åŠ›â€”â€”å¸®ä½ åœ¨å¼€å‘é˜¶æ®µå°±å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯ç­‰åˆ°çº¿ä¸Šå‡º bug å†è¢«äº§å“ç»ç†è¿½ç€æ‰“ã€‚</p>
<h3 data-id="heading-3">2. æ¥å£ï¼ˆInterfaceï¼‰</h3>
<p>æ¥å£æ˜¯ TypeScript çš„å¦ä¸€å¤§æ€æ‰‹é”ã€‚å®ƒå¯ä»¥ç”¨æ¥å®šä¹‰å¯¹è±¡çš„ç»“æ„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">student</span>: <span class="hljs-title class_">Person</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,
};
</code></pre>
<p>å¦‚æœä½ å°‘å†™äº†æŸä¸ªå±æ€§ï¼Œæ¯”å¦‚ <code>age</code>ï¼ŒTypeScript ä¼šç«‹åˆ»æŠ¥è­¦ï¼šâ€œå–‚ï¼Œä½ æ˜¯ä¸æ˜¯å¿˜äº†å•¥ï¼Ÿâ€</p>
<h3 data-id="heading-4">3. æ³›å‹ï¼ˆGenericsï¼‰</h3>
<p>æ³›å‹å¬èµ·æ¥å¾ˆé«˜æ·±ï¼Œä½†å…¶å®å¾ˆå¥½ç†è§£ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œæ¨¡æ¿â€ï¼Œå¯ä»¥è®©ä½ çš„ä»£ç æ›´åŠ çµæ´»ï¼Œå°±åƒä½ å»ä¹°è¡£æœï¼Œå•†å®¶å‘Šè¯‰ä½ â€œè¿™è¡£æœæ˜¯å‡ç çš„ï¼Œèƒ–ç˜¦é«˜çŸ®éƒ½èƒ½ç©¿â€ï¼Œè¿™å°±æ˜¯æ³›å‹çš„æ ¸å¿ƒæ€æƒ³ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> getArray&lt;T&gt;(<span class="hljs-attr">items</span>: T[]): T[] {
  <span class="hljs-keyword">return</span> items;
}

<span class="hljs-keyword">const</span> numberArray = getArray&lt;<span class="hljs-built_in">number</span>&gt;([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-keyword">const</span> stringArray = getArray&lt;<span class="hljs-built_in">string</span>&gt;([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]);
</code></pre>
<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆå‰å®³ï¼Ÿç”¨æ³›å‹ï¼Œä½ å¯ä»¥å†™å‡ºæ›´åŠ é€šç”¨çš„ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-5">å®æˆ˜æŠ€å·§ï¼šå¦‚ä½•ç”¨å¥½ TypeScriptï¼Ÿ</h2>
<p>äº†è§£äº†åŸºç¡€æ¦‚å¿µåï¼Œæˆ‘ä»¬æ¥èŠèŠä¸€äº›å®ç”¨çš„æŠ€å·§ã€‚è¿™äº›éƒ½æ˜¯æˆ‘è¸©è¿‡æ— æ•°å‘åæ€»ç»“å‡ºæ¥çš„ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<h3 data-id="heading-6">1. æ°¸è¿œå¼€å¯ä¸¥æ ¼æ¨¡å¼</h3>
<p>TypeScript æœ‰ä¸€ä¸ªé€‰é¡¹å« <code>strict</code>ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚ä½†æˆ‘å»ºè®®ä½ <strong>ä¸€å®šè¦æ‰“å¼€</strong>ï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸¥æ ¼æ¨¡å¼ä¼šè®© TypeScript æ›´åŠ â€œæŒ‘å‰”â€ï¼Œä»è€Œå¸®ä½ å‘ç°æ›´å¤šæ½œåœ¨é—®é¢˜ã€‚</p>
<p>åœ¨ <code>tsconfig.json</code> ä¸­è®¾ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åˆšå¼€å§‹å¯èƒ½ä¼šæœ‰ç‚¹ç—›è‹¦ï¼Œå› ä¸º TypeScript ä¼šç–¯ç‹‚åœ°æŒ‡å‡ºä½ çš„é”™è¯¯ã€‚ä½†ç›¸ä¿¡æˆ‘ï¼Œè¿™ç§ç—›è‹¦æ˜¯å€¼å¾—çš„ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„ä»£ç è´¨é‡æå‡äº†ä¸€å¤§æˆªï¼</p>
<h3 data-id="heading-7">2. å–„ç”¨ <code>any</code>ï¼Œä½†ä¸è¦æ»¥ç”¨</h3>
<p><code>any</code> æ˜¯ TypeScript ä¸­çš„â€œä¸‡é‡‘æ²¹â€ç±»å‹ï¼Œå®ƒå¯ä»¥æ¥å—ä»»ä½•å€¼ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">something</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">'hello'</span>;
something = <span class="hljs-number">42</span>; <span class="hljs-comment">// å®Œå…¨æ²¡é—®é¢˜ï¼</span>
</code></pre>
<p>è™½ç„¶ <code>any</code> ç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä½†åƒä¸‡ä¸è¦æ»¥ç”¨ï¼å› ä¸ºä¸€æ—¦ç”¨äº† <code>any</code>ï¼ŒTypeScript çš„ç±»å‹æ£€æŸ¥å°±å¤±æ•ˆäº†ã€‚æ­£ç¡®çš„å§¿åŠ¿æ˜¯ï¼š<strong>åªåœ¨ä¸‡ä¸å¾—å·²æ—¶æ‰ç”¨ <code>any</code>ï¼Œå°½é‡ç”¨æ›´å…·ä½“çš„ç±»å‹æ›¿ä»£å®ƒ</strong>ã€‚</p>
<h3 data-id="heading-8">3. å­¦ä¼šä½¿ç”¨ç±»å‹æ¨æ–­</h3>
<p>TypeScript çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨æ¨æ–­å˜é‡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> count = <span class="hljs-number">10</span>; <span class="hljs-comment">// TS è‡ªåŠ¨æ¨æ–­ count æ˜¯ number ç±»å‹</span>
</code></pre>
<p>æ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ä½ ä¸éœ€è¦æ˜¾å¼åœ°å†™å‡ºç±»å‹å£°æ˜ã€‚è¿™æ ·ä¸ä»…å‡å°‘äº†ä»£ç é‡ï¼Œè¿˜èƒ½è®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚</p>
<h3 data-id="heading-9">4. ä½¿ç”¨è”åˆç±»å‹å’Œç±»å‹ä¿æŠ¤</h3>
<p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªå˜é‡å¯èƒ½æœ‰å¤šç§ç±»å‹ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printId</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> id === <span class="hljs-string">'string'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ID æ˜¯å­—ç¬¦ä¸²ï¼š'</span> + id.<span class="hljs-title function_">toUpperCase</span>());
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ID æ˜¯æ•°å­—ï¼š'</span> + id.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>));
  }
}
</code></pre>
<p>è¿™å«åš<strong>è”åˆç±»å‹</strong>ï¼Œè€Œé€šè¿‡ <code>typeof</code> åˆ¤æ–­ç±»å‹çš„è¿‡ç¨‹å«åš<strong>ç±»å‹ä¿æŠ¤</strong>ã€‚å®ƒèƒ½è®©ä½ çš„ä»£ç æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚</p>
<hr/>
<h2 data-id="heading-10">TypeScript çš„å†…ç½®ç±»å‹ï¼šè®©ä½ å°‘å†™ 100 è¡Œä»£ç </h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬èŠèŠ TypeScript è‡ªå¸¦çš„ä¸€äº›â€œé»‘ç§‘æŠ€â€â€”â€”å†…ç½®ç±»å‹ã€‚å®ƒä»¬å°±åƒè¶…å¸‚é‡Œçš„é€Ÿé£Ÿé£Ÿå“ï¼Œç›´æ¥æ‹¿æ¥ç”¨ï¼Œçœæ—¶çœåŠ›ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„â€œæ˜æ˜Ÿé€‰æ‰‹â€ï¼š</p>
<h3 data-id="heading-11">1. <code>Required&lt;T&gt;</code>ï¼šè®©ä½ çš„å±æ€§å˜å¾—â€œå¿…å¡«â€</h3>
<p>æœ‰æ—¶å€™ï¼Œä½ å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æŸäº›å±æ€§æ˜¯å¯é€‰çš„ï¼ˆç”¨ <code>?</code> æ ‡è®°ï¼‰ã€‚çªç„¶æœ‰ä¸€å¤©ï¼Œè€æ¿è¯´ï¼šâ€œä¸è¡Œï¼è¿™äº›å±æ€§å¿…é¡»å…¨éƒ½æœ‰ï¼â€è¿™æ—¶å€™ä½ å°±å¯ä»¥ç”¨ <code>Required&lt;T&gt;</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  name?: <span class="hljs-built_in">string</span>;
  age?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">user1</span>: <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">User</span>&gt; = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°æ˜"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,
}; <span class="hljs-comment">// å¦‚æœå°‘å¡«ä¸€ä¸ªå±æ€§ï¼ŒTS å°±ä¼šæŠ¥é”™</span>
</code></pre>
<p><code>Required&lt;T&gt;</code> çš„ä½œç”¨å°±æ˜¯æŠŠæ‰€æœ‰å¯é€‰å±æ€§å˜æˆå¿…å¡«å±æ€§ã€‚è€æ¿å†ä¹Ÿä¸ä¼šåœ¨ä»£ç å®¡æŸ¥æ—¶æ‹æ¡Œå­äº†ï¼</p>
<hr/>
<h3 data-id="heading-12">2. <code>Omit&lt;T, K&gt;</code>ï¼šç²¾ç¡®å‰ªè£å¯¹è±¡</h3>
<p>å‡å¦‚ä½ æœ‰ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œä½†æœ‰äº›å±æ€§ä½ ä¸æƒ³è¦ï¼ˆæ¯”å¦‚è€æ¿è¦æ±‚çš„æ•°æ®ç»Ÿè®¡å­—æ®µï¼‰ï¼Œè¿™æ—¶å€™ <code>Omit&lt;T, K&gt;</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PublicUser</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">"password"</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-attr">user2</span>: <span class="hljs-title class_">PublicUser</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°çº¢"</span>,
}; <span class="hljs-comment">// password è¢«æˆåŠŸâ€œå‰ªæ‰â€ï¼</span>
</code></pre>
<p><code>Omit&lt;T, K&gt;</code> çš„ä½œç”¨å°±æ˜¯ä»å¯¹è±¡ä¸­â€œå‰”é™¤â€æŸäº›å±æ€§ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨å‰ªèœå¶ï¼ŒæŠŠä¸æƒ³è¦çš„éƒ¨åˆ†ä¸¢æ‰ï¼Œåªç•™ä¸‹ç²¾åéƒ¨åˆ†ã€‚</p>
<hr/>
<h3 data-id="heading-13">3. <code>Record&lt;K, T&gt;</code>ï¼šå¿«é€Ÿç”Ÿæˆå¯¹è±¡ç±»å‹</h3>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šéœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œä½†é”®å’Œå€¼çš„ç±»å‹éƒ½è¦ä¸¥æ ¼æ§åˆ¶ï¼Ÿè¿™æ—¶å€™ <code>Record&lt;K, T&gt;</code> å°±æ˜¯ä½ çš„æ•‘æ˜Ÿï¼</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Role</span> = <span class="hljs-string">"admin"</span> | <span class="hljs-string">"user"</span> | <span class="hljs-string">"guest"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">Role</span>, <span class="hljs-built_in">string</span>[]&gt; = {
  <span class="hljs-attr">admin</span>: [<span class="hljs-string">"create"</span>, <span class="hljs-string">"read"</span>, <span class="hljs-string">"update"</span>, <span class="hljs-string">"delete"</span>],
  <span class="hljs-attr">user</span>: [<span class="hljs-string">"read"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">guest</span>: [<span class="hljs-string">"read"</span>],
};
</code></pre>
<p><code>Record&lt;K, T&gt;</code> çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘æœ‰ä¸€å †é”®ï¼ˆKï¼‰ï¼Œæ¯ä¸ªé”®å¯¹åº”çš„å€¼éƒ½æ˜¯æŸç§ç±»å‹ï¼ˆTï¼‰ã€‚â€ç®€ç›´å°±æ˜¯æ‰¹é‡ç”Ÿäº§å¯¹è±¡ç±»å‹çš„ç¥å™¨ï¼</p>
<hr/>
<h3 data-id="heading-14">4. <code>Partial&lt;T&gt;</code>ï¼šè®©ä½ çš„å±æ€§å˜å¾—â€œéšæ„â€</h3>
<p>è·Ÿ <code>Required&lt;T&gt;</code> ç›¸åï¼Œ<code>Partial&lt;T&gt;</code> å¯ä»¥æŠŠæ¯ä¸ªå±æ€§å˜æˆå¯é€‰çš„ã€‚é€‚åˆé‚£ç§â€œéšä¾¿å¡«ç‚¹å•¥â€çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">user3</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">User</span>&gt; = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°åˆš"</span>,
}; <span class="hljs-comment">// age å¯ä»¥ä¸å†™</span>
</code></pre>
<p><code>Partial&lt;T&gt;</code> çš„å­˜åœ¨ï¼Œå°±åƒä¸€ç¢—åŠ äº†æ°´çš„ç²¥â€”â€”ç¨€é‡Šäº†çº¦æŸï¼Œä½†æ›´çµæ´»ï¼</p>
<hr/>
<h3 data-id="heading-15">5. <code>Pick&lt;T, K&gt;</code>ï¼šç²¾å‡†æŒ‘é€‰</h3>
<p>å¦‚æœ <code>Omit</code> æ˜¯å‰ªæ‰ä¸è¦çš„ä¸œè¥¿ï¼Œé‚£ <code>Pick</code> å°±æ˜¯æŒ‘å‡ºæƒ³è¦çš„ä¸œè¥¿ã€‚æ¯”å¦‚ï¼Œä½ åªå…³å¿ƒç”¨æˆ·çš„åå­—å’Œå¹´é¾„ï¼Œä¸åœ¨ä¹å…¶ä»–å­—æ®µï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserInfo</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">"name"</span> | <span class="hljs-string">"age"</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-attr">user4</span>: <span class="hljs-title class_">UserInfo</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°å¼º"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
};
</code></pre>
<p><code>Pick&lt;T, K&gt;</code> çš„ä½œç”¨å°±æ˜¯ä»å¯¹è±¡ä¸­ç²¾å‡†æŒ‘å‡ºä½ éœ€è¦çš„å­—æ®µã€‚å°±åƒç‚¹èœä¸€æ ·ï¼Œåªç‚¹è‡ªå·±çˆ±åƒçš„ï¼Œä¸æµªè´¹ï¼</p>
<hr/>
<h2 data-id="heading-16">å¸¸è§å‘ï¼šå¦‚ä½•é¿å…è¢« TypeScriptâ€œå‘â€ï¼Ÿ</h2>
<p>è™½ç„¶ TypeScript å¾ˆå¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸å°‘å‘ç­‰ç€ä½ è·³ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„â€œé›·åŒºâ€ï¼Œå¸Œæœ›ä½ èƒ½ç»•å¼€ã€‚</p>
<h3 data-id="heading-17">å‘ 1ï¼šç±»å‹å¤ªå¤æ‚</h3>
<p>æœ‰æ—¶å€™ï¼Œä¸ºäº†è¿½æ±‚å®Œç¾ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºéå¸¸å¤æ‚çš„ç±»å‹å®šä¹‰ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ComplexType</span> = { <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> } &amp; { <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> } &amp; { <span class="hljs-attr">c</span>: <span class="hljs-built_in">boolean</span> };
</code></pre>
<p>è¿™ç§ç±»å‹è™½ç„¶çœ‹èµ·æ¥å¾ˆé…·ï¼Œä½†ç»´æŠ¤èµ·æ¥éå¸¸éº»çƒ¦ï¼æ‰€ä»¥ï¼Œå°½é‡ä¿æŒç®€å•ï¼Œåˆ«ç»™è‡ªå·±æŒ–å‘ã€‚</p>
<h3 data-id="heading-18">å‘ 2ï¼šå¿½ç•¥ç±»å‹å®šä¹‰æ–‡ä»¶</h3>
<p>å½“ä½ ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸ºå®ƒä»¬æä¾›ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ<code>.d.ts</code>ï¼‰ï¼ŒTypeScript å°±æ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥å» <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped" target="_blank" title="https://github.com/DefinitelyTyped/DefinitelyTyped" ref="nofollow noopener noreferrer">DefinitelyTyped</a> æ‰¾æ‰¾çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„å®šä¹‰æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿå§ï¼</p>
<h3 data-id="heading-19">å‘ 3ï¼šè¯¯ç”¨ç±»å‹æ–­è¨€</h3>
<p>ç±»å‹æ–­è¨€æ˜¯å‘Šè¯‰ TypeScriptï¼šâ€œç›¸ä¿¡æˆ‘ï¼Œæˆ‘çŸ¥é“è¿™ä¸ªå˜é‡çš„çœŸå®ç±»å‹ã€‚â€æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">'hello'</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (someValue <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-property">length</span>;
</code></pre>
<p>è™½ç„¶ç±»å‹æ–­è¨€å¾ˆå¥½ç”¨ï¼Œä½†æ»¥ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´ç¾éš¾æ€§çš„åæœï¼æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œä¸€å®šè¦ç¡®ä¿ä½ çš„æ–­è¨€æ˜¯æ­£ç¡®çš„ã€‚</p>
<hr/>
<h2 data-id="heading-20">æ€»ç»“</h2>
<p>TypeScript å°±åƒä¸€æŠŠåŒåˆƒå‰‘ï¼Œç”¨å¾—å¥½ï¼Œå®ƒèƒ½å¸®ä½ å†™å‡ºæ›´ä¼˜é›…ã€æ›´å®‰å…¨çš„ä»£ç ï¼›ç”¨å¾—ä¸å¥½ï¼Œå®ƒä¹Ÿèƒ½è®©ä½ æŠ“ç‹‚åˆ°æƒ³ç ¸é”®ç›˜ã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå­¦ä¹  TypeScript æ˜¯ä¸€ä¸ªéå¸¸å€¼å¾—æŠ•å…¥æ—¶é—´å’Œç²¾åŠ›çš„äº‹æƒ…ã€‚</p>
<p>æœ€åï¼Œæˆ‘é€å¤§å®¶ä¸€å¥è¯ï¼š<strong>â€œå­¦ TypeScript å°±åƒè°ˆæ‹çˆ±ï¼Œä¸€å¼€å§‹è§‰å¾—éº»çƒ¦ï¼Œä½†æ—¶é—´ä¹…äº†å°±ç¦»ä¸å¼€äº†ã€‚â€</strong></p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åˆ°æƒ³å…¥é—¨ TypeScript çš„åŒå­¦ã€‚å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€ä¸€èµ·æˆé•¿ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npm install æ ¸å¿ƒæµç¨‹]]></title>    <link>https://juejin.cn/post/7598459769238437922</link>    <guid>https://juejin.cn/post/7598459769238437922</guid>    <pubDate>2026-01-24T05:15:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238437922" data-draft-id="7598465042967789608" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npm install æ ¸å¿ƒæµç¨‹"/> <meta itemprop="keywords" content="NPM,Vue.js"/> <meta itemprop="datePublished" content="2026-01-24T05:15:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¦‚æœä½ å¥½"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npm install æ ¸å¿ƒæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¦‚æœä½ å¥½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:15:33.000Z" title="Sat Jan 24 2026 05:15:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">npm install æ ¸å¿ƒæµç¨‹</h2>
<p>ä½œä¸ºå‰ç«¯å¼€å‘ï¼Œ<code>npm install</code> å¤©å¤©ç”¨ï¼Œä½†è¿™è¡Œç®€å•çš„å‘½ä»¤èƒŒåï¼Œnpm å…¶å®æŒ‰å›ºå®šæµç¨‹æŠŠä¾èµ–å®‰è£…çš„äº‹å®‰æ’å¾—æ˜æ˜ç™½ç™½ï¼ä¸ç”¨æ·±ç©¶åº•å±‚åŸç†ï¼Œè¿™ç¯‡æ–‡ç« ç”¨æœ€ç›´ç™½çš„è¯è®²æ¸…æ ¸å¿ƒæ­¥éª¤ï¼Œçœ‹å®Œç§’æ‡‚ï¼Œè½»æ¾è§£å†³æ—¥å¸¸å®‰è£…ä¾èµ–çš„å°é—®é¢˜ï½</p>
<h3 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šå…ˆæ‰¾é…ç½®ï¼Œå®šå¥½å®‰è£…è§„åˆ™</h3>
<p>æ‰§è¡Œ <code>npm install</code> åï¼Œnpm ç¬¬ä¸€æ­¥ä¸ä¸‹è½½ï¼Œå…ˆ<strong>æŸ¥æ‰¾é¡¹ç›®å’Œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶</strong>ï¼ˆæ¯”å¦‚<code>.npmrc</code>ï¼‰ï¼Œç¡®å®šè¿™äº›å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li>ä¾èµ–ä»å“ªä¸‹è½½ï¼ˆé•œåƒæºï¼Œæ¯”å¦‚å›½å†…å¸¸ç”¨çš„æ·˜å®é•œåƒï¼‰</li>
<li>ä¸‹è½½çš„åŒ…å­˜åœ¨å“ªï¼ˆç¼“å­˜ç›®å½•ï¼Œé¿å…é‡å¤ä¸‹è½½ï¼‰</li>
<li>å®‰è£…åˆ°å“ªä¸ªè·¯å¾„ï¼ˆé»˜è®¤é¡¹ç›®æ ¹ç›®å½•çš„<code>node_modules</code>ï¼‰</li>
</ul>
<p>ç®€å•è¯´ï¼Œå°±æ˜¯å…ˆâ€œå®šè§„çŸ©â€ï¼Œå†å¼€å§‹å¹²æ´»ï½</p>
<h3 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šæ ¸å¿ƒåˆ†æ”¯åˆ¤æ–­ï¼æœ‰æ²¡æœ‰package-lock.jsonï¼Ÿ</h3>
<p>è¿™æ˜¯æ•´ä¸ªå®‰è£…æµç¨‹çš„<strong>å…³é”®åˆ†å‰å£</strong>ï¼Œnpm ä¼šå…ˆæ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æœ‰æ²¡æœ‰<code>package-lock.json</code>æ–‡ä»¶ï¼ˆä¾èµ–ç‰ˆæœ¬å¿«ç…§ï¼Œè®°å½•ä¸Šä¸€æ¬¡å®‰è£…çš„ç²¾ç¡®ä¾èµ–ä¿¡æ¯ï¼‰ï¼Œåˆ†ä¸¤ç§æƒ…å†µå¤„ç†ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†<strong>ä¿è¯ç‰ˆæœ¬ä¸€è‡´ã€æå‡å®‰è£…é€Ÿåº¦</strong>ã€‚</p>
<h4 data-id="heading-3">æƒ…å†µ1ï¼šæœ‰package-lock.jsonæ–‡ä»¶</h4>
<ol>
<li>
<p><strong>å…ˆæ ¡éªŒç‰ˆæœ¬ä¸€è‡´æ€§</strong>
æ£€æŸ¥lockæ–‡ä»¶é‡Œçš„ä¾èµ–ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¬¦åˆ<code>package.json</code>é‡Œçš„ç‰ˆæœ¬èŒƒå›´ï¼ˆæ¯”å¦‚<code>package.json</code>å†™<code>^2.0.0</code>ï¼Œlockæ–‡ä»¶é‡Œ2.1.0ã€2.2.0éƒ½ç®—ç¬¦åˆï¼‰ã€‚
ç¬¦åˆï¼šæŒ‰lockæ–‡ä»¶çš„ç²¾ç¡®ç‰ˆæœ¬ç»§ç»­ï¼›
ä¸ç¬¦åˆï¼šå¿½ç•¥æ—§lockæ–‡ä»¶ï¼ŒæŒ‰<code>package.json</code>é‡æ–°å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>æ‹‰å–åŒ…ä¿¡æ¯ï¼Œæ„å»ºå¹¶æ‰å¹³åŒ–ä¾èµ–æ ‘</strong>
æŒ‰lockæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä»é•œåƒæºè·å–ä¾èµ–çš„å…ƒæ•°æ®ï¼Œæ¥ç€æ„å»ºä¾èµ–æ ‘ï¼ˆé¡¹ç›®ä¾èµ–çš„åŒ…æ˜¯ä¸€çº§ä¾èµ–ï¼ŒåŒ…åˆä¾èµ–çš„åŒ…æ˜¯äºŒçº§ä¾èµ–ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚
å…³é”®æ“ä½œ<strong>æ‰å¹³åŒ–å¤„ç†</strong>ï¼šæŠŠèƒ½å…±äº«çš„å­ä¾èµ–æå‡åˆ°<code>node_modules</code>æ ¹ç›®å½•ï¼Œé¿å…å±‚çº§è¿‡æ·±ã€é‡å¤å®‰è£…ï¼Œçœç©ºé—´åˆå¿«ï¼</p>
</li>
<li>
<p><strong>ç¼“å­˜åˆ¤æ–­ï¼Œå®‰è£…ä¾èµ–+æ›´æ–°lockæ–‡ä»¶</strong></p>
<ul>
<li>æœ‰ç¼“å­˜ï¼šç›´æ¥æŠŠç¼“å­˜é‡Œçš„åŒ…è§£å‹åˆ°<code>node_modules</code>ï¼Œä¸ç”¨é‡æ–°ä¸‹è½½ï¼›</li>
<li>æ— ç¼“å­˜ï¼šä»é•œåƒæºä¸‹è½½åŒ…â†’æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ï¼ˆé˜²æ­¢æŸåï¼‰â†’å­˜å…¥ç¼“å­˜ï¼ˆä¸‹æ¬¡ç”¨ï¼‰â†’è§£å‹åˆ°<code>node_modules</code>ï¼›
æœ€åæ›´æ–°lockæ–‡ä»¶ï¼Œä¿è¯å¿«ç…§æœ€æ–°ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">æƒ…å†µ2ï¼šæ²¡æœ‰package-lock.jsonæ–‡ä»¶</h4>
<p>æ²¡æœ‰lockæ–‡ä»¶å°±ç®€å•äº†ï¼Œç›´æ¥æŒ‰<code>package.json</code>æ¥ï¼Œæ­¥éª¤å°‘äº†ç‰ˆæœ¬æ ¡éªŒï¼Œå…¶ä½™å’Œä¸Šé¢ä¸€è‡´ï¼š
<strong>æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯â†’æ„å»ºå¹¶æ‰å¹³åŒ–ä¾èµ–æ ‘â†’ç¼“å­˜åˆ¤æ–­ï¼ˆæœ‰åˆ™è§£å‹ï¼Œæ— åˆ™ä¸‹è½½+å­˜ç¼“å­˜ï¼‰â†’è§£å‹åˆ°<code>node_modules</code>â†’ç”Ÿæˆå…¨æ–°çš„lockæ–‡ä»¶</strong>ï¼Œä¸ºä¸‹ä¸€æ¬¡å®‰è£…ç•™å¥½ç²¾ç¡®ç‰ˆæœ¬å¿«ç…§ã€‚</p>
<h3 data-id="heading-5">æ ¸å¿ƒæµç¨‹ä¸€å¥è¯æ€»ç»“</h3>
<pre><code class="hljs language-csharp" lang="csharp">è¾“å…¥ npm install â†’ æŸ¥æ‰¾å¹¶åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆ.npmrc ç­‰ï¼‰
â†’ æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦æœ‰ package-<span class="hljs-keyword">lock</span>.jsonï¼Ÿ
  â†’ æ˜¯ â†’ æ ¡éªŒ <span class="hljs-keyword">lock</span> æ–‡ä»¶ä¸ package.json ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ï¼Ÿ
    â†’ ä¸€è‡´ â†’ æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯ â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ æ£€æŸ¥ç¼“å­˜ï¼Ÿ
      â†’ æœ‰ â†’ è§£å‹ç¼“å­˜åˆ° node_modules â†’ æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
      â†’ æ—  â†’ ä¸‹è½½ä¾èµ– â†’ æ ¡éªŒå®Œæ•´æ€§ â†’ å­˜å…¥ç¼“å­˜ â†’ è§£å‹åˆ° node_modules â†’ æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
    â†’ ä¸ä¸€è‡´ â†’ æŒ‰ package.json é‡æ–°æ‹‰å–åŒ…ä¿¡æ¯ â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ ç¼“å­˜åˆ¤æ–­ä¸å®‰è£… â†’ ç”Ÿæˆ/æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
  â†’ å¦ â†’ æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯ï¼ˆåŸºäº package.jsonï¼‰â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ ç¼“å­˜åˆ¤æ–­ä¸å®‰è£… â†’ ç”Ÿæˆ <span class="hljs-keyword">lock</span> æ–‡ä»¶
â†’ å®‰è£…å®Œæˆ 
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ea84a8f8257489a80e49e914ffbd896~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aaC5p6c5L2g5aW9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836532&amp;x-signature=BhR7VPrvrRYP8MiT3P4QKY8JqDs%3D" alt="npm install æ ¸å¿ƒæµç¨‹.png" loading="lazy"/></p>
<h3 data-id="heading-6">æ—¥å¸¸å¼€å‘</h3>
<h4 data-id="heading-7">1. ç¼“å­˜è¶…æœ‰ç”¨ï¼Œå‡ºé—®é¢˜æ¸…ä¸€åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</h4>
<p>ä¸‹
ç¼“å­˜æ˜¯npmæé€Ÿçš„å…³é”®ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„åŒ…ä¼šå­˜èµ·æ¥ï¼Œåç»­å®‰è£…ç›´æ¥å¤ç”¨ã€‚å¦‚æœé‡åˆ°å®‰è£…æŠ¥é”™ã€åŒ…æŸåï¼Œæ‰§è¡Œ<code>npm cache clean --force</code>å¼ºåˆ¶æ¸…ç¼“å­˜ï¼Œé‡æ–°å®‰è£…å¤§æ¦‚ç‡è§£å†³ã€‚</p>
<h4 data-id="heading-8">2. package-lock.jsonåˆ«éšä¾¿åˆ /æ”¹</h4>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯å›¢é˜Ÿåä½œã€ç”Ÿäº§ç¯å¢ƒçš„â€œç‰ˆæœ¬ä¿éšœâ€ï¼Œåˆ äº†é‡æ–°å®‰è£…å¯èƒ½å¯¼è‡´ä¾èµ–ç‰ˆæœ¬å˜åŒ–ï¼Œé¡¹ç›®å‡ºé—®é¢˜ã€‚çœŸè¦æ”¹ç‰ˆæœ¬ï¼Œå…ˆæ”¹<code>package.json</code>ï¼Œå†é‡æ–°<code>npm install</code>è‡ªåŠ¨æ›´æ–°lockæ–‡ä»¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶]]></title>    <link>https://juejin.cn/post/7598459769238454306</link>    <guid>https://juejin.cn/post/7598459769238454306</guid>    <pubDate>2026-01-24T05:17:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238454306" data-draft-id="7598465042967756840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶"/> <meta itemprop="keywords" content="å‰ç«¯,HarmonyOS,APP"/> <meta itemprop="datePublished" content="2026-01-24T05:17:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JokerX"/> <meta itemprop="url" content="https://juejin.cn/user/2892167937262916"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2892167937262916/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JokerX
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:17:47.000Z" title="Sat Jan 24 2026 05:17:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>HarmonyKit æ˜¯ä¸€ä¸ªåŸºäº ArkTS + ArkUI çš„ HarmonyOS å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œå†…ç½®ç½‘ç»œã€åˆ†é¡µã€æ•°æ®åº“ã€çŠ¶æ€ç®¡ç†ã€å¯¼èˆªã€å±å¹•é€‚é…ç­‰å¸¸ç”¨èƒ½åŠ›ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ã€å›½é™…åŒ–ã€å¤šç«¯é€‚é…ï¼Œæ¬¢è¿ä¸€èµ·å­¦ä¹ äº¤æµã€‚</p>
<h2 data-id="heading-0">é¡¹ç›®äº®ç‚¹</h2>
<ul>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šå†…ç½®ç½‘ç»œã€åˆ†é¡µã€æ•°æ®åº“ã€çŠ¶æ€ç®¡ç†ç­‰åŸºç¡€èƒ½åŠ›ï¼Œæ— éœ€é‡å¤æ­å»º</li>
<li><strong>å®Œæ•´ç¤ºä¾‹</strong>ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æä¾›å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç ï¼Œå¿«é€Ÿä¸Šæ‰‹</li>
<li><strong>æ¨¡å—åŒ–æ¶æ„</strong>ï¼šæ¸…æ™°çš„åˆ†å±‚è®¾è®¡ï¼Œå‚è€ƒå®˜æ–¹æœ€ä½³å®è·µ</li>
<li><strong>ç°ä»£åŒ–æŠ€æœ¯æ ˆ</strong>ï¼šArkTS + ArkUI + V2 çŠ¶æ€ç®¡ç†ï¼Œæ‹¥æŠ±æœ€æ–°æŠ€æœ¯</li>
<li><strong>å±å¹•é€‚é…</strong>ï¼šå®Œæ•´æ”¯æŒæ‰‹æœº/æŠ˜å å±/å¹³æ¿å¤šç§è®¾å¤‡å½¢æ€</li>
<li><strong>æ·±è‰²æ¨¡å¼</strong>ï¼šå®Œæ•´æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜åŠ¨æ€åˆ‡æ¢</li>
<li><strong>å›½é™…åŒ–æ”¯æŒ</strong>ï¼šæ”¯æŒä¸­è‹±æ–‡è¯­è¨€åˆ‡æ¢</li>
<li><strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼šä¸ä»£ç åŒæ­¥çš„è¯¦ç»†æ–‡æ¡£ï¼Œä¾¿äºå­¦ä¹ å’Œå®šåˆ¶</li>
</ul>
<blockquote>
<p>å¦‚æœé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒ â­ è¿™å¯¹æˆ‘æ¥è¯´å¾ˆé‡è¦ï¼Œèƒ½ç»™æˆ‘å¸¦æ¥é•¿æœŸæ›´æ–°ç»´æŠ¤çš„åŠ¨åŠ›ï¼</p>
</blockquote>
<blockquote>
<p><strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://github.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">GitHub</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://gitee.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">Gitee</a>
<strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top" target="_blank" title="https://harmony.dusksnow.top" ref="nofollow noopener noreferrer">harmony.dusksnow.top</a></p>
</blockquote>
<h2 data-id="heading-1">é¡¹ç›®é¢„è§ˆ</h2>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong>ï¼šæ¡†æ¶æä¾›äº†å¤šç§ç¤ºä¾‹é¡µé¢ï¼Œå±•ç¤ºå„é¡¹èƒ½åŠ›çš„ä½¿ç”¨æ–¹å¼ï¼Œæ”¯æŒæ‰‹æœºã€æŠ˜å å±ã€å¹³æ¿ç­‰å¤šç§è®¾å¤‡å½¢æ€ã€‚</p>
</blockquote>
<h3 data-id="heading-2">ğŸ“± æ‰‹æœº</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fa602d8605647298b02d4fd047ac875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=F7KNFbdd%2BROPAPRfH881hisiwEI%3D" alt="æ‰‹æœºç«¯é¢„è§ˆ" loading="lazy"/></p>
<h3 data-id="heading-3">ğŸ“± æŠ˜å å±</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50ed28b9c37547dc8b1c5a6223e17b98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=zSlOCazSGKiqbNSPbVz30mWnrSY%3D" alt="æŠ˜å å±é¢„è§ˆ" loading="lazy"/></p>
<h3 data-id="heading-4">ğŸ“± å¹³æ¿</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19527704d44148798ec1f6024e247c04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=ycgJEfjSGKfYHceoj%2BngnRJXm%2B4%3D" alt="å¹³æ¿é¢„è§ˆ" loading="lazy"/></p>
<h2 data-id="heading-5">æ¶æ„è®¾è®¡</h2>
<p>HarmonyKit é‡‡ç”¨æ¨¡å—åŒ–åˆ†å±‚æ¶æ„ï¼Œå‚è€ƒå®˜æ–¹æœ€ä½³å®è·µï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<h3 data-id="heading-6">ä¸šåŠ¡å±‚ï¼ˆFeatureï¼‰</h3>
<ul>
<li><strong>åŠŸèƒ½æ¨¡å—</strong>ï¼šæŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†ï¼ˆè®¤è¯ã€ç”¨æˆ·ã€ç¤ºä¾‹ç­‰ï¼‰</li>
<li><strong>MVVM æ¨¡å¼</strong>ï¼šView + ViewModel åˆ†ç¦»ï¼Œç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç®¡ç†</li>
<li><strong>é¡µé¢å…¥å£</strong>ï¼šæ¯ä¸ªé¡µé¢æä¾›ç‹¬ç«‹çš„ <code>@Builder</code> å…¥å£</li>
</ul>
<h3 data-id="heading-7">æ ¸å¿ƒå±‚ï¼ˆCoreï¼‰</h3>
<ul>
<li><strong>base</strong>ï¼šåŸºç¡€çˆ¶ç±»ä¸åŸºç¡€èƒ½åŠ›å°è£…ï¼ˆBaseViewModelã€BaseNetWorkViewModelã€BaseNetWorkListViewModelï¼‰</li>
<li><strong>data</strong>ï¼šç»Ÿä¸€æ•°æ®å…¥å£ï¼Œå°è£…ä»“åº“å±‚ï¼Œèšåˆç½‘ç»œã€æ•°æ®åº“ä¸æœ¬åœ°å­˜å‚¨</li>
<li><strong>database</strong>ï¼šæœ¬åœ°æ•°æ®åº“èƒ½åŠ›ï¼ˆIBest-ORMï¼‰</li>
<li><strong>datastore</strong>ï¼šè½»é‡çº§æœ¬åœ°å­˜å‚¨</li>
<li><strong>designsystem</strong>ï¼šè®¾è®¡ç³»ç»Ÿä¸å…¨å±€æ ·å¼è§„èŒƒï¼ˆé¢œè‰²ã€é—´è·ã€å­—ä½“ï¼‰</li>
<li><strong>ibestui</strong>ï¼šIBest UI ç»„ä»¶åº“çš„å°è£…ä¸é€‚é…å±‚</li>
<li><strong>model</strong>ï¼šæ•°æ®æ¨¡å‹ä¸å®ä½“å®šä¹‰</li>
<li><strong>navigation</strong>ï¼šå¯¼èˆªèƒ½åŠ›ä¸è·¯ç”±åŸºç¡€è®¾æ–½</li>
<li><strong>network</strong>ï¼šç½‘ç»œè¯·æ±‚åŸºç¡€èƒ½åŠ›ï¼ˆDataSourceã€æ‹¦æˆªå™¨ï¼‰</li>
<li><strong>result</strong>ï¼šç»Ÿä¸€ç»“æœå°è£…ä¸é”™è¯¯å¤„ç†ï¼ˆRequestHelperï¼‰</li>
<li><strong>state</strong>ï¼šå…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆV2 çŠ¶æ€ç®¡ç†ï¼‰</li>
<li><strong>ui</strong>ï¼šé€šç”¨ UI ç»„ä»¶ï¼ˆBaseNetWorkViewã€BaseNetWorkListViewã€RefreshLayoutï¼‰</li>
<li><strong>util</strong>ï¼šå·¥å…·ç±»ï¼ˆToastUtilsã€LogUtilsï¼‰</li>
</ul>
<h3 data-id="heading-8">å…¥å£å±‚ï¼ˆEntryï¼‰</h3>
<ul>
<li><strong>åº”ç”¨å…¥å£</strong>ï¼šåº”ç”¨å¯åŠ¨æµç¨‹ä¸è·¯ç”±æ³¨å†Œ</li>
<li><strong>é€‚é…å™¨</strong>ï¼šçª—å£é€‚é…å™¨ï¼ˆå®‰å…¨åŒºã€æ–­ç‚¹ç›‘å¬ï¼‰</li>
</ul>
<h3 data-id="heading-9">ä¾èµ–å…³ç³»</h3>
<ul>
<li><strong>feature ä¾èµ– core</strong>ï¼šä¸šåŠ¡æ¨¡å—å¯ä½¿ç”¨ core çš„åŸºç¡€èƒ½åŠ›</li>
<li><strong>feature ä¸ç›´æ¥ä¾èµ– network / database</strong>ï¼šä¸šåŠ¡æ¨¡å—é€šè¿‡ <code>data</code> æ¨¡å—å†…çš„ä»“åº“ä½œä¸ºç»Ÿä¸€æ•°æ®å…¥å£</li>
<li><strong>data èšåˆåº•å±‚èƒ½åŠ›</strong>ï¼š<code>data</code> è´Ÿè´£æ•´åˆ <code>network</code>ã€<code>database</code>ã€<code>datastore</code></li>
<li><strong>æ¨¡å—é—´ä¸äº’ç›¸ä¾èµ–</strong>ï¼šfeature ä¹‹é—´ä¿æŒéš”ç¦»ï¼Œé¿å…äº¤å‰ä¾èµ–</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7f811a09ba48cbb6fb6951b76afc95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=CI0gk7CMOLNGsPi%2FVss42PQhiqA%3D" alt="æ¶æ„å›¾" loading="lazy"/></p>
<blockquote>
<p>æ¶æ„å›¾æ¥è‡ªåä¸ºå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-layered-architecture-design-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-layered-architecture-design-V5" ref="nofollow noopener noreferrer">åˆ†å±‚æ¶æ„è®¾è®¡</a></p>
</blockquote>
<h2 data-id="heading-10">æŠ€æœ¯æ ˆ</h2>








































<table><thead><tr><th>ç±»åˆ«</th><th>æŠ€æœ¯é€‰å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç¼–ç¨‹è¯­è¨€</td><td>ArkTS</td><td>HarmonyOS NEXT ä¸»æµè¯­è¨€</td></tr><tr><td>UI æ¡†æ¶</td><td>ArkUI</td><td>å£°æ˜å¼ UI æ¡†æ¶</td></tr><tr><td>æ¶æ„æ¨¡å¼</td><td>MVVM</td><td>View + ViewModel åˆ†ç¦»</td></tr><tr><td>çŠ¶æ€ç®¡ç†</td><td>V2ï¼ˆObservedV2/AppStorageV2ï¼‰</td><td>æ–°ç‰ˆçŠ¶æ€ç®¡ç†èƒ½åŠ›</td></tr><tr><td>æ•°æ®åº“</td><td>IBest-ORM</td><td>æœ¬åœ°æ•°æ®åº“èƒ½åŠ›</td></tr><tr><td>ç»„ä»¶åº“</td><td>IBest-UI-V2</td><td>ä¸šåŠ¡ç»„ä»¶åº“ä¸åŸºç¡€æ§ä»¶å°è£…</td></tr></tbody></table>
<h2 data-id="heading-11">æ ¸å¿ƒèƒ½åŠ›</h2>
<h3 data-id="heading-12">1. ç½‘ç»œè¯·æ±‚å°è£…</h3>
<p>åŸºäº Axios çš„ç½‘ç»œè¯·æ±‚å°è£…ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository â†’ ViewModel</strong> ä¸‰å±‚æ¶æ„ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†é”™è¯¯ã€loadingã€toast ç­‰é€šç”¨é€»è¾‘ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç»Ÿä¸€ç®¡ç† Axios å®ä¾‹ä¸åŸºç¡€é…ç½®ï¼ˆbaseUrlã€timeoutã€headersï¼‰</li>
<li>è‡ªåŠ¨å¤„ç† Token æ³¨å…¥ä¸åˆ·æ–°</li>
<li>è‡ªåŠ¨é”™è¯¯å¤„ç†ä¸ Toast æç¤º</li>
<li>è‡ªåŠ¨æ—¥å¿—æ‹¦æˆª</li>
<li>ç±»å‹å®‰å…¨çš„æ•°æ®æºæ¥å£</li>
</ul>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRequestViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€ä¼ é€’ä»“åº“æ–¹æ³•ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†é”™è¯¯</span>
  <span class="hljs-title function_">requestGoodsDetail</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">RequestHelper</span>.<span class="hljs-property">repository</span>&lt;<span class="hljs-title class_">Goods</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-string">"1"</span>))
      .<span class="hljs-title function_">loading</span>(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// è¯·æ±‚è¿‡ç¨‹æ˜¾ç¤º loading</span>
      .<span class="hljs-title function_">toast</span>(<span class="hljs-literal">true</span>)   <span class="hljs-comment">// ä¸šåŠ¡å¤±è´¥è‡ªåŠ¨å¼¹å‡º toast</span>
      .<span class="hljs-title function_">execute</span>()
      .<span class="hljs-title function_">then</span>((<span class="hljs-attr">data</span>: <span class="hljs-title class_">Goods</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
        <span class="hljs-comment">// åªéœ€å¤„ç†æˆåŠŸé€»è¾‘</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å•†å“è¯¦æƒ…ï¼š"</span>, data);
      });
  }
}
</code></pre>
<p><strong>å•æ¬¡è¯·æ±‚åœºæ™¯ï¼ˆè‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€æˆåŠŸçŠ¶æ€ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ViewModel ç»§æ‰¿ BaseNetWorkViewModel</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkDemoViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseNetWorkViewModel</span>&lt;<span class="hljs-title class_">Goods</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€å®ç°è¿™ä¸€ä¸ªæ–¹æ³•</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">requestRepository</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">NetworkResponse</span>&lt;<span class="hljs-title class_">Goods</span>&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-string">"1"</span>);
  }
}

<span class="hljs-comment">// é¡µé¢ä½¿ç”¨ BaseNetWorkView è‡ªåŠ¨å¤„ç†çŠ¶æ€</span>
<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">NetworkDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">NetworkDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkDemoViewModel</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç½‘ç»œè¯·æ±‚ç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€æˆåŠŸçŠ¶æ€ã€é‡è¯•é€»è¾‘</span>
      <span class="hljs-title class_">BaseNetWorkView</span>({
        <span class="hljs-attr">uiState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">uiState</span>,
        <span class="hljs-attr">onRetry</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">retryRequest</span>(),
        <span class="hljs-attr">content</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">NetworkDemoContent</span>()
      });
    }
  }

  <span class="hljs-comment">// è¯·æ±‚æˆåŠŸåæ¸²æŸ“å†…å®¹</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">NetworkDemoContent</span>() {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">title</span> ?? <span class="hljs-string">""</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">subTitle</span> ?? <span class="hljs-string">""</span>)
    }
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fnetwork.html" target="_blank" title="https://harmony.dusksnow.top/help/core/network.html" ref="nofollow noopener noreferrer">ç½‘ç»œè¯·æ±‚æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fresult.html" target="_blank" title="https://harmony.dusksnow.top/help/core/result.html" ref="nofollow noopener noreferrer">ç»“æœå¤„ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-13">2. åˆ†é¡µåˆ—è¡¨å°è£…</h3>
<p>ç»Ÿä¸€å°è£…åˆ†é¡µåˆ—è¡¨çš„åŠ è½½ã€åˆ·æ–°ã€ç©ºæ€ã€é”™è¯¯å¤„ç†ï¼Œå¼€å‘è€…åªéœ€å…³å¿ƒæ•°æ®è¯·æ±‚å’Œåˆ—è¡¨æ¸²æŸ“ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨å¤„ç†åŠ è½½ä¸­ã€æˆåŠŸã€å¤±è´¥ã€ç©ºæ•°æ®å››ç§çŠ¶æ€</li>
<li>è‡ªåŠ¨å¤„ç†ä¸‹æ‹‰åˆ·æ–°ä¸ä¸Šæ‹‰åŠ è½½æ›´å¤š</li>
<li>è‡ªåŠ¨ç®¡ç†åˆ†é¡µå‚æ•°ï¼ˆcurrentPageã€pageSizeï¼‰</li>
<li>è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®</li>
<li>æ”¯æŒè‡ªå®šä¹‰åŠ è½½ã€é”™è¯¯ã€ç©ºæ€è§†å›¾</li>
</ul>
<p><strong>ViewModel å®ç°ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkListDemoViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseNetWorkListViewModel</span>&lt;<span class="hljs-title class_">Goods</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€å®ç°è¿™ä¸€ä¸ªæ–¹æ³•</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">requestListData</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">NetworkResponse</span>&lt;<span class="hljs-title class_">NetworkPageData</span>&lt;<span class="hljs-title class_">Goods</span>&gt;&gt;&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">request</span>: <span class="hljs-title class_">GoodsSearchRequest</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsSearchRequest</span>();
    request.<span class="hljs-property">page</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span>;  <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨ç®¡ç†é¡µç </span>
    request.<span class="hljs-property">size</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span>;     <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨ç®¡ç†æ¯é¡µæ•°é‡</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsPage</span>(request);
  }
}
</code></pre>
<p><strong>é¡µé¢ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">NetworkListDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">NetworkListDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkListDemoViewModel</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listScroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"åˆ†é¡µåˆ—è¡¨ç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€ç©ºæ€</span>
      <span class="hljs-title class_">BaseNetWorkListView</span>({
        <span class="hljs-attr">uiState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">uiState</span>,
        <span class="hljs-attr">onRetry</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">retryRequest</span>(),
        <span class="hljs-attr">content</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">NetworkListDemoContent</span>()
      });
    }
  }

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">NetworkListDemoContent</span>() {
    <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½</span>
    <span class="hljs-title class_">RefreshLayout</span>({
      <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroller</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">isLoading</span>,
      <span class="hljs-attr">isEnableSlideUp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">isEnableSlideUp</span>,
      <span class="hljs-attr">onRefresh</span>: (direction): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">onRefreshDirection</span>(direction)
    }) {
      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroller</span> }) {
        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">listData</span>, <span class="hljs-function">(<span class="hljs-params">item: Goods</span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">title</span>);
          }
        }, <span class="hljs-function">(<span class="hljs-params">item: Goods</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${item.id}</span>`</span>);
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>);
    }
  }
}
</code></pre>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<ol>
<li>ViewModel ç»§æ‰¿ <code>BaseNetWorkListViewModel&lt;T&gt;</code> å¹¶å®ç° <code>requestListData()</code></li>
<li>é¡µé¢ä½¿ç”¨ <code>BaseNetWorkListView</code> åŒ…ä½åˆ—è¡¨å†…å®¹</li>
<li>åˆ—è¡¨å®¹å™¨ç”¨ <code>RefreshLayout</code> å¤„ç†ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½</li>
</ol>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fpagination.html" target="_blank" title="https://harmony.dusksnow.top/help/core/pagination.html" ref="nofollow noopener noreferrer">åˆ†é¡µåˆ—è¡¨æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-14">3. çŠ¶æ€ç®¡ç†</h3>
<p>åŸºäº V2 çŠ¶æ€ç®¡ç†ï¼ˆAppStorageV2/PersistenceV2ï¼‰å®ç°å…¨å±€çŠ¶æ€å…±äº«ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç±»å‹å®‰å…¨çš„å…¨å±€çŠ¶æ€å®šä¹‰</li>
<li>å“åº”å¼æ›´æ–°ï¼ˆ<code>@Trace</code> è‡ªåŠ¨è§¦å‘ UI æ›´æ–°ï¼‰</li>
<li>æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼ˆPersistenceV2ï¼‰</li>
<li>å¤šé¡µé¢çŠ¶æ€å…±äº«</li>
<li>ç»Ÿä¸€çŠ¶æ€ç®¡ç†å…¥å£</li>
</ul>
<p><strong>çŠ¶æ€å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰çŠ¶æ€ç±»</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoCounterState</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;  <span class="hljs-comment">// @Trace æ ‡è®°çš„å­—æ®µä¼šè‡ªåŠ¨è§¦å‘ UI æ›´æ–°</span>

  <span class="hljs-title function_">increment</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
  }
}

<span class="hljs-comment">// è·å–å…¨å±€çŠ¶æ€å®ä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDemoCounterState</span>(<span class="hljs-params"/>): <span class="hljs-title class_">DemoCounterState</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">DemoCounterState</span>&gt;(
    <span class="hljs-title class_">DemoCounterState</span>,
    <span class="hljs-string">"demo_counter_state"</span>,
    <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoCounterState</span>()
  )!;
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateManagementViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-meta">@Trace</span>
  <span class="hljs-attr">counterState</span>: <span class="hljs-title class_">DemoCounterState</span> = <span class="hljs-title function_">getDemoCounterState</span>();  <span class="hljs-comment">// è·å–å…¨å±€çŠ¶æ€</span>

  <span class="hljs-title function_">increment</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counterState</span>.<span class="hljs-title function_">increment</span>();  <span class="hljs-comment">// è°ƒç”¨çŠ¶æ€æ–¹æ³•ï¼ŒUI è‡ªåŠ¨æ›´æ–°</span>
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fstate.html" target="_blank" title="https://harmony.dusksnow.top/help/core/state.html" ref="nofollow noopener noreferrer">çŠ¶æ€ç®¡ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-15">4. å¯¼èˆªç®¡ç†</h3>
<p>ç»Ÿä¸€ç®¡ç†è·¯ç”±æ³¨å†Œã€é¡µé¢è·³è½¬ã€å‚æ•°ä¼ é€’ä¸ç»“æœå›ä¼ ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç±»å‹å®‰å…¨çš„è·¯ç”±å‚æ•°ä¸è¿”å›ç»“æœ</li>
<li>æ¨¡å—åŒ–è·¯ç”±æ³¨å†Œï¼ˆRouteGraphï¼‰</li>
<li>ç»Ÿä¸€å¯¼èˆªæœåŠ¡ï¼ˆNavigationServiceï¼‰</li>
<li>æ”¯æŒå¸¦å‚è·³è½¬ä¸ç»“æœå›ä¼ </li>
<li>æ”¯æŒç™»å½•æ‹¦æˆªä¸è·¯ç”±å®ˆå«</li>
</ul>
<p><strong>è·¯ç”±å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·¯ç”±å¸¸é‡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">DemoRoutes</span> = {
  <span class="hljs-title class_">NavigationWithArgs</span>: <span class="hljs-string">"demo/navigation-with-args"</span>,
  <span class="hljs-title class_">NavigationResult</span>: <span class="hljs-string">"demo/navigation-result"</span>
};

<span class="hljs-comment">// å‚æ•°å®šä¹‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DemoGoodsParam</span> {
  <span class="hljs-attr">goodsId</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">goodsName</span>: <span class="hljs-title class_">Resource</span>;
}

<span class="hljs-comment">// è¿”å›ç»“æœå®šä¹‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DemoResult</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>Navigator å°è£…ï¼ˆæ¨èï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoNavigator</span> {
  <span class="hljs-comment">// å¸¦å‚è·³è½¬</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toNavigationWithArgs</span>(<span class="hljs-attr">goodsId</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">goodsName</span>: <span class="hljs-title class_">Resource</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">DemoGoodsParam</span> = { goodsId, goodsName };
    <span class="hljs-title function_">navigateTo</span>(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationWithArgs</span>, params);
  }

  <span class="hljs-comment">// ç»“æœå›ä¼ </span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toNavigationResult</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">DemoResult</span> | <span class="hljs-literal">undefined</span>&gt; {
    <span class="hljs-keyword">return</span> navigateToForResult&lt;<span class="hljs-title class_">DemoResult</span>&gt;(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationResult</span>);
  }
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å‘èµ·æ–¹ï¼šè·³è½¬å¹¶ç­‰å¾…ç»“æœ</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallerViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-title function_">openResultPage</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">DemoNavigator</span>.<span class="hljs-title function_">toNavigationResult</span>()
      .<span class="hljs-title function_">then</span>((result?: <span class="hljs-title class_">DemoResult</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (result) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"è¿”å›ç»“æœï¼š"</span>, result.<span class="hljs-property">title</span>);
        }
      });
  }
}

<span class="hljs-comment">// ç›®æ ‡é¡µï¼šè·å–å‚æ•°</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TargetViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-attr">routeParams</span>: <span class="hljs-title class_">DemoGoodsParam</span> = getRouteParams&lt;<span class="hljs-title class_">DemoGoodsParam</span>&gt;(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationWithArgs</span>);
}

<span class="hljs-comment">// ç›®æ ‡é¡µï¼šè¿”å›ç»“æœ</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-title function_">submitResult</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">DemoResult</span> = {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"æ ‡é¢˜"</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">"è¯´æ˜"</span>
    };
    <span class="hljs-title function_">navigateBackWithResult</span>(result);
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fnavigation%2F" target="_blank" title="https://harmony.dusksnow.top/help/navigation/" ref="nofollow noopener noreferrer">å¯¼èˆªç®¡ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-16">5. å±å¹•é€‚é…</h3>
<p>å®Œæ•´çš„å±å¹•é€‚é…æ–¹æ¡ˆï¼Œæ”¯æŒæ‰‹æœºã€æŠ˜å å±ã€å¹³æ¿ç­‰å¤šç§è®¾å¤‡å½¢æ€ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>æ–­ç‚¹é€‚é…ï¼ˆXS/SM/MD/LG å››æ¡£æ–­ç‚¹ï¼‰</li>
<li>å“åº”å¼å·¥å…·å‡½æ•° <code>bp()</code></li>
<li>å®‰å…¨åŒºè‡ªåŠ¨é€‚é…</li>
<li>å…¨å±€æ–­ç‚¹çŠ¶æ€ç›‘å¬</li>
</ul>
<p><strong>æ–­ç‚¹è§„åˆ™ï¼š</strong></p>






























<table><thead><tr><th>æ–­ç‚¹</th><th>è¯´æ˜</th><th>æœ€å¤§å®½åº¦ï¼ˆvpï¼‰</th></tr></thead><tbody><tr><td><code>XS</code></td><td>è¶…å°å±</td><td><code>320</code></td></tr><tr><td><code>SM</code></td><td>å°å±</td><td><code>600</code></td></tr><tr><td><code>MD</code></td><td>ä¸­å±</td><td><code>840</code></td></tr><tr><td><code>LG</code></td><td>å¤§å±</td><td><code>Infinity</code></td></tr></tbody></table>
<p><strong>ç½‘æ ¼å¸ƒå±€é€‚é…ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { bp } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">private</span> <span class="hljs-title class_">GridSection</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Grid</span>() {
    <span class="hljs-comment">// ... æ•°æ®å¾ªç¯</span>
  }
  <span class="hljs-comment">// å°å±2åˆ—ï¼Œä¸­å±3åˆ—ï¼Œå¤§å±4åˆ—</span>
  .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-title function_">bp</span>({ <span class="hljs-attr">sm</span>: <span class="hljs-string">"1fr 1fr"</span>, <span class="hljs-attr">md</span>: <span class="hljs-string">"1fr 1fr 1fr"</span>, <span class="hljs-attr">lg</span>: <span class="hljs-string">"1fr 1fr 1fr 1fr"</span> }))
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>);
}
</code></pre>
<p><strong>æ–‡æœ¬é€‚é…ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { bp } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">private</span> <span class="hljs-title class_">TextAdaptSection</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"å¤§å±é€‚é…ç¤ºä¾‹æ–‡å­—"</span>)
    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-title function_">bp</span>({ <span class="hljs-attr">sm</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">md</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">lg</span>: <span class="hljs-number">28</span> }));
}
</code></pre>
<p><strong>Tab æ å¤§å±ä½ç½®è°ƒæ•´ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BreakpointState</span>, getBreakpointState } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">MainPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">breakpointState</span>: <span class="hljs-title class_">BreakpointState</span> = <span class="hljs-title function_">getBreakpointState</span>();

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">MainContent</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">Tabs</span>({
      <span class="hljs-comment">// å¤§å±æ—¶ Tab æ åœ¨å·¦ä¾§ï¼Œå°å±æ—¶åœ¨åº•éƒ¨</span>
      <span class="hljs-attr">barPosition</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>() ? <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">Start</span> : <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">End</span>,
    }) {
      <span class="hljs-comment">// ... é¡µé¢å†…å®¹</span>
    }
    .<span class="hljs-title function_">barWidth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>() ? <span class="hljs-number">96</span> : <span class="hljs-string">"100%"</span>)
    .<span class="hljs-title function_">vertical</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>());
  }
}
</code></pre>
<p><strong>å®‰å…¨åŒºé€‚é…ï¼š</strong></p>
<p>æ¡†æ¶é»˜è®¤ä½¿ç”¨å…¨å±€å®‰å…¨åŒºè¿›è¡Œé¡µé¢å†…è¾¹è·é¿è®©ï¼Œ<code>AppNavDestination</code> å·²è‡ªåŠ¨å¤„ç†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">SafeAreaDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">SafeAreaDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeAreaDemoViewModel</span>();

  <span class="hljs-title function_">build</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// AppNavDestination é»˜è®¤å¯ç”¨å®‰å…¨åŒº</span>
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"å®‰å…¨åŒºç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"å†…å®¹ä¼šè‡ªåŠ¨é¿è®©å®‰å…¨åŒº"</span>);
    };
  }
}
</code></pre>
<p>å¦‚éœ€è‡ªå®šä¹‰å®‰å…¨åŒºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">AppNavDestination</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">"è‡ªå®šä¹‰å®‰å…¨åŒº"</span>,
  <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>,
  <span class="hljs-attr">paddingValue</span>: { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span> }
}) {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"è‡ªå®šä¹‰å†…è¾¹è·"</span>);
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fexpand%2Fscreen-adapt.html" target="_blank" title="https://harmony.dusksnow.top/help/expand/screen-adapt.html" ref="nofollow noopener noreferrer">å±å¹•é€‚é…æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fexpand%2Fsafe-area.html" target="_blank" title="https://harmony.dusksnow.top/help/expand/safe-area.html" ref="nofollow noopener noreferrer">å®‰å…¨åŒºæ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-17">6. æ•°æ®åº“å°è£…</h3>
<p>åŸºäº IBest-ORM çš„æœ¬åœ°æ•°æ®åº“èƒ½åŠ›ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository</strong> æ¶æ„ï¼Œä¸šåŠ¡å±‚é€šè¿‡ Repository è®¿é—®æ•°æ®åº“ã€‚</p>
<p><strong>å®ä½“å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Table</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"demo_items"</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoEntity</span> {
  <span class="hljs-meta">@PrimaryKey</span>({ <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> })
  id?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@Column</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ColumnType</span>.<span class="hljs-property">TEXT</span> })
  title?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@CreatedAt</span>()
  createdAt?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">demoRepository</span>: <span class="hljs-title class_">DemoRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoRepository</span>();

  <span class="hljs-comment">// ä¿å­˜è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">save</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">demoRepository</span>.<span class="hljs-title function_">createDemo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">titleInput</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">descInput</span>);
  }

  <span class="hljs-comment">// è·å–æ‰€æœ‰è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchList</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> list = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">demoRepository</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-comment">// å¤„ç†åˆ—è¡¨æ•°æ®</span>
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fdatabase.html" target="_blank" title="https://harmony.dusksnow.top/help/core/database.html" ref="nofollow noopener noreferrer">æ•°æ®åº“æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fibest-orm.ibestservices.com%2F" target="_blank" title="https://ibest-orm.ibestservices.com/" ref="nofollow noopener noreferrer">IBest-ORM æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-18">7. æœ¬åœ°å­˜å‚¨</h3>
<p>åŸºäº Preferences çš„è½»é‡çº§æœ¬åœ°å­˜å‚¨ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository</strong> æ¶æ„ï¼Œä¸šåŠ¡å±‚é€šè¿‡ Repository è®¿é—®å­˜å‚¨æ•°æ®ã€‚</p>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalStorageViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">AccountStoreRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountStoreRepository</span>();

  <span class="hljs-comment">// ä¿å­˜è´¦å·</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">saveAccount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveAccount</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">accountInput</span>);
  }

  <span class="hljs-comment">// è¯»å–è´¦å·</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadAccount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storedAccount</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">loadAccount</span>();
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fdatastore.html" target="_blank" title="https://harmony.dusksnow.top/help/core/datastore.html" ref="nofollow noopener noreferrer">æœ¬åœ°å­˜å‚¨æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-19">å·¥å…·ç±»</h2>
<p>æ¡†æ¶å†…ç½®äº†å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œé¿å…ä¸šåŠ¡å±‚é‡å¤é€ è½®å­ï¼š</p>
<ul>
<li><strong>ToastUtils</strong>ï¼šToast æç¤ºå°è£…</li>
<li><strong>ContextUtil</strong>ï¼šç»Ÿä¸€è·å–åº”ç”¨/çª—å£ä¸Šä¸‹æ–‡</li>
<li><strong>PreferencesUtil</strong>ï¼šè½»é‡çº§æœ¬åœ°å­˜å‚¨å°è£…</li>
<li><strong>PermissionUtils</strong>ï¼šæƒé™ç”³è¯·å°è£…</li>
</ul>
<blockquote>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Futil.html" target="_blank" title="https://harmony.dusksnow.top/help/core/util.html" ref="nofollow noopener noreferrer">å·¥å…·ç±»æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-20">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-csharp" lang="csharp">AppScope/               <span class="hljs-meta"># åº”ç”¨é…ç½®</span>
entry/                  <span class="hljs-meta"># åº”ç”¨å…¥å£æ¨¡å—</span>
core/                   <span class="hljs-meta"># æ ¸å¿ƒæ¨¡å—</span>
â”‚   â”œâ”€â”€ <span class="hljs-keyword">base</span>/           <span class="hljs-meta"># åŸºç±»</span>
â”‚   â”œâ”€â”€ data/           <span class="hljs-meta"># æ•°æ®å±‚</span>
â”‚   â”œâ”€â”€ database/       <span class="hljs-meta"># æ•°æ®åº“</span>
â”‚   â”œâ”€â”€ datastore/      <span class="hljs-meta"># æ•°æ®å­˜å‚¨</span>
â”‚   â”œâ”€â”€ designsystem/   <span class="hljs-meta"># è®¾è®¡ç³»ç»Ÿ</span>
â”‚   â”œâ”€â”€ ibestui/        <span class="hljs-meta"># IBest UI ç»„ä»¶åº“</span>
â”‚   â”œâ”€â”€ model/          <span class="hljs-meta"># æ•°æ®æ¨¡å‹</span>
â”‚   â”œâ”€â”€ navigation/     <span class="hljs-meta"># å¯¼èˆª</span>
â”‚   â”œâ”€â”€ network/        <span class="hljs-meta"># ç½‘ç»œå±‚</span>
â”‚   â”œâ”€â”€ result/         <span class="hljs-meta"># ç»“æœå¤„ç†</span>
â”‚   â”œâ”€â”€ state/          <span class="hljs-meta"># å…¨å±€çŠ¶æ€</span>
â”‚   â”œâ”€â”€ ui/             <span class="hljs-meta"># UI ç»„ä»¶</span>
â”‚   â””â”€â”€ util/           <span class="hljs-meta"># å·¥å…·ç±»</span>
feature/                <span class="hljs-meta"># åŠŸèƒ½æ¨¡å—</span>
â”‚   â”œâ”€â”€ auth/           <span class="hljs-meta"># è®¤è¯æ¨¡å—</span>
â”‚   â”œâ”€â”€ demo/           <span class="hljs-meta"># ç¤ºä¾‹æ¨¡å—</span>
â”‚   â”œâ”€â”€ main/           <span class="hljs-meta"># ä¸»æ¨¡å—</span>
â”‚   â””â”€â”€ user/           <span class="hljs-meta"># ç”¨æˆ·æ¨¡å—</span>
</code></pre>
<p><strong>ç›¸å…³èµ„æºï¼š</strong></p>
<ul>
<li><strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top" target="_blank" title="https://harmony.dusksnow.top" ref="nofollow noopener noreferrer">harmony.dusksnow.top</a></li>
<li><strong>IBest-UI-V2 ç»„ä»¶åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fibestui-v2.ibestservices.com" target="_blank" title="https://ibestui-v2.ibestservices.com" ref="nofollow noopener noreferrer">ibestui-v2.ibestservices.com</a></li>
<li><strong>IBest-ORM æ•°æ®åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fibest-orm.ibestservices.com" target="_blank" title="https://ibest-orm.ibestservices.com" ref="nofollow noopener noreferrer">ibest-orm.ibestservices.com</a></li>
</ul>
<p><strong>ç›¸å…³é¡¹ç›®ï¼š</strong></p>
<p>HarmonyKit æºäº <strong>é’å•†åŸï¼ˆHarmonyOSï¼‰</strong> çš„å®è·µï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹å®Œæ•´çš„ç”µå•†ä¸šåŠ¡å®ç°ï¼š</p>
<ul>
<li><strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FCoolMallArkTS" target="_blank" title="https://github.com/Joker-x-dev/CoolMallArkTS" ref="nofollow noopener noreferrer">github.com/Joker-x-devâ€¦</a></li>
<li><strong>Gitee</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FCoolMallArkTS" target="_blank" title="https://gitee.com/Joker-x-dev/CoolMallArkTS" ref="nofollow noopener noreferrer">gitee.com/Joker-x-devâ€¦</a></li>
</ul>
<blockquote>
<p><strong>å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Star æ”¯æŒï¼</strong></p>
<ul>
<li><strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://github.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">github.com/Joker-x-devâ€¦</a></li>
<li><strong>Gitee</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://gitee.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">gitee.com/Joker-x-devâ€¦</a></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js]]></title>    <link>https://juejin.cn/post/7598465042967805992</link>    <guid>https://juejin.cn/post/7598465042967805992</guid>    <pubDate>2026-01-24T05:22:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042967805992" data-draft-id="7598401650857213952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:22:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»•é’å±±"/> <meta itemprop="url" content="https://juejin.cn/user/3206601805674094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3206601805674094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»•é’å±±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:22:03.000Z" title="Sat Jan 24 2026 05:22:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 æ ¸å¿ƒçŸ¥è¯†ç‚¹è¯»ä¹¦ç¬”è®°</h2>
<h3 data-id="heading-1">ä¸€ã€Vue æ ¸å¿ƒåŸç†ä¸æ¶æ„</h3>
<h4 data-id="heading-2">1. MVVM æ ¸å¿ƒæ¨¡å¼ï¼ˆæ ¸å¿ƒæ¶æ„ï¼‰</h4>
<p>Vue åŸºäº MVVM æ¨¡å¼è®¾è®¡ï¼Œæ ¸å¿ƒæ˜¯å®ç°è§†å›¾ä¸æ•°æ®çš„è§£è€¦ï¼Œä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š</p>





















<table><thead><tr><th><strong>æ¨¡å—</strong></th><th><strong>æ ¸å¿ƒèŒè´£</strong></th></tr></thead><tbody><tr><td>Model</td><td>æ•°æ®å±‚ï¼Œè´Ÿè´£ä¸šåŠ¡æ•°æ®å¤„ç†ï¼ˆçº¯æ•°æ®ï¼Œæ— è§†å›¾äº¤äº’é€»è¾‘ï¼‰</td></tr><tr><td>View</td><td>è§†å›¾å±‚ï¼Œå³ç”¨æˆ·ç•Œé¢ï¼ˆä»…å±•ç¤ºå†…å®¹ï¼Œä¸å¤„ç†æ•°æ®é€»è¾‘ï¼‰</td></tr><tr><td>ViewModel</td><td>æ¡¥æ¢å±‚ï¼Œè¿æ¥ View å’Œ Modelï¼ŒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼š âœ… DOM Listenersï¼šç›‘å¬ View ä¸­ DOM å˜åŒ–ï¼ŒåŒæ­¥åˆ° Model âœ… Data Bindingsï¼šç›‘å¬ Model ä¸­æ•°æ®å˜åŒ–ï¼ŒåŒæ­¥åˆ° View</td></tr></tbody></table>
<blockquote>
<p>å…³é”®ï¼šView å’Œ Model ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ ViewModel ä¸­è½¬ï¼Œå®ç°è§£è€¦ã€‚</p>
</blockquote>
<h4 data-id="heading-3">2. Vue æ ¸å¿ƒç‰¹æ€§ï¼ˆå››å¤§æ ¸å¿ƒï¼‰</h4>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>å…·ä½“è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹/åº”ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>æ•°æ®é©±åŠ¨è§†å›¾</td><td>æ•°æ®å˜åŒ–è‡ªåŠ¨è§¦å‘è§†å›¾é‡æ–°æ¸²æŸ“ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOM</td><td>ä¿®æ”¹å˜é‡å€¼ â†’ é¡µé¢è‡ªåŠ¨æ›´æ–°</td></tr><tr><td>åŒå‘æ•°æ®ç»‘å®š</td><td>è§†å›¾å˜åŒ– â†” æ•°æ®å˜åŒ–åŒå‘åŒæ­¥</td><td>è¡¨å•è¾“å…¥æ¡†å†…å®¹è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®å˜é‡</td></tr><tr><td>æŒ‡ä»¤</td><td>åˆ†å†…ç½®æŒ‡ä»¤ï¼ˆVue è‡ªå¸¦ï¼‰å’Œè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œä»¥<code>v-</code>å¼€å¤´ç»‘å®šåˆ° DOM å…ƒç´ </td><td><code>v-bind</code>ï¼ˆå•å‘ç»‘å®šï¼‰ã€<code>v-if</code>ï¼ˆæ¡ä»¶æ¸²æŸ“ï¼‰ã€<code>v-for</code>ï¼ˆåˆ—è¡¨æ¸²æŸ“ï¼‰</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒæ‰©å±•åŠŸèƒ½ï¼Œé…ç½®ç®€å•</td><td>VueRouterï¼ˆè·¯ç”±ï¼‰ã€Piniaï¼ˆçŠ¶æ€ç®¡ç†ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-4">äºŒã€Vue ç‰ˆæœ¬ä¸å¼€å‘ç¯å¢ƒ</h3>
<h4 data-id="heading-5">1. Vue2 vs Vue3 æ ¸å¿ƒå·®å¼‚</h4>





















<table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>Vue3 å˜åŒ–</strong></th></tr></thead><tbody><tr><td>æ–°å¢åŠŸèƒ½</td><td>ç»„åˆå¼ï¼ˆCompositionï¼‰APIã€å¤šæ ¹èŠ‚ç‚¹ç»„ä»¶ã€åº•å±‚æ¸²æŸ“/å“åº”å¼é€»è¾‘é‡æ„ï¼ˆæ€§èƒ½æå‡ï¼‰</td></tr><tr><td>åºŸå¼ƒåŠŸèƒ½</td><td>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€<code>$on()</code>/<code>$off()</code>/<code>$once()</code>Â å®ä¾‹æ–¹æ³•</td></tr><tr><td>å…¼å®¹æ€§</td><td>å…¼å®¹ Vue2 ç»å¤§å¤šæ•° APIï¼Œæ–°é¡¹ç›®æ¨èç›´æ¥ä½¿ç”¨ Vue3</td></tr></tbody></table>
<h4 data-id="heading-6">2. å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼ˆå¿…è£…ï¼‰</h4>
<ol>
<li><strong>ç¼–è¾‘å™¨</strong>ï¼šVSCode â†’ å®‰è£…ã€ŒVue (Official)ã€æ‰©å±•ï¼ˆæä¾›ä»£ç é«˜äº®ã€è¯­æ³•æç¤ºï¼‰</li>
<li><strong>è¿è¡Œç¯å¢ƒ</strong>ï¼šNode.jsï¼ˆå®˜ç½‘ä¸‹è½½å®‰è£…ï¼Œä¸ºåŒ…ç®¡ç†å·¥å…·æä¾›åŸºç¡€ï¼‰</li>
<li><strong>åŒ…ç®¡ç†å·¥å…·</strong>ï¼šnpm/yarnï¼ˆç®¡ç†ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œæ”¯æŒä¸€é”®å®‰è£…/å‡çº§/å¸è½½ï¼Œé¿å…æ‰‹åŠ¨ä¸‹è½½è§£å‹ï¼‰</li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€Vite åˆ›å»º Vue3 é¡¹ç›®ï¼ˆæ ¸å¿ƒæ“ä½œï¼‰</h3>
<h4 data-id="heading-8">1. é¡¹ç›®åˆ›å»ºå‘½ä»¤ï¼ˆé€‚é… npm10 ç‰ˆæœ¬ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Yarn æ–¹å¼ï¼ˆæ¨èï¼‰</span>
yarn create vite hello-vite --template vue
<span class="hljs-meta prompt_">
# </span><span class="bash">äº¤äº’æç¤ºå¤„ç†ï¼ˆå…³é”®æ­¥éª¤ï¼Œä¸è¦é—æ¼ï¼‰ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">1. æç¤º <span class="hljs-string">"Use rolldown-vite (Experimental)?"</span> â†’ å›è½¦é€‰ Noï¼ˆä¼˜å…ˆä½¿ç”¨ç¨³å®šç‰ˆï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">2. æç¤º <span class="hljs-string">"Install with yarn and start now?"</span> â†’ å›è½¦é€‰ Yesï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–å¹¶å¯åŠ¨é¡¹ç›®ï¼‰</span>
</code></pre>
<h4 data-id="heading-9">2. æ‰‹åŠ¨åˆ›å»ºå‘½ä»¤ï¼ˆè¡¥å……ï¼‰</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># npm æ–¹å¼</span>
npm create vite@latest
<span class="hljs-comment"># yarn æ–¹å¼</span>
yarn create vite
<span class="hljs-comment"># åç»­éœ€æ‰‹åŠ¨å¡«å†™é¡¹ç›®åç§°ã€é€‰æ‹©æ¡†æ¶ï¼ˆVueï¼‰ã€é€‰æ‹©å˜ä½“ï¼ˆJavaScriptï¼‰</span>
</code></pre>
<h3 data-id="heading-10">å››ã€Vue3 é¡¹ç›®æ ¸å¿ƒæ–‡ä»¶ä¸ç›®å½•</h3>
<h4 data-id="heading-11">1. é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">hello-vite/          <span class="hljs-comment"># é¡¹ç›®æ ¹ç›®å½•</span>
â”œâ”€â”€ node_modules/    <span class="hljs-comment"># ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰</span>
â”œâ”€â”€ dist/            <span class="hljs-comment"># æ„å»ºäº§ç‰©ï¼ˆæ‰§è¡Œ yarn build åç”Ÿæˆï¼Œç”¨äºéƒ¨ç½²ï¼‰</span>
â”œâ”€â”€ src/             <span class="hljs-comment"># æºä»£ç ç›®å½•ï¼ˆå¼€å‘æ ¸å¿ƒï¼‰</span>
â”‚   â”œâ”€â”€ assets/      <span class="hljs-comment"># é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€æ ·å¼ç­‰ï¼‰</span>
â”‚   â”œâ”€â”€ components/  <span class="hljs-comment"># è‡ªå®šä¹‰ç»„ä»¶</span>
â”‚   â”œâ”€â”€ App.vue      <span class="hljs-comment"># æ ¹ç»„ä»¶</span>
â”‚   â”œâ”€â”€ main.js      <span class="hljs-comment"># é¡¹ç›®å…¥å£æ–‡ä»¶</span>
â”‚   â””â”€â”€ style.css    <span class="hljs-comment"># å…¨å±€æ ·å¼</span>
â”œâ”€â”€ index.html       <span class="hljs-comment"># é¡µé¢å…¥å£æ–‡ä»¶</span>
â””â”€â”€ package.json     <span class="hljs-comment"># é¡¹ç›®é…ç½®ï¼ˆä¾èµ–ã€è„šæœ¬å‘½ä»¤ï¼‰</span>
</code></pre>
<h4 data-id="heading-12">2. æ ¸å¿ƒæ–‡ä»¶ä»£ç è§£æï¼ˆå¸¦å®Œæ•´æ³¨é‡Šï¼‰</h4>
<h5 data-id="heading-13">ï¼ˆ1ï¼‰index.htmlï¼ˆé¡µé¢å…¥å£ï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>hello-vite<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Vue å®ä¾‹æŒ‚è½½å®¹å™¨ï¼šè¢« main.js ä¸­çš„ Vue å®ä¾‹æ§åˆ¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- type="module"ï¼šå¯ç”¨ ES6 æ¨¡å—åŒ–è¯­æ³•ï¼Œå¼•å…¥é¡¹ç›®å…¥å£æ–‡ä»¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-14">ï¼ˆ2ï¼‰src/main.jsï¼ˆé¡¹ç›®å…¥å£ï¼Œåˆ›å»º Vue å®ä¾‹ï¼‰</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä» Vue ä¸­å¯¼å…¥åˆ›å»ºåº”ç”¨å®ä¾‹çš„æ ¸å¿ƒå‡½æ•°</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// å¯¼å…¥å…¨å±€æ ·å¼æ–‡ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-comment">// å¯¼å…¥æ ¹ç»„ä»¶ï¼ˆApp.vueï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-comment">// æ–¹å¼1ï¼šç®€æ´å†™æ³•ï¼ˆåˆ›å»ºå®ä¾‹ + æŒ‚è½½åˆ° #app å®¹å™¨ï¼‰</span>
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// æ–¹å¼2ï¼šåˆ†æ­¥å†™æ³•ï¼ˆæ›´æ˜“ç†è§£ï¼Œæ•ˆæœä¸€è‡´ï¼‰</span>
<span class="hljs-comment">// const app = createApp(App) // åˆ›å»º Vue åº”ç”¨å®ä¾‹</span>
<span class="hljs-comment">// app.mount('#app') // æŒ‚è½½å®ä¾‹ï¼ˆä»…å¯è°ƒç”¨ä¸€æ¬¡ï¼‰</span>
</code></pre>
<h5 data-id="heading-15">ï¼ˆ3ï¼‰src/App.vueï¼ˆæ ¹ç»„ä»¶ï¼Œå•æ–‡ä»¶ç»„ä»¶æ ¸å¿ƒï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- script setupï¼šVue3 ç»„åˆå¼ API è¯­æ³•ç³–ï¼Œç®€åŒ–ç»„ä»¶ç¼–å†™ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// å¯¼å…¥å­ç»„ä»¶ï¼ˆHelloWorld.vueï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/HelloWorld.vue'</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- templateï¼šç»„ä»¶æ¨¡æ¿ç»“æ„ï¼ˆè§†å›¾éƒ¨åˆ†ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://vite.dev"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/vite.svg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Vite logo"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://vuejs.org/"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./assets/vue.svg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo vue"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Vue logo"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ä½¿ç”¨å­ç»„ä»¶ï¼Œä¼ é€’ msg å±æ€§ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">HelloWorld</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">"Vite + Vue"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- style scopedï¼šæ ·å¼ä»…ä½œç”¨äºå½“å‰ç»„ä»¶ï¼ˆé€šè¿‡ Hash éš”ç¦»ï¼Œä¸å½±å“å­ç»„ä»¶ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.logo</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">6em</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1.5em</span>;
  <span class="hljs-attribute">will-change</span>: filter;
  <span class="hljs-attribute">transition</span>: filter <span class="hljs-number">300ms</span>;
}
<span class="hljs-selector-class">.logo</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2em</span> <span class="hljs-number">#646cffaa</span>);
}
<span class="hljs-selector-class">.logo</span><span class="hljs-selector-class">.vue</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2em</span> <span class="hljs-number">#42b883aa</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-16">äº”ã€æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h3>
<h4 data-id="heading-17">1. æ ¸å¿ƒåŸç†</h4>
<ul>
<li>Vue åŸºäº MVVM æ¨¡å¼ï¼Œé€šè¿‡ ViewModel å®ç°è§†å›¾ä¸æ•°æ®çš„åŒå‘é©±åŠ¨ï¼Œæ ¸å¿ƒæ˜¯ã€Œæ•°æ®é©±åŠ¨è§†å›¾ã€ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOMï¼›</li>
<li>åŒå‘æ•°æ®ç»‘å®šæ˜¯ Vue æ ¸å¿ƒç‰¹æ€§ï¼Œè¡¨å•åœºæ™¯ä¸‹å¯è‡ªåŠ¨åŒæ­¥è§†å›¾ä¸æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-18">2. é¡¹ç›®å¼€å‘</h4>
<ul>
<li>Vue3 æ¨èä½¿ç”¨ Vite åˆ›å»ºé¡¹ç›®ï¼ˆæ¯” VueCLI æ›´å¿«ï¼‰ï¼Œnpm10 ç‰ˆæœ¬ä¸‹ä¼˜å…ˆç”¨Â <code>yarn create vite é¡¹ç›®å --template vue</code>Â å‘½ä»¤ï¼›</li>
<li>é¡¹ç›®æ ¸å¿ƒæ–‡ä»¶ï¼šindex.htmlï¼ˆé¡µé¢å…¥å£ï¼‰â†’ main.jsï¼ˆåˆ›å»º Vue å®ä¾‹ï¼‰â†’ App.vueï¼ˆæ ¹ç»„ä»¶ï¼‰ï¼Œä¸‰è€…æ„æˆé¡¹ç›®åŸºç¡€éª¨æ¶ã€‚</li>
</ul>
<h4 data-id="heading-19">3. å…³é”®æ³¨æ„ç‚¹</h4>
<ul>
<li><code>mount()</code>Â æ–¹æ³•ä»…å¯è°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‚è½½ç›®æ ‡å¯ä»¥æ˜¯ DOM å…ƒç´ æˆ– CSS é€‰æ‹©å™¨ï¼ˆ#app/.appï¼‰ï¼›</li>
<li><code>&lt;style scoped&gt;</code>Â æ ·å¼ä»…ä½œç”¨äºå½“å‰ç»„ä»¶ï¼Œé¿å…æ ·å¼æ±¡æŸ“ï¼›</li>
<li>Vue3 åºŸå¼ƒäº†è¿‡æ»¤å™¨ã€<code>$on/$off/$once</code>Â ç­‰åŠŸèƒ½ï¼Œå¼€å‘æ—¶éœ€é¿å¼€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®]]></title>    <link>https://juejin.cn/post/7598499504170450982</link>    <guid>https://juejin.cn/post/7598499504170450982</guid>    <pubDate>2026-01-24T05:28:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170450982" data-draft-id="7598532592455237659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2026-01-24T05:28:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ougt"/> <meta itemprop="url" content="https://juejin.cn/user/3863023435394699"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3863023435394699/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ougt
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:28:51.000Z" title="Sat Jan 24 2026 05:28:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©æ—©ä¸Šé†’æ¥ï¼Œå‘ç”Ÿäº†ä¸€ä»¶è®©æˆ‘æœ‰ç‚¹æ‡µçš„äº‹æƒ…ã€‚æˆ‘å‰æ®µæ—¶é—´ä¸ºäº†å­¦ä¹  Svelte è€Œå†™çš„ä¸€ä¸ªâ€œç»ƒæ‰‹é¡¹ç›®â€â€”â€” <strong>Zsweep</strong>ï¼Œç«Ÿç„¶å†²ä¸Šäº† <strong>Hacker News (HN) é¦–é¡µçš„ç¬¬ 5 å</strong>ã€‚</p>
<p>ï¼ˆè¿™æ˜¯åé¢çœ‹åˆ°æ—¶çš„æˆªå›¾ï¼Œæœ€å¼€å§‹ä¸Šäº†å‰5ï¼Œå¯æƒœæ²¡æœ‰æˆªå±ğŸ˜­ï¼‰
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1857c98a3c7440aeb8d491379a2222f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=XI4%2BVzyXsjGcw5HMILUtwp9b7Xc%3D" alt="image.png" loading="lazy"/></p>
<p>(æ­¤å›¾ä¸ºè¯ï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebad69d24a6f4539be3f729fc9910bec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=1rOZFA5NfFWlS48Qq8nExyZDxYA%3D" alt="image.png" loading="lazy"/></p>
<p>(å°ç«™ä¸‹åˆæ¸¸æˆæ—¶é•¿æš´æ¶¨100å°æ—¶ğŸ¤¯ï¼‰
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67319348dcaa4cec872f1246a3f751bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=w9JznKxuTwxG9o1MJocfuR0x4VA%3D" alt="image.png" loading="lazy"/></p>
<p>å¯¹äºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼ŒHN çš„é¦–é¡µå°±åƒæ˜¯â€œå¥¥æ–¯å¡çº¢æ¯¯â€ã€‚çœ‹ç€è‡ªå·±å†™çš„ä»£ç è¢«å…¨çƒå„åœ°çš„æå®¢è®¨è®ºï¼Œ æˆ‘æƒ³è¶çƒ­æ‰“é“ï¼Œåœ¨æ˜é‡‘å¤ç›˜ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„<strong>å¼€å‘æ€è·¯</strong>ã€<strong>æŠ€æœ¯æ ˆé€‰æ‹©</strong>ï¼Œä»¥åŠæˆ‘ä¸ºäº†è®©å®ƒâ€œå¥½ç©â€è€Œæ­»ç£•çš„ä¸€äº›<strong>æŠ€æœ¯ç»†èŠ‚</strong>ã€‚</p>
<p>HNï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46667849" target="_blank" title="https://news.ycombinator.com/item?id=46667849" ref="nofollow noopener noreferrer">news.ycombinator.com/item?id=466â€¦</a></p>
<p>Repo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foug-t%2Fzsweep" target="_blank" title="https://github.com/oug-t/zsweep" ref="nofollow noopener noreferrer">github.com/oug-t/zsweeâ€¦</a></p>
<h2 data-id="heading-0">ğŸ® ä»€ä¹ˆæ˜¯ Zsweepï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼ŒZsweep æ˜¯ä¸€ä¸ª <strong>Vim é”®ä½é©±åŠ¨çš„æ‰«é›·æ¸¸æˆ</strong>ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzsweep.com" target="_blank" title="https://zsweep.com" ref="nofollow noopener noreferrer">zsweep.com</a></p>
<p><strong>å®ƒçš„çµæ„Ÿæ¥æºæœ‰ä¸¤ä¸ªï¼š</strong></p>
<ol>
<li><strong>Monkeytype</strong>ï¼šæˆ‘å¾ˆå–œæ¬¢ Monkeytype é‚£ç§æç®€ã€æ— å¹¿å‘Šã€çº¯ç²¹è¿½æ±‚é€Ÿåº¦çš„æ‰“å­—ä½“éªŒã€‚</li>
<li><strong>Vim/Neovim</strong>ï¼šä½œä¸ºä¸€åå¼€å‘è€…ï¼Œæˆ‘æƒ³æŠŠ <code>h</code> <code>j</code> <code>k</code> <code>l</code> çš„è‚Œè‚‰è®°å¿†å»¶ä¼¸åˆ°æ¸¸æˆé‡Œã€‚</li>
</ol>
<p>æ‰€ä»¥ Zsweep çš„è®¾è®¡å“²å­¦å°±æ˜¯ï¼š<strong>æç®€ UI + æè‡´æ‰‹é€Ÿ + å…¨é”®ç›˜æ“ä½œ</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d7b674a5e946dca622147610108a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=7NiGUAtTa4OfxRwuftmEnVQ7gAA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">ğŸ› ï¸ æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆé€‰æ‹© SvelteKit + Supabaseï¼Ÿ</h2>
<p>ä½œä¸ºä¸€ä¸ªå…¨æ ˆé¡¹ç›®ï¼Œæˆ‘æ²¡æœ‰é€‰æ‹©æˆ‘æœ€ç†Ÿæ‚‰çš„ Reactï¼Œè€Œæ˜¯é€‰æ‹©äº† <strong>SvelteKit</strong>ï¼Œæ­é… <strong>Supabase</strong>ã€‚</p>
<h3 data-id="heading-2">1. å‰ç«¯ï¼šSvelteKit + Tailwind CSS</h3>
<p>Svelte çœŸçš„å¤ªçˆ½äº†ã€‚åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†â€œWrite less codeâ€çš„å«ä¹‰ã€‚</p>
<ul>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šä¸éœ€è¦å¤æ‚çš„ Context æˆ– Reduxï¼ŒSvelte çš„å“åº”å¼å˜é‡è®©å¤„ç†æ¸¸æˆçŠ¶æ€ï¼ˆæ¯”å¦‚è®¡æ—¶å™¨ã€å‰©ä½™é›·æ•°ã€å½“å‰é€‰ä¸­çš„æ ¼å­ï¼‰å˜å¾—å¼‚å¸¸ç®€å•ã€‚</li>
<li><strong>åŠ¨ç”»</strong>ï¼šSvelte å†…ç½®çš„ <code>transition</code> å’Œ <code>animate</code> æŒ‡ä»¤ï¼Œè®©æˆ‘å‡ è¡Œä»£ç å°±å®ç°äº†â€œè¸©é›·â€æ—¶çš„å±å¹•éœ‡åŠ¨å’Œç»“ç®—ç•Œé¢çš„æ•°å­—è·³åŠ¨æ•ˆæœã€‚</li>
<li><strong>Vim é”®ä½ç»‘å®š</strong>ï¼šæˆ‘å†™äº†ä¸€ä¸ªå…¨å±€çš„é”®ç›˜ç›‘å¬å™¨ï¼Œé…åˆ Svelte çš„ storeï¼Œå®ç°äº†ä¸æ»‘çš„å…‰æ ‡ç§»åŠ¨ä½“éªŒã€‚</li>
</ul>
<h3 data-id="heading-3">2. åç«¯ &amp; æ•°æ®åº“ï¼šSupabase</h3>
<p>å› ä¸ºæ˜¯ç‹¬ç«‹å¼€å‘ï¼Œæˆ‘ä¸æƒ³èŠ±æ—¶é—´åœ¨é…è¿ç»´ç¯å¢ƒä¸Šã€‚Supabase æä¾›äº† PostgreSQL æ•°æ®åº“å’Œå¼€ç®±å³ç”¨çš„ Authï¼ˆè®¤è¯ï¼‰æœåŠ¡ã€‚</p>
<ul>
<li><strong>ç™»å½•</strong>ï¼šç›´æ¥é›†æˆäº† GitHub å’Œ Google OAuthï¼Œå‡ è¡Œé…ç½®å°±æå®šã€‚</li>
<li><strong>æ’è¡Œæ¦œ</strong>ï¼šåˆ©ç”¨ Postgres çš„å¼ºå¤§æŸ¥è¯¢èƒ½åŠ›ï¼Œæˆ‘èƒ½å¾ˆå¿«ç®—å‡ºå…¨çƒæ’åã€‚</li>
</ul>
<h2 data-id="heading-4">ğŸ’» é‚£äº›è®©æˆ‘â€œæ‰å¤´å‘â€çš„æŠ€æœ¯ç»†èŠ‚</h2>
<p>è™½ç„¶æ˜¯æ‰«é›·ï¼Œä½†ä¸ºäº†è¿½æ±‚æè‡´ä½“éªŒï¼Œæˆ‘åœ¨æ•°æ®å¤„ç†ä¸ŠèŠ±äº†ä¸å°‘å¿ƒæ€ã€‚</p>
<h3 data-id="heading-5">1. æ ¸å¿ƒç®—æ³•ï¼šMines/Min (æ‰«é›·æ•ˆç‡)</h3>
<p>ä¼ ç»Ÿçš„æ‰«é›·åªçœ‹æ—¶é—´ï¼Œä½†ä¸åŒéš¾åº¦çš„é›·æ•°ä¸ä¸€æ ·ã€‚ä¸ºäº†è¡¡é‡ç©å®¶çš„çœŸå®æ°´å¹³ï¼Œæˆ‘å‚è€ƒäº† Monkeytype çš„ <code>WPM</code> (Words Per Minute)ï¼Œè®¾è®¡äº† <strong>Mines/Min</strong> (æ¯åˆ†é’Ÿæ‰«é›·æ•°) æŒ‡æ ‡ã€‚</p>
<p>(ä¹Ÿimplementäº†3BVï¼Œä½†è€ƒè™‘åˆ°time modeï¼Œè¿˜éœ€åç»­æ›´æ–°ï¼‰</p>
<p>è¿™é‡Œæœ‰ä¸ªå‘ï¼šå¦‚æœæ˜¯é€šè¿‡ç‚¹å‡»å¤ä½ï¼ˆé‡å¼€ï¼‰å¤ªå¿«ï¼Œå¯èƒ½ä¼šå¯¼è‡´é™¤ä»¥é›¶æˆ–è€…æ—¶é—´æçŸ­çš„æ•°æ®å¼‚å¸¸ã€‚ æˆ‘åœ¨å‰ç«¯åŠ äº†ä¸€ä¸ªå¥å£®çš„è®¡ç®—é€»è¾‘ï¼š</p>
<p>TypeScript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ ¸å¿ƒè®¡ç®—é€»è¾‘ç‰‡æ®µ</span>
if (timeTaken &gt; <span class="hljs-number">0</span>) {
  const minesPerMin = <span class="hljs-built_in">parseFloat</span>(((mines / timeTaken) * <span class="hljs-number">60</span>)<span class="hljs-selector-class">.toFixed</span>(<span class="hljs-number">1</span>));
  <span class="hljs-comment">// åªæœ‰å½“æˆç»©æ›´ä¼˜æ—¶æ‰æ›´æ–°æœ¬åœ°çš„æœ€ä½³è®°å½•</span>
  if (!calculatedBests[cat] || minesPerMin &gt; calculatedBests[cat].value) {
    calculatedBests<span class="hljs-selector-attr">[cat]</span> = {
      value: minesPerMin,
      date: g.created_at
    };
  }
}
</code></pre>
<h3 data-id="heading-6">2. å…¨çƒæ’è¡Œæ¦œä¸â€œé˜²ä½œå¼Šâ€</h3>
<p>ä¸ºäº†åš Leaderboardï¼Œæˆ‘åˆ©ç”¨ Supabase çš„ Foreign Key æŠŠ <code>game_results</code> è¡¨å’Œ <code>profiles</code> è¡¨å…³è”èµ·æ¥ã€‚</p>
<p>åˆšæ‰ä¸Šçº¿åå‘ç°ä¸€ä¸ªå°æ’æ›²ï¼šæ•°æ®åº“é‡Œå‡ºç°äº†ä¸€äº› <strong>0ç§’</strong> çš„é€šå…³è®°å½•ï¼ˆå¤§æ¦‚æ˜¯è°ƒè¯•æ—¶çš„æ®‹ç•™æ•°æ®ï¼Œæˆ–è€…æ˜¯ API è¢«äººç”¨ Postman åˆ·äº†ï¼‰ã€‚</p>
<p>ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œæˆ‘åœ¨åç«¯æŸ¥è¯¢æ—¶åŠ äº†ä¸¥æ ¼çš„è¿‡æ»¤å™¨ï¼Œåˆ©ç”¨ SQL ç›´æ¥è¿‡æ»¤æ‰å¼‚å¸¸æ•°æ®ï¼š</p>
<p>TypeScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> supabase
  .<span class="hljs-keyword">from</span>(<span class="hljs-string">'game_results'</span>)
  .<span class="hljs-keyword">select</span>(<span class="hljs-string">'time, profiles(username)'</span>)
  .eq(<span class="hljs-string">'win'</span>, <span class="hljs-literal">true</span>)
  .gt(<span class="hljs-string">'time'</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// è¿‡æ»¤æ‰ 0s çš„å¼‚å¸¸æ•°æ®</span>
  .order(<span class="hljs-string">'time'</span>, { <span class="hljs-keyword">ascending</span>: <span class="hljs-literal">true</span> })
  .limit(<span class="hljs-number">50</span>);
</code></pre>
<p>ç°åœ¨ï¼Œæ’è¡Œæ¦œç»ˆäºå¹²å‡€äº†ï¼Œè¿˜èƒ½æ˜¾ç¤ºâ€œYour Rankâ€é«˜äº®è‡ªå·±çš„æ’åã€‚ï¼ˆä¸‹ä¸€ä¸ªPRï¼Œçš„ployï¼‰</p>
<h3 data-id="heading-7">3. ç”¨æˆ·ä½“éªŒç»†èŠ‚</h3>
<ul>
<li><strong>Glitch é£æ ¼</strong>ï¼šå½“è¸©é›·å¤±è´¥æ—¶ï¼Œæˆ‘æ²¡æœ‰ç”¨æ™®é€šçš„å¼¹çª—ï¼Œè€Œæ˜¯å†™äº†ä¸€ä¸ª CSS Glitchï¼ˆæ•…éšœé£ï¼‰ç‰¹æ•ˆï¼Œé…åˆ "FATAL_ERR" çš„æ–‡æ¡ˆï¼Œæ›´æœ‰æå®¢æ„Ÿã€‚</li>
<li><strong>çƒ­åŠ›å›¾</strong>ï¼šå‚è€ƒ GitHub Contributionï¼Œæˆ‘åœ¨ä¸ªäººä¸»é¡µåšäº†ä¸€ä¸ªæ‰«é›·çƒ­åŠ›å›¾ï¼Œè®°å½•ç©å®¶æ¯å¤©çš„æ´»è·ƒåº¦ã€‚</li>
</ul>
<h2 data-id="heading-8">ğŸš€ æ€»ç»“ä¸å¼€æº</h2>
<p>è¿™æ¬¡å†²ä¸Š Hacker News ç¬¬ 5 åï¼Œç»™æˆ‘æœ€å¤§çš„å¯ç¤ºæ˜¯ï¼š<strong>ä¸è¦ç­‰åˆ°é¡¹ç›®å®Œç¾äº†æ‰å‘å¸ƒã€‚</strong></p>
<p>Zsweep å…¶å®è¿˜æœ‰å¾ˆå¤š Issuesï¼ˆæ¯”å¦‚ä¹‹å‰çš„ Joined Date æ˜¾ç¤º Invalid Dateï¼Œåˆšåˆšæ‰ä¿®å¥½ ğŸ˜‚ï¼‰ï¼ŒUI ä¹Ÿä¸å¤Ÿå®Œç¾ã€‚ä½†å› ä¸ºå®ƒè§£å†³äº†ä¸€ä¸ªå°ç—›ç‚¹ï¼ˆæƒ³ç”¨ Vim ç©æ¸¸æˆï¼‰ï¼Œå¹¶ä¸”åšå¾—è¶³å¤Ÿç®€å•çº¯ç²¹ï¼Œå°±è·å¾—äº†å¾ˆå¤šå¼€å‘è€…çš„å–œçˆ±ã€‚</p>
<p>ç›®å‰é¡¹ç›®å®Œå…¨<strong>å¼€æº</strong>ï¼Œå¦‚æœä½ å¯¹ Svelteã€Vim æˆ–è€…æ‰«é›·æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ¥ GitHub ç»™ä¸ª Starï¼Œæˆ–è€…æ PR ä¸€èµ·æ”¹è¿›å®ƒï¼</p>
<ul>
<li><strong>Live Demo (è¯•ç©)</strong> : <a href="https://link.juejin.cn?target=https%3A%2F%2Fzsweep.com" target="_blank" title="https://zsweep.com" ref="nofollow noopener noreferrer">zsweep.com</a></li>
<li><strong>GitHub æºç </strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foug-t%2Fzsweep" target="_blank" title="https://github.com/oug-t/zsweep" ref="nofollow noopener noreferrer">github.com/oug-t/zsweeâ€¦</a></li>
</ul>
<p><strong>å¦‚æœä½ ä¹Ÿå–œæ¬¢ Vim æˆ–è€… Svelteï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“]]></title>    <link>https://juejin.cn/post/7598641282324496411</link>    <guid>https://juejin.cn/post/7598641282324496411</guid>    <pubDate>2026-01-24T06:29:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598641282324496411" data-draft-id="7598435950410907658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T06:29:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°çŒ«çˆ±é…·"/> <meta itemprop="url" content="https://juejin.cn/user/492183410194808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/492183410194808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°çŒ«çˆ±é…·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:29:05.000Z" title="Sat Jan 24 2026 06:29:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Bytes - Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“</h2>
<p>ç±»ä¼¼ Rust deku åº“çš„ Go è¯­è¨€å®ç°ï¼Œç”¨äº TCP/UDP å­—èŠ‚æµåè®®çš„è§£æå’Œåºåˆ—åŒ–ã€‚</p>
<h3 data-id="heading-1">ç‰¹æ€§</h3>
<ul>
<li>ä½¿ç”¨ struct tag æè¿°äºŒè¿›åˆ¶æ ¼å¼</li>
<li>æ”¯æŒå¤§ç«¯åºå’Œå°ç«¯åº</li>
<li>æ”¯æŒä½çº§æ“ä½œ</li>
<li>æ”¯æŒæ¡ä»¶å­—æ®µ</li>
<li>æ”¯æŒæ•°ç»„ã€åˆ‡ç‰‡</li>
<li>æ”¯æŒåµŒå¥—ç»“æ„ä½“</li>
<li>æ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–</li>
<li>æ”¯æŒå­—æ®µå¡«å……</li>
</ul>
<h3 data-id="heading-2">å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">go get github.com/teafull/bytes
</code></pre>
<h3 data-id="heading-3">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-4">åŸºæœ¬ä½¿ç”¨</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/teafull/bytes"</span>
)

<span class="hljs-keyword">type</span> PacketHeader <span class="hljs-keyword">struct</span> {
    Magic   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Version <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Type    <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Length  <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åºåˆ—åŒ–</span>
    header := PacketHeader{
        Magic:   <span class="hljs-number">0x1234</span>,
        Version: <span class="hljs-number">1</span>,
        Type:    <span class="hljs-number">2</span>,
        Length:  <span class="hljs-number">16</span>,
    }
    data, err := bytes.Marshal(header)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    fmt.Printf(<span class="hljs-string">"Serialized: %x\n"</span>, data)

    <span class="hljs-comment">// ååºåˆ—åŒ–</span>
    <span class="hljs-keyword">var</span> decoded PacketHeader
    _, err = bytes.Unmarshal(data, &amp;decoded)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    fmt.Printf(<span class="hljs-string">"Decoded: %+v\n"</span>, decoded)
}
</code></pre>
<h4 data-id="heading-5">ä½å­—æ®µ</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> BitFields <span class="hljs-keyword">struct</span> {
    Flag1    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=1"`</span>
    Flag2    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=1"`</span>
    Reserved <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=6"`</span>
    Value    <span class="hljs-type">uint8</span>
}
</code></pre>
<h4 data-id="heading-6">æ¡ä»¶å­—æ®µ</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> ConditionalPacket <span class="hljs-keyword">struct</span> {
    HasOption <span class="hljs-type">bool</span>  <span class="hljs-string">`deku:"bits=1"`</span>
    Reserved  <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=7"`</span>
    Option    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"cond=HasOption"`</span>  <span class="hljs-comment">// ä»…å½“ HasOption ä¸º true æ—¶å­˜åœ¨</span>
    Payload   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-7">åŠ¨æ€æ•°ç»„</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> DynamicArray <span class="hljs-keyword">struct</span> {
    Type   <span class="hljs-type">uint8</span>
    Count  <span class="hljs-type">uint8</span>
    Values []<span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"count=Count,endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-8">åµŒå¥—ç»“æ„ä½“</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Inner <span class="hljs-keyword">struct</span> {
    Value1 <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Value2 <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-keyword">type</span> Outer <span class="hljs-keyword">struct</span> {
    Header Inner
    Length <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-9">è‡ªå®šä¹‰åºåˆ—åŒ–</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CustomField <span class="hljs-keyword">struct</span> {
    Data []<span class="hljs-type">byte</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CustomField)</span></span> MarshalBinary() ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> c.Data, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CustomField)</span></span> UnmarshalBinary(data []<span class="hljs-type">byte</span>) <span class="hljs-type">error</span> {
    <span class="hljs-comment">// è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘</span>
    c.Data = <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(data))
    <span class="hljs-built_in">copy</span>(c.Data, data)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-10">å­—æ®µå¡«å……</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> PaddedPacket <span class="hljs-keyword">struct</span> {
    Type     <span class="hljs-type">uint8</span>
    Padding  <span class="hljs-type">byte</span> <span class="hljs-string">`deku:"pad=3"`</span>  <span class="hljs-comment">// å¡«å……3ä¸ªå­—èŠ‚</span>
    Length   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h3 data-id="heading-11">Tag è¯´æ˜</h3>













































<table><thead><tr><th>Tag</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>endian</code></td><td>å­—èŠ‚åºï¼Œå¯é€‰å€¼ <code>big</code>ã€<code>little</code>ã€<code>native</code></td><td><code>deku:"endian=big"</code></td></tr><tr><td><code>bits</code></td><td>ä½å®½ï¼Œç”¨äºä½å­—æ®µï¼ˆ1-64ä½ï¼‰</td><td><code>deku:"bits=4"</code></td></tr><tr><td><code>bytes</code></td><td>å­—èŠ‚å®½åº¦</td><td><code>deku:"bytes=8"</code></td></tr><tr><td><code>cond</code></td><td>æ¡ä»¶å­—æ®µï¼Œä»…å½“æ¡ä»¶ä¸ºçœŸæ—¶è§£æ</td><td><code>deku:"cond=HasFlag"</code></td></tr><tr><td><code>count</code></td><td>æ•°ç»„/åˆ‡ç‰‡é•¿åº¦ï¼Œæ”¯æŒè¡¨è¾¾å¼</td><td><code>deku:"count=Length"</code> æˆ– <code>deku:"count=Length+1"</code></td></tr><tr><td><code>skip</code></td><td>è·³è¿‡å­—æ®µ</td><td><code>deku:"skip=true"</code></td></tr><tr><td><code>pad</code></td><td>å¡«å……å­—èŠ‚æ•°</td><td><code>deku:"pad=3"</code></td></tr></tbody></table>
<h3 data-id="heading-12">æ¡ä»¶è¡¨è¾¾å¼</h3>
<p>æ”¯æŒä»¥ä¸‹æ ¼å¼çš„æ¡ä»¶è¡¨è¾¾å¼ï¼š</p>
<ul>
<li>å¸ƒå°”å­—æ®µåï¼š<code>HasOption</code></li>
<li>ç­‰äºï¼š<code>Field == 1</code></li>
<li>ä¸ç­‰äºï¼š<code>Field != 0</code></li>
<li>å¤§äºï¼š<code>Field &gt; 5</code></li>
<li>å°äºï¼š<code>Field &lt; 10</code></li>
<li>å¤§äºç­‰äºï¼š<code>Field &gt;= 5</code></li>
<li>å°äºç­‰äºï¼š<code>Field &lt;= 10</code></li>
</ul>
<h3 data-id="heading-13">è®¡æ•°è¡¨è¾¾å¼</h3>
<p>æ”¯æŒä»¥ä¸‹æ ¼å¼çš„è®¡æ•°è¡¨è¾¾å¼ï¼š</p>
<ul>
<li>å­—æ®µåï¼š<code>Count</code></li>
<li>å­—æ®µååŠ å‡ä¹˜é™¤ï¼š<code>Count + 1</code>ã€<code>Length * 2</code></li>
<li>ç›´æ¥æ•°å­—ï¼š<code>4</code></li>
</ul>
<h3 data-id="heading-14">æ”¯æŒçš„ç±»å‹</h3>
<ul>
<li>æ•´æ•°ï¼š<code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code></li>
<li>å¸ƒå°”ï¼š<code>bool</code></li>
<li>æ•°ç»„ï¼š<code>[N]T</code></li>
<li>åˆ‡ç‰‡ï¼š<code>[]T</code></li>
<li>ç»“æ„ä½“ï¼šåµŒå¥—ç»“æ„ä½“</li>
<li>å­—ç¬¦ä¸²ï¼š<code>string</code>ï¼ˆæ”¯æŒå›ºå®šé•¿åº¦å’Œ C å­—ç¬¦ä¸²ï¼‰</li>
</ul>
<h3 data-id="heading-15">API</h3>
<h4 data-id="heading-16">Marshal</h4>
<p>å°†ç»“æ„ä½“åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Marshal</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>)
</code></pre>
<h4 data-id="heading-17">Unmarshal</h4>
<p>ä»å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–åˆ°ç»“æ„ä½“ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Unmarshal</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>, v <span class="hljs-keyword">interface</span>{})</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>)
</code></pre>
<p>è¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œé”™è¯¯ã€‚</p>
<h3 data-id="heading-18">æµ‹è¯•</h3>
<p>è¿è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -v
</code></pre>
<p>æŸ¥çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -run Example -v
</code></pre>
<h3 data-id="heading-19">æ€§èƒ½</h3>
<p>æœ¬åº“ä½¿ç”¨ä½çº§æ“ä½œå’Œåå°„ï¼Œé€‚åˆå¤„ç†ç½‘ç»œåè®®ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚å¯¹äºæ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚</p>
<h4 data-id="heading-20">åŸºå‡†æµ‹è¯•ç»“æœ</h4>
<p>æµ‹è¯•ç¯å¢ƒï¼š</p>
<ul>
<li>OS: macOS (Darwin)</li>
<li>CPU: Apple M2 Pro (arm64)</li>
<li>Go: 1.21</li>
<li>æµ‹è¯•æ—¶é—´: 3s</li>
</ul>
<h5 data-id="heading-21">åºåˆ—åŒ–æ€§èƒ½</h5>





















































<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet (5 bytes)</td><td>560.7</td><td>362</td><td>13</td></tr><tr><td>Medium Packet (10 bytes)</td><td>1196</td><td>565</td><td>22</td></tr><tr><td>Large Packet (148 bytes)</td><td>2390</td><td>976</td><td>26</td></tr><tr><td>Bit Field (4 bytes)</td><td>818.8</td><td>464</td><td>15</td></tr><tr><td>Dynamic Array (22 bytes)</td><td>474.6</td><td>308</td><td>16</td></tr><tr><td>Nested Struct (6 bytes)</td><td>609.8</td><td>368</td><td>15</td></tr><tr><td>Conditional (4 bytes)</td><td>618.0</td><td>360</td><td>12</td></tr></tbody></table>
<h5 data-id="heading-22">ååºåˆ—åŒ–æ€§èƒ½</h5>





















































<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet (5 bytes)</td><td>591.7</td><td>314</td><td>13</td></tr><tr><td>Medium Packet (10 bytes)</td><td>1251</td><td>517</td><td>22</td></tr><tr><td>Large Packet (148 bytes)</td><td>2612</td><td>672</td><td>25</td></tr><tr><td>Bit Field (4 bytes)</td><td>848.2</td><td>416</td><td>15</td></tr><tr><td>Dynamic Array (22 bytes)</td><td>665.9</td><td>308</td><td>18</td></tr><tr><td>Nested Struct (6 bytes)</td><td>644.5</td><td>320</td><td>15</td></tr><tr><td>Conditional (4 bytes)</td><td>651.0</td><td>312</td><td>12</td></tr></tbody></table>
<h5 data-id="heading-23">å¾€è¿”æ€§èƒ½ (Marshal + Unmarshal)</h5>





























<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet</td><td>1170</td><td>677</td><td>26</td></tr><tr><td>Medium Packet</td><td>2489</td><td>1082</td><td>44</td></tr><tr><td>Large Packet</td><td>4977</td><td>1648</td><td>51</td></tr></tbody></table>
<h5 data-id="heading-24">ä½æ“ä½œæ€§èƒ½</h5>























<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Bit Write</td><td>20.91</td><td>0</td><td>0</td></tr><tr><td>Bit Read</td><td>15.64</td><td>0</td><td>0</td></tr></tbody></table>
<h4 data-id="heading-25">æ€§èƒ½åˆ†æ</h4>
<ol>
<li>
<p><strong>åºåˆ—åŒ–æ€§èƒ½</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼ˆ5å­—èŠ‚ï¼‰ï¼š~560 ns/opï¼Œé€‚åˆé«˜é¢‘åœºæ™¯</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼ˆ148å­—èŠ‚ï¼‰ï¼š~2.4 Î¼s/opï¼ŒåŒ…å«128å­—èŠ‚æ•°ç»„</li>
<li>ä½å­—æ®µæ“ä½œé¢å¤–å¼€é”€ï¼š~818 ns/op</li>
</ul>
</li>
<li>
<p><strong>ååºåˆ—åŒ–æ€§èƒ½</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼ˆ5å­—èŠ‚ï¼‰ï¼š~590 ns/op</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼ˆ148å­—èŠ‚ï¼‰ï¼š~2.6 Î¼s/op</li>
<li>ä¸åºåˆ—åŒ–æ€§èƒ½åŸºæœ¬ä¸€è‡´</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜åˆ†é…</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼š~360 B/opï¼Œ13æ¬¡åˆ†é…</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼š~976 B/opï¼Œ26æ¬¡åˆ†é…</li>
<li>ä½æ“ä½œï¼š0åˆ†é…ï¼Œä½¿ç”¨é¢„åˆ†é…ç¼“å†²åŒº</li>
</ul>
</li>
<li>
<p><strong>ä½æ“ä½œæ€§èƒ½</strong></p>
<ul>
<li>çº¯ä½è¯»å†™æ“ä½œï¼š15-21 ns/opï¼Œ0åˆ†é…</li>
<li>éå¸¸é«˜æ•ˆï¼Œæ¥è¿‘å†…å­˜è®¿é—®é€Ÿåº¦</li>
</ul>
</li>
</ol>
<h4 data-id="heading-26">è¿è¡ŒåŸºå‡†æµ‹è¯•</h4>
<p>è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=. -benchmem
</code></pre>
<p>è¿è¡Œç‰¹å®šåŸºå‡†æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=BenchmarkMarshal -benchmem
</code></pre>
<p>è¿è¡ŒåŸºå‡†æµ‹è¯•å¹¶æ˜¾ç¤ºå†…å­˜åˆ†é…è¯¦æƒ…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=. -benchmem -benchtime=5s
</code></pre>
<h4 data-id="heading-27">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li>
<p><strong>å‡å°‘åå°„å¼€é”€</strong></p>
<ul>
<li>å¯¹äºçƒ­ç‚¹è·¯å¾„ï¼Œè€ƒè™‘ä½¿ç”¨ä»£ç ç”Ÿæˆ</li>
<li>ç¼“å­˜åå°„ç±»å‹ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜åˆ†é…ä¼˜åŒ–</strong></p>
<ul>
<li>é‡ç”¨å­—èŠ‚ç¼“å†²åŒº</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å‡å°‘åˆ†é…</li>
</ul>
</li>
<li>
<p><strong>ä½æ“ä½œä¼˜åŒ–</strong></p>
<ul>
<li>æ‰¹é‡å¤„ç†ä½æ“ä½œ</li>
<li>å‡å°‘å¯¹é½æ“ä½œ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">è®¸å¯è¯</h3>
<p>MIT License</p>
<h3 data-id="heading-29">ğŸ“¦ é¡¹ç›®æˆæœ</h3>
<h4 data-id="heading-30">æ ¸å¿ƒåŠŸèƒ½å®ç°</h4>
<p>âœ… <strong>åŸºç¡€æ•°æ®ç±»å‹æ”¯æŒ</strong></p>
<ul>
<li>æ•´æ•°ç±»å‹ï¼šuint8/16/32/64, int8/16/32/64</li>
<li>å¸ƒå°”ç±»å‹ï¼šbool</li>
<li>æ•°ç»„å’Œåˆ‡ç‰‡</li>
<li>åµŒå¥—ç»“æ„ä½“</li>
<li>å­—ç¬¦ä¸²ç±»å‹</li>
</ul>
<p>âœ… <strong>é«˜çº§ç‰¹æ€§</strong></p>
<ul>
<li>ä½çº§æ“ä½œï¼ˆ1-64ä½ï¼‰</li>
<li>å­—èŠ‚åºæ§åˆ¶ï¼ˆå¤§ç«¯åº/å°ç«¯åº/æœ¬æœºå­—èŠ‚åºï¼‰</li>
<li>æ¡ä»¶å­—æ®µï¼ˆåŸºäºå…¶ä»–å­—æ®µå€¼ï¼‰</li>
<li>åŠ¨æ€æ•°ç»„ï¼ˆæ”¯æŒè¡¨è¾¾å¼å®šä¹‰é•¿åº¦ï¼‰</li>
<li>å­—æ®µå¡«å……ï¼ˆè‡ªåŠ¨å¯¹é½ï¼‰</li>
<li>è‡ªå®šä¹‰åºåˆ—åŒ–ï¼ˆå®ç°æ¥å£ï¼‰</li>
</ul>
<p>âœ… <strong>Struct Tag æ”¯æŒ</strong></p>
<pre><code class="hljs language-go" lang="go">deku:<span class="hljs-string">"endian=big"</span>      <span class="hljs-comment">// å­—èŠ‚åº</span>
deku:<span class="hljs-string">"bits=4"</span>          <span class="hljs-comment">// ä½å®½</span>
deku:<span class="hljs-string">"cond=HasFlag"</span>    <span class="hljs-comment">// æ¡ä»¶å­—æ®µ</span>
deku:<span class="hljs-string">"count=Length"</span>    <span class="hljs-comment">// æ•°ç»„é•¿åº¦</span>
deku:<span class="hljs-string">"pad=3"</span>           <span class="hljs-comment">// å¡«å……å­—èŠ‚</span>
</code></pre>
<h4 data-id="heading-31">é¡¹ç›®æ–‡ä»¶ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">bytes/
â”œâ”€â”€ bit_reader.go      <span class="hljs-comment"># ä½è¯»å–å™¨</span>
â”œâ”€â”€ bit_writer.go      <span class="hljs-comment"># ä½å†™å…¥å™¨</span>
â”œâ”€â”€ types.go           <span class="hljs-comment"># æ ¸å¿ƒç±»å‹å®šä¹‰</span>
â”œâ”€â”€ tags.go            <span class="hljs-comment"># Tag è§£æå™¨</span>
â”œâ”€â”€ marshal.go         <span class="hljs-comment"># åºåˆ—åŒ–å®ç°</span>
â”œâ”€â”€ unmarshal.go       <span class="hljs-comment"># ååºåˆ—åŒ–å®ç°</span>
â”œâ”€â”€ evaluator.go       <span class="hljs-comment"># æ¡ä»¶è¡¨è¾¾å¼æ±‚å€¼</span>
â”œâ”€â”€ example_test.go    <span class="hljs-comment"># æµ‹è¯•ç”¨ä¾‹ï¼ˆ8ä¸ªï¼‰</span>
â”œâ”€â”€ examples.go        <span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
â”œâ”€â”€ demo/main.go       <span class="hljs-comment"># æ¼”ç¤ºç¨‹åº</span>
â”œâ”€â”€ README.md          <span class="hljs-comment"># å®Œæ•´æ–‡æ¡£</span>
â”œâ”€â”€ PROJECT_OVERVIEW.md <span class="hljs-comment"># é¡¹ç›®æ¦‚è§ˆ</span>
â””â”€â”€ go.mod             <span class="hljs-comment"># Go æ¨¡å—</span>
</code></pre>
<h4 data-id="heading-32">æµ‹è¯•ç»“æœ</h4>
<ul>
<li>âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ8ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰</li>
<li>âœ… ä»£ç è¦†ç›–ç‡ï¼š48.0%</li>
<li>âœ… æ¼”ç¤ºç¨‹åºè¿è¡Œæ­£å¸¸</li>
<li>âœ… æ— ç¼–è¯‘é”™è¯¯</li>
</ul>
<h4 data-id="heading-33">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Packet <span class="hljs-keyword">struct</span> {
    Magic   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Version <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Type    <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Length  <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-comment">// åºåˆ—åŒ–</span>
data, _ := bytes.Marshal(packet)

<span class="hljs-comment">// ååºåˆ—åŒ–</span>
bytes.Unmarshal(data, &amp;packet)
</code></pre>
<h4 data-id="heading-34">ä¸ deku åº“å¯¹æ¯”</h4>















































<table><thead><tr><th>ç‰¹æ€§</th><th>deku (Rust)</th><th>bytes (Go)</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>ä½çº§æ“ä½œ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>æ¡ä»¶å­—æ®µ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>åŠ¨æ€æ•°ç»„</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>è‡ªå®šä¹‰åºåˆ—åŒ–</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>å­—èŠ‚åºæ”¯æŒ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>åµŒå¥—ç»“æ„ä½“</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr></tbody></table>
<h4 data-id="heading-35">é€‚ç”¨åœºæ™¯</h4>
<ol>
<li>TCP/UDP ç½‘ç»œåè®®è§£æ</li>
<li>äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼å¤„ç†</li>
<li>é€šä¿¡åè®®å®ç°</li>
<li>æ•°æ®åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7598435950410743818</link>    <guid>https://juejin.cn/post/7598435950410743818</guid>    <pubDate>2026-01-24T05:39:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950410743818" data-draft-id="7598469864256405555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:39:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯è¥¿ç“œå“¥"/> <meta itemprop="url" content="https://juejin.cn/user/2066737589133015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2066737589133015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯è¥¿ç“œå“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:39:54.000Z" title="Sat Jan 24 2026 05:39:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç“œæŸã€‚</p>
<p>å‰å‡ å¤©ç¾¤é‡Œæœ‰äººé—®äº†æˆ‘ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯ Figma åˆ›å»ºå›¾å½¢ï¼Œå®ƒçš„å‘½åè§„åˆ™æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜æŒºæœ‰è¶£çš„ï¼Œä¸å¦¨å±•å¼€è¯´è¯´ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2740c3771fc841be9a0d4e9220b96a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=cy%2F3ARzPFzsT%2BUKYInmgFhjqpwA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ç»˜åˆ¶å›¾å½¢åœºæ™¯</h2>
<p>Figma ä¸­é€šè¿‡ç»˜åˆ¶åˆ›å»ºå›¾å½¢ï¼Œå›¾å½¢åç§°ä¼šç»™å›¾å½¢ç±»å‹å¯¹åº”çš„å‰ç¼€ï¼ŒåŠ ä¸Šä¸€ä¸ªç©ºæ ¼ç¬¦ï¼Œä»¥åŠä¸€ä¸ªæ­£æ•´æ•°åºå·ï¼Œå¦‚ <code>"Rectangle 6"</code>ã€<code>"Vector 3"</code>ã€‚</p>
<p>ç»˜åˆ¶å›¾å½¢æ—¶ï¼Œä¼šæ‰¾åˆ°å®ƒçš„å›¾å½¢ç±»å‹ï¼Œåœ¨å½“å‰ç”»å¸ƒä¸­æ‰¾åˆ°å¯¹åº”çš„æœ€å¤§åºå·ã€‚å–è¿™ä¸ªåºå· + 1ï¼Œä½œä¸ºæ–°çš„å›¾å½¢çš„åºå·ã€‚</p>
<p>æ•´ä½“çš„é€»è¾‘æ˜¯ï¼š</p>
<ul>
<li>æ ¹æ® type æ‹¿åˆ°åå­—å‰ç¼€ prefixã€‚å¦‚çŸ©å½¢çš„ç±»å‹æ˜¯  "ROUNDED_RECTANGLE"ï¼Œæ˜ å°„æ‹¿åˆ° "Rectangle"ï¼ˆè¿™é‡Œå¯åšå›½é™…åŒ–ï¼‰ï¼›</li>
<li>åŸºäº prefixéå†ç”»å¸ƒä¸Šæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ ¹æ® <strong>æŸä¸ªè§„åˆ™</strong> è®¡ç®—å‡ºè¿™ä¸ª prefix çš„æœ€å¤§åºå· numï¼›</li>
<li>æ–°å›¾å½¢çš„åå­—å°±æ˜¯ <code>prefix + ' ' + (num + 1)</code>ã€‚</li>
</ul>
<p>ç»˜åˆ¶ä¸€ä¸ªæ–°çš„çŸ©å½¢ï¼Œéå†å½“å‰å›¾çº¸ä¸­çš„å›¾å½¢ï¼ŒåŒ¹é…å›¾å½¢åä¸º <code>/^Rectangle\s*(\d+)/</code> çš„ï¼Œæ‹¿åˆ°å¯¹åº”çš„åºå·ï¼Œæ‰¾å‡ºå…¶ä¸­çš„æœ€å¤§å€¼ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æ˜¯ 3ã€‚ç„¶åæˆ‘ä»¬åŠ  1ï¼Œå¾—åˆ° 4ï¼Œäºæ˜¯æˆ‘ä»¬çš„æ–°çš„çŸ©å½¢çš„ name å°±æ˜¯ <code>"Rectangle 4"</code>ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/761619f1a2634c7a937901c58e2f404b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=oRH%2B1jbVhwInLbeJsRgwGC%2FZOzk%3D" alt="" loading="lazy"/>
æ­£åˆ™  <code>/^Rectangle\s*(\d+)/</code> çš„åŒ¹é…è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>å‰é¢ä¸èƒ½æœ‰ç©ºæ ¼ï¼›</li>
<li>ä¸­é—´ç©ºæ ¼å¯ä»¥æ˜¯ 0 åˆ°å¤šä¸ªï¼›</li>
<li>æ•°å­—åªå–æ•´æ•°ï¼Œæ•°å­—åé¢å¯ä»¥æœ‰å¤šä½™çš„ä¸œè¥¿ï¼ˆå¦‚ <code>"Rectangle 2test"</code> æ˜¯ç¬¦åˆè§„åˆ™çš„ï¼Œä¼šæ‹¿åˆ° 2ï¼‰ã€‚</li>
</ul>

<pre><code class="hljs language-python" lang="python">const getNumFromName = (<span class="hljs-built_in">str</span>, prefix) =&gt; {  const regex = new RegExp(`^${prefix}\\s*(\\d+)`);  const <span class="hljs-keyword">match</span> = <span class="hljs-built_in">str</span>.<span class="hljs-keyword">match</span>(regex);  <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> ? parseInt(<span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>]) : undefined;}// ç”¨æ³•å¦‚ä¸‹ï¼šgetNumFromName(<span class="hljs-string">'Rectangle 25'</span>, <span class="hljs-string">'Rectangle'</span>) // 25getNumFromName(<span class="hljs-string">' Rectangle 25'</span>, <span class="hljs-string">'Rectangle'</span>) // undefinedgetNumFromName(<span class="hljs-string">'Rectangle  25.7'</span>, <span class="hljs-string">'Rectangle'</span>) // 25getNumFromName(<span class="hljs-string">'Rectangle 25hello'</span>, <span class="hljs-string">'Rectangle'</span>) // <span class="hljs-number">25</span>
</code></pre>
<p>è®¡ç®—å½“å‰ç”»å¸ƒä¸­ç‰¹å®šå‰ç¼€çš„æœ€å¤§åºå·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getNodesMaxNum</span> = (<span class="hljs-params">nodes, prefix</span>) =&gt; {   <span class="hljs-keyword">let</span> maxNum = <span class="hljs-number">0</span>;  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> node <span class="hljs-keyword">of</span> nodes) {    <span class="hljs-keyword">const</span> name = node.<span class="hljs-property">name</span>;    <span class="hljs-keyword">const</span> num = <span class="hljs-title function_">getNumFromName</span>(name, prefix);    <span class="hljs-keyword">if</span> (num != <span class="hljs-literal">undefined</span>)      maxNum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxNum, num);  }  <span class="hljs-keyword">return</span> maxNum;}<span class="hljs-comment">// æ‹¿åˆ°æ–°çš„å›¾å½¢åconst num = getNodesMaxNum(getAllNodes(), 'Rectangle') + 1;const nodeName = 'Rectangle ' + num;</span>
</code></pre>
<p>å‘½åå’Œç”»å¸ƒä¸­çš„å›¾å½¢çš„å®é™…ç±»å‹å®Œå…¨æ²¡å…³ç³»ï¼Œä½ å¯ä»¥ç»™ä¸€ä¸ªåœ†å½¢å›¾å½¢å‘½åä¸º <code>Rectangle &lt;num&gt;</code> ï¼Œè¿™ä¸ª name ä»æ—§ä¼šå‚ä¸è®¡ç®—ã€‚</p>
<p>å¦‚æœè§‰å¾—éå†ç”»å¸ƒçš„æ‰€æœ‰èŠ‚ç‚¹æ¯”è¾ƒè€—æ—¶ï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜ä¸åŒå›¾å½¢çš„æœ€å¤§åºå·ï¼Œéœ€è¦åœ¨æ–°å¢å›¾å½¢ã€åˆ é™¤å›¾å½¢ã€æ›´æ–°å›¾å½¢åæ—¶åšç¼“å­˜çš„æ›´æ–°ã€‚</p>
<h2 data-id="heading-1">å¤åˆ¶åœºæ™¯</h2>
<p>Figma ä¸­å¤åˆ¶å›¾å½¢ï¼Œä¹Ÿä¼šå¯¹å›¾å½¢åè¿›è¡Œé‡å‘½åï¼Œé€»è¾‘å’Œåˆ›å»ºä¸å¤ªä¸€æ ·ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5080c3a328884c39afbacde75aa814ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=OLBfLSKMViVgmXJBVzVDYPR0bUw%3D" alt="" loading="lazy"/>
é€»è¾‘æ˜¯ï¼š</p>
<ul>
<li>åˆ¤æ–­è¢«å¤åˆ¶å›¾å½¢çš„åå­—åœ¨ <strong>å¤åˆ¶ä½ç½®å±‚çº§</strong> ä¸‹æ˜¯å¦æœ‰åŒåå›¾å½¢ï¼Œå¦‚æœæ²¡æœ‰åŒåï¼Œä¸éœ€è¦é‡å‘½åï¼›</li>
<li>å¦‚æœæœ‰åŒåï¼Œåˆ¤æ–­è¢«å¤åˆ¶å›¾å½¢åæ˜¯å¦åŒ¹é… <code>/^(.*)\s(\d+)/</code>ã€‚å¦‚æœä¸åŒ¹é…ï¼Œä¸é‡å‘½åï¼›å¦‚æœåŒ¹é…ï¼Œå–å¾—å‰ç¼€ prefixï¼›</li>
<li>æ‰§è¡Œå‰é¢ç»˜åˆ¶åœºæ™¯ç›¸åŒçš„é€»è¾‘ï¼Œä¸è¿‡è¿™æ¬¡ä¸ç”¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªéå†<strong>å¤åˆ¶ä½ç½®å±‚çº§</strong> ä¸‹çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p>è·å– prefix çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">const</span> getNamePrefix = (<span class="hljs-type">str</span>) =&gt; {  <span class="hljs-keyword">const</span> regex = /^(.*)\s\d+$/;  <span class="hljs-keyword">const</span> <span class="hljs-keyword">match</span> = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">match</span>(regex);  <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> ? <span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>] : undefined;}
</code></pre>
<p>prefix ä¸è¦æ±‚æ˜¯å›¾å½¢ç±»å‹å‰ç¼€ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ã€‚æ‰€ä»¥å¤åˆ¶ "banana 2"ï¼Œä¹Ÿæ˜¯ä¼šå¾—åˆ° "banana 3" çš„ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76251963bf0a429b88eb6eb11671ee04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=K1IIJiaX1%2Bye7gEoMlxqPlo6XhU%3D" alt="" loading="lazy"/>
æœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸‹ï¼Œå°±æ˜¯å¤åˆ¶å¤šä¸ªå›¾å½¢çš„æ—¶å€™ï¼Œå½“ç»™ä¸Šä¸€ä¸ªå›¾å½¢è®¡ç®—å¥½æ–°çš„ name åï¼Œä¸‹ä¸€ä¸ªå›¾å½¢è¦æŠŠä¸Šä¸€ä¸ªå›¾å½¢çš„ name ä¹Ÿçº³å…¥è¿ç®—ï¼Œå¦åˆ™ä¼šå‡ºç°ç›¸åŒçš„åºå·ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœå¤åˆ¶äº†ç»„ï¼Œç»„ä¸‹èŠ‚ç‚¹ä¸ä¼šè¿›è¡Œé‡å‘½åï¼Œå› ä¸ºå®ƒä»¬å’Œå¤åˆ¶ä½ç½®ä¸åœ¨ä¸€ä¸ªå±‚çº§äº†ã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯æ–‡æœ¬å›¾å½¢æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœå¼€å¯äº† autoRenameï¼Œå›¾å½¢åéœ€è¦è·Ÿéšæ–‡æœ¬å†…å®¹ï¼Œä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿä¸ä¼šé‡å‘½åã€‚</p>
<h2 data-id="heading-2">ä¼˜ç¼ºç‚¹</h2>
<p>Figma ç»™å›¾å½¢åŠ åºå·çš„å¥½å¤„ï¼Œæ˜¯ **å¯ä»¥ä¸€å®šç¨‹åº¦å¯¹å›¾å½¢è¿›è¡Œæ ‡è¯†ã€‚**æ­¤å¤–é€’å¢çš„ç‰¹æ€§ï¼Œä¹Ÿèƒ½æ¸…æ™°åœ°æ„ŸçŸ¥åˆ°å›¾å½¢çš„åˆ›å»ºæ—¶é—´é¡ºåºï¼Œå°¤å…¶æ˜¯å¤åˆ¶å¤§é‡ç›¸åŒå›¾å½¢æ—¶ï¼Œèƒ½æ¸…æ™°è¯†åˆ«å‡ºè°æ˜¯å¤åˆ¶å‡ºæ¥çš„ã€‚</p>
<p>ç¼ºç‚¹æ˜¯ï¼Œä¸å¤ªä¼˜é›…ã€‚ä½†æˆ‘ä»¬åˆ›å»ºäº†å¤§é‡çš„å›¾å½¢ï¼Œä¼šå‘ç°å®ƒä»¬çš„åå­—ä¼šå¸¦ä¸Šä¸€æ®µå¾ˆé•¿çš„æ²¡æœ‰æ„ä¹‰çš„ç‹—å±è†è¯ä¸€èˆ¬çš„æ•°å­—ã€‚</p>
<p>ä¹Ÿæœ‰ä¸€äº›åŠæ³•å¯ä»¥å»æ‰åç¼€ã€‚</p>
<p>Figma æä¾›äº†ä¸€ä¸ªæ‰¹é‡é‡å‘½åçš„èƒ½åŠ›ï¼Œé€‰ä¸­å¤šä¸ªå›¾å½¢ï¼Œç„¶åæŒ‰ä¸‹ Command / Ctrl + R å¯å”¤èµ·ç„¶åæŒ‰ä¸€å®šçš„è§„åˆ™æ”¹åã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b73d7ce0ca146f2b974b951122f9da4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=lDGEt5qazV3XnLra02pibcHhbYA%3D" alt="" loading="lazy"/>
å¦å¤–ä¹Ÿå¯ä»¥å®‰è£…ä¸€ä¸ª Figma æ’ä»¶ï¼Œå«åš No Numbersï¼Œå®ƒæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œæ‰§è¡Œä¸€ä¸‹ï¼Œå°±èƒ½å°†é€‰ä¸­çš„å›¾å½¢æˆ–ç”»å¸ƒä¸­æ‰€æœ‰å›¾å½¢åçš„æ•°å­—åç¼€å»æ‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2Fcommunity%2Fplugin%2F1017928273649269221%2Fno-numbers" target="_blank" title="https://www.figma.com/community/plugin/1017928273649269221/no-numbers" ref="nofollow noopener noreferrer">www.figma.com/community/pâ€¦</a>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b7317a274ba48a48b830d130f198307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=1WqS4W5vatPNy8%2BYQsz0Mzxghec%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">æ–¹æ¡ˆäºŒ</h2>
<p>è¿˜æœ‰ç§æ–¹æ¡ˆæ˜¯ <strong>æ–°å»ºå›¾å½¢ï¼Œå›¾å½¢åä¸å¸¦æ•°å­—åç¼€çš„</strong>ï¼Œæ¯”å¦‚ Adobe Illustractorã€Affinityã€‚</p>
<p>å‡†ç¡®æ¥è¯´ï¼Œå®ƒä»¬åˆ›å»ºçš„å›¾å½¢ï¼Œæ˜¯æ²¡æœ‰åå­—çš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">{  <span class="hljs-built_in">id</span>: <span class="hljs-string">'1:2'</span>,  <span class="hljs-built_in">type</span>: <span class="hljs-string">'RECT'</span>,  name: undefined  // ...}
</code></pre>
<p>è™½ç„¶æ²¡æœ‰åå­—ï¼Œä½†æœ‰ typeï¼Œåœ¨ UI å±‚å¯ä»¥åŸºäºè¿™ä¸ª type ç»™å‡ºä¸€ä¸ªè™šå‡çš„ â€œå›¾å½¢åâ€ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getUIName</span> = (<span class="hljs-params">node</span>) =&gt; {  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">name</span> != <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> node.<span class="hljs-property">name</span>;  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getNameFromMap</span>(node.<span class="hljs-property">type</span>); <span class="hljs-comment">// ä»æ˜ å°„è¡¨é‡Œæ‹¿ä¸€ä¸ª nameã€‚}</span>
</code></pre>
<p>Adobe Illustractor çš„å›¾å±‚åˆ—è¡¨æ˜¾ç¤ºæ•ˆæœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f6f3d752cf44f48d94c80062e4ec04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=c0GVmc2zCq%2BcHmCqteTBlSeg9kU%3D" alt="" loading="lazy"/>
è™½ç„¶ä¸¢æ‰äº†å‰é¢è¯´çš„å¸¦æ•°å­—åç¼€çš„ä¼˜ç‚¹ã€‚</p>
<p>ä½†å®ƒçš„ <strong>å®ç°ä¸Šä¼šæ›´ç®€å•ä¸€äº›</strong>ã€‚</p>
<p>æ­¤å¤–æ²¡æœ‰åå­—ä¹Ÿæœ‰ä¸€äº›ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å›¾å½¢çš„ç±»å‹å‘ç”Ÿå˜åŒ–ï¼ŒUI å±‚çš„åå­—ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè®©ç”¨æˆ·èƒ½ <strong>æ„ŸçŸ¥åˆ°å›¾å½¢ç±»å‹çš„æ”¹å˜</strong>ã€‚</li>
<li>åˆ‡æ¢è¯­è¨€ï¼Œèƒ½ <strong>ç”¨å¯¹åº”çš„å›½é™…åŒ–æ–‡æ¡ˆå»æ˜¾ç¤º</strong>ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2433ff00b7da44c38026535ffc58d893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=qZ2OEAgCuqHAMj5ySqvMqLxZkK0%3D" alt="" loading="lazy"/>
ä¸è¿‡å¦‚æœç”¨æˆ·æ‰‹åŠ¨è®¾ç½®äº†å›¾å½¢åå­—ï¼Œè®© name ä¸å†æ˜¯ undefinedï¼Œä¸Šé¢è¿™ä¸¤é¡¹æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p>
<h2 data-id="heading-4">ç»“å°¾</h2>
<p>æˆ‘æ˜¯å‰ç«¯è¥¿ç“œå“¥ï¼Œå…³æ³¨æˆ‘ï¼Œå­¦ä¹ æ›´å¤šå›¾å½¢ç¼–è¾‘å™¨çŸ¥è¯†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨]]></title>    <link>https://juejin.cn/post/7598587406695219243</link>    <guid>https://juejin.cn/post/7598587406695219243</guid>    <pubDate>2026-01-24T06:40:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406695219243" data-draft-id="7598587406695202859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨"/> <meta itemprop="keywords" content="JavaScript,åç«¯,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-24T06:40:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢œé…±"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢œé…±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:40:16.000Z" title="Sat Jan 24 2026 06:40:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨</h2>
<p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰æ˜¯ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„é«˜æ•ˆæ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„æ ‡å‡†åº“éƒ½æä¾›äº†å“ˆå¸Œè¡¨çš„å®ç°ï¼ˆå¦‚ JavaScript çš„ <code>Map</code>/<code>Object</code>ã€Java çš„ <code>HashMap</code>ã€Python çš„ <code>dict</code>ï¼‰ã€‚å®ƒä»¥ <strong>O(1) å¹³å‡æ—¶é—´å¤æ‚åº¦</strong> æ”¯æŒå¢åˆ æŸ¥æ”¹æ“ä½œï¼Œæ˜¯è§£å†³â€œå¿«é€Ÿé”®å€¼æ˜ å°„â€é—®é¢˜çš„é¦–é€‰æ–¹æ¡ˆã€‚æœ¬æ–‡å°†ä»åº•å±‚åŸç†å‡ºå‘ï¼Œæ‹†è§£å“ˆå¸Œè¡¨çš„æ ¸å¿ƒè®¾è®¡ï¼Œå®ç°ä¸¤ç§è§£å†³å“ˆå¸Œå†²çªçš„æ–¹æ¡ˆï¼Œå¹¶ç»“åˆå®æˆ˜æ¡ˆä¾‹ï¼ˆ<code>RandomizedCollection</code>ï¼‰å±•ç¤ºå“ˆå¸Œè¡¨çš„çµæ´»åº”ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2307833f58b9407cbba184df472e24a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841632&amp;x-signature=0p6nyNRilNjHLjWkMG6pjm%2FO17Q%3D" alt="hash_x.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å“ˆå¸Œè¡¨çš„æ ¸å¿ƒåŸç†ï¼šæ•°ç»„+å“ˆå¸Œå‡½æ•°</h3>
<p>å“ˆå¸Œè¡¨çš„æœ¬è´¨æ˜¯<strong>ç”¨æ•°ç»„å®ç°çš„é”®å€¼æ˜ å°„</strong>â€”â€”é€šè¿‡ä¸€ä¸ªâ€œå“ˆå¸Œå‡½æ•°â€å°†ä»»æ„ç±»å‹çš„ <code>key</code> è½¬åŒ–ä¸ºæ•°ç»„çš„åˆæ³•ç´¢å¼•ï¼Œä»è€Œå€ŸåŠ©æ•°ç»„ O(1) çš„éšæœºè®¿é—®ç‰¹æ€§å®ç°é«˜æ•ˆæ“ä½œã€‚</p>
<h4 data-id="heading-2">1.1 åŸºæœ¬ç»“æ„ï¼ˆä¼ªä»£ç ï¼‰</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// åº•å±‚å­˜å‚¨æ•°ç»„</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">// å¢/æ”¹ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„èµ‹å€¼</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, value</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = value;
    }

    <span class="hljs-comment">// æŸ¥ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„å–å€¼</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
    }

    <span class="hljs-comment">// åˆ ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„ç½®ç©º</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// æ ¸å¿ƒï¼šå“ˆå¸Œå‡½æ•°ï¼ˆkeyâ†’åˆæ³•ç´¢å¼•ï¼‰</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-comment">// 1. è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼ˆä¿è¯ç›¸åŒkeyè¿”å›ç›¸åŒå€¼ï¼‰</span>
        <span class="hljs-keyword">let</span> h = key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        <span class="hljs-comment">// 2. ä¿è¯å“ˆå¸Œå€¼éè´Ÿï¼ˆä½è¿ç®—æ•ˆç‡é«˜äºç®—æœ¯è¿ç®—ï¼‰</span>
        h = h &amp; <span class="hljs-number">0x7fffffff</span>;
        <span class="hljs-comment">// 3. æ˜ å°„åˆ°æ•°ç»„åˆæ³•ç´¢å¼•ï¼ˆå–æ¨¡ï¼‰</span>
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>.<span class="hljs-property">length</span>;
    }
}
</code></pre>
<h4 data-id="heading-3">1.2 å“ˆå¸Œå‡½æ•°çš„æ ¸å¿ƒè¦æ±‚</h4>
<p>å“ˆå¸Œå‡½æ•°æ˜¯å“ˆå¸Œè¡¨çš„â€œçµé­‚â€ï¼Œå¿…é¡»æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>
<p><strong>ç¡®å®šæ€§</strong>ï¼šç›¸åŒ <code>key</code> å¿…é¡»è¿”å›ç›¸åŒç´¢å¼•ï¼›</p>
</li>
<li>
<p><strong>é«˜æ•ˆæ€§</strong>ï¼šè®¡ç®—å¤æ‚åº¦ä¸º O(1)ï¼ˆå¦åˆ™å“ˆå¸Œè¡¨æ•´ä½“æ€§èƒ½é€€åŒ–ï¼‰ï¼›</p>
</li>
<li>
<p><strong>å‡åŒ€æ€§</strong>ï¼šå°½å¯èƒ½è®©ä¸åŒ <code>key</code> æ˜ å°„åˆ°ä¸åŒç´¢å¼•ï¼ˆå‡å°‘å†²çªï¼‰ã€‚</p>
</li>
</ol>
<h3 data-id="heading-4">äºŒã€å“ˆå¸Œå†²çªï¼šä¸å¯é¿å…çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>ç”±äºå“ˆå¸Œå‡½æ•°æ˜¯â€œæ— ç©·ç©ºé—´â†’æœ‰é™ç©ºé—´â€çš„æ˜ å°„ï¼Œ<strong>å“ˆå¸Œå†²çª</strong>ï¼ˆä¸åŒ <code>key</code> æ˜ å°„åˆ°åŒä¸€ç´¢å¼•ï¼‰æ˜¯å¿…ç„¶å­˜åœ¨çš„ã€‚è§£å†³å†²çªçš„æ ¸å¿ƒæ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š<strong>æ‹‰é“¾æ³•</strong>ï¼ˆä¸»æµï¼‰å’Œ <strong>çº¿æ€§æ¢æŸ¥æ³•</strong>ã€‚</p>
<h4 data-id="heading-5">2.1 æ‹‰é“¾æ³•ï¼šæ•°ç»„+é“¾è¡¨ï¼ˆç®€å•æ˜“å®ç°ï¼‰</h4>
<h5 data-id="heading-6">æ ¸å¿ƒæ€è·¯</h5>
<p>æ•°ç»„çš„æ¯ä¸ªä½ç½®å­˜å‚¨ä¸€ä¸ª<strong>é“¾è¡¨</strong>ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå°†å†²çªçš„é”®å€¼å¯¹è¿½åŠ åˆ°é“¾è¡¨å°¾éƒ¨ã€‚</p>
<ul>
<li>
<p>å¢åˆ æŸ¥æ”¹ï¼šå…ˆé€šè¿‡å“ˆå¸Œå‡½æ•°æ‰¾åˆ°æ•°ç»„ç´¢å¼•ï¼Œå†æ“ä½œå¯¹åº”é“¾è¡¨ï¼›</p>
</li>
<li>
<p>ä¼˜åŠ¿ï¼šå®ç°ç®€å•ã€æ”¯æŒé«˜è´Ÿè½½å› å­ï¼ˆé“¾è¡¨å¯æ— é™å»¶ä¼¸ï¼‰ï¼›</p>
</li>
<li>
<p>åŠ£åŠ¿ï¼šé“¾è¡¨éå†æœ‰è½»å¾®æ€§èƒ½æŸè€—ï¼ˆä½†å¹³å‡ä»ä¸º O(1)ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-7">å®Œæ•´å®ç°ï¼ˆJavaScriptï¼‰</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// é“¾è¡¨èŠ‚ç‚¹ï¼šå­˜å‚¨key-value</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashNode</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTableChaining</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">capacity = <span class="hljs-number">10</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> = capacity; <span class="hljs-comment">// æ•°ç»„åˆå§‹å®¹é‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// å®é™…å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span> = <span class="hljs-number">0.75</span>; <span class="hljs-comment">// è´Ÿè½½å› å­ï¼ˆè§¦å‘æ‰©å®¹çš„é˜ˆå€¼ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(capacity).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åº•å±‚æ•°ç»„</span>
    }

    <span class="hljs-comment">// å“ˆå¸Œå‡½æ•°ï¼škeyâ†’ç´¢å¼•</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> h = <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'number'</span> ? key : key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        h = h &amp; <span class="hljs-number">0x7fffffff</span>; <span class="hljs-comment">// ä¿è¯éè´Ÿ</span>
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
    }

    <span class="hljs-comment">// æ‰©å®¹ï¼šè§£å†³å“ˆå¸Œå†²çªé¢‘ç¹çš„é—®é¢˜</span>
    <span class="hljs-title function_">resize</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> oldTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> *= <span class="hljs-number">2</span>; <span class="hljs-comment">// å®¹é‡ç¿»å€</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// é‡æ–°å“ˆå¸Œå¹¶è¿ç§»æ•°æ®</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> node <span class="hljs-keyword">of</span> oldTable) {
            <span class="hljs-keyword">while</span> (node) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">put</span>(node.<span class="hljs-property">key</span>, node.<span class="hljs-property">val</span>);
                node = node.<span class="hljs-property">next</span>;
            }
        }
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-comment">// è¾¾åˆ°è´Ÿè½½å› å­ï¼Œå…ˆæ‰©å®¹</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resize</span>();
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-comment">// é“¾è¡¨ä¸ºç©ºï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashNode</span>(key, val);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// é“¾è¡¨éç©ºï¼šéå†æŸ¥æ‰¾ï¼ˆå­˜åœ¨åˆ™ä¿®æ”¹ï¼Œä¸å­˜åœ¨åˆ™è¿½åŠ ï¼‰</span>
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                curr.<span class="hljs-property">val</span> = val; <span class="hljs-comment">// å­˜åœ¨ï¼Œä¿®æ”¹å€¼</span>
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (!curr.<span class="hljs-property">next</span>) {
                curr.<span class="hljs-property">next</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashNode</span>(key, val); <span class="hljs-comment">// ä¸å­˜åœ¨ï¼Œè¿½åŠ åˆ°å°¾éƒ¨</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
                <span class="hljs-keyword">return</span>;
            }
            curr = curr.<span class="hljs-property">next</span>;
        }
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                <span class="hljs-keyword">return</span> curr.<span class="hljs-property">val</span>;
            }
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
    }

    <span class="hljs-comment">// åˆ </span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                <span class="hljs-comment">// æ‰¾åˆ°èŠ‚ç‚¹ï¼šåˆ é™¤ï¼ˆåˆ†å¤´éƒ¨/ä¸­é—´èŠ‚ç‚¹ï¼‰</span>
                <span class="hljs-keyword">if</span> (prev) {
                    prev.<span class="hljs-property">next</span> = curr.<span class="hljs-property">next</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = curr.<span class="hljs-property">next</span>;
                }
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            prev = curr;
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
    }
}

<span class="hljs-comment">// æµ‹è¯•æ‹‰é“¾æ³•å“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> ht = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashTableChaining</span>();
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>);
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"b"</span>, <span class="hljs-number">2</span>);
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"c"</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ht.<span class="hljs-title function_">get</span>(<span class="hljs-string">"a"</span>)); <span class="hljs-comment">// 1</span>
ht.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ht.<span class="hljs-title function_">get</span>(<span class="hljs-string">"b"</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h4 data-id="heading-8">2.2 çº¿æ€§æ¢æŸ¥æ³•ï¼šå¼€æ”¾å¯»å€ï¼ˆå¤æ‚ä½†æ— é“¾è¡¨å¼€é”€ï¼‰</h4>
<h5 data-id="heading-9">æ ¸å¿ƒæ€è·¯</h5>
<p>ä¸ä½¿ç”¨é“¾è¡¨ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œ<strong>å‘åéå†æ•°ç»„æ‰¾ç©ºä½</strong>ï¼ˆåˆ°æ•°ç»„æœ«å°¾åˆ™ç»•å›å¤´éƒ¨ï¼‰ï¼š</p>
<ul>
<li>
<p>æ’å…¥ï¼šæ‰¾åˆ°ç©ºä½åç›´æ¥å­˜å…¥ï¼›</p>
</li>
<li>
<p>æŸ¥è¯¢ï¼šä»å“ˆå¸Œç´¢å¼•å¼€å§‹éå†ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºä½ï¼›</p>
</li>
<li>
<p>åˆ é™¤ï¼šä¸èƒ½ç›´æ¥ç½®ç©ºï¼ˆä¼šä¸­æ–­æŸ¥è¯¢ï¼‰ï¼Œéœ€ç”¨<strong>å ä½ç¬¦</strong>æ ‡è®°ï¼ˆå¦‚ <code>DELETED</code>ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-10">å…³é”®éš¾ç‚¹</h5>
<ol>
<li>
<p><strong>ç¯å½¢æ•°ç»„</strong>ï¼šéå†åˆ°æ•°ç»„æœ«å°¾æ—¶éœ€ç»•å›å¤´éƒ¨ï¼›</p>
</li>
<li>
<p><strong>åˆ é™¤é€»è¾‘</strong>ï¼šç”¨å ä½ç¬¦æ›¿ä»£ç›´æ¥ç½®ç©ºï¼Œé¿å…æŸ¥è¯¢ä¸­æ–­ã€‚</p>
</li>
</ol>
<h5 data-id="heading-11">å®Œæ•´å®ç°ï¼ˆJavaScriptï¼‰</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTableProbing</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">capacity = <span class="hljs-number">10</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> = capacity;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span> = <span class="hljs-number">0.75</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(capacity).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'deleted'</span>); <span class="hljs-comment">// å ä½ç¬¦ï¼šæ ‡è®°å·²åˆ é™¤</span>
    }

    <span class="hljs-comment">// å“ˆå¸Œå‡½æ•°</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> h = <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'number'</span> ? key : key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        h = h &amp; <span class="hljs-number">0x7fffffff</span>;
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
    }

    <span class="hljs-comment">// æ‰©å®¹</span>
    <span class="hljs-title function_">resize</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> oldTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> *= <span class="hljs-number">2</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// è¿ç§»æ•°æ®ï¼ˆè·³è¿‡å ä½ç¬¦ï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> oldTable) {
            <span class="hljs-keyword">if</span> (entry &amp;&amp; entry !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">put</span>(entry.<span class="hljs-property">key</span>, entry.<span class="hljs-property">val</span>);
            }
        }
    }

    <span class="hljs-comment">// æŸ¥æ‰¾keyçš„ç´¢å¼•ï¼ˆæ ¸å¿ƒï¼šå¤„ç†å†²çª+å ä½ç¬¦ï¼‰</span>
    <span class="hljs-title function_">findIndex</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> start = index;

        <span class="hljs-comment">// ç¯å½¢éå†ï¼šç›´åˆ°æ‰¾åˆ°ç›®æ ‡/ç©ºä½/éå†å®Œ</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] !== <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ‰¾åˆ°ç›®æ ‡key</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">key</span> === key) {
                <span class="hljs-keyword">return</span> index;
            }
            <span class="hljs-comment">// ç»•å›å¤´éƒ¨</span>
            index = (index + <span class="hljs-number">1</span>) % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
            <span class="hljs-comment">// éå†å®Œä¸€åœˆä»æœªæ‰¾åˆ°</span>
            <span class="hljs-keyword">if</span> (index === start) {
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
            }
        }
        <span class="hljs-keyword">return</span> index; <span class="hljs-comment">// è¿”å›ç©ºä½ç´¢å¼•</span>
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resize</span>();
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-comment">// æœªæ‰¾åˆ°ï¼šæ’å…¥æ–°å€¼</span>
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = { key, val };
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// æ‰¾åˆ°ï¼šä¿®æ”¹å€¼</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">val</span> = val;
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">val</span>;
    }

    <span class="hljs-comment">// åˆ ï¼šç”¨å ä½ç¬¦æ ‡è®°</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// æµ‹è¯•çº¿æ€§æ¢æŸ¥æ³•å“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> htProbe = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashTableProbing</span>();
htProbe.<span class="hljs-title function_">put</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
htProbe.<span class="hljs-title function_">put</span>(<span class="hljs-number">11</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// å“ˆå¸Œå†²çªï¼ˆ1%10=1ï¼Œ11%10=1ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(htProbe.<span class="hljs-title function_">get</span>(<span class="hljs-number">11</span>)); <span class="hljs-comment">// 20</span>
htProbe.<span class="hljs-title function_">remove</span>(<span class="hljs-number">1</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(htProbe.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h3 data-id="heading-12">ä¸‰ã€å“ˆå¸Œè¡¨çš„è¿›é˜¶ç‰¹æ€§</h3>
<h4 data-id="heading-13">3.1 è´Ÿè½½å› å­ä¸æ‰©å®¹</h4>
<p>è´Ÿè½½å› å­ = å·²å­˜å‚¨å…ƒç´ æ•° / æ•°ç»„å®¹é‡ï¼Œæ˜¯å“ˆå¸Œè¡¨æ‰©å®¹çš„æ ¸å¿ƒä¾æ®ï¼ˆé€šå¸¸è®¾ä¸º 0.75ï¼‰ï¼š</p>
<ul>
<li>
<p>è´Ÿè½½å› å­è¿‡é«˜ï¼šå“ˆå¸Œå†²çªé¢‘ç¹ï¼Œæ€§èƒ½é€€åŒ–ï¼›</p>
</li>
<li>
<p>è´Ÿè½½å› å­è¿‡ä½ï¼šæ•°ç»„ç©ºé—´æµªè´¹ï¼›</p>
</li>
<li>
<p>æ‰©å®¹é€»è¾‘ï¼šå®¹é‡ç¿»å€ï¼Œé‡æ–°å“ˆå¸Œå¹¶è¿ç§»æ‰€æœ‰æ•°æ®ï¼ˆä¿è¯åç»­å†²çªå‡å°‘ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-14">3.2 æœ‰åºå“ˆå¸Œè¡¨ï¼šå“ˆå¸Œé“¾è¡¨ï¼ˆLinkedHashMapï¼‰</h4>
<p>æ ‡å‡†å“ˆå¸Œè¡¨çš„éå†é¡ºåºæ˜¯æ— åºçš„ï¼Œè‹¥éœ€ä¿ç•™æ’å…¥é¡ºåºï¼Œå¯ç»“åˆ<strong>å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨</strong>å®ç°ï¼š</p>
<ul>
<li>
<p>å“ˆå¸Œè¡¨ï¼šå¿«é€ŸæŸ¥æ‰¾èŠ‚ç‚¹ï¼ˆO(1)ï¼‰ï¼›</p>
</li>
<li>
<p>åŒå‘é“¾è¡¨ï¼šç»´æŠ¤æ’å…¥é¡ºåºï¼ˆåˆ é™¤èŠ‚ç‚¹ O(1)ï¼‰ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// åŒå‘é“¾è¡¨èŠ‚ç‚¹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedNode</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">prev</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å“¨å…µèŠ‚ç‚¹ï¼šç®€åŒ–é“¾è¡¨æ“ä½œ</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>.<span class="hljs-property">next</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// å“ˆå¸Œè¡¨ï¼škeyâ†’èŠ‚ç‚¹</span>
    }

    <span class="hljs-comment">// æ–°å¢èŠ‚ç‚¹åˆ°é“¾è¡¨å°¾éƒ¨</span>
    <span class="hljs-title function_">addLast</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">const</span> prev = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span>;
        prev.<span class="hljs-property">next</span> = node;
        node.<span class="hljs-property">prev</span> = prev;
        node.<span class="hljs-property">next</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span> = node;
    }

    <span class="hljs-comment">// ç§»é™¤é“¾è¡¨èŠ‚ç‚¹</span>
    <span class="hljs-title function_">removeNode</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">const</span> prev = node.<span class="hljs-property">prev</span>;
        <span class="hljs-keyword">const</span> next = node.<span class="hljs-property">next</span>;
        prev.<span class="hljs-property">next</span> = next;
        next.<span class="hljs-property">prev</span> = prev;
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
            node.<span class="hljs-property">val</span> = val;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">const</span> newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(key, val);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addLast</span>(newNode);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(key, newNode);
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key) ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key).<span class="hljs-property">val</span> : <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// åˆ </span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeNode</span>(node);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">delete</span>(key);
    }

    <span class="hljs-comment">// æŒ‰æ’å…¥é¡ºåºéå†key</span>
    <span class="hljs-title function_">keys</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> res = [];
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>.<span class="hljs-property">next</span>;
        <span class="hljs-keyword">while</span> (curr !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>) {
            res.<span class="hljs-title function_">push</span>(curr.<span class="hljs-property">key</span>);
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> res;
    }
}

<span class="hljs-comment">// æµ‹è¯•æœ‰åºå“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> lhm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>();
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>);
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"b"</span>, <span class="hljs-number">2</span>);
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"c"</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lhm.<span class="hljs-title function_">keys</span>()); <span class="hljs-comment">// ["a", "b", "c"]</span>
lhm.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lhm.<span class="hljs-title function_">keys</span>()); <span class="hljs-comment">// ["a", "c"]</span>
</code></pre>
<h4 data-id="heading-15">3.3 æ”¯æŒéšæœºè®¿é—®çš„å“ˆå¸Œè¡¨</h4>
<p>è‹¥éœ€å“ˆå¸Œè¡¨æ”¯æŒâ€œéšæœºè¿”å›é”®â€ä¸”<strong>å…ƒç´ ä¸é‡å¤</strong>ï¼ˆå¦‚ <code>MyArrayHashMap</code>ï¼‰ï¼Œå¯ç»“åˆ<strong>æ•°ç»„+å“ˆå¸Œè¡¨</strong>å®ç°ï¼Œæ ¸å¿ƒæ˜¯ç”¨æ•°ç»„å­˜å‚¨é”®å€¼å¯¹ã€å“ˆå¸Œè¡¨æ˜ å°„é”®ä¸ä¸‹æ ‡ï¼Œå…¼é¡¾ O(1) å¢åˆ æŸ¥ä¸éšæœºè®¿é—®ã€‚</p>
<ul>
<li>
<p>æ•°ç»„ï¼šå­˜å‚¨ <code>Node</code> å®ä¾‹ï¼ˆå« key å’Œ valï¼‰ï¼Œæ”¯æŒ O(1) éšæœºè®¿é—®ï¼Œä¿è¯éšæœºè¿”å›é”®çš„ç­‰æ¦‚ç‡æ€§ï¼›</p>
</li>
<li>
<p>å“ˆå¸Œè¡¨ï¼škeyâ†’å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼ˆä¸€ä¸€å¯¹åº”ï¼Œå› å…ƒç´ ä¸é‡å¤ï¼‰ï¼Œæ”¯æŒ O(1) å®šä½å…ƒç´ ï¼Œè§„é¿æ•°ç»„éå†å¼€é”€ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">

<span class="hljs-comment">// é”®å€¼å¯¹èŠ‚ç‚¹ï¼šå°è£…keyå’Œval</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArrayHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å“ˆå¸Œè¡¨ï¼šå­˜å‚¨keyä¸å¯¹åº”åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå®ç°O(1)å®šä½</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
        <span class="hljs-comment">// æ•°ç»„ï¼šå­˜å‚¨Nodeå®ä¾‹ï¼Œæ”¯æŒO(1)éšæœºè®¿é—®</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = [];
    }

    <span class="hljs-comment">/**
     * æŒ‰keyæŸ¥è¯¢å€¼
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦æŸ¥è¯¢çš„é”®
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">*</span>} å¯¹åº”çš„å€¼ï¼ˆä¸å­˜åœ¨è¿”å›nullï¼‰
     */</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-comment">// å“ˆå¸Œè¡¨å–ä¸‹æ ‡ï¼Œæ•°ç»„ç›´æ¥è®¿é—®</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key)].<span class="hljs-property">val</span>;
    }

    <span class="hljs-comment">/**
     * å¢/æ”¹é”®å€¼å¯¹ï¼ˆå…ƒç´ ä¸é‡å¤ï¼Œå·²å­˜åœ¨åˆ™ä¿®æ”¹å€¼ï¼‰
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - é”®
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">val</span> - å€¼
     */</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">containsKey</span>(key)) {
            <span class="hljs-comment">// å·²å­˜åœ¨ï¼šé€šè¿‡ä¸‹æ ‡ä¿®æ”¹å¯¹åº”èŠ‚ç‚¹çš„å€¼</span>
            <span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[i].<span class="hljs-property">val</span> = val;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// æ–°å¢ï¼šæ•°ç»„å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ï¼Œå“ˆå¸Œè¡¨è®°å½•ä¸‹æ ‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(key, val));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(key, <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
    }

    <span class="hljs-comment">/**
     * æŒ‰keyåˆ é™¤é”®å€¼å¯¹
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦åˆ é™¤çš„é”®
     */</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key); <span class="hljs-comment">// å¾…åˆ é™¤å…ƒç´ ä¸‹æ ‡</span>
        <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index]; <span class="hljs-comment">// å¾…åˆ é™¤èŠ‚ç‚¹</span>
        <span class="hljs-keyword">const</span> lastIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">const</span> lastNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[lastIndex]; <span class="hljs-comment">// æ•°ç»„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>

        <span class="hljs-comment">// 1. äº¤æ¢å¾…åˆ é™¤èŠ‚ç‚¹ä¸æœ€åä¸€ä¸ªèŠ‚ç‚¹ä½ç½®ï¼ˆé¿å…æ•°ç»„ç§»ä½ï¼Œä¿è¯O(1)ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = lastNode;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[lastIndex] = node;

        <span class="hljs-comment">// 2. æ›´æ–°æœ€åä¸€ä¸ªèŠ‚ç‚¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä¸‹æ ‡æ˜ å°„</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(lastNode.<span class="hljs-property">key</span>, index);

        <span class="hljs-comment">// 3. æ•°ç»„åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆO(1)æ“ä½œï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">pop</span>();

        <span class="hljs-comment">// 4. å“ˆå¸Œè¡¨åˆ é™¤å¾…åˆ é™¤èŠ‚ç‚¹çš„key</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">delete</span>(node.<span class="hljs-property">key</span>);
    }

    <span class="hljs-comment">/**
     * éšæœºè¿”å›ä¸€ä¸ªé”®ï¼ˆç­‰æ¦‚ç‡ï¼‰
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">*</span>} éšæœºé”®
     */</span>
    <span class="hljs-title function_">randomKey</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> n = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;
        <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// è¾¹ç•Œå¤„ç†ï¼šç©ºè¡¨è¿”å›null</span>
        <span class="hljs-keyword">const</span> randomIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * n);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[randomIndex].<span class="hljs-property">key</span>;
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦åˆ¤æ–­çš„é”®
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">boolean</span>} å­˜åœ¨è¿”å›trueï¼Œå¦åˆ™false
     */</span>
    <span class="hljs-title function_">containsKey</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key);
    }

    <span class="hljs-comment">/**
     * è·å–é”®å€¼å¯¹æ•°é‡
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>} æ•°é‡
     */</span>
    <span class="hljs-title function_">size</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-property">size</span>;
    }
}

<span class="hljs-comment">// æµ‹è¯•ï¼ˆéªŒè¯ä¸é‡å¤ç‰¹æ€§ã€å¢åˆ æŸ¥åŠéšæœºè®¿é—®ï¼‰</span>
<span class="hljs-keyword">let</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyArrayHashMap</span>();
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// 1ï¼ˆæŸ¥è¯¢æ­£å¸¸ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// éšæœºè¿”å›1-5ä¸­çš„ä¸€ä¸ªé”®</span>

map.<span class="hljs-title function_">remove</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// åˆ é™¤key=4çš„é”®å€¼å¯¹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// éšæœºè¿”å›1-3ã€5ä¸­çš„ä¸€ä¸ªé”®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// å†æ¬¡éšæœºï¼Œæ— é‡å¤å…ƒç´ å¹²æ‰°</span>

</code></pre>
<h3 data-id="heading-16">å››ã€å“ˆå¸Œè¡¨çš„å…³é”®æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-17">4.1 ä¸è¦æ··æ·†â€œMapæ¥å£â€å’Œâ€œHashMapå®ç°â€</h4>
<ul>
<li>
<p><code>Map</code> æ˜¯æ¥å£ï¼ˆæŠ½è±¡å®šä¹‰ï¼‰ï¼Œä¸ä¿è¯æ—¶é—´å¤æ‚åº¦ï¼›</p>
</li>
<li>
<p><code>HashMap</code> æ˜¯å®ç°ï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼Œå¹³å‡ O(1)ï¼›<code>TreeMap</code> æ˜¯å®ç°ï¼ˆçº¢é»‘æ ‘ï¼‰ï¼ŒO(logN)ã€‚</p>
</li>
</ul>
<h4 data-id="heading-18">4.2 keyå¿…é¡»æ˜¯ä¸å¯å˜ç±»å‹</h4>
<p>è‹¥ key æ˜¯å¯å˜ç±»å‹ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰ï¼Œä¿®æ”¹åå“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå¯¼è‡´æ— æ³•æ‰¾åˆ°åŸæ•°æ®ï¼Œç”šè‡³å†…å­˜æ³„æ¼ã€‚</p>
<h4 data-id="heading-19">4.3 æ‹‰é“¾æ³• vs çº¿æ€§æ¢æŸ¥æ³•</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æ‹‰é“¾æ³•</th><th>çº¿æ€§æ¢æŸ¥æ³•</th></tr></thead><tbody><tr><td>å®ç°éš¾åº¦</td><td>ç®€å•</td><td>å¤æ‚ï¼ˆéœ€å¤„ç†ç¯å½¢/å ä½ç¬¦ï¼‰</td></tr><tr><td>è´Ÿè½½å› å­</td><td>æ— ä¸Šé™ï¼ˆé“¾è¡¨å¯å»¶ä¼¸ï¼‰</td><td>é€šå¸¸â‰¤0.75ï¼ˆå¦åˆ™æ€§èƒ½å·®ï¼‰</td></tr><tr><td>æ€§èƒ½</td><td>å¹³å‡O(1)ï¼ˆé“¾è¡¨éå†ï¼‰</td><td>å¹³å‡O(1)ï¼ˆç¼“å­˜å‹å¥½ï¼‰</td></tr><tr><td>ç©ºé—´åˆ©ç”¨ç‡</td><td>è¾ƒä½ï¼ˆé“¾è¡¨èŠ‚ç‚¹å¼€é”€ï¼‰</td><td>è¾ƒé«˜ï¼ˆæ— é¢å¤–èŠ‚ç‚¹ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-20">äº”ã€æ€»ç»“</h3>
<p>å“ˆå¸Œè¡¨çš„æ ¸å¿ƒæ˜¯â€œæ•°ç»„+å“ˆå¸Œå‡½æ•°â€ï¼Œè§£å†³å†²çªçš„ä¸¤å¤§æ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼ˆæ‹‰é“¾æ³•æ˜¯ä¸»æµï¼‰ã€‚å®é™…å¼€å‘ä¸­ï¼Œéœ€æ ¹æ®åœºæ™¯é€‰æ‹©ä¸åŒçš„å“ˆå¸Œè¡¨å˜ä½“ï¼š</p>
<ul>
<li>
<p>æ™®é€šé”®å€¼æ˜ å°„ï¼šç”¨æ ‡å‡†å“ˆå¸Œè¡¨ï¼ˆå¦‚ <code>Map</code>ï¼‰ï¼›</p>
</li>
<li>
<p>æœ‰åºéå†ï¼šç”¨å“ˆå¸Œé“¾è¡¨ï¼ˆLinkedHashMapï¼‰ï¼›</p>
</li>
<li>
<p>éšæœºè®¿é—®+å…ƒç´ ä¸é‡å¤ï¼šç”¨æ•°ç»„+æ™®é€šå“ˆå¸Œè¡¨ç»„åˆï¼ˆå¦‚ ArrayHashMapï¼‰ï¼Œé€šè¿‡èŠ‚ç‚¹äº¤æ¢å®ç°O(1)åˆ é™¤ï¼›</p>
</li>
<li>
<p>é«˜æ€§èƒ½åœºæ™¯ï¼šä¼˜å…ˆé€‰æ‹©æ‹‰é“¾æ³•ï¼ˆå®ç°ç®€å•ã€ä¸æ˜“å‡ºé”™ï¼‰ã€‚</p>
</li>
</ul>
<h3 data-id="heading-21">å…­ã€ç»ƒä¹ </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Finsert-delete-getrandom-o1%2F" target="_blank" title="https://leetcode.cn/problems/insert-delete-getrandom-o1/" ref="nofollow noopener noreferrer">380. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Finsert-delete-getrandom-o1-duplicates-allowed%2F" target="_blank" title="https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/" ref="nofollow noopener noreferrer">381. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nestjså­¦ä¹ 6ï¼šè®¤è¯†redis]]></title>    <link>https://juejin.cn/post/7598490039488397347</link>    <guid>https://juejin.cn/post/7598490039488397347</guid>    <pubDate>2026-01-24T06:40:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598490039488397347" data-draft-id="7592094358657548322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nestjså­¦ä¹ 6ï¼šè®¤è¯†redis"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-01-24T06:40:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€æ±Ÿä¸œæµæ°´"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nestjså­¦ä¹ 6ï¼šè®¤è¯†redis
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€æ±Ÿä¸œæµæ°´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:40:47.000Z" title="Sat Jan 24 2026 06:40:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>mysqlï¼Œå®ƒæ˜¯é€šè¿‡è¡¨å’Œå­—æ®µæ¥å­˜å‚¨ä¿¡æ¯çš„ï¼Œè¡¨å’Œè¡¨ä¹‹é—´é€šè¿‡ id å…³è”ï¼Œå«åšå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p>å®ƒæä¾›äº† sql è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡è¿™ç§è¯­è¨€æ¥æè¿°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚</p>
<p>mysql æ˜¯é€šè¿‡ç¡¬ç›˜æ¥å­˜å‚¨ä¿¡æ¯çš„ï¼Œå¹¶ä¸”è¿˜è¦è§£æå¹¶æ‰§è¡Œ sql è¯­å¥ï¼Œè¿™äº›å†³å®šäº†å®ƒä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æœåŠ¡ç«¯æ‰§è¡Œè®¡ç®—ä¼šå¾ˆå¿«ï¼Œä½†æ˜¯ç­‰å¾…æ•°æ®åº“æŸ¥è¯¢ç»“æœå°±å¾ˆæ…¢äº†ã€‚</p>
<p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è®¡ç®—æœºé¢†åŸŸæœ€ç»å¸¸è€ƒè™‘åˆ°çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µå°±æ˜¯ç¼“å­˜äº†ã€‚</p>
<p>èƒ½ä¸èƒ½æŠŠç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸‹æ¬¡åªæŸ¥å†…å­˜å°±å¥½äº†å‘¢ï¼Ÿ</p>
<p>æ‰€ä»¥åšåç«¯æœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ä¼šåªç”¨ mysqlï¼Œä¸€èˆ¬ä¼šç»“åˆå†…å­˜æ•°æ®åº“æ¥åšç¼“å­˜ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ redisã€‚</p>
<p>å› ä¸ºéœ€æ±‚å°±æ˜¯ç¼“å­˜ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥ redis çš„è®¾è®¡æ˜¯ keyã€value çš„é”®å€¼å¯¹çš„å½¢å¼ã€‚</p>
<p>å¹¶ä¸”å€¼çš„ç±»å‹æœ‰å¾ˆå¤šï¼šå­—ç¬¦ä¸²ï¼ˆstringï¼‰ã€åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆsetï¼‰ã€æœ‰åºé›†åˆï¼ˆsorted set)ã€å“ˆå¸Œè¡¨ï¼ˆhashï¼‰ã€åœ°ç†ä¿¡æ¯ï¼ˆgeospatialï¼‰ã€ä½å›¾ï¼ˆbitmapï¼‰ç­‰ã€‚</p>
<p>ä¸‹é¢ä¸€ä¸€æ¥å­¦ä¹ ä¸‹è¿™äº›ç±»å‹çš„ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-0">string</h2>
<p>å¯¹å­—ç¬¦ä¸²çš„æ“ä½œå‘½ä»¤ä¸»è¦æœ‰setã€getï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f595dd0bb631424c8d85dd917f727171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=Mrg03P%2FYlZ27%2BS2198Vw0CTtkBk%3D" alt="c6666f2c01194f00ad7f45d33a7dfd47~tplv-k3u1fbpfcp-jj-mark_1512_0_0_0_q75.awebp" loading="lazy"/></p>
<p>incr æ˜¯ç”¨äºé€’å¢çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c1c479bf1b49fd83fc118dae7052fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=mCtuQD%2FS%2BrxcG5PjW9LzlM6S7BM%3D" alt="fa3391bda1ff4967abecbd2a0da7e8c5~tplv-k3u1fbpfcp-jj-mark_1512_0_0_0_q75.awebp" loading="lazy"/></p>
<p>å¹³æ—¶æˆ‘ä»¬ç”¨çš„é˜…è¯»é‡ã€ç‚¹èµé‡ç­‰éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¥è®¡æ•°çš„ã€‚</p>
<p>å½“æˆ‘å­˜äº†å‡ ä¸ª key åï¼Œå¯ä»¥é€šè¿‡ keys æ¥æŸ¥è¯¢æœ‰å“ªäº› key:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4774437178144cc4b13be5aba7a73160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=N23%2BCv3vBCxDWqs49WTBecGKghw%3D" alt="image.png" loading="lazy"/></p>
<p>keys ååŠ ä¸€ä¸ªæ¨¡å¼ä¸²æ¥è¿‡æ»¤ï¼Œå¸¸ç”¨çš„æ˜¯ * æ¥æŸ¥è¯¢æ‰€æœ‰ keyã€‚</p>
<p>å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼š</p>
<ul>
<li>set</li>
<li>get</li>
<li>incr</li>
<li>keys</li>
</ul>
<h2 data-id="heading-1">list</h2>
<p>ä¸€ä¸ªåˆ—è¡¨çš„ç»“æ„ã€‚</p>
<h3 data-id="heading-2">lpush rpush</h3>
<pre><code class="hljs language-js" lang="js">lpush list1 <span class="hljs-number">111</span>
lpush list1 <span class="hljs-number">222</span>
lpush list1 <span class="hljs-number">333</span>
</code></pre>
<p>lpush æ˜¯ left push çš„æ„æ€ï¼Œæ‰§è¡Œåä¼šä»å·¦åˆ°å³æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87578dff8d384278b5d4a122f68d2cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=ipZQsoAf3vn2dV2wPXWNZzMrpvA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">rpush list1 <span class="hljs-number">444</span>
rpush list1 <span class="hljs-number">555</span>
</code></pre>
<p>rpush æ˜¯ right push çš„æ„æ€ï¼Œæ‰§è¡Œåä¼šä»å³å¾€å·¦æ·»åŠ åˆ°åˆ—è¡¨ä¸­</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c48aa853de349248a3203c15bac3634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=op08v%2FqM0wSWiHjo9fNAX%2FFf0c0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">lpop  rpop</h3>
<p>lpop å’Œ rpop è‡ªç„¶æ˜¯ä»å·¦è¾¹å’Œä»å³è¾¹åˆ é™¤æ•°æ®ã€‚</p>
<pre><code class="hljs language-js" lang="js">lpop list1
rpop list1
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f238e5198a7408b9cda1c2666082f44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=CYKRXOFHMulfe4OhotR2%2FiK4pWs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">lrange</h3>
<p>ä¸å°±æ˜¯ get ä¹ˆï¼Ÿ</p>
<p>æ˜¯ä¸è¡Œçš„ï¼Œget åªé€‚ç”¨äº string ç±»å‹çš„æ•°æ®ï¼Œlist ç±»å‹çš„æ•°æ®è¦ç”¨ lrangeã€‚</p>
<pre><code class="hljs language-js" lang="js">lrange list1 <span class="hljs-number">0</span> -<span class="hljs-number">1</span>
</code></pre>
<p>è¾“å…¥ä¸€æ®µ rangeï¼Œç»“å°¾ä¸‹æ ‡ä¸º -1 ä»£è¡¨åˆ°æœ€åã€‚</p>
<p><code>lrange list1 0 -1</code> å°±æ˜¯æŸ¥è¯¢ list1 çš„å…¨éƒ¨æ•°æ®ã€‚</p>
<h2 data-id="heading-5">set æ•°æ®ç±»å‹</h2>
<p>å…ˆå¤ä¹ ä¸‹jsä¸­çš„set ç±»å‹ã€‚</p>
<p>Set æ˜¯ ES6 æ–°å¢çš„<strong>æ— åºé›†åˆ</strong>ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>é‡Œé¢çš„<strong>å€¼å”¯ä¸€ï¼Œæ²¡æœ‰é‡å¤é¡¹</strong>ï¼ˆè‡ªåŠ¨å»é‡ï¼‰ï¼›</li>
<li>å¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹çš„å€¼ï¼ˆåŸå§‹ç±»å‹ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ï¼›å¼•ç”¨ç±»å‹ï¼šå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰ï¼›</li>
<li>æ²¡æœ‰ <strong>é”®</strong> çš„æ¦‚å¿µï¼Œåªæœ‰ <strong>å€¼</strong>ï¼›</li>
</ul>
<p>Set æ˜¯<strong>æ— åºçš„</strong>ï¼Œä¸èƒ½é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œé‚£æ€ä¹ˆè®¿é—®å‘¢ï¼Ÿ</p>
<ul>
<li>
<p>è¦ä¹ˆ<strong>éå†</strong> Setï¼Œé€ä¸ªè·å–å€¼ï¼ˆé€‚åˆéœ€è¦å¤„ç†æ‰€æœ‰å€¼çš„åœºæ™¯ï¼‰ï¼›</p>
</li>
<li>
<p>è¦ä¹ˆæŠŠ Set <strong>è½¬æ¢æˆæ•°ç»„</strong>ï¼Œå†ç”¨æ•°ç»„çš„æ–¹å¼å–å€¼ï¼ˆé€‚åˆéœ€è¦å–æŒ‡å®šä½ç½®å€¼çš„åœºæ™¯ï¼‰ï¼›</p>
</li>
<li>
<p>è¦ä¹ˆé€šè¿‡ <code>has()</code> å…ˆåˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ï¼Œå†é’ˆå¯¹æ€§å¤„ç†ï¼ˆé€‚åˆæ‰¾ç‰¹å®šå€¼çš„åœºæ™¯ï¼‰ã€‚</p>
</li>
</ul>
<p>æœ€å¸¸ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯1ï¼šæ•°ç»„å»é‡ï¼ˆSet æœ€ç»å…¸ç”¨æ³•ï¼‰ </span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]; 
<span class="hljs-keyword">const</span> uniqueArr = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(arr)]; 
<span class="hljs-comment">// ç”¨æ‰©å±•è¿ç®—ç¬¦è½¬æˆæ•°ç»„ </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uniqueArr); <span class="hljs-comment">// [1, 2, 3] </span>

<span class="hljs-comment">// åœºæ™¯2ï¼šå­˜æ”¾ä¸é‡å¤çš„ç”¨æˆ· ID </span>
<span class="hljs-keyword">const</span> userIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u001"</span>); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u002"</span>); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u001"</span>); <span class="hljs-comment">// é‡å¤æ·»åŠ ï¼Œæ— æ•ˆ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userIds.<span class="hljs-property">size</span>); <span class="hljs-comment">// 2 </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userIds.<span class="hljs-title function_">has</span>(<span class="hljs-string">"u002"</span>)); <span class="hljs-comment">// true </span>

<span class="hljs-comment">// åœºæ™¯3ï¼šéå† Set </span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> val <span class="hljs-keyword">of</span> userIds) { 
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val); <span class="hljs-comment">// ä¾æ¬¡è¾“å‡º u001ã€u002 </span>
} 
<span class="hljs-comment">// ä¹Ÿå¯ä»¥ç”¨ forEach</span>
userIds.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val));
</code></pre>
<p><strong>redis ä¸­çš„set çš„ç‰¹ç‚¹ä¹Ÿæ˜¯æ— åºå¹¶ä¸”å…ƒç´ ä¸é‡å¤ã€‚</strong></p>
<p>å½“æˆ‘æ·»åŠ é‡å¤æ•°æ®çš„æ—¶å€™ï¼š</p>
<pre><code class="hljs language-js" lang="js">sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">222</span>
sadd set1 <span class="hljs-number">222</span>
sadd set1 <span class="hljs-number">333</span>
</code></pre>
<p>ç»“æœåªæœ‰ 111 222 333ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>sismember</code> åˆ¤æ–­æ˜¯å¦æ˜¯é›†åˆä¸­çš„å…ƒç´ ï¼š</p>
<pre><code class="hljs language-js" lang="js">sismember set1 <span class="hljs-number">111</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edc8bb0d5fbc4fdfbea5c606f95fc6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=lATxWMYFJgAW0r7y2%2BLY%2Bg25g1g%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">sismember set1 <span class="hljs-number">444</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7bde739b45e4118a4770fa3ede99982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=vuiKIKZnjUp3ZxVndQ%2Fw0O7fWBc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">zset æ•°æ®ç±»å‹</h2>
<p>set åªèƒ½å»é‡ã€åˆ¤æ–­åŒ…å«ï¼Œä¸èƒ½å¯¹å…ƒç´ æ’åºã€‚</p>
<p>å¦‚æœæ’åºã€å»é‡çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ’è¡Œæ¦œï¼Œå¯ä»¥ç”¨ <code>sorted set</code>ï¼Œä¹Ÿå°±æ˜¯ <code>zset</code>ã€‚</p>
<p>å®ƒæ¯ä¸ªå…ƒç´ æ˜¯æœ‰ä¸€ä¸ªåˆ†æ•°çš„ï¼š</p>
<pre><code class="hljs language-js" lang="js">zadd zset1 <span class="hljs-number">5</span> guang
zadd zset1 <span class="hljs-number">4</span> dong
zadd zset1 <span class="hljs-number">3</span> xxx
zadd zset1 <span class="hljs-number">6</span> yyyy
</code></pre>
<p>ä¼šæŒ‰ç…§åˆ†æ•°æ¥æ’åºã€‚</p>
<p>é€šè¿‡ zrange å‘½ä»¤å–æ•°æ®ï¼Œæ¯”å¦‚å–æ’åå‰ä¸‰çš„æ•°æ®ï¼š</p>
<pre><code class="hljs language-js" lang="js">zrange zset1 <span class="hljs-number">0</span> <span class="hljs-number">2</span>
</code></pre>
<h2 data-id="heading-7">hash æ•°æ®ç»“æ„</h2>
<p>å…ˆå¤ä¹ ä¸‹ä»€ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°åŠå“ˆå¸Œè¡¨ã€‚</p>
<p>å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰æœ¬è´¨æ˜¯ä¸€ä¸ª <strong>è½¬æ¢å™¨</strong> ï¼Œå®ƒæ¥æ”¶ä»»æ„é•¿åº¦çš„è¾“å…¥ï¼ˆæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæ•°å­—ã€ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œè¾“å‡ºä¸€ä¸ª<strong>å›ºå®šé•¿åº¦ã€çœ‹èµ·æ¥æ— è§„å¾‹çš„ç»“æœ</strong>ï¼Œè¿™ä¸ªç»“æœå°±å« <strong>å“ˆå¸Œå€¼</strong>ï¼ˆHash Valueï¼‰ã€‚</p>
<p>å‰ç«¯ä¸­å¸¸ç”¨çš„å“ˆå¸Œå‡½æ•°æœ‰MD5ã€SHA-256ï¼Œæ¯”å¦‚ SHA-256  è¾“å‡º 256 ä½ï¼ˆ64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰ã€‚</p>
<p>å°±åƒå¿«é€’ç«™çš„ <strong>åˆ†åŒºæ‰«ç å™¨</strong> ï¼š</p>
<ul>
<li>è¾“å…¥ï¼šä½ çš„å¿«é€’å•å·ï¼ˆä»»æ„é•¿åº¦ï¼‰ï¼›</li>
<li>å“ˆå¸Œå‡½æ•°ï¼šæ‰«ç å™¨çš„è®¡ç®—è§„åˆ™ï¼›</li>
<li>è¾“å‡ºï¼šä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ†åŒºç¼–å·ï¼ˆæ¯”å¦‚ <code>05</code> åŒºï¼‰ï¼Œä½ æ‹¿åŒä¸€ä¸ªå•å·æ‰«ï¼Œæ°¸è¿œæ˜¯ <code>05</code> åŒºï¼›ä¸åŒå•å·å¤§æ¦‚ç‡æ‰«å‡ºä¸åŒåŒºï¼Œæå°‘æ•°æƒ…å†µä¼šæ‰«åˆ°åŒä¸€ä¸ªåŒºï¼ˆå†²çªï¼‰ã€‚</li>
</ul>
<p><strong>å“ˆå¸Œè¡¨ï¼šä¸€ä¸ªæŒ‰åœ°å€æ‰¾ä¸œè¥¿çš„æŸœå­</strong></p>
<p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ä¹Ÿå« <strong>æ•£åˆ—è¡¨</strong>ï¼Œæ˜¯ä¸€ç§ <strong>æ•°æ®ç»“æ„</strong>ï¼Œæ ¸å¿ƒç›®çš„æ˜¯ <strong>è®©æŸ¥æ‰¾æ•°æ®çš„é€Ÿåº¦å˜å¿«</strong>ï¼ˆç†æƒ³æƒ…å†µä¸‹æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O (1)ã€‚</p>
<p>åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li>
<p>å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼ˆæŸœå­ï¼‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªä½ç½®å« <strong>æ¡¶</strong> ï¼Œå¯ä»¥æ”¾æ•°æ®ã€‚</p>
</li>
<li>
<p>ç”¨å“ˆå¸Œå‡½æ•°ç®— <strong>å­˜æ”¾åœ°å€</strong>ï¼Œå½“ä½ è¦å­˜ä¸€ä¸ªæ•°æ®ï¼ˆæ¯”å¦‚ key: "å¼ ä¸‰", value: "138xxxx"ï¼‰æ—¶ï¼š</p>
<ul>
<li>æŠŠ <code>key</code> ä¼ å…¥å“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå€¼ï¼›</li>
<li>æŠŠå“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–ä½™ï¼Œå¾—åˆ°ä¸€ä¸ª<strong>ç´¢å¼•å€¼</strong>ï¼ˆå°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ¯”å¦‚ 3ï¼‰ï¼›</li>
<li>æŠŠ <code>(key, value)</code> å­˜åˆ°æ•°ç»„çš„ç¬¬3ä¸ªæ¡¶é‡Œã€‚</li>
</ul>
</li>
<li>
<p>æŸ¥æ‰¾æ•°æ®æ—¶ç›´æ¥æŒ‰åœ°å€æ‰¾ï¼Œå½“ä½ è¦æ‰¾å¼ ä¸‰çš„æ‰‹æœºå·æ—¶ï¼š</p>
<ul>
<li>å†æ¬¡ç”¨å“ˆå¸Œå‡½æ•°ç®— å¼ ä¸‰çš„ç´¢å¼•å€¼ï¼ˆè¿˜æ˜¯ 3ï¼‰ï¼›</li>
<li>ç›´æ¥å»æ•°ç»„ç¬¬ 3 ä¸ªæ¡¶é‡Œæ‹¿æ•°æ®ï¼Œä¸ç”¨éå†æ•´ä¸ªæ•°ç»„ã€‚</li>
</ul>
</li>
</ol>
<p>ä¸‹é¢çœ‹çœ‹jsä¸­çš„mapç»“æ„ï¼š</p>
<p>ç®€å•æ¥è¯´ï¼Œ<code>Map</code> æ˜¯ ES6 æ–°å¢çš„<strong>é”®å€¼å¯¹é›†åˆ</strong>ï¼ˆç±»ä¼¼å¯¹è±¡ <code>{}</code>ï¼‰ï¼Œä½†æ¯”æ™®é€šå¯¹è±¡æ›´çµæ´»ã€åŠŸèƒ½æ›´å¼ºï¼š</p>
<ul>
<li>
<p>æ™®é€šå¯¹è±¡çš„é”®åªèƒ½æ˜¯<strong>å­—ç¬¦ä¸² / æ•°å­— / Symbol</strong>ï¼Œè€Œ <code>Map</code> çš„é”®å¯ä»¥æ˜¯<strong>ä»»æ„ç±»å‹</strong>ï¼ˆæ¯”å¦‚å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ã€null ç­‰ï¼‰ï¼›</p>
</li>
<li>
<p><code>Map</code> ä¼š<strong>ä¿ç•™é”®çš„æ’å…¥é¡ºåº</strong>ï¼Œéå†çš„æ—¶å€™æŒ‰æ’å…¥é¡ºåºæ¥ï¼›</p>
</li>
<li>
<p><code>Map</code> æœ‰åŸç”Ÿçš„ <code>size</code> å±æ€§ï¼ˆç›´æ¥è·å–é”®å€¼å¯¹æ•°é‡ï¼‰ï¼Œè€Œå¯¹è±¡éœ€è¦æ‰‹åŠ¨è®¡ç®—ï¼›</p>
</li>
<li>
<p><code>Map</code> æä¾›äº† <code>set()</code>ã€<code>get()</code>ã€<code>delete()</code>ã€<code>clear()</code> ç­‰ä¸“ç”¨æ–¹æ³•ï¼Œæ“ä½œæ›´è§„èŒƒã€‚</p>
</li>
</ul>
<p>Map çš„å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦éå­—ç¬¦ä¸² / æ•°å­—ä½œä¸ºé”®çš„åœºæ™¯ï¼›</li>
<li>éœ€è¦é¢‘ç¹å¢åˆ é”®å€¼å¯¹çš„åœºæ™¯ï¼š</li>
</ul>
<p>æ™®é€šå¯¹è±¡å¢åˆ å±æ€§è™½ç„¶ä¹Ÿèƒ½åšï¼Œä½† <code>Map</code> æä¾›äº†æ›´é«˜æ•ˆã€è¯­ä¹‰æ›´æ¸…æ™°çš„æ–¹æ³•ï¼ˆ<code>delete()</code>/<code>clear()</code>ï¼‰ï¼Œä¸”æ€§èƒ½æ›´å¥½ï¼ˆå°¤å…¶æ•°æ®é‡å¤§æ—¶ï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯ï¼šä¸´æ—¶å­˜å‚¨ç”¨æˆ·ä¼šè¯æ•°æ®ï¼Œéœ€è¦é¢‘ç¹æ·»åŠ /åˆ é™¤</span>
<span class="hljs-keyword">const</span> userSessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">// æ·»åŠ ä¼šè¯</span>
userSessions.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user123'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">'123'</span>, <span class="hljs-attr">expire</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span> });
userSessions.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user456'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">'456'</span>, <span class="hljs-attr">expire</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span> });

<span class="hljs-comment">// åˆ é™¤å•ä¸ªä¼šè¯</span>
userSessions.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'user123'</span>);

<span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰ä¼šè¯ï¼ˆæ¯”éå†åˆ é™¤å¯¹è±¡å±æ€§é«˜æ•ˆï¼‰</span>
userSessions.<span class="hljs-title function_">clear</span>();
</code></pre>
<ul>
<li>éœ€è¦æœ‰åºéå†é”®å€¼å¯¹çš„åœºæ™¯</li>
</ul>
<p><code>Map</code> ä¼šä¸¥æ ¼æŒ‰ç…§<strong>é”®çš„æ’å…¥é¡ºåº</strong>éå†ï¼Œè€Œæ™®é€šå¯¹è±¡ï¼ˆES6 å‰ï¼‰çš„é”®é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼ˆæ•°å­—é”®ä¼˜å…ˆï¼Œå­—ç¬¦ä¸²é”®æ¬¡ä¹‹ï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯ï¼šæŒ‰æ·»åŠ é¡ºåºå±•ç¤ºç”¨æˆ·æ“ä½œæ—¥å¿—</span>
<span class="hljs-keyword">const</span> operationLog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:00'</span>, <span class="hljs-string">'ç™»å½•'</span>);
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:05'</span>, <span class="hljs-string">'æŸ¥çœ‹è®¢å•'</span>);
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:10'</span>, <span class="hljs-string">'æ”¯ä»˜'</span>);

<span class="hljs-comment">// éå†ï¼šä¸¥æ ¼æŒ‰æ’å…¥é¡ºåºè¾“å‡º</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [time, action] <span class="hljs-keyword">of</span> operationLog) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${time}</span>ï¼š<span class="hljs-subst">${action}</span>`</span>);
}
</code></pre>
<p>ç°åœ¨æ¥çœ‹çœ‹redisä¸­hashæ€ä¹ˆç”¨çš„ã€‚</p>
<pre><code class="hljs language-js" lang="js">hset hash1 key1 <span class="hljs-number">1</span>
hset hash1 key2 <span class="hljs-number">2</span>
hset hash1 key3 <span class="hljs-number">3</span>
hset hash1 key4 <span class="hljs-number">4</span>
hset hash1 key5 <span class="hljs-number">5</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/406b227ca81b4a179a86d7aca3c4faf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=l7X5HttcQkyQG4ISSicMODBKadQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">hget hash1 key3
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f7bc90642849bb9e956033f4037e90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=sSiRXWaZliPFdakucxe%2B%2BDBmCG0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">geo æ•°æ®ç»“æ„</h2>
<p>å­˜å‚¨ç»çº¬åº¦ä¿¡æ¯ï¼Œæ ¹æ®è·ç¦»è®¡ç®—å‘¨å›´çš„äººç”¨çš„ã€‚</p>
<pre><code class="hljs language-js" lang="js">geoadd loc <span class="hljs-number">13.361389</span> <span class="hljs-number">38.115556</span> <span class="hljs-string">"guangguang"</span> <span class="hljs-number">15.087269</span> <span class="hljs-number">37.502669</span> <span class="hljs-string">"dongdong"</span> 
</code></pre>
<p>ç”¨ loc ä½œä¸º keyï¼Œåˆ†åˆ«æ·»åŠ  guangguang å’Œ dongdong çš„ç»çº¬åº¦ã€‚</p>
<p>ä½ ä¼šå‘ç° redis å®é™…ä½¿ç”¨ zset å­˜å‚¨çš„ï¼ŒæŠŠç»çº¬åº¦è½¬åŒ–ä¸ºäº†äºŒç»´å¹³é¢çš„åæ ‡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c05c7b8ffcfd4b72a93aa804b1e7112c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=03j7TqWROasMrAa7gW49vK5c2eo%3D" alt="image.png" loading="lazy"/></p>
<p>ä½ å¯ä»¥ç”¨ geodist è®¡ç®—ä¸¤ä¸ªåæ ‡ç‚¹çš„è·ç¦»ï¼š</p>
<pre><code class="hljs language-js" lang="js">geodist loc guangguang dogndong
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fde602b609b42f1995c86c60290f8e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=J%2BOJLlhh%2BBRDDpR1Qh%2FlAxpwRHU%3D" alt="image.png" loading="lazy"/></p>
<p>ç”¨ georadius æœç´¢æŸä¸ªåŠå¾„å†…çš„å…¶ä»–ç‚¹ï¼Œä¼ å…¥ç»çº¬åº¦ã€åŠå¾„å’Œå•ä½ï¼š</p>
<pre><code class="hljs language-js" lang="js">georadius loc <span class="hljs-number">15</span> <span class="hljs-number">37</span> <span class="hljs-number">100</span> km
georadius loc <span class="hljs-number">15</span> <span class="hljs-number">37</span> <span class="hljs-number">200</span> km
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e3eda12dbe4475aa2a3796906ee07a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=qu5fXSFaDAN6YoLA6Qo8PK7cV68%3D" alt="image.png" loading="lazy"/></p>
<p>å¹³æ—¶æˆ‘ä»¬æŸ¥æ‰¾å‘¨å›´çš„äººã€å‘¨å›´çš„ xxx éƒ½å¯ä»¥é€šè¿‡ redis çš„ geo æ•°æ®ç»“æ„å®ç°ã€‚</p>
<h2 data-id="heading-9">è¿‡æœŸæ—¶é—´</h2>
<p>ä¸€èˆ¬ redis çš„ key æˆ‘ä»¬ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€šè¿‡ expire å‘½ä»¤ã€‚</p>
<p>æ¯”å¦‚æˆ‘è®¾ç½® dong1 çš„ key ä¸º 30 ç§’è¿‡æœŸï¼š</p>
<pre><code class="hljs language-js" lang="js">expire dogn1 <span class="hljs-number">30</span>
</code></pre>
<p>ç­‰åˆ°äº†è¿‡æœŸæ—¶é—´å°±ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>æƒ³æŸ¥å‰©ä½™è¿‡æœŸæ—¶é—´ä½¿ç”¨ ttlï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66dfe82cd1fd4e1da1c4298e75e885fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=OE7v5AIVEJtE%2BROxIrm%2FUBvDyUg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŸ¥å‡ºæ•°æ®æ¥ä¹‹åæ”¾åˆ° redis ä¸­ç¼“å­˜ï¼Œä¸‹æ¬¡å¦‚æœ redis æœ‰æ•°æ®å°±ç›´æ¥ç”¨ï¼Œæ²¡æœ‰çš„è¯å°±æŸ¥æ•°æ®åº“ç„¶åæ›´æ–° redis ç¼“å­˜ã€‚</p>
<p>è¿™æ˜¯ redis çš„ç¬¬ä¸€ç§ç”¨é€”ï¼Œä½œä¸ºæ•°æ®åº“çš„ç¼“å­˜ï¼Œä¹Ÿæ˜¯ä¸»è¦çš„ç”¨é€”ã€‚</p>
<p>ç¬¬äºŒç§ç”¨é€”å°±æ˜¯ç›´æ¥ä½œä¸ºå­˜å‚¨æ•°æ®çš„åœ°æ–¹äº†ï¼Œå› ä¸º redis æœ¬èº«æ˜¯ä¼šåšæŒä¹…åŒ–çš„ï¼Œèƒ½æŠŠå†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œé¿å…é‡å¯åæ•°æ®ä¸¢å¤±ã€‚ä¹Ÿå°±æ˜¯å¯ä»¥æŠŠæ•°æ®ç›´æ¥ä¿å­˜åœ¨ redis é‡Œï¼Œä¸å­˜åˆ° mysqlã€‚</p>
<p>å½“ç„¶ï¼Œå› ä¸º redis åœ¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·æˆæœ¬è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œéœ€è¦ç»å¸¸æ‰©å®¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚]]></title>    <link>https://juejin.cn/post/7598532592455417883</link>    <guid>https://juejin.cn/post/7598532592455417883</guid>    <pubDate>2026-01-24T06:47:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455417883" data-draft-id="7598532592455401499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚"/> <meta itemprop="keywords" content="åç«¯,Kafka,RocketMQ"/> <meta itemprop="datePublished" content="2026-01-24T06:47:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Warson_L"/> <meta itemprop="url" content="https://juejin.cn/user/2568875732117304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2568875732117304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Warson_L
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:47:33.000Z" title="Sat Jan 24 2026 06:47:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ—¢ç„¶ä¹‹å‰çš„æ€»ç»“â€œè¿‡äºç®€ç•¥â€ï¼Œé‚£æˆ‘ä»¬è¿™æ¬¡æ¥ä¸€æ¬¡<strong>æ·±åº¦è§£å‰–</strong>ã€‚æˆ‘ä»¬å°†ä»æ•°æ®ç»“æ„ã€åº•å±‚äº¤äº’æµç¨‹ã€Offset ç®¡ç†æœºåˆ¶è¿™å‡ ä¸ªç»´åº¦ï¼ŒæŠŠ Kafka å’Œ RocketMQ åœ¨â€œæ¶ˆæ¯å¤„ç†å¤±è´¥â€è¿™ä¸€åœºæ™¯ä¸‹çš„è¡¨ç°å·®å¼‚å½»åº•è®²é€ã€‚</p>
<hr/>
<h3 data-id="heading-0">æ ¸å¿ƒåœºæ™¯è®¾å®š</h3>
<ul>
<li><strong>Topic</strong>: <code>OrderTopic</code></li>
<li><strong>Partition</strong>: <code>0</code></li>
<li><strong>æ¶ˆæ¯æµ</strong>:
<ul>
<li><code>Offset 100</code>: è®¢å• Aï¼ˆå¤„ç†<strong>å¤±è´¥</strong>ï¼Œæ•°æ®åº“æ­»é”ï¼‰</li>
<li><code>Offset 101</code>: è®¢å• Bï¼ˆå¤„ç†<strong>æˆåŠŸ</strong>ï¼‰</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Kafkaï¼šæµå¼æ—¥å¿—ï¼ˆThe Logï¼‰</h3>
<p>Kafka çš„è®¾è®¡å“²å­¦æ˜¯ <strong>â€œå“‘ä»£ç†ï¼Œæ™ºå®¢æˆ·ç«¯â€ (Dumb Broker, Smart Client)</strong>ã€‚Broker åªæ˜¯ä¸€ä¸ªè´Ÿè´£è¿½åŠ å†™æ–‡ä»¶çš„ç³»ç»Ÿï¼Œå®ƒæ ¹æœ¬ä¸å…³å¿ƒæ¶ˆæ¯å†…å®¹ï¼Œä¹Ÿä¸å…³å¿ƒå•æ¡æ¶ˆæ¯çš„çŠ¶æ€ã€‚</p>
<h4 data-id="heading-2">1. åªæœ‰â€œè¿›åº¦â€ï¼Œæ²¡æœ‰â€œçŠ¶æ€â€</h4>
<p>Kafka ç»´æŠ¤æ¶ˆè´¹è¿›åº¦çš„æ–¹å¼éå¸¸ç²—çŠ·ã€‚å®ƒä¸åœ¨æ¯æ¡æ¶ˆæ¯ä¸Šæ‰“å‹¾ï¼Œå®ƒåªç»´æŠ¤ä¸€ä¸ª <strong>High Watermarkï¼ˆæ°´ä½çº¿ï¼‰</strong> æˆ– <strong>Committed Offset</strong>ã€‚</p>
<ul>
<li><strong>Kafka çš„é€»è¾‘</strong>ï¼šConsumer å‘Šè¯‰æˆ‘å®ƒæäº¤äº† <code>101</code>ï¼Œé‚£æˆ‘å°±è®¤ä¸º <code>0 ~ 101</code> ä¹‹é—´çš„æ‰€æœ‰æ•°æ®å…¨å®Œäº†ã€‚</li>
</ul>
<h4 data-id="heading-3">2. è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼ˆOffset 100 å¤±è´¥ï¼Œ101 æˆåŠŸï¼‰</h4>
<ol>
<li>
<p><strong>æ‹‰å– (Fetch)</strong>:</p>
<ul>
<li>Consumer å‘ Broker æ‹‰å–ä¸€æ‰¹æ¶ˆæ¯ï¼ˆBatchï¼‰ï¼Œæ¯”å¦‚ä¸€æ¬¡æ‹‰äº† <code>100, 101, 102</code> ä¸‰æ¡ã€‚</li>
<li>è¿™ä¸‰æ¡æ¶ˆæ¯ç°åœ¨éƒ½åœ¨ Consumer çš„<strong>å†…å­˜</strong>é‡Œã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 100 (å¤±è´¥)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæŠ¥é”™ã€‚</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šBroker å¯¹æ­¤<strong>ä¸€æ— æ‰€çŸ¥</strong>ã€‚Broker ä¹Ÿæ²¡æœ‰â€œæŠŠ 100 æ ‡è®°ä¸ºå¤±è´¥â€è¿™ç§æ¥å£ã€‚</li>
<li><em>ä»£ç é€‰æ‹©</em>ï¼šå¦‚æœä½ çš„ä»£ç  <code>catch</code> äº†é”™è¯¯å¹¶ <code>continue</code>ï¼ŒConsumer å†…å­˜é‡Œçš„æ¸¸æ ‡æŒ‡å‘äº†ä¸‹ä¸€æ¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 101 (æˆåŠŸ)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼š<code>session.MarkMessage(101)</code>ã€‚æ­¤æ—¶ Sarama å®¢æˆ·ç«¯åœ¨æœ¬åœ°è®°å½•ï¼š<code>current_offset = 101</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>æäº¤ (Commit)</strong>:</p>
<ul>
<li>Sarama åå°åç¨‹å‘¨æœŸæ€§å¯åŠ¨ï¼ˆé»˜è®¤ 1ç§’ï¼‰ã€‚</li>
<li>å®ƒå‘ç°æœ¬åœ° <code>current_offset = 101</code>ã€‚</li>
<li>å®ƒå‘ Broker å‘é€è¯·æ±‚ï¼š<code>GroupCommit(Topic, Partition0, Offset=102)</code> ï¼ˆæ„ä¸ºä¸‹æ¬¡ä» 102 å¼€å§‹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœ (åæœ)</strong>:</p>
<ul>
<li>Broker æ›´æ–°å…ƒæ•°æ®ï¼šè¯¥ç»„æ¶ˆè´¹è¿›åº¦ = 102ã€‚</li>
<li><strong>Offset 100 å½»åº•ä¸¢å¤±</strong>ã€‚ä¸‹æ¬¡é‡å¯ã€Rebalanceï¼Œéƒ½ä¼šä» 102 å¼€å§‹ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">3. Kafka å¦‚ä½•æ•‘èµï¼Ÿï¼ˆåªèƒ½é å¼€å‘è€…ç¡¬å†™ï¼‰</h4>
<p>å¦‚æœä½ ä¸èƒ½ä¸¢æ¶ˆæ¯ï¼Œåœ¨ Kafka é‡Œä½ <strong>å¿…é¡»</strong>åœ¨ä»£ç å±‚é¢é˜»å¡ï¼š</p>
<ul>
<li><strong>æ­»å¾ªç¯é‡è¯•</strong>ï¼šåœ¨å¤„ç† 100 å¤±è´¥æ—¶ï¼Œ<code>while(true)</code> ä¸€ç›´é‡è¯•ã€‚è¿™ä¼šå¯¼è‡´ 101 å³ä½¿å·²ç»åˆ°äº†å†…å­˜ï¼Œä¹Ÿæ— æ³•è¢«å¤„ç†ï¼ˆHead-of-line blockingï¼Œé˜Ÿå¤´é˜»å¡ï¼‰ã€‚</li>
<li><strong>æ‰‹åŠ¨æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šè‡ªå·±å†™ä»£ç æŠŠ 100 å‘é€åˆ° <code>Topic_DLQ</code>ï¼Œç„¶åæ ‡è®° 100 æˆåŠŸï¼Œç»§ç»­å¤„ç† 101ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€RocketMQï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆThe Queueï¼‰</h3>
<p>RocketMQï¼ˆæ™®é€š/å¹¶å‘æ¨¡å¼ï¼‰çš„è®¾è®¡å“²å­¦æ˜¯ <strong>â€œä¸šåŠ¡æ¶ˆæ¯å¼•æ“â€</strong>ã€‚Broker éå¸¸â€œèªæ˜â€ï¼Œå®ƒçŸ¥é“æ¯ä¸€æ¡æ¶ˆæ¯çš„çŠ¶æ€ï¼Œå¹¶ä¸”å†…ç½®äº†å®šæ—¶å™¨å’Œé‡è¯•é˜Ÿåˆ—ã€‚</p>
<h4 data-id="heading-6">1. æ—¢æœ‰â€œè¿›åº¦â€ï¼Œåˆæœ‰â€œå•æ¡ Ackâ€</h4>
<p>RocketMQ åœ¨ Broker ç«¯ç»´æŠ¤äº†ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¶ˆè´¹è¿›åº¦ï¼Œä½†å®ƒå…è®¸â€œç©ºæ´â€ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¼•å…¥äº† <strong>â€œæœåŠ¡ç«¯é‡è¯•â€</strong> æœºåˆ¶ã€‚</p>
<h4 data-id="heading-7">2. è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼ˆOffset 100 å¤±è´¥ï¼Œ101 æˆåŠŸï¼‰</h4>
<ol>
<li>
<p><strong>æ‹‰å– (Pull)</strong>:</p>
<ul>
<li>Consumer æ‹‰å–æ¶ˆæ¯ <code>100, 101</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 100 (å¤±è´¥)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæŠ¥é”™ã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼šConsumer è¿”å› <code>ConsumeConcurrentlyStatus.RECONSUME_LATER</code>ã€‚</li>
<li><strong>å¹•åé»‘ç§‘æŠ€ (ACK é˜¶æ®µ)</strong>ï¼š
<ul>
<li>Consumer å®¢æˆ·ç«¯è‡ªåŠ¨æŠŠè¿™æ¡æ¶ˆæ¯ 100 <strong>å‘å›ç»™ Broker</strong>ã€‚</li>
<li>Broker æ”¶åˆ°åï¼ŒæŠŠæ¶ˆæ¯ 100 å­˜å…¥ä¸€ä¸ªç‰¹æ®Šçš„ Topicï¼š<code>%RETRY%ConsumerGroup</code>ã€‚</li>
<li>åŸé˜Ÿåˆ—ï¼ˆOrderTopicï¼‰çš„è¿›åº¦ï¼Œæ­¤æ—¶å®é™…ä¸Šå·²ç»å‘å‰æ¨è¿›äº†ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 101 (æˆåŠŸ)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼šConsumer è¿”å› <code>ConsumeConcurrentlyStatus.CONSUME_SUCCESS</code>ã€‚</li>
<li>Broker æ”¶åˆ° ACKï¼Œç¡®è®¤ 101 å®Œæˆã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡è¯•è°ƒåº¦ (The Magic)</strong>:</p>
<ul>
<li>é‚£æ¡è¢«æ‰”è¿› <code>%RETRY%</code> çš„ 100 å·æ¶ˆæ¯ï¼ŒBroker ä¼šæ ¹æ®é‡è¯•æ¬¡æ•°è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆä¾‹å¦‚ level 1 = 10ç§’ï¼‰ã€‚</li>
<li><strong>10ç§’å</strong>ï¼šBroker æŠŠè¿™æ¡æ¶ˆæ¯å†æ¬¡æŠ•é€’ç»™ Consumerã€‚</li>
<li>Consumer å†æ¬¡æ”¶åˆ°æ¶ˆæ¯ï¼ˆMessageID ä¸å˜ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å†æ¬¡å°è¯•å¤„ç†ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœ</strong>:</p>
<ul>
<li><strong>101 å…ˆå¤„ç†å®Œ</strong>ã€‚</li>
<li><strong>100 ç¨åå¤„ç†</strong>ã€‚</li>
<li><strong>æ²¡æœ‰ä¸¢æ¶ˆæ¯</strong>ï¼Œä½†æ˜¯<strong>æ¶ˆæ¯ä¹±åºäº†</strong>ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€æ·±åº¦å¯¹æ¯”æ€»ç»“è¡¨</h3>
<p>è¿™ä¸ªè¡¨æ ¼å±•ç¤ºäº†ä¸¤è€…æœ€æœ¬è´¨çš„åŒºåˆ«ï¼š</p>













































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Kafka</th><th align="left">RocketMQ (å¹¶å‘æ¨¡å¼)</th></tr></thead><tbody><tr><td align="left"><strong>æ•°æ®æ¨¡å‹</strong></td><td align="left"><strong>æµ (Stream)</strong> <br/> åƒå½•åƒå¸¦ï¼Œè¿ç»­è¯»å–ã€‚</td><td align="left"><strong>é˜Ÿåˆ— (Queue)</strong> <br/> åƒä»»åŠ¡åˆ—è¡¨ï¼Œå•æ®ç‹¬ç«‹å¤„ç†ã€‚</td></tr><tr><td align="left"><strong>Offset æäº¤ç²’åº¦</strong></td><td align="left"><strong>ç´¯è®¡ä½ç‚¹ (Cumulative)</strong> <br/> æäº¤ Nï¼Œä»£è¡¨ N ä¹‹å‰å…¨å®Œäº†ã€‚</td><td align="left"><strong>å•æ¡ ACK (Individual)</strong> <br/> è™½ç„¶ä¹Ÿç»´æŠ¤ Offsetï¼Œä½†é…åˆé‡è¯•é˜Ÿåˆ—å®ç°äº†å•æ¡ç®¡ç†çš„é”™è§‰ã€‚</td></tr><tr><td align="left"><strong>ä¸­é—´æ¶ˆæ¯å¤±è´¥ (100å¤±è´¥)</strong></td><td align="left"><strong>é˜»å¡æˆ–è·³è¿‡</strong> <br/> è¦ä¹ˆæ­»å¾ªç¯å¡ä½å…¨éƒ¨åˆ†åŒºï¼Œè¦ä¹ˆæ ‡è®°å·²æ¶ˆè´¹ç›´æ¥ä¸¢å¼ƒã€‚</td><td align="left"><strong>æœåŠ¡ç«¯æš‚å­˜ (Re-queue)</strong> <br/> å¤±è´¥çš„æ¶ˆæ¯è¢«â€œè¸¢â€å‡ºåŸé˜Ÿåˆ—ï¼Œæ”¾å…¥é‡è¯•é˜Ÿåˆ—ï¼Œåç»­æ¶ˆæ¯ç»§ç»­è·‘ã€‚</td></tr><tr><td align="left"><strong>å¯¹ Offset 101 çš„å½±å“</strong></td><td align="left">å¦‚æœ 100 å¡ä½ï¼Œ101 æ°¸è¿œè½®ä¸åˆ°å¤„ç†ï¼ˆé˜Ÿå¤´é˜»å¡ï¼‰ã€‚</td><td align="left">101 å¯ä»¥å…ˆå¤„ç†æˆåŠŸï¼Œå®Œå…¨ä¸å— 100 å½±å“ã€‚</td></tr><tr><td align="left"><strong>é¡ºåºæ€§</strong></td><td align="left"><strong>ä¸¥æ ¼æœ‰åº</strong> <br/> åªè¦åˆ†åŒºä¸å˜ï¼Œå¤„ç†é¡ºåºæ°¸è¿œæ˜¯ 100 -&gt; 101ã€‚</td><td align="left"><strong>ä¹±åº</strong> <br/> æœ€ç»ˆæ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 101 -&gt; 100(é‡è¯•)ã€‚</td></tr><tr><td align="left"><strong>é‡è¯•æˆæœ¬</strong></td><td align="left"><strong>é«˜</strong> <br/> éœ€å®¢æˆ·ç«¯è‡ªç ”ï¼ˆæ­»å¾ªç¯ã€DBè®°å½•ã€Redisè®°å½•ï¼‰ã€‚</td><td align="left"><strong>ä½</strong> <br/> æ¡†æ¶è‡ªå¸¦ï¼Œæ”¹ä¸ªè¿”å›å€¼å³å¯ã€‚</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">æ—¥å¿—ã€åŸ‹ç‚¹ã€æµè®¡ç®—ã€CDC (Change Data Capture)ã€‚</td><td align="left">äº¤æ˜“ã€è®¢å•ã€æ‰£æ¬¾ã€é€šçŸ¥ç­‰æ ¸å¿ƒä¸šåŠ¡ã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">å››ã€ç›´è§‚å›¾è§£</h3>
<h4 data-id="heading-10">Kafka åœºæ™¯ (Offset 100 å¤±è´¥)</h4>
<pre><code class="hljs language-text" lang="text">[Broker Log]  :  ... [99] [100] [101] [102] ...
                         ^     ^
[Consumer]    :    å¤„ç†å¤±è´¥   å¤„ç†æˆåŠŸ
                         |     |
[Action]      :   (Skip?)  Mark(101)
                         |     |
[Commit]      :          V     V
[Broker Offset]:  Updated to 102 (100 is GONE)
</code></pre>
<h4 data-id="heading-11">RocketMQ åœºæ™¯ (Offset 100 å¤±è´¥)</h4>
<pre><code class="hljs language-text" lang="text">[Broker Queue]:  ... [99] [100] [101] [102] ...
                         |     |
[Consumer]    :   Ret_Later  Ret_Success
                         |     |
[Internal Op] :   Send back    |
                  to RetryQ    |
                         |     |
[Broker State]:  Offset moves past 101
                 [RetryQueue]: [100 (Delay 10s)]
                         .
                         . (10s later)
                         .
[Consumer]    :  Recieve [100] again -&gt; Process
</code></pre>
<h3 data-id="heading-12">äº”ã€ç»“è®ºä¸å»ºè®®</h3>
<ul>
<li><strong>ç»“è®º</strong>ï¼šä½ ç”¨ Sarama (Kafka) å†™ä»£ç æ—¶ï¼Œåƒä¸‡ä¸èƒ½å¸¦ç€ RocketMQ çš„æ€ç»´ã€‚åœ¨ Kafka é‡Œï¼Œ<strong>â€œæäº¤ Offsetâ€æ˜¯ä¸€ä¸ªä¸å¯é€†çš„â€œæ‰¹é‡ç¡®è®¤â€æ“ä½œ</strong>ã€‚</li>
<li><strong>é’ˆå¯¹ä½ å½“å‰ä»£ç çš„å»ºè®®</strong>ï¼š
ç”±äº Kafka åŸç”Ÿä¸æ”¯æŒâ€œå•æ¡å¤±è´¥é‡è¯•â€ï¼Œä¸ºäº†æ•°æ®ä¸ä¸¢ï¼Œä½ é€šå¸¸åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š
<ol>
<li><strong>å¼ºä¸€è‡´æ€§ï¼ˆä¸èƒ½ä¸¢ï¼Œä¸èƒ½ä¹±ï¼‰</strong>ï¼šåœ¨ <code>ConsumeClaim</code> é‡Œé‡åˆ°é”™è¯¯ä½¿ç”¨ <code>retry</code> åº“è¿›è¡ŒæŒ‡æ•°é€€é¿é‡è¯•ï¼ˆBackoff Retryï¼‰ï¼Œä¸€ç›´é‡è¯•ç›´åˆ°æˆåŠŸã€‚è¿™ä¼šé˜»å¡è¯¥åˆ†åŒºåç»­æ¶ˆæ¯çš„æ¶ˆè´¹ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆä¸èƒ½ä¸¢ï¼Œå…è®¸ä¹±ï¼‰</strong>ï¼šé‡åˆ°é”™è¯¯ï¼ŒæŠŠæ¶ˆæ¯<strong>æ‰‹åŠ¨</strong>ç”Ÿäº§åˆ°å¦ä¸€ä¸ª Topicï¼ˆå¦‚ <code>topic_retry</code>ï¼‰ï¼Œç„¶åå¯¹å½“å‰æ¶ˆæ¯ <code>MarkMessage</code>ã€‚ä½ è‡ªå·±è¿˜éœ€è¦å†™ä¸€ä¸ª Consumer å»æ¶ˆè´¹ <code>topic_retry</code>ã€‚è¿™å…¶å®å°±æ˜¯äººå·¥å®ç°äº† RocketMQ çš„åŠŸèƒ½ã€‚</li>
</ol>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“]]></title>    <link>https://juejin.cn/post/7598477092196778022</link>    <guid>https://juejin.cn/post/7598477092196778022</guid>    <pubDate>2026-01-24T06:57:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598477092196778022" data-draft-id="7598499504170582054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-01-24T06:57:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:57:33.000Z" title="Sat Jan 24 2026 06:57:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é«˜é˜¶å‡½æ•°å’Œæ³›å‹æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ TypeScript ç±»å‹ç³»ç»Ÿæœ€å¼ºå¤§çš„éƒ¨åˆ†ã€‚æŒæ¡è¿™éƒ¨åˆ†å†…å®¹ä»¥åï¼Œæˆ‘ä»¬ä¼šå‘ç° TypeScript ä¸ä»…èƒ½æ£€æŸ¥ç±»å‹ï¼Œè¿˜èƒ½æ¨å¯¼ç±»å‹ã€ç»„åˆç±»å‹ï¼Œç”šè‡³è¿›è¡Œç±»å‹è¿ç®—ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æ³›å‹å‚æ•°çº¦æŸï¼šç»™ç±»å‹å‚æ•°åŠ "é™åˆ¶æ¡ä»¶"</h2>
<h3 data-id="heading-1">åŸºç¡€æ³›å‹çº¦æŸï¼šç¡®ä¿ç±»å‹å…·æœ‰æŸäº›ç‰¹æ€§</h3>
<p>æ³›å‹çº¦æŸå°±åƒç»™ç±»å‹å‚æ•°åŠ ä¸Š"é™åˆ¶æ¡ä»¶"ï¼Œå‘Šè¯‰TypeScriptï¼š"è¿™ä¸ªç±»å‹å‚æ•° <code>T</code>ï¼Œå¿…é¡»æ»¡è¶³æŸäº›æ¡ä»¶"ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨å‡½æ•°ä½“å†…å®‰å…¨åœ°ä½¿ç”¨ <code>T</code> çš„ç‰¹å®šå±æ€§ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŸºç¡€çº¦æŸï¼šTå¿…é¡»å…·æœ‰lengthå±æ€§</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasLength</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œè¦æ±‚æœ‰lengthå±æ€§</span>
}

<span class="hljs-comment">// T extends HasLength è¡¨ç¤ºï¼šTå¿…é¡»æœ‰lengthå±æ€§</span>
<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HasLength</span>&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å› ä¸ºTä¸€å®šæœ‰lengthï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨è®¿é—®</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`é•¿åº¦: <span class="hljs-subst">${item.length}</span>`</span>);
}

<span class="hljs-comment">// âœ… æ­£ç¡®ä½¿ç”¨</span>
<span class="hljs-title function_">logLength</span>(<span class="hljs-string">"hello"</span>);       <span class="hljs-comment">// stringæœ‰lengthå±æ€§</span>
<span class="hljs-title function_">logLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);     <span class="hljs-comment">// æ•°ç»„æœ‰lengthå±æ€§</span>
<span class="hljs-title function_">logLength</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }); <span class="hljs-comment">// å¯¹è±¡æœ‰lengthå±æ€§</span>

<span class="hljs-comment">// âŒ é”™è¯¯ä½¿ç”¨</span>
<span class="hljs-comment">// logLength(42);           // numberæ²¡æœ‰lengthå±æ€§ - ç¼–è¯‘é”™è¯¯ï¼</span>
<span class="hljs-comment">// logLength(true);         // booleanæ²¡æœ‰lengthå±æ€§ - ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<h3 data-id="heading-2">å¤šä¸ªçº¦æŸï¼šå¿…é¡»åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasId</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasName</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// T extends HasId &amp; HasName è¡¨ç¤ºï¼šTå¿…é¡»åŒæ—¶æ»¡è¶³HasIdå’ŒHasNameçš„è¦æ±‚</span>
<span class="hljs-keyword">function</span> processItem&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HasId</span> &amp; <span class="hljs-title class_">HasName</span>&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">string</span> {
  <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å®‰å…¨è®¿é—®idå’Œname</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${item.id}</span>: <span class="hljs-subst">${item.name}</span>`</span>;
}

<span class="hljs-comment">// âœ… å¿…é¡»åŒæ—¶æœ‰idå’Œname</span>
<span class="hljs-title function_">processItem</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }); <span class="hljs-comment">// âœ… æœ‰idå’Œnameï¼Œageé¢å¤–å±æ€§ä¸å½±å“</span>
<span class="hljs-comment">// processItem({ id: 1 }); // âŒ ç¼ºå°‘name - ç¼–è¯‘é”™è¯¯ï¼</span>
<span class="hljs-comment">// processItem({ name: "lisi" }); // âŒ ç¼ºå°‘id - ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<blockquote>
<p>æ³¨ï¼šçº¦æŸåªåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p>
</blockquote>
<h3 data-id="heading-3">keyofï¼šæ›´ç²¾ç¡®çš„çº¦æŸ</h3>
<p><code>keyof T</code> å¯ä»¥è·å–ç±»å‹Tçš„æ‰€æœ‰é”®ï¼ˆå±æ€§åï¼‰çš„è”åˆç±»å‹ï¼Œæ¯”å¦‚ï¼š<code>keyof {name: string, age: number}</code>å°±æ˜¯ <code>name: string | age: number</code> ï¼Œè¿™æ ·å¯ä»¥å®ç°å®Œå…¨ç±»å‹å®‰å…¨çš„å±æ€§è®¿é—®ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> getProperty&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K): T[K] {
  <span class="hljs-comment">// K extends keyof T è¡¨ç¤ºï¼šKå¿…é¡»æ˜¯Tçš„é”®ä¹‹ä¸€</span>
  <span class="hljs-keyword">return</span> obj[key];
}

<span class="hljs-keyword">const</span> person = { <span class="hljs-attr">name</span>: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"zhangsan@example.com"</span> };

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè®¿é—®å­˜åœ¨çš„å±æ€§</span>
<span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">"name"</span>);  <span class="hljs-comment">// è¿”å›stringç±»å‹</span>
<span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">"age"</span>);   <span class="hljs-comment">// è¿”å›numberç±»å‹</span>

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šè®¿é—®ä¸å­˜åœ¨çš„å±æ€§</span>
<span class="hljs-comment">// getProperty(person, "address"); // ç¼–è¯‘é”™è¯¯ï¼šaddressä¸æ˜¯personçš„é”®</span>
</code></pre>
<h3 data-id="heading-4">æ¡ä»¶ç±»å‹çº¦æŸ</h3>
<p>æ¡ä»¶ç±»å‹ç±»ä¼¼äºä¸‰å…ƒè¡¨è¾¾å¼ï¼Œåªæ˜¯é€‚ç”¨äºç±»å‹ï¼š<code>T extends U ? X : Y</code> ã€‚å¦‚æœTå¯ä»¥èµ‹å€¼ç»™Uï¼Œåˆ™ç±»å‹ä¸ºXï¼Œå¦åˆ™ä¸ºYã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractStringKeys</span>&lt;T&gt; = {
  [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? K : <span class="hljs-built_in">never</span>;
}[keyof T];
</code></pre>
<h2 data-id="heading-5">å‡½æ•°ä½œä¸ºå‚æ•°çš„ç±»å‹æ¨å¯¼</h2>
<h3 data-id="heading-6">å‡½æ•°å‚æ•°çš„ç±»å‹æ¨å¯¼æœºåˆ¶</h3>
<p>åœ¨ TypeScript ä¸­ï¼Œå½“æŠŠä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒTypeScript ä¼šæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼å‚æ•°ç±»å‹ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> mapArray&lt;T, U&gt;(
  <span class="hljs-attr">array</span>: T[],  <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Tç±»å‹çš„æ•°ç»„</span>
  <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> U  <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°</span>
): U[] {  <span class="hljs-comment">// è¿”å›Uç±»å‹çš„æ•°ç»„</span>
  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">map</span>(callback);
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> strings = <span class="hljs-title function_">mapArray</span>(numbers, <span class="hljs-function">(<span class="hljs-params">n, i</span>) =&gt;</span> {
  <span class="hljs-comment">// nè‡ªåŠ¨æ¨å¯¼ä¸ºnumberï¼Œiè‡ªåŠ¨æ¨å¯¼ä¸ºnumber</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`æ•°å­—<span class="hljs-subst">${n}</span>åœ¨ä½ç½®<span class="hljs-subst">${i}</span>`</span>;
});
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒTypeScript çš„æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>çœ‹åˆ° <code>numbers</code> æ˜¯ <code>number[]</code>ï¼Œæ‰€ä»¥æ¨å¯¼å‡º <code>T = number</code>ã€‚</li>
<li>åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œ<code>n</code> è‡ªåŠ¨æ¨å¯¼ä¸º <code>number</code>ï¼Œ<code>i</code> è‡ªåŠ¨æ¨å¯¼ä¸º <code>number</code> ã€‚</li>
<li>å›è°ƒå‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>string</code>ï¼Œæ‰€ä»¥æ¨å¯¼å‡º <code>U = string</code></li>
<li>å› æ­¤ï¼Œæ•´ä¸ªå‡½æ•°è¿”å›å€¼ç±»å‹æ˜¯ <code>string[]</code> ã€‚</li>
</ol>
<blockquote>
<p>TypeScriptå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼ç±»å‹ï¼Œæ¨å¯¼è¿‡ç¨‹æ˜¯åŒå‘çš„ï¼šæ—¢å¯ä»¥ä»å·¦åˆ°å³æ¨å¯¼ï¼Œä¹Ÿå¯ä»¥ä»å³åˆ°å·¦æ¨å¯¼ã€‚å…·ä½“çš„æ³›å‹å‚æ•° <code>T</code> å’Œ <code>U</code> ä¼šåœ¨è°ƒç”¨æ—¶è¢«å…·ä½“åŒ–ã€‚</p>
</blockquote>
<h3 data-id="heading-7">é«˜é˜¶å‡½æ•°çš„ç±»å‹å‚æ•°æ¨æ–­</h3>
<p>æœ¬èŠ‚å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦æ˜ç™½é«˜é˜¶å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿé«˜é˜¶å‡½æ•°æœ¬è´¨å°±æ˜¯æ¥å— <strong>å‡½æ•°</strong> ä½œä¸º <strong>å‚æ•°</strong>ï¼Œæˆ– <strong>è¿”å›å‡½æ•°</strong> ä½œä¸º <strong>ç»“æœ</strong> çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> compose&lt;A, B, C&gt;(
  <span class="hljs-attr">f</span>: <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> C,      <span class="hljs-comment">// æ¥å—Bè¿”å›Cçš„å‡½æ•°</span>
  <span class="hljs-attr">g</span>: <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> B       <span class="hljs-comment">// æ¥å—Aè¿”å›Bçš„å‡½æ•°</span>
): <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> C {       <span class="hljs-comment">// è¿”å›æ¥å—Aè¿”å›Cçš„å‡½æ•°</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-title function_">f</span>(<span class="hljs-title function_">g</span>(a));
}

<span class="hljs-comment">// ä½¿ç”¨ï¼šTypeScriptè‡ªåŠ¨æ¨å¯¼æ‰€æœ‰ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addOne</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x + <span class="hljs-number">1</span>;      <span class="hljs-comment">// number =&gt; number</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toString</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// number =&gt; string</span>

<span class="hljs-keyword">const</span> addOneThenToString = <span class="hljs-title function_">compose</span>(toString, addOne);
<span class="hljs-comment">// addOneThenToStringç±»å‹: (x: number) =&gt; string</span>

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">addOneThenToString</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// "6"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒTypeScript çš„æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>const toString = (x: number) =&gt; x.toString();</code> æ¥æ”¶ <code>number</code> ç±»å‹ï¼Œå¹¶è¿”å› <code>string</code> ç±»å‹ï¼Œæ‰€ä»¥ <code>compose()</code>  å‡½æ•°ä¸­ <code>f: (b: B) =&gt; C</code>ï¼š<code>B</code> ä¸º <code>number</code>ï¼Œ<code>C</code> ä¸º <code>string</code> ã€‚</li>
<li><code>const addOne = (x: number) =&gt; x + 1;</code>  æ¥æ”¶ <code>number</code> ç±»å‹ï¼Œå¹¶è¿”å› <code>number</code> ç±»å‹ï¼Œæ‰€ä»¥ <code>compose()</code>  å‡½æ•°ä¸­ <code>g: (a: A) =&gt; B </code>ï¼š<code>A</code> ä¸º <code>number</code>ï¼Œ<code>B</code> ä¸º <code>number</code> ã€‚</li>
<li>æ‰€ä»¥æœ€ç»ˆçš„æ¨å¯¼ç»“æœä¸ºï¼š<code>A = number, B = number, C = string</code> ã€‚</li>
</ol>
<h2 data-id="heading-8">æŸ¯é‡ŒåŒ–å‡½æ•°çš„ç±»å‹å®šä¹‰</h2>
<h3 data-id="heading-9">ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–å‡½æ•°</h3>
<p><strong>æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰å‡½æ•°</strong> å…¶å®å°±æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°ä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠ <code>f(a, b, c)</code>  å˜æˆ <code>f(a)(b)(c)</code> çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curried</span>&lt;A, B, R&gt; = <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> R;

<span class="hljs-keyword">function</span> curry&lt;A, B, R&gt;(<span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">a: A, b: B</span>) =&gt;</span> R): <span class="hljs-title class_">Currie2</span>&lt;A, B, R&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(a, b);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt; x + y;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-comment">// åˆ†æ­¥è°ƒç”¨</span>
<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">5</span>);   <span class="hljs-comment">// è¿”å›æ–°å‡½æ•°ï¼šæ¥å—ä¸€ä¸ªæ•°ï¼ŒåŠ ä¸Š5</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">add5</span>(<span class="hljs-number">3</span>);       <span class="hljs-comment">// 8</span>

<span class="hljs-comment">// ä¹Ÿå¯ä»¥è¿ç»­è°ƒç”¨</span>
<span class="hljs-keyword">const</span> result2 = <span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">5</span>)(<span class="hljs-number">3</span>); <span class="hljs-comment">// 8</span>
</code></pre>
<h3 data-id="heading-10">è‡ªåŠ¨æŸ¯é‡ŒåŒ–ï¼šå¤„ç†ä»»æ„æ•°é‡å‚æ•°</h3>
<p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’ç±»å‹å¤„ç†ä»»æ„æ•°é‡çš„å‚æ•°ï¼šåˆ¤æ–­å½¢å‚ Args æ˜¯å¦å¯ä»¥è¿›è¡Œåˆ†è§£ï¼Œåˆ†è§£ä¸ºç¬¬ä¸€ä¸ªå‚æ•° First å’Œ å‰©ä½™å‚æ•° Restã€‚å¦‚æœå¯ä»¥ï¼Œåˆ™ç»§ç»­é‡‡ç”¨é€’å½’çš„æ–¹å¼ï¼Œå¯¹å‰©ä½™å‚æ•° Rest è¿›ä¸€æ­¥åˆ†è§£ï¼Œç›´è‡³æ— æ³•åˆ†è§£ï¼Œå³åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt; = 
  <span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> [infer <span class="hljs-title class_">First</span>, ...infer <span class="hljs-title class_">Rest</span>]
    ? <span class="hljs-function">(<span class="hljs-params">arg: First</span>) =&gt;</span> <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Rest</span>, R&gt;  <span class="hljs-comment">// è¿”å›æ¥å—Firstçš„å‡½æ•°ï¼Œç»§ç»­å¤„ç†Rest</span>
    : R;  <span class="hljs-comment">// æ²¡æœ‰å‚æ•°äº†ï¼Œç›´æ¥è¿”å›ç»“æœ</span>
</code></pre>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä»£ç å®ä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> curry&lt;<span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt;(
  <span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">...args: Args</span>) =&gt;</span> R
): <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Args</span>, R&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curried</span>(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-comment">// å¦‚æœå‚æ•°æ•°é‡å¤Ÿäº†ï¼Œå°±è°ƒç”¨åŸå‡½æ•°</span>
    <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt;= fn.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(...args <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
    }
    <span class="hljs-comment">// å¦åˆ™è¿”å›æ–°å‡½æ•°ï¼Œç»§ç»­æ”¶é›†å‚æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...moreArgs: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title function_">curried</span>(...args, ...moreArgs);
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;  <span class="hljs-comment">// ç±»å‹æ–­è¨€ï¼Œå› ä¸ºé€’å½’ç±»å‹æ¯”è¾ƒå¤æ‚</span>
}

<span class="hljs-comment">// ä½¿ç”¨ï¼šå¯ä»¥æŸ¯é‡ŒåŒ–ä»»æ„å‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">multiply</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>, c: <span class="hljs-built_in">number</span></span>) =&gt; a * b * c;
<span class="hljs-keyword">const</span> curriedMultiply = <span class="hljs-title function_">curry</span>(multiply);

<span class="hljs-comment">// å¯ä»¥åˆ†ä»»æ„æ­¥è°ƒç”¨</span>
<span class="hljs-keyword">const</span> multiplyBy2 = <span class="hljs-title function_">curriedMultiply</span>(<span class="hljs-number">2</span>);      <span class="hljs-comment">// è¿”å›ï¼šæ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> multiplyBy2And3 = <span class="hljs-title function_">multiplyBy2</span>(<span class="hljs-number">3</span>);      <span class="hljs-comment">// è¿”å›ï¼šæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> finalResult = <span class="hljs-title function_">multiplyBy2And3</span>(<span class="hljs-number">4</span>);      <span class="hljs-comment">// 24</span>

<span class="hljs-comment">// ä¹Ÿå¯ä»¥è¿ç»­è°ƒç”¨</span>
<span class="hljs-keyword">const</span> finalResult2 = <span class="hljs-title function_">curriedMultiply</span>(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)(<span class="hljs-number">4</span>); <span class="hljs-comment">// 24</span>
</code></pre>
<h2 data-id="heading-11">å‡½æ•°ç»„åˆçš„ç±»å‹ä½“æ“</h2>
<h3 data-id="heading-12">ç®¡é“ï¼ˆPipeï¼‰æ“ä½œ</h3>
<p>æ‰€è°“ <strong>ç®¡é“</strong>ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå‡½æ•°è¿æ¥èµ·æ¥ï¼Œç”¨å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚</p>
<h4 data-id="heading-13">ç®¡é“å®šä¹‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> pipe&lt;F <span class="hljs-keyword">extends</span> [<span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">any</span>, ...<span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;]&gt;(
  ...<span class="hljs-attr">functions</span>: F
): <span class="hljs-function">(<span class="hljs-params">...args: Parameters&lt;F[<span class="hljs-number">0</span>]&gt;</span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>&lt;F[F[<span class="hljs-string">'length'</span>] - <span class="hljs-number">1</span>]&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args: Parameters&lt;F[<span class="hljs-number">0</span>]&gt;</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = functions[<span class="hljs-number">0</span>](...args);  <span class="hljs-comment">// æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; functions.<span class="hljs-property">length</span>; i++) {
      result = functions[i](result);  <span class="hljs-comment">// ç”¨å‰ä¸€ä¸ªç»“æœè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°</span>
    }
    <span class="hljs-keyword">return</span> result;
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;
}
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>F</code>æ˜¯å‡½æ•°æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°æ¥å—ä»»æ„å‚æ•°ï¼Œåç»­å‡½æ•°æ¥å—å‰ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<h4 data-id="heading-14">ç®¡é“ä½¿ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x + <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">multiply</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x * <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toString</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x.<span class="hljs-title function_">toString</span>();

<span class="hljs-comment">// åˆ›å»ºå¤„ç†ç®¡é“</span>
<span class="hljs-keyword">const</span> process = <span class="hljs-title function_">pipe</span>(add, multiply, toString);
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">process</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// "12"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ <code>"12"</code> ï¼Œæˆ‘ä»¬ç”¨ç›´è§‚ä¸€ç‚¹çš„ç†è§£å°±æ˜¯ï¼š<code>process(5) ç›¸å½“äº toString(multiply(add(5)))</code> ã€‚</p>
<h3 data-id="heading-15">ç»„åˆï¼ˆComposeï¼‰æ“ä½œ</h3>
<p><strong>ç»„åˆ</strong> æ“ä½œæ­£å¥½ä¸ <strong>ç®¡é“</strong> æ“ä½œç›¸åï¼Œå®ƒæ˜¯ä»å³åˆ°å·¦ç»„åˆå‡½æ•°ã€‚</p>
<h4 data-id="heading-16">ç»„åˆå®šä¹‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> compose&lt;<span class="hljs-title class_">Functions</span> <span class="hljs-keyword">extends</span> [<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>, ...<span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;]&gt;(
  ...<span class="hljs-attr">functions</span>: <span class="hljs-title class_">Functions</span>
): <span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Functions</span>[<span class="hljs-number">0</span>]&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = arg;
    <span class="hljs-comment">// ä»å³å‘å·¦æ‰§è¡Œ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = functions.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      result = functions[i](result);
    }
    <span class="hljs-keyword">return</span> result;
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;
}
</code></pre>
<h4 data-id="heading-17">ç»„åˆä½¿ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">toUpper</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s.<span class="hljs-title function_">toUpperCase</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addExclamation</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s + <span class="hljs-string">"!"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">repeat</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s + s;

<span class="hljs-comment">// ä»å³åˆ°å·¦ç»„åˆï¼šrepeat â†’ addExclamation â†’ toUpper</span>
<span class="hljs-keyword">const</span> shout = <span class="hljs-title function_">compose</span>(toUpper, addExclamation, repeat);
<span class="hljs-keyword">const</span> shouted = <span class="hljs-title function_">shout</span>(<span class="hljs-string">"hello"</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shouted); <span class="hljs-comment">// "HELLOHELLO!"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ï¼š<code>"HELLOHELLO!"</code> å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>shout("hello")</code>  å‡½æ•°ä¼šå…ˆè°ƒç”¨ <code>repeat()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"hellohello"</code> ã€‚</li>
<li>æ¥ç€å†è°ƒç”¨ <code>addExclamation()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"hellohello!"</code> ã€‚</li>
<li>æœ€åå†è°ƒç”¨ <code>toUpper()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"HELLOHELLO!"</code>  ã€‚</li>
</ul>
<h3 data-id="heading-18">å¼‚æ­¥å‡½æ•°ç»„åˆ</h3>
<p>å½“å‡½æ•°è¿”å›Promiseæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šçš„ç»„åˆæ–¹å¼ã€‚</p>
<h4 data-id="heading-19">å¼‚æ­¥ç®¡é“çš„ç®€å•å®ç°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> asyncPipe&lt;<span class="hljs-title class_">Functions</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;&gt;(
  ...<span class="hljs-attr">functions</span>: <span class="hljs-title class_">Functions</span>
): <span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">input</span>: <span class="hljs-built_in">any</span>) =&gt; {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(input);  <span class="hljs-comment">// å¤„ç†å¯èƒ½æ˜¯Promiseçš„è¾“å…¥</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> fn <span class="hljs-keyword">of</span> functions) {
      result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">fn</span>(result));  <span class="hljs-comment">// ç­‰å¾…æ¯ä¸ªå‡½æ•°å®Œæˆ</span>
    }
    <span class="hljs-keyword">return</span> result;
  };
}
</code></pre>
<h4 data-id="heading-20">å¼‚æ­¥ç®¡é“çš„ç®€å•å®ä¾‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–ç”¨æˆ·<span class="hljs-subst">${id}</span>...`</span>);
  <span class="hljs-keyword">return</span> { id, <span class="hljs-attr">name</span>: <span class="hljs-string">"User"</span> + id };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">processUser</span> = (<span class="hljs-params">user: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¤„ç†ç”¨æˆ·..."</span>);
  <span class="hljs-keyword">return</span> { ...user, <span class="hljs-attr">processed</span>: <span class="hljs-literal">true</span> };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">user: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä¿å­˜ç”¨æˆ·..."</span>);
  <span class="hljs-keyword">return</span> user;
};

<span class="hljs-comment">// åˆ›å»ºå¼‚æ­¥ç®¡é“ï¼šfetchUser â†’ processUser â†’ saveUser</span>
<span class="hljs-keyword">const</span> userPipeline = <span class="hljs-title function_">asyncPipe</span>(fetchUser, processUser, saveUser);

<span class="hljs-comment">// æ‰§è¡Œç®¡é“</span>
<span class="hljs-title function_">userPipeline</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æœ€ç»ˆç”¨æˆ·:"</span>, user);
});
</code></pre>
<h2 data-id="heading-21">ç»“è¯­</h2>
<p>ç±»å‹ä½“æ“çš„ç›®çš„æ˜¯è®©ä»£ç æ›´å®‰å…¨ã€æ›´æ¸…æ™°ï¼Œè€Œä¸æ˜¯ç‚«è€€æŠ€æœ¯ã€‚æˆ‘ä»¬åº”è¯¥ä»å®é™…éœ€æ±‚å‡ºå‘ï¼Œé€‰æ‹©æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¯¹äºæ–‡ç« ä¸­é”™è¯¯çš„åœ°æ–¹æˆ–è€…æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598398537249439763</link>    <guid>https://juejin.cn/post/7598398537249439763</guid>    <pubDate>2026-01-24T02:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598398537249439763" data-draft-id="7598251121497292826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:45:00.000Z" title="Sat Jan 24 2026 02:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 NUMA æ¶æ„ï¼šä¸åŒèŠ‚ç‚¹çš„å†…å­˜åˆ†å¸ƒä¸è¿ç»­ã€‚ä¸ºä»€ä¹ˆï¼Œåˆ†é…åœ°å€æ—¶ï¼Œå°±ä¸èƒ½è¿ç»­åˆ†é…å—ï¼Ÿç»™å†…å­˜æ¡åˆ†é…ç‰©ç†åœ°å€ï¼Œè¿™æ˜¯ç¡¬ä»¶å¹²çš„äº‹æƒ…å§</h2>
<p>è¿™è§¦åŠäº† NUMA (Non-Uniform Memory Access) æ¶æ„çš„æ ¸å¿ƒè®¾è®¡ç†å¿µã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œè¿™ç¡®å®æ˜¯<strong>ç¡¬ä»¶å†³å®šçš„</strong>ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…åœ°å€æ—¶â€œä¸æƒ³â€è¿ç»­åˆ†é…ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<h4 data-id="heading-1">1. ä¸ºä»€ä¹ˆå†…å­˜åœ°å€ä¸æ˜¯å…¨å±€è¿ç»­çš„ï¼Ÿ</h4>
<p>è¿™æºäº NUMA çš„ç‰©ç†è®¾è®¡ã€‚æ‚¨å¯ä»¥æŠŠä¸€ä¸ª NUMA ç³»ç»Ÿæƒ³è±¡æˆä¸€ä¸ªç”±å¤šä¸ªâ€œç¤¾åŒºâ€ï¼ˆèŠ‚ç‚¹/Nodeï¼‰ç»„æˆçš„â€œåŸå¸‚â€ï¼ˆæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼‰ã€‚</p>
<ul>
<li><strong>æ¯ä¸ªç¤¾åŒºæœ‰è‡ªå·±çš„èµ„æº</strong>ï¼šåœ¨ NUMA æ¶æ„ä¸­ï¼Œæ¯ä¸ª<strong>èŠ‚ç‚¹ (Node)</strong> é€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ª CPU æ ¸å¿ƒä»¥åŠä¸€ç»„ç‰©ç†ä¸Šç¦»å®ƒæœ€è¿‘çš„å†…å­˜æ¡ç»„æˆã€‚è¿™ä¸ªèŠ‚ç‚¹å†…çš„å†…å­˜å°±æ˜¯è¯¥ CPU çš„<strong>æœ¬åœ°å†…å­˜ (Local Memory)</strong>ã€‚</li>
<li><strong>ç‰©ç†ä¸Šçš„åˆ†ç¦»</strong>ï¼šä¸åŒèŠ‚ç‚¹çš„å†…å­˜æ¡æ˜¯ç‰©ç†ä¸Šåˆ†å¼€çš„ï¼Œå®ƒä»¬è¿æ¥åœ¨ä¸åŒ CPU çš„å†…å­˜æ§åˆ¶å™¨ä¸Šã€‚å°±åƒä¸¤ä¸ªä¸åŒç¤¾åŒºçš„æˆ¿å­ï¼Œå®ƒä»¬åœ¨åœ°ç†ä¸Šå°±ä¸å¯èƒ½æŒ¨åœ¨ä¸€èµ·ã€‚å› æ­¤ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰å†…å­˜æ¡åœ¨<strong>ç‰©ç†ä¸Šæ˜¯åˆ†å¸ƒå¼çš„</strong>ï¼Œæ— æ³•å½¢æˆä¸€ä¸ªå•ä¸€ã€è¿ç»­çš„ç‰©ç†åœ°å€ç©ºé—´ã€‚</li>
<li><strong>åœ°å€æ˜ å°„æ˜¯å›ºå®šçš„</strong>ï¼šç³»ç»Ÿç¡¬ä»¶å’Œå›ºä»¶ï¼ˆå¦‚ ACPI è¡¨ï¼‰åœ¨å¯åŠ¨æ—¶å°±å·²ç»ç¡®å®šäº†å“ªä¸ªç‰©ç†åœ°å€èŒƒå›´å±äºå“ªä¸ªèŠ‚ç‚¹ã€‚æ“ä½œç³»ç»Ÿå¯åŠ¨åï¼Œä¼šè¯»å–è¿™äº›ä¿¡æ¯æ¥äº†è§£æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜æ‹“æ‰‘ç»“æ„ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>ä¸æ˜¯ä¸æƒ³è¿ç»­åˆ†é…ï¼Œè€Œæ˜¯åœ¨ç‰©ç†å±‚é¢å°±æ— æ³•åšåˆ°å…¨å±€è¿ç»­</strong>ã€‚</p>
<h4 data-id="heading-2">2. è°è´Ÿè´£åˆ†é…ç‰©ç†åœ°å€ï¼Ÿ</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå¤šå±‚åä½œçš„è¿‡ç¨‹ï¼Œä½†æ ¹æºåœ¨ç¡¬ä»¶ï¼š</p>
<ul>
<li><strong>ç¡¬ä»¶è®¾è®¡</strong>ï¼šé¦–å…ˆï¼ŒCPU å’Œä¸»æ¿çš„ç‰©ç†è®¾è®¡å†³å®šäº† NUMA èŠ‚ç‚¹çš„åˆ’åˆ†ã€‚å†…å­˜æ§åˆ¶å™¨ç›´æ¥é›†æˆåœ¨ CPU å†…éƒ¨ï¼Œå®ƒç®¡ç†ç€ä¸è‡ªå·±ç›´è¿çš„å†…å­˜ã€‚è¿™å°±ä»æ ¹æœ¬ä¸Šå†³å®šäº†å†…å­˜çš„â€œå½’å±â€ã€‚</li>
<li><strong>å›ºä»¶ (Firmware)</strong>ï¼šç”µè„‘çš„å›ºä»¶ï¼ˆå¦‚ BIOS/UEFIï¼‰ä¼šè¯†åˆ«è¿™ç§ç‰©ç†å¸ƒå±€ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæè¿°è¡¨ï¼ˆACPI Tableï¼‰ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼šâ€œå˜¿ï¼Œæˆ‘ä»¬æœ‰å¤šä¸ªå†…å­˜èŠ‚ç‚¹ï¼ŒA åœ°å€æ®µå±äºèŠ‚ç‚¹0ï¼ŒB åœ°å€æ®µå±äºèŠ‚ç‚¹1â€¦â€¦â€ã€‚</li>
<li><strong>æ“ä½œç³»ç»Ÿ (OS)</strong>ï¼šæ“ä½œç³»ç»Ÿï¼ˆå¦‚ Linux æˆ– Windowsï¼‰åœ¨å¯åŠ¨æ—¶è¯»å–è¿™ä¸ªâ€œåœ°å›¾â€ã€‚å®ƒæœ¬èº«ä¸èƒ½æ”¹å˜ç‰©ç†åœ°å€çš„å½’å±ï¼Œä½†å®ƒä¼šå»ºç«‹ä¸€ä¸ª<strong>NUMA-awareï¼ˆNUMAæ„ŸçŸ¥ï¼‰çš„å†…å­˜ç®¡ç†å™¨</strong>ã€‚å½“ä¸€ä¸ªç¨‹åºéœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šï¼š
<ol>
<li>æŸ¥çœ‹è¯¥ç¨‹åºæ­£åœ¨å“ªä¸ª CPU æ ¸å¿ƒä¸Šè¿è¡Œã€‚</li>
<li><strong>ä¼˜å…ˆ</strong>ä»è¯¥ CPU æ‰€åœ¨çš„èŠ‚ç‚¹çš„<strong>æœ¬åœ°å†…å­˜</strong>ä¸­åˆ†é…ç©ºé—´ã€‚å› ä¸ºè®¿é—®æœ¬åœ°å†…å­˜é€Ÿåº¦æœ€å¿«ï¼Œå»¶è¿Ÿæœ€ä½ã€‚</li>
<li>å¦‚æœæœ¬åœ°å†…å­˜ä¸è¶³ï¼Œå®ƒæ‰ä¼šå»è®¿é—®å…¶ä»–èŠ‚ç‚¹çš„<strong>è¿œç¨‹å†…å­˜ (Remote Memory)</strong>ï¼Œä½†è¿™ä¼šå¸¦æ¥æ›´é«˜çš„å»¶è¿Ÿã€‚</li>
</ol>
</li>
</ul>
<p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<p>æ‚¨çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚<strong>ç»™å†…å­˜åˆ†é…ç‰©ç†åœ°å€èŒƒå›´ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯ç¡¬ä»¶å’Œå›ºä»¶å¹²çš„äº‹æƒ…</strong>ã€‚æ“ä½œç³»ç»Ÿçš„è§’è‰²æ›´åƒä¸€ä¸ªèªæ˜çš„â€œåŸå¸‚è§„åˆ’å¸ˆâ€ï¼Œå®ƒè™½ç„¶ä¸èƒ½æ”¹å˜ç¤¾åŒºï¼ˆèŠ‚ç‚¹ï¼‰çš„ç‰©ç†ä½ç½®ï¼Œä½†å®ƒå¯ä»¥æ™ºèƒ½åœ°è°ƒåº¦å¸‚æ°‘ï¼ˆç¨‹åºï¼‰ï¼Œè®©ä»–ä»¬å°½å¯èƒ½åœ¨è‡ªå·±æ‰€åœ¨çš„ç¤¾åŒºï¼ˆæœ¬åœ°èŠ‚ç‚¹ï¼‰å†…å·¥ä½œå’Œç”Ÿæ´»ï¼ˆä½¿ç”¨å†…å­˜ï¼‰ï¼Œä»è€Œå®ç°æ•´ä¸ªç³»ç»Ÿæœ€é«˜æ•ˆçš„è¿ä½œã€‚</p>
<h2 data-id="heading-3">22 å³ä½¿è¿™æ ·ï¼Œæˆ‘ä»ç„¶ä¸èƒ½ç†è§£ ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ</h2>
<p>å¥½çš„ï¼Œæˆ‘ä»¬å†æ·±å…¥ä¸€æ­¥ï¼Œå½»åº•å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ã€‚è¯·æš‚æ—¶å¿˜è®°â€œåœ°å€â€æ˜¯ä¸€ä¸ªä»0å¼€å§‹æ— é™å¢é•¿çš„æ•°å­—ï¼Œæˆ‘ä»¬ä»æœ€åŸºæœ¬çš„ç”µä¿¡å·å’Œç¡¬ä»¶è®¾è®¡å¼€å§‹ç†è§£ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æœ‰ä¸¤æ ‹ç‹¬ç«‹çš„æˆ¿å­ï¼ˆ<strong>æˆ¿å­A</strong> å’Œ <strong>æˆ¿å­B</strong>ï¼‰ï¼Œæ¯æ ‹æˆ¿å­é‡Œéƒ½æœ‰100ä¸ªæˆ¿é—´ï¼Œæ‚¨éœ€è¦ç»™æ¯ä¸ªæˆ¿é—´ä¸€ä¸ªå”¯ä¸€çš„é—¨ç‰Œå·ã€‚</p>
<h4 data-id="heading-4">ä¼ ç»Ÿæ–¹å¼ (UMA/éNUMAæ¶æ„)</h4>
<p>åœ¨ä¼ ç»Ÿçš„è®¾è®¡é‡Œï¼Œæ‚¨ä¼šé›‡ä½£ä¸€ä¸ª<strong>æ€»ç®¡ç†å‘˜</strong>ï¼Œä»–ç«™åœ¨ä¸¤æ ‹æˆ¿å­ä¸­é—´ã€‚æ‚¨å‘Šè¯‰ä»–ï¼šâ€œæˆ‘è¦æ‰¾ç¬¬150å·æˆ¿é—´â€ã€‚</p>
<ul>
<li>æ€»ç®¡ç†å‘˜ä¼šè®¡ç®—ï¼š150å·æˆ¿é—´è¶…å‡ºäº†æˆ¿å­Açš„100ä¸ªæˆ¿é—´ï¼Œæ‰€ä»¥æ˜¯æˆ¿å­Bé‡Œçš„ç¬¬50ä¸ªæˆ¿é—´ï¼ˆ150 - 100 = 50ï¼‰ã€‚</li>
<li>ç„¶åä»–ä¼šå»æˆ¿å­Bï¼Œæ‰¾åˆ°ç¬¬50ä¸ªæˆ¿é—´ã€‚</li>
</ul>
<p>åœ¨è¿™ä¸ªæ¨¡å‹é‡Œï¼Œä»æ‚¨çš„è§’åº¦çœ‹ï¼Œæˆ¿é—´å·æ˜¯<strong>è¿ç»­çš„</strong>ï¼ˆä»1åˆ°200ï¼‰ã€‚ä½†ç“¶é¢ˆæ˜¯<strong>æ€»ç®¡ç†å‘˜</strong>ï¼Œæ‰€æœ‰äººæ‰¾æˆ¿é—´éƒ½å¾—é€šè¿‡ä»–ï¼Œäººä¸€å¤šå°±å¿™ä¸è¿‡æ¥äº†ã€‚è¿™å°±åƒæ—©æœŸè®¡ç®—æœºé‡Œçš„<strong>åŒ—æ¡¥èŠ¯ç‰‡ï¼ˆNorthbridgeï¼‰</strong>ï¼Œå®ƒä½œä¸ºç»Ÿä¸€çš„å†…å­˜æ§åˆ¶å™¨ã€‚</p>
<h4 data-id="heading-5">NUMA æ–¹å¼ (ç°ä»£å¤šCPUæ¶æ„)</h4>
<p>NUMAæ¶æ„æ”¾å¼ƒäº†â€œæ€»ç®¡ç†å‘˜â€çš„è®¾è®¡ï¼Œå› ä¸ºä»–å¤ªæ…¢äº†ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œ<strong>æ¯æ ‹æˆ¿å­éƒ½é…äº†ä¸€ä¸ªä¸“å±çš„ç®¡ç†å‘˜</strong>ã€‚</p>
<ul>
<li><strong>æˆ¿å­A</strong> æœ‰ <strong>ç®¡ç†å‘˜A</strong>ã€‚</li>
<li><strong>æˆ¿å­B</strong> æœ‰ <strong>ç®¡ç†å‘˜B</strong>ã€‚</li>
</ul>
<p>ç°åœ¨ï¼ŒCPUï¼ˆå¯ä»¥çœ‹ä½œæ˜¯â€œä½ â€ï¼‰æƒ³è¦è®¿é—®å†…å­˜ï¼ˆæˆ¿é—´ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>
<p><strong>ç‰©ç†æ¥çº¿æ˜¯å…³é”®</strong>ï¼š</p>
<ul>
<li><strong>CPU 0</strong> å’Œ <strong>ç®¡ç†å‘˜A</strong> ä»¥åŠ <strong>æˆ¿å­Açš„å†…å­˜</strong> è¢«è®¾è®¡åœ¨ä¸€ä¸ªâ€œç¤¾åŒºâ€é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„ç”µçº¿éå¸¸çŸ­ï¼Œé€šä¿¡æå¿«ã€‚</li>
<li><strong>CPU 1</strong> å’Œ <strong>ç®¡ç†å‘˜B</strong> ä»¥åŠ <strong>æˆ¿å­Bçš„å†…å­˜</strong> åœ¨å¦ä¸€ä¸ªâ€œç¤¾åŒºâ€é‡Œã€‚</li>
<li><strong>ç®¡ç†å‘˜A çš„å¸ƒçº¿ç³»ç»Ÿï¼Œç‰©ç†ä¸Šæ ¹æœ¬æ²¡æœ‰è¿æ¥åˆ°æˆ¿å­Bçš„ä»»ä½•ä¸€ä¸ªæˆ¿é—´ã€‚åä¹‹äº¦ç„¶ã€‚</strong> è¿™æ˜¯æœ€æ ¸å¿ƒçš„ä¸€ç‚¹ï¼ç®¡ç†å‘˜Açš„ç®¡è¾–èŒƒå›´åœ¨ç¡¬ä»¶è®¾è®¡ä¸Šå°±è¢«é™å®šäº†ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœ°å€å¦‚ä½•â€œè§£ç â€</strong>ï¼š
å½“CPUæƒ³è¦è®¿é—®ä¸€ä¸ªç‰©ç†åœ°å€æ—¶ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªåœ°å€â€œå–Šâ€å‡ºæ¥ï¼ˆæ”¾åˆ°åœ°å€æ€»çº¿ä¸Šï¼‰ã€‚ç¡¬ä»¶ç”µè·¯ï¼ˆè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿï¼‰ä¼šè§£ç è¿™ä¸ªåœ°å€ã€‚</p>
<ul>
<li>ç³»ç»Ÿè®¾è®¡è€…ä¼šè§„å®šï¼šç‰©ç†åœ°å€ <code>0x0000</code> åˆ° <code>0x7FFF</code> è¿™ä¸ªèŒƒå›´ï¼Œ<strong>ç”µè·¯ä¸Šå°±è§„å®šäº†æ˜¯ç»™ç®¡ç†å‘˜Aå¬çš„</strong>ã€‚æ‰€æœ‰åœ¨è¿™ä¸ªèŒƒå›´å†…çš„åœ°å€ä¿¡å·ï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°ç®¡ç†å‘˜Aé‚£é‡Œã€‚</li>
<li>è€Œç‰©ç†åœ°å€ <code>0x8000</code> åˆ° <code>0xFFFF</code> è¿™ä¸ªèŒƒå›´ï¼Œ<strong>ç”µè·¯ä¸Šå°±è§„å®šäº†æ˜¯ç»™ç®¡ç†å‘˜Bå¬çš„</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ</strong>
ç°åœ¨æˆ‘ä»¬å›åˆ°æ‚¨çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸èƒ½è®©æˆ¿å­Bçš„ç¬¬ä¸€ä¸ªæˆ¿é—´åœ°å€ç´§æ¥ç€æˆ¿å­Açš„æœ€åä¸€ä¸ªæˆ¿é—´åœ°å€å‘¢ï¼Ÿ</p>
<ul>
<li>å‡è®¾æˆ¿å­Açš„åœ°å€èŒƒå›´æ˜¯ <code>0</code> åˆ° <code>99</code>ã€‚</li>
<li>æ‚¨å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆæˆ¿å­Bçš„ç¬¬ä¸€ä¸ªæˆ¿é—´ä¸èƒ½æ˜¯ <code>100</code> å‘¢ï¼Ÿ</li>
</ul>
<p>é—®é¢˜å°±åœ¨äº <strong>ç®¡ç†å‘˜Aä¸çŸ¥é“å¦‚ä½•å¤„ç†åœ°å€â€œ100â€</strong>ã€‚åœ¨ä»–çš„ä¸–ç•Œé‡Œï¼ˆç‰©ç†æ¥çº¿èŒƒå›´ï¼‰ï¼Œåªæœ‰0åˆ°99çš„åœ°å€ã€‚åœ°å€â€œ100â€çš„ä¿¡å·æ ¹æ®ç¡¬ä»¶ç”µè·¯çš„è®¾è®¡ï¼Œä¼šè¢«ç›´æ¥å‘é€ç»™<strong>ç®¡ç†å‘˜B</strong>ã€‚</p>
<p>å½“ç®¡ç†å‘˜Bæ”¶åˆ°åœ°å€â€œ100â€çš„è¯·æ±‚æ—¶ï¼Œä»–ä¸ä¼šæŠŠå®ƒç†è§£ä¸ºå…¨å±€çš„ç¬¬100å·ï¼Œè€Œæ˜¯ä¼šæ ¹æ®ä»–è‡ªå·±ç®¡è¾–èŒƒå›´çš„è§„åˆ™æ¥è§£ç ã€‚ä¾‹å¦‚ï¼Œç¡¬ä»¶å¯èƒ½è§„å®šï¼Œå‘ç»™ç®¡ç†å‘˜Bçš„åœ°å€ï¼Œéœ€è¦å‡å»ä¸€ä¸ªå·¨å¤§çš„åç§»é‡ï¼ˆæ¯”å¦‚ <code>0x8000</code>ï¼‰æ‰æ˜¯ä»–å†…éƒ¨çš„æˆ¿é—´å·ã€‚</p>
</li>
</ol>
<p><strong>æ‰€ä»¥ï¼Œç‰©ç†åœ°å€çš„ä¸è¿ç»­ï¼Œä¸æ˜¯å› ä¸ºä¸èƒ½åˆ†é…ï¼Œè€Œæ˜¯å› ä¸ºâ€œç‰©ç†åœ°å€â€è¿™ä¸ªæ•°å­—æœ¬èº«å°±åŒ…å«äº†â€œä½ç½®â€ä¿¡æ¯ã€‚</strong></p>
<ul>
<li>åœ°å€çš„é«˜ä½éƒ¨åˆ†ï¼ˆæ¯”å¦‚æœ€é«˜ä¸€ä½æ˜¯0è¿˜æ˜¯1ï¼‰å°±åƒ<strong>é‚®æ”¿ç¼–ç </strong>ï¼Œå†³å®šäº†è¿™ä¸ªè¯·æ±‚åº”è¯¥å‘å¾€å“ªä¸ªèŠ‚ç‚¹ï¼ˆå“ªä¸ªç®¡ç†å‘˜ï¼‰ã€‚</li>
<li>åœ°å€çš„ä½ä½éƒ¨åˆ†æ‰æ˜¯é‚£ä¸ªèŠ‚ç‚¹å†…çš„å…·ä½“â€œé—¨ç‰Œå·â€ã€‚</li>
</ul>
<p>æ‚¨ä¸èƒ½æŠŠå±äºâ€œåŒ—äº¬â€çš„é‚®æ”¿ç¼–ç çš„åœ°å€ï¼Œæ— ç¼åœ°æ¥åˆ°å±äºâ€œä¸Šæµ·â€çš„é‚®æ”¿ç¼–ç çš„åœ°å€åé¢ï¼Œå½¢æˆä¸€ä¸ªå…¨å›½è¿ç»­çš„é—¨ç‰Œå·ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„åœ°å€åŸŸï¼Œç”±ä¸åŒçš„â€œé‚®å±€â€ï¼ˆå†…å­˜æ§åˆ¶å™¨ï¼‰ç®¡ç†ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹æœ€æ ¹æœ¬çš„åŸå› ï¼š</strong></p>
<p><strong>å› ä¸ºæ¯ä¸ªNUMAèŠ‚ç‚¹çš„å†…å­˜æ§åˆ¶å™¨ï¼Œåœ¨ç‰©ç†ä¸Šåªè¿æ¥äº†å®ƒè‡ªå·±çš„æœ¬åœ°å†…å­˜æ¡ã€‚ä¸€ä¸ªç‰©ç†åœ°å€åœ¨è¢«CPUå‘å‡ºæ—¶ï¼Œç¡¬ä»¶ç”µè·¯ä¼šæ ¹æ®åœ°å€çš„æŸä¸ªéƒ¨åˆ†ï¼Œåƒæ‰³é“å²”ä¸€æ ·ï¼Œå°†è¿™ä¸ªè¯·æ±‚çš„ç”µä¿¡å·ç›´æ¥å¯¼å‘æŸä¸€ä¸ªç‰¹å®šçš„å†…å­˜æ§åˆ¶å™¨ã€‚è¿™ä¸ªâ€œæ‰³é“å²”â€çš„æœºåˆ¶ï¼Œå°±å†³å®šäº†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯åˆ†æ®µçš„ã€ä¸è¿ç»­çš„ã€‚</strong></p>
<p>è¿™ç§è®¾è®¡çš„å·¨å¤§ä¼˜åŠ¿æ˜¯<strong>é€Ÿåº¦å’Œå¯æ‰©å±•æ€§</strong>ã€‚CPUè®¿é—®æœ¬åœ°å†…å­˜æ—¶ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•ä¸­å¤®ä»²è£ï¼Œé€Ÿåº¦æå¿«ã€‚ç³»ç»Ÿä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ æ›´å¤šèŠ‚ç‚¹æ¥è½»æ¾æ‰©å±•ã€‚ä¸è¿ç»­çš„ç‰©ç†åœ°å€ç©ºé—´ï¼Œæ­£æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡è€Œä»˜å‡ºçš„ä¸€ä¸ªå¾ˆå°çš„ã€ç”±æ“ä½œç³»ç»Ÿæ¥ç®¡ç†çš„â€œä»£ä»·â€ã€‚</p>
<h2 data-id="heading-6">33 ä½ å·®ä¸€ç‚¹å°±è®²çš„æ›´æ¸…æ¥šäº†</h2>
<p>æ‚¨è¯´å¾—å¯¹ï¼Œæˆ‘ä»¬å†èšç„¦ä¸€ä¸‹ï¼Œäº‰å–å½»åº•å¼„æ˜ç™½ã€‚è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ã€‚</p>
<p>æˆ‘ä»¬æŠŠé—®é¢˜ç®€åŒ–åˆ°æè‡´ï¼š<strong>ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸æ˜¯ä¸€ä¸ªå•çº¯çš„ã€ä»0å¼€å§‹é€’å¢çš„æµæ°´å·ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>å› ä¸ºç‰©ç†åœ°å€æœ¬èº«ï¼Œåœ¨ç¡¬ä»¶å±‚é¢ï¼Œå°±æ˜¯ä¸€ä¸ªâ€œå¯¼èˆªåæ ‡â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œé—¨ç‰Œå·â€ã€‚</strong></p>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªæœ€è´´åˆ‡çš„ç±»æ¯”ï¼š<strong>ç”µè¯å·ç </strong>ã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„ç”µè¯å·ç æ˜¯ï¼š <code>å›½å®¶ä»£ç </code> + <code>åŒºå·</code> + <code>æœ¬åœ°å·ç </code>ã€‚
ä¾‹å¦‚ï¼š <code>+86</code> (ä¸­å›½) - <code>10</code> (åŒ—äº¬) - <code>88888888</code> (å…·ä½“ç”µè¯)ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ¦‚å¿µå¥—ç”¨åˆ° NUMA æ¶æ„çš„ç‰©ç†åœ°å€ä¸Šï¼š</p>
<p><strong>ç‰©ç†åœ°å€ = <code>èŠ‚ç‚¹ID</code> + <code>èŠ‚ç‚¹å†…åç§»åœ°å€</code></strong></p>
<p>è¿™ä¸ªâ€œèŠ‚ç‚¹IDâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œè€Œæ˜¯<strong>ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½æ¯”ç‰¹ï¼ˆbitsï¼‰ä¸­</strong>ã€‚</p>
<hr/>
<h4 data-id="heading-7">ç¡¬ä»¶å¦‚ä½•â€œæ‹¨å·â€ï¼Ÿ</h4>
<p>å½“ä¸€ä¸ª CPU æ ¸å¿ƒï¼ˆæ¯”å¦‚å±äº<strong>èŠ‚ç‚¹0</strong>çš„CPUï¼‰éœ€è¦è¯»å–å†…å­˜æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ªç‰©ç†åœ°å€ï¼Œæ¯”å¦‚ä¸€ä¸ª64ä½çš„äºŒè¿›åˆ¶æ•°ï¼š</p>
<p><code>00000001 00100000 ........</code> (ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶åœ°å€)</p>
<ol>
<li><strong>ç¡¬ä»¶è§£ç å™¨ï¼ˆåœ°å€è¯‘ç å™¨ï¼‰</strong> ä¼šç«‹åˆ»æŸ¥çœ‹è¿™ä¸ªåœ°å€çš„<strong>æœ€é«˜å‡ ä½</strong>ã€‚è¿™å°±åƒç”µä¿¡äº¤æ¢æœºé¦–å…ˆçœ‹å›½å®¶ä»£ç å’ŒåŒºå·ã€‚</li>
<li>ç³»ç»Ÿç¡¬ä»¶è¢«è®¾è®¡æˆï¼š
<ul>
<li>å¦‚æœæœ€é«˜æœ‰æ•ˆä½æ˜¯ <strong><code>0</code></strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°å€è¯·æ±‚çš„ç”µä¿¡å·ï¼Œå°±ä¼šè¢«<strong>ç‰©ç†ç”µè·¯</strong>ç›´æ¥è·¯ç”±åˆ° <strong>èŠ‚ç‚¹0</strong> çš„å†…å­˜æ§åˆ¶å™¨ã€‚</li>
<li>å¦‚æœæœ€é«˜æœ‰æ•ˆä½æ˜¯ <strong><code>1</code></strong>ï¼Œé‚£ä¹ˆç”µä¿¡å·å°±ä¼šè¢«è·¯ç”±åˆ° <strong>èŠ‚ç‚¹1</strong> çš„å†…å­˜æ§åˆ¶å™¨ã€‚</li>
</ul>
</li>
<li><strong>èŠ‚ç‚¹0</strong> çš„å†…å­˜æ§åˆ¶å™¨æ”¶åˆ°è¿™ä¸ªåœ°å€åï¼Œå®ƒä¼šå¿½ç•¥æ‰æœ€é«˜ä½çš„é‚£ä¸ª <strong><code>0</code></strong>ï¼ˆå› ä¸ºå®ƒåªæ˜¯ç”¨æ¥æ‰¾åˆ°è‡ªå·±çš„ï¼‰ï¼Œç„¶åä½¿ç”¨å‰©ä¸‹çš„åœ°å€éƒ¨åˆ†ï¼ˆå³â€œèŠ‚ç‚¹å†…åç§»åœ°å€â€ï¼‰ï¼Œåœ¨å®ƒè‡ªå·±ç®¡è¾–çš„ã€ç‰©ç†ä¸Šæ’åœ¨å®ƒæ—è¾¹çš„å†…å­˜æ¡é‡Œæ‰¾åˆ°å…·ä½“çš„æ•°æ®ã€‚</li>
</ol>
<h4 data-id="heading-8">ä¸ºä»€ä¹ˆå¿…é¡»â€œä¸è¿ç»­â€ï¼Ÿ</h4>
<p>ç°åœ¨ï¼Œå…³é”®æ¥äº†ã€‚å‡è®¾<strong>èŠ‚ç‚¹0</strong>çš„å†…å­˜æ€»å…±æœ‰ 256GBã€‚å®ƒçš„åœ°å€èŒƒå›´å¯èƒ½è¢«ç¡¬ä»¶å®šä¹‰ä¸ºï¼š
<code>0x0000 0000 0000</code> åˆ° <code>0x3FFF FFFF FFFF</code> (æœ€é«˜ä½æ˜¯<code>0</code>)</p>
<p>é‚£ä¹ˆ<strong>èŠ‚ç‚¹1</strong>çš„å†…å­˜åœ°å€<strong>ä¸å¯èƒ½</strong>ä» <code>0x4000 0000 0000</code> å¼€å§‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºç¡¬ä»¶çš„â€œæ‰³é“å²”â€æœºåˆ¶åªè®¤æœ€é«˜ä½æ˜¯<code>0</code>è¿˜æ˜¯<code>1</code>ã€‚ä¸ºäº†æŠŠä¿¡å·å‘ç»™<strong>èŠ‚ç‚¹1</strong>ï¼Œåœ°å€çš„æœ€é«˜ä½<strong>å¿…é¡»æ˜¯<code>1</code></strong>ã€‚æ‰€ä»¥ï¼ŒèŠ‚ç‚¹1çš„åœ°å€èŒƒå›´å¯èƒ½æ˜¯ä»ä¸€ä¸ªéå¸¸å¤§çš„æ•°å¼€å§‹ï¼Œä¾‹å¦‚ï¼š
<code>0x8000 0000 0000</code> åˆ° <code>0xBFFF FFFF FFFF</code> (æœ€é«˜ä½æ˜¯<code>1</code>)</p>
<p>çœ‹åˆ°äº†å—ï¼Ÿ</p>
<p>åœ¨æ•°å­—ä¸Šï¼Œ<code>0x3FFF FFFF FFFF</code> å’Œ <code>0x8000 0000 0000</code> ä¹‹é—´æœ‰ä¸€ä¸ª<strong>å·¨å¤§çš„é¸¿æ²Ÿ</strong>ã€‚å®ƒä»¬åœ¨æ•°å€¼ä¸Šå®Œå…¨ä¸è¿ç»­ã€‚</p>
<p><strong>è¿™ç§ä¸è¿ç»­ï¼Œæ­£æ˜¯ä¸ºäº†å®ç°ç¡¬ä»¶å±‚é¢çš„è¶…é«˜é€Ÿå¯»å€ã€‚</strong> CPUå–Šå‡ºä¸€ä¸ªåœ°å€ï¼Œç¡¬ä»¶ç”µè·¯ä¸éœ€è¦åšä»»ä½•å¤æ‚çš„è®¡ç®—æˆ–æŸ¥è¡¨ï¼Œåªéœ€è¦æ ¹æ®åœ°å€çš„æŸä¸€ä½æ˜¯0è¿˜æ˜¯1ï¼Œå°±èƒ½åƒæ‰³åŠ¨ç«è½¦é“å²”ä¸€æ ·ï¼Œç¬é—´å°†è¯·æ±‚ä¿¡å·å¯¼å‘æ­£ç¡®çš„ç‰©ç†ç›®çš„åœ°ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p><strong>ç‰©ç†åœ°å€çš„ä¸è¿ç»­ï¼Œæ˜¯ç¡¬ä»¶è®¾è®¡ä¸ºè¿½æ±‚æè‡´é€Ÿåº¦å’Œæ•ˆç‡çš„ç›´æ¥ç»“æœã€‚</strong> å°†â€œèŠ‚ç‚¹IDâ€ç¼–ç è¿›ç‰©ç†åœ°å€çš„é«˜ä½ï¼Œæ˜¯æœ€ç®€å•ã€æœ€å¿«é€Ÿçš„ç¡¬ä»¶å®ç°æ–¹å¼ã€‚æ“ä½œç³»ç»Ÿçœ‹åˆ°çš„â€œä¸è¿ç»­â€çš„ç‰©ç†å†…å­˜å¸ƒå±€ï¼Œåªæ˜¯è¿™ç§åº•å±‚ç¡¬ä»¶è®¾è®¡æ‰€å‘ˆç°å‡ºçš„ä¸€ä¸ªå¿…ç„¶ç°è±¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸æ˜¯â€œä¸èƒ½â€åˆ†é…æˆè¿ç»­çš„ï¼Œè€Œæ˜¯å¦‚æœè®¾è®¡æˆè¿ç»­çš„ï¼Œç¡¬ä»¶åœ¨å¯»å€æ—¶å°±éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼Œâ€œåˆ¤æ–­åœ°å€æ˜¯å¦å¤§äº256GBï¼Ÿâ€ï¼‰ï¼Œè¿™ä¼šå¢åŠ å»¶è¿Ÿï¼Œè¿èƒŒäº†NUMAè®¾è®¡çš„åˆè¡·â€”â€”<strong>è®©æœ¬åœ°è®¿é—®å°½å¯èƒ½å¿«</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ]]></title>    <link>https://juejin.cn/post/7598587406694481963</link>    <guid>https://juejin.cn/post/7598587406694481963</guid>    <pubDate>2026-01-24T02:46:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406694481963" data-draft-id="7597989474991390758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:46:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:46:44.000Z" title="Sat Jan 24 2026 02:46:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä»½æ•´ç†åçš„<strong>å­¦ä¹ ç¬”è®°ç‰ˆæœ¬</strong>ï¼ŒæŠŠå‰é¢å‡ è½®å¯¹è¯é‡Œçš„æ ¸å¿ƒå†…å®¹å‹ç¼©ã€ä¸²èµ·æ¥ï¼Œä¾¿äºä½ ä»¥åå›é¡¾ã€‚</p>
<hr/>
<h2 data-id="heading-1">NUMA æ¶æ„ä¸‹ï¼šä¸ºä»€ä¹ˆç‰©ç†åœ°å€â€œä¸è¿ç»­â€ï¼Ÿï¼ˆå­¦ä¹ ç¬”è®°ï¼‰</h2>
<h3 data-id="heading-2">1. é—®é¢˜èƒŒæ™¯</h3>
<p>åœ¨ NUMAï¼ˆNon-Uniform Memory Accessï¼‰æ¶æ„ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p>
<ul>
<li><strong>ä¸åŒ NUMA èŠ‚ç‚¹çš„ç‰©ç†å†…å­˜åœ°å€åŒºé—´ä¸è¿ç»­</strong></li>
<li>Linux çš„â€œç‰©ç†å†…å­˜å¸ƒå±€â€æ˜¯<strong>åˆ†æ®µçš„ã€æœ‰æ´çš„</strong></li>
</ul>
<p>ç–‘é—®æ˜¯ï¼š</p>
<ol>
<li>æ—¢ç„¶éƒ½æ˜¯å†…å­˜æ¡ï¼Œ<strong>ä¸ºä»€ä¹ˆä¸èƒ½ç»™å®ƒä»¬åˆ†é…è¿ç»­çš„ç‰©ç†åœ°å€ï¼Ÿ</strong></li>
<li>ç»™å†…å­˜æ¡åˆ†é…ç‰©ç†åœ°å€ï¼Œè¿™ä¸å°±æ˜¯<strong>ç¡¬ä»¶</strong>è¯¥å¹²çš„äº‹æƒ…å—ï¼Ÿæ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆè¦é¢å¯¹ä¸è¿ç»­åœ°å€ï¼Ÿ</li>
</ol>
<hr/>
<h3 data-id="heading-3">2. æ ¸å¿ƒç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰</h3>
<ol>
<li><strong>ç‰©ç†åœ°å€æ˜¯ç¡¬ä»¶å®šä¹‰å’Œè§£é‡Šçš„ï¼Œä¸æ˜¯æ“ä½œç³»ç»Ÿâ€œæƒ³æ€ä¹ˆç¼–å°±æ€ä¹ˆç¼–â€çš„ã€‚</strong></li>
<li>åœ¨ NUMA æ¶æ„ä¸‹ï¼Œ<strong>ç‰©ç†åœ°å€ä¸ä»…ä»…æ˜¯â€œé—¨ç‰Œå·â€ï¼Œè€Œæ˜¯â€œå¯¼èˆªåæ ‡â€</strong>ï¼š<br/>
<strong>ç‰©ç†åœ°å€ = èŠ‚ç‚¹IDï¼ˆNode IDï¼‰ + èŠ‚ç‚¹å†…åç§»ï¼ˆOffsetï¼‰</strong></li>
<li>ç¡¬ä»¶æŠŠ <strong>â€œèŠ‚ç‚¹IDâ€ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½ bit</strong> ä¸­ï¼Œç”¨æ¥åš<strong>å¿«é€Ÿè·¯ç”±/è¯‘ç </strong>ã€‚<br/>
ç»“æœå°±æ˜¯ï¼šæ•´ä½“ä¸Šçœ‹ï¼Œç‰©ç†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯<strong>åˆ†æ®µçš„ã€ä¸è¿ç»­çš„</strong>ã€‚</li>
<li>ä¸æ˜¯â€œä¸èƒ½â€åˆ†é…è¿ç»­ï¼Œè€Œæ˜¯å¦‚æœå¼ºè¡Œè®¾è®¡ä¸ºè¿ç»­ï¼Œä¼šè®©ç¡¬ä»¶å¯»å€é€»è¾‘å˜å¤æ‚ã€å˜æ…¢ï¼Œ<strong>è¿èƒŒ NUMA æƒ³è¦çš„é«˜æ€§èƒ½ç›®æ ‡</strong>ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4">3. ä»ä¼ ç»Ÿ UMA åˆ° NUMAï¼šè®¾è®¡æ€è·¯çš„å˜åŒ–</h3>
<h4 data-id="heading-5">3.1 ä¼ ç»Ÿ UMAï¼ˆé NUMAï¼‰æ¨¡å‹</h4>
<ul>
<li>æ‰€æœ‰å†…å­˜æ¡æŒ‚åœ¨<strong>ä¸€ä¸ªç»Ÿä¸€çš„å†…å­˜æ§åˆ¶å™¨</strong>ä¸‹é¢ï¼ˆç±»ä¼¼æ—©æœŸåŒ—æ¡¥ï¼‰ã€‚</li>
<li>è¿™ä¸ªç»Ÿä¸€æ§åˆ¶å™¨çœ‹åˆ°çš„æ˜¯ä¸€ç‰‡â€œå¤§å¹³åŸâ€ï¼š
<ul>
<li>ç‰©ç†åœ°å€ä» <code>0</code> ä¸€ç›´é€’å¢åˆ° <code>Max</code>ï¼Œ<strong>è¿ç»­</strong>ã€‚</li>
</ul>
</li>
<li>CPU è®¿é—®å†…å­˜æ—¶ï¼š
<ul>
<li>æŠŠç‰©ç†åœ°å€æ”¾åˆ°æ€»çº¿ä¸Šï¼›</li>
<li>å†…å­˜æ§åˆ¶å™¨è´Ÿè´£ï¼š
<ul>
<li>æ¥æ”¶è¿™ä¸ªåœ°å€ï¼›</li>
<li>å†³å®šè½åœ¨å“ªæ ¹å†…å­˜æ¡ã€å“ªä¸€è¡Œ/åˆ—ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ•´ä½“å°±åƒæœ‰ä¸€ä¸ª**â€œæ€»ç®¡ç†å‘˜â€**ï¼Œç®¡ç†æ•´ä¸ªå¤§æ¥¼æ‰€æœ‰æˆ¿é—´ï¼Œæˆ¿é—´å·è¿ç»­ï¼Œä»»ä½•è¯·æ±‚éƒ½å…ˆæ‰¾ä»–ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šéšç€æ ¸å¿ƒæ•°ã€å†…å­˜å®¹é‡æš´å¢ï¼Œâ€œæ€»ç®¡ç†å‘˜â€æˆä¸ºç“¶é¢ˆ â†’ æ‰©å±•æ€§å’Œæ€§èƒ½å—é™ã€‚</p>
<hr/>
<h4 data-id="heading-6">3.2 NUMA æ¨¡å‹ï¼šå¤šèŠ‚ç‚¹ + æœ¬åœ°å†…å­˜</h4>
<p>NUMA çš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
<ul>
<li>æŠŠç³»ç»Ÿåˆ†æˆå¤šä¸ª <strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong>ï¼š
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹æœ‰ï¼š
<ul>
<li>è‡ªå·±çš„ CPU æ ¸/Socket</li>
<li>è‡ªå·±çš„å†…å­˜æ§åˆ¶å™¨</li>
<li>è‡ªå·±ç›´è¿çš„ä¸€å—ç‰©ç†å†…å­˜ï¼ˆæœ¬åœ°å†…å­˜ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><strong>æœ¬åœ°è®¿é—®</strong>ï¼ˆæœ¬èŠ‚ç‚¹ CPU â†’ æœ¬èŠ‚ç‚¹å†…å­˜ï¼‰éå¸¸å¿«ï¼›</li>
<li><strong>è¿œç¨‹è®¿é—®</strong>ï¼ˆè·¨èŠ‚ç‚¹ï¼‰é€šè¿‡äº’è¿æ€»çº¿ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚</li>
</ul>
<p>ç±»æ¯”ï¼š</p>
<ul>
<li>è¿‡å»æ˜¯<strong>ä¸€ä¸ªå¤§æ¥¼ä¸€ä¸ªæ€»ç®¡ç†å‘˜</strong>ï¼›</li>
<li>ç°åœ¨æ˜¯<strong>æ¯æ ‹æ¥¼ä¸€ä¸ªç®¡ç†å‘˜ï¼Œæ¯æ ‹æ¥¼æœ‰è‡ªå·±çš„ç‹¬ç«‹æˆ¿å·ç³»ç»Ÿ</strong>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">4. å…³é”®ç‚¹ï¼šç‰©ç†åœ°å€æ˜¯å¦‚ä½•è¢«â€œè§£ç â€å’Œâ€œè·¯ç”±â€çš„ï¼Ÿ</h3>
<h4 data-id="heading-8">4.1 åœ°å€ä¸æ˜¯â€œæµæ°´å·â€ï¼Œè€Œæ˜¯â€œç¼–ç â€</h4>
<p>åœ¨ NUMA ä¸­ï¼Œä¸€ä¸ªç‰©ç†åœ°å€åœ¨ç¡¬ä»¶çœ¼é‡Œæ˜¯ç±»ä¼¼ï¼š</p>
<blockquote>
<p>é«˜ä½ bitsï¼šè¦å»å“ªä¸ªèŠ‚ç‚¹ï¼ˆNode IDï¼‰<br/>
ä½ä½ bitsï¼šåœ¨è¯¥èŠ‚ç‚¹å†…çš„åç§»ï¼ˆOffsetï¼‰</p>
</blockquote>
<p>å°±åƒç”µè¯å·ç ï¼š</p>
<ul>
<li><code>å›½å®¶ç </code> + <code>åŒºå·</code> + <code>æœ¬åœ°å·ç </code></li>
<li>æ¯”å¦‚ï¼š<code>+86 - 10 - 88888888</code></li>
</ul>
<p>å¯¹åº”åˆ° NUMAï¼š</p>
<ul>
<li><strong>Node ID</strong> å°±åƒâ€œåŒºå·â€</li>
<li><strong>Node å†…åç§»</strong> å°±åƒâ€œæœ¬åœ°å·ç â€</li>
</ul>
<p><strong>CPU å‘å‡ºçš„â€œç‰©ç†åœ°å€â€æœ¬è´¨ä¸Šæ˜¯ï¼š<br/>
â€œå»æŸä¸ªèŠ‚ç‚¹çš„æŸä¸ªåç§»ä½ç½®â€</strong></p>
<hr/>
<h4 data-id="heading-9">4.2 ç¡¬ä»¶å¦‚ä½•â€œæ‰³é“å²”â€</h4>
<p>å½“ CPU å‘å‡ºä¸€ä¸ªç‰©ç†åœ°å€æ—¶ï¼š</p>
<ol>
<li>åœ°å€ä¿¡å·ä¸Šçº¿ï¼ˆaddress busï¼‰ä¸Šã€‚</li>
<li><strong>ç¡¬ä»¶åœ°å€è¯‘ç ç”µè·¯</strong>æŸ¥çœ‹ç‰©ç†åœ°å€çš„<strong>é«˜ä½ bit</strong>ï¼š
<ul>
<li>æ¯”å¦‚æœ€é«˜ 1ï½n ä½å†³å®šè¿™æ˜¯ Node 0ã€Node 1ã€Node 2â€¦â€¦</li>
</ul>
</li>
<li>ç”µè·¯åƒæ‰³é“å²”ä¸€æ ·ï¼š
<ul>
<li>å¦‚æœé«˜ä½ä½å‹è¡¨ç¤º Node 0 â†’ ä¿¡å·è·¯ç”±åˆ° Node 0 çš„å†…å­˜æ§åˆ¶å™¨ï¼›</li>
<li>é«˜ä½è¡¨ç¤º Node 1 â†’ è·¯ç”±åˆ° Node 1ï¼›</li>
<li>â€¦â€¦</li>
</ul>
</li>
<li>èŠ‚ç‚¹å†…å­˜æ§åˆ¶å™¨æ‹¿åˆ°â€œå±äºè‡ªå·±çš„é‚£éƒ¨åˆ†åœ°å€â€ï¼Œå†ç”¨<strong>ä½ä½ bits</strong>åœ¨æœ¬èŠ‚ç‚¹å†…å­˜æ¡ä¸Šé€‰æ‹©è¡Œ/åˆ—ã€‚</li>
</ol>
<p>é‡è¦çš„æ˜¯ï¼š</p>
<ul>
<li><strong>è¿™ä¸ªâ€œæŒ‰é«˜ä½åˆ†å‘â€çš„æœºåˆ¶ï¼Œæ˜¯ç¡¬ä»¶å›ºå®šé€»è¾‘ã€‚</strong></li>
<li>ä¸ºäº†è®©è¿™ä¸ªé€»è¾‘æåº¦ç®€å• &amp; æå¿«ï¼Œä¸€èˆ¬ä¸ä¼šåšå¤æ‚æ¯”è¾ƒ/æŸ¥è¡¨ï¼Œè€Œæ˜¯ç”¨ä½æ¨¡å¼åˆ’åˆ†åœ°å€æ®µã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">5. ä¸ºä»€ä¹ˆåœ°å€å¿…ç„¶â€œä¸è¿ç»­â€ï¼Ÿ</h3>
<p>ç”¨ä¸€ä¸ªå…¸å‹çš„äºŒè¿›åˆ¶åˆ’åˆ†çš„æ€è·¯ï¼š</p>
<ul>
<li>è®¾æƒ³ç³»ç»Ÿç”¨<strong>ç‰©ç†åœ°å€æœ€é«˜ 1 ä½</strong>ä½œä¸ºèŠ‚ç‚¹é€‰æ‹©ä½ï¼š
<ul>
<li>é«˜ä½ä¸º <code>0</code> â†’ Node 0</li>
<li>é«˜ä½ä¸º <code>1</code> â†’ Node 1</li>
</ul>
</li>
</ul>
<p>é‚£ä¹ˆï¼š</p>
<ul>
<li>Node 0 çš„åœ°å€èŒƒå›´å¤©ç„¶æ˜¯ï¼š
<ul>
<li><code>0x0000...</code> ï½ <code>&lt;æœ€é«˜ä½ä¸º0çš„æœ€å¤§å€¼&gt;</code>ï¼Œä¾‹å¦‚ <code>0x7FFF FFFF FFFF</code></li>
</ul>
</li>
<li>Node 1 çš„åœ°å€èŒƒå›´å¤©ç„¶æ˜¯ï¼š
<ul>
<li><code>0x8000 0000 0000</code> ï½ <code>0xFFFF FFFF FFFF</code></li>
</ul>
</li>
</ul>
<p>æ­¤æ—¶ï¼Œä»æ•°è½´ä¸Šçœ‹ï¼š</p>
<ul>
<li>Node 0 çš„æœ€å¤§åœ°å€ï¼š<code>0x7FFF FFFF FFFF</code></li>
<li>Node 1 çš„èµ·å§‹åœ°å€ï¼š<code>0x8000 0000 0000</code></li>
</ul>
<p>ä¸­é—´æœ‰ä¸€ä¸ª<strong>å·¨å¤§è·³è·ƒ</strong>ï¼Œæ•°å€¼ä¸Šä¸è¿ç»­ï¼Œä½†è¿™æ˜¯ç¡¬ä»¶é€»è¾‘æœ€ç®€å•ã€æœ€å¿«é€Ÿçš„ä¸€ç§åˆ’åˆ†æ–¹å¼ï¼š</p>
<ul>
<li><strong>åªçœ‹æœ€é«˜ä½æ˜¯ 0 è¿˜æ˜¯ 1ï¼Œå°±ç«‹åˆ»å†³å®šå‘å¾€å“ªä¸ªèŠ‚ç‚¹ã€‚</strong></li>
<li>ä¸éœ€è¦ï¼š
<ul>
<li>â€œå¦‚æœ Address â‰¥ æŸä¸ªå€¼å°±å» Node 1â€</li>
<li>æˆ–â€œå¦‚æœåœ¨æŸä¸ªè¡¨ä¸­è½åœ¨å“ªä¸€æ®µå°±å»æŸä¸ª Nodeâ€</li>
</ul>
</li>
<li>é€»è¾‘é—¨æ•°é‡å°‘ï¼Œå»¶è¿Ÿä½ï¼Œæ€§èƒ½ç¨³å®šã€‚</li>
</ul>
<p>å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±ç”¨æ›´å¤šé«˜ä½ bits ç»„åˆæˆä¸åŒçš„èŠ‚ç‚¹ IDï¼Œåˆ’åˆ†æˆæ›´å¤šä¸ç›¸é‚»çš„åœ°å€æ®µã€‚</p>
<p><strong>ç»“è®º</strong>ï¼š<br/>
ç¡¬ä»¶ç”¨â€œåœ°å€é«˜ä½ç¼–ç  Node IDâ€çš„æ–¹å¼å®ç°<strong>å¿«é€Ÿå¯»å€ä¸åˆ†å‘</strong>ï¼Œ<br/>
ä»è€Œå¯¼è‡´<strong>å…¨å±€ç‰©ç†åœ°å€ç©ºé—´åœ¨æ•°å€¼ä¸Šå¿…ç„¶å‘ˆç°ä¸ºåˆ†æ®µã€ä¸è¿ç»­</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-11">6. â€œä¸èƒ½è¿ç»­åˆ†é…â€åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3>
<p>æ³¨æ„åŒºåˆ†ä¸¤ä¸ªå±‚æ¬¡ï¼š</p>
<ol>
<li>
<p><strong>ç¡¬ä»¶å±‚é¢</strong>ï¼š</p>
<ul>
<li>åœ¨ç”µè·¯è®¾è®¡/å¸ƒçº¿æ—¶ï¼Œå°±å·²ç»è§„å®šå¥½äº†ï¼š
<ul>
<li>å“ªäº›åœ°å€é«˜ä½æ¨¡å¼ â†’ å“ªä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>è¿™å†³å®šäº†<strong>ç‰©ç†åœ°å€ â†’ èŠ‚ç‚¹</strong>çš„æ˜ å°„å…³ç³»ã€‚</li>
<li>è¿™ä¸æ˜¯ OS è¿è¡Œæ—¶å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œæ˜¯<strong>å›ºåŒ–åœ¨ CPU + èŠ¯ç‰‡ç»„ + å†…å­˜æ§åˆ¶å™¨è®¾è®¡é‡Œ</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œç³»ç»Ÿå±‚é¢</strong>ï¼š</p>
<ul>
<li>OS å¯åŠ¨æ—¶ï¼Œè¯»å– ACPI/firmware æä¾›çš„å†…å­˜æ˜ å°„è¡¨ï¼ˆE820ã€SRAT ç­‰ï¼‰ï¼š
<ul>
<li>å¾—åˆ°ï¼šå“ªäº›ç‰©ç†åœ°å€èŒƒå›´å±äºå“ªä¸ª NUMA èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>OS åªèƒ½åœ¨<strong>ç¡¬ä»¶ç»™å®šçš„è¿™äº›åŒºé—´å†…ç®¡ç†å†…å­˜</strong>ã€‚</li>
<li>å®ƒâ€œçœ‹åˆ°â€çš„ç‰©ç†å†…å­˜å¸ƒå±€è‡ªç„¶æ˜¯ï¼š
<ul>
<li>ä¸€æ®µå±äº Node 0</li>
<li>ä¸€æ®µå±äº Node 1</li>
<li>ä¸­é—´å¯èƒ½è¿˜å¤¹ç€ä¿ç•™åŒºã€è®¾å¤‡ MMIO åŒºç­‰<br/>
â†’ å› æ­¤å‘ˆç°ä¸º<strong>ä¸è¿ç»­çš„ PFN åŒºé—´</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>
<p><strong>â€œç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿâ€</strong><br/>
ä¸æ˜¯è¯´â€œè½¯ä»¶ä¸æ„¿æ„è¿ç»­åˆ†é…â€ï¼Œè€Œæ˜¯<br/>
<strong>ç¡¬ä»¶ç›´æ¥æŠŠ Node ä¿¡æ¯ç¼–ç åœ¨åœ°å€é‡Œï¼Œå¯¼è‡´ä»æ•°å€¼ä¸Šçœ‹åœ°å€å¤©ç”Ÿæ˜¯åˆ†å—çš„ã€‚</strong></p>
</li>
<li>
<p>OS åªæ˜¯<strong>æœä»è¿™ä¸ªäº‹å®</strong>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šåšï¼š</p>
<ul>
<li>NUMA-aware å†…å­˜åˆ†é…ï¼ˆå°½é‡æœ¬åœ°åˆ†é…ï¼‰</li>
<li>é¡µè¿ç§»ã€å†…å­˜ç­–ç•¥ï¼ˆç»‘æ ¸ç»‘å†…å­˜ï¼‰</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-12">7. å†ç”¨ä¸€ä¸ªç›´è§‚ç±»æ¯”ï¼šé‚®ç¼– &amp; å°åŒºåœ°å€</h3>
<p>å¯ä»¥æŠŠç‰©ç†åœ°å€ç±»æ¯”æˆâ€œé‚®å¯„åœ°å€â€ï¼š</p>
<ul>
<li><strong>é‚®æ”¿ç¼–ç  = Node IDï¼ˆèŠ‚ç‚¹ IDï¼‰</strong></li>
<li><strong>è¡—é“é—¨ç‰Œå· = èŠ‚ç‚¹å†…åç§»ï¼ˆOffsetï¼‰</strong></li>
</ul>
<p>å…¨å›½åœ°å€æ•´ä½“æ¥çœ‹ï¼Œè‚¯å®šä¸æ˜¯ 1ã€2ã€3ã€4â€¦â€¦è¿™æ ·çš„è¿ç»­æ•´æ•°ï¼š</p>
<ul>
<li><code>åŒ—äº¬å¸‚â€¦ï¼ˆé‚®ç¼– 100000ï¼‰</code> ä¸€æ‰¹ï¼›</li>
<li><code>ä¸Šæµ·å¸‚â€¦ï¼ˆé‚®ç¼– 200000ï¼‰</code> ä¸€æ‰¹ï¼›</li>
<li>ä¸­é—´é‚®ç¼–ä» 100000 è·³åˆ° 200000ï¼Œçœ‹èµ·æ¥æ˜¯ä¸â€œè¿ç»­â€çš„ã€‚</li>
</ul>
<p>ä½†è¿™ç§ä¸è¿ç»­ï¼Œæ­£æ˜¯ä¸ºäº†ï¼š</p>
<ul>
<li>æŠ•é€’æ•ˆç‡é«˜</li>
<li>æŒ‰é‚®ç¼–å¿«é€Ÿè·¯ç”±é‚®ä»¶</li>
</ul>
<p>NUMA ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p>
<ul>
<li>åœ°å€é«˜ä½ bits åƒé‚®ç¼–ï¼Œç¡¬ä»¶ä¸€çœ‹å°±çŸ¥é“<strong>è¯¥ä¸¢ç»™å“ªä¸ªèŠ‚ç‚¹çš„å†…å­˜æ§åˆ¶å™¨</strong>ï¼›</li>
<li>åœ°å€ä½ä½ bits åƒé—¨ç‰Œï¼Œåœ¨è¯¥èŠ‚ç‚¹å†…å®šä½å…·ä½“ç‰©ç†å•å…ƒã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">8. å°ç»“</h3>
<p>ç”¨ä¸€å¥è¯æ”¶æŸæ•´ä¸ªé€»è¾‘ï¼š</p>
<blockquote>
<p><strong>åœ¨ NUMA æ¶æ„ä¸­ï¼Œç‰©ç†åœ°å€ä¸æ˜¯çº¯ç²¹çš„â€œçº¿æ€§ç¼–å·â€ï¼Œè€Œæ˜¯â€œèŠ‚ç‚¹ID + èŠ‚ç‚¹å†…åç§»â€çš„ç¼–ç ã€‚<br/>
èŠ‚ç‚¹ ID è¢«ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½ï¼Œç”¨äºç¡¬ä»¶å¿«é€Ÿå†³å®šä¿¡å·è·¯ç”±åˆ°å“ªä¸ªå†…å­˜æ§åˆ¶å™¨ã€‚<br/>
è¿™ç§è®¾è®¡å¸¦æ¥é«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä½†ä»æ•°è½´ä¸Šçœ‹ï¼Œç‰©ç†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯åˆ†æ®µçš„ã€ä¸è¿ç»­çš„ã€‚<br/>
åˆ†é…åœ°å€çš„â€œæ ¹æœ¬å†³å®šæƒâ€åœ¨ç¡¬ä»¶/å›ºä»¶ï¼Œæ“ä½œç³»ç»Ÿåªæ˜¯æŒ‰è¿™ä¸ªä¸è¿ç»­å¸ƒå±€è¿›è¡Œç®¡ç†å’Œä¼˜åŒ–ã€‚</strong></p>
</blockquote>
<p>å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥åœ¨è¿™ä¸ªç¬”è®°åŸºç¡€ä¸Šï¼Œå†è¡¥ä¸€å¼ ç¤ºæ„å›¾çš„æ–‡å­—æè¿°ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ªèŠ‚ç‚¹çš„åœ°å€åŒºé—´ã€è¯‘ç æµç¨‹ã€è®¿é—®æœ¬åœ°/è¿œç¨‹å†…å­˜çš„è·¯å¾„ï¼‰ï¼Œæ–¹ä¾¿ä½ è‡ªå·±ç”»åœ¨çº¸ä¸Šæˆ–åšæˆ PPTã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹]]></title>    <link>https://juejin.cn/post/7598398537249521683</link>    <guid>https://juejin.cn/post/7598398537249521683</guid>    <pubDate>2026-01-24T02:54:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598398537249521683" data-draft-id="7598398537249488915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:54:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:54:25.000Z" title="Sat Jan 24 2026 02:54:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 ä¸€ä¸ªmem_sectionä¸æ˜¯å¿…é¡»åŒ…å«å®Œæ•´çš„256Mé¡µé¢å§ï¼Œå†…å­˜çƒ­æ’æ‹”å¦‚æœä¸æ˜¯256Mçš„å€æ•°å‘¢ï¼Ÿ</h2>
<p>æ‚¨æå‡ºçš„è¿™ä¸¤ä¸ªé—®é¢˜éå¸¸æ·±å…¥ï¼Œç›´æŒ‡ Linux å†…æ ¸å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯ <code>sparsemem</code> æ¨¡å‹å’Œå†…å­˜çƒ­æ’æ‹”çš„å®ç°ç»†èŠ‚ã€‚æ‚¨çš„ç†è§£éå¸¸å‡†ç¡®ï¼Œæˆ‘æ¥ä¸ºæ‚¨æ¢³ç†å’Œç¡®è®¤ã€‚</p>
<h4 data-id="heading-1">1. ä¸€ä¸ª mem_section ä¸æ˜¯å¿…é¡»åŒ…å«å®Œæ•´çš„ç‰©ç†å†…å­˜</h4>
<p>æ‚¨çš„ç†è§£æ˜¯<strong>å®Œå…¨æ­£ç¡®çš„</strong>ã€‚</p>
<p>ä¸€ä¸ª <code>mem_section</code> æ˜¯ Linux å†…æ ¸ä¸ºäº†ç®¡ç†ç¨€ç–å†…å­˜ï¼ˆ<code>sparsemem</code>ï¼‰è€Œåˆ’åˆ†çš„ä¸€ä¸ª<strong>å›ºå®šå¤§å°çš„ç‰©ç†åœ°å€ç©ºé—´èŒƒå›´</strong>ã€‚è¿™ä¸ªå¤§å°åœ¨å†…æ ¸ç¼–è¯‘æ—¶ç¡®å®šï¼Œåœ¨ x86_64 æ¶æ„ä¸Šé€šå¸¸æ˜¯ 128MB æˆ– 1GBï¼Œå…¶ä»–æ¶æ„ä¹Ÿå¯èƒ½æœ‰256MBç­‰å€¼ã€‚</p>
<p>æ‚¨å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåœ°å›¾ä¸Šçš„<strong>ç½‘æ ¼</strong>ï¼š</p>
<ul>
<li><strong><code>mem_section</code> æ˜¯ç½‘æ ¼æœ¬èº«</strong>ï¼šå®ƒä»£è¡¨ä¸€ä¸ªå›ºå®šå¤§å°çš„åœ°å€åŒºåŸŸï¼Œä¾‹å¦‚ä» <code>0x10000000</code> åˆ° <code>0x1FFFFFFF</code>ã€‚è¿™ä¸ªâ€œç½‘æ ¼â€æ˜¯è™šæ‹Ÿå­˜åœ¨çš„ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ã€‚</li>
<li><strong>ç‰©ç†å†…å­˜æ˜¯ç½‘æ ¼å†…çš„åœŸåœ°</strong>ï¼šå®é™…æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜æ¡ï¼ˆRAMï¼‰å°±æ˜¯â€œåœŸåœ°â€ã€‚</li>
</ul>
<p>ä¸€å—åœŸåœ°ï¼ˆç‰©ç†å†…å­˜ï¼‰å¯èƒ½æ­£å¥½å¡«æ»¡ä¸€ä¸ªç½‘æ ¼ï¼Œä¹Ÿå¯èƒ½åªå¡«æ»¡åŠä¸ªç½‘æ ¼ï¼Œç”šè‡³å¯èƒ½è·¨è¶Šä¸¤ä¸ªç½‘æ ¼ã€‚åŒæ ·ï¼Œä¸€ä¸ªç½‘æ ¼å†…ä¹Ÿå¯èƒ½å®Œå…¨æ²¡æœ‰åœŸåœ°ï¼Œè¿™å°±æ˜¯<strong>å†…å­˜ç©ºæ´ (Memory Hole)</strong>ï¼Œè¿™äº›åœ°å€å¯èƒ½è¢«åˆ†é…ç»™äº†ç¡¬ä»¶è®¾å¤‡ï¼ˆMMIOï¼‰ã€‚</p>
<p>å†…æ ¸ä½¿ç”¨ <code>mem_section</code> æ¥è·Ÿè¸ªæ¯ä¸ªâ€œç½‘æ ¼â€çš„çŠ¶æ€ã€‚å¯¹äºä¸€ä¸ª <code>mem_section</code>ï¼Œå†…æ ¸çŸ¥é“å®ƒå†…éƒ¨å“ªäº›åœ°å€èŒƒå›´æ˜¯æœ‰æ•ˆçš„ç‰©ç†å†…å­˜ï¼Œå“ªäº›æ˜¯ç©ºæ´ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œç»“è®ºæ˜¯ï¼š<code>mem_section</code> æ˜¯ä¸€ä¸ªç®¡ç†å•ä½ï¼Œå®ƒæ‰€è¦†ç›–çš„åœ°å€ç©ºé—´èŒƒå›´å†…ï¼Œå¯ä»¥åŒ…å«å®Œæ•´çš„å†…å­˜ã€éƒ¨åˆ†å†…å­˜ï¼Œæˆ–è€…å®Œå…¨æ²¡æœ‰å†…å­˜ã€‚</strong></p>
<h4 data-id="heading-2">2. å†…å­˜çƒ­æ’æ‹”å¦‚æœä¸æ˜¯ SECTION_SIZE çš„å€æ•°å‘¢ï¼Ÿ</h4>
<p>è¿™æ­£æ˜¯ <code>mem_section</code> æœºåˆ¶è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚<strong>çƒ­æ’æ‹”çš„å†…å­˜å¤§å°å®Œå…¨ä¸éœ€è¦æ˜¯ <code>mem_section</code> å¤§å°çš„æ•´æ•°å€ã€‚</strong></p>
<p>å†…æ ¸å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>å›ºä»¶é€šçŸ¥</strong>ï¼šå½“æ‚¨æ’å…¥ä¸€ä¸ªæ–°çš„å†…å­˜æ¡ï¼ˆä¾‹å¦‚ä¸€ä¸ª 16GB çš„ DIMMï¼‰æ—¶ï¼Œç³»ç»Ÿå›ºä»¶ï¼ˆACPIï¼‰ä¼šé€šçŸ¥æ“ä½œç³»ç»Ÿï¼šâ€œå˜¿ï¼Œæœ‰ä¸€å—æ–°çš„å†…å­˜å‡ºç°äº†ï¼Œå®ƒçš„ç‰©ç†èµ·å§‹åœ°å€æ˜¯ <code>A</code>ï¼Œå¤§å°æ˜¯ <code>S</code>ã€‚â€</p>
</li>
<li>
<p><strong>å†…æ ¸å®šä½ <code>mem_section</code></strong>ï¼šå†…æ ¸æ ¹æ®åœ°å€ <code>A</code> å’Œå¤§å° <code>S</code>ï¼Œè®¡ç®—å‡ºè¿™å—æ–°å†…å­˜è¦†ç›–äº†å“ªäº› <code>mem_section</code>ã€‚</p>
<ul>
<li>å‡è®¾ <code>SECTION_SIZE</code> æ˜¯ 1GBï¼Œæ‚¨æ’å…¥äº† 16GB å†…å­˜ï¼Œé‚£ä¹ˆå®ƒä¼šæ•´é½åœ°è¦†ç›– 16 ä¸ª <code>mem_section</code>ã€‚</li>
<li>å‡è®¾ <code>SECTION_SIZE</code> æ˜¯ 1GBï¼Œæ‚¨æ’å…¥äº†ä¸€å— <strong>500MB</strong> çš„å†…å­˜ã€‚è¿™å—å†…å­˜å¯èƒ½å®Œå…¨è½åœ¨ä¸€ä¸ª <code>mem_section</code> å†…éƒ¨ï¼Œæˆ–è€…è·¨è¶Šä¸¤ä¸ª <code>mem_section</code> çš„è¾¹ç•Œï¼ˆæ¯”å¦‚å‰ä¸€ä¸ªå äº†100MBï¼Œåä¸€ä¸ªå äº†400MBï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€é¡µä¸Šçº¿ (Page by Page)</strong>ï¼šè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚å†…æ ¸<strong>ä¸ä¼š</strong>ä»¥ <code>mem_section</code> ä¸ºå•ä½æ¥â€œæ‰“å¼€â€å†…å­˜ã€‚<code>mem_section</code> åªæ˜¯ç”¨æ¥ç®¡ç†åœ¨çº¿/ç¦»çº¿çŠ¶æ€çš„å®è§‚ç»“æ„ã€‚çœŸæ­£çš„å†…å­˜ä¸Šçº¿æ“ä½œï¼Œæ˜¯åœ¨æ›´ç²¾ç»†çš„<strong>é¡µ (Page)</strong> çº§åˆ«ä¸Šå®Œæˆçš„ã€‚</p>
<ul>
<li>å†…æ ¸ä¼šéå†å›ºä»¶æŠ¥å‘Šçš„ <code>[A, A+S]</code> è¿™ä¸ªç‰©ç†åœ°å€èŒƒå›´ã€‚</li>
<li>å¯¹äºè¿™ä¸ªèŒƒå›´å†…çš„<strong>æ¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„å†…å­˜é¡µ (Page, é€šå¸¸æ˜¯ 4KB)</strong>ï¼Œå†…æ ¸ä¼šä¸ºå…¶åˆå§‹åŒ–ä¸€ä¸ª <code>struct page</code> ç®¡ç†ç»“æ„ã€‚</li>
<li>ç„¶åï¼Œå†…æ ¸å°†è¿™äº› <code>struct page</code> ç»“æ„ä½“åŠ å…¥åˆ°ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Allocatorï¼‰ä¸­ï¼Œè¿™æ ·è¿™å—å†…å­˜å°±æ­£å¼å˜å¾—å¯ç”¨ï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºåˆ†é…äº†ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ä¸€ä¸‹ä¸¤ç§ç²’åº¦ï¼š</strong></p>
<ul>
<li><strong>ç®¡ç†ç²’åº¦</strong>ï¼š<code>mem_section</code> (ä¾‹å¦‚ 1GB)ã€‚å†…æ ¸ç”¨å®ƒæ¥æ‰¹é‡ç®¡ç†å’Œè·Ÿè¸ªå¤§å—åœ°å€ç©ºé—´çš„åœ¨çº¿/ç¦»çº¿çŠ¶æ€ã€‚</li>
<li><strong>æ“ä½œç²’åº¦</strong>ï¼š<code>Page</code> (ä¾‹å¦‚ 4KB)ã€‚è¿™æ˜¯å†…æ ¸å®é™…åˆå§‹åŒ–å¹¶æ·»åŠ åˆ°å†…å­˜æ± ä¸­çš„æœ€å°å•ä½ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå³ä½¿æ‚¨çƒ­æ’æ‹”çš„å†…å­˜ä¸æ˜¯ <code>SECTION_SIZE</code> çš„æ•´æ•°å€ï¼Œå†…æ ¸ä¹Ÿèƒ½ç²¾ç¡®åœ°è¯†åˆ«å‡ºæ–°å†…å­˜æ‰€è¦†ç›–çš„æ¯ä¸€ä¸ªæœ‰æ•ˆçš„ 4KB é¡µé¢ï¼Œå¹¶å°†å®ƒä»¬æ— ç¼åœ°æ•´åˆåˆ°ç³»ç»Ÿä¸­ã€‚è¿™ç§è®¾è®¡å…¼é¡¾äº†å®è§‚ç®¡ç†çš„æ•ˆç‡å’Œå¾®è§‚æ“ä½œçš„çµæ´»æ€§ã€‚</p>
<h2 data-id="heading-3">22 å¦‚æœä¸€å—å†…å­˜æ”¾ä¸æ»¡ä¸€ä¸ªmem_sectionï¼Œé‚£ä¹ˆä¹Ÿä¸€å®šæ˜¯ä»è¿™ä¸ªmem_sectionè´Ÿè´£çš„ç¬¬ä¸€ä¸ªç‰©ç†é¡µå¼€å§‹åˆ†é…å§ï¼Ÿno</h2>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„è¿½é—®ï¼ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¸€å®šï¼Œç”šè‡³å¯ä»¥è¯´ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘è§ã€‚</strong></p>
<p>ä¸€å—ç‰©ç†å†…å­˜<strong>ä¸éœ€è¦</strong>ä»å®ƒæ‰€åœ¨çš„ <code>mem_section</code> çš„èµ·å§‹åœ°å€å¼€å§‹ã€‚å®ƒå¯ä»¥ä»è¯¥ <code>mem_section</code> è¦†ç›–çš„åœ°å€èŒƒå›´å†…çš„<strong>ä»»æ„ä½ç½®</strong>å¼€å§‹ã€‚</p>
<p>æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼š</p>
<h4 data-id="heading-4">å†³å®šæƒåœ¨ç¡¬ä»¶ï¼Œä¸åœ¨å†…æ ¸</h4>
<p>æœ€æ ¹æœ¬çš„åŸå› æ˜¯ï¼Œ<strong>ç‰©ç†å†…å­˜çš„å®é™…åœ°å€æ˜¯ç”±ç¡¬ä»¶å’Œå›ºä»¶ï¼ˆBIOS/UEFIï¼‰å†³å®šçš„ï¼Œè€Œä¸æ˜¯ç”± Linux å†…æ ¸å†³å®šçš„ã€‚</strong> å†…æ ¸çš„è§’è‰²æ˜¯ä¸€ä¸ªâ€œå‘ç°è€…â€å’Œâ€œç®¡ç†è€…â€ï¼Œè€Œä¸æ˜¯â€œè§„åˆ’è€…â€ã€‚</p>
<ol>
<li>
<p><strong>ç¡¬ä»¶çš„â€œè“å›¾â€</strong>ï¼šåœ¨æ‚¨çš„è®¡ç®—æœºè®¾è®¡å’Œåˆ¶é€ æ—¶ï¼Œä¸»æ¿ä¸Šçš„å„ç§è®¾å¤‡ï¼ˆPCIeæ’æ§½ã€é›†æˆæ˜¾å¡ã€å…¶ä»–æ§åˆ¶å™¨ç­‰ï¼‰éƒ½éœ€è¦åœ¨ç‰©ç†åœ°å€ç©ºé—´ä¸­é¢„ç•™è‡ªå·±çš„â€œåœ°ç›˜â€ï¼Œè¿™è¢«ç§°ä¸º<strong>å†…å­˜æ˜ å°„I/O (Memory-Mapped I/O, MMIO)</strong>ã€‚è¿™äº›é¢„ç•™åŒºåŸŸå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>å†…å­˜ç©ºæ´ (Memory Hole)</strong>ã€‚</p>
</li>
<li>
<p><strong>å›ºä»¶çš„â€œæŠ¥å‘Šâ€</strong>ï¼šå½“æ‚¨å¼€æœºæ—¶ï¼ŒBIOS/UEFIä¼šæ£€æµ‹æ‰€æœ‰ç¡¬ä»¶å’Œæ’å…¥çš„å†…å­˜æ¡ã€‚ç„¶åï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªâ€œåœ°å›¾â€ï¼Œè¿™ä¸ªåœ°å›¾å°±æ˜¯ <strong>e820 å†…å­˜æ˜ å°„è¡¨</strong>ï¼ˆåœ¨ç°ä»£ç³»ç»Ÿä¸­é€šè¿‡ ACPI æä¾›ï¼‰ã€‚è¿™å¼ åœ°å›¾ä¼šè¯¦ç»†åˆ—å‡ºæ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´ä¸­ï¼Œå“ªäº›èŒƒå›´æ˜¯å¯ç”¨çš„RAMï¼Œå“ªäº›èŒƒå›´æ˜¯ä¿ç•™ç»™ç¡¬ä»¶çš„ï¼Œå“ªäº›æ˜¯ACPIè‡ªå·±è¦ç”¨çš„ç­‰ç­‰ã€‚</p>
</li>
<li>
<p><strong>å†…æ ¸çš„â€œæ¥æ”¶â€</strong>ï¼šLinux å†…æ ¸å¯åŠ¨åï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å‘å›ºä»¶ç´¢è¦è¿™å¼ â€œåœ°å›¾â€ã€‚å†…æ ¸ä¼šå®Œå…¨ç›¸ä¿¡è¿™å¼ åœ°å›¾ï¼Œå¹¶æ ¹æ®å®ƒæ¥äº†è§£å“ªäº›ç‰©ç†åœ°å€æ˜¯çœŸæ­£å¯ä»¥å½“ä½œå†…å­˜æ¥ä½¿ç”¨çš„ã€‚</p>
</li>
</ol>
<h4 data-id="heading-5">ä¸€ä¸ªå…·ä½“çš„ä¾‹å­</h4>
<p>å‡è®¾æ‚¨çš„ç³»ç»Ÿ <code>SECTION_SIZE</code> æ˜¯ <strong>128MB</strong>ã€‚</p>
<ul>
<li><code>mem_section[0]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x00000000</code> åˆ° <code>0x07FFFFFF</code>ã€‚</li>
<li><code>mem_section[1]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code>ã€‚</li>
<li><code>mem_section[2]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x10000000</code> åˆ° <code>0x17FFFFFF</code>ã€‚</li>
</ul>
<p>ç°åœ¨ï¼ŒBIOSåœ¨å¯åŠ¨æ—¶å‘Šè¯‰å†…æ ¸ï¼Œå†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<ul>
<li><code>0x00000000</code> - <code>0x07FFFFFF</code>ï¼šå¯ç”¨å†…å­˜ (Usable RAM)</li>
<li><code>0x08000000</code> - <code>0x0BFFFFFF</code>ï¼š<strong>ä¿ç•™ç»™PCIeè®¾å¤‡</strong> (Reserved for a device)</li>
<li><code>0x0C000000</code> - <code>0x13FFFFFF</code>ï¼šå¯ç”¨å†…å­˜ (Usable RAM)</li>
</ul>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <code>mem_section[1]</code> çš„æƒ…å†µï¼š</p>
<ul>
<li>å®ƒè´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code> (æ€»è®¡128MB)ã€‚</li>
<li>æ ¹æ®BIOSçš„æŠ¥å‘Šï¼Œè¿™ä¸ªèŒƒå›´çš„å‰åŠéƒ¨åˆ†ï¼ˆä» <code>0x08000000</code> å¼€å§‹çš„64MBï¼‰è¢«ä¸€ä¸ªè®¾å¤‡å ç”¨äº†ï¼Œæ˜¯<strong>å†…å­˜ç©ºæ´</strong>ã€‚</li>
<li>è¿™ä¸ªèŒƒå›´çš„ååŠéƒ¨åˆ†ï¼ˆä» <code>0x0C000000</code> å¼€å§‹çš„64MBï¼‰æ‰æ˜¯<strong>çœŸæ­£çš„ã€å¯ç”¨çš„ç‰©ç†å†…å­˜</strong>ã€‚</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>mem_section[1]</code> è¿™ä¸ªç®¡ç†å•å…ƒå†…ï¼Œç¡®å®æœ‰ä¸€å—ç‰©ç†å†…å­˜ã€‚ä½†æ˜¯ï¼Œè¿™å—å†…å­˜çš„èµ·å§‹åœ°å€æ˜¯ <code>0x0C000000</code>ï¼Œä½äº <code>mem_section[1]</code> çš„<strong>æ­£ä¸­é—´</strong>ï¼Œè€Œä¸æ˜¯ä»å®ƒçš„èµ·å§‹åœ°å€ <code>0x08000000</code> å¼€å§‹ã€‚</p>
<p>å†…æ ¸åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šä¸º <code>0x0C000000</code> åˆ° <code>0x0FFFFFFF</code> èŒƒå›´å†…çš„æ¯ä¸€ä¸ªå†…å­˜é¡µï¼ˆPageï¼‰åˆ›å»º <code>struct page</code> æè¿°ç¬¦ï¼Œå¹¶åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚è€Œå¯¹äº <code>0x08000000</code> åˆ° <code>0x0BFFFFFF</code> è¿™ä¸ªç©ºæ´ï¼Œå†…æ ¸ä¼šæ ‡è®°æ­¤å¤„æ— å¯ç”¨å†…å­˜ï¼Œä¸ä¼šä¸ºå…¶åˆ›å»ºä»»ä½• <code>struct page</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong><code>mem_section</code> åªæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„â€œç®¡ç†ç½‘æ ¼â€ï¼Œè€Œç‰©ç†å†…å­˜è¿™å—â€œåœŸåœ°â€å¯ä»¥è½åœ¨ç½‘æ ¼å†…çš„ä»»ä½•åœ°æ–¹ï¼Œå…¶å…·ä½“ä½ç½®å’Œå¤§å°å®Œå…¨ç”±åº•å±‚ç¡¬ä»¶å’Œå›ºä»¶è¯´äº†ç®—ã€‚</strong></p>
<h2 data-id="heading-6">33 åº”è¯¥æ˜¯é€šè¿‡struct mem_sectionçš„ start_pfnæ¥è®°å½•å§ï¼Ÿç­”ï¼šæ²¡start_pfnè¿™ä¸ªä¸œè¥¿</h2>
<p>æ‚¨æå‡ºäº†ä¸€ä¸ªéå¸¸ç²¾å‡†çš„æŠ€æœ¯é—®é¢˜ï¼æ‚¨çš„çŒœæµ‹éå¸¸æ¥è¿‘ï¼Œä½†å†…æ ¸çš„å®ç°æ–¹å¼è¦æ›´å·§å¦™ä¸€äº›ï¼Œå®ƒé€šè¿‡ä¸€ç§â€œéšå¼â€çš„æ–¹å¼æ¥çŸ¥é“èµ·å§‹åœ°å€ï¼Œä»è€ŒèŠ‚çœäº†å­˜å‚¨ç©ºé—´ã€‚</p>
<p><code>struct mem_section</code> æœ¬èº«<strong>å¹¶ä¸åŒ…å«</strong>ä¸€ä¸ªåä¸º <code>start_pfn</code> çš„å­—æ®µã€‚</p>
<p>åŸå› æ˜¯ï¼š<strong>ä»»ä½•ä¸€ä¸ª <code>mem_section</code> çš„èµ·å§‹åœ°å€ï¼ˆstart_pfnï¼‰éƒ½å¯ä»¥æ ¹æ®å®ƒåœ¨å…¨å±€ <code>mem_sections</code> æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®è®¡ç®—å‡ºæ¥ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å­˜å‚¨äº†ã€‚</strong></p>
<h4 data-id="heading-7">å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4>
<ol>
<li>
<p><strong>å…¨å±€çš„ <code>mem_sections</code> æ•°ç»„</strong>ï¼š
å†…æ ¸åœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå·¨å¤§çš„ã€ç¨€ç–çš„æ•°ç»„ï¼ˆæˆ–å¤šçº§æ•°ç»„ï¼‰ï¼Œé€šå¸¸å«åš <code>mem_sections</code>ã€‚è¿™ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼ˆindexï¼‰ç›´æ¥å¯¹åº”äºç‰©ç†åœ°å€ç©ºé—´ä¸­çš„â€œåŒºå—ç¼–å·â€ã€‚</p>
<p><code>struct mem_section *mem_sections[NR_MEM_SECTIONS];</code></p>
</li>
<li>
<p><strong>é€šè¿‡ä½ç½®éšå¼ç¡®å®šåœ°å€</strong>ï¼š
<code>mem_section</code> çš„å¤§å°ï¼ˆ<code>SECTION_SIZE</code>ï¼‰æ˜¯å›ºå®šçš„ã€‚å› æ­¤ï¼Œç¬¬ <code>i</code> ä¸ª <code>mem_section</code> æ‰€è´Ÿè´£çš„èµ·å§‹ç‰©ç†é¡µå¸§å·ï¼ˆstart_pfnï¼‰æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è¢«ç®€å•è®¡ç®—å‡ºæ¥ï¼š</p>
<p><code>start_pfn_of_section_i = i * PAGES_PER_SECTION;</code></p>
<ul>
<li><code>i</code> æ˜¯ <code>mem_section</code> åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚</li>
<li><code>PAGES_PER_SECTION</code> æ˜¯ä¸€ä¸ª <code>mem_section</code> åŒ…å«çš„é¡µé¢æ•°é‡ï¼ˆä¾‹å¦‚ 128MB / 4KB = 32768ï¼‰ã€‚</li>
</ul>
<p>åè¿‡æ¥ï¼Œç»™å®šä¸€ä¸ªç‰©ç†é¡µå¸§å· <code>pfn</code>ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥ç”¨æå¿«çš„ä½ç§»è¿ç®—æ‰¾åˆ°å®ƒå±äºå“ªä¸ª <code>mem_section</code>ï¼š</p>
<p><code>section_index = pfn &gt;&gt; PFN_SECTION_SHIFT;</code>  // <code>PFN_SECTION_SHIFT</code> æ˜¯ <code>log2(PAGES_PER_SECTION)</code></p>
<p>å› ä¸ºè¿™ç§å¯¹åº”å…³ç³»æ˜¯å›ºå®šçš„ã€å¯è®¡ç®—çš„ï¼Œæ‰€ä»¥åœ¨ <code>struct mem_section</code> å†…éƒ¨å†å­˜å‚¨ä¸€ä¸ª <code>start_pfn</code> å­—æ®µå°±æ˜¯å†—ä½™çš„ã€‚</p>
</li>
</ol>
<h4 data-id="heading-8">é‚£ä¹ˆï¼Œå¦‚ä½•è®°å½•â€œçœŸæ­£çš„â€å†…å­˜èµ·å§‹ä½ç½®ï¼Ÿ</h4>
<p>æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šå¦‚æœä¸€ä¸ª <code>mem_section</code> å†…éƒ¨æœ‰å†…å­˜ç©ºæ´ï¼ŒçœŸæ­£çš„å†…å­˜æ˜¯ä»ä¸­é—´å¼€å§‹çš„ï¼Œå†…æ ¸æ€ä¹ˆçŸ¥é“å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆè—åœ¨ <code>mem_section</code> æŒ‡å‘çš„**<code>struct page</code> æ•°ç»„**é‡Œã€‚</p>
<p><code>struct mem_section</code> ä¸­æœ€é‡è¦çš„å­—æ®µæ˜¯ <code>section_mem_map</code>ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª <code>struct page</code> æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„çš„å¤§å°æ­£å¥½è¦†ç›–æ•´ä¸ª <code>mem_section</code> çš„åœ°å€èŒƒå›´ã€‚</p>
<p><strong>å…³é”®åœ¨äºï¼šå†…æ ¸åªä¼šä¸º e820 å†…å­˜åœ°å›¾ä¸­æŠ¥å‘Šä¸ºâ€œå¯ç”¨ RAMâ€çš„ç‰©ç†åœ°å€èŒƒå›´ï¼Œå»åˆå§‹åŒ–å…¶å¯¹åº”çš„ <code>struct page</code> ç»“æ„ã€‚</strong></p>
<p>æˆ‘ä»¬å†ç”¨ä¹‹å‰çš„ä¾‹å­ï¼š</p>
<ul>
<li><code>mem_section[1]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code>ã€‚</li>
<li>ç¡¬ä»¶æŠ¥å‘Šçš„å¯ç”¨å†…å­˜æ˜¯ä» <code>0x0C000000</code> å¼€å§‹çš„ã€‚</li>
</ul>
<p>å†…æ ¸çš„æ“ä½œæ˜¯ï¼š</p>
<ol>
<li>å†…æ ¸ä¸º <code>mem_section[1]</code> åˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ <code>struct page</code> æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é€»è¾‘ä¸Šè¦†ç›–ä» <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code> çš„æ‰€æœ‰é¡µé¢ã€‚</li>
<li>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå†…æ ¸éå†è¿™ä¸ª <code>struct page</code> æ•°ç»„ï¼š
<ul>
<li>å¯¹äºä»£è¡¨ <code>0x08000000</code> åˆ° <code>0x0BFFFFFF</code> åœ°å€èŒƒå›´çš„ <code>struct page</code>ï¼Œå†…æ ¸ä¼šå‘ç°å®ƒä»¬ä½äºå†…å­˜ç©ºæ´ä¸­ã€‚äºæ˜¯ï¼Œå®ƒä¼šå°†è¿™äº› <code>struct page</code> çš„æ ‡å¿—ä½ï¼ˆflagsï¼‰è®¾ç½®ä¸º <code>PG_reserved</code>ï¼Œè¡¨ç¤ºè¿™äº›é¡µé¢ä¸å¯ç”¨ã€‚ä¼™ä¼´ç³»ç»Ÿä¼šå®Œå…¨å¿½ç•¥å®ƒä»¬ã€‚</li>
<li>å¯¹äºä»£è¡¨ <code>0x0C000000</code> åˆ° <code>0x0FFFFFFF</code> åœ°å€èŒƒå›´çš„ <code>struct page</code>ï¼Œå†…æ ¸å‘ç°å®ƒä»¬æ˜¯æœ‰æ•ˆçš„å¯ç”¨å†…å­˜ã€‚äºæ˜¯ï¼Œå®ƒä¼šæ­£å¸¸åˆå§‹åŒ–è¿™äº› <code>struct page</code> ç»“æ„ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ°ä¼™ä¼´ç³»ç»Ÿçš„ç©ºé—²é“¾è¡¨ä¸­ï¼Œä½¿å…¶å¯ä»¥è¢«åˆ†é…ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>mem_section</code> çš„ <strong>â€œç®¡è¾–èŒƒå›´â€</strong> èµ·å§‹åœ°å€ï¼Œæ˜¯é€šè¿‡å®ƒåœ¨å…¨å±€æ•°ç»„ä¸­çš„<strong>ä½ç½®</strong>éšå¼è®¡ç®—å‡ºæ¥çš„ã€‚</li>
<li><code>mem_section</code> å†…éƒ¨ <strong>â€œå®é™…å¯ç”¨å†…å­˜â€</strong> çš„èµ·å§‹åœ°å€å’Œåˆ†å¸ƒï¼Œæ˜¯é€šè¿‡å…¶æŒ‡å‘çš„ <code>struct page</code> æ•°ç»„ä¸­ï¼Œ<strong>æ¯ä¸ª <code>page</code> çš„çŠ¶æ€æ ‡å¿—ä½</strong>æ¥ç²¾ç»†è®°å½•çš„ã€‚</li>
</ul>
<p>è¿™ç§è®¾è®¡éå¸¸é«˜æ•ˆï¼šç”¨å®è§‚çš„ã€åŸºäºä½ç½®çš„ <code>mem_section</code> æ¥å¿«é€Ÿå®šä½ï¼Œå†ç”¨å¾®è§‚çš„ã€åŸºäºæ ‡å¿—ä½çš„ <code>struct page</code> æ¥è¿›è¡Œç²¾ç¡®ç®¡ç†ã€‚</p>
<h2 data-id="heading-9">44 ä¹Ÿå°±æ˜¯è¯´ç©ºæ´ä¹Ÿä¼šåˆ†é…ç›¸åº”çš„pageå‘—ï¼Ÿç­”ï¼šæ˜¯</h2>
<p>å®Œå…¨æ­£ç¡®ï¼æ‚¨ä¸€è¯­ä¸­çš„ï¼Œè¿™æ­£æ˜¯ <code>sparsemem</code> æ¨¡å‹çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡å“²å­¦ï¼Œä¹Ÿæ˜¯åˆå­¦è€…å®¹æ˜“æ„Ÿåˆ°å›°æƒ‘çš„åœ°æ–¹ã€‚</p>
<p><strong>æ˜¯çš„ï¼Œå³ä½¿æ˜¯å†…å­˜ç©ºæ´ï¼ˆHoleï¼‰ï¼Œå†…æ ¸ä¹Ÿä¼šä¸ºå…¶å¯¹åº”çš„ç‰©ç†åœ°å€èŒƒå›´åˆ†é… <code>struct page</code> ç»“æ„ä½“ã€‚</strong></p>
<p>ä½†è¿™çœ‹èµ·æ¥ä¼¼ä¹æ˜¯ä¸€ç§â€œæµªè´¹â€ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼ŸåŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼Œéƒ½å’Œ<strong>æ•ˆç‡</strong>ä¸<strong>ç®€æ´æ€§</strong>æœ‰å…³ã€‚</p>
<h4 data-id="heading-10">æ ¸å¿ƒåŸå› ï¼šä¸ºäº†å®ç°é—ªç”µèˆ¬çš„åœ°å€è½¬æ¢</h4>
<p>è¿™æ˜¯æœ€æ ¹æœ¬çš„åŸå› ã€‚åœ¨å†…æ ¸ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œå¿…é¡»åšåˆ°æè‡´çš„å¿«ï¼š</p>
<ol>
<li><code>pfn_to_page(pfn)</code>ï¼šæ ¹æ®ä¸€ä¸ªç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰ï¼Œç«‹å³æ‰¾åˆ°ç®¡ç†å®ƒçš„ <code>struct page</code> ç»“æ„ä½“ã€‚</li>
<li><code>page_to_pfn(page)</code>ï¼šæ ¹æ®ä¸€ä¸ª <code>struct page</code> ç»“æ„ä½“çš„åœ°å€ï¼Œç«‹å³åç®—å‡ºå®ƒç®¡ç†çš„ç‰©ç†é¡µå¸§å·ã€‚</li>
</ol>
<p>ä¸ºäº†å®ç°è¿™ä¸ªé€Ÿåº¦ï¼Œå†…æ ¸é‡‡ç”¨äº†ä¸€ç§<strong>çº¯ç®—æœ¯</strong>çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å»æŸ¥è¡¨ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå†…æ ¸åªä¸ºçœŸæ­£çš„å†…å­˜åˆ†é… <code>struct page</code>ï¼Œé‚£ä¹ˆ <code>struct page</code> æ•°ç»„æœ¬èº«å°†æ˜¯é›¶æ•£çš„ã€ä¸è¿ç»­çš„ã€‚å½“ä½ æ‹¿åˆ°ä¸€ä¸ª PFNï¼Œæƒ³æ‰¾åˆ°å®ƒçš„ <code>struct page</code> æ—¶ï¼Œä½ å°±æ— æ³•é€šè¿‡ç®€å•çš„æ•°å­¦è®¡ç®—æ¥å®šä½ï¼Œè€Œå¿…é¡»å»æœç´¢ä¸€ä¸ªå¤æ‚çš„ã€è®°å½•ç€â€œå“ªæ®µ PFN å¯¹åº”å“ªæ®µ <code>struct page</code> åœ°å€â€çš„æ•°æ®ç»“æ„ã€‚è¿™ä¼šéå¸¸æ…¢ã€‚</p>
<p>è€Œç°åœ¨çš„ <code>sparsemem</code> è®¾è®¡åˆ™å®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸€ä¸ª <code>mem_section</code> ç®¡è¾–çš„åœ°å€èŒƒå›´æ˜¯å›ºå®šçš„ï¼ˆä¾‹å¦‚128MBï¼‰ã€‚</li>
<li>å®ƒæ‰€æŒ‡å‘çš„ <code>section_mem_map</code> æ˜¯ä¸€ä¸ª<strong>è¿ç»­çš„ã€å®Œæ•´çš„ <code>struct page</code> æ•°ç»„</strong>ï¼Œè¿™ä¸ªæ•°ç»„çš„å¤§å°ä¹Ÿæ­£å¥½å¯¹åº”128MBçš„åœ°å€ç©ºé—´ã€‚</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>pfn_to_page(pfn)</code> çš„è½¬æ¢å°±å˜æˆäº†ç®€å•çš„å‡ æ­¥æ•°å­¦è¿ç®—ï¼š</p>
<ol>
<li><code>section_index = pfn &gt;&gt; PFN_SECTION_SHIFT;</code>  // ç”¨ä½ç§»ç®—å‡ºå±äºå“ªä¸ª section</li>
<li><code>page_index = pfn &amp; (PAGES_PER_SECTION - 1);</code> // ç”¨ä½ä¸ç®—å‡ºåœ¨ section å†…éƒ¨çš„åç§»</li>
<li><code>mem_map = __nr_to_section(section_index)-&gt;section_mem_map;</code> // æ‰¾åˆ° section å¯¹åº”çš„ page æ•°ç»„</li>
<li><code>return &amp;mem_map[page_index];</code> // ç›´æ¥ç”¨æ•°ç»„ä¸‹æ ‡è®¿é—®</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸æ¶‰åŠä»»ä½•å¾ªç¯æˆ–æœç´¢ï¼Œé€Ÿåº¦æå¿«ã€‚</p>
<h4 data-id="heading-11">å¸¦æ¥çš„å¥½å¤„ï¼šç»Ÿä¸€çš„ç®¡ç†æ¨¡å‹</h4>
<p>ä¸ºæ‰€æœ‰åœ°å€ï¼ˆåŒ…æ‹¬ç©ºæ´ï¼‰éƒ½åˆ†é…ä¸€ä¸ª <code>struct page</code> ä¹‹åï¼Œå†…æ ¸å°±æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼æ¥æè¿°æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´çš„çŠ¶æ€ã€‚</p>
<ul>
<li>å¯¹äºçœŸæ­£çš„å†…å­˜é¡µï¼Œå…¶ <code>struct page</code> çš„ <code>flags</code> æ˜¯æ­£å¸¸çš„ã€‚</li>
<li>å¯¹äºå†…å­˜ç©ºæ´ä¸­çš„é¡µï¼Œå…¶ <code>struct page</code> çš„ <code>flags</code> ä¼šè¢«è®¾ç½®ä¸º <strong><code>PG_reserved</code></strong>ã€‚</li>
</ul>
<p>å½“ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Allocatorï¼‰æˆ–å…¶ä»–å†…å­˜ç®¡ç†å­ç³»ç»Ÿçœ‹åˆ°ä¸€ä¸ª <code>page</code> è¢«æ ‡è®°ä¸º <code>PG_reserved</code> æ—¶ï¼Œå®ƒå°±çŸ¥é“è¿™ä¸ªé¡µé¢æ˜¯ä¸å¯ç”¨çš„ï¼Œä¼šç›´æ¥è·³è¿‡ã€‚è¿™ä½¿å¾—ä»£ç é€»è¾‘å˜å¾—éå¸¸ç»Ÿä¸€å’Œç®€æ´ï¼Œä¸éœ€è¦ä¸ºâ€œç©ºæ´â€ç¼–å†™é¢å¤–çš„ç‰¹æ®Šå¤„ç†é€»è¾‘ã€‚</p>
<h4 data-id="heading-12">è¿™æ˜¯ä¸€ç§å…¸å‹çš„â€œç©ºé—´æ¢æ—¶é—´â€</h4>
<p>è¿™ç¡®å®ä¼šæ¶ˆè€—ä¸€äº›å†…å­˜ã€‚ä¸€ä¸ª <code>struct page</code> åœ¨64ä½ç³»ç»Ÿä¸Šå¤§çº¦æ˜¯64å­—èŠ‚ã€‚ä¸ºä¸€ä¸ª128MBçš„<code>mem_section</code>ï¼ˆåŒ…å«32768ä¸ªé¡µé¢ï¼‰å®Œæ•´åˆ†é… <code>struct page</code> æ•°ç»„ï¼Œä¼šæ¶ˆè€— <code>32768 * 64B = 2MB</code> çš„å†…å­˜ã€‚</p>
<p>è¿™2MBçš„å†…å­˜å¼€é”€ï¼Œæ¢æ¥çš„æ˜¯å†…æ ¸æœ€æ ¸å¿ƒçš„å†…å­˜ç®¡ç†è·¯å¾„ä¸Šæé«˜çš„è¿è¡Œæ•ˆç‡ã€‚åœ¨ç°ä»£æ‹¥æœ‰å‡ åä¸Šç™¾GBå†…å­˜çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™ç‚¹å¼€é”€æ˜¯å®Œå…¨å€¼å¾—çš„ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>æ‚¨å¯ä»¥æŠŠ <code>struct page</code> æ•°ç»„æƒ³è±¡æˆä¸€ä¸ª<strong>é¢„å…ˆå°å¥½çš„è´¦æœ¬</strong>ï¼Œè´¦æœ¬çš„é¡µç ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰å’Œç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰ä¸¥æ ¼å¯¹åº”ã€‚å³ä½¿æŸå—åœ°ï¼ˆç‰©ç†åœ°å€ï¼‰æ˜¯ç©ºçš„ï¼Œè´¦æœ¬ä¸Šä¾ç„¶æœ‰é‚£ä¸€é¡µï¼Œåªæ˜¯åœ¨é‚£ä¸€é¡µä¸Šç›–äº†ä¸€ä¸ªâ€œä½œåºŸâ€ï¼ˆ<code>PG_reserved</code>ï¼‰çš„ç« ã€‚è¿™æ ·åšè™½ç„¶æµªè´¹äº†å‡ é¡µçº¸ï¼Œä½†ç¡®ä¿äº†ä½ å¯ä»¥é€šè¿‡é¡µç ç¬é—´ç¿»åˆ°ä»»ä½•ä¸€é¡µï¼Œè€Œä¸éœ€è¦å»æŸ¥ç›®å½•ã€‚</p>
<h2 data-id="heading-13">55</h2>
<p>æ‚¨è§‚å¯Ÿå¾—å¤ªä»”ç»†äº†ï¼æ‚¨æŒ‡å‡ºçš„è¿™ä¸€ç‚¹æ­£æ˜¯ç†è§£å†…æ ¸å®ç°çš„å…³é”®ï¼Œä¹Ÿæ˜¯é«˜çº§æ¦‚å¿µå’Œåº•å±‚ä»£ç å®ç°ä¹‹é—´æœ€å®¹æ˜“äº§ç”Ÿå›°æƒ‘çš„åœ°æ–¹ã€‚</p>
<p><strong>æ‚¨æ²¡æœ‰æé”™ï¼Œæ‚¨å¼•ç”¨çš„ç¬”è®°åœ¨é€»è¾‘ä¸Šæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½†â€œè®¾ç½® start_pfnâ€è¿™å¥è¯éœ€è¦ä»å®ç°å±‚é¢æ¥ç†è§£ã€‚</strong></p>
<p>æˆ‘ä»¬æ¥æŠŠè¿™ä¸ªâ€œç»“â€å½»åº•è§£å¼€ã€‚</p>
<h4 data-id="heading-14">å…³é”®ï¼šæ¦‚å¿µä¸Šçš„â€œè®¾ç½®â€ vs å®ç°ä¸Šçš„â€œè®¡ç®—â€</h4>
<p>æ‚¨å¼•ç”¨çš„ç¬”è®°æè¿°çš„æ˜¯ä¸€ä¸ª<strong>é€»è¾‘æµç¨‹</strong>ï¼Œåœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œâ€œä¸ºæŸä¸ª section ç¡®å®šå…¶èµ·å§‹åœ°å€â€æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚æ‰€ä»¥ï¼Œä»æ¦‚å¿µä¸Šè¯´ï¼Œâ€œè®¾ç½® start_pfnâ€æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨<strong>ä»£ç å®ç°</strong>ä¸­ï¼Œå†…æ ¸å¼€å‘è€…å‘ç°ï¼Œè¿™ä¸ª <code>start_pfn</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰è§„å¾‹çš„ã€å¯ä»¥éšæ—¶é€šè¿‡è®¡ç®—å¾—å‡ºçš„å€¼ã€‚å› æ­¤ï¼Œä¸ºäº†èŠ‚çœ <code>struct mem_section</code> ç»“æ„ä½“æœ¬èº«çš„ç©ºé—´ï¼Œå¹¶åˆ©ç”¨CPUé«˜æ•ˆçš„ä½è¿ç®—ï¼Œä»–ä»¬<strong>æ²¡æœ‰åœ¨ <code>struct mem_section</code> ç»“æ„ä½“é‡Œå®šä¹‰ä¸€ä¸ªåä¸º <code>start_pfn</code> çš„å­—æ®µ</strong>ã€‚</p>
<p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå½“å†…æ ¸éœ€è¦çŸ¥é“ä»»ä½•ä¸€ä¸ª <code>mem_section</code> çš„èµ·å§‹åœ°å€æ—¶ï¼Œå®ƒä¼š<strong>å³æ—¶è®¡ç®—</strong>å‡ºæ¥ã€‚</p>
<hr/>
<h4 data-id="heading-15">æˆ‘ä»¬æ¥é‡æ–°å®¡è§†æ‚¨çš„ç¬”è®°ï¼Œå¹¶åŠ ä¸Šâ€œå®ç°ç»†èŠ‚â€çš„æ³¨é‡Š</h4>
<p><strong>4.1 è®¡ç®— section å¸ƒå±€</strong></p>
<blockquote>
<p>å†…æ ¸å¯åŠ¨æ—¶ï¼Œæ ¹æ®ç‰©ç†å†…å­˜èŒƒå›´è®¡ç®—éœ€è¦å¤šå°‘ä¸ª sectionã€‚
æ¯ä¸ª section å¤§å°å›ºå®šï¼ˆä¾‹å¦‚ 256MBï¼‰ã€‚</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå®Œå…¨æ­£ç¡®ã€‚å†…æ ¸ä¼šç¡®å®šä¸€ä¸ª <code>NR_MEM_SECTIONS</code> çš„æœ€å¤§å€¼ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ <code>struct mem_section* mem_sections[NR_MEM_SECTIONS]</code>ã€‚</li>
</ul>
<p><strong>4.2 åˆå§‹åŒ– mem_section æ•°ç»„</strong></p>
<blockquote>
<p>å¯¹äºå­˜åœ¨çš„ç‰©ç†å†…å­˜åŒºåŸŸï¼š
æ ‡è®° <code>mem_section[i].present = 1</code></p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šè¿™é‡Œçš„ <code>present</code> ä¹Ÿä¸æ˜¯ä¸€ä¸ªçœŸå®çš„å­—æ®µã€‚å†…æ ¸çš„å®ç°æ–¹å¼æ˜¯ï¼šå¦‚æœ <code>mem_sections[i]</code> è¿™ä¸ªæŒ‡é’ˆæ˜¯ <code>NULL</code>ï¼Œå°±ä»£è¡¨è¯¥ section ä¸å­˜åœ¨æˆ–æ²¡æœ‰å†…å­˜ã€‚å¦‚æœå®ƒ<strong>æŒ‡å‘ä¸€ä¸ªå®é™…åˆ†é…çš„ <code>struct mem_section</code> å¯¹è±¡</strong>ï¼Œå°±ä»£è¡¨å®ƒæ˜¯â€œpresentâ€çš„ã€‚æ‰€ä»¥ï¼Œä¸º section åˆ†é… <code>struct mem_section</code> å¯¹è±¡æœ¬èº«ï¼Œå°±å®Œæˆäº†â€œæ ‡è®°ä¸º presentâ€çš„åŠ¨ä½œã€‚</li>
</ul>
<blockquote>
<p>è®¾ç½® <code>start_pfn</code></p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼š<strong>è¿™å°±æ˜¯å…³é”®ç‚¹ï¼</strong> è¿™ä¸€æ­¥åœ¨ä»£ç é‡Œå¹¶ä¸å­˜åœ¨ <code>section-&gt;start_pfn = ...</code> è¿™æ ·çš„èµ‹å€¼è¯­å¥ã€‚è¿™ä¸€æ­¥çš„çœŸæ­£å«ä¹‰æ˜¯ï¼šâ€œ<strong>å†…æ ¸æ­¤æ—¶å·²ç»çŸ¥é“ï¼Œè¿™ä¸ªç´¢å¼•ä¸º <code>i</code> çš„ sectionï¼Œå®ƒæ‰€å¯¹åº”çš„èµ·å§‹é¡µå¸§å· <code>start_pfn</code> å°±æ˜¯ <code>i * PAGES_PER_SECTION</code></strong>â€ã€‚è¿™ä¸ªå…³ç³»æ˜¯å†…æ ¸åç»­æ‰€æœ‰æ“ä½œçš„åŸºç¡€ã€‚</li>
</ul>
<blockquote>
<p>åˆ†é…å¹¶åˆå§‹åŒ– <code>section_mem_map</code>ï¼ˆæŒ‡å‘è¯¥ section çš„ <code>struct page</code> æ•°ç»„ï¼‰</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå®Œå…¨æ­£ç¡®ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„åŠ¨ä½œã€‚å†…æ ¸ä¼šåˆ†é…ä¸€ä¸ª <code>struct mem_section</code> å¯¹è±¡ï¼Œç„¶åä¸ºå®ƒçš„ <code>section_mem_map</code> å­—æ®µå¡«å……ä¸€ä¸ªæŒ‡å‘ <code>struct page</code> æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>4.3 åˆ†é… struct page</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯ SPARSEMEM_VMEMMAP...
å¦‚æœæ˜¯æ™®é€š SPARSEMEM...</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šæ‚¨çš„ç¬”è®°åœ¨è¿™é‡Œéå¸¸ä¸“ä¸šå’Œå‡†ç¡®ï¼Œæ¸…æ™°åœ°æŒ‡å‡ºäº†ä¸¤ç§ <code>sparsemem</code> æ¨¡å‹çš„åŒºåˆ«ã€‚</li>
</ul>
<h4 data-id="heading-16">ç»“è®º</h4>
<p>æ‚¨æ²¡æœ‰æé”™ã€‚æ‚¨å¼•ç”¨çš„ç¬”è®°æ˜¯ä»ä¸€ä¸ª<strong>é«˜çº§çš„ã€é€»è¾‘çš„è§†è§’</strong>æ¥æè¿°å†…å­˜åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¸…æ™°æ˜“æ‡‚ã€‚è€Œæˆ‘ä¹‹å‰çš„å›ç­”ï¼Œæ˜¯ä»ä¸€ä¸ª<strong>åº•å±‚çš„ã€æ•°æ®ç»“æ„å®ç°çš„è§†è§’</strong>æ¥è§£é‡Šä¸ºä»€ä¹ˆ <code>struct page</code> çš„è½¬æ¢å¯ä»¥é‚£ä¹ˆå¿«ã€‚</p>
<ul>
<li><strong>æ‚¨çš„ç¬”è®°</strong>ï¼šâ€œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ª section ç¡®å®šä¸€ä¸ªèµ·å§‹åœ°å€ï¼ˆ<code>start_pfn</code>ï¼‰ã€‚â€ (æè¿°è¦åšä»€ä¹ˆ - <strong>What</strong>)</li>
<li><strong>å†…æ ¸å®ç°</strong>ï¼šâ€œæˆ‘ä»¬é€šè¿‡ section çš„æ•°ç»„ä¸‹æ ‡ <code>i</code> ä¹˜ä»¥ä¸€ä¸ªå¸¸é‡æ¥éšæ—¶å¾—åˆ° <code>start_pfn</code>ï¼Œæ‰€ä»¥ä¸ç”¨æŠŠå®ƒå­˜èµ·æ¥ã€‚â€ (æè¿°æ€ä¹ˆåš - <strong>How</strong>)</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>â€œè®¾ç½® start_pfnâ€è¿™å¥è¯ï¼Œåº”è¯¥ç†è§£ä¸ºå†…æ ¸åœ¨é€»è¾‘ä¸Šå°†ä¸€ä¸ª section ä¸å…¶å›ºå®šçš„èµ·å§‹åœ°å€å…³è”èµ·æ¥çš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªå…³è”æ˜¯é€šè¿‡æ•°ç»„ç´¢å¼•å’Œæ•°å­¦è®¡ç®—æ¥é«˜æ•ˆå®ç°çš„ï¼Œè€Œéé€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å­—æ®µæ¥å­˜å‚¨ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ]]></title>    <link>https://juejin.cn/post/7598587406694563883</link>    <guid>https://juejin.cn/post/7598587406694563883</guid>    <pubDate>2026-01-24T02:59:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406694563883" data-draft-id="7598103558887194670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:59:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:59:25.000Z" title="Sat Jan 24 2026 02:59:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ã€ŒLinux sparsemem/mem_section æ·±åº¦ç¬”è®°ï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ã€</strong></p>
<p>ä»¥ä¸‹æ˜¯åŸºäºä½ æåˆ°çš„è¿™äº›ç‚¹ï¼Œæ•´ç†çš„ä¸€ä»½<strong>Linux sparsemem/mem_section ç¬”è®°</strong>ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹åšäº†å®ç°å±‚é¢çš„çº æ­£å’Œè¡¥å……ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. sparsemem ä¸ mem_section çš„è§’è‰²</h2>
<ul>
<li><strong>sparsemem çš„ç›®çš„</strong>ï¼šåº”å¯¹ç‰©ç†åœ°å€ç©ºé—´ç¢ç‰‡åŒ–ï¼ˆå¤§æ´ã€å¤šèŠ‚ç‚¹ã€çƒ­æ’æ‹”ç­‰ï¼‰ï¼Œä¸å†å‡è®¾ç‰©ç†å†…å­˜è¿ç»­ã€‚</li>
<li><strong>mem_section çš„å®šä¹‰</strong>ï¼š
<ul>
<li>æ˜¯<strong>å›ºå®šå¤§å°çš„ç‰©ç†åœ°å€åŒºé—´ç®¡ç†å•å…ƒ</strong>ï¼ˆä¾‹å¦‚ 128MBã€256MBã€1GBï¼Œå–å†³äºæ¶æ„å’Œé…ç½®ï¼‰ã€‚</li>
<li>å†…æ ¸å¯åŠ¨æ—¶æŒ‰æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´åˆ’åˆ†ä¸€ä¸ªä¸ª sectionï¼šsection0 ç®¡ç† <code>[0, SECTION_SIZE)</code>, section1 ç®¡ç† <code>[SECTION_SIZE, 2*SECTION_SIZE)</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li><strong>å…³é”®ç‚¹ï¼šmem_section ç®¡çš„æ˜¯â€œè¦†ç›–çš„åœ°å€èŒƒå›´â€ï¼Œä¸ä¿è¯è¿™æ®µèŒƒå›´å†…å…¨éƒ¨éƒ½æ˜¯çœŸå®å†…å­˜ã€‚</strong></li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. mem_section ä¸ç‰©ç†å†…å­˜çš„å…³ç³»</h2>
<h3 data-id="heading-2">2.1 mem_section ä¸ç­‰äºâ€œæ•´å—å†…å­˜â€</h3>
<ul>
<li>ä¸€ä¸ª <strong>mem_section ä¸è¦æ±‚è¢«çœŸå®ç‰©ç†å†…å­˜â€œå¡«æ»¡â€</strong>ã€‚</li>
<li>åœ¨ä¸€ä¸ª mem_section è¦†ç›–çš„åœ°å€èŒƒå›´å†…ï¼Œå¯èƒ½å‡ºç°ï¼š
<ul>
<li>å®Œå…¨æ˜¯å¯ç”¨ RAMï¼›</li>
<li>RAM + å†…å­˜ç©ºæ´ï¼ˆè®¾å¤‡ MMIO / ä¿ç•™åŒºåŸŸï¼‰æ··åˆï¼›</li>
<li>å®Œå…¨æ²¡æœ‰ RAMï¼Œä»…ä»…æ˜¯â€œæ´â€ï¼ˆæ­¤æ—¶æ•´ä¸ª section ç”šè‡³å¯ä»¥ä¸è¢«æ ‡è®°ä¸º presentï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>mem_section æ˜¯â€œç½‘æ ¼â€ï¼›çœŸå®å†…å­˜æ˜¯â€œæ•£è½åœ¨ç½‘æ ¼é‡Œçš„åœŸåœ°â€ã€‚ç½‘æ ¼å¯æ»¡å¯ç©ºå¯åŠæ»¡ã€‚</strong></p>
<h3 data-id="heading-3">2.2 èµ·å§‹ä½ç½®ä¸å¿…å¯¹é½åˆ° section å¼€å¤´</h3>
<ul>
<li>ä¸€å—çœŸæ­£æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜å—ï¼ˆæ¯”å¦‚ä¸€ä¸ª DIMM æ¡ï¼‰ï¼Œåœ¨ç‰©ç†åœ°å€ä¸Šçš„<strong>èµ·å§‹åœ°å€å’Œé•¿åº¦å®Œå…¨ç”±ç¡¬ä»¶+å›ºä»¶å†³å®š</strong>ï¼Œå’Œ mem_section çš„è¾¹ç•Œæ— å…³ã€‚</li>
<li>å› æ­¤ï¼š
<ul>
<li>ä¸€ä¸ª section è¦†ç›– <code>[A, A+SECTION_SIZE)</code>ï¼›</li>
<li>å¯ç”¨ RAM å¯èƒ½åªåœ¨å…¶ä¸­çš„ä¸€æ®µï¼Œä¾‹å¦‚ <code>[A+64MB, A+128MB)</code>ï¼›</li>
<li>section å‰åŠæ®µå¯èƒ½æ˜¯ MMIO/ä¿ç•™åŒºåŸŸï¼ˆå†…å­˜ç©ºæ´ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>â€œä¸€å—å†…å­˜å¦‚æœä¸è¶³ä»¥å¡«æ»¡ä¸€ä¸ª sectionï¼Œä¹Ÿä¸ä¸€å®šä»è¿™ä¸ª section çš„ç¬¬ä¸€ä¸ªç‰©ç†é¡µå¼€å§‹â€ï¼Œå®ƒå¯ä»¥ä» section ä¸­é—´ä»»æ„ä¸€ä¸ª pfn å¼€å§‹ï¼Œåªè¦å›ºä»¶è¿™ä¹ˆæŠ¥å‘Šå³å¯ã€‚</strong></p>
<hr/>
<h2 data-id="heading-4">3. å†…å­˜çƒ­æ’æ‹”ä¸é SECTION_SIZE å€æ•°</h2>
<ul>
<li>å›ºä»¶ï¼ˆé€šå¸¸ ACPIï¼‰åœ¨çƒ­æ’æ‹”å†…å­˜æ—¶ï¼ŒæŠ¥å‘Šçš„æ˜¯ä¸€ä¸ª<strong>ä»»æ„èµ·å§‹åœ°å€ + ä»»æ„å¤§å°</strong>çš„å†…å­˜åŒºåŸŸï¼Œä¾‹å¦‚ï¼š
<ul>
<li>èµ·å§‹åœ°å€ï¼š<code>start</code></li>
<li>å¤§å°ï¼š<code>size</code></li>
</ul>
</li>
<li>å†…æ ¸å¤„ç†æµç¨‹ï¼ˆé€»è¾‘ç²’åº¦ï¼‰ï¼š
<ol>
<li>æ ¹æ® <code>[start, start + size)</code> è®¡ç®—æ¶‰åŠåˆ°çš„ <strong>mem_section ä¸‹æ ‡é›†åˆ</strong>ã€‚</li>
<li>ä¸ºè¿™äº› section åˆ†é…/åˆå§‹åŒ– <code>struct mem_section</code> å’Œ <code>section_mem_map</code>ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ã€‚</li>
<li>åœ¨è¿™ä¸ªåœ°å€åŒºé—´å†…ï¼ŒæŒ‰ <strong>é¡µ (page)</strong> ç²’åº¦éå†ï¼š
<ul>
<li>å¯¹æ¯ä¸€ä¸ªå¯ç”¨çš„ pageï¼ˆ4KB ç­‰ï¼‰ï¼Œåˆå§‹åŒ–å¯¹åº”çš„ <code>struct page</code>ã€‚</li>
<li>æŠŠè¿™äº› page åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><strong>é‡è¦åŒºåˆ†ï¼š</strong></p>
<ul>
<li><strong>ç®¡ç†ç²’åº¦</strong>ï¼šmem_sectionï¼ˆä¾‹å¦‚ 128MB/256MB/1GBï¼‰ï¼Œä¾¿äºæ‰¹é‡æ ‡è®° online/offlineã€‚</li>
<li><strong>æ“ä½œç²’åº¦</strong>ï¼špageï¼ˆä¾‹å¦‚ 4KBï¼‰ï¼ŒçœŸæ­£åˆå§‹åŒ–å’Œå‚ä¸åˆ†é…çš„æ˜¯ pageã€‚</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>çƒ­æ’æ‹”å†…å­˜ç»ä¸è¦æ±‚æ˜¯ SECTION_SIZE çš„æ•´æ•°å€ï¼Œåªè¦æ˜¯é¡µç²’åº¦å¯¹é½å³å¯ï¼Œå†…æ ¸å¯ä»¥ç²¾ç¡®åˆ°æ¯ä¸€é¡µç®¡ç†ã€‚</strong></p>
<hr/>
<h2 data-id="heading-5">4. struct mem_section é‡Œæœ‰æ²¡æœ‰ start_pfnï¼Ÿ</h2>
<h3 data-id="heading-6">4.1 æ¦‚å¿µå±‚é¢ vs å®ç°å±‚é¢</h3>
<ul>
<li>
<p>æ¦‚å¿µå±‚é¢ï¼Œæè¿°æµç¨‹æ—¶å¸¸ä¼šè¯´ï¼š<br/>
<strong>â€œä¸º section è®¾ç½® start_pfnâ€</strong><br/>
å®é™…å«ä¹‰æ˜¯ï¼š<strong>â€œæŠŠè¿™ä¸ª section ä¸å®ƒè´Ÿè´£çš„èµ·å§‹ç‰©ç†é¡µå·å…³è”èµ·æ¥â€ã€‚</strong></p>
</li>
<li>
<p>å®ç°å±‚é¢ï¼š</p>
<ul>
<li>
<p><strong>åœ¨ <code>struct mem_section</code> ä¸­å¹¶æ²¡æœ‰ <code>start_pfn</code> è¿™ä¸ªå­—æ®µã€‚</strong></p>
</li>
<li>
<p>èµ·å§‹é¡µå¸§å·æ˜¯é€šè¿‡ <strong>ä¸‹æ ‡è®¡ç®—</strong> è·å¾—çš„ï¼š</p>
<ul>
<li>
<p>è®¾ <code>PAGES_PER_SECTION = SECTION_SIZE / PAGE_SIZE</code></p>
</li>
<li>
<p>ç¬¬ <code>i</code> ä¸ª section çš„èµ·å§‹ pfnï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>start_pfn</mtext><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>i</mi><mo>Ã—</mo><mi>P</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>P</mi><mi>E</mi><mi>R</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\text{start\_pfn}(i) = i \times PAGES\_PER\_SECTION</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">start_pfn</span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"/><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">GES</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.00773em;">PER</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span></span></span></span></span></div>
</li>
<li>
<p>ç»™å®šä¸€ä¸ª pfnï¼Œè¦æ‰¾åˆ°å®ƒå±äºå“ªä¸ª sectionï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>section_index</mtext><mo>=</mo><mfrac><mtext>pfn</mtext><mtext>PAGES_PER_SECTION</mtext></mfrac><mo>=</mo><mtext>pfn</mtext><mo>&gt;</mo><mo>&gt;</mo><mi>P</mi><mi>F</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>H</mi><mi>I</mi><mi>F</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\text{section\_index} = \frac{\text{pfn}}{\text{PAGES\_PER\_SECTION}} = \text{pfn} &gt;&gt; PFN\_SECTION\_SHIFT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">section_index</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.3674em;vertical-align:-0.996em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord">PAGES_PER_SECTION</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord">pfn</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.996em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">PFN</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">FT</span></span></span></span></span></div>
</li>
</ul>
</li>
<li>
<p>ç”±äºè¿™ç§å…³ç³»æ˜¯<strong>å›ºå®šå¯è®¡ç®—</strong>çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦åœ¨ç»“æ„ä½“é‡Œå†å­˜ä¸€ä¸ª <code>start_pfn</code> å­—æ®µã€‚</p>
</li>
</ul>
</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong><br/>
<strong>â€œè®¾ç½® start_pfnâ€æ˜¯é€»è¾‘åŠ¨ä½œï¼›å®é™…ä»£ç æ˜¯â€œé€šè¿‡ section ä¸‹æ ‡ + å¸¸é‡è®¡ç®— start_pfnâ€ï¼Œä¸éœ€è¦æˆå‘˜å˜é‡ã€‚</strong></p>
<hr/>
<h2 data-id="heading-7">5. mem_section çš„ present / section_mem_map</h2>
<h3 data-id="heading-8">5.1 mem_sections å…¨å±€æ•°ç»„</h3>
<ul>
<li>å†…æ ¸ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„ section æ•°ç»„ï¼ˆé€»è¾‘ä¸Šï¼‰ï¼š
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mem_section</span> *<span class="hljs-title">mem_sections</span>[<span class="hljs-title">NR_MEM_SECTIONS</span>];</span>
</code></pre>
</li>
<li>æ¯ä¸ªä¸‹æ ‡ <code>i</code> å¯¹åº”ä¸€ä¸ªè¦†ç›–å›ºå®šåœ°å€èŒƒå›´çš„ sectionã€‚</li>
</ul>
<h3 data-id="heading-9">5.2 present çš„â€œéšå¼â€è¡¨ç¤º</h3>
<ul>
<li>æ¦‚å¿µä¸Šï¼Œä¼šè¯´ <code>mem_section[i].present = 1</code> è¡¨ç¤ºè¿™ä¸ª section é‡Œæœ‰å†…å­˜ã€‚</li>
<li>å®ç°ä¸Šï¼Œé€šå¸¸é€šè¿‡ï¼š
<ul>
<li><code>mem_sections[i]</code> æ˜¯å¦ä¸º <code>NULL</code>ï¼›</li>
<li>æˆ–è€…åœ¨ <code>section_mem_map</code> æŒ‡é’ˆçš„ä½ä½ä¸Šç¼–ç ä¸€äº› bitï¼›
æ¥è¡¨ç¤ºè¿™ä¸ª section æ˜¯å¦ <strong>present / online</strong>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>â€œpresent å­—æ®µâ€ä¸€èˆ¬ä¹Ÿæ˜¯æ¦‚å¿µæè¿°ï¼›å®é™…ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºã€æŒ‡é’ˆä¸Šçš„æ ‡å¿—ä½ç­‰æ‰‹æ®µã€‚</strong></p>
<h3 data-id="heading-10">5.3 section_mem_mapï¼šæŒ‡å‘ struct page æ•°ç»„</h3>
<ul>
<li><code>struct mem_section</code> çš„æ ¸å¿ƒå­—æ®µæ˜¯ <strong><code>section_mem_map</code></strong>ï¼š
<ul>
<li>æŒ‡å‘ä¸€ä¸ª <code>struct page</code> æ•°ç»„ã€‚</li>
<li>æ•°ç»„é•¿åº¦è¦†ç›–æ•´ä¸ª section èŒƒå›´çš„æ‰€æœ‰é¡µæ•°ï¼š<code>PAGES_PER_SECTION</code>ã€‚</li>
</ul>
</li>
<li>åç»­æ‰€æœ‰å…³äºè¯¥ section å†… page çš„ä¿¡æ¯ï¼ˆæ˜¯å¦ç©ºæ´ã€æ˜¯å¦å¯ç”¨ã€å±äºå“ªä¸ª zone/node ç­‰ï¼‰éƒ½é€šè¿‡è¿™äº› <code>struct page</code> çš„å­—æ®µæ¥è¡¨è¾¾ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-11">6. å†…å­˜ç©ºæ´ä¸ struct page çš„åˆ†é…</h2>
<h3 data-id="heading-12">6.1 â€œç©ºæ´ä¹Ÿä¼šåˆ†é… page å—ï¼Ÿâ€</h3>
<p><strong>æ›´ç²¾ç¡®çš„è¯´æ³•ï¼š</strong></p>
<ul>
<li>å¯¹äº<strong>å·²ç»æ ‡è®°ä¸º present çš„ section</strong>ï¼š
<ul>
<li>å†…æ ¸ä¼šä¸ºè¯¥ section è¦†ç›–çš„æ•´ä¸ªåœ°å€èŒƒå›´åˆ†é…ä¸€æ•´å— <code>struct page</code> æ•°ç»„ã€‚</li>
<li>å…¶ä¸­ï¼š
<ul>
<li>ä½äºçœŸå® RAM èŒƒå›´çš„é‚£äº›é¡µï¼Œå¯¹åº”çš„ <code>struct page</code> ä¼šè¢«åˆå§‹åŒ–ä¸º <strong>å¯ç”¨å†…å­˜é¡µ</strong>ï¼›</li>
<li>ä½äºå†…å­˜ç©ºæ´ï¼ˆMMIO/ä¿ç•™åŒºåŸŸï¼‰èŒƒå›´çš„é‚£äº›é¡µï¼Œå¯¹åº”çš„ <code>struct page</code> ä¼šè¢«æ ‡è®°ä¸º <strong><code>PG_reserved</code></strong>ï¼Œä¸ä¼šåŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å¯¹äº<strong>å®Œå…¨æ²¡æœ‰ RAM çš„ section</strong>ï¼ˆæ•´ä¸ª section æ˜¯æ´ï¼‰ï¼š
<ul>
<li>è¯¥ section é€šå¸¸ä¸ä¼šè¢«æ ‡è®°ä¸º presentï¼Œä¹Ÿä¸ä¼šåˆ†é… <code>struct mem_section</code> å’Œ <code>section_mem_map</code>ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰ <code>struct page</code>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ‰€ä»¥ï¼š</strong></p>
<ul>
<li><strong>â€œç©ºæ´ä¹Ÿä¼šåˆ†é…ç›¸åº”çš„ pageâ€</strong> è¿™å¥è¯åœ¨ä¸Šä¸‹æ–‡ä¸Šï¼Œåº”ç†è§£ä¸ºï¼š<br/>
<strong>â€œåœ¨ä¸€ä¸ªå·²å­˜åœ¨ï¼ˆpresentï¼‰çš„ section å†…éƒ¨ï¼Œå³ä¾¿æŸäº›å­èŒƒå›´æ˜¯å†…å­˜ç©ºæ´ï¼Œä¹Ÿä¼šæœ‰å¯¹åº”çš„ <code>struct page</code>ï¼Œä½†è¿™äº› page ä¼šæ ‡è®°ä¸º <code>PG_reserved</code>ï¼Œä¸å‚ä¸åˆ†é…ã€‚â€</strong></li>
</ul>
<h3 data-id="heading-13">6.2 è¿™æ ·åšçš„æ ¸å¿ƒç†ç”±ï¼špfn_to_page / page_to_pfn çš„æè‡´æ•ˆç‡</h3>
<ul>
<li>
<p>æ ¸å¿ƒéœ€æ±‚ï¼š<br/>
<strong><code>pfn_to_page(pfn)</code> å’Œ <code>page_to_pfn(page)</code> å¿…é¡»éå¸¸å¿«ã€‚</strong></p>
</li>
<li>
<p>åœ¨ sparsemem ä¸‹ï¼Œ<code>pfn_to_page()</code> çš„å…¸å‹è®¡ç®—é€»è¾‘ï¼š</p>
<ol>
<li>è®¡ç®— section ä¸‹æ ‡ï¼š
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>section</mtext><mo>=</mo><mtext>pfn</mtext><mo>&gt;</mo><mo>&gt;</mo><mi>P</mi><mi>F</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>H</mi><mi>I</mi><mi>F</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\text{section} = \text{pfn} &gt;&gt; PFN\_SECTION\_SHIFT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">section</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">PFN</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">FT</span></span></span></span></span></div>
</li>
<li>è®¡ç®—åœ¨ section å†…çš„é¡µåç§»ï¼š
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>offset</mtext><mo>=</mo><mtext>pfn</mtext><mi mathvariant="normal">&amp;</mi><mo stretchy="false">(</mo><mi>P</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>P</mi><mi>E</mi><mi>R</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{offset} = \text{pfn} \&amp; (PAGES\_PER\_SECTION - 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">offset</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mord">&amp;</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">GES</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.00773em;">PER</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></div>
</li>
<li>æ‰¾åˆ°è¯¥ section çš„ <code>section_mem_map</code>ï¼š
<pre><code class="hljs language-c" lang="c">mem_map = __nr_to_section(section)-&gt;section_mem_map;
</code></pre>
</li>
<li>è¿”å›å¯¹åº”é¡µï¼š
<pre><code class="hljs language-c" lang="c">page = &amp;mem_map[offset];
</code></pre>
</li>
</ol>
</li>
<li>
<p>ä¹‹æ‰€ä»¥èƒ½åšåˆ°<strong>çº¯ç®—æœ¯ + æ•°ç»„ä¸‹æ ‡è®¿é—®</strong>ï¼Œå‰æå°±æ˜¯ï¼š</p>
<ul>
<li>å¯¹äºä¸€ä¸ª present çš„ sectionï¼Œæ•´ä¸ª PRFN èŒƒå›´éƒ½æœ‰ä¸€ä¸ªè¿ç»­çš„ <code>struct page</code> æ•°ç»„ä¸å…¶ä¸€ä¸€å¯¹åº”ï¼Œæ— è®ºæ˜¯å¦æ´ã€‚</li>
</ul>
</li>
<li>
<p>å¯¹äºæ´ä¸­çš„é¡µï¼Œ<code>struct page</code> ä»ç„¶å­˜åœ¨ï¼Œä½†é€šè¿‡ <code>flags</code>ï¼ˆå¦‚ <code>PG_reserved</code>ï¼‰è¡¨ç¤ºâ€œä¸å¯ç”¨â€ã€‚</p>
</li>
</ul>
<p><strong>è¿™æ˜¯ä¸€ç§å…¸å‹çš„â€œç©ºé—´æ¢æ—¶é—´â€è®¾è®¡ï¼š</strong></p>
<ul>
<li>ç©ºé—´æˆæœ¬ï¼š<br/>
æ¯ä¸ª <code>struct page</code> å å‡ åå­—èŠ‚ï¼Œä¸€ä¸ªå¤§ section ä¼šç”¨æ‰å‡ ç™¾ KB æˆ–å‡  MB çš„å†…æ ¸å†…å­˜ã€‚</li>
<li>æ—¶é—´æ”¶ç›Šï¼š<br/>
æ¢æ¥ pfn/page åŒå‘è½¬æ¢åœ¨å†…æ ¸æ ¸å¿ƒè·¯å¾„ä¸Šçš„<strong>æé«˜æ€§èƒ½</strong>ï¼Œé¿å…å¤æ‚æŸ¥è¡¨å’Œæœç´¢é€»è¾‘ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-14">7. SPARSEMEM_VMEMMAP vs ä¼ ç»Ÿ SPARSEMEMï¼ˆç®€è¦ï¼‰</h2>
<ul>
<li><strong>SPARSEMEM_VMEMMAP</strong>ï¼š
<ul>
<li>å°†æ‰€æœ‰ <code>struct page</code> è‡ªèº«æ”¾è¿›ä¸€ä¸ªä¸“é—¨çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆvmemmapï¼‰ã€‚</li>
<li>å¯¹äºâ€œå¯èƒ½å­˜åœ¨çš„æ‰€æœ‰ PFNâ€éƒ½æœ‰ä¸€æ¡ <code>struct page</code>ï¼Œæ´åˆ™ç”¨ <code>PG_reserved</code> ç­‰æ ‡è¯†ã€‚</li>
<li>pfn ä¸ <code>struct page*</code> ä¹‹é—´å‡ ä¹æ˜¯ä¸€ä¸€æ˜ å°„ï¼ˆåŠ åç§»å³å¯ï¼‰ï¼Œæ›´ç»Ÿä¸€ã€‚</li>
</ul>
</li>
<li><strong>ä¼ ç»Ÿ SPARSEMEMï¼ˆé vmemmapï¼‰</strong>ï¼š
<ul>
<li>æ¯ä¸ª present çš„ section å•ç‹¬åˆ†é…ä¸€å— <code>struct page</code> æ•°ç»„ã€‚</li>
<li>Section å†…éƒ¨çš„æ´ä¹Ÿæœ‰å¯¹åº” <code>struct page</code>ï¼Œç”¨äºä¿æŒç´¢å¼•è¿ç»­ï¼Œä½†å®Œå…¨ç©ºçš„ section ä¸åˆ†é…ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å…±åŒç‚¹ï¼š</strong><br/>
<strong>åªè¦ section è¢«è®¤ä¸ºæ˜¯ presentï¼Œå…¶è¦†ç›–èŒƒå›´å†…çš„ PFN ä¸€èˆ¬éƒ½ä¼šæœ‰å¯¹åº”çš„ <code>struct page</code> å¯¹è±¡ï¼›â€œæ˜¯å¦çœŸå®å†…å­˜â€åˆ™é€šè¿‡ <code>struct page</code> çš„æ ‡å¿—ä½åŒºåˆ†ã€‚</strong></p>
<hr/>
<h2 data-id="heading-15">8. æ€»ç»“æ€ç»´æ¨¡å‹</h2>
<p>å¯ä»¥ç”¨ä»¥ä¸‹æ¨¡å‹åœ¨è„‘å­é‡Œâ€œç”»å›¾â€ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸€å±‚ï¼šmem_section ç½‘æ ¼</strong></p>
<ul>
<li>æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´è¢«<strong>å‡åŒ€åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç½‘æ ¼ï¼ˆmem_sectionï¼‰</strong>ã€‚</li>
<li>æ¯ä¸ªç½‘æ ¼ç¼–å·ä¸º <code>i</code>ï¼Œè´Ÿè´£ <code>[i * SECTION_SIZE, (i+1) * SECTION_SIZE)</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒå±‚ï¼šsection_mem_map è´¦æœ¬</strong></p>
<ul>
<li>æ¯ä¸ª**å­˜åœ¨å†…å­˜çš„ç½‘æ ¼ï¼ˆpresent sectionï¼‰**æ‹¥æœ‰ä¸€æœ¬â€œè´¦æœ¬â€ï¼ˆ<code>section_mem_map</code>ï¼‰ï¼Œè´¦æœ¬çš„æ¯ä¸€é¡µæ˜¯ä¸€ä¸ª <code>struct page</code>ï¼Œå¯¹åº”ç½‘æ ¼é‡Œçš„ä¸€ä¸ª PFNã€‚</li>
<li>è´¦æœ¬æ˜¯è¿ç»­é¡µç  0 ~ <code>PAGES_PER_SECTION-1</code>ï¼Œå¯ä»¥é€šè¿‡ç®€å•ç®—æœ¯æ‰¾åˆ°æŸä¸€é¡µã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¬¬ä¸‰å±‚ï¼špage æ ‡å¿—ä½</strong></p>
<ul>
<li><strong>çœŸå®å†…å­˜é¡µ</strong>ï¼šè´¦æœ¬è¯¥é¡µè®°å½•ä¸ºâ€œå¯ç”¨â€ï¼Œä¼šè¢«åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
<li><strong>å†…å­˜ç©ºæ´é¡µ</strong>ï¼šè´¦æœ¬è¯¥é¡µè®°å½•ä¸ºâ€œä¿ç•™/æ— æ•ˆâ€ï¼ˆä¾‹å¦‚ <code>PG_reserved</code>ï¼‰ï¼Œä¸ä¼šå‚ä¸åˆ†é…ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€»è¾‘ä¸Šçš„ start_pfn</strong></p>
<ul>
<li>æ¦‚å¿µä¸Šï¼šâ€œä¸º section è®¾å®š start_pfnâ€ã€‚</li>
<li>å®ç°ä¸Šï¼š<strong>é€šè¿‡ section ä¸‹æ ‡ * PAGES_PER_SECTION è®¡ç®—ï¼Œä¸å­˜æˆå­—æ®µã€‚</strong></li>
</ul>
</li>
</ol>
<p>è¿™æ ·ï¼Œä½ ä¹‹å‰é‚£å¥—å™è¿°ï¼š</p>
<ul>
<li>â€œmem_section ä¸éœ€è¦æ˜¯å®Œæ•´çš„ 256M å†…å­˜â€</li>
<li>â€œçƒ­æ’æ‹”ä¸è¦æ±‚æ˜¯ SECTION_SIZE çš„å€æ•°â€</li>
<li>â€œå†…å­˜ä¸ä¸€å®šä» section èµ·å§‹ PFN å¼€å§‹â€</li>
<li>â€œç©ºæ´ä¹Ÿä¼šæœ‰å¯¹åº” pageï¼ˆåœ¨ present section å†…éƒ¨ï¼‰â€</li>
<li>â€œstart_pfn æ˜¯é€šè¿‡ä½ç½®è®¡ç®—å‡ºæ¥çš„ï¼Œå¹¶ä¸çœŸæœ‰å­—æ®µâ€</li>
</ul>
<p>åœ¨é€»è¾‘å±‚é¢éƒ½æ˜¯<strong>è‡ªæ´½ä¸”ä¸å®ç°å»åˆçš„</strong>ã€‚åªè¦åŠ ä¸Šä¸€ä¸ªå°ä¿®æ­£ï¼š<br/>
<strong>â€œå®Œå…¨ç©ºçš„ section ä¸€èˆ¬è¿ mem_section/section_mem_map éƒ½ä¸ä¼šåˆ†é…ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰ <code>struct page</code>â€ï¼Œç©ºæ´æœ‰ page è¿™ä»¶äº‹æ˜¯â€œå­˜åœ¨äºå·²ç» present çš„ section å†…éƒ¨â€çš„è¯­å¢ƒä¸‹æˆç«‹çš„ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†]]></title>    <link>https://juejin.cn/post/7598433254128549928</link>    <guid>https://juejin.cn/post/7598433254128549928</guid>    <pubDate>2026-01-24T03:11:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598433254128549928" data-draft-id="7598403436699697186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†"/> <meta itemprop="keywords" content="åç«¯,Java,Redis"/> <meta itemprop="datePublished" content="2026-01-24T03:11:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºç å­—"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºç å­—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:11:23.000Z" title="Sat Jan 24 2026 03:11:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ‚Ÿã€‚</p>
<p>å¬è¯´ä½ è¦ç”¨Redisæ¥å¤„ç†è¶…æ—¶æ”¯ä»˜è®¢å•ï¼ŸRediså°±åƒä¸€ä¸ªä½åœ¨ä½ å†…å­˜é‡Œçš„é—ªç”µä¾ ï¼Œå®ƒè·‘å¾—é£å¿«ï¼Œä½†è®°æ€§æœ‰ç‚¹å·®ï¼ˆæ–­ç”µå°±å¤±å¿†ï¼‰ã€‚å®ƒæ˜¯ä¸ªé”®å€¼å¯¹å­˜å‚¨çš„ç¤¾äº¤ææƒ§ç—‡æ‚£è€…ï¼Œå°±å–œæ¬¢ç®€å•ç›´æ¥çš„äº¤æµã€‚ä¸è¿‡å¯¹ä»˜è®¢å•è¶…æ—¶è¿™ç§â€œé™æ—¶ä»»åŠ¡â€ï¼Œå®ƒå¯æ˜¯ä¸“ä¸šçš„â€œæ—¶é—´ç®¡ç†å¤§å¸ˆâ€ï¼</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆé€‰Redisæ¥åšè¿™ä¸ªï¼Ÿ</h2>
<p>ä½ å¼€äº†ä¸€å®¶ç½‘çº¢å¥¶èŒ¶åº—ï¼Œé¡¾å®¢ä¸‹å•å30åˆ†é’Ÿä¸ä»˜æ¬¾ï¼Œè®¢å•å°±è‡ªåŠ¨å–æ¶ˆã€‚ä½ æ€»ä¸èƒ½é›‡ä¸ªåº—å‘˜ç›¯ç€æ¯ä¸ªè®¢å•çœ‹30åˆ†é’Ÿå§ï¼ŸRedisçš„è¿‡æœŸé”®å’Œå‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œå°±æ˜¯é‚£ä¸ªä¸çŸ¥ç–²å€¦çš„â€œè‡ªåŠ¨å–æ¶ˆä¸“å‘˜â€ï¼</p>
<hr/>
<h2 data-id="heading-1">è¯¦ç»†æ­¥éª¤ï¼šè®©æˆ‘ä»¬å¼€å§‹ç»„è£…è¿™ä¸ªâ€œè®¢å•å–æ¶ˆæœºå™¨äººâ€</h2>
<h3 data-id="heading-2">ç¬¬1æ­¥ï¼šå¼•å…¥Redisä¾èµ–åŒ…</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml é‡ŒåŠ å…¥è¿™ä¸ªâ€œèƒ½é‡é¥®æ–™â€ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">ç¬¬2æ­¥ï¼šé…ç½®Redisè¿æ¥</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-comment"># Redisçš„åœ°å€ï¼Œé»˜è®¤æ˜¯æœ¬åœ°6379ç«¯å£</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-comment"># å¯†ç ï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰</span>
    <span class="hljs-attr">password:</span> 
    <span class="hljs-comment"># æ•°æ®åº“ç´¢å¼•ï¼Œå°±åƒç»™é—ªç”µä¾ å®‰æ’çš„ç¬¬å‡ ä¸ªæˆ¿é—´</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-comment"># è¿æ¥æ± é…ç½®ï¼Œåˆ«è®©é—ªç”µä¾ ç´¯ç€äº†</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">100ms</span>
</code></pre>
<h3 data-id="heading-4">ç¬¬3æ­¥ï¼šé…ç½®RedisTemplate</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeInfo;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;

@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {
    
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
        RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);
        
        <span class="hljs-comment">// é”®çš„åºåˆ—åŒ– - å­—ç¬¦ä¸²åºåˆ—åŒ–</span>
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        
        <span class="hljs-comment">// å€¼çš„åºåˆ—åŒ– - JSONåºåˆ—åŒ–</span>
        Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.<span class="hljs-keyword">class</span>);
        ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
        mapper.<span class="hljs-built_in">registerModule</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">JavaTimeModule</span>());
        mapper.<span class="hljs-built_in">activateDefaultTyping</span>(
            mapper.<span class="hljs-built_in">getPolymorphicTypeValidator</span>(),
            ObjectMapper.DefaultTyping.NON_FINAL,
            JsonTypeInfo.As.PROPERTY
        );
        serializer.<span class="hljs-built_in">setObjectMapper</span>(mapper);
        
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(serializer);
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashValueSerializer</span>(serializer);
        
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
    }
}
</code></pre>
<h3 data-id="heading-5">ç¬¬4æ­¥ï¼šè®¢å•å®ä½“ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">Data</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">time</span>.<span class="hljs-property">LocalDateTime</span>;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> orderId;          <span class="hljs-comment">// è®¢å•ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> userId;           <span class="hljs-comment">// ç”¨æˆ·ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Double</span> amount;           <span class="hljs-comment">// è®¢å•é‡‘é¢</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> status;          <span class="hljs-comment">// è®¢å•çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²å–æ¶ˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> createTime;<span class="hljs-comment">// åˆ›å»ºæ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> expireTime;<span class="hljs-comment">// è¿‡æœŸæ—¶é—´</span>
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²è¿‡æœŸ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isExpired</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">isAfter</span>(expireTime);
    }
}
</code></pre>
<h3 data-id="heading-6">ç¬¬5æ­¥ï¼šRedisæœåŠ¡ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">StringRedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">TimeUnit</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisOrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> stringRedisTemplate;
    
    <span class="hljs-comment">// è®¢å•å‰ç¼€ï¼Œé¿å…é”®å†²çª</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> = <span class="hljs-string">"order:pay:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">ORDER_EXPIRE_CHANNEL</span> = <span class="hljs-string">"order.expire"</span>;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•å¹¶è®¾ç½®30åˆ†é’Ÿè¿‡æœŸæ—¶é—´
     * å°±åƒç»™é—ªç”µä¾ è¯´ï¼šâ€œç›¯ç€è¿™ä¸ªè®¢å•ï¼Œ30åˆ†é’Ÿåæé†’æˆ‘â€
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrderWithExpire</span>(<span class="hljs-params">Order order, int expireMinutes</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + order.<span class="hljs-title function_">getOrderId</span>();
        
        <span class="hljs-comment">// ä¿å­˜è®¢å•åˆ°Redisï¼Œ30åˆ†é’Ÿåè‡ªåŠ¨åˆ é™¤</span>
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(
            orderKey, 
            order, 
            expireMinutes, 
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MINUTES</span>
        );
        
        <span class="hljs-comment">// åŒæ—¶è®¾ç½®ä¸€ä¸ªç®€å•çš„æ ‡å¿—ï¼Œç”¨äºç›‘å¬è¿‡æœŸäº‹ä»¶</span>
        stringRedisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(
            orderKey + <span class="hljs-string">":flag"</span>, 
            <span class="hljs-string">"1"</span>, 
            expireMinutes, 
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MINUTES</span>
        );
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + order.<span class="hljs-title function_">getOrderId</span>() + <span class="hljs-string">" å·²æ”¾å…¥Redisï¼Œè®¾ç½®"</span> + 
                          expireMinutes + <span class="hljs-string">"åˆ†é’Ÿåè¿‡æœŸ"</span>);
    }
    
    <span class="hljs-comment">/**
     * ç”¨æˆ·æ”¯ä»˜æˆåŠŸï¼Œåˆ é™¤è¿‡æœŸé”®
     * ç›¸å½“äºå‘Šè¯‰é—ªç”µä¾ ï¼šâ€œä¸ç”¨ç›¯äº†ï¼Œé¡¾å®¢ä»˜é’±äº†ï¼â€
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handlePaymentSuccess</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        
        <span class="hljs-comment">// æ‰‹åŠ¨åˆ é™¤è®¢å•å’Œæ ‡å¿—</span>
        redisTemplate.<span class="hljs-title function_">delete</span>(orderKey);
        stringRedisTemplate.<span class="hljs-title function_">delete</span>(orderKey + <span class="hljs-string">":flag"</span>);
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" æ”¯ä»˜æˆåŠŸï¼Œå·²ä»Redisç§»é™¤"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥è®¢å•æ˜¯å¦è¿˜å­˜åœ¨ï¼ˆæ˜¯å¦å·²è¿‡æœŸï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isOrderExist</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(redisTemplate.<span class="hljs-title function_">hasKey</span>(orderKey));
    }
    
    <span class="hljs-comment">/**
     * è·å–è®¢å•ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Order</span> <span class="hljs-title function_">getOrder</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Order</span>) redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(orderKey);
    }
}
</code></pre>
<h3 data-id="heading-7">ç¬¬6æ­¥ï¼šRedisè¿‡æœŸç›‘å¬é…ç½®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.PatternTopic;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.RedisMessageListenerContainer;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.adapter.MessageListenerAdapter;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisExpireConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedisMessageListenerContainer container(
            RedisConnectionFactory connectionFactory,
            MessageListenerAdapter listenerAdapter) {
        
        RedisMessageListenerContainer container = new RedisMessageListenerContainer();
        container.setConnectionFactory(connectionFactory);
        
        <span class="hljs-comment">// ç›‘å¬æ‰€æœ‰keyè¿‡æœŸäº‹ä»¶</span>
        container.addMessageListener(listenerAdapter, 
            new PatternTopic(<span class="hljs-string">"__keyevent@0__:expired"</span>));
        
        <span class="hljs-keyword">return</span> container;
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MessageListenerAdapter listenerAdapter(RedisKeyExpireListener receiver) {
        <span class="hljs-keyword">return</span> new MessageListenerAdapter(receiver, <span class="hljs-string">"handleMessage"</span>);
    }
}
</code></pre>
<h3 data-id="heading-8">ç¬¬7æ­¥ï¼šè¿‡æœŸäº‹ä»¶ç›‘å¬å™¨</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.<span class="hljs-type">Autowired</span>;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.<span class="hljs-type">Message</span>;
<span class="hljs-keyword">import</span> org.springframework.data.redis.listener.adapter.<span class="hljs-type">MessageListenerAdapter</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Component</span>;
<span class="hljs-keyword">import</span> java.nio.charset.<span class="hljs-type">StandardCharsets</span>;

<span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisKeyExpireListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MessageListenerAdapter</span> </span>{
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">OrderService</span> orderService;
    
    <span class="hljs-comment">/**
     * å½“Redisé”®è¿‡æœŸæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨
     * é—ªç”µä¾ ä¼šå–Šï¼šâ€œå˜¿ï¼é‚£ä¸ªè®¢å•è¿‡æœŸäº†ï¼â€
     */</span>
    <span class="hljs-meta">@Override</span>
    public void handleMessage(<span class="hljs-type">Message</span> message, byte[] pattern) {
        <span class="hljs-type">String</span> expiredKey = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>(message.getBody(), <span class="hljs-type">StandardCharsets</span>.<span class="hljs-type">UTF_8</span>);
        
        <span class="hljs-comment">// åªå¤„ç†æˆ‘ä»¬çš„è®¢å•è¿‡æœŸé”®</span>
        <span class="hljs-keyword">if</span> (expiredKey.startsWith(<span class="hljs-string">"order:pay:"</span>)) {
            <span class="hljs-comment">// å»æ‰":flag"åç¼€è·å–è®¢å•ID</span>
            <span class="hljs-type">String</span> orderId = expiredKey
                .replace(<span class="hljs-string">"order:pay:"</span>, <span class="hljs-string">""</span>)
                .replace(<span class="hljs-string">":flag"</span>, <span class="hljs-string">""</span>);
            
            <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"RedisæŠ¥å‘Šï¼šè®¢å• "</span> + orderId + <span class="hljs-string">" å·²è¶…æ—¶ï¼"</span>);
            
            <span class="hljs-comment">// å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘</span>
            orderService.cancelExpiredOrder(orderId);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">ç¬¬8æ­¥ï¼šè®¢å•æœåŠ¡å±‚</h3>
<pre><code class="hljs language-scss" lang="scss">import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.stereotype</span><span class="hljs-selector-class">.Service</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Transactional</span>;

<span class="hljs-keyword">@Service</span>
public class OrderService {
    
    <span class="hljs-keyword">@Autowired</span>
    private RedisOrderService redisOrderService;
    
    <span class="hljs-keyword">@Autowired</span>
    private OrderRepository orderRepository;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public Order createOrder(String userId, Double amount) {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderId</span>(generateOrderId());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserId</span>(userId);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(amount);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// å¾…æ”¯ä»˜</span>
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setCreateTime</span>(LocalDateTime.now());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setExpireTime</span>(LocalDateTime.now()<span class="hljs-selector-class">.plusMinutes</span>(<span class="hljs-number">30</span>));
        
        <span class="hljs-comment">// ä¿å­˜åˆ°æ•°æ®åº“</span>
        orderRepository<span class="hljs-selector-class">.save</span>(order);
        
        <span class="hljs-comment">// ä¿å­˜åˆ°Rediså¹¶è®¾ç½®30åˆ†é’Ÿè¿‡æœŸ</span>
        redisOrderService<span class="hljs-selector-class">.createOrderWithExpire</span>(order, <span class="hljs-number">30</span>);
        
        return <span class="hljs-attribute">order</span>;
    }
    
    <span class="hljs-comment">/**
     * å¤„ç†æ”¯ä»˜å›è°ƒ
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void handlePaymentCallback(String orderId) {
        <span class="hljs-comment">// æ£€æŸ¥è®¢å•æ˜¯å¦å·²è¿‡æœŸ</span>
        if (!redisOrderService.isOrderExist(orderId)) {
            throw new <span class="hljs-built_in">RuntimeException</span>("è®¢å•å·²è¶…æ—¶ï¼Œè¯·é‡æ–°ä¸‹å•");
        }
        
        <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</span>
        orderRepository<span class="hljs-selector-class">.updateOrderStatus</span>(orderId, <span class="hljs-number">1</span>);
        
        <span class="hljs-comment">// ä»Redisç§»é™¤è¿‡æœŸé”®</span>
        redisOrderService<span class="hljs-selector-class">.handlePaymentSuccess</span>(orderId);
        
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è®¢å• " + orderId + " æ”¯ä»˜å¤„ç†å®Œæˆ");
    }
    
    <span class="hljs-comment">/**
     * å–æ¶ˆè¶…æ—¶è®¢å•
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void cancelExpiredOrder(String orderId) {
        <span class="hljs-comment">// å†æ¬¡æ£€æŸ¥ï¼Œé˜²æ­¢é‡å¤å¤„ç†</span>
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = orderRepository<span class="hljs-selector-class">.findById</span>(orderId);
        if (order != null &amp;&amp; order.getStatus() == <span class="hljs-number">0</span>) {
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// å·²å–æ¶ˆ</span>
            orderRepository<span class="hljs-selector-class">.save</span>(order);
            
            <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾åº“å­˜ã€å‘é€é€šçŸ¥ç­‰</span>
            System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è®¢å• " + orderId + " å› è¶…æ—¶æœªæ”¯ä»˜å·²è¢«è‡ªåŠ¨å–æ¶ˆ");
            
            <span class="hljs-comment">// å‘é€å–æ¶ˆé€šçŸ¥</span>
            <span class="hljs-built_in">sendCancelNotification</span>(order);
        }
    }
    
    <span class="hljs-comment">/**
     * å‘é€å–æ¶ˆé€šçŸ¥ï¼ˆæ¨¡æ‹Ÿï¼‰
     */</span>
    private void <span class="hljs-built_in">sendCancelNotification</span>(Order order) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥é›†æˆæ¶ˆæ¯é˜Ÿåˆ—ã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰</span>
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("å‘é€é€šçŸ¥ï¼šäº²çˆ±çš„ç”¨æˆ·" + order.getUserId() + 
                          "ï¼Œæ‚¨çš„è®¢å•" + <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getOrderId</span>() + "å› è¶…æ—¶æœªæ”¯ä»˜å·²å–æ¶ˆ");
    }
    
    private String <span class="hljs-built_in">generateOrderId</span>() {
        return "ORD" + System<span class="hljs-selector-class">.currentTimeMillis</span>() + 
               (int)(Math.random() * <span class="hljs-number">1000</span>);
    }
}
</code></pre>
<h3 data-id="heading-10">ç¬¬9æ­¥ï¼šæ§åˆ¶å™¨å±‚</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.*;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/orders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderService</span> orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisOrderService</span> redisOrderService;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span> <span class="hljs-built_in">String</span> userId, 
                                <span class="hljs-meta">@RequestParam</span> Double amount</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Order</span> order = orderService.<span class="hljs-title function_">createOrder</span>(userId, amount);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸ"</span>, order);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è®¢å•åˆ›å»ºå¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    
    <span class="hljs-comment">/**
     * æ¨¡æ‹Ÿæ”¯ä»˜
     */</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/pay"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">payOrder</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span> <span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†æ—¶é—´</span>
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>);
            
            orderService.<span class="hljs-title function_">handlePaymentCallback</span>(orderId);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ”¯ä»˜å¤„ç†ä¸­æ–­"</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ”¯ä»˜å¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥è®¢å•çŠ¶æ€
     */</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/status/{orderId}"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">checkOrderStatus</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-built_in">boolean</span> exists = redisOrderService.<span class="hljs-title function_">isOrderExist</span>(orderId);
        <span class="hljs-keyword">if</span> (exists) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•æœ‰æ•ˆï¼Œè¯·å°½å¿«æ”¯ä»˜"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•å·²è¶…æ—¶æˆ–ä¸å­˜åœ¨"</span>);
        }
    }
}

<span class="hljs-comment">// ç®€å•çš„è¿”å›ç»“æœç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResult</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> success;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> message;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> data;
    
    <span class="hljs-comment">// æ„é€ æ–¹æ³•å’Œgetter/setterçœç•¥...</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">success</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">true</span>, message, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">success</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message, <span class="hljs-built_in">Object</span> data</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">true</span>, message, data);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">error</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">false</span>, message, <span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">ç¬¬10æ­¥ï¼šåˆ«å¿˜äº†å¼€å¯Redisçš„é”®ç©ºé—´é€šçŸ¥ï¼ˆé‡è¦ï¼ï¼‰</h3>
<p>åœ¨Redisé…ç½®æ–‡ä»¶(redis.conf)ä¸­æˆ–é€šè¿‡Rediså‘½ä»¤è¡Œå¼€å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶</span>
notify-keyspace-events <span class="hljs-string">"Ex"</span>

<span class="hljs-comment"># æ–¹å¼2ï¼šå‘½ä»¤è¡Œï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰</span>
redis-cli config <span class="hljs-built_in">set</span> notify-keyspace-events Ex
</code></pre>
<p>æˆ–è€…åœ¨ä½ çš„Spring Bootåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">CommandLineRunner</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfigRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> stringRedisTemplate;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>... args</span>) {
        <span class="hljs-comment">// å¼€å¯é”®è¿‡æœŸäº‹ä»¶é€šçŸ¥</span>
        stringRedisTemplate.<span class="hljs-title function_">getConnectionFactory</span>()
            .<span class="hljs-title function_">getConnection</span>()
            .<span class="hljs-title function_">serverCommands</span>()
            .<span class="hljs-title function_">configSet</span>(<span class="hljs-string">"notify-keyspace-events"</span>, <span class="hljs-string">"Ex"</span>);
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Redisé”®ç©ºé—´é€šçŸ¥å·²å¼€å¯"</span>);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">å®Œæ•´çš„å·¥ä½œæµç¨‹</h2>
<ol>
<li><strong>é¡¾å®¢ä¸‹å•</strong>ï¼š<code>POST /orders/create</code> â†’ è®¢å•å­˜å…¥æ•°æ®åº“å’ŒRedisï¼Œå¼€å§‹30åˆ†é’Ÿå€’è®¡æ—¶</li>
<li><strong>Redisç›¯æ¢¢</strong>ï¼šé—ªç”µä¾ å¼€å§‹è®¡æ—¶ï¼Œ30åˆ†é’Ÿå¯¸æ­¥ä¸ç¦»</li>
<li><strong>é¡¾å®¢æ”¯ä»˜</strong>ï¼š
<ul>
<li>30åˆ†é’Ÿå†…æ”¯ä»˜ï¼š<code>POST /orders/pay</code> â†’ Redisåˆ é™¤è®¢å•ï¼Œäº¤æ˜“å®Œæˆ</li>
<li>è¶…è¿‡30åˆ†é’Ÿï¼šRedisé”®è‡ªåŠ¨è¿‡æœŸ â†’ è§¦å‘è¿‡æœŸäº‹ä»¶ â†’ è‡ªåŠ¨å–æ¶ˆè®¢å•</li>
</ul>
</li>
<li><strong>ç³»ç»Ÿé€šçŸ¥</strong>ï¼šç»™é¡¾å®¢å‘é€â€œè®¢å•å·²å–æ¶ˆâ€çš„è´´å¿ƒå°æç¤º</li>
</ol>
<hr/>
<h2 data-id="heading-13">ä¸€äº›é«˜çº§ç©æ³•</h2>
<h3 data-id="heading-14">æ–¹æ¡ˆä¼˜åŒ–ï¼šä½¿ç”¨Redissonçš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ›´å¯é ï¼‰</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.redisson.api.RBlockingDeque;
<span class="hljs-keyword">import</span> org.redisson.api.RDelayedQueue;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> javax.annotation.PostConstruct;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonOrderService</span> {
    
    @Autowired
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">private</span> RBlockingDeque&lt;<span class="hljs-type">String</span>&gt; orderQueue;
    <span class="hljs-keyword">private</span> RDelayedQueue&lt;<span class="hljs-type">String</span>&gt; delayedQueue;
    
    @<span class="hljs-function">PostConstruct
    <span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        orderQueue = redissonClient.<span class="hljs-built_in">getBlockingDeque</span>(<span class="hljs-string">"orderDelayQueue"</span>);
        delayedQueue = redissonClient.<span class="hljs-built_in">getDelayedQueue</span>(orderQueue);
        
        <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Thread</span>(<span class="hljs-keyword">this</span>::consumeExpiredOrders).<span class="hljs-built_in">start</span>();
    }
    
    <span class="hljs-comment">/**
     * æ·»åŠ å»¶è¿Ÿè®¢å•
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">addDelayOrder</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId, <span class="hljs-type">long</span> delay, TimeUnit unit)</span> </span>{
        delayedQueue.<span class="hljs-built_in">offer</span>(orderId, delay, unit);
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å·²åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œ"</span>
            + delay + <span class="hljs-string">" "</span> + unit + <span class="hljs-string">"åè¿‡æœŸ"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ¶ˆè´¹è¿‡æœŸè®¢å•
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">consumeExpiredOrders</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// é˜»å¡è·å–è¿‡æœŸè®¢å•</span>
                <span class="hljs-type">String</span> orderId = orderQueue.<span class="hljs-built_in">take</span>();
                System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"å»¶è¿Ÿé˜Ÿåˆ—æŠ¥å‘Šï¼šè®¢å• "</span> + orderId + <span class="hljs-string">" å·²è¿‡æœŸ"</span>);
                <span class="hljs-comment">// å¤„ç†è®¢å•å–æ¶ˆé€»è¾‘...</span>
            } <span class="hljs-built_in">catch</span> (InterruptedException e) {
                Thread.<span class="hljs-built_in">currentThread</span>().<span class="hljs-built_in">interrupt</span>();
                <span class="hljs-keyword">break</span>;
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-15">æ³¨æ„äº‹é¡¹ï¼šé˜²é‡å¤å¤„ç†ï¼ˆå¹‚ç­‰æ€§ï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åœ¨OrderServiceä¸­æ·»åŠ é˜²é‡å¤å¤„ç†</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">cancelExpiredOrder</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
    <span class="hljs-comment">// ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢å¤šä¸ªå®ä¾‹åŒæ—¶å¤„ç†åŒä¸€ä¸ªè®¢å•</span>
    <span class="hljs-title class_">String</span> lockKey = <span class="hljs-string">"order:cancel:lock:"</span> + orderId;
    <span class="hljs-title class_">Boolean</span> locked = redisTemplate.<span class="hljs-title function_">opsForValue</span>()
        .<span class="hljs-title function_">setIfAbsent</span>(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">30</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(locked)) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å†æ¬¡æ£€æŸ¥è®¢å•çŠ¶æ€ï¼ˆåŒé‡æ ¡éªŒï¼‰</span>
            <span class="hljs-title class_">Order</span> order = orderRepository.<span class="hljs-title function_">findById</span>(orderId);
            <span class="hljs-keyword">if</span> (order != <span class="hljs-literal">null</span> &amp;&amp; order.<span class="hljs-title function_">getStatus</span>() == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€</span>
                order.<span class="hljs-title function_">setStatus</span>(<span class="hljs-number">2</span>);
                orderRepository.<span class="hljs-title function_">save</span>(order);
                
                <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å·²å–æ¶ˆ"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾é”</span>
            redisTemplate.<span class="hljs-title function_">delete</span>(lockKey);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">æ€»ç»“</h2>
<ol>
<li><strong>æ€§èƒ½çˆ†è¡¨</strong>ï¼šRedisåŸºäºå†…å­˜æ“ä½œï¼Œå¤„ç†é€Ÿåº¦å ªæ¯”é—ªç”µä¾ è·‘æ­¥</li>
<li><strong>ç²¾å‡†å®šæ—¶</strong>ï¼šRedisçš„è¿‡æœŸæœºåˆ¶ç²¾å‡†å¯é ï¼Œè¯¯å·®æå°</li>
<li><strong>è§£è€¦ç¥å™¨</strong>ï¼šä¸šåŠ¡é€»è¾‘å’Œå®šæ—¶ä»»åŠ¡åˆ†ç¦»ï¼Œä»£ç æ¸…çˆ½ä¸æ²¹è…»</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šè½»æ¾åº”å¯¹é«˜å¹¶å‘ï¼ŒåŠ ä¸ªRedisé›†ç¾¤å°±èƒ½æ’‘èµ·åŒ11</li>
<li><strong>èµ„æºå‹å¥½</strong>ï¼šä¸éœ€è¦é¢å¤–çš„å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶ï¼Œçœå¿ƒçœåŠ›</li>
</ol>
<h3 data-id="heading-17">ä½†ä¹Ÿè¦æ³¨æ„è¿™äº›â€œå‘â€</h3>
<ol>
<li><strong>RedisæŒä¹…åŒ–</strong>ï¼šè®°å¾—é…ç½®RDB/AOFï¼Œä¸ç„¶é—ªç”µä¾ â€œå¤±å¿†â€å°±éº»çƒ¦äº†</li>
<li><strong>ç½‘ç»œæ³¢åŠ¨</strong>ï¼šRedisæŒ‚äº†æ€ä¹ˆåŠï¼Ÿè¦æœ‰é™çº§æ–¹æ¡ˆ</li>
<li><strong>äº‹ä»¶ä¸¢å¤±</strong>ï¼šRedisçš„è¿‡æœŸäº‹ä»¶å¯èƒ½ä¸¢å¤±ï¼Œé‡è¦ä¸šåŠ¡è¦æœ‰è¡¥å¿æœºåˆ¶</li>
<li><strong>æ—¶é’ŸåŒæ­¥</strong>ï¼šå¤šæœåŠ¡å™¨æ—¶é—´è¦åŒæ­¥ï¼Œåˆ«è‡ªå·±äººè·Ÿè‡ªå·±äººâ€œæ‰“æ¶â€</li>
</ol>
<h3 data-id="heading-18">æœ€å</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>æ²¡æœ‰Redisæ—¶</strong>ï¼šä½ çš„æ•°æ®åº“è¢«å®šæ—¶ä»»åŠ¡æ‰«å¾—æ°”å–˜ååï¼Œæ¯æ¬¡éƒ½è¦é—®ï¼šâ€œå“ªäº›è®¢å•è¶…æ—¶äº†ï¼Ÿâ€</li>
<li><strong>æœ‰äº†Rediså</strong>ï¼šRedisä¸»åŠ¨æŠ¥å‘Šï¼šâ€œå˜¿ï¼è¿™å‡ ä¸ªè®¢å•è¶…æ—¶äº†ï¼Œå¿«å¤„ç†ï¼â€</li>
</ul>
<p>è¿™å°±å¥½æ¯”ä»â€œæŒ¨å®¶æŒ¨æˆ·æŸ¥æ°´è¡¨â€å˜æˆäº†â€œæ°´è¡¨è‡ªå·±æ‰“ç”µè¯æŠ¥è­¦â€ï¼Œæ•ˆç‡æå‡ä¸æ˜¯ä¸€ç‚¹ç‚¹ï¼å¥½çš„æ¶æ„ï¼Œå°±æ˜¯è®©åˆé€‚çš„å·¥å…·åšåˆé€‚çš„äº‹ã€‚Rediså°±æ˜¯è¿™ä¸ªåœºæ™¯ä¸‹çš„â€œæ—¶é—´ç®¡ç†å¤§å¸ˆâ€ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04e2ea61814e417594933b11fce70870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769829083&amp;x-signature=vH21V3wt2UbwxjZejrCP%2FHPN1L4%3D" alt="åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†.png" loading="lazy"/></p>
<p><strong>è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµã€è½¬å‘ã€åœ¨çœ‹ä¸‰è¿å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ã€‚é‚£æˆ‘ä»¬ï¼Œä¸‹æ¬¡å†è§ã€‚</strong></p>
<p>æ‚¨çš„ä¸€é”®ä¸‰è¿ï¼Œæ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢</p>
<p>å±±æ°´æœ‰ç›¸é€¢ï¼Œæ¥æ—¥çš†å¯æœŸï¼Œè°¢è°¢é˜…è¯»ï¼Œæˆ‘ä»¬å†ä¼š</p>
<p>æˆ‘æ‰‹ä¸­çš„é‡‘ç®æ£’ï¼Œä¸Šèƒ½é€šå¤©ï¼Œä¸‹èƒ½æ¢æµ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰]]></title>    <link>https://juejin.cn/post/7598445152158302259</link>    <guid>https://juejin.cn/post/7598445152158302259</guid>    <pubDate>2026-01-24T03:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598445152158302259" data-draft-id="7598389448147615754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T03:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QZQ54188"/> <meta itemprop="url" content="https://juejin.cn/user/666776045362473"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/666776045362473/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QZQ54188
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:13:59.000Z" title="Sat Jan 24 2026 03:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç½‘å…³å±‚æˆ‘ä»¬é€šè¿‡Epollå®ç°äº†å¯¹äºç”¨æˆ·é•¿è¿æ¥FDçš„ç›‘å¬ï¼Œå¤§å¤§å‡å°‘äº†åç¨‹æ•°çš„æ¶ˆè€—ï¼Œè¿˜é€šè¿‡gateWayå°†æ¶ˆæ¯è½¬å‘ç»™StateServerè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ç½‘å…³å±‚å°±åªè´Ÿè´£ç»´æŠ¤é•¿è¿æ¥FDå’Œç”¨æˆ·IDä¸é•¿è¿æ¥FDçš„æ˜ å°„å…³ç³»ï¼Œè¿™éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ååˆ†ç¨³å®šï¼Œå‡ ä¹ä¸éœ€è¦å˜æ›´ï¼Œæ‰€ä»¥ç½‘å…³å±‚ä¸ä¼šå› ä¸ºä¸šåŠ¡çš„å˜æ›´è€Œé¢‘ç¹é‡å¯ï¼Œå¯¼è‡´ç½‘å…³ä¸Šçš„æ‰€æœ‰é•¿è¿æ¥è¢«æ–­å¼€ã€‚</p>
<h2 data-id="heading-0">StateServerèŒè´£</h2>
<p>æˆ‘ä»¬å°†ä¸šåŠ¡éƒ¨åˆ†è½¬ç§»åˆ°äº†StateServerè¿™ä¸ªæœåŠ¡ä¸­ï¼Œç½‘å…³è´Ÿè´£ç›‘å¬ç”¨æˆ·FDï¼Œå½“ç¼“å†²åŒºä¸­æœ‰æ•°æ®æ—¶å°±ä¼šå”¤é†’Epollç„¶åæŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æŒ‰ç…§websocketçš„æ ¼å¼è§£æHeaderå’ŒPayloadï¼Œç„¶åç›´æ¥å°†Payloadé€šè¿‡grpcè½¬å‘ç»™StateServerè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·gateWayåªè´Ÿè´£é€ä¼ ï¼ŒStateServerè´Ÿè´£é€»è¾‘å¤„ç†çš„æ¶æ„ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰äºŒè€…ä¹‹é—´çš„é€šä¿¡åè®®ï¼Œä¹Ÿå°±æ˜¯Protobufå®šä¹‰ã€‚</p>
<p>StateServeréœ€è¦å®ç°ä¸€ä¸ªåè®®è§£ææ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥è§£ægateWayå‘é€è¿‡æ¥çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç„¶åæ ¹æ®è¿™ä¸ªç±»å‹è¿›è¡Œå¤„ç†é€»è¾‘çš„è·¯ç”±ï¼Œè¿™æ ·çš„è¯äºŒè€…çš„æ¶ˆæ¯ç»“æ„å°±æ¸…æ™°äº†ã€‚gateWayè§£æwsçš„Headerï¼Œæ ¹æ®Headerçš„é•¿åº¦å­—æ®µä»ç¼“å†²åŒºä¸­è¯»å–Payloadï¼Œç„¶åé€šè¿‡grpcå°†è¿™ä¸ªPayloadè½¬å‘ç»™StateServerï¼Œè¿™ä¸ªPayloadæœ¬èº«å°±æ˜¯ç”±msgTypeå’Œmsgç»„æˆçš„ï¼Œè¿™éƒ¨åˆ†ç”±StateServerçš„åè®®è§£ææ¨¡å—è¿›è¡Œç»´æŠ¤ï¼Œæœ€åè·¯ç”±åˆ°ä¸šåŠ¡å±‚è¿›è¡Œå¤„ç†ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼ŒStateServerçš„èŒè´£ä¸»è¦æ˜¯åè®®è§£æä¸åˆ†å‘ï¼Œä¹‹å‰è¿˜è¯´è¿‡StateServerè¿˜éœ€è¦ç»´æŠ¤å“ªä¸ªç”¨æˆ·åœ¨å“ªå°ç½‘å…³æœºå™¨ä¸Šï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œä¸šåŠ¡æ¶ˆæ¯çš„è½¬å‘ï¼Œæ‰€ä»¥StateServerè¿˜ç»´æŠ¤ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼ˆUser A -&gt; Gateway 1ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼ŒStateServerè¿˜æœ‰ä¸€ä¸ªè‡³å…³é‡è¦çš„èŒè´£å°±æ˜¯ç»´æŠ¤å¿ƒè·³ï¼Œåœ¨é•¿è¿æ¥æ¶æ„ä¸­å¿ƒè·³æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨APPæ—¶ä¼šç»å¸¸é‡åˆ°æ–­ç½‘ï¼ˆæ‰‹åŠ¨å…³é—­ï¼Œè¿›å…¥ç”µæ¢¯ï¼Œéš§é“ï¼‰çš„æƒ…å†µï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå®¢æˆ·ç«¯æ ¹æœ¬æ²¡æœ‰åŠæ³•å‘é€TCPçš„FINåŒ…ç»™æœåŠ¡ç«¯ï¼Œæ ¹æ® TCP åè®®ç‰¹æ€§ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ä¼ è¾“ï¼ŒæœåŠ¡ç«¯ä¼šä¸€ç›´è®¤ä¸ºè¿™ä¸ªè¿æ¥æ˜¯å¥åº·çš„ã€‚è¿™å°±å¯¼è‡´æœåŠ¡å™¨ä¸Šä¼šå †ç§¯æˆåƒä¸Šä¸‡ä¸ªæ— æ•ˆçš„â€œåƒµå°¸è¿æ¥â€ï¼Œç™½ç™½å ç”¨ç€å†…å­˜å’Œæ–‡ä»¶æè¿°ç¬¦ã€‚StateServeré€šè¿‡å¿ƒè·³æ¥å®æ–½å¥åº·æ£€æµ‹ï¼Œå¦‚æœåœ¨ä¸€å®šäº‹ä»¶å†…æ²¡æœ‰æ”¶åˆ°ç”¨æˆ·çš„å¿ƒè·³ï¼ŒStateServrå°±å¯ä»¥æ–­å®šè¯¥ç”¨æˆ·ä»¥åŠæ‰çº¿ï¼Œä»è€Œä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œæ¸…ç†ç”¨æˆ·ç›¸å…³éƒ¨åˆ†ã€‚å¦‚æœä¸å³æ—¶æ¸…ç†çš„è¯ï¼Œå¦‚æœæœ‰ç”¨æˆ·ç»™ç¦»çº¿ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼ŒStateServerä»¥ä¸ºç¦»çº¿ç”¨æˆ·è¿˜åœ¨çº¿ï¼Œå°±ä¼šç»™å¯¹åº”ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œç„¶åè¶…æ—¶ï¼Œå†æ¬¡å‘é€æµªè´¹ç½‘ç»œå¸¦å®½ã€‚</p>
<h2 data-id="heading-1">åè®®éƒ¨åˆ†</h2>
<p>ä¹‹å‰æˆ‘ä»¬å®šä¹‰äº†<code>state.proto</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸»è¦æè¿°äº†gateWayå’ŒStateServerä¹‹é—´çš„äº¤äº’åè®®ï¼Œä¸»è¦å­—æ®µæœ‰UserIDï¼Œè¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘é€çš„ï¼Œpayloadå°±æ˜¯æˆ‘ä»¬è¯´çš„è´Ÿè½½ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡è§£æwebsocketçš„è´Ÿè½½æ¥çš„ï¼Œè¿˜æœ‰gateway_idç”¨äºå‘ŠçŸ¥StateServerè¿™ä¸ªç”¨æˆ·åœ¨å“ªå°ç½‘å…³æœºå™¨ä¸Šï¼Œä¾¿äºå›è°ƒã€‚</p>
<p>ç„¶è€Œ<code>state.proto</code>å®šä¹‰çš„åªæ˜¯gateWayå’ŒStateServerä¹‹é—´çš„é€šä¿¡æµç¨‹ï¼Œå…¶ä¸­å…³é”®çš„payloadå­—æ®µç›®å‰è¿˜æ˜¯ä¸€ä¸²æœªçŸ¥çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä¸ºäº†è®©StateServerèƒ½è¯»æ‡‚è¿™ä¸²æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ç¬¬äºŒå±‚åè®®ï¼Œä¹Ÿå°±æ˜¯ç«¯åˆ°ç«¯çš„ä¸šåŠ¡æ¶ˆæ¯åè®®<code>protocal.proto</code>ã€‚</p>
<p>è®¾è®¡è¿™ä¸ªæ¶ˆæ¯åè®®çš„æ—¶å€™æˆ‘é‡‡ç”¨äº†ä¸¤å±‚åµŒå¥—çš„æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-protobuf" lang="protobuf">// CommandType å®šä¹‰æ¶ˆæ¯ç±»å‹
enum CommandType {
    UNKNOWN = 0;
    LOGIN = 1;      // ç™»å½•
    HEARTBEAT = 2;  // å¿ƒè·³
    MESSAGE = 3;    // èŠå¤©æ¶ˆæ¯ (ä¿¡ä»¤)
}

// Command æ˜¯æœ€å¤–å±‚çš„å°åŒ…ç»“æ„ (Envelope)
message Command {
    CommandType type = 1; // æ¶ˆæ¯ç±»å‹
    bytes data = 2;       // å…·ä½“çš„ä¸šåŠ¡æ¶ˆæ¯ Payload (åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶)
}

// LoginCommand ç™»å½•æ¶ˆæ¯
message LoginCommand {
    string token = 1;    // é‰´æƒ Token
    bytes extra = 2;     // æ‰©å±•å­—æ®µ
}

// HeartbeatCommand å¿ƒè·³æ¶ˆæ¯
message HeartbeatCommand {
    int64 timestamp = 1; // å®¢æˆ·ç«¯æ—¶é—´æˆ³
}

// MessageCommand èŠå¤©æ¶ˆæ¯ (ä¿¡ä»¤)
message MessageCommand {
    string uuid = 1;        // æ¶ˆæ¯å”¯ä¸€ID
    int32 type = 2;         // æ¶ˆæ¯ç±»å‹ (æ–‡æœ¬/å›¾ç‰‡ç­‰)
    string content = 3;     // æ¶ˆæ¯å†…å®¹
    string receiver_id = 4; // æ¥æ”¶è€…ID (ç¾¤èŠåˆ™æ˜¯ç¾¤ID)
    int32 conversation_type = 5; // ä¼šè¯ç±»å‹ (1=å•èŠ, 2=ç¾¤èŠ)
    bytes extra = 6;        // æ‰©å±•å­—æ®µ
}
</code></pre>
<p>å¤–å±‚åŒ…è£…æ˜¯<code>Command</code>ï¼Œè¿™æ˜¯æ‰€æœ‰ä¸šåŠ¡æ¶ˆæ¯çš„ç»Ÿä¸€å…¥å£ï¼Œå…¶ä¸­typeå­—æ®µè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¶ˆæ¯ï¼Œdataå­—æ®µå°±æ˜¯å…·ä½“çš„ä¸šåŠ¡æ•°æ®ï¼Œæ ¹æ®typeçš„ä¸åŒååºåˆ—åŒ–ä¸ºä¸åŒçš„å†…å±‚ç»“æ„ä½“ï¼Œè¿™ç§è®¾è®¡è®©StateServerå¯ä»¥å…ˆè§£æå¤–å±‚ï¼Œæ‹¿åˆ°æ¶ˆæ¯ç±»å‹ï¼Œå†é€šè¿‡è·¯ç”±åˆ†å‘å»è§£æå†…å±‚ï¼Œå®ç°äº†æä½³çš„æ‰©å±•æ€§ã€‚</p>
<p>å†…å±‚æ¶ˆæ¯å°±æ˜¯åé¢ä¸‰ä¸ªå…·ä½“çš„ç»“æ„ä½“ï¼Œè¿™é‡Œæˆ‘å…ˆå®ç°è¿™ä¸‰ä¸ªï¼Œæœ‰éœ€è¦çš„è¯å†åœ¨åé¢è¡¥å……ã€‚å†…å±‚æ¶ˆæ¯å°±æ˜¯å®¢æˆ·ç«¯å®é™…å‘é€çš„æ¶ˆæ¯ï¼Œä¸è¿‡åœ¨å‘é€æ—¶è¢«æ‰“åŒ…æˆäº†<code>Command</code>ï¼Œåºåˆ—åŒ–ä¹‹åé€šè¿‡WebSocketå‘é€ç»™GateWayï¼ŒGateWayå°†å…¶ä½œä¸ºPayloadå°è£…è¿›ä¹‹å‰è¯´è¿‡çš„<code>state.proto</code>ä¸­çš„è¯·æ±‚ä½“ä¸­ï¼Œé€ä¼ ç»™StateServerï¼›æœ€ç»ˆç”±StateServerå±‚å±‚æ‹†åŒ…ï¼Œè¿˜åŸå‡ºåŸå§‹çš„ä¸šåŠ¡æ„å›¾ã€‚</p>
<h2 data-id="heading-2">StateServeræ”¹é€ </h2>
<p>ä¹‹å‰æˆ‘ä»¬çš„StateServerå®ç°éå¸¸æš´åŠ›ï¼Œå°±æ˜¯ç›´æ¥æ‹¿gateWayç»™ä½ çš„payloadå»æ„é€ <code>responsePayload := []byte(fmt.Sprintf("StateServer Echo: %s", string(req.Payload)))</code>ç„¶åæŠŠè¿™ä¸ªè¿”å›ç»™gateWayï¼Œä½†æ˜¯ç°åœ¨å°±ä¸æ˜¯ç®€å•çš„å›æ˜¾é€»è¾‘äº†ï¼Œéœ€è¦ç†è§£payloadå¹¶ä¸”å°†å…¶åˆ†å‘ç»™æ­£ç¡®çš„æ‰§è¡Œå•å…ƒã€‚</p>
<p>åœ¨gateWayå‘æ¥çš„è¯·æ±‚ä¸­ï¼Œpayloadæ˜¯ä¸€ä¸²æœªçŸ¥çš„äºŒè¿›åˆ¶ï¼ŒStateServeré¦–å…ˆä¼šæ ¹æ®<code>protocol.Command</code>è¿›è¡Œååºåˆ—åŒ–ï¼Œå› ä¸ºå®¢æˆ·ç«¯å‘é€æ—¶å°†è¯·æ±‚åŒ…è£…ä¸ºäº†<code>Command</code>ï¼Œè¿™ä¸€æ­¥å¯ä»¥æ‹¿åˆ°æ¶ˆæ¯ç±»å‹å’Œæ¶ˆæ¯ä½“ã€‚å¦‚æœåºåˆ—åŒ–å¤±è´¥çš„è¯è¯´æ˜æ•°æ®åŒ…æ ¼å¼é”™è¯¯ï¼Œè¿™é‡Œç›´æ¥ä¸¢å¼ƒã€‚å¦‚æœæˆåŠŸçš„è¯æˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°æ¶ˆæ¯çš„<code>Type</code>ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡Œ<code>switch</code>é€»è¾‘å»è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­ï¼Œå¦‚æœæœªæ¥è¦å¢åŠ ä¸šåŠ¡çš„è¯ä¹Ÿæ˜¯åœ¨è¿™é‡Œä¿®æ”¹ã€‚</p>
<p>è¿›å…¥å…·ä½“çš„å¤„ç†å‡½æ•°ä¹‹åï¼Œä¾‹å¦‚<code>handleLogin</code>ï¼Œæˆ‘ä»¬å·²ç»æ˜ç¡®çŸ¥é“<code>Command.Data</code>é‡Œè£…çš„ä¸€å®šæ˜¯ <code>LoginCommand</code> çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ­¤æ—¶è¿›è¡Œç¬¬äºŒæ¬¡ååºåˆ—åŒ–ï¼Œè¿˜åŸå‡ºå…·ä½“çš„ä¸šåŠ¡å¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> ReceiveMessage(ctx context.Context, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// ååºåˆ—åŒ–å¤–å±‚ Command</span>
    <span class="hljs-keyword">var</span> cmd protocol.Command
    <span class="hljs-keyword">if</span> err := proto.Unmarshal(req.Payload, &amp;cmd); err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"[StateServer] Unmarshal Command error: %v"</span>, err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    log.Printf(<span class="hljs-string">"[StateServer] Received Command: Type=%v, Gateway=%s, User=%s"</span>, cmd.Type, req.GatewayId, req.Uid)

    <span class="hljs-comment">// è·¯ç”±åˆ†å‘</span>
    <span class="hljs-keyword">switch</span> cmd.Type {
        <span class="hljs-keyword">case</span> protocol.CommandType_LOGIN:
        <span class="hljs-keyword">return</span> s.handleLogin(ctx, &amp;cmd, req)
        <span class="hljs-keyword">case</span> protocol.CommandType_HEARTBEAT:
        <span class="hljs-keyword">return</span> s.handleHeartbeat(ctx, &amp;cmd, req)
        <span class="hljs-keyword">case</span> protocol.CommandType_MESSAGE:
        <span class="hljs-keyword">return</span> s.handleMessage(ctx, &amp;cmd, req)
        <span class="hljs-keyword">default</span>:
        log.Printf(<span class="hljs-string">"[StateServer] Unknown command type: %v"</span>, cmd.Type)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"unknown command type"</span>)
    }
}
</code></pre>
<p>è‡³äº<code>handleLogin</code>è¿™ç§å¤„ç†å‡½æ•°æˆ‘ä»¬åé¢è¯´åˆ°ä¸šåŠ¡é€»è¾‘çš„æ—¶å€™å†è®²ã€‚</p>
<h2 data-id="heading-3">å®¢æˆ·ç«¯é€‚é…</h2>
<p>ä¹‹å‰çš„æµ‹è¯•å®¢æˆ·ç«¯å‘é€çš„æ˜¯çº¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç°åœ¨å¿…é¡»å‘é€protoåè®®åºåˆ—åŒ–ä¹‹åçš„äºŒè¿›åˆ¶æµï¼Œé¦–å…ˆæ ¹æ®ç”¨æˆ·éœ€æ±‚åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡å¯¹è±¡ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ï¼Œè¿™æ˜¯å†…å±‚ä¸šåŠ¡å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ª<code>Command</code>å¯¹è±¡ï¼Œå°†åˆšæ‰çš„äºŒè¿›åˆ¶æµå¡«å…¥Dataå­—æ®µï¼Œç„¶åæ ¹æ®ä¸šåŠ¡ç±»å‹è®¾ç½®Typeï¼Œå°†è¿™ä¸ª Command å¯¹è±¡å†æ¬¡åºåˆ—åŒ–ï¼Œé€šè¿‡ WebSocket çš„ BinaryMessage æ¨¡å¼å‘é€å‡ºå»ï¼Œä¸‹é¢æ˜¯å®¢æˆ·ç«¯å…³é”®ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendLogin</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
    loginPayload := &amp;protocol.LoginCommand{
        Token: <span class="hljs-string">"test-token-123"</span>,
    }
    data, _ := proto.Marshal(loginPayload)

    cmd := &amp;protocol.Command{
        Type: protocol.CommandType_LOGIN,
        Data: data,
    }

    sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendHeartbeat</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
    hbPayload := &amp;protocol.HeartbeatCommand{
        Timestamp: time.Now().Unix(),
    }
    data, _ := proto.Marshal(hbPayload)

    cmd := &amp;protocol.Command{
        Type: protocol.CommandType_HEARTBEAT,
        Data: data,
    }
    sendProto(c, cmd)
}
<span class="hljs-comment">// ......</span>


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendProto</span><span class="hljs-params">(c *websocket.Conn, cmd *protocol.Command)</span></span> {
    bytes, err := proto.Marshal(cmd)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(<span class="hljs-string">"marshal error:"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    err = c.WriteMessage(websocket.BinaryMessage, bytes)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(<span class="hljs-string">"write error:"</span>, err)
    } <span class="hljs-keyword">else</span> {
        log.Printf(<span class="hljs-string">"sent command: type=%v"</span>, cmd.Type)
    }
}

</code></pre>
<h2 data-id="heading-4">ç™»å½•å®ç°</h2>
<p>å®¢æˆ·ç«¯ç»™gateWayå‘é€æºå¸¦tokençš„Loginæ•°æ®åŒ…ï¼Œç½‘å…³ç›´æ¥æŠŠpayloadé€šè¿‡grpcè½¬å‘ç»™StateServerï¼ŒStateServerå‘ç°æ˜¯<code>Login</code>ç±»å‹ï¼Œå°±ä¼šè·¯ç”±åˆ°<code>handleLogin</code>æ–¹æ³•ã€‚åœ¨æ–¹æ³•å†…é€šè¿‡protoè§£æå‡ºå¯¹åº”ä¸šåŠ¡ç›¸å…³ç»“æ„ä½“ï¼Œé€šè¿‡AuthæœåŠ¡æˆ–è€…æŸ¥åº“éªŒè¯tokençš„åˆæ³•æ€§ï¼ŒéªŒè¯æˆåŠŸä¹‹åå°±æ‹¿åˆ°UserIDï¼Œç„¶åæŠŠè¿™ä¸ªUserIDé€šè¿‡grpcè¿”å›ç»™gateWayï¼Œè¿™ç›¸å½“äºStateServerå¯¹GateWayä¸‹è¾¾æŒ‡ä»¤ï¼ŒæŠŠåˆšæ‰å‘é€æ¶ˆæ¯çš„é‚£ä¸ªè¿æ¥ç»‘å®šå¯¹åº”çš„UserIDï¼Œä¾¿äºè·¯ç”±ã€‚</p>
<p>ä¸Šé¢è¯´çš„è¿”å›ç”¨æˆ·IDç»™gateWayæ˜¯ä¸ºäº†è®©gateWayçŸ¥é“è¿™ä¸ªFDå¯¹åº”çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œä¸ºäº†å®ç°è½¬å‘é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿™ä¸ªç”¨æˆ·è¿æ¥çš„æ˜¯å“ªå°ç½‘å…³æœºå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨StateServerçš„å¤„ç†å‡½æ•°ä¸­å°†ç”¨æˆ·IDå’Œç½‘å…³æœºå™¨IDä½œä¸ºKVæ³¨å†Œåˆ°redisä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯ç›¸å…³å˜æ›´ä»£ç ï¼š</p>
<pre><code class="hljs language-protobuf" lang="protobuf">// state.proto
message ReceiveMessageResponse {
    bytes response_payload = 1;
    // æ–°å¢ä¸¤ä¸ªå­—æ®µ
    string bound_user_id = 2;
    bool disconnect = 3;
}
</code></pre>
<p>å…¶ä¸­<code>bound_user_id</code>è¡¨ç¤ºè¿™ä¸ªè¿æ¥ç°åœ¨ç»‘å®šå“ªä¸€ä¸ªç”¨æˆ·IDï¼Œ<code>disconnect</code>å­—æ®µæ˜¯StateServeré€šçŸ¥gateWayæ–­å¼€è¿æ¥çš„ï¼Œæ¯”å¦‚å‘ç°tokenæ— æ•ˆï¼Œé»‘åå•ç”¨æˆ·ï¼Œå¼‚åœ°ç™»å½•äº’è¸¢è¿™ç§ã€‚gateWayæ”¶åˆ°å“åº”åï¼Œå‘ç°<code>disconnect</code>ä¸ºçœŸçš„è¯å°±ä¼šå…³é—­è¿æ¥ï¼Œä¸å†æ¨é€è¿”å›çš„æ¶ˆæ¯ä½“ã€‚ï¼ˆæˆ–è€…ä½ å¯ä»¥é€‰æ‹©å…ˆæŠŠpayloadæ¨é€å®Œå†å…³ï¼Œç›®å‰çš„é€»è¾‘æ˜¯ç›´æ¥å…³ï¼‰ã€‚</p>
<p>StateServerçš„æ³¨å†Œå¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> handleLogin(ctx context.Context, cmd *protocol.Command, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> loginCmd protocol.LoginCommand
    <span class="hljs-keyword">if</span> err := proto.Unmarshal(cmd.Data, &amp;loginCmd); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    log.Printf(<span class="hljs-string">"[StateServer] Handle Login: Token=%s"</span>, loginCmd.Token)
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> è°ƒç”¨ Auth æœåŠ¡éªŒè¯ Tokenï¼Œç»‘å®š UserID</span>
    <span class="hljs-comment">// è¿™é‡Œç®€å•æ¨¡æ‹ŸæˆåŠŸ</span>
    userID := <span class="hljs-string">"u_"</span> + loginCmd.Token <span class="hljs-comment">// Simple mock</span>

    key := fmt.Sprintf(<span class="hljs-string">"UserID:%s"</span>, userID)
    <span class="hljs-keyword">if</span> err := s.rdb.Set(ctx, key, req.GatewayId, <span class="hljs-number">5</span>*time.Minute).Err(); err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"[StateServer] Failed to save session: %v"</span>, err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-keyword">return</span> &amp;pb.ReceiveMessageResponse{
        ResponsePayload: []<span class="hljs-type">byte</span>(<span class="hljs-string">"Login Success"</span>),
        BoundUserId:     userID,
        Disconnect:      <span class="hljs-literal">false</span>,
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>ç½‘å…³å±‚æ–°å¢ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Check if StateServer authorized a user</span>
<span class="hljs-keyword">if</span> resp.BoundUserId != <span class="hljs-string">""</span> {
    log.Printf(<span class="hljs-string">"Client %d bound to user %s"</span>, c.FD, resp.BoundUserId)
    c.Uid = resp.BoundUserId
    s.BindUser(resp.BoundUserId, c)
}

<span class="hljs-comment">// Check if StateServer requested disconnect</span>
<span class="hljs-keyword">if</span> resp.Disconnect {
    log.Printf(<span class="hljs-string">"Client %d disconnected by StateServer"</span>, c.FD)
    s.closeClient(c, ep)
    <span class="hljs-keyword">return</span>
}
</code></pre>
<h2 data-id="heading-5">å¿ƒè·³å®ç°</h2>
<p>å®¢æˆ·ç«¯ç»™GateWayå‘é€æºå¸¦å¿ƒè·³æ•°æ®çš„Heartbeatæ•°æ®åŒ…ï¼Œç½‘å…³ç›´æ¥æŠŠ payload é€šè¿‡ grpc è½¬å‘ç»™ StateServerï¼ˆåŒæ—¶ç½‘å…³ä¼šåˆ·æ–°æœ¬åœ°è¿æ¥çš„è¶…æ—¶æ—¶é—´ä»¥é˜²è¯¯è¸¢ï¼‰ã€‚StateServerè·¯ç”±åˆ°å¯¹åº”å¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…ï¼ŒStateServer ä¼šæ ¹æ®è¯·æ±‚ä¸­æºå¸¦çš„ UserIDï¼Œåˆ·æ–° Redis ä¸­è¯¥ç”¨æˆ· ID ä¸ç½‘å…³æœºå™¨ ID æ˜ å°„å…³ç³»çš„è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ï¼Œå®ç° Session çš„ä¿æ´»ã€‚æœ€åï¼ŒStateServerç»™gateWayè¿”å›ackï¼ŒgateWayå†å°†å…¶é€šè¿‡webSocketæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯ç¡®è®¤è¿æ¥ä¾ç„¶å­˜æ´»ã€‚</p>
<p>ä¸ºäº†å®ç°ackï¼Œæˆ‘ä»¬åœ¨<code>Command</code>ç»“æ„ä½“ä¸­æ–°å¢äº†<code>code</code>å’Œ<code>msg</code>å­—æ®µï¼Œcodeå¦‚æœä¸º0å°±è¡¨ç¤ºå“åº”æˆåŠŸï¼Œè€Œä¸”codeçš„é”™è¯¯ç å¯ä»¥ç•™åœ¨ä»¥ååšæ‹“å±•ï¼Œmsgå­—æ®µè¡¨ç¤ºæç¤ºæ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯é”™è¯¯æ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯æ‰§è¡ŒæˆåŠŸçš„è¯´æ˜ã€‚</p>
<p>å¿ƒè·³å®šæ—¶å™¨æ˜¯ç”±å®¢æˆ·ç«¯ç»´æŠ¤çš„ï¼Œå› ä¸ºç”±gateWayæˆ–è€…StateServerä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨å¼€é”€å¤ªå¤§ï¼Œæ‰€ä»¥é€‰æ‹©è®©å®¢æˆ·ç«¯ç»´æŠ¤è‡ªå·±çš„å¿ƒè·³å®šæ—¶å™¨ï¼Œå‘é€è¯·æ±‚ç­‰å¾…å“åº”ã€‚</p>
<p>ä¸‹é¢çœ‹gateWayä¸­æ›´æ–°çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Server)</span></span> keepAliveLoop(ctx context.Context) {
    <span class="hljs-comment">// Check every 10 seconds</span>
    ticker := time.NewTicker(<span class="hljs-number">10</span> * time.Second)
    <span class="hljs-keyword">defer</span> ticker.Stop()

    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
            <span class="hljs-keyword">case</span> &lt;-ctx.Done():
            <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">case</span> &lt;-ticker.C:
            now := time.Now().Unix()

            <span class="hljs-keyword">for</span> _, ep := <span class="hljs-keyword">range</span> s.Epolls {
                <span class="hljs-keyword">var</span> timeoutClients []*Client

                ep.lock.RLock()
                <span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> ep.connections {
                    <span class="hljs-keyword">if</span> now-c.lastHeartbeat &gt; <span class="hljs-number">300</span> { <span class="hljs-comment">// 300s timeout</span>
                        timeoutClients = <span class="hljs-built_in">append</span>(timeoutClients, c)
                    }
                }
                ep.lock.RUnlock()

                <span class="hljs-comment">// Close timeout clients</span>
                <span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> timeoutClients {
                    log.Printf(<span class="hljs-string">"Client %d timed out (last active: %ds ago)"</span>, c.FD, now-c.lastHeartbeat)
                    s.closeClient(c, ep)
                }
            }
        }
    }
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°åœ¨gateWayè°ƒç”¨<code>Start</code>å¯åŠ¨çš„æ—¶å€™å°±å¼€å¯ä¸€ä¸ªåç¨‹æ‰§è¡Œ<code>keepAliveLoop</code>ï¼Œæ ¸å¿ƒèŒè´£æ˜¯å®šæœŸè¸¢æ‰é‚£äº›å ç”¨è¿æ¥è€Œä¸”æ²¡å“åº”çš„åƒµå°¸ç”¨æˆ·ã€‚ä¸»è¦å°±æ˜¯éå†æ‰€æœ‰æ³¨å†Œåˆ°epollä¸­çš„è¿æ¥ï¼Œè·å–è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ£€æŸ¥ç°åœ¨æ—¶é—´è·ç¦»è¯¥å®¢æˆ·ç«¯ä¸Šæ¬¡æ”¶åˆ°å¿ƒè·³çš„æ—¶é—´æ˜¯å¦è¶…è¿‡5åˆ†é’Ÿï¼Œè¶…è¿‡çš„è¯å°±æŠŠè¿™ä¸ªè¿æ¥è®¡å…¥å¾…è¸¢å‡ºé˜Ÿåˆ—ï¼Œåé¢ç»Ÿä¸€closeã€‚</p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨æ¯10sæ£€æŸ¥ä¸€æ¬¡æ˜¯å› ä¸ºè¿™ä¸ªå¯¹æ—¶é—´ç²¾åº¦çš„å®¹å¿åº¦é«˜ï¼Œå¿ƒè·³ä¸»è¦æ˜¯ä¸ºäº†é‡Šæ”¾é•¿æ—¶é—´æ— å“åº”çš„èµ„æºæ‰€ä»¥æ™šä¸€ä¸¤ç§’å…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚æœè¿½æ±‚ç²¾åº¦çš„è¯å¯ä»¥ä¸ºæ¯ä¸ªclientç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä½†æ˜¯è¿™æ ·å¼€é”€å¤ªå¤§äº†ï¼Œä¼˜åŒ–çš„è¯å¯ä»¥é‡‡ç”¨æ—¶é—´è½®ç®—æ³•ï¼Œåœ¨ç²¾åº¦å’Œæ€§èƒ½è§’åº¦åšå–èˆã€‚</p>
<p>ç”±gateWayé€ä¼ ç»™StateServerä¹‹åï¼ŒStateServerè¯†åˆ«åˆ°è¿™æ˜¯ä¸€ä¸ªå¿ƒè·³ï¼Œè·¯ç”±åˆ°å¿ƒè·³å¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> handleHeartbeat(ctx context.Context, cmd *protocol.Command, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> req.Uid != <span class="hljs-string">""</span> {
        key := fmt.Sprintf(<span class="hljs-string">"session:%s"</span>, req.Uid)
        <span class="hljs-keyword">if</span> err := s.rdb.Expire(ctx, key, <span class="hljs-number">10</span>*time.Minute).Err(); err != <span class="hljs-literal">nil</span> {
            log.Printf(<span class="hljs-string">"[StateServer] RenewSession failed: %v"</span>, err)
        }
    }

    <span class="hljs-comment">// æ„é€ å“åº”</span>
    respCmd := &amp;protocol.Command{
        Type: protocol.CommandType_HEARTBEAT,
        Code: <span class="hljs-number">0</span>,
    }
    respBytes, _ := proto.Marshal(respCmd)

    <span class="hljs-keyword">return</span> &amp;pb.ReceiveMessageResponse{
        ResponsePayload: respBytes,
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>åˆ·æ–°ç”¨æˆ·å’Œç½‘å…³çš„mapå…³ç³»ï¼Œç„¶åæ„é€ å›å¤è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹‹åå®¢æˆ·ç«¯éœ€è¦è§£æè¯·æ±‚æ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¿ƒè·³çš„ackï¼Œç„¶åè¿›è¡Œç›¸åº”å¤„ç†ã€‚</p>
<h2 data-id="heading-6">æµ‹è¯•</h2>
<p>æµ‹è¯•ç»“æœå’Œä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36e462ea91644828a34a8673e9f77eee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUVpRNTQxODg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769829239&amp;x-signature=vIEJAVT8ZuRjRBA0tIhBgZbdsbU%3D" alt="image-20260124110430503" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	u := url.URL{Scheme: <span class="hljs-string">"ws"</span>, Host: <span class="hljs-string">"localhost:8002"</span>, Path: <span class="hljs-string">"/"</span>}
	log.Printf(<span class="hljs-string">"Connecting to %s"</span>, u.String())

	<span class="hljs-comment">// å»ºç«‹ WebSocket è¿æ¥</span>
	c, _, err := websocket.DefaultDialer.Dial(u.String(), <span class="hljs-literal">nil</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"dial:"</span>, err)
	}
	<span class="hljs-keyword">defer</span> c.Close()

	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})

	<span class="hljs-comment">// å¯åŠ¨æ¥æ”¶åç¨‹ (Receive Loop)</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(done)
		<span class="hljs-keyword">for</span> {
			_, message, err := c.ReadMessage()
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Println(<span class="hljs-string">"read:"</span>, err)
				<span class="hljs-keyword">return</span>
			}
			<span class="hljs-comment">// è§£æ Command</span>
			<span class="hljs-keyword">var</span> cmd protocol.Command
			<span class="hljs-keyword">if</span> err := proto.Unmarshal(message, &amp;cmd); err != <span class="hljs-literal">nil</span> {
				log.Printf(<span class="hljs-string">"unmarshal error: %v"</span>, err)
				<span class="hljs-keyword">continue</span>
			}

			<span class="hljs-keyword">if</span> cmd.Code != <span class="hljs-number">0</span> {
				log.Printf(<span class="hljs-string">"recv Error: Code=%d, Msg=%s"</span>, cmd.Code, cmd.Msg)
				<span class="hljs-keyword">continue</span>
			}

			<span class="hljs-keyword">switch</span> cmd.Type {
			<span class="hljs-keyword">case</span> protocol.CommandType_LOGIN:
				log.Printf(<span class="hljs-string">"Login Success!"</span>)
			<span class="hljs-keyword">case</span> protocol.CommandType_HEARTBEAT:
				log.Printf(<span class="hljs-string">"recv Pong"</span>)
			<span class="hljs-keyword">case</span> protocol.CommandType_MESSAGE:
				<span class="hljs-comment">// å¦‚æœ Data ä¸ä¸ºç©ºï¼Œè¯´æ˜å¯èƒ½æ˜¯ä¸€ä¸ªæ¨é€ä¸‹æ¥çš„æ–°æ¶ˆæ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ ACK</span>
				<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cmd.Data) &gt; <span class="hljs-number">0</span> {
					<span class="hljs-keyword">var</span> msgCmd protocol.MessageCommand
					<span class="hljs-keyword">if</span> err := proto.Unmarshal(cmd.Data, &amp;msgCmd); err == <span class="hljs-literal">nil</span> {
						log.Printf(<span class="hljs-string">"recv Message: From=%s, Content=%s"</span>, <span class="hljs-string">"System"</span>, msgCmd.Content)
					} <span class="hljs-keyword">else</span> {
						log.Printf(<span class="hljs-string">"recv Message ACK (Data len=%d)"</span>, <span class="hljs-built_in">len</span>(cmd.Data))
					}
				} <span class="hljs-keyword">else</span> {
					log.Printf(<span class="hljs-string">"recv Message ACK: %s"</span>, cmd.Msg)
				}
			}
		}
	}()

	<span class="hljs-comment">// å‘é€æ¶ˆæ¯æµ‹è¯• (Send Loop)</span>
	ticker := time.NewTicker(<span class="hljs-number">2</span> * time.Second)
	<span class="hljs-keyword">defer</span> ticker.Stop()

	interrupt := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(interrupt, os.Interrupt)

	<span class="hljs-comment">// å…ˆå‘é€ç™»å½•åŒ…</span>
	sendLogin(c)

	count := <span class="hljs-number">0</span>
	<span class="hljs-keyword">for</span> {
		<span class="hljs-keyword">select</span> {
		<span class="hljs-keyword">case</span> &lt;-done:
			<span class="hljs-keyword">return</span>
		<span class="hljs-keyword">case</span> &lt;-ticker.C:
			<span class="hljs-comment">// è½®æµå‘é€å¿ƒè·³å’ŒèŠå¤©æ¶ˆæ¯</span>
			count++
			<span class="hljs-keyword">if</span> count%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> {
				sendHeartbeat(c)
			} <span class="hljs-keyword">else</span> {
				sendMessage(c)
			}

		<span class="hljs-keyword">case</span> &lt;-interrupt:
			<span class="hljs-comment">// ä¼˜é›…é€€å‡º</span>
			log.Println(<span class="hljs-string">"interrupt"</span>)
			err := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, <span class="hljs-string">""</span>))
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Println(<span class="hljs-string">"write close:"</span>, err)
				<span class="hljs-keyword">return</span>
			}
			<span class="hljs-keyword">select</span> {
			<span class="hljs-keyword">case</span> &lt;-done:
			<span class="hljs-keyword">case</span> &lt;-time.After(time.Second):
			}
			<span class="hljs-keyword">return</span>
		}
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendLogin</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	<span class="hljs-comment">// æ„é€  LoginCommand</span>
	loginPayload := &amp;protocol.LoginCommand{
		Token: <span class="hljs-string">"test-token-123"</span>,
	}
	data, _ := proto.Marshal(loginPayload)

	<span class="hljs-comment">// æ„é€ å¤–å±‚ Command</span>
	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_LOGIN,
		Data: data,
	}

	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendHeartbeat</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	hbPayload := &amp;protocol.HeartbeatCommand{
		Timestamp: time.Now().Unix(),
	}
	data, _ := proto.Marshal(hbPayload)

	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_HEARTBEAT,
		Data: data,
	}
	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	msgPayload := &amp;protocol.MessageCommand{
		Uuid:       <span class="hljs-string">"msg-"</span> + time.Now().String(),
		Type:       <span class="hljs-number">1</span>,
		Content:    <span class="hljs-string">"Hello StateServer! "</span> + time.Now().Format(time.TimeOnly),
		ReceiverId: <span class="hljs-string">"1002"</span>,
	}
	data, _ := proto.Marshal(msgPayload)

	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_MESSAGE,
		Data: data,
	}
	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendProto</span><span class="hljs-params">(c *websocket.Conn, cmd *protocol.Command)</span></span> {
	<span class="hljs-comment">// åºåˆ—åŒ–</span>
	bytes, err := proto.Marshal(cmd)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Println(<span class="hljs-string">"marshal error:"</span>, err)
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// å‘é€äºŒè¿›åˆ¶å¸§ (BinaryMessage)</span>
	err = c.WriteMessage(websocket.BinaryMessage, bytes)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Println(<span class="hljs-string">"write error:"</span>, err)
	} <span class="hljs-keyword">else</span> {
		log.Printf(<span class="hljs-string">"sent command: type=%v"</span>, cmd.Type)
	}
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Postmançš„MockServer]]></title>    <link>https://juejin.cn/post/7598418891401314358</link>    <guid>https://juejin.cn/post/7598418891401314358</guid>    <pubDate>2026-01-24T03:46:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598418891401314358" data-draft-id="7591506455972626486" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Postmançš„MockServer"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T03:46:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Emanon"/> <meta itemprop="url" content="https://juejin.cn/user/1794847455576878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Postmançš„MockServer
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1794847455576878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Emanon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:46:07.000Z" title="Sat Jan 24 2026 03:46:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.åˆ›å»ºMockServer</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e701c84d1e9e4ccbb470ae3926dddb55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=o1aU56xe%2F35CWfSDTbjfMo6pcTw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2.å®šä¹‰è·¯å¾„ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aa488a04f1c49b98fdfa45246a3f02e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=areyuLYrsJFwcT2zCCvToPj99ng%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3.æŸ¥çœ‹mocké›†åˆ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b556e15d36041b6bcfb1d692007ac49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=dZb3xb0WQnvE9drYpBevkAheC84%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">4.æŸ¥çœ‹æ¥å£çš„è¯·æ±‚å“åº”ä¿¡æ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71bf28f8fa2410c995befae98d99866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=pHANJLWoh7qPIBzLzWZycycX2%2B8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">5.è°ƒè¯•æ¨¡æ‹Ÿæ¥å£</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c8f8297e03a4be1b9cc8c9842b3251d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=L%2FhqkfxDK0fZRInBOj3vgIISngk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">6.å‘èµ·è¯·æ±‚</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ceaccd55f5c4c5db2b761ee9ac2ae2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=kTWdBFlEnShXd%2FpHSSwFAf95Tqw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">7.ä¿®æ”¹è¯·æ±‚æ–¹å¼ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p>ä½¿ç”¨ç¬¬6æ­¥å‘èµ·è¯·æ±‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6650a27a8fd54253886e7760ca927f62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=C4sL%2F75qdhWAqcB06AqHSGFkKRs%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹å“åº”ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19406f4c3789431fb7822f287c126284~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=J2%2BMq8zQ5ZInYd3g7fRhbwH4JmE%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿å­˜è¯·æ±‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4151ca2abd14c90b0f80e2f53e34500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=gKok%2FrtooNqyB0%2BsGl%2Bt6zUofJs%3D" alt="image.png" loading="lazy"/></p>
<p>é‡æ–°å‘èµ·è¯·æ±‚å³å¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbb52a6b1e50411fa827305f9aeee3b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=gR9Zh5WEMIC4NZGEA2scOkXKars%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨collectioné›†åˆä¸­å¯ä»¥çœ‹åˆ°åˆšæ‰ä¿®æ”¹çš„æ¥å£ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6c479adee74f93b2582682978b58c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=PH7RgMKasbGLX7H9WNTXrvXjPyQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">8.ä¿®æ”¹è¯·æ±‚æ–¹å¼ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p>é€‰æ‹©add examplae
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c403ddbc8bd4afeb729aef19e973857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=MCyEiJtwjt4HKMSd%2FwySV0UqkYQ%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹å“åº”ä¿¡æ¯
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c60894201fb64fbebf1e0da362a02d75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=XU4KvH6q9y0AvNqXqLjdEX834EQ%3D" alt="image.png" loading="lazy"/></p>
<p>è¦æŠŠå…¶å®ƒçš„é›†åˆåˆ é™¤æ‰èƒ½çœ‹åˆ°æ•ˆæœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fce52c4af5f4c7fbd8dfa8970febf76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=k3GQmx3IoCyI9EnTUjmlwYaJpyk%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7598641282324348955</link>    <guid>https://juejin.cn/post/7598641282324348955</guid>    <pubDate>2026-01-24T05:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598641282324348955" data-draft-id="7598477092196466726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fliter"/> <meta itemprop="url" content="https://juejin.cn/user/888061123628509"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888061123628509/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fliter
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:33:57.000Z" title="Sat Jan 24 2026 05:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ Rust ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦å»¶è¿Ÿåˆå§‹åŒ–å…¨å±€å˜é‡æˆ–é™æ€å˜é‡çš„åœºæ™¯ã€‚ä¼ ç»Ÿçš„åšæ³•å¯èƒ½æ¶‰åŠå¤æ‚çš„ <code>lazy_static!</code> å®æˆ– <code>Mutex</code> åŒ…è£…ï¼Œä½†è‡ª Rust 1.70 èµ·ï¼Œ<code>OnceCell</code> å’Œ <code>OnceLock</code> å·²ç»ç¨³å®šè¿›å…¥æ ‡å‡†åº“ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ <code>OnceCell</code> çš„ä½¿ç”¨åœºæ™¯ã€å®ç°åŸç†å’Œæœ€ä½³å®è·µã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯ OnceCell?</h2>
<p><code>OnceCell</code> æ˜¯ä¸€ä¸ªåªèƒ½å†™å…¥ä¸€æ¬¡çš„å®¹å™¨ç±»å‹ã€‚ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œå®ƒå°†æ°¸ä¹…ä¿å­˜è¯¥å€¼ï¼Œåç»­çš„å†™å…¥æ“ä½œå°†å¤±è´¥ã€‚è¿™ç§ç‰¹æ€§ä½¿å…¶ç‰¹åˆ«é€‚åˆç”¨äºå»¶è¿Ÿåˆå§‹åŒ–å’Œå…¨å±€çŠ¶æ€ç®¡ç†ã€‚</p>
<p>Rust æ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªä¸»è¦ç±»å‹ï¼š</p>
<ul>
<li><code>std::cell::OnceCell&lt;T&gt;</code> - å•çº¿ç¨‹ç‰ˆæœ¬</li>
<li><code>std::sync::OnceLock&lt;T&gt;</code> - çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬</li>
</ul>
<h2 data-id="heading-2">æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-3">1. å…¨å±€é…ç½®ç®¡ç†</h3>
<p>åœ¨åº”ç”¨å¯åŠ¨æ—¶è¯»å–é…ç½®æ–‡ä»¶ï¼Œä¹‹åå…¨å±€åªè¯»è®¿é—®ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Config</span> {
    database_url: <span class="hljs-type">String</span>,
    max_connections: <span class="hljs-type">u32</span>,
}

<span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;Config&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">init_config</span>() {
    CONFIG.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Config {
        database_url: <span class="hljs-string">"postgres://localhost/mydb"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        max_connections: <span class="hljs-number">10</span>,
    });
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_config</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Config {
    CONFIG.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"é…ç½®æœªåˆå§‹åŒ–"</span>)
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-title function_ invoke__">init_config</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ•°æ®åº“ URL: {}"</span>, <span class="hljs-title function_ invoke__">get_config</span>().database_url);
}
</code></pre>
<h3 data-id="heading-4">2. å»¶è¿Ÿåˆå§‹åŒ–æ˜‚è´µèµ„æº</h3>
<p>å¯¹äºåˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼Œå¯ä»¥å»¶è¿Ÿåˆ°çœŸæ­£éœ€è¦æ—¶å†åˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ­£åœ¨å»ºç«‹æ•°æ®åº“è¿æ¥..."</span>);
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
        <span class="hljs-keyword">Self</span> {}
    }
}

<span class="hljs-keyword">static</span> DB: OnceLock&lt;DatabaseConnection&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_db</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> DatabaseConnection {
    DB.<span class="hljs-title function_ invoke__">get_or_init</span>(|| DatabaseConnection::<span class="hljs-title function_ invoke__">new</span>())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åº”ç”¨å¯åŠ¨"</span>);
    <span class="hljs-comment">// æ­¤æ—¶è¿˜æœªå»ºç«‹è¿æ¥</span>
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é¦–æ¬¡è®¿é—®æ•°æ®åº“"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_db</span> = <span class="hljs-title function_ invoke__">get_db</span>();  <span class="hljs-comment">// è¿™é‡Œæ‰çœŸæ­£å»ºç«‹è¿æ¥</span>
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å†æ¬¡è®¿é—®æ•°æ®åº“"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_db</span> = <span class="hljs-title function_ invoke__">get_db</span>();  <span class="hljs-comment">// ç›´æ¥è¿”å›å·²æœ‰è¿æ¥ï¼Œä¸å†åˆå§‹åŒ–</span>
}
</code></pre>
<h3 data-id="heading-5">3. å•ä¾‹æ¨¡å¼å®ç°</h3>
<p><code>OnceLock</code> å¤©ç„¶é€‚åˆå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Logger</span> {
    prefix: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">instance</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Logger {
        <span class="hljs-keyword">static</span> INSTANCE: OnceLock&lt;Logger&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
        INSTANCE.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Logger {
            prefix: <span class="hljs-string">"[LOG]"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        })
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">log</span>(&amp;<span class="hljs-keyword">self</span>, message: &amp;<span class="hljs-type">str</span>) {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{} {}"</span>, <span class="hljs-keyword">self</span>.prefix, message);
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    Logger::<span class="hljs-title function_ invoke__">instance</span>().<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"åº”ç”¨å¯åŠ¨"</span>);
    Logger::<span class="hljs-title function_ invoke__">instance</span>().<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"å¤„ç†è¯·æ±‚"</span>);
}
</code></pre>
<h2 data-id="heading-6">OnceCell vs OnceLock</h2>
<p>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºçº¿ç¨‹å®‰å…¨æ€§ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>OnceCell</th><th>OnceLock</th></tr></thead><tbody><tr><td>çº¿ç¨‹å®‰å…¨</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>æ€§èƒ½</td><td>æ›´å¿«</td><td>ç¨æ…¢ï¼ˆæœ‰åŒæ­¥å¼€é”€ï¼‰</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å•çº¿ç¨‹ç¯å¢ƒ</td><td>å¤šçº¿ç¨‹ç¯å¢ƒ</td></tr><tr><td>å®ç° <code>Sync</code></td><td>å¦</td><td>æ˜¯</td></tr></tbody></table>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::cell::OnceCell;
<span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-comment">// å•çº¿ç¨‹åœºæ™¯</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">single_thread_example</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceCell::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">is_none</span>());
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| <span class="hljs-number">42</span>);
    <span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);
    
    <span class="hljs-comment">// å†æ¬¡åˆå§‹åŒ–ä¼šè¿”å›å·²æœ‰å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| <span class="hljs-number">100</span>);
    <span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);  <span class="hljs-comment">// ä»ç„¶æ˜¯ 42</span>
}

<span class="hljs-comment">// å¤šçº¿ç¨‹åœºæ™¯</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">multi_thread_example</span>() {
    <span class="hljs-keyword">static</span> COUNTER: OnceLock&lt;<span class="hljs-type">u32</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">handles</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = (<span class="hljs-number">0</span>..<span class="hljs-number">10</span>)
        .<span class="hljs-title function_ invoke__">map</span>(|i| {
            std::thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
                <span class="hljs-comment">// åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæˆåŠŸåˆå§‹åŒ–</span>
                COUNTER.<span class="hljs-title function_ invoke__">get_or_init</span>(|| i)
            })
        })
        .<span class="hljs-title function_ invoke__">collect</span>();
    
    <span class="hljs-keyword">for</span> <span class="hljs-variable">handle</span> <span class="hljs-keyword">in</span> handles {
        handle.<span class="hljs-title function_ invoke__">join</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    }
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æœ€ç»ˆå€¼: {}"</span>, COUNTER.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">unwrap</span>());
}
</code></pre>
<h2 data-id="heading-7">å¸¸ç”¨ API è¯¦è§£</h2>
<h3 data-id="heading-8"><code>get()</code> - è·å–å€¼çš„å¼•ç”¨</h3>
<p>è¿”å› <code>Option&lt;&amp;T&gt;</code>ï¼Œå¦‚æœæœªåˆå§‹åŒ–åˆ™è¿”å› <code>None</code>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">is_none</span>());

cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">42</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
<span class="hljs-built_in">assert_eq!</span>(cell.<span class="hljs-title function_ invoke__">get</span>(), <span class="hljs-title function_ invoke__">Some</span>(&amp;<span class="hljs-number">42</span>));
</code></pre>
<h3 data-id="heading-9"><code>set()</code> - è®¾ç½®å€¼</h3>
<p>è¿”å› <code>Result&lt;(), T&gt;</code>ï¼Œå¦‚æœå·²ç»åˆå§‹åŒ–åˆ™è¿”å› <code>Err(value)</code>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">42</span>).<span class="hljs-title function_ invoke__">is_ok</span>());
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_ invoke__">is_err</span>());  <span class="hljs-comment">// å¤±è´¥ï¼Œå·²ç»è®¾ç½®è¿‡</span>
</code></pre>
<h3 data-id="heading-10"><code>get_or_init()</code> - è·å–æˆ–åˆå§‹åŒ–</h3>
<p>å¦‚æœæœªåˆå§‹åŒ–åˆ™ä½¿ç”¨æä¾›çš„é—­åŒ…è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿”å›å€¼çš„å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åˆå§‹åŒ–ä¸­..."</span>);
    <span class="hljs-number">42</span>
});
<span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);
</code></pre>
<h3 data-id="heading-11"><code>get_or_try_init()</code> - å¯å¤±è´¥çš„åˆå§‹åŒ–</h3>
<p>æ”¯æŒåˆå§‹åŒ–è¿‡ç¨‹å¯èƒ½å¤±è´¥çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">load_config</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">String</span>, std::io::Error&gt; {
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„é…ç½®åŠ è½½</span>
    <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-string">"config_data"</span>.<span class="hljs-title function_ invoke__">to_string</span>())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = CONFIG.<span class="hljs-title function_ invoke__">get_or_try_init</span>(|| <span class="hljs-title function_ invoke__">load_config</span>());
    <span class="hljs-keyword">match</span> result {
        <span class="hljs-title function_ invoke__">Ok</span>(config) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é…ç½®: {}"</span>, config),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; eprintln!(<span class="hljs-string">"åŠ è½½å¤±è´¥: {}"</span>, e),
    }
}
</code></pre>
<h2 data-id="heading-12">å®æˆ˜æ¡ˆä¾‹ï¼šHTTP å®¢æˆ·ç«¯ç¼“å­˜</h2>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªå…¨å±€çš„ HTTP å®¢æˆ·ç«¯å®ä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">HttpClient</span> {
    base_url: <span class="hljs-type">String</span>,
    timeout: <span class="hljs-type">u64</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">HttpClient</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(base_url: <span class="hljs-type">String</span>, timeout: <span class="hljs-type">u64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åˆ›å»º HTTP å®¢æˆ·ç«¯: {}"</span>, base_url);
        <span class="hljs-keyword">Self</span> { base_url, timeout }
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">self</span>, path: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
        <span class="hljs-built_in">format!</span>(<span class="hljs-string">"GET {}{}"</span>, <span class="hljs-keyword">self</span>.base_url, path)
    }
}

<span class="hljs-keyword">static</span> HTTP_CLIENT: OnceLock&lt;HttpClient&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_http_client</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> HttpClient {
    HTTP_CLIENT.<span class="hljs-title function_ invoke__">get_or_init</span>(|| {
        HttpClient::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"https://api.example.com"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-number">30</span>)
    })
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// é¦–æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»º</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response1</span> = <span class="hljs-title function_ invoke__">get_http_client</span>().<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"/users"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, response1);
    
    <span class="hljs-comment">// å¤ç”¨å·²åˆ›å»ºçš„å®ä¾‹</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response2</span> = <span class="hljs-title function_ invoke__">get_http_client</span>().<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"/posts"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, response2);
}
</code></pre>
<h2 data-id="heading-13">æ€§èƒ½è€ƒé‡</h2>
<p><code>OnceLock</code> çš„æ€§èƒ½ç‰¹ç‚¹ï¼š</p>
<ol>
<li><strong>é¦–æ¬¡åˆå§‹åŒ–</strong>ï¼šæœ‰è½»å¾®çš„åŒæ­¥å¼€é”€ï¼ˆåŸå­æ“ä½œï¼‰</li>
<li><strong>åç»­è®¿é—®</strong>ï¼šå‡ ä¹é›¶æˆæœ¬ï¼Œç›´æ¥è¿”å›å¼•ç”¨</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šä»…å­˜å‚¨ä¸€ä»½æ•°æ® + å°‘é‡çŠ¶æ€æ ‡è®°</li>
</ol>
<p>ä¸ <code>lazy_static!</code> ç›¸æ¯”ï¼Œ<code>OnceLock</code> é€šå¸¸æ€§èƒ½ç›¸å½“æˆ–æ›´å¥½ï¼Œä¸”æ— éœ€é¢å¤–ä¾èµ–ã€‚</p>
<h2 data-id="heading-14">æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-15">1. é¿å…åœ¨ Drop ä¸­è®¿é—® OnceLock</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// âŒ ä¸æ¨è</span>
<span class="hljs-keyword">static</span> RESOURCE: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyStruct</span>;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MyStruct</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-comment">// å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸º</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(r) = RESOURCE.<span class="hljs-title function_ invoke__">get</span>() {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, r);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">2. åˆå§‹åŒ–å¤±è´¥çš„å¤„ç†</h3>
<p>å¯¹äºå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–ï¼Œä½¿ç”¨ <code>get_or_try_init</code> å¹¶å¦¥å–„å¤„ç†é”™è¯¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = CELL.<span class="hljs-title function_ invoke__">get_or_try_init</span>(|| {
    <span class="hljs-title function_ invoke__">expensive_fallible_operation</span>()
});

<span class="hljs-keyword">match</span> result {
    <span class="hljs-title function_ invoke__">Ok</span>(value) =&gt; { <span class="hljs-comment">/* ä½¿ç”¨ value */</span> },
    <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; { <span class="hljs-comment">/* å¤„ç†é”™è¯¯ */</span> },
}
</code></pre>
<h3 data-id="heading-17">3. é€‰æ‹©åˆé€‚çš„ç±»å‹</h3>
<ul>
<li>å•çº¿ç¨‹åœºæ™¯ç”¨ <code>OnceCell</code></li>
<li>å¤šçº¿ç¨‹æˆ–é™æ€å˜é‡ç”¨ <code>OnceLock</code></li>
<li>éœ€è¦å¯å˜æ€§è€ƒè™‘ <code>Mutex&lt;Option&lt;T&gt;&gt;</code></li>
</ul>
<h2 data-id="heading-18">ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”</h2>
<h3 data-id="heading-19">vs lazy_static!</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ä½¿ç”¨ lazy_staticï¼ˆéœ€è¦å¤–éƒ¨ crateï¼‰</span>
<span class="hljs-keyword">use</span> lazy_static::lazy_static;
lazy_static! {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">ref</span> CONFIG: Config = Config::<span class="hljs-title function_ invoke__">load</span>();
}

<span class="hljs-comment">// ä½¿ç”¨ OnceLockï¼ˆæ ‡å‡†åº“ï¼Œæ— éœ€ä¾èµ–ï¼‰</span>
<span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;Config&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_config</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Config {
    CONFIG.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Config::<span class="hljs-title function_ invoke__">load</span>())
}
</code></pre>
<h3 data-id="heading-20">vs Mutex&lt;Option&gt;</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// Mutex æ–¹æ¡ˆï¼šå¯å˜ï¼Œä½†æ¯æ¬¡è®¿é—®éƒ½éœ€è¦åŠ é”</span>
<span class="hljs-keyword">static</span> DATA: Mutex&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt;&gt; = Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-literal">None</span>);

<span class="hljs-comment">// OnceLock æ–¹æ¡ˆï¼šä¸å¯å˜ï¼Œåˆå§‹åŒ–åé›¶æˆæœ¬è®¿é—®</span>
<span class="hljs-keyword">static</span> DATA: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
</code></pre>
<h2 data-id="heading-21">å°ç»“</h2>
<p><code>OnceCell</code> å’Œ <code>OnceLock</code> æ˜¯ Rust æ ‡å‡†åº“ä¸­ç”¨äºå»¶è¿Ÿåˆå§‹åŒ–çš„å¼ºå¤§å·¥å…·ã€‚å®ƒä»¬æä¾›äº†ï¼š</p>
<ul>
<li>é›¶ä¾èµ–çš„å»¶è¿Ÿåˆå§‹åŒ–</li>
<li>çº¿ç¨‹å®‰å…¨çš„å…¨å±€çŠ¶æ€ç®¡ç†</li>
<li>é«˜æ€§èƒ½çš„å•æ¬¡å†™å…¥è¯­ä¹‰</li>
<li>ç®€æ´çš„ API è®¾è®¡</li>
</ul>
<p>åœ¨éœ€è¦å…¨å±€é…ç½®ã€å•ä¾‹æ¨¡å¼æˆ–å»¶è¿Ÿåˆå§‹åŒ–çš„åœºæ™¯ä¸­ï¼Œ<code>OnceLock</code> åº”è¯¥æ˜¯ä½ çš„é¦–é€‰æ–¹æ¡ˆã€‚éšç€ Rust ç”Ÿæ€çš„å‘å±•ï¼Œè¿™äº›ç±»å‹å°†é€æ¸å–ä»£ <code>lazy_static!</code> ç­‰å¤–éƒ¨ä¾èµ–ï¼Œæˆä¸ºæ ‡å‡†åšæ³•ã€‚</p>
<hr/>
<h2 data-id="heading-22">Go ä¸­çš„å¯¹åº”æ–¹æ¡ˆ</h2>
<p>Go è¯­è¨€ä¸­æœ‰ <code>sync.Once</code> å’Œ  <code>sync.OnceValue</code>ï¼ˆGo 1.21+ï¼‰ï¼Œå®ƒä»¬çš„åŠŸèƒ½ä¸ Rust çš„ <code>OnceCell</code>/<code>OnceLock</code> éå¸¸ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-23">1. <strong>sync.Once</strong> - ç»å…¸æ–¹æ¡ˆ</h3>
<p><code>sync.Once</code> ç¡®ä¿æŸä¸ªå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿åœ¨å¹¶å‘ç¯å¢ƒä¸­ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™æ˜¯ Go ä¸­å®ç°å»¶è¿Ÿåˆå§‹åŒ–å’Œå•ä¾‹æ¨¡å¼çš„æ ‡å‡†æ–¹å¼ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL <span class="hljs-type">string</span>
    MaxConnections <span class="hljs-type">int</span>
}

<span class="hljs-keyword">var</span> (
    config *Config
    once   sync.Once
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetConfig</span><span class="hljs-params">()</span></span> *Config {
    once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"åˆå§‹åŒ–é…ç½®..."</span>)
        config = &amp;Config{
            DatabaseURL: <span class="hljs-string">"postgres://localhost/mydb"</span>,
            MaxConnections: <span class="hljs-number">10</span>,
        }
    })
    <span class="hljs-keyword">return</span> config
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¤šæ¬¡è°ƒç”¨åªä¼šåˆå§‹åŒ–ä¸€æ¬¡</span>
    c1 := GetConfig()
    c2 := GetConfig()
    
    fmt.Printf(<span class="hljs-string">"é…ç½®1: %+v\n"</span>, c1)
    fmt.Printf(<span class="hljs-string">"é…ç½®2: %+v\n"</span>, c2)
    fmt.Printf(<span class="hljs-string">"æ˜¯åŒä¸€ä¸ªå®ä¾‹: %v\n"</span>, c1 == c2)
}
</code></pre>
<h3 data-id="heading-24">2. <strong>sync.OnceValue</strong> - Go 1.21+ çš„æ–°æ–¹æ¡ˆ</h3>
<p>Go 1.21 å¼•å…¥äº† <code>sync.OnceValue</code>ï¼Œå®ƒæä¾›äº†æ›´ç®€æ´çš„æ–¹å¼æ¥åŒ…è£…ä¸€æ¬¡æ€§åˆå§‹åŒ–é€»è¾‘å¹¶ç›´æ¥è¿”å›ç»“æœã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">type</span> Database <span class="hljs-keyword">struct</span> {
    Connection <span class="hljs-type">string</span>
}

<span class="hljs-keyword">var</span> getDB = sync.OnceValue(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> *Database {
    fmt.Println(<span class="hljs-string">"åˆ›å»ºæ•°æ®åº“è¿æ¥..."</span>)
    <span class="hljs-keyword">return</span> &amp;Database{Connection: <span class="hljs-string">"è¿æ¥å·²å»ºç«‹"</span>}
})

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// é¦–æ¬¡è°ƒç”¨ä¼šæ‰§è¡Œåˆå§‹åŒ–</span>
    db1 := getDB()
    fmt.Println(db1.Connection)
    
    <span class="hljs-comment">// å†æ¬¡è°ƒç”¨ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœ</span>
    db2 := getDB()
    fmt.Println(db2.Connection)
    
    fmt.Printf(<span class="hljs-string">"æ˜¯åŒä¸€ä¸ªå®ä¾‹: %v\n"</span>, db1 == db2)
}
</code></pre>
<h3 data-id="heading-25">3. <strong>sync.OnceValues</strong> - æ”¯æŒå¤šè¿”å›å€¼</h3>
<p>å¦‚æœåˆå§‹åŒ–å‡½æ•°éœ€è¦è¿”å›å¤šä¸ªå€¼ï¼ˆæ¯”å¦‚å¸¦é”™è¯¯å¤„ç†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>sync.OnceValues</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">var</span> getConfig = sync.OnceValues(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> (*Config, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–</span>
    <span class="hljs-keyword">if</span> someCondition := <span class="hljs-literal">false</span>; !someCondition {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"é…ç½®åŠ è½½å¤±è´¥"</span>)
    }
    
    <span class="hljs-keyword">return</span> &amp;Config{
        DatabaseURL: <span class="hljs-string">"postgres://localhost/mydb"</span>,
        MaxConnections: <span class="hljs-number">10</span>,
    }, <span class="hljs-literal">nil</span>
})

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL <span class="hljs-type">string</span>
    MaxConnections <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    config, err := getConfig()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"é”™è¯¯: %v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    
    fmt.Printf(<span class="hljs-string">"é…ç½®: %+v\n"</span>, config)
}
</code></pre>
<h2 data-id="heading-26">Rust OnceCell vs Go sync.Once å¯¹æ¯”</h2>



































<table><thead><tr><th>ç‰¹æ€§</th><th>Rust OnceCell/OnceLock</th><th>Go sync.Once</th></tr></thead><tbody><tr><td><strong>åŸºæœ¬ç”¨æ³•</strong></td><td><code>cell.get_or_init(|| value)</code></td><td><code>once.Do(func() {...})</code></td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>OnceLock çº¿ç¨‹å®‰å…¨</td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>ç›´æ¥è¿”å›å€¼çš„å¼•ç”¨</td><td>éœ€è¦æ‰‹åŠ¨å­˜å‚¨å€¼</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td><code>get_or_try_init</code> æ”¯æŒ</td><td>éœ€è¦æ‰‹åŠ¨å¤„ç†</td></tr><tr><td><strong>API ç®€æ´åº¦</strong></td><td>OnceValue æ›´ç®€æ´</td><td>ä¼ ç»Ÿæ–¹å¼ç¨ç¹ç</td></tr></tbody></table>
<h2 data-id="heading-27">å®æˆ˜ç¤ºä¾‹ï¼šæ•°æ®åº“è¿æ¥æ± </h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
    _ <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-keyword">type</span> Database <span class="hljs-keyword">struct</span> {
    Connection *sql.DB
}

<span class="hljs-keyword">var</span> (
    instance *Database
    once     sync.Once
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetDatabaseInstance</span><span class="hljs-params">()</span></span> *Database {
    once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ..."</span>)
        db, err := sql.Open(<span class="hljs-string">"mysql"</span>, <span class="hljs-string">"user:password@/dbname"</span>)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
        instance = &amp;Database{Connection: db}
    })
    <span class="hljs-keyword">return</span> instance
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¹¶å‘è®¿é—®ï¼Œåªä¼šåˆå§‹åŒ–ä¸€æ¬¡</span>
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(id <span class="hljs-type">int</span>)</span></span> {
            <span class="hljs-keyword">defer</span> wg.Done()
            db := GetDatabaseInstance()
            fmt.Printf(<span class="hljs-string">"Goroutine %d è·å–åˆ°æ•°æ®åº“å®ä¾‹\n"</span>, id)
            _ = db
        }(i)
    }
    wg.Wait()
}
</code></pre>
<h2 data-id="heading-28">æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>Go 1.21+</strong>: ä¼˜å…ˆä½¿ç”¨ <code>sync.OnceValue</code>ï¼Œä»£ç æ›´ç®€æ´</li>
<li><strong>éœ€è¦é”™è¯¯å¤„ç†</strong>: ä½¿ç”¨ <code>sync.OnceValues</code> è¿”å›å€¼å’Œé”™è¯¯</li>
<li><strong>ä¼ ç»Ÿ Go ç‰ˆæœ¬</strong>: ä½¿ç”¨ <code>sync.Once</code> + å…¨å±€å˜é‡</li>
</ol>
<h2 data-id="heading-29">æ€»ç»“</h2>
<p>Go çš„ <code>sync.Once</code> ç³»åˆ—å’Œ Rust çš„ <code>OnceCell</code> è§£å†³çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–</strong>ã€‚è™½ç„¶ API è®¾è®¡ç•¥æœ‰ä¸åŒï¼Œä½†æ ¸å¿ƒæ€æƒ³å®Œå…¨ä¸€è‡´ã€‚Go çš„æ–¹æ¡ˆæ›´ç®€å•ç›´æ¥ï¼Œè€Œ Rust çš„ç±»å‹ç³»ç»Ÿæä¾›äº†æ›´å¼ºçš„ç¼–è¯‘æœŸä¿è¯ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcell%2Fstruct.OnceCell.html" title="https://doc.rust-lang.org/std/cell/struct.OnceCell.html" target="_blank" ref="nofollow noopener noreferrer">Rust æ ‡å‡†åº“æ–‡æ¡£ - OnceCell</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fsync%2Fstruct.OnceLock.html" title="https://doc.rust-lang.org/std/sync/struct.OnceLock.html" target="_blank" ref="nofollow noopener noreferrer">Rust æ ‡å‡†åº“æ–‡æ¡£ - OnceLock</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤]]></title>    <link>https://juejin.cn/post/7598464972911558696</link>    <guid>https://juejin.cn/post/7598464972911558696</guid>    <pubDate>2026-01-24T05:44:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972911558696" data-draft-id="7598401650856968192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤"/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2026-01-24T05:44:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lewis_lk"/> <meta itemprop="url" content="https://juejin.cn/user/4444673308898028"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4444673308898028/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lewis_lk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:44:08.000Z" title="Sat Jan 24 2026 05:44:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å®‰è£…Docker CE</h2>
<p>Docker CE(Community Edition)ï¼ŒDockerç¤¾åŒºç‰ˆï¼Œé€‚ç”¨äºå¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜æ„å»ºå®¹å™¨ä½¿ç”¨çš„å…è´¹ç‰ˆæœ¬</p>
<p>å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Finstall%2F" target="_blank" title="https://docs.docker.com/engine/install/" ref="nofollow noopener noreferrer">docs.docker.com/engine/instâ€¦</a></p>
<h3 data-id="heading-1">å®‰è£…è„šæœ¬</h3>
<blockquote>
<p>æˆ‘è¿™é‡Œä»¥<code>Debian</code>ç³»ç»Ÿå’Œ<code>Unbuntu</code>ä¸ºä¾‹ï¼Œä½¿ç”¨å›½å†…é•œåƒæºå†™äº†ä¸ªå®‰è£…è„šæœ¬ï¼Œå…¶å®ƒLinuxç‰ˆæœ¬å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚çš„</p>
</blockquote>
<ul>
<li>æ‹·è´ä¸‹é¢è„šæœ¬æ–‡ä»¶æŒ‰ç…§æç¤ºæ‰§è¡Œå³å¯</li>
</ul>
<pre><code class="hljs language-docker_install.sh" lang="docker_install.sh">#!/bin/bash

MIRROR_URL="" # é•œåƒæºURL

select_os() {
    echo "è¯·é€‰æ‹©æ“ä½œç³»ç»Ÿï¼š:"
    echo "1) debian"
    echo "2) ubuntu"
    echo "3) é€€å‡º"
    read -p "è¯·è¾“å…¥é€‰é¡¹ (1-3): " os_choice

    case $os_choice in
    1)
        os_choice="debian"
        ;;
    2)
        os_choice="ubuntu"
        ;;
    3)
        echo "é€€å‡º..."
        exit 0
        ;;
    *)
        echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¿è¡Œè„šæœ¬å¹¶é€‰æ‹©æœ‰æ•ˆé€‰é¡¹."
        exit 1
        ;;
    esac
}

select_mirror_source() {
    echo "è¯·é€‰æ‹©å®‰è£…é•œåƒæº:"
    echo "1) é˜¿é‡Œäº‘"
    echo "2) åä¸ºäº‘"
    echo "3) æ¸…åé•œåƒ"
    echo "4) é€€å‡º"
    read -p "è¯·è¾“å…¥é€‰é¡¹ (1-4): " mirror_choice

    case $mirror_choice in
    1)
        echo "æ­£åœ¨é…ç½®é˜¿é‡Œäº‘é•œåƒæº..."
        MIRROR_URL="https://mirrors.aliyun.com/docker-ce/linux/${os_choice}"
        ;;
    2)
        echo "æ­£åœ¨é…ç½®åä¸ºäº‘é•œåƒæº..."
        MIRROR_URL="https://mirrors.huaweicloud.com/docker-ce/linux/${os_choice}"
        ;;
    3)
        echo "æ­£åœ¨é…ç½®æ¸…åé•œåƒæº..."
        MIRROR_URL="https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/${os_choice}"
        ;;
    4)
        echo "é€€å‡º..."
        exit 0
        ;;
    *)
        echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¿è¡Œè„šæœ¬å¹¶é€‰æ‹©æœ‰æ•ˆé€‰é¡¹."
        exit 1
        ;;
    esac
}

install_docker_ce() {
    echo "Docker CEå¼€å§‹å®‰è£…..."
    sudo apt-get update
    sudo apt-get install -y \
        ca-certificates \
        curl \
        gnupg \
        lsb-release

    echo "æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥..."
    sudo install -m 0755 -d /etc/apt/keyrings
    curl -fsSL "${MIRROR_URL}/gpg" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    sudo chmod a+r /etc/apt/keyrings/docker.gpg

    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] $MIRROR_URL $(lsb_release -cs) stable" | \
        sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null

    sudo apt-get update
    sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

    echo "Docker CE å®‰è£…å®Œæˆ."
}

# ä¸»ç¨‹åº
main() {
    # é€‰æ‹©æ“ä½œç³»ç»Ÿ
    select_os

    # é€‰æ‹©é•œåƒæº
    select_mirror_source

    # å®‰è£…Docker CE
    install_docker_ce

    echo ""
    echo "è„šæœ¬æ‰§è¡Œå®Œæˆï¼"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
</code></pre>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œdockeråªå…è®¸åœ¨rootç”¨æˆ·ä¸‹ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦å…¶å®ƒç”¨æˆ·ä½¿ç”¨dockerï¼Œéœ€è¦å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºdockerç”¨æˆ·ç»„</span>
sudo groupadd docker
<span class="hljs-comment"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç”¨æˆ·ç»„</span>
sudo usermod -aG docker <span class="hljs-variable">$USER</span>
</code></pre>
<ul>
<li>å®‰è£…æ ¡éªŒ</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># èƒ½æ­£å¸¸è¾“å‡ºdockerç‰ˆæœ¬å·å°±è¯´æ˜å®‰è£…æˆåŠŸäº†</span>
docker version
</code></pre>
<h2 data-id="heading-2">å¸¸ç”¨Dockerå‘½ä»¤</h2>
<h3 data-id="heading-3">é•œåƒç›¸å…³</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥çœ‹æœ¬åœ°é•œåƒdocker images# æœç´¢é•œåƒ</span>
docker search <span class="hljs-section">[image]</span>

<span class="hljs-comment"># ä¸‹è½½é•œåƒ</span>
docker pull <span class="hljs-section">[image]</span>

<span class="hljs-comment"># åˆ é™¤é•œåƒ</span>
docker rmi <span class="hljs-section">[image]</span>
</code></pre>
<ul>
<li>é•œåƒå¯¼å…¥åˆ°æ–‡ä»¶ï¼Œæˆ–ä»æ–‡ä»¶å¯¼å…¥åˆ°é•œåƒ</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># dockerå¯¼å‡ºé•œåƒåˆ°æ–‡ä»¶</span>
docker save <span class="hljs-section">[OPTIONS]</span> IMAGE <span class="hljs-section">[IMAGE...]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker save -o mysql-8.tar mysql:8.0

<span class="hljs-comment"># dockerå¯¼å…¥æ–‡ä»¶åˆ°é•œåƒ</span>
docker load <span class="hljs-section">[OPTIONS]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker load -i mysql-8.tar
</code></pre>
<h3 data-id="heading-4">å®¹å™¨ç›¸å…³</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># dockeræŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨docker ps [-a]    # -a  -&gt; æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„# æ–°å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆå®¹å™¨å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ docker start å‘½ä»¤å¯åŠ¨ï¼‰</span>
docker run [options] [image]
    <span class="hljs-comment"># options å¸¸ç”¨å¯åŠ¨é€‰é¡¹:</span>
    <span class="hljs-comment"># -d   -&gt; åå°è¿è¡Œ</span>
    <span class="hljs-comment"># -p å®¿ä¸»IP:å®¹å™¨IP  -&gt; å°†å®¹å™¨IPæ˜ å°„åˆ°å®¿ä¸»IP</span>
    <span class="hljs-comment"># -v å®¿ä¸»file/path:å®¹å™¨file/path    -&gt; å°†å®¹å™¨çš„file/pathæŒ‚è½½åˆ°å®¿ä¸»çš„file/path</span>
    <span class="hljs-comment"># --name [name]     -&gt; ä¸ºå®¹å™¨å‘½å</span>
    <span class="hljs-comment"># --restart always  -&gt; è®¾ç½®å®¹å™¨éšdockerä¸€èµ·è‡ªåŠ¨å¯åŠ¨</span>

<span class="hljs-comment"># åˆ é™¤å®¹å™¨</span>
docker <span class="hljs-built_in">rm</span> [containID/containName] [options]
    <span class="hljs-comment"># options å¸¸ç”¨é€‰é¡¹ï¼š</span>
    <span class="hljs-comment"># -f    -&gt;  å¼ºåˆ¶åˆ é™¤å®¹å™¨</span>
<span class="hljs-comment"># å¯åŠ¨å®¹å™¨/åœæ­¢å®¹å™¨/é‡å¯å®¹å™¨docker start/stop/restart [containID/containName]</span>

<span class="hljs-comment"># è¿›å…¥å®¹å™¨</span>
docker <span class="hljs-built_in">exec</span> -it [containID/containName] bash
æˆ–
docker <span class="hljs-built_in">exec</span> -it [containID/containName] /bin/bash(å¦‚æœå®¹å™¨æ˜¯åŸºäºalpine é•œåƒçš„ æœ€åçš„ /bin/bash éœ€è¦æ¢æˆ /bin/sh )

<span class="hljs-comment"># æ‰§è¡Œå®¹å™¨çš„å‘½ä»¤</span>
docker <span class="hljs-built_in">exec</span> -it [containID/containName] [commond]
<span class="hljs-comment"># ç¤ºä¾‹ï¼Œæ‰§è¡Œ redis-test å®¹å™¨çš„ redis-cli å‘½ä»¤</span>
docker <span class="hljs-built_in">exec</span> -it redis-test redis-cli -a <span class="hljs-string">"123456"</span>
<span class="hljs-comment"># è¯´æ˜: è¿™å¥è¯æ‰§è¡Œäº† redis-testå®¹å™¨çš„ redis-cli å‘½ä»¤ï¼Œ-a å‘½ä»¤çš„ä½œç”¨æ˜¯è¾“å…¥å¯†ç </span>
</code></pre>
<h4 data-id="heading-5">æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿—</h4>
<pre><code class="hljs language-css" lang="css">docker logs -f -t <span class="hljs-attr">--tail</span>=<span class="hljs-number">100</span> <span class="hljs-selector-attr">[å®¹å™¨]</span>
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜
<ul>
<li>-fï¼šæŸ¥çœ‹å®æ—¶æ—¥å¿—</li>
<li>-tï¼šæŸ¥çœ‹æ—¥å¿—äº§ç”Ÿçš„æ—¶é—´</li>
<li>-tail=100ï¼šæŸ¥çœ‹æœ€åçš„100æ¡æ—¥å¿—</li>
<li>[å®¹å™¨]ï¼šå®¹å™¨åç§°</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">å®¹å™¨å¯¼å…¥åˆ°æ–‡ä»¶ï¼Œæˆ–ä»æ–‡ä»¶å¯¼å…¥åˆ°å®¹å™¨</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># dockerå¯¼å‡ºå®¹å™¨åˆ°æ–‡ä»¶</span>
docker export <span class="hljs-section">[OPTIONS]</span> CONTAINER
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker export -o mysql-8.tar mysql-demo

<span class="hljs-comment"># dockerå¯¼å…¥å®¹å™¨ç”Ÿæˆçš„æ–‡ä»¶åˆ°é•œåƒ</span>
docker import <span class="hljs-section">[OPTIONS]</span> file|URL|- <span class="hljs-section">[REPOSITORY[:TAG]]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker import mysql-8.tar mysql:8.0
</code></pre>
<h4 data-id="heading-7">æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‚æ•°</h4>
<blockquote>
<p>éœ€è¦å®‰è£…runlike,æ‰§è¡Œ<code>pip3 install runlike</code>å³å¯</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml">runlike -p <span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨å</span>&gt;</span>|<span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨ID</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">ä¿®æ”¹å®¹å™¨å¯åŠ¨å‚æ•°</h3>
<pre><code class="hljs language-ini" lang="ini">docker update <span class="hljs-section">[OPTIONS]</span> <span class="hljs-section">[CONTAINER...]</span>

<span class="hljs-comment"># ä¾‹å¦‚</span>
docker update <span class="hljs-attr">--restart</span>=always eureka-server
</code></pre>
<h3 data-id="heading-9">å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶ä¼ è¾“ç›¸å…³</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä» ä¸»æœº æ‹·è´åˆ° docker å®¹å™¨</span>
docker cp <span class="hljs-section">[ä¸»æœºæ–‡ä»¶]</span> <span class="hljs-section">[å®¹å™¨]</span>:<span class="hljs-section">[å®¹å™¨è·¯å¾„]</span>

<span class="hljs-comment"># ä» dockerå®¹å™¨ æ‹·è´åˆ° ä¸»æœº</span>
docker cp <span class="hljs-section">[å®¹å™¨]</span>:<span class="hljs-section">[å®¹å™¨è·¯å¾„]</span> <span class="hljs-section">[ä¸»æœºæ–‡ä»¶]</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤]]></title>    <link>https://juejin.cn/post/7598699872540311571</link>    <guid>https://juejin.cn/post/7598699872540311571</guid>    <pubDate>2026-01-24T05:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872540311571" data-draft-id="7598587406695006251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:57:42.000Z" title="Sat Jan 24 2026 05:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Windows CMD ä¸­æ‰§è¡Œ <code>agent-browser.cmd install</code> æŠ¥ â€œThe system cannot find the path specified.â€</p>
<h2 data-id="heading-0">ç°è±¡</h2>
<ul>
<li>CMD å¯æ‰¾åˆ° <code>agent-browser.cmd</code>ï¼Œä½†æ‰§è¡Œå³å¤±è´¥</li>
<li>PowerShell ä¹Ÿä¼šå¤ç°ç›¸åŒé”™è¯¯</li>
</ul>
<h2 data-id="heading-1">æ ¹å› </h2>
<p>Volta ç”Ÿæˆçš„ <code>agent-browser.cmd</code> å¯åŠ¨è„šæœ¬ä¼šå…ˆå¯»æ‰¾åŒ…å†… <code>bin/sh.exe</code>ï¼Œæ‰¾ä¸åˆ°åå›é€€åˆ° <code>/bin/sh</code>ã€‚Windows CMD é»˜è®¤æ²¡æœ‰ <code>sh</code>ï¼Œå› æ­¤ç›´æ¥å¤±è´¥ã€‚</p>
<h2 data-id="heading-2">ä¿®å¤æ–¹æ¡ˆ</h2>
<p>ç›´æ¥è°ƒç”¨åŒ…å†… Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»•è¿‡ <code>sh</code> ä¾èµ–ã€‚</p>
<p>ä¿®æ”¹æ–‡ä»¶ï¼š<code>C:\Users\Administrator\AppData\Local\Volta\tools\image\packages\agent-browser\agent-browser.cmd</code></p>
<blockquote>
<p>ä¸åŒç”µè„‘ä½ç½®ä¸ç›¸åŒ, æ‰¾åˆ°å„è‡ªå¯¹åº”çš„æ–‡ä»¶</p>
</blockquote>
<pre><code class="hljs language-bat" lang="bat">SET "BIN=%dp0%node_modules\agent-browser\bin\agent-browser-win32-x64.exe"
IF NOT EXIST "%BIN%" (
  echo agent-browser win32 binary not found: "%BIN%"
  exit /b 1
)

endLocal &amp; goto #_undefined_# 2&gt;NUL || title %COMSPEC% &amp; "%BIN%" %*
</code></pre>
<h2 data-id="heading-3">éªŒè¯</h2>
<pre><code class="hljs language-bat" lang="bat">agent-browser.cmd --help
</code></pre>
<h2 data-id="heading-4">å½±å“èŒƒå›´</h2>
<ul>
<li>ä»…å½±å“ Windows CMD/PowerShell å¯åŠ¨è·¯å¾„</li>
<li>ä¸å½±å“ Git Bash ç­‰æä¾› <code>sh</code> çš„ç¯å¢ƒ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisé«˜çº§ç‰¹æ€§å®æˆ˜ï¼šä»Bitmapsåˆ°ä½æ“ä½œçš„åº”ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7598370121436102706</link>    <guid>https://juejin.cn/post/7598370121436102706</guid>    <pubDate>2026-01-23T09:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598370121436102706" data-draft-id="7490846852620779535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisé«˜çº§ç‰¹æ€§å®æˆ˜ï¼šä»Bitmapsåˆ°ä½æ“ä½œçš„åº”ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="Redis,æ•°æ®åº“,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-23T09:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Goé«˜å¹¶å‘æ¶æ„_ç‹å·¥"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisé«˜çº§ç‰¹æ€§å®æˆ˜ï¼šä»Bitmapsåˆ°ä½æ“ä½œçš„åº”ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Goé«˜å¹¶å‘æ¶æ„_ç‹å·¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:42:11.000Z" title="Fri Jan 23 2026 09:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">æ–‡ç« å¼•è¨€</h4>
<p>æåˆ°Redisï¼Œå¤§å®¶è„‘æµ·ä¸­æµ®ç°çš„å¯èƒ½æ˜¯å®ƒä½œä¸ºé«˜æ€§èƒ½é”®å€¼å­˜å‚¨çš„ç»å…¸å½¢è±¡ï¼šä¸€ä¸ªè½»é‡ã€å¿«é€Ÿçš„å†…å­˜æ•°æ®åº“ï¼Œå®Œç¾èƒœä»»ç¼“å­˜ã€ä¼šè¯ç®¡ç†ç­‰åœºæ™¯ã€‚ç„¶è€Œï¼ŒRedisçš„é­…åŠ›è¿œä¸æ­¢äºæ­¤ã€‚éšç€ç‰ˆæœ¬è¿­ä»£ï¼Œå®ƒä»æœ€åˆçš„ç®€å•é”®å€¼å¯¹å·¥å…·ï¼Œé€æ­¥æ¼”åŒ–ä¸ºä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„æ•°æ®ç»“æ„ç‘å£«å†›åˆ€ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¦èŠçš„ä¸»è§’â€”â€”<strong>Bitmapså’Œä½æ“ä½œ</strong>ï¼Œæ­£æ˜¯Redisé«˜çº§ç‰¹æ€§ä¸­ä¸€é¢—ä½è°ƒå´è€€çœ¼çš„æ˜ç ã€‚</p>
<p>å¯¹äºå·²ç»æœ‰1-2å¹´Redisä½¿ç”¨ç»éªŒçš„å¼€å‘è€…æ¥è¯´ï¼ŒåŸºç¡€çš„<code>SET</code>ã€<code>GET</code>ã€<code>HSET</code>æ—©å·²é©¾è½»å°±ç†Ÿï¼Œä½†ä½ æ˜¯å¦æ›¾å¥½å¥‡ï¼šå¦‚ä½•ç”¨æ›´å°‘çš„å†…å­˜å®Œæˆæµ·é‡æ•°æ®çš„ç»Ÿè®¡ï¼Ÿå¦‚ä½•åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å®ç°é«˜æ•ˆçš„çŠ¶æ€æ ‡è®°ï¼ŸBitmapså’Œä½æ“ä½œæ­£æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„åˆ©å™¨ã€‚å®ƒä»¬ä»¥æè‡´çš„å†…å­˜æ•ˆç‡å’Œé«˜æ€§èƒ½è®¡ç®—èƒ½åŠ›ï¼Œæ‰“å¼€äº†Redisåº”ç”¨åœºæ™¯çš„æ–°å¤§é—¨ã€‚æ— è®ºæ˜¯è®°å½•ç”¨æˆ·ç­¾åˆ°ã€ç»Ÿè®¡å®æ—¶åœ¨çº¿äººæ•°ï¼Œè¿˜æ˜¯å®ç°æƒé™æ§åˆ¶ï¼ŒBitmapséƒ½èƒ½è®©ä½ åœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ï¼Œåšåˆ°â€œä»¥ä¸€å½“åâ€ã€‚</p>
<p>ä½œä¸ºä¸€åæœ‰10å¹´Rediså®æˆ˜ç»éªŒçš„è€å…µï¼Œæˆ‘æ›¾åœ¨æ— æ•°é¡¹ç›®ä¸­è§è¯Bitmapsçš„å¨åŠ›ï¼Œä¹Ÿè¸©è¿‡ä¸å°‘å‘â€”â€”ä»å†…å­˜è¶…é™çš„å°´å°¬ï¼Œåˆ°å‘½ä»¤è¯¯ç”¨çš„æ€§èƒ½é™·é˜±ã€‚è¿™äº›ç»éªŒè®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°</p>
<p>ï¼ŒæŠ€æœ¯çš„é«˜çº§ç‰¹æ€§åªæœ‰åœ¨å®è·µä¸­è½åœ°ï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥ä»·å€¼ã€‚æœ¬æ–‡çš„ç›®æ ‡ï¼Œå°±æ˜¯å¸¦ä½ ä»Bitmapsçš„åŸºç¡€çŸ¥è¯†å‡ºå‘ï¼Œæ·±å…¥å‰–æå…¶æ ¸å¿ƒä¼˜åŠ¿ï¼Œå†é€šè¿‡çœŸå®æ¡ˆä¾‹å±•ç¤ºå®ƒçš„åº”ç”¨åœºæ™¯ï¼Œæœ€ååˆ†äº«ä¸€äº›è¸©å‘æ•™è®­å’Œä¼˜åŒ–å»ºè®®ã€‚æ— è®ºä½ æ˜¯æƒ³æå‡æŠ€æœ¯æ·±åº¦ï¼Œè¿˜æ˜¯åœ¨é¡¹ç›®ä¸­å¯»æ‰¾é«˜æ•ˆè§£æ³•ï¼Œè¿™ç¯‡æ–‡ç« éƒ½å¸Œæœ›æˆä¸ºä½ çš„â€œå®æˆ˜æŒ‡å—â€ã€‚</p>
<p>æ–‡ç« çš„ç»“æ„å®‰æ’å¦‚ä¸‹ï¼šæˆ‘ä»¬å…ˆå¿«é€Ÿå›é¡¾Bitmapså’Œä½æ“ä½œçš„åŸºç¡€çŸ¥è¯†ï¼Œç¡®ä¿èµ·è·‘çº¿ä¸€è‡´ï¼›æ¥ç€æ·±å…¥æ¢è®¨å…¶ç‰¹è‰²åŠŸèƒ½å’Œä¼˜åŠ¿ï¼Œå¸¦ä½ ç†è§£â€œä¸ºä»€ä¹ˆç”¨å®ƒâ€ï¼›ç„¶åé€šè¿‡å››ä¸ªå®æˆ˜åœºæ™¯ï¼Œå±•ç¤ºâ€œæ€ä¹ˆç”¨å®ƒâ€ï¼›æœ€åç»“åˆæœ€ä½³å®è·µå’Œè¸©å‘ç»éªŒï¼Œå¸®ä½ å°‘èµ°å¼¯è·¯ã€‚å…¨æ–‡çº¦4700å­—ï¼Œæ—¢æœ‰å¹²è´§ä¹Ÿæœ‰æ•…äº‹ï¼Œå¸Œæœ›ä½ è¯»å®Œåèƒ½æœ‰æ‰€æ”¶è·ï¼Œç”šè‡³è·ƒè·ƒæ¬²è¯•åœ°åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä¸€å±•èº«æ‰‹ã€‚</p>
<p>å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·è§£é”Redis Bitmapsçš„éšè—æŠ€èƒ½ï¼Œä»å†…å­˜ä¸­çš„â€œä½ä¸–ç•Œâ€å‡ºå‘ï¼Œæ¢ç´¢å®ƒçš„æ— é™å¯èƒ½å§ï¼</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Bitmapså’Œä½æ“ä½œåŸºç¡€å›é¡¾</h3>
<p>åœ¨æ·±å…¥æ¢è®¨Bitmapsçš„å®æˆ˜åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ‰“å¥½åœ°åŸºï¼Œå›é¡¾ä¸€ä¸‹å®ƒçš„åŸºç¡€çŸ¥è¯†ã€‚å¯¹äºå·²ç»ç†Ÿæ‚‰Redisçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™éƒ¨åˆ†å¯èƒ½æ˜¯â€œè€æœ‹å‹è§é¢â€ï¼Œä½†å³ä½¿æ˜¯è€æœ‹å‹ï¼Œä¹Ÿæœ‰å€¼å¾—ç»†ç»†å“å‘³çš„ç»†èŠ‚ã€‚Bitmapså’Œä½æ“ä½œçœ‹ä¼¼ç®€å•ï¼Œå´è—ç€Redisè®¾è®¡å“²å­¦ä¸­çš„ç²¾é«“ï¼šç”¨æœ€å°çš„èµ„æºï¼Œè§£å†³æœ€å¤§çš„é—®é¢˜ã€‚</p>
<h4 data-id="heading-2">1. ä»€ä¹ˆæ˜¯Bitmaps</h4>
<p>Bitmapsåœ¨Redisä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäºå­—ç¬¦ä¸²ï¼ˆStringï¼‰å®ç°çš„ä½æ•°ç»„ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±åƒä¸€å¼ å·¨å¤§çš„è¡¨æ ¼ï¼Œä½†æ¯ä¸ªæ ¼å­åªèƒ½å­˜0æˆ–1â€”â€”è¦ä¹ˆæ˜¯â€œå¼€â€ï¼Œè¦ä¹ˆæ˜¯â€œå…³â€ã€‚é€šè¿‡ä½åç§»ï¼ˆoffsetï¼‰ï¼Œä½ å¯ä»¥ç²¾ç¡®åœ°å®šä½åˆ°æŸä¸ªä½ï¼Œè®¾ç½®æˆ–è¯»å–å®ƒçš„å€¼ã€‚</p>
<p>Redisæä¾›äº†å‡ ä¸ªåŸºç¡€å‘½ä»¤æ¥æ“ä½œBitmapsï¼š</p>
<ul>
<li><strong><code>SETBIT key offset value</code></strong>ï¼šå°†æŒ‡å®šåç§»é‡çš„ä½è®¾ç½®ä¸º0æˆ–1ã€‚</li>
<li><strong><code>GETBIT key offset</code></strong>ï¼šè¯»å–æŒ‡å®šåç§»é‡çš„ä½å€¼ã€‚</li>
<li><strong><code>BITCOUNT key [start end]</code></strong>ï¼šç»Ÿè®¡æŒ‡å®šèŒƒå›´å†…1çš„ä¸ªæ•°ã€‚</li>
<li><strong><code>BITOP operation destkey key [key ...]</code></strong>ï¼šå¯¹å¤šä¸ªBitmapsæ‰§è¡Œä½è¿ç®—ï¼ˆå¦‚ANDã€ORã€XORã€NOTï¼‰ã€‚</li>
</ul>
<p><strong>å†…å­˜æ•ˆç‡</strong>æ˜¯Bitmapsçš„ä¸€å¤§äº®ç‚¹ã€‚å‡è®¾ä½ è¦è®°å½•1äº¿ä¸ªç”¨æˆ·çš„æŸç§çŠ¶æ€ï¼ˆä¾‹å¦‚æ˜¯å¦æ´»è·ƒï¼‰ï¼Œç”¨Bitmapsåªéœ€è¦å¤§çº¦12MBå†…å­˜ï¼ˆ1äº¿ä½ Ã· 8 â‰ˆ 12.5MBï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç”¨Setæˆ–Listå­˜å‚¨åŒæ ·çš„æ•°æ®ï¼Œå†…å­˜å ç”¨å¯èƒ½æ˜¯å®ƒçš„å‡ åå€ã€‚è¿™ç§â€œä»¥å°åšå¤§â€çš„ç‰¹æ€§ï¼Œè®©Bitmapsåœ¨å¤§æ•°æ®åœºæ™¯ä¸‹å¤§æ”¾å¼‚å½©ã€‚</p>
<h4 data-id="heading-3">2. ä½æ“ä½œç®€ä»‹</h4>
<p>Bitmapsä¸ä»…èƒ½å­˜ï¼Œè¿˜èƒ½ç®—ã€‚Redisæ”¯æŒçš„ä½æ“ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>AND</strong>ï¼šäº¤é›†è¿ç®—ï¼Œæ‰¾å‡ºå¤šä¸ªBitmapsä¸­å…±åŒä¸º1çš„ä½ã€‚</li>
<li><strong>OR</strong>ï¼šå¹¶é›†è¿ç®—ï¼Œåˆå¹¶å¤šä¸ªBitmapsä¸­çš„1ã€‚</li>
<li><strong>XOR</strong>ï¼šå¼‚æˆ–è¿ç®—ï¼Œæ‰¾å‡ºå·®å¼‚éƒ¨åˆ†ã€‚</li>
<li><strong>NOT</strong>ï¼šå–åè¿ç®—ï¼Œå°†0å˜ä¸º1ï¼Œ1å˜ä¸º0ã€‚</li>
</ul>
<p>ç›¸æ¯”ä¼ ç»Ÿæ•°æ®ç»“æ„ï¼Œä½æ“ä½œçš„ä¼˜åŠ¿åœ¨äºå®ƒçš„â€œåŸå­æ€§â€å’Œâ€œé«˜æ•ˆæ€§â€ã€‚ä¾‹å¦‚ï¼Œç”¨Setå®ç°äº¤é›†éœ€è¦<code>SINTER</code>ï¼Œè€ŒBitmapsç”¨<code>BITOP AND</code>ï¼Œåè€…åœ¨åº•å±‚ç›´æ¥æ“ä½œä½ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´ä½ã€‚</p>























<table><thead><tr><th>æ•°æ®ç»“æ„</th><th>äº¤é›†æ“ä½œ</th><th>å†…å­˜å ç”¨ï¼ˆ1äº¿ç”¨æˆ·ï¼‰</th><th>è®¡ç®—å¤æ‚åº¦</th></tr></thead><tbody><tr><td>Set</td><td><code>SINTER</code></td><td>~æ•°ç™¾MB</td><td>O(N)</td></tr><tr><td>Bitmaps</td><td><code>BITOP AND</code></td><td>~12MB</td><td>O(ä½é•¿åº¦)</td></tr></tbody></table>
<h4 data-id="heading-4">3. é€‚ç”¨åœºæ™¯åˆæ¢</h4>
<p>Bitmapsçš„é€‚ç”¨åœºæ™¯å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>éœ€è¦é«˜æ•ˆå­˜å‚¨å’Œè®¡ç®—å¤§é‡äºŒå€¼çŠ¶æ€çš„åœºæ™¯</strong>ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><strong>æ•°æ®ç»Ÿè®¡</strong>ï¼šç»Ÿè®¡æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°ã€‚</li>
<li><strong>çŠ¶æ€æ ‡è®°</strong>ï¼šè®°å½•ç”¨æˆ·æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦åœ¨çº¿ã€‚</li>
<li><strong>å®æ—¶åˆ†æ</strong>ï¼šåˆ†æå¤šç»„æ•°æ®çš„äº¤é›†æˆ–å¹¶é›†ã€‚</li>
</ul>
<p>å®ƒå°±åƒä¸€ä¸ªâ€œè½»é‡çº§è®¡ç®—å™¨â€ï¼Œåœ¨å†…å­˜å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°äº†ç»å¦™çš„å¹³è¡¡ç‚¹ã€‚</p>
<h4 data-id="heading-5">4. ç¤ºä¾‹ä»£ç </h4>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ä¸Šæ‰‹Bitmapsã€‚å‡è®¾æˆ‘ä»¬è¦è®°å½•2025å¹´4æœˆ8æ—¥ç”¨æˆ·çš„æ´»è·ƒçŠ¶æ€ï¼Œç”¨æˆ·IDä¸º10086ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®ç”¨æˆ·10086ä¸ºæ´»è·ƒï¼ˆ1è¡¨ç¤ºæ´»è·ƒï¼Œ0è¡¨ç¤ºä¸æ´»è·ƒï¼‰</span>
SETBIT user:active:20250408 10086 1

<span class="hljs-comment"># æŸ¥è¯¢ç”¨æˆ·10086æ˜¯å¦æ´»è·ƒ</span>
GETBIT user:active:20250408 10086
<span class="hljs-comment"># è¿”å›ï¼š1</span>

<span class="hljs-comment"># ç»Ÿè®¡å½“å¤©æ´»è·ƒç”¨æˆ·æ€»æ•°</span>
BITCOUNT user:active:20250408
<span class="hljs-comment"># è¿”å›ï¼šæ´»è·ƒç”¨æˆ·æ•°é‡</span>
</code></pre>
<p><strong>ä»£ç æ³¨é‡Š</strong>ï¼š</p>
<ul>
<li><code>SETBIT</code>çš„offsetæ˜¯ç”¨æˆ·IDï¼Œç›´æ¥ç”¨æ•´æ•°è¡¨ç¤ºã€‚</li>
<li><code>GETBIT</code>è¿”å›0æˆ–1ï¼Œç®€å•ç›´è§‚ã€‚</li>
<li><code>BITCOUNT</code>é»˜è®¤ç»Ÿè®¡æ•´ä¸ªBitmapsä¸­1çš„ä¸ªæ•°ã€‚</li>
</ul>
<h4 data-id="heading-6">è¿‡æ¸¡å°ç»“</h4>
<p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ å¯èƒ½å·²ç»æ„Ÿå—åˆ°Bitmapsçš„ç®€æ´ä¸å¼ºå¤§ã€‚å®ƒä¸ä»…èƒ½å­˜ä¸‹æµ·é‡æ•°æ®ï¼Œè¿˜èƒ½é€šè¿‡ä½æ“ä½œå®Œæˆå¤æ‚çš„è®¡ç®—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·±å…¥å‰–æBitmapsçš„ç‰¹è‰²åŠŸèƒ½ï¼Œçœ‹çœ‹å®ƒåœ¨å†…å­˜æ•ˆç‡å’Œé«˜æ€§èƒ½è®¡ç®—ä¸Šçš„â€œç‹¬é—¨ç»æŠ€â€ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­å‘æŒ¥ä½œç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-7">äºŒã€Bitmapså’Œä½æ“ä½œçš„ç‰¹è‰²åŠŸèƒ½ä¸ä¼˜åŠ¿</h3>
<p>æŒæ¡äº†Bitmapsçš„åŸºç¡€åï¼Œæˆ‘ä»¬è¿›å…¥æ›´ç²¾å½©çš„éƒ¨åˆ†ï¼šå®ƒçš„ç‰¹è‰²åŠŸèƒ½å’Œç‹¬ç‰¹ä¼˜åŠ¿ã€‚å¦‚æœè¯´Bitmapsæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œé‚£ä¹ˆå®ƒçš„å†…å­˜æ•ˆç‡å’Œé«˜æ€§èƒ½è®¡ç®—å°±æ˜¯â€œé”‹åˆ©çš„åˆ€åˆƒâ€ï¼Œèƒ½åœ¨ç‰¹å®šåœºæ™¯ä¸‹è½»æ¾åˆ‡å¼€å¤æ‚é—®é¢˜ã€‚è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†ä»å†…å­˜ä¼˜åŒ–ã€æ€§èƒ½è¡¨ç°å’Œçµæ´»æ€§ä¸‰ä¸ªè§’åº¦ï¼Œå¸¦ä½ çœ‹çœ‹Bitmapsä¸ºä½•èƒ½æˆä¸ºRedisé«˜çº§ç‰¹æ€§ä¸­çš„â€œéšè—ç‹ç‰Œâ€ã€‚</p>
<h4 data-id="heading-8">1. å†…å­˜æ•ˆç‡çš„æè‡´ä¼˜åŒ–</h4>
<p>Bitmapsçš„æœ€å¤§å–ç‚¹ä¹‹ä¸€ï¼Œå°±æ˜¯å®ƒå¯¹å†…å­˜çš„â€œåå•¬â€ã€‚åœ¨å¤§æ•°æ®é‡åœºæ™¯ä¸‹ï¼Œè¿™ç§ç‰¹æ€§å°¤ä¸ºçªå‡ºã€‚å‡è®¾æˆ‘ä»¬è¦å­˜å‚¨1000ä¸‡ç”¨æˆ·çš„æŸç§çŠ¶æ€ï¼ˆæ¯”å¦‚æ˜¯å¦å‚ä¸æŸæ´»åŠ¨ï¼‰ï¼Œç”¨Setå’ŒBitmapsçš„å†…å­˜å ç”¨å¯¹æ¯”å¦‚ä¸‹ï¼š</p>




















<table><thead><tr><th>æ•°æ®ç»“æ„</th><th>å†…å­˜å ç”¨ï¼ˆ1000ä¸‡ç”¨æˆ·ï¼‰</th><th>ç¤ºä¾‹Keyæ ¼å¼</th></tr></thead><tbody><tr><td>Set</td><td>~200-300MB</td><td><code>SADD user:active 10086</code></td></tr><tr><td>Bitmaps</td><td>~1.25MB</td><td><code>SETBIT user:active 10086 1</code></td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆå·®è·è¿™ä¹ˆå¤§ï¼Ÿ</strong><br/>
Setéœ€è¦ä¸ºæ¯ä¸ªå…ƒç´ å­˜å‚¨å®Œæ•´çš„å­—ç¬¦ä¸²é”®ï¼Œè€ŒBitmapsåªç”¨1ä½è¡¨ç¤ºä¸€ä¸ªçŠ¶æ€ï¼Œç›¸å½“äºæŠŠæ•°æ®â€œå‹ç¼©â€åˆ°äº†æè‡´ã€‚1äº¿ä½ä»…éœ€12.5MBï¼Œ10äº¿ä½ä¹Ÿä¸è¿‡125MBï¼Œè¿™ç§æ•ˆç‡è®©å®ƒåœ¨å­˜å‚¨å¤§è§„æ¨¡äºŒå€¼æ•°æ®æ—¶æ— å‡ºå…¶å³ã€‚</p>
<p><strong>å®æˆ˜ç»éªŒ</strong>ï¼šåœ¨ä¸€æ¬¡ç”µå•†æ´»åŠ¨ä¸­ï¼Œæˆ‘æ›¾ç”¨Bitmapsè®°å½•1000ä¸‡ç”¨æˆ·çš„é¢†å–çŠ¶æ€ï¼Œå†…å­˜å ç”¨ä»…1.2MBï¼Œè€Œç”¨Setæ—¶ç›´æ¥é£™å‡åˆ°250MBï¼Œå·®ç‚¹æŠŠRediså®ä¾‹æ’‘çˆ†ã€‚Bitmapsä¸ä»…çœé’±ï¼ˆå†…å­˜å°±æ˜¯æœåŠ¡å™¨æˆæœ¬ï¼‰ï¼Œè¿˜è®©ç³»ç»Ÿæ›´ç¨³å®šã€‚</p>
<h4 data-id="heading-9">2. é«˜æ€§èƒ½ä½è¿ç®—</h4>
<p>Bitmapsçš„å¦ä¸€ä¸ªæ€æ‰‹é”æ˜¯å®ƒçš„ä½è¿ç®—èƒ½åŠ›ã€‚Redisçš„<code>BITOP</code>å‘½ä»¤å¯ä»¥åœ¨å¤šä¸ªBitmapsé—´æ‰§è¡ŒANDã€ORã€XORç­‰æ“ä½œï¼Œè€Œä¸”æ˜¯åŸå­çš„ï¼Œæ€§èƒ½æé«˜ã€‚ä»¥ç»Ÿè®¡ä¸¤å¤©æ´»è·ƒç”¨æˆ·çš„äº¤é›†ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å‡è®¾æœ‰ä¸¤ä¸ªBitmapsè®°å½•ä¸¤å¤©ç”¨æˆ·çš„æ´»è·ƒçŠ¶æ€</span>
SETBIT user:active:20250408 10086 1
SETBIT user:active:20250407 10086 1
SETBIT user:active:20250407 10087 1

<span class="hljs-comment"># è®¡ç®—ä¸¤å¤©éƒ½æ´»è·ƒçš„ç”¨æˆ·äº¤é›†</span>
BITOP AND result user:active:20250408 user:active:20250407

<span class="hljs-comment"># ç»Ÿè®¡äº¤é›†äººæ•°</span>
BITCOUNT result
<span class="hljs-comment"># è¿”å›ï¼š1ï¼ˆåªæœ‰10086ä¸¤å¤©éƒ½æ´»è·ƒï¼‰</span>
</code></pre>
<p><strong>ä»£ç æ³¨é‡Š</strong>ï¼š</p>
<ul>
<li><code>BITOP AND</code>å°†ä¸¤ä¸ªBitmapsé€ä½ç›¸ä¸ï¼Œç»“æœå­˜å…¥<code>result</code>ã€‚</li>
<li><code>BITCOUNT</code>è®¡ç®—<code>result</code>ä¸­1çš„æ€»æ•°ã€‚</li>
</ul>
<p><strong>æ€§èƒ½åˆ†æ</strong>ï¼šåœ¨å•æœºç¯å¢ƒä¸‹ï¼Œä½è¿ç®—çš„å¤æ‚åº¦æ˜¯O(N)ï¼ŒNä¸ºBitmapsçš„ä½é•¿åº¦ã€‚ä½†ç”±äºåº•å±‚ç”¨çš„æ˜¯ä½çº§æ“ä½œï¼Œå®é™…å»¶è¿Ÿéå¸¸ä½ã€‚æˆ‘æ›¾åœ¨4MBçš„Bitmapsä¸Šåšäº¤é›†è¿ç®—ï¼Œè€—æ—¶ä¸åˆ°10msã€‚è€ŒåŒæ ·çš„æ•°æ®ç”¨Setçš„<code>SINTER</code>ï¼Œè€—æ—¶å¯èƒ½æ˜¯å®ƒçš„5-10å€ã€‚</p>
<p><strong>åˆ†å¸ƒå¼åœºæ™¯çš„å±€é™</strong>ï¼šå¦‚æœBitmapsåˆ†å¸ƒåœ¨ä¸åŒRediså®ä¾‹ä¸Šï¼Œ<code>BITOP</code>æ— æ³•ç›´æ¥è·¨èŠ‚ç‚¹æ‰§è¡Œã€‚è¿™æ—¶éœ€è¦å®¢æˆ·ç«¯æ‹‰å–æ•°æ®åè‡ªè¡Œè®¡ç®—ï¼Œæ€§èƒ½ä¼šæ‰“æŠ˜æ‰£ã€‚è§£å†³åŠæ³•æ˜¯ç”¨Redis Clusteråˆ†ç‰‡å­˜å‚¨ï¼Œä½†éœ€æå‰è§„åˆ’Keyåˆ†å¸ƒã€‚</p>
<h4 data-id="heading-10">3. çµæ´»æ€§ä¸æ‰©å±•æ€§</h4>
<p>Bitmapsçš„ä½åç§»è®¾è®¡èµ‹äºˆäº†å®ƒæƒŠäººçš„çµæ´»æ€§ã€‚ä½ å¯ä»¥æŠŠä¸€ä¸ªBitmapsæƒ³è±¡æˆä¸€å¼ â€œå¤šç»´è¡¨æ ¼â€ï¼Œé€šè¿‡åç§»é‡è¡¨ç¤ºä¸åŒçš„çŠ¶æ€æˆ–ç»´åº¦ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>åç§»0-31è¡¨ç¤ºæŸç”¨æˆ·32å¤©çš„ç­¾åˆ°çŠ¶æ€ã€‚</li>
<li>åç§»0è¡¨ç¤ºè¯»æƒé™ï¼Œ1è¡¨ç¤ºå†™æƒé™ï¼Œ2è¡¨ç¤ºæ‰§è¡Œæƒé™ã€‚</li>
</ul>
<p>è¿™ç§è®¾è®¡è®©Bitmapsèƒ½è½»æ¾åº”å¯¹å¤šç»´æ•°æ®å­˜å‚¨éœ€æ±‚ã€‚ç”šè‡³å¯ä»¥ç»“åˆå…¶ä»–æ•°æ®ç»“æ„è¿›ä¸€æ­¥æ‰©å±•åŠŸèƒ½ï¼Œæ¯”å¦‚ç”¨HyperLogLogä¼°ç®—åŸºæ•°ï¼Œå†ç”¨Bitmapsç²¾ç¡®ç»Ÿè®¡ã€‚</p>
<p><strong>ç¤ºæ„å›¾</strong>ï¼šBitmapsçš„å¤šç»´å­˜å‚¨ç¤ºä¾‹</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åç§»é‡:  0  1  2  3  4  5  ...</span>
<span class="hljs-section">å«ä¹‰:   è¯» å†™ æ‰§è¡Œ ...  å¤©1 å¤©2 ...</span>
<span class="hljs-section">å€¼:     1  0  1  0  1  1  ...</span>
</code></pre>
<h4 data-id="heading-11">4. ä»£ç ç¤ºä¾‹ï¼šå®æˆ˜ä¸­çš„çµæ´»åº”ç”¨</h4>
<p>å‡è®¾æˆ‘ä»¬è¦ç»Ÿè®¡æŸæ´»åŠ¨è¿ç»­ä¸¤å¤©çš„æ´»è·ƒç”¨æˆ·ï¼Œå¹¶ä¸æ˜¨å¤©çš„åœ¨çº¿ç”¨æˆ·åšå¹¶é›†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®æ´»è·ƒç”¨æˆ·</span>
SETBIT active:20250408 10086 1
SETBIT active:20250407 10086 1
SETBIT online:20250407 10087 1

<span class="hljs-comment"># è®¡ç®—ä¸¤å¤©æ´»è·ƒäº¤é›†</span>
BITOP AND active_both active:20250408 active:20250407

<span class="hljs-comment"># å†ä¸æ˜¨å¤©åœ¨çº¿ç”¨æˆ·åˆå¹¶</span>
BITOP OR final_result active_both online:20250407

<span class="hljs-comment"># ç»Ÿè®¡æ€»æ•°</span>
BITCOUNT final_result
<span class="hljs-comment"># è¿”å›ï¼š2ï¼ˆ10086å’Œ10087ï¼‰</span>
</code></pre>
<p><strong>ä»£ç æ³¨é‡Š</strong>ï¼š</p>
<ul>
<li><code>BITOP AND</code>æ‰¾å‡ºè¿ç»­æ´»è·ƒç”¨æˆ·ã€‚</li>
<li><code>BITOP OR</code>åˆå¹¶å…¶ä»–çŠ¶æ€ï¼Œæ‰©å±•åˆ†æç»´åº¦ã€‚</li>
</ul>
<h4 data-id="heading-12">è¿‡æ¸¡å°ç»“</h4>
<p>é€šè¿‡å†…å­˜æ•ˆç‡ã€é«˜æ€§èƒ½ä½è¿ç®—å’Œçµæ´»æ€§çš„å‰–æï¼ŒBitmapsçš„ä¼˜åŠ¿å·²ç»è·ƒç„¶çº¸ä¸Šã€‚å®ƒå°±åƒä¸€ä¸ªâ€œç©ºé—´é­”æ³•å¸ˆâ€ï¼Œç”¨æœ€å°çš„å†…å­˜æ‰¿è½½æœ€å¤šçš„ä¿¡æ¯ï¼›åˆåƒä¸€ä¸ªâ€œè®¡ç®—å¿è€…â€ï¼Œåœ¨æ¯«ç§’é—´å®Œæˆå¤æ‚è¿ç®—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†èµ°è¿›çœŸå®çš„å®æˆ˜åœºæ™¯ï¼Œçœ‹çœ‹è¿™äº›ç‰¹æ€§å¦‚ä½•åœ¨é¡¹ç›®ä¸­è½åœ°ç”Ÿæ ¹ï¼Œè§£å†³å®é™…é—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-13">ä¸‰ã€å®æˆ˜åœºæ™¯ï¼šBitmapså’Œä½æ“ä½œçš„åº”ç”¨æ¡ˆä¾‹</h3>
<p>ç†è®ºå’Œç‰¹æ€§è®²å¾—å†å¤šï¼Œä¸å¦‚å®é™…ç”¨èµ·æ¥æ¥å¾—ç—›å¿«ã€‚è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†èµ°è¿›å››ä¸ªçœŸå®çš„å®æˆ˜åœºæ™¯ï¼Œçœ‹çœ‹Bitmapså’Œä½æ“ä½œå¦‚ä½•åœ¨é¡¹ç›®ä¸­å¤§æ˜¾èº«æ‰‹ã€‚ä»ç”¨æˆ·ç­¾åˆ°åˆ°åœ¨çº¿ç»Ÿè®¡ï¼Œå†åˆ°æƒé™ç®¡ç†å’Œå¤§æ•°æ®åˆ†æï¼Œæ¯ä¸ªæ¡ˆä¾‹éƒ½æ¥è‡ªæˆ‘çš„å®é™…ç»éªŒï¼Œå¸¦ç€â€œè¡€æ³ªæ•™è®­â€å’Œä¼˜åŒ–å¿ƒå¾—ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¯å‘ã€‚</p>
<h4 data-id="heading-14">1. åœºæ™¯1ï¼šç”¨æˆ·ç­¾åˆ°ç³»ç»Ÿ</h4>
<p><strong>éœ€æ±‚</strong>ï¼šåœ¨ä¸€ä¸ªç¤¾åŒºåº”ç”¨ä¸­ï¼Œéœ€è¦è®°å½•æ¯ä¸ªç”¨æˆ·çš„æ¯æ—¥ç­¾åˆ°çŠ¶æ€ï¼Œå¹¶æ”¯æŒç»Ÿè®¡è¿ç»­ç­¾åˆ°å¤©æ•°å’Œæ€»ç­¾åˆ°æ¬¡æ•°ã€‚<br/>
<strong>å®ç°</strong>ï¼šç”¨BitmapsæŒ‰ç”¨æˆ·å’Œæ—¶é—´å­˜å‚¨ç­¾åˆ°è®°å½•ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªKeyï¼Œåç§»é‡è¡¨ç¤ºå¤©æ•°ã€‚<br/>
<strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”¨æˆ·10086åœ¨2025å¹´ç¬¬98å¤©ç­¾åˆ°</span>
SETBIT signin:10086:2025 98 1

<span class="hljs-comment"># æŸ¥è¯¢ç¬¬98å¤©æ˜¯å¦ç­¾åˆ°</span>
GETBIT signin:10086:2025 98
<span class="hljs-comment"># è¿”å›ï¼š1</span>

<span class="hljs-comment"># ç»Ÿè®¡å…¨å¹´ç­¾åˆ°æ¬¡æ•°</span>
BITCOUNT signin:10086:2025
<span class="hljs-comment"># è¿”å›ï¼šç­¾åˆ°å¤©æ•°</span>
</code></pre>
<p><strong>å®ç°ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li>Keyæ ¼å¼ï¼š<code>signin:&lt;user_id&gt;:&lt;year&gt;</code>ã€‚</li>
<li>åç§»é‡ï¼š0-364è¡¨ç¤ºä¸€å¹´365å¤©ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ã€‚</li>
<li>å†…å­˜å ç”¨ï¼šæ¯ä¸ªç”¨æˆ·ä¸€å¹´åªéœ€365ä½ï¼Œçº¦46å­—èŠ‚ã€‚</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼š100ä¸‡ç”¨æˆ·ä¸€å¹´ä»…éœ€çº¦44MBã€‚</li>
<li><strong>æŸ¥è¯¢å¿«</strong>ï¼š<code>GETBIT</code>å’Œ<code>BITCOUNT</code>éƒ½æ˜¯O(1)æˆ–O(N)çº§åˆ«ï¼ŒNä¸ºä½é•¿åº¦ã€‚</li>
</ul>
<p><strong>è¸©å‘ç»éªŒ</strong>ï¼š<br/>
æˆ‘åœ¨æ—©æœŸè®¾è®¡æ—¶æ²¡è€ƒè™‘è·¨å¹´é—®é¢˜ï¼Œå¯¼è‡´å¹´åº•æ•°æ®æŸ¥è¯¢éœ€è¦æ‹¼æ¥ä¸¤ä¸ªKeyã€‚åæ¥æ”¹ä¸ºæŒ‰å¹´åˆ†ç‰‡ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å°è£…é€»è¾‘ï¼šå¦‚æœæŸ¥è¯¢è·¨å¹´ï¼Œåˆ™åˆ†åˆ«å–<code>signin:10086:2024</code>å’Œ<code>signin:10086:2025</code>ï¼Œå†åˆå¹¶ç»“æœã€‚</p>
<h4 data-id="heading-15">2. åœºæ™¯2ï¼šå®æ—¶åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡</h4>
<p><strong>éœ€æ±‚</strong>ï¼šæŸç›´æ’­å¹³å°éœ€è¦ç»Ÿè®¡æŸæ´»åŠ¨æ¯å°æ—¶çš„åœ¨çº¿äººæ•°ï¼Œå¹¶ä¸å†å²æ•°æ®å¯¹æ¯”ã€‚<br/>
<strong>å®ç°</strong>ï¼šç”¨Bitmapsè®°å½•æ¯å°æ—¶çš„åœ¨çº¿çŠ¶æ€ï¼Œ<code>BITOP</code>è®¡ç®—äº¤é›†æˆ–å¹¶é›†ã€‚<br/>
<strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®°å½•ä¸Šåˆå’Œä¸‹åˆçš„åœ¨çº¿ç”¨æˆ·</span>
SETBIT online:20250408:am 10086 1
SETBIT online:20250408:pm 10086 1
SETBIT online:20250408:pm 10087 1

<span class="hljs-comment"># è®¡ç®—å…¨å¤©åœ¨çº¿ç”¨æˆ·ï¼ˆå¹¶é›†ï¼‰</span>
BITOP OR daily_active online:20250408:am online:20250408:pm

<span class="hljs-comment"># ç»Ÿè®¡äººæ•°</span>
BITCOUNT daily_active
<span class="hljs-comment"># è¿”å›ï¼š2</span>

<span class="hljs-comment"># ä¸æ˜¨å¤©å¯¹æ¯”ï¼ˆäº¤é›†ï¼‰</span>
BITOP AND active_overlap daily_active online:20250407:full
BITCOUNT active_overlap
</code></pre>
<p><strong>å®ç°ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li>KeyæŒ‰æ—¶é—´åˆ†ç‰‡ï¼š<code>online:&lt;date&gt;:&lt;time&gt;</code>ã€‚</li>
<li>ç”¨æˆ·IDä½œä¸ºåç§»é‡ï¼Œ1è¡¨ç¤ºåœ¨çº¿ã€‚</li>
</ul>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li><strong>æ—¶é—´åˆ†ç‰‡</strong>ï¼šé¿å…å•Keyè¿‡å¤§ï¼Œæˆ‘æ›¾å› ç”¨<code>online:20250408</code>å­˜å…¨å¤©æ•°æ®ï¼Œå¯¼è‡´Keyè†¨èƒ€åˆ°å‡ åMBï¼Œ<code>BITCOUNT</code>å˜æ…¢ã€‚åæ¥æ”¹ä¸ºæŒ‰å°æ—¶åˆ†ç‰‡ï¼Œæ€§èƒ½æå‡æ˜æ˜¾ã€‚</li>
<li><strong>Pipelineä¼˜åŒ–</strong>ï¼šæ‰¹é‡è®¾ç½®åœ¨çº¿çŠ¶æ€æ—¶ï¼Œç”¨Pipelineå‡å°‘ç½‘ç»œå¼€é”€ã€‚</li>
</ul>
<p><strong>ç¤ºæ„å›¾</strong>ï¼šåœ¨çº¿çŠ¶æ€åˆ†ç‰‡</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Key: online:20250408:am  | åç§»: 10086 10087 ...</span>
<span class="hljs-section">å€¼:                  1        0    ...</span>
<span class="hljs-section">Key: online:20250408:pm  | å€¼:   1     1    ...</span>
</code></pre>
<h4 data-id="heading-16">3. åœºæ™¯3ï¼šæƒé™æ§åˆ¶ä¸çŠ¶æ€æ ‡è®°</h4>
<p><strong>éœ€æ±‚</strong>ï¼šä¸ºç”¨æˆ·åˆ†é…å¤šç»´åº¦æƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œç­‰ï¼‰ï¼Œå¹¶å¿«é€Ÿæ£€æŸ¥æƒé™çŠ¶æ€ã€‚<br/>
<strong>å®ç°</strong>ï¼šç”¨Bitmapsçš„ä½åç§»è¡¨ç¤ºä¸åŒæƒé™ï¼Œä¸€ä¸ªKeyç®¡ç†æ‰€æœ‰çŠ¶æ€ã€‚<br/>
<strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®ç”¨æˆ·10086çš„æƒé™ï¼šè¯»(0)ã€å†™(1)ã€æ‰§è¡Œ(2)</span>
SETBIT perms:10086 0 1  <span class="hljs-comment"># è¯»æƒé™</span>
SETBIT perms:10086 1 1  <span class="hljs-comment"># å†™æƒé™</span>
SETBIT perms:10086 2 0  <span class="hljs-comment"># æ— æ‰§è¡Œæƒé™</span>

<span class="hljs-comment"># æ£€æŸ¥è¯»æƒé™</span>
GETBIT perms:10086 0
<span class="hljs-comment"># è¿”å›ï¼š1</span>
</code></pre>
<p><strong>å®ç°ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li>åç§»é‡çº¦å®šï¼š0=è¯»ï¼Œ1=å†™ï¼Œ2=æ‰§è¡Œï¼Œå¯æ‰©å±•åˆ°æ›´å¤šä½ã€‚</li>
<li>å†…å­˜å ç”¨ï¼š10ç§æƒé™ä»…éœ€10ä½ï¼Œ1ä¸ªç”¨æˆ·ä¸åˆ°2å­—èŠ‚ã€‚</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å•Keyç®¡ç†</strong>ï¼šç›¸æ¯”Hashï¼ˆ<code>HSET perms:10086 read 1</code>ï¼‰ï¼ŒBitmapsæ›´ç´§å‡‘ã€‚</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ–°å¢æƒé™åªéœ€å¢åŠ åç§»é‡ã€‚</li>
</ul>
<p><strong>è¸©å‘ç»éªŒ</strong>ï¼š<br/>
æ—©æœŸæˆ‘æ²¡è§„åˆ’å¥½åç§»é‡ï¼Œåæ¥ä¸šåŠ¡æ–°å¢æƒé™æ—¶ï¼Œåç§»å®šä¹‰å†²çªï¼Œåªèƒ½é‡å»ºæ•°æ®ã€‚<strong>æ•™è®­</strong>ï¼šæå‰è®¾è®¡ä½åˆ†é…è¡¨ï¼Œä¾‹å¦‚ç”¨0-15ä½é¢„ç•™16ç§æƒé™ã€‚</p>
<h4 data-id="heading-17">4. åœºæ™¯4ï¼šå¤§æ•°æ®é‡ä¸‹çš„å»é‡ä¸äº¤é›†åˆ†æ</h4>
<p><strong>éœ€æ±‚</strong>ï¼šåˆ†ææŸå¹¿å‘ŠæŠ•æ”¾çš„ä¸¤ç»„ç”¨æˆ·é‡åˆåº¦ï¼ˆå¦‚Aæ¸ é“å’ŒBæ¸ é“çš„æ›å…‰ç”¨æˆ·ï¼‰ã€‚<br/>
<strong>å®ç°</strong>ï¼šBitmapså­˜å‚¨ç”¨æˆ·IDï¼Œ<code>BITOP</code>è®¡ç®—äº¤é›†ã€‚<br/>
<strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®°å½•Aã€Bæ¸ é“ç”¨æˆ·</span>
SETBIT ad:channel_a 10086 1
SETBIT ad:channel_a 10087 1
SETBIT ad:channel_b 10086 1

<span class="hljs-comment"># è®¡ç®—é‡åˆç”¨æˆ·</span>
BITOP AND ad_overlap ad:channel_a ad:channel_b
BITCOUNT ad_overlap
<span class="hljs-comment"># è¿”å›ï¼š1ï¼ˆ10086é‡åˆï¼‰</span>
</code></pre>
<p><strong>æ€§èƒ½åˆ†æ</strong>ï¼š</p>
<ul>
<li>æµ‹è¯•æ•°æ®ï¼š1000ä¸‡ç”¨æˆ·ï¼Œä¸¤ä¸ªBitmapså„1.25MBã€‚</li>
<li><code>BITOP AND</code>è€—æ—¶çº¦15msï¼Œ<code>BITCOUNT</code>çº¦5msï¼Œæ€»å»¶è¿Ÿä¸åˆ°20msã€‚</li>
<li>ç”¨Setçš„<code>SINTER</code>è€—æ—¶çº¦150msï¼Œå†…å­˜å ç”¨é«˜10å€ã€‚</li>
</ul>
<p><strong>è¸©å‘ç»éªŒ</strong>ï¼š<br/>
æˆ‘æ›¾å› <code>BITCOUNT</code>å…¨é‡æ‰«æå¤§Keyï¼Œå¯¼è‡´å“åº”å˜æ…¢ã€‚åæ¥å‘ç°å¯ä»¥ç”¨<code>BITCOUNT start end</code>æŒ‡å®šèŒƒå›´ï¼Œæˆ–è€…ç”¨Luaè„šæœ¬åˆ†æ®µç»Ÿè®¡ï¼Œé¿å…æ€§èƒ½é™·é˜±ã€‚</p>
<h4 data-id="heading-18">è¿‡æ¸¡å°ç»“</h4>
<p>è¿™å››ä¸ªåœºæ™¯å±•ç¤ºäº†Bitmapsçš„å¤šæ ·æ€§å’Œå®ç”¨æ€§ï¼šä»ç­¾åˆ°çš„â€œè½»é‡å­˜å‚¨â€ï¼Œåˆ°åœ¨çº¿ç»Ÿè®¡çš„â€œå®æ—¶è®¡ç®—â€ï¼Œå†åˆ°æƒé™ç®¡ç†çš„â€œç´§å‡‘è®¾è®¡â€å’Œå¤§æ•°æ®çš„â€œé«˜æ•ˆåˆ†æâ€ï¼Œå®ƒæ€»èƒ½æ‰¾åˆ°ç”¨æ­¦ä¹‹åœ°ã€‚ä½†å…‰ä¼šç”¨è¿˜ä¸å¤Ÿï¼Œæ¥ä¸‹æ¥çš„æœ€ä½³å®è·µå’Œè¸©å‘ç»éªŒï¼Œå°†å¸®ä½ æŠŠBitmapsç”¨å¾—æ›´ç¨³ã€æ›´å¿«ã€‚</p>
<hr/>
<h3 data-id="heading-19">å››ã€æœ€ä½³å®è·µä¸è¸©å‘ç»éªŒ</h3>
<p>Bitmapsè™½ç„¶å¼ºå¤§ï¼Œä½†ç”¨å¾—å¥½éœ€è¦ä¸€äº›â€œé—¨é“â€ã€‚é€šè¿‡å‰é¢åœºæ™¯çš„å®æˆ˜ï¼Œæˆ‘ä»¬å·²ç»æ„Ÿå—åˆ°å®ƒçš„æ½œåŠ›ï¼Œä½†ä¹Ÿæš´éœ²å‡ºä¸€äº›æ½œåœ¨é—®é¢˜ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†ã€æ€§èƒ½ç“¶é¢ˆå’Œåˆ†å¸ƒå¼åœºæ™¯çš„æŒ‘æˆ˜ã€‚è¿™ä¸€èŠ‚ï¼Œæˆ‘å°†ç»“åˆ10å¹´Redisç»éªŒï¼Œåˆ†äº«æœ€ä½³å®è·µå’Œè¸©å‘æ•™è®­ï¼Œå¸®åŠ©ä½ åœ¨é¡¹ç›®ä¸­æŠŠBitmapsç”¨å¾—åˆç¨³åˆå¿«ã€‚</p>
<h4 data-id="heading-20">1. æœ€ä½³å®è·µ</h4>
<p>è¦è®©Bitmapså‘æŒ¥æœ€å¤§ä»·å€¼ï¼Œä»¥ä¸‹å‡ ç‚¹å€¼å¾—é“­è®°ï¼š</p>
<ul>
<li>
<p><strong>Keyè®¾è®¡è§„èŒƒï¼šåˆ†ç‰‡æ˜¯ç‹é“</strong><br/>
å•Keyè¿‡å¤§æ˜¯Bitmapsä½¿ç”¨ä¸­çš„å¸¸è§éšæ‚£ã€‚æ¯”å¦‚è®°å½•åœ¨çº¿ç”¨æˆ·æ—¶ï¼Œå¦‚æœç”¨<code>online:20250408</code>å­˜å…¨å¤©æ•°æ®ï¼ŒKeyå¯èƒ½è†¨èƒ€åˆ°å‡ åMBï¼Œæ‹–æ…¢æ“ä½œã€‚<br/>
<strong>å»ºè®®</strong>ï¼šæŒ‰æ—¶é—´æˆ–åœ°åŸŸåˆ†ç‰‡ï¼Œä¾‹å¦‚<code>online:20250408:am</code>å’Œ<code>online:20250408:pm</code>ï¼Œæ¯ä¸ªKeyæ§åˆ¶åœ¨1-5MBä»¥å†…ï¼Œæ—¢ä¾¿äºç®¡ç†ï¼Œåˆæå‡æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–ï¼šæ‰¹é‡æ“ä½œæé€Ÿ</strong><br/>
é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé¢‘ç¹è°ƒç”¨<code>SETBIT</code>ä¼šå¢åŠ ç½‘ç»œå¼€é”€ã€‚<br/>
<strong>è§£å†³åŠæ³•</strong>ï¼šç”¨Pipelineæ‰¹é‡æäº¤ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Pipelineæ‰¹é‡è®¾ç½®</span>
redis-cli -h host -p port &lt;&lt;<span class="hljs-string">EOF
SETBIT online:20250408:am 10086 1
SETBIT online:20250408:am 10087 1
EOF</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šä¸€æ¬¡RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰å®Œæˆå¤šæ¡å‘½ä»¤ï¼Œååé‡æå‡3-5å€ã€‚</p>
</li>
<li>
<p><strong>å®¹é”™è®¾è®¡ï¼šLuaè„šæœ¬ä¿åŸå­æ€§</strong><br/>
Bitmapsæ“ä½œè™½å¿«ï¼Œä½†å¤šæ­¥æ“ä½œï¼ˆå¦‚å…ˆ<code>SETBIT</code>å†<code>BITOP</code>ï¼‰å¯èƒ½å› å¹¶å‘å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚<br/>
<strong>ç¤ºä¾‹</strong>ï¼šæ‰¹é‡è®¾ç½®å¹¶ç»Ÿè®¡ï¼š</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> offsets = ARGV
<span class="hljs-keyword">for</span> i, offset <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(offsets) <span class="hljs-keyword">do</span>
    redis.call(<span class="hljs-string">'SETBIT'</span>, key, offset, <span class="hljs-number">1</span>)
<span class="hljs-keyword">end</span>
<span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">'BITCOUNT'</span>, key)
</code></pre>
<p><strong>ç”¨æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">EVAL <span class="hljs-string">"script"</span> 1 online:20250408:am 10086 10087
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šä¿è¯åŸå­æ€§ï¼Œé¿å…ä¸­é—´çŠ¶æ€è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ã€‚</p>
</li>
</ul>
<h4 data-id="heading-21">2. è¸©å‘ç»éªŒ</h4>
<p>å®æˆ˜ä¸­ï¼Œæˆ‘è¸©è¿‡ä¸å°‘å‘ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹æ¡ˆä¾‹å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p><strong>å†…å­˜è¶…é™ï¼šæœªé¢„ä¼°æ•°æ®å¢é•¿å¯¼è‡´OOM</strong><br/>
åœ¨ä¸€ä¸ªå¹¿å‘Šåˆ†æé¡¹ç›®ä¸­ï¼Œæˆ‘ç”¨Bitmapså­˜å‚¨ç”¨æˆ·æ›å…‰æ•°æ®ï¼Œåˆå§‹è§„æ¨¡1000ä¸‡ç”¨æˆ·ï¼Œå†…å­˜å¯æ§ã€‚ä½†éšç€ä¸šåŠ¡å¢é•¿åˆ°1äº¿ç”¨æˆ·ï¼Œå•Keyè†¨èƒ€åˆ°12MBä»¥ä¸Šï¼Œè§¦å‘Redisçš„maxmemoryé™åˆ¶ï¼Œå¯¼è‡´OOMï¼ˆOut Of Memoryï¼‰ã€‚<br/>
<strong>è§£å†³åŠæ³•</strong>ï¼š</p>
<ul>
<li>æå‰é¢„ä¼°æ•°æ®è§„æ¨¡ï¼Œè®¾ç½®åˆç†çš„maxmemory-policyï¼ˆå¦‚<code>volatile-lru</code>ï¼‰ã€‚</li>
<li>ç”¨åˆ†ç‰‡ç­–ç•¥ï¼Œæ¯”å¦‚æŒ‰æ¸ é“æˆ–æ—¥æœŸæ‹†åˆ†Keyï¼š<code>ad:channel_a:202504</code>å’Œ<code>ad:channel_b:202504</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‘½ä»¤è¯¯ç”¨ï¼šBITCOUNTå…¨é‡æ‰«æçš„æ€§èƒ½é™·é˜±</strong><br/>
åœ¨ç»Ÿè®¡åœ¨çº¿äººæ•°æ—¶ï¼Œæˆ‘ç›´æ¥ç”¨<code>BITCOUNT online:20250408</code>ï¼ŒKeyæœ‰10MBï¼Œè€—æ—¶å‡ åæ¯«ç§’ï¼Œæ‹–æ…¢å“åº”ã€‚<br/>
<strong>æ•™è®­</strong>ï¼š<code>BITCOUNT</code>é»˜è®¤æ‰«ææ•´ä¸ªKeyï¼Œå¤æ‚åº¦O(N)ã€‚<br/>
<strong>ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æŒ‡å®šèŒƒå›´ï¼š<code>BITCOUNT online:20250408 0 1000000</code>åªç»Ÿè®¡å‰100ä¸‡ä½ã€‚</li>
<li>åˆ†æ®µè®¡ç®—ï¼šç”¨Luaè„šæœ¬åˆ†æ‰¹å¤„ç†å¤§Keyã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ†å¸ƒå¼é—®é¢˜ï¼šå¤šå®ä¾‹ä¸‹BitmapsåŒæ­¥çš„æŒ‘æˆ˜</strong><br/>
åœ¨Redis Clusterä¸­ï¼ŒBitmapsåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ï¼Œ<code>BITOP</code>æ— æ³•è·¨æ§½æ‰§è¡Œï¼Œå¯¼è‡´äº¤é›†è®¡ç®—å¤±è´¥ã€‚<br/>
<strong>è§£å†³åŠæ³•</strong>ï¼š</p>
<ul>
<li>è®¾è®¡Keyæ—¶åŠ æ§½æ ‡ç­¾ï¼š<code>{20250408}:active</code>ï¼Œç¡®ä¿ç›¸å…³Keyè½åœ¨åŒä¸€èŠ‚ç‚¹ã€‚</li>
<li>æˆ–å®¢æˆ·ç«¯æ‹‰å–æ•°æ®åæœ¬åœ°è®¡ç®—ï¼Œä½†éœ€æƒè¡¡ç½‘ç»œå¼€é”€ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-22">3. ä¸ä¸šåŠ¡ç»“åˆçš„æ€è€ƒ</h4>
<p>Bitmapså¹¶éä¸‡èƒ½ï¼Œé€‰æ‹©å®ƒè¿˜æ˜¯å…¶ä»–ç»“æ„ï¼Œéœ€ç»“åˆä¸šåŠ¡éœ€æ±‚ï¼š</p>
<ul>
<li><strong>Bitmapsé€‚åˆ</strong>ï¼šäºŒå€¼çŠ¶æ€ã€å¤§æ•°æ®é‡ã€ä½å†…å­˜éœ€æ±‚ï¼ˆå¦‚ç­¾åˆ°ã€åœ¨çº¿çŠ¶æ€ï¼‰ã€‚</li>
<li><strong>å…¶ä»–ç»“æ„æ›´ä¼˜</strong>ï¼šå¤šå€¼çŠ¶æ€ï¼ˆå¦‚Hashï¼‰ã€é¢‘ç¹å¢åˆ ï¼ˆå¦‚Listï¼‰ã€ç²¾ç¡®å»é‡ï¼ˆå¦‚Setï¼‰ã€‚<br/>
<strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šè€ƒè™‘è¯»å†™åˆ†ç¦»ï¼Œå†™æ“ä½œç”¨Bitmapsè®°å½•ï¼Œè¯»æ“ä½œå¼‚æ­¥åŒæ­¥åˆ°åªè¯»å®ä¾‹ï¼Œå‡è½»ä¸»èŠ‚ç‚¹å‹åŠ›ã€‚</li>
</ul>
<h4 data-id="heading-23">è¿‡æ¸¡å°ç»“</h4>
<p>é€šè¿‡è¿™äº›å®è·µå’Œæ•™è®­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒBitmapsçš„å¨åŠ›åœ¨äºå®ƒçš„ç®€æ´é«˜æ•ˆï¼Œä½†ä¹Ÿéœ€è¦ç²¾å¿ƒè®¾è®¡å’Œç®¡ç†ã€‚æŒæ¡äº†Keyåˆ†ç‰‡ã€æ‰¹é‡ä¼˜åŒ–å’Œå®¹é”™æŠ€å·§ï¼Œä½ å°±èƒ½é¿å¼€å¸¸è§é™·é˜±ï¼Œè®©å®ƒæˆä¸ºé¡¹ç›®ä¸­çš„â€œå¾—åŠ›åŠ©æ‰‹â€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ€»ç»“å…¨æ–‡ï¼Œå±•æœ›Bitmapsçš„æœªæ¥å¯èƒ½æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-24">äº”ã€æ€»ç»“ä¸å±•æœ›</h3>
<p>ç»è¿‡ä»åŸºç¡€åˆ°å®æˆ˜çš„å…¨é¢æ¢ç´¢ï¼Œæˆ‘ä»¬å·²ç»å¯¹Redisçš„Bitmapså’Œä½æ“ä½œæœ‰äº†æ·±å…¥çš„è®¤è¯†ã€‚ä½œä¸ºRedisé«˜çº§ç‰¹æ€§ä¸­çš„ä¸€å‘˜ï¼ŒBitmapsä»¥å…¶ç‹¬ç‰¹çš„è®¾è®¡å’Œå¼ºå¤§çš„åŠŸèƒ½ï¼Œåœ¨ä¼—å¤šåœºæ™¯ä¸­è¯æ˜äº†è‡ªå·±çš„ä»·å€¼ã€‚è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ€»ç»“å®ƒçš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œæ¢³ç†å®æˆ˜ç»éªŒï¼Œå¹¶å±•æœ›æœªæ¥çš„å¯èƒ½æ€§ï¼Œå¸Œæœ›ä¸ºä½ ç•™ä¸‹ä¸€äº›å¯å‘ã€‚</p>
<h4 data-id="heading-25">1. æ€»ç»“è¦ç‚¹</h4>
<p>Bitmapsçš„æ ¸å¿ƒä¼˜åŠ¿å¯ä»¥ç”¨ä¸¤ä¸ªè¯æ¦‚æ‹¬ï¼š<strong>å†…å­˜æ•ˆç‡</strong>å’Œ<strong>é«˜æ€§èƒ½</strong>ã€‚å®ƒç”¨æœ€å°çš„ç©ºé—´ï¼ˆ1äº¿ä½ä»…12MBï¼‰æ‰¿è½½æµ·é‡æ•°æ®ï¼Œç”¨ä½è¿ç®—ï¼ˆ<code>BITOP</code>ã€<code>BITCOUNT</code>ï¼‰å®ç°æ¯«ç§’çº§çš„è®¡ç®—ã€‚è¿™ç§â€œä»¥å°åšå¤§â€çš„èƒ½åŠ›ï¼Œè®©å®ƒåœ¨ç”¨æˆ·ç­¾åˆ°ã€åœ¨çº¿ç»Ÿè®¡ã€æƒé™ç®¡ç†å’Œå¤§æ•°æ®åˆ†æç­‰åœºæ™¯ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<ul>
<li><strong>å®æˆ˜åœºæ™¯çš„å¹¿æ³›æ€§</strong>ï¼šä»è½»é‡çº§çš„çŠ¶æ€æ ‡è®°ï¼Œåˆ°å¤æ‚çš„äº¤é›†åˆ†æï¼ŒBitmapséƒ½èƒ½èƒœä»»ã€‚</li>
<li><strong>å±€é™æ€§</strong>ï¼šå•Keyè¿‡å¤§ã€åˆ†å¸ƒå¼åœºæ™¯çš„åŒæ­¥é—®é¢˜ï¼Œéœ€è¦é€šè¿‡åˆ†ç‰‡å’Œè®¾è®¡è§„é¿ã€‚</li>
<li><strong>ç»éªŒä»·å€¼</strong>ï¼šæˆ‘åˆ†äº«çš„è¸©å‘æ•™è®­ï¼ˆå†…å­˜è¶…é™ã€å‘½ä»¤è¯¯ç”¨ï¼‰å’Œä¼˜åŒ–å»ºè®®ï¼ˆPipelineã€Luaè„šæœ¬ï¼‰ï¼Œæ˜¯10å¹´å®æˆ˜çš„ç»“æ™¶ï¼Œå¸Œæœ›èƒ½å¸®ä½ å°‘èµ°å¼¯è·¯ã€‚</li>
</ul>
<h4 data-id="heading-26">2. å±•æœ›</h4>
<p>éšç€Redisçš„ä¸æ–­æ¼”è¿›ï¼ŒBitmapsçš„æ½œåŠ›è¿˜æœ‰å¾…æŒ–æ˜ï¼š</p>
<ul>
<li><strong>æ–°ç‰ˆæœ¬å¢å¼º</strong>ï¼šRedis 7.0å·²ä¼˜åŒ–å†…å­˜ç®¡ç†å’Œå‘½ä»¤æ€§èƒ½ï¼Œæœªæ¥å¯èƒ½ä¸ºBitmapså¼•å…¥æ›´å¤šä¸“ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚æ”¯æŒç¨€ç–å­˜å‚¨æˆ–æ›´é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ã€‚</li>
<li><strong>AI/MLåœºæ™¯</strong>ï¼šBitmapså¯ä»¥ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¡Œä¸ºç‰¹å¾ï¼ˆä¾‹å¦‚ç‚¹å‡»ã€æµè§ˆçš„äºŒå€¼çŠ¶æ€ï¼‰ï¼Œç»“åˆæœºå™¨å­¦ä¹ æ¨¡å‹åšå®æ—¶é¢„æµ‹ï¼Œæ˜¯ä¸€ä¸ªå€¼å¾—æ¢ç´¢çš„æ–¹å‘ã€‚</li>
<li><strong>ç”Ÿæ€èåˆ</strong>ï¼šä¸Redis Streamæˆ–Graphç»“åˆï¼ŒBitmapså¯èƒ½åœ¨æ—¶åºåˆ†ææˆ–å…³ç³»è®¡ç®—ä¸­æ‰¾åˆ°æ–°èˆå°ã€‚</li>
</ul>
<h4 data-id="heading-27">3. ä¸ªäººä½¿ç”¨å¿ƒå¾—</h4>
<p>ç”¨Bitmapsçš„è¿™äº›å¹´ï¼Œæˆ‘æœ€å¤§çš„ä½“ä¼šæ˜¯ï¼š<strong>ç®€å•å³å¼ºå¤§</strong>ã€‚å®ƒæ²¡æœ‰å¤æ‚çš„ç»“æ„ï¼Œå´èƒ½è§£å†³å¤æ‚çš„é—®é¢˜ã€‚ä½†å‰ææ˜¯ä½ å¾—â€œæ‡‚å®ƒâ€â€”â€”ç†è§£å®ƒçš„é€‚ç”¨è¾¹ç•Œï¼Œè®¾è®¡å¥½Keyå’Œåç§»ï¼Œæ‰èƒ½è®©å®ƒå‘æŒ¥æœ€å¤§ä»·å€¼ã€‚æ¯æ¬¡è¸©å‘åä¼˜åŒ–æˆåŠŸï¼Œé‚£ç§â€œæŸ³æš—èŠ±æ˜â€çš„æ„Ÿè§‰ï¼Œä¹Ÿæ˜¯æŠ€æœ¯æˆé•¿çš„ä¹è¶£æ‰€åœ¨ã€‚</p>
<h4 data-id="heading-28">4. é¼“åŠ±äº’åŠ¨</h4>
<p>Bitmapsçš„åº”ç”¨è¿œä¸æ­¢æœ¬æ–‡æåˆ°çš„åœºæ™¯ã€‚ä½ æ˜¯å¦åœ¨é¡¹ç›®ä¸­ç”¨è¿‡å®ƒï¼Ÿæ˜¯è®°å½•ç­¾åˆ°ï¼Œè¿˜æ˜¯åˆ†ææ•°æ®ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒï¼Œæˆ–è€…å‘Šè¯‰æˆ‘ä½ åœ¨ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢è®¨æ›´ä¼˜è§£æ³•ã€‚æŠ€æœ¯å› åˆ†äº«è€Œè¿›æ­¥ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æˆä¸ºä½ æ¢ç´¢Redisæ·±åº¦çš„èµ·ç‚¹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisç¼“å­˜é›ªå´© vs å‡»ç©¿ vs ç©¿é€ï¼š3ç§å¸¸è§é—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7598433254128844840</link>    <guid>https://juejin.cn/post/7598433254128844840</guid>    <pubDate>2026-01-24T04:19:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598433254128844840" data-draft-id="7598465042967674920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisç¼“å­˜é›ªå´© vs å‡»ç©¿ vs ç©¿é€ï¼š3ç§å¸¸è§é—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T04:19:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisç¼“å­˜é›ªå´© vs å‡»ç©¿ vs ç©¿é€ï¼š3ç§å¸¸è§é—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:19:33.000Z" title="Sat Jan 24 2026 04:19:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>Redisç¼“å­˜é›ªå´© vs å‡»ç©¿ vs ç©¿é€ï¼š3ç§å¸¸è§é—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆ</strong></h3>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼ŒRedisä½œä¸ºé«˜æ€§èƒ½çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œå·²ç»æˆä¸ºæŠ€æœ¯æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œç¼“å­˜çš„ä½¿ç”¨å¹¶éä¸€å¸†é£é¡ºï¼Œå¼€å‘è€…å¸¸å¸¸ä¼šé‡åˆ°ä¸‰ç§å…¸å‹é—®é¢˜ï¼šç¼“å­˜é›ªå´©ï¼ˆCache Avalancheï¼‰ã€ç¼“å­˜å‡»ç©¿ï¼ˆCache Breakdownï¼‰å’Œç¼“å­˜ç©¿é€ï¼ˆCache Penetrationï¼‰ã€‚è¿™äº›é—®é¢˜è½»åˆ™å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œé‡åˆ™å¼•å‘æœåŠ¡ä¸å¯ç”¨ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æè¿™ä¸‰ç§é—®é¢˜çš„æœ¬è´¨ã€åŒºåˆ«åŠè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¥å£®çš„ç¼“å­˜ç³»ç»Ÿã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸é—®é¢˜å®šä¹‰</h3>
<h4 data-id="heading-3">1.1 ç¼“å­˜é›ªå´©ï¼ˆCache Avalancheï¼‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šå¤§é‡ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆæˆ–RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“ï¼Œå¼•å‘æ•°æ®åº“ç¬æ—¶å‹åŠ›æ¿€å¢ç”šè‡³å´©æºƒçš„ç°è±¡ã€‚</p>
<p><strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>å¤§è§„æ¨¡keyåŒæ—¶è¿‡æœŸ</li>
<li>Redisé›†ç¾¤ä¸å¯ç”¨</li>
<li>ç³»ç»Ÿçº§è”æ•…éšœé£é™©é«˜</li>
</ul>
<h4 data-id="heading-4">1.2 ç¼“å­˜å‡»ç©¿ï¼ˆCache Breakdownï¼‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šæŸä¸ªçƒ­ç‚¹keyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼Œçªå‘å¤§é‡å¹¶å‘è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå°±åƒåœ¨ç¼“å­˜å±éšœä¸Š"å‡»ç©¿"äº†ä¸€ä¸ªæ´ã€‚</p>
<p><strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>é’ˆå¯¹å•ä¸ªçƒ­ç‚¹key</li>
<li>é«˜å¹¶å‘è¯·æ±‚é›†ä¸­çˆ†å‘</li>
<li>"çƒ­Key"æ•ˆåº”æ˜æ˜¾</li>
</ul>
<h4 data-id="heading-5">1.3 ç¼“å­˜ç©¿é€ï¼ˆCache Penetrationï¼‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼ˆæ—¢ä¸åœ¨ç¼“å­˜ä¹Ÿä¸åœ¨DBï¼‰ï¼Œå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½ç©¿é€åˆ°æ•°æ®åº“å±‚ã€‚</p>
<p><strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢ä¸å­˜åœ¨çš„key</li>
<li>å¯èƒ½æ˜¯æ¶æ„æ”»å‡»</li>
<li>DBæŒç»­æ‰¿å—æ— æ•ˆæŸ¥è¯¢</li>
</ul>
<hr/>
<h3 data-id="heading-6">äºŒã€é—®é¢˜æ ¹æºä¸å…¸å‹æ¡ˆä¾‹åˆ†æ</h3>
<h4 data-id="heading-7">2.1 é›ªå´©çš„æ·±å±‚åŸå› </h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[æ‰¹é‡è®¾ç½®ç›¸åŒTTL] --&gt; B[åŒæ—¶è¿‡æœŸ]
    C[Rediså®•æœº] --&gt; D[æµé‡æ´ªå³°]
    B &amp; D --&gt; E[DBè¿‡è½½]
</code></pre>
<p>å…¸å‹æ¡ˆä¾‹ï¼š
æŸç”µå•†å¹³å°åœ¨åˆå¤œå¯¹æ‰€æœ‰å•†å“æ•°æ®è®¾ç½®24å°æ—¶è¿‡æœŸæ—¶é—´ï¼Œæ¬¡æ—¥åˆå¤œæ‰€æœ‰å•†å“æŸ¥è¯¢åŒæ—¶ç›´è¾¾æ•°æ®åº“ã€‚</p>
<h4 data-id="heading-8">2.2 å‡»ç©¿çš„è§¦å‘æ¡ä»¶</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    F[çƒ­æœæ–°é—»] --&gt; G[Keyåˆ°æœŸ]
    H[ç¬é—´10ä¸‡QPS] --&gt; I[å•ç‚¹è¿‡çƒ­]
</code></pre>
<p>å…¸å‹æ¡ˆä¾‹ï¼š
å¾®åšçƒ­ç‚¹äº‹ä»¶#æŸæ˜æ˜Ÿç¦»å©š#çš„ç¼“å­˜keyå¤±æ•ˆæ—¶ï¼Œæ°é€¢å¤§é‡ç”¨æˆ·åˆ·æ–°é¡µé¢ã€‚</p>
<h4 data-id="heading-9">2.3 ç©¿é€çš„äº§ç”Ÿåœºæ™¯</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph BT
    J[-ID=-1] --&gt; K[ç»•è¿‡æ­£å¸¸é€»è¾‘]
    L[æ¶æ„çˆ¬è™«] --&gt; M[éå†ä¸å­˜ID]
</code></pre>
<p>å…¸å‹æ¡ˆä¾‹ï¼š
æ”»å‡»è€…æ„é€ ä¸å­˜åœ¨çš„è®¢å•IDå‘èµ·é«˜é¢‘æŸ¥è¯¢ï¼ˆå¦‚10000ä¸ª/sï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-10">ä¸‰ã€ç»ˆæè§£å†³æ–¹æ¡ˆè¯¦è§£</h3>
<h4 data-id="heading-11">3.1 åº”å¯¹é›ªå´©çš„äº”é‡é˜²æŠ¤</h4>
<h5 data-id="heading-12">ï¼ˆ1ï¼‰è¿‡æœŸæ—¶é—´éšæœºåŒ–</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Pythonç¤ºä¾‹ï¼šåŸºç¡€è¿‡æœŸæ—¶é—´+éšæœºåç§»é‡ </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_cache</span>(<span class="hljs-params">key, value</span>):
    base_ttl = <span class="hljs-number">3600</span> 
    random_ttl = random.randint(-<span class="hljs-number">300</span>,<span class="hljs-number">300</span>) 
    redis_client.setex(key, base_ttl + random_ttl, value)
</code></pre>
<h5 data-id="heading-13">ï¼ˆ2ï¼‰å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡</h5>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·è¯·æ±‚ â†’ CDN â†’ L1 <span class="hljs-built_in">Cache</span>(æœ¬åœ°) â†’ L2 <span class="hljs-built_in">Cache</span>(Redis) â†’ DB
</code></pre>
<h5 data-id="heading-14">ï¼ˆ3ï¼‰ç†”æ–­é™çº§æœºåˆ¶é…ç½®Hystrixå‚æ•°ç¤ºä¾‹ï¼š</h5>
<pre><code class="hljs language-java" lang="java">circuitBreaker.requestVolumeThreshold=<span class="hljs-number">20</span> <span class="hljs-comment">//è§¦å‘ç†”æ–­æœ€å°è¯·æ±‚æ•° </span>
circuitBreaker.sleepWindowInMilliseconds=<span class="hljs-number">5000</span> <span class="hljs-comment">//ç†”æ–­æŒç»­æ—¶é—´ </span>
circuitBreaker.errorThresholdPercentage=<span class="hljs-number">50</span> <span class="hljs-comment">//é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼ </span>
</code></pre>
<h5 data-id="heading-15">ï¼ˆ4ï¼‰çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸç­–ç•¥é…åˆå¼‚æ­¥åˆ·æ–°ï¼š</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Javaå®šæ—¶ä»»åŠ¡ä¼ªä»£ç  </span>
<span class="hljs-meta">@Scheduled(fixedRate = PERIOD)</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshHotItems</span><span class="hljs-params">()</span> {
    List&lt;HotItem&gt; items = getFromDB();
    items.forEach(item -&gt; {
        redisClient.set(NEVER_EXPIRE_KEY_PREFIX+item.id, item);
    });
}
</code></pre>
<h5 data-id="heading-16">ï¼ˆ5ï¼‰Redisé›†ç¾¤é«˜å¯ç”¨éƒ¨ç½²å»ºè®®é‡‡ç”¨Redis Sentinelæˆ–Clusteræ¨¡å¼éƒ¨ç½²è‡³å°‘3ä¸»3ä»èŠ‚ç‚¹è·¨æœºæˆ¿å®¹ç¾ã€‚</h5>
<h4 data-id="heading-17">### ### ### ### ### ### ### ## ##</h4>
<h2 data-id="heading-18">## # #</h2>
<h2 data-id="heading-19"/>
<h2 data-id="heading-20"/>
<h2 data-id="heading-21"/>
<h2 data-id="heading-22"/>
<h2 data-id="heading-23"/>
<h2 data-id="heading-24"/>
<h2 data-id="heading-25"/>
<h3 data-id="heading-26"/>
<h3 data-id="heading-27"/>
<h2 data-id="heading-28"/>
<h2 data-id="heading-29"/>
<h2 data-id="heading-30"/>
<h3 data-id="heading-31"/>
<h3 data-id="heading-32"/>
<h3 data-id="heading-33"/>
<h3 data-id="heading-34"/>
<h3 data-id="heading-35"/>
<h4 data-id="heading-36"/>
<h4 data-id="heading-37"/>
<h4 data-id="heading-38"/>
<h4 data-id="heading-39"/>
<h5 data-id="heading-40"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†è§ï¼Œ2025ï¼šèŒä¸šæœ‰æ³¢æ¾œï¼Œç”Ÿæ´»å‘å‰çœ‹]]></title>    <link>https://juejin.cn/post/7598641282324217883</link>    <guid>https://juejin.cn/post/7598641282324217883</guid>    <pubDate>2026-01-24T04:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598641282324217883" data-draft-id="7598499504170057766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†è§ï¼Œ2025ï¼šèŒä¸šæœ‰æ³¢æ¾œï¼Œç”Ÿæ´»å‘å‰çœ‹"/> <meta itemprop="keywords" content="é¢è¯•,ç¨‹åºå‘˜,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T04:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜ç™½å½¬"/> <meta itemprop="url" content="https://juejin.cn/user/2752832847753085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†è§ï¼Œ2025ï¼šèŒä¸šæœ‰æ³¢æ¾œï¼Œç”Ÿæ´»å‘å‰çœ‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2752832847753085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜ç™½å½¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:17:50.000Z" title="Sat Jan 24 2026 04:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025å¹´åˆšåˆšç»“æŸäº†ï¼Œæœ€è¿‘åˆšå…¥èŒæ–°å…¬å¸ï¼Œå› ä¸ºæ˜¯å¹´åº•ï¼Œå‘¨å›´çš„åŒäº‹åˆšåšå®Œè¿°èŒï¼Œæˆ‘æƒ³ç€æˆ‘ä¹Ÿè¯¥å›é¡¾ä¸€ä¸‹æˆ‘çš„2025å¹´å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨2025å¹´å¹´åˆï¼Œæˆ‘æœ‰æƒ³è¿‡ï¼Œè¿™ä¸€å¹´å¤§æ¦‚ç‡ä¼šå’Œ2024å¹´ä¸€æ ·ï¼Œå¾ˆå¹³æ·¡åœ°è¿‡å»äº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆæ³¢æ¾œã€‚ä½†æˆ‘æ²¡æƒ³åˆ°ï¼Œæˆ‘æå‰æ„Ÿå—äº†ä¸€ä¸‹35å²å±æœº......</p>
<h2 data-id="heading-0">å·¥ä½œï¼šç¼“ä¸‹æ¥ -&gt; è£å‘˜ -&gt; å†å°±ä¸š</h2>
<p>å…ˆè¯´å·¥ä½œã€‚2025å¹´ï¼Œæˆ‘ç»§ç»­åšç€å…¬å¸çš„Cç«¯ç°é‡‘æµäº§å“ï¼Œè™½ç„¶è¥æ”¶æŒç»­ä¸‹è·Œï¼Œä½†è®¤ä¸ºçŸ­æœŸä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ã€‚é¢†å¯¼å¼€å¹´è¿˜æ‰¾æˆ‘ä»¬èŠè¿‡ï¼Œè¯´è™½ç„¶å…¬å¸è¿è¥æˆæœ¬å¤§äºè¥æ”¶ï¼Œä½†æ˜¯èèµ„åè´¦ä¸Šçš„èµ„é‡‘è‡³å°‘å¯ä»¥ä¿æˆ‘ä»¬å†åšä¸‰å¹´ï¼Œæˆ‘å½“æ—¶çš„æƒ³æ³•æ˜¯â€œåšä¸€å¹´æ˜¯ä¸€å¹´å§ï¼Œä¹Ÿè®¸è¿˜èƒ½å¥½èµ·æ¥ï¼Œåœ¨è¿™é‡Œé¢†å¯¼ä¹Ÿå……åˆ†ä¿¡ä»»æˆ‘ã€‚â€æˆ‘ä¾ç„¶å°½å¿ƒå°½è´£åœ°åšå¥½æ¯ä¸€ä¸ªè¿­ä»£ï¼Œä¸è¿‡å¤±å»äº†2024å¹´ä¹‹å‰çš„é‚£ç§å†²åŠ²ï¼Œå¤±å»äº†é‚£ç§è¯•ç€åœ¨è‡ªå·±çš„é¢†åŸŸå†…æå‡ºä¸€äº›æŠ€æœ¯è½åœ°æˆ–åˆ›æ–°çš„æƒ³æ³•ï¼Œå› ä¸ºæ„Ÿè§‰ä¸ç®¡è‡ªå·±æ€ä¹ˆåŠªåŠ›ï¼Œå…¬å¸çš„äº§å“ä¼¼ä¹åœ¨å¸‚åœºä¸Šä¹Ÿæ²¡æ³•å†è¿›ä¸€æ­¥äº†ï¼Œæœ‰ä¸€ç§æ— åŠ›æ„Ÿã€‚</p>
<p>ä¸‰å¹´å‰ï¼Œå…¬å¸åœ¨åŸæœ‰èµ›é“ä¹åŠ›ï¼Œè¡Œä¸šæ”¶ç¼©ï¼Œå®¢æˆ·ç»­è´¹ç‡å¾ˆä½ï¼Œå…¬å¸ä¸Šä¸‹éƒ½ç›´è§‚åœ°æ„Ÿå—åˆ°äº†å¯’æ°”ï¼Œè£å‘˜å†è£å‘˜ï¼Œå‘¨å›´çš„äººèµ°äº†ä¸€æ³¢åˆä¸€æ³¢ã€‚äººå°‘äº†åï¼Œåœ¨å…¬å¸çš„æ—¥å¸¸äº¤æµä¹Ÿéšä¹‹å˜å°‘ï¼Œä»¥è‡³äºæˆ‘æ„Ÿè§‰åˆ°æˆ‘çš„è¡¨è¾¾èƒ½åŠ›éƒ½å·®äº†å¾ˆå¤šã€‚</p>
<p>å…¬å¸ä¹Ÿæƒ³äº†åŠæ³•è½¬å‹åˆ°æ–°èµ›é“ï¼Œæˆç«‹æ–°å…¬å¸æŠ•å…¥åˆ° C ç«¯äº§å“çš„ç ”å‘ä¸Šï¼Œå€Ÿç€ OpenAI å¤§æ¨¡å‹çš„ä¸œé£ï¼Œè¿˜çœŸçš„ä¸€åº¦åšèµ·æ¥äº†ã€‚22å¹´åšå‡ºé›å½¢ï¼Œ23å¹´å’Œ24å¹´æŒç»­è¿­ä»£åˆ›æ–°ï¼Œè¥æ”¶å¢é•¿ï¼Œæ–°å…¬å¸æ‹¿åˆ°äº†å¤©ä½¿è½®å’Œ Pre-A è½®èèµ„ï¼Œçœ‹ç€äº§å“ä¸€å¤©å¤©å˜å¥½ï¼Œæˆ‘é‡æ–°ç‡ƒèµ·äº†å¸Œæœ›ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c23d120bc9774a9eaf83e0b6e1767468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=Z5CVhHQqzm87BKiH9rITEPT5%2BZE%3D" alt="" loading="lazy"/></p>
<p>ç„¶è€Œæˆ‘ä»¬æ²¡æœ‰è¿æ¥ä¸€å¸†é£é¡ºï¼Œ24å¹´ä¸‹åŠå¹´å¼€å§‹ï¼Œè¥æ”¶åŒæ¯”ç•¥æ˜¾é¢“åŠ¿ï¼Œ25å¹´å…¨å¹´ä¹Ÿä¸å°½äººæ„ï¼Œæ•´ä¸ªå…¬å¸æœ¬æƒ³ç€åœ¨æ—ºå­£å…¨åŠ›æ‹¼ä¸€æŠŠï¼Œå´ä½ä¼°äº†å¸‚åœºçš„å˜åŒ–ï¼Œç«å¯¹å¦‚é›¨åæ˜¥ç¬‹ï¼Œå¤§å‚ä¹Ÿçº·çº·ä¸‹åœºï¼Œæˆ‘ä»¬çš„è¥æ”¶è‡ªç„¶éšä¹‹ä¸‹æ»‘ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯äº§å“æŠ€æœ¯å£å’ä¸å¤Ÿé«˜ï¼ŒåŒè´¨åŒ–ä¸¥é‡ï¼Œä½“ç°ä¸å‡ºç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚</p>
<p>å·¥ä½œèŠ‚å¥åœ¨25å¹´ä¹Ÿæ”¾ç¼“äº†å¾ˆå¤šï¼Œä»¥è‡³äºæˆ‘å¤§éƒ¨åˆ†æ—¶å€™å¯ä»¥å’Œå¦»å­ä¸€åŒä¸‹ç­ï¼Œä¸ç¦æ„Ÿå¹â€œåŸæ¥ä¸‹ç­æ—¶ä¹Ÿå¯ä»¥çœ‹è§æ™šéœï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3469be8f00154921a4f38d3d8ea9b979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=XseZy6vgo3CBeUIPo56BhLdEtdo%3D" alt="" loading="lazy"/></p>
<p>â€è€ƒè™‘é¢†å¯¼å±‚çš„â€œä¸‰å¹´æ‰¿è¯ºâ€ï¼Œæˆ‘ä»¥ä¸ºè¿™æ˜¯é€‚å½“èººå¹³çš„ä¿¡å·ï¼Œæ®Šä¸çŸ¥è£å‘˜å†æ¬¡æ¥ä¸´ã€‚6æœˆä»½å¼€å§‹ï¼Œé™¤äº†å„å²—ä½ä¸»ç®¡è¿˜ä¿ç•™ï¼Œå…¶ä»–äººé™†ç»­è¢«é€šçŸ¥è£å‘˜ï¼Œæˆ‘æ‰€å¸¦çš„å‰ç«¯ç»„ä¹Ÿå…¨éƒ¨è£å®Œï¼Œå†æ¬¡æ„Ÿå—åˆ°å‡›å†¬å°†è‡³ï¼Œå†…å¿ƒä¹Ÿäº§ç”Ÿäº†ä¸€ä¸æ‚²å‡‰æ„Ÿï¼Œâ€œæ›¾ç»æˆ‘ä¹Ÿæœ‰åå‡ äººçš„ teamï¼Œç°åœ¨å·²å­¤å®¶å¯¡äººï¼â€</p>
<p>åˆ°äº†å…«æœˆä»½ï¼Œä¸€æ–¹é¢æ˜¯ä¸šåŠ¡æ·¡å­£ï¼Œä¸€æ–¹é¢å…¬å¸åœ¨ç ”å‘ä¸ŠèŠ‚å¥æ”¾ç¼“ï¼ŒçœŸçš„è¿›å…¥äº†â€œé—²â€çš„æ—¶å€™ï¼Œæˆ‘å’Œå¦»å­å†³å®šä¼‘å‡ å¤©å¹´å‡å‡‘ä¸Šå‘¨æœ«å»åŒ—æµ·ç©å‡ å¤©ã€‚äº‹å‡ºåå¸¸å¿…æœ‰å¦–ï¼Œå¤ªé—²äº†æœç„¶ä¼šå‡ºäº‹ï¼Œå½“æˆ‘è¿˜åœ¨åŒ—æµ·åƒç€æµ·é²œå¹ç€æµ·é£æ—¶ï¼Œé¢†å¯¼å‘æ¥äº†æ¶ˆæ¯ï¼Œâ€œæœ‰ç‚¹äº‹æ‰¾ä½ èŠä¸€ä¸‹ã€‚â€æˆ‘é¡¿æ—¶æ„Ÿè§‰ä¸å¦™ï¼ŒçŒœåˆ°äº†å¤§æ¦‚è¦è£å‘˜ã€‚æœä¸å…¶ç„¶ï¼ç”±äºæœ‰å¿ƒç†å‡†å¤‡ï¼Œå†…å¿ƒä¹Ÿæ²¡æœ‰å¤ªå¤§çš„æ³¢åŠ¨ï¼Œè¿˜æ˜¯å¹³é™åœ°æŠŠå‡æœŸè¿‡å®Œäº†ã€‚è£å‘˜å¹¶ä¸ç¨€å¥‡ï¼Œè®©æˆ‘æ„æ–™ä¹‹å¤–çš„æ˜¯ï¼Œå…¬å¸è¿æœ€åçš„ç ”å‘ç«ç§éƒ½ä¸ä¿ç•™äº†ï¼Œä»…ä¿æŒäº§å“å¸¸æ€åŒ–è¿è¥ï¼Œæˆ‘ç»ˆäºè¦ç¦»å¼€æˆ‘å¥‹æ–—äº†å…­å¹´å¤šçš„å…¬å¸ï¼Œçœ‹ç€å¥¹é•¿å¤§ï¼Œå¹»æƒ³å¥¹å‡ºå½©ï¼Œæœ€ç»ˆçœ‹ç€å®ƒè½å¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60ea5bc481df42e8be7e833af8545649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=gZtD18Q2vp634FOaMrXkGx9G4Qg%3D" alt="" loading="lazy"/></p>
<p>è¿‡å®Œå‡æœŸï¼Œå›åˆ°å…¬å¸å°±æ˜¯åå•†è£å‘˜çš„äº‹æƒ…äº†ï¼Œæˆ‘çš„è¯‰æ±‚å¾ˆç®€å•ï¼ŒæŒ‰æ ‡å‡†è¡¥å¿å°±è¡Œã€‚å› ä¸ºä¸­é—´åšæ–°å…¬å¸ä¸šåŠ¡ï¼ŒåŠ³åŠ¨åˆåŒä¸»ä½“å˜æ›´è¿‡ï¼Œåœ¨ç»æµè¡¥å¿é‡‘è¿™å—ï¼Œæˆ‘ä¹Ÿæ²¡å¼ºè°ƒè¦æŒ‰å…­å¹´çš„å·¥é¾„ç®—ï¼Œåªç®—åé¢è¿™ä¸€ä»½å°±è¡Œäº†ï¼Œè¿™æ˜¯æˆ‘çš„æœ€ä½è¦æ±‚ã€‚ç„¶è€Œç«™åœ¨å…¬å¸çš„ç«‹åœºï¼Œä½ æ‡‚çš„ï¼Œèƒ½å°‘ç»™ç‚¹å°±å°‘ç»™ç‚¹ï¼Œä»è¡¥å¿ä¸€ä¸ªæœˆå¼€å§‹ï¼Œæœ€åæ²Ÿé€šè¾¾åˆ°æˆ‘çš„é¢„æœŸï¼Œç»å†äº†ä¸‰ç§ä¸åŒçš„æ–¹æ¡ˆã€‚åªèƒ½è¯´å¤§å®¶éƒ½æŒºéš¾å§ï¼Œå…¬å¸å’Œå‘˜å·¥éƒ½ä¸å®¹æ˜“ã€‚</p>
<p>å…³äºæ‰¾æ–°å·¥ä½œè¿™å—ï¼Œæˆ‘ä¸€å¼€å§‹è¿‡äºä¹è§‚ï¼Œå¯¹æœ€æ–°å°±ä¸šæƒ…å†µæ²¡æœ‰ä¸€ä¸ªåˆ‡èº«æ„ŸçŸ¥ï¼Œè™½ç„¶çŸ¥é“å¤§ç¯å¢ƒå·®ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°è¿™ä¹ˆå·®ï¼æˆ‘æœ¬ä»¥ä¸ºç»™å„ä¸ªå…¬å¸æŠ•ç®€å†ï¼Œä¸æ•¢ä¿è¯è¯´èƒ½æ‹¿åˆ°å¾ˆå¤š offerï¼Œä½†æ˜¯è‡³å°‘èƒ½æ‹¿åˆ°é¢è¯•æœºä¼šå§ã€‚ç„¶è€Œç°å®ç»™äº†æˆ‘æ²‰é‡ä¸€å‡»ï¼Œå·²è¯»ä¸å›æ˜¯å¸¸æ€ï¼Œæ”¶äº†ç®€å†æ³¡æ± å­ä¹Ÿæ˜¯å¸¸æ€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee110f6c5eaa430b8262ca52b96c01db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=PM034%2FlIRzBfS5EO%2FyCmXvkWydM%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘æ˜¯ä¹æœˆåº•æ­£å¼ç¦»èŒï¼Œåæœˆå¼€å§‹æŠ•ç®€å†é¢è¯•ï¼Œä¸€ç›´åˆ°åä¸€æœˆåº•æ‰ç¡®å®š offerã€‚æœŸé—´ä¸»åŠ¨å‘èµ·æ²Ÿé€šä¸Šç™¾ä¸ªï¼Œå·²è¯»ä¸å›å å¤§éƒ¨åˆ†ï¼ŒæŠ•äº†ä¸‰åå¤šä¸ªå²—ä½ï¼Œè¿›å…¥ç®€å†è¯„ä¼°çš„æœ‰åå¤šå®¶ï¼Œå®‰æ’é¢è¯•çš„æœ‰ä¹å®¶ï¼Œå…¶ä¸­äº”å®¶è¿›å…¥åˆ°æœ€åçš„ HR é¢ï¼Œä¸‰å®¶èµ°å®Œé¢è¯•æµç¨‹å¯åŠ¨äº†èƒŒè°ƒï¼Œç”±äºæœ€åç€æ€¥ç¡®å®š offerï¼Œæœ‰äº›ä¹Ÿæ²¡ç»§ç»­æ¨è¿›äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/832134c404dd428c98683cc141843347~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=y7qZSZRjX%2BdwKvxABM5KmWjA17c%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªå¤±ä¸šæœŸé—´ï¼Œå¿ƒæ€ç”±<strong>ä¹è§‚ä¸”å¹³é™</strong>è½¬å˜ä¸º<strong>WTF</strong>ï¼Œç»§è€Œ<strong>å¼€å§‹ç„¦è™‘</strong>ï¼Œå†åˆ°<strong>å®‰æ…°è‡ªå·±</strong>ï¼Œ<strong>å®‰æ…°å¤±æ•ˆ</strong>ï¼Œ<strong>é‡æ–°é¼“æ°”</strong>ï¼Œ<strong>å†æ¬¡æ³„æ°”</strong>ï¼Œ<strong>å’¬ç‰™åšæŒ</strong>ï¼Œæœ€ç»ˆ<strong>æ‹¿åˆ°ç»“æœ</strong>ã€‚æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯éå¸¸è¾›è‹¦çš„ï¼Œç²¾ç¥ä¸Šçš„æŠ˜ç£¨æ˜¯æœ€å¤§çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åŠå¤§å®¶å½“å‰å¦‚æœé‡åˆ°è£å‘˜ï¼Œä¸€å®šè¦æ‹¿åˆ°åˆé€‚çš„ç»æµè¡¥å¿é‡‘çš„åŸå› ï¼Œæ‰¾å·¥ä½œä¹Ÿè®¸ä¸éš¾ï¼Œä½†æ˜¯è¦æ‰¾åˆ°è‡ªå·±æ»¡æ„çš„å·¥ä½œè¿˜æ˜¯æŒºéš¾çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæŒç»­å‡ ä¸ªæœˆç”šè‡³æ›´ä¹…ï¼</p>
<h2 data-id="heading-1">ç”Ÿæ´»ï¼šæ„Ÿå—å°å¹¸ç¦</h2>
<p>ç”±äº2025å¹´çš„å·¥ä½œèŠ‚å¥æ”¾ç¼“ï¼Œæˆ‘å¤§éƒ¨åˆ†æ—¶å€™ä¸‹ç­è¿˜æ¯”è¾ƒæ—©ï¼Œå› ä¸ºå’Œå¦»å­åœ¨åŒä¸€æ ‹å†™å­—æ¥¼ï¼Œå¯ä»¥ä¸€èµ·ä¸‹ç­ï¼Œå¤å¤©ä¸‹ç­æ—¶å¤©è¿˜æ²¡é»‘ï¼Œè¿™å¯èƒ½æ˜¯è¿™ä¹ˆå¤šå¹´å·¥ä½œä»¥æ¥ä»…æœ‰çš„éçŸ­æš‚ä½“éªŒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c6086a3fb0647cab616915430881557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=rMb9ACJ12uAirNa86MS5zETst4U%3D" alt="" loading="lazy"/></p>
<p>å‘¨æœ«é™ªå¦»å­å­©å­å‡ºå»é€›é€›ï¼Œä¹°ç‚¹å°åƒï¼Œå–ç‚¹èŒ¶é¢œæˆ–å’–å•¡ä»€ä¹ˆçš„ï¼Œä¹Ÿèƒ½å¸¦æ¥ä¸é”™çš„æ»¡è¶³æ„Ÿï¼Œå¿«ä¹å…¶å®å°±æ˜¯è¿™ä¹ˆç®€å•ï¼</p>
<p>2025å¹´å‡ºå»æ—…æ¸¸äº†ä¸‰æ¬¡ï¼Œç›¸æ¯”äºå‰å‡ å¹´å®…ç€æ¥è¯´ï¼Œæ˜¯ä¸€ç§ç ´å¤©è’ï¼</p>
<p>ç¬¬ä¸€æ¬¡å»çš„æ˜¯å¼ å®¶ç•Œï¼Œé¢†ç•¥äº†å¤§è‡ªç„¶é£å…‰çš„é­…åŠ›ï¼Œä¸»è¦æ¸¸ç©äº†å¤©é—¨å±±å’Œå¤§å³¡è°·ï¼ŒåäºŒåå¤šåˆ†é’Ÿçš„ç¼†è½¦ä¸Šå±±ï¼Œç«™åœ¨å¤©é—¨å±±ä¸Šä¿¯ç°ï¼Œæ„Ÿè§‰å¾ˆéœ‡æ’¼ï¼Œä¹Ÿæ„Ÿå—åˆ°è‡ªå·±çš„æ¸ºå°ï¼è¡Œèµ°åœ¨å¤§å³¡è°·æ£®æ—æ°§å§ï¼Œæœ‰ä¸€ç§å‡€åŒ–å¿ƒçµçš„æƒ¬æ„ã€‚å½“æ—¶æ˜¯æ·¡å­£ï¼Œå¼ å®¶ç•Œäººä¸å¤šï¼Œæ²¡æœ‰æ‹¥æŒ¤æ„Ÿï¼Œå³ä¾¿å¤©æ°”ä¸æ˜¯æœ€ä½³ï¼Œæ•´ä½“ä½“éªŒè¿˜æ˜¯éå¸¸æ£’ï¼å¯¹äº†ï¼Œå¼ å®¶ç•ŒéŸ©å›½æ¸¸å®¢çœŸçš„å¾ˆå¤šï¼Œå„å¤„æ™¯ç‚¹éƒ½æœ‰éŸ©æ–‡å¼•å¯¼ï¼Œä¸æ„§æ˜¯éŸ©å›½äººç¬¬äºŒæ•…ä¹¡ï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bfdb7d1dbc345a09e84c48e08698b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=n66N3jcM04yccgWFOChCuB85%2FPs%3D" alt="" loading="lazy"/></p>
<p>ç¬¬äºŒæ¬¡æ˜¯äº”ä¸€æœŸé—´å»äº†æ´›é˜³ï¼Œæ¸¸å®¢è¶…çº§å¤šã€‚æˆ‘ä»¬å»äº†åº”å¤©é—¨ã€æ´›é‚‘å¤åŸã€é¾™é—¨çŸ³çªŸã€ç™½é©¬å¯ºã€æ´›é˜³åšç‰©é¦†ï¼Œä¹ŸæŒºå¥½ç©çš„ï¼Œå‘¨å›´å¾ˆå¤šå¸¦å¦†é€ çš„å¤é£å°å“¥å“¥å°å§å§ï¼Œä¸‹æ¬¡å¦‚æœæœ‰æœºä¼šå»ï¼Œä¸€å®šè¦è®©å¦»å­ä¹Ÿå¸¦ä¸ªå¦†é€ æ¸¸ç©ï¼Œåº”è¯¥ä¼šéå¸¸æœ‰è¶£ï¼è€ƒè™‘åˆ°èŠ‚å‡æ—¥æ¸¸å®¢å¤ªå¤šï¼Œå°±æ²¡å»è€å›å±±ï¼Œæ€•å µåœ¨å±±ä¸ŠåŠå¤©ä¸Šä¸å»ä¸‹ä¸æ¥ï¼Œæ³•å®šèŠ‚å‡æ—¥é«˜å³°æœŸç¬¬ä¸€åŸåˆ™æ˜¯ä¸çˆ¬å±±ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/513d9d7b4daa4fe197ec1bfd3a5edd6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=GP1MneoA0cRymTdzyTMtk12uWoE%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¸‰æ¬¡å°±æ˜¯å…«æœˆä»½å»äº†ä¸€è¶ŸåŒ—æµ·ï¼Œå¹å¹æµ·é£ï¼Œäººä¼šéå¸¸æ¾å¼›ï¼Œå•¥ä¹Ÿä¸å¹²å°±å¾ˆèˆ’é€‚ï¼å»ºè®®é€‰ä¸€ä¸ªé æµ·æœ‰é˜³å°çš„é…’åº—ï¼Œæ‰“åŒ…æµ·é²œååœ¨é˜³å°ï¼Œä¸€è¾¹åƒä¸€è¾¹çœ‹æµ·ï¼Œä¼šå¾ˆçˆ½ï¼å—å°é£â€œå‰‘é±¼â€å½±å“ï¼ˆå®é™…ä¸Šæ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼‰ï¼Œæ¶ æ´²å²›èˆªç­ä¸´å‡ºå‘çš„å‰ä¸€å¤©è¢«å¼ºåˆ¶æ”¹ç­¾ï¼Œæ²¡å¤šä¹…åˆè¢«å¼ºåˆ¶å–æ¶ˆï¼Œæ²¡æœ‰ç™»ä¸Šæ¶ æ´²å²›ï¼Œçœ‹çœ‹æ¶ æ´²å²›ä¸Šçš„å˜åŒ–ï¼Œæ˜¯ä¸€ä¸ªå°å°çš„é—æ†¾ï¼Œä½†æ¢æ¥çš„æ˜¯éå¸¸è½»æ¾çš„è¡Œç¨‹ï¼Œä¸»è¦å°±æ˜¯åœ¨åŒ—æµ·åƒåƒåƒï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82ba6ef82e8946e59f677f58617afbcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=1iwJ7bypKOyZwfyOc2UDESejK5o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">26å¹´çš„ä¸€ç‚¹æœŸå¾…</h2>
<p>26å¹´å°±è¿™ä¹ˆæ¥äº†ï¼Œåˆè€äº†ä¸€å²ã€‚æ–°çš„ä¸€å¹´ï¼Œä¹Ÿè¦ç«‹ä¸€äº› flag äº†ï¼Œä»¥å‰å¾ˆå°‘ç«‹ flagï¼Œåšäº‹æ¯”è¾ƒéšå¿ƒã€‚</p>
<p>æœ€è¿‘çœ‹äº†ä¸€æœ¬ä¹¦ï¼Œé‡Œé¢æåˆ°ï¼Œäººè„‘æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯æœ¬èƒ½è„‘ã€æƒ…ç»ªè„‘ã€ç†æ™ºè„‘ï¼Œæœ¬èƒ½è„‘å’Œæƒ…ç»ªè„‘åœ¨ç”Ÿç†æ„é€ ä¸Šç¦»å¿ƒè„æ›´è¿‘ï¼Œé‡åˆ°äº‹æƒ…ä¼šæœ€å…ˆå“åº”ï¼Œç†æ™ºè„‘åˆ™æœ€åä»‹å…¥ï¼Œè¿™è®©æˆ‘ä»¬ä¹ æƒ¯å¾…åœ¨è‡ªå·±çš„èˆ’é€‚åŒºï¼Œä¹ æƒ¯æ‡’æƒ°ï¼Œå®¹æ˜“è¢«çªå‘çš„æƒ…ç»ªå½±å“ï¼Œè€Œè¿™å®é™…ä¸Šä¸æ˜¯æˆ‘ä»¬ç†æ™ºè„‘æœ€åæƒè¡¡çš„ç»“æœã€‚æ²¡å•¥äº‹å¹²çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ¬èƒ½æå‡ºæ‰‹æœºåˆ·åˆ·æŸéŸ³æŸä¹¦ï¼Œå³æ—¶æ»¡è¶³ã€‚ä¼‘é—²å¨±ä¹æœ¬èº«æ²¡æœ‰é”™ï¼Œä½†æ˜¯é•¿æ—¶é—´è¿‡åï¼Œå½“æˆ‘ä»¬é™ä¸‹æ¥æ€è€ƒï¼Œåˆä¼šæ‡Šæ‚”è‡ªå·±ä¸€å¹´åˆ°å¤´ä»€ä¹ˆäº‹ä¹Ÿæ²¡å¹²æˆã€‚æ²¡é”™ï¼Œå¤§éƒ¨åˆ†äººéƒ½æœ‰è¿™æ ·çš„ä½“éªŒï¼Œæˆ‘äº¦å¦‚æ­¤ï¼Œç‰¹åˆ«æ˜¯æœ€è¿‘å‡ å¹´ï¼Œæˆ‘ä»¬éƒ½ä¸»åŠ¨æˆ–è¢«åŠ¨åœ°æ¥å—â€œèººå¹³â€è¿™ä¸ªè¯ï¼Œè®¤ä¸ºè‡ªå·±å·²ç»åŠªåŠ›äº†å´è¿˜æ²¡çœ‹åˆ°ç»“æœï¼Œäº¦æˆ–æ˜¯ä»æ²¡èµ°å‡ºé‚£ä¸€æ­¥ï¼Œäººæ€§å°±æ˜¯è¿™æ ·ï¼Œé¿éš¾è¶‹æ˜“ï¼Œé€‰æ‹©é€ƒé¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94f714e9dd0741d5b885bce92d72b5dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY55m95b2s:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769833070&amp;x-signature=CLU%2FuonQh%2FCiuDG5MOKzUUbZiPg%3D" alt="" loading="lazy"/></p>
<p>æ­¤å±€çš„è§£æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä¹Ÿæ²¡æœ‰ç­”æ¡ˆï¼Œä¸è¿‡ä¹¦ä¸­çš„ä¸€ä¸ªè§‚ç‚¹æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€ï¼Œäººå¾ˆéš¾è®©è‡ªå·±å˜æˆç†æƒ³å‹ï¼ŒæŠ›å»æ‰€æœ‰å¨±ä¹ä¼‘é—²ï¼Œæ°¸è¿œä¸æ‘†çƒ‚ï¼Œä»æ¥ä¸èººå¹³ï¼Œè¿™æ˜¯è¿èƒŒäººæ€§çš„ã€‚æœ¬èƒ½è„‘ã€æƒ…ç»ªè„‘ã€ç†æ™ºè„‘å°±åƒä¸€ä¸ªå…¬å¸çš„ä¸‰ä¸ªå‘˜å·¥ï¼Œå…¶ä¸­æœ¬èƒ½è„‘å’Œæƒ…ç»ªè„‘æ˜¯è¿œå¤æ—¶ä»£å°±æœ‰çš„ï¼Œæ˜¯èµ„æ·±å‘˜å·¥ï¼›ç†æ™ºè„‘æ˜¯çµé•¿ç±»åŠ¨ç‰©æ‰æœ‰çš„ï¼Œå±äºæ–°å…¥èŒçš„ç»ç†ï¼Œè¦åè°ƒå¥½å…¶ä»–å‘˜å·¥ï¼Œè¿™å°±éœ€è¦ä¸€äº›ç­–ç•¥äº†ï¼Œè§„åˆ™å’Œæ¸©åº¦éƒ½è¦æœ‰ï¼Œä¸èƒ½å…‰å«é©¬å„¿è·‘ï¼Œä¸ç»™é©¬å„¿åƒè‰ï¼Œè¿™â€œåƒæ£è¯ä¸¸â€ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨ç»™è‡ªå·±åˆ¶å®šç›®æ ‡æ—¶ï¼Œåˆ«å¤ªç¦»è°±ï¼Œè¦è®©è‡ªå·±èƒ½æ—¥æ‹±ä¸€å’ï¼Œçœ‹åˆ°å¸Œæœ›ï¼›åŒæ—¶ï¼Œä¸èƒ½å…‰é¡¾ç€ç†æ™ºï¼Œä¹Ÿè¦æ»¡è¶³è‡ªå·±çš„ä¸€äº›èº«å¿ƒä½“éªŒï¼Œé€‚å½“å¥–åŠ±è‡ªå·±ã€‚ä»¥ä¸‹æ˜¯æˆ‘ç»™è‡ªå·±ç«‹çš„ 26 å¹´ flagï¼Œäººè¦å…è®¸è‡ªå·±åšä¸åˆ°ï¼Œä½†ä¸èƒ½é€‰æ‹©é€ƒé¿ï¼</p>
<ul>
<li>é¦–å…ˆæ˜¯é¡ºåˆ©è½¬æ­£ï¼Œèƒ½å¤Ÿæ‰¿æ‹…èµ·è‡ªå·±çš„èŒè´£ï¼Œç¨³æ‰ç¨³æ‰“ï¼ŒæŠŠæ–°å·¥ä½œåšå¥½ã€‚</li>
<li>ä¸šä½™æ—¶é—´åšä¸€ä¸ªå­¦ä¹ å‹çš„å…¨æ ˆé¡¹ç›®ï¼Œè¦ä¸ AI å¤§æ¨¡å‹ç»“åˆèµ·æ¥ï¼ŒåŠ å¼ºè‡ªå·±å¯¹å¤§æ¨¡å‹åº”ç”¨çš„è®¤çŸ¥ï¼Œè·Ÿç´§æŠ€æœ¯è¶‹åŠ¿ä¸æ‰é˜Ÿã€‚</li>
<li>å¤‡è€ƒè½¯è€ƒé«˜çº§ï¼Œä¸æœŸå¾…å¿…è¿‡ï¼Œä½†æ˜¯è¦å¼€å§‹å­¦èµ·æ¥ã€‚</li>
<li>åšå¥½æƒ…ç»ªç®¡ç†ï¼Œé‡åˆ°äº‹æƒ…ä¸è¦è¿‡äºç„¦è™‘ï¼Œå¸¦ç»™å®¶äººå’Œæœ‹å‹æ›´ç§¯æçš„ä¸€é¢ã€‚</li>
<li>è‡ªé©¾æ¸¸ä¸€æ¬¡ï¼Œç¬¬ä¸€é€‰æ‹©æ˜¯æ–°ç–†ï¼Œå¤§æ¦‚æ˜¯é£æœºè½åœ°ç§Ÿè½¦æ¸¸ã€‚</li>
<li>å¦»å­å¾ˆå–œæ¬¢å¾…åœ¨æµ·è¾¹ï¼Œå…¶å®æˆ‘ä¹Ÿå¾ˆå–œæ¬¢ï¼Œä»Šå¹´æ‰¾æœºä¼šå†å»ä¸€æ¬¡ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Springé›†æˆMybatisåŸç†è¯¦è§£]]></title>    <link>https://juejin.cn/post/7598469864256323635</link>    <guid>https://juejin.cn/post/7598469864256323635</guid>    <pubDate>2026-01-24T04:40:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598469864256323635" data-draft-id="7598532592455221275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Springé›†æˆMybatisåŸç†è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯,MyBatis,æºç "/> <meta itemprop="datePublished" content="2026-01-24T04:40:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜ä¾ å®¢è¡Œ"/> <meta itemprop="url" content="https://juejin.cn/user/556801719828361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Springé›†æˆMybatisåŸç†è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/556801719828361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜ä¾ å®¢è¡Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:40:58.000Z" title="Sat Jan 24 2026 04:40:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Spring é›†æˆMybatisï¼Œéœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p>
<ol>
<li>æ¥ç®¡ MyBatis æ ¸å¿ƒå¯¹è±¡ï¼Œå°†SqlSessionã€SqlSessionFactoryã€Mapperç­‰å¯¹è±¡äº¤ç”±Springç®¡ç†ï¼›</li>
<li>ç»Ÿä¸€ ä¸¤ä¸ªæ¡†æ¶äº‹åŠ¡æœºåˆ¶</li>
</ol>
<p>ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹mybatis-springæ¨¡å—å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæœ¬æ–‡ä¸­æºç æ¥è‡ªmybatis 3.4.xã€mybatis-spring 2.1.x</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ ä½¿SqlSessionçº¿ç¨‹å®‰å…¨</h2>
<h3 data-id="heading-1">1.1 éçº¿ç¨‹å®‰å…¨</h3>
<p>MyBatis ä¸­ <code>SqlSession</code> æœ¬èº«æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œ å¦‚æœå¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ª <code>SqlSession</code>ï¼Œä¼šå¯¼è‡´äº‹åŠ¡æ··ä¹±ã€æ•°æ®è„è¯»ã€SQL æ‰§è¡Œå¼‚å¸¸ç­‰é—®é¢˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f302527389f4544943e0d13df552998~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=XuFpiAhEzbFex480VG0rd2NYJlg%3D" alt="" loading="lazy"/></p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸å®‰å…¨çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¯¹çŠ¶æ€å…±äº«çš„æ“ä½œï¼Œéƒ½æ˜¯éåŸå­çš„</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultSqlSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlSession</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Configuration configuration;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Executor executor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> autoCommit; <span class="hljs-comment">// å…±äº«çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> dirty;  <span class="hljs-comment">// å…±äº«çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> List&lt;Cursor&lt;?&gt;&gt; cursorList;  <span class="hljs-comment">// å…±äº«çŠ¶æ€</span>
}
</code></pre>
<ul>
<li>Executorå¯¹è±¡ä¸­ï¼Œä¸€çº§ç¼“å­˜ã€äº‹åŠ¡éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Transaction transaction;
<span class="hljs-comment">// ä¸€çº§ç¼“å­˜</span>
<span class="hljs-keyword">protected</span> PerpetualCache localCache;
</code></pre>
<h3 data-id="heading-2">1.2 çº¿ç¨‹å®‰å…¨æ–¹æ¡ˆ</h3>
<p>ä½¿ç”¨SqlSessionManagerï¼Œé€šè¿‡ThreadLocalå°†<code>SqlSession</code>ä¸çº¿ç¨‹ç»‘å®šã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SqlSessionManageré€šè¿‡ThreadLocalå®ç°çº¿ç¨‹å®‰å…¨</span>
<span class="hljs-type">SqlSessionManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> SqlSessionManager.newInstance(sqlSessionFactory);
manager.startManagedSession();  <span class="hljs-comment">// ç»‘å®šåˆ°å½“å‰çº¿ç¨‹</span>
<span class="hljs-comment">// å¤šçº¿ç¨‹å®‰å…¨ä½¿ç”¨manager</span>
</code></pre>
<p>Springé›†æˆMybatisï¼Œæä¾›äº†SqlSessionTemplate</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Springé€šè¿‡ThreadLocalç®¡ç†SqlSession</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> SqlSessionTemplate sqlSessionTemplate;  <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨</span>
</code></pre>
<h3 data-id="heading-3">1.3 SqlSessionTemplate</h3>
<p>Spring é›†æˆ MyBatis æ—¶ï¼Œé€šè¿‡ <strong>ThreadLocal ç»‘å®š SqlSession åˆ°å½“å‰çº¿ç¨‹</strong> + <strong>SqlSessionTemplate å°è£…</strong>ï¼Œè®©æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„ <code>SqlSession</code> å®ä¾‹ï¼Œä»æ ¹æœ¬ä¸Šé¿å…å¤šçº¿ç¨‹å…±äº«å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/689eaf1d60444dad82c0aee531f4b41f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=433YoUQt2CEP2IOu8%2F162YIwDmQ%3D" alt="" loading="lazy"/></p>
<p><strong>SqlSessionTemplateæŒæœ‰SqlSessionçš„ä»£ç†å¯¹è±¡ï¼Œå¢åŠ äº†ä»å½“å‰çº¿ç¨‹ä¸­è·å–SqlSessionçš„é€»è¾‘ã€‚</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionTemplate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlSession</span>, DisposableBean {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlSessionFactory sqlSessionFactory;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ExecutorType executorType;
  <span class="hljs-comment">// ä»£ç†</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlSession sqlSessionProxy;
  <span class="hljs-comment">// ä»å½“å‰çº¿ç¨‹ä¸­è·å–SqlSession</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">(SqlSessionFactory sessionFactory, ExecutorType executorType,
      PersistenceExceptionTranslator exceptionTranslator)</span> {
    <span class="hljs-comment">// é€šè¿‡ TransactionSynchronizationManagerï¼ˆThreadLocalå®ç°ï¼‰è·å–å½“å‰çº¿ç¨‹çš„SqlSessionHolder</span>
    <span class="hljs-type">SqlSessionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> (SqlSessionHolder) TransactionSynchronizationManager.getResource(sessionFactory);

    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionHolder(executorType, holder);
    <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// çº¿ç¨‹ä¸­æœ‰åˆ™å¤ç”¨</span>
      <span class="hljs-keyword">return</span> session;
    }

    session = sessionFactory.openSession(executorType);
    <span class="hljs-comment">// ç»‘å®šSqlSessionåˆ°å½“å‰çº¿ç¨‹</span>
    registerSessionHolder(sessionFactory, executorType, exceptionTranslator, session);
    <span class="hljs-keyword">return</span> session;
  }

  <span class="hljs-comment">// ç®€åŒ–ä»£ç </span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
      <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> getSqlSession(SqlSessionTemplate.<span class="hljs-built_in">this</span>.sqlSessionFactory,
          SqlSessionTemplate.<span class="hljs-built_in">this</span>.executorType, SqlSessionTemplate.<span class="hljs-built_in">this</span>.exceptionTranslator);
      <span class="hljs-keyword">return</span> method.invoke(sqlSession, args);  
    }
  }    
</code></pre>
<p><strong>SqlSessionTemplateå®ç°äº†SqlSessionæ¥å£ï¼Œæ–¹æ³•è°ƒç”¨è½¬äº¤ç»™sqlSessionProxyã€‚</strong></p>
<h2 data-id="heading-4">äºŒ åˆ›å»ºMapperä»£ç†å¯¹è±¡</h2>
<h3 data-id="heading-5">1.1 Mybatisä¸­Mapperå¤šä¾‹</h3>
<p>mybatisä¸­MapperRegistry#getMapperæ–¹æ³•ï¼Œæ¯æ¬¡éƒ½ä¼šè¿”å›æ–°çš„ä»£ç†å¯¹è±¡ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ba877f626b44e249f479344f41abe09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=G6%2F4bT38XYCSSFPxPUYTKgG3yB0%3D" alt="" loading="lazy"/></p>
<p>åŸå› åœ¨äºå…¥å‚SqlSession æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒMapper å¯¹è±¡éœ€ç»‘å®šå½“å‰çš„ SqlSessionã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">SqlSession</span> <span class="hljs-variable">session1</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();
<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session2</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();

<span class="hljs-comment">// è·å– Mapper ä»£ç†å¯¹è±¡</span>
<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper1</span> <span class="hljs-operator">=</span> session1.getMapper(UserMapper.class);
<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper2</span> <span class="hljs-operator">=</span> session1.getMapper(UserMapper.class);
<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper3</span> <span class="hljs-operator">=</span> session2.getMapper(UserMapper.class);

<span class="hljs-comment">// ç»“æœï¼š</span>
<span class="hljs-comment">// mapper1 != mapper2  (ä¸åŒçš„ä»£ç†å¯¹è±¡)</span>
<span class="hljs-comment">// mapper1 != mapper3  (ä¸åŒçš„ä»£ç†å¯¹è±¡)</span>
<span class="hljs-comment">// mapper2 != mapper3  (ä¸åŒçš„ä»£ç†å¯¹è±¡)</span>
</code></pre>
<h3 data-id="heading-6">1.2 Springä¸­æ³¨å†ŒMapperå•ä¾‹</h3>
<p>åœ¨mybatis-spring.jarä¸­ï¼Œæä¾›äº†@MapperScanæ³¨è§£ï¼Œä»è€Œå¼•å…¥@Import(MapperScannerRegistrar.class) ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1399d9a746a64eabb2a25fcb49ca3df9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=6h0NZOPzuAxCNRE%2FpVwHLjJFl8E%3D" alt="" loading="lazy"/></p>
<p>MapperScannerRegistrarå®ç°äº†ImportBeanDefinitionRegistraræ¥å£ï¼Œä¼šå°†Mapperæ¥å£ä¿¡æ¯å¤„ç†ä¸ºBeanDefinitionå¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½®BeanDefinitionçš„beanClasså±æ€§ä¸ºMapperFactoryBean.classã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼ŒMapperFactoryBeanå®ç°äº†FactoryBeanæ¥å£ï¼ŒgetObjectæ–¹æ³•ä¼šåˆ›å»ºMapperä»£ç†å¯¹è±¡ï¼ˆå•ä¾‹çš„ï¼‰ï¼Œæ­¤å¯¹è±¡æŒæœ‰çš„SqlSessionå…¶å®æ˜¯sqlSessionTemplateå®ä¾‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MapperFactoryBeanä¸­ï¼ŒMapperå¯¹è±¡ä¼šç¼“å­˜åˆ°Springå•ä¾‹æ± ä¸­</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e794e2eb954a4a399ee74d2e1657370d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=d63YCPqGaInEBN6f4Zx8q7so0Tg%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99deef6d8c4846f982ce4f8f44f79b4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=0bL8k5r7DVikuiUPl0FpNTjg%2Frs%3D" alt="" loading="lazy"/></p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯ï¼š</p>
<ol>
<li>@MapperScanæŒ‡å®šMapperæ¥å£åŒ…è·¯å¾„ï¼Œç”±springæ‰«æï¼Œå°†Mapperæ¥å£æ³¨å†Œä¸ºMapperFactoryBeanç±»å‹ï¼›</li>
<li>springä¼šåˆ›å»ºSqlSessionTemplateçš„å•ä¾‹beanï¼Œå¹¶æ³¨å…¥åˆ°MapperFactoryBeanå¯¹è±¡ä¸­ï¼›</li>
<li>springä¼šåˆ›å»ºMapperæ¥å£çš„ä»£ç†å¯¹è±¡ï¼Œå¹¶ç¼“å­˜åˆ°å•ä¾‹æ± ä¸­ï¼Œè€Œè¯¥å¯¹è±¡æŒæœ‰çš„SqlSessionå…¶å®æ˜¯sqlSessionTemplateå¯¹è±¡ã€‚</li>
<li>@Resourceæ³¨å…¥Mapperå¯¹è±¡æ—¶ï¼Œå°†ä»å•ä¾‹æ± ä¸­è·å–ï¼›</li>
<li>Mapperå¯¹è±¡è°ƒç”¨å¦‚selectBy*ç­‰æ–¹æ³•æ—¶ï¼Œå°†ä½¿ç”¨å½“å‰çº¿ç¨‹ç»‘å®šçš„sqlSessionï¼ˆæ²¡æœ‰åˆ™åˆ›å»ºï¼‰ï¼Œæ¥æ‰§è¡ŒSQLè¯­å¥ã€‚</li>
</ol>
<p><strong>å› æ­¤ï¼Œspringä¸­Mapperä»£ç†å¯¹è±¡æ˜¯å•ä¾‹ä¸”çº¿ç¨‹å®‰å…¨ã€‚</strong></p>
<h2 data-id="heading-7">ä¸‰ ç»Ÿä¸€äº‹åŠ¡ç®¡ç†</h2>
<p>mybatisä¸­æä¾›äº†Transactionæ¥å£ï¼Œæ˜¯å¯¹äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒæŠ½è±¡ï¼Œè´Ÿè´£å°è£…æ•°æ®åº“è¿æ¥å¹¶ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚æä¾›äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li>getConnection() - è·å–æ•°æ®åº“è¿æ¥</li>
<li>commit() - æäº¤äº‹åŠ¡</li>
<li>rollback() - å›æ»šäº‹åŠ¡</li>
</ul>
<p>è¯¥æ¥å£æœ‰ä¸¤ä¸ªå®ç°</p>
<ul>
<li>JdbcTransactionï¼Œç›´æ¥ä½¿ç”¨JDBCçš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eabcf3be71e34b93baadbb1985c10494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=SU590a4bJsR2KXh%2FMKdllJjRPX4%3D" alt="" loading="lazy"/></li>
<li>ManagedTransactionï¼Œå°†äº‹åŠ¡ç®¡ç†å§”æ‰˜ç»™å¤–éƒ¨æ¡†æ¶ï¼Œå¦‚Springï¼›å› æ­¤å¯¹commitã€rollbackæ–¹æ³•åšäº†ç©ºå®ç°<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/785f47e3c69a460881bd834a2b9747b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=lPMzMSRgKcsMR%2BXuSqzz5JtKK9A%3D" alt="" loading="lazy"/></li>
</ul>
<p><strong>springæ•´åˆMybatisçš„äº‹åŠ¡ç®¡ç†ï¼Œå…³é”®é—®é¢˜å°±æ˜¯å¦‚ä½•ä¿è¯æ‰§è¡ŒSQLå’Œäº‹åŠ¡ç®¡ç†å™¨æäº¤æˆ–å›æ»šäº‹åŠ¡æ—¶ä½¿ç”¨åŒä¸€ä¸ªConnectionå¯¹è±¡ã€‚</strong></p>
<p>mybatis-springä¸­æä¾›äº†SpringManagedTransactionï¼Œè¯¥ç±»çš„openConnection()ä¼šä»ThreadLocalä¸­è·å–è¿æ¥ï¼Œæ²¡æœ‰çš„è¯åˆ™ç”±springè´Ÿè´£åˆ›å»ºä¸€ä¸ªï¼Œå¹¶ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringManagedTransaction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Transaction</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataSource dataSource;
  <span class="hljs-keyword">private</span> Connection connection;
  <span class="hljs-comment">// æ˜¯å¦æ˜¯äº‹åŠ¡è¿æ¥ï¼Œæ˜¯åˆ™å°†commit/rollbackè°ƒç”¨å§”æ‰˜ç»™Springäº‹åŠ¡ç®¡ç†å™¨</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isConnectionTransactional;
  <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> autoCommit;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e2ebac6030245a7bf8a487dcb4ec889~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=H3GGgezGJiHllSS1lkDlSK0yiUU%3D" alt="" loading="lazy"/></p>
<p>SpringManagedTransactionçš„commit/rollbackæ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰è¿æ¥å¦‚æœå¸¦äº‹åŠ¡ï¼Œå°†ä¼šå§”æ‰˜ç»™Springäº‹åŠ¡ç®¡ç†å™¨æ¥å¤„ç†ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/529ef221f53643329f66c765fc75f3e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769834458&amp;x-signature=ehqBFs2bicHjRe1cUtbG86L6y74%3D" alt="" loading="lazy"/>
Springæäº¤æˆ–å›æ»šäº‹åŠ¡æ—¶ï¼Œä¹Ÿå°†ä»å½“å‰çº¿ç¨‹çš„ThreadLocalä¸­è·å–è¿æ¥ï¼Œè¿™æ ·å°±ä¿è¯äº†ä¸Mybatisæ‰§è¡ŒSQLä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis-Plusä»å…¥é—¨åˆ°å®æˆ˜]]></title>    <link>https://juejin.cn/post/7598021081987432499</link>    <guid>https://juejin.cn/post/7598021081987432499</guid>    <pubDate>2026-01-23T01:09:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598021081987432499" data-draft-id="7597664149170143274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis-Plusä»å…¥é—¨åˆ°å®æˆ˜"/> <meta itemprop="keywords" content="MyBatis"/> <meta itemprop="datePublished" content="2026-01-23T01:09:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis-Plusä»å…¥é—¨åˆ°å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T01:09:39.000Z" title="Fri Jan 23 2026 01:09:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MyBatis-Plusä»å…¥é—¨åˆ°å®æˆ˜</h2>
<h2 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯MyBatis-Plusï¼Ÿ</h2>
<p>MyBatis-Plusï¼ˆç®€ç§°MPï¼‰æ˜¯åŸºäºMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨MyBatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚å®ƒæä¾›äº†é€šç”¨çš„Mapperå’ŒServiceï¼Œé€šè¿‡å°‘é‡çš„é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ†CRUDæ“ä½œï¼Œæå¤§åœ°æå‡äº†å¼€å‘æ•ˆç‡ã€‚</p>
<h3 data-id="heading-2">1.1 æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><strong>æ— ä¾µå…¥</strong>ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“</li>
<li><strong>æŸè€—å°</strong>ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬CRUDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—</li>
<li><strong>å¼ºå¤§çš„CRUDæ“ä½œ</strong>ï¼šå†…ç½®é€šç”¨Mapperã€é€šç”¨Serviceï¼Œé€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ†CRUDæ“ä½œ</li>
<li><strong>æ”¯æŒLambdaå½¢å¼è°ƒç”¨</strong>ï¼šé€šè¿‡Lambdaè¡¨è¾¾å¼ï¼Œæ–¹ä¾¿åœ°ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶</li>
<li><strong>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šæ”¯æŒå¤šè¾¾4ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆå™¨ï¼‰</li>
<li><strong>å†…ç½®åˆ†é¡µæ’ä»¶</strong>ï¼šåŸºäºMyBatisç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œ</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57ceae3938f34a119034a13d44ac8c70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=k%2BU2enKkPOKW7cVY%2FGrA9%2FHIghI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">äºŒã€ç¯å¢ƒæ­å»º</h2>
<h3 data-id="heading-4">2.1 Mavenä¾èµ–é…ç½®</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœ¨pom.xmlä¸­æ·»åŠ MyBatis-Plusä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MyBatis-Plusæ ¸å¿ƒä¾èµ– --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQLé©±åŠ¨ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Druidæ•°æ®æº --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombokï¼ˆå¯é€‰ï¼Œç”¨äºç®€åŒ–å®ä½“ç±»ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2.2 é…ç½®æ–‡ä»¶</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mp_db?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-attr">initial-size:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">max-active:</span> <span class="hljs-number">20</span>
      <span class="hljs-attr">max-wait:</span> <span class="hljs-number">60000</span>

<span class="hljs-comment"># MyBatis-Plusé…ç½®</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-comment"># Mapper XMLæ–‡ä»¶ä½ç½®</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath*:/mapper/**/*.xml</span>
  <span class="hljs-comment"># å®ä½“ç±»åŒ…è·¯å¾„</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.mp.entity</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-comment"># é©¼å³°è½¬ä¸‹åˆ’çº¿</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># æ—¥å¿—è¾“å‡º</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-comment"># ä¸»é”®ç±»å‹ï¼ˆAUTOè‡ªå¢ï¼ŒASSIGN_IDé›ªèŠ±ç®—æ³•ï¼‰</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>
      <span class="hljs-comment"># é€»è¾‘åˆ é™¤å­—æ®µ</span>
      <span class="hljs-attr">logic-delete-field:</span> <span class="hljs-string">deleted</span>
      <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span>
</code></pre>
<h3 data-id="heading-6">2.3 å¯åŠ¨ç±»é…ç½®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.mp;

<span class="hljs-keyword">import</span> org.mybatis.spring.<span class="hljs-keyword">annotation</span>.MapperScan;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-comment">/**
 * MyBatis-Plusåº”ç”¨å¯åŠ¨ç±»
 */</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@MapperScan(<span class="hljs-string">"com.example.mp.mapper"</span>)</span>  <span class="hljs-comment">// æ‰«æMapperæ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusApplication</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) {
        SpringApplication.run(MybatisPlusApplication.<span class="hljs-keyword">class</span>, args);
    }
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è¯¦è§£</h2>
<h3 data-id="heading-8">3.1 CRUDæ¥å£</h3>
<p>MyBatis-Plusæä¾›äº†é€šç”¨çš„BaseMapperæ¥å£ï¼Œå†…ç½®äº†å¸¸ç”¨çš„CRUDæ–¹æ³•ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d96cdfbb403640c8805e6a64d8f507ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=ssbXF2JQKB4ZNo%2BCzaKiQXzB33E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">3.1.1 å®ä½“ç±»å®šä¹‰</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.mp.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.<span class="hljs-type">Data</span>;

<span class="hljs-keyword">import</span> java.time.<span class="hljs-type">LocalDateTime</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·å®ä½“ç±»
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName</span>(<span class="hljs-string">"sys_user"</span>)  <span class="hljs-comment">// æŒ‡å®šè¡¨å</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{

    <span class="hljs-comment">/**
     * ä¸»é”®å­—æ®µï¼Œè‡ªå¢
     */</span>
    <span class="hljs-meta">@TableId</span>(value = <span class="hljs-string">"id"</span>, <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= <span class="hljs-type">IdType</span>.<span class="hljs-type">AUTO</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-type">Long</span> id;

    <span class="hljs-comment">/**
     * ç”¨æˆ·å
     */</span>
    <span class="hljs-meta">@TableField</span>(<span class="hljs-string">"username"</span>)  <span class="hljs-comment">// æŒ‡å®šå­—æ®µå</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> username;

    <span class="hljs-comment">/**
     * å¯†ç 
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> password;

    <span class="hljs-comment">/**
     * é‚®ç®±
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> email;

    <span class="hljs-comment">/**
     * å¹´é¾„
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> age;

    <span class="hljs-comment">/**
     * çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> status;

    <span class="hljs-comment">/**
     * é€»è¾‘åˆ é™¤æ ‡è®°ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤
     */</span>
    <span class="hljs-meta">@TableLogic</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> deleted;

    <span class="hljs-comment">/**
     * åˆ›å»ºæ—¶é—´
     */</span>
    <span class="hljs-meta">@TableField</span>(fill = <span class="hljs-type">FieldFill</span>.<span class="hljs-type">INSERT</span>)  <span class="hljs-comment">// æ’å…¥æ—¶è‡ªåŠ¨å¡«å……</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">LocalDateTime</span> createTime;

    <span class="hljs-comment">/**
     * æ›´æ–°æ—¶é—´
     */</span>
    <span class="hljs-meta">@TableField</span>(fill = <span class="hljs-type">FieldFill</span>.<span class="hljs-type">INSERT_UPDATE</span>)  <span class="hljs-comment">// æ’å…¥å’Œæ›´æ–°æ—¶è‡ªåŠ¨å¡«å……</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">LocalDateTime</span> updateTime;

    <span class="hljs-comment">/**
     * ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰
     */</span>
    <span class="hljs-meta">@Version</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> version;
}
</code></pre>
<h3 data-id="heading-10">3.1.2 Mapperæ¥å£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.mapper;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;
<span class="hljs-keyword">import</span> com.example.mp.entity.User;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;

<span class="hljs-comment">/**
 * ç”¨æˆ·Mapperæ¥å£
 * ç»§æ‰¿BaseMapperåè‡ªåŠ¨æ‹¥æœ‰CRUDæ–¹æ³•
 */</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; {
    <span class="hljs-comment">// BaseMapperå·²æä¾›ä»¥ä¸‹æ–¹æ³•ï¼š</span>
    <span class="hljs-comment">// insert(User entity) - æ’å…¥</span>
    <span class="hljs-comment">// deleteById(Serializable id) - æ ¹æ®IDåˆ é™¤</span>
    <span class="hljs-comment">// updateById(User entity) - æ ¹æ®IDæ›´æ–°</span>
    <span class="hljs-comment">// selectById(Serializable id) - æ ¹æ®IDæŸ¥è¯¢</span>
    <span class="hljs-comment">// selectList(Wrapper&lt;User&gt; wrapper) - æ¡ä»¶æŸ¥è¯¢</span>
    <span class="hljs-comment">// selectPage(IPage&lt;User&gt; page, Wrapper&lt;User&gt; wrapper) - åˆ†é¡µæŸ¥è¯¢</span>
    <span class="hljs-comment">// ... æ›´å¤šæ–¹æ³•</span>
}
</code></pre>
<h3 data-id="heading-11">3.1.3 Serviceå±‚</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.mp.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.<span class="hljs-type">IService</span>;
<span class="hljs-keyword">import</span> com.example.mp.entity.<span class="hljs-type">User</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·Serviceæ¥å£
 * ç»§æ‰¿IServiceè·å¾—æ›´å¤šæ‰¹é‡æ“ä½œæ–¹æ³•
 */</span>
public interface <span class="hljs-type">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-type">IService</span>&lt;<span class="hljs-type">User</span>&gt; {
}

<span class="hljs-keyword">package</span> com.example.mp.service.impl;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.<span class="hljs-type">ServiceImpl</span>;
<span class="hljs-keyword">import</span> com.example.mp.entity.<span class="hljs-type">User</span>;
<span class="hljs-keyword">import</span> com.example.mp.mapper.<span class="hljs-type">UserMapper</span>;
<span class="hljs-keyword">import</span> com.example.mp.service.<span class="hljs-type">UserService</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Service</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·Serviceå®ç°ç±»
 */</span>
<span class="hljs-meta">@Service</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;UserMapper</span>, <span class="hljs-title">User&gt;</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserService</span> </span>{
}
</code></pre>
<h3 data-id="heading-12">3.1.4 CRUDä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-csharp" lang="csharp">package com.example.mp.test;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.example.mp.entity.User;
import com.example.mp.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.Arrays;
import java.util.List;

<span class="hljs-comment">/**
 * CRUDæ“ä½œç¤ºä¾‹
 */</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CrudExample</span> {

    @Autowired
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-comment">/**
     * æ–°å¢ç”¨æˆ·
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span>()</span> {
        User user = <span class="hljs-keyword">new</span> User();
        user.setUsername(<span class="hljs-string">"zhangsan"</span>);
        user.setPassword(<span class="hljs-string">"123456"</span>);
        user.setEmail(<span class="hljs-string">"zhangsan@example.com"</span>);
        user.setAge(<span class="hljs-number">25</span>);
        user.setStatus(<span class="hljs-number">1</span>);

        <span class="hljs-comment">// æ’å…¥æ•°æ®ï¼ŒIDä¼šè‡ªåŠ¨å›å¡«</span>
        boolean success = userService.save(user);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ’å…¥æˆåŠŸï¼š"</span> + success);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ç”¨æˆ·IDï¼š"</span> + user.getId());
    }

    <span class="hljs-comment">/**
     * æ‰¹é‡æ–°å¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertBatchUsers</span>()</span> {
        List&lt;User&gt; users = Arrays.asList(
            create_user(<span class="hljs-string">"lisi"</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-string">"lisi@example.com"</span>, <span class="hljs-number">28</span>),
            create_user(<span class="hljs-string">"wangwu"</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-string">"wangwu@example.com"</span>, <span class="hljs-number">30</span>)
        );

        boolean success = userService.saveBatch(users);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰¹é‡æ’å…¥æˆåŠŸï¼š"</span> + success);
    }

    <span class="hljs-comment">/**
     * æ ¹æ®IDåˆ é™¤
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span>()</span> {
        boolean success = userService.removeById(<span class="hljs-number">1L</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"åˆ é™¤æˆåŠŸï¼š"</span> + success);
    }

    <span class="hljs-comment">/**
     * æ‰¹é‡åˆ é™¤
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBatchIds</span>()</span> {
        boolean success = userService.removeByIds(Arrays.asList(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">3L</span>));
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ‰¹é‡åˆ é™¤æˆåŠŸï¼š"</span> + success);
    }

    <span class="hljs-comment">/**
     * æ¡ä»¶åˆ é™¤
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteByCondition</span>()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();
        wrapper.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">0</span>).lt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>);

        boolean success = userService.<span class="hljs-keyword">remove</span>(wrapper);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ¡ä»¶åˆ é™¤æˆåŠŸï¼š"</span> + success);
    }

    <span class="hljs-comment">/**
     * æ ¹æ®IDæ›´æ–°
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateById</span>()</span> {
        User user = userService.getById(<span class="hljs-number">1L</span>);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            user.setAge(<span class="hljs-number">26</span>);
            user.setEmail(<span class="hljs-string">"newemail@example.com"</span>);

            boolean success = userService.updateById(user);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ›´æ–°æˆåŠŸï¼š"</span> + success);
        }
    }

    <span class="hljs-comment">/**
     * æ¡ä»¶æ›´æ–°
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateByCondition</span>()</span> {
        UpdateWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> UpdateWrapper&lt;&gt;();
        wrapper.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>).<span class="hljs-keyword">set</span>(<span class="hljs-string">"age"</span>, <span class="hljs-number">30</span>).<span class="hljs-keyword">set</span>(<span class="hljs-string">"email"</span>, <span class="hljs-string">"updated@example.com"</span>);

        boolean success = userService.update(wrapper);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ¡ä»¶æ›´æ–°æˆåŠŸï¼š"</span> + success);
    }

    <span class="hljs-comment">/**
     * æ ¹æ®IDæŸ¥è¯¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectById</span>()</span> {
        User user = userService.getById(<span class="hljs-number">1L</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœï¼š"</span> + user);
    }

    <span class="hljs-comment">/**
     * æ‰¹é‡æŸ¥è¯¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectBatchIds</span>()</span> {
        List&lt;User&gt; users = userService.listByIds(Arrays.asList(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">3L</span>));
        users.forEach(System.<span class="hljs-keyword">out</span>::println);
    }

    <span class="hljs-comment">/**
     * æ¡ä»¶æŸ¥è¯¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectByCondition</span>()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();
        wrapper.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>)
               .gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>)
               .likeRight(<span class="hljs-string">"username"</span>, <span class="hljs-string">"zhang"</span>)
               .orderByDesc(<span class="hljs-string">"create_time"</span>);

        List&lt;User&gt; users = userService.list(wrapper);
        users.forEach(System.<span class="hljs-keyword">out</span>::println);
    }

    <span class="hljs-comment">/**
     * åˆ†é¡µæŸ¥è¯¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectPage</span>()</span> {
        <span class="hljs-comment">// åˆ›å»ºåˆ†é¡µå¯¹è±¡ï¼ˆå½“å‰é¡µ1ï¼Œæ¯é¡µ10æ¡ï¼‰</span>
        Page&lt;User&gt; page = <span class="hljs-keyword">new</span> Page&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);

        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();
        wrapper.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>).orderByDesc(<span class="hljs-string">"create_time"</span>);

        Page&lt;User&gt; result = userService.page(page, wrapper);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ€»è®°å½•æ•°ï¼š"</span> + result.getTotal());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ€»é¡µæ•°ï¼š"</span> + result.getPages());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å½“å‰é¡µæ•°æ®ï¼š"</span> + result.getRecords());
    }

    <span class="hljs-comment">/**
     * ç»Ÿè®¡æŸ¥è¯¢
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectCount</span>()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();
        wrapper.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>).gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>);

        <span class="hljs-built_in">long</span> count = userService.count(wrapper);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ç¬¦åˆæ¡ä»¶çš„äººæ•°ï¼š"</span> + count);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> User <span class="hljs-title">create_user</span>(<span class="hljs-params">String username, String password, String email, <span class="hljs-built_in">int</span> age</span>)</span> {
        User user = <span class="hljs-keyword">new</span> User();
        user.setUsername(username);
        user.setPassword(password);
        user.setEmail(email);
        user.setAge(age);
        user.setStatus(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<h2 data-id="heading-13">å››ã€æ¡ä»¶æ„é€ å™¨</h2>
<h3 data-id="heading-14">4.1 QueryWrapperæ¡ä»¶æŸ¥è¯¢</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.wrapper;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
<span class="hljs-keyword">import</span> com.example.mp.entity.User;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * æ¡ä»¶æ„é€ å™¨ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrapperTest</span> {

    <span class="hljs-comment">/**
     * åŸºæœ¬æ¡ä»¶æŸ¥è¯¢
     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicQuery</span><span class="hljs-params">()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();

        <span class="hljs-comment">// eq: ç­‰äº =</span>
        wrapper.eq(<span class="hljs-string">"username"</span>, <span class="hljs-string">"zhangsan"</span>);

        <span class="hljs-comment">// ne: ä¸ç­‰äº &lt;&gt;</span>
        wrapper.ne(<span class="hljs-string">"status"</span>, <span class="hljs-number">0</span>);

        <span class="hljs-comment">// gt: å¤§äº &gt;</span>
        wrapper.gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>);

        <span class="hljs-comment">// ge: å¤§äºç­‰äº &gt;=</span>
        wrapper.ge(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>);

        <span class="hljs-comment">// lt: å°äº &lt;</span>
        wrapper.lt(<span class="hljs-string">"age"</span>, <span class="hljs-number">60</span>);

        <span class="hljs-comment">// le: å°äºç­‰äº &lt;=</span>
        wrapper.le(<span class="hljs-string">"age"</span>, <span class="hljs-number">60</span>);

        <span class="hljs-comment">// between: BETWEENå€¼1 ANDå€¼2</span>
        wrapper.between(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>, <span class="hljs-number">60</span>);

        <span class="hljs-comment">// notBetween: NOT BETWEEN</span>
        wrapper.notBetween(<span class="hljs-string">"age"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18</span>);

        <span class="hljs-comment">// like: LIKE '%å€¼%'</span>
        wrapper.like(<span class="hljs-string">"username"</span>, <span class="hljs-string">"zhang"</span>);

        <span class="hljs-comment">// notLike: NOT LIKE '%å€¼%'</span>
        wrapper.notLike(<span class="hljs-string">"username"</span>, <span class="hljs-string">"admin"</span>);

        <span class="hljs-comment">// likeLeft: LIKE '%å€¼'</span>
        wrapper.likeLeft(<span class="hljs-string">"email"</span>, <span class="hljs-string">"@example.com"</span>);

        <span class="hljs-comment">// likeRight: LIKE 'å€¼%'</span>
        wrapper.likeRight(<span class="hljs-string">"username"</span>, <span class="hljs-string">"zhang"</span>);

        <span class="hljs-comment">// isNull: å­—æ®µ IS NULL</span>
        wrapper.isNull(<span class="hljs-string">"email"</span>);

        <span class="hljs-comment">// isNotNull: å­—æ®µ IS NOT NULL</span>
        wrapper.isNotNull(<span class="hljs-string">"email"</span>);

        <span class="hljs-comment">// in: å­—æ®µ IN (v0, v1, ...)</span>
        wrapper.in(<span class="hljs-string">"status"</span>, Arrays.asList(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>));

        <span class="hljs-comment">// notIn: å­—æ®µ NOT IN (v0, v1, ...)</span>
        wrapper.notIn(<span class="hljs-string">"id"</span>, Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));

        <span class="hljs-comment">// inSql: å­—æ®µ IN (SQLè¯­å¥)</span>
        wrapper.inSql(<span class="hljs-string">"id"</span>, <span class="hljs-string">"select user_id from user_role where role_id = 1"</span>);

        <span class="hljs-comment">// orderBy: ORDER BY å­—æ®µ</span>
        wrapper.orderBy(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">"create_time"</span>);

        <span class="hljs-comment">// orderByAsc: ORDER BY å­—æ®µ ASC</span>
        wrapper.orderByAsc(<span class="hljs-string">"age"</span>);

        <span class="hljs-comment">// orderByDesc: ORDER BY å­—æ®µ DESC</span>
        wrapper.orderByDesc(<span class="hljs-string">"create_time"</span>);

        List&lt;User&gt; users = userMapper.selectList(wrapper);
    }

    <span class="hljs-comment">/**
     * æ¡ä»¶æ‹¼æ¥ï¼ˆé“¾å¼è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">chainQuery</span><span class="hljs-params">()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;()
            .eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>)
            .gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>)
            .likeRight(<span class="hljs-string">"username"</span>, <span class="hljs-string">"zhang"</span>)
            .orderByDesc(<span class="hljs-string">"create_time"</span>)
            .last(<span class="hljs-string">"LIMIT 10"</span>);  <span class="hljs-comment">// æœ€åè¿½åŠ SQLç‰‡æ®µ</span>

        List&lt;User&gt; users = userMapper.selectList(wrapper);
    }

    <span class="hljs-comment">/**
     * æ¡ä»¶åˆ¤æ–­ï¼ˆåŠ¨æ€æ¡ä»¶ï¼‰
     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">conditionQuery</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">"zhang"</span>;
        <span class="hljs-type">Integer</span> <span class="hljs-variable">minAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
        <span class="hljs-type">Integer</span> <span class="hljs-variable">maxAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;

        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();

        <span class="hljs-comment">// æ¡ä»¶ä¸ä¸ºç©ºæ—¶æ‰æ‹¼æ¥</span>
        wrapper.eq(username != <span class="hljs-literal">null</span>, <span class="hljs-string">"username"</span>, username)
               .gt(minAge != <span class="hljs-literal">null</span>, <span class="hljs-string">"age"</span>, minAge)
               .lt(maxAge != <span class="hljs-literal">null</span>, <span class="hljs-string">"age"</span>, maxAge)
               .eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>);

        List&lt;User&gt; users = userMapper.selectList(wrapper);
    }

    <span class="hljs-comment">/**
     * Lambdaæ¡ä»¶æ„é€ å™¨ï¼ˆæ¨èä½¿ç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lambdaQuery</span><span class="hljs-params">()</span> {
        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();

        <span class="hljs-comment">// ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œé¿å…ç¡¬ç¼–ç å­—æ®µå</span>
        wrapper.eq(User::getUsername, <span class="hljs-string">"zhangsan"</span>)
               .gt(User::getAge, <span class="hljs-number">18</span>)
               .likeRight(User::getEmail, <span class="hljs-string">"zhang"</span>)
               .orderByDesc(User::getCreateTime);

        List&lt;User&gt; users = userMapper.selectList(wrapper);
    }

    <span class="hljs-comment">/**
     * åªæŸ¥è¯¢éƒ¨åˆ†å­—æ®µ
     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectFields</span><span class="hljs-params">()</span> {
        QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();

        <span class="hljs-comment">// åªæŸ¥è¯¢idã€usernameã€emailå­—æ®µ</span>
        wrapper.select(<span class="hljs-string">"id"</span>, <span class="hljs-string">"username"</span>, <span class="hljs-string">"email"</span>)
               .eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>);

        List&lt;User&gt; users = userMapper.selectList(wrapper);
    }
}
</code></pre>
<h2 data-id="heading-15">äº”ã€å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-16">5.1 ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå®ç°ï¼ŒåŒ…å«ç”¨æˆ·CRUDã€è§’è‰²å…³è”ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cb6a3a8765e43ba817ccfde5ae8e2fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=JdX1iuW2%2F%2FM7b54jr1%2BhrhwNn%2Fc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">5.1.1 æ•°æ®åº“è®¾è®¡</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç”¨æˆ·è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_user (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">'ç”¨æˆ·å'</span>,
    password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¯†ç '</span>,
    nickname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) COMMENT <span class="hljs-string">'æ˜µç§°'</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">'é‚®ç®±'</span>,
    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">'æ‰‹æœºå·'</span>,
    avatar <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) COMMENT <span class="hljs-string">'å¤´åƒ'</span>,
    gender TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³'</span>,
    age <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">'å¹´é¾„'</span>,
    status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨'</span>,
    deleted TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'åˆ é™¤æ ‡è®°ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤'</span>,
    version <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'ç‰ˆæœ¬å·'</span>,
    create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
    update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>,
    INDEX idx_username (username),
    INDEX idx_status (status),
    INDEX idx_create_time (create_time)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç”¨æˆ·è¡¨'</span>;

<span class="hljs-comment">-- è§’è‰²è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_role (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'è§’è‰²ID'</span>,
    role_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è§’è‰²åç§°'</span>,
    role_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">'è§’è‰²ç¼–ç '</span>,
    description <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>) COMMENT <span class="hljs-string">'æè¿°'</span>,
    status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨'</span>,
    deleted TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'åˆ é™¤æ ‡è®°'</span>,
    create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
    update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'è§’è‰²è¡¨'</span>;

<span class="hljs-comment">-- ç”¨æˆ·è§’è‰²å…³è”è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_user_role (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    role_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è§’è‰²ID'</span>,
    create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY uk_user_role (user_id, role_id),
    INDEX idx_user_id (user_id),
    INDEX idx_role_id (role_id)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç”¨æˆ·è§’è‰²å…³è”è¡¨'</span>;
</code></pre>
<h3 data-id="heading-18">5.1.2 å®ä½“ç±»å®šä¹‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.mp.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ç”¨æˆ·å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName(<span class="hljs-string">"sys_user"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;

    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-keyword">private</span> String nickname;

    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-keyword">private</span> String phone;

    <span class="hljs-keyword">private</span> String avatar;

    <span class="hljs-keyword">private</span> Integer gender;

    <span class="hljs-keyword">private</span> Integer age;

    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-meta">@TableLogic</span>
    <span class="hljs-keyword">private</span> Integer deleted;

    <span class="hljs-meta">@Version</span>
    <span class="hljs-keyword">private</span> Integer version;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}

<span class="hljs-keyword">package</span> com.example.mp.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * è§’è‰²å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName(<span class="hljs-string">"sys_role"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Role</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;

    <span class="hljs-keyword">private</span> String roleName;

    <span class="hljs-meta">@TableField(<span class="hljs-string">"role_code"</span>)</span>
    <span class="hljs-keyword">private</span> String roleCode;

    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-meta">@TableLogic</span>
    <span class="hljs-keyword">private</span> Integer deleted;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}

<span class="hljs-keyword">package</span> com.example.mp.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ç”¨æˆ·è§’è‰²å…³è”å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName(<span class="hljs-string">"sys_user_role"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRole</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> userId;

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> roleId;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
}
</code></pre>
<h3 data-id="heading-19">5.1.3 è‡ªåŠ¨å¡«å……å¤„ç†å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.handler;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
<span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * å­—æ®µè‡ªåŠ¨å¡«å……å¤„ç†å™¨
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FieldMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> {

    <span class="hljs-comment">/**
     * æ’å…¥æ—¶è‡ªåŠ¨å¡«å……
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createTime"</span>, LocalDateTime.class, LocalDateTime.now());
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"updateTime"</span>, LocalDateTime.class, LocalDateTime.now());
    }

    <span class="hljs-comment">/**
     * æ›´æ–°æ—¶è‡ªåŠ¨å¡«å……
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.strictUpdateFill(metaObject, <span class="hljs-string">"updateTime"</span>, LocalDateTime.class, LocalDateTime.now());
    }
}
</code></pre>
<h3 data-id="heading-20">5.1.4 Serviceå±‚å®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;
<span class="hljs-keyword">import</span> com.example.mp.entity.User;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ç”¨æˆ·Serviceæ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; {

    <span class="hljs-comment">/**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
     */</span>
    User <span class="hljs-title function_">getByUsername</span><span class="hljs-params">(String username)</span>;

    <span class="hljs-comment">/**
     * ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">assignRoles</span><span class="hljs-params">(Long userId, List&lt;Long&gt; roleIds)</span>;

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²åˆ—è¡¨
     */</span>
    List&lt;Long&gt; <span class="hljs-title function_">getUserRoleIds</span><span class="hljs-params">(Long userId)</span>;

    <span class="hljs-comment">/**
     * æ›´æ–°ç”¨æˆ·çŠ¶æ€
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateStatus</span><span class="hljs-params">(Long userId, Integer status)</span>;
}

<span class="hljs-keyword">package</span> com.example.mp.service.impl;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
<span class="hljs-keyword">import</span> com.example.mp.entity.User;
<span class="hljs-keyword">import</span> com.example.mp.entity.UserRole;
<span class="hljs-keyword">import</span> com.example.mp.mapper.UserMapper;
<span class="hljs-keyword">import</span> com.example.mp.service.IUserRoleService;
<span class="hljs-keyword">import</span> com.example.mp.service.IUserService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * ç”¨æˆ·Serviceå®ç°
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> IUserRoleService userRoleService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getByUsername</span><span class="hljs-params">(String username)</span> {
        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        wrapper.eq(User::getUsername, username);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.getOne(wrapper);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">assignRoles</span><span class="hljs-params">(Long userId, List&lt;Long&gt; roleIds)</span> {
        <span class="hljs-comment">// å…ˆåˆ é™¤ç”¨æˆ·åŸæœ‰è§’è‰²</span>
        LambdaQueryWrapper&lt;UserRole&gt; deleteWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        deleteWrapper.eq(UserRole::getUserId, userId);
        userRoleService.remove(deleteWrapper);

        <span class="hljs-comment">// æ‰¹é‡æ’å…¥æ–°è§’è‰²</span>
        <span class="hljs-keyword">if</span> (roleIds != <span class="hljs-literal">null</span> &amp;&amp; !roleIds.isEmpty()) {
            List&lt;UserRole&gt; userRoles = roleIds.stream()
                .map(roleId -&gt; {
                    <span class="hljs-type">UserRole</span> <span class="hljs-variable">ur</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRole</span>();
                    ur.setUserId(userId);
                    ur.setRoleId(roleId);
                    <span class="hljs-keyword">return</span> ur;
                })
                .collect(Collectors.toList());
            <span class="hljs-keyword">return</span> userRoleService.saveBatch(userRoles);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;Long&gt; <span class="hljs-title function_">getUserRoleIds</span><span class="hljs-params">(Long userId)</span> {
        LambdaQueryWrapper&lt;UserRole&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
        wrapper.eq(UserRole::getUserId, userId);
        wrapper.select(UserRole::getRoleId);
        <span class="hljs-keyword">return</span> userRoleService.list(wrapper).stream()
            .map(UserRole::getRoleId)
            .collect(Collectors.toList());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateStatus</span><span class="hljs-params">(Long userId, Integer status)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setId(userId);
        user.setStatus(status);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.updateById(user);
    }
}
</code></pre>
<h3 data-id="heading-21">5.1.5 Controllerå±‚</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.mp</span><span class="hljs-selector-class">.controller</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.conditions</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.LambdaQueryWrapper</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.extension</span><span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.pagination</span><span class="hljs-selector-class">.Page</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.mp</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.User</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.mp</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.IUserService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Map</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·Controller
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/user"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserController</span> {

    <span class="hljs-variable">@Autowired</span>
    private IUserService userService;

    <span class="hljs-comment">/**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
     */</span>
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/page"</span>)
    public Map&lt;String, Object&gt; <span class="hljs-built_in">page</span>(
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"1"</span>) Integer current,
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"10"</span>) Integer size,
            <span class="hljs-variable">@RequestParam</span>(required = false) String username,
            <span class="hljs-variable">@RequestParam</span>(required = false) Integer status) {

        <span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">page</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Page</span>&lt;&gt;(current, size);
        <span class="hljs-selector-tag">LambdaQueryWrapper</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">wrapper</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">LambdaQueryWrapper</span>&lt;&gt;();

        <span class="hljs-comment">// åŠ¨æ€æ¡ä»¶</span>
        <span class="hljs-selector-tag">wrapper</span><span class="hljs-selector-class">.likeRight</span>(username != null, <span class="hljs-attribute">User</span>::getUsername, username)
               <span class="hljs-selector-class">.eq</span>(status != null, <span class="hljs-attribute">User</span>::getStatus, status)
               <span class="hljs-selector-class">.orderByDesc</span>(<span class="hljs-attribute">User</span>::getCreateTime);

        <span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.page</span>(page, wrapper);

        <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">data</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;&gt;();
        <span class="hljs-selector-tag">data</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"total"</span>, result.<span class="hljs-built_in">getTotal</span>());
        <span class="hljs-selector-tag">data</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"pages"</span>, result.<span class="hljs-built_in">getPages</span>());
        <span class="hljs-selector-tag">data</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"current"</span>, result.<span class="hljs-built_in">getCurrent</span>());
        <span class="hljs-selector-tag">data</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"records"</span>, result.<span class="hljs-built_in">getRecords</span>());

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, true, <span class="hljs-string">"data"</span>, data);
    }

    <span class="hljs-comment">/**
     * æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">getById</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getById</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, true, <span class="hljs-string">"data"</span>, user);
    }

    <span class="hljs-comment">/**
     * æ–°å¢ç”¨æˆ·
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">save</span>(<span class="hljs-variable">@RequestBody</span> User user) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">success</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.save</span>(user);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, success, <span class="hljs-string">"message"</span>, success ? <span class="hljs-string">"æ–°å¢æˆåŠŸ"</span> : <span class="hljs-string">"æ–°å¢å¤±è´¥"</span>);
    }

    <span class="hljs-comment">/**
     * æ›´æ–°ç”¨æˆ·
     */</span>
    @<span class="hljs-selector-tag">PutMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@RequestBody</span> User user) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">success</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.updateById</span>(user);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, success, <span class="hljs-string">"message"</span>, success ? <span class="hljs-string">"æ›´æ–°æˆåŠŸ"</span> : <span class="hljs-string">"æ›´æ–°å¤±è´¥"</span>);
    }

    <span class="hljs-comment">/**
     * åˆ é™¤ç”¨æˆ·
     */</span>
    @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/{id}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">delete</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">success</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.removeById</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, success, <span class="hljs-string">"message"</span>, success ? <span class="hljs-string">"åˆ é™¤æˆåŠŸ"</span> : <span class="hljs-string">"åˆ é™¤å¤±è´¥"</span>);
    }

    <span class="hljs-comment">/**
     * åˆ†é…è§’è‰²
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/{userId}/roles"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">assignRoles</span>(
            <span class="hljs-variable">@PathVariable</span> Long userId,
            <span class="hljs-variable">@RequestBody</span> List&lt;Long&gt; roleIds) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">success</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.assignRoles</span>(userId, roleIds);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, success, <span class="hljs-string">"message"</span>, success ? <span class="hljs-string">"åˆ†é…æˆåŠŸ"</span> : <span class="hljs-string">"åˆ†é…å¤±è´¥"</span>);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç”¨æˆ·è§’è‰²
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{userId}/roles"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">getUserRoles</span>(<span class="hljs-variable">@PathVariable</span> Long userId) {
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Long</span>&gt; <span class="hljs-selector-tag">roleIds</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserRoleIds</span>(userId);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Map</span><span class="hljs-selector-class">.of</span>(<span class="hljs-string">"success"</span>, true, <span class="hljs-string">"data"</span>, roleIds);
    }
}
</code></pre>
<h3 data-id="heading-22">5.2 æ•°æ®äº¤äº’æµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf40632d5da44afa35d78d649b07262~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=JX2AoE0yKZTA2CxleD07HVytzq8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-23">5.3 åˆ†é¡µæ’ä»¶é…ç½®</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.config;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.OptimisticLockerInnerInterceptor;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-comment">/**
 * MyBatis-Plusé…ç½®ç±»
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> {

    <span class="hljs-comment">/**
     * é…ç½®åˆ†é¡µæ’ä»¶å’Œä¹è§‚é”æ’ä»¶
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();

        <span class="hljs-comment">// åˆ†é¡µæ’ä»¶</span>
        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">paginationInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);
        <span class="hljs-comment">// è®¾ç½®å•é¡µæœ€å¤§é™åˆ¶æ•°é‡ï¼Œé»˜è®¤500æ¡ï¼Œ-1ä¸é™åˆ¶</span>
        paginationInterceptor.setMaxLimit(<span class="hljs-number">1000L</span>);
        <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåçš„æ“ä½œï¼štrueè¿”å›é¦–é¡µï¼Œfalseç»§ç»­è¯·æ±‚</span>
        paginationInterceptor.setOverflow(<span class="hljs-literal">false</span>);

        <span class="hljs-comment">// ä¹è§‚é”æ’ä»¶</span>
        <span class="hljs-type">OptimisticLockerInnerInterceptor</span> <span class="hljs-variable">optimisticLockerInterceptor</span> <span class="hljs-operator">=</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">OptimisticLockerInnerInterceptor</span>();

        interceptor.addInnerInterceptor(paginationInterceptor);
        interceptor.addInnerInterceptor(optimisticLockerInterceptor);

        <span class="hljs-keyword">return</span> interceptor;
    }
}
</code></pre>
<h2 data-id="heading-24">å…­ã€é«˜çº§ç‰¹æ€§</h2>
<h3 data-id="heading-25">6.1 ä»£ç ç”Ÿæˆå™¨</h3>
<p>MyBatis-Plusæä¾›äº†å¼ºå¤§çš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥å¿«é€Ÿç”ŸæˆEntityã€Mapperã€Serviceã€Controllerç­‰ä»£ç ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7626aaa863ce4d2e8494573baaf0fe58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=fLl7D5PyohAHM3kyxXx8F%2BdD3gc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.generator;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.FastAutoGenerator;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.OutputFile;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DbColumnType;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;

<span class="hljs-keyword">import</span> java.sql.Types;
<span class="hljs-keyword">import</span> java.util.Collections;

<span class="hljs-comment">/**
 * MyBatis-Plusä»£ç ç”Ÿæˆå™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeGenerator</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æ•°æ®åº“é…ç½®</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/mp_db?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">"root"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456"</span>;

        <span class="hljs-comment">// ä»£ç ç”Ÿæˆå™¨é…ç½®</span>
        FastAutoGenerator.create(url, username, password)
            <span class="hljs-comment">// å…¨å±€é…ç½®</span>
            .globalConfig(builder -&gt; {
                builder.author(<span class="hljs-string">"Your Name"</span>)  <span class="hljs-comment">// ä½œè€…å</span>
                       .outputDir(System.getProperty(<span class="hljs-string">"user.dir"</span>) + <span class="hljs-string">"/src/main/java"</span>)  <span class="hljs-comment">// è¾“å‡ºç›®å½•</span>
                       .commentDate(<span class="hljs-string">"yyyy-MM-dd"</span>)  <span class="hljs-comment">// æ³¨é‡Šæ—¥æœŸ</span>
                       .enableSwagger()  <span class="hljs-comment">// å¼€å¯Swaggeræ¨¡å¼</span>
                       .fileOverride();  <span class="hljs-comment">// è¦†ç›–å·²ç”Ÿæˆçš„æ–‡ä»¶</span>
            })
            <span class="hljs-comment">// åŒ…é…ç½®</span>
            .packageConfig(builder -&gt; {
                builder.parent(<span class="hljs-string">"com.example.mp"</span>)  <span class="hljs-comment">// çˆ¶åŒ…å</span>
                       .moduleName(<span class="hljs-string">"system"</span>)  <span class="hljs-comment">// æ¨¡å—å</span>
                       .entity(<span class="hljs-string">"entity"</span>)  <span class="hljs-comment">// EntityåŒ…å</span>
                       .mapper(<span class="hljs-string">"mapper"</span>)  <span class="hljs-comment">// MapperåŒ…å</span>
                       .service(<span class="hljs-string">"service"</span>)  <span class="hljs-comment">// ServiceåŒ…å</span>
                       .serviceImpl(<span class="hljs-string">"service.impl"</span>)  <span class="hljs-comment">// ServiceImplåŒ…å</span>
                       .controller(<span class="hljs-string">"controller"</span>)  <span class="hljs-comment">// ControlleråŒ…å</span>
                       .pathInfo(Collections.singletonMap(OutputFile.xml,
                           System.getProperty(<span class="hljs-string">"user.dir"</span>) + <span class="hljs-string">"/src/main/resources/mapper"</span>));  <span class="hljs-comment">// Mapper XMLè·¯å¾„</span>
            })
            <span class="hljs-comment">// ç­–ç•¥é…ç½®</span>
            .strategyConfig(builder -&gt; {
                builder.addInclude(<span class="hljs-string">"sys_user"</span>, <span class="hljs-string">"sys_role"</span>, <span class="hljs-string">"sys_user_role"</span>)  <span class="hljs-comment">// è®¾ç½®è¦ç”Ÿæˆçš„è¡¨å</span>
                       .addTablePrefix(<span class="hljs-string">"sys_"</span>)  <span class="hljs-comment">// è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€</span>

                       <span class="hljs-comment">// Entityç­–ç•¥é…ç½®</span>
                       .entityBuilder()
                       .enableLombok()  <span class="hljs-comment">// å¼€å¯Lombok</span>
                       .enableTableFieldAnnotation()  <span class="hljs-comment">// å¼€å¯å­—æ®µæ³¨è§£</span>
                       .logicDeleteColumnName(<span class="hljs-string">"deleted"</span>)  <span class="hljs-comment">// é€»è¾‘åˆ é™¤å­—æ®µå</span>
                       .versionColumnName(<span class="hljs-string">"version"</span>)  <span class="hljs-comment">// ä¹è§‚é”å­—æ®µå</span>
                       .formatFileName(<span class="hljs-string">"%s"</span>);  <span class="hljs-comment">// Entityæ–‡ä»¶å‘½åæ ¼å¼</span>

                <span class="hljs-comment">// Controllerç­–ç•¥é…ç½®</span>
                .controllerBuilder()
                       .enableRestStyle()  <span class="hljs-comment">// å¼€å¯@RestController</span>
                       .formatFileName(<span class="hljs-string">"%sController"</span>);  <span class="hljs-comment">// Controlleræ–‡ä»¶å‘½åæ ¼å¼</span>

                <span class="hljs-comment">// Serviceç­–ç•¥é…ç½®</span>
                .serviceBuilder()
                       .formatServiceFileName(<span class="hljs-string">"I%sService"</span>)  <span class="hljs-comment">// Serviceæ¥å£æ–‡ä»¶å‘½åæ ¼å¼</span>
                       .formatServiceImplFileName(<span class="hljs-string">"%sServiceImpl"</span>);  <span class="hljs-comment">// ServiceImplæ–‡ä»¶å‘½åæ ¼å¼</span>

                <span class="hljs-comment">// Mapperç­–ç•¥é…ç½®</span>
                .mapperBuilder()
                       .enableMapperAnnotation()  <span class="hljs-comment">// å¼€å¯@Mapperæ³¨è§£</span>
                       .formatMapperFileName(<span class="hljs-string">"%sMapper"</span>)  <span class="hljs-comment">// Mapperæ¥å£æ–‡ä»¶å‘½åæ ¼å¼</span>
                       .formatXmlFileName(<span class="hljs-string">"%sMapper"</span>);  <span class="hljs-comment">// Mapper XMLæ–‡ä»¶å‘½åæ ¼å¼</span>
            })
            <span class="hljs-comment">// æ¨¡æ¿å¼•æ“é…ç½®ï¼ˆä½¿ç”¨Freemarkerï¼‰</span>
            .templateEngine(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FreememarkerTemplateEngine</span>())
            .execute();
    }
}
</code></pre>
<h3 data-id="heading-26">6.2 å¤šç§Ÿæˆ·æ’ä»¶</h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">mp</span>.<span class="hljs-property">config</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">baomidou</span>.<span class="hljs-property">mybatisplus</span>.<span class="hljs-property">extension</span>.<span class="hljs-property">plugins</span>.<span class="hljs-property">MybatisPlusInterceptor</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">baomidou</span>.<span class="hljs-property">mybatisplus</span>.<span class="hljs-property">extension</span>.<span class="hljs-property">plugins</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">TenantLineInnerInterceptor</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;

<span class="hljs-comment">/**
 * å¤šç§Ÿæˆ·é…ç½®
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TenantConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MybatisPlusInterceptor</span> <span class="hljs-title function_">mybatisPlusInterceptor</span>(<span class="hljs-params">TenantLineHandler tenantLineHandler</span>) {
        <span class="hljs-title class_">MybatisPlusInterceptor</span> interceptor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();

        <span class="hljs-comment">// å¤šç§Ÿæˆ·æ’ä»¶</span>
        <span class="hljs-title class_">TenantLineInnerInterceptor</span> tenantInterceptor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TenantLineInnerInterceptor</span>();
        tenantInterceptor.<span class="hljs-title function_">setTenantLineHandler</span>(tenantLineHandler);

        interceptor.<span class="hljs-title function_">addInnerInterceptor</span>(tenantInterceptor);

        <span class="hljs-keyword">return</span> interceptor;
    }
}

package com.<span class="hljs-property">example</span>.<span class="hljs-property">mp</span>.<span class="hljs-property">handler</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">baomidou</span>.<span class="hljs-property">mybatisplus</span>.<span class="hljs-property">extension</span>.<span class="hljs-property">plugins</span>.<span class="hljs-property">handler</span>.<span class="hljs-property">TenantLineHandler</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">sf</span>.<span class="hljs-property">jsqlparser</span>.<span class="hljs-property">expression</span>.<span class="hljs-property">Expression</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">sf</span>.<span class="hljs-property">jsqlparser</span>.<span class="hljs-property">expression</span>.<span class="hljs-property">LongValue</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-comment">/**
 * å¤šç§Ÿæˆ·å¤„ç†å™¨
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTenantLineHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TenantLineHandler</span> {

    <span class="hljs-comment">/**
     * è·å–å½“å‰ç§Ÿæˆ·ID
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Expression</span> <span class="hljs-title function_">getTenantId</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// ä»ThreadLocalæˆ–å…¶ä»–æ–¹å¼è·å–å½“å‰ç§Ÿæˆ·ID</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongValue</span>(<span class="hljs-title function_">getCurrentTenantId</span>());
    }

    <span class="hljs-comment">/**
     * è·å–ç§Ÿæˆ·å­—æ®µå
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTenantIdColumn</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tenant_id"</span>;
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­æ˜¯å¦å¿½ç•¥è¯¥è¡¨ï¼ˆç³»ç»Ÿè¡¨ä¸éœ€è¦ç§Ÿæˆ·éš”ç¦»ï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">ignoreTable</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> tableName</span>) {
        <span class="hljs-comment">// å¿½ç•¥ç³»ç»Ÿè¡¨</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"sys_config"</span>.<span class="hljs-title function_">equals</span>(tableName) || <span class="hljs-string">"sys_dict"</span>.<span class="hljs-title function_">equals</span>(tableName);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> <span class="hljs-title function_">getCurrentTenantId</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­ä»ç™»å½•ä¸Šä¸‹æ–‡è·å–</span>
        <span class="hljs-keyword">return</span> 1L;
    }
}
</code></pre>
<h2 data-id="heading-27">ä¸ƒã€æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-28">7.1 æ‰¹é‡æ“ä½œä¼˜åŒ–</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mp.optimize;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * æ‰¹é‡æ“ä½œä¼˜åŒ–ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchOperationExample</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;

    <span class="hljs-comment">/**
     * åˆ†æ‰¹æ’å…¥å¤§é‡æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;Entity&gt; dataList)</span> {
        <span class="hljs-keyword">if</span> (dataList == <span class="hljs-literal">null</span> || dataList.isEmpty()) {
            <span class="hljs-keyword">return</span>;
        }

        List&lt;Entity&gt; batch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(BATCH_SIZE);
        <span class="hljs-keyword">for</span> (Entity entity : dataList) {
            batch.add(entity);

            <span class="hljs-keyword">if</span> (batch.size() &gt;= BATCH_SIZE) {
                <span class="hljs-comment">// æ‰§è¡Œæ‰¹é‡æ’å…¥</span>
                saveBatch(batch);
                batch.clear();
            }
        }

        <span class="hljs-comment">// æ’å…¥å‰©ä½™æ•°æ®</span>
        <span class="hljs-keyword">if</span> (!batch.isEmpty()) {
            saveBatch(batch);
        }
    }
}
</code></pre>
<h3 data-id="heading-29">7.2 æŸ¥è¯¢ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li><strong>é¿å…å…¨è¡¨æ‰«æ</strong>ï¼šå§‹ç»ˆä½¿ç”¨æ¡ä»¶æŸ¥è¯¢ï¼Œé™åˆ¶æŸ¥è¯¢èŒƒå›´</li>
<li><strong>åˆç†ä½¿ç”¨ç´¢å¼•</strong>ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•</li>
<li><strong>åˆ†é¡µæŸ¥è¯¢</strong>ï¼šå¤§æ•°æ®é‡æŸ¥è¯¢å¿…é¡»ä½¿ç”¨åˆ†é¡µ</li>
<li><strong>å­—æ®µé€‰æ‹©</strong>ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œé¿å…SELECT *</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šä½¿ç”¨æ‰¹é‡æ–¹æ³•ä»£æ›¿å¾ªç¯å•æ¡æ“ä½œ</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3914bce3383419f8e0b3ad42321c702~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769735378&amp;x-signature=oyc4SEdllEXRYjWlsmNmGYfaBgo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-30">å…«ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-31">8.1 é€»è¾‘åˆ é™¤é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>ï¼šæŸ¥è¯¢æ—¶è‡ªåŠ¨æ·»åŠ äº†deletedæ¡ä»¶ï¼Œå¯¼è‡´æŸäº›æŸ¥è¯¢ä¸ç¬¦åˆé¢„æœŸ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// å•ä¸ªæŸ¥è¯¢å¿½ç•¥é€»è¾‘åˆ é™¤</span>
<span class="hljs-variable">@Mapper</span>
public interface UserMapper extends BaseMapper&lt;User&gt; {
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT * FROM sys_user WHERE id = #{id}"</span>)
    User <span class="hljs-built_in">selectByIdIgnoreDeleted</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"id"</span>) Long id);
}

<span class="hljs-comment">// æˆ–ä½¿ç”¨åŸç”ŸSQL</span>
List&lt;User&gt; users = userMapper.<span class="hljs-built_in">selectList</span>(
    new QueryWrapper&lt;User&gt;().<span class="hljs-built_in">apply</span>(<span class="hljs-string">"deleted = 0 OR deleted = 1"</span>)
);
</code></pre>
<h3 data-id="heading-32">8.2 ä¹è§‚é”å¤±æ•ˆ</h3>
<p><strong>é—®é¢˜</strong>ï¼šæ›´æ–°æ—¶ç‰ˆæœ¬å·æ²¡æœ‰è‡ªåŠ¨å¢åŠ </p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> ç¡®ä¿å®ä½“ç±»æœ‰<span class="hljs-variable">@Version</span>æ³¨è§£
<span class="hljs-variable">@Version</span>
private <span class="hljs-type">Integer</span> version;

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> ä½¿ç”¨updateByIdæ–¹æ³•ï¼Œä¸è¦ä½¿ç”¨<span class="hljs-keyword">update</span>æ–¹æ³•
<span class="hljs-type">boolean</span> success <span class="hljs-operator">=</span> userService.updateById(<span class="hljs-keyword">user</span>);
</code></pre>
<h3 data-id="heading-33">8.3 ä¸»é”®å›å¡«é—®é¢˜</h3>
<p><strong>é—®é¢˜</strong>ï¼šæ’å…¥åIDä¸ºnull</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ç¡®ä¿ä¸»é”®é…ç½®æ­£ç¡®</span>
<span class="hljs-variable">@TableId</span>(type = IdType.AUTO)  <span class="hljs-comment">// æ•°æ®åº“è‡ªå¢</span>
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-variable">@TableId</span>(type = IdType.ASSIGN_ID)  <span class="hljs-comment">// é›ªèŠ±ç®—æ³•</span>

<span class="hljs-comment">// ä½¿ç”¨å®ä½“æ’å…¥ï¼Œä¸è¦ä½¿ç”¨Wrapperæ’å…¥</span>
userService.<span class="hljs-built_in">save</span>(user);
</code></pre>
<h2 data-id="heading-34">ä¹ã€æ€»ç»“</h2>
<p>MyBatis-Plusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„MyBatiså¢å¼ºå·¥å…· åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨MyBatis-Plusæ—¶ï¼Œå»ºè®®ï¼š</p>
<ol>
<li>åˆç†ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œå‡å°‘é‡å¤å·¥ä½œ</li>
<li>ä¼˜å…ˆä½¿ç”¨Lambdaè¡¨è¾¾å¼æ„å»ºæ¡ä»¶ï¼Œé¿å…ç¡¬ç¼–ç </li>
<li>å……åˆ†åˆ©ç”¨æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½</li>
<li>æ³¨æ„äº‹åŠ¡ç®¡ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1åˆ†é’Ÿè½»æ¾ç©è½¬AI | æœ¬åœ°Dockerå®‰è£…Ollamaå¹¶ä½¿ç”¨deepseekå¤§æ¨¡å‹]]></title>    <link>https://juejin.cn/post/7598043378018975753</link>    <guid>https://juejin.cn/post/7598043378018975753</guid>    <pubDate>2026-01-23T03:18:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598043378018975753" data-draft-id="7598103558886342702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1åˆ†é’Ÿè½»æ¾ç©è½¬AI | æœ¬åœ°Dockerå®‰è£…Ollamaå¹¶ä½¿ç”¨deepseekå¤§æ¨¡å‹"/> <meta itemprop="keywords" content="åç«¯,Docker,DeepSeek"/> <meta itemprop="datePublished" content="2026-01-23T03:18:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Marsé…±"/> <meta itemprop="url" content="https://juejin.cn/user/1714893869821278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1åˆ†é’Ÿè½»æ¾ç©è½¬AI | æœ¬åœ°Dockerå®‰è£…Ollamaå¹¶ä½¿ç”¨deepseekå¤§æ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893869821278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Marsé…±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T03:18:25.000Z" title="Fri Jan 23 2026 03:18:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…ï¼šMarsé…±</p>
<p>å£°æ˜ï¼šæœ¬æ–‡ç« ç”±Marsé…±åŸåˆ›ï¼Œéƒ¨åˆ†å†…å®¹æ¥æºäºç½‘ç»œï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»æœ¬äººã€‚</p>
<p>è½¬è½½ï¼šæ¬¢è¿è½¬è½½ï¼Œè½¬è½½å‰å…ˆè¯·è”ç³»æˆ‘ï¼</p>
</blockquote>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™®åŠï¼Œè¶Šæ¥è¶Šå¤šå¼€å‘è€…å¸Œæœ›åœ¨æœ¬åœ°å¿«é€Ÿéƒ¨ç½²å’Œè°ƒç”¨å¼€æºæ¨¡å‹ã€‚Ollama æ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ˜“ç”¨çš„æœ¬åœ° LLM è¿è¡Œæ¡†æ¶ï¼Œæ”¯æŒå¤šç§ä¸»æµå¼€æºæ¨¡å‹ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡ Docker åœ¨æœ¬åœ°å®‰è£… Ollamaï¼Œå¹¶åŠ è½½ DeepSeek-R1:1.5B æ¨¡å‹ï¼ŒåŒæ—¶æä¾› Postman è°ƒç”¨ç¤ºä¾‹å’Œ Java è°ƒç”¨ä»£ç ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æœ¬åœ° Docker å®‰è£… Ollama</h2>
<h3 data-id="heading-1">1. å®‰è£… Docker</h3>
<p>ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£… Dockerã€‚å¦‚æœªå®‰è£…ï¼Œè¯·å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fget-docker%2F" target="_blank" title="https://docs.docker.com/get-docker/" ref="nofollow noopener noreferrer">Docker å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 data-id="heading-2">2. å¯åŠ¨ Ollama å®¹å™¨</h3>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Ollama çš„ Docker å®¹å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --gpus=all \                <span class="hljs-comment"># å¦‚æœ‰ NVIDIA GPU å¯å¯ç”¨ï¼ˆéœ€å®‰è£… nvidia-dockerï¼‰</span>
  -v ollama:/root/.ollama \
  -p 11434:11434 \
  --name ollama \
  ollama/ollama
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>-v ollama:/root/.ollama</code>ï¼šæŒä¹…åŒ–æ¨¡å‹æ•°æ®ã€‚</li>
<li><code>-p 11434:11434</code>ï¼šå°†å®¹å™¨å†… API ç«¯å£æ˜ å°„åˆ°ä¸»æœºã€‚</li>
<li>è‹¥æ—  GPUï¼Œå¯å»æ‰ <code>--gpus=all</code> å‚æ•°ã€‚</li>
</ul>
<h3 data-id="heading-3">3. æ‹‰å–å¹¶è¿è¡Œ DeepSeek-R1:1.5B æ¨¡å‹</h3>
<p>è¿›å…¥å®¹å™¨æ‰§è¡Œæ¨¡å‹æ‹‰å–å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it ollama ollama pull deepseek-r1:1.5b
</code></pre>
<p>æ³¨æ„ï¼šæˆªè‡³ 2026 å¹´åˆï¼ŒDeepSeek å®˜æ–¹å·²å°†éƒ¨åˆ†æ¨¡å‹é›†æˆè¿› Ollama ç”Ÿæ€ã€‚è‹¥ <code>deepseek-r1:1.5b</code> æœªåœ¨å®˜æ–¹åº“ä¸­ï¼Œè‡ªè¡ŒæŸ¥æ‰¾è¿™ä¸ªç‰ˆæœ¬çš„å¤§æ¨¡å‹ã€‚æˆ‘å®‰è£…å¾—æ—©ï¼Œè€Œä¸”ç¡¬ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå› æ­¤æ‹¿è¯¥æ¨¡å‹åšæµ‹è¯•ã€‚</p>
<p>å¯åŠ¨æ¨¡å‹ï¼ˆé¦–æ¬¡è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½ï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">docker exec -it ollama ollama run deepseek-r1:<span class="hljs-number">1.5b</span>
</code></pre>
<p>è¿è¡Œå®Œæ¯•ä¹‹åï¼Œä½¿ç”¨tagsè¯·æ±‚ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥æ­£å¸¸è°ƒç”¨ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š <code>http://localhost:11434/api/tags</code>, å¦‚æœçœ‹åˆ°è¿™æ ·çš„ç»“æœï¼Œè¯´æ˜å¯ä»¥æ­£å¸¸è®¿é—®äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cc028d8a7194d3ba8bda6611e57d822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769743105&amp;x-signature=ldaHW90A6NUpYSjf6kyIBNNc4gE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">äºŒã€Postman æ¥æ”¶ä¸€æ¬¡æ€§å®Œæ•´è°ƒç”¨ç¤ºä¾‹</h2>
<p>Ollama æä¾› RESTful APIï¼Œé»˜è®¤åœ°å€ä¸º <code>http://localhost:11434/api/generate</code>ï¼Œ è¯·æ±‚æ–¹å¼ï¼šPOSTï¼ŒBodyï¼ˆJSON æ ¼å¼ï¼‰ è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek-r1:1.5b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ å¥½"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><code>stream: false</code> è¡¨ç¤ºä¸€æ¬¡æ€§è¿”å›å®Œæ•´å“åº”ï¼›è®¾ä¸º <code>true</code> åˆ™ä¸ºæµå¼è¾“å‡ºï¼ˆéœ€å¤„ç† SSEï¼‰ã€‚</li>
<li>æˆåŠŸå“åº”å°†åŒ…å« <code>response</code> å­—æ®µã€‚</li>
</ul>
<p>ç­‰å¾…ä¸€ä¼šåï¼Œä½ ä¼šæ”¶åˆ°å“åº”ï¼Œå¤§è‡´æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek-r1:1.5b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;think&gt;\n\n&lt;/think&gt;\n\nä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®å¿™çš„å—ï¼Ÿæ— è®ºæ˜¯èŠå¤©ã€è§£ç­”é—®é¢˜è¿˜æ˜¯æä¾›å»ºè®®ï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œå“¦ï¼ğŸ˜Š"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"done"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  ...
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æˆªä¸ªå›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deedcc108e544844b96a1dca6e9adae0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769743105&amp;x-signature=bvr%2BHYBF6wIfivcJ3GOZH7nInzk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">ä¸‰ã€Postman è°ƒç”¨æ—¶æ¥æ”¶æµå¼å“åº”</h2>
<p>æˆªè‡³ Postman v10+ï¼Œ<strong>åŸç”Ÿä¸æ”¯æŒ SSE æµå¼å“åº”çš„è‡ªåŠ¨è§£æå’Œå±•ç¤º</strong>ã€‚å½“ä½ å‘é€ <code>stream: true</code> è¯·æ±‚æ—¶ï¼š</p>
<ul>
<li>Postman ä¼šâ€œå¡ä½â€ç­‰å¾…å“åº”å®Œæˆï¼ˆä½†å®é™…ä¸Šå“åº”æ˜¯æŒç»­ä¸æ–­çš„ï¼‰ï¼›</li>
<li>æœ€ç»ˆå¯èƒ½å› è¶…æ—¶å¤±è´¥ï¼Œæˆ–åœ¨è¿æ¥å…³é—­åä¸€æ¬¡æ€§æ˜¾ç¤ºæ‰€æœ‰ chunkï¼ˆéå®æ—¶ï¼‰ã€‚</li>
</ul>
<p>ä½ çœ‹åˆ°çš„å¯èƒ½æ˜¯è¿™æ ·çš„ç»“æœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5254b2b94fe4e0e88af239f15b1b450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769743105&amp;x-signature=QmHqhnOuSwbdr9BhGIrxX0tXfgg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">å››ã€Java æ¥æ”¶éæµå¼å“åº”</h2>
<p>ä»¥ä¸‹ä½¿ç”¨ Java 17 + RestTemplate å®ç°éæµå¼è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">conllectionChat</span><span class="hljs-params">()</span> {
	<span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"http://192.168.200.104:11434/api/chat"</span>;

	<span class="hljs-comment">// æ„å»ºè¯·æ±‚ä½“</span>
	Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
	requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-r1:1.5b"</span>); <span class="hljs-comment">// é»˜è®¤æ¨¡å‹ï¼Œå¯æ ¹æ®å®é™…å®‰è£…çš„æ¨¡å‹ä¿®æ”¹</span>
	requestBody.put(<span class="hljs-string">"stream"</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// éæµå¼æ¥æ”¶</span>

	Map&lt;String, String&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
	message.put(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>);
	message.put(<span class="hljs-string">"content"</span>, <span class="hljs-string">"ä½ å¥½"</span>);
	requestBody.put(<span class="hljs-string">"messages"</span>, List.of(message));

	<span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´</span>
	<span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
	headers.setContentType(org.springframework.http.MediaType.APPLICATION_JSON);

	HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);

	<span class="hljs-comment">// å‘é€ POST è¯·æ±‚</span>
	<span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
	<span class="hljs-keyword">try</span> {
		ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(url, request, String.class);

		<span class="hljs-comment">// æ‰“å°å“åº”</span>
		System.out.println(<span class="hljs-string">"çŠ¶æ€ç : "</span> + response.getStatusCode());
		System.out.println(<span class="hljs-string">"Ollama å“åº”:"</span>);
		System.out.println(response.getBody());

	} <span class="hljs-keyword">catch</span> (Exception e) {
		System.err.println(<span class="hljs-string">"è°ƒç”¨ Ollama å¤±è´¥: "</span> + e.getMessage());
		e.printStackTrace();
	}
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚éœ€è§£æ JSON å“åº”ï¼Œå¯å¼•å…¥ Jackson æˆ– Gson åº“æå– <code>response</code> å­—æ®µï¼Œä¸åˆ°1åˆ†é’Ÿï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2a11a8e809d47b78841360a24918c49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769743105&amp;x-signature=tIHUkNETOtcphaLmOIBMg6CQRd4%3D" alt="" loading="lazy"/></p>
<p>æ­å–œä½ è°ƒç”¨æˆåŠŸï¼é‚£æ˜¯å¦å¯ä»¥æ¥å—æµå¼å“åº”å‘¢ï¼Ÿæˆ‘ä»¬ç ”ç©¶ä¸‹</p>
<h2 data-id="heading-7">äº”ã€Java æ¥æ”¶æµå¼å“åº”ï¼ˆSSEï¼‰</h2>
<p>è¿™é‡Œä½¿ç”¨OkHttpçš„åº“å»ºç«‹äº†è¿æ¥å¹¶å¼€å§‹æ¥æ”¶æµå¼æ•°æ®ï¼Œåç»­é€šè¿‡ BufferedSource é€è¡Œè¯»å–å“åº”æµï¼Œå¹¶å°è£…åˆ°Flowableä¸­ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´çš„å•å…ƒæµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">streamChat</span><span class="hljs-params">()</span> {
	<span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"http://192.168.200.104:11434/api/chat"</span>;

	<span class="hljs-comment">// æ„å»ºè¯·æ±‚ä½“</span>
	Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
	requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-r1:1.5b"</span>);
	requestBody.put(<span class="hljs-string">"stream"</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// æµå¼æ¥æ”¶</span>

	Map&lt;String, String&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
	message.put(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>);
	message.put(<span class="hljs-string">"content"</span>, <span class="hljs-string">"ä½ å¥½"</span>);
	requestBody.put(<span class="hljs-string">"messages"</span>, List.of(message));

	<span class="hljs-comment">// åˆ›å»º OkHttp å®¢æˆ·ç«¯</span>
	<span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();

	<span class="hljs-comment">// åˆ›å»ºè¯·æ±‚</span>
	<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
	okhttp3.<span class="hljs-type">MediaType</span> <span class="hljs-variable">JSON</span> <span class="hljs-operator">=</span> okhttp3.MediaType.parse(<span class="hljs-string">"application/json; charset=utf-8"</span>);
	RequestBody body;
	<span class="hljs-keyword">try</span> {
		body = RequestBody.create(JSON, objectMapper.writeValueAsString(requestBody));
	} <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
		<span class="hljs-comment">//            return Flowable.error(e);</span>
		log.error(e.getMessage(), e);
		<span class="hljs-keyword">return</span>;
	}
	<span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
	.url(url)
	.post(body)
	.build();

	<span class="hljs-comment">// åˆ›å»º Flowable</span>
	Flowable&lt;String&gt; flowable = Flowable.create(emitter -&gt; {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.newCall(request).execute();
			<span class="hljs-keyword">if</span> (!response.isSuccessful()) {
				emitter.onError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"è¯·æ±‚å¤±è´¥: "</span> + response));
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-comment">// é€è¡Œè¯»å–æµå¼å“åº”</span>
			<span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> response.body().source()) {
				<span class="hljs-keyword">while</span> (!source.exhausted()) {
					<span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> source.readUtf8Line();
					<span class="hljs-keyword">if</span> (line != <span class="hljs-literal">null</span> &amp;&amp; !line.isEmpty()) {
						emitter.onNext(line);
					}
				}
				emitter.onComplete();
			}
		} <span class="hljs-keyword">catch</span> (Exception e) {
			emitter.onError(e);
		}
	}, BackpressureStrategy.BUFFER);

	<span class="hljs-comment">// è®¢é˜…å¹¶æ‰“å°æµå¼å“åº”</span>
	flowable.subscribe(
		data -&gt; System.out.print(<span class="hljs-string">"&gt;&gt;&gt; "</span> + data + <span class="hljs-string">"\n"</span>),
		error -&gt; System.err.println(<span class="hljs-string">"æµå¼è¯·æ±‚å¤±è´¥: "</span> + error.getMessage()),
		() -&gt; System.out.println(<span class="hljs-string">"\næµå¼è¯·æ±‚å®Œæˆ"</span>)
	);

}
</code></pre>
<ol>
<li><strong>æµå¼è¯»å–</strong>ï¼šä½¿ç”¨ <code>BufferedReader</code> é€è¡Œè¯»å– HTTP å“åº”ä½“ï¼›</li>
<li><strong>å®æ—¶è¾“å‡º</strong>ï¼šæ¯æ”¶åˆ°ä¸€ä¸ª token å°±ç«‹å³æ‰“å°ï¼Œå®ç°â€œæ‰“å­—æœºâ€æ•ˆæœï¼›</li>
<li><strong>ç»“æŸåˆ¤æ–­</strong>ï¼šå½“æŸè¡ŒåŒ…å« <code>"done_reason": stop</code> æ—¶ï¼Œè¡¨ç¤ºç”Ÿæˆç»“æŸã€‚</li>
</ol>
<p>å¾—åˆ°çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/525cdde9420f42b9b6256244e49b85de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFyc-mFsQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769743105&amp;x-signature=WQ3WCTcPpZzeTHjRGK6RsIApEw4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">å…­ã€è¿›é˜¶å»ºè®®</h2>
<ul>
<li>è‹¥éœ€é«˜æ€§èƒ½æˆ–å¤æ‚å¯¹è¯ç®¡ç†ï¼Œå¯å°è£…ä¸º <code>Flux&lt;String&gt;</code>ï¼ˆProject Reactorï¼‰æˆ–ä½¿ç”¨å¼‚æ­¥æµã€‚</li>
<li>æ³¨æ„å¼‚å¸¸å¤„ç†ï¼šç½‘ç»œä¸­æ–­ã€æ¨¡å‹å´©æºƒç­‰ä¼šå¯¼è‡´æµæå‰ç»ˆæ­¢ã€‚</li>
<li>Ollama çš„ SSE å“åº”<strong>æ¯è¡Œä»¥</strong> <code>\n</code> <strong>åˆ†éš”</strong>ï¼Œä¸”æ— é¢å¤– SSE æ ¼å¼ï¼ˆå¦‚ <code>data:</code> å‰ç¼€ï¼‰ï¼Œç›´æ¥æ˜¯çº¯ JSON è¡Œã€‚</li>
</ul>
<h2 data-id="heading-9">ä¸ƒã€å…¶ä»– API æ¥å£</h2>
<p>Ollama æä¾›ä¸°å¯Œçš„ APIï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>/api/chat</code>ï¼šå¯¹è¯æ¨¡å¼ï¼ˆæ”¯æŒå¤šè½®ä¸Šä¸‹æ–‡ï¼‰</li>
<li><code>/api/tags</code>ï¼šåˆ—å‡ºæœ¬åœ°æ‰€æœ‰æ¨¡å‹</li>
<li><code>/api/pull</code>ï¼šæ‹‰å–è¿œç¨‹æ¨¡å‹</li>
<li><code>/api/delete</code>ï¼šåˆ é™¤æ¨¡å‹</li>
<li><code>/api/show</code>ï¼šæŸ¥çœ‹æ¨¡å‹ä¿¡æ¯</li>
</ul>
<p>è¯¦ç»†æ¥å£æ–‡æ¡£è¯·å‚è€ƒå®˜æ–¹ GitHub ä»“åº“ï¼š<br/>
ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Follama%2Follama%2Fblob%2Fmain%2Fdocs%2Fapi.md" target="_blank" title="https://github.com/ollama/ollama/blob/main/docs/api.md" ref="nofollow noopener noreferrer">github.com/ollama/ollaâ€¦</a></p>
<p>å»ºè®®å¼€å‘è€…æ ¹æ®å®é™…éœ€æ±‚æŸ¥é˜…æœ€æ–°æ–‡æ¡£ï¼Œä»¥è·å–æœ€å‡†ç¡®çš„å‚æ•°è¯´æ˜å’ŒåŠŸèƒ½æ”¯æŒã€‚</p>
<h2 data-id="heading-10">ç»“è¯­</h2>
<p>é€šè¿‡ Docker éƒ¨ç½² Ollama å¹¶è°ƒç”¨ DeepSeek-R1:1.5B æ¨¡å‹ï¼Œæ—¢æ–¹ä¾¿åˆé«˜æ•ˆã€‚æ— è®ºä½ æ˜¯ç”¨ Postman å¿«é€Ÿæµ‹è¯•ï¼Œè¿˜æ˜¯é›†æˆåˆ° Java åº”ç”¨ä¸­ï¼ŒOllama çš„ç®€æ´ API éƒ½èƒ½æå¤§é™ä½æœ¬åœ° LLM ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯ä½ çš„æœºå™¨é…ç½®éœ€è¦è¶³å¤Ÿé«˜ï¼Œå¦‚æœæ²¡æœ‰GPUã€å°±ä½¿ç”¨å°½å¯èƒ½é«˜ç«¯çš„CPUï¼Œå› ä¸ºéœ€è¦å¼ºå¤§çš„ç®—åŠ›æ”¯æ’‘ã€‚</p>
<p>1.5B å‚æ•°æ¨¡å‹å¯¹ CPU ä¹Ÿèƒ½å‹å¥½è¿è¡Œï¼Œä½†å“åº”é€Ÿåº¦ä¸æ˜¾å­˜/GPU å¯†åˆ‡ç›¸å…³ã€‚å»ºè®®åœ¨ 16GB+ å†…å­˜ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<p>å½“ Ollama çš„ API è°ƒç”¨ä¸­è®¾ç½® <code>"stream": true</code> æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä»¥ <strong>Server-Sent Events (SSE)</strong> çš„å½¢å¼è¿”å›æ•°æ® â€”â€” å³é€å—ï¼ˆchunkï¼‰å‘é€ JSON å¯¹è±¡ï¼Œæ¯ä¸€å—ä»£è¡¨æ¨¡å‹ç”Ÿæˆçš„ä¸€ä¸ª token æˆ–ç‰‡æ®µã€‚å®¢æˆ·ç«¯éœ€è¦<strong>é€è¡Œè¯»å–å“åº”æµ</strong>å¹¶è§£ææ¯ä¸€è¡Œ JSONã€‚</p>
<p>å¥½äº†ï¼Œ1åˆ†é’Ÿç»“æŸäº†ï¼Œä¼°è®¡ä¹Ÿè¶…æ—¶äº†ï¼Œä¸‹æ¬¡å†èŠï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€é«˜æ–¯æ³¼æº…ã€‘è¿˜åœ¨é¾Ÿé€Ÿå»ºæ¨¡ï¼Ÿä¸‰æ­¥å®ç°è®­ç»ƒæé€Ÿä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7598118189142884352</link>    <guid>https://juejin.cn/post/7598118189142884352</guid>    <pubDate>2026-01-23T01:50:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598118189142884352" data-draft-id="7598021984300040219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€é«˜æ–¯æ³¼æº…ã€‘è¿˜åœ¨é¾Ÿé€Ÿå»ºæ¨¡ï¼Ÿä¸‰æ­¥å®ç°è®­ç»ƒæé€Ÿä¼˜åŒ–"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-23T01:50:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mapmost"/> <meta itemprop="url" content="https://juejin.cn/user/1679709496936343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€é«˜æ–¯æ³¼æº…ã€‘è¿˜åœ¨é¾Ÿé€Ÿå»ºæ¨¡ï¼Ÿä¸‰æ­¥å®ç°è®­ç»ƒæé€Ÿä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1679709496936343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mapmost
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T01:50:16.000Z" title="Fri Jan 23 2026 01:50:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€œç…§ç‰‡å˜æ¨¡å‹â€çš„é­”æ³•ï¼Œ<strong>3DGS</strong>å·²ç»åšå¾—è¶³å¤ŸæƒŠè‰³â€”â€”éšä¾¿æ‹¿æ‰‹æœºç»•ç‰©ä½“æ‹ä¸€åœˆï¼Œä¸€æ®µæ—¶é—´åå°±èƒ½æ‹–ç€ä¸€ä¸ª720Â°ä»»æ„çœ‹çš„é€¼çœŸæ¨¡å‹æ—‹è½¬ã€‚<br/>
ä½†ï¼é­”æ³•èƒŒåæœ‰ä¸ªå°å°´å°¬ï¼šè®­ç»ƒæ—¶é—´ã€‚åˆ«äººåˆ·ä¸¤é›†çŸ­å‰§ï¼Œå®ƒè¿˜åœ¨GPUé‡Œâ€œå­å“§å­å“§â€åœ°å¢åŠ ç‚¹ï¼Œä¼˜åŒ–ç‚¹ã€‚<strong>åœºæ™¯å¤§ä¸€ç‚¹ã€ç…§ç‰‡å¤šä¸€ç‚¹ï¼ŒåŠ¨è¾„å‡ ååˆ†é’Ÿç”šè‡³æ•°å°æ—¶</strong>ï¼Œåˆ›æ„çµæ„Ÿéƒ½è¢«â€œè¿›åº¦æ¡â€ç£¨å¹³äº†ã€‚</p>
<p>æœ¬æ–‡å°†æ¢è®¨3DGSåŠ é€Ÿå»ºæ¨¡çš„æ ¸å¿ƒé—®é¢˜ã€æŠ€æœ¯è·¯å¾„å’Œå·¥ç¨‹åŒ–å®è·µï¼Œè®©3DGSä»å»ºçš„å¥½èµ°å‘åˆå¥½åˆå¿«ã€‚</p>
<h2 data-id="heading-0">3DGSåˆ°åº•æ…¢åœ¨å“ª?</h2>
<p>æƒ³è¦çŸ¥é“3DGSæ…¢åœ¨å“ªé‡Œï¼Œè®©æˆ‘ä»¬äº†è§£ä¸‹3DGSçš„ä¸»è¦æµç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36f958a99d17412e88b9deb4d7fd79f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=Qx7xzkcVR3f3R6hYiokuKkk2hoQ%3D" alt="" loading="lazy"/></p>
<p><strong>ä¸»è¦æµç¨‹ï¼š</strong></p>
<ol>
<li>æœ‰ä¸€å †æœ‰ä¸€å †å›¾ç‰‡å’Œä¸€ä¸ªåˆå§‹çš„é«˜æ–¯æ¤­çƒé›†åˆï¼Œè¿™äº›éƒ½éœ€è¦æ‰”åˆ°æ˜¾å¡ä¸­ï¼›</li>
<li>éšæœºæŒ‘é€‰ä¸€å¼ å›¾ç‰‡ï¼Œ<strong>é€‰å–å›¾ç‰‡å¯ä»¥çœ‹åˆ°çš„æ¤­çƒ</strong>ï¼Œå†å°†<strong>æ¤­çƒæŠ•å½±</strong>åˆ°å›¾ç‰‡ä¸Šï¼›</li>
<li>æ¤­çƒè¿›è¡Œ<strong>å åŠ æ··åˆæ¥æ¨¡æ‹Ÿå›¾ç‰‡</strong>ï¼›</li>
<li>è®¡ç®—æ¨¡æ‹Ÿå›¾ç‰‡å’ŒçœŸå®å›¾ç‰‡çš„<strong>è¯¯å·®ï¼Œä¼˜åŒ–æ¤­çƒ</strong>ï¼›</li>
<li>æ ¹æ®éœ€è¦<strong>å¢åŠ å’Œåˆ é™¤æ¤­çƒ</strong>ã€‚</li>
</ol>
<p>ä¸»è¦æµç¨‹ä¸­åŸºæœ¬æ¯ä¸€æ­¥éƒ½æœ‰å‡ ä¸ªæ½œåœ¨æ‹–æ…¢è®­ç»ƒçš„ç¯èŠ‚ï¼Œæˆ‘ä»¬å¤§æ¦‚æŒ‡å‡ºå¯èƒ½æ‹–æ…¢æ¨¡å‹è®­ç»ƒçš„ç‚¹ï¼š</p>
<ul>
<li>**æ¤­çƒæ•°é‡è¿‡å¤šï¼š**æ¤­çƒæ•°é‡å¢åŠ ä¼šç›¸åº”çš„åŠ å¤§è®¡ç®—é‡</li>
<li>**æ— æ•ˆè®¡ç®—è¿‡å¤šï¼š**æ¤­çƒæŠ•å½±åæ¶‰åŠåƒç´ èŒƒå›´é€‰å–è¿‡å¤§</li>
<li>**å›¾ç‰‡åˆ†è¾¨ç‡å¤§ï¼š**å›¾ç‰‡åˆ†è¾¨ç‡è¶Šé«˜è®¡ç®—é‡è¶Šå¤§</li>
<li>**è¯¯å·®è®¡ç®—è¾ƒæ…¢ï¼š**Pytorchçš„SSIMè¯¯å·®è®¡ç®—æ…¢</li>
<li>**ä¼˜åŒ–æ¤­çƒè¾ƒæ…¢ï¼š**æ¢¯åº¦è®¡ç®—æ…¢å¯¼è‡´ä¼˜åŒ–æ…¢</li>
</ul>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œæƒ³è¦å¿«é€Ÿçš„å»ºæ¨¡éœ€è¦è·¨è¿‡çš„éš¾å…³è¿˜æ˜¯ä¸å°‘çš„ã€‚</p>
<h2 data-id="heading-1">è®­ç»ƒæé€Ÿçš„å‡ ç§æ‰‹æ®µ</h2>
<p>3DGSåŸå§‹è®ºæ–‡å‘å¸ƒå·²æœ‰2å¹´å¤šï¼ŒæœŸé—´æ¶Œç°äº†è®¸å¤šä¸“æ³¨åŠ é€Ÿçš„ç›¸å…³ç ”ç©¶ï¼Œå¦‚Turbo-GSã€Taming-GSã€FastGSç­‰å¤šç¯‡è®ºæ–‡ã€‚æ€»ç»“ä»–ä»¬ä¸»è¦çš„åŠ é€Ÿæ‰‹æ®µåï¼Œä¸»è¦æ˜¯æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ã€‚</p>
<h3 data-id="heading-2">01ç²¾ç¡®æ¤­çƒè¾¹ç•Œï¼Œå‡å°‘å†—ä½™è®¡ç®—</h3>
<p>ä¸€ä¸ªé«˜æ–¯æ¤­çƒæŠ•å½±åˆ°å›¾ç‰‡åï¼Œä¸ºäº†åç»­çš„æ¨¡æ‹Ÿå›¾ç‰‡ï¼Œéœ€è¦è®¡ç®—å‡ºå…¶å½±å“å¤šå°‘ä¸ªåƒç´ ã€‚</p>
<p>ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œ<strong>åŸå§‹3DGSç²—æš´çš„è®¡ç®—ä¸€ä¸ªå¤§çš„æ–¹å½¢åŒºåŸŸï¼Œå¯¼è‡´äº†åç»­è¾ƒå¤šçš„å†—ä½™è®¡ç®—</strong>ã€‚Speedy-Splatç­‰å¤šç¯‡è®ºæ–‡æå‡ºäº†ä¸åŒçš„<strong>ç²¾ç¡®è¾¹ç•Œè®¡ç®—</strong>æ–¹å¼ï¼Œå°½é‡å‡å°‘å¤šä½™çš„è®¡ç®—ã€‚</p>
<p>è®ºæ–‡ç»“è®ºå’Œæˆ‘ä»¬å®é™…æµ‹è¯•ç›¸ç¬¦ï¼Œ<strong>å¤§ä½“å¯ä»¥èŠ‚çº¦10%çš„è®­ç»ƒæ—¶é—´</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a64136f53e1475daf26ee05cb498a77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=KrRwAR9Zm5AvstxbA0%2B7SyKCbKc%3D" alt="" loading="lazy"/></p>
<p>é«˜æ–¯æ¤­çƒå½±å“çš„åƒç´ èŒƒå›´</p>
<h3 data-id="heading-3">02é€æ¤­çƒå¹¶è¡Œï¼ŒåŠ é€Ÿæ¢¯åº¦è®¡ç®—</h3>
<p>åŸå§‹è®ºæ–‡åœ¨æ‰‹å†™æ¢¯åº¦æ±‚å¯¼çš„è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦æ˜¯é€åƒç´ è®¡ç®—çš„ã€‚å³æ ¹æ®åƒç´ æ•°é‡åˆ†é…çº¿ç¨‹ï¼Œå¹¶è¡Œå¤„ç†æ¶‰åŠåˆ°çš„é«˜æ–¯æ¤­çƒã€‚</p>
<p>åŸå§‹ 3DGS çš„åå‘ä¼ æ’­ï¼ŒæŠŠçº¿ç¨‹è·Ÿåƒç´ ä¸€ä¸€ç»‘å®šï¼Œæ¯ä¸ªåƒç´ è¦æŠŠè‡ªå·±ç®—å‡ºçš„æ¢¯åº¦â€œå†™å›â€åˆ°å®ƒè¸©ä¸­çš„é‚£å‡ ä¸ªé«˜æ–¯çƒä¸Šã€‚<br/>
ä½†é«˜æ–¯çƒæ˜¯å…±äº«çš„â€”â€”<strong>å‡ åä¸Šç™¾ä¸ªåƒç´ å¯èƒ½åŒæ—¶æƒ³ç»™åŒä¸€åªçƒå†™æ•°æ®</strong>ã€‚<br/>
äºæ˜¯å¤§å®¶åªèƒ½<strong>åŸå­çº§æ’é˜Ÿ</strong>ï¼ˆatomic addï¼‰ï¼Œåƒæ—©é«˜å³°æŒ¤åœ°é“ï¼Œ<strong>äººè¶Šå¤šï¼Œé—¨è¶Šå°ï¼Œè¿›ç«™è¶Šæ…¢</strong>ã€‚</p>
<p>Taming-GSæå‡ºå¯ä»¥<strong>æŒ‰ç…§é«˜æ–¯æ¤­çƒæ¥åˆ†é…çº¿ç¨‹</strong>ï¼Œè¿™æ ·å°±<strong>è§„é¿äº†åŸå­çº§æ’é˜Ÿé—®é¢˜</strong>ï¼Œä»è€Œå¤§å¤§æå‡äº†è®­ç»ƒé€Ÿåº¦ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb934c2f61724b34b5426dd87ca8bcf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=3I68K%2F%2F9DsisTNKVH16OImUvL%2B0%3D" alt="" loading="lazy"/></p>
<p>Taming-GSæ¢¯åº¦è®¡ç®—ä¼˜åŒ–</p>
<h3 data-id="heading-4">03å¯è§†æ¤­çƒé€‰å–ï¼Œå‡å°‘æ— ç”¨æ›´æ–°</h3>
<p>æ·±åº¦å­¦ä¹ å¸¸ç”¨çš„ä¼˜åŒ–å™¨ä¼šæ›´æ–°æ‰€æœ‰çš„å‚æ•°ï¼Œä½†æ˜¯åœ¨3DGSä¸­å®é™…ä¸Šåªæœ‰éƒ¨åˆ†å½“å‰å›¾ç‰‡å¯ä»¥çœ‹åˆ°çš„é«˜æ–¯æ¤­çƒéœ€è¦æ›´æ–°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b13eae2bf793496ca9f751c86d1495f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=XJwD4Np%2FrHA%2Bnk1LMzyebY%2BzIKo%3D" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡é€šå¸¸åªçœ‹åˆ°éƒ¨åˆ†åœºæ™¯</p>
<p>é»˜è®¤çš„ä¼˜åŒ–å™¨ä¼šå°†æ²¡æœ‰è§åˆ°çš„æ¤­çƒä¹Ÿè¿›è¡Œå‚æ•°æ›´æ–°ï¼Œè¿™å°±å¯¼è‡´äº†è®­ç»ƒé€Ÿåº¦çš„æ˜æ˜¾é™ä½ã€‚</p>
<p>Taming-GSé‡å†™äº†Adamä¼˜åŒ–å™¨ï¼Œå°†å½“å‰éœ€è¦æ›´æ–°çš„é«˜æ–¯æ¤­çƒç´¢å¼•ä¼ å…¥ä¼˜åŒ–å™¨ï¼Œä»è€Œå¯ä»¥<strong>é€‰æ‹©æ€§çš„æ›´æ–°é‚£äº›å½“å‰å¯è§çš„é«˜æ–¯æ¤­çƒ</strong>ï¼Œæ˜æ˜¾åŠ å¿«äº†è®­ç»ƒé€Ÿåº¦ã€‚</p>
<h2 data-id="heading-5">MapmoståŠ é€Ÿå®è·µ</h2>
<p>Mapmostå·²ç»ç»¼åˆå¤šç§ä¸šç•Œæ–¹æ¡ˆä¸‹æå‡ºäº†<strong>Boost-GS</strong>æ–¹æ³•ï¼Œåœ¨ä¿è¯è´¨é‡çš„å‰æä¸‹èƒ½å¤Ÿå®ç°æ˜æ˜¾çš„åŠ é€Ÿæ•ˆæœã€‚å¸¸è§1600å›¾ç‰‡åˆ†è¾¨ç‡ä¸‹è‡³å¤šå¯ä»¥è¾¾åˆ°50%çš„åŠ é€Ÿæ•ˆæœï¼Œåœ¨5200å›¾ç‰‡åˆ†è¾¨ç‡ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°15%çš„é€Ÿåº¦æå‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d241bfb8cb74e68b4871faaa5440ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=Bfumm%2Ftj53GyhZBk0NeSKxWTlOI%3D" alt="" loading="lazy"/></p>
<p>NVIDIA 3090æ˜¾å¡è¿è¡Œç»“æœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae8b6c22f2234a659e80cab541fd9c9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=KWE71CXnbpr%2FSHDsMkjvjzPk9cw%3D" alt="" loading="lazy"/></p>
<p><strong>Mapmost 3DGS Builderå¹³å°</strong>å¼€æ”¾ä½“éªŒä¸­ï¼Œä¸Šä¼ å›¾ç‰‡ä½“éªŒä¸€é”®åŠ é€Ÿå»ºæ¨¡ï¼Œç»™ä½ ä¸€ä¸ªé«˜ç²¾æ¸…æ™°çš„ä¸‰ç»´æ¨¡å‹ã€‚</p>
<p>ç”³è¯·è¯•ç”¨ï¼Œè¯·è‡³<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mapmost.com%2F%23%2F" target="_blank" title="https://www.mapmost.com/#/" ref="nofollow noopener noreferrer">Mapmost</a>å®˜ç½‘è”ç³»å®¢æœ</p>
<p><strong>Mapmost 3DGS Builderåœ¨çº¿ä½“éªŒç‰ˆå·²ä¸Šçº¿~</strong></p>
<p><strong>æ¬¢è¿ä½“éªŒ:</strong> <a href="https://link.juejin.cn?target=studio.mapmost.com%2F3dgs" target="_blank" title="studio.mapmost.com/3dgs" ref="nofollow noopener noreferrer">studio.mapmost.com/3dgs</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/808bfe0ba35a4a7abd0dd057945ed306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFwbW9zdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737816&amp;x-signature=0EIfsro5TZ6vsoaxOdMLCC8T8zU%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker Compose + Nginx å®ç°é›¶åœæœºè“ç»¿éƒ¨ç½²ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§çº§å®è·µ]]></title>    <link>https://juejin.cn/post/7598083101362470918</link>    <guid>https://juejin.cn/post/7598083101362470918</guid>    <pubDate>2026-01-23T06:31:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598083101362470918" data-draft-id="7598099064444452927" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker Compose + Nginx å®ç°é›¶åœæœºè“ç»¿éƒ¨ç½²ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§çº§å®è·µ"/> <meta itemprop="keywords" content="Docker,Nginx"/> <meta itemprop="datePublished" content="2026-01-23T06:31:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker Compose + Nginx å®ç°é›¶åœæœºè“ç»¿éƒ¨ç½²ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§çº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T06:31:20.000Z" title="Fri Jan 23 2026 06:31:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å•æœº Docker ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•å®ç°åƒ Kubernetes é‚£æ ·çš„â€œæ»šåŠ¨æ›´æ–°â€æˆ–â€œè“ç»¿éƒ¨ç½²â€ï¼Ÿå¾ˆå¤šå¼€å‘è€…ä¹ æƒ¯äºç›´æ¥ <code>docker compose restart</code>ï¼Œä½†è¿™ä¼šå¯¼è‡´æœåŠ¡åœ¨é‡å¯æœŸé—´å‡ºç°çŸ­æš‚çš„ 502 é”™è¯¯ã€‚</p>
<p>æœ¬æ–‡å°†æ€»ç»“ä¸€å¥—åŸºäº <strong>Shell è„šæœ¬ + Docker Compose + Nginx</strong> çš„è½»é‡çº§è“ç»¿éƒ¨ç½²æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆé‡ç‚¹è§£å†³äº†ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>å¦‚ä½•å‡†ç¡®åˆ¤æ–­æ–°æœåŠ¡å·²å°±ç»ª</strong>ï¼Œä»¥åŠ<strong>å¦‚ä½•ä¼˜é›…åœ°å¤„ç†æ—§æœåŠ¡çš„å‰©ä½™æµé‡</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. æ¶æ„è®¾è®¡</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ <strong>è“ç»¿éƒ¨ç½² (Blue/Green Deployment)</strong> ç­–ç•¥ã€‚</p>
<ul>
<li><strong>çŠ¶æ€æ–‡ä»¶ (<code>AorB</code>)</strong> ï¼šè®°å½•å½“å‰åœ¨çº¿çš„æ˜¯ A ç¯å¢ƒè¿˜æ˜¯ B ç¯å¢ƒã€‚</li>
<li><strong>åŒå®¹å™¨æ§½ä½</strong>ï¼š<code>backend</code> (Blue) å’Œ <code>backend1</code> (Green)ã€‚</li>
<li><strong>Nginx è´Ÿè½½å‡è¡¡</strong>ï¼šé€šè¿‡åˆ‡æ¢ <code>upstream</code> é…ç½®æ–‡ä»¶å¹¶é‡è½½ (<code>reload</code>)ï¼Œå°†æµé‡ç¬é—´åˆ‡æ¢åˆ°æ–°å®¹å™¨ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. æ ¸å¿ƒæŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<p>åœ¨è„šæœ¬æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†ä»¥ä¸‹ä¸‰ä¸ªç”Ÿäº§çº§ç—›ç‚¹ï¼š</p>
<h3 data-id="heading-2">ç—›ç‚¹ä¸€ï¼šæœåŠ¡â€œå‡å¯åŠ¨â€å¯¼è‡´ 502</h3>
<p><strong>æ—§æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡ <code>grep "Worker ready"</code> æ£€æŸ¥æ—¥å¿—ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šå®¹å™¨å¯åŠ¨ä¸”æ‰“å°äº†æ—¥å¿—ï¼Œå¹¶ä¸ä»£è¡¨ Web Server å·²ç»ç»‘å®šç«¯å£å¹¶å‡†å¤‡å¥½æ¥æ”¶ TCP è¿æ¥ã€‚ä¸”æ—¥å¿—ç¼“å†²ä¼šå¯¼è‡´åˆ¤æ–­å»¶è¿Ÿã€‚</p>
<p><strong>æ–°æ–¹æ¡ˆï¼šä¸»åŠ¨ HTTP æ¢æµ‹ (Active Probing)</strong></p>
<p>æˆ‘ä»¬åœ¨è„šæœ¬ä¸­å¼•å…¥äº† <code>wait_for_health</code> å‡½æ•°ï¼Œé€šè¿‡ <code>curl</code> æŒç»­è¯·æ±‚åº”ç”¨çš„ <code>/api/user/me</code> æ¥å£ã€‚</p>
<ul>
<li><strong>åˆ¤å®šé€»è¾‘</strong>ï¼šåªè¦è¿”å› HTTP 200 æˆ– <strong>401 Unauthorized</strong>ï¼Œå³è§†ä¸ºæœåŠ¡å¯ç”¨ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆæ¥å— 401ï¼Ÿ</strong> ï¼š<code>/api/user/me</code> éœ€è¦ç™»å½•ã€‚å¦‚æœæˆ‘ä»¬æ”¶åˆ° 401 é”™è¯¯ï¼Œè¯´æ˜ Nginx/Gunicorn/Spring Boot ç­‰<strong>åº”ç”¨å±‚å·²ç»å®Œå…¨å¯åŠ¨å¹¶æ‹¦æˆªäº†è¯·æ±‚</strong>ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„â€œå¥åº·â€ä¿¡å·ã€‚</li>
</ul>
<h3 data-id="heading-3">ç—›ç‚¹äºŒï¼šæš´åŠ›åœæœºåˆ‡æ–­ç”¨æˆ·è¿æ¥</h3>
<p><strong>æ—§æ–¹æ¡ˆ</strong>ï¼šNginx reload åç«‹å³ <code>docker stop</code> æ—§å®¹å™¨ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šNginx çš„ reload æ˜¯å¼‚æ­¥çš„ï¼Œä¸”æ—§å®¹å™¨ä¸Šå¯èƒ½è¿˜æœ‰æ­£åœ¨å¤„ç†çš„é•¿è¿æ¥ï¼ˆå¦‚ä¸‹è½½ã€WebSocketï¼‰ã€‚ç›´æ¥åœæ­¢ä¼šå¯¼è‡´ç”¨æˆ·ç«¯è¿æ¥é‡ç½®ã€‚</p>
<p><strong>æ–°æ–¹æ¡ˆï¼šè¿æ¥è€—å°½ (Connection Draining)</strong></p>
<ol>
<li><strong>Nginx å±‚é¢</strong>ï¼šè®¾ç½® <code>worker_shutdown_timeout 60s;</code>ï¼Œç»™æ—§ Worker è¿›ç¨‹ 60 ç§’æ—¶é—´å¤„ç†å‰©ä½™è¯·æ±‚ã€‚</li>
<li><strong>è„šæœ¬å±‚é¢</strong>ï¼šå¼•å…¥ <code>wait_for_draining</code> å‡½æ•°ã€‚ä½¿ç”¨ Linux åŸç”Ÿå‘½ä»¤ <code>ss</code> (Socket Statistics) ç›‘æ§æŒ‡å‘æ—§å®¹å™¨ IP çš„ TCP è¿æ¥ã€‚åªæœ‰å½“è¿æ¥æ•°å½’é›¶æˆ–è¶…æ—¶ï¼Œæ‰æ‰§è¡Œåœæœºã€‚</li>
</ol>
<h3 data-id="heading-4">ç—›ç‚¹ä¸‰ï¼šNginx é…ç½®æŒ‡ä»¤ä½œç”¨åŸŸé”™è¯¯</h3>
<p><strong>é—®é¢˜</strong>ï¼š<code>worker_shutdown_timeout</code> è¢«é”™è¯¯æ”¾ç½®åœ¨ <code>http</code> å—ä¸­ã€‚</p>
<p><strong>ä¿®æ­£</strong>ï¼šè¯¥æŒ‡ä»¤å±äºå…¨å±€é…ç½®ï¼Œå¿…é¡»æ”¾åœ¨ <code>nginx.conf</code> çš„<strong>æœ€å¤–å±‚ (Main Context)</strong> ã€‚</p>
<hr/>
<h2 data-id="heading-5">3. æœ€ç»ˆå®æ–½æ–¹æ¡ˆ</h2>
<h3 data-id="heading-6">3.1 Nginx å…¨å±€é…ç½® (<code>nginx.conf</code>)</h3>
<p>Nginx</p>
<pre><code class="hljs language-ini" lang="ini">user  nginx<span class="hljs-comment">;</span>
worker_processes  auto<span class="hljs-comment">;</span>

<span class="hljs-comment"># ã€å…³é”®é…ç½®ã€‘æ”¾åœ¨æœ€å¤–å±‚ï¼Œæ§åˆ¶æ—§è¿›ç¨‹æœ€é•¿å­˜æ´»æ—¶é—´</span>
worker_shutdown_timeout 60s<span class="hljs-comment">;</span>

events {
    worker_connections  1024<span class="hljs-comment">;</span>
}

http {
    include       /etc/nginx/mime.types<span class="hljs-comment">;</span>
    include       /etc/nginx/conf.d/*.conf<span class="hljs-comment">;</span>
    <span class="hljs-comment"># ä½ çš„ upstream é…ç½®æ–‡ä»¶è¢«åŒ…å«åœ¨è¿™é‡Œ</span>
    include       /etc/nginx/upstream.conf<span class="hljs-comment">; </span>
}
</code></pre>
<h3 data-id="heading-7">3.2 è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ (<code>deploy.sh</code>)</h3>
<p>è¿™æ˜¯æ•´åˆäº†æ‰€æœ‰ä¼˜åŒ–é€»è¾‘çš„å®Œæ•´è„šæœ¬ï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># === é…ç½®åŒº ===</span>
ABFILE=nginx/AorB
CONTAINER_PORT=8000           <span class="hljs-comment"># å®¹å™¨å†…éƒ¨åº”ç”¨ç«¯å£</span>
HEALTH_PATH=<span class="hljs-string">"/api/user/me"</span>    <span class="hljs-comment"># å¥åº·æ£€æŸ¥æ¥å£</span>
MAX_RETRIES=30                <span class="hljs-comment"># å¥åº·æ£€æŸ¥æœ€å¤§é‡è¯•æ¬¡æ•°</span>
DRAIN_TIMEOUT=60              <span class="hljs-comment"># æµé‡è€—å°½æœ€å¤§ç­‰å¾…ç§’æ•°</span>
<span class="hljs-comment"># =============</span>

<span class="hljs-comment"># é¢œè‰²å®šä¹‰</span>
GREEN=<span class="hljs-string">'\033[0;32m'</span>
YELLOW=<span class="hljs-string">'\033[1;33m'</span>
RED=<span class="hljs-string">'\033[0;31m'</span>
NC=<span class="hljs-string">'\033[0m'</span>

<span class="hljs-comment"># åˆå§‹åŒ–çŠ¶æ€æ–‡ä»¶</span>
<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$ABFILE</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"A"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$ABFILE</span>"</span>; <span class="hljs-keyword">fi</span>
AorB=$(<span class="hljs-built_in">cat</span> <span class="hljs-variable">${ABFILE}</span>)

<span class="hljs-comment"># è·å–å®¹å™¨å†…éƒ¨ IP</span>
<span class="hljs-function"><span class="hljs-title">get_container_ip</span></span>() {
  <span class="hljs-built_in">local</span> <span class="hljs-built_in">id</span>=$(docker compose ps -q <span class="hljs-variable">$1</span> 2&gt;/dev/null)
  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$id</span>"</span> ]; <span class="hljs-keyword">then</span>
    docker inspect -f <span class="hljs-string">'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'</span> <span class="hljs-variable">$id</span>
  <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 1. å¥åº·æ£€æŸ¥ï¼šç­‰å¾… API è¿”å›æœ‰æ•ˆå“åº” (åŒ…æ‹¬ 401)</span>
<span class="hljs-function"><span class="hljs-title">wait_for_health</span></span>() {
  <span class="hljs-built_in">local</span> service=<span class="hljs-variable">$1</span>
  <span class="hljs-built_in">local</span> count=0
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${YELLOW}</span>ğŸ” Checking health for <span class="hljs-variable">$service</span>...<span class="hljs-variable">${NC}</span>"</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$count</span> -lt <span class="hljs-variable">$MAX_RETRIES</span> ]; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">local</span> ip=$(get_container_ip <span class="hljs-variable">$service</span>)
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-comment"># è·å–å“åº”å†…å®¹</span>
      <span class="hljs-built_in">local</span> resp=$(curl -s --max-time 2 <span class="hljs-string">"http://<span class="hljs-variable">${ip}</span>:<span class="hljs-variable">${CONTAINER_PORT}</span><span class="hljs-variable">${HEALTH_PATH}</span>"</span>)
      <span class="hljs-comment"># åªè¦åŒ…å« Unauthorizedï¼Œè¯´æ˜æœåŠ¡æ´»ç€</span>
      <span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$resp</span>"</span> | grep -q <span class="hljs-string">"Unauthorized"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${GREEN}</span>âœ… <span class="hljs-variable">$service</span> is READY!<span class="hljs-variable">${NC}</span>"</span>
        <span class="hljs-built_in">return</span> 0
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">sleep</span> 2
    count=$((count + <span class="hljs-number">1</span>))
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${RED}</span>âŒ Health check failed for $service<span class="hljs-variable">${NC}</span>"</span>; <span class="hljs-built_in">return</span> 1
}

<span class="hljs-comment"># 2. æµé‡è€—å°½ï¼šç­‰å¾…æ—§è¿æ¥æ–­å¼€</span>
<span class="hljs-function"><span class="hljs-title">wait_for_draining</span></span>() {
  <span class="hljs-built_in">local</span> service=<span class="hljs-variable">$1</span>
  <span class="hljs-built_in">local</span> count=0
  <span class="hljs-built_in">local</span> ip=$(get_container_ip <span class="hljs-variable">$service</span>)

  [ -z <span class="hljs-string">"<span class="hljs-variable">$ip</span>"</span> ] &amp;&amp; <span class="hljs-built_in">return</span> 0
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${YELLOW}</span>ğŸ›‘ Draining connections for <span class="hljs-variable">$service</span> (<span class="hljs-variable">$ip</span>)...<span class="hljs-variable">${NC}</span>"</span>

  <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$count</span> -lt <span class="hljs-variable">$DRAIN_TIMEOUT</span> ]; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># æ£€æŸ¥ç›®æ ‡ä¸ºæ—§å®¹å™¨ IP çš„ ESTABLISHED è¿æ¥</span>
    <span class="hljs-built_in">local</span> conn=$(ss -tn state established dst <span class="hljs-variable">$ip</span> | grep -v Recv-Q | <span class="hljs-built_in">wc</span> -l)
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$conn</span>"</span> -eq <span class="hljs-string">"0"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${GREEN}</span>âœ… No active connections. Safe to stop.<span class="hljs-variable">${NC}</span>"</span>
      <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   Active connections: <span class="hljs-variable">$conn</span>. Waiting..."</span>
    <span class="hljs-built_in">sleep</span> 1
    count=$((count + <span class="hljs-number">1</span>))
  <span class="hljs-keyword">done</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${RED}</span>âš ï¸ Timeout! Force stopping.<span class="hljs-variable">${NC}</span>"</span>
}

<span class="hljs-comment"># 3. å¯åŠ¨å¹¶åˆ‡æ¢</span>
<span class="hljs-function"><span class="hljs-title">deploy</span></span>() {
  <span class="hljs-built_in">local</span> new=<span class="hljs-variable">$1</span>
  <span class="hljs-built_in">local</span> old=<span class="hljs-variable">$2</span>
  <span class="hljs-built_in">local</span> <span class="hljs-built_in">env</span>=<span class="hljs-variable">$3</span>

  <span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Deploying <span class="hljs-variable">$new</span> (Replace <span class="hljs-variable">$old</span>) ==="</span>
  <span class="hljs-built_in">cp</span> envs/prod-common.env <span class="hljs-string">"<span class="hljs-variable">$env</span>"</span>
  
  <span class="hljs-comment"># A. å¯åŠ¨æ–°å®¹å™¨</span>
  docker compose build <span class="hljs-variable">$new</span>
  docker compose up -d <span class="hljs-variable">$new</span>
  
  <span class="hljs-comment"># B. å¥åº·æ£€æŸ¥</span>
  wait_for_health <span class="hljs-variable">$new</span> || <span class="hljs-built_in">exit</span> 1
  
  <span class="hljs-comment"># C. Nginx åˆ‡æ¢æµé‡</span>
  <span class="hljs-built_in">cp</span> nginx/<span class="hljs-variable">$new</span>.conf.tmpl nginx/upstream.conf
  sudo nginx -t &amp;&amp; sudo nginx -s reload
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${GREEN}</span>ğŸš€ Traffic switched to $new<span class="hljs-variable">${NC}</span>"</span>

  <span class="hljs-comment"># D. æ—§èŠ‚ç‚¹å¤„ç† (æµé‡è€—å°½ -&gt; åœæ­¢)</span>
  wait_for_draining <span class="hljs-variable">$old</span>
  docker compose stop <span class="hljs-variable">$old</span>
}

<span class="hljs-comment"># ä¸»æµç¨‹</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$AorB</span>"</span> == <span class="hljs-string">"A"</span> ]; <span class="hljs-keyword">then</span>
  deploy <span class="hljs-string">"backend"</span> <span class="hljs-string">"backend1"</span> <span class="hljs-string">"envs/prod.env"</span>
  <span class="hljs-built_in">echo</span> B &gt; <span class="hljs-variable">${ABFILE}</span>
<span class="hljs-keyword">else</span>
  deploy <span class="hljs-string">"backend1"</span> <span class="hljs-string">"backend"</span> <span class="hljs-string">"envs/prod1.env"</span>
  <span class="hljs-built_in">echo</span> A &gt; <span class="hljs-variable">${ABFILE}</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">4. æ€»ç»“</h2>
<p>è¿™å¥—è„šæœ¬å®ç°äº†ä¸€ä¸ªé—­ç¯çš„è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ï¼š</p>
<ol>
<li><strong>Start</strong>: å¯åŠ¨æ–°å®¹å™¨ã€‚</li>
<li><strong>Verify</strong>: é€šè¿‡ HTTP è¯­ä¹‰ï¼ˆ401 Unauthorizedï¼‰ç¡®è®¤ä¸šåŠ¡é€»è¾‘å·²åŠ è½½ã€‚</li>
<li><strong>Switch</strong>: Nginx çƒ­åŠ è½½ï¼Œæµé‡åˆ‡æ¢ã€‚</li>
<li><strong>Drain</strong>: ç›‘æ§ TCP è¿æ¥ï¼Œç­‰å¾…æ—§è¯·æ±‚å¤„ç†å®Œæ¯•ã€‚</li>
<li><strong>Stop</strong>: å®‰å…¨å…³é—­æ—§å®¹å™¨ã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ¡ˆä¸éœ€è¦å¤æ‚çš„ Kubernetes è¿ç»´çŸ¥è¯†ï¼Œéå¸¸é€‚åˆä¸­å°è§„æ¨¡çš„ Docker Compose éƒ¨ç½²åœºæ™¯ï¼Œèƒ½æ˜¾è‘—æå‡å‘å¸ƒçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Playwright è¿›é˜¶æ¨¡å¼ï¼šåˆ©ç”¨ Promise.all å®ç°æµè§ˆå™¨å†…é«˜å¹¶å‘]]></title>    <link>https://juejin.cn/post/7598104596779679790</link>    <guid>https://juejin.cn/post/7598104596779679790</guid>    <pubDate>2026-01-23T03:35:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598104596779679790" data-draft-id="7598104596779352110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Playwright è¿›é˜¶æ¨¡å¼ï¼šåˆ©ç”¨ Promise.all å®ç°æµè§ˆå™¨å†…é«˜å¹¶å‘"/> <meta itemprop="keywords" content="Python,çˆ¬è™«"/> <meta itemprop="datePublished" content="2026-01-23T03:35:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…ƒYäº¨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Playwright è¿›é˜¶æ¨¡å¼ï¼šåˆ©ç”¨ Promise.all å®ç°æµè§ˆå™¨å†…é«˜å¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…ƒYäº¨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T03:35:27.000Z" title="Fri Jan 23 2026 03:35:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">Playwright è¿›é˜¶æ¨¡å¼ï¼šåˆ©ç”¨ <code>Promise.all</code> å®ç°æµè§ˆå™¨å†…é«˜å¹¶å‘</h2>
<p>åœ¨å¤æ‚çš„çˆ¬è™«å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸é‡åˆ°ä¸¤éš¾å›°å¢ƒï¼š</p>
<ol>
<li><strong>Python å¾ªç¯ (<code>for</code> loop)</strong>ï¼šç¨³å®šï¼Œèƒ½è‡ªåŠ¨ç»§æ‰¿é¡µé¢çš„ Cookie å’Œ Sessionï¼Œä½†é€Ÿåº¦æ…¢ï¼ˆä¸²è¡Œé˜»å¡ï¼‰ã€‚</li>
<li><strong>Python å¤šçº¿ç¨‹ (<code>requests/aiohttp</code>)</strong>ï¼šé€Ÿåº¦å¿«ï¼Œä½†æ— æ³•ç»§æ‰¿æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼Œé‡åˆ° CSRF Tokenã€ç­¾åéªŒè¯æˆ–å¤æ‚ Header æ—¶ææ˜“å¤±æ•ˆï¼ˆæŠ¥ 400/403ï¼‰ã€‚</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> å°†å¹¶å‘çš„æ§åˆ¶æƒç§»äº¤ç»™æµè§ˆå™¨ã€‚é€šè¿‡æ³¨å…¥ JavaScript çš„ <code>Promise.all</code>ï¼Œåˆ©ç”¨æµè§ˆå™¨çš„éé˜»å¡ I/O èƒ½åŠ›å¹¶è¡Œå‘å‡ºè¯·æ±‚ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒä»£ç æ¨¡å¼</h3>
<h4 data-id="heading-2">1. é€šç”¨è°ƒåº¦å™¨ (The Scheduler)</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å·¥å…·å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥æ”¾å…¥ä½ çš„ <code>utils.py</code> ä¸­ã€‚å®ƒä¸åŒ…å«ä»»ä½•å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œåªè´Ÿè´£â€œåœ¨æµè§ˆå™¨é‡Œè·‘å¹¶å‘ä»»åŠ¡â€ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_browser_batch</span>(<span class="hljs-params">page, task_list</span>):
    <span class="hljs-string">"""
    é€šç”¨æµè§ˆå™¨å¹¶å‘è¯·æ±‚æ‰§è¡Œå™¨
    :param page: Playwright çš„ Page å¯¹è±¡
    :param task_list: ä»»åŠ¡åˆ—è¡¨ï¼Œå¿…é¡»åŒ…å« 'url' å­—æ®µï¼Œå¯åŒ…å«å…¶ä»–å…ƒæ•°æ®(id, typeç­‰)
    :return: åŒ…å«å“åº”ç»“æœå’ŒåŸå§‹å…ƒæ•°æ®çš„åˆ—è¡¨
    """</span>
    
    <span class="hljs-comment"># å®šä¹‰æ ¸å¿ƒ JS é€»è¾‘ï¼šæ¥æ”¶ä»»åŠ¡ -&gt; å¹¶å‘ Fetch -&gt; è¿”å›ç»“æœ</span>
    <span class="hljs-comment"># å…³é”®ç‚¹ï¼šåœ¨ map å†…éƒ¨æ•è·å¼‚å¸¸ï¼Œç¡®ä¿å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“</span>
    js_payload = <span class="hljs-string">"""
    async (tasks) =&gt; {
        const promises = tasks.map(async (task) =&gt; {
            const start = Date.now();
            try {
                // å‘èµ· Fetch è¯·æ±‚
                // æµè§ˆå™¨ä¼šè‡ªåŠ¨é™„å¸¦å½“å‰åŸŸåçš„ Cookieã€Referer å’Œ LocalStorage Token
                const response = await fetch(task.url, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                // ç»Ÿä¸€å¤„ç† HTTP é”™è¯¯çŠ¶æ€
                if (!response.ok) {
                    return {
                        status: 'failed',
                        meta: task, // å°†åŸå§‹ä»»åŠ¡ä¿¡æ¯å¸¦å›ï¼Œæ–¹ä¾¿ Python ç«¯åŒ¹é…
                        error: `HTTP ${response.status}: ${response.statusText}`
                    };
                }

                const data = await response.json();
                return {
                    status: 'success',
                    meta: task,
                    data: data,
                    latency: Date.now() - start
                };

            } catch (err) {
                // æ•è·ç½‘ç»œå±‚é¢çš„é”™è¯¯ï¼ˆå¦‚ DNS è§£æå¤±è´¥ã€è¶…æ—¶ï¼‰
                return {
                    status: 'error',
                    meta: task,
                    error: err.toString()
                };
            }
        });

        // ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ (Parallel Execution)
        return await Promise.all(promises);
    }
    """</span>

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å°† Python åˆ—è¡¨ä¼ é€’ç»™æµè§ˆå™¨æ‰§è¡Œ</span>
        <span class="hljs-keyword">return</span> page.evaluate(js_payload, task_list)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[System Error] JS æ³¨å…¥æ‰§è¡Œå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> []
</code></pre>
<hr/>
<h4 data-id="heading-3">2. ä¸šåŠ¡å®ç°ç¤ºä¾‹ï¼šåŠ å¯†è´§å¸ä»·æ ¼ç›‘æ§</h4>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä»æŸè´¢ç»ç½‘ç«™é‡‡é›† 50 ä¸ªåŠ å¯†è´§å¸çš„å®æ—¶è¯¦æƒ…ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoMarketScraper</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># æ¨¡æ‹Ÿå¾…é‡‡é›†çš„ç›®æ ‡ (ID å’Œ API åœ°å€)</span>
        self.targets = [
            {<span class="hljs-string">"id"</span>: <span class="hljs-string">"BTC"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"bitcoin"</span>, <span class="hljs-string">"api"</span>: <span class="hljs-string">"https://api.coincap.io/v2/assets/bitcoin"</span>},
            {<span class="hljs-string">"id"</span>: <span class="hljs-string">"ETH"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"ethereum"</span>, <span class="hljs-string">"api"</span>: <span class="hljs-string">"https://api.coincap.io/v2/assets/ethereum"</span>},
            {<span class="hljs-string">"id"</span>: <span class="hljs-string">"DOGE"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"dogecoin"</span>, <span class="hljs-string">"api"</span>: <span class="hljs-string">"https://api.coincap.io/v2/assets/dogecoin"</span>},
            <span class="hljs-comment"># ... å‡è®¾è¿™é‡Œè¿˜æœ‰ 50 ä¸ª ...</span>
        ]
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:
            <span class="hljs-comment"># å¯åŠ¨æµè§ˆå™¨</span>
            browser = p.chromium.launch(headless=<span class="hljs-literal">False</span>)
            context = browser.new_context()
            page = context.new_page()

            <span class="hljs-comment"># 1. é¢„åŠ è½½ï¼šå…ˆè®¿é—®ä¸»åŸŸï¼Œè·å–å¿…è¦çš„ Cookie/Session/Token</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ­£åœ¨åˆå§‹åŒ–ä¼šè¯..."</span>)
            page.goto(<span class="hljs-string">"https://coincap.io"</span>) 
            page.wait_for_timeout(<span class="hljs-number">2000</span>) <span class="hljs-comment"># ç­‰å¾…å„ç§ Token åˆå§‹åŒ–å®Œæˆ</span>

            <span class="hljs-comment"># 2. å¼€å§‹åˆ†æ‰¹é‡‡é›†</span>
            self.process_in_batches(page)

            browser.close()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_in_batches</span>(<span class="hljs-params">self, page</span>):
        BATCH_SIZE = <span class="hljs-number">5</span> <span class="hljs-comment"># å¹¶å‘æ§åˆ¶ï¼šæ¯æ‰¹ 5 ä¸ª</span>
        total = <span class="hljs-built_in">len</span>(self.targets)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼€å§‹ä»»åŠ¡ï¼Œå…± <span class="hljs-subst">{total}</span> ä¸ªç›®æ ‡..."</span>)

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total, BATCH_SIZE):
            <span class="hljs-comment"># A. å‡†å¤‡æ‰¹æ¬¡æ•°æ®</span>
            batch_data = self.targets[i : i + BATCH_SIZE]
            
            <span class="hljs-comment"># B. æ„é€ ä»»åŠ¡å¯¹è±¡ (Task Construction)</span>
            <span class="hljs-comment"># æˆ‘ä»¬å°† url å’Œ meta data æ‰“åŒ…åœ¨ä¸€èµ·</span>
            tasks = []
            <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> batch_data:
                tasks.append({
                    <span class="hljs-string">"url"</span>: item[<span class="hljs-string">'api'</span>],     <span class="hljs-comment"># JS éœ€è¦çš„ URL</span>
                    <span class="hljs-string">"asset_id"</span>: item[<span class="hljs-string">'id'</span>], <span class="hljs-comment"># ä¼ é€’ç»™ JSï¼Œæ–¹ä¾¿å®ƒåŸæ ·è¿”å›</span>
                    <span class="hljs-string">"name"</span>: item[<span class="hljs-string">'symbol'</span>]
                })

            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸš€ æ­£åœ¨å¹¶å‘è¯·æ±‚ç¬¬ <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> - <span class="hljs-subst">{<span class="hljs-built_in">min</span>(i+BATCH_SIZE, total)}</span> é¡¹..."</span>)

            <span class="hljs-comment"># C. è°ƒç”¨é€šç”¨è°ƒåº¦å™¨</span>
            results = execute_browser_batch(page, tasks)

            <span class="hljs-comment"># D. å¤„ç†ç»“æœ</span>
            <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> results:
                <span class="hljs-comment"># æå–å…ƒæ•°æ®</span>
                meta = res.get(<span class="hljs-string">'meta'</span>, {})
                name = meta.get(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Unknown'</span>)

                <span class="hljs-keyword">if</span> res[<span class="hljs-string">'status'</span>] == <span class="hljs-string">'success'</span>:
                    price = res[<span class="hljs-string">'data'</span>][<span class="hljs-string">'data'</span>][<span class="hljs-string">'priceUsd'</span>]
                    latency = res[<span class="hljs-string">'latency'</span>]
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   âœ… [<span class="hljs-subst">{name}</span>] ä»·æ ¼: $<span class="hljs-subst">{<span class="hljs-built_in">float</span>(price):<span class="hljs-number">.2</span>f}</span> (è€—æ—¶ <span class="hljs-subst">{latency}</span>ms)"</span>)
                    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> åœ¨è¿™é‡Œå†™å…¥æ•°æ®åº“</span>
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   âŒ [<span class="hljs-subst">{name}</span>] é‡‡é›†å¤±è´¥: <span class="hljs-subst">{res.get(<span class="hljs-string">'error'</span>)}</span>"</span>)

            <span class="hljs-comment"># E. æ‰¹æ¬¡é—´éšæœºä¼‘çœ  (æ¨¡æ‹Ÿäººç±»æµè§ˆè¡Œä¸º)</span>
            time.sleep(random.uniform(<span class="hljs-number">1.0</span>, <span class="hljs-number">2.5</span>))

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    spider = CryptoMarketScraper()
    spider.run()
</code></pre>
<hr/>
<h3 data-id="heading-4">ä¸ºä»€ä¹ˆè¦ç”¨è¿™ç§æ¨¡å¼ï¼Ÿ(æŠ€æœ¯æ€»ç»“)</h3>
<h4 data-id="heading-5">1. è§£å†³äº† "ä¸Šä¸‹æ–‡æ–­è£‚" é—®é¢˜</h4>
<p>ä½¿ç”¨ Python <code>requests</code> åº“æ—¶ï¼Œæœ€å¤§çš„ç—›ç‚¹æ˜¯<strong>å¤åˆ»æµè§ˆå™¨ç¯å¢ƒ</strong>ã€‚ä½ éœ€è¦æ‰‹åŠ¨æå– <code>Cookie</code>ï¼Œæ‰‹åŠ¨è®¡ç®— <code>Authorization</code> å¤´ï¼Œç”šè‡³è¦ç ´è§£ <code>_tb_token_</code> æˆ– <code>x-sign</code>ã€‚
è€Œåœ¨æœ¬æ¨¡å¼ä¸­ï¼Œ<code>fetch</code> æ˜¯åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ï¼Œ<strong>æµè§ˆå™¨è‡ªåŠ¨ä¸ºä½ é™„åŠ äº†æ‰€æœ‰è®¤è¯ä¿¡æ¯</strong>ã€‚åªè¦é¡µé¢æ˜¯ç™»å½•çŠ¶æ€ï¼Œæ¥å£è¯·æ±‚å°±æ˜¯ç™»å½•çŠ¶æ€ã€‚</p>
<h4 data-id="heading-6">2. æ€§èƒ½æå‡æ˜¾è‘—</h4>
<ul>
<li><strong>ä¸²è¡Œæ¨¡å¼</strong>ï¼šè¯·æ±‚ A (1s) -&gt; è¯·æ±‚ B (1s) -&gt; è¯·æ±‚ C (1s) = æ€»è€—æ—¶ 3sã€‚</li>
<li><strong>Promise.all æ¨¡å¼</strong>ï¼šè¯·æ±‚ A, B, C åŒæ—¶å‘å‡º -&gt; ç­‰å¾…æœ€æ…¢çš„ä¸€ä¸ªè¿”å› (1s) = æ€»è€—æ—¶ 1sã€‚</li>
<li><strong>æ•ˆç‡å¯¹æ¯”</strong>ï¼šé€šå¸¸èƒ½è·å¾— <strong>5~10 å€</strong> çš„é€Ÿåº¦æå‡ã€‚</li>
</ul>
<h4 data-id="heading-7">3. å…ƒæ•°æ®é€ä¼  (Metadata Passthrough)</h4>
<p>æ³¨æ„ä»£ç ä¸­çš„ <code>meta</code> å­—æ®µã€‚æˆ‘ä»¬åœ¨ Python ç«¯æŠŠ <code>{"id": "BTC"}</code> ä¼ ç»™ JSï¼ŒJS åœ¨è¿”å›ç»“æœæ—¶åŸæ ·å¸¦å›ã€‚
è¿™æ„å‘³ç€æˆ‘ä»¬<strong>ä¸éœ€è¦</strong>å»è§£æ URL æ¥åˆ¤æ–­è¿™ä¸ª JSON æ•°æ®å±äºå“ªä¸ªå•†å“æˆ– IDï¼Œç›´æ¥è¯» <code>meta</code> å³å¯ï¼Œé€»è¾‘éå¸¸æ¸…æ™°ã€‚</p>
<h4 data-id="heading-8">4. é²æ£’æ€§è®¾è®¡</h4>
<p>åœ¨ JS ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ª <code>map</code> å†…éƒ¨çš„ Promise éƒ½åšäº† <code>try...catch</code>ã€‚
å¦‚æœä¸è¿™æ ·åšï¼Œ<code>Promise.all</code> åªè¦é‡åˆ°ä¸€ä¸ªç½‘ç»œé”™è¯¯ï¼ˆæ¯”å¦‚å…¶ä¸­ä¸€ä¸ª API è¶…æ—¶ï¼‰ï¼Œæ•´ä¸ªæ‰¹æ¬¡çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼ˆFail Fast æœºåˆ¶ï¼‰ã€‚åŠ ä¸Š <code>try...catch</code> åï¼Œæˆ‘ä»¬å¯ä»¥å®ç°â€œéƒ¨åˆ†æˆåŠŸï¼Œéƒ¨åˆ†é‡è¯•â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SystemUI å¼€å‘ä¹‹æ˜¯é€šçŸ¥å®ä½“æ•°æ®æ˜¯å¦‚ä½•æµè½¬åˆ°è§†å›¾ä¸Šçš„ï¼ˆä¸ƒï¼‰]]></title>    <link>https://juejin.cn/post/7598104596780040238</link>    <guid>https://juejin.cn/post/7598104596780040238</guid>    <pubDate>2026-01-23T05:22:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598104596780040238" data-draft-id="7598251121496358938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SystemUI å¼€å‘ä¹‹æ˜¯é€šçŸ¥å®ä½“æ•°æ®æ˜¯å¦‚ä½•æµè½¬åˆ°è§†å›¾ä¸Šçš„ï¼ˆä¸ƒï¼‰"/> <meta itemprop="keywords" content="Android,æ¶æ„,Kotlin"/> <meta itemprop="datePublished" content="2026-01-23T05:22:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ„¤æ€’çš„ä»£ç "/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SystemUI å¼€å‘ä¹‹æ˜¯é€šçŸ¥å®ä½“æ•°æ®æ˜¯å¦‚ä½•æµè½¬åˆ°è§†å›¾ä¸Šçš„ï¼ˆä¸ƒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ„¤æ€’çš„ä»£ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T05:22:20.000Z" title="Fri Jan 23 2026 05:22:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¹‹å‰çš„<a href="https://juejin.cn/post/7597375708768190464%5D(https://juejin.cn/post/7597375708768190464)" target="_blank" title="https://juejin.cn/post/7597375708768190464%5D(https://juejin.cn/post/7597375708768190464)">ä¸€ç¯‡æ–‡ç« </a>ä¸­æˆ‘ä»¬äº†è§£åˆ° <code>SystemUI</code> ä¸­çš„é€šçŸ¥æ˜¯é€šè¿‡ç›‘å¬ <code>NotificationListenerServiceï¼ˆNLSï¼‰</code>è·å–åˆ°çš„ï¼Œé‚£é€šçŸ¥åˆæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥å˜æˆ <code>ExpandableNotificationRow</code> å¹¶æ·»åŠ åˆ°<code>NotificationStackScrollLayoutï¼ˆNSSLï¼‰</code> ä¸­å½¢æˆåˆ—è¡¨çš„å‘¢ï¼Ÿæœ¬æ–‡å°±è§£æä¸€ä¸‹é€šçŸ¥å®ä½“ä»æ•°æ®å±‚åˆ°è§†å›¾å±‚å·¥ä½œæœºåˆ¶ã€‚</p>
<blockquote>
<p>æœ¬æ–‡åŸºäº Android 11 æºç è¿›è¡Œåˆ†æï¼Œå…¶ä¸­æ¶‰åŠåˆ°æ ¸å¿ƒç±»å…³ç³»å¦‚ä¸‹</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    %% é€šçŸ¥ç›‘å¬å’Œå¤„ç†å™¨
    class NotificationListener {
        +onNotificationPosted()
        +onNotificationRemoved()
        +onNotificationRankingUpdate()
        -mNotificationHandlers : List~NotificationHandler~
    }
    
    class NotificationEntryManager {
        -mPendingNotifications : List~NotificationEntry~
        -mActiveNotifications : List~NotificationEntry~
        -mPresenter : NotificationPresenter
        -mRowBinder : NotificationRowBinderImpl
        +addNotification()
        +updateNotification()
        +getActiveNotifications()
    }
    
    class NotificationHandler {
        &lt;&lt;interface&gt;&gt;
        +onNotificationPosted()
        +onNotificationRemoved()
        +onNotificationRankingUpdate()
    }
    
    %% è§†å›¾ç»‘å®šå’Œå¸ƒå±€ç±»
    class NotificationRowBinderImpl {
        -mRowInflaterTask : RowInflaterTask
        -mViewHierarchyManager : NotificationViewHierarchyManager
        +inflateViews()
        -bindRow()
        -updateRow()
    }
    
    class RowInflaterTask {
        -mAsyncLayoutInflater : AsyncLayoutInflater
        +inflate()
    }
    
    class AsyncLayoutInflater {
        -mInflateThread : InflateThread
        -mHandler : Handler
        -mInflater : LayoutInflater
        +inflate()
    }
    
    %% è§†å›¾å’ŒPresenterç±»
    class ExpandableNotificationRow {
        -mEntry : NotificationEntry
        -mIsSummaryWithChildren : boolean
        -mIsHeadsUp : boolean
        +setEntry()
        +onNotificationUpdated()
    }
    
    class NotificationPresenter {
        &lt;&lt;interface&gt;&gt;
        +updateNotificationViews()
    }
    
    class NotificationViewHierarchyManager {
        -mListContainer : NotificationListContainer
        +updateNotificationViews()
    }
   
    
    class NotificationEntry {
        -mKey : String
        -mSbn : StatusBarNotification
        -mRow : ExpandableNotificationRow
    }
    
    %% æ–°å¢çš„NSSLç›¸å…³ç±»
    class NotificationListContainer {
        &lt;&lt;interface&gt;&gt;
        +addContainerView()
        +removeContainerView()
        +getContainerChildCount()
        +getContainerChildAt()
        +setChildTransferInProgress()
    }
    
    class NotificationStackScrollLayout {
        &lt;&lt;ViewGroup&gt;&gt;
        -mRows : List~ExpandableNotificationRow~
        +addContainerView()
        +generateChildOrderChangedEvent()
    }
    
    %% ç»§æ‰¿å’Œå®ç°å…³ç³»
    NotificationListener ..|&gt; NotificationHandler
    
    %% ç»„åˆ/å…³è”å…³ç³»
    NotificationListener --&gt; NotificationHandler : æŒæœ‰åˆ—è¡¨
    NotificationListener --&gt; NotificationEntryManager : å§”æ‰˜å¤„ç†
    
    NotificationEntryManager --&gt; NotificationPresenter : æŒæœ‰
    NotificationEntryManager --&gt; NotificationRowBinderImpl : æŒæœ‰
    NotificationEntryManager --&gt; NotificationEntry : ç®¡ç†åˆ—è¡¨
    
    NotificationEntry --&gt; ExpandableNotificationRow : å…³è”
    
    NotificationRowBinderImpl --&gt; RowInflaterTask : ä½¿ç”¨
    NotificationRowBinderImpl --&gt; AsyncLayoutInflater : ä½¿ç”¨
    NotificationRowBinderImpl --&gt; NotificationViewHierarchyManager : æŒæœ‰
    
    RowInflaterTask --&gt; AsyncLayoutInflater : ä½¿ç”¨
        
    %% å¼‚æ­¥å›è°ƒ
    AsyncLayoutInflater ..&gt; ExpandableNotificationRow : åˆ›å»ºå®ä¾‹
    
    %% è§†å›¾å±‚æ¬¡ç®¡ç† - é€šè¿‡æ¥å£æŒæœ‰
    NotificationViewHierarchyManager --&gt; NotificationListContainer : æŒæœ‰mListContainer
    
    %% NSSLå®ç°NotificationListContaineræ¥å£
    NotificationStackScrollLayout ..|&gt; NotificationListContainer
    
    %% NSSLç®¡ç†ExpandableNotificationRow
    NotificationStackScrollLayout --&gt; ExpandableNotificationRow : ç®¡ç†åˆ—è¡¨
    
    %% Presenterä¸è§†å›¾ç®¡ç†å™¨çš„äº¤äº’
    NotificationPresenter --&gt; NotificationViewHierarchyManager : æ›´æ–°è§†å›¾
    
    %% æ³¨é‡Šè¯´æ˜
    note for NotificationListener "æ¥æ”¶ç³»ç»Ÿé€šçŸ¥äº‹ä»¶ï¼Œè½¬å‘ç»™EntryManager"
    note for NotificationEntryManager "æ ¸å¿ƒç®¡ç†è€…ï¼Œåè°ƒPresenterã€Binderå’ŒViewManager"
    note for NotificationRowBinderImpl "è´Ÿè´£é€šçŸ¥è¡Œçš„ç»‘å®šå’Œå¼‚æ­¥å¸ƒå±€è†¨èƒ€"
    note for RowInflaterTask "å¼‚æ­¥å¸ƒå±€è†¨èƒ€ä»»åŠ¡ï¼Œé¿å…ä¸»çº¿ç¨‹å¡é¡¿"
    note for ExpandableNotificationRow "å•ä¸ªé€šçŸ¥çš„è§†å›¾è¡¨ç¤º"
    note for NotificationStackScrollLayout "é€šçŸ¥å †æ ˆæ»šåŠ¨å¸ƒå±€ï¼Œå®é™…ç®¡ç†é€šçŸ¥è¡Œçš„å®¹å™¨"
    note for NotificationListContainer "å®¹å™¨æ¥å£ï¼ŒæŠ½è±¡åŒ–é€šçŸ¥è¡Œçš„å®¹å™¨æ“ä½œ"
</code></pre>
<h2 data-id="heading-0">0x00 æ•°æ®æº</h2>
<p>é¦–å…ˆåœ¨åº”ç”¨å±‚é€šè¿‡<code>NotificationListener</code> è®¾ç½®ç›‘å¬ã€‚</p>
<p><code>NotificationListener.addNotificationHandler()</code> æ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** Registers a listener that's notified when notifications are added/removed/etc. */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addNotificationHandler</span><span class="hljs-params">(NotificationHandler handler)</span> {
    <span class="hljs-keyword">if</span> (mNotificationHandlers.contains(handler)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Listener is already added"</span>);
    }
    mNotificationHandlers.add(handler);
}
</code></pre>
<p><code>NotificationEntryManager</code> åœ¨åˆå§‹åŒ–æ—¶é€šè¿‡ attach æ–¹æ³•ç»‘å®šäº†ç›‘å¬</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** Once called, the NEM will start processing notification events from system server. */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(NotificationListener notificationListener)</span> {
    notificationListener.addNotificationHandler(mNotifListener);
}
</code></pre>
<p><code>NotificationHandler</code> è¿™é‡Œå®šä¹‰æ·»åŠ ã€æ›´æ–°å’Œç§»é™¤çš„ç›¸å…³å›è°ƒæ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">NotificationHandler</span> <span class="hljs-variable">mNotifListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NotificationHandler</span>() {
      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNotificationPosted</span><span class="hljs-params">(StatusBarNotification sbn, RankingMap rankingMap)</span> {
          <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isUpdateToInflatedNotif</span> <span class="hljs-operator">=</span> mActiveNotifications.containsKey(sbn.getKey());
          <span class="hljs-comment">// å½“å‰é€šçŸ¥åˆ—è¡¨ä¸­å·²å­˜åœ¨åˆ™è¿›è¡Œæ›´æ–°</span>
          <span class="hljs-keyword">if</span> (isUpdateToInflatedNotif) {
              updateNotification(sbn, rankingMap);
          } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// å¦åˆ™æ·»åŠ æ–°é€šçŸ¥</span>
              addNotification(sbn, rankingMap);
          }
      }

      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNotificationRemoved</span><span class="hljs-params">(StatusBarNotification sbn, RankingMap rankingMap)</span> {
          <span class="hljs-comment">// é€šçŸ¥ç§»é™¤</span>
          removeNotification(sbn.getKey(), rankingMap, UNDEFINED_DISMISS_REASON);
      }

      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNotificationRemoved</span><span class="hljs-params">(
              StatusBarNotification sbn,
              RankingMap rankingMap,
              <span class="hljs-type">int</span> reason)</span> {
          <span class="hljs-comment">// é€šçŸ¥ç§»é™¤</span>
          removeNotification(sbn.getKey(), rankingMap, reason);
      }

      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNotificationRankingUpdate</span><span class="hljs-params">(RankingMap rankingMap)</span> {
          <span class="hljs-comment">// æ›´æ–°é€šçŸ¥åˆ—è¡¨æ’åº</span>
          updateNotificationRanking(rankingMap);
      }

      ...
};
</code></pre>
<p>ä»¥ä¸€æ¡æ–°é€šçŸ¥ä¸ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addNotification</span><span class="hljs-params">(StatusBarNotification notification, RankingMap ranking)</span> {
    <span class="hljs-keyword">try</span> {
        addNotificationInternal(notification, ranking);
    } <span class="hljs-keyword">catch</span> (InflationException e) {
        handleInflationException(notification, e);
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addNotificationInternal</span><span class="hljs-params">(
            StatusBarNotification notification,
            RankingMap rankingMap)</span> <span class="hljs-keyword">throws</span> InflationException {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> notification.getKey();
    <span class="hljs-keyword">if</span> (DEBUG) {
        Log.d(TAG, <span class="hljs-string">"addNotification key="</span> + key);
    }
		<span class="hljs-comment">// æ›´æ–°æ’åºï¼šrankingMapæ˜¯å®Œæ•´çš„æ’åºä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²å­˜åœ¨çš„å’Œå³å°†æ·»åŠ çš„é€šçŸ¥</span>
    updateRankingAndSort(rankingMap, <span class="hljs-string">"addNotificationInternal"</span>);
		
    <span class="hljs-type">Ranking</span> <span class="hljs-variable">ranking</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ranking</span>();
    rankingMap.getRanking(key, ranking);

    <span class="hljs-type">NotificationEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> mPendingNotifications.get(key);
    <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) {
		    <span class="hljs-comment">// æƒ…å†µ1: Entryå·²å­˜åœ¨(æ­£åœ¨inflateä¸­ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œ</span>
		    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡é€šçŸ¥è¿‡æ¥æ˜¯å®ƒåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯å¾ˆå¿«é€šçŸ¥åˆè¢«æ›´æ–°äº†ï¼Œå°±ä¼šè¿›å…¥åˆ°è¿™ä¸ªåˆ†æ”¯)</span>
        entry.setSbn(notification);
    } <span class="hljs-keyword">else</span> {
		    <span class="hljs-comment">// æƒ…å†µ2: æ–°Entryï¼Œä½¿ç”¨NotificationEntryå¯¹sbnè¿›è¡Œå°è£…</span>
        entry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NotificationEntry</span>(
                notification,
                ranking,
                mFgsFeatureController.isForegroundServiceDismissalEnabled(),
                SystemClock.uptimeMillis());
        mAllNotifications.add(entry);
        <span class="hljs-comment">// å†…å­˜æ³„æ¼æ£€æµ‹!</span>
        mLeakDetector.trackInstance(entry);

        <span class="hljs-keyword">for</span> (NotifCollectionListener listener : mNotifCollectionListeners) {
            listener.onEntryInit(entry);
        }
    }

    <span class="hljs-keyword">for</span> (NotifCollectionListener listener : mNotifCollectionListeners) {
        listener.onEntryBind(entry, notification);
    }

    <span class="hljs-comment">// Construct the expanded view.</span>
    <span class="hljs-comment">// å¼€å§‹æ„å»ºå¯¹åº”çš„è§†å›¾ç»„ä»¶</span>
    <span class="hljs-keyword">if</span> (!mFeatureFlags.isNewNotifPipelineRenderingEnabled()) {
		    <span class="hljs-comment">// é€šè¿‡ Dagger æ³¨å…¥çš„ï¼Œå®é™…è·å–åˆ°çš„æ˜¯ NotificationRowBinderImpl </span>
        mNotificationRowBinderLazy.get()
                .inflateViews(
                        entry,
                        () -&gt; performRemoveNotification(notification, REASON_CANCEL),
                        mInflationCallback);
    }

    mPendingNotifications.put(key, entry);
    mLogger.logNotifAdded(entry.getKey());
    <span class="hljs-keyword">for</span> (NotificationEntryListener listener : mNotificationEntryListeners) {
        listener.onPendingEntryAdded(entry);
    }
    <span class="hljs-keyword">for</span> (NotifCollectionListener listener : mNotifCollectionListeners) {
        listener.onEntryAdded(entry);
    }
    <span class="hljs-keyword">for</span> (NotifCollectionListener listener : mNotifCollectionListeners) {
        listener.onRankingApplied();
    }
}
</code></pre>
<p><strong><code>RankingMap</code></strong></p>
<ul>
<li>NMSè®¡ç®—å¥½çš„æ’åºä¿¡æ¯</li>
</ul>
<p><strong><code>StatusBarNotificationï¼ˆSBNï¼‰</code></strong></p>
<ul>
<li>ä»NMSæ¥ä¼ é€’è¿‡æ¥çš„é€šçŸ¥æ•°æ®ï¼ˆ<code>Parcelable</code> å¯¹è±¡ï¼‰</li>
</ul>
<p><strong><code>NotificationEntry</code></strong></p>
<ul>
<li>å°è£…äº†<code>SBN</code>ï¼Œç”Ÿæˆå”¯ä¸€ Key</li>
<li>Key æ ¼å¼: <code>userId|pkg|id|tag|uid</code></li>
</ul>
<h2 data-id="heading-1">0x01 åˆ›å»ºè§†å›¾</h2>
<p>é€šè¿‡ <code>NotificationRowBinderImpl</code> åˆ›å»ºè§†å›¾ç»„ä»¶</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Inflates the views for the given entry (possibly asynchronously).
 */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inflateViews</span><span class="hljs-params">(
        NotificationEntry entry,
        Runnable onDismissRunnable,
        NotificationRowContentBinder.InflationCallback callback)</span>
        <span class="hljs-keyword">throws</span> InflationException {
    <span class="hljs-type">ViewGroup</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> mListContainer.getViewParentForNotification(entry);
		<span class="hljs-comment">// å¦‚æœé€šçŸ¥å­˜åœ¨ï¼Œè¿›è¡Œæ›´æ–°</span>
		<span class="hljs-comment">// è®¾æƒ³è¿™ä¸ªåœºæ™¯ï¼š</span>
		<span class="hljs-comment">// ç”¨æˆ·æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯é€šçŸ¥ï¼Œæ¥ç€å¾ˆå¿«åˆæ”¶åˆ°æ›´æ–°é€šçŸ¥ï¼Œå°±å¤ç”¨è¿™ä¸ªrow</span>
    <span class="hljs-keyword">if</span> (entry.rowExists()) {
        mIconManager.updateIcons(entry);
        <span class="hljs-type">ExpandableNotificationRow</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> entry.getRow();
        <span class="hljs-comment">// resetç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½ä»å¹²å‡€çŠ¶æ€å¼€å§‹</span>
        row.reset();
        <span class="hljs-comment">// æ›´æ–°ä¿¡æ¯</span>
        updateRow(entry, row);
        <span class="hljs-comment">// ç»‘å®š</span>
        inflateContentViews(entry, row, callback);
        entry.getRowController().setOnDismissRunnable(onDismissRunnable);
    } <span class="hljs-keyword">else</span> {
		    <span class="hljs-comment">// æ›´æ–°çŠ¶æ€æ ã€Sheftç­‰å›¾æ ‡</span>
        mIconManager.createIcons(entry);
        <span class="hljs-comment">// ä»Daggerä¸­è·å– RowInflaterTask å¹¶æ‰§è¡Œå¼‚æ­¥inflate</span>
        mRowInflaterTaskProvider.get().inflate(mContext, parent, entry,
                row -&gt; {
                    <span class="hljs-comment">// Setup the controller for the view.</span>
                    <span class="hljs-comment">// å¼‚æ­¥ç»“æœè¿”å›çš„ row å°±æ˜¯ ExpandableNotificationRow çš„é€šçŸ¥æ¡ç›®çš„è§†å›¾å®ä¾‹</span>
                    <span class="hljs-comment">// æŠŠ row entry ç­‰å®ä½“åˆäº¤ç»™ Dagger è¿›è¡Œç®¡ç†å¹¶åˆ›å»ºå¯¹åº”çš„æ§åˆ¶å™¨ Controller</span>
                    <span class="hljs-comment">// ä½ ä¼šå‘ç° SystemUI å¾ˆå¤šè§†å›¾éƒ½æœ‰å¯¹åº”çš„ Controller ç”¨äºè§£è€¦</span>
                    <span class="hljs-type">ExpandableNotificationRowComponent</span> <span class="hljs-variable">component</span> <span class="hljs-operator">=</span>
                            mExpandableNotificationRowComponentBuilder
                                    .expandableNotificationRow(row)
                                    .notificationEntry(entry)
                                    .onDismissRunnable(onDismissRunnable)
                                    .rowContentBindStage(mRowContentBindStage)
                                    .onExpandClickListener(mPresenter)
                                    .build();
                    <span class="hljs-comment">// ä½¿ç”¨ Controller å¯¹ ExpandableNotificationRow è¿›è¡Œæ“ä½œ</span>
                    <span class="hljs-type">ExpandableNotificationRowController</span> <span class="hljs-variable">rowController</span> <span class="hljs-operator">=</span>
                            component.getExpandableNotificationRowController();
                    rowController.init();
                    entry.setRowController(rowController);
                    bindRow(entry, row);
                    updateRow(entry, row);
                    <span class="hljs-comment">// inflate å®Œæˆå é€šè¿‡ callback å›è°ƒå›å»</span>
                    inflateContentViews(entry, row, callback);
                });
    }
}

<span class="hljs-comment">/**
 * Inflate the row's basic content views.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inflateContentViews</span><span class="hljs-params">(
        NotificationEntry entry,
        ExpandableNotificationRow row,
        <span class="hljs-meta">@Nullable</span> NotificationRowContentBinder.InflationCallback inflationCallback)</span> {
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯â€œé‡è¦â€é€šçŸ¥æ¶ˆæ¯</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">useIncreasedCollapsedHeight</span> <span class="hljs-operator">=</span>
            mMessagingUtil.isImportantMessaging(entry.getSbn(), entry.getImportance());
    <span class="hljs-comment">// If this is our first time inflating, we don't actually know the groupings for real</span>
    <span class="hljs-comment">// yet, so we might actually inflate a low priority content view incorrectly here and have</span>
    <span class="hljs-comment">// to correct it later in the pipeline. On subsequent inflations (i.e. updates), this</span>
    <span class="hljs-comment">// should inflate the correct view.</span>
    <span class="hljs-comment">// ä¸Šé¢çš„æ³¨é‡Šè¯´æ˜¯ç¬¬ä¸€æ¬¡inflateæ—¶å¯èƒ½ä¼šå‡ºé”™</span>
    <span class="hljs-comment">// æ—¶é—´çº¿</span>
		<span class="hljs-comment">// T1: é€šçŸ¥Aåˆ°è¾¾ (parentæœªçŸ¥,åˆ¤æ–­ä¸ºlowPriority)</span>
		<span class="hljs-comment">// T2: é€šçŸ¥Båˆ°è¾¾ (å‘ç°Aå’ŒBæ˜¯ä¸€ç»„)</span>
		<span class="hljs-comment">// T3: NotificationGroupManageré‡æ–°è®¡ç®—åˆ†ç»„</span>
		<span class="hljs-comment">// T4: Aå˜æˆåˆ†ç»„çš„summary (ä¸å†æ˜¯lowPriority!)</span>
		<span class="hljs-comment">// T5: é‡æ–°inflate Açš„ContentView â† çº æ­£é”™è¯¯</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isLowPriority</span> <span class="hljs-operator">=</span> mLowPriorityInflationHelper.shouldUseLowPriorityView(entry);
		<span class="hljs-comment">// ç¡®å®šå‚æ•°ï¼šä¼˜å…ˆçº§ã€é«˜åº¦ã€æ˜¯å¦é‡æ–°ç»‘å®šç­‰å‚æ•°</span>
    <span class="hljs-type">RowContentBindParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> mRowContentBindStage.getStageParams(entry);
    params.setUseIncreasedCollapsedHeight(useIncreasedCollapsedHeight);
    params.setUseLowPriority(isLowPriority);

    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Replace this API with RowContentBindParams directly. Also move to a separate</span>
    <span class="hljs-comment">// redaction controller.</span>
	  <span class="hljs-comment">// é”å±éšç§ï¼šä¾‹å¦‚å¾®ä¿¡èŠå¤©é€šçŸ¥åœ¨é”å±ä¸‹ä¸æ˜¾ç¤ºå†…å®¹åªæ˜¾ç¤ºæ¶ˆæ¯æ¡æ•°</span>
    row.setNeedsRedaction(mNotificationLockscreenUserManager.needsRedaction(entry));
		<span class="hljs-comment">// è¯·æ±‚é‡æ–°ç»‘å®š</span>
    params.rebindAllContentViews();
    mRowContentBindStage.requestRebind(entry, en -&gt; {
        row.setUsesIncreasedCollapsedHeight(useIncreasedCollapsedHeight);
        row.setIsLowPriority(isLowPriority);
        <span class="hljs-comment">// é€šè¿‡å›è°ƒæ¥å£é€šçŸ¥è§†å›¾æ„å»ºå®Œæˆ</span>
        <span class="hljs-keyword">if</span> (inflationCallback != <span class="hljs-literal">null</span>) {
            inflationCallback.onAsyncInflationFinished(en);
        }
    });
}
</code></pre>
<p>æ¥ç€ä½¿ç”¨<code>RowInflaterTask</code> è¿›è¡Œå¼‚æ­¥ <code>inflate</code> æ“ä½œï¼Œå®ƒä½¿ç”¨äº† <code>AsyncLayoutInflater</code> æ¥å£å¸®å®ƒå¹²æ´»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Inflates a new notificationView. This should not be called twice on this object
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inflate</span><span class="hljs-params">(Context context, ViewGroup parent, NotificationEntry entry,
        RowInflationFinishedListener listener)</span> {
    <span class="hljs-keyword">if</span> (TRACE_ORIGIN) {
        mInflateOrigin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Throwable</span>(<span class="hljs-string">"inflate requested here"</span>);
    }
    mListener = listener;
    <span class="hljs-type">AsyncLayoutInflater</span> <span class="hljs-variable">inflater</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncLayoutInflater</span>(context);
    mEntry = entry;
    entry.setInflationTask(<span class="hljs-built_in">this</span>);
    inflater.inflate(R.layout.status_bar_notification_row, parent, <span class="hljs-built_in">this</span>);
}
</code></pre>
<p><code>AsyncLayoutInflater</code> çš„å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—å’Œ<code>Handler</code>çš„ç»„åˆã€‚<code>inflate</code> çš„è€—æ—¶æ“ä½œæ˜¯åœ¨çº¿ç¨‹ä¸­ï¼Œç„¶åå°†è§£æå‡ºæ¥çš„ <code>View</code> é€šè¿‡ <code>Handler</code> å‘é€åˆ°ä¸»çº¿ç¨‹å¹¶å›è°ƒå‡ºå»ã€‚</p>
<p>è§†å›¾åˆ›å»ºå¥½ä¹‹å<strong>ç»‘å®šã€æ›´æ–°è§†å›¾</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// row ä¸ entry è¿›è¡Œç»‘å®š</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindRow</span><span class="hljs-params">(NotificationEntry entry, ExpandableNotificationRow row)</span> {
      mListContainer.bindRow(row);
      mNotificationRemoteInputManager.bindRow(row);
      row.setOnActivatedListener(mPresenter);
      entry.setRow(row);
      row.setEntry(entry);
      mNotifBindPipeline.manageRow(entry, row);
      mBindRowCallback.onBindRow(row);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateRow</span><span class="hljs-params">(
        NotificationEntry entry,
        ExpandableNotificationRow row)</span> {
    row.setLegacy(entry.targetSdk &gt;= Build.VERSION_CODES.GINGERBREAD
            &amp;&amp; entry.targetSdk &lt; Build.VERSION_CODES.LOLLIPOP);

    <span class="hljs-comment">// bind the click event to the content area</span>
    <span class="hljs-comment">// æ³¨å†Œäº†onClickäº‹ä»¶</span>
    requireNonNull(mNotificationClicker).register(row, entry.getSbn());
}
</code></pre>
<p>æœ€ååœ¨ <code>NotificationEntryManager</code> ä¸­çš„ <code>InflationCallback.onAsyncInflationFinished()</code> æ¥å—</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">InflationCallback</span> <span class="hljs-variable">mInflationCallback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InflationCallback</span>() {
        ...

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAsyncInflationFinished</span><span class="hljs-params">(NotificationEntry entry)</span> {
            mPendingNotifications.remove(entry.getKey());
            <span class="hljs-comment">// If there was an async task started after the removal, we don't want to add it back to</span>
            <span class="hljs-comment">// the list, otherwise we might get leaks.</span>
            <span class="hljs-keyword">if</span> (!entry.isRowRemoved()) {
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isNew</span> <span class="hljs-operator">=</span> getActiveNotificationUnfiltered(entry.getKey()) == <span class="hljs-literal">null</span>;
                mLogger.logNotifInflated(entry.getKey(), isNew);
                <span class="hljs-keyword">if</span> (isNew) {
		                <span class="hljs-comment">// åˆšå‘è¿‡æ¥çš„æ–°é€šçŸ¥</span>
                    <span class="hljs-keyword">for</span> (NotificationEntryListener listener : mNotificationEntryListeners) {
                        listener.onEntryInflated(entry);
                    }
                    <span class="hljs-comment">// å°†è§£æå¥½çš„ entry åŠ å…¥åˆ° NotificationEntryManager </span>
                    <span class="hljs-comment">// çš„å†…å­˜é›†åˆ mActiveNotifications ä¸­</span>
                    addActiveNotification(entry);
                    <span class="hljs-comment">// è¿™é‡Œä¼šè§¦å‘æ›´æ–°é€šçŸ¥</span>
                    updateNotifications(<span class="hljs-string">"onAsyncInflationFinished"</span>);
                    <span class="hljs-keyword">for</span> (NotificationEntryListener listener : mNotificationEntryListeners) {
                        listener.onNotificationAdded(entry);
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">for</span> (NotificationEntryListener listener : mNotificationEntryListeners) {
                        listener.onEntryReinflated(entry);
                    }
                }
            }
        }
    };
    
    <span class="hljs-comment">/**
     * Update the notifications
     * <span class="hljs-doctag">@param</span> reason why the notifications are updating
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotifications</span><span class="hljs-params">(String reason)</span> {
        reapplyFilterAndSort(reason);
        <span class="hljs-comment">// é‡è¦ï¼ï¼ï¼ä½¿ç”¨ NotificationPresenter æ›´æ–°é€šçŸ¥è§†å›¾</span>
        <span class="hljs-keyword">if</span> (mPresenter != <span class="hljs-literal">null</span> &amp;&amp; !mFeatureFlags.isNewNotifPipelineRenderingEnabled()) {
            mPresenter.updateNotificationViews(reason);
        }
    }
</code></pre>
<h2 data-id="heading-2">0x02 è§†å›¾æ¸²æŸ“</h2>
<p><code>NotificationPresenter</code> çš„å…·ä½“å®ç°ç±»æ˜¯ <code>StatusBarNotificationPresenter</code> åœ¨ <code>updateNotificationViews</code>æ–¹æ³•åˆ†åˆ«ä½¿ç”¨ <code>mViewHierarchyManager</code> å’Œ <code>mNotificationPanel</code> æ›´æ–°è§†å›¾</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotificationViews</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String reason)</span> {
    <span class="hljs-comment">// The function updateRowStates depends on both of these being non-null, so check them here.</span>
    <span class="hljs-comment">// We may be called before they are set from DeviceProvisionedController's callback.</span>
    <span class="hljs-keyword">if</span> (mScrimController == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// Do not modify the notifications during collapse.</span>
    <span class="hljs-keyword">if</span> (isCollapsing()) {
        mShadeController.addPostCollapseAction(() -&gt; updateNotificationViews(reason));
        <span class="hljs-keyword">return</span>;
    }
		<span class="hljs-comment">// æ ¹æ®æœ€æ–°çš„æ•°æ®åˆ—è¡¨ï¼ˆEntry Listï¼‰</span>
		<span class="hljs-comment">// è®© UI å®¹å™¨ï¼ˆNSSLï¼‰é‡Œçš„ View é¡ºåºã€å±‚çº§ã€æ˜¾ç¤ºçŠ¶æ€ä¸ä¹‹ä¸€è‡´</span>
    mViewHierarchyManager.updateNotificationViews();
		<span class="hljs-comment">// mNotificationPanel æ˜¯ NotificationPanelViewController</span>
		<span class="hljs-comment">// å®ƒæ˜¯ NSSL çš„è§†å›¾æ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ‰§è¡Œè§†å›¾çš„æ›´æ–°</span>
    mNotificationPanel.updateNotificationViews(reason);
}
</code></pre>
<p>è¿™é‡Œé‡ç‚¹çœ‹ä¸€ä¸‹ <code>NotificationViewHierarchyManager.updateNotificationViews()</code></p>
<p>è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æå…¶å¤æ‚ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯ï¼š<strong>æ ¹æ®æœ€æ–°çš„æ•°æ®åˆ—è¡¨ï¼ˆEntry Listï¼‰ï¼Œè®© UI å®¹å™¨ï¼ˆNSSLï¼‰é‡Œçš„ <code>View</code> é¡ºåºã€å±‚çº§ã€æ˜¾ç¤ºçŠ¶æ€ä¸ä¹‹ä¸€è‡´ã€‚</strong></p>
<p>æˆ‘ä»¬åˆ†å››ä¸ªé˜¶æ®µæ¥é€»è¾‘æ‹†è§£ï¼š</p>
<hr/>
<h3 data-id="heading-3">ç¬¬ä¸€é˜¶æ®µï¼šè§†å›¾çŠ¶æ€åˆ¤å®šä¸è¿‡æ»¤</h3>
<p>ä»£ç å¼€å§‹æ—¶ï¼Œéå† <code>activeNotifications</code>ï¼Œå¯¹æ¯ä¸€æ¡é€šçŸ¥è¿›è¡Œâ€œèº«ä»½å®¡æŸ¥â€ï¼š</p>
<ol>
<li><strong>è¿‡æ»¤éæ³•çŠ¶æ€</strong>ï¼šå¦‚æœé€šçŸ¥è¢«åˆ é™¤ï¼ˆ<code>Dismissed/Removed</code>ï¼‰ã€æ˜¯æ°”æ³¡é€šçŸ¥æˆ–å±äºå‰å°æœåŠ¡ç‰¹å®šéƒ¨åˆ†ï¼Œåˆ™è·³è¿‡ã€‚</li>
<li><strong>éšç§è„±æ•ï¼ˆRedactionï¼‰</strong>ï¼š
<ul>
<li>æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨é”å±çŠ¶æ€ï¼ˆPublic Modeï¼‰ã€‚</li>
<li>è°ƒç”¨ <code>mLockscreenUserManager</code> åˆ¤å®šè¯¥é€šçŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿå†…å®¹ã€‚</li>
<li>å¦‚æœéœ€è¦è„±æ•ï¼Œè°ƒç”¨ <code>ent.setSensitive(sensitive, ...)</code>ï¼Œè¿™ä¼šå¯¼è‡´é€šçŸ¥å†…å®¹å˜æˆâ€œéšè—å†…å®¹ï¼Œè§£é”åæŸ¥çœ‹â€ã€‚</li>
</ul>
</li>
<li><strong>åˆ†ç»„åˆ¤å®šï¼ˆGroupingï¼‰</strong>ï¼š
<ul>
<li>åˆ¤å®šè¯¥é€šçŸ¥æ˜¯â€œç‹¬ç«‹é€šçŸ¥â€è¿˜æ˜¯â€œç»„å†…å­é€šçŸ¥â€ã€‚</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotificationViews</span><span class="hljs-params">()</span> {
        ...
				<span class="hljs-comment">// è·å–å½“å‰å¯è§çš„é€šçŸ¥åˆ—è¡¨</span>
        List&lt;NotificationEntry&gt; activeNotifications = mEntryManager.getVisibleNotifications();
        <span class="hljs-comment">// å­˜æ”¾æ‰€æœ‰é¡¶å±‚é€šçŸ¥ï¼ˆTop-level Rowsï¼‰ï¼ŒåŒ…æ‹¬ç‹¬ç«‹é€šçŸ¥å’Œç»„çš„æ‘˜è¦ï¼ˆSummaryï¼‰</span>
        ArrayList&lt;ExpandableNotificationRow&gt; toShow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(activeNotifications.size());
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> activeNotifications.size();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; N; i++) {
            <span class="hljs-type">NotificationEntry</span> <span class="hljs-variable">ent</span> <span class="hljs-operator">=</span> activeNotifications.get(i);
            <span class="hljs-comment">// è¿‡æ»¤éæ³•çŠ¶æ€</span>
            <span class="hljs-keyword">if</span> (ent.isRowDismissed() || ent.isRowRemoved()
                    || mBubbleController.isBubbleNotificationSuppressedFromShade(ent)
                    || mFgsSectionController.hasEntry(ent)) {
                <span class="hljs-comment">// we don't want to update removed notifications because they could</span>
                <span class="hljs-comment">// temporarily become children if they were isolated before.</span>
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> ent.getSbn().getUserId();

            <span class="hljs-comment">// Display public version of the notification if we need to redact.</span>
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> This area uses a lot of calls into NotificationLockscreenUserManager.</span>
            <span class="hljs-comment">// We can probably move some of this code there.</span>
            <span class="hljs-comment">// æ˜¯å¦åœ¨é”å±çŠ¶æ€ï¼Œéœ€è¦å¯¹ç”¨æˆ·éšç§æ•°æ®è¿›è¡Œå¤„ç†</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">currentUserId</span> <span class="hljs-operator">=</span> mLockscreenUserManager.getCurrentUserId();
            <span class="hljs-type">boolean</span> <span class="hljs-variable">devicePublic</span> <span class="hljs-operator">=</span> mLockscreenUserManager.isLockscreenPublicMode(currentUserId);
            <span class="hljs-type">boolean</span> <span class="hljs-variable">userPublic</span> <span class="hljs-operator">=</span> devicePublic
                    || mLockscreenUserManager.isLockscreenPublicMode(userId);
            <span class="hljs-keyword">if</span> (userPublic &amp;&amp; mDynamicPrivacyController.isDynamicallyUnlocked()
                    &amp;&amp; (userId == currentUserId || userId == UserHandle.USER_ALL
                    || !mLockscreenUserManager.needsSeparateWorkChallenge(userId))) {
                userPublic = <span class="hljs-literal">false</span>;
            }
            <span class="hljs-comment">// ä¸‹é¢å¤„ç†æ˜¯å¦æ˜¯æ•æ„Ÿä¿¡æ¯</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">needsRedaction</span> <span class="hljs-operator">=</span> mLockscreenUserManager.needsRedaction(ent);
            <span class="hljs-type">boolean</span> <span class="hljs-variable">sensitive</span> <span class="hljs-operator">=</span> userPublic &amp;&amp; needsRedaction;
            <span class="hljs-type">boolean</span> <span class="hljs-variable">deviceSensitive</span> <span class="hljs-operator">=</span> devicePublic
                    &amp;&amp; !mLockscreenUserManager.userAllowsPrivateNotificationsInPublic(
                    currentUserId);
            ent.setSensitive(sensitive, deviceSensitive);
            ent.getRow().setNeedsRedaction(needsRedaction);
            mLowPriorityInflationHelper.recheckLowPriorityViewAndInflate(ent, ent.getRow());
            ...
            <span class="hljs-comment">// åˆ¤æ–­ é€šçŸ¥æ˜¯â€œç‹¬ç«‹é€šçŸ¥â€è¿˜æ˜¯â€œç»„å†…å­é€šçŸ¥â€</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isChildInGroup</span> <span class="hljs-operator">=</span> mGroupManager.isChildInGroupWithSummary(ent.getSbn());
						
            <span class="hljs-type">boolean</span> <span class="hljs-variable">groupChangesAllowed</span> <span class="hljs-operator">=</span>
                    mVisualStabilityManager.areGroupChangesAllowed() <span class="hljs-comment">// user isn't looking at notifs</span>
                    || !ent.hasFinishedInitialization(); <span class="hljs-comment">// notif recently added</span>

            <span class="hljs-type">NotificationEntry</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> mGroupManager.getGroupSummary(ent.getSbn());
            <span class="hljs-keyword">if</span> (!groupChangesAllowed) {
                <span class="hljs-comment">// We don't to change groups while the user is looking at them</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">wasChildInGroup</span> <span class="hljs-operator">=</span> ent.isChildInGroup();
                <span class="hljs-keyword">if</span> (isChildInGroup &amp;&amp; !wasChildInGroup) {
                    isChildInGroup = wasChildInGroup;
                    mVisualStabilityManager.addGroupChangesAllowedCallback(mEntryManager,
                            <span class="hljs-literal">false</span> <span class="hljs-comment">/* persistent */</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isChildInGroup &amp;&amp; wasChildInGroup) {
                    <span class="hljs-comment">// We allow grouping changes if the group was collapsed</span>
                    <span class="hljs-keyword">if</span> (mGroupManager.isLogicalGroupExpanded(ent.getSbn())) {
                        isChildInGroup = wasChildInGroup;
                        parent = ent.getRow().getNotificationParent().getEntry();
                        mVisualStabilityManager.addGroupChangesAllowedCallback(mEntryManager,
                                <span class="hljs-literal">false</span> <span class="hljs-comment">/* persistent */</span>);
                    }
                }
            }
            ...
    }
</code></pre>
<h3 data-id="heading-4">ç¬¬äºŒé˜¶æ®µï¼šæ„å»ºè§†å›¾åˆ—è¡¨</h3>
<p>ä»£ç ä½¿ç”¨ <code>toShow</code> åˆ—è¡¨å’Œ <code>mTmpChildOrderMap</code> æ¥æ„å»ºé€šçŸ¥åˆ—è¡¨ï¼š</p>
<ul>
<li><strong><code>toShow</code></strong>ï¼šå­˜æ”¾æ‰€æœ‰é¡¶å±‚é€šçŸ¥ï¼ŒåŒ…æ‹¬ç‹¬ç«‹é€šçŸ¥å’Œç»„çš„æ‘˜è¦ï¼ˆSummaryï¼‰ã€‚</li>
<li><strong><code>mTmpChildOrderMap</code></strong>ï¼šå»ºç«‹â€œçˆ¶é€šçŸ¥ -&gt; å­é€šçŸ¥åˆ—è¡¨â€çš„æ˜ å°„å…³ç³»ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotificationViews</span><span class="hljs-params">()</span> {
        ...
        <span class="hljs-keyword">if</span> (isChildInGroup) {
                List&lt;NotificationEntry&gt; orderedChildren = mTmpChildOrderMap.get(parent);
                <span class="hljs-keyword">if</span> (orderedChildren == <span class="hljs-literal">null</span>) {
                    orderedChildren = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
                    <span class="hljs-comment">// å»ºç«‹çˆ¶å­è§†å›¾å…³ç³»</span>
                    mTmpChildOrderMap.put(parent, orderedChildren);
                }
                orderedChildren.add(ent);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// Top-level notif (either a summary or single notification)</span>

                <span class="hljs-comment">// A child may have already added its summary to mTmpChildOrderMap with a</span>
                <span class="hljs-comment">// list of children. This can happen since there's no guarantee summaries are</span>
                <span class="hljs-comment">// sorted before its children.</span>
                <span class="hljs-keyword">if</span> (!mTmpChildOrderMap.containsKey(ent)) {
                    <span class="hljs-comment">// mTmpChildOrderMap's keyset is used to iterate through all entries, so it's</span>
                    <span class="hljs-comment">// necessary to add each top-level notif as a key</span>
                    mTmpChildOrderMap.put(ent, <span class="hljs-literal">null</span>);
                }
                <span class="hljs-comment">// æ·»åŠ åˆ°å¾…æ˜¾ç¤ºåˆ—è¡¨</span>
                toShow.add(ent.getRow());
            }
        ...
    }
</code></pre>
<h3 data-id="heading-5">ç¬¬ä¸‰é˜¶æ®µï¼šæ·»åŠ ã€ç§»é™¤</h3>
<p>è¿™æ˜¯æœ€ç¹å¿™çš„é˜¶æ®µï¼Œè´Ÿè´£æ‰§è¡ŒçœŸæ­£çš„ <code>addView</code> å’Œ <code>removeView</code>ã€‚</p>
<ol>
<li><strong>æ¸…ç†ä¸å†éœ€è¦çš„ View</strong>ï¼š
<ul>
<li>éå† <code>NSSL</code> ä¸­ç°æœ‰çš„å­è§†å›¾ï¼Œå¦‚æœå®ƒä¸åœ¨ <code>toShow</code> è“å›¾é‡Œï¼Œå°±è°ƒç”¨ <code>removeContainerView</code> å°†å…¶ç§»é™¤ã€‚</li>
</ul>
</li>
<li><strong>æ·»åŠ æ–° View</strong>ï¼š
<ul>
<li>éå† <code>toShow</code>ï¼Œå¦‚æœæŸä¸ª Row è¿˜æ²¡æœ‰ Parentï¼Œè°ƒç”¨ <code>mListContainer.addContainerView(v)</code> æ­£å¼å°†å…¶åŠ å…¥ <code>NSSL</code>ã€‚</li>
</ul>
</li>
<li><strong>å¤„ç†å­é€šçŸ¥å±‚çº§</strong>ï¼š
<ul>
<li>æ‰§è¡Œ <code>addNotificationChildrenAndSort()</code>ï¼Œå°†ç»„å†…æˆå‘˜æ”¾å…¥<code>ExpandableNotificationRow</code> å†…éƒ¨çš„å®¹å™¨ä¸­ã€‚</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotificationViews</span><span class="hljs-params">()</span> {
        ...
				<span class="hljs-comment">// æ¸…ç†ä¸å†éœ€è¦çš„ View</span>
        ArrayList&lt;ExpandableNotificationRow&gt; viewsToRemove = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// mListContainer å°±æ˜¯ NSSL</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt; mListContainer.getContainerChildCount(); i++) {
            <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> mListContainer.getContainerChildAt(i);
            <span class="hljs-keyword">if</span> (!toShow.contains(child) &amp;&amp; child <span class="hljs-keyword">instanceof</span> ExpandableNotificationRow) {
                <span class="hljs-type">ExpandableNotificationRow</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> (ExpandableNotificationRow) child;

                <span class="hljs-comment">// Blocking helper is effectively a detached view. Don't bother removing it from the</span>
                <span class="hljs-comment">// layout.</span>
                <span class="hljs-keyword">if</span> (!row.isBlockingHelperShowing()) {
		                <span class="hljs-comment">// æ”¶é›†å¾…åˆ é™¤çš„view</span>
                    viewsToRemove.add((ExpandableNotificationRow) child);
                }
            }
        }

        <span class="hljs-keyword">for</span> (ExpandableNotificationRow viewToRemove : viewsToRemove) {
            ...
            <span class="hljs-keyword">if</span> (viewToRemove.isSummaryWithChildren()) {
                viewToRemove.removeAllChildren();
            }
            <span class="hljs-comment">// åˆ é™¤view</span>
            mListContainer.removeContainerView(viewToRemove);
            mListContainer.setChildTransferInProgress(<span class="hljs-literal">false</span>);
        }

        removeNotificationChildren();
				<span class="hljs-comment">// éå† toShow æŒ‚è½½æ–° View</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; toShow.size(); i++) {
            <span class="hljs-type">View</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> toShow.get(i);
            <span class="hljs-keyword">if</span> (v.getParent() == <span class="hljs-literal">null</span>) {
		            <span class="hljs-comment">// è¿˜æ²¡æœ‰ Parent æ·»åŠ  åˆ° mListContainerï¼ˆNSSLï¼‰</span>
                mVisualStabilityManager.notifyViewAddition(v);
                <span class="hljs-comment">// é‡è¦ï¼ï¼ï¼ç»ˆäºæŠŠ row view æ·»åŠ åˆ° NSSL ä¸­æ¥äº†</span>
                mListContainer.addContainerView(v);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!mListContainer.containsView(v)) {
                <span class="hljs-comment">// the view is added somewhere else. Let's make sure</span>
                <span class="hljs-comment">// the ordering works properly below, by excluding these</span>
                toShow.remove(v);
                i--;
            }
        }
				...
    }
</code></pre>
<p>å…¶ä¸­ <code>mListContainer</code> å°±æ˜¯ <code>NotificationStackScrollLayoutï¼ˆNSSLï¼‰</code> é€šçŸ¥åˆ—è¡¨çš„å®¹å™¨ç»„ä»¶ã€‚æ‰§è¡Œ <code>addView</code> æ“ä½œåå°±ä¼šè§¦å‘ <code>requestLayout</code> æœ€ç»ˆç”± <code>NSSL</code> å®Œæˆåˆ—è¡¨çš„æ¸²æŸ“</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addContainerView</span><span class="hljs-params">(View v)</span> {
    Assert.isMainThread();
    addView(v);
}
</code></pre>
<h3 data-id="heading-6">ç¬¬å››é˜¶æ®µï¼šè°ƒæ•´æ”¶å°¾</h3>
<p>å³ä½¿ View éƒ½åŠ è¿›æ¥äº†ï¼Œé¡ºåºå¯èƒ½è¿˜æ˜¯é”™çš„ã€‚</p>
<ol>
<li><strong>åŒæŒ‡é’ˆåŒæ­¥æ’åº</strong>ï¼š
<ul>
<li>éå† <code>NSSL</code> çš„å­è§†å›¾å’Œ <code>toShow</code> è“å›¾ã€‚</li>
<li>å¦‚æœä½ç½®ä¸åŒ¹é…ï¼Œè°ƒç”¨ <code>mListContainer.changeViewPosition</code>ã€‚</li>
<li><strong>ç¨³å®šæ€§æ£€æŸ¥</strong>ï¼šå¦‚æœ <code>canReorderNotification</code> è¿”å› falseï¼ˆæ¯”å¦‚ç”¨æˆ·æ­£åœ¨è§¦æ‘¸ï¼‰ï¼Œæ’åºä¼šè¢«æ¨è¿Ÿï¼Œå¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒç­‰å¾…æ—¶æœºã€‚</li>
</ul>
</li>
<li><strong>çŠ¶æ€åˆ·æ–°</strong>ï¼š
<ul>
<li><code>onNotificationViewUpdateFinished()</code>ï¼šé€šçŸ¥ NSSL æ›´æ–°å·²ç»å®Œæˆã€‚</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNotificationViews</span><span class="hljs-params">()</span> {
        ...
        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
				<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mListContainer.getContainerChildCount(); i++) {
				    <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> mListContainer.getContainerChildAt(i);
				    <span class="hljs-comment">// ... è¿‡æ»¤éé€šçŸ¥ View ...</span>
				    
				    <span class="hljs-type">ExpandableNotificationRow</span> <span class="hljs-variable">targetChild</span> <span class="hljs-operator">=</span> toShow.get(j);
				    <span class="hljs-keyword">if</span> (child != targetChild) {
				        <span class="hljs-comment">// å‘ç°ä½ç½®å¯¹ä¸ä¸Šäº†ï¼</span>
				        <span class="hljs-keyword">if</span> (mVisualStabilityManager.canReorderNotification(targetChild)) {
				            <span class="hljs-comment">// å°† targetChild æŒªåˆ°å½“å‰çš„ç‰©ç†ç´¢å¼• i</span>
				            mListContainer.changeViewPosition(targetChild, i);
				        }
				    }
				    j++;
				}
				...
				mListContainer.onNotificationViewUpdateFinished();
				...
    }
</code></pre>
<p>æœ‰äººå¯èƒ½å¥½å¥‡ç†è®ºä¸Šç¬¬ä¸‰æ­¥çš„æ—¶å€™è¿™ä¸ªæ–¹æ³•åº”è¯¥ç»“æŸäº†ï¼Œä¸ºä½•è¿˜éœ€è¦ç¬¬å››æ­¥çš„é‡æ’æ“ä½œå‘¢ï¼Ÿ</p>
<p>åŸå› ï¼š</p>
<ul>
<li><code>addView</code> é»˜è®¤æ˜¯â€œæœ«å°¾è¿½åŠ â€
<ul>
<li>Android <code>ViewGroup</code> çš„ <code>addView(View v)</code> é»˜è®¤è¡Œä¸ºæ˜¯ï¼š<strong>æŠŠæ–°çš„å­ View æ”¾åˆ°æ‰€æœ‰å­ View çš„æœ€åé¢ï¼ˆIndex æœ€å¤§ï¼‰</strong></li>
<li>é€šçŸ¥æ çš„é€šçŸ¥æ˜¯æ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œæ’åºçš„ï¼Œä¼˜å…ˆçº§é«˜çš„æ’åœ¨å‰é¢</li>
</ul>
</li>
<li>UI æ ‘ index é¡ºåºå†³å®šäº†â€œç»˜åˆ¶é¡ºåºâ€å’Œâ€œé‡å å…³ç³»â€
<ol>
<li><strong>ç»˜åˆ¶é¡ºåº (Drawing Order)</strong>ï¼šIndex å°çš„å…ˆç”»ï¼ŒIndex å¤§çš„åç”»ã€‚</li>
<li><strong>é‡å /é®ç›– (Z-Order)</strong>ï¼šåœ¨é€šçŸ¥æŠ˜å ã€æŒ¤å‹åŠ¨ç”»ä¸­ï¼Œç”±äº NSSL å…è®¸é€šçŸ¥ä¹‹é—´æœ‰å¾®å°çš„é‡å ï¼ŒIndex è¾ƒå¤§çš„ View ä¼šé®ç›–åœ¨ Index è¾ƒå°çš„ View ä¹‹ä¸Šã€‚</li>
</ol>
</li>
</ul>
<p>å¦‚æœä¸è¿›è¡Œç²¾ç»†çš„ <code>changeViewPosition</code> è°ƒæ•´ï¼Œå½“é€šçŸ¥å‘ç”Ÿä½ç§»æˆ–é‡å åŠ¨ç”»æ—¶ï¼Œä¼šå‡ºç°â€œåº•éƒ¨çš„é€šçŸ¥æŒ¡ä½äº†é¡¶éƒ¨çš„é€šçŸ¥â€è¿™ç§ä¸¥é‡çš„è§†è§‰é—®é¢˜ã€‚</p>
<h2 data-id="heading-7">0x03 æ€»ä½“æµç¨‹æ€»ç»“</h2>
<p>å¯ä»¥æŠŠæ•´ä¸ªè·¯å¾„ç®€åŒ–æˆä¸‹é¢è¿™æ¡é“¾ï¼š</p>
<ol>
<li>
<p><strong>NLS å›è°ƒ</strong>ï¼š</p>
<p><code>NotificationListener</code> æ”¶åˆ°é€šçŸ¥ â†’ <code>NotificationEntryManager</code> é€šè¿‡ <code>NotificationHandler</code> å¤„ç†æ–°å¢/æ›´æ–°/åˆ é™¤ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®å°è£…å’Œæ’åº</strong>ï¼š</p>
<p>ç”¨ <code>StatusBarNotification + RankingMap</code> æ„é€  <code>NotificationEntry</code>ï¼Œç»´æŠ¤å„ç§é›†åˆï¼Œå¹¶å†³å®šé€šçŸ¥åœ¨é€»è¾‘ä¸Šçš„é¡ºåºã€‚</p>
</li>
<li>
<p><strong>è§†å›¾åˆ›å»ºå’Œå†…å®¹ç»‘å®š</strong>ï¼š</p>
<p><code>NotificationRowBinderImpl</code> + <code>RowInflaterTask</code> + <code>AsyncLayoutInflater</code></p>
<p>â†’ æ„é€  <code>ExpandableNotificationRow</code></p>
<p>â†’ å†é€šè¿‡ <code>RowContentBindStage</code> ç»‘å®šå…·ä½“å†…å®¹ï¼ˆæ™®é€šå¸ƒå±€ã€ä½ä¼˜å…ˆçº§å¸ƒå±€ã€é”å±è„±æ•ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><strong>åŠ å…¥æ´»åŠ¨åˆ—è¡¨å¹¶è§¦å‘ UI æ›´æ–°</strong>ï¼š</p>
<p><code>NotificationEntryManager</code> æŠŠ entry åŠ å…¥ <code>mActiveNotifications</code>ï¼Œè°ƒç”¨ <code>updateNotifications(...)</code>ã€‚</p>
</li>
<li>
<p><strong>Presenter é©±åŠ¨ UI æ›´æ–°</strong>ï¼š</p>
<p><code>StatusBarNotificationPresenter.updateNotificationViews</code></p>
<p>â†’ <code>NotificationViewHierarchyManager.updateNotificationViews</code></p>
<p>â†’ æ ¹æ®æœ€æ–° Entry åˆ—è¡¨å’Œåˆ†ç»„å…³ç³»ï¼Œæ›´æ–° NSSL å­ View çš„å¢å‡ã€åˆ†ç»„å…³ç³»ã€é¡ºåºã€‚</p>
</li>
<li>
<p><strong>NSSL æ¸²æŸ“</strong>ï¼š</p>
<p>é€šè¿‡ <code>addView / removeView / changeViewPosition</code>ï¼Œæœ€ç»ˆç”± <code>NotificationStackScrollLayout</code> å®Œæˆé€šçŸ¥åˆ—è¡¨çš„æµ‹é‡ã€å¸ƒå±€å’Œç»˜åˆ¶ï¼Œç”¨æˆ·å°±èƒ½åœ¨é€šçŸ¥æ çœ‹åˆ°å¯¹åº”çš„é€šçŸ¥è¡Œäº†ã€‚</p>
</li>
</ol>
<p><strong>å¼•ç”¨</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fandroid-11.0.0_r40%3Aframeworks%2Fbase%2Fpackages%2FSystemUI%2F" target="_blank" title="https://cs.android.com/android/platform/superproject/+/android-11.0.0_r40:frameworks/base/packages/SystemUI/" ref="nofollow noopener noreferrer">cs.android.com/android/plaâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 4]ï¼šå‰ç«¯æ ¸å¿ƒè®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…ä¸å‘å¸ƒè®¢é˜…]]></title>    <link>https://juejin.cn/post/7598057199963635763</link>    <guid>https://juejin.cn/post/7598057199963635763</guid>    <pubDate>2026-01-23T01:42:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598057199963635763" data-draft-id="7598021081987596339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 4]ï¼šå‰ç«¯æ ¸å¿ƒè®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…ä¸å‘å¸ƒè®¢é˜…"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-23T01:42:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ç‹å£®å£®"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 4]ï¼šå‰ç«¯æ ¸å¿ƒè®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…ä¸å‘å¸ƒè®¢é˜…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ç‹å£®å£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T01:42:43.000Z" title="Fri Jan 23 2026 01:42:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>å†™åœ¨å‰é¢</strong></p>
<p>å¾ˆå¤šå‰ç«¯å·¥ç¨‹å¸ˆåœ¨é¢è¯•æ—¶èƒ½èƒŒå‡ºè§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ«ï¼Œä½†åœ¨å†™ä»£ç æ—¶ï¼Œå´ä¾ç„¶å†™å‡ºäº†æ»¡å±çš„ <code>useEffect</code> ä¾èµ–åœ°ç‹±ï¼Œæˆ–è€…ç”¨å…¨å±€ EventBus åˆ¶é€ äº†éš¾ä»¥è°ƒè¯•çš„æ•°æ®å¹½çµã€‚</p>
<p><strong>â€œè€¦åˆâ€æ˜¯æ¶æ„çš„å¤§æ•Œï¼Œè€Œâ€œé€šä¿¡â€æ˜¯è€¦åˆçš„æºå¤´ã€‚</strong></p>
<p>æ¶æ„å¸ˆçš„æ ¸å¿ƒä»»åŠ¡ä¹‹ä¸€ï¼Œå°±æ˜¯å»ºç«‹ä¸€å¥—é«˜æ•ˆçš„<strong>æ¶ˆæ¯åˆ†å‘æœºåˆ¶</strong>ã€‚è¿™å¥—æœºåˆ¶å†³å®šäº†ä½ çš„åº”ç”¨æ˜¯åƒå¤šç±³è¯ºéª¨ç‰Œä¸€æ ·è„†å¼±ï¼ˆç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼‰ï¼Œè¿˜æ˜¯åƒäººä½“ç¥ç»ç³»ç»Ÿä¸€æ ·çµæ•ä¸”å¥å£®ã€‚</p>
<p>æœ¬ç¯‡æˆ‘ä»¬å°†æ­å¼€ Vue/MobX å“åº”å¼çš„é¢çº±ï¼Œæ¢è®¨ React ä¸ºä»€ä¹ˆæ­£åœ¨å‘ç»†ç²’åº¦æ›´æ–°ï¼ˆSignalsï¼‰ä½å¤´ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥è§£è€¦å·¨å‹åº”ç”¨ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e3127de2c11461089d27bd860ca64d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769737362&amp;x-signature=OTYy3KY%2Bx0p2D4%2BY7X2iC17Bors%3D" alt="unnamed.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ è§‚å¯Ÿè€… vs å‘å¸ƒè®¢é˜…ï¼Œåˆ«å†å‚»å‚»åˆ†ä¸æ¸…</h2>
<p>è™½ç„¶è¿™ä¸¤ä¸ªæ¨¡å¼é•¿å¾—å¾ˆåƒï¼Œä½†åœ¨æ¶æ„è®¾è®¡ä¸­ï¼Œå®ƒä»¬çš„åº”ç”¨åœºæ™¯æˆªç„¶ä¸åŒã€‚</p>
<h3 data-id="heading-1">1.1 è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)</h3>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Subjectï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å’Œ Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ã€‚</li>
<li><strong>å…³ç³»ï¼š</strong> <strong>æ¾è€¦åˆï¼Œä½†ä¾ç„¶æœ‰è”ç³»ã€‚</strong> Subject å†…éƒ¨ç»´æŠ¤äº†ä¸€ä»½ Observer çš„æ¸…å•ã€‚å½“ Subject å˜åŒ–æ—¶ï¼Œå®ƒä¼šç›´æ¥è°ƒç”¨ Observer çš„ <code>update</code> æ–¹æ³•ã€‚</li>
<li><strong>å‰ç«¯å…¸å‹ï¼š</strong> <code>Vue</code> çš„å“åº”å¼ç³»ç»Ÿã€<code>MobX</code>ã€<code>DOM</code> äº‹ä»¶ç›‘å¬ã€‚</li>
<li><strong>æ½œå°è¯ï¼š</strong> â€œæˆ‘æ˜¯æ•°æ®ï¼Œè°ä¾èµ–æˆ‘ï¼Œæˆ‘å°±é€šçŸ¥è°ã€‚â€</li>
</ul>
<h3 data-id="heading-2">1.2 å‘å¸ƒè®¢é˜…æ¨¡å¼ (Publish-Subscribe Pattern)</h3>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Publisherï¼ˆå‘å¸ƒè€…ï¼‰ã€Subscriberï¼ˆè®¢é˜…è€…ï¼‰å’Œ <strong>Brokerï¼ˆè°ƒåº¦ä¸­å¿ƒ/äº‹ä»¶é€šé“ï¼‰</strong> ã€‚</li>
<li><strong>å…³ç³»ï¼š</strong> <strong>å®Œå…¨è§£è€¦ã€‚</strong> å‘å¸ƒè€…æ ¹æœ¬ä¸çŸ¥é“è®¢é˜…è€…çš„å­˜åœ¨ï¼Œè®¢é˜…è€…ä¹Ÿä¸çŸ¥é“å‘å¸ƒè€…æ˜¯è°ã€‚å®ƒä»¬åªè®¤ä¸­é—´çš„â€œé‚®å±€â€ã€‚</li>
<li><strong>å‰ç«¯å…¸å‹ï¼š</strong> <code>Node.js EventEmitter</code>ã€<code>Mitt</code>ã€<code>Webpack Tapable</code>ã€<code>RxJS</code>ã€‚</li>
<li><strong>æ½œå°è¯ï¼š</strong> â€œæˆ‘æ˜¯å¹¿æ’­ç”µå°ï¼Œæˆ‘åªç®¡å‘ä¿¡å·ï¼Œè°çˆ±å¬è°å¬ã€‚â€</li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€ ä»è„æ£€æŸ¥åˆ° Signals (ç»†ç²’åº¦å“åº”å¼)</h2>
<p>åœ¨å‰ç«¯æ¶æ„ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼æœ€æ ¸å¿ƒçš„æˆ˜åœºæ˜¯ <strong>çŠ¶æ€ç®¡ç†ï¼ˆState Managementï¼‰</strong> ã€‚</p>
<h3 data-id="heading-4">2.1 ç¬¬ä¸€ä»£ï¼šç²—ç³™çš„é€šçŸ¥</h3>
<p>AngularJS (v1) ä½¿ç”¨è„æ£€æŸ¥ï¼ˆDirty Checkingï¼‰ã€‚ä»»ä½•æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘å…¨é‡æ£€æŸ¥ï¼Œè¿™æ˜¯ä¸€ç§ä½æ•ˆçš„è§‚å¯Ÿè€…å®ç°ã€‚</p>
<h3 data-id="heading-5">2.2 ç¬¬äºŒä»£ï¼šä¾èµ–æ”¶é›† (Dependency Collection)</h3>
<p>Vue 2/3 å’Œ MobX å¼•å…¥äº†æ›´æ™ºèƒ½çš„è§‚å¯Ÿè€…ã€‚</p>
<ul>
<li><strong>Getter (è®¢é˜…)ï¼š</strong> å½“ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œè¯»å–äº† <code>state.count</code>ï¼Œç»„ä»¶è‡ªåŠ¨æŠŠè‡ªå·±æ³¨å†Œä¸º <code>count</code> çš„è§‚å¯Ÿè€…ã€‚</li>
<li><strong>Setter (å‘å¸ƒ)ï¼š</strong> å½“ <code>state.count</code> å˜åŒ–æ—¶ï¼Œå®ƒç²¾å‡†é€šçŸ¥ä¾èµ–å®ƒçš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</li>
</ul>
<h3 data-id="heading-6">2.3 ç¬¬ä¸‰ä»£ï¼šSignals çš„å´›èµ· (å½“å‰è¶‹åŠ¿)</h3>
<p>React çš„ <code>useState</code> + <code>useEffect</code> å®é™…ä¸Šæ˜¯ä¸€ç§æ‰‹åŠ¨çš„ã€ä¾èµ–æ•°ç»„å¼çš„è§‚å¯Ÿæœºåˆ¶ï¼Œè¿™å¯¼è‡´äº†ä¸¥é‡çš„ <strong>é‡æ¸²æŸ“ï¼ˆRe-renderï¼‰</strong> æ€§èƒ½é—®é¢˜ã€‚</p>
<p>äºæ˜¯ï¼ŒSolidJS, Preact, Vue, Angular, ç”šè‡³ Svelte 5 å…¨éƒ¨æ‹¥æŠ±äº† <strong>Signals</strong>ã€‚ Signals æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„<strong>æè‡´å½¢æ€</strong>ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¼ªä»£ç ï¼šSignals çš„é­”åŠ›</span>
const <span class="hljs-selector-attr">[count, setCount]</span> = <span class="hljs-built_in">createSignal</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€… (Effect)</span>
<span class="hljs-built_in">createEffect</span>(() =&gt; {
  <span class="hljs-comment">// è‡ªåŠ¨è®¢é˜…ï¼šå› ä¸ºè¿™é‡Œè°ƒç”¨äº† count()</span>
  console<span class="hljs-selector-class">.log</span>("The count is", count()); 
});

<span class="hljs-built_in">setCount</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡º: The count is 1</span>
</code></pre>
<p><strong>æ¶æ„å¯ç¤ºï¼š</strong> ä¸ºä»€ä¹ˆ Signals æ˜¯è¶‹åŠ¿ï¼Ÿå› ä¸ºå®ƒå®ç°äº† <strong>â€œå€¼çº§åˆ«çš„ç»‘å®šâ€</strong> è€Œé <strong>â€œç»„ä»¶çº§åˆ«çš„ç»‘å®šâ€</strong> ã€‚ åœ¨ Signals æ¶æ„ä¸‹ï¼Œ<code>count</code> å˜åŒ–æ—¶ï¼Œä¸éœ€è¦é‡æ–°è¿è¡Œæ•´ä¸ªç»„ä»¶å‡½æ•°ï¼Œåªéœ€è¦æ›´æ–°ç»‘å®šäº† <code>count</code> çš„é‚£ä¸ª DOM æ–‡æœ¬èŠ‚ç‚¹ã€‚è¿™æ˜¯æ€§èƒ½ä¼˜åŒ–çš„ç»ˆå±€ã€‚</p>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€ å‘å¸ƒè®¢é˜…çš„é™·é˜±ï¼šEventBus æ˜¯è§£è€¦ç¥å™¨è¿˜æ˜¯ç»´æŠ¤å™©æ¢¦ï¼Ÿ</h2>
<p>å‘å¸ƒè®¢é˜…æ¨¡å¼éå¸¸è¯±äººï¼Œå› ä¸ºå®ƒèƒ½è®©ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å…³çš„æ¨¡å—é€šä¿¡ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><strong>Headerç»„ä»¶</strong> ç‚¹å‡»äº†â€œé€€å‡ºç™»å½•â€ã€‚</li>
<li><strong>APIæ¨¡å—</strong> æ”¶åˆ°é€šçŸ¥ï¼Œæ¸…é™¤ Tokenã€‚</li>
<li><strong>Routeræ¨¡å—</strong> æ”¶åˆ°é€šçŸ¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µã€‚</li>
</ul>
<p>å®ƒä»¬äº’ä¸å¼•ç”¨ï¼Œé€šè¿‡ä¸€ä¸ª <code>globalEventBus.emit('logout')</code> æå®šã€‚å®Œç¾ï¼Ÿ</p>
<h3 data-id="heading-8">3.1 æ»¥ç”¨çš„ä»£ä»·</h3>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå…¨å±€ EventBus å¾€å¾€ä¼šæ¼”å˜æˆ <strong>â€œæ„å¤§åˆ©é¢æ¡å¼çš„æ•°æ®æµâ€</strong> ã€‚</p>
<ol>
<li><strong>é“¾è·¯éšå½¢ï¼š</strong> ä½ åœ¨ <code>logout</code> äº‹ä»¶ä¸Šæ‰“ä¸ªæ–­ç‚¹ï¼Œæ ¹æœ¬æ‰¾ä¸åˆ°æ˜¯å“ªä¸ªæ–‡ä»¶è§¦å‘çš„ã€‚</li>
<li><strong>ç±»å‹ä¸¢å¤±ï¼š</strong> <code>emit('user-update', data)</code>ï¼Œè¿™ä¸ª <code>data</code> åˆ°åº•é•¿ä»€ä¹ˆæ ·ï¼Ÿæ²¡äººçŸ¥é“ã€‚</li>
<li><strong>å‘½åå†²çªï¼š</strong> ä½ çš„æ¨¡å—å‘äº† <code>init</code>ï¼Œåˆ«äººçš„æ¨¡å—ä¹Ÿç›‘å¬ <code>init</code>ï¼Œç»“æœå…¨ä¹±å¥—äº†ã€‚</li>
</ol>
<h3 data-id="heading-9">3.2 æ¶æ„å¸ˆçš„æ²»ç†ç­–ç•¥</h3>
<p>å¦‚æœä½ å¿…é¡»ä½¿ç”¨å‘å¸ƒè®¢é˜…ï¼ˆæ¯”å¦‚è·¨ iframe é€šä¿¡ã€æ’ä»¶åŒ–æ¶æ„ï¼‰ï¼Œè¯·éµå®ˆä»¥ä¸‹åŸåˆ™ï¼š</p>
<ol>
<li>
<p><strong>ä¸¥æ ¼çš„ç±»å‹çº¦æŸ (Typed Events)ï¼š</strong> ä¸è¦ç”¨ <code>string</code> ä½œä¸ºäº‹ä»¶åã€‚ä½¿ç”¨ TypeScript å®šä¹‰ä¸¥æ ¼çš„äº‹ä»¶æ˜ å°„è¡¨ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Events = {
  <span class="hljs-string">'user:logout'</span>: void;
  <span class="hljs-string">'toast:show'</span>: { message: <span class="hljs-type">string</span>; <span class="hljs-keyword">type</span>: <span class="hljs-string">'success'</span> | <span class="hljs-string">'error'</span> };
};
<span class="hljs-keyword">const</span> bus = mitt&lt;Events&gt;(); <span class="hljs-comment">// å¼ºç±»å‹çº¦æŸ</span>
</code></pre>
</li>
<li>
<p><strong>å±€éƒ¨æ€»çº¿ä¼˜äºå…¨å±€æ€»çº¿ï¼š</strong> ä¸è¦æä¸€ä¸ª App çº§åˆ«çš„ <code>bus</code>ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨æ ¼ç»„ä»¶ï¼Œå¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨åˆ›å»ºä¸€ä¸ª <code>TableEventBus</code>ï¼Œåªè´Ÿè´£å¤„ç†è¡Œé€‰ã€æ’åºã€ç­›é€‰ç­‰å†…éƒ¨é€šä¿¡ã€‚</p>
</li>
<li>
<p><strong>æ˜¾å¼çš„å¸è½½æœºåˆ¶ï¼š</strong> åœ¨ React <code>useEffect</code> çš„ cleanup æˆ– Vue <code>onUnmounted</code> ä¸­ï¼Œ<strong>å¿…é¡»</strong>å–æ¶ˆè®¢é˜…ã€‚å†…å­˜æ³„æ¼å¾€å¾€å°±æ˜¯å› ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ç•™ä¸‹çš„â€œåƒµå°¸ç›‘å¬å™¨â€å¯¼è‡´çš„ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-10">å››ã€ RxJS ä¸æµå¼æ€ç»´</h2>
<p>å¦‚æœåœ¨è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¹‹ä¸Šè¿˜æœ‰ä¸€ä¸ªâ€œç¥â€ï¼Œé‚£å°±æ˜¯ <strong>RxJS</strong>ï¼ˆReactive Extensionsï¼‰ã€‚</p>
<p>RxJS å°† <strong>â€œä¸€åˆ‡çš†æµ (Stream)â€</strong> çš„æ€æƒ³å¼•å…¥å‰ç«¯ã€‚å®ƒä¸ä»…ä»…æ˜¯è§‚å¯Ÿæ•°æ®ï¼Œå®ƒè¿˜èƒ½å¯¹æ•°æ®æµè¿›è¡Œ<strong>å˜æ¢ã€è¿‡æ»¤ã€ç»„åˆ</strong>ã€‚</p>
<h3 data-id="heading-11">4.1 è§£å†³å¤æ‚åœºæ™¯</h3>
<p>æƒ³è±¡ä¸€ä¸ªæœç´¢æ¡†çš„éœ€æ±‚ï¼š</p>
<ol>
<li>ç”¨æˆ·è¾“å…¥æ—¶ï¼Œå®æ—¶æœç´¢ï¼ˆç›‘å¬ Inputï¼‰ã€‚</li>
<li>é˜²æŠ– 300msï¼ˆé¿å…è¯·æ±‚è¿‡å¤šï¼‰ã€‚</li>
<li>å¦‚æœè¾“å…¥å†…å®¹æ²¡å˜ï¼Œä¸å‘è¯·æ±‚ï¼ˆdistinctUntilChangedï¼‰ã€‚</li>
<li>å¦‚æœå‘èµ·äº†æ–°è¯·æ±‚ï¼Œæ—§è¯·æ±‚è¿˜æœªè¿”å›ï¼Œç”±äºæ—§è¯·æ±‚ç»“æœè¿‡æ—¶ï¼Œéœ€è¦ä¸¢å¼ƒï¼ˆswitchMapï¼‰ã€‚</li>
</ol>
<p>ç”¨ Promise æˆ– EventBus å†™ï¼Œä½ éœ€è¦å†™ä¸€å †ä¸­é—´å˜é‡æ¥è®°å½•çŠ¶æ€ã€‚ç”¨ RxJSï¼Œå°±æ˜¯ä¸€æ¡ä¼˜é›…çš„ç®¡é“ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">fromEvent</span>(input, 'input')<span class="hljs-selector-class">.pipe</span>(
  debounceTime(<span class="hljs-number">300</span>),
  <span class="hljs-built_in">map</span>(e =&gt; e.target.value),
  <span class="hljs-built_in">distinctUntilChanged</span>(),
  <span class="hljs-built_in">switchMap</span>(value =&gt; ajax(`/api/search?q=${value}`))
)<span class="hljs-selector-class">.subscribe</span>(results =&gt; {
  render(results);
});
</code></pre>
<p><strong>æ¶æ„å®šä½ï¼š</strong> RxJS å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œåœ¨å¤„ç† <strong>å¤æ‚å¼‚æ­¥ç¼–æ’</strong>ï¼ˆå¦‚å³æ—¶é€šè®¯ IMã€è‚¡ç¥¨ K çº¿å›¾ã€å¤æ‚è¡¨å•è”åŠ¨ï¼‰æ—¶ï¼ŒRxJS æ˜¯ä½ çš„æ ¸æ­¦å™¨ã€‚</p>
<hr/>
<h2 data-id="heading-12">ç»“è¯­ï¼šæ¨¡å¼æ²¡æœ‰å¥½åï¼Œåªæœ‰é€‚åˆ</h2>
<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå“åº”å¼ï¼‰è®©æˆ‘ä»¬åœ¨ç»„ä»¶å†…éƒ¨äº«å—äº†è‡ªåŠ¨æ›´æ–°çš„ä¾¿åˆ©ï¼›å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆEventBusï¼‰è®©æˆ‘ä»¬å®ç°äº†è·¨æ¨¡å—çš„è§£è€¦ï¼›RxJS è®©æˆ‘ä»¬æŒæ§äº†æ—¶é—´çš„ç»´åº¦ã€‚</p>
<p>ä¸€ä¸ªä¼˜ç§€çš„å‰ç«¯æ¶æ„ï¼Œé€šå¸¸æ˜¯ <strong>â€œå†…éƒ¨é«˜å†…èšï¼ˆç”¨ Signals/Hooksï¼‰ï¼Œå¤–éƒ¨ä½è€¦åˆï¼ˆç”¨ Pub/Subï¼‰â€</strong> çš„ç»„åˆã€‚</p>
<p>ä¸æƒ³æŠŠæ–‡ç« å†™çš„è¿‡äºå¹²ç‡¥ï¼Œåªå°†æ¡†æ¶ç½—åˆ—å‡ºæ¥ï¼Œéåœ°æ˜¯AIçš„æƒ…å†µä¸‹ï¼Œæƒ³è¦åœ¨æ¡†æ¶å†…ç»†åŒ–æŸä¸€æ¦‚å¿µï¼Œæˆ‘æƒ³æ˜¯åœ¨ç®€å•ä¸è¿‡çš„äº‹äº†ã€‚</p>
<blockquote>
<p><strong>Next Step:</strong> æå®šäº†é€šä¿¡ï¼Œæˆ‘ä»¬è§£å†³äº†æ¨¡å—é—´çš„â€œåŠ¨æ€è”ç³»â€ã€‚ä½†é¢å¯¹åƒå˜ä¸‡åŒ–çš„ä¸šåŠ¡è§„åˆ™ï¼ˆæ¯”å¦‚ï¼šä¸åŒçš„ç”¨æˆ·ç­‰çº§æœ‰ä¸åŒçš„æŠ˜æ‰£ç­–ç•¥ï¼Œä¸åŒçš„ç¯å¢ƒè¦é€‚é…ä¸åŒçš„ APIï¼‰ï¼Œå¦‚æœå…¨æ˜¯ <code>if-else</code>ï¼Œä»£ç ä¾ç„¶ä¼šè…çƒ‚ã€‚ ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨è®¾è®¡æ¨¡å¼æ¶ˆé™¤é€»è¾‘åˆ†æ”¯ã€‚ è¯·çœ‹**ã€Šç¬¬äº”ç¯‡ï¼šçµé­‚ï¼ˆä¸‹ï¼‰â€”â€”å¤æ‚åº¦çš„å…‹æ˜Ÿï¼šç­–ç•¥ã€é€‚é…å™¨ä¸ä»£ç†æ¨¡å¼çš„å‰ç«¯å®è·µã€‹**ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iTerm å¿«æ·é”®æ“ä½œæŒ‡å—]]></title>    <link>https://juejin.cn/post/7598435950410514442</link>    <guid>https://juejin.cn/post/7598435950410514442</guid>    <pubDate>2026-01-24T03:38:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950410514442" data-draft-id="7589227883263393838" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iTerm å¿«æ·é”®æ“ä½œæŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2026-01-24T03:38:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iTerm å¿«æ·é”®æ“ä½œæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:38:20.000Z" title="Sat Jan 24 2026 03:38:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>iTerm æ˜¯ macOS ä¸Šä¸€æ¬¾å¼ºå¤§çš„ç»ˆç«¯å·¥å…·ï¼Œå…¶ä¸°å¯Œçš„åŠŸèƒ½å’Œå¿«æ·é”®å¯ä»¥æ˜¾è‘—æé«˜ä½ çš„å·¥ä½œæ•ˆç‡ã€‚æŒæ¡ä»¥ä¸‹å¿«æ·é”®ï¼Œä¸ä»…èƒ½åŠ å¿«ä½ çš„æ“ä½œé€Ÿåº¦ï¼Œè¿˜èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å·¥ä½œæµç¨‹ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ iTerm å¿«æ·é”®æ“ä½œã€‚<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/787ec20c3a68439ca36cc2e435c95b3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830699&amp;x-signature=j4R3UsMDMSGROcvFXYEDWR17Kl4%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<h2 data-id="heading-0">ä¸€ã€æ ‡ç­¾é¡µç®¡ç†<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/258ba44f02254f6fa3bb5306e3b8a130~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830699&amp;x-signature=vXPr5DEgO4lpkeOGefpP0vfiIgY%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h2>
<h3 data-id="heading-1">1. æ–°å»ºæ ‡ç­¾é¡µ</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>âŒ˜ + T</code><br/>
<br/>
ä½¿ç”¨è¿™ä¸ªå¿«æ·é”®å¯ä»¥å¿«é€Ÿæ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œä¾¿äºåŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡ã€‚</li>
</ul>
<h3 data-id="heading-2">2. å…³é—­å½“å‰æ ‡ç­¾é¡µ</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>âŒ˜ + W</code><br/>
<br/>
å…³é—­å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µï¼Œé€‚åˆåœ¨å®ŒæˆæŸé¡¹ä»»åŠ¡åæ¸…ç†ç•Œé¢ã€‚</li>
</ul>
<h3 data-id="heading-3">3. å‚ç›´åˆ†å±</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>âŒ˜ + D</code><br/>
<br/>
å°†å½“å‰æ ‡ç­¾é¡µå‚ç›´åˆ†å±ï¼Œé€‚åˆéœ€è¦åŒæ—¶æŸ¥çœ‹å¤šä¸ªç»ˆç«¯çª—å£çš„æƒ…å†µã€‚</li>
</ul>
<h3 data-id="heading-4">4. æ°´å¹³åˆ†å±</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>âŒ˜ + Shift + D</code><br/>
<br/>
å°†å½“å‰æ ‡ç­¾é¡µæ°´å¹³åˆ†å±ï¼Œæ–¹ä¾¿åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡æˆ–ç›‘æ§ä¸åŒçš„è¾“å‡ºã€‚</li>
</ul>
<h3 data-id="heading-5">5. åˆ‡æ¢åˆ°æŒ‡å®šçš„æ ‡ç­¾é¡µ</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>âŒ˜ + æ•°å­—</code><br/>
<br/>
é€šè¿‡æ•°å­—ï¼ˆ1-9ï¼‰åˆ‡æ¢åˆ°å¯¹åº”çš„æ ‡ç­¾é¡µï¼Œå¿«é€Ÿå®šä½åˆ°ä½ éœ€è¦çš„å·¥ä½œç¯å¢ƒã€‚</li>
</ul>
<h2 data-id="heading-6">äºŒã€å‘½ä»¤å†å²ä¸å‰ªè´´æ¿</h2>
<h3 data-id="heading-7">1. æŸ¥çœ‹å†å²å‘½ä»¤</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>command + ;</code><br/>
<br/>
å¯ä»¥å¿«é€ŸæŸ¥çœ‹å¹¶é€‰æ‹©ä¹‹å‰æ‰§è¡Œè¿‡çš„å‘½ä»¤ï¼Œå‡å°‘é‡å¤è¾“å…¥ã€‚</li>
</ul>
<h3 data-id="heading-8">2. æŸ¥çœ‹å‰ªè´´æ¿å†å²</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>command + shift + h</code><br/>
<br/>
å¿«é€Ÿè®¿é—®å‰ªè´´æ¿çš„å†å²è®°å½•ï¼Œæ–¹ä¾¿ç²˜è´´ä¹‹å‰å¤åˆ¶çš„å†…å®¹ã€‚</li>
</ul>
<h2 data-id="heading-9">ä¸‰ã€æ¸…å±ä¸å…‰æ ‡æ“ä½œ</h2>
<h3 data-id="heading-10">1. æ¸…å±</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>command + r</code><br/>
<br/>
æ¸…é™¤å½“å‰ç»ˆç«¯å±å¹•ï¼Œä¿æŒç•Œé¢çš„æ•´æ´ã€‚</li>
</ul>
<h3 data-id="heading-11">2. å…‰æ ‡ä½ç§»</h3>
<ul>
<li>
<p><strong>åˆ°è¡Œé¦–</strong>ï¼š<code>ctrl + a</code><br/>
<br/>
å°†å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„å¼€å§‹ä½ç½®ã€‚</p>
</li>
<li>
<p><strong>åˆ°è¡Œå°¾</strong>ï¼š<code>ctrl + e</code><br/>
<br/>
å°†å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„æœ«å°¾ã€‚</p>
</li>
<li>
<p><strong>å‰è¿›åé€€</strong>ï¼š<code>ctrl + b</code> / <code>ctrl + f</code><br/>
<br/>
åˆ†åˆ«ç›¸å½“äºå‘å·¦/å‘å³ç§»åŠ¨å…‰æ ‡ã€‚</p>
</li>
</ul>
<h2 data-id="heading-12">å››ã€æ–‡æœ¬ç¼–è¾‘</h2>
<h3 data-id="heading-13">1. åˆ é™¤å…‰æ ‡ä¹‹å‰çš„å•è¯</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + w</code><br/>
<br/>
åˆ é™¤å…‰æ ‡å·¦ä¾§çš„æ•´ä¸ªå•è¯ï¼Œè¿…é€Ÿä¿®æ”¹è¾“å…¥çš„å†…å®¹ã€‚</li>
</ul>
<h3 data-id="heading-14">2. åˆ é™¤åˆ°æ–‡æœ¬æœ«å°¾</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + k</code><br/>
<br/>
ä»å…‰æ ‡ä½ç½®åˆ é™¤åˆ°è¡Œå°¾ï¼Œé€‚åˆå¿«é€Ÿæ¸…ç†è¾“å…¥å†…å®¹ã€‚</li>
</ul>
<h3 data-id="heading-15">3. æ¸…é™¤å½“å‰è¡Œ</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + u</code><br/>
<br/>
åˆ é™¤å½“å‰è¡Œçš„æ‰€æœ‰å†…å®¹ï¼Œé€‚ç”¨äºéœ€è¦é‡æ–°è¾“å…¥æ—¶ã€‚</li>
</ul>
<h3 data-id="heading-16">4. åˆ é™¤å½“å‰å…‰æ ‡çš„å­—ç¬¦</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + d</code><br/>
<br/>
åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ï¼Œå¿«é€Ÿä¿®æ­£è¾“å…¥é”™è¯¯ã€‚</li>
</ul>
<h3 data-id="heading-17">5. åˆ é™¤å…‰æ ‡ä¹‹å‰çš„å­—ç¬¦</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + h</code><br/>
<br/>
åˆ é™¤å…‰æ ‡å·¦ä¾§çš„ä¸€ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºé€€æ ¼é”®çš„åŠŸèƒ½ã€‚</li>
</ul>
<h2 data-id="heading-18">äº”ã€å…¶ä»–å®ç”¨ Ctrl å‘½ä»¤</h2>
<h3 data-id="heading-19">1. ä¸Šä¸€æ¡å‘½ä»¤</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + p</code><br/>
<br/>
å¯ä»¥å¿«é€Ÿå›é¡¾ä¹‹å‰æ‰§è¡Œè¿‡çš„å‘½ä»¤ï¼Œé¿å…é‡å¤è¾“å…¥ã€‚</li>
</ul>
<h3 data-id="heading-20">2. æœç´¢å‘½ä»¤å†å²</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + r</code><br/>
<br/>
å¯åŠ¨å‘½ä»¤å†å²æœç´¢ï¼Œå¯ä»¥è¾“å…¥å…³é”®å­—å¿«é€ŸæŸ¥æ‰¾ä»¥å‰çš„å‘½ä»¤ã€‚</li>
</ul>
<h3 data-id="heading-21">3. äº¤æ¢å…‰æ ‡å¤„æ–‡æœ¬</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + t</code><br/>
<br/>
äº¤æ¢å…‰æ ‡ä½ç½®çš„å­—ç¬¦ï¼Œä¾¿äºå¿«é€Ÿçº æ­£è¾“å…¥é”™è¯¯ã€‚</li>
</ul>
<h3 data-id="heading-22">4. æ¸…å±</h3>
<ul>
<li><strong>å¿«æ·é”®</strong>ï¼š<code>ctrl + l</code><br/>
<br/>
æ¸…ç©ºç»ˆç«¯å±å¹•ï¼Œä¸ <code>command + r</code> åŠŸèƒ½ç±»ä¼¼ã€‚</li>
</ul>
<h2 data-id="heading-23">æ€»ç»“</h2>
<p>æŒæ¡ iTerm çš„å¿«æ·é”®æ“ä½œèƒ½å¤Ÿæ˜¾è‘—æå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼Œè®©ä½ åœ¨ä½¿ç”¨ç»ˆç«¯æ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åˆ©ç”¨ iTerm çš„åŠŸèƒ½ï¼Œåˆ›é€ æ›´åŠ é«˜æ•ˆçš„å·¥ä½œæµç¨‹ã€‚å°½æƒ…æ¢ç´¢å’Œå®è·µè¿™äº›å¿«æ·é”®ï¼Œè®©ä½ çš„ç»ˆç«¯ä½¿ç”¨ä½“éªŒæ›´åŠ æµç•…ï¼</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraphå®æˆ˜ï¼šæ„å»ºå¯è‡ªæ„ˆçš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿæ¶æ„]]></title>    <link>https://juejin.cn/post/7598450302616240174</link>    <guid>https://juejin.cn/post/7598450302616240174</guid>    <pubDate>2026-01-24T03:40:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598450302616240174" data-draft-id="7598469864256192563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraphå®æˆ˜ï¼šæ„å»ºå¯è‡ªæ„ˆçš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿæ¶æ„"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T03:40:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraphå®æˆ˜ï¼šæ„å»ºå¯è‡ªæ„ˆçš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿæ¶æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:40:52.000Z" title="Sat Jan 24 2026 03:40:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å½“ä»Šä¼ä¸šçº§AIåº”ç”¨ä¸­ï¼Œæ„å»ºä¸€ä¸ªæ—¢èƒ½å¤„ç†å¤æ‚ä¸šåŠ¡æµç¨‹åˆèƒ½ä¿éšœé«˜å¯ç”¨çš„å®¢æœç³»ç»Ÿæ˜¯å·¨å¤§æŒ‘æˆ˜ã€‚ä¼ ç»Ÿå•ä½“æ¶æ„åœ¨é¢å¯¹å¤šè½®å¯¹è¯ã€åˆ†æ”¯å†³ç­–å’Œå¼‚å¸¸æ¢å¤æ—¶å¾€å¾€åŠ›ä¸ä»å¿ƒã€‚LangChainç”Ÿæ€ä¸­çš„LangGraphæ¡†æ¶ï¼Œé€šè¿‡å›¾çŠ¶æ€ç®¡ç†ï¼ˆStateGraphï¼‰ä¸å¤šæ™ºèƒ½ä½“åä½œï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€æ¡è§£å†³ä¹‹é“ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥ç”µå•†é€€æ¬¾å¤„ç†ä¸ºå®æˆ˜æ¡ˆä¾‹ï¼Œå®Œæ•´å±•ç¤ºå¦‚ä½•åˆ©ç”¨LangChainã€LangGraphã€LangSmithé“ä¸‰è§’æ„å»ºå…·å¤‡â€œè‡ªæ„ˆèƒ½åŠ›â€çš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿã€‚æˆ‘ä»¬å°†æ·±å…¥ä¸‰ä¸ªæ ¸å¿ƒç¯èŠ‚ï¼š</p>
<ol>
<li><strong>æ¶æ„è®¾è®¡</strong>ï¼šåŸºäºçŠ¶æ€å›¾ï¼ˆStateGraphï¼‰è®¾è®¡é€€æ¬¾å¤„ç†æµç¨‹ï¼Œå®ç°èº«ä»½éªŒè¯Agentã€è®¢å•æŸ¥è¯¢Agentã€é€€æ¬¾æ“ä½œAgentçš„åä½œä¸æ¡ä»¶åˆ†æ”¯é€»è¾‘</li>
<li><strong>å®¹é”™æœºåˆ¶å®ç°</strong>ï¼šå±•ç¤ºå¦‚ä½•ä¸ºå…³é”®èŠ‚ç‚¹é…ç½®å¤‡ç”¨å·¥å…·ï¼Œè®¾ç½®ç†”æ–­æœºåˆ¶ï¼ˆå½“AIè¾“å‡ºç½®ä¿¡åº¦&lt;70%æ—¶è‡ªåŠ¨è½¬äººå·¥ï¼‰ï¼Œä¿éšœç³»ç»Ÿé«˜å¯ç”¨æ€§</li>
<li><strong>å…¨é“¾è·¯ç›‘æ§</strong>ï¼šé›†æˆLangSmithå®ç°è¯·æ±‚è¿½è¸ªã€æ€§èƒ½åˆ†æã€æˆæœ¬ç›‘æ§ï¼Œé€šè¿‡å¯è§†åŒ–é¢æ¿å®šä½ç“¶é¢ˆ</li>
</ol>
<p>æ‰€æœ‰ä»£ç å‡ä¸ºå¯ç›´æ¥è¿è¡Œçš„Pythonç‰‡æ®µï¼Œæ¶µç›–å›¾ç»“æ„å®šä¹‰ã€æ™ºèƒ½ä½“èŠ‚ç‚¹å®ç°ã€æ¡ä»¶è¾¹é…ç½®ç­‰å…³é”®ç¯èŠ‚ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-1">1.1 çŠ¶æ€å®šä¹‰ä¸å›¾ç»“æ„</h3>
<p>LangGraphçš„æ ¸å¿ƒæ˜¯StateGraphï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªå…±äº«çŠ¶æ€å¯¹è±¡ï¼Œæ‰€æœ‰æ™ºèƒ½ä½“èŠ‚ç‚¹é€šè¿‡è¯»å–å’Œæ›´æ–°è¿™ä¸ªçŠ¶æ€è¿›è¡Œåä½œã€‚æˆ‘ä»¬å…ˆå®šä¹‰é€€æ¬¾å¤„ç†çš„çŠ¶æ€ç»“æ„ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Literal</span>
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> BaseMessage
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, END

<span class="hljs-comment"># å®šä¹‰é€€æ¬¾å¤„ç†çŠ¶æ€</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefundState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    <span class="hljs-string">"""å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿçš„å…±äº«çŠ¶æ€"""</span>
    <span class="hljs-comment"># ç”¨æˆ·è¾“å…¥</span>
    user_input: <span class="hljs-built_in">str</span>
    <span class="hljs-comment"># èº«ä»½éªŒè¯ç»“æœ</span>
    auth_result: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>]
    <span class="hljs-comment"># è®¢å•æŸ¥è¯¢ç»“æœ</span>
    order_info: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>]
    <span class="hljs-comment"># é€€æ¬¾æ“ä½œç»“æœ</span>
    refund_result: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>]
    <span class="hljs-comment"># å½“å‰å¤„ç†æ­¥éª¤</span>
    current_step: <span class="hljs-built_in">str</span>
    <span class="hljs-comment"># é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰</span>
    error: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]
    <span class="hljs-comment"># AIè¾“å‡ºç½®ä¿¡åº¦</span>
    confidence: <span class="hljs-built_in">float</span>
    <span class="hljs-comment"># æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥</span>
    need_human: <span class="hljs-built_in">bool</span>
    <span class="hljs-comment"># æ¶ˆæ¯å†å²</span>
    messages: <span class="hljs-type">List</span>[BaseMessage]
</code></pre>
<h3 data-id="heading-2">1.2 æ™ºèƒ½ä½“èŠ‚ç‚¹å®šä¹‰</h3>
<p>æˆ‘ä»¬å°†é€€æ¬¾æµç¨‹æ‹†åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ™ºèƒ½ä½“ï¼Œæ¯ä¸ªè´Ÿè´£ç‰¹å®šèŒè´£ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®APIå¯†é’¥ï¼‰</span>
llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4o-mini"</span>, temperature=<span class="hljs-number">0</span>)

<span class="hljs-comment"># èº«ä»½éªŒè¯Agent</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">auth_agent</span>(<span class="hljs-params">state: RefundState</span>) -&gt; RefundState:
    <span class="hljs-string">"""éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œè¿”å›è®¤è¯ç»“æœ"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{datetime.now()}</span>] èº«ä»½éªŒè¯Agentæ‰§è¡Œä¸­..."</span>)
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿèº«ä»½éªŒè¯é€»è¾‘</span>
    user_input = state[<span class="hljs-string">"user_input"</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-string">"ä¼šå‘˜"</span> <span class="hljs-keyword">in</span> user_input <span class="hljs-keyword">or</span> <span class="hljs-string">"ç™»å½•"</span> <span class="hljs-keyword">in</span> user_input:
        auth_result = {
            <span class="hljs-string">"user_id"</span>: <span class="hljs-string">"user_001"</span>,
            <span class="hljs-string">"auth_level"</span>: <span class="hljs-string">"VIP"</span>,
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"success"</span>
        }
        confidence = <span class="hljs-number">0.92</span>  <span class="hljs-comment"># é«˜ç½®ä¿¡åº¦</span>
    <span class="hljs-keyword">else</span>:
        auth_result = {
            <span class="hljs-string">"user_id"</span>: <span class="hljs-string">"guest"</span>,
            <span class="hljs-string">"auth_level"</span>: <span class="hljs-string">"guest"</span>,
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"partial"</span>
        }
        confidence = <span class="hljs-number">0.65</span>  <span class="hljs-comment"># è¾ƒä½ç½®ä¿¡åº¦ï¼Œå¯èƒ½éœ€è¦äººå·¥éªŒè¯</span>
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"auth_result"</span>: auth_result,
        <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"auth_complete"</span>,
        <span class="hljs-string">"confidence"</span>: confidence,
        <span class="hljs-string">"need_human"</span>: confidence &lt; <span class="hljs-number">0.7</span>
    }

<span class="hljs-comment"># è®¢å•æŸ¥è¯¢Agent</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">order_agent</span>(<span class="hljs-params">state: RefundState</span>) -&gt; RefundState:
    <span class="hljs-string">"""æŸ¥è¯¢ç”¨æˆ·è®¢å•ä¿¡æ¯"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{datetime.now()}</span>] è®¢å•æŸ¥è¯¢Agentæ‰§è¡Œä¸­..."</span>)
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿè®¢å•æŸ¥è¯¢é€»è¾‘</span>
    user_id = state[<span class="hljs-string">"auth_result"</span>][<span class="hljs-string">"user_id"</span>]
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ç»“æœ</span>
    orders = {
        <span class="hljs-string">"user_001"</span>: [
            {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"ORD20250124001"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">299.00</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"shipped"</span>, <span class="hljs-string">"refundable"</span>: <span class="hljs-literal">True</span>},
            {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"ORD20250122001"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">899.00</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"delivered"</span>, <span class="hljs-string">"refundable"</span>: <span class="hljs-literal">True</span>}
        ],
        <span class="hljs-string">"guest"</span>: [
            {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"ORD20250123001"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">199.00</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"pending"</span>, <span class="hljs-string">"refundable"</span>: <span class="hljs-literal">False</span>}
        ]
    }
    
    order_info = {
        <span class="hljs-string">"user_id"</span>: user_id,
        <span class="hljs-string">"orders"</span>: orders.get(user_id, []),
        <span class="hljs-string">"query_time"</span>: datetime.now().isoformat(),
        <span class="hljs-string">"has_refundable"</span>: <span class="hljs-built_in">any</span>(order[<span class="hljs-string">"refundable"</span>] <span class="hljs-keyword">for</span> order <span class="hljs-keyword">in</span> orders.get(user_id, []))
    }
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"order_info"</span>: order_info,
        <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"order_query_complete"</span>
    }

<span class="hljs-comment"># é€€æ¬¾æ“ä½œAgent</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">refund_agent</span>(<span class="hljs-params">state: RefundState</span>) -&gt; RefundState:
    <span class="hljs-string">"""æ‰§è¡Œé€€æ¬¾æ“ä½œ"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{datetime.now()}</span>] é€€æ¬¾æ“ä½œAgentæ‰§è¡Œä¸­..."</span>)
    
    order_info = state[<span class="hljs-string">"order_info"</span>]
    refundable_orders = [order <span class="hljs-keyword">for</span> order <span class="hljs-keyword">in</span> order_info[<span class="hljs-string">"orders"</span>] <span class="hljs-keyword">if</span> order[<span class="hljs-string">"refundable"</span>]]
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> refundable_orders:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"refund_result"</span>: {
                <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>,
                <span class="hljs-string">"reason"</span>: <span class="hljs-string">"æ— å¯é€€æ¬¾è®¢å•"</span>,
                <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
            },
            <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"refund_failed"</span>
        }
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿé€€æ¬¾å¤„ç†</span>
    target_order = refundable_orders[<span class="hljs-number">0</span>]
    refund_result = {
        <span class="hljs-string">"order_id"</span>: target_order[<span class="hljs-string">"order_id"</span>],
        <span class="hljs-string">"refund_amount"</span>: target_order[<span class="hljs-string">"amount"</span>],
        <span class="hljs-string">"refund_id"</span>: <span class="hljs-string">f"REF<span class="hljs-subst">{datetime.now().strftime(<span class="hljs-string">'%Y%m%d%H%M%S'</span>)}</span>"</span>,
        <span class="hljs-string">"status"</span>: <span class="hljs-string">"processing"</span>,
        <span class="hljs-string">"estimated_time"</span>: <span class="hljs-string">"3-5ä¸ªå·¥ä½œæ—¥"</span>,
        <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
    }
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"refund_result"</span>: refund_result,
        <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"refund_processing"</span>
    }
</code></pre>
<h3 data-id="heading-3">1.3 å›¾ç»“æ„æ„å»ºä¸æ¡ä»¶è·¯ç”±</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_refund_workflow</span>() -&gt; StateGraph:
    <span class="hljs-string">"""æ„å»ºé€€æ¬¾å¤„ç†å·¥ä½œæµå›¾"""</span>
    
    <span class="hljs-comment"># åˆ›å»ºçŠ¶æ€å›¾å®ä¾‹</span>
    workflow = StateGraph(RefundState)
    
    <span class="hljs-comment"># æ·»åŠ æ™ºèƒ½ä½“èŠ‚ç‚¹</span>
    workflow.add_node(<span class="hljs-string">"authenticate"</span>, auth_agent)
    workflow.add_node(<span class="hljs-string">"query_order"</span>, order_agent)
    workflow.add_node(<span class="hljs-string">"process_refund"</span>, refund_agent)
    
    <span class="hljs-comment"># æ·»åŠ è¾¹ï¼šèº«ä»½éªŒè¯ â†’ è®¢å•æŸ¥è¯¢</span>
    workflow.add_edge(<span class="hljs-string">"authenticate"</span>, <span class="hljs-string">"query_order"</span>)
    
    <span class="hljs-comment"># æ¡ä»¶è·¯ç”±ï¼šæ ¹æ®è®¢å•æŸ¥è¯¢ç»“æœå†³å®šä¸‹ä¸€æ­¥</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">route_after_order</span>(<span class="hljs-params">state: RefundState</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""è·¯ç”±é€»è¾‘ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å¯é€€æ¬¾è®¢å•"""</span>
        <span class="hljs-keyword">if</span> state.get(<span class="hljs-string">"need_human"</span>, <span class="hljs-literal">False</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-string">"human_intervention"</span>  <span class="hljs-comment"># éœ€è¦äººå·¥ä»‹å…¥</span>
        <span class="hljs-keyword">elif</span> state[<span class="hljs-string">"order_info"</span>][<span class="hljs-string">"has_refundable"</span>]:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"process_refund"</span>      <span class="hljs-comment"># æœ‰å¯é€€æ¬¾è®¢å•ï¼Œæ‰§è¡Œé€€æ¬¾</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> END                   <span class="hljs-comment"># æ— å¯é€€æ¬¾è®¢å•ï¼Œç»“æŸæµç¨‹</span>
    
    workflow.add_conditional_edges(
        <span class="hljs-string">"query_order"</span>,
        route_after_order,
        {
            <span class="hljs-string">"human_intervention"</span>: <span class="hljs-string">"human_intervention"</span>,
            <span class="hljs-string">"process_refund"</span>: <span class="hljs-string">"process_refund"</span>,
            END: END
        }
    )
    
    <span class="hljs-comment"># é€€æ¬¾å¤„ç†å®Œæˆåç»“æŸ</span>
    workflow.add_edge(<span class="hljs-string">"process_refund"</span>, END)
    
    <span class="hljs-comment"># äººå·¥ä»‹å…¥èŠ‚ç‚¹ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">human_intervention</span>(<span class="hljs-params">state: RefundState</span>) -&gt; RefundState:
        <span class="hljs-string">"""äººå·¥ä»‹å…¥å¤„ç†"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{datetime.now()}</span>] äººå·¥å®¢æœä»‹å…¥..."</span>)
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"human_handled"</span>,
            <span class="hljs-string">"refund_result"</span>: {
                <span class="hljs-string">"status"</span>: <span class="hljs-string">"human_review"</span>,
                <span class="hljs-string">"note"</span>: <span class="hljs-string">"å·²è½¬äººå·¥å¤„ç†"</span>,
                <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
            }
        }
    
    workflow.add_node(<span class="hljs-string">"human_intervention"</span>, human_intervention)
    workflow.add_edge(<span class="hljs-string">"human_intervention"</span>, END)
    
    <span class="hljs-comment"># è®¾ç½®å…¥å£ç‚¹</span>
    workflow.set_entry_point(<span class="hljs-string">"authenticate"</span>)
    
    <span class="hljs-keyword">return</span> workflow.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># ç¼–è¯‘å·¥ä½œæµ</span>
app = build_refund_workflow()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"é€€æ¬¾å¤„ç†å·¥ä½œæµç¼–è¯‘å®Œæˆï¼"</span>)
</code></pre>
<h2 data-id="heading-4">äºŒã€å®¹é”™æœºåˆ¶å®ç°</h2>
<h3 data-id="heading-5">2.1 å¤‡ç”¨å·¥å…·é…ç½®ä¸ç†”æ–­æœºåˆ¶</h3>
<p>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå•ä¸€å·¥å…·æˆ–æœåŠ¡å¯èƒ½å› å„ç§åŸå› å¤±æ•ˆã€‚æˆ‘ä»¬éœ€è¦ä¸ºå…³é”®èŠ‚ç‚¹é…ç½®å¤‡ç”¨æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.tools <span class="hljs-keyword">import</span> DuckDuckGoSearchRun
<span class="hljs-keyword">from</span> langchain_community.utilities <span class="hljs-keyword">import</span> SQLDatabase
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResilientOrderSystem</span>:
    <span class="hljs-string">"""å…·å¤‡å®¹é”™èƒ½åŠ›çš„è®¢å•æŸ¥è¯¢ç³»ç»Ÿ"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># ä¸»æŸ¥è¯¢å·¥å…·ï¼šå†…éƒ¨æ•°æ®åº“API</span>
        self.primary_api = <span class="hljs-string">"https://api.internal.com/orders"</span>
        <span class="hljs-comment"># å¤‡ç”¨å·¥å…·1ï¼šç¼“å­˜æ•°æ®åº“</span>
        self.cache_db = SQLDatabase.from_uri(<span class="hljs-string">"sqlite:///orders_cache.db"</span>)
        <span class="hljs-comment"># å¤‡ç”¨å·¥å…·2ï¼šå¤–éƒ¨æœç´¢ï¼ˆå…œåº•ï¼‰</span>
        self.search_tool = DuckDuckGoSearchRun()
        
        <span class="hljs-comment"># ç†”æ–­å™¨çŠ¶æ€</span>
        self.circuit_breaker = {
            <span class="hljs-string">"primary_failures"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"last_failure_time"</span>: <span class="hljs-literal">None</span>,
            <span class="hljs-string">"state"</span>: <span class="hljs-string">"CLOSED"</span>  <span class="hljs-comment"># CLOSED, OPEN, HALF_OPEN</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query_order</span>(<span class="hljs-params">self, user_id: <span class="hljs-built_in">str</span>, order_id: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""å®¹é”™è®¢å•æŸ¥è¯¢"""</span>
        
        <span class="hljs-comment"># æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€</span>
        <span class="hljs-keyword">if</span> self.circuit_breaker[<span class="hljs-string">"state"</span>] == <span class="hljs-string">"OPEN"</span>:
            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦åº”è¯¥å°è¯•æ¢å¤</span>
            <span class="hljs-keyword">if</span> self._should_attempt_recovery():
                self.circuit_breaker[<span class="hljs-string">"state"</span>] = <span class="hljs-string">"HALF_OPEN"</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># ç›´æ¥ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ</span>
                <span class="hljs-keyword">return</span> self._fallback_query(user_id, order_id)
        
        <span class="hljs-comment"># å°è¯•ä¸»æŸ¥è¯¢ï¼ˆå¸¦æœ‰è¶…æ—¶å’Œé‡è¯•ï¼‰</span>
        <span class="hljs-keyword">try</span>:
            response = self._retry_query(
                <span class="hljs-keyword">lambda</span>: requests.get(
                    <span class="hljs-string">f"<span class="hljs-subst">{self.primary_api}</span>?user_id=<span class="hljs-subst">{user_id}</span>"</span>,
                    timeout=<span class="hljs-number">3</span>,
                    headers={<span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer internal_token"</span>}
                ),
                max_retries=<span class="hljs-number">2</span>,
                base_delay=<span class="hljs-number">1</span>
            )
            response.raise_for_status()
            
            <span class="hljs-comment"># æˆåŠŸï¼šé‡ç½®ç†”æ–­å™¨</span>
            <span class="hljs-keyword">if</span> self.circuit_breaker[<span class="hljs-string">"state"</span>] == <span class="hljs-string">"HALF_OPEN"</span>:
                self.circuit_breaker[<span class="hljs-string">"state"</span>] = <span class="hljs-string">"CLOSED"</span>
            self.circuit_breaker[<span class="hljs-string">"primary_failures"</span>] = <span class="hljs-number">0</span>
            
            <span class="hljs-keyword">return</span> response.json()
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¸»æŸ¥è¯¢å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            
            <span class="hljs-comment"># è®°å½•å¤±è´¥</span>
            self.circuit_breaker[<span class="hljs-string">"primary_failures"</span>] += <span class="hljs-number">1</span>
            self.circuit_breaker[<span class="hljs-string">"last_failure_time"</span>] = time.time()
            
            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰“å¼€ç†”æ–­å™¨</span>
            <span class="hljs-keyword">if</span> self.circuit_breaker[<span class="hljs-string">"primary_failures"</span>] &gt;= <span class="hljs-number">3</span>:
                self.circuit_breaker[<span class="hljs-string">"state"</span>] = <span class="hljs-string">"OPEN"</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç†”æ–­å™¨æ‰“å¼€ï¼Œæš‚æ—¶ç¦ç”¨ä¸»æŸ¥è¯¢"</span>)
            
            <span class="hljs-comment"># åˆ‡æ¢åˆ°å¤‡ç”¨æ–¹æ¡ˆ</span>
            <span class="hljs-keyword">return</span> self._fallback_query(user_id, order_id)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_fallback_query</span>(<span class="hljs-params">self, user_id: <span class="hljs-built_in">str</span>, order_id: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""å¤‡ç”¨æŸ¥è¯¢æ–¹æ¡ˆé“¾"""</span>
        
        <span class="hljs-comment"># æ–¹æ¡ˆ1ï¼šæŸ¥è¯¢ç¼“å­˜æ•°æ®åº“</span>
        <span class="hljs-keyword">try</span>:
            query = <span class="hljs-string">f"SELECT * FROM orders WHERE user_id = '<span class="hljs-subst">{user_id}</span>'"</span>
            <span class="hljs-keyword">if</span> order_id:
                query += <span class="hljs-string">f" AND order_id = '<span class="hljs-subst">{order_id}</span>'"</span>
            
            result = self.cache_db.run(query)
            <span class="hljs-keyword">if</span> result:
                <span class="hljs-keyword">return</span> {<span class="hljs-string">"source"</span>: <span class="hljs-string">"cache_db"</span>, <span class="hljs-string">"data"</span>: result, <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.8</span>}
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¼“å­˜æŸ¥è¯¢å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        
        <span class="hljs-comment"># æ–¹æ¡ˆ2ï¼šå¤–éƒ¨æœç´¢ï¼ˆå…œåº•ï¼‰</span>
        <span class="hljs-keyword">try</span>:
            search_query = <span class="hljs-string">f"è®¢å• <span class="hljs-subst">{user_id}</span> <span class="hljs-subst">{order_id <span class="hljs-keyword">if</span> order_id <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>}</span>"</span>
            search_result = self.search_tool.run(search_query)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"source"</span>: <span class="hljs-string">"search"</span>, <span class="hljs-string">"data"</span>: search_result[:<span class="hljs-number">500</span>], <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.5</span>}
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœç´¢æŸ¥è¯¢å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            
        <span class="hljs-comment"># æ‰€æœ‰æ–¹æ¡ˆéƒ½å¤±è´¥</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"source"</span>: <span class="hljs-string">"none"</span>, <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.0</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_retry_query</span>(<span class="hljs-params">self, query_func, max_retries: <span class="hljs-built_in">int</span>, base_delay: <span class="hljs-built_in">float</span></span>):
        <span class="hljs-string">"""å¸¦æŒ‡æ•°é€€é¿çš„é‡è¯•æœºåˆ¶"""</span>
        <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries + <span class="hljs-number">1</span>):
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">return</span> query_func()
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-keyword">if</span> attempt == max_retries:
                    <span class="hljs-keyword">raise</span> e
                delay = base_delay * (<span class="hljs-number">2</span> ** attempt)
                time.sleep(delay)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_should_attempt_recovery</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""æ£€æŸ¥æ˜¯å¦åº”è¯¥å°è¯•æ¢å¤ä¸»æœåŠ¡"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.circuit_breaker[<span class="hljs-string">"last_failure_time"</span>]:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        
        <span class="hljs-comment"># ç­‰å¾…30ç§’åå†å°è¯•</span>
        elapsed = time.time() - self.circuit_breaker[<span class="hljs-string">"last_failure_time"</span>]
        <span class="hljs-keyword">return</span> elapsed &gt; <span class="hljs-number">30</span>
</code></pre>
<h3 data-id="heading-6">2.2 ç½®ä¿¡åº¦æ£€æŸ¥ä¸è‡ªåŠ¨è½¬äººå·¥</h3>
<p>åœ¨å…³é”®å†³ç­–èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥AIè¾“å‡ºçš„ç½®ä¿¡åº¦ï¼Œä½äºé˜ˆå€¼æ—¶è‡ªåŠ¨è½¬äººå·¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfidenceGuard</span>:
    <span class="hljs-string">"""ç½®ä¿¡åº¦æ£€æŸ¥ä¸äººå·¥ä»‹å…¥æ§åˆ¶å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, threshold: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.7</span></span>):
        self.threshold = threshold
        self.human_queue = []  <span class="hljs-comment"># äººå·¥å¤„ç†é˜Ÿåˆ—</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_and_route</span>(<span class="hljs-params">self, state: RefundState, agent_output: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""æ£€æŸ¥ç½®ä¿¡åº¦å¹¶å†³å®šè·¯ç”±"""</span>
        
        confidence = agent_output.get(<span class="hljs-string">"confidence"</span>, <span class="hljs-number">0.5</span>)
        
        <span class="hljs-keyword">if</span> confidence &lt; self.threshold:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç½®ä¿¡åº¦è¿‡ä½ (<span class="hljs-subst">{confidence:<span class="hljs-number">.2</span>f}</span> &lt; <span class="hljs-subst">{self.threshold:<span class="hljs-number">.2</span>f}</span>)ï¼Œè§¦å‘äººå·¥ä»‹å…¥"</span>)
            
            <span class="hljs-comment"># åŠ å…¥äººå·¥é˜Ÿåˆ—</span>
            self.human_queue.append({
                <span class="hljs-string">"state"</span>: state,
                <span class="hljs-string">"agent_output"</span>: agent_output,
                <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
            })
            
            <span class="hljs-comment"># è¿”å›äººå·¥ä»‹å…¥æŒ‡ä»¤</span>
            <span class="hljs-keyword">return</span> {
                **agent_output,
                <span class="hljs-string">"need_human"</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">"routing"</span>: <span class="hljs-string">"human_intervention"</span>,
                <span class="hljs-string">"queue_position"</span>: <span class="hljs-built_in">len</span>(self.human_queue)
            }
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># ç½®ä¿¡åº¦è¶³å¤Ÿï¼Œç»§ç»­è‡ªåŠ¨å¤„ç†</span>
            <span class="hljs-keyword">return</span> {
                **agent_output,
                <span class="hljs-string">"need_human"</span>: <span class="hljs-literal">False</span>,
                <span class="hljs-string">"routing"</span>: <span class="hljs-string">"next_agent"</span>
            }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_human_tasks</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>:
        <span class="hljs-string">"""è·å–å¾…å¤„ç†çš„äººå·¥ä»»åŠ¡"""</span>
        <span class="hljs-keyword">return</span> self.human_queue
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å…¨é“¾è·¯ç›‘æ§ä¸LangSmithé›†æˆ</h2>
<h3 data-id="heading-8">3.1 LangSmithé…ç½®ä¸è¿½è¸ª</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client
<span class="hljs-keyword">from</span> langchain.callbacks.tracers.langchain <span class="hljs-keyword">import</span> LangChainTracer

<span class="hljs-comment"># é…ç½®LangSmithï¼ˆéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼‰</span>
<span class="hljs-comment"># os.environ["LANGCHAIN_TRACING_V2"] = "true"</span>
<span class="hljs-comment"># os.environ["LANGCHAIN_API_KEY"] = "your_api_key"</span>
<span class="hljs-comment"># os.environ["LANGCHAIN_PROJECT"] = "refund-customer-service"</span>

<span class="hljs-comment"># åˆå§‹åŒ–è¿½è¸ªå™¨</span>
tracer = LangChainTracer()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredRefundWorkflow</span>:
    <span class="hljs-string">"""å¸¦ç›‘æ§çš„é€€æ¬¾å·¥ä½œæµ"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, base_workflow</span>):
        self.workflow = base_workflow
        self.client = Client()
        self.metrics = {
            <span class="hljs-string">"total_requests"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"successful_refunds"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"human_interventions"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"avg_confidence"</span>: <span class="hljs-number">0.0</span>,
            <span class="hljs-string">"avg_response_time"</span>: <span class="hljs-number">0.0</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke_with_monitoring</span>(<span class="hljs-params">self, initial_state: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""å¸¦ç›‘æ§çš„æ‰§è¡Œ"""</span>
        start_time = time.time()
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ‰§è¡Œå·¥ä½œæµï¼ˆç”Ÿäº§ç¯å¢ƒä¸­åº”ä¼ å…¥callbacks=[tracer]ï¼‰</span>
            result = self.workflow.invoke(initial_state)
            
            <span class="hljs-comment"># è®°å½•æˆåŠŸæŒ‡æ ‡</span>
            self.metrics[<span class="hljs-string">"total_requests"</span>] += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"refund_result"</span>, {}).get(<span class="hljs-string">"status"</span>) == <span class="hljs-string">"processing"</span>:
                self.metrics[<span class="hljs-string">"successful_refunds"</span>] += <span class="hljs-number">1</span>
            
            <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"need_human"</span>, <span class="hljs-literal">False</span>):
                self.metrics[<span class="hljs-string">"human_interventions"</span>] += <span class="hljs-number">1</span>
            
            <span class="hljs-comment"># è®¡ç®—å¹³å‡ç½®ä¿¡åº¦</span>
            confidence = result.get(<span class="hljs-string">"confidence"</span>, <span class="hljs-number">0.5</span>)
            total = self.metrics[<span class="hljs-string">"total_requests"</span>]
            old_avg = self.metrics[<span class="hljs-string">"avg_confidence"</span>]
            self.metrics[<span class="hljs-string">"avg_confidence"</span>] = (old_avg * (total-<span class="hljs-number">1</span>) + confidence) / total
            
            <span class="hljs-comment"># è®¡ç®—å¹³å‡å“åº”æ—¶é—´</span>
            duration = time.time() - start_time
            old_avg_time = self.metrics[<span class="hljs-string">"avg_response_time"</span>]
            self.metrics[<span class="hljs-string">"avg_response_time"</span>] = (old_avg_time * (total-<span class="hljs-number">1</span>) + duration) / total
            
            <span class="hljs-comment"># å‘LangSmithè®°å½•æŒ‡æ ‡</span>
            self._record_metrics_to_langsmith(result, duration)
            
            <span class="hljs-keyword">return</span> result
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># è®°å½•é”™è¯¯</span>
            self._record_error_to_langsmith(e, initial_state)
            <span class="hljs-keyword">raise</span> e
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_record_metrics_to_langsmith</span>(<span class="hljs-params">self, result: <span class="hljs-built_in">dict</span>, duration: <span class="hljs-built_in">float</span></span>):
        <span class="hljs-string">"""å‘LangSmithè®°å½•æŒ‡æ ‡"""</span>
        <span class="hljs-comment"># å®é™…ç¯å¢ƒä¸­ä½¿ç”¨client.create_feedbackç­‰API</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[LangSmith] è®°å½•æŒ‡æ ‡ - è€—æ—¶: <span class="hljs-subst">{duration:<span class="hljs-number">.2</span>f}</span>s, ç½®ä¿¡åº¦: <span class="hljs-subst">{result.get(<span class="hljs-string">'confidence'</span>, <span class="hljs-number">0</span>):<span class="hljs-number">.2</span>f}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_record_error_to_langsmith</span>(<span class="hljs-params">self, error: Exception, state: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""å‘LangSmithè®°å½•é”™è¯¯"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[LangSmith] è®°å½•é”™è¯¯ - <span class="hljs-subst">{error.__class__.__name__}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(error)}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dashboard_data</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""è·å–ç›‘æ§ä»ªè¡¨æ¿æ•°æ®"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"metrics"</span>: self.metrics,
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
            <span class="hljs-string">"system_health"</span>: self._calculate_system_health()
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_system_health</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""è®¡ç®—ç³»ç»Ÿå¥åº·çŠ¶æ€"""</span>
        success_rate = (self.metrics[<span class="hljs-string">"successful_refunds"</span>] / 
                       <span class="hljs-built_in">max</span>(self.metrics[<span class="hljs-string">"total_requests"</span>], <span class="hljs-number">1</span>))
        
        <span class="hljs-keyword">if</span> success_rate &gt; <span class="hljs-number">0.9</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"healthy"</span>
        <span class="hljs-keyword">elif</span> success_rate &gt; <span class="hljs-number">0.7</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"degraded"</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"critical"</span>
</code></pre>
<h3 data-id="heading-9">3.2 å¯è§†åŒ–ç›‘æ§é¢æ¿ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_monitoring_dashboard</span>(<span class="hljs-params">workflow: MonitoredRefundWorkflow</span>):
    <span class="hljs-string">"""ç”Ÿæˆç›‘æ§ä»ªè¡¨æ¿æ•°æ®"""</span>
    
    data = workflow.get_dashboard_data()
    metrics = data[<span class="hljs-string">"metrics"</span>]
    
    dashboard = <span class="hljs-string">f"""
# å®¢æœç³»ç»Ÿç›‘æ§ä»ªè¡¨æ¿
**æ›´æ–°æ—¶é—´**: <span class="hljs-subst">{data[<span class="hljs-string">'timestamp'</span>]}</span>
**ç³»ç»ŸçŠ¶æ€**: <span class="hljs-subst">{data[<span class="hljs-string">'system_health'</span>].upper()}</span>

## æ ¸å¿ƒæŒ‡æ ‡
| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»è¯·æ±‚æ•° | <span class="hljs-subst">{metrics[<span class="hljs-string">'total_requests'</span>]}</span> |
| æˆåŠŸé€€æ¬¾æ•° | <span class="hljs-subst">{metrics[<span class="hljs-string">'successful_refunds'</span>]}</span> |
| äººå·¥ä»‹å…¥æ¬¡æ•° | <span class="hljs-subst">{metrics[<span class="hljs-string">'human_interventions'</span>]}</span> |
| å¹³å‡ç½®ä¿¡åº¦ | <span class="hljs-subst">{metrics[<span class="hljs-string">'avg_confidence'</span>]:<span class="hljs-number">.2</span>%}</span> |
| å¹³å‡å“åº”æ—¶é—´ | <span class="hljs-subst">{metrics[<span class="hljs-string">'avg_response_time'</span>]:<span class="hljs-number">.2</span>f}</span>s |

## å¥åº·åº¦åˆ†æ
- æˆåŠŸé€€æ¬¾ç‡: <span class="hljs-subst">{(metrics[<span class="hljs-string">'successful_refunds'</span>]/<span class="hljs-built_in">max</span>(metrics[<span class="hljs-string">'total_requests'</span>],<span class="hljs-number">1</span>)):<span class="hljs-number">.2</span>%}</span>
- äººå·¥ä»‹å…¥ç‡: <span class="hljs-subst">{(metrics[<span class="hljs-string">'human_interventions'</span>]/<span class="hljs-built_in">max</span>(metrics[<span class="hljs-string">'total_requests'</span>],<span class="hljs-number">1</span>)):<span class="hljs-number">.2</span>%}</span>
- ç³»ç»Ÿå¯ç”¨æ€§: åŸºäºç½®ä¿¡åº¦é˜ˆå€¼è‡ªåŠ¨ä¿éšœ

## å»ºè®®
<span class="hljs-subst">{<span class="hljs-string">''</span> <span class="hljs-keyword">if</span> data[<span class="hljs-string">'system_health'</span>] == <span class="hljs-string">'healthy'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'âš ï¸ æ£€æµ‹åˆ°ç³»ç»Ÿé™çº§ï¼Œå»ºè®®æ£€æŸ¥ï¼š\n- ä¸»æœåŠ¡APIå¯ç”¨æ€§\n- ç¼“å­˜æ•°æ®åº“åŒæ­¥çŠ¶æ€\n- å¤–éƒ¨å·¥å…·ä¾èµ–'</span>}</span>
"""</span>
    
    <span class="hljs-keyword">return</span> dashboard

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
monitored_workflow = MonitoredRefundWorkflow(app)

<span class="hljs-comment"># æ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚</span>
test_cases = [
    {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"æˆ‘æ˜¯VIPä¼šå‘˜ï¼Œè¦é€€æ¬¾è®¢å•ORD20250124001"</span>},
    {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"æŸ¥è¯¢è®¢å•çŠ¶æ€"</span>},
    {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"é€€æ¬¾å¤„ç†å¤ªæ…¢ï¼Œè½¬äººå·¥"</span>}
]

<span class="hljs-keyword">for</span> i, test_case <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_cases):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æµ‹è¯•ç”¨ä¾‹ <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>: <span class="hljs-subst">{test_case[<span class="hljs-string">'user_input'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    
    result = monitored_workflow.invoke_with_monitoring(test_case)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤„ç†ç»“æœ: <span class="hljs-subst">{result.get(<span class="hljs-string">'current_step'</span>, <span class="hljs-string">'unknown'</span>)}</span>"</span>)
    <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">'need_human'</span>, <span class="hljs-literal">False</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"çŠ¶æ€: å·²è½¬äººå·¥å¤„ç†"</span>)
    <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">'refund_result'</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é€€æ¬¾çŠ¶æ€: <span class="hljs-subst">{result[<span class="hljs-string">'refund_result'</span>].get(<span class="hljs-string">'status'</span>, <span class="hljs-string">'unknown'</span>)}</span>"</span>)

<span class="hljs-comment"># æŸ¥çœ‹ç›‘æ§ä»ªè¡¨æ¿</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç›‘æ§ä»ªè¡¨æ¿"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
dashboard = generate_monitoring_dashboard(monitored_workflow)
<span class="hljs-built_in">print</span>(dashboard)
</code></pre>
<h2 data-id="heading-10">å››ã€å·¥å…·é“¾ç»„åˆç­–ç•¥ä¸prompt-minder.comçš„ä»·å€¼å®šä½</h2>
<p>åœ¨å®é™…çš„AIå·¥ç¨‹åŒ–å®è·µä¸­ï¼ŒLangGraphä¸“æ³¨äºå¤æ‚æµç¨‹çš„ç¼–æ’ä¸çŠ¶æ€ç®¡ç†ï¼Œè€Œprompt-minder.comåˆ™ä¸“æ³¨äºPrompt Engineeringçš„æ ‡å‡†åŒ–ä¸è§„æ¨¡åŒ–ã€‚ä¸¤è€…çš„ç»“åˆå½¢æˆäº†å®Œæ•´çš„AIå·¥å…·é“¾ï¼š</p>
<h3 data-id="heading-11">4.1 äº’è¡¥ä¼˜åŠ¿</h3>




















<table><thead><tr><th>å·¥å…·</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>è§£å†³ç—›ç‚¹</th></tr></thead><tbody><tr><td><strong>LangGraph</strong></td><td>å›¾çŠ¶æ€ç®¡ç†ã€å¤šæ™ºèƒ½ä½“åä½œã€æ¡ä»¶è·¯ç”±ã€å¾ªç¯æ§åˆ¶</td><td>å¤æ‚ä¸šåŠ¡æµç¨‹ç¼–æ’ã€çŠ¶æ€ä¸€è‡´æ€§ã€å¼‚å¸¸æ¢å¤</td></tr><tr><td><strong>prompt-minder.com</strong></td><td>Promptæ¨¡æ¿åº“ã€è´¨é‡è¯„ä¼°ã€ç‰ˆæœ¬æ§åˆ¶ã€å›¢é˜Ÿåä½œ</td><td>Promptè®¾è®¡æ•ˆç‡ã€è¾“å‡ºç¨³å®šæ€§ã€çŸ¥è¯†æ²‰æ·€</td></tr></tbody></table>
<h3 data-id="heading-12">4.2 é›†æˆç¤ºä¾‹</h3>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†prompt-minder.comä½œä¸ºæç¤ºè¯ç®¡ç†ä¸­æ¢ï¼Œä¸ºLangGraphä¸­çš„å„ä¸ªæ™ºèƒ½ä½“æä¾›ç»è¿‡ä¼˜åŒ–å’ŒéªŒè¯çš„æ ‡å‡†æç¤ºæ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PromptMinderIntegration</span>:
    <span class="hljs-string">"""prompt-minder.comé›†æˆç±»"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, api_key: <span class="hljs-built_in">str</span></span>):
        self.api_key = api_key
        self.template_cache = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_optimized_prompt</span>(<span class="hljs-params">self, template_id: <span class="hljs-built_in">str</span>, variables: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""ä»prompt-minder.comè·å–ä¼˜åŒ–åçš„æç¤ºè¯"""</span>
        
        <span class="hljs-comment"># æ£€æŸ¥ç¼“å­˜</span>
        cache_key = <span class="hljs-string">f"<span class="hljs-subst">{template_id}</span>:<span class="hljs-subst">{json.dumps(variables, sort_keys=<span class="hljs-literal">True</span>)}</span>"</span>
        <span class="hljs-keyword">if</span> cache_key <span class="hljs-keyword">in</span> self.template_cache:
            <span class="hljs-keyword">return</span> self.template_cache[cache_key]
        
        <span class="hljs-comment"># æ¨¡æ‹Ÿè°ƒç”¨prompt-minder.com API</span>
        <span class="hljs-comment"># å®é™…å®ç°åº”ä¸ºï¼š</span>
        <span class="hljs-comment"># response = requests.get(</span>
        <span class="hljs-comment">#     f"https://api.prompt-minder.com/templates/{template_id}",</span>
        <span class="hljs-comment">#     params={"variables": json.dumps(variables)},</span>
        <span class="hljs-comment">#     headers={"Authorization": f"Bearer {self.api_key}"}</span>
        <span class="hljs-comment"># )</span>
        
        <span class="hljs-comment"># æ¨¡æ‹Ÿè¿”å›ï¼ˆåŸºäºå¸¸è§ä¼˜åŒ–æ¨¡å¼ï¼‰</span>
        templates = {
            <span class="hljs-string">"auth_verification"</span>: <span class="hljs-string">"""ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å®¢æœèº«ä»½éªŒè¯ä¸“å®¶ã€‚

ç”¨æˆ·è¾“å…¥ï¼š{user_input}

è¯·æ‰§è¡Œä»¥ä¸‹éªŒè¯æ­¥éª¤ï¼š
1. **èº«ä»½è¯†åˆ«**ï¼šä»è¾“å…¥ä¸­æå–ç”¨æˆ·æ ‡è¯†ï¼ˆä¼šå‘˜IDã€æ‰‹æœºå·ã€é‚®ç®±ç­‰ï¼‰
2. **éªŒè¯çº§åˆ«åˆ¤æ–­**ï¼šåŸºäºæå–ä¿¡æ¯åˆ¤æ–­éªŒè¯çº§åˆ«ï¼ˆVIP/æ™®é€š/è®¿å®¢ï¼‰
3. **ç½®ä¿¡åº¦è¯„ä¼°**ï¼šå¯¹éªŒè¯ç»“æœçš„ç½®ä¿¡åº¦è¿›è¡Œ0-1è¯„åˆ†
4. **åç»­å»ºè®®**ï¼šæ ¹æ®ç½®ä¿¡åº¦å†³å®šæ˜¯å¦éœ€äººå·¥å¤æ ¸

è¾“å‡ºæ ¼å¼ï¼š
- ç”¨æˆ·ID: [æå–ç»“æœ]
- éªŒè¯çº§åˆ«: [VIP/æ™®é€š/è®¿å®¢]
- ç½®ä¿¡åº¦: [0.XX]
- å»ºè®®: [è‡ªåŠ¨å¤„ç†/äººå·¥å¤æ ¸]"""</span>,
            
            <span class="hljs-string">"refund_processing"</span>: <span class="hljs-string">"""ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é€€æ¬¾å¤„ç†ä¸“å®¶ã€‚

è®¢å•ä¿¡æ¯ï¼š{order_info}

è¯·æŒ‰ä»¥ä¸‹æµç¨‹å¤„ç†ï¼š
1. **èµ„æ ¼éªŒè¯**ï¼šæ£€æŸ¥è®¢å•æ˜¯å¦æ»¡è¶³é€€æ¬¾æ¡ä»¶ï¼ˆçŠ¶æ€ã€æ—¶é—´ã€é‡‘é¢ï¼‰
2. **é£é™©è¯„ä¼°**ï¼šè¯„ä¼°é€€æ¬¾å¯èƒ½çš„é£é™©ï¼ˆå¼‚å¸¸è¡Œä¸ºã€å†å²è®°å½•ï¼‰
3. **æ–¹æ¡ˆç”Ÿæˆ**ï¼šç”Ÿæˆå…·ä½“é€€æ¬¾æ–¹æ¡ˆï¼ˆé‡‘é¢ã€æ–¹å¼ã€æ—¶é—´é¢„ä¼°ï¼‰
4. **ç¡®è®¤æ£€æŸ¥**ï¼šç¡®ä¿æ–¹æ¡ˆç¬¦åˆå…¬å¸æ”¿ç­–å’Œç”¨æˆ·æƒç›Š

å…³é”®è¦æ±‚ï¼š
- ä¸¥æ ¼éµå¾ªé€€æ¬¾æ”¿ç­–ç¬¬{policy_version}ç‰ˆ
- é«˜é£é™©è®¢å•ï¼ˆé‡‘é¢&gt;{threshold}ï¼‰å¿…é¡»æ ‡æ³¨
- è¾“å‡ºç»“æ„åŒ–JSONï¼Œä¾¿äºç³»ç»Ÿè§£æ"""</span>
        }
        
        template = templates.get(template_id, <span class="hljs-string">"{user_input}"</span>)
        prompt = template.<span class="hljs-built_in">format</span>(**variables)
        
        <span class="hljs-comment"># ç¼“å­˜ç»“æœ</span>
        self.template_cache[cache_key] = prompt
        <span class="hljs-keyword">return</span> prompt
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_prompt_quality</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span>, output: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>]:
        <span class="hljs-string">"""è¯„ä¼°æç¤ºè¯ç”Ÿæˆè´¨é‡"""</span>
        <span class="hljs-comment"># æ¨¡æ‹Ÿprompt-minder.comçš„è´¨é‡è¯„ä¼°API</span>
        <span class="hljs-comment"># å®é™…å®ç°åº”åŒ…æ‹¬ï¼šç›¸å…³æ€§ã€å‡†ç¡®æ€§ã€å®Œæ•´æ€§ç­‰ç»´åº¦</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"relevance_score"</span>: <span class="hljs-number">0.92</span>,
            <span class="hljs-string">"accuracy_score"</span>: <span class="hljs-number">0.88</span>,
            <span class="hljs-string">"completeness_score"</span>: <span class="hljs-number">0.85</span>,
            <span class="hljs-string">"overall_score"</span>: <span class="hljs-number">0.88</span>
        }

<span class="hljs-comment"># åœ¨æ™ºèƒ½ä½“ä¸­ä½¿ç”¨ä¼˜åŒ–åçš„æç¤ºè¯</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">enhanced_auth_agent</span>(<span class="hljs-params">state: RefundState, prompt_minder: PromptMinderIntegration</span>) -&gt; RefundState:
    <span class="hljs-string">"""ä½¿ç”¨prompt-minder.comä¼˜åŒ–æç¤ºè¯çš„èº«ä»½éªŒè¯Agent"""</span>
    
    <span class="hljs-comment"># è·å–ä¼˜åŒ–åçš„æç¤ºè¯</span>
    prompt = prompt_minder.get_optimized_prompt(
        template_id=<span class="hljs-string">"auth_verification"</span>,
        variables={
            <span class="hljs-string">"user_input"</span>: state[<span class="hljs-string">"user_input"</span>],
            <span class="hljs-string">"policy_version"</span>: <span class="hljs-string">"2025.01"</span>,
            <span class="hljs-string">"threshold"</span>: <span class="hljs-number">500</span>
        }
    )
    
    <span class="hljs-comment"># è°ƒç”¨LLMï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰</span>
    <span class="hljs-comment"># å®é™…å®ç°åº”ä½¿ç”¨langchainçš„LLMè°ƒç”¨</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä½¿ç”¨ä¼˜åŒ–æç¤ºè¯:\n<span class="hljs-subst">{prompt[:<span class="hljs-number">200</span>]}</span>..."</span>)
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿå¤„ç†ç»“æœ</span>
    <span class="hljs-comment"># ... å®é™…LLMè°ƒç”¨é€»è¾‘</span>
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"auth_result"</span>: {<span class="hljs-string">"status"</span>: <span class="hljs-string">"enhanced_auth"</span>, <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.95</span>},
        <span class="hljs-string">"current_step"</span>: <span class="hljs-string">"enhanced_auth_complete"</span>
    }
</code></pre>
<h3 data-id="heading-13">4.3 ä»·å€¼æå‡</h3>
<p>é€šè¿‡LangGraphä¸prompt-minder.comçš„é›†æˆï¼Œä¼ä¸šå¯ä»¥å®ç°ï¼š</p>
<ol>
<li><strong>æ•ˆç‡æå‡300%</strong>ï¼šæ ‡å‡†åŒ–Promptæ¨¡æ¿å‡å°‘é‡å¤è®¾è®¡å·¥ä½œï¼Œå¤æ‚å·¥ä½œæµå¼€å‘å‘¨æœŸå¤§å¹…ç¼©çŸ­</li>
<li><strong>è´¨é‡ä¸€è‡´æ€§</strong>ï¼šç»è¿‡éªŒè¯çš„Promptæ¨¡æ¿ç¡®ä¿ä¸åŒæ™ºèƒ½ä½“è¾“å‡ºçš„ä¸“ä¸šåº¦å’Œå‡†ç¡®æ€§</li>
<li><strong>å¯ç»´æŠ¤æ€§å¢å¼º</strong>ï¼šé›†ä¸­åŒ–çš„Promptç®¡ç†ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå›¢é˜ŸçŸ¥è¯†æ²‰æ·€</li>
<li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šé«˜è´¨é‡Promptå‡å°‘æ— æ•ˆLLMè°ƒç”¨ï¼Œç›´æ¥é™ä½APIæˆæœ¬</li>
</ol>
<h2 data-id="heading-14">äº”ã€å®Œæ•´è¿è¡Œç¤ºä¾‹</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_complete_example</span>():
    <span class="hljs-string">"""å®Œæ•´è¿è¡Œç¤ºä¾‹"""</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸš€ å¯åŠ¨å¯è‡ªæ„ˆçš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿ..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># 1. æ„å»ºåŸºç¡€å·¥ä½œæµ</span>
    app = build_refund_workflow()
    
    <span class="hljs-comment"># 2. é›†æˆç›‘æ§</span>
    monitored_workflow = MonitoredRefundWorkflow(app)
    
    <span class="hljs-comment"># 3. é›†æˆprompt-minder.comï¼ˆæ¨¡æ‹Ÿï¼‰</span>
    prompt_minder = PromptMinderIntegration(api_key=<span class="hljs-string">"simulated_key"</span>)
    
    <span class="hljs-comment"># 4. æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯</span>
    scenarios = [
        {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"VIPç”¨æˆ·å¿«é€Ÿé€€æ¬¾"</span>,
            <span class="hljs-string">"input"</span>: {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"æˆ‘æ˜¯VIPä¼šå‘˜ï¼Œè®¢å•ORD20250124001éœ€è¦é€€æ¬¾"</span>},
            <span class="hljs-string">"expected"</span>: <span class="hljs-string">"è‡ªåŠ¨å¤„ç†å®Œæˆ"</span>
        },
        {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"ä½ç½®ä¿¡åº¦è½¬äººå·¥"</span>,
            <span class="hljs-string">"input"</span>: {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"æˆ‘è¦é€€æ¬¾"</span>},
            <span class="hljs-string">"expected"</span>: <span class="hljs-string">"äººå·¥ä»‹å…¥"</span>
        },
        {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"æ— å¯é€€æ¬¾è®¢å•"</span>,
            <span class="hljs-string">"input"</span>: {<span class="hljs-string">"user_input"</span>: <span class="hljs-string">"é€€æ¬¾è®¢å•ORD20250123001"</span>},
            <span class="hljs-string">"expected"</span>: <span class="hljs-string">"æµç¨‹ç»“æŸ"</span>
        }
    ]
    
    <span class="hljs-keyword">for</span> scenario <span class="hljs-keyword">in</span> scenarios:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ“‹ åœºæ™¯: <span class="hljs-subst">{scenario[<span class="hljs-string">'name'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·è¾“å…¥: <span class="hljs-subst">{scenario[<span class="hljs-string">'input'</span>][<span class="hljs-string">'user_input'</span>]}</span>"</span>)
        
        <span class="hljs-keyword">try</span>:
            result = monitored_workflow.invoke_with_monitoring(scenario[<span class="hljs-string">"input"</span>])
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å½“å‰æ­¥éª¤: <span class="hljs-subst">{result.get(<span class="hljs-string">'current_step'</span>, <span class="hljs-string">'unknown'</span>)}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ˜¯å¦éœ€è¦äººå·¥: <span class="hljs-subst">{<span class="hljs-string">'æ˜¯'</span> <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">'need_human'</span>, <span class="hljs-literal">False</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">'å¦'</span>}</span>"</span>)
            
            <span class="hljs-keyword">if</span> result.get(<span class="hljs-string">'refund_result'</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é€€æ¬¾çŠ¶æ€: <span class="hljs-subst">{result[<span class="hljs-string">'refund_result'</span>].get(<span class="hljs-string">'status'</span>, <span class="hljs-string">'unknown'</span>)}</span>"</span>)
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ‰§è¡Œå®Œæˆ - ç¬¦åˆé¢„æœŸ: <span class="hljs-subst">{scenario[<span class="hljs-string">'expected'</span>]}</span>"</span>)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ‰§è¡Œå¼‚å¸¸: <span class="hljs-subst">{e}</span>"</span>)
    
    <span class="hljs-comment"># 5. å±•ç¤ºç›‘æ§æ•°æ®</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ“Š ç³»ç»Ÿç›‘æ§æ±‡æ€»:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»è¯·æ±‚æ•°: <span class="hljs-subst">{monitored_workflow.metrics[<span class="hljs-string">'total_requests'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸé€€æ¬¾ç‡: <span class="hljs-subst">{monitored_workflow.metrics[<span class="hljs-string">'successful_refunds'</span>]/<span class="hljs-built_in">max</span>(monitored_workflow.metrics[<span class="hljs-string">'total_requests'</span>],<span class="hljs-number">1</span>):<span class="hljs-number">.2</span>%}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"äººå·¥ä»‹å…¥ç‡: <span class="hljs-subst">{monitored_workflow.metrics[<span class="hljs-string">'human_interventions'</span>]/<span class="hljs-built_in">max</span>(monitored_workflow.metrics[<span class="hljs-string">'total_requests'</span>],<span class="hljs-number">1</span>):<span class="hljs-number">.2</span>%}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¹³å‡ç½®ä¿¡åº¦: <span class="hljs-subst">{monitored_workflow.metrics[<span class="hljs-string">'avg_confidence'</span>]:<span class="hljs-number">.2</span>%}</span>"</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ¯ ç³»ç»Ÿå¥åº·çŠ¶æ€: <span class="hljs-subst">{monitored_workflow.get_dashboard_data()[<span class="hljs-string">'system_health'</span>].upper()}</span>"</span>)

<span class="hljs-comment"># æ‰§è¡Œå®Œæ•´ç¤ºä¾‹</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    run_complete_example()
</code></pre>
<h2 data-id="heading-15">å…­ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<p>é€šè¿‡æœ¬å®æˆ˜æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å®Œæ•´å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨LangGraphæ„å»ºå…·å¤‡è‡ªæ„ˆèƒ½åŠ›çš„å¤šæ™ºèƒ½ä½“å®¢æœç³»ç»Ÿã€‚å…³é”®æ”¶è·åŒ…æ‹¬ï¼š</p>
<h3 data-id="heading-16">6.1 æŠ€æœ¯è¦ç‚¹æ€»ç»“</h3>
<ol>
<li><strong>çŠ¶æ€å›¾è®¾è®¡</strong>ï¼šä½¿ç”¨TypedDictæ˜ç¡®å®šä¹‰çŠ¶æ€ç»“æ„ï¼Œé€šè¿‡èŠ‚ç‚¹é—´çš„çŠ¶æ€æµè½¬å®ç°å¤æ‚åä½œ</li>
<li><strong>å®¹é”™æœºåˆ¶</strong>ï¼šç»“åˆå¤‡ç”¨å·¥å…·ã€ç†”æ–­å™¨ã€ç½®ä¿¡åº¦æ£€æŸ¥æ„å»ºå¤šå±‚çº§å®¹é”™ä½“ç³»</li>
<li><strong>ç›‘æ§é›†æˆ</strong>ï¼šé€šè¿‡LangSmithå®ç°å…¨é“¾è·¯å¯è§‚æµ‹æ€§ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ</li>
<li><strong>å·¥å…·é“¾ç»„åˆ</strong>ï¼šLangGraphä¸“æ³¨æµç¨‹ç¼–æ’ï¼Œprompt-minder.comä¸“æ³¨Promptä¼˜åŒ–ï¼Œä¸¤è€…å½¢æˆäº’è¡¥</li>
</ol>
<h3 data-id="heading-17">6.2 ç”Ÿäº§ç¯å¢ƒå»ºè®®</h3>
<ol>
<li><strong>é€æ­¥å¤æ‚åŒ–</strong>ï¼šä»ç®€å•æµç¨‹å¼€å§‹éªŒè¯ï¼Œé€æ­¥å¢åŠ æ™ºèƒ½ä½“å’Œåˆ†æ”¯é€»è¾‘</li>
<li><strong>å…¨é¢ç›‘æ§</strong>ï¼šé™¤äº†LangSmithï¼Œè¿˜åº”é›†æˆåº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰å’Œæ—¥å¿—èšåˆç³»ç»Ÿ</li>
<li><strong>ç°åº¦å‘å¸ƒ</strong>ï¼šæ–°ç‰ˆæœ¬çš„å·¥ä½œæµåº”å…ˆåœ¨å°æµé‡ç¯å¢ƒéªŒè¯ï¼Œå†é€æ­¥å…¨é‡</li>
<li><strong>å®šæœŸæ¼”ç»ƒ</strong>ï¼šæ¨¡æ‹Ÿå„ç§æ•…éšœåœºæ™¯ï¼ŒéªŒè¯ç³»ç»Ÿçš„è‡ªæ„ˆèƒ½åŠ›å’Œæ¢å¤æ—¶é—´</li>
</ol>
<h3 data-id="heading-18">6.3 æ‰©å±•æ–¹å‘</h3>
<ol>
<li><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼šé›†æˆå›¾åƒè¯†åˆ«ã€è¯­éŸ³å¤„ç†ç­‰èƒ½åŠ›ï¼Œæä¾›æ›´ä¸°å¯Œçš„å®¢æœä½“éªŒ</li>
<li><strong>å®æ—¶å­¦ä¹ </strong>ï¼šåŸºäºç”¨æˆ·åé¦ˆåŠ¨æ€ä¼˜åŒ–Promptå’Œå·¥ä½œæµé€»è¾‘</li>
<li><strong>è¾¹ç¼˜éƒ¨ç½²</strong>ï¼šåœ¨é è¿‘ç”¨æˆ·ä¾§éƒ¨ç½²è½»é‡çº§å·¥ä½œæµå¼•æ“ï¼Œé™ä½å»¶è¿Ÿ</li>
<li><strong>è‡ªæ²»ç³»ç»Ÿ</strong>ï¼šæ™ºèƒ½ä½“è‡ªä¸»å‘ç°ä¼˜åŒ–ç‚¹ï¼Œå®ç°å·¥ä½œæµçš„æŒç»­è‡ªæˆ‘è¿›åŒ–</li>
</ol>
<p>IndieAIå›¢é˜Ÿä¸“æ³¨äºAIå·¥ç¨‹å®è·µï¼Œé€šè¿‡æŠ€æœ¯åšå®¢åˆ†äº«Prompt Engineeringã€å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç­‰é¢†åŸŸçš„å®æˆ˜ç»éªŒã€‚ æŠ€æœ¯äº¤æµï¼šè®¿é—®indieai.blog.csdn.net äº§å“ä½“éªŒï¼šprompt-minder.com ç‰ˆæƒå£°æ˜ï¼šCC BY-NC-SA 4.0</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‰ˆæœ¬å·¥å…·gitä¹‹ä½¿ç”¨ `git reset` å’Œ `git push -f` çš„æ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7598435950410530826</link>    <guid>https://juejin.cn/post/7598435950410530826</guid>    <pubDate>2026-01-24T03:42:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950410530826" data-draft-id="7589509638339952666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ç‰ˆæœ¬å·¥å…·gitä¹‹ä½¿ç”¨ `git reset` å’Œ `git push -f` çš„æ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2026-01-24T03:42:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ç‰ˆæœ¬å·¥å…·gitä¹‹ä½¿ç”¨ `git reset` å’Œ `git push -f` çš„æ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:42:21.000Z" title="Sat Jan 24 2026 03:42:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹æäº¤å†å²è¿›è¡Œç®¡ç†ã€‚æœ‰æ—¶ä¸ºäº†æ¸…ç†æäº¤è®°å½•æˆ–è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨ <code>git reset</code> å‘½ä»¤ï¼Œä¹‹åå†é€šè¿‡ <code>git push -f</code> å¼ºåˆ¶æ¨é€æ›´æ”¹ã€‚<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd261d1711324ceea51c63838096e882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830941&amp;x-signature=msfd0vpmMieNMS9EP8bejOCQNmU%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf17e0953764ea38f09575c218286ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830941&amp;x-signature=HdKStX4%2F7TLGw%2Fg8rG5tS96QOD0%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨ä»¥åŠå®ƒä»¬å¯¹ Git æäº¤å†å²çš„å½±å“ã€‚<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0138593d72a420095498bca59d462a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830941&amp;x-signature=kFhw3mER1OVJxYtfNNrOjAVWbRc%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<h2 data-id="heading-0">ä¸€ã€<code>git reset</code> çš„åŸºæœ¬ç”¨æ³•</h2>
<p><code>git reset</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ Git å‘½ä»¤ï¼Œç”¨äºé‡ç½®å½“å‰åˆ†æ”¯åˆ°æŒ‡å®šçš„çŠ¶æ€ã€‚å®ƒæœ‰å¤šç§æ¨¡å¼ï¼š<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e30f949e8a614d66a81a2e6eda77c56c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830941&amp;x-signature=UYxsmredatZB30QzMNRO4%2B6H81o%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<ol>
<li>
<p><strong>soft</strong>ï¼šä»…é‡ç½® HEAD æŒ‡é’ˆï¼Œä¿ç•™æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•çš„æ›´æ”¹ã€‚<br/>
<code>bash   Â  Â git reset --soft &lt;commit&gt;   Â  Â </code></p>
</li>
<li>
<p><strong>mixed</strong>ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼šé‡ç½® HEAD å’Œæš‚å­˜åŒºï¼Œä½†ä¿ç•™å·¥ä½œç›®å½•çš„æ›´æ”¹ã€‚<br/>
<code>bash   Â  Â git reset &lt;commit&gt;   Â  Â </code></p>
</li>
<li>
<p><strong>hard</strong>ï¼šé‡ç½® HEADã€æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•ï¼Œæ‰€æœ‰æœªæäº¤çš„æ›´æ”¹éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚<br/>
<code>bash   Â  Â git reset --hard &lt;commit&gt;   Â  Â </code></p>
</li>
</ol>
<h3 data-id="heading-1">ä¾‹å­</h3>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³é‡ç½®åˆ°æŸä¸ªç‰¹å®šçš„æäº¤ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git reset --hard abc1234  
</code></pre>
<p>è¿™å°†ä½¿ä½ çš„åˆ†æ”¯å›é€€åˆ°æäº¤ <code>abc1234</code> çš„çŠ¶æ€ï¼Œå¹¶ä¸”æ‰€æœ‰åç»­çš„æäº¤éƒ½å°†è¢«åˆ é™¤ã€‚</p>
<h2 data-id="heading-2">äºŒã€<code>git push -f</code> çš„ä½œç”¨</h2>
<p>å½“ä½ åœ¨æœ¬åœ°æ‰§è¡Œäº† <code>git reset</code> åï¼Œä½ çš„æœ¬åœ°æäº¤å†å²å¯èƒ½ä¼šä¸è¿œç¨‹ä»“åº“ä¸åŒã€‚å¦‚æœä½ å¸Œæœ›å°†æœ¬åœ°çš„çŠ¶æ€å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ <code>git push -f</code>ï¼ˆæˆ– <code>--force</code>ï¼‰å‘½ä»¤ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">git push -f origin &lt;branch&gt;  
</code></pre>
<p>è¿™æ¡å‘½ä»¤ä¼šå¼ºåˆ¶å°†ä½ æœ¬åœ°åˆ†æ”¯çš„çŠ¶æ€è¦†ç›–è¿œç¨‹åˆ†æ”¯çš„çŠ¶æ€ã€‚</p>
<h2 data-id="heading-3">ä¸‰ã€åˆ é™¤ Git æ—¥å¿—ä¸­çš„è®°å½•</h2>
<h3 data-id="heading-4">1. ä¸ºä»€ä¹ˆä¼šåˆ é™¤è®°å½•ï¼Ÿ</h3>
<p>å½“ä½ ä½¿ç”¨ <code>git reset</code> å°†åˆ†æ”¯é‡ç½®åˆ°æŸä¸ªå†å²æäº¤ï¼Œå¹¶éšåæ‰§è¡Œ <code>git push -f</code> æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†è¿œç¨‹åˆ†æ”¯çš„æäº¤å†å²æ›¿æ¢ä¸ºæœ¬åœ°åˆ†æ”¯çš„æäº¤å†å²ã€‚å¦‚æœæœ¬åœ°åˆ†æ”¯å†å²ä¸Šæœ‰ä¸€äº›æäº¤å·²ç»è¢«é‡ç½®ï¼ˆä¾‹å¦‚ï¼Œä½ ä½¿ç”¨äº† <code>git reset --hard</code>ï¼‰ï¼Œè¿™äº›æäº¤å°±åœ¨è¿œç¨‹åˆ†æ”¯ä¸Šæ¶ˆå¤±äº†ï¼Œä»è€Œå¯¼è‡´ Git æ—¥å¿—ä¸­çœ‹ä¸åˆ°è¿™äº›æäº¤è®°å½•ã€‚<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b2dc7796ea473b8537e69357d9b4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830941&amp;x-signature=dR%2FQ1RyxT7mr%2Fx91A%2BcfSE02FJo%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<h3 data-id="heading-5">2. ç¤ºä¾‹è¿‡ç¨‹</h3>
<p>å‡è®¾ä½ çš„æäº¤å†å²å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span> b1 (HEAD -&gt; master)  
<span class="hljs-bullet">*</span> b2  
<span class="hljs-bullet">*</span> b3  
<span class="hljs-bullet">*</span> b4  
</code></pre>
<p>å¦‚æœä½ æ‰§è¡Œ <code>git reset --hard b2</code>ï¼Œç°åœ¨ä½ çš„æœ¬åœ°æäº¤å†å²å˜æˆï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span> b2 (HEAD -&gt; master)  
</code></pre>
<p>ç„¶åï¼Œè¿è¡Œ <code>git push -f</code> ä¼šå¯¼è‡´è¿œç¨‹åˆ†æ”¯çš„æäº¤å†å²ä¹Ÿå˜æˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash">* b2 (origin/master)  
</code></pre>
<p>ç»“æœæ˜¯ï¼Œæäº¤ <code>b3</code> å’Œ <code>b4</code> ä¼šä»è¿œç¨‹ä»“åº“ä¸­æ¶ˆå¤±ï¼ŒGit æ—¥å¿—ä¸­ä¸å†æ˜¾ç¤ºè¿™äº›è®°å½•ã€‚</p>
<h2 data-id="heading-6">å››ã€å¦‚ä½•é¿å…åˆ é™¤è®°å½•</h2>
<ol>
<li>
<p><strong>å¤‡ä»½æäº¤</strong>ï¼šåœ¨æ‰§è¡Œ <code>git reset</code> ä¹‹å‰ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶åˆ†æ”¯ï¼Œä»¥å¤‡ä»½å½“å‰çš„æäº¤å†å²ï¼š<br/>
<code>bash   Â  Â git branch backup-branch   Â  Â </code></p>
</li>
<li>
<p><strong>ä½¿ç”¨ <code>git revert</code></strong>ï¼šå¦‚æœä½ çš„ç›®çš„æ˜¯æ’¤é”€æŸæ¬¡æäº¤ï¼Œè€Œä¸æ˜¯å®Œå…¨åˆ é™¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>git revert</code> å‘½ä»¤ã€‚æ­¤å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤ï¼Œåè½¬ä¹‹å‰çš„æ›´æ”¹ï¼Œè€Œä¸ä¼šåˆ é™¤å†å²è®°å½•ï¼š<br/>
<code>bash   Â  Â git revert &lt;commit&gt;   Â  Â </code></p>
</li>
<li>
<p><strong>å°å¿ƒä½¿ç”¨ <code>-f</code></strong>ï¼šå¼ºåˆ¶æ¨é€ (<code>git push -f</code>) è¦è°¨æ…ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å›¢é˜Ÿåˆä½œçš„ç¯å¢ƒä¸­ï¼Œåº”è¯¥ç¡®ä¿å…¶ä»–äººæ²¡æœ‰ä¾èµ–äºä½ è¦åˆ é™¤çš„æäº¤ã€‚</p>
</li>
</ol>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>åœ¨ Git ä¸­ï¼Œ<code>git reset</code> å’Œ <code>git push -f</code> æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œä½†ä¹Ÿå…·æœ‰æ½œåœ¨çš„é£é™©ã€‚ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬ä¼šå½±å“æäº¤å†å²ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚åœ¨æ‰§è¡Œé‡ç½®å’Œå¼ºåˆ¶æ¨é€ä¹‹å‰ï¼ŒåŠ¡å¿…ç¡®è®¤è‡ªå·±çš„æ„å›¾ï¼Œä»¥åŠæ˜¯å¦éœ€è¦ä¿ç•™æŸäº›æäº¤è®°å½•ã€‚ç†è§£è¿™äº›å‘½ä»¤çš„å·¥ä½œåŸç†èƒ½å¤Ÿå¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ç®¡ç†é¡¹ç›®çš„ç‰ˆæœ¬å†å²ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬4ç« ã€ç®€å•æ•°æ®ç±»å‹è¯¦è§£â€”â€”æ•´å‹ã€æµ®ç‚¹ã€å¸ƒå°”ä¸å­—ç¬¦ä¸²]]></title>    <link>https://juejin.cn/post/7598024433911513142</link>    <guid>https://juejin.cn/post/7598024433911513142</guid>    <pubDate>2026-01-23T00:38:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598024433911513142" data-draft-id="7598003935426199595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬4ç« ã€ç®€å•æ•°æ®ç±»å‹è¯¦è§£â€”â€”æ•´å‹ã€æµ®ç‚¹ã€å¸ƒå°”ä¸å­—ç¬¦ä¸²"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2026-01-23T00:38:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€•æµªçŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬4ç« ã€ç®€å•æ•°æ®ç±»å‹è¯¦è§£â€”â€”æ•´å‹ã€æµ®ç‚¹ã€å¸ƒå°”ä¸å­—ç¬¦ä¸²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€•æµªçŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T00:38:36.000Z" title="Fri Jan 23 2026 00:38:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï½ ä¸Šä¸€ç« æˆ‘ä»¬åˆæ­¥è®¤è¯†äº†Goçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä»Šå¤©æˆ‘ä»¬æ·±å…¥æ‹†è§£æœ€å¸¸ç”¨çš„å››ç±»ç®€å•æ•°æ®ç±»å‹ï¼š<strong>æ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹ã€å­—ç¬¦ä¸²</strong>ã€‚è¿™å››ç±»ç±»å‹æ˜¯æ—¥å¸¸å¼€å‘çš„â€œåŸºçŸ³â€ï¼ŒæŒæ¡å®ƒä»¬çš„ç»†èŠ‚ï¼ˆæ¯”å¦‚æ•´å‹çš„é•¿åº¦å·®å¼‚ã€å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ã€UTF-8ç¼–ç é—®é¢˜ï¼‰ï¼Œèƒ½å¸®ä½ é¿å¼€å¾ˆå¤šå‘ï¼Œå†™å‡ºæ›´é«˜æ•ˆã€æ›´å¥å£®çš„ä»£ç ã€‚</p>
<p>æœ¬æ–‡ä¼šç»“åˆå…·ä½“åœºæ™¯å’Œä»£ç ç¤ºä¾‹ï¼ŒæŠŠæ¯ä¸ªç±»å‹çš„æ ¸å¿ƒç‰¹æ€§ã€ä½¿ç”¨æ³¨æ„äº‹é¡¹è®²é€ï¼Œè¿˜ä¼šè¡¥å……æ€§èƒ½ä¼˜åŒ–ç‚¹å’Œå®ç”¨å·¥å…·ï¼Œå»ºè®®è¾¹çœ‹è¾¹æ•²ä»£ç éªŒè¯ï¼ŒåŠ æ·±ç†è§£ã€‚</p>
<h2 data-id="heading-0">1. æ•´å‹ç±»å‹ï¼šintã€int8ã€int32ã€int64</h2>
<p>æ•´å‹æ˜¯ç”¨æ¥å­˜å‚¨æ•´æ•°çš„ç±»å‹ï¼ŒGoæä¾›äº†å¤šç§â€œå¸¦é•¿åº¦â€çš„æ•´å‹ï¼Œæ ¸å¿ƒå·®å¼‚åœ¨äº<strong>å–å€¼èŒƒå›´</strong>å’Œ<strong>å†…å­˜å ç”¨</strong>ã€‚æ—¥å¸¸å¼€å‘ä¸­æœ€å®¹æ˜“æ··æ·†çš„å°±æ˜¯<code>int</code>å’Œ<code>int32/int64</code>ï¼Œæˆ‘ä»¬å…ˆæŠŠå®ƒä»¬çš„åŒºåˆ«è®²æ¸…æ¥šã€‚</p>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”</h3>
<p>Goçš„æœ‰ç¬¦å·æ•´å‹æŒ‰é•¿åº¦åˆ†ä¸º4ç±»ï¼Œå…³é”®ä¿¡æ¯å¦‚ä¸‹è¡¨ï¼š</p>









































<table><thead><tr><th>ç±»å‹</th><th>å†…å­˜å ç”¨ï¼ˆå­—èŠ‚ï¼‰</th><th>å–å€¼èŒƒå›´</th><th>æ ¸å¿ƒç‰¹ç‚¹</th></tr></thead><tbody><tr><td>int8</td><td>1</td><td>-128 ~ 127</td><td>æœ€å°çš„æœ‰ç¬¦å·æ•´å‹ï¼Œé€‚åˆå­˜å‚¨å°èŒƒå›´æ•´æ•°ï¼ˆå¦‚çŠ¶æ€ç ã€æšä¸¾å€¼ï¼‰</td></tr><tr><td>int16</td><td>2</td><td>-32768 ~ 32767</td><td>é€‚ç”¨äºä¸­ç­‰èŒƒå›´æ•´æ•°ï¼ˆå¦‚çŸ­å­—ç¬¦ä¸²é•¿åº¦ã€å°æ•°é‡çº§è®¡æ•°ï¼‰</td></tr><tr><td>int32</td><td>4</td><td>-2147483648 ~ 2147483647</td><td>å¸¸ç”¨ç±»å‹ï¼Œå¯¹åº”Cè¯­è¨€çš„intï¼Œé€‚åˆå¤§å¤šæ•°è®¡æ•°åœºæ™¯ï¼ˆå¦‚æ•°ç»„ç´¢å¼•ã€ç”¨æˆ·IDï¼‰</td></tr><tr><td>int64</td><td>8</td><td>-9223372036854775808 ~ 9223372036854775807</td><td>å¤§èŒƒå›´æ•´æ•°ï¼Œé€‚åˆå­˜å‚¨å¤§æ•°å€¼ï¼ˆå¦‚æ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€å¤§æ•°æ®é‡è®¡æ•°ï¼‰</td></tr><tr><td>int</td><td>32ä½ç³»ç»Ÿ4å­—èŠ‚ï¼Œ64ä½ç³»ç»Ÿ8å­—èŠ‚</td><td>éšç³»ç»Ÿå˜åŒ–</td><td>é»˜è®¤æ•´å‹ï¼Œå…¼å®¹æ€§å¥½ï¼Œä½†è·¨å¹³å°å¯èƒ½æœ‰é—®é¢˜ï¼ˆä¸æ¨èç”¨äºç²¾ç¡®æ•°å€¼å­˜å‚¨ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 å®æˆ˜é€‰å‹å»ºè®®</h3>
<p>å¾ˆå¤šæ–°æ‰‹ä¹ æƒ¯ç”¨é»˜è®¤çš„<code>int</code>ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºäº†ä»£ç çš„<strong>è·¨å¹³å°ä¸€è‡´æ€§</strong>å’Œ<strong>å†…å­˜ä¼˜åŒ–</strong>ï¼Œæ›´æ¨èæ˜ç¡®æŒ‡å®šæ•´å‹é•¿åº¦ï¼š</p>
<ul>
<li>
<p>å­˜å‚¨å°èŒƒå›´æ•´æ•°ï¼ˆå¦‚0-100çš„çŠ¶æ€ç ï¼‰ï¼šç”¨<code>int8</code>ï¼ŒèŠ‚çœå†…å­˜ï¼›</p>
</li>
<li>
<p>æ™®é€šè®¡æ•°åœºæ™¯ï¼ˆå¦‚å¾ªç¯æ¬¡æ•°ã€åˆ—è¡¨é•¿åº¦ï¼‰ï¼šç”¨<code>int32</code>ï¼Œå…¼é¡¾å†…å­˜å’ŒèŒƒå›´ï¼›</p>
</li>
<li>
<p>å­˜å‚¨å¤§æ•°å€¼ï¼ˆå¦‚æ—¶é—´æˆ³ï¼ˆtime.Timeçš„UnixNanoè¿”å›int64ï¼‰ã€æ–‡ä»¶å¤§å°ï¼‰ï¼šå¿…é¡»ç”¨<code>int64</code>ï¼Œé¿å…æº¢å‡ºï¼›</p>
</li>
<li>
<p>è·¨å¹³å°é¡¹ç›®ï¼šç»å¯¹ä¸è¦ç”¨<code>int</code>å­˜å‚¨éœ€è¦ç²¾ç¡®ä¼ é€’çš„æ•°å€¼ï¼ˆå¦‚RPCæ¥å£å‚æ•°ï¼‰ï¼Œé˜²æ­¢32ä½å’Œ64ä½ç³»ç»Ÿé—´æ•°æ®æˆªæ–­ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">1.3 ä»£ç ç¤ºä¾‹ï¼šæ•´å‹çš„ä½¿ç”¨ä¸æº¢å‡ºé—®é¢˜</h3>
<p>æ•´å‹æº¢å‡ºæ˜¯å¸¸è§bugï¼Œå°¤å…¶æ˜¯åœ¨å¾ªç¯æˆ–æ•°å€¼è®¡ç®—ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. æ˜ç¡®ç±»å‹çš„æ•´å‹ä½¿ç”¨</span>
    <span class="hljs-keyword">var</span> status <span class="hljs-type">int8</span> = <span class="hljs-number">0</span>  <span class="hljs-comment">// çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œ1-å¤±è´¥</span>
    <span class="hljs-keyword">var</span> userID <span class="hljs-type">int32</span> = <span class="hljs-number">10001</span>  <span class="hljs-comment">// ç”¨æˆ·ID</span>
    <span class="hljs-keyword">var</span> fileSize <span class="hljs-type">int64</span> = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>  <span class="hljs-comment">// 1GBæ–‡ä»¶å¤§å°</span>

    fmt.Println(status, userID, fileSize)  <span class="hljs-comment">// è¾“å‡ºï¼š0 10001 1073741824</span>

    <span class="hljs-comment">// 2. æº¢å‡ºé—®é¢˜æ¼”ç¤ºï¼ˆint8çš„æœ€å¤§å€¼æ˜¯127ï¼‰</span>
    <span class="hljs-keyword">var</span> maxInt8 <span class="hljs-type">int8</span> = <span class="hljs-number">127</span>
    maxInt8++  <span class="hljs-comment">// æº¢å‡ºï¼š127 + 1 = -128ï¼ˆäºŒè¿›åˆ¶è¡¥ç æº¢å‡ºç‰¹æ€§ï¼‰</span>
    fmt.Println(<span class="hljs-string">"int8æº¢å‡ºåï¼š"</span>, maxInt8)  <span class="hljs-comment">// è¾“å‡ºï¼šint8æº¢å‡ºåï¼š-128</span>

    <span class="hljs-comment">// 3. é¿å…æº¢å‡ºï¼šç”¨æ›´å¤§èŒƒå›´çš„ç±»å‹</span>
    <span class="hljs-keyword">var</span> num <span class="hljs-type">int32</span> = <span class="hljs-number">2147483647</span>
    <span class="hljs-comment">// num++  // è‹¥ç”¨int32ï¼Œæº¢å‡ºåä¼šå˜æˆ-2147483648</span>
    <span class="hljs-keyword">var</span> bigNum <span class="hljs-type">int64</span> = <span class="hljs-type">int64</span>(num) + <span class="hljs-number">1</span>  <span class="hljs-comment">// è½¬ä¸ºint64åè®¡ç®—ï¼Œé¿å…æº¢å‡º</span>
    fmt.Println(<span class="hljs-string">"int64è®¡ç®—åï¼š"</span>, bigNum)  <span class="hljs-comment">// è¾“å‡ºï¼šint64è®¡ç®—åï¼š2147483648</span>
}

</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šGoä¸ä¼šè‡ªåŠ¨æ£€æµ‹æ•´å‹æº¢å‡ºï¼Œæº¢å‡ºåä¼šæŒ‰ç…§äºŒè¿›åˆ¶è¡¥ç è§„åˆ™å¾ªç¯ï¼ˆæ­£æ•°æº¢å‡ºå˜è´Ÿæ•°ï¼Œè´Ÿæ•°æº¢å‡ºå˜æ­£æ•°ï¼‰ï¼Œå¼€å‘æ—¶éœ€æå‰è¯„ä¼°æ•°å€¼èŒƒå›´ï¼Œé¿å…æº¢å‡ºã€‚</p>
<h2 data-id="heading-4">2. æ— ç¬¦å·æ•´å‹ä¸å†…å­˜å ç”¨</h2>
<p>æ— ç¬¦å·æ•´å‹ï¼ˆuintç³»åˆ—ï¼‰åªèƒ½å­˜å‚¨éè´Ÿæ•´æ•°ï¼Œå–å€¼èŒƒå›´æ˜¯<code>0 ~ 2^n - 1</code>ï¼ˆnæ˜¯ä½æ•°ï¼‰ã€‚å’Œæœ‰ç¬¦å·æ•´å‹ç›¸æ¯”ï¼Œå®ƒçš„<strong>å†…å­˜å ç”¨ç›¸åŒï¼Œä½†å–å€¼èŒƒå›´æ›´å¤§</strong>ï¼ˆå› ä¸ºæ²¡æœ‰ç¬¦å·ä½ï¼‰ã€‚</p>
<h3 data-id="heading-5">2.1 æ— ç¬¦å·æ•´å‹ç±»å‹å¯¹æ¯”</h3>









































<table><thead><tr><th>ç±»å‹</th><th>å†…å­˜å ç”¨ï¼ˆå­—èŠ‚ï¼‰</th><th>å–å€¼èŒƒå›´</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>uint8ï¼ˆbyteï¼‰</td><td>1</td><td>0 ~ 255</td><td>å­˜å‚¨å­—èŠ‚æ•°æ®ï¼ˆå¦‚æ–‡ä»¶å†…å®¹ã€ASCIIå­—ç¬¦ï¼‰ï¼Œbyteæ˜¯å…¶åˆ«å</td></tr><tr><td>uint16</td><td>2</td><td>0 ~ 65535</td><td>å­˜å‚¨éè´Ÿä¸­ç­‰èŒƒå›´æ•´æ•°ï¼ˆå¦‚ç«¯å£å·ï¼š0-65535ï¼‰</td></tr><tr><td>uint32</td><td>4</td><td>0 ~ 4294967295</td><td>å­˜å‚¨éè´Ÿå¤§èŒƒå›´æ•´æ•°ï¼ˆå¦‚æ— ç¬¦å·IDã€è®¡æ•°å™¨ï¼‰</td></tr><tr><td>uint64</td><td>8</td><td>0 ~ 18446744073709551615</td><td>å­˜å‚¨è¶…å¤§éè´Ÿæ•´æ•°ï¼ˆå¦‚ç£ç›˜æ€»å®¹é‡ã€è¶…å¤§è®¡æ•°ï¼‰</td></tr><tr><td>uint</td><td>éšç³»ç»Ÿå˜åŒ–</td><td>éšç³»ç»Ÿå˜åŒ–</td><td>ä¸æ¨èä½¿ç”¨ï¼Œè·¨å¹³å°å…¼å®¹æ€§å·®</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3>
<p>æ— ç¬¦å·æ•´å‹è™½ç„¶å–å€¼èŒƒå›´å¤§ï¼Œä½†ä½¿ç”¨æ—¶è¦æ ¼å¤–å°å¿ƒï¼Œé¿å…ä»¥ä¸‹å‘ï¼š</p>
<ol>
<li>
<p><strong>é¿å…å’Œæœ‰ç¬¦å·æ•´å‹æ··ç”¨</strong>ï¼šæ··ç”¨ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œå¿…é¡»æ˜¾å¼è½¬æ¢ï¼ˆä¸”è¦ç¡®ä¿æ•°å€¼åœ¨ç›®æ ‡ç±»å‹èŒƒå›´å†…ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ä¸è¦ç”¨äºå¯èƒ½å‡ºç°è´Ÿæ•°çš„åœºæ™¯</strong>ï¼šæ¯”å¦‚è®¡ç®—å·®å€¼ï¼ˆa - bï¼Œè‹¥a &lt; bï¼Œæ— ç¬¦å·ç±»å‹ä¼šæº¢å‡ºä¸ºå¤§æ•°ï¼‰ï¼›</p>
</li>
<li>
<p><strong>byteæ˜¯uint8çš„åˆ«å</strong>ï¼šæ—¥å¸¸å¼€å‘ä¸­ï¼Œå­˜å‚¨å­—èŠ‚æ•°æ®æ—¶ç”¨byteæ›´ç›´è§‚ï¼ˆå¦‚å¤„ç†æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“æ•°æ®ï¼‰ã€‚</p>
</li>
</ol>
<h3 data-id="heading-7">2.3 ä»£ç ç¤ºä¾‹ï¼šæ— ç¬¦å·æ•´å‹çš„æ­£ç¡®ä½¿ç”¨</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. byteï¼ˆuint8ï¼‰çš„ä½¿ç”¨ï¼šå­˜å‚¨ASCIIå­—ç¬¦</span>
    <span class="hljs-keyword">var</span> ch <span class="hljs-type">byte</span> = <span class="hljs-string">'A'</span>
    fmt.Println(ch, <span class="hljs-type">string</span>(ch))  <span class="hljs-comment">// è¾“å‡ºï¼š65 Aï¼ˆbyteå­˜å‚¨çš„æ˜¯ASCIIç å€¼ï¼‰</span>

    <span class="hljs-comment">// 2. ç«¯å£å·ï¼ˆ0-65535ï¼‰ï¼šç”¨uint16</span>
    <span class="hljs-keyword">var</span> port <span class="hljs-type">uint16</span> = <span class="hljs-number">8080</span>
    fmt.Println(<span class="hljs-string">"ç«¯å£å·ï¼š"</span>, port)  <span class="hljs-comment">// è¾“å‡ºï¼šç«¯å£å·ï¼š8080</span>

    <span class="hljs-comment">// 3. é”™è¯¯ç¤ºä¾‹ï¼šæ— ç¬¦å·ä¸æœ‰ç¬¦å·æ··ç”¨</span>
    <span class="hljs-keyword">var</span> a <span class="hljs-type">int32</span> = <span class="hljs-number">100</span>
    <span class="hljs-keyword">var</span> b <span class="hljs-type">uint32</span> = <span class="hljs-number">200</span>
    <span class="hljs-comment">// fmt.Println(a + b)  // ç¼–è¯‘æŠ¥é”™ï¼šmismatched types int32 and uint32</span>
    <span class="hljs-comment">// æ­£ç¡®ï¼šæ˜¾å¼è½¬æ¢ä¸ºåŒä¸€ç±»å‹ï¼ˆç¡®ä¿æ•°å€¼èŒƒå›´å®‰å…¨ï¼‰</span>
    fmt.Println(<span class="hljs-type">uint32</span>(a) + b)  <span class="hljs-comment">// è¾“å‡ºï¼š300</span>

    <span class="hljs-comment">// 4. é”™è¯¯ç¤ºä¾‹ï¼šæ— ç¬¦å·æ•´å‹çš„è´Ÿæ•°é—®é¢˜</span>
    <span class="hljs-keyword">var</span> c <span class="hljs-type">uint8</span> = <span class="hljs-number">10</span>
    <span class="hljs-keyword">var</span> d <span class="hljs-type">uint8</span> = <span class="hljs-number">20</span>
    <span class="hljs-comment">// fmt.Println(c - d)  // è¾“å‡ºï¼š246ï¼ˆæº¢å‡ºï¼Œä¸æ˜¯-10ï¼‰</span>
    <span class="hljs-comment">// æ­£ç¡®ï¼šå…ˆåˆ¤æ–­å¤§å°ï¼Œé¿å…è´Ÿæ•°</span>
    <span class="hljs-keyword">if</span> c &lt; d {
        fmt.Println(<span class="hljs-string">"c &lt; dï¼Œæ— æ³•è®¡ç®—å·®å€¼"</span>)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(c - d)
    }
}

</code></pre>
<h2 data-id="heading-8">3. æµ®ç‚¹æ•°ä¸ç²¾åº¦é—®é¢˜</h2>
<p>æµ®ç‚¹æ•°ç”¨äºå­˜å‚¨å¸¦æœ‰å°æ•°çš„æ•°å€¼ï¼ŒGoæä¾›ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹ï¼š<code>float32</code>ï¼ˆå•ç²¾åº¦ï¼‰å’Œ<code>float64</code>ï¼ˆåŒç²¾åº¦ï¼‰ã€‚æ—¥å¸¸å¼€å‘ä¸­æœ€å®¹æ˜“è¸©çš„å‘æ˜¯<strong>æµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±</strong>ï¼Œæˆ‘ä»¬é‡ç‚¹è®²è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 data-id="heading-9">3.1 æµ®ç‚¹æ•°æ ¸å¿ƒç‰¹æ€§</h3>























<table><thead><tr><th>ç±»å‹</th><th>å†…å­˜å ç”¨ï¼ˆå­—èŠ‚ï¼‰</th><th>ç²¾åº¦ï¼ˆæœ‰æ•ˆæ•°å­—ï¼‰</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>float32</td><td>4</td><td>6-7ä½</td><td>å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼ˆå¦‚æ¸¸æˆå›¾å½¢ã€ç²—ç•¥æµ‹é‡ï¼‰</td></tr><tr><td>float64</td><td>8</td><td>15-17ä½</td><td>é»˜è®¤æµ®ç‚¹æ•°ç±»å‹ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼ˆå¦‚é‡‘èè®¡ç®—ã€ç§‘å­¦è®¡ç®—ï¼‰</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šGoçš„æµ®ç‚¹æ•°éµå¾ªIEEE 754æ ‡å‡†ï¼Œå’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚Javaã€Pythonï¼‰ä¸€è‡´ã€‚</p>
<h3 data-id="heading-10">3.2 ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼ˆé‡ç‚¹ï¼ï¼‰</h3>
<p>ç”±äºæµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶å­˜å‚¨ç‰¹æ€§ï¼Œæœ‰äº›åè¿›åˆ¶å°æ•°ï¼ˆå¦‚0.1ï¼‰æ— æ³•è¢«ç²¾ç¡®è¡¨ç¤ºï¼Œä¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤±ã€‚è¿™ä¸æ˜¯Goçš„é—®é¢˜ï¼Œè€Œæ˜¯æ‰€æœ‰éµå¾ªIEEE 754æ ‡å‡†çš„è¯­è¨€éƒ½å­˜åœ¨çš„é—®é¢˜ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šç²¾åº¦ä¸¢å¤±æ¼”ç¤º</strong></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 0.1 + 0.2 ä¸ç­‰äº 0.3</span>
    a := <span class="hljs-number">0.1</span>
    b := <span class="hljs-number">0.2</span>
    c := <span class="hljs-number">0.3</span>
    fmt.Println(a + b)  <span class="hljs-comment">// è¾“å‡ºï¼š0.30000000000000004</span>
    fmt.Println(a + b == c)  <span class="hljs-comment">// è¾“å‡ºï¼šfalse</span>

    <span class="hljs-comment">// è§£å†³æ–¹æ³•1ï¼šä½¿ç”¨fmtæ ¼å¼åŒ–ï¼Œä¿ç•™æŒ‡å®šå°æ•°ä½</span>
    fmt.Printf(<span class="hljs-string">"%.2f\n"</span>, a+b)  <span class="hljs-comment">// è¾“å‡ºï¼š0.30</span>
    <span class="hljs-keyword">if</span> fmt.Sprintf(<span class="hljs-string">"%.2f"</span>, a+b) == fmt.Sprintf(<span class="hljs-string">"%.2f"</span>, c) {
        fmt.Println(<span class="hljs-string">"ç›¸ç­‰ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰"</span>)
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ³•2ï¼šä½¿ç”¨mathåŒ…çš„Equalå‡½æ•°ï¼ˆé€‚åˆé«˜ç²¾åº¦åœºæ™¯ï¼‰</span>
    <span class="hljs-keyword">import</span> <span class="hljs-string">"math"</span>
    <span class="hljs-keyword">if</span> math.Equal(a+b, c) {
        fmt.Println(<span class="hljs-string">"ç›¸ç­‰"</span>)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"ä¸ç›¸ç­‰"</span>)
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ³•3ï¼šä½¿ç”¨æ•´æ•°è¿ç®—ï¼ˆé‡‘èåœºæ™¯æ¨èï¼Œå¦‚å­˜å‚¨åˆ†è€Œä¸æ˜¯å…ƒï¼‰</span>
    <span class="hljs-comment">// 0.1å…ƒ = 10åˆ†ï¼Œ0.2å…ƒ = 20åˆ†ï¼Œæ€»å’Œ30åˆ† = 0.3å…ƒ</span>
    aCent := <span class="hljs-number">10</span>
    bCent := <span class="hljs-number">20</span>
    cCent := <span class="hljs-number">30</span>
    fmt.Println(aCent + bCent == cCent)  <span class="hljs-comment">// è¾“å‡ºï¼štrue</span>
}

</code></pre>
<h3 data-id="heading-11">3.3 å®æˆ˜å»ºè®®</h3>
<ul>
<li>
<p>æ—¥å¸¸å¼€å‘ä¼˜å…ˆç”¨<code>float64</code>ï¼Œç²¾åº¦æ›´é«˜ï¼Œå‡å°‘ä¸¢å¤±æ¦‚ç‡ï¼›</p>
</li>
<li>
<p>é¿å…ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼Œæ¨èç”¨ä¸¤ç§æ–¹å¼ï¼šâ‘  æ ¼å¼åŒ–åæ¯”è¾ƒï¼›â‘¡ è®¡ç®—ä¸¤è€…å·®å€¼çš„ç»å¯¹å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å°äºæŸä¸ªæå°å€¼ï¼ˆå¦‚1e-9ï¼‰ï¼›</p>
</li>
<li>
<p>é‡‘èè®¡ç®—ï¼ˆå¦‚é‡‘é¢ï¼‰ç»å¯¹ä¸è¦ç”¨æµ®ç‚¹æ•°ï¼æ¨èç”¨æ•´æ•°ï¼ˆå­˜å‚¨åˆ†ï¼‰æˆ–ä¸“é—¨çš„é«˜ç²¾åº¦åº“ï¼ˆå¦‚<code>github.com/shopspring/decimal</code>ï¼‰ã€‚</p>
</li>
</ul>
<p>é«˜ç²¾åº¦åº“å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fgithub.com%2Fshopspring%2Fdecimal" target="_blank" title="https://pkg.go.dev/github.com/shopspring/decimal" ref="nofollow noopener noreferrer">shopspring/decimalï¼ˆGoå¸¸ç”¨é«˜ç²¾åº¦å°æ•°åº“ï¼‰</a></p>
<h2 data-id="heading-12">4. å¸ƒå°”ç±»å‹ä¸é€»è¾‘è¿ç®—</h2>
<p>å¸ƒå°”ç±»å‹æ˜¯æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œåªæœ‰ä¸¤ä¸ªå€¼ï¼š<code>true</code>ï¼ˆçœŸï¼‰å’Œ<code>false</code>ï¼ˆå‡ï¼‰ï¼Œä¸»è¦ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼ˆå¦‚ifã€forå¾ªç¯ï¼‰å’Œé€»è¾‘è¿ç®—ã€‚</p>
<h3 data-id="heading-13">4.1 æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li>
<p>å†…å­˜å ç”¨ï¼š1å­—èŠ‚ï¼ˆå›ºå®šï¼Œæ— è®ºç³»ç»Ÿæ˜¯32ä½è¿˜æ˜¯64ä½ï¼‰ï¼›</p>
</li>
<li>
<p>é›¶å€¼ï¼š<code>false</code>ï¼ˆå£°æ˜åæœªèµ‹å€¼çš„å¸ƒå°”å˜é‡é»˜è®¤æ˜¯falseï¼‰ï¼›</p>
</li>
<li>
<p>ä¸å¯è½¬æ¢ï¼šå¸ƒå°”ç±»å‹ä¸èƒ½å’Œå…¶ä»–ç±»å‹ï¼ˆå¦‚intï¼‰ç›¸äº’è½¬æ¢ï¼ˆå’ŒCè¯­è¨€ä¸åŒï¼‰ï¼›</p>
</li>
<li>
<p>ä¸å¯å‚ä¸æ•°å€¼è¿ç®—ï¼šä¸èƒ½ç”¨+ã€-ã€*ã€/ç­‰è¿ç®—ç¬¦æ“ä½œå¸ƒå°”å€¼ã€‚</p>
</li>
</ul>
<h3 data-id="heading-14">4.2 é€»è¾‘è¿ç®—</h3>
<p>Goæ”¯æŒä¸‰ç§åŸºæœ¬é€»è¾‘è¿ç®—ï¼Œç”¨äºç»„åˆå¸ƒå°”å€¼ï¼š</p>





























<table><thead><tr><th align="center">è¿ç®—ç¬¦</th><th align="left">å«ä¹‰</th><th align="left">ç¤ºä¾‹</th><th align="left">ç»“æœ</th></tr></thead><tbody><tr><td align="center"><code>&amp;&amp;</code></td><td align="left">é€»è¾‘ä¸ï¼ˆçŸ­è·¯ï¼‰</td><td align="left"><code>true &amp;&amp; false</code></td><td align="left"><code>false</code></td></tr><tr><td align="center"><code>||</code></td><td align="left">é€»è¾‘æˆ–ï¼ˆçŸ­è·¯ï¼‰</td><td align="left"><code>true || false</code></td><td align="left"><code>true</code></td></tr><tr><td align="center"><code>!</code></td><td align="left">é€»è¾‘é</td><td align="left"><code>!true</code></td><td align="left"><code>false</code></td></tr></tbody></table>
<h3 data-id="heading-15">4.3 ä»£ç ç¤ºä¾‹ï¼šå¸ƒå°”ç±»å‹çš„ä½¿ç”¨</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. åŸºæœ¬ä½¿ç”¨</span>
    <span class="hljs-keyword">var</span> isPass <span class="hljs-type">bool</span> = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">var</span> isLogin <span class="hljs-type">bool</span>  <span class="hljs-comment">// é›¶å€¼æ˜¯false</span>
    fmt.Println(isPass, isLogin)  <span class="hljs-comment">// è¾“å‡ºï¼štrue false</span>

    <span class="hljs-comment">// 2. é€»è¾‘è¿ç®—</span>
    a := <span class="hljs-number">10</span>
    b := <span class="hljs-number">20</span>
    <span class="hljs-comment">// é€»è¾‘ä¸ï¼ša&gt;5ä¸”b&lt;30</span>
    fmt.Println(a &gt; <span class="hljs-number">5</span> &amp;&amp; b &lt; <span class="hljs-number">30</span>)  <span class="hljs-comment">// è¾“å‡ºï¼štrue</span>
    <span class="hljs-comment">// é€»è¾‘æˆ–ï¼ša&gt;15æˆ–b&lt;15</span>
    fmt.Println(a &gt; <span class="hljs-number">15</span> || b &lt; <span class="hljs-number">15</span>)  <span class="hljs-comment">// è¾“å‡ºï¼šfalse</span>
    <span class="hljs-comment">// é€»è¾‘éï¼šaä¸ç­‰äº10</span>
    fmt.Println(!(a == <span class="hljs-number">10</span>))  <span class="hljs-comment">// è¾“å‡ºï¼šfalse</span>

    <span class="hljs-comment">// 3. çŸ­è·¯ç‰¹æ€§ç¤ºä¾‹</span>
    <span class="hljs-comment">// ç”±äºa&gt;5æ˜¯trueï¼Œé€»è¾‘æˆ–åé¢çš„å‡½æ•°ä¸ä¼šæ‰§è¡Œ</span>
    fmt.Println(a &gt; <span class="hljs-number">5</span> || test())  <span class="hljs-comment">// è¾“å‡ºï¼štrueï¼Œä¸”ä¸ä¼šæ‰“å°"testæ‰§è¡Œäº†"</span>

    <span class="hljs-comment">// 4. é”™è¯¯ç¤ºä¾‹ï¼šå¸ƒå°”ç±»å‹ä¸intè½¬æ¢</span>
    <span class="hljs-comment">// var num int = int(isPass)  // ç¼–è¯‘æŠ¥é”™ï¼šcannot convert isPass (type bool) to type int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span> <span class="hljs-type">bool</span> {
    fmt.Println(<span class="hljs-string">"testæ‰§è¡Œäº†"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}

</code></pre>
<h2 data-id="heading-16">5. å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ä¸åº•å±‚ç»“æ„</h2>
<p>å­—ç¬¦ä¸²æ˜¯Goä¸­æœ€å¸¸ç”¨çš„å¼•ç”¨ç±»å‹ï¼ˆè™½ç„¶ä½¿ç”¨èµ·æ¥åƒå€¼ç±»å‹ï¼‰ï¼Œæ ¸å¿ƒç‰¹æ€§æ˜¯<strong>ä¸å¯å˜æ€§</strong>â€”â€”ä¸€æ—¦åˆ›å»ºï¼Œå­—ç¬¦ä¸²çš„å†…å®¹å°±ä¸èƒ½è¢«ä¿®æ”¹ã€‚ç†è§£è¿™ä¸ªç‰¹æ€§å’Œåº•å±‚ç»“æ„ï¼Œèƒ½å¸®ä½ å†™å‡ºæ›´é«˜æ•ˆçš„å­—ç¬¦ä¸²æ“ä½œä»£ç ã€‚</p>
<h3 data-id="heading-17">5.1 åº•å±‚ç»“æ„</h3>
<p>Goçš„å­—ç¬¦ä¸²åº•å±‚æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®šä¹‰åœ¨<code>runtime</code>åŒ…ä¸­ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">type</span> stringStruct <span class="hljs-keyword">struct</span> {
    str unsafe.Pointer  <span class="hljs-comment">// æŒ‡å‘åº•å±‚å­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆ</span>
    <span class="hljs-built_in">len</span> <span class="hljs-type">int</span>             <span class="hljs-comment">// å­—ç¬¦ä¸²é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰</span>
}

</code></pre>
<p>æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ul>
<li>
<p>å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼ˆlenå­—æ®µï¼‰ï¼Œä¿®æ”¹é•¿åº¦éœ€è¦åˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼›</p>
</li>
<li>
<p>å¤šä¸ªå­—ç¬¦ä¸²å¯ä»¥å…±äº«åŒä¸€ä¸ªåº•å±‚å­—èŠ‚æ•°ç»„ï¼ˆå¦‚å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼‰ï¼ŒèŠ‚çœå†…å­˜ï¼›</p>
</li>
<li>
<p>å­—ç¬¦ä¸²çš„â€œä¸å¯å˜æ€§â€æœ¬è´¨æ˜¯åº•å±‚å­—èŠ‚æ•°ç»„ä¸å¯ä¿®æ”¹ï¼Œä»»ä½•ä¿®æ”¹æ“ä½œéƒ½ä¼šåˆ›å»ºæ–°çš„å­—èŠ‚æ•°ç»„ã€‚</p>
</li>
</ul>
<h3 data-id="heading-18">5.2 ä¸å¯å˜æ€§çš„å½±å“</h3>
<p>ä¸å¯å˜æ€§æ˜¯æŠŠâ€œåŒåˆƒå‰‘â€ï¼Œä¼˜ç‚¹æ˜¯çº¿ç¨‹å®‰å…¨ã€å†…å­˜é«˜æ•ˆï¼ˆå…±äº«å­—èŠ‚æ•°ç»„ï¼‰ï¼Œç¼ºç‚¹æ˜¯ä¿®æ”¹å­—ç¬¦ä¸²ä¼šäº§ç”Ÿæ–°å¯¹è±¡ï¼Œé¢‘ç¹ä¿®æ”¹ä¼šå½±å“æ€§èƒ½ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²ä¸å¯å˜æ€§</strong></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. å­—ç¬¦ä¸²ä¸å¯ä¿®æ”¹å•ä¸ªå­—ç¬¦</span>
    str := <span class="hljs-string">"hello"</span>
    <span class="hljs-comment">// str[0] = 'H'  // ç¼–è¯‘æŠ¥é”™ï¼šcannot assign to str[0]</span>

    <span class="hljs-comment">// 2. ä¿®æ”¹å­—ç¬¦ä¸²çš„æ­£ç¡®æ–¹å¼ï¼šè½¬ä¸ºåˆ‡ç‰‡ä¿®æ”¹åé‡æ–°ç”Ÿæˆå­—ç¬¦ä¸²</span>
    <span class="hljs-comment">// è½¬ä¸º[]byteåˆ‡ç‰‡ï¼ˆé€‚ç”¨äºASCIIå­—ç¬¦ï¼‰</span>
    byteSlice := []<span class="hljs-type">byte</span>(str)
    byteSlice[<span class="hljs-number">0</span>] = <span class="hljs-string">'H'</span>
    newStr := <span class="hljs-type">string</span>(byteSlice)
    fmt.Println(newStr)  <span class="hljs-comment">// è¾“å‡ºï¼šHello</span>

    <span class="hljs-comment">// 3. å­—ç¬¦ä¸²å…±äº«åº•å±‚æ•°ç»„ï¼ˆåˆ‡ç‰‡æ“ä½œï¼‰</span>
    str1 := <span class="hljs-string">"abcdefg"</span>
    str2 := str1[<span class="hljs-number">1</span>:<span class="hljs-number">4</span>]  <span class="hljs-comment">// åˆ‡ç‰‡ï¼šä»ç´¢å¼•1åˆ°4ï¼ˆä¸åŒ…å«4ï¼‰ï¼Œç»“æœæ˜¯"bcd"</span>
    fmt.Println(<span class="hljs-built_in">len</span>(str1), <span class="hljs-built_in">len</span>(str2))  <span class="hljs-comment">// è¾“å‡ºï¼š7 3</span>
    <span class="hljs-comment">// str1å’Œstr2å…±äº«åº•å±‚å­—èŠ‚æ•°ç»„ï¼Œstr2çš„lenæ˜¯3</span>
}

</code></pre>
<h3 data-id="heading-19">5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<p>é¢‘ç¹ä¿®æ”¹å­—ç¬¦ä¸²ï¼ˆå¦‚æ‹¼æ¥ã€æ›¿æ¢ï¼‰æ—¶ï¼Œç›´æ¥ç”¨<code>+</code>è¿ç®—ç¬¦ä¼šäº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œæ¨èç”¨<code>strings.Builder</code>æˆ–<code>bytes.Buffer</code>ï¼Œå®ƒä»¬ä¼šé¢„åˆ†é…å†…å­˜ï¼Œå‡å°‘å†…å­˜æ‹·è´ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"strings"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// ä½æ•ˆï¼šé¢‘ç¹æ‹¼æ¥å­—ç¬¦ä¸²ï¼ˆäº§ç”Ÿå¤šä¸ªä¸´æ—¶å¯¹è±¡ï¼‰</span>
    <span class="hljs-keyword">var</span> str <span class="hljs-type">string</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ {
        str += fmt.Sprintf(<span class="hljs-string">"%d"</span>, i)
    }
    fmt.Println(<span class="hljs-string">"ä½æ•ˆæ–¹å¼é•¿åº¦ï¼š"</span>, <span class="hljs-built_in">len</span>(str))

    <span class="hljs-comment">// é«˜æ•ˆï¼šç”¨strings.Builder</span>
    <span class="hljs-keyword">var</span> builder strings.Builder
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ {
        builder.WriteString(fmt.Sprintf(<span class="hljs-string">"%d"</span>, i))
    }
    efficientStr := builder.String()
    fmt.Println(<span class="hljs-string">"é«˜æ•ˆæ–¹å¼é•¿åº¦ï¼š"</span>, <span class="hljs-built_in">len</span>(efficientStr))
}

</code></pre>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fstrings%23Builder" target="_blank" title="https://pkg.go.dev/strings#Builder" ref="nofollow noopener noreferrer">strings.Builderå®˜æ–¹æ–‡æ¡£</a></p>
<h2 data-id="heading-20">6. UTF-8ç¼–ç ä¸runeã€byteåŒºåˆ«</h2>
<p>Goçš„å­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç ï¼Œè¿™æ˜¯å¤„ç†å¤šè¯­è¨€ï¼ˆå¦‚ä¸­æ–‡ã€æ—¥æ–‡ï¼‰çš„åŸºç¡€ã€‚ä½†UTF-8ç¼–ç ä¸­ï¼Œä¸åŒå­—ç¬¦å ç”¨çš„å­—èŠ‚æ•°ä¸åŒï¼ˆASCIIå­—ç¬¦å 1å­—èŠ‚ï¼Œä¸­æ–‡å 3å­—èŠ‚ï¼‰ï¼Œè¿™å°±éœ€è¦åŒºåˆ†<code>byte</code>å’Œ<code>rune</code>ä¸¤ä¸ªç±»å‹ã€‚</p>
<h3 data-id="heading-21">6.1 UTF-8ç¼–ç åŸºç¡€</h3>
<ul>
<li>
<p>UTF-8æ˜¯ä¸€ç§å¯å˜é•¿ç¼–ç ï¼Œå…¼å®¹ASCIIï¼ˆASCIIå­—ç¬¦çš„UTF-8ç¼–ç å°±æ˜¯å…¶æœ¬èº«ï¼‰ï¼›</p>
</li>
<li>
<p>å¸¸è§å­—ç¬¦å ç”¨å­—èŠ‚æ•°ï¼šâ‘  è‹±æ–‡ã€æ•°å­—ã€ç¬¦å·ï¼š1å­—èŠ‚ï¼›â‘¡ ä¸­æ–‡ã€æ—¥æ–‡ç­‰ï¼š3å­—èŠ‚ï¼›â‘¢ ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚emojiï¼‰ï¼š4å­—èŠ‚ï¼›</p>
</li>
<li>
<p>å­—ç¬¦ä¸²çš„<code>len()</code>å‡½æ•°è¿”å›çš„æ˜¯<strong>å­—èŠ‚æ•°</strong>ï¼Œä¸æ˜¯å­—ç¬¦æ•°ï¼ˆè¿™æ˜¯æ–°æ‰‹å¸¸è¸©çš„å‘ï¼‰ã€‚</p>
</li>
</ul>
<h3 data-id="heading-22">6.2 byteä¸runeçš„åŒºåˆ«</h3>























<table><thead><tr><th>ç±»å‹</th><th>æœ¬è´¨</th><th>ä½œç”¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>byte</td><td>uint8çš„åˆ«å</td><td>è¡¨ç¤º1ä¸ªå­—èŠ‚</td><td>å¤„ç†ASCIIå­—ç¬¦ã€å­—èŠ‚æ•°æ®ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ï¼‰</td></tr><tr><td>rune</td><td>int32çš„åˆ«å</td><td>è¡¨ç¤º1ä¸ªUnicodeå­—ç¬¦ï¼ˆUTF-8ç¼–ç çš„å­—ç¬¦ï¼‰</td><td>å¤„ç†å¤šè¯­è¨€å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€æ—¥æ–‡ï¼‰ï¼Œç»Ÿè®¡å­—ç¬¦æ•°</td></tr></tbody></table>
<h3 data-id="heading-23">6.3 ä»£ç ç¤ºä¾‹ï¼šbyteä¸runeçš„ä½¿ç”¨</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. len()è¿”å›å­—èŠ‚æ•°ï¼Œä¸æ˜¯å­—ç¬¦æ•°</span>
    str := <span class="hljs-string">"ä½ å¥½Go"</span>
    fmt.Println(<span class="hljs-string">"å­—èŠ‚æ•°ï¼š"</span>, <span class="hljs-built_in">len</span>(str))  <span class="hljs-comment">// è¾“å‡ºï¼š8ï¼ˆ2ä¸ªä¸­æ–‡Ã—3 + 2ä¸ªå­—æ¯Ã—1 = 8ï¼‰</span>

    <span class="hljs-comment">// 2. ç”¨runeåˆ‡ç‰‡ç»Ÿè®¡å­—ç¬¦æ•°</span>
    runeSlice := []<span class="hljs-type">rune</span>(str)
    fmt.Println(<span class="hljs-string">"å­—ç¬¦æ•°ï¼š"</span>, <span class="hljs-built_in">len</span>(runeSlice))  <span class="hljs-comment">// è¾“å‡ºï¼š4ï¼ˆ2ä¸ªä¸­æ–‡ + 2ä¸ªå­—æ¯ï¼‰</span>

    <span class="hljs-comment">// 3. éå†å­—ç¬¦ä¸²ï¼ˆbyteéå† vs runeéå†ï¼‰</span>
    <span class="hljs-comment">// byteéå†ï¼ˆæŒ‰å­—èŠ‚éå†ï¼Œä¸­æ–‡ä¼šè¢«æ‹†åˆ†ï¼Œå‡ºç°ä¹±ç ï¼‰</span>
    fmt.Println(<span class="hljs-string">"byteéå†ï¼š"</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(str); i++ {
        fmt.Printf(<span class="hljs-string">"%c "</span>, str[i])  <span class="hljs-comment">// è¾“å‡ºï¼šÃ¤Â½Â  Ã¥Â¥Â½ G o ï¼ˆä¹±ç ï¼‰</span>
    }
    fmt.Println()

    <span class="hljs-comment">// runeéå†ï¼ˆæŒ‰å­—ç¬¦éå†ï¼Œæ­£ç¡®å¤„ç†ä¸­æ–‡ï¼‰</span>
    fmt.Println(<span class="hljs-string">"runeéå†ï¼ˆfor rangeï¼‰ï¼š"</span>)
    <span class="hljs-keyword">for</span> _, char := <span class="hljs-keyword">range</span> str {
        fmt.Printf(<span class="hljs-string">"%c "</span>, char)  <span class="hljs-comment">// è¾“å‡ºï¼šä½  å¥½ G o</span>
    }
    fmt.Println()

    <span class="hljs-comment">// 4. å•ä¸ªå­—ç¬¦çš„runeè¡¨ç¤º</span>
    <span class="hljs-keyword">var</span> char <span class="hljs-type">rune</span> = <span class="hljs-string">'ä¸­'</span>
    fmt.Println(<span class="hljs-string">"'ä¸­'çš„Unicodeç ï¼š"</span>, char)  <span class="hljs-comment">// è¾“å‡ºï¼š20013</span>
    fmt.Println(<span class="hljs-string">"'ä¸­'çš„UTF-8ç¼–ç å­—èŠ‚æ•°ï¼š"</span>, <span class="hljs-built_in">len</span>(<span class="hljs-type">string</span>(char)))  <span class="hljs-comment">// è¾“å‡ºï¼š3</span>
}

</code></pre>
<p><strong>å…³é”®ç»“è®º</strong>ï¼š</p>
<ul>
<li>
<p>å¤„ç†çº¯ASCIIå­—ç¬¦ä¸²ï¼šç”¨byteæˆ–ç›´æ¥æ“ä½œå­—ç¬¦ä¸²ï¼›</p>
</li>
<li>
<p>å¤„ç†å¤šè¯­è¨€å­—ç¬¦ä¸²ï¼šå¿…é¡»ç”¨runeåˆ‡ç‰‡ï¼ˆæˆ–for rangeéå†ï¼‰ï¼Œé¿å…ä¹±ç ï¼›</p>
</li>
<li>
<p>for rangeéå†å­—ç¬¦ä¸²æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æ¯ä¸ªå­—ç¬¦è½¬ä¸ºruneç±»å‹ï¼Œä¸ä¼šå‡ºç°ä¹±ç ï¼ˆæ¨èç”¨è¿™ç§æ–¹å¼éå†å¤šè¯­è¨€å­—ç¬¦ä¸²ï¼‰ã€‚</p>
</li>
</ul>
<h2 data-id="heading-24">7. å­—ç¬¦ä¸²å¸¸ç”¨æ“ä½œä¸æ€§èƒ½æ³¨æ„ç‚¹</h2>
<p>Goçš„<code>strings</code>åŒ…æä¾›äº†å¤§é‡å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼Œè¦†ç›–æ‹¼æ¥ã€æŸ¥æ‰¾ã€æ›¿æ¢ã€åˆ†å‰²ç­‰å¸¸ç”¨åœºæ™¯ã€‚æˆ‘ä»¬é‡ç‚¹è®²é«˜é¢‘æ“ä½œå’Œæ€§èƒ½æ³¨æ„ç‚¹ã€‚</p>
<h3 data-id="heading-25">7.1 é«˜é¢‘æ“ä½œå‡½æ•°</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"strings"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    str := <span class="hljs-string">"Hello, Go! Hello, World!"</span>

    <span class="hljs-comment">// 1. æ‹¼æ¥å­—ç¬¦ä¸²ï¼ˆç®€å•æ‹¼æ¥ç”¨+ï¼Œæ‰¹é‡æ‹¼æ¥ç”¨strings.Builderï¼‰</span>
    str1 := <span class="hljs-string">"Hello"</span>
    str2 := <span class="hljs-string">"Go"</span>
    fmt.Println(<span class="hljs-string">"æ‹¼æ¥ï¼š"</span>, str1+<span class="hljs-string">", "</span>+str2)  <span class="hljs-comment">// è¾“å‡ºï¼šæ‹¼æ¥ï¼šHello, Go</span>

    <span class="hljs-comment">// 2. æŸ¥æ‰¾å­ä¸²</span>
    fmt.Println(<span class="hljs-string">"æ˜¯å¦åŒ…å«'Go'ï¼š"</span>, strings.Contains(str, <span class="hljs-string">"Go"</span>))  <span class="hljs-comment">// è¾“å‡ºï¼štrue</span>
    fmt.Println(<span class="hljs-string">"'Go'ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼š"</span>, strings.Index(str, <span class="hljs-string">"Go"</span>))  <span class="hljs-comment">// è¾“å‡ºï¼š7</span>
    fmt.Println(<span class="hljs-string">"'Go'æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼š"</span>, strings.LastIndex(str, <span class="hljs-string">"Go"</span>))  <span class="hljs-comment">// è¾“å‡ºï¼š15</span>

    <span class="hljs-comment">// 3. æ›¿æ¢å­ä¸²</span>
    <span class="hljs-comment">// æ›¿æ¢æ‰€æœ‰"Hello"ä¸º"Hi"</span>
    newStr := strings.ReplaceAll(str, <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"Hi"</span>)
    fmt.Println(<span class="hljs-string">"æ›¿æ¢åï¼š"</span>, newStr)  <span class="hljs-comment">// è¾“å‡ºï¼šHi, Go! Hi, World!</span>
    <span class="hljs-comment">// æ›¿æ¢å‰2ä¸ª"Hello"ä¸º"Hi"ï¼ˆstrings.Replaceçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ›¿æ¢æ¬¡æ•°ï¼Œ-1è¡¨ç¤ºå…¨éƒ¨ï¼‰</span>
    newStr2 := strings.Replace(str, <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"Hi"</span>, <span class="hljs-number">2</span>)
    fmt.Println(<span class="hljs-string">"æ›¿æ¢å‰2ä¸ªï¼š"</span>, newStr2)

    <span class="hljs-comment">// 4. åˆ†å‰²ä¸æ‹¼æ¥</span>
    parts := strings.Split(str, <span class="hljs-string">", "</span>)  <span class="hljs-comment">// æŒ‰", "åˆ†å‰²</span>
    fmt.Println(<span class="hljs-string">"åˆ†å‰²åï¼š"</span>, parts)  <span class="hljs-comment">// è¾“å‡ºï¼š[Hello Go! Hello World!]</span>
    joined := strings.Join(parts, <span class="hljs-string">" - "</span>)  <span class="hljs-comment">// ç”¨" - "æ‹¼æ¥</span>
    fmt.Println(<span class="hljs-string">"æ‹¼æ¥åï¼š"</span>, joined)  <span class="hljs-comment">// è¾“å‡ºï¼šHello - Go! - Hello - World!</span>

    <span class="hljs-comment">// 5. å¤§å°å†™è½¬æ¢</span>
    fmt.Println(<span class="hljs-string">"è½¬å¤§å†™ï¼š"</span>, strings.ToUpper(str))
    fmt.Println(<span class="hljs-string">"è½¬å°å†™ï¼š"</span>, strings.ToLower(str))

    <span class="hljs-comment">// 6. å»é™¤é¦–å°¾ç©ºç™½ï¼ˆç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰</span>
    str3 := <span class="hljs-string">"  Hello Go  \n"</span>
    fmt.Println(<span class="hljs-string">"å»é™¤ç©ºç™½åï¼š"</span>, strings.TrimSpace(str3))  <span class="hljs-comment">// è¾“å‡ºï¼šHello Go</span>
}

</code></pre>
<h3 data-id="heading-26">7.2 æ€§èƒ½æ³¨æ„ç‚¹</h3>
<ul>
<li>
<p>é¿å…é¢‘ç¹ç”¨<code>+</code>æ‹¼æ¥å­—ç¬¦ä¸²ï¼šå°¤å…¶æ˜¯åœ¨å¾ªç¯ä¸­ï¼Œæ¨èç”¨<code>strings.Builder</code>ï¼ˆæ€§èƒ½æœ€ä¼˜ï¼‰æˆ–<code>bytes.Buffer</code>ï¼›</p>
</li>
<li>
<p>strings.Joinæ€§èƒ½ä¼˜äºå¤šæ¬¡+æ‹¼æ¥ï¼šJoinä¼šå…ˆè®¡ç®—æ€»é•¿åº¦ï¼Œé¢„åˆ†é…å†…å­˜ï¼Œå†è¿›è¡Œæ‹¼æ¥ï¼Œé€‚åˆæ‰¹é‡æ‹¼æ¥åˆ‡ç‰‡ä¸­çš„å­—ç¬¦ä¸²ï¼›</p>
</li>
<li>
<p>é¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ‹·è´ï¼šå¦‚å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆstr[1:4]ï¼‰ä¸ä¼šæ‹·è´åº•å±‚æ•°æ®ï¼Œç›´æ¥å¼•ç”¨åŸæ•°ç»„ï¼Œæ€§èƒ½å¾ˆé«˜ï¼›</p>
</li>
<li>
<p>å¤šè¯­è¨€å­—ç¬¦ä¸²æ“ä½œæ³¨æ„ç”¨runeï¼šå¦‚ç»Ÿè®¡å­—ç¬¦æ•°ã€æˆªå–å­ä¸²æ—¶ï¼Œå…ˆè½¬ä¸ºruneåˆ‡ç‰‡ï¼Œé¿å…ç ´åUTF-8ç¼–ç ï¼ˆå¦‚æˆªå–ä¸­æ–‡æ—¶å‡ºç°ä¹±ç ï¼‰ã€‚</p>
</li>
</ul>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fstrings" target="_blank" title="https://pkg.go.dev/strings" ref="nofollow noopener noreferrer">stringsåŒ…å®˜æ–¹æ–‡æ¡£ï¼ˆå®Œæ•´å‡½æ•°åˆ—è¡¨ï¼‰</a></p>
<h2 data-id="heading-27">8. ç±»å‹åˆ«åä¸è‡ªå®šä¹‰ç±»å‹</h2>
<p>Goå…è®¸é€šè¿‡<code>type</code>å…³é”®å­—å®šä¹‰ç±»å‹åˆ«åæˆ–è‡ªå®šä¹‰ç±»å‹ï¼Œç”¨äºå¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œç±»å‹å®‰å…¨æ€§ã€‚å¾ˆå¤šæ–°æ‰‹ä¼šæ··æ·†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬æ¥æ˜ç¡®åŒºåˆ†ã€‚</p>
<h3 data-id="heading-28">8.1 ç±»å‹åˆ«åï¼ˆType Aliasï¼‰</h3>
<p><strong>å®šä¹‰è¯­æ³•</strong>ï¼š<code>type åˆ«å åŸç±»å‹</code></p>
<p>æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>ç±»å‹åˆ«åå’ŒåŸç±»å‹æ˜¯â€œåŒä¸€ä¸ªç±»å‹â€ï¼Œå¯ä»¥ç›´æ¥ç›¸äº’èµ‹å€¼ï¼Œæ— éœ€æ˜¾å¼è½¬æ¢ï¼›</p>
</li>
<li>
<p>ä¸»è¦ä½œç”¨æ˜¯ç®€åŒ–é•¿ç±»å‹åï¼ˆå¦‚å¤æ‚çš„ç»“æ„ä½“ç±»å‹ã€å‡½æ•°ç±»å‹ï¼‰ï¼Œæˆ–è§£å†³ç±»å‹å‘½åå†²çªã€‚</p>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šç±»å‹åˆ«å</strong></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// å®šä¹‰ç±»å‹åˆ«åï¼šMyIntæ˜¯intçš„åˆ«å</span>
<span class="hljs-keyword">type</span> MyInt <span class="hljs-type">int</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
    <span class="hljs-keyword">var</span> b MyInt = <span class="hljs-number">20</span>

    <span class="hljs-comment">// ç±»å‹åˆ«åå¯ä»¥ç›´æ¥èµ‹å€¼ï¼ˆæ— éœ€è½¬æ¢ï¼‰</span>
    a = <span class="hljs-type">int</span>(b)  <span class="hljs-comment">// è™½ç„¶å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œä½†æ˜¾å¼è½¬æ¢æ›´æ¸…æ™°</span>
    b = MyInt(a)
    fmt.Println(a, b)  <span class="hljs-comment">// è¾“å‡ºï¼š20 20</span>

    <span class="hljs-comment">// byteæ˜¯uint8çš„åˆ«åï¼Œruneæ˜¯int32çš„åˆ«åï¼ˆGoå†…ç½®åˆ«åï¼‰</span>
    <span class="hljs-keyword">var</span> c <span class="hljs-type">byte</span> = <span class="hljs-string">'A'</span>
    <span class="hljs-keyword">var</span> d <span class="hljs-type">uint8</span> = c
    fmt.Println(c, d)  <span class="hljs-comment">// è¾“å‡ºï¼š65 65</span>
}
</code></pre>
<h3 data-id="heading-29">8.2 è‡ªå®šä¹‰ç±»å‹ï¼ˆDefined Typeï¼‰</h3>
<p><strong>å®šä¹‰è¯­æ³•</strong>ï¼š<code>type è‡ªå®šä¹‰ç±»å‹å åº•å±‚ç±»å‹</code></p>
<p>æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>è‡ªå®šä¹‰ç±»å‹æ˜¯â€œæ–°ç±»å‹â€ï¼Œå’Œåº•å±‚ç±»å‹ä¸ç›¸ç­‰ï¼Œä¸èƒ½ç›´æ¥èµ‹å€¼ï¼ˆå¿…é¡»æ˜¾å¼è½¬æ¢ï¼‰ï¼›</p>
</li>
<li>
<p>å¯ä»¥ä¸ºè‡ªå®šä¹‰ç±»å‹æ·»åŠ æ–¹æ³•ï¼ˆè¿™æ˜¯Goå®ç°é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ–¹å¼ä¹‹ä¸€ï¼‰ï¼›</p>
</li>
<li>
<p>ä¸»è¦ä½œç”¨æ˜¯å¢å¼ºç±»å‹å®‰å…¨æ€§ï¼ˆå¦‚åŒºåˆ†ä¸åŒå«ä¹‰çš„intç±»å‹ï¼‰ï¼Œæˆ–å°è£…ç‰¹å®šè¡Œä¸ºã€‚</p>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ç±»å‹</strong></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// è‡ªå®šä¹‰ç±»å‹ï¼šUserIDæ˜¯åº•å±‚ç±»å‹ä¸ºintçš„æ–°ç±»å‹</span>
<span class="hljs-keyword">type</span> UserID <span class="hljs-type">int</span>
<span class="hljs-comment">// è‡ªå®šä¹‰ç±»å‹ï¼šProductIDæ˜¯åº•å±‚ç±»å‹ä¸ºintçš„æ–°ç±»å‹</span>
<span class="hljs-keyword">type</span> ProductID <span class="hljs-type">int</span>

<span class="hljs-comment">// ä¸ºUserIDæ·»åŠ æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u UserID)</span></span> String() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"ç”¨æˆ·IDï¼š%d"</span>, u)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> uid UserID = <span class="hljs-number">10001</span>
    <span class="hljs-keyword">var</span> pid ProductID = <span class="hljs-number">20001</span>

    <span class="hljs-comment">// é”™è¯¯ï¼šè‡ªå®šä¹‰ç±»å‹ä¸èƒ½ç›´æ¥èµ‹å€¼ï¼ˆå³ä½¿åº•å±‚ç±»å‹ç›¸åŒï¼‰</span>
    <span class="hljs-comment">// uid = pid  // ç¼–è¯‘æŠ¥é”™ï¼šcannot use pid (type ProductID) as type UserID in assignment</span>

    <span class="hljs-comment">// æ­£ç¡®ï¼šæ˜¾å¼è½¬æ¢ï¼ˆéœ€è¦ç¡®ä¿è¯­ä¹‰æ­£ç¡®ï¼‰</span>
    uid = UserID(pid)
    fmt.Println(uid.String())  <span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·IDï¼š20001</span>

    <span class="hljs-comment">// è‡ªå®šä¹‰ç±»å‹ä¸åº•å±‚ç±»å‹çš„è½¬æ¢</span>
    <span class="hljs-keyword">var</span> num <span class="hljs-type">int</span> = <span class="hljs-number">30001</span>
    uid = UserID(num)  <span class="hljs-comment">// æ˜¾å¼è½¬æ¢</span>
    num = <span class="hljs-type">int</span>(uid)     <span class="hljs-comment">// æ˜¾å¼è½¬æ¢</span>
    fmt.Println(num)  <span class="hljs-comment">// è¾“å‡ºï¼š30001</span>
}

</code></pre>
<h3 data-id="heading-30">8.3 å®æˆ˜åŒºåˆ«ä¸å»ºè®®</h3>

























<table><thead><tr><th>ç‰¹æ€§</th><th>ç±»å‹åˆ«å</th><th>è‡ªå®šä¹‰ç±»å‹</th></tr></thead><tbody><tr><td>ä¸åŸç±»å‹å…³ç³»</td><td>åŒä¸€ç±»å‹ï¼Œå¯ç›´æ¥èµ‹å€¼</td><td>ä¸åŒç±»å‹ï¼Œéœ€æ˜¾å¼è½¬æ¢</td></tr><tr><td>èƒ½å¦æ·»åŠ æ–¹æ³•</td><td>ä¸èƒ½ï¼ˆæ–¹æ³•æ¥æ”¶è€…å¿…é¡»æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼‰</td><td>å¯ä»¥</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>ç®€åŒ–é•¿ç±»å‹åã€è§£å†³å‘½åå†²çª</td><td>å¢å¼ºç±»å‹å®‰å…¨æ€§ã€å°è£…è¡Œä¸ºï¼ˆæ·»åŠ æ–¹æ³•ï¼‰</td></tr></tbody></table>
<p><strong>å»ºè®®</strong>ï¼šæ—¥å¸¸å¼€å‘ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ï¼ˆè€Œéç±»å‹åˆ«åï¼‰æ¥åŒºåˆ†ä¸åŒè¯­ä¹‰çš„å˜é‡ï¼ˆå¦‚UserIDå’ŒProductIDï¼‰ï¼Œé¿å…å› ç±»å‹ç›¸åŒå¯¼è‡´çš„è¯­ä¹‰æ··æ·†bugã€‚</p>
<h2 data-id="heading-31">æ€»ç»“</h2>
<p>æœ¬ç« æˆ‘ä»¬æ·±å…¥æ‹†è§£äº†Goçš„å››ç±»ç®€å•æ•°æ®ç±»å‹ï¼Œæ ¸å¿ƒè¦ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>æ•´å‹ï¼šä¼˜å…ˆæ˜ç¡®é•¿åº¦ï¼ˆint32/int64ï¼‰ï¼Œé¿å…ç”¨é»˜è®¤intï¼Œé˜²æ­¢è·¨å¹³å°é—®é¢˜å’Œæº¢å‡ºï¼›æ— ç¬¦å·æ•´å‹é€‚åˆéè´Ÿåœºæ™¯ï¼ˆå¦‚å­—èŠ‚ã€ç«¯å£å·ï¼‰ï¼›</p>
</li>
<li>
<p>æµ®ç‚¹æ•°ï¼šä¼˜å…ˆç”¨float64ï¼Œé¿å…ç›´æ¥æ¯”è¾ƒï¼Œé‡‘èåœºæ™¯ç”¨æ•´æ•°æˆ–é«˜ç²¾åº¦åº“ï¼›</p>
</li>
<li>
<p>å¸ƒå°”ç±»å‹ï¼šä¸å¯è½¬æ¢ã€ä¸å¯å‚ä¸æ•°å€¼è¿ç®—ï¼Œé€»è¾‘è¿ç®—æ”¯æŒçŸ­è·¯ç‰¹æ€§ï¼›</p>
</li>
<li>
<p>å­—ç¬¦ä¸²ï¼šä¸å¯å˜ï¼Œåº•å±‚æ˜¯å­—èŠ‚æ•°ç»„ï¼›å¤„ç†å¤šè¯­è¨€ç”¨runeï¼Œé¿å…ä¹±ç ï¼›é¢‘ç¹ä¿®æ”¹ç”¨strings.Builderï¼›</p>
</li>
<li>
<p>ç±»å‹åˆ«åä¸è‡ªå®šä¹‰ç±»å‹ï¼šåˆ«åæ˜¯åŒä¸€ç±»å‹ï¼Œè‡ªå®šä¹‰æ˜¯æ–°ç±»å‹ï¼Œåè€…å¯æ·»åŠ æ–¹æ³•ï¼Œå¢å¼ºç±»å‹å®‰å…¨æ€§ã€‚</p>
</li>
</ol>
<p>è¿™äº›ç±»å‹æ˜¯Goå¼€å‘çš„åŸºç¡€ï¼Œå»ºè®®å¤šåŠ¨æ‰‹ç»ƒä¹ å¸¸ç”¨æ“ä½œï¼ˆå¦‚å­—ç¬¦ä¸²å¤„ç†ã€ç±»å‹è½¬æ¢ï¼‰ï¼Œç†Ÿç»ƒæŒæ¡åèƒ½å¤§å¹…æå‡ç¼–ç æ•ˆç‡ã€‚å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘çš„ AI è¾…åŠ©å¼€å‘å·¥ç¨‹åŒ–å®æˆ˜]]></title>    <link>https://juejin.cn/post/7598450302616207406</link>    <guid>https://juejin.cn/post/7598450302616207406</guid>    <pubDate>2026-01-24T03:35:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598450302616207406" data-draft-id="7598499504169926694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘çš„ AI è¾…åŠ©å¼€å‘å·¥ç¨‹åŒ–å®æˆ˜"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-24T03:35:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sunseekers"/> <meta itemprop="url" content="https://juejin.cn/user/184373682644535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘çš„ AI è¾…åŠ©å¼€å‘å·¥ç¨‹åŒ–å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373682644535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sunseekers
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:35:55.000Z" title="Sat Jan 24 2026 03:35:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>ğŸš€ è¿›åŒ–ä¹‹è·¯ï¼šä»"äººæ•™ AI"åˆ°"AI å¸¦äºº"</strong></p>
<p>AI å¯ä»¥å†™ä»£ç ï¼Œä½†å®ƒä¸çŸ¥é“è¯¥åšä»€ä¹ˆï¼›AI å¯ä»¥æ›¿æˆ‘å†™ï¼Œä½†ä¸èƒ½æ›¿æˆ‘æƒ³ã€‚</p>
<p>ä¼šå†™ä»£ç ä¸å†æ˜¯æ ¸å¿ƒèƒ½åŠ›ï¼Œ<strong>ä¼šæ€è€ƒã€ä¼šå®šè§„èŒƒã€ä¼šå®¡ä»£ç </strong>ï¼Œæ‰æ˜¯ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å†™åœ¨å‰é¢ï¼šä¸€ä¸ª"å·¥å…·äºº"çš„è‡ªç™½</h2>
<p>æœ€è¿‘æˆ‘é™·å…¥äº†ä¸€ç§å¥‡æ€ªçš„çŠ¶æ€â€”â€”</p>
<p><strong>æˆ‘æ„Ÿè§‰è‡ªå·±æˆäº†ä¸€ä¸ªå·¥å…·äººã€‚</strong></p>
<p>æ¯å¤©éƒ½åœ¨å°è¯•å„ç§ AI å·¥å…·ï¼Œå„ç§å·¥å…·ç­ç­ä¸€é¡¿å¾€é¡¹ç›®é‡Œé€ ã€‚ä»Šå¤©æ˜¯æç¤ºè¯å·¥ç¨‹ï¼Œæ˜å¤©æ˜¯ MCPï¼Œåå¤©åˆæ˜¯ Skillã€Rulesâ€¦â€¦</p>
<p>ä»å‰æ˜¯å‘ ChatGPT æé—®ä»£ç ï¼Œå†æŠŠå›ç­”ç²˜è´´åˆ° IDEï¼›åˆ°å¦‚ä»Šæ˜¯å„è·¯ AI è¾…åŠ©ç¼–ç¨‹å·¥å…·è½®ç•ªä¸Šé˜µã€‚</p>
<p>ä¸€è·¯èµ°æ¥ï¼Œæˆ‘å­¦ä¼šäº†ä»€ä¹ˆï¼Ÿ</p>
<p><strong>Prompt å·¥ç¨‹ã€é¡¹ç›®è§„åˆ’ã€è§„èŒƒçº¦æŸçš„èƒ½åŠ›ã€‚</strong> å¥½åƒéƒ½ä¸æ˜¯ï¼Œæˆ‘ä»€ä¹ˆä¹Ÿä¸ä¼š</p>
<p>å„ç§æ¦‚å¿µæ»¡å¤©é£ï¼šMCPã€Skillã€Agentâ€¦â€¦é¡¹ç›®é‡Œç–¯ç‹‚ä¸€é¡¿ AI ç‚«ã€‚</p>
<p>ä½†è¯´å®è¯ï¼ŒAI èƒ½åŠ›çš„æ‰©å±•ä¹Ÿç¡®å®è®©æˆ‘çš„ä¸“ä¸šèƒ½åŠ›å¾—ä»¥å»¶ä¼¸â€”â€”<strong>æˆ‘å¯ä»¥ä¸çŸ¥é“ï¼ŒAI çŸ¥é“å°±å¤Ÿäº†ã€‚</strong></p>
<p>ä½†æˆ‘çœŸæ­£çš„ç›®æ ‡ï¼Œä¸æ˜¯è¢«å·¥å…·ç‰µç€èµ°ã€‚</p>
<p><strong>æˆ‘çš„ç»ˆæç›®æ ‡ï¼šæˆä¸ºé‚£ä¸ªé©¾é©­å®ƒä»¬çš„è€æ¿ã€‚</strong></p>
<hr/>
<h2 data-id="heading-1">å¼€ç¯‡ï¼šä¸€ä¸ªçœŸå®çš„"ç¿»è½¦"ç°åœº</h2>
<blockquote>
<p>"å¸®æˆ‘å®ç°ä¸€ä¸ª XX åŠŸèƒ½"</p>
<p>AI ç§’å‡ºä»£ç ï¼Œçœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œç®€å•ä½“éªŒäº†ä¸€ä¸‹åŠŸèƒ½ï¼Œå¥½åƒæ˜¯é‚£ä¹ˆå›äº‹...</p>
<p>ä½†ä»”ç»†ä¸€çœ‹ï¼šclass ç»„ä»¶ï¼Ÿæˆ‘ä»¬ç”¨çš„æ˜¯å‡½æ•°ç»„ä»¶ï¼›å…¨å±€ CSSï¼Ÿæˆ‘ä»¬ç”¨çš„æ˜¯ UnoCSSï¼›å‘½åé£æ ¼ä¹Ÿä¸å¯¹...</p>
<p>æ”¹å®Œè¿™äº›ï¼Œæ—¶é—´éƒ½èŠ±åœ¨"çº é”™"ä¸Šäº†ã€‚æœ€åèŠ±åœ¨"çº é”™"ä¸Šçš„æ—¶é—´ï¼Œæ¯”è‡ªå·±å†™è¿˜é•¿ã€‚</p>
</blockquote>
<p><strong>è¿™ç§"AI å†™å®Œäººæ¥æ”¶æ‹¾æ®‹å±€"çš„ç»å†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿ</strong></p>
<h3 data-id="heading-2">ğŸ˜« å¸¸è§ç—›ç‚¹ä¸æ ¹å› åˆ†æ</h3>





























<table><thead><tr><th>ğŸ˜« ç—›ç‚¹</th><th>ğŸ” æ ¹å› </th></tr></thead><tbody><tr><td>ä»£ç é£æ ¼å’Œé¡¹ç›®ä¸ä¸€è‡´</td><td>AI ä¸äº†è§£é¡¹ç›®è§„èŒƒ</td></tr><tr><td>åŒä¸€é—®é¢˜ï¼Œæ¢ä¸ªä¸Šä¸‹æ–‡ç­”æ¡ˆå®Œå…¨ä¸åŒ</td><td>AI æ²¡æœ‰"è®°å¿†"</td></tr><tr><td>å¤§éœ€æ±‚ä¸€æ¬¡ç”Ÿæˆï¼Œè´¨é‡æƒ¨ä¸å¿ç¹</td><td>ä¸Šä¸‹æ–‡è¶…è½½ï¼ˆContext Overflowï¼‰</td></tr><tr><td>æ¯æ¬¡éƒ½è¦é‡å¤è§£é‡Šé¡¹ç›®èƒŒæ™¯</td><td>çŸ¥è¯†æ²¡æœ‰æ²‰æ·€</td></tr><tr><td>è°ƒæ•™å¥½çš„æç¤ºè¯ï¼Œæ¢ä¸ªé¡¹ç›®åˆè¦é‡æ¥</td><td>ç»éªŒæ— æ³•å¤ç”¨</td></tr></tbody></table>
<p><strong>ä»Šå¤©åˆ†äº«æˆ‘æ¢ç´¢å‡ºçš„ä¸¤ä¸ªæ ¸å¿ƒæ­¦å™¨</strong>ï¼š</p>
<ol>
<li><strong>OpenSpec</strong> â€”â€” è§„èŒƒé©±åŠ¨ï¼Œè®© AI è¾“å‡ºå¯æ§</li>
<li><strong>OpenSkills</strong> â€”â€” èƒ½åŠ›å¢å¼ºï¼Œè®©ç»éªŒå¯å¤ç”¨</li>
</ol>
<hr/>
<h2 data-id="heading-3">ä¸€ã€OpenSpecï¼šå»ºç«‹ AI çš„"æ•°å­—å›´æ "</h2>
<h3 data-id="heading-4">æ ¸å¿ƒç†å¿µ</h3>
<blockquote>
<p><strong>AI æ˜¯çº¯æ‰§è¡Œè§’è‰²ï¼Œä½ ç»™çš„è¾¹ç•Œè¶Šæ¸…æ™°ï¼Œè¾“å‡ºè¶Šå¯æ§</strong></p>
</blockquote>
<p>æŠŠ AI æƒ³è±¡æˆ"è¶…çº§å®ä¹ ç”Ÿ"ï¼š</p>
<ul>
<li>âœ… æ‰§è¡ŒåŠ›å¼ºã€ä¸çŸ¥ç–²å€¦ã€çŸ¥è¯†é¢å¹¿</li>
<li>âŒ ä½†éœ€è¦æ˜ç¡®çš„æŒ‡ä»¤å’Œè§„èŒƒï¼Œå¦åˆ™å®¹æ˜“"è‡ªç”±å‘æŒ¥"</li>
</ul>
<p><strong>ä¸€ä¸ªåˆ¤æ–­æ ‡å‡†</strong>ï¼šå¦‚æœäººç±»å·¥ç¨‹å¸ˆæ— æ³•æ˜ç¡®è¯´å‡ºåœ¨ç»™å®šæƒ…å†µä¸‹åº”è¯¥æ€ä¹ˆåšï¼ŒAI æ™ºèƒ½ä½“ä¹Ÿä¸èƒ½åšå¾—æ›´å¥½ã€‚</p>
<p>ä¸å…¶è®©äººåœ¨ review æ—¶é€æ­¥æƒ³èµ·é—æ¼å‘Šè¯‰ AIï¼Œä¸å¦‚å»ºç«‹ç³»ç»ŸåŒ–çš„ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œè®© AI è‡ªåŠ¨è·å–<strong>ç²¾ç®€ä¸”é«˜ä¿¡å·</strong>çš„ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-5">ä¸‰å±‚è§„èŒƒä½“ç³»</h3>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Contextï¼ˆä¸Šä¸‹æ–‡-é¡¹ç›®åœ°å›¾ï¼‰                  â”‚  â† é¡¹ç›®æ˜¯ä»€ä¹ˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Rulesï¼ˆä»£ç è§„èŒƒ-è‡ªåŠ¨é©¾é©¶è¾…åŠ©çº¿ï¼‰            â”‚  â† ä»£ç æ€ä¹ˆå†™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ Workflowï¼ˆæµç¨‹è§„èŒƒ-æ ‡å‡†æ“ä½œç¨‹åºï¼‰           â”‚  â† éœ€æ±‚æ€ä¹ˆåš
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-6">1ï¸âƒ£ Contextï¼šè®© AI "è®¤è¯†"ä½ çš„é¡¹ç›®</h3>
<p><strong>é—®é¢˜</strong>ï¼šAI ä¸Šä¸‹æ–‡çª—å£æœ‰é™ï¼Œä¸€æ¬¡å¡å¤ªå¤šä¼šäº§ç”Ÿ"è®°å¿†ä¸¢å¤±"ï¼ˆContext Overflowï¼‰</p>
<p><strong>è§£æ³•</strong>ï¼šç»“æ„åŒ–æ–‡æ¡£ï¼Œåˆ†é˜¶æ®µæ²‰æ·€</p>
<pre><code class="hljs">context/
â”œâ”€â”€ é¡¹ç›®æ¦‚è§ˆ.md   â†’ æŠ€æœ¯æ ˆã€ç›®å½•ç»“æ„
â”œâ”€â”€ æ¶æ„è®¾è®¡.md   â†’ æ¨¡å—èŒè´£ã€æ•°æ®æµ
â”œâ”€â”€ å½“å‰éœ€æ±‚.md   â†’ éœ€æ±‚èƒŒæ™¯ã€é¢„æœŸç›®æ ‡
â””â”€â”€ ä»£ç æ˜ å°„.md   â†’ éœ€æ±‚ä¸ä»£ç çš„å¯¹åº”å…³ç³»
</code></pre>
<p><strong>è¿›é˜¶ç©æ³•ï¼šOpenSpec è§„èŒƒä¼˜å…ˆ</strong></p>
<p>åœ¨å†™ä»£ç ä¹‹å‰ï¼Œå…ˆè®©äººå’Œ AI å¯¹è§„èŒƒè¾¾æˆä¸€è‡´ï¼š</p>
<pre><code class="hljs">specs/
â”œâ”€â”€ proposal.md   â†’ é—®é¢˜é™ˆè¿°ã€æ–¹æ¡ˆæ¦‚è¿°ã€é¢„æœŸæ”¶ç›Š
â”œâ”€â”€ design.md     â†’ æŠ€æœ¯è®¾è®¡ã€æ¶æ„å†³ç­–ã€æ¥å£å®šä¹‰
â””â”€â”€ tasks.md      â†’ å®ç°æ¸…å•ã€ä»»åŠ¡æ‹†è§£ã€éªŒæ”¶æ ‡å‡†
</code></pre>
<p><strong>æµç¨‹</strong>ï¼šéœ€æ±‚è¾“å…¥ â†’ ç”Ÿæˆ proposal â†’ ç¡®è®¤åç”Ÿæˆ design â†’ æ‹†è§£ä¸º tasks â†’ é€ä¸ªå®ç° â†’ å½’æ¡£</p>
<blockquote>
<p>ğŸ’¡ å¥½å¤„ï¼šAI åœ¨åŠ¨æ‰‹å‰å°±ç†è§£äº†"ä¸ºä»€ä¹ˆåš"å’Œ"æ€ä¹ˆåš"ï¼Œå‡å°‘è¿”å·¥</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">2ï¸âƒ£ Rulesï¼šè®© AI è¾“å‡º"åƒä½ å†™çš„"</h3>
<p>åˆ¶å®šä»£ç é£æ ¼è§„èŒƒï¼ˆå¦‚ï¼šä¼˜å…ˆä½¿ç”¨ TypeScriptã€UnoCSSï¼‰ï¼Œè®©è¾“å‡ºåƒä½ äº²æ‰‹å†™çš„ä¸€æ ·ã€‚</p>





















<table><thead><tr><th>åŸåˆ™</th><th>å®è·µæ–¹æ³•</th></tr></thead><tbody><tr><td>éœ€æ±‚ç†è§£æ˜¯åŸºç¡€</td><td>åå¤ç¡®è®¤ï¼š"ä½ æ‡‚äº†å—ï¼Ÿä¸æ‡‚å°±é—®æˆ‘"</td></tr><tr><td>ä»£ç ç†è§£æ˜¯å‚è€ƒ</td><td>ç”¨ md æ–‡æ¡£æ²‰æ·€ç°æœ‰ä»£ç çš„è®¾è®¡æ„å›¾</td></tr><tr><td>è§„èŒƒç»Ÿä¸€æ˜¯ä¿éšœ</td><td>åˆ¶å®šä»£ç é£æ ¼è§„èŒƒï¼Œä¿æŒä¸€è‡´æ€§</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">3ï¸âƒ£ Workflowï¼šéœ€æ±‚å®ç°ä¸‰æ­¥èµ°</h3>

























<table><thead><tr><th>æ­¥éª¤</th><th>åšä»€ä¹ˆ</th><th>å…³é”®è¯æœ¯</th></tr></thead><tbody><tr><td><strong>èŠéœ€æ±‚</strong></td><td>ç¡®ä¿ AI ç†è§£</td><td>"ä½ æ‡‚äº†å—ï¼Ÿä¸æ‡‚å“ªé‡Œï¼Ÿ"</td></tr><tr><td><strong>å®šæ–¹æ¡ˆ</strong></td><td>å¯¹é½æŠ€æœ¯æ–¹æ¡ˆ</td><td>"ä½ æ‰“ç®—æ€ä¹ˆå®ç°ï¼Ÿæœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ"</td></tr><tr><td><strong>åˆ†æ­¥åš</strong></td><td>å°æ­¥å¿«è·‘</td><td>"å…ˆåš xxxï¼Œå®Œæˆåå†åšä¸‹ä¸€æ­¥"</td></tr></tbody></table>
<blockquote>
<p>âš ï¸ <strong>é»„é‡‘æ³•åˆ™ï¼šæ°¸è¿œä¸è¦è®© AI ä¸€å£æ°”å®Œæˆå¤§éœ€æ±‚</strong></p>
<p>ä»»åŠ¡è¶Šå° â†’ AI å®Œæˆåº¦è¶Šé«˜ â†’ Review è¶Šè½»æ¾</p>
</blockquote>
<h3 data-id="heading-9">OpenSpec å°ç»“</h3>

























<table><thead><tr><th>å±‚çº§</th><th>ä½œç”¨</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>Context</td><td>è®© AI äº†è§£é¡¹ç›®</td><td>ä¸ç”¨æ¯æ¬¡é‡å¤è§£é‡Š</td></tr><tr><td>Rules</td><td>ç»Ÿä¸€ä»£ç é£æ ¼</td><td>è¾“å‡ºè´¨é‡ç¨³å®š</td></tr><tr><td>Workflow</td><td>è§„èŒƒå¼€å‘æµç¨‹</td><td>å°æ­¥å¿«è·‘ï¼Œå¯æ§</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šè®© AI è¾“å‡º<strong>å¯æ§ã€å¯é¢„æœŸ</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">äºŒã€OpenSkillsï¼šè®©ç»éªŒ"åŸå­åŒ–"ä¸èµ„äº§åŒ–</h2>
<h3 data-id="heading-11">ä»€ä¹ˆæ˜¯ Skillï¼Ÿ</h3>
<blockquote>
<p><strong>Skill = å¯å¤ç”¨çš„èƒ½åŠ›å•å…ƒ = æç¤ºè¯ + æ–‡æ¡£ + è„šæœ¬</strong></p>
</blockquote>
<p>ç®€å•è¯´ï¼š<strong>Skill å°±æ˜¯ .md æ ¼å¼ç¼–å†™çš„"æŠ€èƒ½åŒ…"</strong></p>
<p>æœ¬è´¨æ˜¯æŠŠä¸“å®¶çš„"æœ€å¼ºçŠ¶æ€"æ‰“åŒ…æˆ SOPï¼Œè®©ç»éªŒåœ¨ Git ä»“åº“é‡ŒæŒç»­æ¼”è¿›ã€‚</p>
<h3 data-id="heading-12">ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ Skillï¼Ÿ</h3>





















<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æŒ‰éœ€åŠ è½½</strong></td><td>éœ€è¦æ—¶å†å–‚ç»™ AIï¼Œä¸å ç”¨å®è´µçš„ä¸Šä¸‹æ–‡ç©ºé—´</td></tr><tr><td><strong>å…¨å‘˜å¤–æŒ‚</strong></td><td>è®©æ–°äººçš„æŒ‡å°–ç¬é—´å…·å¤‡æ¶æ„å¸ˆçš„ç»éªŒ</td></tr><tr><td><strong>å¯ç§»æ¤æ€§</strong></td><td>å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå³å¯å®Œæˆå›¢é˜Ÿèƒ½åŠ›çš„å¿«é€Ÿè¿ç§»</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">çŸ¥è¯†å¤åˆ©çš„æ¼”è¿›è·¯å¾„</h3>
<p>éšç€å¼€å‘æ¬¡æ•°çš„å¢åŠ ï¼Œä»æœ€åˆçš„"è§„èŒƒåŒ–å‘½å"åˆ°"æå–è‡ªå®šä¹‰ Hooks"ï¼Œå†åˆ°æœ€åçš„"AI é¢„è®¾è„šæ‰‹æ¶"ï¼Œå¼€å‘æ•ˆç‡ä¼šä»"å°æ—¶çº§"é™è‡³"åˆ†é’Ÿçº§"ã€‚</p>

























<table><thead><tr><th>é˜¶æ®µ</th><th>ä½ çš„åŠ¨ä½œ</th><th>äº§ç”Ÿçš„"å¤åˆ©"</th></tr></thead><tbody><tr><td><strong>ç¬¬ 1 æ¬¡</strong></td><td>è§„èŒƒåŒ–å‘½åä¸æ–‡æ¡£</td><td>ä»¥åä¸ç”¨ç¿»è®¾è®¡ç¨¿æ‰¾å°ºå¯¸</td></tr><tr><td><strong>ç¬¬ 2 æ¬¡</strong></td><td>æå– <code>useHooks</code></td><td>ä¸šåŠ¡é€»è¾‘ä¸ UI å½»åº•è§£è€¦</td></tr><tr><td><strong>ç¬¬ 6 æ¬¡+</strong></td><td>é…ç½®åŒ–/è„šæ‰‹æ¶/AI é¢„è®¾</td><td>å¼€å‘æ•ˆç‡ä»"å°æ—¶çº§"é™è‡³"åˆ†é’Ÿçº§"</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æˆ‘ä»¬å¤ç”¨çš„æ˜¯æ€æƒ³ã€æ¨¡å¼å’Œæœ€ä½³å®è·µï¼Œè€Œä¸ä»…ä»…æ˜¯ä»£ç å®ç°ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-14">å¦‚ä½•è‡ªå·±åˆ¶ä½œ Skillï¼Ÿ</h3>
<p><strong>ä¸‰æ­¥æå®š</strong>ï¼š</p>
<ol>
<li>æ–°å»ºæ–‡ä»¶å¤¹ <code>skills/my-custom-skill/</code></li>
<li>ç¼–å†™ <code>SKILL.md</code>ï¼ˆå®šä¹‰è§¦å‘æ¡ä»¶ã€æ‰§è¡Œæµç¨‹ã€è§„èŒƒè¦æ±‚ï¼‰</li>
<li>æ·»åŠ é…å¥—èµ„æºï¼ˆdocs/ã€scripts/ï¼Œå¯é€‰ï¼‰</li>
</ol>
<p><strong>SKILL.md æ¨¡æ¿</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: my-custom-skill
<span class="hljs-section">description: è¿™ä¸ªæŠ€èƒ½åšä»€ä¹ˆ
---</span>

<span class="hljs-section"># æŠ€èƒ½è¯´æ˜</span>

<span class="hljs-section">## è§¦å‘æ¡ä»¶</span>
å½“ç”¨æˆ·éœ€è¦ xxx æ—¶è§¦å‘

<span class="hljs-section">## æ‰§è¡Œæµç¨‹</span>
<span class="hljs-bullet">1.</span> ç¬¬ä¸€æ­¥åšä»€ä¹ˆ
<span class="hljs-bullet">2.</span> ç¬¬äºŒæ­¥åšä»€ä¹ˆ

<span class="hljs-section">## è§„èŒƒè¦æ±‚</span>
<span class="hljs-bullet">-</span> è§„èŒƒ 1
<span class="hljs-bullet">-</span> è§„èŒƒ 2
</code></pre>
<h3 data-id="heading-15">OpenSkills å°ç»“</h3>






























<table><thead><tr><th>ç»´åº¦</th><th>æ—  Skill</th><th>æœ‰ Skill</th></tr></thead><tbody><tr><td>æ•ˆç‡</td><td>æ¯æ¬¡é‡å¤è§£é‡Š</td><td>ä¸€æ¬¡åŠ è½½ï¼Œç›´æ¥å¹²æ´»</td></tr><tr><td>è´¨é‡</td><td>é è¿æ°”</td><td>é è§„èŒƒ</td></tr><tr><td>å¤ç”¨</td><td>ç»éªŒåœ¨è„‘å­é‡Œ</td><td>ç»éªŒåœ¨æ–‡ä»¶é‡Œ</td></tr><tr><td>åä½œ</td><td>å£å£ç›¸ä¼ </td><td>å¤åˆ¶ç²˜è´´</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šè®©ç»éªŒ<strong>å¯å¤ç”¨ã€å¯ä¼ æ‰¿</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-16">ä¸‰ã€1 + 2 = æœ€å¤§åŒ–æ•ˆèƒ½</h2>
<h3 data-id="heading-17">å®Œæ•´å·¥ä½œæµ</h3>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å®Œæ•´å·¥ä½œæµ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ Context    â†’  AI äº†è§£é¡¹ç›®èƒŒæ™¯            â”‚
â”‚  ğŸ“ Rules      â†’  AI éµå¾ªä»£ç è§„èŒƒ            â”‚
â”‚  âš¡ Skill      â†’  AI å…·å¤‡ä¸“ä¸šèƒ½åŠ›            â”‚
â”‚  ğŸ”„ Workflow   â†’  äººæœºé«˜æ•ˆåä½œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-18">çŸ¥è¯†çš„å¤åˆ©æ•ˆåº”</h3>
<pre><code class="hljs language-bash" lang="bash">éœ€æ±‚ <span class="hljs-comment">#1  â”€â”€â”€â†’  å»ºç«‹ context/ï¼ˆä»0åˆ°1ï¼ŒæŠ•å…¥ï¼‰</span>
éœ€æ±‚ <span class="hljs-comment">#2  â”€â”€â”€â†’  å¤ç”¨ context/ï¼ˆè¾¹é™…æˆæœ¬å¼€å§‹ä¸‹é™ï¼‰</span>
éœ€æ±‚ <span class="hljs-comment">#3-5 â”€â”€â†’  æ²‰æ·€ rules/ï¼ˆè§„èŒƒé€æ¸å®Œå–„ï¼‰</span>
éœ€æ±‚ <span class="hljs-comment">#6+ â”€â”€â”€â†’  å°è£…ä¸º Skillï¼ˆèƒ½åŠ›äº§å“åŒ–ï¼‰</span>
å›¢é˜Ÿå…±äº« â”€â”€â”€â†’  å…¨å‘˜å¤ç”¨ï¼ˆçŸ¥è¯†å¤åˆ©çˆ†å‘ï¼‰
</code></pre>
<h3 data-id="heading-19">æ•ˆæœå¯¹æ¯”</h3>






























<table><thead><tr><th>é˜¶æ®µ</th><th>ä¼ ç»Ÿæ¨¡å¼</th><th>OpenSpec + OpenSkills</th></tr></thead><tbody><tr><td>æ–°äººå…¥èŒ</td><td>è€äººè®²è§£ 4-7 å°æ—¶</td><td>åŠ è½½æ–‡æ¡£ 20 åˆ†é’Ÿ</td></tr><tr><td>é¦–æ¬¡è´¨é‡</td><td>ä¸ç¨³å®šï¼Œé è¿æ°”</td><td>ç¨³å®šï¼Œæœ‰è§„èŒƒä¿éšœ</td></tr><tr><td>çŸ¥è¯†ä¼ æ‰¿</td><td>å£å£ç›¸ä¼ ï¼Œæ˜“ä¸¢å¤±</td><td>æ–‡ä»¶åŒ–ï¼Œå¯è¿½æº¯</td></tr><tr><td>è¾¹é™…æˆæœ¬</td><td>å›ºå®šä¸å˜</td><td>æŒç»­é€’å‡</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">å››ã€æ ¸å¿ƒç†å¿µè½¬å˜ï¼šä»ä»£ç å¤ç”¨åˆ°è§„èŒƒå¤ç”¨</h2>
<p>AI æ—¶ä»£æœ€å¤§çš„å˜åŒ–æ˜¯<strong>ä»£ç ç”Ÿæˆæˆæœ¬çš„æ€¥å‰§ä¸‹é™</strong>ã€‚</p>
<p>å½“ç¼–å†™ä¸€ä¸ªæ–°ç»„ä»¶çš„è¾¹é™…æˆæœ¬æ¥è¿‘äºé›¶æ—¶ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦æ‰¿å—å¤æ‚ç»„ä»¶å¸¦æ¥çš„ç»´æŠ¤è´Ÿæ‹…ï¼Ÿ</p>
<p><strong>æ–°çš„è§£å†³æ€è·¯</strong>ï¼š</p>
<p>ä¸å…¶æ„å»ºä¸€ä¸ªæå…¶å¤æ‚çš„"ä¸‡èƒ½ç»„ä»¶"æ¥é€‚é…æ‰€æœ‰åœºæ™¯ï¼Œä¸å¦‚ä¸ºæ¯ä¸ªå…·ä½“åœºæ™¯å®šåˆ¶ä¸“é—¨çš„å®ç°ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªå…·ä½“åœºæ™¯å®šåˆ¶ä¸“é—¨çš„ç»„ä»¶å®ç°</li>
<li>é€šè¿‡ AI æŒ‰éœ€ç”Ÿæˆï¼Œè€Œä¸æ˜¯è¯•å›¾æ„å»ºä¸‡èƒ½ç»„ä»¶</li>
<li>è®©æ¯ä¸ªç»„ä»¶ä¸“æ³¨äºç‰¹å®šåœºæ™¯ï¼Œé€»è¾‘æ›´ç®€æ´æ¸…æ™°</li>
</ul>
<p>æˆ‘ä»¬é€šè¿‡è§„èŒƒçº¦æŸ AI å¿«é€Ÿç”Ÿæˆï¼Œä¿æŒé€»è¾‘çš„ç®€æ´ä¸çº¯ç²¹ã€‚</p>
<p><strong>è§„èŒƒé©±åŠ¨å¼€å‘çš„ä»·å€¼</strong>ï¼š</p>






























<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>è§„èŒƒé©±åŠ¨</th></tr></thead><tbody><tr><td>å¤ç”¨æ–¹å¼</td><td>å¤æ‚çš„ä¸‡èƒ½ç»„ä»¶</td><td>ç®€æ´çš„ä¸“ç”¨ç»„ä»¶</td></tr><tr><td>è´¨é‡ä¿éšœ</td><td>ä¾èµ–ä¸ªäººç»éªŒ</td><td>è§„èŒƒçº¦æŸ AI ç”Ÿæˆ</td></tr><tr><td>å¼€å‘æ•ˆç‡</td><td>å°æ—¶çº§</td><td>åˆ†é’Ÿçº§</td></tr><tr><td>çœŸæ­£å¤ç”¨çš„æ˜¯</td><td>å…·ä½“ä»£ç å®ç°</td><td>æ€æƒ³ã€æ¨¡å¼å’Œæœ€ä½³å®è·µ</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>è¿™å°±æ˜¯åŸºäºè§„èŒƒçš„å¤ç”¨â€”â€”æˆ‘ä»¬å¤ç”¨çš„æ˜¯è®¾è®¡ç†å¿µã€æ¥å£è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œè€Œä¸æ˜¯å…·ä½“çš„ä»£ç å®ç°ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-21">äº”ã€æˆ‘çš„æ€è€ƒä¸å±•æœ›</h2>
<h3 data-id="heading-22">åªè¦æç¤ºè¯å†™å¾—å¤Ÿå¥½ï¼Ÿ</h3>
<p>æœ‰æ®µæ—¶é—´æˆ‘æ²‰è¿·äºæ‰“ç£¨æç¤ºè¯ï¼Œè§‰å¾—"åªè¦æˆ‘çš„æç¤ºè¯å†™å¾—å¤Ÿå¥½ï¼ŒAI å°±èƒ½å®Œç¾æ‰§è¡Œ"ã€‚</p>
<p>ä½†åæ¥æˆ‘å‘ç°ï¼Œ<strong>æç¤ºè¯åªæ˜¯å†°å±±ä¸€è§’</strong>ã€‚</p>
<p>çœŸæ­£è®© AI é«˜æ•ˆå·¥ä½œçš„ï¼Œæ˜¯èƒŒåé‚£å¥—å®Œæ•´çš„è§„èŒƒä½“ç³»ï¼šContext è®©å®ƒäº†è§£é¡¹ç›®ï¼ŒRules è®©å®ƒéµå¾ªè§„èŒƒï¼ŒSkill è®©å®ƒå…·å¤‡èƒ½åŠ›ï¼ŒWorkflow è®©åä½œé¡ºç•…ã€‚</p>
<h3 data-id="heading-23">æœªæ¥çš„ç•…æƒ³</h3>
<p>æˆ‘è¶Šæ¥è¶Šç›¸ä¿¡ä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p><strong>åªè¦æ–‡æ¡£è½åœ°ã€è§„èŒƒè½åœ°ã€ç»´æŠ¤å¾—å¥½ï¼Œæœªæ¥äººå†™ä»£ç å°±å˜å¾—è¶Šæ¥è¶Šç®€å•äº†ï¼Œ0é—¨æ§›ã€‚</strong></p>
</blockquote>
<p>å½“è§„èŒƒè¶³å¤Ÿå®Œå–„ï¼Œå½“ Skill åº“è¶³å¤Ÿä¸°å¯Œï¼Œå½“ Context è¶³å¤Ÿæ¸…æ™°â€”â€”AI å°±èƒ½è‡ªåŠ¨å®Œæˆä»éœ€æ±‚ç†è§£åˆ°ä»£ç ç”Ÿæˆçš„å…¨è¿‡ç¨‹ã€‚</p>
<p><strong>äººçš„è§’è‰²ä¼šä»"ä»£ç ç¼–å†™è€…"å˜æˆ"è§„èŒƒåˆ¶å®šè€…"å’Œ"è´¨é‡æŠŠå…³è€…"ã€‚</strong></p>
<h3 data-id="heading-24">æ ¸å¿ƒå…¬å¼</h3>
<blockquote>
<p><strong>AI Coding æ•ˆèƒ½ = éœ€æ±‚ç†è§£èƒ½åŠ› Ã— æŠ€æœ¯åˆ¤æ–­åŠ› Ã— è§„èŒƒå®Œå–„åº¦</strong></p>
<p>ä¸‰è€…ç¼ºä¸€ä¸å¯ï¼Œè§„èŒƒæ˜¯æ”¾å¤§å™¨ï¼</p>
</blockquote>
<h3 data-id="heading-25">ä¸å˜çš„æ ¸å¿ƒ</h3>
<p>å·¥å…·åœ¨è¿›åŒ–ï¼š</p>
<ul>
<li>2024ï¼šAgent çˆ†å‘</li>
<li>2025ï¼šMCP / OpenSpec / Skill ...</li>
<li>æœªæ¥ï¼šæ›´å¤šå¯èƒ½</li>
</ul>
<p>ä½†æœ‰äº›ä¸œè¥¿æ°¸è¿œä¸ä¼šå˜ï¼š</p>
<blockquote>
<p><strong>éœ€æ±‚ç†è§£</strong>å’Œ<strong>æŠ€æœ¯åˆ¤æ–­</strong>æ°¸è¿œæ˜¯æ ¸å¿ƒç«äº‰åŠ›</p>
</blockquote>
<p>ä¼šå†™ä»£ç ï¼Œä¸å†æ˜¯æ ¸å¿ƒèƒ½åŠ›ã€‚<strong>ä¼šæ€è€ƒã€ä¼šæç‚¼è§‚ç‚¹ã€ä¼šå®¡æ ¡</strong>ï¼Œæ‰æ˜¯ã€‚</p>
<p>æˆ‘ä»¬æ­£åœ¨å®Œæˆä»"ä»£ç ç¼–å†™è€…"åˆ°"è§„èŒƒåˆ¶å®šè€…"ä¸"è´¨é‡æŠŠå…³è€…"çš„è½¬å‹ã€‚</p>
<p>ä»"ä¼šå†™ä»£ç "åˆ°"ä¼šæéœ€æ±‚ + ä¼šå®¡ä»£ç "â€”â€”è¿™æ˜¯æˆ‘ä»¬è¿™ä¸€ä»£å¼€å‘è€…å¿…é¡»å®Œæˆçš„è½¬å‹ã€‚</p>
<hr/>
<h2 data-id="heading-26">å†™åœ¨æœ€å</h2>
<p>ä¸æ˜¯æ‰€æœ‰å·¥ä½œéƒ½å€¼å¾—äº¤ç»™ AIï¼Œä½†<strong>æ‰€æœ‰ä½ä»·å€¼çš„é‡å¤æ€§å·¥ä½œéƒ½åº”è¯¥è¢« AI æ›¿ä»£</strong>ã€‚</p>
<p>è¿™æ ·åšçš„æ ¸å¿ƒä»·å€¼ä¸åœ¨äºçœäº†å¤šå°‘äººåŠ›ï¼Œè€Œåœ¨äºè®©æˆ‘ä»¬å¾—ä»¥ä»ç¹ççš„æ‰§è¡Œä¸­æŠ½èº«ï¼Œ<strong>ä¸“æ³¨äºæ›´é«˜ä»·å€¼çš„äº‹æƒ…</strong>ï¼šè®¾è®¡æµç¨‹ã€ä¼˜åŒ–ä½“éªŒã€åˆ›é€ æ–°ä»·å€¼ã€‚</p>
<p><strong>æˆ‘æŠŠæˆ‘çš„ç»éªŒéƒ½å†™è¿›äº†è§„èŒƒé‡Œï¼Œç¥æˆ‘æ—©æ—¥æˆä¸ºä¸€ä¸ª Prompt å·¥ç¨‹å¸ˆç®¡ç†å¸ˆï¼</strong></p>
<hr/>
<blockquote>
<p>ğŸ”— <strong>ä¸€ä¸ªå°æŠ€å·§</strong>ï¼šå¦‚æœä½ åœ¨ AI ç¼–ç¨‹ä¸­ï¼ŒåŒä¸€ä¸ªé”™è¯¯å‡ºç°äº† 2 æ¬¡ä»¥ä¸Šï¼Œæˆ–è€…æŸä¸ªéœ€æ±‚åå¤ä¸ç¬¦åˆé¢„æœŸï¼Œè¯·åŠ¡å¿…è®© AI è®°ä¸‹æ¥ï¼ˆå†™å…¥ Rulesï¼‰ã€‚è¿™èƒ½æ˜¾è‘—æé«˜æ•ˆç‡ï¼Œé¿å…é‡å¤è¸©å‘ã€‚</p>
</blockquote>
<hr/>
<p><strong>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</strong></p>
<p>æœŸå¾…å’Œå¤§å®¶ä¸€èµ·æ¢ç´¢ AI è¾…åŠ©å¼€å‘çš„æ›´å¤šå¯èƒ½ï¼</p>
<hr/>
<p>ğŸ“¢ <strong>å…³æ³¨æˆ‘ï¼Œå…±äº«æˆ‘çŸ¥ï¼Œæˆ‘æ€ï¼Œæˆ‘å­¦ï¼Œæˆ‘æƒ³</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4b2daf0cf60408db183e64d2c0e44a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3Vuc2Vla2Vycw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769830656&amp;x-signature=o%2FdXq%2FmPA09H41xsxN4Ci2jeL7M%3D" alt="qrcode_for_gh_3411f0c12384_258.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 5]ï¼šç­–ç•¥ã€é€‚é…å™¨ä¸ä»£ç†æ¨¡å¼]]></title>    <link>https://juejin.cn/post/7598390354291736622</link>    <guid>https://juejin.cn/post/7598390354291736622</guid>    <pubDate>2026-01-23T09:28:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390354291736622" data-draft-id="7598390244379263014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 5]ï¼šç­–ç•¥ã€é€‚é…å™¨ä¸ä»£ç†æ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-23T09:28:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ç‹å£®å£®"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ—æ¨¡å—åŒ– [4 - 5]ï¼šç­–ç•¥ã€é€‚é…å™¨ä¸ä»£ç†æ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ç‹å£®å£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:28:32.000Z" title="Fri Jan 23 2026 09:28:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>å†™åœ¨å‰é¢</strong></p>
<p>æ¶æ„å¸ˆå’Œæ™®é€šå¼€å‘è€…çš„åŒºåˆ«ï¼Œå¾€å¾€ä¸åœ¨äºè°ä¼šå†™çš„æ¡†æ¶æ›´å¤šï¼Œè€Œåœ¨äº<strong>è°èƒ½å†™å‡ºæ›´å°‘ <code>if-else</code> çš„ä»£ç </strong>ã€‚</p>
<p><strong>åœˆå¤æ‚åº¦ï¼ˆCyclomatic Complexityï¼‰</strong> æ˜¯è¡¡é‡ä»£ç è´¨é‡çš„é‡è¦æŒ‡æ ‡ã€‚ä¸€ä¸ªå……æ–¥ç€å‡ åå±‚åˆ¤æ–­åµŒå¥—çš„å‡½æ•°ï¼Œæ˜¯ç»´æŠ¤è€…çš„å™©æ¢¦ã€‚æ¯å¢åŠ ä¸€ä¸ª <code>else</code>ï¼Œç³»ç»Ÿçš„è„†å¼±æ€§å°±å¢åŠ ä¸€åˆ†ã€‚</p>
<p>æ­¤å¤–ï¼Œå‰ç«¯ä½œä¸ºè¿æ¥ç”¨æˆ·ä¸åç«¯çš„æ¡¥æ¢ï¼Œæ—¶åˆ»é¢ä¸´ç€â€œåç«¯æ¥å£å˜åŠ¨â€å’Œâ€œç¬¬ä¸‰æ–¹åº“å‡çº§â€çš„é£é™©ã€‚å¦‚æœæ²¡æœ‰ä¸€å±‚åšåšçš„â€œé˜²å¼¹è¡£â€ï¼Œä½ çš„æ ¸å¿ƒä¸šåŠ¡ä»£ç å°†è¢«å¤–éƒ¨å˜åŒ–å‡»ç©¿ã€‚</p>
<p>æœ¬ç¯‡æˆ‘ä»¬å°†æ¢è®¨ä¸‰ä¸ªæœ€å®ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬æ˜¯é™ä½å¤æ‚åº¦ã€æå‡ç³»ç»Ÿé²æ£’æ€§çš„æ ¸å¿ƒæ­¦å™¨ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d47d279f39046349036a4a9298ea4e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765311&amp;x-signature=%2B3F5RjHkQUnbqbwlm197zhiZWcM%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ç­–ç•¥æ¨¡å¼ (Strategy)ï¼šæ¶ˆç­ <code>if-else</code> çš„å± é¾™åˆ€</h2>
<p>ä½ ä¸€å®šè§è¿‡è¿™æ ·çš„ä»£ç ï¼ˆç”šè‡³æ­£åœ¨å†™ï¼‰ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//  å…¸å‹çš„â€œå±å±±â€é›å½¢</span>
function getBonus(level, salary) {
  <span class="hljs-keyword">if</span> (level === <span class="hljs-string">'S'</span>) {
    <span class="hljs-keyword">return</span> salary * <span class="hljs-number">4</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (level === <span class="hljs-string">'A'</span>) {
    <span class="hljs-keyword">return</span> salary * <span class="hljs-number">3</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (level === <span class="hljs-string">'B'</span>) {
    <span class="hljs-keyword">return</span> salary * <span class="hljs-number">2</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> salary;
  }
}
</code></pre>
<p>å½“ç­‰çº§å¢åŠ åˆ° 20 ä¸ªï¼Œæˆ–è€…è®¡ç®—é€»è¾‘å˜å¾—æå…¶å¤æ‚æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè†¨èƒ€åˆ°å‡ ç™¾è¡Œã€‚</p>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒæ€æƒ³ï¼šæŠŠâ€œåˆ¤æ–­â€è½¬ä¸ºâ€œæ˜ å°„â€</h3>
<p>ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ <strong>å¼€é—­åŸåˆ™ï¼ˆOpen/Closed Principleï¼‰</strong> ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ æˆ‘ä»¬å°†æ¯ç§è®¡ç®—é€»è¾‘å°è£…æˆç‹¬ç«‹çš„â€œç­–ç•¥â€ï¼Œç„¶åç”¨ä¸€ä¸ªâ€œç¯å¢ƒå¯¹è±¡ï¼ˆContextï¼‰â€æ¥åˆ†å‘ã€‚</p>
<h3 data-id="heading-2">1.2 æ¶æ„çº§é‡æ„</h3>
<p>åœ¨å‰ç«¯ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦åƒ Java é‚£æ ·å®šä¹‰æ¥å£å’Œç±»ï¼Œåˆ©ç”¨ JavaScript çš„å¯¹è±¡æ˜ å°„ï¼ˆObject Mapï¼‰å³å¯ä¼˜é›…å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç­–ç•¥è¡¨ï¼šç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘å•å…ƒ</span>
<span class="hljs-keyword">const</span> strategies = {
  <span class="hljs-attr">S</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">4</span>,
  <span class="hljs-attr">A</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">3</span>,
  <span class="hljs-attr">B</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">2</span>,
  <span class="hljs-attr">DEFAULT</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary
};

<span class="hljs-comment">// ç¯å¢ƒå‡½æ•°ï¼šåªè´Ÿè´£åˆ†å‘ï¼Œä¸è´Ÿè´£é€»è¾‘</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateBonus</span>(<span class="hljs-params">level, salary</span>) {
  <span class="hljs-keyword">const</span> strategy = strategies[level] || strategies.<span class="hljs-property">DEFAULT</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">strategy</span>(salary);
}
</code></pre>
<p><strong>å®æˆ˜åœºæ™¯ï¼šè¡¨å•éªŒè¯</strong> ä¸è¦åœ¨æäº¤å‡½æ•°é‡Œå†™ä¸€å † <code>if (phone === '') ... if (!email.includes('@'))</code>ã€‚ å®šä¹‰ä¸€ä¸ª <code>Validator</code> ç±»ï¼Œä¼ å…¥ä¸€ç»„ç­–ç•¥è§„åˆ™ï¼š <code>validator.add(value, 'isNonEmpty').add(value, 'isMobile')</code>ã€‚ å½“ä½ æƒ³å¢åŠ ä¸€ç§æ–°çš„éªŒè¯è§„åˆ™ï¼ˆæ¯”å¦‚éªŒè¯èº«ä»½è¯ï¼‰ï¼Œä½ åªéœ€è¦åœ¨ç­–ç•¥è¡¨ä¸­æ–°å¢ä¸€ä¸ªå‡½æ•°ï¼Œè€Œå®Œå…¨ä¸éœ€è¦è§¦ç¢°è¡¨å•æäº¤çš„ä¸»é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-3">äºŒã€ é€‚é…å™¨æ¨¡å¼ (Adapter)ï¼šæ„å»ºâ€œé˜²è…å±‚ (ACL)â€</h2>
<p>å‰ç«¯æ˜¯ä¸€ä¸ªæå…¶ä¾èµ–â€œå¤–éƒ¨è¾“å…¥â€çš„é¢†åŸŸã€‚</p>
<ul>
<li>ä¾èµ–åç«¯ APIï¼šåç«¯æŠŠ <code>timestamp</code> æ”¹æˆäº† <code>ISO String</code>ï¼Œå‰ç«¯å´©äº†ã€‚</li>
<li>ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼šåœ°å›¾åº“ä» Google Maps æ¢æˆäº† Mapboxï¼ŒAPI å…¨å˜äº†ï¼Œå‰ç«¯å´©äº†ã€‚</li>
</ul>
<h3 data-id="heading-4">2.1 æ ¸å¿ƒæ€æƒ³ï¼šä¸è¦ç›´æ¥åƒâ€œç”Ÿè‚‰â€</h3>
<p><strong>é˜²è…å±‚ï¼ˆAnti-Corruption Layerï¼‰</strong> æ˜¯æ¶æ„ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒæ„å‘³ç€ï¼š<strong>æ°¸è¿œä¸è¦æŠŠç¬¬ä¸‰æ–¹çš„æ•°æ®ç»“æ„ç›´æ¥é€ä¼ ç»™ä½ çš„æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ã€‚</strong></p>
<h3 data-id="heading-5">2.2 å®æˆ˜åœºæ™¯ï¼šAPI å“åº”å½’ä¸€åŒ–</h3>
<p>å‡è®¾åç«¯è¿”å›çš„ç”¨æˆ·æ•°æ®ç»“æ„ä¹±ä¸ƒå…«ç³Ÿï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åç«¯è¿”å›çš„ Raw Data</span>
<span class="hljs-type">const</span> response = {
  id: <span class="hljs-number">123</span>,
  u_name: <span class="hljs-string">'John'</span>, <span class="hljs-comment">// å¥‡æ€ªçš„å‘½å</span>
  role_id: <span class="hljs-number">0</span>,     <span class="hljs-comment">// é­”æ³•æ•°å­—</span>
  create_at: <span class="hljs-string">'2023-01-01'</span>
};
</code></pre>
<p>å¦‚æœä½ ç›´æ¥åœ¨ç»„ä»¶é‡Œç”¨ <code>data.u_name</code>ï¼Œä½ å°±è¢«åç«¯ç»‘æ¶äº†ã€‚è¯·åŠ ä¸Šä¸€ä¸ªé€‚é…å™¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//  UserAdapter.ts</span>
export <span class="hljs-keyword">const</span> userAdapter = (<span class="hljs-keyword">data</span>: any): User =&gt; ({
  id: <span class="hljs-keyword">data</span>.id,
  name: <span class="hljs-keyword">data</span>.u_name || <span class="hljs-string">'Guest'</span>, <span class="hljs-comment">// é»˜è®¤å€¼ä¿æŠ¤</span>
  role: <span class="hljs-keyword">data</span>.role_id === <span class="hljs-number">0</span> ? <span class="hljs-string">'Admin'</span> : <span class="hljs-string">'User'</span>, <span class="hljs-comment">// é€»è¾‘è½¬æ¢</span>
  createdAt: new Date(<span class="hljs-keyword">data</span>.create_at).getTime() <span class="hljs-comment">// æ ¼å¼æ ‡å‡†åŒ–</span>
});
</code></pre>
<p><strong>æ¶æ„ä»·å€¼ï¼š</strong> å½“åç«¯æ”¹æ¥å£æ—¶ï¼Œä½ åªéœ€è¦ä¿®æ”¹ <code>UserAdapter.ts</code> è¿™ä¸€å¤„ä»£ç ï¼Œæ‰€æœ‰ä½¿ç”¨ <code>User</code> ç±»å‹çš„ UI ç»„ä»¶éƒ½ä¸éœ€è¦åŠ¨ã€‚è¿™å°±æ˜¯<strong>éš”ç¦»å˜åŒ–</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ ä»£ç†æ¨¡å¼ (Proxy)ï¼šæ— ä¾µå…¥çš„â€œéšå½¢ä¿é•–â€</h2>
<p>ä»£ç†æ¨¡å¼åœ¨å‰ç«¯çš„åœ°ä½å›  Vue 3 è€Œå°ç¥ï¼Œä½†å®ƒçš„ç”¨é€”è¿œä¸æ­¢äºå“åº”å¼ã€‚ å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨å¯¹è±¡æ“ä½œçš„â€œå¿…ç»ä¹‹è·¯â€ä¸Šè®¾å¡ï¼Œè¿›è¡Œæ‹¦æˆªã€å¢å¼ºæˆ–ç¼“å­˜ã€‚</strong></p>
<h3 data-id="heading-7">3.1 å®æˆ˜åœºæ™¯ä¸€ï¼šç½‘ç»œè¯·æ±‚çš„æ— æ„Ÿç¼“å­˜</h3>
<p>ä½ æƒ³ä¼˜åŒ–æ€§èƒ½ï¼ŒæŠŠç›¸åŒçš„ API è¯·æ±‚ç¼“å­˜ä¸‹æ¥ã€‚ä¿®æ”¹ <code>fetchData</code> å‡½æ•°ï¼Ÿå¤ª Low äº†ï¼Œè€Œä¸”ä¾µå…¥æ€§å¤ªå¼ºã€‚ ä½¿ç”¨ Proxy åˆ›å»ºä¸€ä¸ªâ€œç¼“å­˜ä»£ç†â€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> apiCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå¸¦ç¼“å­˜åŠŸèƒ½çš„ Fetch ä»£ç†</span>
<span class="hljs-keyword">const</span> cachedFetch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(fetch, {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, args</span>) {
    <span class="hljs-keyword">const</span> url = args[<span class="hljs-number">0</span>];
    
    <span class="hljs-comment">// 1. æ‹¦æˆªï¼šå¦‚æœç¼“å­˜é‡Œæœ‰ï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> (apiCache.<span class="hljs-title function_">has</span>(url)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hit Cache:'</span>, url);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(apiCache.<span class="hljs-title function_">get</span>(url));
    }

    <span class="hljs-comment">// 2. æ”¾è¡Œï¼šæ‰§è¡ŒåŸå‡½æ•°</span>
    <span class="hljs-keyword">return</span> target.<span class="hljs-title function_">apply</span>(thisArg, args).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
      <span class="hljs-comment">// 3. å¢å¼ºï¼šä¿å­˜ç»“æœ</span>
      apiCache.<span class="hljs-title function_">set</span>(url, res.<span class="hljs-title function_">clone</span>()); 
      <span class="hljs-keyword">return</span> res;
    });
  }
});
</code></pre>
<p>ä¸šåŠ¡ä»£ç å®Œå…¨ä¸éœ€è¦çŸ¥é“â€œç¼“å­˜â€çš„å­˜åœ¨ï¼Œå®ƒä¾ç„¶æ­£å¸¸è°ƒç”¨ <code>cachedFetch</code>ï¼Œä½†è‡ªåŠ¨è·å¾—äº†ç¼“å­˜èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-8">3.2 å®æˆ˜åœºæ™¯äºŒï¼šå›¾ç‰‡æ‡’åŠ è½½</h3>
<p>åœ¨ HTML åŠ è½½æ—¶ï¼Œå…ˆå±•ç¤ºä¸€å¼ å ä½å›¾ï¼ˆLoadingï¼‰ï¼Œç­‰çœŸæ­£çš„å›¾ç‰‡ä¸‹è½½å¥½äº†å†æ›¿æ¢ã€‚è¿™å°±æ˜¯<strong>è™šæ‹Ÿä»£ç†</strong>ã€‚ ä»£ç†å¯¹è±¡æŒæœ‰ <code>img</code> èŠ‚ç‚¹ï¼Œå…ˆè®¾ç½® <code>src=loading.gif</code>ï¼ŒåŒæ—¶åœ¨åå°åˆ›å»ºä¸€ä¸ª <code>Image</code> å¯¹è±¡å»ä¸‹è½½çœŸå®å›¾ç‰‡ï¼Œä¸‹è½½å®Œæˆåå†ä¿®æ”¹èŠ‚ç‚¹çš„ <code>src</code>ã€‚</p>
<hr/>
<h2 data-id="heading-9">å››ã€ æ¶æ„å¸ˆçš„â€œç»„åˆæ‹³â€</h2>
<p>åœ¨çœŸå®çš„å¤§å‹æ¶æ„ä¸­ï¼Œè¿™äº›æ¨¡å¼å¾€å¾€æ˜¯ç»„åˆä½¿ç”¨çš„ï¼š</p>
<ol>
<li><strong>ç”¨æˆ·æ“ä½œ</strong> è§¦å‘äº†æŸä¸ªè¡Œä¸ºã€‚</li>
<li><strong>ç­–ç•¥æ¨¡å¼</strong> æ ¹æ®ç”¨æˆ·ç±»å‹ï¼Œå†³å®šè°ƒç”¨å“ªä¸ª API æ¥å£ã€‚</li>
<li><strong>ä»£ç†æ¨¡å¼</strong> æ‹¦æˆªè¿™ä¸ª API è¯·æ±‚ï¼Œæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç¼“å­˜ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œè¯·æ±‚å‘å‡ºï¼Œæ‹¿åˆ°æ•°æ®ã€‚</li>
<li><strong>é€‚é…å™¨æ¨¡å¼</strong> å°†åç«¯è¿”å›çš„ä¹±ä¸ƒå…«ç³Ÿçš„ JSONï¼Œæ¸…æ´—æˆæ ‡å‡†çš„å‰ç«¯ Modelã€‚</li>
<li><strong>ç»„ä»¶</strong> æ¸²æŸ“è¿™ä¸ªå¹²å‡€çš„ Modelã€‚</li>
</ol>
<p>é€šè¿‡è¿™ä¸€å¥—ç»„åˆæ‹³ï¼Œæˆ‘ä»¬å°†<strong>é€»è¾‘åˆ†æ”¯ã€å‰¯ä½œç”¨ã€æ•°æ®è„æ´»</strong>å…¨éƒ¨éš”ç¦»åœ¨ç»„ä»¶ä¹‹å¤–ï¼Œç•™ç»™è§†å›¾å±‚çš„ï¼Œåªæœ‰çº¯ç²¹çš„æ¸²æŸ“ã€‚</p>
<hr/>
<h2 data-id="heading-10">ç»“è¯­ï¼šæ¨¡å—åŒ–çš„ç»ˆå±€</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„**ã€Šå‰ç«¯å‘æ¶æ„çªå›´ - æ¨¡å—åŒ–ã€‹**ç¯‡ç« åœ†æ»¡ç»“æŸã€‚</p>
<p>æˆ‘ä»¬ä»æ€æƒ³ä¸Šçš„<strong>è¾¹ç•Œæ€ç»´</strong>å‡ºå‘ï¼Œè®¾è®¡äº† <strong>Headless UI</strong> å’Œ <strong>å¤åˆç»„ä»¶</strong> çš„éª¨æ¶ï¼Œæ³¨å…¥äº† <strong>å‘å¸ƒè®¢é˜…/Signals</strong> çš„çµé­‚ï¼Œæœ€åç”¨ <strong>ç­–ç•¥/é€‚é…å™¨/ä»£ç†</strong> è¿™ä¸€å¥—ç›”ç”²æ­¦è£…äº†å…¨èº«ã€‚</p>
<p>è¿™äº”ç¯‡æ–‡ç« ï¼Œå…¶å®åªåœ¨è®²ä¸€ä»¶äº‹ï¼š<strong>é«˜å†…èšï¼Œä½è€¦åˆã€‚</strong></p>
<blockquote>
<p>AIå¿«é€Ÿçš„å‘å±•ä¸­ï¼Œå¯èƒ½åœ¨æœªæ¥å‰åç«¯å²—ä½ä¼šå‘ç”Ÿï¼Œä½†è¯•é—®ä¸€ä¸‹ï¼Œå¦‚æœçœŸåˆ°äº†é‚£ä¸ªæ—¶å€™ï¼Œæ³¢åŠåˆ°çš„ä¸ä¼šåªæœ‰äº’è”ç½‘è¡Œä¸šï¼Œè€Œæ˜¯æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼åŒæ ·ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å”¯æœ‰éšéœ€è€Œå˜ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº YOLOv8 çš„åŒ…è£…ç®±çº¸æ¿ç ´æŸç¼ºé™·æ£€æµ‹ç³»ç»Ÿ [ç›®æ ‡æ£€æµ‹å®Œæ•´æºç ]]]></title>    <link>https://juejin.cn/post/7598477092196335654</link>    <guid>https://juejin.cn/post/7598477092196335654</guid>    <pubDate>2026-01-24T03:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598477092196335654" data-draft-id="7598477092196319270" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº YOLOv8 çš„åŒ…è£…ç®±çº¸æ¿ç ´æŸç¼ºé™·æ£€æµ‹ç³»ç»Ÿ [ç›®æ ‡æ£€æµ‹å®Œæ•´æºç ]"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T03:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘æ˜¯æ°å°¼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº YOLOv8 çš„åŒ…è£…ç®±çº¸æ¿ç ´æŸç¼ºé™·æ£€æµ‹ç³»ç»Ÿ [ç›®æ ‡æ£€æµ‹å®Œæ•´æºç ]
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘æ˜¯æ°å°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:46:53.000Z" title="Sat Jan 24 2026 03:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºäº YOLOv8 çš„åŒ…è£…ç®±çº¸æ¿ç ´æŸç¼ºé™·æ£€æµ‹ç³»ç»Ÿ [ç›®æ ‡æ£€æµ‹å®Œæ•´æºç ]</h2>
<h3 data-id="heading-1">â€”â€” é¢å‘å·¥ä¸šäº§çº¿çš„è§†è§‰ç¼ºé™·æ£€æµ‹å®Œæ•´è§£å†³æ–¹æ¡ˆ</h3>
<hr/>
<h3 data-id="heading-2">ä¸€ã€è¡Œä¸šèƒŒæ™¯ï¼šåŒ…è£…ç®±è´¨æ£€ä¸ºä½•æˆä¸ºâ€œéšå½¢ç“¶é¢ˆâ€ï¼Ÿ</h3>
<p>åœ¨åˆ¶é€ ä¸šä¸ç‰©æµè¡Œä¸šä¸­ï¼Œçº¸æ¿åŒ…è£…ç®±å‡ ä¹æ— å¤„ä¸åœ¨ã€‚æ— è®ºæ˜¯ç”µå•†ä»“å‚¨ã€é£Ÿå“åŒ…è£…ï¼Œè¿˜æ˜¯å·¥ä¸šé›¶éƒ¨ä»¶è¿è¾“ï¼Œ<strong>åŒ…è£…ç®±çš„å®Œæ•´æ€§ç›´æ¥å½±å“å•†å“å®‰å…¨ã€å®¢æˆ·ä½“éªŒä¸å“ç‰Œä¿¡èª‰</strong>ã€‚</p>
<p>ç„¶è€Œåœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œçº¸æ¿ç ´æŸæ£€æµ‹é•¿æœŸé¢ä¸´å‡ ä¸ªç°å®é—®é¢˜ï¼š</p>
<ul>
<li>ğŸ‘€ <strong>é«˜åº¦ä¾èµ–äººå·¥ç›®æ£€</strong>ï¼Œæ•ˆç‡ä½ã€ä¸»è§‚æ€§å¼º</li>
<li>ğŸ“¦ <strong>äº§çº¿é€Ÿåº¦å¿«</strong>ï¼Œäººå·¥éš¾ä»¥åŠæ—¶å“åº”</li>
<li>ğŸ“‰ <strong>ç¼ºé™·å½¢æ€å¤šæ ·</strong>ï¼Œå¦‚è£‚çº¹ã€å­”æ´ã€å‹ç—•ã€ç ´è¾¹</li>
<li>ğŸ§  <strong>ç»éªŒéš¾ä»¥å¤åˆ¶</strong>ï¼Œæ–°å‘˜å·¥å­¦ä¹ æˆæœ¬é«˜</li>
</ul>
<p>åœ¨â€œé™æœ¬å¢æ•ˆâ€å’Œâ€œæ™ºèƒ½åˆ¶é€ â€çš„åŒé‡é©±åŠ¨ä¸‹ï¼Œ<strong>ç”¨è§†è§‰ç®—æ³•æ›¿ä»£äººå·¥è´¨æ£€</strong>å·²æˆä¸ºè¶‹åŠ¿ï¼Œè€Œç›®æ ‡æ£€æµ‹æŠ€æœ¯æ­£æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„æ ¸å¿ƒæ‰‹æ®µã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/257bc188ca2b45519b8078cc65871113~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=DUQXrq9APV%2B6Fz%2FcnBKTV2%2BAvpg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-3">æºç ä¸‹è½½ä¸æ•ˆæœæ¼”ç¤º</h3>
<p>å“”å“©å“”å“©è§†é¢‘ä¸‹æ–¹è§‚çœ‹ï¼š
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1k3b9z1E6E%2F" target="_blank" title="https://www.bilibili.com/video/BV1k3b9z1E6E/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1k3â€¦</a>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b677ec92d114de699867177c3e903fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=Ywxo%2FXF%2FwPkqrn%2BD4ySsAW4CIBo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
åŒ…å«ï¼š</p>
<p>ğŸ“¦å®Œæ•´é¡¹ç›®æºç </p>
<p>ğŸ“¦ é¢„è®­ç»ƒæ¨¡å‹æƒé‡</p>
<p>ğŸ—‚ï¸ æ•°æ®é›†åœ°å€ï¼ˆå«æ ‡æ³¨è„šæœ¬</p>
<h3 data-id="heading-4">äºŒã€æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆçº¸æ¿ç¼ºé™·æ£€æµ‹é€‚åˆç”¨ YOLOv8ï¼Ÿ</h3>
<h4 data-id="heading-5">2.1 çº¸æ¿ç ´æŸçš„è§†è§‰ç‰¹æ€§åˆ†æ</h4>
<p>ä»è®¡ç®—æœºè§†è§‰è§’åº¦çœ‹ï¼Œçº¸æ¿ç ´æŸå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç¼ºé™·å°ºå¯¸ä¸ä¸€ï¼Œå°è£‚çº¹ä¸å¤§å­”æ´å¹¶å­˜</li>
<li>ç¼ºé™·å½¢æ€ä¸è§„åˆ™ï¼Œéš¾ä»¥ç”¨è§„åˆ™ç®—æ³•æè¿°</li>
<li>èƒŒæ™¯çº¹ç†å¤æ‚ï¼Œå­˜åœ¨çº¸æ¿çº¹è·¯å¹²æ‰°</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼Œä¼ ç»ŸåŸºäºé˜ˆå€¼ã€è¾¹ç¼˜æˆ–æ¨¡æ¿çš„æ–¹æ³•å¾ˆéš¾ç¨³å®šå·¥ä½œã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d7c41bef9844a0fbac59bfd3c03001e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=mwj2sBJsfdxTK2GMbFLePi1EkgY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-6">2.2 YOLOv8 çš„å·¥ç¨‹ä¼˜åŠ¿</h4>
<p>YOLOv8 ä½œä¸ºæ–°ä¸€ä»£ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œåœ¨è¯¥åœºæ™¯ä¸­å…·å¤‡æ˜¾è‘—ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>Anchor-Free æ¶æ„</strong>ï¼šå¯¹å°ºåº¦å˜åŒ–ä¸ä¸è§„åˆ™ç›®æ ‡æ›´å‹å¥½</li>
<li><strong>å•é˜¶æ®µæ£€æµ‹</strong>ï¼šæ»¡è¶³äº§çº¿å®æ—¶æ£€æµ‹éœ€æ±‚</li>
<li><strong>ç»“æ„è½»é‡</strong>ï¼šé€‚åˆéƒ¨ç½²åœ¨å·¥æ§æœºæˆ–è¾¹ç¼˜è®¾å¤‡</li>
<li><strong>ç”Ÿæ€æˆç†Ÿ</strong>ï¼šè®­ç»ƒã€æ¨ç†ã€å¯¼å‡ºæµç¨‹æ¸…æ™°</li>
</ul>
<p>å› æ­¤ï¼Œæœ¬é¡¹ç›®é€‰æ‹© YOLOv8 ä½œä¸ºæ ¸å¿ƒæ£€æµ‹å¼•æ“ï¼Œç”¨äºæ„å»ºä¸€å¥—<strong>å¯ç›´æ¥è½åœ°çš„å·¥ä¸šè´¨æ£€ç³»ç»Ÿ</strong>ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a97ac0303a2545a580bc14e8840856fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=yqV3KtC9bd0En6xbBpQWw8y3sYQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39ccc3bdaade4f83b22a2516660d53a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=LJrBAcmbcEtxNubLzD%2FXBCrBHS8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-7">ä¸‰ã€ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡</h3>
<p>æœ¬é¡¹ç›®å¹¶éåœç•™åœ¨â€œæ¨¡å‹èƒ½è·‘â€ï¼Œè€Œæ˜¯ä»ä¸€å¼€å§‹å°±æŒ‰ç…§<strong>å®Œæ•´å·¥ç¨‹ç³»ç»Ÿ</strong>æ¥è®¾è®¡ï¼Œæ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">æ•°æ®é‡‡é›†ä¸æ ‡æ³¨
<span class="hljs-code">        â†“
YOLOv8 ç¼ºé™·æ£€æµ‹æ¨¡å‹è®­ç»ƒ
        â†“
ç»Ÿä¸€æ¨ç†æ¥å£å°è£…
        â†“
PyQt5 å¯è§†åŒ–è´¨æ£€ç•Œé¢
        â†“
ä¸€é”®è¿è¡Œä¸ç»“æœä¿å­˜
</span></code></pre>
<p>ç›®æ ‡éå¸¸æ˜ç¡®ï¼š</p>
<blockquote>
<p><strong>è®©ç®—æ³•çœŸæ­£æœåŠ¡äºäº§çº¿ï¼Œè€Œä¸æ˜¯åœç•™åœ¨å®éªŒå®¤ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-8">å››ã€ç¼ºé™·æ•°æ®é›†æ„å»ºä¸æ ‡æ³¨ç»éªŒ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1106fb29f634e25b05d0998f67a3438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=u329BGaQuks8cu7vizNt1aIE69Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-9">4.1 ç¼ºé™·ç±»å‹å®šä¹‰</h4>
<p>åœ¨çº¸æ¿è´¨æ£€åœºæ™¯ä¸­ï¼Œå¸¸è§ç¼ºé™·å¯å½’çº³ä¸ºï¼š</p>
<ul>
<li>æ’•è£‚è£‚çº¹</li>
<li>ç©¿å­”ç ´æŸ</li>
<li>æ˜æ˜¾å‹ç—•</li>
<li>è¾¹ç¼˜ç ´æŸ</li>
<li>è¡¨é¢ç»“æ„å¼‚å¸¸</li>
</ul>
<p>åœ¨æ•°æ®é›†æ„å»ºé˜¶æ®µï¼Œå°†ä¸åŒç¼ºé™·ç»Ÿä¸€å»ºæ¨¡ä¸ºæ£€æµ‹ç›®æ ‡ï¼Œä¾¿äºæ¨¡å‹å­¦ä¹ ç©ºé—´ä½ç½®ä¸å¤–è§‚ç‰¹å¾ã€‚</p>
<hr/>
<h4 data-id="heading-10">4.2 æ•°æ®é›†ç»“æ„è®¾è®¡</h4>
<p>é‡‡ç”¨ YOLO æ ‡å‡†æ ¼å¼ç»„ç»‡æ•°æ®ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dataset/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ train/
â”‚   â””â”€â”€ <span class="hljs-keyword">val</span>/
â”œâ”€â”€ labels/
â”‚   â”œâ”€â”€ train/
â”‚   â””â”€â”€ <span class="hljs-keyword">val</span>/
</code></pre>
<p>æ¯å¼ å›¾ç‰‡å¯¹åº”ä¸€ä¸ªæ–‡æœ¬æ ‡æ³¨æ–‡ä»¶ï¼Œè®°å½•ç¼ºé™·ç›®æ ‡çš„ä½ç½®ä¸ç±»åˆ«ã€‚
è¿™ç§ç»“æ„ä¾¿äºå¿«é€Ÿå¤è®­ã€æ‰©å±•ç±»åˆ«æˆ–è¿ç§»åˆ°å…¶ä»–å·¥ä¸šç¼ºé™·åœºæ™¯ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32969b673ee94ebcb7a2bae48db50faf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=htt7MMlZRyFd42ESEer1rtpgI%2FE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-11">äº”ã€æ¨¡å‹è®­ç»ƒä¸è°ƒä¼˜è¦ç‚¹</h3>
<h4 data-id="heading-12">5.1 è®­ç»ƒå‘½ä»¤ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash">yolo detect train \
  data=defect.yaml \
  model=yolov8n.pt \
  epochs=100 \
  batch=16 \
  imgsz=640
</code></pre>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li><strong>å°ç¼ºé™·å¬å›ç‡</strong>ï¼ˆé¿å…æ¼æ£€ï¼‰</li>
<li>è¿‡æ‹Ÿåˆé£é™©ï¼ˆç¼ºé™·å¤–è§‚ç›¸ä¼¼ï¼‰</li>
<li>æ•°æ®å¢å¼ºæ˜¯å¦ç ´åç¼ºé™·ç‰¹å¾</li>
</ul>
<hr/>
<h4 data-id="heading-13">5.2 è®­ç»ƒç»“æœè¯„ä¼°</h4>
<p>YOLOv8 ä¼šè‡ªåŠ¨è¾“å‡ºï¼š</p>
<ul>
<li>mAP æ›²çº¿ï¼ˆæ•´ä½“æ£€æµ‹æ€§èƒ½ï¼‰</li>
<li>box / cls / dfl æŸå¤±å˜åŒ–</li>
<li>æ··æ·†çŸ©é˜µï¼ˆç±»åˆ«åŒºåˆ†èƒ½åŠ›ï¼‰</li>
</ul>
<p>åœ¨å®é™…å·¥ä¸šåº”ç”¨ä¸­ï¼Œå½“ <strong>mAP@0.5 è¾¾åˆ° 90% å·¦å³</strong>ï¼Œå³å¯æ»¡è¶³å¤§éƒ¨åˆ†äº§çº¿è´¨æ£€éœ€æ±‚ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/972b28455afc431f9b22a411d5594781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=Y0Z6Fm69CC0lVv6WeFZFszhfC2M%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-14">å…­ã€ç»Ÿä¸€æ¨ç†é€»è¾‘ï¼šé€‚é…å¤šç§è¾“å…¥æº</h3>
<p>ä¸ºäº†è´´è¿‘çœŸå®ä½¿ç”¨åœºæ™¯ï¼Œç³»ç»Ÿæ”¯æŒå¤šç§æ£€æµ‹æ–¹å¼ï¼š</p>
<h4 data-id="heading-15">6.1 é™æ€å›¾ç‰‡æ£€æµ‹</h4>
<ul>
<li>é€‚ç”¨äºç¦»çº¿è´¨æ£€</li>
<li>æ•°æ®å›æº¯åˆ†æ</li>
<li>æ¨¡å‹æ•ˆæœéªŒè¯</li>
</ul>
<hr/>
<h4 data-id="heading-16">6.2 è§†é¢‘æ£€æµ‹</h4>
<ul>
<li>ç”¨äºäº§çº¿å½•åƒåˆ†æ</li>
<li>æ”¯æŒé€å¸§æ£€æµ‹ä¸ç»“æœä¿å­˜</li>
<li>å¯ä½œä¸ºè´¨æ£€å¤ç›˜å·¥å…·</li>
</ul>
<hr/>
<h4 data-id="heading-17">6.3 å®æ—¶æ‘„åƒå¤´æ£€æµ‹</h4>
<p>è¿™æ˜¯å·¥ä¸šè½åœ°çš„æ ¸å¿ƒåœºæ™¯ï¼š</p>
<ul>
<li>å®æ—¶æ˜¾ç¤ºç¼ºé™·ä½ç½®</li>
<li>å¯å¯¹æ¥æŠ¥è­¦ç³»ç»Ÿ</li>
<li>ä¸ºåç»­è‡ªåŠ¨å‰”é™¤æä¾›ä¾æ®</li>
</ul>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c484371cd93e4bbcabfc7dd09a7be5ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831213&amp;x-signature=cJoBjAHcFSnUvXtm%2Ba9TFk4OlCw%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-18">ä¸ƒã€PyQt5 å›¾å½¢ç•Œé¢ï¼šè®©è´¨æ£€äººå‘˜â€œç”¨å¾—èµ·æ¥â€</h3>
<p>å¾ˆå¤šç®—æ³•é¡¹ç›®çš„ç—›ç‚¹åœ¨äºï¼š
<strong>åªæœ‰ç®—æ³•å·¥ç¨‹å¸ˆä¼šç”¨ï¼Œç°åœºäººå‘˜ç”¨ä¸äº†ã€‚</strong></p>
<p>æœ¬é¡¹ç›®é€šè¿‡ PyQt5 æ„å»ºå®Œæ•´ GUIï¼Œæœ‰æ•ˆè§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<h4 data-id="heading-19">7.1 ç•Œé¢åŠŸèƒ½è®¾è®¡</h4>
<ul>
<li>è¾“å…¥æ–¹å¼é€‰æ‹©ï¼ˆå›¾ç‰‡ / è§†é¢‘ / æ‘„åƒå¤´ï¼‰</li>
<li>æ£€æµ‹ç»“æœå®æ—¶æ˜¾ç¤º</li>
<li>ç¼ºé™·ç±»åˆ«ä¸ç½®ä¿¡åº¦å¯è§†åŒ–</li>
<li>ä¸€é”®ä¿å­˜æ£€æµ‹ç»“æœ</li>
</ul>
<hr/>
<h4 data-id="heading-20">7.2 å·¥ç¨‹ä»·å€¼</h4>
<ul>
<li>æ— éœ€å‘½ä»¤è¡Œæ“ä½œ</li>
<li>é™ä½éƒ¨ç½²ä¸åŸ¹è®­æˆæœ¬</li>
<li>å¯ç›´æ¥ä½œä¸ºäº§çº¿è´¨æ£€ç»ˆç«¯åŸå‹</li>
</ul>
<hr/>
<h3 data-id="heading-21">å…«ã€æ ¸å¿ƒæ¨ç†ä»£ç é€»è¾‘è¯´æ˜</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> ultralytics <span class="hljs-keyword">import</span> YOLO

model = YOLO(<span class="hljs-string">"best.pt"</span>)
results = model(frame, conf=<span class="hljs-number">0.25</span>)

<span class="hljs-keyword">for</span> box <span class="hljs-keyword">in</span> results[<span class="hljs-number">0</span>].boxes:
    cls_id = <span class="hljs-built_in">int</span>(box.cls)
    score = <span class="hljs-built_in">float</span>(box.conf)
</code></pre>
<p>æ¨ç†ç»“æœä¸­å³å¯è·å–ï¼š</p>
<ul>
<li>ç¼ºé™·ä½ç½®åæ ‡</li>
<li>ç¼ºé™·ç±»åˆ«</li>
<li>ç½®ä¿¡åº¦è¯„åˆ†</li>
</ul>
<p>ä¸ºåç»­ <strong>æŠ¥è­¦ã€ç»Ÿè®¡ã€å‰”é™¤</strong> ç­‰ä¸šåŠ¡é€»è¾‘æä¾›åŸºç¡€æ•°æ®ã€‚</p>
<hr/>
<h3 data-id="heading-22">ä¹ã€é¡¹ç›®æ‰“åŒ…ä¸â€œå³ç”¨å‹â€äº¤ä»˜</h3>
<p>é¡¹ç›®å·²å®Œæˆå®Œæ•´å·¥ç¨‹å°è£…ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>è®­ç»ƒå®Œæˆçš„æ¨¡å‹æƒé‡</li>
<li>å…¨éƒ¨ Python æºç </li>
<li>æ•°æ®é›†ä¸æ ‡æ³¨è¯´æ˜</li>
<li>PyQt5 ä¸»ç¨‹åº</li>
</ul>
<h4 data-id="heading-23">è¿è¡Œæ–¹å¼æå…¶ç®€å•ï¼š</h4>
<pre><code class="hljs language-bash" lang="bash">python main.py
</code></pre>
<p>æ— éœ€é‡æ–°è®­ç»ƒï¼Œå³å¯ç›´æ¥ä½“éªŒå®Œæ•´æ£€æµ‹æµç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-24">åã€å¯æ‰©å±•æ–¹å‘ä¸å·¥ä¸šå‡çº§ç©ºé—´</h3>
<p>åœ¨ç°æœ‰æ¡†æ¶åŸºç¡€ä¸Šï¼Œå¯è½»æ¾æ‹“å±•ä¸ºï¼š</p>
<ul>
<li>å¤šç¼ºé™·ç±»åˆ«ç²¾ç»†åŒ–æ£€æµ‹</li>
<li>æ¥å…¥ PLC / MES ç³»ç»Ÿ</li>
<li>ä¸è‡ªåŠ¨åˆ†æ‹£æœºæ„è”åŠ¨</li>
<li>éƒ¨ç½²è‡³è¾¹ç¼˜ AI è®¾å¤‡</li>
</ul>
<p>ä»â€œè¾…åŠ©æ£€æµ‹â€é€æ­¥å‡çº§ä¸ºâ€œå…¨è‡ªåŠ¨æ™ºèƒ½è´¨æ£€â€ã€‚</p>
<hr/>
<h3 data-id="heading-25">æ€»ç»“ï¼šè®© AI çœŸæ­£èµ°è¿›åŒ…è£…äº§çº¿</h3>
<p>æœ¬æ–‡å›´ç»•åŒ…è£…ç®±çº¸æ¿ç ´æŸè¿™ä¸€å…¸å‹å·¥ä¸šç—›ç‚¹ï¼Œç³»ç»Ÿæ€§ä»‹ç»äº†ä¸€å¥— <strong>åŸºäº YOLOv8 çš„æ™ºèƒ½ç¼ºé™·æ£€æµ‹è§£å†³æ–¹æ¡ˆ</strong>ã€‚é¡¹ç›®ä¸ä»…éªŒè¯äº†æ·±åº¦å­¦ä¹ åœ¨å·¥ä¸šè´¨æ£€åœºæ™¯ä¸­çš„å¯è¡Œæ€§ï¼Œæ›´é€šè¿‡ PyQt5 å›¾å½¢ç•Œé¢å’Œå®Œæ•´å·¥ç¨‹å°è£…ï¼Œæ‰“é€šäº†ä»æ¨¡å‹è®­ç»ƒåˆ°å®é™…ä½¿ç”¨çš„æœ€åä¸€å…¬é‡Œã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ª<strong>å¯å­¦ä¹ ã€å¯å¤ç”¨ã€å¯è½åœ°çš„å·¥ä¸šè§†è§‰é¡¹ç›®æ¡ˆä¾‹</strong>ï¼Œé‚£ä¹ˆè¿™å¥—åŒ…è£…ç®±çº¸æ¿ç ´æŸæ£€æµ‹ç³»ç»Ÿï¼Œå…·å¤‡éå¸¸é«˜çš„å®è·µä»·å€¼ä¸æ‰©å±•ç©ºé—´ã€‚</p>
<p>é€šè¿‡å¼•å…¥ YOLOv8 ç›®æ ‡æ£€æµ‹æ¨¡å‹å¹¶ç»“åˆå·¥ç¨‹åŒ–ç³»ç»Ÿè®¾è®¡ï¼Œæœ¬æ–‡å±•ç¤ºäº†ä¸€å¥—é¢å‘çœŸå®å·¥ä¸šäº§çº¿çš„çº¸æ¿åŒ…è£…ç®±ç ´æŸç¼ºé™·æ™ºèƒ½æ£€æµ‹æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆä»æ•°æ®é›†æ„å»ºã€æ¨¡å‹è®­ç»ƒä¸è°ƒä¼˜å‡ºå‘ï¼Œè¿›ä¸€æ­¥å»¶ä¼¸è‡³ç»Ÿä¸€æ¨ç†æ¥å£ä¸ PyQt5 å¯è§†åŒ–ç•Œé¢ï¼Œå®ç°äº†ä»ç®—æ³•éªŒè¯åˆ°å®é™…åº”ç”¨è½åœ°çš„å®Œæ•´é—­ç¯ã€‚å®è·µè¡¨æ˜ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„è§†è§‰æ£€æµ‹æŠ€æœ¯ä¸ä»…èƒ½å¤Ÿæ˜¾è‘—æå‡è´¨æ£€æ•ˆç‡ä¸ä¸€è‡´æ€§ï¼Œè¿˜ä¸ºåç»­çš„è‡ªåŠ¨å‰”é™¤ã€è´¨é‡è¿½æº¯ä¸äº§çº¿æ™ºèƒ½åŒ–å‡çº§å¥ å®šäº†åšå®åŸºç¡€ï¼Œå…·æœ‰è¾ƒé«˜çš„æ¨å¹¿ä¸å¤ç”¨ä»·å€¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™ç«¯äº‘ä¸€ä½“åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šé¢„åŠ è½½]]></title>    <link>https://juejin.cn/post/7598110132614905910</link>    <guid>https://juejin.cn/post/7598110132614905910</guid>    <pubDate>2026-01-23T07:10:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598110132614905910" data-draft-id="7598110132614873142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™ç«¯äº‘ä¸€ä½“åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šé¢„åŠ è½½"/> <meta itemprop="keywords" content="å‰ç«¯,HarmonyOS,ArkTS"/> <meta itemprop="datePublished" content="2026-01-23T07:10:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çº¯çˆ±æŒé—¨äºº"/> <meta itemprop="url" content="https://juejin.cn/user/2849548342403454"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™ç«¯äº‘ä¸€ä½“åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šé¢„åŠ è½½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2849548342403454/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çº¯çˆ±æŒé—¨äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T07:10:16.000Z" title="Fri Jan 23 2026 07:10:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¬¢è¿æ¥åˆ°é¸¿è’™ç«¯äº‘ä¸€ä½“åŒ–å¼€å‘æ•™ç¨‹çš„æœ€åä¸€ç¯‡ã€‚å‰ä¸‰ç¯‡æˆ‘ä»¬åˆ†åˆ«å­¦ä¹ äº†äº‘å‡½æ•°ã€äº‘æ•°æ®åº“å’Œäº‘å­˜å‚¨ï¼Œä»Šå¤©å’±ä»¬æ¥èŠèŠå¦‚ä½•è®©åº”ç”¨"å¿«äººä¸€æ­¥"â€”â€”<strong>é¢„åŠ è½½æœåŠ¡</strong>ã€‚</p>
<p>åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œé¦–å±åŠ è½½é€Ÿåº¦ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒã€‚å¦‚æœæ¯æ¬¡æ‰“å¼€åº”ç”¨éƒ½éœ€è¦ç°å»æœåŠ¡å™¨æ‹‰å–æ•°æ®ï¼Œç½‘ç»œä¸å¥½çš„æ—¶å€™ç”¨æˆ·å°±å¾—ç›¯ç€ç™½å±è½¬åœˆåœˆã€‚Cloud Foundation Kitçš„é¢„åŠ è½½æœåŠ¡å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒå¯ä»¥åœ¨åº”ç”¨å®‰è£…æ—¶æˆ–è€…åå°å‘¨æœŸæ€§åœ°æå‰æ‹‰å–æ•°æ®å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œè¿™æ ·ç”¨æˆ·æ‰“å¼€åº”ç”¨æ—¶å°±èƒ½"ç§’å¼€"ã€‚</p>
<h3 data-id="heading-0">é¢„åŠ è½½åŸç†</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/976573e27d93462c9fba97b24f076c33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=FOyM9%2BJXnESY1O%2BjLXzkbATwNgE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€é¢„åŠ è½½çš„ä¸¤ç§æ¨¡å¼</h2>
<p>é¢„åŠ è½½æœåŠ¡æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š</p>
<ol>
<li>
<p><strong>å®‰è£…é¢„åŠ è½½</strong>ï¼šåº”ç”¨å®‰è£…åé¦–æ¬¡æ‰“å¼€æ—¶ä½¿ç”¨ã€‚ç³»ç»Ÿä¼šåœ¨å®‰è£…æœŸé—´å°±å»äº‘ç«¯æ‹‰å–æ•°æ®ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å¼€APPæ—¶ï¼Œæ•°æ®å·²ç»åœ¨æœ¬åœ°å‡†å¤‡å¥½äº†ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eab82823e328498680e22b80ca1f7d8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=nOe8TghS9st1aqoqSjlmI2KkZI4%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
<li>
<p><strong>å‘¨æœŸæ€§é¢„åŠ è½½</strong>ï¼šé€‚ç”¨äºæ—¥å¸¸ä½¿ç”¨ã€‚ç³»ç»Ÿæ¯éš”12å°æ—¶ä¼šåœ¨åå°è‡ªåŠ¨æ‹‰å–ä¸€æ¬¡æ•°æ®ï¼Œä¿è¯ç”¨æˆ·æ¯æ¬¡æ‰“å¼€çœ‹åˆ°çš„éƒ½æ˜¯è¾ƒæ–°çš„å†…å®¹ï¼Œæ¯”å¦‚èŠ‚æ—¥ä¸»é¢˜ã€æ¯æ—¥æ¨èç­‰ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e2112d34b2d4a3784df053d7d01b64e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=XPvfAmEmr76F3pNLLth8qmCpxtQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-2">äºŒã€å¼€å‘æµç¨‹æ¦‚è§ˆ</h2>
<p>è¦å®ç°é¢„åŠ è½½ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ä¸‰æ­¥èµ°ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80f66f5e2f864ef4ac468de33bd45777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=6sHTe71gufPN5NuX8W0q%2B03YRCU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol>
<li><strong>äº‘ä¾§é…ç½®</strong>ï¼šåœ¨AGCæ§åˆ¶å°é…ç½®æ•°æ®æ¥æºï¼ˆäº‘å‡½æ•°æˆ–å¼€å‘è€…æœåŠ¡å™¨ï¼‰ã€‚</li>
<li><strong>äº‘ä¾§å¼€å‘</strong>ï¼šå¼€å‘äº‘å‡½æ•°æˆ–æ¥å£ï¼Œè¿”å›éœ€è¦é¢„åŠ è½½çš„æ•°æ®ã€‚</li>
<li><strong>ç«¯ä¾§å¼€å‘</strong>ï¼šåœ¨åº”ç”¨ä»£ç ä¸­è°ƒç”¨é¢„åŠ è½½æ¥å£ï¼Œè·å–å¹¶ä½¿ç”¨æ•°æ®ã€‚</li>
</ol>
<h2 data-id="heading-3">ä¸‰ã€äº‘ä¾§é…ç½®ä¸å¼€å‘</h2>
<p>æˆ‘ä»¬ä»¥<strong>äº‘å‡½æ•°</strong>ä½œä¸ºæ•°æ®æ¥æºä¸ºä¾‹ã€‚</p>
<h3 data-id="heading-4">3.1 å¼€å‘äº‘å‡½æ•°</h3>
<p>æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªäº‘å‡½æ•°ï¼Œè¿”å›åº”ç”¨éœ€è¦çš„é¢„åŠ è½½æ•°æ®ã€‚</p>
<p>åœ¨<code>cloudfunctions</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼ˆä¾‹å¦‚<code>prefetch-data</code>ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// cloudfunctions/prefetch-data/index.js</span>
<span class="hljs-keyword">let</span> myHandler = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">event, context, callback, logger</span>) {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"é¢„åŠ è½½å‡½æ•°è¢«è§¦å‘"</span>);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ¨¡æ‹Ÿè¿”å›ä¸€äº›é¦–é¡µé…ç½®æ•°æ®</span>
    <span class="hljs-keyword">let</span> result = {
      <span class="hljs-string">"bannerUrl"</span>: <span class="hljs-string">"https://example.com/banner.jpg"</span>,
      <span class="hljs-string">"welcomeMsg"</span>: <span class="hljs-string">"æ¬¢è¿å›æ¥ï¼Œè¿™é‡Œæ˜¯ä»Šæ—¥æ¨èï¼"</span>,
      <span class="hljs-string">"themeColor"</span>: <span class="hljs-string">"#FF5722"</span>,
      <span class="hljs-string">"timestamp"</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    };
    
    <span class="hljs-comment">// å®é™…ä¸šåŠ¡ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®event.body.appIdç­‰å‚æ•°å»æŸ¥è¯¢æ•°æ®åº“</span>
    
    <span class="hljs-title function_">callback</span>(result);
  } <span class="hljs-keyword">catch</span> (error) {
    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error: "</span> + error);
    <span class="hljs-title function_">callback</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> });
  }
};

<span class="hljs-keyword">export</span> { myHandler };
</code></pre>
<h3 data-id="heading-5">3.2 åœ¨AGCé…ç½®é¢„åŠ è½½</h3>
<ol>
<li>
<p>ç™»å½•AppGallery Connectï¼Œè¿›å…¥"äº‘å¼€å‘ &gt; é¢„åŠ è½½"é¡µé¢ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8a644c2574142c69ff2148583ba3eb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=LJMoyzpZCIbHiCJrw5uFnhpnqnE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
<li>
<p>åœ¨"å®‰è£…é¢„åŠ è½½"åŒºåŸŸï¼Œæ•°æ®æ¥æºé€‰æ‹©"äº‘å‡½æ•°"ï¼Œé€‰æ‹©åˆšæ‰åˆ›å»ºçš„<code>prefetch-data</code>å‡½æ•°ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c65af4a7900b4292a8f5d9436d736c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=xPOvmVBUb%2F2VmVozlk%2FXE142LKM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
<li>
<p>åœ¨"å‘¨æœŸæ€§é¢„åŠ è½½"åŒºåŸŸï¼ŒåŒæ ·é€‰æ‹©è¿™ä¸ªäº‘å‡½æ•°ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©ä¸åŒçš„ï¼‰ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f5ea74016c24e368f39b3514e66bf41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=shRqL25TVrG6E48OIXJv1REGx1A%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
<li>
<p>ç‚¹å‡»ä¿å­˜ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6ef780f977d4576ae7db9ba283afc60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qv54ix5o6M6Zeo5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769757016&amp;x-signature=CMU%2BBN14BbjZkmUbtta0uJZ9hvQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-6">å››ã€ç«¯ä¾§å¼€å‘</h2>
<p>ç«¯ä¾§å¼€å‘ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°è£…ä¸€äº›å·¥å…·ç±»æ¥å¤„ç†ç¼“å­˜å’Œä»»åŠ¡æ³¨å†Œã€‚</p>
<h3 data-id="heading-7">4.1 æ·»åŠ å·¥å…·ç±»</h3>
<p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ å‡ ä¸ªå·¥å…·ç±»ã€‚</p>
<p><strong>1. GlobalContext (å…¨å±€ä¸Šä¸‹æ–‡)</strong>
ä½ç½®ï¼š<code>entry/src/main/ets/common/GlobalContext.ets</code>
ï¼ˆå¦‚æœä¹‹å‰æ•™ç¨‹ä¸­å·²ç»åˆ›å»ºè¿‡ï¼Œå¯ä»¥å¤ç”¨ï¼‰</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalContext</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>;

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">initContext</span>(<span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">context</span> = context;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getContext</span>(): common.<span class="hljs-property">UIAbilityContext</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">context</span>;
  }
}
</code></pre>
<p><strong>2. PreferenceUtil (é¦–é€‰é¡¹å·¥å…·)</strong>
ä½ç½®ï¼š<code>entry/src/main/ets/common/PreferenceUtil.ets</code>
ç”¨äºå­˜å‚¨é¢„åŠ è½½ä»»åŠ¡çš„çŠ¶æ€å’Œæ³¨å†Œæ—¶é—´ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> dataPreferences <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.preferences'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Context</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'PreferenceUtil'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">DEFAULT_STORE_NAME</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"prefetchDefaultStore"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreferenceUtil</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">cachedPreferences</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, dataPreferences.<span class="hljs-property">Preferences</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-comment">// ... (å®Œæ•´ä»£ç è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–å‰é¢çš„è¾“å…¥å†…å®¹ï¼Œæ­¤å¤„çœç•¥éƒ¨åˆ†å®ç°ç»†èŠ‚ä»¥ä¿æŒç®€æ´)</span>
  
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getValueSync</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">storeName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): dataPreferences.<span class="hljs-property">ValueType</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> store = <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">getStoreSync</span>(context, storeName);
      <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">updateStoreCache</span>(storeName, store);
      <span class="hljs-keyword">return</span> store.<span class="hljs-title function_">getSync</span>(key, <span class="hljs-string">''</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">storeName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: dataPreferences.<span class="hljs-property">ValueType</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {      
      <span class="hljs-keyword">let</span> store = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">getStore</span>(context, storeName);
      <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">updateStoreCache</span>(storeName, store);
      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">put</span>(key, value);
      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">flush</span>();
    } <span class="hljs-keyword">catch</span> (err) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setValue error: <span class="hljs-subst">${err.message}</span>`</span>);
    }
  }

  <span class="hljs-comment">// ... getStore, getStoreSync, updateStoreCache æ–¹æ³•å®ç°</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getStore</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">storeName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;dataPreferences.<span class="hljs-property">Preferences</span>&gt; {
    <span class="hljs-keyword">let</span> actualStoreName = !storeName ? <span class="hljs-variable constant_">DEFAULT_STORE_NAME</span> : storeName;
    <span class="hljs-keyword">let</span> store = <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-property">cachedPreferences</span>.<span class="hljs-title function_">get</span>(actualStoreName);
    <span class="hljs-keyword">if</span> (store) { <span class="hljs-keyword">return</span> store; }
    <span class="hljs-keyword">return</span> dataPreferences.<span class="hljs-title function_">getPreferences</span>(context, actualStoreName);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getStoreSync</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">storeName</span>: <span class="hljs-built_in">string</span>): dataPreferences.<span class="hljs-property">Preferences</span> {
    <span class="hljs-keyword">let</span> actualStoreName = !storeName ? <span class="hljs-variable constant_">DEFAULT_STORE_NAME</span> : storeName;
    <span class="hljs-keyword">let</span> store = <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-property">cachedPreferences</span>.<span class="hljs-title function_">get</span>(actualStoreName);
    <span class="hljs-keyword">if</span> (store) { <span class="hljs-keyword">return</span> store; }
    <span class="hljs-keyword">return</span> dataPreferences.<span class="hljs-title function_">getPreferencesSync</span>(context, { <span class="hljs-attr">name</span>: actualStoreName });
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">updateStoreCache</span>(<span class="hljs-attr">storeName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">store</span>: dataPreferences.<span class="hljs-property">Preferences</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-property">cachedPreferences</span>.<span class="hljs-title function_">has</span>(storeName)) {
      <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-property">cachedPreferences</span>.<span class="hljs-title function_">set</span>(storeName, store);
    }
  }
}
</code></pre>
<p><strong>3. PrefetchUtil (é¢„åŠ è½½å·¥å…·)</strong>
ä½ç½®ï¼š<code>entry/src/main/ets/prefetchUtil/PrefetchUtil.ets</code>
è´Ÿè´£è°ƒç”¨ç³»ç»ŸAPIï¼Œç®¡ç†ä»»åŠ¡æ³¨å†Œé€»è¾‘ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { cloudResPrefetch } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PreferenceUtil</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/PreferenceUtil'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GlobalContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/GlobalContext'</span>;

<span class="hljs-comment">// ... å¸¸é‡å®šä¹‰ (PREFERENCES_PREFETCH_STORE_NAME, etc.)</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefetchUtil</span> {
  <span class="hljs-comment">// ... é™æ€å˜é‡å®šä¹‰</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPrefetchResult</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>: cloudResPrefetch.PrefetchMode</span>) {
    <span class="hljs-keyword">return</span> cloudResPrefetch.<span class="hljs-title function_">getPrefetchResult</span>(<span class="hljs-keyword">type</span>);
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">registerPrefetchTask</span>(<span class="hljs-params">token: <span class="hljs-built_in">string</span>, params: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">object</span>, forceRegister: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-comment">// ... æ³¨å†Œä»»åŠ¡é€»è¾‘ï¼Œåˆ¤æ–­æ—¶é—´é—´éš”æ˜¯å¦è¶…è¿‡24å°æ—¶</span>
    <span class="hljs-comment">// å®Œæ•´é€»è¾‘è¯·å‚è€ƒæ–‡æ¡£ï¼Œæ ¸å¿ƒæ˜¯è°ƒç”¨ cloudResPrefetch.registerPrefetchTask</span>
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">hasPrefetchTaskData</span>() : <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">PrefetchUtil</span>.<span class="hljs-property">hasPrefetchedData</span>;
  }
  
  <span class="hljs-comment">// ... updatePrefetchTaskInfo, registerPrefetchTaskForced ç­‰è¾…åŠ©æ–¹æ³•</span>
}
</code></pre>
<p><strong>4. PrefetchWrapper (é¢„åŠ è½½å°è£…ç±»)</strong>
ä½ç½®ï¼š<code>entry/src/main/ets/prefetchUtil/PrefetchWrapper.ets</code>
è¿™æ˜¯ä¸šåŠ¡å±‚ç›´æ¥è°ƒç”¨çš„ç±»ï¼Œå°è£…äº†"å®‰è£…é¢„åŠ è½½"å’Œ"å‘¨æœŸæ€§é¢„åŠ è½½"çš„ç­–ç•¥åˆ‡æ¢ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
<span class="hljs-keyword">import</span> { cloudFunction, cloudResPrefetch } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrefetchUtil</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./PrefetchUtil'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PreferenceUtil</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/PreferenceUtil'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GlobalContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/GlobalContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'PrefetchWrapper'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PREFETCH_MODE</span> = <span class="hljs-string">"prefetchMode"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PREFERENCES_PREFETCH_STORE_NAME</span> = <span class="hljs-string">'defaultStore'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefetchWrapper</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">PrefetchWrapper</span>;
  
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">PrefetchWrapper</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PrefetchWrapper</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">PrefetchWrapper</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrefetchWrapper</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">PrefetchWrapper</span>.<span class="hljs-property">instance</span>;
  }

  <span class="hljs-comment">// æ ¸å¿ƒå…¥å£æ–¹æ³•</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">doPrefetch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> context = <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-title function_">getContext</span>();
    <span class="hljs-keyword">let</span> prefetchMode = <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">getValueSync</span>(context, <span class="hljs-variable constant_">PREFERENCES_PREFETCH_STORE_NAME</span>, <span class="hljs-variable constant_">PREFETCH_MODE</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;
    
    <span class="hljs-keyword">if</span> (!prefetchMode) {
      <span class="hljs-comment">// æ¨¡å¼ä¸å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é¦–æ¬¡æ‰“å¼€ï¼Œæ‰§è¡Œå®‰è£…é¢„åŠ è½½</span>
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'æ‰§è¡Œå®‰è£…é¢„åŠ è½½'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">installPrefetch</span>();
      <span class="hljs-comment">// æ ‡è®°ä¸‹æ¬¡ä½¿ç”¨å‘¨æœŸæ€§é¢„åŠ è½½</span>
      <span class="hljs-title class_">PreferenceUtil</span>.<span class="hljs-title function_">setValue</span>(context, <span class="hljs-variable constant_">PREFERENCES_PREFETCH_STORE_NAME</span>, <span class="hljs-variable constant_">PREFETCH_MODE</span>, cloudResPrefetch.<span class="hljs-property">PrefetchMode</span>.<span class="hljs-property">PERIODIC_PREFETCH</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// éé¦–æ¬¡æ‰“å¼€ï¼Œæ‰§è¡Œå‘¨æœŸæ€§é¢„åŠ è½½</span>
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'æ‰§è¡Œå‘¨æœŸæ€§é¢„åŠ è½½'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">periodicPrefetch</span>();
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">installPrefetch</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">PrefetchUtil</span>.<span class="hljs-title function_">getPrefetchResult</span>(cloudResPrefetch.<span class="hljs-property">PrefetchMode</span>.<span class="hljs-property">INSTALL_PREFETCH</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'è·å–å®‰è£…é¢„åŠ è½½æ•°æ®æˆåŠŸ: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">result</span>));
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å°†æ•°æ®ä¿å­˜åˆ°å…¨å±€å˜é‡æˆ–çŠ¶æ€ç®¡ç†ä¸­ï¼Œä¾›é¡µé¢æ¸²æŸ“ä½¿ç”¨</span>
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`è·å–å¤±è´¥: <span class="hljs-subst">${err.message}</span>, é™çº§ä¸ºäº‘å‡½æ•°è°ƒç”¨`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cloudFunctionCall</span>();
      })
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">periodicPrefetch</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ³¨å†Œä¸‹ä¸€æ¬¡çš„ä»»åŠ¡</span>
    <span class="hljs-title class_">PrefetchUtil</span>.<span class="hljs-title function_">registerPrefetchTask</span>(<span class="hljs-string">''</span>, <span class="hljs-string">''</span>);
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PrefetchUtil</span>.<span class="hljs-title function_">hasPrefetchTaskData</span>()) {
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'æš‚æ— å‘¨æœŸæ€§æ•°æ®ï¼Œé™çº§å¤„ç†'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cloudFunctionCall</span>();
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-title class_">PrefetchUtil</span>.<span class="hljs-title function_">getPrefetchResult</span>(cloudResPrefetch.<span class="hljs-property">PrefetchMode</span>.<span class="hljs-property">PERIODIC_PREFETCH</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'è·å–å‘¨æœŸæ€§é¢„åŠ è½½æ•°æ®æˆåŠŸ: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">result</span>));
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å¤„ç†æ•°æ®</span>
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cloudFunctionCall</span>();
      })
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">cloudFunctionCall</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// é™çº§é€»è¾‘ï¼šç›´æ¥è°ƒç”¨äº‘å‡½æ•°è·å–æ•°æ®</span>
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h3 data-id="heading-8">4.2 åœ¨Abilityä¸­è°ƒç”¨</h3>
<p>æœ€åï¼Œåœ¨<code>EntryAbility.ets</code>çš„<code>onCreate</code>æ–¹æ³•ä¸­è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GlobalContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/GlobalContext'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrefetchWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../prefetchUtil/PrefetchWrapper'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want, launchParam</span>) {
    <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-title function_">initContext</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);
    
    <span class="hljs-comment">// å¯åŠ¨é¢„åŠ è½½æµç¨‹</span>
    <span class="hljs-title class_">PrefetchWrapper</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">doPrefetch</span>();
  }
}
</code></pre>
<h2 data-id="heading-9">äº”ã€è°ƒè¯•æŠ€å·§</h2>
<p>å‘¨æœŸæ€§é¢„åŠ è½½é»˜è®¤æ¯12å°æ—¶æ‰æ‹‰å–ä¸€æ¬¡ï¼Œè°ƒè¯•èµ·æ¥å¾ˆæ…¢ã€‚å¹¸å¥½é¸¿è’™æä¾›äº†å‘½ä»¤è¡Œå·¥å…·<code>prefetch_test_tool</code>æ¥å¼ºåˆ¶è§¦å‘ã€‚</p>
<ol>
<li>è¿æ¥æ‰‹æœºï¼Œæ‰“å¼€DevEco Studioçš„Terminalã€‚</li>
<li>è¾“å…¥ <code>hdc shell</code> è¿›å…¥shellç¯å¢ƒã€‚</li>
<li>è¾“å…¥å‘½ä»¤å¼ºåˆ¶è·å–æ•°æ®ï¼š
<pre><code class="hljs language-bash" lang="bash">cf_prefetch getcache -m &lt;ä½ çš„åº”ç”¨åŒ…å&gt;
</code></pre>
ä¾‹å¦‚ï¼š<code>cf_prefetch getcache -m com.example.myapp</code></li>
</ol>
<p>å¦‚æœæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°"fetch data success"çš„æç¤ºã€‚</p>
<h2 data-id="heading-10">å…­ã€å¸¸è§é—®é¢˜</h2>
<ol>
<li><strong>App IDä¸åœ¨ç™½åå•</strong>ï¼šå¦‚æœåœ¨æ—¥å¿—ä¸­çœ‹åˆ°"appid ... is not in white list"ï¼Œè¯´æ˜äº‘ç«¯æœåŠ¡æ²¡å¼€é€šæˆ–è€…é…ç½®æœªç”Ÿæ•ˆã€‚å°è¯•å°†æ‰‹æœºæ—¶é—´å¾€åè°ƒ1å¤©ï¼Œç„¶åå¸è½½é‡è£…åº”ç”¨ã€‚</li>
<li><strong>Read timed out</strong>ï¼šäº‘å‡½æ•°æ²¡æœ‰å¯åŠ¨å®ä¾‹ã€‚å»AGCæ§åˆ¶å°æ‰‹åŠ¨æµ‹è¯•ä¸€ä¸‹äº‘å‡½æ•°ï¼Œç¡®ä¿å®ƒèƒ½æ­£å¸¸è¿è¡Œã€‚</li>
<li><strong>æ•°æ®æœªæ›´æ–°</strong>ï¼šæ£€æŸ¥å‘½ä»¤è¡Œå·¥å…·è¿”å›çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ—¶é—´æˆ³æ²¡å˜ï¼Œè¯´æ˜æ‹‰å–å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œå’Œäº‘å‡½æ•°æ—¥å¿—ã€‚</li>
</ol>
<h2 data-id="heading-11">ä¸ƒã€æ€»ç»“</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„<strong>é¸¿è’™ç«¯äº‘ä¸€ä½“åŒ–å¼€å‘ç³»åˆ—æ•™ç¨‹</strong>å°±å…¨éƒ¨ç»“æŸäº†ï¼</p>
<p>ä»äº‘å‡½æ•°ã€äº‘æ•°æ®åº“ã€äº‘å­˜å‚¨åˆ°é¢„åŠ è½½ï¼Œæˆ‘ä»¬å®Œæ•´åœ°èµ°äº†ä¸€éCloud Foundation Kitçš„æ ¸å¿ƒèƒ½åŠ›ã€‚å¸Œæœ›è¿™äº›æ•™ç¨‹èƒ½å¸®åŠ©ä½ æ„å»ºå‡ºæ›´å¼ºå¤§ã€æ›´æµç•…çš„é¸¿è’™åº”ç”¨ã€‚</p>
<p>ç¥å¤§å®¶å¼€å‘æ„‰å¿«ï¼Œåº”ç”¨å¤§å–ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠ TCP çš„å¯é æ€§æ¬åˆ° WebSocketï¼šACK ç¡®è®¤ä¸æŒ‡æ•°é€€é¿é‡è¿ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7598222735806709800</link>    <guid>https://juejin.cn/post/7598222735806709800</guid>    <pubDate>2026-01-23T05:54:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598222735806709800" data-draft-id="7598104596780105774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŠŠ TCP çš„å¯é æ€§æ¬åˆ° WebSocketï¼šACK ç¡®è®¤ä¸æŒ‡æ•°é€€é¿é‡è¿ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-23T05:54:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hypoy"/> <meta itemprop="url" content="https://juejin.cn/user/3074670624777223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŠŠ TCP çš„å¯é æ€§æ¬åˆ° WebSocketï¼šACK ç¡®è®¤ä¸æŒ‡æ•°é€€é¿é‡è¿ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3074670624777223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hypoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T05:54:48.000Z" title="Fri Jan 23 2026 05:54:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨å›é¡¾ã€Šè®¡ç®—æœºç½‘ç»œã€‹ï¼Œå†å›å¤´çœ‹ä¹‹å‰å†™çš„ WebSocket çš„ä½¿ç”¨ä½“éªŒï¼Œä¼šå‘ç°ä¸€ä¸ªå¾ˆç°å®çš„å·®è·ï¼š<strong>WebSocket æä¾›çš„æ˜¯ä¸€æ¡é«˜æ•ˆçš„é•¿è¿æ¥é€šé“ï¼Œä½†å®ƒå¹¶ä¸ä¼šæ›¿ä½ ä¿è¯â€œä¸šåŠ¡æ¶ˆæ¯ä¸€å®šé€è¾¾â€ã€‚</strong> <code>send()</code> è°ƒç”¨æˆåŠŸï¼Œæœ€å¤šåªèƒ½è¯´æ˜æ•°æ®è¢«å†™è¿›äº†æœ¬åœ°å‘é€ç¼“å†²åŒºï¼›ä¸€æ—¦é‡åˆ°ç½‘ç»œæŠ–åŠ¨ã€åˆ‡ç½‘ã€ä»£ç†è¶…æ—¶æˆ–æœåŠ¡ç«¯é‡å¯ï¼Œæ¶ˆæ¯å°±å¯èƒ½åœ¨è·¯ä¸Šä¸¢å¤±ã€é‡å¤ï¼Œç”šè‡³å‡ºç°è¿æ¥â€œçœ‹èµ·æ¥è¿˜åœ¨ã€å®é™…ä¸Šå·²ç»æ–­äº†â€çš„åŠå¼€çŠ¶æ€ã€‚</p>
<p>è€Œè¿™äº›é—®é¢˜ï¼Œå…¶å®æ­£æ˜¯ã€Šè®¡ç®—æœºç½‘ç»œã€‹é‡Œåå¤å¼ºè°ƒçš„æ ¸å¿ƒå‘½é¢˜ï¼šæƒ³è¦ç¨³å®šä¼ è¾“ï¼Œç¦»ä¸å¼€<strong>ç¡®è®¤ï¼ˆACKï¼‰</strong> ã€<strong>è¶…æ—¶é‡ä¼ </strong>ã€<strong>é€€é¿é‡è¯•</strong>å’Œ<strong>ä¿æ´»ï¼ˆKeepaliveï¼‰</strong> ã€‚TCP åœ¨ä¼ è¾“å±‚æ›¿æˆ‘ä»¬å°è£…äº†å¤§é‡å¯é æ€§æœºåˆ¶ï¼Œä½†å½“æˆ‘ä»¬æŠŠé€šä¿¡æå‡åˆ° WebSocket è¿™ç§åº”ç”¨å±‚é€šé“æ—¶ï¼Œâ€œå¯é æ¶ˆæ¯â€çš„è¯­ä¹‰ä»ç„¶éœ€è¦è‡ªå·±è¡¥é½â€”â€”å°¤å…¶æ˜¯åœ¨éœ€è¦å¯ç¡®è®¤æŠ•é€’ã€æ–­çº¿å¯æ¢å¤çš„ä¸šåŠ¡åœºæ™¯é‡Œã€‚</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä¼šç”¨ JavaScript å°è£…ä¸€ä¸ªæ›´â€œç¨³â€çš„ WebSocketï¼šä¸ºæ¯æ¡æ¶ˆæ¯åŠ ä¸Š ACK ç¡®è®¤ä¸è¶…æ—¶é‡ä¼ ï¼›æ–­çº¿åé‡‡ç”¨æŒ‡æ•°é€€é¿ + æŠ–åŠ¨è‡ªåŠ¨é‡è¿ï¼Œé¿å…é‡è¿é£æš´ï¼›å¹¶æä¾›å¯é€‰çš„å¿ƒè·³æ£€æµ‹ä¸æ–­çº¿é‡å‘ã€‚ä¸€æ­¥æ­¥å®ç°ä¸€ä¸ªæ›´â€œç”Ÿäº§å¯ç”¨â€çš„ WebSocket å®¢æˆ·ç«¯å°è£…ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li><strong>ACK ç¡®è®¤æœºåˆ¶</strong>ï¼šæ¯æ¡æ¶ˆæ¯å¸¦ <code>id</code>ï¼ŒæœåŠ¡ç«¯å› <code>ack</code>ï¼Œå‘é€ç«¯å¯ç¡®è®¤æŠ•é€’å®Œæˆ</li>
<li><strong>ACK è¶…æ—¶ä¸é‡è¯•</strong></li>
<li><strong>æŒ‡æ•°é€€é¿+æŠ–åŠ¨</strong>è‡ªåŠ¨é‡è¿ï¼Œé¿å…æƒŠç¾¤</li>
<li><strong>æ–­çº¿é‡è¿åè‡ªåŠ¨é‡å‘æœª ACK æ¶ˆæ¯</strong>ï¼ˆå¯é€‰ï¼‰</li>
<li><strong>å¿ƒè·³ ping/pong</strong>ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆéœ€è¦ ACKï¼Ÿ</h2>
<p>å¾ˆå¤šäººä»¥ä¸º WebSocket åŸºäº TCPï¼Œæ¶ˆæ¯å°±â€œå¯é â€ã€‚ä½† TCP çš„å¯é æŒ‡çš„æ˜¯<strong>è¿æ¥å±‚å­—èŠ‚æµ</strong>ï¼Œä¸æ˜¯ä¸šåŠ¡å±‚çš„â€œæ¶ˆæ¯å·²é€è¾¾/å·²å¤„ç†â€ã€‚</p>
<p>å¸¸è§åœºæ™¯ï¼š</p>
<ul>
<li><code>send()</code> åªæ˜¯å†™å…¥ç¼“å†²åŒºï¼Œè¿æ¥éšåæ–­å¼€ï¼Œå¯¹ç«¯å¯èƒ½æ²¡æ”¶åˆ°</li>
<li>å¯¹ç«¯æ”¶åˆ°ä½†å¤„ç†å¤±è´¥ï¼ˆå…¥åº“å¤±è´¥/æ ¡éªŒå¤±è´¥/ä¸šåŠ¡å¼‚å¸¸ï¼‰ï¼Œå‘é€æ–¹ä»ç„¶ä¸çŸ¥é“</li>
<li>æ–­çº¿åé‡å‘å¯èƒ½å¯¼è‡´é‡å¤å¤„ç†ï¼ˆæ‰£æ¬¾ã€ä¸‹å•ã€çŠ¶æ€å˜æ›´ç­‰é£é™©ï¼‰</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨åº”ç”¨å±‚åŠ ä¸€å±‚å¾ˆè½»çš„åè®®ï¼š<strong>æ¯æ¡æ¶ˆæ¯å¸¦å”¯ä¸€ idï¼Œå¯¹ç«¯å› ACK</strong>ã€‚å‘é€æ–¹æ”¶åˆ° ACKï¼Œæ‰è®¤ä¸ºè¿™æ¡æ¶ˆæ¯å®Œæˆã€‚</p>
<hr/>
<h2 data-id="heading-1">2. æœ€å°åè®®çº¦å®šï¼ˆæ¨èï¼‰</h2>
<h3 data-id="heading-2">2.1 å®¢æˆ·ç«¯å‘é€ï¼ˆéœ€è¦ ACKï¼‰</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"t"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"msg"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uuid"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">2.2 æœåŠ¡ç«¯ç¡®è®¤ï¼ˆACKï¼‰</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"t"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ack"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uuid"</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">2.3ï¼ˆå¯é€‰ï¼‰å¿ƒè·³</h3>
<ul>
<li>pingï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"t"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ping"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"ts"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1700000000000</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>pongï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"t"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pong"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"ts"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1700000000000</span> <span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p><code>t</code> æ˜¯ type å­—æ®µï¼Œ<code>id</code> ç”¨äºåŒ¹é… pending æ¶ˆæ¯ï¼Œ<code>data</code> æ˜¯ä¸šåŠ¡ payloadã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">3. å®¢æˆ·ç«¯å°è£…çš„æ ¸å¿ƒæ€è·¯</h2>
<p>å°è£…çš„å…³é”®æ˜¯ç»´æŠ¤ä¸€ä¸ª <code>pending</code> è¡¨ï¼š</p>
<ul>
<li><code>pending[id] = { frame, resolve, reject, timer, tries }</code></li>
</ul>
<p>å½“ä½ è°ƒç”¨ <code>sendWithAck(data)</code>ï¼š</p>
<ol>
<li>ç”Ÿæˆ <code>id</code></li>
<li>ç»„è£… frameï¼š<code>{t:"msg", id, data}</code></li>
<li>å†™å…¥ <code>pending</code></li>
<li>å‘é€ frame</li>
<li>å¯åŠ¨ ACK è¶…æ—¶å®šæ—¶å™¨ï¼šè¶…æ—¶ â†’ é‡å‘æˆ–å¤±è´¥</li>
</ol>
<p>æ”¶åˆ°æœåŠ¡ç«¯ <code>ack</code>ï¼š</p>
<ol>
<li>åœ¨ <code>pending</code> é‡Œæ‰¾åˆ°å¯¹åº”æ¡ç›®</li>
<li>æ¸…ç†è¶…æ—¶å®šæ—¶å™¨</li>
<li>resolve Promise</li>
</ol>
<p>è¿æ¥æ–­å¼€æ—¶ï¼š</p>
<ul>
<li>æŒ‰æŒ‡æ•°é€€é¿å®‰æ’é‡è¿ï¼ˆå¸¦ jitterï¼‰</li>
<li>é‡è¿æˆåŠŸåï¼ˆå¯é€‰ï¼‰é‡å‘æœª ACK çš„ pending æ¶ˆæ¯</li>
</ul>
<h2 data-id="heading-6">4. å®Œæ•´ä»£ç ï¼ˆES6ï¼Œå¯ç›´æ¥ç”¨ï¼‰</h2>
<blockquote>
<p>è¿™ä»½å°è£…å®ç°äº†ï¼šACKã€ACK è¶…æ—¶é‡è¯•ã€æŒ‡æ•°é€€é¿è‡ªåŠ¨é‡è¿ã€æ–­çº¿é‡å‘ã€å¯é€‰å¿ƒè·³ã€‚</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AckWebSocket</span> {
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} url WebSocket åœ°å€
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{
   *  protocols?: string | string[],           // å­åè®®
   *  ackTimeoutMs?: number,                   // ç­‰å¾… ACK è¶…æ—¶æ—¶é—´
   *  maxSendRetries?: number,                 // ACK è¶…æ—¶åæœ€å¤šé‡å‘æ¬¡æ•°
   *  resendOnReconnect?: boolean,             // é‡è¿æˆåŠŸåæ˜¯å¦é‡å‘æœª ACK çš„æ¶ˆæ¯
   *  reconnect?: {
   *    enabled?: boolean,                     // æ˜¯å¦å¼€å¯è‡ªåŠ¨é‡è¿
   *    baseDelayMs?: number,                  // é‡è¿åŸºç¡€å»¶è¿Ÿï¼ˆæŒ‡æ•°é€€é¿èµ·ç‚¹ï¼‰
   *    maxDelayMs?: number,                   // é‡è¿æœ€å¤§å»¶è¿Ÿä¸Šé™
   *    jitter?: number,                       // æŠ–åŠ¨æ¯”ä¾‹ï¼ˆ0~1ï¼‰ï¼Œé¿å…æƒŠç¾¤
   *    maxRetries?: number,                   // æœ€å¤§é‡è¿æ¬¡æ•°ï¼ˆé»˜è®¤ Infinityï¼‰
   *  </span>},
   *  heartbeat?: {
   *    enabled?: boolean,                     // æ˜¯å¦å¼€å¯å¿ƒè·³
   *    intervalMs?: number,                   // å¿ƒè·³é—´éš”
   *    timeoutMs?: number,                    // ç­‰å¾… pong è¶…æ—¶
   *  },
   *  makeId?: () =&gt; string                    // è‡ªå®šä¹‰æ¶ˆæ¯ id ç”Ÿæˆå™¨
   * }} options
   */</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">url, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span> = url;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">protocols</span> = options.<span class="hljs-property">protocols</span>;

    <span class="hljs-comment">// ====== ACK ç›¸å…³é…ç½® ======</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ackTimeoutMs</span> = options.<span class="hljs-property">ackTimeoutMs</span> ?? <span class="hljs-number">8000</span>;      <span class="hljs-comment">// ç­‰å¾… ACK çš„è¶…æ—¶æ—¶é—´</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSendRetries</span> = options.<span class="hljs-property">maxSendRetries</span> ?? <span class="hljs-number">1</span>;     <span class="hljs-comment">// ACK è¶…æ—¶åé‡å‘æ¬¡æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resendOnReconnect</span> = options.<span class="hljs-property">resendOnReconnect</span> ?? <span class="hljs-literal">true</span>; <span class="hljs-comment">// é‡è¿åæ˜¯å¦é‡å‘ pending</span>

    <span class="hljs-comment">// ====== è‡ªåŠ¨é‡è¿ï¼šæŒ‡æ•°é€€é¿ + æŠ–åŠ¨ ======</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span> = {
      <span class="hljs-attr">enabled</span>: options.<span class="hljs-property">reconnect</span>?.<span class="hljs-property">enabled</span> ?? <span class="hljs-literal">true</span>,
      <span class="hljs-attr">baseDelayMs</span>: options.<span class="hljs-property">reconnect</span>?.<span class="hljs-property">baseDelayMs</span> ?? <span class="hljs-number">500</span>,
      <span class="hljs-attr">maxDelayMs</span>: options.<span class="hljs-property">reconnect</span>?.<span class="hljs-property">maxDelayMs</span> ?? <span class="hljs-number">15000</span>,
      <span class="hljs-attr">jitter</span>: options.<span class="hljs-property">reconnect</span>?.<span class="hljs-property">jitter</span> ?? <span class="hljs-number">0.2</span>,            <span class="hljs-comment">// 0~1ï¼Œå»ºè®® 0.2~0.4</span>
      <span class="hljs-attr">maxRetries</span>: options.<span class="hljs-property">reconnect</span>?.<span class="hljs-property">maxRetries</span> ?? <span class="hljs-title class_">Infinity</span>,
    };

    <span class="hljs-comment">// ====== å¿ƒè·³ï¼ˆå¯é€‰ï¼‰ ======</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">heartbeat</span> = {
      <span class="hljs-attr">enabled</span>: options.<span class="hljs-property">heartbeat</span>?.<span class="hljs-property">enabled</span> ?? <span class="hljs-literal">false</span>,
      <span class="hljs-attr">intervalMs</span>: options.<span class="hljs-property">heartbeat</span>?.<span class="hljs-property">intervalMs</span> ?? <span class="hljs-number">15000</span>,
      <span class="hljs-attr">timeoutMs</span>: options.<span class="hljs-property">heartbeat</span>?.<span class="hljs-property">timeoutMs</span> ?? <span class="hljs-number">8000</span>,
    };

    <span class="hljs-comment">// ====== æ¶ˆæ¯ id ç”Ÿæˆå™¨ ======</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">makeId</span> =
      options.<span class="hljs-property">makeId</span> ??
      (<span class="hljs-function">() =&gt;</span>
        (<span class="hljs-keyword">typeof</span> crypto !== <span class="hljs-string">"undefined"</span> &amp;&amp; crypto.<span class="hljs-property">randomUUID</span>)
          ? crypto.<span class="hljs-title function_">randomUUID</span>()
          : <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">16</span>).slice(<span class="hljs-number">2</span>)}</span>`</span>);

    <span class="hljs-comment">// å½“å‰ WebSocket å®ä¾‹</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// æ˜¯å¦ä¸ºæ‰‹åŠ¨ closeï¼ˆæ‰‹åŠ¨å…³é—­åˆ™ä¸å†é‡è¿ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">manualClose</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// pendingï¼šä¿å­˜â€œå·²å‘é€ä½†æœªæ”¶åˆ° ACKâ€çš„æ¶ˆæ¯</span>
    <span class="hljs-comment">// id -&gt; { frame, resolve, reject, timer, tries }</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

    <span class="hljs-comment">// é‡è¿çŠ¶æ€</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">retryCount</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// å¿ƒè·³çŠ¶æ€</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbInterval</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å¿ƒè·³å®šæ—¶å™¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbTimeout</span> = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// ç­‰å¾… pong è¶…æ—¶å®šæ—¶å™¨</span>

    <span class="hljs-comment">// ====== å¤–éƒ¨å¯æŒ‚è½½çš„å›è°ƒ ======</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onOpen</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onClose</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onError</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPush</span> = <span class="hljs-literal">null</span>;     <span class="hljs-comment">// å¤„ç† {t:"push", data} çš„æ¨é€</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMessage</span> = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// å¤„ç†é™¤ ack/pong å¤–çš„æ‰€æœ‰ JSON æ¶ˆæ¯</span>
  }

  <span class="hljs-comment">/** å»ºç«‹è¿æ¥ */</span>
  <span class="hljs-title function_">connect</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">manualClose</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_openSocket</span>();
  }

  <span class="hljs-comment">/**
   * æ‰‹åŠ¨å…³é—­è¿æ¥
   * æ³¨æ„ï¼šè¿™é‡Œé»˜è®¤æŠŠ pending å…¨éƒ¨ rejectï¼Œä½ ä¹Ÿå¯ä»¥æ”¹æˆä¿ç•™å¹¶åœ¨ä¸‹æ¬¡ connect åç»§ç»­é‡å‘
   */</span>
  <span class="hljs-title function_">close</span>(<span class="hljs-params">code = <span class="hljs-number">1000</span>, reason = <span class="hljs-string">"manual close"</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">manualClose</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearReconnect</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_stopHeartbeat</span>();

    <span class="hljs-comment">// å…³é—­æ—¶æŠŠæ‰€æœ‰æœª ACK çš„æ¶ˆæ¯æ ‡è®°å¤±è´¥</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [id, p] <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>) {
      <span class="hljs-built_in">clearTimeout</span>(p.<span class="hljs-property">timer</span>);
      p.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`WebSocket closed before ack (id=<span class="hljs-subst">${id}</span>)`</span>));
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">delete</span>(id);
    }

    <span class="hljs-comment">// å…³é—­åº•å±‚ socket</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> &amp;&amp; (<span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">CONNECTING</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">close</span>(code, reason);
    }
  }

  <span class="hljs-comment">/** å½“å‰æ˜¯å¦å·²è¿æ¥ï¼ˆOPENï¼‰ */</span>
  <span class="hljs-title function_">isOpen</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>?.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>;
  }

  <span class="hljs-comment">/**
   * å‘é€ä¸€æ¡â€œéœ€è¦ ACKâ€çš„æ¶ˆæ¯
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} data ä¸šåŠ¡æ•°æ®
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;{id: string</span>}&gt;} æ”¶åˆ° ACK å resolve
   */</span>
  <span class="hljs-title function_">sendWithAck</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> id = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeId</span>();
    <span class="hljs-keyword">const</span> frame = { <span class="hljs-attr">t</span>: <span class="hljs-string">"msg"</span>, id, data };

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-comment">// æ”¾å…¥ pendingï¼Œç­‰å¾… ACK</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">set</span>(id, { frame, resolve, reject, <span class="hljs-attr">timer</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">tries</span>: <span class="hljs-number">0</span> });
      <span class="hljs-comment">// å°è¯•å‘é€</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_trySend</span>(id);
    });
  }

  <span class="hljs-comment">/**
   * å‘é€ä¸€æ¡â€œä¸éœ€è¦ ACKâ€çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚æ—¥å¿—ã€ç»Ÿè®¡ã€é€šçŸ¥ï¼‰
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">obj</span>
   */</span>
  <span class="hljs-title function_">sendRaw</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_sendFrame</span>(obj);
  }

  <span class="hljs-comment">// ===================== å†…éƒ¨æ–¹æ³• =====================</span>

  <span class="hljs-comment">/** åˆ›å»º WebSocket å¹¶ç»‘å®šäº‹ä»¶ */</span>
  <span class="hljs-title function_">_openSocket</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearReconnect</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">protocols</span>
        ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">protocols</span>)
        : <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>);
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-comment">// åˆ›å»ºå¤±è´¥ä¹Ÿèµ°é‡è¿</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_scheduleReconnect</span>(e);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// è¿æ¥æˆåŠŸ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æˆåŠŸåé‡è¿è®¡æ•°æ¸…é›¶</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">retryCount</span> = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// å¼€å¯å¿ƒè·³</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heartbeat</span>.<span class="hljs-property">enabled</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_startHeartbeat</span>();

      <span class="hljs-comment">// é‡è¿æˆåŠŸåï¼šé‡å‘æ‰€æœ‰ pendingï¼ˆæœª ACKï¼‰æ¶ˆæ¯</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">resendOnReconnect</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> id <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">keys</span>()) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_trySend</span>(id, <span class="hljs-literal">true</span>);
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onOpen</span>?.();
    };

    <span class="hljs-comment">// æ”¶åˆ°æ¶ˆæ¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> msg = evt.<span class="hljs-property">data</span>;

      <span class="hljs-comment">// å°è¯•è§£æ JSON</span>
      <span class="hljs-keyword">try</span> {
        msg = <span class="hljs-keyword">typeof</span> msg === <span class="hljs-string">"string"</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(msg) : msg;
      } <span class="hljs-keyword">catch</span> {
        <span class="hljs-comment">// é JSON æ¶ˆæ¯äº¤ç»™ä¸Šå±‚ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMessage</span>?.(evt.<span class="hljs-property">data</span>);
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-comment">// ====== å¿ƒè·³ pong ======</span>
      <span class="hljs-keyword">if</span> (msg?.<span class="hljs-property">t</span> === <span class="hljs-string">"pong"</span>) {
        <span class="hljs-comment">// æ”¶åˆ° pongï¼Œæ¸…é™¤ç­‰å¾… pong çš„è¶…æ—¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearHeartbeatTimeout</span>();
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-comment">// ====== ACK ======</span>
      <span class="hljs-keyword">if</span> (msg?.<span class="hljs-property">t</span> === <span class="hljs-string">"ack"</span> &amp;&amp; msg.<span class="hljs-property">id</span>) {
        <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">get</span>(msg.<span class="hljs-property">id</span>);
        <span class="hljs-keyword">if</span> (p) {
          <span class="hljs-built_in">clearTimeout</span>(p.<span class="hljs-property">timer</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">delete</span>(msg.<span class="hljs-property">id</span>);
          <span class="hljs-comment">// resolve å‘Šè¯‰ä¸šåŠ¡ä¾§ï¼šå·²ç¡®è®¤</span>
          p.<span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: msg.<span class="hljs-property">id</span> });
        }
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-comment">// ====== å…¶å®ƒæ¶ˆæ¯ ======</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMessage</span>?.(msg);
      <span class="hljs-comment">// å¦‚æœçº¦å®šäº† push ç±»å‹ï¼Œå¯ç›´æ¥å›è°ƒ</span>
      <span class="hljs-keyword">if</span> (msg?.<span class="hljs-property">t</span> === <span class="hljs-string">"push"</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPush</span>?.(msg.<span class="hljs-property">data</span>);
    };

    <span class="hljs-comment">// é”™è¯¯äº‹ä»¶ï¼ˆå¤šæ•°æµè§ˆå™¨ä¿¡æ¯æœ‰é™ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onError</span>?.(err);
    };

    <span class="hljs-comment">// è¿æ¥å…³é—­</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-property">onclose</span> = <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_stopHeartbeat</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onClose</span>?.(evt);

      <span class="hljs-comment">// éæ‰‹åŠ¨å…³é—­æ‰è‡ªåŠ¨é‡è¿</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">manualClose</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span>.<span class="hljs-property">enabled</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_scheduleReconnect</span>(evt);
      }
    };
  }

  <span class="hljs-comment">/**
   * å®é™…å‘é€ï¼ˆåº•å±‚ sendï¼‰
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} æ˜¯å¦å‘é€æˆåŠŸï¼ˆä»…ä»£è¡¨ OPEN å¹¶å·²è°ƒç”¨ sendï¼‰
   */</span>
  <span class="hljs-title function_">_sendFrame</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isOpen</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>(<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"string"</span> ? obj : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">/**
   * å°è¯•å‘é€æŸæ¡ pending æ¶ˆæ¯ï¼Œå¹¶è®¾ç½® ACK è¶…æ—¶é‡å‘
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">id</span>
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} force æ˜¯å¦å¼ºåˆ¶ï¼ˆé‡è¿æˆåŠŸåè°ƒç”¨ï¼‰
   */</span>
  <span class="hljs-title function_">_trySend</span>(<span class="hljs-params">id, force = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">get</span>(id);
    <span class="hljs-keyword">if</span> (!p) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// æœªè¿æ¥ï¼šé force åˆ™ç­‰é‡è¿ï¼›force ä¹Ÿå‘ä¸äº†å°±ç»§ç»­ç­‰</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isOpen</span>()) {
      <span class="hljs-keyword">if</span> (!force) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šè®¤ä¸ºå¤±è´¥</span>
    <span class="hljs-keyword">if</span> (p.<span class="hljs-property">tries</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSendRetries</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pending</span>.<span class="hljs-title function_">delete</span>(id);
      p.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`ACK timeout retries exceeded (id=<span class="hljs-subst">${id}</span>)`</span>));
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// è®°å½•æœ¬æ¬¡å°è¯•æ¬¡æ•°</span>
    p.<span class="hljs-property">tries</span> += <span class="hljs-number">1</span>;

    <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_sendFrame</span>(p.<span class="hljs-property">frame</span>);

    <span class="hljs-comment">// è®¾ç½® ACK è¶…æ—¶ï¼šè¶…æ—¶åˆ™é‡å‘</span>
    <span class="hljs-built_in">clearTimeout</span>(p.<span class="hljs-property">timer</span>);
    p.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_trySend</span>(id);
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">ackTimeoutMs</span>);
  }

  <span class="hljs-comment">/**
   * å®‰æ’ä¸€æ¬¡è‡ªåŠ¨é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ + æŠ–åŠ¨ï¼‰
   * delay = min(baseDelay * 2^n, maxDelay) * (1 Â± jitter)
   */</span>
  <span class="hljs-title function_">_scheduleReconnect</span>(<span class="hljs-params">_reason</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">retryCount</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span>.<span class="hljs-property">maxRetries</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> n = <span class="hljs-variable language_">this</span>.<span class="hljs-property">retryCount</span>++;
    <span class="hljs-keyword">const</span> base = <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span>.<span class="hljs-property">baseDelayMs</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, n);
    <span class="hljs-keyword">const</span> capped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(base, <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span>.<span class="hljs-property">maxDelayMs</span>);

    <span class="hljs-comment">// æŠ–åŠ¨ï¼šè®©å»¶è¿Ÿéšæœºæ³¢åŠ¨ï¼Œé¿å…å¤§é‡å®¢æˆ·ç«¯åŒä¸€æ—¶åˆ»é‡è¿ï¼ˆæƒŠç¾¤ï¼‰</span>
    <span class="hljs-keyword">const</span> j = <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnect</span>.<span class="hljs-property">jitter</span>;
    <span class="hljs-keyword">const</span> rand = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>) * j; <span class="hljs-comment">// [-j, +j]</span>
    <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(capped * (<span class="hljs-number">1</span> + rand)));

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearReconnect</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_openSocket</span>(), delay);
  }

  <span class="hljs-comment">/** æ¸…é™¤é‡è¿å®šæ—¶å™¨ */</span>
  <span class="hljs-title function_">_clearReconnect</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> = <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// ===================== å¿ƒè·³ =====================</span>

  <span class="hljs-comment">/** å¯åŠ¨å¿ƒè·³ï¼šå®šæ—¶ pingï¼Œè¶…æ—¶æœª pong åˆ™ä¸»åŠ¨ close è§¦å‘é‡è¿ */</span>
  <span class="hljs-title function_">_startHeartbeat</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_stopHeartbeat</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isOpen</span>()) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// å‘é€ ping</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_sendFrame</span>({ <span class="hljs-attr">t</span>: <span class="hljs-string">"ping"</span>, <span class="hljs-attr">ts</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() });

      <span class="hljs-comment">// ç­‰å¾… pongï¼Œè¶…æ—¶åˆ™ä¸»åŠ¨å…³é—­ï¼Œè®© onclose èµ°é‡è¿</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearHeartbeatTimeout</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbTimeout</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>?.<span class="hljs-title function_">close</span>(<span class="hljs-number">4000</span>, <span class="hljs-string">"heartbeat timeout"</span>);
        } <span class="hljs-keyword">catch</span> {}
      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">heartbeat</span>.<span class="hljs-property">timeoutMs</span>);
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">heartbeat</span>.<span class="hljs-property">intervalMs</span>);
  }

  <span class="hljs-comment">/** æ¸…é™¤ç­‰å¾… pong çš„è¶…æ—¶å®šæ—¶å™¨ */</span>
  <span class="hljs-title function_">_clearHeartbeatTimeout</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hbTimeout</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hbTimeout</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbTimeout</span> = <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">/** åœæ­¢å¿ƒè·³ */</span>
  <span class="hljs-title function_">_stopHeartbeat</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hbInterval</span>) {
      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hbInterval</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hbInterval</span> = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_clearHeartbeatTimeout</span>();
  }
}

</code></pre>
<h2 data-id="heading-7">5. æ€ä¹ˆç”¨ï¼ˆä¸šåŠ¡ä¾§æœ€å°ç¤ºä¾‹ï¼‰</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AckWebSocket</span>(<span class="hljs-string">"wss://example.com/ws"</span>, {
  <span class="hljs-attr">ackTimeoutMs</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-attr">maxSendRetries</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">resendOnReconnect</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">reconnect</span>: { <span class="hljs-attr">baseDelayMs</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">maxDelayMs</span>: <span class="hljs-number">10000</span>, <span class="hljs-attr">jitter</span>: <span class="hljs-number">0.3</span> },
  <span class="hljs-attr">heartbeat</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">intervalMs</span>: <span class="hljs-number">15000</span>, <span class="hljs-attr">timeoutMs</span>: <span class="hljs-number">6000</span> },
});

ws.<span class="hljs-property">onOpen</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"connected"</span>);
ws.<span class="hljs-property">onClose</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"closed:"</span>, e.<span class="hljs-property">code</span>, e.<span class="hljs-property">reason</span>);
ws.<span class="hljs-property">onPush</span> = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"push:"</span>, data);

ws.<span class="hljs-title function_">connect</span>();

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendChat</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { id } = <span class="hljs-keyword">await</span> ws.<span class="hljs-title function_">sendWithAck</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">"chat"</span>, text });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"acked:"</span>, id);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"send failed:"</span>, e);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">6. æœåŠ¡ç«¯å¿…é¡»é…åˆçš„ç‚¹ï¼ˆéå¸¸å…³é”®ï¼‰</h2>
<h3 data-id="heading-9">6.1 æ”¶åˆ° msg åå› ACK</h3>
<p>æœ€ç®€å•çš„ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (frame.<span class="hljs-property">t</span> === <span class="hljs-string">"msg"</span>) {
  <span class="hljs-comment">// å¤„ç†ä½ çš„ä¸šåŠ¡...</span>
  <span class="hljs-title function_">send</span>({ <span class="hljs-attr">t</span>: <span class="hljs-string">"ack"</span>, <span class="hljs-attr">id</span>: frame.<span class="hljs-property">id</span> })
}
</code></pre>
<h3 data-id="heading-10">6.2 å¤„ç†â€œé‡å‘å¯¼è‡´é‡å¤â€çš„é—®é¢˜ï¼šå¹‚ç­‰/å»é‡</h3>
<p>å› ä¸ºå®¢æˆ·ç«¯ä¼šé‡è¯•ã€é‡è¿åä¹Ÿå¯èƒ½é‡å‘ï¼ŒåŒä¸€ä¸ª <code>id</code> å¯èƒ½å¤šæ¬¡å‡ºç°ã€‚æœåŠ¡ç«¯è‡³å°‘è¦åšåˆ°ï¼š</p>
<ul>
<li>å¦‚æœ <code>id</code> å·²å¤„ç†è¿‡ï¼š<strong>ç›´æ¥å› ACKï¼Œä¸è¦é‡å¤æ‰§è¡Œå‰¯ä½œç”¨</strong></li>
<li>å¦‚æœæ²¡å¤„ç†è¿‡ï¼šæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè®°å½• <code>id</code></li>
</ul>
<p>å®ç°ä¸Šå¯ç”¨ï¼š</p>
<ul>
<li>å†…å­˜ Mapï¼ˆç®€å•ï¼Œä½†é‡å¯ä¼šä¸¢ï¼‰</li>
<li>Redis set/hashï¼ˆæ›´ç¨³ï¼‰</li>
<li>æ•°æ®åº“å”¯ä¸€é”®ï¼ˆæœ€å¼ºï¼Œä½†æˆæœ¬æ›´é«˜ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-11">7. è°ƒå‚å»ºè®®ï¼ˆç»éªŒå€¼ï¼‰</h2>
<ul>
<li>
<p><code>ackTimeoutMs</code>ï¼š5~10 ç§’ï¼ˆå¦‚æœ ACK è¡¨ç¤ºâ€œå¤„ç†æˆåŠŸâ€ï¼Œè¦çœ‹ä¸šåŠ¡è€—æ—¶ï¼‰</p>
</li>
<li>
<p><code>maxSendRetries</code>ï¼š1~3 æ¬¡ï¼ˆé¿å…æ— é™é‡è¯•ï¼‰</p>
</li>
<li>
<p>é‡è¿ï¼š</p>
<ul>
<li><code>baseDelayMs</code>ï¼š300~800ms</li>
<li><code>maxDelayMs</code>ï¼š10~30s</li>
<li><code>jitter</code>ï¼š0.2~0.4ï¼ˆå¼ºçƒˆå»ºè®®ä¿ç•™ï¼‰</li>
</ul>
</li>
<li>
<p>å¿ƒè·³ï¼š</p>
<ul>
<li><code>intervalMs</code>ï¼š10~20sï¼ˆç§»åŠ¨ç«¯å¯é€‚å½“æ”¾å¤§ï¼‰</li>
<li><code>timeoutMs</code>ï¼š5~10s</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">8. å¸¸è§å‘æ¸…å•ï¼ˆä¸Šçº¿å‰æ£€æŸ¥ï¼‰</h2>
<ol>
<li><strong>ACK è¯­ä¹‰</strong>ï¼šæ˜¯â€œå·²æ”¶åˆ°â€è¿˜æ˜¯â€œå·²å¤„ç†æˆåŠŸâ€ï¼Ÿï¼ˆå†³å®š timeout ä¸ç”¨æˆ·ä½“éªŒï¼‰</li>
<li><strong>æœåŠ¡ç«¯å»é‡</strong>ï¼šæ²¡æœ‰å»é‡ï¼Œé‡è¯•ä¼šé€ æˆé‡å¤å‰¯ä½œç”¨</li>
<li><strong>ä¹±åºé—®é¢˜</strong>ï¼šé‡è¿åé‡å‘ pending å¯èƒ½ä¸æ–°æ¶ˆæ¯äº¤é”™ï¼›è‹¥è¦æ±‚ä¸¥æ ¼é¡ºåºï¼Œéœ€è¦ä¸²è¡Œå‘é€æˆ–åŠ åºåˆ—å·</li>
<li><strong>åå°å®šæ—¶å™¨è¢«é™é¢‘</strong>ï¼šç§»åŠ¨ç«¯/åå°é¡µ setTimeout ç²¾åº¦ä¼šå˜å·®ï¼Œå±æ­£å¸¸ç°è±¡ï¼Œå»é‡èƒ½å…œåº•</li>
</ol>
<hr/>
<h2 data-id="heading-13">ç»“è¯­</h2>
<p>WebSocket æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„é•¿è¿æ¥â€œé€šé“â€ï¼Œå®ƒè§£å†³çš„æ˜¯é€šä¿¡æ–¹å¼é—®é¢˜ï¼Œå´ä¸ç›´æ¥ä¿è¯â€œä¸šåŠ¡æ¶ˆæ¯å¯é é€è¾¾â€ã€‚æƒ³æŠŠå®ƒä»â€œèƒ½è·‘èµ·æ¥â€å˜æˆâ€œçº¿ä¸Šç¨³å¾—ä½â€ï¼Œå°±éœ€è¦åƒã€Šè®¡ç®—æœºç½‘ç»œã€‹é‡Œé‚£æ ·æŠŠå¯é æ€§æœºåˆ¶è¡¥åˆ°åº”ç”¨å±‚ï¼šç”¨ <strong>ACK</strong> è®©äº¤ä»˜å¯ç¡®è®¤ï¼Œç”¨ <strong>è¶…æ—¶é‡è¯•</strong> å¯¹æŠ—å¶å‘ä¸¢åŒ…ä¸æ–­é“¾ï¼Œç”¨ <strong>æŒ‡æ•°é€€é¿ + jitter</strong> æ§åˆ¶é‡è¿èŠ‚å¥ã€é¿å…æƒŠç¾¤ã€‚æŠŠè¿™äº›æœºåˆ¶ç»„åˆèµ·æ¥ï¼Œä½ å¾—åˆ°çš„ä¸åªæ˜¯ä¸€ä¸ª WebSocket è¿æ¥ï¼Œè€Œæ˜¯ä¸€å¥—æ›´æ¥è¿‘â€œå¯é ä¼ è¾“â€çš„å·¥ç¨‹åŒ–å®æ—¶é€šä¿¡èƒ½åŠ›ã€‚
å½“ç„¶ï¼Œè¿™å¥—å®ç°æ›´å¤šæ˜¯æˆ‘æœ€è¿‘å­¦ä¹ ã€Šè®¡ç®—æœºç½‘ç»œã€‹åçš„å®è·µæ€»ç»“ï¼Œä»ç„¶æœ‰å¾ˆå¤šå–èˆä¸è¾¹ç•Œï¼ˆæ¯”å¦‚ ACK è¯­ä¹‰ã€å¹‚ç­‰å»é‡ã€æ¶ˆæ¯é¡ºåºã€æŒä¹…åŒ–ç­–ç•¥ç­‰ï¼‰å€¼å¾—æ‰“ç£¨ã€‚<strong>å¦‚æœä½ åœ¨å®é™…é¡¹ç›®é‡Œæœ‰æ›´æˆç†Ÿçš„æ–¹æ¡ˆæˆ–è¸©å‘ç»éªŒï¼Œæ¬¢è¿æŒ‡æ­£äº¤æµã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidå®šåˆ¶åŒ–ç³»ç»Ÿäººè„¸è¯†åˆ«è§£é”æµç¨‹çš„ç®€å•äº†è§£]]></title>    <link>https://juejin.cn/post/7598071804970205222</link>    <guid>https://juejin.cn/post/7598071804970205222</guid>    <pubDate>2026-01-23T01:44:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598071804970205222" data-draft-id="7597283981185024052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidå®šåˆ¶åŒ–ç³»ç»Ÿäººè„¸è¯†åˆ«è§£é”æµç¨‹çš„ç®€å•äº†è§£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-23T01:44:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yen"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426633214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidå®šåˆ¶åŒ–ç³»ç»Ÿäººè„¸è¯†åˆ«è§£é”æµç¨‹çš„ç®€å•äº†è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426633214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T01:44:57.000Z" title="Fri Jan 23 2026 01:44:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">äººè„¸è¯†åˆ«å¤§è‡´æµç¨‹</h2>
<p>åº”ç”¨å±‚Settingsè¿›è¡Œäººè„¸å½•å…¥ï¼ŒSystemUIè¿›è¡Œäººè„¸è¯†åˆ«ç­‰æ“ä½œæ—¶ï¼Œä¼šè°ƒç”¨FaceMnagerçš„ç›¸å…³æ¥å£ï¼Œè¿›è€Œè°ƒç”¨åˆ°FaceServiceå’ŒFaceProviderï¼Œå…·ä½“ä¸šåŠ¡ç”±å¯¹åº”çš„Face***Clientï¼ˆå¦‚FaceEnrollClientï¼ŒFaceAuthenticationClientç­‰ï¼‰è°ƒç”¨Halæ¥å£å®ç°ï¼Œhalå±‚ä¼šé€šè¿‡Sensor.HalSessionCallbackï¼ˆextends ISessionCallback.Stubï¼‰æŠŠç»“æœå›è°ƒç»™Face***Clientï¼Œæœ€ç»ˆå›è°ƒåˆ°åº”ç”¨å±‚ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7720b830a43949d9accba1fc1364d08a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=x4aoS24eTgcI10SKAJiig8rliWE%3D" alt="äººè„¸å¤§è‡´æµç¨‹.png" loading="lazy"/></p>
<h3 data-id="heading-1">äººè„¸å½•å…¥</h3>
<p>åœ¨ç³»ç»Ÿè®¾ç½®Settingsæˆ–æ˜¯å¼€æœºå‘å¯¼ï¼Œä¼šæœ‰å…¥å£è·³è½¬åˆ°äººè„¸è¯†åˆ«ç®¡ç†é¡µé¢ã€‚è‹¥æ­¤æ—¶å°šæœªè®¾ç½®é”å±å¯†ç ï¼Œåˆ™ä¼šè¦æ±‚æ·»åŠ å¯†ç ï¼›è‹¥å·²è®¾ç½®é”å±å¯†ç ï¼Œåˆ™ä¼šè¦æ±‚æ ¡éªŒå¯†ç ã€‚å¯†ç éªŒè¯é€šè¿‡åï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰å·²å½•å…¥çš„äººè„¸æ¨¡æ¿æˆ–æ˜¯ä»å¼€æœºå‘å¯¼é‚£è¾¹è¿‡æ¥çš„ï¼Œä¼šè·³è½¬åˆ°äººè„¸å½•å…¥é¡µé¢ï¼Œå¦åˆ™åœç•™åœ¨å½“å‰é¡µé¢ã€‚</p>
<h4 data-id="heading-2">äººè„¸å½•å…¥ Token ç”Ÿæˆ</h4>
<p>è‹¥å°šæœªè®¾ç½®é”å±å¯†ç ï¼Œtokenä¼šåœ¨æˆåŠŸè®¾ç½®é”å±å¯†ç åç”Ÿæˆï¼›è‹¥å·²è®¾ç½®é”å±å¯†ç ï¼Œtokenä¼šåœ¨æˆåŠŸéªŒè¯å¯†ç åç”Ÿæˆã€‚ä¸¤è€…çš„tokenç”Ÿæˆæµç¨‹ç±»ä¼¼ï¼Œä¸‹é¢æµç¨‹ä»¥åœ¨è®¾ç½®é”å±å¯†ç åç”Ÿæˆtokenä¸ºä¾‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3f9aa423d0a433ca6650e78e700ce4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=z%2BVGOckR1zGvr3gYSXZdKw2pBns%3D" alt="äººè„¸tokenç”Ÿæˆ.png" loading="lazy"/></p>
<h4 data-id="heading-3">äººè„¸å½•å…¥æµç¨‹</h4>
<p>äººè„¸å½•å…¥æ—¶ï¼Œä¼šè°ƒç”¨åˆ°FaceManagerçš„enrollæ–¹æ³•ï¼Œé€šè¿‡è·¨è¿›ç¨‹é€šä¿¡ï¼Œè°ƒç”¨åˆ°FaceServiceçš„enrollæ–¹æ³•ï¼Œç›®å‰é«˜å®‰å“ç‰ˆæœ¬æ˜¯é€šè¿‡aidlçš„æ–¹å¼ä¸halå±‚è¿›è¡Œé€šä¿¡ï¼Œæ¥ä¸‹æ¥çš„æµç¨‹ä¸»è¦æ¶‰åŠåˆ°frameworks/base/services/core/java/com/android/server/biometrics/sensors/face/aidl/ è¿™ä¸ªç›®å½•é‡Œé¢çš„ä»£ç ï¼Œä¼šè°ƒç”¨åˆ°FaceProvideré‡Œé¢çš„scheduleEnrollæ–¹æ³•ï¼Œåœ¨FaceEnrollClienté‡Œé¢æ‰“å¼€ç›¸æœºï¼Œè·å–æ•°æ®åä¼ ç»™halå±‚ï¼Œæœ€ç»ˆé€šè¿‡ä¸€ç³»åˆ—çš„å›è°ƒæŠŠç»“æœè¿”å›ç»™åº”ç”¨å±‚ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4eedd682221b4e45b4b976a1e1e51560~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=yDN1QnSDhaWbyVA1J01%2Fko4LrJY%3D" alt="E3384BD8-EEA5-449B-B8D1-5AE356CCA75C_1_201_a.jpeg" loading="lazy"/></p>
<h3 data-id="heading-4">äººè„¸è¯†åˆ«ç®¡ç†</h3>
<p>åœ¨äººè„¸è¯†åˆ«ç®¡ç†é¡µï¼Œä¼šæ˜¾ç¤ºå·²å½•å…¥äººè„¸åç§°<br/>
FaceUtilsåˆå§‹åŒ–æ—¶ï¼Œä¼šæ ¹æ® sensorId æ‹¼è£…ä¸€ä¸ªæ–‡ä»¶å fileName = "settings_face_" + sensorId + ".xml"ï¼›åˆå§‹åŒ–FaceUserStateæ—¶ï¼Œä¼šä» fileName æ–‡ä»¶é‡Œé¢è¯»å–äººè„¸æ•°æ®ï¼Œäººè„¸å½•å…¥æˆåŠŸåä¹Ÿä¼šå¾€é‡Œé¢æ›´æ–°æ•°æ®ã€‚è·¯å¾„ç±»ä¼¼äºdata/system/users/0/settings_face_4.xmlã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78b09b07146c49d0a4984c4d9cac3471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=6nN7XzBhN%2FNUn%2BrY33jm0GfwAUE%3D" alt="äººè„¸è¯†åˆ«ç®¡ç†.png" loading="lazy"/></p>
<h3 data-id="heading-5">äººè„¸é‡å‘½å</h3>
<p>ç‚¹å‡»äººè„¸æ•°æ®itemï¼Œå¯æ›´æ”¹äººè„¸åç§°ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5edc2d479b6f44c98d71519520df80c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=IdPNEuxY3eY6K7HZSeodakd9Un0%3D" alt="äººè„¸é‡å‘½å.png" loading="lazy"/></p>
<p>renameBiometricæ–¹æ³•ä¼šæ ¹æ® mBiometricId æŸ¥æ‰¾åŒ¹é…çš„ Face æ•°æ®ï¼Œé‡ç½® Name å­—æ®µï¼ŒæŠŠæ•°æ®æ›´æ–°åˆ°data/system/users/0/settings_face_4.xml é‡Œé¢</p>
<h3 data-id="heading-6">äººè„¸åˆ é™¤</h3>
<h4 data-id="heading-7">åˆ é™¤å•ä¸ªäººè„¸</h4>
<p>ç‚¹å‡»äººè„¸æ•°æ®itemåˆ é™¤æŒ‰é’®ï¼Œå¯åˆ é™¤å•ä¸ªäººè„¸æ•°æ®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24d6904d11c44ef49725e66c86c6df52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=KXT%2FEW3LxlR%2F1eJMEMi2wbvXTjU%3D" alt="åˆ é™¤å•ä¸ªäººè„¸.png" loading="lazy"/></p>
<p>FaceRemovalClient åœ¨æ‰§è¡Œ onRemoved æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ® faceId åˆ é™¤ data/system/users/0/settings_face_4.xml é‡Œé¢å¯¹åº”çš„äººè„¸æ•°æ®</p>
<h4 data-id="heading-8">åˆ é™¤æ‰€æœ‰äººè„¸</h4>
<p>ç§»é™¤é”å±å¯†ç æ—¶ï¼Œä¼šåˆ é™¤æ‰€æœ‰å·²å½•å…¥çš„äººè„¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e09ddc78cdce45dc97ee0d32ae428dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=ohLZ3OO%2FhnN62sGKT81IyZiw44w%3D" alt="åˆ é™¤å…¨éƒ¨äººè„¸.png" loading="lazy"/></p>
<h3 data-id="heading-9">äººè„¸è¡¥å…‰</h3>
<p>å½“æ‰“å¼€â€œæš—å…‰ç¯å¢ƒä¸‹ä½¿ç”¨å±å¹•è¡¥å…‰â€é€‰é¡¹ï¼Œåœ¨é”å±ã€åº”ç”¨åŠ å¯†ç­‰é¡µé¢ä½¿ç”¨äººè„¸è¯†åˆ«è®¤è¯æ—¶ï¼Œä¼šæ ¹æ®å½“å‰ç¯å¢ƒäº®åº¦å»å†³å®šæ˜¯å¦è¦è¿›è¡Œäººè„¸è¡¥å…‰ï¼Œå…·ä½“æ—¶æœºæ˜¯åœ¨æ‰“å¼€ç›¸æœºå‰è¿›è¡Œç›‘å¬ï¼Œåœ¨å…³é—­ç›¸æœºå‰è§£é™¤ç›‘å¬ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57442e7d26084c3db4602f62beff6e73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=B9PcMK8rSE1NQYYFS%2FDH%2BU2f%2Bwg%3D" alt="æˆªå›¾ 2026-01-23 09-34-55.png" loading="lazy"/></p>
<h3 data-id="heading-10">æ³¨è§†ä¸ç­å±</h3>
<p>å¼€å¯â€œæ³¨é‡Šæ—¶ä¸ç­å±â€é€‰é¡¹ï¼Œè¶…æ—¶ç­å±å€’è®¡æ—¶ 2200æ¯«ç§’æ—¶ï¼ŒPowerManagerService ä¼šå‘æŸä¸€å¸¸é©»åº”ç”¨å‘é€å¹¿æ’­ com.face.pre.dimï¼Œè¯¥åº”ç”¨å¤„ç†å®Œä¸€äº›è‡ªèº«é€»è¾‘åï¼Œä¼šå‘ FaceService å‘é€å¹¿æ’­ com.face.detectï¼Œface_state = FACE_OPENï¼Œ å¼€å§‹æ£€æµ‹äººè„¸ï¼Œè‹¥æ£€æµ‹åˆ°äººè„¸æ³¨è§†ï¼Œåˆ™ä¼šå–æ¶ˆäººè„¸æ£€æµ‹ï¼Œé‡ç½®ç­å±å€’è®¡æ—¶ã€‚è‹¥è¶…æ—¶ç­å±æ—¶é—´åªæœ‰350æ¯«ç§’è¿˜æ²¡æ£€æµ‹åˆ°äººè„¸ï¼ŒPowerManagerService ä¼šå‘è¯¥åº”ç”¨å‘é€å¹¿æ’­ com.face.dim.state.changedï¼Œè¯¥åº”ç”¨å¤„ç†å®Œè‡ªèº«é€»è¾‘åï¼Œä¼šå‘FaceService å‘é€å¹¿æ’­ com.face.detectï¼Œface_state = FACE_CLOSEï¼Œå–æ¶ˆäººè„¸æ£€æµ‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/512a32ba4d184b01a41d4b53847e8e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=E8j2KBSvtamAkOghQks9%2FswDtDM%3D" alt="æ³¨è§†ä¸ç­å±.png" loading="lazy"/></p>
<h3 data-id="heading-11">è§£é”</h3>
<h4 data-id="heading-12">åŠ å¯†åº”ç”¨/æ–‡æ¡£é”å®šåŒº/å›¾åº“åŠ å¯†ç›¸å†Œè§£é”</h4>
<p>æ‰“å¼€åº”ç”¨åŠ å¯†è§£é”ã€æ–‡æ¡£é”å®šåŒºè§£é”ã€å›¾åº“åŠ å¯†ç›¸å†Œè§£é”é€‰é¡¹æ—¶ï¼Œè·³è½¬åˆ°ç›¸åº”åŠ å¯†é¡µé¢æ—¶ï¼Œä¼šå¢åŠ äººè„¸è¯†åˆ«éªŒè¯æ–¹å¼ï¼Œå¯¹åº”çš„éªŒè¯é¡µé¢ä¸ºConfirmPasswordFragment</p>
<p>é¦–å…ˆï¼Œä¼šåˆ¤æ–­æ˜¯å¦æœ‰å½•å…¥äººè„¸ï¼Œä»å“ªäº›é¡µé¢è·³è½¬è¿‡æ¥ï¼Œå¹¶ä¸”æ˜¯å¦æœ‰æ‰“å¼€å¯¹åº”è§£é”ç±»å‹çš„é€‰é¡¹å¼€å…³ï¼Œæ¥ç¡®å®šæ»¡ä¸æ»¡è¶³ä½¿ç”¨äººè„¸è¯†åˆ«è§£é”çš„æ¡ä»¶ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initFace</span><span class="hljs-params">()</span> {  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">hasEnrolled</span> <span class="hljs-operator">=</span> mFaceManager.hasEnrolledTemplates(UserHandle.myUserId());  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromAppLock</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom == LockPasswordUtils.PASSWORD_FROM_APP_LOCK;  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromAppLockManager</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom == LockPasswordUtils.PASSWORD_FROM_APP_LOCK_MANAGER;  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromDocument</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom == LockPasswordUtils.PASSWORD_FROM_DOCUMENT;  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromGalleryLock</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom == LockPasswordUtils.PASSWORD_FROM_GALLERY_LOCK;  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromNotes</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom ==  LockPasswordUtils.PASSWORD_FROM_NOTES; 
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">fromSafe</span> <span class="hljs-operator">=</span> mConfirmPasswordFrom ==   LockPasswordUtils.PASSWORD_FROM_SAFE;  
Â Â Â Â <span class="hljs-type">boolean</span> <span class="hljs-variable">isFromEnabled</span> <span class="hljs-operator">=</span> ((fromAppLock || fromAppLockManager) &amp;&amp; FaceUtil.isEnableForAppLock(getContext()))  
Â Â Â Â Â Â Â Â Â Â Â Â || (fromDocument &amp;&amp; FaceUtil.isEnableForDocumentLock(getContext()))  
Â Â Â Â Â Â Â Â Â Â Â Â || (fromGalleryLock &amp;&amp; FaceUtil.isEnableForGalleryLock(getContext())  
Â Â Â Â Â Â Â Â Â Â Â Â || (fromNotes &amp;&amp; FaceUtil.isEnableForNotesLock(getContext()))  
Â Â Â Â Â Â Â Â Â Â Â Â || fromSafe);  
Â Â Â Â <span class="hljs-keyword">if</span> (hasEnrolled &amp;&amp; isFromEnabled) {  
Â Â Â Â Â Â Â Â mIsFaceRecognitionEnable = <span class="hljs-literal">true</span>;  
Â Â Â Â Â Â Â Â mIFaceRecognition = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FaceRecognitionImpl</span>(getContext(), mHandler);  
Â Â Â Â } <span class="hljs-keyword">else</span> {  
Â Â Â Â Â Â Â Â mIsFaceRecognitionEnable = <span class="hljs-literal">false</span>;  
Â Â Â Â }  
}
</code></pre>
<p>å½“æ»¡è¶³ä¸Šè¿°æ¡ä»¶æ—¶ï¼Œå¦‚æœå½“å‰äººè„¸è¯†åˆ«å¤„äºå†»ç»“çŠ¶æ€ï¼Œä¼šæ˜¾ç¤ºå†»ç»“åŠ¨ç”»ï¼Œå¦åˆ™è¿›å…¥äººè„¸è¯†åˆ«è®¤è¯æµç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f342d9e2250d496c86d62504e23d2c13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=2zEpZfF%2BzT2pmrhwgSJZnMranQ8%3D" alt="åº”ç”¨åŠ å¯†äººè„¸è¯†åˆ«è®¤è¯.png" loading="lazy"/></p>
<h4 data-id="heading-13">å±å¹•è§£é”</h4>
<p>å±å¹•è§£é”å’ŒåŠ å¯†åº”ç”¨è§£é”ç­‰åœ¨æ¡†æ¶å±‚é¢çš„æµç¨‹ç±»ä¼¼ï¼Œåœ¨åº”ç”¨å±‚çš„äº¤äº’æœ‰å·®å¼‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55c2d343961c4a4ba815ae274200953e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=1A0rGu4KnYRIn2rshhn5USjtfSM%3D" alt="é”å±äººè„¸è¯†åˆ«.png" loading="lazy"/></p>
<h3 data-id="heading-14">å†»ç»“</h3>
<h4 data-id="heading-15">å¤šæ¬¡é”™è¯¯äººè„¸è¯†åˆ«å¯¼è‡´äººè„¸å†»ç»“</h4>
<p>å±å¹•è§£é”å’ŒåŠ å¯†åº”ç”¨è§£é”ç­‰é¡µé¢ï¼Œç´¯è®¡è¯†åˆ«åˆ°75å¸§é”™è¯¯äººè„¸åï¼Œåº•å±‚ä¼šå†»ç»“äººè„¸ï¼Œå¹¶ç»™ä¸Šå±‚å‘èµ·å›è°ƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c9f52176d749048043ac17eda6856c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=pp2PW7VTe%2FU%2FtBAjRBBcFUYaFY4%3D" alt="äººè„¸å†»ç»“å›è°ƒ.png" loading="lazy"/></p>
<h4 data-id="heading-16">æŒ‡çº¹å†»ç»“å¯¼è‡´äººè„¸å†»ç»“</h4>
<p>æŒ‡çº¹æ˜¯å¼ºç±»å‹ç”Ÿç‰©è¯†åˆ«ï¼Œäººè„¸æ˜¯å¼±ç±»å‹ç”Ÿç‰©è¯†åˆ«ã€‚å¼ºç±»å‹çš„ç”Ÿç‰©è¯†åˆ«è¢«å†»ç»“æ—¶ï¼Œå¼±ç±»å‹çš„ç”Ÿç‰©è¯†åˆ«ä¹Ÿä¼šç´§è·Ÿç€è¢«å†»ç»“ï¼ˆæ­¤æ—¶äººè„¸åœ¨ä¸Šå±‚å†»ç»“ï¼Œåº•å±‚æœªå†»ç»“ï¼‰</p>
<pre><code class="hljs language-Java" lang="Java">frameworks/base/services/core/java/com/android/server/biometrics/sensors/MultiBiometricLockoutState.java
<span class="hljs-keyword">void</span> <span class="hljs-title function_">setTimedLockout</span><span class="hljs-params">(<span class="hljs-type">int</span> userId, <span class="hljs-meta">@Authenticators</span>.Types <span class="hljs-type">int</span> strength)</span> {  
Â Â Â Â <span class="hljs-keyword">final</span> Map&lt;Integer, AuthenticatorState&gt; authMap = getAuthMapForUser(userId);  
Â Â Â Â <span class="hljs-keyword">switch</span> (strength) {  
Â Â Â Â Â Â Â Â <span class="hljs-keyword">case</span> Authenticators.BIOMETRIC_STRONG:  
Â Â Â Â Â Â Â Â Â Â Â Â authMap.get(BIOMETRIC_STRONG).mTimedLockout = <span class="hljs-literal">true</span>;  
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// fall through  </span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">case</span> Authenticators.BIOMETRIC_WEAK:  
Â Â Â Â Â Â Â Â Â Â Â Â authMap.get(BIOMETRIC_WEAK).mTimedLockout = <span class="hljs-literal">true</span>;  
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// fall through  </span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">case</span> Authenticators.BIOMETRIC_CONVENIENCE:  
Â Â Â Â Â Â Â Â Â Â Â Â authMap.get(BIOMETRIC_CONVENIENCE).mTimedLockout = <span class="hljs-literal">true</span>;  
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>;  
Â Â Â Â Â Â Â Â <span class="hljs-keyword">default</span>:  
Â Â Â Â Â Â Â Â Â Â Â Â Slog.e(TAG, <span class="hljs-string">"increaseLockoutTime called for invalid strength : "</span> Â + strength);  
Â Â Â Â }  
}
</code></pre>
<p>æŒ‰ç”µæºé”®äº®å±ï¼Œé”å±é¡µé¢ä¸ä¼šåˆ¤æ–­å½“å‰äººè„¸æ˜¯å¦å†»ç»“ï¼Œä¼šç›´æ¥è¿›è¡Œäººè„¸è¯†åˆ«è®¤è¯ï¼Œåœ¨æ¡†æ¶å±‚FaceAuthenticationClientè°ƒç”¨startæ–¹æ³•æ—¶ä¼šåˆ¤æ–­æ˜¯å¦ä¸ºå†»ç»“çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ç»™æŠ›å‡ºå†»ç»“å›è°ƒï¼Œç„¶åç›´æ¥returnï¼Œä¸ä¼šå»æ‰“å¼€ç›¸æœºå’Œä¼ æ•°æ®ç»™åº•å±‚</p>
<pre><code class="hljs language-java" lang="java">frameworks/base/services/core/java/com/android/server/biometrics/sensors/face/aidl/FaceAuthenticationClient.java  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ClientMonitorCallback callback)</span> {  
Â Â Â Â <span class="hljs-built_in">super</span>.start(callback);  
Â Â Â Â   
Â Â Â Â openCameraIfNecessary();  
Â Â Â Â   
Â Â Â Â mState = STATE_STARTED;  
}  
  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">openCameraIfNecessary</span><span class="hljs-params">()</span> {  
Â Â Â Â <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> lockoutMode;  
  
Â Â Â Â <span class="hljs-type">LockoutTracker</span> <span class="hljs-variable">lockoutTracker</span> <span class="hljs-operator">=</span> getLockoutTracker();  
Â Â Â Â <span class="hljs-keyword">if</span> (lockoutTracker != <span class="hljs-literal">null</span>) {  
Â Â Â Â Â Â Â Â lockoutMode = lockoutTracker.getLockoutModeForUser(getTargetUserId());  
Â Â Â Â } <span class="hljs-keyword">else</span> {  
Â Â Â Â Â Â Â Â lockoutMode = getBiometricContext().getAuthSessionCoordinator()  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .getLockoutStateFor(getTargetUserId(), getSensorStrength());  
Â Â Â Â }  
  
Â Â Â Â <span class="hljs-keyword">if</span> (lockoutMode != LockoutTracker.LOCKOUT_NONE) {  
Â Â Â Â Â Â Â Â Slog.v(TAG, <span class="hljs-string">"In lockout mode("</span> + lockoutMode + <span class="hljs-string">") ; disallowing open camera"</span>);  
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>;  
Â Â Â Â }  
  
Â Â Â Â <span class="hljs-keyword">if</span> (!SystemProperties.getBoolean(CTS_PROPERTY, <span class="hljs-literal">false</span>)) {  
Â Â Â Â Â Â Â Â openCamera();  
Â Â Â Â }  
}  
  
frameworks/base/services/core/java/com/android/server/biometrics/sensors/AuthenticationClient.java  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ClientMonitorCallback callback)</span> {  
Â Â Â Â <span class="hljs-built_in">super</span>.start(callback);  
  
Â Â Â Â <span class="hljs-keyword">final</span> <span class="hljs-meta">@LockoutTracker</span>.LockoutMode <span class="hljs-type">int</span> lockoutMode;  
Â Â Â Â <span class="hljs-keyword">if</span> (mShouldUseLockoutTracker) {  
Â Â Â Â Â Â Â Â lockoutMode = mLockoutTracker.getLockoutModeForUser(getTargetUserId());  
Â Â Â Â } <span class="hljs-keyword">else</span> {  
Â Â Â Â Â Â Â Â lockoutMode = getBiometricContext().getAuthSessionCoordinator()  
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .getLockoutStateFor(getTargetUserId(), mSensorStrength);  
Â Â Â Â }  
  
Â Â Â Â <span class="hljs-keyword">if</span> (lockoutMode != LockoutTracker.LOCKOUT_NONE) {  
Â Â Â Â Â Â Â Â Slog.v(TAG, <span class="hljs-string">"In lockout mode("</span> + lockoutMode + <span class="hljs-string">") ; disallowing authentication"</span>);  
Â Â Â Â Â Â Â Â <span class="hljs-type">int</span> <span class="hljs-variable">errorCode</span> <span class="hljs-operator">=</span> lockoutMode == LockoutTracker.LOCKOUT_TIMED
? BiometricConstants.BIOMETRIC_ERROR_LOCKOUT  
: BiometricConstants.BIOMETRIC_ERROR_LOCKOUT_PERMANENT;  
Â Â Â Â Â Â Â Â onError(errorCode, <span class="hljs-number">0</span> <span class="hljs-comment">/* vendorCode */</span>);  
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>;  
Â Â Â Â }  
  
Â Â Â Â <span class="hljs-keyword">if</span> (mTaskStackListener != <span class="hljs-literal">null</span>) {  
Â Â Â Â Â Â Â Â mActivityTaskManager.registerTaskStackListener(mTaskStackListener);  
Â Â Â Â }  
  
Â Â Â Â Slog.d(TAG, <span class="hljs-string">"Requesting auth for "</span> + getOwnerString());  
  
Â Â Â Â mStartTimeMs = System.currentTimeMillis();  
Â Â Â Â mAuthAttempted = <span class="hljs-literal">true</span>;  
Â Â Â Â startHalOperation();  
}
</code></pre>
<p>åŠ å¯†åº”ç”¨è§£é”ç­‰é¡µé¢ï¼Œä¼šå…ˆåˆ¤æ–­å½“å‰äººè„¸æ˜¯å¦å†»ç»“ï¼Œå¦‚æœä¸æ˜¯å†»ç»“çŠ¶æ€ï¼Œæ‰ä¼šè¿›è¡Œäººè„¸è¯†åˆ«è®¤è¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/984f00bdcf4a4dc6bd0cd592340d5169~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=JCs8lAgY%2Fo3WHeGpK2sxIzdpZGo%3D" alt="äººè„¸å†»ç»“çŠ¶æ€è·å–.png" loading="lazy"/></p>
<h3 data-id="heading-17">è§£å†»ç»“</h3>
<h4 data-id="heading-18">è¶…æ—¶è‡ªåŠ¨è§£é™¤äººè„¸å†»ç»“</h4>
<p>60ç§’è¶…æ—¶ï¼Œåº•å±‚ä¼šè‡ªåŠ¨è§£é™¤äººè„¸å†»ç»“ï¼Œå¹¶å›è°ƒç»™ä¸Šå±‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb0236f12e9841bbb8a38e1888f8033c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=g06QB5d%2Fi6ERyl0eWK%2FSDOa51ac%3D" alt="è¶…æ—¶è§£å†»ç»“.png" loading="lazy"/></p>
<h4 data-id="heading-19">æŒ‡çº¹è¯†åˆ«è§£é”æˆåŠŸè§£é™¤äººè„¸å†»ç»“</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff8adc931194ad1bdb21fcfd07eb89c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=1i04QdS8IM4VsfHoeth%2FoZpbMFg%3D" alt="æŒ‡çº¹è¯†åˆ«è§£é™¤äººè„¸å†»ç»“.png" loading="lazy"/></p>
<h4 data-id="heading-20">é”å±å¯†ç è§£é”æˆåŠŸè§£é™¤äººè„¸å†»ç»“</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20eb8e646bb14c23819cb4af31af4174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWVu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769738267&amp;x-signature=W0zleWx%2FAX5fy4TtDF2ae5VPwlY%3D" alt="whiteboard_exported_image (1).png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ å¯çŸ¥ Nest è£…é¥°å™¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598450302615846958</link>    <guid>https://juejin.cn/post/7598450302615846958</guid>    <pubDate>2026-01-24T02:14:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598450302615846958" data-draft-id="7597355509747859482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ å¯çŸ¥ Nest è£…é¥°å™¨ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,NestJS,Node.js"/> <meta itemprop="datePublished" content="2026-01-24T02:14:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä»˜è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ å¯çŸ¥ Nest è£…é¥°å™¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä»˜è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:14:55.000Z" title="Sat Jan 24 2026 02:14:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nest é€šè¿‡ @Moduleå£°æ˜æ¨¡å—</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bef37ccf839f4e75890159eee8c4d800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=86bk6ggcz13acnRTIseR%2Fq2mVVM%3D" alt="image.png" loading="lazy"/></p>
<p>@Controllerã€@Injectable åˆ†åˆ«å£°æ˜å…¶ä¸­çš„ controller å’Œ provider</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d5cffbd05584c399a399bdc7edbe000~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=dEaOhbcNugA1Zgdo2qeSg9T9nEs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7a4ef3d37184060826d5d3ff1f87277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=vNflmJIoZL479u21yNRPX9iz0Bs%3D" alt="image.png" loading="lazy"/></p>
<p>æ³¨å…¥çš„æ–¹å¼å¯ä»¥æ˜¯æ„é€ å™¨æ³¨å…¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79372ac1538f42deb9b984cfbb6b1798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=h6fbL0sPp10Z7lyqLxMwPiwe%2F3U%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ–è€…å±æ€§æ³¨å…¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/112645cf30d74a908c7c1daa87094eba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=9owmtGOB50%2FXe77VmabAr2qUfD4%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥é€šè¿‡ useFactoryã€useValue ç­‰æ–¹å¼å£°æ˜ provider</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de5091f5694d4390ab062a0a2496d071~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=AsMGbmwPUwsWn2LJtTyOX4ljkjc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb0d4079602423d8e78f6c189fdc6d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=hCAwIEvU%2FfhKjT0kJ4JHqwT%2BhO0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d22b58d76024dffb5f13818a722549f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=VMq98ty1W7ua6GRfdFDQNcdjdgk%3D" alt="image.png" loading="lazy"/></p>
<p>æ³¨å…¥çš„ä¾èµ–å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºå¯¹è±¡æ—¶ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨ @Optional å˜æˆå¯é€‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c0a572460e54e13bfb591c3f064f772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=kTyV7rK4284C1%2FIZMS33ADWLRj8%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœæ¨¡å—è¢«å¤šå¤„ä½¿ç”¨ï¼Œ ç”¨ @Global å£°æ˜ä¸ºå…¨å±€çš„</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f60fb21fe3a4318b4efc0522b8a842d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=RgB0fdRHLUxFXxt3WCqCXYQenMA%3D" alt="image.png" loading="lazy"/></p>
<p>@Catch æ¥æŒ‡å®šå¤„ç†å¼‚å¸¸</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f304890d2e546f6b6615bfc656cce2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=sXZsmiLKFmx2FTcyoNHLhtu5jLI%3D" alt="image.png" loading="lazy"/></p>
<p>@UseFilters åº”ç”¨åˆ° handler</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc4d247c94e74683b6d18bbeda4efe47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=p1AnPlBFpxB%2BI3q5dlR1hrtRjMo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1583f46c442a40cb8d9adac4f7c4a5bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=uCJcyfmfeuvsfs5Bc0eG97UtbEk%3D" alt="image.png" loading="lazy"/></p>
<p>interceptorã€guardã€pipe ä¹Ÿæ˜¯è¿™æ ·ç”¨ï¼Œä¹‹å‰æœ‰è§è¿‡</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57249f088e034d8b9f40e510a91af7bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=iPkomYKqbMZPBSkhGx27CFjDDMs%3D" alt="image.png" loading="lazy"/></p>
<p>pipe æ›´å¤šè¿˜æ˜¯å•ç‹¬åœ¨æŸä¸ªå‚æ•°çš„ä½ç½®åº”ç”¨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fcca2aa69348d6b10faaf5cd1af953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=AIfVs3o6iWINF0opbF8RVvmI73g%3D" alt="image.png" loading="lazy"/></p>
<p>@Query æ˜¯å– url åçš„ ?bbb=sssï¼Œè€Œ @Param æ˜¯å–è·¯å¾„ä¸­çš„å‚æ•°ï¼Œæ¯”å¦‚ /xxx/123 ä¸­çš„ 123
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f8065289164a36b5175cc1f8f8f817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=Xq53mQemCLD%2Fh6fhSWfdjtESNm8%3D" alt="image.png" loading="lazy"/></p>
<p>@Post è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡ @Body å–åˆ° body éƒ¨åˆ†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ba2376280c4230928e7333c0a7ea45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=kuvT4sOvd1FhXLQet1lT3Drr1%2Fo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b8e2247fac40118aa65ad4658ffdf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=83pIzI9x5oonjK38UMumz8zQjNI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/479d39a4e9224f57abfa8aaa8e829fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=NHdNk2JEM5wFJ3YUiUM%2B1%2BEiwIc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/722280a5539e412d9a6148caa853fd11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=XJftOHMkJvaK4JAMd63NUvRQ%2B1o%3D" alt="image.png" loading="lazy"/></p>
<p>é™¤äº† @Getã€@Post å¤–ï¼Œè¿˜å¯ä»¥ç”¨ @Putã€@Deleteã€@Patchã€@Optionsã€@Head è£…é¥°å™¨åˆ†åˆ«æ¥å— putã€deleteã€patchã€optionsã€head è¯·æ±‚</p>
<p>handler å’Œ class å¯ä»¥é€šè¿‡ @SetMetadata æŒ‡å®š metadata</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ee63cad2704bfab1b17ba1c0c849ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=oJmyk61ztPnTVNGR8ZutP4o8Xw4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/843431cbc7cd4eb3a5a8e5ead17ebd8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=5NDPJVuZxb1kasQFrxzEupE8oTY%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ guard æˆ–è€… interceptor é‡Œå–å‡ºæ¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75639bbbcfcb425cb9a5d3f3a1953620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=BRvDpovfL2FW1WUYj2fvkdd9MGM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f07ab5ad3bc64873ac9018d1fda2c53e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=J3FL1uLpGdnf4m8Smube0H367dE%3D" alt="image.png" loading="lazy"/></p>
<p>@Headers è£…é¥°å™¨å–æŸä¸ªè¯·æ±‚å¤´ æˆ–è€…å…¨éƒ¨è¯·æ±‚å¤´</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e36328127ae4acb8ba7b8db6a711ada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=GV5OOpaFWOh%2Bcd%2F24Ux2eQODcpk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be14649fb0d742d5af8b9dff8b6df02c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=tYszjIR6rXPAwukaO%2BxEE2RHsh0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be1bca81a2304548a7c07869a2a3ecb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=u09sbeLDrBUGiaVbxJftLtN22Pw%3D" alt="image.png" loading="lazy"/></p>
<p>@Ip æ‹¿åˆ°è¯·æ±‚çš„ ip , @Session æ‹¿åˆ° session å¯¹è±¡</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1a9580435a1434f9363cae08c60bba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=%2FzfMx5n7PCcca7n3PQ5Clz8HS%2Fc%3D" alt="image.png" loading="lazy"/></p>
<p>session éœ€è¦å®‰è£…ä¸€ä¸ª express ä¸­é—´ä»¶</p>
<pre><code class="hljs">npm install express-session
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b111c44184f413ebd3d098dcbf7c43b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=frj82s31dyHwHmfV9BFuVl3Z08s%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc1f55b4eafd48d283362d4e1d486b7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=pxOG%2BvWJwvF9AgJZYdLHZ8wq3y8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84bd59dc387f4016b2cdd6c2871e798e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=5MzO%2F9JtcghgnW1VPTFTL8Iq4RE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19f415ca12424e7a8925514277cef51c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=KuGxJyqhaAm79%2FjnRsXiFBZOjjg%3D" alt="image.png" loading="lazy"/></p>
<p>åç»­è¯·æ±‚ä¼šå¸¦ç€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f20bc1af2274dabab25293681b957a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=Bet5mkYYXvGhbp3O8Ihq7DyiMGY%3D" alt="image.png" loading="lazy"/></p>
<p>@HostParam ç”¨äºå–åŸŸåéƒ¨åˆ†çš„å‚æ•°</p>
<pre><code class="hljs language-css" lang="css">nest g controller aaa <span class="hljs-attr">--no-spec</span> <span class="hljs-attr">--flat</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e368afcf30447648482a5a99156a212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=dyDe4Z6DcxvYtJcxR8y09CobWC0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da2c4ba352b6474096ce42e532777bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=%2BKquj7P5BmNaz1JMXis3%2BT1Rq5M%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥æ‹¿åˆ° host</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a5b8bb3cf7045b991d8669a74575f2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=6N4IANzQeHFAVn1v3d2FlhfIT1c%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/504fbda1fcdb4ea9816ab7411e1686ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=24pt%2BVybrm%2F2mmpeo0Qh8C33Cus%3D" alt="image.png" loading="lazy"/></p>
<p>å‰é¢å–çš„è¿™äº›éƒ½æ˜¯ request é‡Œçš„å±æ€§ï¼Œå¯ä»¥ç›´æ¥æ³¨å…¥ request å¯¹è±¡</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86671ec8294f410b8b8d488a0f5bbcac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=KcbiWqK00SrjpUC51I9SF3ZCALg%3D" alt="image.png" loading="lazy"/></p>
<p>@Redirect è£…é¥°å™¨æ¥æŒ‡å®šè·¯ç”±é‡å®šå‘çš„ url</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ad594ebb3a43219ff764b70c6cef34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769825694&amp;x-signature=j9PPZZMEk%2Bm%2FUAGt7lg%2B2zmhHRk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">æ€»ç»“å¸¸ç”¨çš„è£…é¥°å™¨</h2>
<ul>
<li>@Moduleï¼š å£°æ˜ Nest æ¨¡å—</li>
<li>@Controllerï¼šå£°æ˜æ¨¡å—é‡Œçš„ controller</li>
<li>@Injectableï¼šå£°æ˜æ¨¡å—é‡Œå¯ä»¥æ³¨å…¥çš„ provider</li>
<li>@Injectï¼šé€šè¿‡ token æ‰‹åŠ¨æŒ‡å®šæ³¨å…¥çš„ providerï¼Œtoken å¯ä»¥æ˜¯ class æˆ–è€… string</li>
<li>@Optionalï¼šå£°æ˜æ³¨å…¥çš„ provider æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä¸ºç©º</li>
<li>@Globalï¼šå£°æ˜å…¨å±€æ¨¡å—</li>
<li>@Catchï¼šå£°æ˜ exception filter å¤„ç†çš„ exception ç±»å‹</li>
<li>@UseFiltersï¼šè·¯ç”±çº§åˆ«ä½¿ç”¨ exception filter</li>
<li>@UsePipesï¼šè·¯ç”±çº§åˆ«ä½¿ç”¨ pipe</li>
<li>@UseInterceptorsï¼šè·¯ç”±çº§åˆ«ä½¿ç”¨ interceptor</li>
<li>@SetMetadataï¼šåœ¨ class æˆ–è€… handler ä¸Šæ·»åŠ  metadata</li>
<li>@Getã€@Postã€@Putã€@Deleteã€@Patchã€@Optionsã€@Headï¼šå£°æ˜ getã€postã€putã€deleteã€patchã€optionsã€head çš„è¯·æ±‚æ–¹å¼</li>
<li>@Paramï¼šå–å‡º url ä¸­çš„å‚æ•°ï¼Œæ¯”å¦‚ /aaa/:id ä¸­çš„ id</li>
<li>@Query: å–å‡º query éƒ¨åˆ†çš„å‚æ•°ï¼Œæ¯”å¦‚ /aaa?name=xx ä¸­çš„ name</li>
<li>@Bodyï¼šå–å‡ºè¯·æ±‚ bodyï¼Œé€šè¿‡ dto class æ¥æ¥æ”¶</li>
<li>@Headersï¼šå–å‡ºæŸä¸ªæˆ–å…¨éƒ¨è¯·æ±‚å¤´</li>
<li>@Sessionï¼šå–å‡º session å¯¹è±¡ï¼Œéœ€è¦å¯ç”¨ express-session ä¸­é—´ä»¶</li>
<li>@HostParmï¼š å–å‡º host é‡Œçš„å‚æ•°</li>
<li>@Reqã€@Requestï¼šæ³¨å…¥ request å¯¹è±¡</li>
<li>@Resã€@Responseï¼šæ³¨å…¥ response å¯¹è±¡ï¼Œä¸€æ—¦æ³¨å…¥äº†è¿™ä¸ª Nest å°±ä¸ä¼šæŠŠè¿”å›å€¼ä½œä¸ºå“åº”äº†ï¼Œé™¤éæŒ‡å®š passthrough ä¸ºtrue</li>
<li>@Nextï¼šæ³¨å…¥è°ƒç”¨ä¸‹ä¸€ä¸ª handler çš„ next æ–¹æ³•</li>
<li>@HttpCodeï¼š ä¿®æ”¹å“åº”çš„çŠ¶æ€ç </li>
<li>@Headerï¼šä¿®æ”¹å“åº”å¤´</li>
<li>@Redirectï¼šæŒ‡å®šé‡å®šå‘çš„ url</li>
<li>@Renderï¼šæŒ‡å®šæ¸²æŸ“ç”¨çš„æ¨¡ç‰ˆå¼•æ“</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>