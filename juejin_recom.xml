<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[让 WinForm.NET 再次伟大！一个专门设计用于帮助 WinForms 应用程序迁移到 Blazor WASM 平台的项目]]></title>    <link>https://juejin.cn/post/7591672090790838291</link>    <guid>https://juejin.cn/post/7591672090790838291</guid>    <pubDate>2026-01-06T00:02:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591672090790838291" data-draft-id="7591697558377201706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让 WinForm.NET 再次伟大！一个专门设计用于帮助 WinForms 应用程序迁移到 Blazor WASM 平台的项目"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-01-06T00:02:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让 WinForm.NET 再次伟大！一个专门设计用于帮助 WinForms 应用程序迁移到 Blazor WASM 平台的项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:02:57.000Z" title="Tue Jan 06 2026 00:02:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>随着企业对网页端访问、界面现代化、跨平台支持、云集成和安全合规等能力的需求日益迫切，传统 .NET WinForms 应用的现代化转型已势在必行。<code>Blazor WebAssembly（WASM）</code> 凭借其可复用 C# 代码与基于浏览器的跨平台特性，成为迁移路径中的热门选择。然而大量 WinForms 应用程序使用了<code>System.Drawing</code> 模块调用<code>GDI+</code>进行复杂的自定义绘图和交互，使得常规迁移方案难以奏效，从而导致众多企业面临着高昂的重写成本和风险。</p>
<p>今天大姚给大家分享一个专门设计用于帮助 WinForms 应用程序迁移到 Blazor WASM 平台的项目：<strong>MWGA（Make WinForms Great Again）</strong> 。</p>
<h2 data-id="heading-1">MWGA 项目介绍</h2>
<p><strong>MWGA（Make WinForms Great Again）</strong> 是一个专门设计用于帮助 WinForms 应用程序迁移到 Blazor WASM 平台的项目，即使这些 WinForms 应用程序使用 GDI+ 功能，<strong>MWGA</strong> 项目也预期将对这些程序源码的修改量不超过10%。这极大的降低 WinForms 软件现代化的成本和风险。<strong>注意该项目是一个巨大的工程目前还在逐步规划、完善中，当前已开源演示项目，主要用于给大家演示迁移流程与验证兼容性</strong>（大家有更好的想法或解决方案欢迎前往开源地址提<strong>Issues</strong>）。</p>
<ul>
<li><strong>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdcsoft-yyf%2FMWGA" target="_blank" title="https://github.com/dcsoft-yyf/MWGA" ref="nofollow noopener noreferrer">github.com/dcsoft-yyf/…</a></strong></li>
</ul>
<h2 data-id="heading-2">WinForms 介绍</h2>
<p>Windows Forms（简称 WinForms）是一个用于构建 Windows 桌面应用程序的用户界面框架。它是对 Windows 原生用户界面库（如 User32 和 GDI+）的 .NET 封装，并提供了 WinForms 特有的控件及其他功能。</p>
<h2 data-id="heading-3">应用场景</h2>
<ul>
<li><strong>传统 WinForms 应用现代化</strong>：全球范围内存在大量基于 WinForms 开发的传统桌面应用，这些应用面临界面老化、跨平台支持差等问题，急需现代化改造。</li>
<li><strong>网页端访问需求</strong>：随着 Web 应用的普及，用户期望能够通过浏览器访问原本仅限于桌面端的应用，提升使用的便捷性和灵活性。</li>
<li><strong>云集成与安全合规</strong>：企业需要将应用迁移至云端，以满足数据安全、合规性要求，并实现更好的资源管理和扩展性。</li>
<li><strong>跨平台访问需求</strong>：原本仅支持 Windows 的应用需在 macOS、Linux 或移动设备浏览器中运行。</li>
<li><strong>降低重写成本与技术风险：</strong> 避免从零开发新 Web 前端带来的高成本、长周期和功能遗漏风险。</li>
</ul>
<h2 data-id="heading-4">演示项目源代码</h2>
<ul>
<li>运行环境：.NET 9.0</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2705aad52313470087728b3a6ad7ec6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=5aVqP1tVgtTcZ7y3cGDrOhqzMbU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d70a828ac24ba8a4a462feb12876ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=4vsFC3YtUs48gQdPWJIFblltOJA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">演示项目效果展示</h2>
<ul>
<li><strong>演示项目在线访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdcsoft-yyf.github.io%2FMWGA%2FWinFormCalculator.html" target="_blank" title="https://dcsoft-yyf.github.io/MWGA/WinFormCalculator.html" ref="nofollow noopener noreferrer">dcsoft-yyf.github.io/MWGA/WinFor…</a></strong></li>
</ul>
<h3 data-id="heading-6">WinForm 计算器项目演示：</h3>
<p>下面是还未迁移到 Blazor WASM 平台的 WinForm 计算器项目演示效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d43049710c80487fad9e126fdb35088e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=2Rr26OD0REx1c%2BE0iAWb4WFLZng%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e97a39f8c8534c38a1b94548101523cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=NfL33i79tlxBvp%2FSNw543YbnQCw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">迁移到 Blazor WASM 平台演示：</h3>
<p>下面是已经通过 <strong>MWGA</strong> 项目迁移到 Blazor WASM 平台的 WinForm 计算器项目演示效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b639b063007c41ffab2d44497a1488e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=KzNXnIPU0%2FVALYtEg3sZwLGSeNM%3D" alt="" loading="lazy"/></p>
<p><strong>Windows 浏览器和运行效果：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3ebbf8c0f3148d3aeb593d63157a184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=LazBFm74e1Q5xqc%2BxH7AUWPItC4%3D" alt="" loading="lazy"/></p>
<p><strong>安卓手机浏览器运行效果：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bedc5f1b27514b4cbaa6baf552bbde53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=khx1W6sBJrwSFZDmZkAbMIiQAbo%3D" alt="" loading="lazy"/></p>
<p><strong>结论：</strong></p>
<p>我实测后确认，同一套<code>Form.cs</code>和<code>Form.Designer.cs</code>代码，在 WinForms 环境下和 Blazor WASM 环境下，程序具有相同的用户界面和相同的运行逻辑。<code>button.Click</code>事件和<code>form.Resize</code>事件处理也符合预期。初步展示了将 WinForms 代码无修改的移植到 Blazor WASM 中的能力。这是<code>MWGA</code>的第一滴血，虽然还有很多不足，但还是为快速低成本的迁移 Winforms 程序带来明确的曙光。</p>
<h2 data-id="heading-8">演示项目核心代码</h2>
<p><strong>Program.cs：</strong> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7140f5b61bf4394aacf6e98d681bf64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262577&amp;x-signature=Y29LDBQprQ3ZDJ%2F7DTuO4zKcWnM%3D" alt="" loading="lazy"/></p>
<p><strong>DCWasmWinFormEngine.cs：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">namespace</span> <span class="hljs-title">DCSoft.WinForm2WASM</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DCWasmWinFormEngine</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 封装 Invoke 调用，强制使用「标识符 + params object[]」重载</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T <span class="hljs-title">InvokeJSFunction</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> identifier, <span class="hljs-keyword">params</span> <span class="hljs-built_in">object</span>?[]? args</span>)</span>
        {
            <span class="hljs-comment">// 直接调用 params 重载（因为 args 是显式的 object[]）</span>
            <span class="hljs-keyword">return</span> _jsRuntime.Invoke&lt;T&gt;(identifier, args);
        }
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InstallFontNames</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] fontNames</span>)</span>
        {
            WinForm2WASMPublish.SetFamilies(fontNames);
        }
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddStandardControlTypeName</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> typeName</span>)</span>
        {
            WinForm2WASMPublish.AddStandardControlTypeName(typeName);
        }
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Microsoft.JSInterop.JSInProcessRuntime _jsRuntime;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params">Microsoft.JSInterop.JSInProcessRuntime rt</span>)</span>
        {
            <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">null</span>)
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"rt"</span>);
            }
            _jsRuntime = rt;
            WinForm2WASMPublish.Start(<span class="hljs-keyword">new</span> MyJSRuntime(rt), <span class="hljs-keyword">typeof</span>(DCWasmWinFormEngine).Assembly);
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyJSRuntime</span> :<span class="hljs-title">DCSoft.IDCJSRuntime</span>
        {
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyJSRuntime</span>(<span class="hljs-params">JSInProcessRuntime rt</span>)</span>
            {
                <span class="hljs-keyword">if</span>(rt == <span class="hljs-literal">null</span> )
                {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"rt"</span>);
                }
                <span class="hljs-keyword">this</span>._rt = rt;
            }
            <span class="hljs-keyword">private</span> JSInProcessRuntime _rt = <span class="hljs-literal">null</span>;
            <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">Invoke</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> identifier, <span class="hljs-keyword">params</span> <span class="hljs-built_in">object</span>?[]? args</span>)</span>
            {
                <span class="hljs-keyword">return</span> _rt.Invoke&lt;T&gt;(identifier, args);
            }
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValueTask</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">InvokeAsync</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-built_in">string</span> identifier, <span class="hljs-keyword">params</span> <span class="hljs-built_in">object</span>?[]? args</span>)</span>
            {
                <span class="hljs-keyword">return</span> _rt.InvokeAsync&lt;T&gt;(identifier, args);
            }
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeVoidAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> identifier, <span class="hljs-keyword">params</span> <span class="hljs-built_in">object</span>?[]? args</span>)</span>
            {
                _rt.InvokeVoidAsync(identifier, args);
            }
        }
        
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 设置屏幕大小</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="width"&gt;</span>宽度<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="height"&gt;</span>高度<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="defaultFontName"&gt;</span>默认字体名称<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="defaultFontSize"&gt;</span>Point为单位的默认字体大小<span class="hljs-doctag">&lt;/param&gt;</span></span>
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetScreenSize</span>(<span class="hljs-params">
            <span class="hljs-built_in">int</span> width,
            <span class="hljs-built_in">int</span> height,
            <span class="hljs-built_in">string</span> defaultFontName,
            <span class="hljs-built_in">float</span> defaultFontSize</span>)</span>
        {
            WinForm2WASMPublish.SetScreenSize(width, height, defaultFontName, defaultFontSize);
        }
        
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">PackageArgumentObjectToHandle</span>(<span class="hljs-params"> JsonNode json </span>)</span>
        {
            <span class="hljs-keyword">return</span> WinForm2WASMPublish.PackageToHandle(json);
        }

        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SendMessage_WM_WINDOWPOSCHANGED</span>(<span class="hljs-params"> <span class="hljs-built_in">int</span> handle , JsonObject args </span>)</span>
        {
            WinForm2WASMPublish.SendMessage_WM_WINDOWPOSCHANGED(handle, args);
        }
        
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送消息到控件</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="handle"&gt;</span>控件句柄<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="msg"&gt;</span>消息类型<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="wParam"&gt;</span>参数1<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="lParam"&gt;</span>参数2<span class="hljs-doctag">&lt;/param&gt;</span></span>
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SendMessageToControl</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> handle , <span class="hljs-built_in">int</span> msg, <span class="hljs-built_in">int</span> wParam, <span class="hljs-built_in">int</span> lParam</span>)</span>
        {
            WinForm2WASMPublish.SendMessageToControl(handle, msg, wParam, lParam); 
        }

        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 处理已经发送的消息</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        [<span class="hljs-meta">JSInvokable</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandlePostedMessage</span>()</span>
        {
            WinForm2WASMPublish.HandlePostedMessage();
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[生产环境使用C++实现算法的必要性]]></title>    <link>https://juejin.cn/post/7591792747775082506</link>    <guid>https://juejin.cn/post/7591792747775082506</guid>    <pubDate>2026-01-06T00:13:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591792747775082506" data-draft-id="7591728734982881307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="生产环境使用C++实现算法的必要性"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-06T00:13:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由生长2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            生产环境使用C++实现算法的必要性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由生长2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:13:00.000Z" title="Tue Jan 06 2026 00:13:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问：使用tensorflow写的算法，为啥要使用C++部署呢？</h2>
<p><strong>算法工程化的核心矛盾</strong>：既然模型是用 TensorFlow（Python）写的，为什么还要用 C++ 来部署？这背后涉及性能、资源、系统集成和生产环境的现实需求。</p>
<p>下面从 <strong>5 个核心维度</strong>解释原因：</p>
<p><strong>1 性能：C++ 能榨干硬件极限</strong></p>
<ul>
<li><strong>低延迟</strong>：C++ 没有 Python 的 GIL（全局解释器锁）、垃圾回收、动态类型开销。在高并发、低延迟场景（如广告点击率预估、实时翻译），<strong>C++ 推理比 Python 快 2~10 倍</strong>很常见。</li>
<li><strong>CPU/GPU 利用率更高</strong>：C++ 可以精细控制内存布局（如连续内存块）、SIMD 指令、线程池，避免 Python 的内存碎片和调度开销。</li>
</ul>
<p>对延迟敏感的业务（金融交易、游戏 AI、车载系统），C++ 是刚需。</p>
<p><strong>2 稳定性与可控性</strong></p>
<p>Python 的动态特性（如 monkey patch、运行时 import）在生产环境是“定时炸弹”。</p>
<p>正因为这些语言更加高级，提供了更加易用的功能，开发方便，但是对于特定场合，比如部署运行，反而成了优化的负担。</p>
<p>C++ 编译期检查强，内存管理明确（RAII），更容易做：</p>
<ul>
<li>
<p>静态分析</p>
</li>
<li>
<p>内存泄漏检测</p>
</li>
<li>
<p>确定性行为（Determinism）</p>
</li>
</ul>
<p><strong>3 资源占用：更省内存、更少依赖</strong></p>
<p>Python 进程本身就要几百 MB 内存（加载 tensorflow、numpy 等），而 C++ 推理服务可以做到 &lt; 50MB。</p>
<p>在边缘设备（手机、IoT、车载芯片）或大规模集群（万级容器），内存节省 = 成本下降。
C++ 部署通常只链接必要的库（如 libtensorflow_cc.so），而 Python 需要整个解释器 + pip 包生态。</p>
<p>资源受限环境（端侧、边缘、高密度部署），C++ 更经济。</p>
<blockquote>
<p>总结前三点原因，可以看出，语言的特性是根本差异，因为C++集成了C语言，它足够原始，没有太多高级特性（内存自动回收），所以可控，性能也消耗最少，1，2，3其实都说的是1个原因。</p>
</blockquote>
<p><strong>4 系统集成性能：嵌入现有 C++ 生态</strong></p>
<p>很多公司核心系统是 C++ 写的（如游戏引擎、高频交易系统、数据库、自动驾驶中间件）。</p>
<p>如果推理服务也用 C++，可以直接 以内存函数调用方式集成，避免：</p>
<ul>
<li>进程间通信（IPC）</li>
<li>gRPC/HTTP 序列化开销</li>
<li>网络抖动风险</li>
</ul>
<p>自动驾驶感知模块（C++）需要实时调用 NLP 模型理解语音指令。</p>
<p>如果用 Python 服务，每帧都要走网络 → 增加 5~10ms 延迟 → 可能错过刹车时机。</p>
<p>用 C++ 直接调用模型 → 零拷贝、零网络 → 安全可靠。</p>
<p><strong>5 TensorFlow 本身就支持 C++ 部署</strong></p>
<p>TensorFlow 不只是 Python 库，它的底层是 C++ 写的，并提供了 官方 C++ API：<br/>
TensorFlow C++ API：直接加载 SavedModel，执行推理<br/>
TensorRT（NVIDIA）：将 TF 模型转为高度优化的 C++ 引擎（GPU 专用）<br/>
TF Lite：轻量级 C++ 推理库（适合移动端/嵌入式）</p>
<blockquote>
<p>4和5说的是生态原因，包括外部生态和内部生态。</p>
</blockquote>
<h2 data-id="heading-1">问：是不是所有场景都要用 C++？</h2>
<p>不是！ 以下情况用 Python 更合适：</p>
<p>快速原型验证（PoC）<br/>
批处理任务（离线分析，不追求低延迟）<br/>
模型频繁迭代，工程团队人力有限<br/>
使用 TF Serving / Triton 等托管服务（它们内部其实也是 C++）</p>
<h2 data-id="heading-2">使用C++部署模型的核心技能</h2>
<p>TensorFlow C++ API 或 ONNX Runtime C++（如果模型可转换）<br/>
SavedModel 格式 的加载与输入/输出张量处理<br/>
性能 profiling（如 perf、nsight）定位瓶颈</p>
<h2 data-id="heading-3">总结：c++运行tensorflow算法</h2>
<p>TensorFlow 的算法（Python 训练的模型）不需要“翻译”成 C++，而是：</p>
<p>用 C++ 直接加载训练好的模型文件，调用 TensorFlow 的 C++ 推理接口执行预测。</p>
<p>python关键代码实例：</p>
<pre><code class="hljs language-python" lang="python">model.save(<span class="hljs-string">"my_model"</span>)  <span class="hljs-comment"># 生成 my_model/ 目录（含 .pb 文件和 variables）</span>
</code></pre>
<p>c++关键代码实例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"tensorflow/cc/saved_model/loader.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"tensorflow/cc/serving/saved_model_bundle.h"</span></span>

tensorflow::SavedModelBundle bundle;
tensorflow::<span class="hljs-built_in">LoadSavedModel</span>(..., <span class="hljs-string">"my_model"</span>, ..., &amp;bundle);

<span class="hljs-comment">// 准备输入 Tensor（例如 shape=[1, 128] 的 float 输入）</span>
<span class="hljs-function">tensorflow::Tensor <span class="hljs-title">input</span><span class="hljs-params">(...)</span></span>;

<span class="hljs-comment">// 执行推理</span>
std::vector&lt;tensorflow::Tensor&gt; outputs;
bundle.session-&gt;<span class="hljs-built_in">Run</span>({{<span class="hljs-string">"input_tensor_name"</span>, input}}, {<span class="hljs-string">"output_tensor_name"</span>}, {}, &amp;outputs);
</code></pre>
<p>编译链接 TensorFlow C++ 库（需提前编译或下载 libtensorflow_cc.so）</p>
<p><strong>重点：</strong><br/>
不是重写算法，而是复用已训练好的模型<br/>
C++ 只负责：加载模型 + 构造输入 + 调用推理 + 解析输出<br/>
模型结构、权重全部由 SavedModel 文件提供，无需手写</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 21新特性实战：5个显著提升开发效率的语法糖与应用场景]]></title>    <link>https://juejin.cn/post/7591703562134487074</link>    <guid>https://juejin.cn/post/7591703562134487074</guid>    <pubDate>2026-01-06T00:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591703562134487074" data-draft-id="7591702898080710671" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 21新特性实战：5个显著提升开发效率的语法糖与应用场景"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-06T00:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 21新特性实战：5个显著提升开发效率的语法糖与应用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:16:48.000Z" title="Tue Jan 06 2026 00:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Java 21新特性实战：5个显著提升开发效率的语法糖与应用场景</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Java作为一门历经20多年演进的编程语言，始终保持着强大的生命力。2023年9月，Oracle正式发布了Java 21，这是一个长期支持（LTS）版本，带来了许多令人兴奋的新特性。其中，一些语法糖（Syntactic Sugar）的引入极大地提升了开发者的编码效率和代码可读性。</p>
<p>本文将深入探讨Java 21中5个最具实用价值的语法糖特性，并结合实际应用场景展示它们如何简化代码、减少模板代码（Boilerplate Code）并提升开发效率。无论你是Java初学者还是资深开发者，这些新特性都将为你的工具箱增添利器。</p>
<hr/>
<h3 data-id="heading-2">1. Switch表达式模式匹配（Pattern Matching for Switch）</h3>
<h4 data-id="heading-3">特性解析</h4>
<p>Java 21进一步完善了<code>switch</code>表达式的模式匹配能力，允许在<code>case</code>标签中直接使用类型模式（Type Patterns）和守卫条件（Guards）。这是对Java 17中预览特性的最终定稿。</p>
<h4 data-id="heading-4">语法示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, Java 21"</span>;

<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> Integer i -&gt; <span class="hljs-string">"Integer: "</span> + i;
    <span class="hljs-keyword">case</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"Long String: "</span> + s;
    <span class="hljs-keyword">case</span> String s -&gt; <span class="hljs-string">"String: "</span> + s;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"Unknown"</span>;
};
</code></pre>
<h4 data-id="heading-5">应用场景</h4>
<ul>
<li><strong>多态处理</strong>：简化基于类型的多分支逻辑，避免频繁的<code>instanceof</code>检查和强制类型转换。</li>
<li><strong>数据解析</strong>：在处理JSON或XML等动态数据时，可以更优雅地匹配和处理不同类型的数据节点。</li>
</ul>
<h4 data-id="heading-6">优势</h4>
<ul>
<li><strong>代码简洁性</strong>：减少了冗余的类型检查和转换代码。</li>
<li><strong>可读性</strong>：通过直观的模式匹配表达意图，逻辑更加清晰。</li>
</ul>
<hr/>
<h3 data-id="heading-7">2. Record模式的解构（Record Patterns）</h3>
<h4 data-id="heading-8">特性解析</h4>
<p>Record是Java 16引入的一种不可变数据载体类。Java 21进一步扩展了Record的功能，支持在模式匹配中直接解构Record的字段值。</p>
<h4 data-id="heading-9">语法示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> {}

<span class="hljs-type">Point</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);

<span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span>) {
    System.out.println(<span class="hljs-string">"x: "</span> + x + <span class="hljs-string">", y: "</span> + y);
}
</code></pre>
<h4 data-id="heading-10">应用场景</h4>
<ul>
<li><strong>DTO处理</strong>：快速提取数据传输对象（DTO）中的字段值。</li>
<li><strong>模式匹配组合</strong>：与<code>switch</code>表达式结合使用，实现复杂数据结构的深度匹配和解构。</li>
</ul>
<h4 data-id="heading-11">优势</h4>
<ul>
<li><strong>减少样板代码</strong>：无需手动调用访问器方法即可获取字段值。</li>
<li><strong>增强表达力</strong>：直接通过模式声明变量的绑定关系。</li>
</ul>
<hr/>
<h3 data-id="heading-12">3. Sequenced Collections API</h3>
<h4 data-id="heading-13">特性解析</h4>
<p>Java 21引入了新的<code>SequencedCollection</code>、<code>SequencedSet</code>和<code>SequencedMap</code>接口，为有序集合提供了一组统一的操作方法，如获取首尾元素、反向视图等。</p>
<h4 data-id="heading-14">语法示例</h4>
<pre><code class="hljs language-java" lang="java">List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, —));
<span class="hljs-type">int</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> list.getFirst(); <span class="hljs-comment">// Java 21新增方法</span>
<span class="hljs-type">int</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> list.getLast();
List&lt;Integer&gt; reversed = list.reversed();
</code></pre>
<p>#### 应用场景</p>
<ul>
<li><strong>队列和栈操作</strong>：简化首尾元素的访问和修改逻辑。</li>
<li><strong>算法实现</strong>：在需要反向遍历或处理边界元素的场景中减少冗余代码。</li>
</ul>
<p>#### 优势
-<strong>API标准化</strong>:统一了不同集合类型(如List.Deque)的首尾操作方法.
-<strong>功能增强</strong>:新增reversed()方法提供不可变的反向视图.</p>
<hr/>
<p>###4.String Templates(字符串模板)</p>
<p>#####特性解析</p>
<p>字符串模板是JEP430引入的特性旨在解决字符串拼接的繁琐问题.它允许开发者直接在字符串中嵌入表达式而无需显式拼接.</p>
<p>#####语法示例</p>
<pre><code class="hljs language-java" lang="java">String name=<span class="hljs-string">"John"</span>;
<span class="hljs-type">int</span> age=<span class="hljs-number">30</span>;

<span class="hljs-comment">//传统方式</span>
String message1=<span class="hljs-string">"Name:"</span>+name+<span class="hljs-string">"Age:"</span>+age;

<span class="hljs-comment">//Java 21字符串模板</span>
String message2=STR.<span class="hljs-string">"Name:\{name}Age:\{age}"</span>;
</code></pre>
<p>#####应用场景</p>
<p>-SQL查询构建:避免手写容易出错的SQL拼接语句.
-HTML生成:在Web应用中动态生成HTML片段时更安全便捷.</p>
<p>#####优势</p>
<p>-<strong>安全性</strong>:通过模板处理器可防止注入攻击.
-<strong>可读性</strong>:内嵌表达式使字符串结构一目了然.</p>
<hr/>
<p>###5.Unnamed Patterns and Variables(未命名模式和变量)</p>
<p>#####特性解析</p>
<p>该特性允许使用下划线_忽略未使用的模式或变量适用于需要声明但不使用的场景.</p>
<p>#####语法示例</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span>{
<span class="hljs-type">int</span> _=Integer.parseInt(<span class="hljs-string">"123"</span>);<span class="hljs-comment">//忽略结果</span>
}<span class="hljs-keyword">catch</span>(NumberFormatException _){
System.out.println(<span class="hljs-string">"Invalid number"</span>);
}

<span class="hljs-comment">//Record解构时忽略某些字段</span>
<span class="hljs-keyword">if</span>(point <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x,_)</span>){
System.out.println(<span class="hljs-string">"x:"</span>+x);
}
</code></pre>
<p>#####应用场景</p>
<p>-异常处理:忽略异常参数.
-Record解构:只提取部分字段值.</p>
<p>#####优势</p>
<p>-<strong>明确意图</strong>:通过_显式表明忽略该变量.
-<strong>减少噪音</strong>:避免未使用变量的警告提示.</p>
<hr/>
<p>##总结</p>
<p>Java21的这些语法糖不仅仅是表面的修饰它们从实际痛点出发显著提升了开发效率和代码质量:</p>
<p>1.Switch模式匹配让复杂的条件分支变得直观.
2.Record模式的解构简化了数据载体的处理.
3.Sequenced Collections为有序集合操作提供了统一API.
4.String Templates终结了繁琐的字符串拼接时代.
5.未命名模式和变量帮助开发者专注于真正需要的部分.</p>
<p>这些改进体现了Java团队对开发者体验的高度重视也展现了语言演进的务实方向.建议开发者尽快熟悉这些特性并将其应用到实际项目中以充分享受现代化Java带来的便利与高效.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 如何高效准备简历和面试]]></title>    <link>https://juejin.cn/post/7591730714140393514</link>    <guid>https://juejin.cn/post/7591730714140393514</guid>    <pubDate>2026-01-06T00:20:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591730714140393514" data-draft-id="7571726099688865811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 如何高效准备简历和面试"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-06T00:20:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端双越老师"/> <meta itemprop="url" content="https://juejin.cn/user/1714893868765373"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 如何高效准备简历和面试
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893868765373/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端双越老师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:20:48.000Z" title="Tue Jan 06 2026 00:20:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是双越。前百度 滴滴 资深前端工程师，慕课网金牌讲师，PMP。我的代表作有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wangeditor.com%2F" target="_blank" title="https://www.wangeditor.com/" ref="nofollow noopener noreferrer">wangEditor</a> 开源 web 富文本编辑器，GitHub 18k star，npm 周下载量 20k</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.huashuiai.com%2F" target="_blank" title="https://www.huashuiai.com/" ref="nofollow noopener noreferrer">划水AI</a> Node 全栈 AIGC 知识库，包括 AI 写作、多人协同编辑。复杂业务，真实上线。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2F" target="_blank" title="https://www.mianshipai.com/" ref="nofollow noopener noreferrer">前端面试派</a> 系统专业的面试导航，刷题，写简历，看面试技巧，内推工作。开源免费。</li>
</ul>
<blockquote>
<p>我在正在开发一个 AI Agent 智能体项目【<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhitalk.chat%2F" target="_blank" title="https://zhitalk.chat/" ref="nofollow noopener noreferrer">智语</a>】一个智能面试官，可以优化简历、模拟面试、解答题目等。对 AI 开发有兴趣的同学，可以围观、学习。</p>
</blockquote>
<h2 data-id="heading-0">开始</h2>
<p>近期已经有好几个同学和我说，裁员，不续约合同，或者看公司发展很不好，想跳槽。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0feef605b1734ac3b8279dacd70560f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263647&amp;x-signature=gqTJp%2BRE2M5%2BYiMbjLjYAHcfekg%3D" alt="image.png" loading="lazy"/></p>
<p>当前这种大环境下，应该如何准备面试呢？尤其是很多同学在一个公司好几年了，也不知道外面什么行情。</p>
<p>按照前些年的想法，面试嘛，那肯定得好好准备一番。刷算法，背诵八股文，甚至还要专门花一段时间学习新的技能。</p>
<p>这么多内容，你如果挨着准备一遍，至少 2-3 个月过去了，这个时间跨度太久了。</p>
<h2 data-id="heading-1">当前不适合长时间准备</h2>
<p>前些年招聘市场火热，面试机会多，工资开的高，这就有两个特点</p>
<ul>
<li>只要出去面试，就一定能找到工作</li>
<li>面试造火箭，只要你准备的好，就很有可能拿到高工资</li>
</ul>
<p>所以那个时候适合多花点时间，多准备些面试题，反正机会多的是，尽量争取一个好机会，进大厂，拿高薪。</p>
<p>而现在情况恰恰相反</p>
<ul>
<li>面试机会少了</li>
<li>面试不再大量考八股文和算法，而是更注重项目，更加实用主义</li>
</ul>
<p>所以你现在如果花大量时间准备很多知识，面试的时候不一定能用的上，而且这段时间你会浪费掉很多机会。现在机会才是最重要的。</p>
<p>而且，你个人的技术能力不可能在短时间靠刷题来提升。尤其是在当前这种实用主义面试的情况下，你很难把自己背诵的题目应用到实际场景中。</p>
<h2 data-id="heading-2">认真写简历</h2>
<p>简历是什么？简历就是一个人的脸，一个人的妆，是 HR 和面试官对你的第一印象。</p>
<p>一个陌生人拿到你简历的第一秒钟，他还没看到内容，但已经可以看到简历的篇幅和格式。</p>
<p>有些同学简历写的太简单，技能就 2-3 个基础的，项目就 2-3 个而且没详细写，格式也字体大小不一致...给人的第一印象就不好。</p>
<p>程序员是一个要求认真仔细的岗位，而且你在工作中除了写代码，也是要写文档的。你对待自己的简历都尚且如此马虎简陋，我不相信你在工作中能写出多么好的文档。</p>
<p>尤其是在当前招聘市场竞争激烈的环境下，简历的作用会被放大，一旦感觉你简历不好，立马就放弃你。</p>
<p>所以简历要认真写，要向别人展示出你的能力和态度</p>
<ul>
<li>专业技能，要写全</li>
<li>工作经历，要写出自己的工作成果</li>
<li>项目，既要有数量，又要有内容，写出自己在项目中的贡献、使用的技能</li>
</ul>
<p>还有一些同学写的太详细了，工作才 3 年，写个简历写 5 页，内容太多了，第一眼看着就眼晕。</p>
<p>简历的核心价值在于“勾引”，你只需要写出最具有吸引力的部分，不用写的很细节，你能引起别人的注意和兴趣，他就会约你来面试。等面试的时候，有你详细表达的机会。</p>
<p>简历的每个模块、格式和细节可参考【面试派】里的介绍 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2Fdocs%2Fbefore-interview%2Fwrite-resume.html" target="_blank" title="https://www.mianshipai.com/docs/before-interview/write-resume.html" ref="nofollow noopener noreferrer">www.mianshipai.com/docs/before…</a></p>
<p>如果你职场经验不多，写好简历以后，找身边认识的有经验的人，尤其是做过面试官的人，找他看一眼，提提建议。有些问题自己死活看不出来，别人一眼就能看出来，多找几个人看看，自己再综合考虑。</p>
<h2 data-id="heading-3">准备好项目</h2>
<p>项目经验，是当前简历和面试中最重要的内容，尤其是对于有工作经验的人。所以要提前准备好。</p>
<p>这其实很好理解，在 AI 编程普及的情况下，八股文、语法、算法能力都被抹平了。如果你是一个老板，要招聘一个干活的程序员，考察项目经验是最直接有效的方式。</p>
<p>简历里一般会写 3-5 个项目，但重要程度不一样，你要找到自己的“代表作”，作为简历第一个项目，这个要重点准备。</p>
<p>首先，在简历里，第一个项目要详细写，多写一下自己的项目职责和工作，使用的技能，项目成果等，得有大量自己参与的内容，才有说服力。</p>
<p>然后，要提前准备面试时的问题。</p>
<p><strong>第一个问题：请介绍这个项目</strong></p>
<p>这个问题看似简单，但很多同学回答的都不好：</p>
<ul>
<li>上来就说技术细节，我压根都不知道你这个项目是个啥</li>
<li>长篇大论，一口气说 10 分钟，其实我在 2 分钟以后就听懵了</li>
</ul>
<p>大家要明白，你去面试，对面坐着的是一个完全陌生的人，他对你陌生，他对你的项目更陌生，他可能刚刚拿到你的简历，你一边讲他一边看。</p>
<p>但你却他把当作你身边的同时一样，直接讨论项目的技术细节，他能听懂吗？他听不懂你说的再好有用吗？</p>
<p>所以，介绍项目时，最重要的是让别人能听懂，这是绝大部分同学所面临的障碍。</p>
<p>面试，是一种沟通，你得感知对方是不是在听你说话，感知他是不是听懂了。沟通，不是你单方面的倾诉，你得适当的留出对方提问的间隙，而不是你一味的自我表达。</p>
<p><strong>第二个问题：项目的亮点或成就</strong></p>
<p>看到这个问题，很多同学的第一反应就是：我没有亮点也没有成就。</p>
<p>老板把你招聘过去，每个月给你开工资干活，你肯定每天都有产出。没有功劳还有苦劳嘛，即便没有亮点，你总有难点吧？</p>
<p>回顾一下你这半年，有没有为一个需求、一个问题、一个 bug 而加班熬夜甚至通宵，头发都抓掉好几把，肯定有吧。</p>
<p>即便再没有，没吃过猪肉也见过猪跑，你身边的同事总会有这种情况吧？你给他买杯奶茶，问问他。</p>
<p>叫法不重要，无论叫亮点、成就、还是难点，都行。你只要能讲出 1-2 段你在项目中的不俗的经历就可以。</p>
<p>然后怎么讲，也是有技巧的。既然要说亮点、难点，那得讲的出“亮”和“难”不能平淡如水。</p>
<p>你得把需求、背景、问题、分析、障碍、解决方案、结果，从头到尾都说出来。并且要体现出使用的技术，因为你是技术人员。</p>
<p>具体格式可以参考【面试派】给出的格式 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2Fdocs%2Fthird-exam%2Fproject.html" target="_blank" title="https://www.mianshipai.com/docs/third-exam/project.html" ref="nofollow noopener noreferrer">www.mianshipai.com/docs/third-…</a></p>
<p><strong>第三个问题，项目有没有做过什么优化？</strong></p>
<p>优化，一般是体验和性能，这其实是老生常谈的问题了。</p>
<p>但如果在项目中问这个问题，不要只背诵八股文，一定要结合项目实际功能，而且最好有量化标准。</p>
<p>总之，你得提前准备这个问题，否则万一被问到，现学现卖是来不及的。而且这种问题一旦回答失败，影响会非常大。</p>
<h2 data-id="heading-4">快速准备八股文和算法</h2>
<p>AI 时代八股文和算法会越来越少，就像 Vue React 时代不会再问你 DOM API 。</p>
<p>但是直接忽略他们，一点都不准备嘛？这肯定不行，万一被问到一个基础问题，你不会，这有点丢人。</p>
<p>我建议是：集中 2-3 天快速复习</p>
<ul>
<li>把本该会的、简单的过一遍，查缺补漏</li>
<li>那些不会的，有点难度的，就先不管了</li>
</ul>
<p>尤其是算法，不好短时间恶补，你如果现在不会，那就先这样吧，别强求了。等找到工作稳定了，再业余去刷吧。</p>
<p>基础八股文的快速复习，可以参考【面试派】里面整理的问题 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2Fdocs%2Fwritten-exam%2FJS-writing.html" target="_blank" title="https://www.mianshipai.com/docs/written-exam/JS-writing.html" ref="nofollow noopener noreferrer">www.mianshipai.com/docs/writte…</a></p>
<h2 data-id="heading-5">尽快投递简历</h2>
<p>上文已经分析了，不要想着：先认真复习 1-2 个人，再投简历。不要这样。</p>
<p>第一，你简历写好了，修改好了；第二，你项目准备好了。<strong>接下来就直接投递简历，不用等</strong>。每天都要投，广泛的投，不放过任何一个机会。</p>
<p>你投递到接到要求，最快也得 3-5 天的时间，这个时间用于快速复习基础八股文，足够了。</p>
<p>后面如果有面试，再根据面试情况归纳总结，复习更多的问题。</p>
<p>总之，要尽快博取机会，不要拖沓。现在竞争激烈，你一旦拖沓，一懒惰，很快 2-3 个月就过去了。</p>
<h2 data-id="heading-6">最后</h2>
<p>现在是买方市场，僧多粥少，不要过多准备。你在这精心准备着，那边机会早就被人给抢走了。</p>
<p>简历，项目，包括基础八股文，最多 2 周时间，然后就去投递，早投，多投。然后一边面试着，一遍再总结。</p>
<p>也许吧，快节奏已经不知不觉渗透到了工作生活的方方面面。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 开年盘点：GitHub 上备受关注的十大 AI Agent 框架]]></title>    <link>https://juejin.cn/post/7591702898080727055</link>    <guid>https://juejin.cn/post/7591702898080727055</guid>    <pubDate>2026-01-06T00:24:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591702898080727055" data-draft-id="7591702898080481295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 开年盘点：GitHub 上备受关注的十大 AI Agent 框架"/> <meta itemprop="keywords" content="Agent,Python,TypeScript"/> <meta itemprop="datePublished" content="2026-01-06T00:24:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天行无忌"/> <meta itemprop="url" content="https://juejin.cn/user/4406498333033918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 开年盘点：GitHub 上备受关注的十大 AI Agent 框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498333033918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天行无忌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:24:46.000Z" title="Tue Jan 06 2026 00:24:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3798d7913bcd4b699161e5dfe9bd6b51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263886&amp;x-signature=M3%2FZTK0Vk4OCL2tzZdNGV4j3vE4%3D" alt="GitHub-上备受关注的十大-AI-Agent-框架.jpg" loading="lazy"/></p>
<p>AI 智能体正在重塑我们构建软件的方式。GitHub Star 星标数是开发者信任度与社区采纳度的重要体现。以下是截至2026年01月05日 GitHub 上备受关注的十大 AI Agent 框架。</p>
<h3 data-id="heading-0">1. LangChain</h3>
<p>最流行的用于构建 LLM 驱动应用的框架，提供用于链、智能体和检索的广泛工具。</p>
<p>借助 LangChain，只需不到 10 行代码即可接入 OpenAI、Anthropic、Google 等平台。它提供预建的智能体架构与模型集成，帮助开发者快速起步，轻松将 LLM 能力融入智能体与应用中。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain" target="_blank" title="https://github.com/langchain-ai/langchain" ref="nofollow noopener noreferrer">github.com/langchain-a…</a></li>
<li>🌟 Star：123K</li>
</ul>
<h3 data-id="heading-1">2. MetaGPT：多智能体框架</h3>
<p>一个模拟软件公司的多智能体框架，智能体在其中担任产品经理、架构师和工程师等角色。</p>
<ol>
<li>MetaGPT输入<strong>一句话的老板需求</strong>，输出<strong>用户故事 / 竞品分析 / 需求 / 数据结构 / APIs / 文件等</strong></li>
<li>MetaGPT内部包括<strong>产品经理 / 架构师 / 项目经理 / 工程师</strong>，它提供了一个<strong>软件公司</strong>的全过程与精心调配的SOP. <code>Code = SOP(Team)</code> 是核心哲学。将SOP具象化，并且用于LLM构成的团队</li>
</ol>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFoundationAgents%2FMetaGPT" target="_blank" title="https://github.com/FoundationAgents/MetaGPT" ref="nofollow noopener noreferrer">github.com/FoundationA…</a></li>
<li>🌟 Star：62.5K</li>
</ul>
<h3 data-id="heading-2">3. AutoGen</h3>
<p>AutoGen 是一个用于创建多智能体 AI 应用的框架，这些应用能够自主行动或与人类协同工作。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fautogen" target="_blank" title="https://github.com/microsoft/autogen" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
<li>🌟 Star：53.2K</li>
</ul>
<h3 data-id="heading-3">4. LlamaIndex</h3>
<p>LlamaIndex（GPT Index）是为您的 LLM 应用程序设计的数据框架。使用 LlamaIndex 进行构建通常涉及 LlamaIndex 核心和一组选定的集成（或插件）。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frun-llama%2Fllama_index" target="_blank" title="https://github.com/run-llama/llama_index" ref="nofollow noopener noreferrer">github.com/run-llama/l…</a></li>
<li>🌟 Star：46.2K</li>
</ul>
<h3 data-id="heading-4">5. CrewAI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e98e03b5c0492fb46f09cd345cb817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263886&amp;x-signature=aNank6QvwSQbHPx5HiOp6ivfA%2BA%3D" alt="image.png" loading="lazy"/></p>
<p>一个用于编排角色扮演自主智能体的框架，这些智能体通过协作完成复杂任务。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FcrewAIInc%2FcrewAI" target="_blank" title="https://github.com/crewAIInc/crewAI" ref="nofollow noopener noreferrer">github.com/crewAIInc/c…</a></li>
<li>🌟 Star：42.3K</li>
</ul>
<h3 data-id="heading-5">6. Agno</h3>
<p>Agno 是一个多智能体框架、运行时和控制平面。用它来在你的云环境中构建私有且安全的 AI 产品。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagno-agi%2Fagno" target="_blank" title="https://github.com/agno-agi/agno" ref="nofollow noopener noreferrer">github.com/agno-agi/ag…</a></li>
<li>🌟 Star：36.6K</li>
</ul>
<p>Agno 提供了一套统一的堆栈，用于构建、运行和管理多智能体系统：</p>
<ul>
<li><strong>框架</strong>：借助记忆、知识库、状态管理、防护机制、人在回路、上下文压缩、MCP 协议、A2A 通信及 100 多种工具包，构建智能体、多智能体团队与工作流。</li>
<li><strong>AgentOS 运行时</strong>：通过安全无状态的运行环境及开箱即用的集成端点，在生产环境中运行多智能体系统。</li>
<li><strong>AgentOS 控制平面</strong>：通过全栈运行可视化管理跨环境部署的 AgentOS 系统，支持测试、监控与运维管理。可自主构建 Web 界面或直接使用 AgentOS 原生管理界面。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcf261691edb4385b647de869e32fb9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263886&amp;x-signature=sISSHLckm%2F9ZLQit4swC7Mei%2FHA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">7. Haystack</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c203eed6fa654f3eba422e6612f816eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263886&amp;x-signature=X3RyO32P6j%2BqKi5otoNJPulbUX4%3D" alt="image.png" loading="lazy"/></p>
<p>Haystack 是一个端到端的 LLM 框架，可让构建由 LLMs、Transformer 模型、向量搜索等技术驱动的应用程序。无论是想实现检索增强生成（RAG）、文档搜索、问答还是答案生成，Haystack 都能将先进的嵌入模型和 LLMs 编排到流水线中，构建端到端的 NLP 应用并满足用例需求。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepset-ai%2Fhaystack" target="_blank" title="https://github.com/deepset-ai/haystack" ref="nofollow noopener noreferrer">github.com/deepset-ai/…</a></li>
<li>🌟 Star：23.8K</li>
</ul>
<h3 data-id="heading-7">8. Open-AutoGLM</h3>
<p>一个开源的手机智能体模型和框架，用于构建移动设备自动化智能体。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a></li>
<li>🌟 Star：20.8K</li>
</ul>
<h3 data-id="heading-8">9. Vercel AI SDK</h3>
<p>来自 Next.js 创造者的 TypeScript 人工智能工具包，专为构建 AI 驱动的网络应用而设计。AI SDK 是一个 TypeScript 工具包，旨在帮助开发者使用 React、Next.js、Vue、Svelte、Node.js 等技术构建由人工智能驱动的应用程序和智能体。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fai" target="_blank" title="https://github.com/vercel/ai" ref="nofollow noopener noreferrer">github.com/vercel/ai</a></li>
<li>🌟 Star：20.6K</li>
</ul>
<h3 data-id="heading-9">10. Mastra</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59f099a5780e4b1aafa839e9f400b348~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768263886&amp;x-signature=2oZygGFKQXSSe7tXP6K9G7mpjPo%3D" alt="image.png" loading="lazy"/></p>
<p>Mastra 是一个用于使用现代化 TypeScript 技术栈构建 AI 驱动的应用程序和代理的框架。它包含了从早期原型到生产就绪应用程序所需的一切。Mastra 可以与前端和后端框架（如 React、Next.js 和 Node）集成，也可以作为独立服务器部署在任何地方。它是构建、调整和扩展可靠 AI 产品的最简便方式。</p>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmastra-ai%2Fmastra" target="_blank" title="https://github.com/mastra-ai/mastra" ref="nofollow noopener noreferrer">github.com/mastra-ai/m…</a></li>
<li>🌟 Star：19.1K</li>
</ul>
<h3 data-id="heading-10">总结</h3>
<p>在上述十大 AI Agent 框架中，Python 生态占据主导地位，其中八个基于 Python 开发。对于前端开发者而言，基于 TypeScript 的 Vercel AI SDK 和 Mastra 是更贴合技术栈的优质选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent 核心策略：如何判断 Agent 应该停止]]></title>    <link>https://juejin.cn/post/7592017365140308020</link>    <guid>https://juejin.cn/post/7592017365140308020</guid>    <pubDate>2026-01-06T00:32:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592017365140308020" data-draft-id="7591702898080759823" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent 核心策略：如何判断 Agent 应该停止"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-06T00:32:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潘锦"/> <meta itemprop="url" content="https://juejin.cn/user/730549110707431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent 核心策略：如何判断 Agent 应该停止
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/730549110707431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潘锦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:32:34.000Z" title="Tue Jan 06 2026 00:32:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>简单来讲，AI Agent 实现的的大逻辑就是一个大的循环 + 获取上下文 + 不停的 LLM 调用 + 工具的调用。</p>
<p>那么一个关键问题就出现了：这个循环什么时候应该停止？如果处理不当，Agent 可能会陷入无限循环，浪费计算资源，或者过早停止而无法完成任务。本文将深入探讨 AI Agent 停止策略的核心设计思路。</p>
<h2 data-id="heading-0">常用停止策略</h2>
<p>AI Agent 停止策略无外乎以下几种情况：</p>
<ol>
<li>硬性限制</li>
</ol>
<p>最简单粗暴的方法：</p>
<ul>
<li>最大步数限制（比如最多循环 30 次）</li>
<li>执行时间限制（比如最多跑 5 分钟）</li>
<li>API 调用次数限制（比如最多调 100 次）</li>
<li>API 调用 Token 数限制</li>
</ul>
<p>这种方法简单有效，但用户体验很差。经常出现任务做到一半被强制停止的情况。</p>
<ol start="2">
<li>任务完成检测</li>
</ol>
<p>让 LLM 判断任务是否完成：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 每次循环后问 LLM</span>
<span class="hljs-attr">response</span> = llm.ask(<span class="hljs-string">"任务是否已经完成？"</span>)
if <span class="hljs-attr">response</span> == <span class="hljs-string">"是"</span>:
    stop()
</code></pre>
<ol start="3">
<li>显式停止信号</li>
</ol>
<p>给 Agent 一个专门的"停止"工具：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tools</span> = [
    <span class="hljs-string">"search"</span>,
    <span class="hljs-string">"calculate"</span>, 
    <span class="hljs-string">"terminate"</span>  <span class="hljs-comment"># 专门用来停止</span>
]
</code></pre>
<p>当 Agent 调用 terminate 工具时就停止。这个方法不错，但需要在 prompt 里教会 Agent 什么时候该调用它。</p>
<ol start="4">
<li>循环检测</li>
</ol>
<p>检测 Agent 是否在做重复的事：</p>
<ul>
<li>连续多次调用同一个工具</li>
<li>动作序列出现循环模式（A→B→A→B...）</li>
<li>输出内容高度相似</li>
</ul>
<ol start="5">
<li>错误累积</li>
</ol>
<p>连续失败多次就放弃：</p>
<pre><code class="hljs language-css" lang="css">if consecutive_errors &gt; <span class="hljs-number">3</span>:
    <span class="hljs-built_in">stop</span>(<span class="hljs-string">"连续失败太多次"</span>)
</code></pre>
<ol start="6">
<li>用户中断</li>
</ol>
<p>让用户能随时喊停。</p>
<p>下面我们以 OpenManus 和 Gemini CLI 的源码来看一下他们是怎么做的。</p>
<h2 data-id="heading-1">OpenManus 的停止逻辑</h2>
<p>OpenManus 的停止机制设计得比较完整，它用了一个多层防护的思路。</p>
<h2 data-id="heading-2">核心：terminate 工具</h2>
<p>OpenManus 给每个 Agent 都配了一个 terminate 工具：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Terminate</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"terminate"</span>
    description = <span class="hljs-string">"""当请求已满足或无法继续时终止交互。
    完成所有任务后，调用此工具结束工作。"""</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self, status: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"交互已完成，状态：<span class="hljs-subst">{status}</span>"</span>
        
以上为示例，原始代码：
<span class="hljs-keyword">from</span> app.tool.base <span class="hljs-keyword">import</span> BaseTool


_TERMINATE_DESCRIPTION = <span class="hljs-string">"""Terminate the interaction when the request is met OR if the assistant cannot proceed further with the task.
When you have finished all the tasks, call this tool to end the work."""</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Terminate</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"terminate"</span>
    description: <span class="hljs-built_in">str</span> = _TERMINATE_DESCRIPTION
    parameters: <span class="hljs-built_in">dict</span> = {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
        <span class="hljs-string">"properties"</span>: {
            <span class="hljs-string">"status"</span>: {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
                <span class="hljs-string">"description"</span>: <span class="hljs-string">"The finish status of the interaction."</span>,
                <span class="hljs-string">"enum"</span>: [<span class="hljs-string">"success"</span>, <span class="hljs-string">"failure"</span>],
            }
        },
        <span class="hljs-string">"required"</span>: [<span class="hljs-string">"status"</span>],
    }

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self, status: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""Finish the current execution"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"The interaction has been completed with status: <span class="hljs-subst">{status}</span>"</span>
</code></pre>
<p>OpenManus 使用的是方案 3，把「何时停止」的决策权交给了 LLM。prompt 里会明确告诉 Agent：任务完成了就调用 terminate。</p>
<h2 data-id="heading-3">状态机管理</h2>
<p>OpenManus 用状态机来管理 Agent 的生命周期：</p>
<pre><code class="hljs language-ini" lang="ini">class AgentState(Enum):
    <span class="hljs-attr">IDLE</span> = <span class="hljs-string">"idle"</span>
    <span class="hljs-attr">RUNNING</span> = <span class="hljs-string">"running"</span>  
    <span class="hljs-attr">FINISHED</span> = <span class="hljs-string">"finished"</span>
    <span class="hljs-attr">ERROR</span> = <span class="hljs-string">"error"</span>
</code></pre>
<p>当检测到特殊工具（如 terminate）被调用时，会触发状态转换：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_handle_special_tool</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, result: <span class="hljs-type">Any</span></span>):
    <span class="hljs-keyword">if</span> name.lower() == <span class="hljs-string">"terminate"</span>:
        self.state = AgentState.FINISHED
        logger.info(<span class="hljs-string">"🏁 任务完成！"</span>)
</code></pre>
<h2 data-id="heading-4">步数限制</h2>
<p>不同类型的 Agent 有不同的步数上限：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ToolCallAgent: 30 步</span>
<span class="hljs-comment"># SWEAgent: 20 步</span>
<span class="hljs-comment"># PlanningFlow: 可配置</span>

<span class="hljs-keyword">while</span> self.current_step &lt; self.max_steps <span class="hljs-keyword">and</span> self.state != AgentState.FINISHED:
    self.current_step += <span class="hljs-number">1</span>
    <span class="hljs-keyword">await</span> self.step()

<span class="hljs-keyword">if</span> self.current_step &gt;= self.max_steps:
    results.append(<span class="hljs-string">f"达到最大步数限制 (<span class="hljs-subst">{self.max_steps}</span>)"</span>)
</code></pre>
<p>这是一个保底机制，防止 Agent 无限运行。</p>
<h2 data-id="heading-5">卡死检测</h2>
<p>OpenManus 还会检测 Agent 是否卡住了：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_stuck</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:
    <span class="hljs-comment"># 检查是否有重复的 assistant 消息</span>
    <span class="hljs-comment"># 如果最近的回复都一样，说明卡住了</span>
    recent_messages = self.get_recent_assistant_messages()
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(recent_messages)) == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<h2 data-id="heading-6">Planning Agent 的结束逻辑</h2>
<h3 data-id="heading-7">1. 计划完成的判断机制</h3>
<p>PlanningFlow 的结束判断并不是简单检查所有步骤是否完成：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在主执行循环中</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># 获取当前需要执行的步骤</span>
    self.current_step_index, step_info = <span class="hljs-keyword">await</span> self._get_current_step_info()
    
    <span class="hljs-comment"># 如果没有更多活跃步骤，则结束计划</span>
    <span class="hljs-keyword">if</span> self.current_step_index <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        result += <span class="hljs-keyword">await</span> self._finalize_plan()
        <span class="hljs-keyword">break</span>
</code></pre>
<h3 data-id="heading-8">2. 步骤状态检查逻辑</h3>
<p>_get_current_step_info() 方法负责判断是否还有未完成的步骤：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查找第一个非完成状态的步骤</span>
<span class="hljs-keyword">for</span> i, step <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(steps):
    <span class="hljs-keyword">if</span> i &gt;= <span class="hljs-built_in">len</span>(step_statuses):
        status = PlanStepStatus.NOT_STARTED.value
    <span class="hljs-keyword">else</span>:
        status = step_statuses[i]
    
    <span class="hljs-comment"># 如果步骤状态为活跃状态（未开始或进行中），返回该步骤</span>
    <span class="hljs-keyword">if</span> status <span class="hljs-keyword">in</span> PlanStepStatus.get_active_statuses():
        <span class="hljs-keyword">return</span> i, step_info

<span class="hljs-comment"># 如果没找到活跃步骤，返回 None</span>
<span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>
</code></pre>
<p>其中 get_active_statuses() 返回 ["not_started", "in_progress"]，意味着只有当所有步骤都是 "completed" 或 "blocked" 状态时，计划才会结束。</p>
<h3 data-id="heading-9">3. 计划结束处理</h3>
<p>当没有更多活跃步骤时，会调用 _finalize_plan() 方法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_finalize_plan</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""使用 LLM 生成计划完成总结"""</span>
    plan_text = <span class="hljs-keyword">await</span> self._get_plan_text()
    
    <span class="hljs-comment"># 使用 LLM 生成总结</span>
    system_message = Message.system_message(
        <span class="hljs-string">"You are a planning assistant. Your task is to summarize the completed plan."</span>
    )
    
    user_message = Message.user_message(
        <span class="hljs-string">f"The plan has been completed. Here is the final plan status:\n\n<span class="hljs-subst">{plan_text}</span>\n\nPlease provide a summary of what was accomplished and any final thoughts."</span>
    )
    
    response = <span class="hljs-keyword">await</span> self.llm.ask(messages=[user_message], system_msgs=[system_message])
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Plan completed:\n\n<span class="hljs-subst">{response}</span>"</span>
</code></pre>
<h2 data-id="heading-10">Gemini CLI 的停止逻辑</h2>
<p>Gemini CLI 的设计思路完全不同，它用了一个更优雅但也更复杂的方案。</p>
<h2 data-id="heading-11">subagent 的停止逻辑</h2>
<h3 data-id="heading-12">1. 达到最大轮次（MAX_TURNS）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.runConfig.max_turns &amp;&amp; turnCounter &gt;= <span class="hljs-keyword">this</span>.runConfig.max_turns) {
    <span class="hljs-keyword">this</span>.output.terminate_reason = SubagentTerminateMode.MAX_TURNS;
    <span class="hljs-keyword">break</span>;
}
</code></pre>
<p>这是最简单的保护机制，防止无限循环。</p>
<h3 data-id="heading-13">2. 执行超时（TIMEOUT）</h3>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">durationMin</span> = (Date.now() - startTime) / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span>)<span class="hljs-comment">;</span>
if (durationMin &gt;= this.runConfig.max_time_minutes) {
    <span class="hljs-attr">this.output.terminate_reason</span> = SubagentTerminateMode.TIMEOUT<span class="hljs-comment">;</span>
    break<span class="hljs-comment">;</span>
}
</code></pre>
<p>注意这里检查了两次超时：</p>
<ul>
<li>在调用 LLM 之前检查一次</li>
<li>在调用 LLM 之后又检查一次</li>
</ul>
<p>这是因为 LLM 调用可能很耗时，要确保不会超时太多。</p>
<h3 data-id="heading-14">3. 用户中断（通过 AbortSignal）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">if</span> (abortController.signal.aborted) <span class="hljs-keyword">return</span>;
</code></pre>
<p>这个检查出现在 stream 处理循环里，确保能及时响应用户的取消操作。</p>
<h3 data-id="heading-15">4. 错误异常（ERROR）</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">catch</span> (<span class="hljs-keyword">error</span>) {
    console.<span class="hljs-keyword">error</span>(<span class="hljs-comment">'Error during subagent execution:', error);</span>
    this.output.terminate_reason = SubagentTerminateMode.<span class="hljs-keyword">ERROR</span>;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">error</span>;
}
</code></pre>
<p>任何未捕获的异常都会导致停止。</p>
<h3 data-id="heading-16">5. 目标完成（GOAL）</h3>
<p>目标完成的判断分两种情况：</p>
<p>情况A：没有预定输出要求</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.outputConfig || Object.keys(<span class="hljs-keyword">this</span>.outputConfig.outputs).length === <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 没有要求特定输出，LLM 不调用工具就认为完成了</span>
    <span class="hljs-keyword">if</span> (functionCalls.length === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.output.terminate_reason = SubagentTerminateMode.GOAL;
        <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
<p>情况B：有预定输出要求</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 检查是否所有要求的变量都已输出</span>
<span class="hljs-keyword">const</span> remainingVars = Object.keys(<span class="hljs-keyword">this</span>.outputConfig.outputs).filter(
    (key) =&gt; !(key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.output.emitted_vars)
);

<span class="hljs-keyword">if</span> (remainingVars.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">this</span>.output.terminate_reason = SubagentTerminateMode.GOAL;
    <span class="hljs-keyword">break</span>;
}
</code></pre>
<h2 data-id="heading-17">声明式输出系统的实现</h2>
<p>声明式输出系统的核心是 outputConfig：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 预先声明需要什么输出</span>
<span class="hljs-keyword">this</span>.outputConfig = {
    outputs: {
        <span class="hljs-string">"summary"</span>: <span class="hljs-string">"string"</span>,
        <span class="hljs-string">"recommendations"</span>: <span class="hljs-string">"array"</span>, 
        <span class="hljs-string">"risk_score"</span>: <span class="hljs-string">"number"</span>
    }
};

<span class="hljs-comment">// Agent 通过 self.emitvalue 工具来产生输出</span>
<span class="hljs-comment">// 每次调用会把值存到 this.output.emitted_vars 里</span>
<span class="hljs-keyword">this</span>.output.emitted_vars = {
    <span class="hljs-string">"summary"</span>: <span class="hljs-string">"这是总结..."</span>,
    <span class="hljs-string">"recommendations"</span>: [<span class="hljs-string">"建议1"</span>, <span class="hljs-string">"建议2"</span>]
    <span class="hljs-comment">// risk_score 还没输出</span>
};
</code></pre>
<p>系统会不断检查 emitted_vars 是否包含了所有 outputs 中声明的变量。只有全部输出了才认为目标完成。</p>
<h2 data-id="heading-18">Nudge 机制</h2>
<p>Nudge（轻推）机制代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (functionCalls.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {  <span class="hljs-comment">// LLM 停止调用工具了</span>
    <span class="hljs-comment">// 检查是否还有变量没输出</span>
    <span class="hljs-keyword">const</span> remainingVars = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outputConfig</span>.<span class="hljs-property">outputs</span>).<span class="hljs-title function_">filter</span>(
        <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> !(key <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">output</span>.<span class="hljs-property">emitted_vars</span>)
    );
    
    <span class="hljs-keyword">if</span> (remainingVars.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 还有变量没输出，"推"它一下</span>
        <span class="hljs-keyword">const</span> nudgeMessage = <span class="hljs-string">`You have stopped calling tools but have not emitted 
        the following required variables: <span class="hljs-subst">${remainingVars.join(<span class="hljs-string">', '</span>)}</span>. 
        Please use the 'self.emitvalue' tool to emit them now, 
        or continue working if necessary.`</span>;
        
        <span class="hljs-comment">// 把提醒作为新的用户消息发给 LLM</span>
        currentMessages = [{
            <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
            <span class="hljs-attr">parts</span>: [{ <span class="hljs-attr">text</span>: nudgeMessage }]
        }];
        
        <span class="hljs-comment">// 继续循环，不退出</span>
    }
}
</code></pre>
<h2 data-id="heading-19">完整的 subagent 执行流程</h2>
<pre><code class="hljs language-arduino" lang="arduino">开始
  ↓
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  检查是否超时/超轮次 → 是 → 退出
    ↓ 否
  调用 LLM
    ↓
  LLM 返回工具调用？
    ├─ 是 → 执行工具 → 检查目标是否完成
    │         ├─ 是 → 退出
    │         └─ 否 → 继续循环
    │
    └─ 否（LLM 停止调用工具）
         ↓
       有预定输出要求吗？
         ├─ 没有 → 退出（认为完成）
         └─ 有 → 检查是否都输出了
                   ├─ 是 → 退出
                   └─ 否 → Nudge 提醒 → 继续循环
}
</code></pre>
<h2 data-id="heading-20">三层循环检测机制</h2>
<h3 data-id="heading-21">第一层：工具调用重复检测</h3>
<p>这是最简单直接的检测，针对 Agent 反复调用相同工具的情况。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> checkToolCallLoop(toolCall: { name: string; args: <span class="hljs-keyword">object</span> }): boolean {
    <span class="hljs-comment">// 把工具名和参数一起哈希，生成唯一标识</span>
    <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">this</span>.getToolCallKey(toolCall);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lastToolCallKey === key) {
        <span class="hljs-comment">// 和上次调用完全一样，计数+1</span>
        <span class="hljs-keyword">this</span>.toolCallRepetitionCount++;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 不一样，重置计数</span>
        <span class="hljs-keyword">this</span>.lastToolCallKey = key;
        <span class="hljs-keyword">this</span>.toolCallRepetitionCount = <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">// 连续5次调用相同工具+相同参数 = 循环</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.toolCallRepetitionCount &gt;= TOOL_CALL_LOOP_THRESHOLD) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>触发条件：连续 5 次调用完全相同的工具（包括参数）。</p>
<p>这种检测很严格——必须是连续的、完全相同的调用。如果中间插入了其他工具调用，计数就会重置。</p>
<h3 data-id="heading-22">第二层：内容重复检测（"咒语"检测）</h3>
<p>这是最复杂的部分，用来检测 LLM 输出重复内容的情况，就像在念咒语一样。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> checkContentLoop(content: string): boolean {
    <span class="hljs-comment">// 1. 先检查是否在特殊内容块中（代码块、表格、列表等）</span>
    <span class="hljs-keyword">const</span> numFences = (content.match(/```/g) ?? []).length;
    <span class="hljs-keyword">const</span> hasTable = /(^|\n)\s*(|.*||[|+-]{<span class="hljs-number">3</span>,})/.test(content);
    <span class="hljs-comment">// ... 检查各种格式</span>
    
    <span class="hljs-comment">// 在代码块中不检测循环（代码本来就可能有重复）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.inCodeBlock) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. 把新内容加入历史</span>
    <span class="hljs-keyword">this</span>.streamContentHistory += content;
    
    <span class="hljs-comment">// 3. 保持历史在 1000 字符以内</span>
    <span class="hljs-keyword">this</span>.truncateAndUpdate();
    
    <span class="hljs-comment">// 4. 分析内容块是否重复</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.analyzeContentChunksForLoop();
}
</code></pre>
<p>核心算法是滑动窗口 + 哈希检测：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> analyzeContentChunksForLoop(): boolean {
    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.hasMoreChunksToProcess()) {
        <span class="hljs-comment">// 提取 50 字符的块</span>
        <span class="hljs-keyword">const</span> currentChunk = <span class="hljs-keyword">this</span>.streamContentHistory.substring(
            <span class="hljs-keyword">this</span>.lastContentIndex,
            <span class="hljs-keyword">this</span>.lastContentIndex + CONTENT_CHUNK_SIZE  <span class="hljs-comment">// 50</span>
        );
        
        <span class="hljs-comment">// 计算哈希</span>
        <span class="hljs-keyword">const</span> chunkHash = createHash(<span class="hljs-string">'sha256'</span>).update(currentChunk).digest(<span class="hljs-string">'hex'</span>);
        
        <span class="hljs-comment">// 检查这个块是否重复出现</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isLoopDetectedForChunk(currentChunk, chunkHash)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-comment">// 滑动窗口向前移动 1 个字符</span>
        <span class="hljs-keyword">this</span>.lastContentIndex++;
    }
}
</code></pre>
<p>判断循环的条件：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> isLoopDetectedForChunk(chunk: string, hash: string): boolean {
    <span class="hljs-keyword">const</span> existingIndices = <span class="hljs-keyword">this</span>.contentStats.<span class="hljs-keyword">get</span>(hash);
    
    <span class="hljs-keyword">if</span> (!existingIndices) {
        <span class="hljs-comment">// 第一次见到这个块，记录位置</span>
        <span class="hljs-keyword">this</span>.contentStats.<span class="hljs-keyword">set</span>(hash, [<span class="hljs-keyword">this</span>.lastContentIndex]);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 验证内容确实相同（防止哈希碰撞）</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isActualContentMatch(chunk, existingIndices[<span class="hljs-number">0</span>])) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    existingIndices.push(<span class="hljs-keyword">this</span>.lastContentIndex);
    
    <span class="hljs-comment">// 需要出现至少 10 次</span>
    <span class="hljs-keyword">if</span> (existingIndices.length &lt; CONTENT_LOOP_THRESHOLD) {  <span class="hljs-comment">// 10</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 关键：这 10 次必须距离很近（平均距离 ≤ 75 字符）</span>
    <span class="hljs-keyword">const</span> recentIndices = existingIndices.slice(-CONTENT_LOOP_THRESHOLD);
    <span class="hljs-keyword">const</span> totalDistance = recentIndices[recentIndices.length - <span class="hljs-number">1</span>] - recentIndices[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> averageDistance = totalDistance / (CONTENT_LOOP_THRESHOLD - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> maxAllowedDistance = CONTENT_CHUNK_SIZE * <span class="hljs-number">1.5</span>;  <span class="hljs-comment">// 75</span>
    
    <span class="hljs-keyword">return</span> averageDistance &lt;= maxAllowedDistance;
}
</code></pre>
<p>触发条件：同一个 50 字符的内容块，在很短的距离内重复出现 10 次。</p>
<h3 data-id="heading-23">第三层：LLM 智能检测</h3>
<p>这是最高级的检测，用 AI 来判断 AI 是否陷入循环。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">private</span> async <span class="hljs-title function_ invoke__">checkForLoopWithLLM</span>(<span class="hljs-attr">signal</span>: AbortSignal) {
    <span class="hljs-comment">// 取最近 20 轮对话</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">recentHistory</span> = this.config
        .<span class="hljs-title function_ invoke__">getGeminiClient</span>()
        .<span class="hljs-title function_ invoke__">getHistory</span>()
        .<span class="hljs-title function_ invoke__">slice</span>(-LLM_LOOP_CHECK_HISTORY_COUNT);  <span class="hljs-comment">// 20</span>
    
    <span class="hljs-comment">// 清理历史（去掉悬空的函数调用等）</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">trimmedHistory</span> = this.<span class="hljs-title function_ invoke__">trimRecentHistory</span>(recentHistory);
    
    <span class="hljs-comment">// 让 Gemini Flash 模型分析</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">result</span> = await this.config.<span class="hljs-title function_ invoke__">getBaseLlmClient</span>().<span class="hljs-title function_ invoke__">generateJson</span>({
        <span class="hljs-attr">contents</span>: [...trimmedHistory, { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">parts</span>: [{ <span class="hljs-attr">text</span>: taskPrompt }] }],
        <span class="hljs-attr">schema</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-attr">properties</span>: {
                <span class="hljs-attr">reasoning</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span> },
                <span class="hljs-attr">confidence</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span> }  // <span class="hljs-number">0</span>-<span class="hljs-number">1</span> 之间
            }
        },
        <span class="hljs-attr">model</span>: DEFAULT_GEMINI_FLASH_MODEL,
        <span class="hljs-attr">systemInstruction</span>: LOOP_DETECTION_SYSTEM_PROMPT
    });
    
    <span class="hljs-keyword">if</span> (result[<span class="hljs-string">'confidence'</span>] &gt; <span class="hljs-number">0.9</span>) {
        <span class="hljs-comment">// 高置信度认为是循环</span>
        console.<span class="hljs-title function_ invoke__">warn</span>(result[<span class="hljs-string">'reasoning'</span>]);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>触发时机：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">async turnStarted(signal: AbortSignal) {
    <span class="hljs-keyword">this</span>.turnsInCurrentPrompt++;
    
    <span class="hljs-keyword">if</span> (
        <span class="hljs-keyword">this</span>.turnsInCurrentPrompt &gt;= LLM_CHECK_AFTER_TURNS &amp;&amp;  <span class="hljs-comment">// 至少 30 轮</span>
        <span class="hljs-keyword">this</span>.turnsInCurrentPrompt - <span class="hljs-keyword">this</span>.lastCheckTurn &gt;= <span class="hljs-keyword">this</span>.llmCheckInterval
    ) {
        <span class="hljs-keyword">this</span>.lastCheckTurn = <span class="hljs-keyword">this</span>.turnsInCurrentPrompt;
        <span class="hljs-keyword">return</span> await <span class="hljs-keyword">this</span>.checkForLoopWithLLM(signal);
    }
}
</code></pre>
<ul>
<li>必须执行超过 30 轮才开始检查（避免误判）</li>
<li>不是每轮都检查，有间隔（默认 3 轮）</li>
<li>间隔会根据置信度动态调整（5-15 轮）</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 动态调整检查频率</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">llmCheckInterval</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(
    <span class="hljs-variable constant_">MIN_LLM_CHECK_INTERVAL</span> +  <span class="hljs-comment">// 5</span>
    (<span class="hljs-variable constant_">MAX_LLM_CHECK_INTERVAL</span> - <span class="hljs-variable constant_">MIN_LLM_CHECK_INTERVAL</span>) * (<span class="hljs-number">1</span> - result[<span class="hljs-string">'confidence'</span>])
    <span class="hljs-comment">// 置信度越高，检查越频繁</span>
);
</code></pre>
<h2 data-id="heading-24">三种循环类型</h2>
<p>系统定义了三种循环类型：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">LoopType</span> {
    CONSECUTIVE_IDENTICAL_TOOL_CALLS,  <span class="hljs-comment">// 连续相同工具调用</span>
    CHANTING_IDENTICAL_SENTENCES,      <span class="hljs-comment">// 重复输出相同内容</span>
    LLM_DETECTED_LOOP                  <span class="hljs-comment">// LLM 检测到的逻辑循环</span>
}
</code></pre>
<p>每种都有不同的检测方法和触发条件。</p>
<p>这比较适合处理长对话场景，既能有效检测循环，又不会因为过于敏感而误判正常的迭代操作。</p>
<h2 data-id="heading-25">小结</h2>
<p>AI Agent 的停止策略是一个容易被忽视但极其重要的技术问题。从原理上看，Agent 就是一个大循环，不断调用 LLM 和工具来完成任务，但如果没有合理的停止机制，就会出现无限循环浪费资源，或者过早停止无法完成任务的问题。常见的停止方案包括硬性限制（步数、时间、API调用次数）、任务完成检测、显式停止信号、循环检测、错误累积和用户中断等，实际应用中需要组合使用多种策略。</p>
<p>OpenManus 采用了相对简单直接的设计：给每个 Agent 配备 terminate 工具，让 LLM 自己决定何时停止，同时用状态机管理生命周期，配合步数限制作为保底，并确保无论如何停止都会正确清理资源。</p>
<p>而 Gemini CLI 的设计更加精巧，核心是声明式输出系统——预先定义需要什么输出，只有全部输出才算完成，如果 Agent 停止调用工具但还有变量未输出，系统会通过 Nudge 机制温和提醒；在循环检测上，Gemini 实现了三层防护：工具调用重复检测（连续5次相同调用）、内容重复检测（滑动窗口+哈希算法检测"咒语"现象）、以及用 LLM 分析对话历史判断是否陷入逻辑循环。</p>
<p>实践中的关键是不要依赖单一停止机制，要组合使用多种策略形成多层防护，给 LLM 明确的停止指引，为不同类型的停止原因提供清晰的用户反馈，并确保资源能够可靠清理。停止策略的本质是在"让 Agent 完成任务"和"防止失控"之间找到平衡点。</p>
<p>以上。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[⏰前端周刊第447期（2025年12月28日–2026年1月3日）～新年好～]]></title>    <link>https://juejin.cn/post/7591703562134519842</link>    <guid>https://juejin.cn/post/7591703562134519842</guid>    <pubDate>2026-01-06T00:34:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591703562134519842" data-draft-id="7591703562134503458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="⏰前端周刊第447期（2025年12月28日–2026年1月3日）～新年好～"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-06T00:34:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ⏰前端周刊第447期（2025年12月28日–2026年1月3日）～新年好～
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:34:50.000Z" title="Tue Jan 06 2026 00:34:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>📢 <strong>宣言</strong>：<strong>每周更新国外论坛的前端热门文章，推荐大家阅读/翻译，紧跟时事，掌握前端技术动态，也为写作或突破新领域提供灵感~</strong></p>
<p>欢迎大家访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">github.com/TUARAN/fron…</a>
顺手点个 ⭐ star 支持，是我们持续输出的续航电池🔋✨！</p>
<p>在线网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffwdc.pages.dev%2F" target="_blank" title="https://fwdc.pages.dev/" ref="nofollow noopener noreferrer">fwdc.pages.dev/</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2506018f41948a6b94a2c8b3fb0d5d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768264490&amp;x-signature=81FACm2ZdQLtYOM5y6ZjtMVaKys%3D" alt="前端周刊封面" loading="lazy"/></p>
<hr/>
<p>💬 <strong>推荐语</strong></p>
<p>新年第一期更偏“趋势 + 实操 + 工程卫生”。</p>
<p>Web 开发部分从 2026 年趋势、Astro 月度更新与 HTML5 文档大纲的历史终章出发，同时复盘 React2Shell 安全漏洞的来龙去脉，并讨论分页是否该跳转新页面与 Hotwire 这类“HTML 驱动交互”的路线。工具与性能栏目聚焦更轻量的 Lint 体验、常用 DevTools 能力与性能排查方法论（含对“浅会话”SPA、第三方单点故障等问题的反思）；最后在 Web Components、CSS 与各框架生态（Svelte/React/Angular/TypeScript）里补齐组件化与类型安全的最新实践。</p>
<hr/>
<h2 data-id="heading-0">🗂 本期精选目录</h2>
<h3 data-id="heading-1">🧭 Web 开发</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2F8-trends-web-dev-2026%2F" target="_blank" title="https://blog.logrocket.com/8-trends-web-dev-2026/" ref="nofollow noopener noreferrer">The 8 trends that will define web development in 2026</a>：总结 2026 年可能主导 Web 开发方向的 8 个趋势，用于技术选型与团队规划参考。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fastro.build%2Fblog%2Fwhats-new-december-2025%2F" target="_blank" title="https://astro.build/blog/whats-new-december-2025/" ref="nofollow noopener noreferrer">What’s new in Astro — December 2025</a>：Astro 2025 年 12 月更新速览：新特性、改进与生态动态。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tempertemper.net%2Fblog%2Fthe-final-nail-in-the-html5-document-outline-coffin" target="_blank" title="https://www.tempertemper.net/blog/the-final-nail-in-the-html5-document-outline-coffin" ref="nofollow noopener noreferrer">The final nail in the HTML5 document outline coffin</a>：回顾并确认 HTML5 文档大纲（outline）机制的“最后一钉”，澄清围绕标题层级与语义结构的误解。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.csoonline.com%2Farticle%2F4111888%2Freact2shell-anatomy-of-a-max-severity-flaw-that-sent-shockwaves-through-the-web.html" target="_blank" title="https://www.csoonline.com/article/4111888/react2shell-anatomy-of-a-max-severity-flaw-that-sent-shockwaves-through-the-web.html" ref="nofollow noopener noreferrer">React2Shell: Anatomy of a max-severity flaw that sent shockwaves through the web</a>：拆解 React2Shell 这类高危漏洞的成因、影响面与修复要点，帮助理解供应链/框架级风险。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tempertemper.net%2Fblog%2Fshould-pagination-take-you-to-a-new-page" target="_blank" title="https://www.tempertemper.net/blog/should-pagination-take-you-to-a-new-page" ref="nofollow noopener noreferrer">Should pagination take you to a new page?</a>：讨论分页交互到底该“换页”还是“局部更新”，从可用性、可访问性与预期一致性出发给出权衡。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoworld.com%2Farticle%2F4100499%2Fintro-to-hotwire-interactive-javascript-built-from-html.html" target="_blank" title="https://www.infoworld.com/article/4100499/intro-to-hotwire-interactive-javascript-built-from-html.html" ref="nofollow noopener noreferrer">Intro to Hotwire: HTMX alternative for developing supercharged, responsive web applications.</a>：Hotwire 入门：以 HTML 为中心构建交互式应用的另一条路线，作为 HTMX 的备选/对照思路。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftympanus.net%2Fcodrops%2F2026%2F01%2F04%2Fefecto-building-real-time-ascii-and-dithering-effects-with-webgl-shaders%2F" target="_blank" title="https://tympanus.net/codrops/2026/01/04/efecto-building-real-time-ascii-and-dithering-effects-with-webgl-shaders/" ref="nofollow noopener noreferrer">Efecto: Building Real-Time ASCII and Dithering Effects with WebGL Shaders</a>：用 WebGL Shader 实时实现 ASCII 与抖动（dithering）视觉效果的完整拆解与实现路径。</li>
</ul>
<h4 data-id="heading-2">🛠 工具</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.flint.fyi%2Fblog%2Fintroducing-flint%2F" target="_blank" title="https://www.flint.fyi/blog/introducing-flint/" ref="nofollow noopener noreferrer">Introducing Flint — A fast, friendly linter for JavaScript, TypeScript, and more.</a>：Flint 代码检查器介绍：主打更快、更友好的 lint 体验，覆盖 JS/TS 等多语言场景。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcalendar.perfplanet.com%2F2025%2Fchrome-devtools-all-the-time%2F" target="_blank" title="https://calendar.perfplanet.com/2025/chrome-devtools-all-the-time/" ref="nofollow noopener noreferrer">Chrome DevTools Features I Use All the Time (and Why You Should Too)</a>：作者常用的 DevTools 功能清单与使用理由，适合查漏补缺提升调试效率。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.blog%2F2025%2F12%2F30%2Fa-new-era-of-stack-overflow%2F" target="_blank" title="https://stackoverflow.blog/2025/12/30/a-new-era-of-stack-overflow/" ref="nofollow noopener noreferrer">A new era of Stack Overflow</a>：Stack Overflow 的新阶段与产品方向变化，面向开发者社区生态的观察。</li>
</ul>
<h4 data-id="heading-3">⚡ 性能</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcalendar.perfplanet.com%2F2025%2Fthe-curious-case-of-the-shallow-session-spas%2F" target="_blank" title="https://calendar.perfplanet.com/2025/the-curious-case-of-the-shallow-session-spas/" ref="nofollow noopener noreferrer">The Curious Case of the Shallow Session SPAs</a>：分析“浅会话”SPA 的典型表现与潜在代价，反思留存、性能与体验之间的取舍。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcalendar.perfplanet.com%2F2025%2Fteaching-agents-about-performance-insights%2F" target="_blank" title="https://calendar.perfplanet.com/2025/teaching-agents-about-performance-insights/" ref="nofollow noopener noreferrer">Teaching Agents about Performance insights</a>：探讨如何把性能洞察与排查经验传递给 AI/Agent，让自动化分析更可靠、可复用。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcalendar.perfplanet.com%2F2025%2Fthird-parties-and-single-points-of-failure%2F" target="_blank" title="https://calendar.perfplanet.com/2025/third-parties-and-single-points-of-failure/" ref="nofollow noopener noreferrer">Third Parties and Single Points of Failure</a>：第三方依赖如何形成单点故障（SPOF），以及在架构与监控层面的缓解策略。</li>
</ul>
<h4 data-id="heading-4">🧩 Web Components</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aaron-gustafson.com%2Fnotebook%2Fa-web-component-starter-template%2F" target="_blank" title="https://www.aaron-gustafson.com/notebook/a-web-component-starter-template/" ref="nofollow noopener noreferrer">A Production-Ready Web Component Starter Template</a>：一个更贴近生产环境的 Web Component 脚手架/模板，覆盖工程化与发布所需的基础要素。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aaron-gustafson.com%2Fnotebook%2Ffullscreen-video-and-iframes-made-easy%2F" target="_blank" title="https://www.aaron-gustafson.com/notebook/fullscreen-video-and-iframes-made-easy/" ref="nofollow noopener noreferrer">Fullscreen Video and Iframes Made Easy with Web Component</a>：用 Web Component 封装全屏视频与 iframe 的常见交互与兼容细节，降低集成成本。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendmasters.com%2Fblog%2Fcustom-elements-with-lit-html%2F" target="_blank" title="https://frontendmasters.com/blog/custom-elements-with-lit-html/" ref="nofollow noopener noreferrer">How I Write Custom Elements with lit-html</a>：用 lit-html 编写自定义元素的实践路线：模板渲染、状态更新与组件组织方式。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fheydonworks.com%2Farticle%2Fdynamically-loading-custom-elements%2F" target="_blank" title="https://heydonworks.com/article/dynamically-loading-custom-elements/" ref="nofollow noopener noreferrer">How To Dynamically Install Custom Elements</a>：动态加载/注册 Custom Elements 的方法与注意事项，兼顾性能与渐进增强。</li>
</ul>
<h3 data-id="heading-5">🎨 CSS</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendmasters.com%2Fblog%2Fimportant-and-css-custom-properties%2F" target="_blank" title="https://frontendmasters.com/blog/important-and-css-custom-properties/" ref="nofollow noopener noreferrer">!important and CSS Custom Properties</a>：讨论 <code>!important</code> 与 CSS 自定义属性（变量）结合时的层叠与覆盖策略，避免样式失控。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffractaledmind.com%2F2026%2F01%2F02%2Fwriting-tailwind-compatible-semantic-css%2F" target="_blank" title="https://fractaledmind.com/2026/01/02/writing-tailwind-compatible-semantic-css/" ref="nofollow noopener noreferrer">Writing Tailwind-compatible Semantic CSS</a>：如何写“语义化但又兼容 Tailwind”的 CSS：在工具类与语义层之间找到可维护的平衡。</li>
</ul>
<h3 data-id="heading-6">💡 JavaScript</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fwhy-developers-are-ditching-frameworks-for-vanilla-javascript%2F" target="_blank" title="https://thenewstack.io/why-developers-are-ditching-frameworks-for-vanilla-javascript/" ref="nofollow noopener noreferrer">Why Developers Are Ditching Frameworks for Vanilla JavaScript</a>：为什么有些团队在回归原生 JS：从复杂度、性能、长期维护与依赖风险角度讨论。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsvelte.dev%2Fblog%2Fwhats-new-in-svelte-january-2026" target="_blank" title="https://svelte.dev/blog/whats-new-in-svelte-january-2026" ref="nofollow noopener noreferrer">What’s new in Svelte: January 2026</a>：Svelte 2026 年 1 月更新汇总：新能力与生态进展速览。</li>
</ul>
<h4 data-id="heading-7">🧷 TypeScript</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhackers.pub%2F%40hongminhee%2F2026%2Ftypescript-sync-async-type-safety" target="_blank" title="https://hackers.pub/@hongminhee/2026/typescript-sync-async-type-safety" ref="nofollow noopener noreferrer">Designing type-safe sync/async mode support in TypeScript</a>：在 TS 中设计同时支持同步/异步模式的类型安全 API：约束、推断与调用体验的权衡。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftkdodo.eu%2Fblog%2Fbuilding-type-safe-compound-components" target="_blank" title="https://tkdodo.eu/blog/building-type-safe-compound-components" ref="nofollow noopener noreferrer">Building Type-Safe Compound Components</a>：构建类型安全的 Compound Components（组合组件）模式：让组合 API 更易用、更不易写错。</li>
</ul>
<h4 data-id="heading-8">⚛️ React</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhackyourmom.com%2Fen%2Fnovyny%2Fbotnet-rondodox-ekspluatuye-vrazlyvist-react2shell-dlya-zlamu-serveriv-next-js%2F" target="_blank" title="https://hackyourmom.com/en/novyny/botnet-rondodox-ekspluatuye-vrazlyvist-react2shell-dlya-zlamu-serveriv-next-js/" ref="nofollow noopener noreferrer">RondoDox botnet exploits React2Shell flaw to breach Next.js servers</a>：React2Shell 被用于攻击 Next.js 服务的案例报道，提醒及时修复与加强防护。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjsdev.space%2Freact-form-primitives%2F" target="_blank" title="https://jsdev.space/react-form-primitives/" ref="nofollow noopener noreferrer">Designing Predictable and Maintainable Forms in React</a>：用“表单原语”的思路设计可预测、可维护的 React 表单：状态边界、校验与可复用结构。</li>
</ul>
<h4 data-id="heading-9">🅰️ Angular</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.telerik.com%2Fblogs%2Fdata-fetching-modern-angular" target="_blank" title="https://www.telerik.com/blogs/data-fetching-modern-angular" ref="nofollow noopener noreferrer">Data Fetching in Modern Angular</a>：现代 Angular 的数据获取实践：常见方案与在工程中落地时的注意点。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fthis-is-angular%2Fng-news-angular-in-2025-307a" target="_blank" title="https://dev.to/this-is-angular/ng-news-angular-in-2025-307a" ref="nofollow noopener noreferrer">Ng-News: Angular in 2025</a>：回顾 2025 年 Angular 的关键变化与生态动态，帮助快速补齐近况。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学生图书馆管理系统第二弹]]></title>    <link>https://juejin.cn/post/7591719013489524774</link>    <guid>https://juejin.cn/post/7591719013489524774</guid>    <pubDate>2026-01-06T00:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591719013489524774" data-draft-id="7591708519449870345" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学生图书馆管理系统第二弹"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-06T00:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃马铃薯长大的土豆"/> <meta itemprop="url" content="https://juejin.cn/user/1162661349831369"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学生图书馆管理系统第二弹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1162661349831369/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃马铃薯长大的土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:38:45.000Z" title="Tue Jan 06 2026 00:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一篇纯分享代码的文章（纯展示），文章的开头先说明一下本文章的代码来源于B站博主，更详细的请去B站观看</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a3ece4c8fe74f7fb392a0e843a21f25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCD6ams6ZOD6Jav6ZW_5aSn55qE5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768264725&amp;x-signature=T16gLC3o9N%2BXTU6dBUhd4L2pt78%3D" alt="屏幕截图 2026-01-05 154859.png" loading="lazy"/>
首先展示一下主播建的文件夹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/702e7ec432e94d458b7b16574e0fab1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCD6ams6ZOD6Jav6ZW_5aSn55qE5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768264725&amp;x-signature=qs8JLCDoEvKE16uwF7zvmb%2B7fuY%3D" alt="屏幕截图 2026-01-06 082112.png" loading="lazy"/></p>
<p>没错主播为了写这个建立了三个文件夹，至于原因请参考上一篇文章。（在这里说一下请大家观看视频的时候尽量和B站的博主写的一样不要加入自己的小巧思）好了下面就是代码展示</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94c18eac54e2426e8e8c7ee0b593cf7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCD6ams6ZOD6Jav6ZW_5aSn55qE5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768264725&amp;x-signature=uzC6f6He2erWO4XwZocBG1iO8%2Bc%3D" alt="屏幕截图 2026-01-06 083324.png" loading="lazy"/></p>
<pre><code class="hljs">fan,123,普通用户
admin,123,管理员
chen,123,普通用户
TEST,123,普通用户
fain,123,普通用户
</code></pre>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1</span>,心灵漏洞指南,老卡,<span class="hljs-literal">true</span>
<span class="hljs-number">2</span>,乌托邦说明书,帕拉图,<span class="hljs-literal">true</span>
<span class="hljs-number">3</span>,火星人成长日记,艾工,<span class="hljs-literal">true</span>
<span class="hljs-number">4</span>,大胡子文豪外史,林老师,<span class="hljs-literal">true</span>
<span class="hljs-number">5</span>,奶奶的回忆录像带,杨奶奶,<span class="hljs-literal">true</span>
<span class="hljs-number">6</span>,清代职场达人笔记,张史官,<span class="hljs-literal">true</span>
<span class="hljs-number">7</span>,心学使用手册,山叔,<span class="hljs-literal">true</span>
<span class="hljs-number">8</span>,晚年打怪日志,戴奶奶,<span class="hljs-literal">true</span>
<span class="hljs-number">9</span>,飞出山谷备忘录,塔拉,<span class="hljs-literal">true</span>
<span class="hljs-number">10</span>,红猫时代的幕后笔记,傅教授,<span class="hljs-literal">true</span>
<span class="hljs-number">11</span>,心灵漏洞指南,老卡,<span class="hljs-literal">true</span>
</code></pre>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">fan,1,心灵漏洞指南,2026-01-03T20:24:24.926523400,2026-01-03T21:31:44.418616</span>
</code></pre>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> org.app

<span class="hljs-keyword">import</span> org.app.models.{BookModel, UserModel}
<span class="hljs-keyword">import</span> org.app.service.{BookService, UserService}

<span class="hljs-keyword">import</span> scala.io.StdIn
<span class="hljs-keyword">import</span> scala.io.StdIn.readLine

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LibrarayPresentation</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-type">val</span> <span class="hljs-variable">BookService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BookService</span>()
  <span class="hljs-keyword">private</span> <span class="hljs-type">val</span> <span class="hljs-variable">UserService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>()

  <span class="hljs-comment">// 辅助方法，输入图书的信息，返回一个BookModel对象</span>
  <span class="hljs-keyword">private</span> def <span class="hljs-title function_">inputBookInfo</span><span class="hljs-params">()</span>: BookModel = {
    println(<span class="hljs-string">"请输入图书的名称:"</span>)
    <span class="hljs-type">val</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> readLine().trim
    <span class="hljs-title function_">println</span><span class="hljs-params">(<span class="hljs-string">"请输入图书的作者:"</span>)</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> readLine().trim
    <span class="hljs-title function_">println</span><span class="hljs-params">(<span class="hljs-string">"请输入图书是否可以外接（true/false）:"</span>)</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> StdIn.readBoolean()
    <span class="hljs-comment">// 初始设置编号为0</span>
    BookModel(<span class="hljs-number">0</span>, name, author, available)
  }
  <span class="hljs-comment">// 显示游客的菜单</span>
  def <span class="hljs-title function_">showVisitorMenu</span><span class="hljs-params">()</span>: Unit = {
    <span class="hljs-type">var</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    <span class="hljs-title function_">while</span> <span class="hljs-params">(running)</span> {
      println(<span class="hljs-string">"欢迎来到我的图书管理系统，请选择"</span>)
      println(<span class="hljs-string">"1. 查看所有图书"</span>)
      println(<span class="hljs-string">"2. 查询图书"</span>)
      println(<span class="hljs-string">"3. 登录"</span>)
      println(<span class="hljs-string">"4. 离开"</span>)

      <span class="hljs-comment">// 获取用户的操作</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> StdIn.readLine().trim
      choice match {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"1"</span> =&gt;
          <span class="hljs-comment">// TODO 查看所有图书</span>
          <span class="hljs-comment">// 调用业务逻辑层的方法</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">results</span> <span class="hljs-operator">=</span> BookService.searchBooks(<span class="hljs-string">""</span>)
          <span class="hljs-keyword">if</span>(results.nonEmpty){
            results.foreach(println)
          } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"没有找到图书"</span>)
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"2"</span> =&gt;
        <span class="hljs-comment">// 提示用户输入查询关键字</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> readLine(<span class="hljs-string">"请输入查询关键字(书名, 作者):"</span>).trim
          <span class="hljs-comment">// 根据关键字去查询图书列表，找到满足条件的书</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">results</span> <span class="hljs-operator">=</span> BookService.searchBooks(query)
          <span class="hljs-comment">// 显示出来</span>
          <span class="hljs-keyword">if</span>(results.nonEmpty){
            println(<span class="hljs-string">"======查询图书的结果======="</span>)
            results.foreach(println)
          } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"没有找到图书"</span>)
          }

        <span class="hljs-keyword">case</span> <span class="hljs-string">"3"</span> =&gt;
          println(<span class="hljs-string">"请输入用户名: "</span>)
          <span class="hljs-type">val</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> StdIn.readLine().trim
          <span class="hljs-title function_">println</span><span class="hljs-params">(<span class="hljs-string">"请输入密码: "</span>)</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> StdIn.readLine().trim
          <span class="hljs-comment">// 调用Service的方法，进行登录</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">userOpt</span> <span class="hljs-operator">=</span> UserService.authenticateUser(username, password)
          <span class="hljs-keyword">if</span>(userOpt.isEmpty){
            println(<span class="hljs-string">"用户名或密码错误"</span>)
          } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"登录成功"</span>)
            <span class="hljs-comment">// 登录成功，显示登录用户的菜单</span>
            <span class="hljs-type">val</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userOpt.get
            user.role match {
              <span class="hljs-keyword">case</span> <span class="hljs-string">"管理员"</span> =&gt; showAdminMenu(user)
              <span class="hljs-keyword">case</span> <span class="hljs-string">"普通用户"</span> =&gt; showUserMenu(user)
            }
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"4"</span> =&gt;
          running = <span class="hljs-literal">false</span>
          <span class="hljs-title function_">println</span><span class="hljs-params">(<span class="hljs-string">"感谢你的使用, 下次再见"</span>)</span>
        <span class="hljs-type">case</span> <span class="hljs-variable">_</span> <span class="hljs-operator">=</span>&gt; println(<span class="hljs-string">"无效的选择"</span>)
      }
    }
  }

  <span class="hljs-comment">// 显示管理员的菜单</span>
  def <span class="hljs-title function_">showAdminMenu</span><span class="hljs-params">(user:UserModel)</span>: Unit = {
    <span class="hljs-type">var</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    <span class="hljs-title function_">while</span> <span class="hljs-params">(running)</span> {
      println(s<span class="hljs-string">"欢迎管理员:${user.username},来到我的图书管理系统，请选择"</span>)
      println(<span class="hljs-string">"1. 添加图书"</span>)
      println(<span class="hljs-string">"2. 查询图书"</span>)
      println(<span class="hljs-string">"3. 添加用户"</span>)
      println(<span class="hljs-string">"4. 退出"</span>)

      <span class="hljs-comment">// 获取用户的操作</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> StdIn.readLine().trim
      choice match {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"1"</span> =&gt;
          <span class="hljs-comment">// 1. 获取图书信息-书名，作者，状态</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> inputBookInfo()
          <span class="hljs-comment">// 2. 调用service层的方法，做添加到books.txt中操作</span>
          BookService.addBook(book)
          println(s<span class="hljs-string">"图书《${book.name}》添加成功"</span>)
        <span class="hljs-keyword">case</span> <span class="hljs-string">"2"</span> =&gt; <span class="hljs-comment">// println("查询图书")</span>
          <span class="hljs-comment">// 提示用户输入查询关键字</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> readLine(<span class="hljs-string">"请输入查询关键字(书名, 作者):"</span>).trim
          <span class="hljs-comment">// 根据关键字去查询图书列表，找到满足条件的书</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">results</span> <span class="hljs-operator">=</span> BookService.searchBooks(query)
          <span class="hljs-comment">// 显示出来</span>
          <span class="hljs-keyword">if</span>(results.nonEmpty){
            println(<span class="hljs-string">"======查询图书的结果======="</span>)
            results.foreach(println)
          } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"没有找到图书"</span>)
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"3"</span> =&gt;
          <span class="hljs-comment">// 1. 获取用户信息-用户名</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> StdIn.readLine(<span class="hljs-string">"请输入用户名: "</span>)
          <span class="hljs-comment">// 2. 调用service层的方法，做添加到users.txt中操作</span>
          <span class="hljs-keyword">if</span>(UserService.addUser(username)){
            println(<span class="hljs-string">"用户添加成功"</span>)
          } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"用户添加失败"</span>)
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"4"</span> =&gt; running = <span class="hljs-literal">false</span>
        <span class="hljs-type">case</span> <span class="hljs-variable">_</span> <span class="hljs-operator">=</span>&gt; println(<span class="hljs-string">"无效的选择"</span>)
      }
    }
  }
  <span class="hljs-comment">// 显示登录用户的菜单</span>
  def <span class="hljs-title function_">showUserMenu</span><span class="hljs-params">(user:UserModel)</span>: Unit = {
    <span class="hljs-type">var</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    <span class="hljs-title function_">while</span> <span class="hljs-params">(running)</span> {
      println(s<span class="hljs-string">"欢迎用户:${user.username},来到我的图书管理系统，请选择"</span>)
      println(<span class="hljs-string">"1. 借阅图书"</span>)
      println(<span class="hljs-string">"2. 查询借阅记录"</span>)
      println(<span class="hljs-string">"3. 还书"</span>)
      println(<span class="hljs-string">"4. 退出"</span>)

      <span class="hljs-comment">// 获取用户的操作</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> StdIn.readLine().trim
      choice match {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"1"</span> =&gt;
          <span class="hljs-comment">// UI: 提示用户输入图书的ID。校验：判断是不是整数</span>
          <span class="hljs-keyword">try</span> {
            <span class="hljs-type">val</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> readLine(<span class="hljs-string">"请输入图书的ID:"</span>).toInt
            BookService.borrowBook(user.username,id)
          } <span class="hljs-keyword">catch</span> {
            <span class="hljs-keyword">case</span> e:Exception =&gt;
              println(e)
              println(<span class="hljs-string">"输入的图书ID无效"</span>)
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"2"</span> =&gt;
          <span class="hljs-comment">// 在BookService中实现根据用户名去查询借阅图书</span>
          <span class="hljs-type">val</span> <span class="hljs-variable">borrowRecords</span> <span class="hljs-operator">=</span> BookService.queryBorrowRecords(user.username)
          <span class="hljs-comment">// 判断是否为空</span>
          <span class="hljs-keyword">if</span>(borrowRecords.isEmpty){
            println(<span class="hljs-string">"没有借阅记录"</span>)
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 遍历借阅记录</span>
            <span class="hljs-comment">// println("查询结果，一共借了？本，换了？本，？本未归还")</span>
            <span class="hljs-keyword">for</span>(record &lt;- borrowRecords){
              <span class="hljs-type">val</span> <span class="hljs-variable">returnDate</span> <span class="hljs-operator">=</span> record.returnDate.getOrElse(<span class="hljs-string">"未归还"</span>)
              println(s<span class="hljs-string">"书名：${record.bookName} 借阅时间：${record.borrowDate}，归还日期：${returnDate}"</span>)
            }
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"3"</span> =&gt;
          <span class="hljs-keyword">try</span> {
            <span class="hljs-type">val</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> readLine(<span class="hljs-string">"请输入要归还的图书ID:"</span>).toInt
            <span class="hljs-title function_">if</span><span class="hljs-params">(BookService.returnBook(user.username, id)</span>){
              println(<span class="hljs-string">"归还图书成功"</span>)
            } <span class="hljs-keyword">else</span> {
              println(<span class="hljs-string">"归还图书失败"</span>)
            }
          } <span class="hljs-keyword">catch</span> {
            <span class="hljs-keyword">case</span> e:Exception =&gt;
              println(e)
              println(<span class="hljs-string">"输入的图书ID无效"</span>)
          }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"4"</span> =&gt; running = <span class="hljs-literal">false</span>
        <span class="hljs-type">case</span> <span class="hljs-variable">_</span> <span class="hljs-operator">=</span>&gt; println(<span class="hljs-string">"无效的选择"</span>)
      }
    }
  }

  def <span class="hljs-title function_">showMenu</span><span class="hljs-params">()</span>: Unit = {
    showVisitorMenu()
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP 8.5 管道操作符 (|>) 告别嵌套函数地狱，写出清晰的数据管道]]></title>    <link>https://juejin.cn/post/7591697558377267242</link>    <guid>https://juejin.cn/post/7591697558377267242</guid>    <pubDate>2026-01-06T00:47:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591697558377267242" data-draft-id="7591672090790887443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP 8.5 管道操作符 (|&gt;) 告别嵌套函数地狱，写出清晰的数据管道"/> <meta itemprop="keywords" content="后端,PHP"/> <meta itemprop="datePublished" content="2026-01-06T00:47:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP 8.5 管道操作符 (|&gt;) 告别嵌套函数地狱，写出清晰的数据管道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:47:19.000Z" title="Tue Jan 06 2026 00:47:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PHP 8.5 管道操作符 (|&gt;) 告别嵌套函数地狱，写出清晰的数据管道</h2>
<p>我消失了一阵——故意的。年底冲刺完，假期认真休息了：断网、放慢节奏，允许自己暂时不想代码。</p>
<p>现在是一月初，感觉该带点新东西回来了。PHP 8.5 来了，虽然改进不少，但有个功能对日常可读性特别突出：管道操作符 (<code>|&gt;</code>)。</p>
<p>可以把它想成"让我的转换变可读"按钮。它让你从左到右写数据处理步骤，不用把它们埋在嵌套括号里。如果你写过（或继承过）<code>foo(bar(baz(trim($x))))</code> 这种代码，你已经知道为什么这很重要了。</p>
<p>下面用实际例子拆解——字符串、数组、错误处理——最后给个简单的重构清单，让你能安全地采用它。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fphp85-pipe-operator-clean-data-pipelines" target="_blank" title="https://catchadmin.com/post/2026-01/php85-pipe-operator-clean-data-pipelines" ref="nofollow noopener noreferrer">原文 PHP 8.5 管道操作符 (|&gt;) 告别嵌套函数地狱，写出清晰的数据管道</a></p>
<h3 data-id="heading-1">日常问题：嵌套调用 vs 顺序步骤</h3>
<p>写过一段时间 PHP，你可能见过这种代码：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">foo</span>(<span class="hljs-title function_ invoke__">bar</span>(<span class="hljs-title function_ invoke__">baz</span>(<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$input</span>)))));
</code></pre>
<p>能跑。但也是那种让你在 review 时停下来、眯眼、默默从里往外重新解析括号的代码——像在做脑力体操。</p>
<p>PHP 开发者历史上有两种常见处理方式：</p>
<ul>
<li>嵌套函数调用（长了就难读）</li>
<li>逐步临时变量（更清晰，但有时啰嗦）</li>
</ul>
<p>PHP 8.5 引入第三种选择：管道操作符 (<code>|&gt;</code>)，让你从左到右写转换，跟你口头解释逻辑的方式一样。</p>
<p>不再是"取输入，小写，trim，验证……"埋在括号里，你可以写：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$email</span> = <span class="hljs-variable">$input</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
    |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-comment">/* validate */</span> <span class="hljs-variable">$v</span>);
</code></pre>
<p>这篇文章是管道操作符的实战教程——不会把你的代码库变成时髦但难读的"函数式汤"。</p>
<p>概括地说，管道操作符把左边的值传给右边的单参数 callable，产出 callable 的返回值。</p>
<h3 data-id="heading-2">核心概念：把前一个结果喂给下一个 callable</h3>
<p>PHP 8.5 里，管道操作符这样求值：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-variable">$value</span> |&gt; <span class="hljs-title function_ invoke__">someCallable</span>(...);
</code></pre>
<p>逻辑上等于：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">someCallable</span>(<span class="hljs-variable">$value</span>);
</code></pre>
<p>链式调用才是它有用的地方：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-variable">$value</span>
    |&gt; <span class="hljs-title function_ invoke__">firstStep</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">secondStep</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">thirdStep</span>(...);
</code></pre>
<p>每个阶段接收上一阶段的输出。</p>
<h4 data-id="heading-3">右边什么算 callable？</h4>
<p>右边可以是任何接受一个参数的 callable，包括：</p>
<ul>
<li>一等公民 callable 如 <code>trim(...)</code>、<code>strlen(...)</code></li>
<li>闭包/箭头函数如 <code>(fn ($x) =&gt; ...)</code></li>
<li>可调用对象（<code>__invoke()</code>）</li>
<li>实例方法 callable 如 <code>$obj-&gt;method(...)</code></li>
<li>静态方法 callable 如 <code>ClassName::method(...)</code></li>
</ul>
<p>关键规则：一个输入值流过去。</p>
<p>PHP 手册明确指出右边的 callable 必须接受单个参数，多于一个必需参数的函数直接用不了。</p>
<p>这个规则决定了你实际怎么写管道。后面会看到处理"多参数"函数的模式。</p>
<h3 data-id="heading-4">基础管道：字符串 → trim → 小写 → 验证</h3>
<p>来构建一个能直接放进项目的东西：一个小的邮箱规范化管道，同时验证并在失败时报错。</p>
<h4 data-id="heading-5">规范化</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-variable">$rawEmail</span> = <span class="hljs-string">"  Alice.Example+promo@GMAIL.com  "</span>;
<span class="hljs-variable">$normalized</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$normalized</span>;
<span class="hljs-comment">// "alice.example+promo@gmail.com"</span>
</code></pre>
<p>目前看起来像方法链——但它作用于普通字符串，不是对象。</p>
<h4 data-id="heading-6">验证（无效时停止管道）</h4>
<p><code>filter_var()</code> 是个好例子，因为验证不只是另一个"转换"。它可能失败。</p>
<p>而且 <code>filter_var($value, FILTER_VALIDATE_EMAIL)</code> 需要第二个参数才有意义。管道只传一个参数，所以要包装一下。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateEmail</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span></span>): <span class="hljs-title">string</span>
</span>{
    <span class="hljs-comment">// filter_var 返回过滤后的值或 false</span>
    <span class="hljs-variable">$validated</span> = <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$email</span>, FILTER_VALIDATE_EMAIL);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$validated</span> === <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Invalid email: <span class="hljs-subst">{$email}</span>"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$validated</span>;
}
<span class="hljs-variable">$rawEmail</span> = <span class="hljs-string">"  alice@example.com  "</span>;
<span class="hljs-variable">$email</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">validateEmail</span>(...);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$email</span>;
</code></pre>
<p>读起来很顺：trim → 小写 → 验证。</p>
<h4 data-id="heading-7">单行验证阶段（throw 作为表达式）</h4>
<p>如果你喜欢更紧凑的管道，PHP 的 <code>throw</code> 是表达式（PHP 8.0 起），可以这样：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-variable">$rawEmail</span> = <span class="hljs-string">"  alice@example.com  "</span>;
<span class="hljs-variable">$email</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
    |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$v</span>, FILTER_VALIDATE_EMAIL)
        ?: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Invalid email: <span class="hljs-subst">{$v}</span>"</span>)
    );
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$email</span>;
</code></pre>
<p>一个小但重要的语法注意点：</p>
<p>在 <code>|&gt;</code> 右边用箭头函数时，必须用括号包起来，避免解析歧义。</p>
<p>所以这是必须的：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$value</span> |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">doSomething</span>(<span class="hljs-variable">$x</span>));
</code></pre>
<p>不是：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// ❌ 这会解析失败</span>
<span class="hljs-variable">$value</span> |&gt; <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">doSomething</span>(<span class="hljs-variable">$x</span>);
</code></pre>
<h4 data-id="heading-8">让它"真实"：规范化 Gmail 地址</h4>
<p>加个实际的转换：对于 Gmail 地址，本地部分的点被忽略，<code>+tag</code> 也被忽略。很多系统会规范化这些。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">canonicalizeGmail</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span></span>): <span class="hljs-title">string</span>
</span>{
    [<span class="hljs-variable">$local</span>, <span class="hljs-variable">$domain</span>] = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'@'</span>, <span class="hljs-variable">$email</span>, <span class="hljs-number">2</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$domain</span> !== <span class="hljs-string">'gmail.com'</span> &amp;&amp; <span class="hljs-variable">$domain</span> !== <span class="hljs-string">'googlemail.com'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$email</span>;
    }
    <span class="hljs-comment">// 移除 plus tag</span>
    <span class="hljs-variable">$local</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'+'</span>, <span class="hljs-variable">$local</span>, <span class="hljs-number">2</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-comment">// 移除点</span>
    <span class="hljs-variable">$local</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'.'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$local</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$local</span> . <span class="hljs-string">'@gmail.com'</span>;
}
<span class="hljs-variable">$rawEmail</span> = <span class="hljs-string">"  Alice.Example+promo@GMAIL.com  "</span>;
<span class="hljs-variable">$email</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
    |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$v</span>, FILTER_VALIDATE_EMAIL)
        ?: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Invalid email: <span class="hljs-subst">{$v}</span>"</span>)
    )
    |&gt; <span class="hljs-title function_ invoke__">canonicalizeGmail</span>(...);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$email</span>;
<span class="hljs-comment">// "aliceexample@gmail.com"</span>
</code></pre>
<p>这就是 <code>|&gt;</code> 开始发光的地方：加步骤时管道保持可读。</p>
<h3 data-id="heading-9">数组和集合的管道：map / filter / reduce（真实用例）</h3>
<p>字符串简单。数组是很多 PHP 代码库开始变乱的地方——因为标准库很强大，但函数签名经常不太适合管道化。</p>
<p>来个常见任务：处理原始订单数据，计算"已支付"订单的收入。</p>
<p>假设你读了 JSON，得到这样的数组：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$orders</span> = [
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'paid'</span>,   <span class="hljs-string">'total'</span> =&gt; <span class="hljs-number">120.50</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'failed'</span>, <span class="hljs-string">'total'</span> =&gt;  <span class="hljs-number">80.00</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'paid'</span>,   <span class="hljs-string">'total'</span> =&gt;  <span class="hljs-number">42.25</span>],
];
</code></pre>
<p>目标：用清晰的管道求已支付订单的 total 之和。</p>
<h4 data-id="heading-10">保持管道干净的辅助函数</h4>
<p><code>array_filter</code>、<code>array_map</code> 和 <code>array_reduce</code> 很好用，但不包装一下没法干净地接受单个"管道值"。</p>
<p>一个实用模式是创建小辅助函数，返回单参数 callable。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span>(<span class="hljs-params"><span class="hljs-keyword">callable</span> <span class="hljs-variable">$fn</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$items</span></span>): <span class="hljs-title">array</span> =&gt;</span> <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-variable">$fn</span>, <span class="hljs-variable">$items</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-keyword">callable</span> <span class="hljs-variable">$fn</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$items</span></span>): <span class="hljs-title">array</span> =&gt;</span> <span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-variable">$items</span>, <span class="hljs-variable">$fn</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span>(<span class="hljs-params"><span class="hljs-keyword">callable</span> <span class="hljs-variable">$fn</span>, <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$initial</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$items</span></span>): <span class="hljs-title">mixed</span> =&gt;</span> <span class="hljs-title function_ invoke__">array_reduce</span>(<span class="hljs-variable">$items</span>, <span class="hljs-variable">$fn</span>, <span class="hljs-variable">$initial</span>);
}
</code></pre>
<p>现在可以顺畅地管道数组了。</p>
<h4 data-id="heading-11">已支付收入管道</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-variable">$orders</span> = [
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'paid'</span>,   <span class="hljs-string">'total'</span> =&gt; <span class="hljs-number">120.50</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'failed'</span>, <span class="hljs-string">'total'</span> =&gt;  <span class="hljs-number">80.00</span>],
    [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'paid'</span>,   <span class="hljs-string">'total'</span> =&gt;  <span class="hljs-number">42.25</span>],
];
<span class="hljs-variable">$paidRevenue</span> = <span class="hljs-variable">$orders</span>
    |&gt; <span class="hljs-title function_ invoke__">filter</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$o</span>) =&gt; <span class="hljs-variable">$o</span>[<span class="hljs-string">'status'</span>] === <span class="hljs-string">'paid'</span>)
    |&gt; <span class="hljs-title function_ invoke__">map</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$o</span>) =&gt; (<span class="hljs-keyword">float</span>) <span class="hljs-variable">$o</span>[<span class="hljs-string">'total'</span>])
    |&gt; <span class="hljs-title function_ invoke__">reduce</span>(fn (<span class="hljs-keyword">float</span> <span class="hljs-variable">$sum</span>, <span class="hljs-keyword">float</span> <span class="hljs-variable">$t</span>) =&gt; <span class="hljs-variable">$sum</span> + <span class="hljs-variable">$t</span>, <span class="hljs-number">0.0</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$paidRevenue</span>; <span class="hljs-comment">// 162.75</span>
</code></pre>
<p>像英语一样读：</p>
<ul>
<li>过滤已支付订单</li>
<li>映射到 total</li>
<li>归约成总和</li>
</ul>
<h4 data-id="heading-12">稍微丰富的真实例子：CSV 风格的行转干净记录</h4>
<p>假设你有一组行：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$lines</span> = [
    <span class="hljs-string">" alice@example.com , paid "</span>,
    <span class="hljs-string">" bob@invalid-domain , paid "</span>,
    <span class="hljs-string">" charlie@example.com , failed "</span>,
    <span class="hljs-string">"  dora@example.com, paid "</span>,
];
</code></pre>
<p>目标：</p>
<ul>
<li>解析成 <code>[email, status]</code></li>
<li>规范化邮箱</li>
<li>验证邮箱（丢弃无效的）</li>
<li>只保留已支付</li>
<li>返回规范化邮箱列表</li>
</ul>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeEmail</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span></span>): <span class="hljs-title">string</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$email</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidEmail</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span></span>): <span class="hljs-title">bool</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$email</span>, FILTER_VALIDATE_EMAIL) !== <span class="hljs-literal">false</span>;
}

<span class="hljs-variable">$lines</span> = [
    <span class="hljs-string">" alice@example.com , paid "</span>,
    <span class="hljs-string">" bob@invalid-domain , paid "</span>,
    <span class="hljs-string">" charlie@example.com , failed "</span>,
    <span class="hljs-string">"  dora@example.com, paid "</span>,
];

<span class="hljs-variable">$paidEmails</span> = <span class="hljs-variable">$lines</span>
    |&gt; <span class="hljs-title function_ invoke__">map</span>(fn (<span class="hljs-keyword">string</span> <span class="hljs-variable">$line</span>) =&gt; <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">'trim'</span>, <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">','</span>, <span class="hljs-variable">$line</span>)))
    |&gt; <span class="hljs-title function_ invoke__">map</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$parts</span>) =&gt; [<span class="hljs-string">'email'</span> =&gt; <span class="hljs-title function_ invoke__">normalizeEmail</span>(<span class="hljs-variable">$parts</span>[<span class="hljs-number">0</span>]), <span class="hljs-string">'status'</span> =&gt; <span class="hljs-variable">$parts</span>[<span class="hljs-number">1</span>]])
    |&gt; <span class="hljs-title function_ invoke__">filter</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$r</span>) =&gt; <span class="hljs-title function_ invoke__">isValidEmail</span>(<span class="hljs-variable">$r</span>[<span class="hljs-string">'email'</span>]))
    |&gt; <span class="hljs-title function_ invoke__">filter</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$r</span>) =&gt; <span class="hljs-variable">$r</span>[<span class="hljs-string">'status'</span>] === <span class="hljs-string">'paid'</span>)
    |&gt; <span class="hljs-title function_ invoke__">map</span>(fn (<span class="hljs-keyword">array</span> <span class="hljs-variable">$r</span>) =&gt; <span class="hljs-variable">$r</span>[<span class="hljs-string">'email'</span>])
    |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$arr</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-variable">$arr</span>));

<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$paidEmails</span>);
<span class="hljs-comment">// ['alice@example.com', 'dora@example.com']</span>
</code></pre>
<p>注意：</p>
<ul>
<li>每个阶段是一个转换</li>
<li>验证在管道里，但不用 <code>normalizeEmail(...)</code> 因为它可能抛异常</li>
<li><code>array_filter</code> 保留键，所以最后 <code>array_values()</code> 是常见的清理步骤</li>
</ul>
<p>这种转换管道就是 <code>|&gt;</code> 发挥价值的地方。</p>
<h3 data-id="heading-13">管道 + 错误处理：try/catch vs 守卫子句</h3>
<p>管道是表达式。错误处理是很多团队要么喜欢要么讨厌这种风格的地方。</p>
<p>有两种健康的方式：</p>
<h4 data-id="heading-14">选项 A：管道外的守卫子句（无聊但很清晰）</h4>
<p>这是"别耍聪明"的方式：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-variable">$email</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$email</span> === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Email is required.'</span>);
}
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$email</span>, FILTER_VALIDATE_EMAIL) === <span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Email is invalid.'</span>);
}
</code></pre>
<p>优点：</p>
<ul>
<li>非常明确</li>
<li>容易调试</li>
<li>闭包里没有异常技巧</li>
</ul>
<p>缺点：</p>
<ul>
<li>"故事"被拆成管道 + 单独的验证块</li>
</ul>
<h4 data-id="heading-15">选项 B：管道里抛异常，外面 catch（适合"全有或全无"）</h4>
<p>当管道逻辑上是一个操作——"解析并规范化这个输入，否则失败"——整个包起来可以很干净：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-keyword">try</span> {
    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$rawEmail</span>
        |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
        |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
        |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-variable">$v</span> !== <span class="hljs-string">''</span>
            ? <span class="hljs-variable">$v</span>
            : <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Email is required.'</span>)
        )
        |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$v</span>, FILTER_VALIDATE_EMAIL)
            ?: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Email is invalid.'</span>)
        );
    <span class="hljs-comment">// 使用 $email</span>
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">InvalidArgumentException</span> <span class="hljs-variable">$e</span>) {
    <span class="hljs-comment">// 处理验证错误</span>
}
</code></pre>
<p>优点：</p>
<ul>
<li>管道读起来像单个"事务"</li>
<li>适合请求解析/DTO 构建</li>
</ul>
<p>缺点：</p>
<ul>
<li>过度使用会让人觉得异常被当作控制流</li>
</ul>
<h4 data-id="heading-16">调试友好的模式：inspect()（管道的"tap"）</h4>
<p>管道代码的一个批评是"中间值更难调试"。</p>
<p>你可以插入一个阶段来记录并原样返回值，不用放弃管道。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inspect</span>(<span class="hljs-params"><span class="hljs-keyword">callable</span> <span class="hljs-variable">$fn</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">mixed</span> <span class="hljs-variable">$value</span></span>) <span class="hljs-keyword">use</span> (<span class="hljs-params"><span class="hljs-variable">$fn</span></span>) </span>{
        <span class="hljs-variable">$fn</span>(<span class="hljs-variable">$value</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$value</span>;
    };
}
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$rawEmail</span>
    |&gt; <span class="hljs-title function_ invoke__">trim</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">inspect</span>(fn (<span class="hljs-variable">$v</span>) =&gt; <span class="hljs-title function_ invoke__">error_log</span>(<span class="hljs-string">"After trim: "</span> . <span class="hljs-variable">$v</span>))
    |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">inspect</span>(fn (<span class="hljs-variable">$v</span>) =&gt; <span class="hljs-title function_ invoke__">error_log</span>(<span class="hljs-string">"After lower: "</span> . <span class="hljs-variable">$v</span>));
</code></pre>
<p>这保持了从左到右的流，同时让中间状态在调试时可见。</p>
<h3 data-id="heading-17">与函数和方法的互操作：写出保持可读的管道</h3>
<p>管道操作符很简单；艺术在于用它而不让代码看起来像聪明的谜题。</p>
<h4 data-id="heading-18">签名匹配时优先用一等公民 callable</h4>
<p>如果函数已经接受单个必需参数，这是最干净的形式：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$value</span> |&gt; <span class="hljs-title function_ invoke__">trim</span>(...) |&gt; <span class="hljs-title function_ invoke__">strtolower</span>(...);
</code></pre>
<p>因为 <code>trim(...)</code> 是 callable 引用，不是调用。它是"一个你可以传递的函数"。</p>
<h4 data-id="heading-19">用命名函数表达"业务含义"</h4>
<p>如果一个阶段不明显，给它起个名字。</p>
<p>不要：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$data</span> |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) =&gt;</span> <span class="hljs-comment">/* 12 行逻辑 */</span>);
</code></pre>
<p>要：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$data</span> |&gt; <span class="hljs-title function_ invoke__">normalizeCustomerPayload</span>(...);
</code></pre>
<p>管道应该读起来像高层脚本。</p>
<h4 data-id="heading-20">管道到方法（实例和静态）</h4>
<p>如果你有个 mapper 对象：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMapper</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toDto</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$row</span></span>): <span class="hljs-title">UserDto</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }
}
<span class="hljs-variable">$mapper</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserMapper</span>();
<span class="hljs-variable">$dto</span> = <span class="hljs-variable">$row</span>
    |&gt; <span class="hljs-variable">$mapper</span>-&gt;<span class="hljs-title function_ invoke__">toDto</span>(...);
</code></pre>
<p>或静态方法：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$dto</span> = <span class="hljs-variable">$row</span> |&gt; <span class="hljs-title class_">UserMapper</span>::<span class="hljs-title function_ invoke__">fromRow</span>(...);
</code></pre>
<h4 data-id="heading-21">处理需要额外参数的函数</h4>
<p>记住：管道传一个参数。很多 PHP 标准函数要更多。</p>
<p>例子：<code>explode('.', $value)</code> 需要两个必需参数，所以不能这样：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// ❌ explode 需要 2 个参数；这直接不行</span>
<span class="hljs-variable">$parts</span> = <span class="hljs-variable">$domain</span> |&gt; <span class="hljs-title function_ invoke__">explode</span>(...);
</code></pre>
<p>包装一下：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$parts</span> = <span class="hljs-variable">$domain</span> |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'.'</span>, <span class="hljs-variable">$v</span>));
</code></pre>
<p>或者，如果你喜欢，创建一个小辅助函数来"预配置"函数：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">explodeBy</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$delimiter</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$value</span></span>): <span class="hljs-title">array</span> =&gt;</span> <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-variable">$delimiter</span>, <span class="hljs-variable">$value</span>);
}

<span class="hljs-variable">$parts</span> = <span class="hljs-variable">$domain</span> |&gt; <span class="hljs-title function_ invoke__">explodeBy</span>(<span class="hljs-string">'.'</span>);
</code></pre>
<p>这种"配置好的 callable"方式在真实代码里扩展性很好。</p>
<h4 data-id="heading-22">操作符优先级陷阱（用括号保持无聊）</h4>
<p>RFC 和手册指出 <code>|&gt;</code> 有定义的优先级且是左结合的。实际上，跟 <code>??</code>、三元运算符或更复杂的表达式混用时应该用括号，除非明显安全。</p>
<p>例子：先选 callable，再管道进去：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$fn</span> = <span class="hljs-variable">$flag</span> ? <span class="hljs-title function_ invoke__">enabledFunc</span>(...) : <span class="hljs-title function_ invoke__">disabledFunc</span>(...);
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$value</span> |&gt; <span class="hljs-variable">$fn</span>;
</code></pre>
<p>如果你坚持内联，用括号：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-variable">$value</span> |&gt; (<span class="hljs-variable">$flag</span> ? <span class="hljs-title function_ invoke__">enabledFunc</span>(...) : <span class="hljs-title function_ invoke__">disabledFunc</span>(...));
</code></pre>
<h4 data-id="heading-23">另一个尖锐边缘：引用传递的 callable 不允许</h4>
<p>有些 PHP 函数按引用接受参数。管道操作符不允许管道到需要引用传递参数的 callable。</p>
<p>大多数日常管道不需要引用——但知道为什么有些函数在管道里不工作是好的。</p>
<h3 data-id="heading-24">什么时候不该用 |&gt;（是的，这是真事）</h3>
<p>管道操作符是工具，不是宗教。这些情况通常是错误选择。</p>
<h4 data-id="heading-25">需要大量分支逻辑时</h4>
<p>如果你的转换有多个提前退出、复杂条件和嵌套循环，管道会变得勉强。</p>
<p>干净的 if/else 块通常比把所有东西塞进闭包好。</p>
<h4 data-id="heading-26">副作用是主要目的时</h4>
<p>管道在每个阶段是纯转换时最好：输入 → 输出。</p>
<p>如果目的是"发邮件"、"写数据库"、"发布事件"，你仍然可以管道，但容易在链里隐藏重要副作用，让流程更难理解。</p>
<p>如果确实需要副作用，优先用明确的 <code>inspect()</code> 阶段，让发生的事情清晰。</p>
<h4 data-id="heading-27">管道变成"闭包汤"时</h4>
<p>如果每隔一个阶段是：</p>
<pre><code class="hljs language-php" lang="php">|&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">someFunc</span>(<span class="hljs-variable">$x</span>, <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>))
</code></pre>
<p>你可能在跟 PHP 的函数签名较劲太多。</p>
<p>这时候：</p>
<ul>
<li>提取命名辅助函数</li>
<li>或用直接的顺序代码</li>
</ul>
<h4 data-id="heading-28">调试是主要活动时</h4>
<p>管道可以调试，但如果你在事故响应的热循环里，临时变量仍然是你的朋友。</p>
<p>可读代码是你能快速插桩和检查的代码。</p>
<h4 data-id="heading-29">链太长时</h4>
<p>经验法则：如果管道超过 6-10 个阶段，考虑把阶段分组成命名函数。</p>
<p>不要：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$payload</span>
    |&gt; <span class="hljs-title function_ invoke__">step1</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step2</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step3</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step4</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step5</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step6</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step7</span>(...);
</code></pre>
<p>要：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$payload</span>
    |&gt; <span class="hljs-title function_ invoke__">normalizePayload</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">validatePayload</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">buildDto</span>(...);
</code></pre>
<h3 data-id="heading-30">重构清单：安全地从嵌套调用迁移到管道</h3>
<p>如果你想在现有代码库引入 <code>|&gt;</code>，这是个实用方法，不会搞坏东西或惹恼团队。</p>
<h4 data-id="heading-31">从有测试覆盖的转换开始</h4>
<p>选一个函数：</p>
<ul>
<li>有清晰的输入/输出</li>
<li>不修改全局状态</li>
<li>有单元或集成测试覆盖</li>
</ul>
<p>逻辑已经稳定时管道最容易（也最安全）。</p>
<h4 data-id="heading-32">先把嵌套调用转成顺序步骤（可选但有效）</h4>
<p>如果你从这开始：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$out</span> = <span class="hljs-title function_ invoke__">c</span>(<span class="hljs-title function_ invoke__">b</span>(<span class="hljs-title function_ invoke__">a</span>(<span class="hljs-variable">$in</span>)));
</code></pre>
<p>改写成：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$tmp</span> = <span class="hljs-variable">$in</span>;
<span class="hljs-variable">$tmp</span> = <span class="hljs-title function_ invoke__">a</span>(<span class="hljs-variable">$tmp</span>);
<span class="hljs-variable">$tmp</span> = <span class="hljs-title function_ invoke__">b</span>(<span class="hljs-variable">$tmp</span>);
<span class="hljs-variable">$out</span> = <span class="hljs-title function_ invoke__">c</span>(<span class="hljs-variable">$tmp</span>);
</code></pre>
<p>这让逻辑阶段明确。然后管道化：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$out</span> = <span class="hljs-variable">$in</span>
    |&gt; <span class="hljs-title function_ invoke__">a</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">b</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">c</span>(...);
</code></pre>
<h4 data-id="heading-33">用小的"可配置 callable"辅助函数处理多参数函数</h4>
<p>不要到处撒包装闭包，集中模式如：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withDelimiter</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$d</span></span>): <span class="hljs-title">Closure</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$v</span></span>): <span class="hljs-title">array</span> =&gt;</span> <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-variable">$d</span>, <span class="hljs-variable">$v</span>);
}
</code></pre>
<p>这让管道保持干净一致。</p>
<h4 data-id="heading-34">保持验证语义一致</h4>
<p>如果你的旧代码失败时返回 null，不要在管道里悄悄换成抛异常，除非你准备好更新调用代码。</p>
<p>明确管道是：</p>
<ul>
<li>返回结果或 null</li>
<li>返回结果或 false</li>
<li>无效输入时抛异常</li>
</ul>
<p>管道可以表达任何这些风格——但随机混用让代码更难理解。</p>
<h4 data-id="heading-35">采用一种格式风格并坚持</h4>
<p>可读的管道通常这样：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$result</span> = <span class="hljs-variable">$value</span>
    |&gt; <span class="hljs-title function_ invoke__">step1</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">step2</span>(...)
    |&gt; (<span class="hljs-function"><span class="hljs-keyword">fn</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) =&gt;</span> <span class="hljs-title function_ invoke__">step3</span>(<span class="hljs-variable">$x</span>))
    |&gt; <span class="hljs-title function_ invoke__">step4</span>(...);
</code></pre>
<p>常见做法：</p>
<ul>
<li>每行一个阶段</li>
<li>对齐管道符</li>
<li>闭包保持短</li>
<li>长闭包提取成命名函数</li>
</ul>
<h4 data-id="heading-36">加"检查点"调试，然后移除</h4>
<p>重构期间，插入 <code>inspect()</code> 阶段验证中间值。一切检查通过后，移除或降级成正式日志。</p>
<h4 data-id="heading-37">用代码审查强制"管道用于转换，不是用于一切"</h4>
<p>管道操作符可以提高可读性。也可以变成隐藏复杂性的时尚声明。</p>
<p>一个简单的审查指南有帮助：</p>
<ul>
<li>用 <code>|&gt;</code> 做转换管道</li>
<li>避免 <code>|&gt;</code> 做复杂分支或副作用密集的序列</li>
<li>优先命名函数而不是长内联闭包</li>
</ul>
<h3 data-id="heading-38">结论：|&gt; 最好用在读起来像故事的时候</h3>
<p>PHP 8.5 的管道操作符不是替代经典 PHP 风格——它是补充。</p>
<p>用它当你想：</p>
<ul>
<li>把转换表达成从左到右的流</li>
<li>减少嵌套括号</li>
<li>让"数据故事"在代码里可见</li>
</ul>
<p>避免它当它变成：</p>
<ul>
<li>隐藏的副作用</li>
<li>密集的闭包链</li>
<li>伪装成优雅的复杂分支</li>
</ul>
<p>如果你保持管道聚焦，给有意义的步骤命名，把调试/验证当作一等公民，<code>|&gt;</code> 能让 PHP 代码感觉明显更现代——不牺牲团队需要的实用、可读风格。</p>
<h3 data-id="heading-39">参考</h3>
<ul>
<li>PHP 手册："函数式操作符"（管道操作符 <code>|&gt;</code>；callable 约束；箭头函数括号要求）</li>
<li>PHP RFC："Pipe Operator v3"（设计、优先级说明、引用限制、性能说明）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[剑指offer-59、按之字形顺序打印⼆叉树]]></title>    <link>https://juejin.cn/post/7591744347827322906</link>    <guid>https://juejin.cn/post/7591744347827322906</guid>    <pubDate>2026-01-06T00:50:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744347827322906" data-draft-id="7589916567875731498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="剑指offer-59、按之字形顺序打印⼆叉树"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-06T00:50:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            剑指offer-59、按之字形顺序打印⼆叉树
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:50:50.000Z" title="Tue Jan 06 2026 00:50:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>请实现⼀个函数按照之字形打印⼆叉树，即第⼀⾏按照从左到右的顺序打印，第⼆层按照从右⾄左的顺序打印，第三⾏按照从左到右的顺序打印，其他⾏以此类推。</p>
<p>示例1
输⼊：{8,6,10,5,7,9,11}
返回值：[[8],[10,6],[5,7,9,11]]</p>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">双向链表（推荐）</h3>
<ol>
<li>借助双向链表，初始化⼀个添加⽅向 boolean 值，先将根节点添加进去：</li>
<li>获取 list ⾥⾯剩下的元素的个数，挨个取出就是⼀层，取出的时候，如果 reverse 为 true ，则往链表的第 0 个索引位置添加，否则直接在后⾯添加，然后判断每⼀个取出来的节点的左右节点是不是为空，不为空则加⼊链表。</li>
<li>每⼀层处理完之后，将 list 加⼊结果集中，然后翻转 reverse 的值，继续判断 list 是不是为空，执⾏第⼆步循环。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> ArrayList &lt; ArrayList &lt; Integer &gt;&gt; Print(TreeNode pRoot) {
        LinkedList &lt; TreeNode &gt; nodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span> &lt; &gt; ();
        ArrayList &lt; ArrayList &lt; Integer &gt;&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">reverse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (pRoot != <span class="hljs-literal">null</span>) {
            nodes.add(pRoot);
            <span class="hljs-keyword">while</span> (!nodes.isEmpty()) {
                ArrayList &lt; Integer &gt; integers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();
                <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> nodes.size();
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) {
                    <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> nodes.poll();
                    <span class="hljs-keyword">if</span> (reverse) {
                        integers.add(node.val);
                    } <span class="hljs-keyword">else</span> {
                        integers.add(<span class="hljs-number">0</span>, node.val);
                    }
                    <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) {
                        nodes.offer(node.left);
                    }
                    <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) {
                        nodes.offer(node.right);
                    }
                }
                <span class="hljs-keyword">if</span> (integers.size() != <span class="hljs-number">0</span>) {
                    results.add(integers);
                }
                reverse = !reverse;
            }
        }
        <span class="hljs-keyword">return</span> results;
    }
}
</code></pre>
<ul>
<li>空间复杂度由于借助了额外的 list ，为 O(n)</li>
<li>时间复杂度，由于每个节点进⼊队列⼜出来，为 O(2n) ，也是 O(n) 。</li>
</ul>
<h3 data-id="heading-3">队列 + 方向反转</h3>
<p>这是最直接的方法。我们进行标准的层序遍历，但用一个标志位记录当前层是奇数层还是偶数层。对于偶数层，我们在将该层的节点值列表加入最终结果前，先进行反转</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt;&gt; <span class="hljs-title function_">Print</span><span class="hljs-params">(TreeNode pRoot)</span> {
        ArrayList&lt;ArrayList&lt;Integer&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (pRoot == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;

        Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
        queue.offer(pRoot);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">leftToRight</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 方向标志，true表示从左到右</span>

        <span class="hljs-keyword">while</span> (!queue.isEmpty()) {
            <span class="hljs-type">int</span> <span class="hljs-variable">levelSize</span> <span class="hljs-operator">=</span> queue.size(); <span class="hljs-comment">// 当前层的节点数</span>
            ArrayList&lt;Integer&gt; levelList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            <span class="hljs-comment">// 遍历当前层的所有节点</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; levelSize; i++) {
                <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();
                levelList.add(node.val); <span class="hljs-comment">// 将节点值加入当前层列表</span>

                <span class="hljs-comment">// 将下一层的节点按标准顺序（先左后右）加入队列</span>
                <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) queue.offer(node.left);
                <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) queue.offer(node.right);
            }

            <span class="hljs-comment">// 如果是偶数层（从第0层开始算则为奇数索引），反转当前层列表</span>
            <span class="hljs-keyword">if</span> (!leftToRight) {
                Collections.reverse(levelList);
            }
            result.add(levelList);
            leftToRight = !leftToRight; <span class="hljs-comment">// 切换方向</span>
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)。每个节点被访问一次，对于偶数层，<code>Collections.reverse</code>的时间复杂度为 O(当前层节点数)，所有层的节点数相加为 n，因此总时间复杂度为 O(n)。</li>
<li><strong>空间复杂度</strong>：O(n)。队列和结果列表所需空间与节点数 n 成线性关系。</li>
</ul>
<h3 data-id="heading-4">双栈交替</h3>
<p>利用栈后进先出（LIFO）的特性来自然地实现顺序的反转。我们使用两个栈，一个用于处理当前层，另一个用于存储下一层的节点</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt;&gt; <span class="hljs-title function_">Print</span><span class="hljs-params">(TreeNode pRoot)</span> {
        ArrayList&lt;ArrayList&lt;Integer&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (pRoot == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;

        Stack&lt;TreeNode&gt; stack1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;(); <span class="hljs-comment">// 处理奇数层（从左到右）</span>
        Stack&lt;TreeNode&gt; stack2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;(); <span class="hljs-comment">// 处理偶数层（从右到左）</span>
        stack1.push(pRoot);

        <span class="hljs-comment">// 当两个栈都为空时，遍历结束</span>
        <span class="hljs-keyword">while</span> (!stack1.isEmpty() || !stack2.isEmpty()) {
            ArrayList&lt;Integer&gt; levelList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            <span class="hljs-keyword">if</span> (!stack1.isEmpty()) {
                <span class="hljs-comment">// 处理stack1（奇数层），其子节点将以“从右到左”的顺序压入stack2</span>
                <span class="hljs-keyword">while</span> (!stack1.isEmpty()) {
                    <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack1.pop();
                    levelList.add(node.val);
                    <span class="hljs-comment">// 关键：先左子节点后右子节点入栈，出栈顺序则为先右后左</span>
                    <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) stack2.push(node.left);
                    <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) stack2.push(node.right);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 处理stack2（偶数层），其子节点将以“从左到右”的顺序压入stack1</span>
                <span class="hljs-keyword">while</span> (!stack2.isEmpty()) {
                    <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack2.pop();
                    levelList.add(node.val);
                    <span class="hljs-comment">// 关键：先右子节点后左子节点入栈，出栈顺序则为先左后右</span>
                    <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) stack1.push(node.right);
                    <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) stack1.push(node.left);
                }
            }
            result.add(levelList);
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)。每个节点被压入栈和弹出栈各一次。</li>
<li><strong>空间复杂度</strong>：O(n)。两个栈在最坏情况下共同存储 n 个节点。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年，第二款创业项目，pxcharts超级表格，最新进展来啦]]></title>    <link>https://juejin.cn/post/7591972586360258579</link>    <guid>https://juejin.cn/post/7591972586360258579</guid>    <pubDate>2026-01-06T00:53:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591972586360258579" data-draft-id="7591697558377250858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年，第二款创业项目，pxcharts超级表格，最新进展来啦"/> <meta itemprop="keywords" content="前端,GitHub,React.js"/> <meta itemprop="datePublished" content="2026-01-06T00:53:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="徐小夕"/> <meta itemprop="url" content="https://juejin.cn/user/3808363978429613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年，第二款创业项目，pxcharts超级表格，最新进展来啦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363978429613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    徐小夕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:53:16.000Z" title="Tue Jan 06 2026 00:53:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>"当我们的表格越来越宽，列数从10到50再到100，我终于意识到：数据不是扁平的，是我们把它压扁了。"</p>
</blockquote>
<p>作为一个在数据可视化领域摸爬滚打多年的开发者+创业者，我今天想和大家聊聊我们最新的AI产品 <strong>pxcharts</strong> 多维表格，以及我最近上线的新功能——<strong>子记录</strong>。（子记录功能已上线，大家感兴趣可以体验一下）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc8ed50de5f942b38016cce6da20ef0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=sTblEsZH1W2a0rPOU1OKu2irfBI%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">pxcharts是什么？</h2>
<p>简单说，pxcharts 是我们团队精心打造的AI多维表格产品。但这样讲太官方了，让我换个说法：</p>
<p>它是我对"<strong>如果Excel生在2024年，会长什么样</strong>"这个问题的回答。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e39689953ca4b8c8d58847032fb7cce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=jJNK0bIeCQhgWyZXWBoYxCkGl9U%3D" alt="图片" loading="lazy"/></p>
<p>传统的电子表格像一张无限大的纸，我们在这张纸上"摊大饼"——不断增加列、不断增加行，直到这张"饼"大到我们自己也找不到想要的数据。pxcharts想做的，是让数据<strong>自然生长</strong>而不是<strong>被动堆砌</strong>。</p>
<p>最近我们花了大量精力在设计和实现子记录功能（当然也是用户反馈最多的问题），好在今天终于实现了，下面我就和大家分享一下这个功能。</p>
<p>同时为了让大家更好的理解和研究多维表格， 我开源了一个基础版本的多维表格，大家也可以学习参考一下：</p>
<p>github 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fpxcharts" target="_blank" title="https://github.com/MrXujiang/pxcharts" ref="nofollow noopener noreferrer">github.com/MrXujiang/p…</a></p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpxcharts.turntip.cn" target="_blank" title="https://pxcharts.turntip.cn" ref="nofollow noopener noreferrer">pxcharts.turntip.cn</a></p>
<p>ps：后续我会定期同步我们创业的进展，大家有好的想法，建议，也欢迎随时交流反馈～</p>
<h2 data-id="heading-1">子记录：让表格有了"层级思维"</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ccb1be1630547b48231f0a2b3dff836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=k06d8S7M9SCvaDt3xaKcokXJTuw%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-2">它是怎么工作的？</h3>
<p>想象这样一个场景：我们在管理一个产品需求表格，每一行是一个需求。但很快我们会发现，每个需求下面还有子任务，子任务下面还有Bug，Bug下面还有测试用例...</p>
<p>传统的做法是：</p>
<ul>
<li>新建一个"子任务"列，用逗号分隔所有子任务</li>
<li>或者干脆新建一张"子任务表"，然后用VLOOKUP来回查找</li>
<li>最糟糕的是，直接把子任务作为新行添加，然后手动维护层级关系</li>
</ul>
<p>pxcharts 的子记录功能做了件底层复杂（数据结构设计）但非常有价值的事：<strong>让表格行也能"生孩子"</strong> 。</p>
<p>右键点击任意行序号 → "创建子记录" → 一个新的子行就出现了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b89f859581142bf80dabfa5137b8266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=u02y8a2rt8EhQjKVk5XxpVLRTv0%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">为什么这样设计？</h3>
<p>这个设计背后有三个核心思考：</p>
<p><strong>1. 数据本来就有层级，我们只是还原它</strong></p>
<p>看看我们周围的世界：</p>
<ul>
<li>公司 → 部门 → 团队 → 个人</li>
<li>产品 → 模块 → 功能 → 用户故事</li>
<li>年 → 季度 → 月 → 周 → 日</li>
</ul>
<p>层级是信息的自然组织方式。扁平化只是为了适应工具限制而做的妥协。</p>
<p>虽然在设计多维表格初期，我的设计哲学一直是把复杂的事情做简单，但是通过市场的辩证之后，我还是“妥协”了。</p>
<p><strong>2. 局部细节不应该污染整体视图</strong></p>
<p>传统表格的问题在于，为了容纳所有细节，我们不得不不断增加列。最后得到一个50列的"巨表"，但90%的时间我们只需要看前5列。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cc91679fb0b42beb34e98aa6ade17f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=Hg5ikEzP8W6otUkIIsYOkNy4GyQ%3D" alt="图片" loading="lazy"/></p>
<p>子记录让"细节待在细节该待的地方"——只有当你需要看某个需求的子任务时，才展开它；其他时候，它安安静静地待在父行里。</p>
<p><strong>3. AI时代，结构化比堆砌更重要</strong></p>
<p>AI擅长处理结构化数据，但不擅长从一堆扁平的数据中还原层级关系。</p>
<p>通过子记录，我们让数据结构自带"上下文"，这让AI能更好地理解数据间的关系，提供更智能的建议。</p>
<h2 data-id="heading-4">那么，什么时候该用子记录呢？</h2>
<p>经过这几天的内测（已有100人获取到了内测码并频繁使用），我发现子记录在几个场景下特别有用：</p>
<h3 data-id="heading-5">1. 产品需求管理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d70359b9cb4a8780eea2f66895644c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=FQIuflUAp2W%2FPMsbcFcx8jwRAVg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">2. 项目任务拆解</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf9da5e247504c2081c112c3c875f36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=nnEl56HptFuf1gTtrm1Aq3eYOLU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">3. 知识库组织</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532a955d10054e018eb27addbe8e397c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=%2FSfIsMQBiwUibRTnnYAFl5Tbask%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">4. 客户跟进管理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/058bf7b3c2da4a36ad8d0a58524d2558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=%2BfQLWHB59bKb11%2FYrwYRQ55LLxE%3D" alt="image.png" loading="lazy"/></p>
<p>当然还有很多场景，大家可以慢慢探索，后续我也会持续迭代，上线更多高价值的功能。</p>
<h2 data-id="heading-9">技术实现的小心思</h2>
<p>作为技术博主，我知道你们肯定好奇这个功能是怎么实现的。简单说几个关键点：</p>
<p><strong>数据结构</strong>：我们采用了邻接表模型+物化路径的混合方案。这样既支持高效的层级查询，又便于权限控制和数据导出。</p>
<p><strong>前端渲染</strong>：虚拟滚动是必须的，但层级缩进让问题复杂化了。我们的解决方案是"分层虚拟滚动"——每一层都有自己的虚拟滚动容器。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7c25d03b6754fed91b576870f457e45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265595&amp;x-signature=uto47JW5tth%2BqpAScXEC%2FqF4iHc%3D" alt="图片" loading="lazy"/></p>
<p><strong>AI集成</strong>：子记录让AI有了"上下文感"。比如当你在一个需求下创建子记录时，AI会基于父需求的内容智能推荐子任务的标题和属性。</p>
<h2 data-id="heading-10">开源，是为了更好的共创</h2>
<p>pxcharts 我提供了一个开源版本，GitHub地址我放在文末了。为什么开源？</p>
<p>因为我觉得<strong>数据组织方式的革新，不应该被某个产品独占</strong>。</p>
<p>我们每天都在和表格打交道，但表格的形态几十年没变过了。也许通过开源，我们能一起探索出更多有趣的可能性。</p>
<h2 data-id="heading-11">写在最后</h2>
<p>回到开头的那个比喻：数据不是扁平的，是我们把它压扁了。</p>
<p>子记录功能只是一个开始。我们还在实验更多让数据"自然生长"的功能：智能分组、动态视图、关系图谱...</p>
<p>如果大家也对<strong>让数据回归本真形态</strong>感兴趣，欢迎参考 <strong>pxcharts</strong>。</p>
<p>毕竟，在AI时代，<strong>结构化的思考</strong>比<strong>堆砌的数据</strong>更有价值。</p>
<p>而一个好的工具，应该让思考更自然，而不是更复杂。</p>
<hr/>
<p><strong>GitHub地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fpxcharts" target="_blank" title="https://github.com/MrXujiang/pxcharts" ref="nofollow noopener noreferrer">github.com/MrXujiang/p…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[淘一淘七载征途 技术深耕守本初]]></title>    <link>https://juejin.cn/post/7591702898080841743</link>    <guid>https://juejin.cn/post/7591702898080841743</guid>    <pubDate>2026-01-06T00:53:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591702898080841743" data-draft-id="7591697558377152554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="淘一淘七载征途 技术深耕守本初"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-06T00:53:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            淘一淘七载征途 技术深耕守本初
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:53:56.000Z" title="Tue Jan 06 2026 00:53:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>本系列为 Android 技术职场题材虚构小说，所有登场人物、公司名称、组织架构及相关情节均为创作所需虚构而来，若有雷同，纯属偶然。书中涉及的技术知识经专业梳理，仅供参考。</em></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/459c1573ddbe4deeb9d09490c234445a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265636&amp;x-signature=efJnBiP%2FJS9Qq%2BVF9eI5XWYV9VQ%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-0">八）淘一淘七载征途 技术深耕守本初</h2>
<p>第二天一早，小安踩着上班铃冲到了老杨工位前，身后的发束随着跑动轻快地扫过肩头，手里还攥着半杯没喝完的豆浆，语气里满是急切：“老杨老杨，昨天你讲到在淘一淘解决了商品列表等很多问题，后来呢？你在淘一淘还经历了啥？后来为啥来我们公司了？”</p>
<p>老杨刚打开电脑，正在加载开发环境，闻言抬眼笑了笑，故意调侃道：“这都上班点了，你不先去忙自己的事？没工作吗？”</p>
<p>小安把豆浆往桌角一放，眨了眨眼，理直气壮地说：“工作哪有听你讲职场经历、吃技术大牛的瓜重要！快说快说。”</p>
<p>老杨被她逗乐了，指了指旁边的空位：“行吧，先坐下来，别急。”</p>
<p>小安连忙拉过椅子坐下，眼神里满是期待。晓雅和阿泽、博文也陆续走到工位，听到两人的对话，纷纷围了过来——昨天老杨讲的职场经历，让这几个实习生都听得入了迷。</p>
<p>老杨指尖在桌面上轻轻敲击，像是在梳理那些在淘一淘跨越七年的技术印记，缓缓开口：“列表优化只是起点，真正的成长，是在一次又一次的项目迭代里熬出来的。”</p>
<p>......</p>
<p>2016年，老杨入职淘一淘的第一年。</p>
<p>......</p>
<p>当时淘一淘正面临一个棘手的问题：随着功能迭代，APP 的 <strong>APK</strong> 体积从最初的18M飙升到了90M，很多低内存机型用户反馈下载慢、安装后占用空间过大，卸载率居高不下。</p>
<p>技术总监王哥把优化 <strong>APK</strong> 体积的任务交给了老杨所在的小组，明确要求“在不削减核心功能的前提下，把体积压缩到60M以内”。</p>
<p>“这可不是简单删几个文件就能解决的。”小组开会时，组长敲着桌子强调，“大家先把 <strong>APK</strong> 包解压缩，分析清楚体积增长的根源。”</p>
<p>老杨主动承担了资源分析的工作。</p>
<p>他用 Android Studio 的分析工具拆解 <strong>APK</strong>，发现问题主要出在三个地方：一是未优化的图片资源占了近16M，二是引入的第三方库存在大量未使用的代码，三是包含了适配所有 CPU 架构的原生库。</p>
<p>“我有个思路。”老杨在第二次小组会上拿出了详细方案，“首先用 <strong>WebP</strong> 格式替换所有 <strong>PNG</strong> 和 <strong>JPEG</strong> 图片，这种格式压缩率比 <strong>PNG</strong> 高不少，而且画质损失很小；然后启用代码压缩工具，移除未使用的类和方法；最后通过 <code>abiFilters</code> 配置，配合应用市场分包策略，让用户只下载和自己机器 CPU 架构相关的安装包，剔除其他小众架构的原生库，进一步减小用户实际下载体积。”</p>
<p>方案得到了一致认可，但执行过程中却遇到了阻碍：第三方库中的部分代码通过反射调用，直接用 <strong>ProGuard</strong> 压缩会导致功能异常。</p>
<p>老杨熬夜研究 <strong>ProGuard</strong> 规则，逐一排查反射调用的类和方法，在配置文件中用 <code>-keep</code> 规则显式保留这些类和方法，终于解决了问题。</p>
<p>经过一个月的优化，<strong>APK</strong> 体积成功压缩到60.8M，下载转化率提升了17%。</p>
<p>王哥在部门例会上特意表扬了老杨：“优化不是蛮干，要精准定位问题，用对技术工具，这一点老杨做得很到位。”</p>
<p>这次优化让老杨对 Android 构建流程和资源管理有了深刻理解，也让他养成了“开发即优化”的习惯——后续开发新功能时，他总会提前考虑资源占用，避免再出现体积臃肿的问题。</p>
<p>16年末，团队做 Android 5.0 系统适配已过去一年多，项目虽早已落地收尾，但老杨发现不少同事对 <strong>ART</strong> 与 <strong>Dalvik</strong> 两种运行时的差异仍一知半解，后续开发中还时不时冒出适配相关的小问题。</p>
<p>为彻底打通这个技术堵点，帮团队夯实基础，部门专门组织了一场专题技术分享会。凭借扎实的适配经验和对运行时原理的深入研究，老杨主动接下了这次分享任务。</p>
<p>分享会上，老杨结合提前备好的流程图，把核心区别讲得条理清晰。</p>
<p>“<strong>Dalvik</strong> 用的是 <strong>JIT</strong> 即时编译，运行时才把字节码转成机器码，这种方式启动快，但运行效率不稳定；<strong>ART</strong> 则是 <strong>AOT</strong> 预编译，安装时就完成转换，虽然首次安装费点时间，但后续运行更流畅、功耗也更低。”</p>
<p>他还结合淘一淘 APP 的真实运行数据，拆解两种运行时对性能的实际影响，讲解得通俗易懂，让在场同事都能听明白。</p>
<p>分享一结束，王哥率先起身鼓掌，赞许道：“老杨把复杂的底层逻辑讲得明明白白，还贴紧咱们的业务场景，这趟分享全是干货！”</p>
<p>这场分享也让老杨在部门内的技术话语权更扎实了。</p>
<p>时间一晃来到2017年，入职淘一淘两年的老杨已能独立承接核心任务。</p>
<p>这一年，淘一淘计划推出“离线缓存”功能，用户可在 WiFi 环境下缓存商品数据，离线时也能查看，这个功能的核心难点是文件系统的安全与高效管理，老杨再次挑起重担。</p>
<p>“用户缓存的商品数据包含价格、详情等敏感信息，必须保证安全，同时要考虑不同设备的存储情况，避免占用过多空间。”老杨在需求评审会上说道。</p>
<p>他深入研究了 Android 文件系统的分区结构，最终决定将缓存数据存储在 <code>/data</code> 分区的应用私有目录下——这里的文件只有当前应用可访问，符合安全要求，更关键的是，应用私有目录无需申请任何存储权限，这对开发来说是极大利好，能避免权限申请被用户拒绝的问题。</p>
<p>同时，他设计了一套针对内存缓存的管理策略：通过 <code>ActivityManager</code> 监控设备内存状态，低内存时自动清理过期缓存；限制单个用户的缓存上限，超过上限则按“最近最少使用”原则删除数据。</p>
<p>“离线缓存”功能上线后广受好评，用户离线使用时长提升了25%，更重要的是，由于采用了严格的文件安全策略，没有出现任何数据泄露问题。这次项目让老杨对 Android 文件系统的权限控制和安全模型有了更深入的理解。</p>
<p>2018年，淘一淘的用户量突破1亿，多进程管理成为制约体验的技术瓶颈——当时应用的多个组件运行在同一个进程中，导致内存占用过高，在低配置机型上频繁被系统杀死。</p>
<p>老杨主导了多进程优化项目，他在 <code>AndroidManifest.xml</code> 中通过 <code>android:process</code> 属性，将后台下载服务、推送服务等组件分配到独立进程中：“这样一来，不同功能模块的进程相互隔离，即使后台服务进程被杀死，也不会影响前台 UI 的正常运行。”</p>
<p>但多进程也带来了新的问题：进程间的通信和数据共享变得复杂。</p>
<p>老杨调研后，选择用 <code>ContentProvider</code> 实现进程间的数据共享，这是 Android 系统提供的跨进程通信组件，支持对集中式数据库的读写，安全性和稳定性都有保障，很适合当前的应用场景。</p>
<p>同时，他还优化了进程优先级管理：通过提升前台 UI 进程的优先级，确保用户交互时不被系统杀死；对后台进程设置合理的保活策略，既保证核心功能正常，又不占用过多系统资源。</p>
<p>多进程优化后，淘一淘 APP 的内存占用降低了15%，后台服务的稳定性提升了60%。</p>
<p>此时的老杨，已经成长为淘一淘技术部的资深工程师，能够独立主导核心项目的技术方案设计。</p>
<p>时间推进到2021年8月，距离老杨2016年入职淘一淘已经六年。</p>
<p>这一年，行业内迎来了一项关键政策调整：Google 正式发布强制要求，所有新上架 Google Play 的应用必须采用 <strong>AAB</strong> 格式提交，不再接受传统 <strong>APK</strong> 上传；即便已上架的存量应用，后续更新也会逐步收紧限制，最终全面切换到 <strong>AAB</strong>格式。</p>
<p>作为需要出海布局的电商平台，淘一淘必须紧跟政策要求完成格式迁移，老杨主动牵头推进淘一淘 APP 从 <strong>APK</strong> 向 <strong>AAB</strong> 的迁移。</p>
<p>他带领团队梳理应用的模块结构，将不同配置的资源和代码拆分成独立的 <code>bundle</code>，并针对非 Google 应用商店的分发场景，制定了“双格式并行”的方案——Google Play 分发 <strong>AAB</strong>，其他渠道仍保留优化后的 <strong>APK</strong>。</p>
<p>迁移过程中，他们遇到了资源拆分不彻底、部分模块兼容性差等问题，老杨带领团队逐一攻克，最终成功完成迁移。</p>
<p>迁移后，用户通过 Google Play 下载的淘一淘 APP 平均体积减小了28%，下载转化率也因此再次提升。</p>
<p>“这近六年，就像跟着 Android 系统和行业规则一起成长。”</p>
<p>老杨的思绪拉回现实，语气中满是感慨，“从2015年刚入职时优化列表项性能，2016年钻研 <strong>APK</strong> 优化起步，之后又陆续跟进了一系列技术迭代项目，最后响应 Google 政策推进 <strong>AAB</strong> 迁移。这一路遇到了不少挑战，但每一次攻克难题，都是一次扎实的成长。”</p>
<p>博文恍然大悟：“杨哥，原来你说的‘技术不是孤立的’是这个意思！优化 <strong>APK</strong> 体积要结合资源优化和代码压缩，做多进程优化还得懂跨进程通信组件的选型，这些知识点都是相互关联的。”</p>
<p>“没错。”老杨点点头，“这也是我把经验文档发给你们的原因，里面不仅记录了我踩过的坑，更梳理了每个技术点的关联逻辑。”</p>
<p>就在这时，老杨的Q书响了，是林卓发来的消息：“老杨，多谢你的指导和鼓励，我一定可以！”</p>
<p>老杨笑着回复：“哈哈，你成长了！遇到问题随时沟通。”</p>
<p>回复完消息，老杨看向眼前的实习生们：“技术成长没有捷径，都是在一次又一次的项目实践中积累起来的。你们现在多学多练，把基础打牢，以后遇到复杂问题自然能从容应对。”</p>
<p>话音刚落，小安忽然想起昨天没问完的问题，眼神亮晶晶地追问：“杨哥，你在淘一淘待了六年，从新人成长为资深工程师，按理说发展得顺风顺水，怎么最后会跳槽来我们公司呀？”</p>
<p>听到这个问题，老杨的思绪瞬间被拉回2021年 <strong>AAB</strong> 迁移完成后的那段日子，那些关于技术与业务的挣扎和矛盾清晰浮现。</p>
<p>他的眼神暗了暗，指尖无意识地摩挲着搪瓷杯的杯壁，沉默了几秒才缓缓开口：“主要是后期淘一淘的发展方向，和我对技术的追求越来越相悖了。”</p>
<p>“2021年顺利完成 <strong>AAB</strong> 迁移后，凭借这些年在核心项目中的突出贡献，22年初我正式晋升为 Android 客户端架构师。”</p>
<p>本以为能有更大权限推动技术优化，没想到公司的重心却在这之后彻底偏向了业务流，尤其是疯狂叠加各类引导消费者消费的功能。这些功能看似能快速提升营收，却让我带领团队亲手优化到流畅的 App 变得越来越臃肿，之前耗费大量心血的性能优化成果，几乎被消耗殆尽。</p>
<p>一旁的阿泽好奇地追问：“引导消费具体是怎么实现的呀？跟之前学到的有关系吗？”</p>
<p>“当然相关，而且很多就依托在之前做的多进程架构里。”老杨点头，语气里带着几分无奈。</p>
<p>“等用户打开 App 搜索购物时，系统就会根据这份个人画像，在搜索结果里插入一部分推荐商品。这些商品根本不是用户原本想要搜索的品类，却会被算法包装得格外吸引人——比如用大幅优惠标签、‘千人千面专属推荐’的话术，再配上高清的宣传图，就是为了让用户忍不住点进去。”</p>
<p>“这些推荐商品的商家，会给公司支付高额的广告费，排名越靠前，费用越高。为了多赚广告费，后期插入的推荐商品越来越多，有时候用户搜一件商品，前半页全是推荐，真正需要的结果反而被压到了后面。”</p>
<p>晓雅皱了皱眉：“这样一来，用户体验不就变差了吗？而且后台一直运行个人画像服务，肯定会增加内存占用和功耗吧？”</p>
<p>“你说的没错。”老杨叹了口气，“我当时就提出，要控制推荐商品的数量，还要优化个人画像服务的运行策略，避免过度占用资源。但领导根本不听，还说我‘只懂技术不懂业务’，让我只管保证功能正常运行，不用管优化的事。”</p>
<p>“那段时间，公司还在不停地加新的营销功能，一会儿加弹窗式优惠券提醒，一会儿加限时秒杀的倒计时悬浮窗，还有各种分享助力的弹窗。这些功能大多是紧急上线，代码写得很粗糙，还要求必须常驻前台，根本没有优化的空间。”</p>
<p>“我做了六年的性能优化，就是想让 App 跑得更流畅、用户用得更舒服。可看着自己亲手优化的架构，被这些臃肿的营销功能一点点拖垮，用户反馈的卡顿、闪退问题越来越多，我心里特别难受。”</p>
<p>“最后一次争吵，是因为一个‘全域弹窗推送’的功能。领导要求不管用户在使用哪个页面，只要符合营销条件，就必须弹出推送窗口。我坚决反对，说这个功能会严重影响用户体验，还可能导致支付流程中断，引发用户投诉。”</p>
<p>“但领导根本不考虑这些，只盯着 <strong>KPI</strong> 和广告费，还说我‘阻碍公司发展’。我和他吵得很凶，我说‘技术应该服务于用户，而不是成为收割用户的工具’。吵完之后我就想通了，在那里继续待下去，根本实现不了我的技术追求，所以第二天就提交了辞职申请。”</p>
<p>老杨话音毕，众人安静了好一会儿。</p>
<p>阿泽忍不住小声感叹：“老杨你也太刚了吧！敢直接跟领导这么硬刚，换我肯定没这个勇气。”</p>
<p>博文也点点头：“是啊，为了坚持技术初心放弃稳定的架构师岗位，太佩服了。”</p>
<p>小安身后的发束轻轻晃了晃，眼神里满是敬佩，随即又带着好奇追问：“那老杨，你跳槽来咱们 ByteFlow 之后，感觉咋样呀？会不会比在淘一淘舒服些？”</p>
<p>提到现在的工作，老杨紧绷的神色柔和了些，嘴角泛起一丝浅笑：“感觉还好，ByteFlow 的氛围更务实，不会为了短期营收牺牲用户体验，技术决策也更尊重工程师的专业意见，没那么不近人情。”</p>
<p>说着，他话锋一转，看向几个实习生认真叮嘱：“不过你们可别学我当初那样冲动辞职。我当时也是年轻气盛，脑子一热就提交了辞职申请，现在回想起来其实挺危险的——裸辞之后的职业空窗期、新工作的不确定性，都是要承担的风险。”</p>
<p>“认真想想，当初的问题未必没有更好的解决方案。比如我可以试着找领导做更详细的利弊分析，用数据证明过度营销会导致用户流失；也可以联合团队里有相同想法的同事一起推动改变，而不是一味硬碰硬。冲动辞职，其实是不负责任，也是最冒险的选择。”</p>
<p>“比如我可以试着找领导做更详细的利弊分析，用数据证明过度营销会导致用户流失；也可以联合团队里有相同想法的同事一起推动改变，而不是一味硬碰硬。冲动辞职，其实是不负责任且最冒险的选择。”</p>
<p>阳光透过落地窗洒在几人的身上，将他们的身影拉得很长。办公区的键盘敲击声渐渐密集起来，新的技术故事，正在这里悄悄开启。</p>
<p>而另一边，刚收到老杨鼓励的林卓，正对着电脑屏幕上复杂的项目需求眉头紧锁——一场属于他的技术挑战，已悄然拉开序幕。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# 前端年度盘点 2025：定义这一年的 10 个核心大事件]]></title>    <link>https://juejin.cn/post/7591744411738849280</link>    <guid>https://juejin.cn/post/7591744411738849280</guid>    <pubDate>2026-01-06T00:57:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744411738849280" data-draft-id="7591703562134601762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# 前端年度盘点 2025：定义这一年的 10 个核心大事件"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-06T00:57:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # 前端年度盘点 2025：定义这一年的 10 个核心大事件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:57:02.000Z" title="Tue Jan 06 2026 00:57:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ffrontend-wrapped-2025%2F" target="_blank" title="https://blog.logrocket.com/frontend-wrapped-2025/" ref="nofollow noopener noreferrer">Frontend Wrapped 2025: The 10 storylines that defined the year - LogRocket Blog</a></p>
<p>翻译：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.heyfe.org%2Fblog" target="_blank" title="https://blog.heyfe.org/blog" ref="nofollow noopener noreferrer">嘿嘿</a></p>
</blockquote>
<blockquote>
<p>📢 <strong>宣言</strong>：<strong>每周更新国外论坛的前端热门文章，推荐大家阅读/翻译，紧跟时事，掌握前端技术动态，也为写作或突破新领域提供灵感~</strong></p>
<p>欢迎大家访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">github.com/TUARAN/fron…</a>
顺手点个 ⭐ star 支持，是我们持续输出的续航电池🔋✨！</p>
<p>在线网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffwdc.pages.dev%2F" target="_blank" title="https://fwdc.pages.dev/" ref="nofollow noopener noreferrer">fwdc.pages.dev/</a></p>
</blockquote>
<p>2025 年对前端开发者来说简直是一场情绪过山车。过去这一年里，我们见证了各个角落的疯狂改进、大规模安全漏洞，以及框架的重新发明。AI 霸占了头条，改变了我们构建应用的方式。一些大牌（TanStack、CSS、TypeScript）带来了重大更新，为 2026 年及以后开辟了新的可能性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47bffc8de6d54955b45d35b2a53a9004~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266049&amp;x-signature=t6vZptGdrJ81loGuD168y7q%2Fd9Y%3D" alt="image.png" loading="lazy"/></p>
<p>这次我不打算做传统的年度回顾，而是根据两个标准对今年最重大的前端事件进行排名：它们引发的热度以及对我们构建 Web 应用方式的持久影响。我们从第 10 位最重要的故事线开始，一路倒数到我认为最能定义 2025 年前端开发的那个事件。</p>
<h2 data-id="heading-0">1. TypeScript 继续统治地位</h2>
<p>TypeScript 在 2025 年<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.blog%2Fdeveloper-skills%2Fprogramming-languages-and-frameworks%2Ftypescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg%2F" target="_blank" title="https://github.blog/developer-skills/programming-languages-and-frameworks/typescripts-rise-in-the-ai-era-insights-from-lead-architect-anders-hejlsberg/" ref="nofollow noopener noreferrer">表现得太好了</a>：</p>
<ul>
<li>npm 每周下载量达 6000 万次（2021 年为 2000 万次）</li>
<li>420 万个 GitHub 仓库在使用 TypeScript</li>
<li>前 100 个 npm 库中超过 80% 都附带 TypeScript 类型定义</li>
</ul>
<p>TypeScript 并不是要取代 JavaScript；它就是开发者现在编写 JavaScript 的方式。大多数代码库都是用 TypeScript 编写，然后编译成 JavaScript（就像 Sass 编译成 CSS 一样）。你能获得类型安全、更好的工具、真正好用的自动补全，以及在有类型代码下性能提升 20% 的 AI 编码助手。</p>
<h2 data-id="heading-1">2. Tailwind CSS 地位稳固</h2>
<p>Tailwind 在 2025 年获得了大规模采用，而 styled-components 和其他运行时 CSS 解决方案则失宠了。现在有超过 61.7 万个网站在使用 Tailwind，它已经成为现代 React 应用的默认样式选择。"写内联样式"的批评声彻底消失了；我觉得现在大家都默认用 Tailwind 了，这已经不是个需要争论的问题。</p>
<h2 data-id="heading-2">3. 服务端渲染（SSR）无处不在</h2>
<p>SSR 在 2025 年不再是"锦上添花"，而是成了必需品。每个主流框架都全力投入：Next.js 将其设为默认，<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fremix-3-ditched-react%2F" target="_blank" title="https://blog.logrocket.com/remix-3-ditched-react/" ref="nofollow noopener noreferrer">Remix</a>/React Router v7 围绕它构建一切，<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ftanstack-start-overview%2F" target="_blank" title="https://blog.logrocket.com/tanstack-start-overview/" ref="nofollow noopener noreferrer">TanStack Start</a> 开箱即带 SSR，就连 SvelteKit 和 Astro 也加倍押注服务器优先架构。</p>
<p>性能和 SEO 不再是可选项。Google 的 Core Web Vitals 变得更严格，用户期待页面秒开。但 2025 年的 SSR 不是 2015 年那种笨重的服务器渲染。</p>
<p>现代 SSR 很聪明：框架现在支持部分水合（只有交互部分需要 JavaScript）、流式 SSR（HTML 准备好就发送）和选择性水合（先水合可见部分）。React Server Components 更进一步，让你可以在服务器上获取数据，而不用把那些逻辑发送到客户端。</p>
<h2 data-id="heading-3">4. Shai Halud npm 攻击事件</h2>
<p>React 在 2025 年末在安全方面遇到了麻烦（稍后会详细说）——但今年它们不是唯一的受害者。</p>
<p>npm 生态系统也遭遇了不少攻击。9 月份，攻击者发起了一场<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DFi5d83gi9cM" target="_blank" title="https://www.youtube.com/watch?v=Fi5d83gi9cM" ref="nofollow noopener noreferrer">协同供应链攻击</a>，分两波展开。首先，9 月 8 日，chalk、debug 和 ansi-styles 等包——这些库每周总下载量达 26 亿次——通过对维护者账户的钓鱼攻击被攻陷。</p>
<p>注入的恶意软件针对加密货币交易。然后出现了 Shai Hulud 蠕虫（以《沙丘》中的沙虫命名）。这个自我复制的恶意软件攻击了超过 180 个包，窃取凭证并自动传播到被攻陷维护者控制的其他包。</p>
<p>与传统攻击不同，这是蠕虫式的：当它在环境中发现 npm token 时，会自动发布任何可访问包的恶意版本，无需人工干预就能指数级传播。可怕的是规模和自动化程度。</p>
<p>如果你在攻击窗口期运行 npm install，就可能拉取到恶意代码。npm 团队和维护者反应迅速，但损害已经造成；数千个项目暴露在风险中，整个生态系统花了几周时间审计依赖项和替换凭证。</p>
<h2 data-id="heading-4">5. CSS 干掉了更多 JavaScript</h2>
<p>2025 年的 CSS 不再只是关于样式；它变成了一门编程语言。浏览器厂商全力投入原生 CSS API，这些 API 能消除整个 JavaScript 库的存在，说实话，早该如此了。口号很明确：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fstop-using-js-for-css" target="_blank" title="https://blog.logrocket.com/stop-using-js-for-css" ref="nofollow noopener noreferrer">少用 JavaScript，多用 CSS</a>。</p>
<h3 data-id="heading-5"><strong>Anchor Positioning（锚点定位）</strong></h3>
<p>Anchor Positioning 在 2025 年在 Safari 中达到生产就绪状态，加入了 Chrome 的现有支持。虽然 Firefox 还只是实验性支持，但该功能现在可以在支撑大部分 Web 的两个浏览器中使用。它允许开发者相对于其他元素定位工具提示、弹出框和下拉菜单，无需 JavaScript。</p>
<h3 data-id="heading-6"><strong>Scroll-Driven Animations（滚动驱动动画）</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fimplementing-scroll-aware-ui-state-css%2F" target="_blank" title="https://blog.logrocket.com/implementing-scroll-aware-ui-state-css/" ref="nofollow noopener noreferrer">这些动画</a>在 2025 年显著成熟，在主线程外运行，实现丝滑的 60fps 性能。你不用再写 Intersection Observer JavaScript，可以使用 <code>animation-timeline: scroll()</code> 或 <code>view()</code> 将动画直接绑定到滚动位置。</p>
<p>Chrome 提供了完整支持，你甚至可以基于哪个元素被吸附或滚动器是否可滚动来制作动画，使用 Chrome 133 中引入的新 <code>@container scroll-state()</code> 查询。</p>
<h3 data-id="heading-7"><strong>Container Queries（容器查询）</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fcss-container-queries-guide%2F" target="_blank" title="https://blog.logrocket.com/css-container-queries-guide/" ref="nofollow noopener noreferrer">容器查询</a>达到了 100% 的浏览器支持，成为基于组件设计的默认选择。组件现在可以响应<strong>父元素的宽度</strong>而不是视口宽度（<code>@container (min-width: 600px)</code>），使真正可复用的组件成为可能。再配合<strong>CSS 嵌套</strong>（现在所有浏览器都原生支持），你就能在不用 Sass 的情况下编写组件作用域样式。</p>
<h3 data-id="heading-8"><strong>CSS <code>if()</code> 函数</strong></h3>
<p>它<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fcss-if-function-conditional-styling-2025%2F" target="_blank" title="https://blog.logrocket.com/css-if-function-conditional-styling-2025/" ref="nofollow noopener noreferrer">终于来了</a>，将<strong>条件逻辑直接带入 CSS</strong>。你现在可以写 <code>background: if(style(--theme: dark), black, white)</code> 来根据自定义属性或样式查询有条件地应用值。</p>
<h2 data-id="heading-9">6. Rust 的复兴</h2>
<p>前端工具在 2025 年经历了我所说的身份危机，而 Rust 就是我们需要的疗法。以前需要几分钟的构建工具现在几秒钟就完成了，因为生态系统意识到用 JavaScript 来构建 JavaScript 不够快。</p>
<p>始于 2024 年末的 Rust 浪潮在 2025 年成为标准。Rspack 在 2024 年 8 月发布 1.0 版本，构建速度提升 23 倍（Webpack 的 6.5 秒 → 282ms），在 2025 年获得了大规模企业采用。</p>
<p>Vercel 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fturbopack-adoption-guide%2F" target="_blank" title="https://blog.logrocket.com/turbopack-adoption-guide/" ref="nofollow noopener noreferrer">Turbopack</a> 成为 Next.js 15 的默认选择，提供快 700 倍的 HMR。SWC 取代 Babel 成为默认转译器，编译速度快 20 倍。Biome 作为 ESLint 和 Prettier 的 Rust 驱动替代品出现，而 Oxc 提供了用于解析、检查、格式化和压缩的完整 Rust 工具链。</p>
<p>微软、亚马逊、Discord、TikTok 和抖音等公司在 2025 年都在生产环境中采用了这些工具。Rust 复兴不是选择；这是必然。当你的构建耗时，CI 流水线花钱时，你要么用 Rust 重写，要么接受现状。2025 年证明了，如果性能很重要，就会用 Rust 重写。欢迎来到锈化时代。</p>
<h2 data-id="heading-10">7. TanStack 生态系统的崛起</h2>
<p>TanStack 在 2025 年悄悄接管了 React 开发，说实话，大多数开发者（包括我）甚至没看到它的到来。最初作为 React Query（一个数据获取库）起步的东西，演变成了一个完整的生态系统，现在正在取代 Redux、React Router 和开发者多年来一直使用的其他一堆工具。</p>
<p>TanStack 创建者 Tanner Linsley 两年前全力投入开源，这次押注大获成功。TanStack 现在有超过 40 亿次下载，涵盖从数据获取（TanStack Query）、路由（TanStack Router）、表格（<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ftanstack-table-formerly-react-table%2F" target="_blank" title="https://blog.logrocket.com/tanstack-table-formerly-react-table/" ref="nofollow noopener noreferrer">TanStack Table</a>）、表单、虚拟化，甚至还有一个叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ffull-stack-app-with-tanstack-start%2F" target="_blank" title="https://blog.logrocket.com/full-stack-app-with-tanstack-start/" ref="nofollow noopener noreferrer">TanStack Start</a> 的全栈框架。</p>
<p>最疯狂的是什么？他们今年在路由匹配上实现了 20,000 倍的性能提升，只是通过追求正确性而非速度。每个库都是无头的、类型安全的、框架无关的，这意味着你能获得完全控制而不会被框架锁定。</p>
<p>到 2025 年底，TanStack 成为需要认真处理数据的 React 应用的默认推荐。Next.js 等框架仍然占主导地位，但如果你用 Vite 构建自定义技术栈或想完全控制架构，TanStack 就是新标准。要说 TanStack Router 的最大的问题，就是一旦你用过它，回到其他路由解决方案就会感觉很痛苦；你会被它的开发体验和类型安全宠坏。</p>
<h2 data-id="heading-11">8. React 19.2 带来无处不在的异步</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Freact-19-2-is-here%2F" target="_blank" title="https://blog.logrocket.com/react-19-2-is-here/" ref="nofollow noopener noreferrer">React 19.2 版本</a>引发了巨大关注，理由充分。在它发布之前，每一次表单提交、导航点击和搜索框都需要一套组合拳：用 <code>useState</code> 处理加载状态，用 try-catch 处理错误，用 <code>useEffect</code> 协调，然后祈祷你没制造出竞态条件。</p>
<p>React 19 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fthe-next-era-of-react%2F" target="_blank" title="https://blog.logrocket.com/the-next-era-of-react/" ref="nofollow noopener noreferrer">彻底改变了游戏规则</a>。在 React Conf 2025 上，团队发布了"Async React"，这是一个使用 React 19 的新原语（如 <code>useTransition</code>、<code>useOptimistic</code> 和 <code>use()</code>）以及 React 18 的 Suspense 和并发特性来声明式处理异步操作的完整系统。</p>
<p>现在 Actions 自动跟踪异步工作（再见 <code>isLoading</code> 标志），乐观更新让 UI 在服务器请求后台运行时感觉即时响应，Suspense 处理加载状态而不会出现刺眼的加载动画闪烁，<code>useDeferredValue</code> 让搜索框即使在慢速连接下也保持流畅。<a href="https://link.juejin.cn?target=https%3A%2F%2Fasync-react.dev%2F" target="_blank" title="https://async-react.dev/" ref="nofollow noopener noreferrer">Async React 演示</a>展示了其可能性：在任何网络速度下都有流畅的用户体验，零手动状态跟踪。</p>
<p>最棒的部分是框架为我们内置了这些。Next.js 现在默认将导航包装在 transitions 中。TanStack Query 内置了 Suspense 支持。设计系统开始暴露"action"属性，所以按钮和标签页能处理自己的乐观更新。</p>
<p>所有那些异步协调的复杂性从我们的代码转移到了框架层。我们从手动跟踪每个加载状态，变成只需描述应该发生什么，React 处理其余部分。大量样板代码就这么消失了，太疯狂了。我不知道为什么花了这么长时间，但说实话，我们不能否认<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Freact-19-2-the-async-shift%2F" target="_blank" title="https://blog.logrocket.com/react-19-2-the-async-shift/" ref="nofollow noopener noreferrer">异步协调</a>终于感觉像是属于 2025 年的东西了。</p>
<h2 data-id="heading-12">9. React2Shell 漏洞</h2>
<p>第二个最能定义这一年的故事是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Freact2shell-exploit%2F" target="_blank" title="https://blog.logrocket.com/react2shell-exploit/" ref="nofollow noopener noreferrer">React 2Shell</a>——也就是 CVE-2025-55182——漏洞。</p>
<p>React 经历了有史以来最糟糕的 12 月！11 月 29 日，安全研究员 Lachlan Davidson 在 React Server Components 中发现了一个严重漏洞，CVSS 评分达到完美的 <strong>10.0</strong>，这是可能的最高严重级别。这不是随机的：这是一个未经身份验证的远程代码执行（RCE）漏洞，让攻击者只需一个恶意 HTTP 请求就能在服务器上运行任意代码。</p>
<p>金融应用成为主要目标；一个精心制作的请求就能暴露敏感的银行信息、操纵交易或植入后门以持续访问。运行 React Server Components 的企业仪表板、医疗门户和 SaaS 平台突然成了活靶子。</p>
<p>React 19 的 Server Components 本应改变全栈开发。结果它们成了 React 有史以来最大的安全危机。整个生态系统在 2025 年的最后几天都处于紧急补丁模式。</p>
<p>教训？能力越大（Server Components）责任越大，而且永远、永远要更新你的依赖项。不过值得一提的是，React 团队行动如闪电：从报告到补丁只用了四天。到 12 月 3 日，修复已经发布。</p>
<h2 data-id="heading-13">10. AI 编码工具的持续演进</h2>
<p>我们今年见证了超过 30 个 AI 模型发布：GPT 5、Claude Opus 4.5，以及最近的 Gemini 3 Pro，还有一波中国公司发布的 DeepSeek、Qwen、ByteDance 和 Moonshot。</p>
<p>还不止于此：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fwindsurf-vs-cursor-when-to-choose-the-challenger%2F" target="_blank" title="https://blog.logrocket.com/windsurf-vs-cursor-when-to-choose-the-challenger/" ref="nofollow noopener noreferrer">Windsurf 和 Cursor</a> 之间的智能体大战愈演愈烈，甚至引发了投资者之间的<a href="https://link.juejin.cn?target=https%3A%2F%2Ftechfundingnews.com%2Fcode-wars-openais-3b-bid-for-windsurf-puts-cursor-microsoft-and-anthropic-on-alert%2F" target="_blank" title="https://techfundingnews.com/code-wars-openais-3b-bid-for-windsurf-puts-cursor-microsoft-and-anthropic-on-alert/" ref="nofollow noopener noreferrer">竞价战</a>。</p>
<p>我们看到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fbuild-deploy-web-app-bolt-new%2F" target="_blank" title="https://blog.logrocket.com/build-deploy-web-app-bolt-new/" ref="nofollow noopener noreferrer">Bolt</a> 和 v0 引领了从编程到生产的一站式编码理念。我们的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ftested-5-ai-cli-tools%2F" target="_blank" title="https://blog.logrocket.com/tested-5-ai-cli-tools/" ref="nofollow noopener noreferrer">CLI</a> 也转变成了编码智能体。我们看到 Claude Code 主导了这个领域，还引入了 MCP 的使用。自然地，其他模型也跟进了：Gemini CLI、Qwen CLI、Kimi CLI 和 Codex。</p>
<p>这些行业在改变我们编写前端代码的方式上投入了最多的工作。今年我们几乎每隔一周就有 2 个模型发布，它们专门被增强来取代开发者。我不知道为什么它们这么想抢我们的饭碗，但说实话，我们不能否认它们让我们的生活更轻松了。就像 Spotify 等其他"年度总结"一样，你也得承认这些模型和工具是你今年最常用的 !😂</p>
<h2 data-id="heading-14">结论</h2>
<p>2025 年真是不平凡的一年！</p>
<p>无论是 AI 进步、安全漏洞，还是不断演进的框架，我们经历了大量改变我们对 Web 开发思考方式的事件。</p>
<p>我漏掉了哪些故事？我的排名哪里不对？哪些故事会定义 2026 年？在评论区发声，让我知道你的看法。新年快乐！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[嫌 AI 写的界面太丑？装上这个开源插件，秒变资深设计师]]></title>    <link>https://juejin.cn/post/7591730714140491818</link>    <guid>https://juejin.cn/post/7591730714140491818</guid>    <pubDate>2026-01-06T00:57:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591730714140491818" data-draft-id="7591672090790903827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="嫌 AI 写的界面太丑？装上这个开源插件，秒变资深设计师"/> <meta itemprop="keywords" content="GitHub,开源"/> <meta itemprop="datePublished" content="2026-01-06T00:57:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            嫌 AI 写的界面太丑？装上这个开源插件，秒变资深设计师
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:57:33.000Z" title="Tue Jan 06 2026 00:57:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b41abd5c2414b8c862d669247e7ec81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=8rsrGQ%2BvhCij2tDOoL%2BBjX8kXcY%3D" alt="" loading="lazy"/></p>
<p>2026 年的第一期「GitHub 热点速览」准时上线！新的一年，让我们看看开源社区迎来了哪些有趣、好玩的开源项目。</p>
<p>如果你受够了不明真相的后台进程，不妨试试 witr，一条命令就能把进程查个底朝天。刚开年想给你的 Mac 瘦瘦身？极简清理工具 Mole 既轻量又方便。对于正在使用 AI 编程的朋友，ui-ux-pro-max-skill 能让你的 AI 助手秒变资深 UI 设计师，告别千篇一律、AI 味儿十足的界面。哈佛大学开源的 AI 系统工程课程，带你从零手搓深度学习框架 TinyTorch。</p>
<p>学累了？不妨试试这款被网友直接“封神”的沉浸式桌面歌词工具 BetterLyrics，享受一会儿沉浸式听歌的快乐，劳逸结合才能更好地出发。</p>
<ul>
<li>本文目录
<ul>
<li>1. 热门开源项目
<ul>
<li>1.1 一条命令揭秘进程身世：witr</li>
<li>1.2 开箱即用的地图组件库：mapcn</li>
<li>1.3 极简的 macOS 系统清理工具：Mole</li>
<li>1.4 AI 编程助手的设计增强插件：ui-ux-pro-max-skill</li>
<li>1.5 机器学习系统工程：cs249r_book</li>
</ul>
</li>
<li>2. HelloGitHub 热评
<ul>
<li>2.1 无需发邮件验证邮箱有效性的工具：check-if-email-exists</li>
<li>2.2 沉浸式桌面歌词显示工具：BetterLyrics</li>
</ul>
</li>
<li>3. 结尾</li>
</ul>
</li>
</ul>
<h2 data-id="heading-0">1. 热门开源项目</h2>
<h3 data-id="heading-1">1.1 一条命令揭秘进程身世：witr</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af4a0f74c9164098a932cc4ee56f8520~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=BVG7dX3EWNZaO8w5jAFF%2F6VC%2FC4%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Go</strong>，<strong>Star：9.9k</strong>，<strong>周增长：7.4k</strong></p>
<p>这是一个用 Go 编写的命令行诊断工具，用于快速定位和分析正在运行的进程。它通过端口、服务名或 PID 映射进程信息，生成通俗易懂的进程因果链，直观展示进程的来源、启动方式和持续运行的原因，帮助运维与开发者排查和定位异常进程。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpranshuparmar%2Fwitr" target="_blank" title="https://github.com/pranshuparmar/witr" ref="nofollow noopener noreferrer">github.com/pranshuparm…</a></p>
</blockquote>
<h3 data-id="heading-2">1.2 开箱即用的地图组件库：mapcn</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc6664cda07240dc97faf57bce74ed57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=zXnviHNtUBSEwPzdKEUSvTpK2nA%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：TypeScript</strong>，<strong>Star：3k</strong>，<strong>周增长：3k</strong></p>
<p>该项目是基于 MapLibre GL 和 Tailwind CSS 构建的交互式地图组件，开箱即用无需配置，能够自动适配浅色和深色模式，支持缩放、指南针、定位、标记、弹框和绘制路线等功能，兼容 shadcn/ui 适合 React 生态的开发者。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Map</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/map"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BasicMapExample</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-[400px] w-full"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Map</span> <span class="hljs-attr">center</span>=<span class="hljs-string">{[-74.006,</span> <span class="hljs-attr">40.7128</span>]} <span class="hljs-attr">zoom</span>=<span class="hljs-string">{12}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAnmolSaini16%2Fmapcn" target="_blank" title="https://github.com/AnmolSaini16/mapcn" ref="nofollow noopener noreferrer">github.com/AnmolSaini1…</a></p>
</blockquote>
<h3 data-id="heading-3">1.3 极简的 macOS 系统清理工具：Mole</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fda6c74d3f1343cbbe777ec69593ff3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=YUA0wcPlIDxNeA22k4sANQSGydk%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Shell、Go</strong>，<strong>Star：25k</strong>，<strong>周增长：1.6k</strong></p>
<p>这是一款专为 macOS 设计的轻量级命令行清理工具，集深度清理、应用卸载、硬盘空间分析和实时状态监控于一体。它主要由 shell 编写，安装简单、零干扰（无广告/弹窗/常驻进程），支持白名单和试运行模式，进一步降低误删风险。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftw93%2FMole" target="_blank" title="https://github.com/tw93/Mole" ref="nofollow noopener noreferrer">github.com/tw93/Mole</a></p>
</blockquote>
<h3 data-id="heading-4">1.4 AI 编程助手的设计增强插件：ui-ux-pro-max-skill</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f24c9de7bc5b4fd88ae84bc805e7902c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=H8ZjI3beExaHIdATZUESkXc3b70%3D" alt="截屏2026-01-06 08.37.16.png" loading="lazy"/></p>
<p><strong>主语言：TypeScript</strong>，<strong>Star：6.8k</strong>，<strong>周增长：4.3k</strong></p>
<p>这是一款面向 AI 编程助手的 UI/UX 设计增强插件，赋予 AI 助手生成专业级界面和用户体验的能力。它内置 57 种 UI 风格、95 套调色方案、56 组字体搭配和 98 条 UX 最佳实践规范的知识库，让 AI 摆脱千篇一律的通用样式代码，自动生成具有较高水准视觉效果和良好交互体验的应用界面代码。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># Install CLI globally</span>
npm install -g uipro-cli

<span class="hljs-meta"># Go to your project</span>
cd /path/to/your/project

<span class="hljs-meta"># Install for your AI assistant</span>
uipro <span class="hljs-keyword">init</span> --ai claude      <span class="hljs-meta"># Claude Code</span>
uipro <span class="hljs-keyword">init</span> --ai cursor      <span class="hljs-meta"># Cursor</span>
uipro <span class="hljs-keyword">init</span> --ai windsurf    <span class="hljs-meta"># Windsurf</span>
uipro <span class="hljs-keyword">init</span> --ai antigravity <span class="hljs-meta"># Antigravity (.agent + .shared)</span>
uipro <span class="hljs-keyword">init</span> --ai copilot     <span class="hljs-meta"># GitHub Copilot</span>
uipro <span class="hljs-keyword">init</span> --ai kiro        <span class="hljs-meta"># Kiro</span>
uipro <span class="hljs-keyword">init</span> --ai all         <span class="hljs-meta"># All assistants</span>
</code></pre>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnextlevelbuilder%2Fui-ux-pro-max-skill" target="_blank" title="https://github.com/nextlevelbuilder/ui-ux-pro-max-skill" ref="nofollow noopener noreferrer">github.com/nextlevelbu…</a></p>
</blockquote>
<h3 data-id="heading-5">1.5 机器学习系统工程：cs249r_book</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f138c6ad3e4d72a3a3fd1ffc92d40a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=K6HwQCmTp%2B1Jxtopyz5H5S4arVA%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Other</strong>，<strong>Star：15k</strong>，<strong>周增长：3k</strong></p>
<p>该项目是由哈佛大学开源的 AI 系统工程（CS249r）课程教材，内含书籍和源码。它通过从零实现深度学习框架 TinyTorch 和将模型部署到 Arduino 与树莓派等硬件设备的实践，帮助学习者将机器学习理论与系统工程实践相结合，掌握在实际嵌入式开发中部署 AI 系统的方法。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fharvard-edge%2Fcs249r_book" target="_blank" title="https://github.com/harvard-edge/cs249r_book" ref="nofollow noopener noreferrer">github.com/harvard-edg…</a></p>
</blockquote>
<h2 data-id="heading-6">2. HelloGitHub 热评</h2>
<p>在此章节中，我们将为大家介绍本周 HelloGitHub 网站上的热门开源项目，希望你能从中收获开源神器和编程知识，更欢迎与我们分享你在使用这些<strong>开源项目的体验和评价</strong>，用最真实反馈为开源项目的作者提供动力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6fe9122d8614770b1d7c05c90ada1e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=6ty6dsb7rJm%2BqC7LvihpFiaQcfs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.1 无需发邮件验证邮箱有效性的工具：check-if-email-exists</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc357b38b3e84c7cba6ab3557961e891~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=qWnl%2FmnvBRXCwvy7gy5mpl%2BnlKI%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Rust</strong></p>
<p>这是一款用 Rust 开发的邮箱验证工具，通过正则表达式、DNS、SMTP 等多重校验，在不发送邮件的情况下验证邮箱有效性，支持 API 和 CLI 等使用方式。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2Freacherhq%2Fcheck-if-email-exists" target="_blank" title="https://hellogithub.com/repository/reacherhq/check-if-email-exists" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h3 data-id="heading-8">2.2 沉浸式桌面歌词显示工具：BetterLyrics</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d2875d2fb34e34a0f509c91b5629f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768265852&amp;x-signature=bFvRPtFE7Gh5WD4GmLWlbc5DvP8%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：C#</strong></p>
<p>这是一款专为 Windows 设计的沉浸式歌词显示工具，能够自动识别播放器正在播放的音乐，实时检索本地或在线歌词，并通过流畅动画美观地展示在桌面上。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2Fjayfunc%2FBetterLyrics" target="_blank" title="https://hellogithub.com/repository/jayfunc/BetterLyrics" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h2 data-id="heading-9">3. 结尾</h2>
<p>以上就是本期「GitHub 热点速览」的全部内容，我始终坚信：兴趣是最好的老师！希望这些开源项目能激发你的兴趣，让你找到下一个想尝试和学习的开源项目。如果你也发现了好玩、有趣的 GitHub 开源项目想要分享，欢迎来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com" target="_blank" title="https://hellogithub.com" ref="nofollow noopener noreferrer">HelloGitHub</a> 与我们交流、讨论使用体验。</p>
<p><strong>往期回顾</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FiUWBUmu8Bw8RuC81CqXpEg" target="_blank" title="https://mp.weixin.qq.com/s/iUWBUmu8Bw8RuC81CqXpEg" ref="nofollow noopener noreferrer">上班摸鱼玩塔防，竟然是为了学架构？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F44TR75pFspRM3kGf-6gU2Q" target="_blank" title="https://mp.weixin.qq.com/s/44TR75pFspRM3kGf-6gU2Q" ref="nofollow noopener noreferrer">节省 60% Token 的新数据格式</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis插件模块详解]]></title>    <link>https://juejin.cn/post/7591728734984028187</link>    <guid>https://juejin.cn/post/7591728734984028187</guid>    <pubDate>2026-01-06T01:01:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591728734984028187" data-draft-id="7591635567588818990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis插件模块详解"/> <meta itemprop="keywords" content="MyBatis"/> <meta itemprop="datePublished" content="2026-01-06T01:01:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis插件模块详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T01:01:24.000Z" title="Tue Jan 06 2026 01:01:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MyBatis插件模块详解</h2>
<h3 data-id="heading-1">一、MyBatis整体架构与插件模块</h3>
<p>在深入插件模块之前，我们先了解MyBatis的整体架构，以及插件模块在其中的重要地位。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04f81476a5ed4bc7a342e2a2119e8d83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=XL6Cg%2BcL9%2B%2FYLn30lMDPeXelbB4%3D" alt="" loading="lazy"/></p>
<p>从上图可以看出，MyBatis采用了分层架构设计，而插件模块（Plugin）通过动态代理机制横切整个框架，能够在核心组件的执行过程中插入自定义逻辑。它为MyBatis提供了强大的扩展能力，使得开发者可以在不修改源码的情况下增强框架功能。</p>
<h4 data-id="heading-2">1.1 插件模块的核心职责</h4>
<p>插件模块主要承担以下核心职责：</p>
<ol>
<li><strong>扩展框架功能</strong>：在不动源码的情况下增强MyBatis功能</li>
<li><strong>拦截核心组件</strong>：拦截Executor、StatementHandler、ParameterHandler、ResultSetHandler</li>
<li><strong>实现AOP功能</strong>：通过动态代理实现面向切面编程</li>
<li><strong>统一权限控制</strong>：实现数据权限过滤</li>
<li><strong>性能监控</strong>：记录SQL执行时间和性能指标</li>
<li><strong>分页查询</strong>：实现物理分页功能</li>
</ol>
<h4 data-id="heading-3">1.2 为什么需要插件</h4>
<p>在实际开发中，我们经常有这些需求：</p>
<pre><code class="hljs language-sql" lang="sql">需求场景：
├── <span class="hljs-keyword">SQL</span>性能监控：记录慢查询
├── 数据权限控制：根据用户权限过滤数据
├── 分页查询：自动实现物理分页
├── 乐观锁：自动更新版本号
├── 审计日志：记录操作日志
└── 加密解密：敏感数据加密存储
</code></pre>
<p>如果没有插件机制，我们需要修改MyBatis源码或编写大量重复代码。插件机制让我们可以优雅地实现这些功能。</p>
<h4 data-id="heading-4">1.3 插件的实现原理</h4>
<p>MyBatis的插件基于<strong>动态代理</strong>实现：</p>
<pre><code class="hljs language-scss" lang="scss">目标对象
    ↓
使用Plugin<span class="hljs-selector-class">.wrap</span>()包装
    ↓
生成代理对象
    ↓
调用<span class="hljs-built_in">intercept</span>()方法
    ↓
执行自定义逻辑
    ↓
调用目标方法或继续传递
</code></pre>
<h3 data-id="heading-5">二、插件拦截机制</h3>
<p>MyBatis的插件机制基于Java动态代理和责任链模式。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376d0f3b8bdd4bf2aab8036be24069cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=IjvaLOW%2FLiZ5HKC7PF1fbGuAqNk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">2.1 Interceptor接口</h4>
<p>MyBatis插件的核心是Interceptor接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-comment">/**
     * 拦截方法，在这里实现自定义逻辑
     * <span class="hljs-doctag">@param</span> invocation 代理调用对象
     * <span class="hljs-doctag">@return</span> 方法执行结果
     * <span class="hljs-doctag">@throws</span> Throwable 异常
     */</span>
    Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable;

    <span class="hljs-comment">/**
     * 包装目标对象，生成代理对象
     * <span class="hljs-doctag">@param</span> target 目标对象
     * <span class="hljs-doctag">@return</span> 代理对象
     */</span>
    <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }

    <span class="hljs-comment">/**
     * 设置插件属性
     * <span class="hljs-doctag">@param</span> properties 配置属性
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-comment">// NOP</span>
    }
}
</code></pre>
<h4 data-id="heading-7">2.2 Invocation类</h4>
<p>Invocation封装了方法调用的相关信息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Invocation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;      <span class="hljs-comment">// 目标对象</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method method;      <span class="hljs-comment">// 目标方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] args;      <span class="hljs-comment">// 方法参数</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Invocation</span><span class="hljs-params">(Object target, Method method, Object[] args)</span> {
        <span class="hljs-built_in">this</span>.target = target;
        <span class="hljs-built_in">this</span>.method = method;
        <span class="hljs-built_in">this</span>.args = args;
    }

    <span class="hljs-comment">// 执行目标方法</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">proceed</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException {
        <span class="hljs-keyword">return</span> method.invoke(target, args);
    }

    <span class="hljs-comment">// Getter方法</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getTarget</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> target; }
    <span class="hljs-keyword">public</span> Method <span class="hljs-title function_">getMethod</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> method; }
    <span class="hljs-keyword">public</span> Object[] getArgs() { <span class="hljs-keyword">return</span> args; }
}
</code></pre>
<h4 data-id="heading-8">2.3 Plugin类</h4>
<p>Plugin是代理对象的InvocationHandler：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Interceptor interceptor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Plugin</span><span class="hljs-params">(Object target, Interceptor interceptor, Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap)</span> {
        <span class="hljs-built_in">this</span>.target = target;
        <span class="hljs-built_in">this</span>.interceptor = interceptor;
        <span class="hljs-built_in">this</span>.signatureMap = signatureMap;
    }

    <span class="hljs-comment">// 静态工厂方法，包装目标对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">wrap</span><span class="hljs-params">(Object target, Interceptor interceptor)</span> {
        <span class="hljs-comment">// 获取拦截的类和方法签名</span>
        Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap = getSignatureMap(interceptor);
        Class&lt;?&gt; type = target.getClass();

        <span class="hljs-comment">// 获取需要拦截的接口</span>
        Class&lt;?&gt;[] interfaces = getAllInterfaces(type, signatureMap);

        <span class="hljs-keyword">if</span> (interfaces.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 创建代理对象</span>
            <span class="hljs-keyword">return</span> Proxy.newProxyInstance(
                type.getClassLoader(),
                interfaces,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Plugin</span>(target, interceptor, signatureMap)
            );
        }
        <span class="hljs-keyword">return</span> target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取需要拦截的方法集合</span>
            Set&lt;Method&gt; methods = signatureMap.get(method.getDeclaringClass());
            <span class="hljs-keyword">if</span> (methods != <span class="hljs-literal">null</span> &amp;&amp; methods.contains(method)) {
                <span class="hljs-comment">// 执行拦截器的intercept方法</span>
                <span class="hljs-keyword">return</span> interceptor.intercept(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Invocation</span>(target, method, args));
            }
            <span class="hljs-comment">// 不需要拦截，直接执行</span>
            <span class="hljs-keyword">return</span> method.invoke(target, args);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> ExceptionUtil.unwrapThrowable(e);
        }
    }

    <span class="hljs-comment">// 获取签名映射</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; getSignatureMap(Interceptor interceptor) {
        <span class="hljs-type">Intercepts</span> <span class="hljs-variable">interceptsAnnotation</span> <span class="hljs-operator">=</span> interceptor.getClass().getAnnotation(Intercepts.class);
        <span class="hljs-keyword">if</span> (interceptsAnnotation == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginException</span>(<span class="hljs-string">"No @Intercepts annotation was found in interceptor "</span> + interceptor.getClass().getName());
        }

        Signature[] sigs = interceptsAnnotation.value();
        Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (Signature sig : sigs) {
            Set&lt;Method&gt; methods = signatureMap.computeIfAbsent(sig.type(), k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;());
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> sig.type().getMethod(sig.method(), sig.args());
                methods.add(method);
            } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginException</span>(<span class="hljs-string">"Could not find method on "</span> + sig.type() + <span class="hljs-string">" named "</span> + sig.method() + <span class="hljs-string">". Cause: "</span> + e, e);
            }
        }
        <span class="hljs-keyword">return</span> signatureMap;
    }

    <span class="hljs-comment">// 获取所有需要拦截的接口</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Class&lt;?&gt;[] getAllInterfaces(Class&lt;?&gt; type, Map&lt;Class&lt;?&gt;, Set&lt;Method&gt;&gt; signatureMap) {
        Set&lt;Class&lt;?&gt;&gt; interfaces = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (type != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (Class&lt;?&gt; c : type.getInterfaces()) {
                <span class="hljs-keyword">if</span> (signatureMap.containsKey(c)) {
                    interfaces.add(c);
                }
            }
            type = type.getSuperclass();
        }
        <span class="hljs-keyword">return</span> interfaces.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[interfaces.size()]);
    }
}
</code></pre>
<h3 data-id="heading-9">三、四大核心拦截点</h3>
<p>MyBatis允许拦截四个核心组件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b57dd653d6da47859ffb044ca5505fe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=fBdirpJeiVsdEgFWq%2BY1B60fac0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">3.1 Executor（执行器）</h4>
<p>Executor是MyBatis的核心执行器，负责SQL的执行。</p>
<p><strong>可拦截方法：</strong></p>
<ul>
<li><code>update(MappedStatement ms, Object parameter)</code> - 执行增删改</li>
<li><code>query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler)</code> - 查询</li>
<li><code>query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey cacheKey, BoundSql boundSql)</code> - 查询（带缓存）</li>
<li><code>flushStatements()</code> - 刷新批处理</li>
<li><code>commit()</code> - 提交事务</li>
<li><code>rollback()</code> - 回滚事务</li>
<li><code>getTransaction()</code> - 获取事务</li>
<li><code>close()</code> - 关闭会话</li>
<li><code>isClosed()</code> - 是否关闭</li>
</ul>
<p><strong>示例：性能监控插件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "update",
               args = {MappedStatement.class, Object.class}),
    @Signature(type = Executor.class,
               method = "query",
               args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitorPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> threshold; <span class="hljs-comment">// 慢查询阈值</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> (MappedStatement) invocation.getArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 执行目标方法</span>
            <span class="hljs-keyword">return</span> invocation.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> end - start;

            <span class="hljs-keyword">if</span> (time &gt; threshold) {
                <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> ms.getBoundSql(<span class="hljs-literal">null</span>).getSql();
                System.out.println(<span class="hljs-string">"慢查询警告: "</span> + ms.getId() + <span class="hljs-string">" 耗时: "</span> + time + <span class="hljs-string">"ms"</span>);
                System.out.println(<span class="hljs-string">"SQL: "</span> + sql);
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-built_in">this</span>.threshold = Long.parseLong(properties.getProperty(<span class="hljs-string">"threshold"</span>, <span class="hljs-string">"1000"</span>));
    }
}
</code></pre>
<h4 data-id="heading-11">3.2 StatementHandler（语句处理器）</h4>
<p>StatementHandler负责创建Statement对象并设置参数。</p>
<p><strong>可拦截方法：</strong></p>
<ul>
<li><code>prepare(Connection connection)</code> - 准备Statement</li>
<li><code>parameterize(Statement statement)</code> - 设置参数</li>
<li><code>batch(Statement statement)</code> - 批处理</li>
<li><code>update(Statement statement)</code> - 执行更新</li>
<li><code>query(Statement statement, ResultHandler resultHandler)</code> - 执行查询</li>
<li><code>getBoundSql()</code> - 获取BoundSql</li>
<li><code>getParameterHandler()</code> - 获取ParameterHandler</li>
<li><code>getResultHandler()</code> - 获取ResultSetHandler</li>
</ul>
<p><strong>示例：SQL重写插件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = StatementHandler.class,
               method = "prepare",
               args = {Connection.class, Integer.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SQLRewritePlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">StatementHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (StatementHandler) invocation.getTarget();
        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> handler.getBoundSql();
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> boundSql.getSql();

        <span class="hljs-comment">// 重写SQL：添加数据权限过滤</span>
        <span class="hljs-keyword">if</span> (sql.toLowerCase().startsWith(<span class="hljs-string">"select"</span>)) {
            sql = rewriteSQL(sql);
            <span class="hljs-comment">// 使用反射修改sql字段</span>
            <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> boundSql.getClass().getDeclaredField(<span class="hljs-string">"sql"</span>);
            field.setAccessible(<span class="hljs-literal">true</span>);
            field.set(boundSql, sql);
        }

        <span class="hljs-keyword">return</span> invocation.proceed();
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">rewriteSQL</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-comment">// 添加数据权限过滤条件</span>
        <span class="hljs-keyword">return</span> sql + <span class="hljs-string">" AND tenant_id = '"</span> + getCurrentTenantId() + <span class="hljs-string">"'"</span>;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getCurrentTenantId</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前租户ID</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1001"</span>;
    }
}
</code></pre>
<h4 data-id="heading-12">3.3 ParameterHandler（参数处理器）</h4>
<p>ParameterHandler负责设置PreparedStatement的参数。</p>
<p><strong>可拦截方法：</strong></p>
<ul>
<li><code>getParameterObject()</code> - 获取参数对象</li>
<li><code>setParameters(PreparedStatement ps)</code> - 设置参数</li>
</ul>
<p><strong>示例：参数加密插件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = ParameterHandler.class,
               method = "setParameters",
               args = {PreparedStatement.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterEncryptPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">ParameterHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (ParameterHandler) invocation.getTarget();
        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> (PreparedStatement) invocation.getArgs()[<span class="hljs-number">0</span>];

        <span class="hljs-comment">// 获取参数对象</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">parameterObject</span> <span class="hljs-operator">=</span> handler.getParameterObject();

        <span class="hljs-keyword">if</span> (parameterObject <span class="hljs-keyword">instanceof</span> User) {
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) parameterObject;
            <span class="hljs-comment">// 加密敏感字段</span>
            <span class="hljs-keyword">if</span> (user.getPassword() != <span class="hljs-literal">null</span>) {
                user.setPassword(encrypt(user.getPassword()));
            }
        }

        <span class="hljs-comment">// 继续执行</span>
        <span class="hljs-keyword">return</span> invocation.proceed();
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String plainText)</span> {
        <span class="hljs-comment">// Base64简单加密</span>
        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(plainText.getBytes());
    }
}
</code></pre>
<h4 data-id="heading-13">3.4 ResultSetHandler（结果集处理器）</h4>
<p>ResultSetHandler负责将ResultSet映射为Java对象。</p>
<p><strong>可拦截方法：</strong></p>
<ul>
<li><code>handleResultSets(Statement stmt)</code> - 处理结果集</li>
<li><code>handleOutputParameters(CallableStatement cs)</code> - 处理存储过程输出参数</li>
</ul>
<p><strong>示例：结果解密插件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = ResultSetHandler.class,
               method = "handleResultSets",
               args = {Statement.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultDecryptPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 执行查询</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();

        <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">instanceof</span> List) {
            List&lt;?&gt; list = (List&lt;?&gt;) result;
            <span class="hljs-keyword">for</span> (Object obj : list) {
                <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> User) {
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) obj;
                    <span class="hljs-comment">// 解密敏感字段</span>
                    <span class="hljs-keyword">if</span> (user.getIdCard() != <span class="hljs-literal">null</span>) {
                        user.setIdCard(decrypt(user.getIdCard()));
                    }
                }
            }
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String cipherText)</span> {
        <span class="hljs-comment">// Base64解密</span>
        <span class="hljs-type">byte</span>[] decoded = Base64.getDecoder().decode(cipherText);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(decoded);
    }
}
</code></pre>
<h3 data-id="heading-14">四、插件实现流程</h3>
<p>理解插件的实现和配置流程非常重要。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63ec6d601cf04e6195e137b7161c2de0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=PfgiCJnROyaWkBgfLlldqLCtG%2BM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">4.1 实现自定义插件</h4>
<p><strong>步骤1：实现Interceptor接口</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "query",
               args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 前置逻辑</span>
        System.out.println(<span class="hljs-string">"Before: "</span> + invocation.getMethod().getName());

        <span class="hljs-comment">// 执行目标方法</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();

        <span class="hljs-comment">// 后置逻辑</span>
        System.out.println(<span class="hljs-string">"After: "</span> + invocation.getMethod().getName());

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-comment">// 使用Plugin.wrap包装目标对象</span>
        <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-comment">// 读取配置属性</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">propertyName</span> <span class="hljs-operator">=</span> properties.getProperty(<span class="hljs-string">"propertyName"</span>);
        System.out.println(<span class="hljs-string">"Property: "</span> + propertyName);
    }
}
</code></pre>
<h4 data-id="heading-16">4.2 配置插件</h4>
<p><strong>方式1：XML配置</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 性能监控插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.example.plugin.PerformanceMonitorPlugin"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"threshold"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1000"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 分页插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"helperDialect"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"mysql"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 自定义插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.example.plugin.CustomPlugin"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"propertyName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"propertyValue"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p><strong>方式2：代码配置</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建Configuration</span>
<span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();

<span class="hljs-comment">// 添加插件</span>
configuration.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMonitorPlugin</span>());
configuration.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInterceptor</span>());
configuration.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomPlugin</span>());

<span class="hljs-comment">// 创建SqlSessionFactory</span>
<span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(configuration);
</code></pre>
<p><strong>方式3：Spring配置</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PerformanceMonitorPlugin <span class="hljs-title function_">performanceMonitorPlugin</span><span class="hljs-params">()</span> {
        <span class="hljs-type">PerformanceMonitorPlugin</span> <span class="hljs-variable">plugin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMonitorPlugin</span>();
        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.setProperty(<span class="hljs-string">"threshold"</span>, <span class="hljs-string">"1000"</span>);
        plugin.setProperties(properties);
        <span class="hljs-keyword">return</span> plugin;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SqlSessionFactory <span class="hljs-title function_">sqlSessionFactory</span><span class="hljs-params">(DataSource dataSource)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SqlSessionFactoryBean</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBean</span>();
        sessionFactory.setDataSource(dataSource);

        <span class="hljs-comment">// 添加插件</span>
        sessionFactory.setPlugins(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>[]{
                performanceMonitorPlugin(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInterceptor</span>()
            }
        );

        <span class="hljs-keyword">return</span> sessionFactory.getObject();
    }
}
</code></pre>
<h4 data-id="heading-17">4.3 插件链的执行顺序</h4>
<p>当配置了多个插件时，它们会形成责任链：</p>
<pre><code class="hljs language-markdown" lang="markdown">原始Executor
<span class="hljs-code">    ↓
被Plugin1包装
    ↓
被Plugin2包装
    ↓
被Plugin3包装
    ↓
最终代理对象
</span></code></pre>
<p><strong>执行顺序：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 配置顺序</span>
&lt;plugin interceptor=<span class="hljs-string">"Plugin1"</span>/&gt;
&lt;plugin interceptor=<span class="hljs-string">"Plugin2"</span>/&gt;
&lt;plugin interceptor=<span class="hljs-string">"Plugin3"</span>/&gt;

<span class="hljs-comment">// 执行顺序</span>
Plugin3.intercept() → Plugin2.intercept() → Plugin1.intercept() → 目标方法

<span class="hljs-comment">// 返回顺序</span>
目标方法 → Plugin1处理 → Plugin2处理 → Plugin3处理 → 最终结果
</code></pre>
<h3 data-id="heading-18">五、动态代理链</h3>
<p>多个插件会形成多层代理。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d91917add24b7c9d1b12ec97a4f0c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=AY2EduC0AhBumeu08NMzLTLZ%2Bz8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">5.1 代理链的构建</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 原始对象</span>
<span class="hljs-type">Executor</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleExecutor</span>();

<span class="hljs-comment">// 第一次包装</span>
<span class="hljs-type">Executor</span> <span class="hljs-variable">proxy1</span> <span class="hljs-operator">=</span> (Executor) Plugin.wrap(target, plugin1);

<span class="hljs-comment">// 第二次包装（包装的是代理对象）</span>
<span class="hljs-type">Executor</span> <span class="hljs-variable">proxy2</span> <span class="hljs-operator">=</span> (Executor) Plugin.wrap(proxy1, plugin2);

<span class="hljs-comment">// 第三次包装</span>
<span class="hljs-type">Executor</span> <span class="hljs-variable">proxy3</span> <span class="hljs-operator">=</span> (Executor) Plugin.wrap(proxy2, plugin3);

<span class="hljs-comment">// proxy3是最外层的代理</span>
</code></pre>
<h4 data-id="heading-20">5.2 代理链的执行</h4>
<pre><code class="hljs language-scss" lang="scss">调用 proxy3<span class="hljs-selector-class">.query</span>()
    ↓
Plugin3<span class="hljs-selector-class">.invoke</span>()
    ↓
Plugin3<span class="hljs-selector-class">.intercept</span>()
    ↓
invocation<span class="hljs-selector-class">.proceed</span>() 调用 proxy2<span class="hljs-selector-class">.query</span>()
    ↓
Plugin2<span class="hljs-selector-class">.invoke</span>()
    ↓
Plugin2<span class="hljs-selector-class">.intercept</span>()
    ↓
invocation<span class="hljs-selector-class">.proceed</span>() 调用 proxy1<span class="hljs-selector-class">.query</span>()
    ↓
Plugin1<span class="hljs-selector-class">.invoke</span>()
    ↓
Plugin1<span class="hljs-selector-class">.intercept</span>()
    ↓
invocation<span class="hljs-selector-class">.proceed</span>() 调用 target<span class="hljs-selector-class">.query</span>()
    ↓
执行真正的查询
    ↓
返回结果
    ↓
Plugin1处理返回值
    ↓
Plugin2处理返回值
    ↓
Plugin3处理返回值
    ↓
最终返回
</code></pre>
<h4 data-id="heading-21">5.3 代理链示例代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts(@Signature(type = Executor.class, method = "query",
        args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class}))</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"Plugin1 Before"</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();
        System.out.println(<span class="hljs-string">"Plugin1 After"</span>);
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-meta">@Intercepts(@Signature(type = Executor.class, method = "query",
        args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class}))</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"Plugin2 Before"</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();
        System.out.println(<span class="hljs-string">"Plugin2 After"</span>);
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">// 输出结果：</span>
<span class="hljs-comment">// Plugin2 Before</span>
<span class="hljs-comment">// Plugin1 Before</span>
<span class="hljs-comment">// 执行查询</span>
<span class="hljs-comment">// Plugin1 After</span>
<span class="hljs-comment">// Plugin2 After</span>
</code></pre>
<h3 data-id="heading-22">六、典型应用场景</h3>
<p>插件在实际开发中有很多应用场景。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c52ee22080dd483fa7c4b17fcca0ecd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768266084&amp;x-signature=EKTNHFhLLi5vOlDQxI1OM8RA4g8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-23">6.1 分页插件</h4>
<p><strong>PageHelper是最著名的MyBatis分页插件：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.github.pagehelper.PageInterceptor"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"helperDialect"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"mysql"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"reasonable"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p><strong>使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询前调用分页</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
List&lt;User&gt; users = userMapper.selectAll();

<span class="hljs-comment">// 获取分页信息</span>
PageInfo&lt;User&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(users);
System.out.println(<span class="hljs-string">"总数: "</span> + pageInfo.getTotal());
System.out.println(<span class="hljs-string">"页数: "</span> + pageInfo.getPages());
</code></pre>
<h4 data-id="heading-24">6.2 性能监控插件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "update",
               args = {MappedStatement.class, Object.class}),
    @Signature(type = Executor.class,
               method = "query",
               args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlowQueryMonitorPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SlowQueryMonitorPlugin.class);
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> slowQueryThreshold;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> (MappedStatement) invocation.getArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> invocation.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">cost</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;
            <span class="hljs-keyword">if</span> (cost &gt; slowQueryThreshold) {
                <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> ms.getBoundSql(invocation.getArgs()[<span class="hljs-number">1</span>]);
                <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> boundSql.getSql();
                logger.warn(<span class="hljs-string">"慢查询: {} 耗时: {}ms\nSQL: {}"</span>, ms.getId(), cost, sql);
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-built_in">this</span>.slowQueryThreshold = Long.parseLong(properties.getProperty(<span class="hljs-string">"threshold"</span>, <span class="hljs-string">"1000"</span>));
    }
}
</code></pre>
<h4 data-id="heading-25">6.3 数据权限插件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = StatementHandler.class,
               method = "prepare",
               args = {Connection.class, Integer.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataPermissionPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">StatementHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (StatementHandler) invocation.getTarget();
        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> handler.getBoundSql();
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> boundSql.getSql();

        <span class="hljs-comment">// 获取当前用户的数据权限</span>
        Set&lt;Long&gt; deptIds = getCurrentUserDeptIds();

        <span class="hljs-comment">// 重写SQL，添加数据权限过滤</span>
        <span class="hljs-keyword">if</span> (sql.toLowerCase().startsWith(<span class="hljs-string">"select"</span>) &amp;&amp; !deptIds.isEmpty()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-string">"dept_id IN ("</span> + String.join(<span class="hljs-string">","</span>, deptIds.toString()) + <span class="hljs-string">")"</span>;
            sql = addDataPermission(sql, condition);

            <span class="hljs-comment">// 使用反射修改SQL</span>
            <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> boundSql.getClass().getDeclaredField(<span class="hljs-string">"sql"</span>);
            field.setAccessible(<span class="hljs-literal">true</span>);
            field.set(boundSql, sql);
        }

        <span class="hljs-keyword">return</span> invocation.proceed();
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">addDataPermission</span><span class="hljs-params">(String sql, String condition)</span> {
        <span class="hljs-comment">// 简单实现：在WHERE后添加条件</span>
        <span class="hljs-keyword">if</span> (sql.toLowerCase().contains(<span class="hljs-string">"where"</span>)) {
            <span class="hljs-keyword">return</span> sql + <span class="hljs-string">" AND "</span> + condition;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> sql + <span class="hljs-string">" WHERE "</span> + condition;
        }
    }

    <span class="hljs-keyword">private</span> Set&lt;Long&gt; <span class="hljs-title function_">getCurrentUserDeptIds</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 从上下文获取当前用户的数据权限</span>
        <span class="hljs-keyword">return</span> SecurityContextHolder.getCurrentUserDataPermission();
    }
}
</code></pre>
<h4 data-id="heading-26">6.4 乐观锁插件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "update",
               args = {MappedStatement.class, Object.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimisticLockPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">Object</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> invocation.getArgs()[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> BaseEntity) {
            <span class="hljs-type">BaseEntity</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> (BaseEntity) parameter;
            <span class="hljs-comment">// 自动设置版本号</span>
            <span class="hljs-keyword">if</span> (entity.getVersion() == <span class="hljs-literal">null</span>) {
                entity.setVersion(<span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> {
                entity.setVersion(entity.getVersion() + <span class="hljs-number">1</span>);
            }
        }

        <span class="hljs-keyword">return</span> invocation.proceed();
    }
}
</code></pre>
<h4 data-id="heading-27">6.5 审计日志插件</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "update",
               args = {MappedStatement.class, Object.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuditLogPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> (MappedStatement) invocation.getArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-type">Object</span> <span class="hljs-variable">parameter</span> <span class="hljs-operator">=</span> invocation.getArgs()[<span class="hljs-number">1</span>];

        <span class="hljs-comment">// 记录操作日志</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">operation</span> <span class="hljs-operator">=</span> ms.getId();
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> getCurrentUser();
        <span class="hljs-type">Date</span> <span class="hljs-variable">operateTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();

        System.out.println(<span class="hljs-string">"操作人: "</span> + operator);
        System.out.println(<span class="hljs-string">"操作时间: "</span> + operateTime);
        System.out.println(<span class="hljs-string">"操作类型: "</span> + operation);
        System.out.println(<span class="hljs-string">"操作数据: "</span> + parameter);

        <span class="hljs-comment">// 执行目标方法</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();

        <span class="hljs-comment">// 记录操作结果</span>
        System.out.println(<span class="hljs-string">"影响行数: "</span> + result);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getCurrentUser</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前登录用户</span>
        <span class="hljs-keyword">return</span> SecurityContextHolder.getCurrentUser().getUsername();
    }
}
</code></pre>
<h3 data-id="heading-28">七、最佳实践</h3>
<h4 data-id="heading-29">7.1 插件设计原则</h4>
<ol>
<li><strong>最小侵入</strong>：尽量不修改原有逻辑</li>
<li><strong>可配置性</strong>：通过属性配置开关</li>
<li><strong>性能考虑</strong>：避免在插件中执行耗时操作</li>
<li><strong>异常处理</strong>：妥善处理异常，避免影响正常流程</li>
<li><strong>日志记录</strong>：记录关键操作日志</li>
</ol>
<h4 data-id="heading-30">7.2 性能优化</h4>
<ol>
<li><strong>减少反射使用</strong>：缓存Field/Method对象</li>
<li><strong>避免复杂计算</strong>：插件逻辑要简单高效</li>
<li><strong>使用缓存</strong>：缓存常用数据</li>
<li><strong>异步处理</strong>：日志等操作异步执行</li>
</ol>
<h4 data-id="heading-31">7.3 常见问题解决</h4>
<h5 data-id="heading-32">问题1：插件不生效</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 原因：@Signature配置错误</span>
<span class="hljs-comment">// 错误：方法签名不匹配</span>
<span class="hljs-meta">@Signature(type = Executor.class,
           method = "query",
           args = {MappedStatement.class, Object.class})</span> <span class="hljs-comment">// 缺少参数</span>

<span class="hljs-comment">// 正确：完整的方法签名</span>
<span class="hljs-meta">@Signature(type = Executor.class,
           method = "query",
           args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})</span>
</code></pre>
<h5 data-id="heading-33">问题2：修改SQL失败</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 原因：直接修改sql字段不生效</span>
boundSql.setSql(newSql); <span class="hljs-comment">// BoundSql没有setSql方法</span>

<span class="hljs-comment">// 正确：使用反射修改</span>
<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> boundSql.getClass().getDeclaredField(<span class="hljs-string">"sql"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);
field.set(boundSql, newSql);
</code></pre>
<h5 data-id="heading-34">问题3：插件顺序混乱</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 建议：按执行顺序配置 --&gt;</span>
<span class="hljs-comment">&lt;!-- 分页插件应该先执行 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"PageInterceptor"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 数据权限插件后执行 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"DataPermissionPlugin"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-35">7.4 插件开发模板</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 插件开发模板
 */</span>
<span class="hljs-meta">@Intercepts({
    @Signature(type = Executor.class,
               method = "query",
               args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TemplatePlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(TemplatePlugin.class);

    <span class="hljs-comment">// 配置属性</span>
    <span class="hljs-keyword">private</span> String configProperty;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 1. 前置处理</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> invocation.getTarget();
        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> invocation.getMethod();
        Object[] args = invocation.getArgs();

        logger.debug(<span class="hljs-string">"Before intercept: {}"</span>, method.getName());

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 执行目标方法</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();

            <span class="hljs-comment">// 3. 后置处理</span>
            logger.debug(<span class="hljs-string">"After intercept: {}"</span>, method.getName());

            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 4. 异常处理</span>
            logger.error(<span class="hljs-string">"Plugin error"</span>, e);
            <span class="hljs-keyword">throw</span> e;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-built_in">this</span>.configProperty = properties.getProperty(<span class="hljs-string">"configProperty"</span>, <span class="hljs-string">"defaultValue"</span>);
        logger.info(<span class="hljs-string">"Plugin initialized with property: {}"</span>, configProperty);
    }
}
</code></pre>
<h3 data-id="heading-36">八、总结</h3>
<p>MyBatis的插件模块提供了强大的扩展能力，使得开发者可以在不修改源码的情况下增强框架功能。</p>
<h4 data-id="heading-37">核心要点</h4>
<ol>
<li><strong>Interceptor接口</strong>：定义插件的核心接口</li>
<li><strong>四大拦截点</strong>：Executor、StatementHandler、ParameterHandler、ResultSetHandler</li>
<li><strong>动态代理</strong>：基于JDK动态代理实现</li>
<li><strong>责任链模式</strong>：多个插件形成责任链</li>
<li><strong>应用场景</strong>：分页、监控、权限、加密、日志等</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重磅！微信小程序AI免费扶持：零成本开发+变现全打通]]></title>    <link>https://juejin.cn/post/7591728734983127067</link>    <guid>https://juejin.cn/post/7591728734983127067</guid>    <pubDate>2026-01-05T16:44:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591728734983127067" data-draft-id="7591719013488443430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重磅！微信小程序AI免费扶持：零成本开发+变现全打通"/> <meta itemprop="keywords" content="微信小程序"/> <meta itemprop="datePublished" content="2026-01-05T16:44:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="codeteenager"/> <meta itemprop="url" content="https://juejin.cn/user/571401777718408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重磅！微信小程序AI免费扶持：零成本开发+变现全打通
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/571401777718408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    codeteenager
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T16:44:53.000Z" title="Mon Jan 05 2026 16:44:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言：AI应用爆发期，小程序成为创意孵化新阵地</h2>
<p>随着AI大模型技术的普及，越来越多创作者渴望将创意转化为实际应用。微信小程序顺势推出「AI应用及线上工具小程序成长计划」，以全周期零成本扶持体系，助力开发者从0到1搭建AI小程序，再从1到100实现商业增长。无论你是个人开发者还是企业团队，只要聚焦虚拟服务领域，就能享受全年免费资源与流量红利，开启AI应用开发新征程。</p>
<h2 data-id="heading-1">二、六大核心支持体系：全流程赋能，让开发与变现更简单</h2>
<h3 data-id="heading-2">（一）开发侧：技术资源拉满，降低启动门槛</h3>
<h4 data-id="heading-3">1. 免费云开发资源：轻盈起步，专注核心功能</h4>
<p>新开发者可免费创建个人版云开发环境，享受6个月有效期，涵盖数据库、云函数等完备后端能力，支持无缝对接AI大模型与智能Agent；已有环境的开发者可领取大额抵扣券，降低长期运营成本。无需自建服务器，快速搭建稳定后台，让技术小白也能轻松上手。</p>
<h4 data-id="heading-4">2. 免费AI算力支持：腾讯混元大模型助力创新</h4>
<p>接入腾讯旗舰级文生文模型「混元2.0」及多模态文生图模型（1亿Token额度+1万张文生图权益），后续新模型上架可直接调用。无论是构建智能写作助手、AI对话机器人，还是图像生成工具，均可免费使用行业顶尖算力，聚焦功能创新而非底层技术研发。</p>
<h3 data-id="heading-5">（二）运营侧：数据驱动增长，流量精准触达</h3>
<h4 data-id="heading-6">1. 免费专业数据分析：We分析专业版助力智能迭代</h4>
<p>免费开放We分析专业版1年权限，深度追踪用户行为、留存率、转化路径等核心数据，通过用户画像与场景分析优化产品设计，让每一次迭代都有数据支撑，避免盲目试错。</p>
<h4 data-id="heading-7">2. 官方流量激励：多入口曝光，优质产品不被埋没</h4>
<p>优秀小程序可获得「微信-发现-小程序」专属推荐位，精准触达亿级用户；公众号发布小程序内容时添加#来微信做个小程序#话题，即有机会解锁公域流量扶持，通过社交裂变快速破圈。</p>
<h3 data-id="heading-8">（三）变现侧：商业化闭环打通，盈利更顺畅</h3>
<h4 data-id="heading-9">1. 无门槛广告接入：免开发智能模式，实时预览上线</h4>
<p>支持「免开发智能接入」，系统自动分析小程序页面，在合适位置智能推荐广告位，开发者可实时预览效果并一键上线，无需复杂开发即可开启广告变现，中小团队也能轻松实现流量转化。</p>
<h4 data-id="heading-10">2. 全终端虚拟支付优惠：费率降低，商业运转更高效</h4>
<p>覆盖安卓、iOS、鸿蒙全终端的虚拟支付与会员订阅能力，享受限时优惠费率，打破平台壁垒。无论是知识付费、工具订阅还是虚拟商品交易，均能以更低成本构建商业闭环，提升盈利空间。</p>
<h2 data-id="heading-11">三、申请指南：三步加入，全年福利即刻解锁</h2>
<h3 data-id="heading-12">（一）准入条件：聚焦虚拟服务，类目清晰明确</h3>
<ul>
<li>「类目要求」：仅限文娱、工具、社交、深度合成、资讯虚拟类目，排除线下服务类目（如餐饮、零售），专注线上场景开发。</li>
<li>「主体要求」：个人开发者与企业主体均可参与，需确保小程序主体信息完备（完成实名认证或企业认证）。</li>
</ul>
<h3 data-id="heading-13">（二）活动时间：2026全年有效，早加入早受益</h3>
<p>即日起至2026年12月31日，所有符合条件的开发者均可申请，资源额度与流量激励按自然年有效期分配，建议尽快启动开发，充分利用全年扶持期。</p>
<h3 data-id="heading-14">（三）申请路径：后台一键提交，快速审核</h3>
<p>登录「微信小程序后台-行业能力-AI小程序成长计划」页面，新开发者完成账号认证后即可提交申请，审核通过后实时开通资源权限，全程线上化操作，无需额外材料。</p>
<h2 data-id="heading-15">四、为什么选择小程序生态？三大优势打造AI应用最优解</h2>
<h3 data-id="heading-16">（一）轻量化开发：周期短、上线快，快速验证创意</h3>
<p>相比App动辄数月的开发周期，小程序依托微信成熟框架，开发周期可缩短至数周，支持「边开发边迭代」，让创意快速落地测试，抢占市场先机。</p>
<h3 data-id="heading-17">（二）社交裂变基因：微信生态内天然传播优势</h3>
<p>背靠10亿+用户的微信生态，支持聊天转发、朋友圈分享、公众号关联等多维度社交分发，优质小程序可通过用户口碑实现低成本裂变，转化率远高于传统流量渠道。</p>
<h3 data-id="heading-18">（三）成熟案例验证：标杆产品已跑通商业模型</h3>
<p>已有《猜盐》（AI问答游戏）、《传图加画框》（AI图像美化）、《写作鹅》（智能写作助手）等小程序通过成长计划资源，实现用户量与收入双增长，证明虚拟服务类小程序在微信生态的可行性与盈利潜力。</p>
<h2 data-id="heading-19">五、结语：现在加入，开启AI应用创业新征程</h2>
<p>从免费云资源到顶尖算力，从流量扶持到无门槛变现，微信小程序AI成长计划真正实现了「零成本启动」。无论你是想将AI创意落地的独立开发者，还是寻求业务拓展的企业团队，2026年都是布局AI小程序的黄金时机。点击后台申请，立即解锁全年专属福利，让你的创意在微信生态中生根发芽，未来更有持续资源加码，共同构建繁荣的AI应用新生态！</p>
<p>【立即行动】登录微信小程序后台，搜索「AI小程序成长计划」，开启你的零成本AI开发之旅！</p>
<p><strong>看完觉得对您有所帮助别忘记关注呦</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bcf60f0963b4799bf58734c5b0bc00e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29kZXRlZW5hZ2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768236293&amp;x-signature=jzt8596b9hCMV%2FbeRqRO32drYSk%3D" alt="qrcode_for_gh_55899dc27008_1280.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agenic Ai架构]]></title>    <link>https://juejin.cn/post/7591715454134534207</link>    <guid>https://juejin.cn/post/7591715454134534207</guid>    <pubDate>2026-01-05T17:55:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591715454134534207" data-draft-id="7591730714140262442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agenic Ai架构"/> <meta itemprop="keywords" content="LLM,OpenAI,AIGC"/> <meta itemprop="datePublished" content="2026-01-05T17:55:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_Shawn"/> <meta itemprop="url" content="https://juejin.cn/user/1855631358965384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agenic Ai架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631358965384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_Shawn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T17:55:53.000Z" title="Mon Jan 05 2026 17:55:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">现代化智能体Ai</h2>
<h3 data-id="heading-1">分层架构</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b79b4ef2396a43b5ae05cea26467417b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768240553&amp;x-signature=%2Bslk7F9rmJ4kBVUkDeDN6ckT9FE%3D" alt="" loading="lazy"/></p>
<p><strong>基础设施层：</strong> Gpu/Tpu Cloud云算力支持，数据仓库，负载均衡，文件存储系统，工作流调度系统，监控运维系统等</p>
<p><strong>Agent网络层：</strong> 包含自主规划Agent，通信协议，向量数据库，状态机维护，工具使用，身份认证权限控制，多智能体系统，短期/长期记忆的管理等。</p>
<p><strong>协议层：</strong> 比较耳熟能详的是mcp , A2A, Fcp。这一层主要定义工具调用/编写的规范，智能体通信/使用规范。</p>
<p><strong>知识增强层：</strong> 这一层主要是做数据/知识的增强，供大模型学习/获取新数据/知识，主要包含Rag，工具调用，知识库增强，联网搜索/爬虫，插件集成等功能。</p>
<p><strong>认知与推理层：</strong> 目标管理，制定执行计划，进行决策，循环反馈，自我提升。需要用到强化学习等相关技术了。</p>
<p><strong>记忆与个性化层：</strong> 主要作用于Agent的长期记忆，提取用户的相关信息，兴趣偏好，行为偏好以及历史对话等形成用户画像，更好地做到千人千面。</p>
<p><strong>应用层：</strong> 这一层就是各种各样的应用Agent，比如deepresearch agent，平台类的agent（比如物流，客服，订单等）。</p>
<p><strong>运维与治理层：</strong> 日志审计与监控统计（统计模型/工具调用量，耗时，token消耗量等，资源cpu，内存，网络，磁盘等使用情况），CI/CD，安全等。这一层是智能体系统走向生产环境的关键保障，决定了系统的可靠性和可持续性。</p>
<h3 data-id="heading-2">技术分层</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a8ce8e10f104b77a06dc4f73ca9ab37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768240553&amp;x-signature=KHKHOS4mZbYRvB3Y%2BQyuBZZs9eg%3D" alt="" loading="lazy"/></p>

































<table><thead><tr><th><strong>技术栈层级 (Technology Stack)</strong></th><th><strong>定义 (Definition)</strong></th></tr></thead><tbody><tr><td><strong>应用层</strong> (Applications layer)</td><td>用于生成针对各种问题和提示的自然语言回复的应用程序，例如<strong>聊天机器人</strong>和<strong>翻译器</strong>。但是，<strong>真实性</strong>对于最大限度地减少“幻觉”并将模型建立在现实基础上至关重要。</td></tr><tr><td><strong>API 层</strong> (API layer)</td><td>面向<strong>专业开发者</strong>（作为构建各种应用程序的 Google LLM 的入口点）和<strong>业余爱好者</strong>（MakerSuite 原型设计工具）的 API。</td></tr><tr><td><strong>大语言模型 (LLMs) 层</strong> (Large Language Model layer)</td><td>预训练的通用语言模型，可以针对特定任务进行微调。 旨在执行通用的语言任务，如语言翻译、摘要生成或对话生成。</td></tr><tr><td><strong>机器学习基础模型层</strong> (ML Foundation Model layer)</td><td>预训练的通用、多功能语言模型。 可以针对各种下游 NLP 任务进行微调，例如文本分类或情感分析。</td></tr><tr><td><strong>架构层</strong> (Architecture layer)</td><td>一种用于自然语言处理 (NLP) 任务的<strong>神经网络架构</strong>，它解锁了两个关键能力： • <strong>决策制定</strong> (Decision making) • <strong>注意力广度</strong> (Attention span) 这可以用<strong>自注意力 (Self-attention)</strong> 这一单一概念来概括。</td></tr><tr><td><strong>基础设施层</strong> (Infrastructure layer)</td><td><strong>张量处理单元 (TPU)</strong> 是专为深度学习工作负载设计的，并针对执行神经网络中常用的矩阵运算进行了优化。</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/207f88d933ef47f899bbfd37563cfdb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768240553&amp;x-signature=WGh%2F9xWdktTTkAn9my6eKKb9Ck0%3D" alt="" loading="lazy"/></p>
<p>这张图展示了<strong>生成式 AI (Generative AI) 的 6 层技术栈</strong>，从底层的硬件设施一直到顶层的用户应用。</p>
<p>以下是从下往上（由底层到应用层）的详细说明：</p>
<p><strong>基础设施层：</strong> 提供算力，NVIDIA（显卡）、Google Cloud TPU、AWS（亚马逊云）、Microsoft Azure。</p>
<p><strong>架构层：</strong> 这一层定义了模型的结构方式。例如，目前最火的 ChatGPT 主要是基于 <strong>Transformer</strong> 架构；画图 AI 常用 <strong>Diffusion Models</strong>（扩散模型）、RAG（检索增强生成）。</p>
<p><strong>机器学习基础模型层：</strong> 预训练的通用、多功能语言模型。可以进行对特定领域进行微调，例如文本分类或者情感分析等。</p>
<p><strong>大语言模型层：</strong> 预训练的通用语言模型，可以针对特定任务进行微调。旨在执行通用的语言任务，如语言翻译、摘要生成或对话生成。</p>
<p><strong>Api层：</strong> 让开发者能够方便地调用模型能力的接口。只需要通过 API 接口，用户可以与大模型进行对话，OpenAI API, Google PaLM API, Azure OpenAI, Hugging Face Inference等基本都有Open Api提供</p>
<p><strong>应用层：</strong> 这一层将 AI 的能力包装成好用的工具，比如写代码助手、聊天机器人、文案生成器等，ChatGPT（聊天）、GitHub Copilot（写代码）、Notion AI（笔记写作）、Jasper（营销文案）、Midjourney/Runway（图像视频生成）。</p>
<h3 data-id="heading-3">多Agent模式</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e37ddcb5e8844b18c01da8975a7633e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768240553&amp;x-signature=yvuoZw4CUgNUeE%2F0qt61KRtFjNE%3D" alt="" loading="lazy"/></p>
<p><strong>1. 链式 (Prompt Chaining)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“单行线”</strong> 。像接力赛一样，一步接一步，前一步的输出是后一步的输入。</li>
<li><strong>适用场景</strong>：流程固定、不能出错的标准化任务（如：写大纲→写正文→润色）。</li>
</ul>
<p><strong>2. 路由式 (Routing)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“分诊台”</strong> 。先看病（识别意图），再挂号（分流），把任务派给专门负责的那个模型。</li>
<li><strong>适用场景</strong>：用户需求五花八门，需要分类处理（如：客服系统分流到人工、退款或查询）。</li>
</ul>
<p><strong>3. 并行式 (Parallelization)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“多线程”</strong> 。把大任务拆成几个互不干扰的小任务，大家同时干，最后把结果拼起来。</li>
<li><strong>适用场景</strong>：任务之间没关联（如：同时分析某公司的股票、新闻和财报）。</li>
</ul>
<p><strong>4. 协作式 (Orchestrator-workers)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“项目组”</strong> 。有一个“包工头”（协调者）负责拆解任务、分派给不同的“工人”（子模型），最后汇总成果。</li>
<li><strong>适用场景</strong>：任务太复杂，需要不同专业技能配合（如：一个负责查资料，一个负责写代码，一个负责测试）。</li>
</ul>
<p><strong>5. 评估优化式 (Evaluator-optimizer)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“改稿模式”</strong> 。一个负责写，一个负责审。审不过就打回重写，直到满意为止。</li>
<li><strong>适用场景</strong>：对质量要求极高，容错率低（如：生成代码、法律合同）。</li>
</ul>
<p><strong>6. 规划式 / 自主智能体 (Autonomous Agent)</strong></p>
<ul>
<li><strong>核心逻辑</strong>： <strong>“自动驾驶”</strong> 。给一个大目标，AI 自己想办法拆解步骤、执行，遇到路不通就自己换条路走。</li>
<li><strong>适用场景</strong>：环境在变、需要多轮决策的复杂任务（如：自主完成一个软件开发项目）。</li>
</ul>
<h2 data-id="heading-4">参考文献</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1925989268351874983" target="_blank" title="https://zhuanlan.zhihu.com/p/1925989268351874983" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/192598926…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FEvanKirstel%2Fstatus%2F1949512638083289335" target="_blank" title="https://x.com/EvanKirstel/status/1949512638083289335" ref="nofollow noopener noreferrer">x.com/EvanKirstel…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftechsurprises.com%2F2023%2F04%2F03%2Fthe-6-layers-of-generative-ai-technology-stack%2F" target="_blank" title="https://techsurprises.com/2023/04/03/the-6-layers-of-generative-ai-technology-stack/" ref="nofollow noopener noreferrer">techsurprises.com/2023/04/03/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_54655817%2Farticle%2Fdetails%2F155972130" target="_blank" title="https://blog.csdn.net/qq_54655817/article/details/155972130" ref="nofollow noopener noreferrer">blog.csdn.net/qq_54655817…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026：当 AI 隐入工作流，你准备好了吗？ -- 肘子的 Swift 周报 #117]]></title>    <link>https://juejin.cn/post/7591703562134454306</link>    <guid>https://juejin.cn/post/7591703562134454306</guid>    <pubDate>2026-01-05T23:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591703562134454306" data-draft-id="7591346773827239962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026：当 AI 隐入工作流，你准备好了吗？  -- 肘子的 Swift 周报 #117"/> <meta itemprop="keywords" content="Swift,SwiftUI,人工智能"/> <meta itemprop="datePublished" content="2026-01-05T23:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东坡肘子"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026：当 AI 隐入工作流，你准备好了吗？  -- 肘子的 Swift 周报 #117
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东坡肘子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T23:55:08.000Z" title="Mon Jan 05 2026 23:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/658416c61b80437da32faa680e3ddca9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768262108&amp;x-signature=r13T5uGrDC6t%2FpWJzIDBWgbuUx0%3D" alt="issue117.webp" loading="lazy"/></p>
<h2 data-id="heading-0">2026：当 AI 隐入工作流，你准备好了吗？</h2>
<p>大家新年好！在过去的几年中，AI 始终占据着科技界最耀眼的 C 位。但站在 2026 年的起点回看，我发现一个显著的转折：从 2025 年末开始，人们对“万亿参数”或“榜单跑分”的狂热逐渐褪去，取而代之的是对 AI 工作流深耕细作的冷静与实战。</p>
<p>如果说过去两年大多数人还在尝试如何与 Chat 机器人聊天，那么现在，AI 已经通过 CLI、MCP 以及各种 Slash、Skill、SubAgent，彻底打破了对话框的限制。对于有经验的开发者来说，AI 已经不再是一个外部工具，而是像插件一样，渗透进终端、编辑器乃至整个操作系统的每一个毛细血管。</p>
<p>在这一点上，macOS 展示了某种“无心插柳”的天然优势。借助 AppleScript 和快捷指令这些成熟的自动化工具，即便不通过复杂的 API 开发，普通用户也能让 AI 访问自己的私有数据。这种“老树发新芽”的现象，让苹果在 AI 时代拥有了新的护城河。而如果这种能力在 iOS 上通过系统级 Agent 完全释放，硬件设备的形态或许将迎来新一轮重塑。</p>
<p>与此同时，某些厂商的策略则更加“激进”。字节跳动的豆包手机尝试从系统底层通过屏幕读取与模拟交互来“暴力”接管一切；华为则通过 A2A（Agent to Agent）策略，试图在后台构建一套统一的代理调度机制。无论路线如何，2026 年对于普通消费者来说都标志着一个奇点的到来：AI 不再是聊天工具，而是显式或隐式地接管了我们的数字生活。</p>
<p>正如那句老话：当一个技术不再被反复提及，才说明它已真正融入生活，如同血液般不可或缺。</p>
<p>然而，越是无感，越要警惕。当 AI 深入工作流的每一个细节，隐私将成为最昂贵的奢侈品。在追求极致自动化与效率的同时，如何选择服务商、如何平衡本地与云端模型、如何保留最后一点象征性的“隐私”，将是我们在 2026 年必须面对的命题。</p>
<p>2026 来了，你开始将 AI 集成到自己的工作流中了吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-117%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-117/" ref="nofollow noopener noreferrer">本期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-116%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-116/" ref="nofollow noopener noreferrer">前一期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">全部周报列表</a></p>
<blockquote>
<p>🚀 <strong>《肘子的 Swift 周报》</strong></p>
<p>每周为你精选最值得关注的 Swift、SwiftUI 技术动态</p>
<ul>
<li><strong>📮 立即订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Ffatbobman" target="_blank" title="https://weekly.fatbobman.com/fatbobman" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取完整内容</li>
<li><strong>👥 加入社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 与 2000+ 开发者交流</li>
<li><strong>📚 深度教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 探索 200+ 原创文章</li>
</ul>
</blockquote>
<h2 data-id="heading-1">近期推荐</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fzipic-1-from-0-to-1%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520117%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/zipic-1-from-0-to-1/?utm_source=fatbobman%20weekly%20issue%20117&amp;utm_medium=web" ref="nofollow noopener noreferrer">独立开发者的试炼：Zipic 从 0 到 1 的产品化之路</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fzipic" target="_blank" title="https://l.fatbobman.com/zipic" ref="nofollow noopener noreferrer">Zipic</a> 是我一直在高频使用的图片压缩工具，我亲眼见证了这个应用如何从一个职场工作的小需求，逐渐在作者 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fokooo5km" target="_blank" title="https://x.com/okooo5km" ref="nofollow noopener noreferrer">十里</a> 的不断打磨下成长为一个高效、精致、专注的成功产品。独立开发者往往意味着“一人成军”，时刻在策略、设计、开发、分发与推广之间来回切换。为了挖掘这背后的故事，我邀请了十里复盘了 Zipic 从 0 到 1 的全过程。全文共分三个篇章：产品设计（本文）、<a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fzipic-2-selling-and-distribution%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520117%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/zipic-2-selling-and-distribution/?utm_source=fatbobman%20weekly%20issue%20117&amp;utm_medium=web" ref="nofollow noopener noreferrer">不依赖 Mac App Store 的分发与售卖</a> 以及 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fzipic-3-technical-details%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520117%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/zipic-3-technical-details/?utm_source=fatbobman%20weekly%20issue%20117&amp;utm_medium=web" ref="nofollow noopener noreferrer">技术细节复盘：SwiftUI 痛点与性能瓶颈</a>。</p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-01" target="_blank" title="https://l.fatbobman.com/w0117-01" ref="nofollow noopener noreferrer">Swift vs. Rust：从内存管理的终极对决中学到的 5 个惊人事实</a></h3>
<p>在开发者社区中，关于 Swift 和 Rust 性能的讨论从未停止。通常的看法是：Swift 因为自动引用计数（ARC）而相对较慢，而 Rust 则以其极致的速度和内存效率著称。但 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Frbbtsn0w" target="_blank" title="https://x.com/rbbtsn0w" ref="nofollow noopener noreferrer">Snow</a> 认为，这种“快”与“慢”的简单标签往往掩盖了两者在设计哲学上的根本差异：Swift 优先开发体验和生态兼容，Rust 追求极致性能和编译时安全。</p>
<p>结合实际案例，文章揭示了五个真相：Rust 的所有权规则本质上是零开销的编译时工具；Swift 的真正性能包袱来自 Objective-C 兼容性而非 ARC 本身；ARC 的核心问题是性能的不可预测性；并发安全上 Swift 依赖运行时保护而 Rust 实现编译时保证；以及为何 Swift 无法“变成”Rust。</p>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-02-1" target="_blank" title="https://l.fatbobman.com/w0117-02-1" ref="nofollow noopener noreferrer">StoreKit 订阅实战指南 (StoreKit Subscriptions: A Practical Guide)</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fazamsharp" target="_blank" title="https://x.com/azamsharp" ref="nofollow noopener noreferrer">Mohammad Azam</a> 基于多年 iOS 开发经验和真实案例，撰写了完整的 StoreKit 订阅实践教程。系列涵盖：变现模型选择（一次性购买、订阅、消耗型购买及混合策略）、<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-02-2" target="_blank" title="https://l.fatbobman.com/w0117-02-2" ref="nofollow noopener noreferrer">付费墙策略对比</a>（软/硬付费墙及订阅试用的权衡）、<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-02-3" target="_blank" title="https://l.fatbobman.com/w0117-02-3" ref="nofollow noopener noreferrer">引导体验设计</a>（从静态截图演进到 8 步交互式引导，让用户在付费前完成核心功能体验并建立情感投入）、以及<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-02-4" target="_blank" title="https://l.fatbobman.com/w0117-02-4" ref="nofollow noopener noreferrer">完整的技术实现</a>（App Store Connect 配置、StoreKit 集成、产品加载和购买流程的代码示例）。</p>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-03" target="_blank" title="https://l.fatbobman.com/w0117-03" ref="nofollow noopener noreferrer">Skip 2025 回顾与 2026 路线图 (Skip 2025 Retrospective and 2026 Roadmap)</a></h3>
<p>在 2025 年，随着 Swift SDK for Android 在 swift.org 正式发布，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fskiptools" target="_blank" title="https://x.com/skiptools" ref="nofollow noopener noreferrer">Skip</a> 通过 Skip Fuse 提供原生编译支持，解锁了数千个原生 Swift 包在 Android 上的使用。同时新增 NFC、Stripe、PostHog、Auth0、Socket.IO 等双平台框架。iOS 26 推出的 Liquid Glass 界面风格成为跨平台框架的试金石。Skip 因采用“完全原生”策略（iOS 上使用原生 SwiftUI，Android 上映射到 Jetpack Compose）而在第一天就自动支持新界面，无需重写或变通。在 2026 年 Skip 计划继续扩展集成框架、优化 Skip Fuse 工具链、提升性能和开发体验。</p>
<hr/>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-04" target="_blank" title="https://l.fatbobman.com/w0117-04" ref="nofollow noopener noreferrer">如何使用 Claude Code (How to use Claude Code)</a></h3>
<p>这是一份 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fonmyway133" target="_blank" title="https://x.com/onmyway133" ref="nofollow noopener noreferrer">Khoa Pham</a> 在高强度使用 Claude Code 数月后整理的实战指南。核心技巧包括各种不同模式的详细应用场景，尤其是如何合理使用 Extended Thinking 模式以避免浪费 Token。另外还涵盖了关键快捷键、上下文管理技巧、MCP 集成、VS Code 和 Chrome 扩展、GitHub Actions 集成、Git Worktrees 并行工作流、插件生态以及提示词最佳实践等众多内容。内容详实、具体、有针对性，并非简单的功能介绍手册。</p>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-05" target="_blank" title="https://l.fatbobman.com/w0117-05" ref="nofollow noopener noreferrer">App Store Connect API Webhook 串接｜提升 iOS CI/CD 自动化效率与通知流程</a></h3>
<p>苹果在 WWDC 2025 中发布了 App Store Connect API Webhook，支持构建状态、App 版本状态、TestFlight 反馈等事件的实时推送。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fzhgchgli%2F" target="_blank" title="https://www.linkedin.com/in/zhgchgli/" ref="nofollow noopener noreferrer">Zhong Cheng</a> 针对打包上传后传统 Polling 方式需等待约 20 分钟（GitHub Runner 浪费 $1.24/次）的痛点，详细介绍了如何在 CI/CD 中应用该能力，实现零等待成本；GitFlow 回 master 时机可精确对齐 App 实际发布时间；开发者权限受限时也能及时收到拒审通知。</p>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-06" target="_blank" title="https://l.fatbobman.com/w0117-06" ref="nofollow noopener noreferrer">使用 WendyOS 开发嵌入式 Linux 应用 (Setting up Embedded Linux with WendyOS)</a></h3>
<p>WendyOS 是一个专为嵌入式设备设计的 Linux 发行版，用 Swift 编写，旨在将 iOS 开发的便捷性带到嵌入式领域。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FJoannisOrlandos" target="_blank" title="https://x.com/JoannisOrlandos" ref="nofollow noopener noreferrer">Joannis Orlandos</a> 在本文中提供了完整上手教程：从安装 Homebrew 和 Wendy 工具、刷写 WendyOS 到树莓派/Jetson Orin Nano 等设备、通过 USB 连接设备、配置 WiFi、创建 Swift 项目（含 <code>wendy.json</code> 权限配置）到使用 VSCode 扩展进行远程调试（支持断点和状态检查）。适合想将 Swift 应用到嵌入式设备或 IoT 场景的开发者作为入门教程。</p>
<h2 data-id="heading-9">工具</h2>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-07" target="_blank" title="https://l.fatbobman.com/w0117-07" ref="nofollow noopener noreferrer">Swift 并发：通俗易懂的学习指南 (Fucking Approachable Swift Concurrency)</a></h3>
<p>这是一个由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fpepicrft" target="_blank" title="https://x.com/pepicrft" ref="nofollow noopener noreferrer">Pedro Piñera</a> 创建、基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.social%2F%40mattiem" target="_blank" title="https://mastodon.social/@mattiem" ref="nofollow noopener noreferrer">Matt Massicotte</a> 的 Swift 并发理念整理的学习资源，用通俗易懂的方式解释 async/await、Task、Actor、Sendable 等核心概念。Pedro 通过 "Office Building（办公楼）" 这一场景，将 MainActor 比作前台、actor 比作部门办公室、await 比作敲门等待，帮助开发者建立直观的心智模型。 另外，还提供了一个适用于 AI 工具的 Skill.md 文件，方便开发者将上述并发实践直接嵌入到开发工作流的规则引擎中。</p>
<hr/>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-08" target="_blank" title="https://l.fatbobman.com/w0117-08" ref="nofollow noopener noreferrer">Dimillian's Skills - iOS/Swift 开发 AI Agent Skills 集合</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDimillian" target="_blank" title="https://github.com/Dimillian" ref="nofollow noopener noreferrer">Thomas Ricouard</a> 创建的用于 iOS/Swift 开发的 Skills 仓库，包含六个专注于实际工作流的 AI Agent Skills。涵盖 App Store Changelog 生成（从 git history 自动生成发布说明）、iOS Debugger Agent（使用 XcodeBuildMCP 构建/调试 iOS 项目）、Swift Concurrency Expert（修复 Swift 6.2 并发问题）、SwiftUI Liquid Glass（实现 iOS 26+ Liquid Glass API）、SwiftUI View Refactor（重构视图结构和依赖模式）、SwiftUI Performance Audit（审查性能瓶颈并提供优化建议）等。</p>
<hr/>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0117-09" target="_blank" title="https://l.fatbobman.com/w0117-09" ref="nofollow noopener noreferrer">StoreKit Helper - SwiftUI 应用内购买封装库</a></h3>
<p>由<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fjaywcjlove" target="_blank" title="https://x.com/jaywcjlove" ref="nofollow noopener noreferrer">jaywcjlove</a>开发的轻量级 StoreKit 2 封装库，专为 SwiftUI 设计，大幅简化应用内购买实现。相比直接使用 StoreKit 2 API，StoreKitHelper 减少了约 70% 的样板代码，特别适合需要快速集成应用内购买且不想处理底层复杂性的 SwiftUI 开发者。</p>
<p>核心特性包括：基于 <code>@ObservableObject</code> 的状态管理、协议驱动的类型安全产品定义、实时交易监听和自动状态更新、内置的 <code>StoreKitHelperView</code> 和 <code>StoreKitHelperSelectionView</code> UI 组件。通过 <code>hasNotPurchased</code>/<code>hasPurchased</code> 属性可以轻松控制界面显示，支持链式 API 配置购买弹窗的各种回调。</p>
<h2 data-id="heading-13">求贤</h2>
<h3 data-id="heading-14"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fphoton-hq" target="_blank" title="https://github.com/photon-hq" ref="nofollow noopener noreferrer">Mac OS 工程师</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fphoton-hq" target="_blank" title="https://github.com/photon-hq" ref="nofollow noopener noreferrer">Photon</a> 正在构建开源基础设施，帮助开发者将 AI Agent 带到人类已经熟悉的交互界面中，例如 iMessage、WhatsApp、电话通话、Discord、Signal 等。在此之上，我们还在打造以交互为核心的开源 Agent SDK，覆盖多段消息处理、消息线程处理、表情/回应（Tapbacks）等能力，让开发者和企业能够开发真正"像人一样"交流的 Agent。</p>
<p><strong>职位要求</strong></p>
<p>我们正在招聘 macOS 工程师，理想的候选人应具备以下条件：</p>
<ul>
<li>对 macOS 内部机制以及系统组件之间的交互有深入理解</li>
<li>具备 macOS 系统分析与调试经验</li>
<li>熟悉 macOS 系统级 API 及底层机制</li>
<li>对探索 Apple 服务中的未知部分有好奇心</li>
<li>加分项：有 iMessage、IMAgent 或相关消息基础设施的经验</li>
</ul>
<p><strong>薪资待遇</strong></p>
<p>我们将提供具有竞争力的薪资（工作地点：美国，支持远程办公）。此外，Photon 获得多家知名投资机构的支持。</p>
<p><strong>联系方式</strong></p>
<p><a href="https://link.juejin.cn?target=mailto%3Aryan%40photon.codes" target="_blank" title="mailto:ryan@photon.codes" ref="nofollow noopener noreferrer">ryan@photon.codes</a></p>
<blockquote>
<p>这是朋友创业团队 Photon 的招聘。他们在做 AI Agent 在 iMessage/WhatsApp 等平台的基础设施，是个早期项目。如果你对 macOS 底层技术和早期创业机会感兴趣，可以了解一下。</p>
</blockquote>
<h2 data-id="heading-15">往期内容</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-116%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-116/" ref="nofollow noopener noreferrer">Swift、SwiftUI 与 SwiftData：走向成熟的 2025 - #116</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-115%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-115/" ref="nofollow noopener noreferrer">周日小插曲 - #115</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-114%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-114/" ref="nofollow noopener noreferrer">挖掘“沉默的专家”- #114</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-113%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-113/" ref="nofollow noopener noreferrer">当 Android 手机『强行兼容』AirDrop - #113</a></li>
</ul>
<h2 data-id="heading-16">💝 支持与反馈</h2>
<p>如果本期周报对你有帮助，请：</p>
<ul>
<li>👍 <strong>点赞</strong> - 让更多开发者看到</li>
<li>💬 <strong>评论</strong> - 分享你的看法或问题</li>
<li>🔄 <strong>转发</strong> - 帮助同行共同成长</li>
</ul>
<hr/>
<blockquote>
<p>🚀 <strong>拓展 Swift 视野</strong></p>
<ul>
<li><strong>📮 邮件订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Fwelcome" target="_blank" title="https://weekly.fatbobman.com/welcome" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取独家技术洞察</li>
<li><strong>👥 开发者社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 实时交流开发经验</li>
<li><strong>📚 原创教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 学习 Swift/SwiftUI 最佳实践</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[练习 AI 编程两年半，2026 年我留下了这些工具]]></title>    <link>https://juejin.cn/post/7591715454134616127</link>    <guid>https://juejin.cn/post/7591715454134616127</guid>    <pubDate>2026-01-05T23:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591715454134616127" data-draft-id="7591715454134599743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="练习 AI 编程两年半，2026 年我留下了这些工具"/> <meta itemprop="keywords" content="AI编程,Trae,Cursor"/> <meta itemprop="datePublished" content="2026-01-05T23:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陈佬昔编程人生"/> <meta itemprop="url" content="https://juejin.cn/user/3087084378402445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            练习 AI 编程两年半，2026 年我留下了这些工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084378402445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陈佬昔编程人生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T23:56:58.000Z" title="Mon Jan 05 2026 23:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026 新年好！</p>
<p>不知不觉用 AI 编程已经有 2 年多的时间了。</p>
<p>从最初对 AI 辅助编程的好奇尝试，到如今它已成为我日常开发中不可或缺的一部分。AI 确确实实给我带来了工作效率的极大提升。</p>
<p>在用了那么多工具后，我选择留下这些：</p>
<h2 data-id="heading-0">插件：Cline</h2>
<p>这款插件几乎覆盖了所有主流IDE，从VS Code、Windsurf到 JetBrains等，兼容性极强。</p>
<p>它支持接入多种大模型，包括GPT-4、Claude和国产模型，通过统一的界面调用，避免了在不同平台间切换的麻烦。</p>
<p>目前它是我用过功能最全面、响应最稳定的AI编程插件。</p>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcline.bot%2F" target="_blank" title="https://cline.bot/" ref="nofollow noopener noreferrer">cline.bot/</a></p>
<h2 data-id="heading-1">IDE：cursor 和 Trae</h2>
<p>首选的 AI 编程IDE依然是 Cursor，能力无庸置疑。从 Claude Sonnet 4.5 到自家的模型，提供了流畅的本地化体验。</p>
<p>目前 Auto 模式就能适应大部分的场景了，减少了开发者的心智负担。</p>
<p>20 刀的套餐，已经够老程序员折腾了。</p>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn" target="_blank" title="https://cursor.com/cn" ref="nofollow noopener noreferrer">cursor.com/cn</a></p>
<p>而 Trae CN，相比其他国产 IDE 的优势确实更明显：</p>
<ul>
<li>国内 IDE 中更新速度频率最快最多的，官方统计一年迭代了 200 多次；</li>
<li>国内最新的大模型第一个支持，比如刚发布的GLM 4.7和MiniMax M2.1；</li>
<li>支持第三方平台接入，允许用户自定义模型端点，灵活性很高。</li>
</ul>
<p>不过，它的 Auto 模式调优一般，推荐手动选择 GLM 或 MiniMax 模型。</p>
<p>字节最近在大批量招程序员做数据标注，估计是对公开的数据集不满意，需要自建更好的数据集，来做自家的编程模型了，期待明年发力吧。</p>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trae.cn%2F" target="_blank" title="https://www.trae.cn/" ref="nofollow noopener noreferrer">www.trae.cn/</a></p>
<p>至于 Qoder，早期给我的体验很好，界面流畅且响应迅速，一度是我最喜欢的国产IDE。但是还是封闭了，限制了模型选择和插件生态。</p>
<p>对比下，我还是选择贵一点但更成熟的 Cursor 。若限制在国内网络环境下，我会选择更实用的 Trae。</p>
<p>其他IDE如Kiro、Codebuddy和comate，我暂时将它们留在观察名单中。</p>
<h2 data-id="heading-2">CLI：Claude Code 和...</h2>
<p>虽然我对 Anthropic 这家公司没什么好感，但 Claude Code 频繁地出现还是引起了我的注意。最近它的 Skill 这类衍生功能就一再刷屏，不过暂时还没有时间尝试。</p>
<p>CLI 这类命令行工具的好处是可以获取更多的权限，因此它能做更多的事情，体验上也能做得比 IDE 更顺畅。</p>
<p>不过也有不少网友反馈，CLI 误删了文件夹之类的事情。所以使用的时候还是要多注意。</p>
<p>国内的 CLI 赛道还没跑出来，大厂虽有产品，但未见大力宣传。明年继续关注吧。</p>
<h2 data-id="heading-3">国产大模型：GLM 4.7 和 MiniMax M2.1</h2>
<p>GLM 和 MiniMax 是目前国内最卷的两个模型了。</p>
<p>经过迭代，编程能力已经明显要优于其他开源模型。因此也成了 IDE、插件、CLI工具的开源模型首选。</p>
<p>GLM 和 MiniMax 背后的公司，这几天就上市了，后续估计竞争会更火热。</p>
<p>官网地址：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2F" target="_blank" title="https://open.bigmodel.cn/" ref="nofollow noopener noreferrer">open.bigmodel.cn/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.minimaxi.com%2F" target="_blank" title="https://www.minimaxi.com/" ref="nofollow noopener noreferrer">www.minimaxi.com/</a></li>
</ul>
<p>Deepseek 还是更期待它的大版本更新吧。</p>
<p>回望2025年，AI 编程确实在很多方面展现了令人惊叹的潜力，但同时也暴露出不少明显的不足。例如在工程化上、在复杂逻辑上、在业务理解上都有不少缺陷。</p>
<p>2026年，随着算法模型的持续迭代、训练数据的进一步丰富以及计算资源的优化，AI 编程工具有望变得更加智能和实用。让我们保持关注，继续期待它在未来一年带来的积极变化与惊喜吧~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 创建对象，除了 new 你还知道哪些方式？]]></title>    <link>https://juejin.cn/post/7591672090790854675</link>    <guid>https://juejin.cn/post/7591672090790854675</guid>    <pubDate>2026-01-06T00:03:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591672090790854675" data-draft-id="7582090790183092262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 创建对象，除了 new 你还知道哪些方式？"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-06T00:03:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 创建对象，除了 new 你还知道哪些方式？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T00:03:01.000Z" title="Tue Jan 06 2026 00:03:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>昨晚加班的时候，同事来旁边坐着跟我闲聊，不经意间看到屏幕上的new 对象代码，他说：“每次这样new 一个对象感觉好丑，有没有更好的方式方法！”。</p>
<p>我说：“有啊，不过也得看场景，简单的直接用 new 一把梭哈！复杂的再考虑其它的方式”</p>
<p>那有哪些方式呢？下面来分享一下。</p>
<h2 data-id="heading-0">1. new关键字</h2>
<p>最直接的创建方式</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 就像我们平时说话：&amp;#34;来一辆新车&amp;#34;</span>
<span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();

<span class="hljs-comment">// 或者带参数的：&amp;#34;来一辆红色的宝马&amp;#34;</span>
<span class="hljs-type">Car</span> <span class="hljs-variable">bmw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(&amp;#<span class="hljs-number">34</span>;宝马&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;红色&amp;#<span class="hljs-number">34</span>;);
</code></pre>
<p><strong>使用场景</strong>：这是<strong>最常用</strong>的方式，适合90%的日常开发场景。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>简单直观，一眼就能看懂</li>
<li>性能好，直接调用构造方法</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>不够灵活，创建逻辑与使用代码耦合</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. 反射机制</h2>
<p>有时候我们需要在运行时才知道要创建什么类的对象，这时候反射就派上用场了。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统方式：我知道要创建Car</span>
<span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();

<span class="hljs-comment">// 反射方式：运行时才知道要创建什么</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">Class</span> <span class="hljs-variable">carClass</span> <span class="hljs-operator">=</span> Class.forName(&amp;#<span class="hljs-number">34</span>;com.example.Car&amp;#<span class="hljs-number">34</span>;);
    <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> carClass.getConstructor();
    <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> (Car) constructor.newInstance();
} <span class="hljs-keyword">catch</span> (Exception e) {
    e.printStackTrace();
}
</code></pre>
<p><strong>案例</strong>：Spring框架中，当我们配置了<code>@Component</code>注解的类，Spring就是通过反射来创建这些对象的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring内部大致是这样做的</span>
<span class="hljs-type">Class</span> <span class="hljs-variable">beanClass</span> <span class="hljs-operator">=</span> loadClass(&amp;#<span class="hljs-number">34</span>;com.example.UserService&amp;#<span class="hljs-number">34</span>;);
<span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> beanClass.getDeclaredConstructor().newInstance();
</code></pre>
<hr/>
<h2 data-id="heading-2">3. clone()方法</h2>
<p>假设你有一个配置好的对象，现在需要另一个一模一样的，这时候clone就很有用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSettings</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">theme</span> <span class="hljs-operator">=</span> &amp;#<span class="hljs-number">34</span>;dark&amp;#<span class="hljs-number">34</span>;;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">fontSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserSettings <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> (UserSettings) <span class="hljs-built_in">super</span>.clone();
        } <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>();
        }
    }
}

<span class="hljs-comment">// 使用clone</span>
<span class="hljs-type">UserSettings</span> <span class="hljs-variable">original</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserSettings</span>();
<span class="hljs-type">UserSettings</span> <span class="hljs-variable">cloned</span> <span class="hljs-operator">=</span> original.clone(); <span class="hljs-comment">// 得到一个完全相同的副本</span>
</code></pre>
<p><strong>注意点</strong>：</p>
<ul>
<li>需要实现<code>Cloneable</code>接口，否则会抛出异常</li>
<li>默认是浅拷贝，如果需要深拷贝要自己实现</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. 反序列化</h2>
<p>当我们把对象保存到文件或通过网络传输后，需要重新把它变回对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 对象需要实现Serializable接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GameSave</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> level;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> score;
}

<span class="hljs-comment">// 保存对象到文件</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(&amp;#<span class="hljs-number">34</span>;save.dat&amp;#<span class="hljs-number">34</span>;))) {
    oos.writeObject(gameSave);
}

<span class="hljs-comment">// 从文件读取对象</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(&amp;#<span class="hljs-number">34</span>;save.dat&amp;#<span class="hljs-number">34</span>;))) {
    <span class="hljs-type">GameSave</span> <span class="hljs-variable">loadedSave</span> <span class="hljs-operator">=</span> (GameSave) ois.readObject();
    <span class="hljs-comment">// loadedSave就是原来那个gameSave的副本</span>
}
</code></pre>
<hr/>
<hr/>
<h2 data-id="heading-4">5. 静态工厂方法</h2>
<p>有时候直接new不够表达我们的意图，这时候工厂方法就很有用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> red, green, blue;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Color</span><span class="hljs-params">(<span class="hljs-type">int</span> r, <span class="hljs-type">int</span> g, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-built_in">this</span>.red = r;
        <span class="hljs-built_in">this</span>.green = g;
        <span class="hljs-built_in">this</span>.blue = b;
    }
    
    <span class="hljs-comment">// 静态工厂方法：语义更明确</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Color <span class="hljs-title function_">fromRGB</span><span class="hljs-params">(<span class="hljs-type">int</span> r, <span class="hljs-type">int</span> g, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(r, g, b);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Color <span class="hljs-title function_">fromHex</span><span class="hljs-params">(String hex)</span> {
        <span class="hljs-comment">// 解析十六进制颜色码</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(<span class="hljs-comment">/* 解析逻辑 */</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Color <span class="hljs-title function_">red</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Color</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    }
}

<span class="hljs-comment">// 使用：这样读起来更自然</span>
<span class="hljs-type">Color</span> <span class="hljs-variable">red</span> <span class="hljs-operator">=</span> Color.red();
<span class="hljs-type">Color</span> <span class="hljs-variable">custom</span> <span class="hljs-operator">=</span> Color.fromRGB(<span class="hljs-number">255</span>, <span class="hljs-number">128</span>, <span class="hljs-number">0</span>);
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>方法名可以表达创建意图</li>
<li>可以缓存对象，避免重复创建</li>
<li>可以返回子类对象，更灵活</li>
</ul>
<hr/>
<h2 data-id="heading-5">6. Builder模式</h2>
<p>当对象有很多属性时，构造方法会变得很长很难读，Builder模式来解决！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String cpu;          <span class="hljs-comment">// 必须</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String ram;          <span class="hljs-comment">// 必须  </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String storage;      <span class="hljs-comment">// 必须</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String graphicsCard; <span class="hljs-comment">// 可选</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String monitor;      <span class="hljs-comment">// 可选</span>
    
    <span class="hljs-comment">// 私有构造方法，只能通过Builder创建</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Computer</span><span class="hljs-params">(Builder builder)</span> {
        <span class="hljs-built_in">this</span>.cpu = builder.cpu;
        <span class="hljs-built_in">this</span>.ram = builder.ram;
        <span class="hljs-built_in">this</span>.storage = builder.storage;
        <span class="hljs-built_in">this</span>.graphicsCard = builder.graphicsCard;
        <span class="hljs-built_in">this</span>.monitor = builder.monitor;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-comment">// 必须参数</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String cpu;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String ram;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String storage;
        
        <span class="hljs-comment">// 可选参数</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">graphicsCard</span> <span class="hljs-operator">=</span> &amp;#<span class="hljs-number">34</span>;集成显卡&amp;#<span class="hljs-number">34</span>;;
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">monitor</span> <span class="hljs-operator">=</span> &amp;#<span class="hljs-number">34</span>;<span class="hljs-number">23</span>寸显示器&amp;#<span class="hljs-number">34</span>;;
        
        <span class="hljs-comment">// Builder构造方法包含必须参数</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Builder</span><span class="hljs-params">(String cpu, String ram, String storage)</span> {
            <span class="hljs-built_in">this</span>.cpu = cpu;
            <span class="hljs-built_in">this</span>.ram = ram;
            <span class="hljs-built_in">this</span>.storage = storage;
        }
        
        <span class="hljs-comment">// 设置可选参数的方法</span>
        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">graphicsCard</span><span class="hljs-params">(String graphicsCard)</span> {
            <span class="hljs-built_in">this</span>.graphicsCard = graphicsCard;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">monitor</span><span class="hljs-params">(String monitor)</span> {
            <span class="hljs-built_in">this</span>.monitor = monitor;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        <span class="hljs-keyword">public</span> Computer <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Computer</span>(<span class="hljs-built_in">this</span>);
        }
    }
}

<span class="hljs-comment">// 使用Builder模式：链式调用，非常清晰</span>
<span class="hljs-type">Computer</span> <span class="hljs-variable">gamingPC</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Computer</span>.Builder(&amp;#<span class="hljs-number">34</span>;i7&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;16GB&amp;#<span class="hljs-number">34</span>;, &amp;#<span class="hljs-number">34</span>;1TB SSD&amp;#<span class="hljs-number">34</span>;)
    .graphicsCard(&amp;#<span class="hljs-number">34</span>;RTX <span class="hljs-number">3080</span>&amp;#<span class="hljs-number">34</span>;)
    .monitor(&amp;#<span class="hljs-number">34</span>;<span class="hljs-number">27</span>寸4K显示器&amp;#<span class="hljs-number">34</span>;)
    .build();
</code></pre>
<p><strong>适用场景</strong>：</p>
<ul>
<li>对象有很多属性，特别是可选属性很多时</li>
<li>希望创建过程更清晰、易读</li>
<li>需要创建不可变对象</li>
</ul>
<hr/>
<h2 data-id="heading-6">7. 匿名内部类</h2>
<p>当我们只需要某个接口的一次性实现时，匿名内部类很方便。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建线程的传统方式</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(&amp;#<span class="hljs-number">34</span>;执行任务&amp;#<span class="hljs-number">34</span>;);
    }
}

<span class="hljs-type">Runnable</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>();

<span class="hljs-comment">// 使用匿名内部类：更简洁</span>
<span class="hljs-type">Runnable</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(&amp;#<span class="hljs-number">34</span>;执行任务&amp;#<span class="hljs-number">34</span>;);
    }
};

<span class="hljs-comment">// Java 8以后，可以用lambda表达式进一步简化</span>
<span class="hljs-type">Runnable</span> <span class="hljs-variable">task3</span> <span class="hljs-operator">=</span> () -&gt; System.out.println(&amp;#<span class="hljs-number">34</span>;执行任务&amp;#<span class="hljs-number">34</span>;);
</code></pre>
<hr/>
<h2 data-id="heading-7">8. 方法引用</h2>
<p>Java 8引入了函数式编程，让对象创建更加优雅。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">private</span> String name;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.name = &amp;#<span class="hljs-number">34</span>;匿名&amp;#<span class="hljs-number">34</span>;;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }
}

<span class="hljs-comment">// 方法引用创建对象</span>
<span class="hljs-type">Supplier</span> <span class="hljs-variable">defaultPerson</span> <span class="hljs-operator">=</span> Person::<span class="hljs-keyword">new</span>;
<span class="hljs-type">Function</span> <span class="hljs-variable">namedPerson</span> <span class="hljs-operator">=</span> Person::<span class="hljs-keyword">new</span>;

<span class="hljs-comment">// 使用</span>
<span class="hljs-type">Person</span> <span class="hljs-variable">p1</span> <span class="hljs-operator">=</span> defaultPerson.get();      <span class="hljs-comment">// 调用无参构造</span>
<span class="hljs-type">Person</span> <span class="hljs-variable">p2</span> <span class="hljs-operator">=</span> namedPerson.apply(&amp;#<span class="hljs-number">34</span>;张三&amp;#<span class="hljs-number">34</span>;); <span class="hljs-comment">// 调用有参构造</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">总结</h2>








































<table><thead><tr><th>场景</th><th>推荐方式</th><th>理由</th></tr></thead><tbody><tr><td>日常开发</td><td>new关键字</td><td>简单直接，性能好</td></tr><tr><td>多参数对象</td><td>Builder模式</td><td>可读性好，灵活</td></tr><tr><td>需要封装创建逻辑</td><td>静态工厂方法</td><td>隐藏实现细节</td></tr><tr><td>框架开发</td><td>反射机制</td><td>动态性，灵活性</td></tr><tr><td>函数式编程</td><td>方法引用</td><td>代码简洁，表达力强</td></tr><tr><td>创建对象副本</td><td>clone()方法</td><td>语义明确，使用方便</td></tr></tbody></table>
<p>简单场景用<code>new</code>，复杂对象用<code>Builder</code>，需要灵活性用工厂方法或反射。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-9">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FU3HhCz5WiAMNM7foxuTa0w" target="_blank" title="https://mp.weixin.qq.com/s/U3HhCz5WiAMNM7foxuTa0w" ref="nofollow noopener noreferrer">《前端高手才知道的秘密：Blob 居然这么强大》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">《重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你真的理解 Interlocked.Exchange 吗？C#.NET 原子操作详解]]></title>    <link>https://juejin.cn/post/7591744347827109914</link>    <guid>https://juejin.cn/post/7591744347827109914</guid>    <pubDate>2026-01-05T23:01:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744347827109914" data-draft-id="7591719013489262630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你真的理解 Interlocked.Exchange 吗？C#.NET 原子操作详解"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2026-01-05T23:01:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你真的理解 Interlocked.Exchange 吗？C#.NET 原子操作详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T23:01:59.000Z" title="Mon Jan 05 2026 23:01:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">什么是 Interlocked.Exchange？</h3>
<p><code>Interlocked.Exchange</code> 是 <code>System.Threading.Interlocked</code> 类中的静态方法，用于原子地替换（交换）一个变量的值，并返回该变量的旧值。整个读-改-写过程是不可分割的，在多线程环境中保证线程安全。</p>
<ul>
<li>
<p>核心作用：无锁地（<code>lock-free</code>）将变量设置为新值，同时获取旧值。</p>
</li>
<li>
<p>常见重载：</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">Exchange</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">int</span> location, <span class="hljs-built_in">int</span> <span class="hljs-keyword">value</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">long</span> <span class="hljs-title">Exchange</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">long</span> location, <span class="hljs-built_in">long</span> <span class="hljs-keyword">value</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">float</span> <span class="hljs-title">Exchange</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">float</span> location, <span class="hljs-built_in">float</span> <span class="hljs-keyword">value</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Exchange</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> <span class="hljs-built_in">double</span> location, <span class="hljs-built_in">double</span> <span class="hljs-keyword">value</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T <span class="hljs-title">Exchange</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-keyword">ref</span> T location, T <span class="hljs-keyword">value</span></span>) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span></span>;  <span class="hljs-comment">// 引用类型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">object</span>? Exchange(<span class="hljs-keyword">ref</span> <span class="hljs-built_in">object</span>? location, <span class="hljs-built_in">object</span>? newValue);
</code></pre>
<ul>
<li>
<p>参数：</p>
<ul>
<li>
<p><code>location</code>：要替换的共享变量（必须ref传递，直接操作内存地址）。</p>
</li>
<li>
<p><code>value / newValue</code>：要写入的新值。</p>
</li>
</ul>
</li>
<li>
<p>返回值：操作前的旧值。</p>
</li>
</ul>
<p>底层基于 <code>CPU</code> 的原子交换指令（如 <code>x86</code> 的 <code>xchg</code>），性能极高。</p>
<h3 data-id="heading-1">为什么使用 Interlocked.Exchange？</h3>
<p>普通的 “读取值 + 赋值新值” 是两步非原子操作，多线程下会因竞态条件导致逻辑错误</p>
<ul>
<li>典型问题：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 非原子操作：读取旧值和赋值新值之间可能被其他线程打断</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">UnsafeReplace</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> newValue</span>)</span>
{
    <span class="hljs-built_in">int</span> oldValue = _flag; <span class="hljs-comment">// 步骤1：读取旧值</span>
    _flag = newValue;     <span class="hljs-comment">// 步骤2：赋值新值</span>
    <span class="hljs-keyword">return</span> oldValue;      <span class="hljs-comment">// 返回旧值</span>
}
</code></pre>
<p>若两个线程同时执行上述代码，可能出现 “线程 A 读取旧值后，线程 B 已修改值，线程 A 最终返回的旧值与实际赋值前的旧值不一致” 的问题。
<code>Interlocked.Exchange</code> 将 “读取旧值 + 设置新值” 合并为不可中断的原子操作，从底层杜绝竞态条件，且无需阻塞线程（无锁）。</p>
<ul>
<li>
<p><code>Exchange</code> 的优势：</p>
<ul>
<li>
<p>原子性：读取旧值和写入新值一步完成。</p>
</li>
<li>
<p>高性能：无锁，开销极低。</p>
</li>
<li>
<p>可见性：所有线程立即可见。</p>
</li>
<li>
<p>有序性：写入前的操作不会被重排到之后。</p>
</li>
<li>
<p>无锁：不阻塞线程。</p>
</li>
<li>
<p>适用场景：</p>
<ul>
<li>
<p>线程安全的状态切换（如启用/禁用标志）。</p>
</li>
<li>
<p>实现懒加载单例（替换 <code>null</code> 为实例）。</p>
</li>
<li>
<p>原子更新引用（如缓存对象）。</p>
</li>
<li>
<p>实现 <code>SpinLock</code> 或自定义同步原语。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">核心原理：CPU 级原子指令</h3>
<p><code>Interlocked.Exchange</code> 的原子性依赖 <code>CPU</code> 硬件指令：</p>
<ul>
<li>
<p><code>x86</code> 架构：使用 <code>LOCK XCHG</code> 指令（<code>LOCK</code> 前缀独占内存总线，阻止其他 <code>CPU</code> 核心修改该内存地址）；</p>
</li>
<li>
<p><code>ARM</code> 架构：使用 <code>SWP</code>（交换指令）或 <code>LDXR/STXR</code>（加载 - 存储独占）指令。</p>
</li>
</ul>
<p>同时，该操作会触发全内存屏障（<code>Full Memory fence</code>）：</p>
<ul>
<li>
<p>保证操作前后的内存读写不会被 <code>CPU</code> 重排序；</p>
</li>
<li>
<p>确保所有线程能立即看到变量的最新值（避免 <code>CPU</code> 缓存导致的 “脏读”）。</p>
</li>
</ul>
<h3 data-id="heading-3">基础使用示例</h3>
<h4 data-id="heading-4">最简单的原子替换（返回原始值）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestExchange</span>()</span>
{
    <span class="hljs-comment">// 目标：将_counter从0替换为100，获取原始值</span>
    <span class="hljs-built_in">int</span> newValue = <span class="hljs-number">100</span>;
    <span class="hljs-built_in">int</span> originalValue = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _counter, newValue);
    
    Console.WriteLine(<span class="hljs-string">$"原始值：<span class="hljs-subst">{originalValue}</span>，新值：<span class="hljs-subst">{_counter}</span>"</span>);
    <span class="hljs-comment">// 输出：原始值：0，新值：100</span>

    <span class="hljs-comment">// 再次替换：将_counter从100替换为200</span>
    originalValue = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _counter, <span class="hljs-number">200</span>);
    Console.WriteLine(<span class="hljs-string">$"原始值：<span class="hljs-subst">{originalValue}</span>，新值：<span class="hljs-subst">{_counter}</span>"</span>);
    <span class="hljs-comment">// 输出：原始值：100，新值：200</span>
}
</code></pre>
<h4 data-id="heading-5">线程安全标志位</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _isProcessing = <span class="hljs-number">0</span>; <span class="hljs-comment">// 0=未处理, 1=处理中</span>

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">StartProcessing</span>()</span>
{
    <span class="hljs-comment">// 如果当前为0（未处理），则设为1（处理中）并返回true</span>
    <span class="hljs-keyword">return</span> Interlocked.Exchange(<span class="hljs-keyword">ref</span> _isProcessing, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EndProcessing</span>()</span>
{
    <span class="hljs-comment">// 重置为未处理状态</span>
    Interlocked.Exchange(<span class="hljs-keyword">ref</span> _isProcessing, <span class="hljs-number">0</span>);
}
</code></pre>
<h4 data-id="heading-6">一次性资源释放（防止重复 Dispose）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> IDisposable? _resource;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>()</span>
{
    <span class="hljs-keyword">var</span> res = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _resource, <span class="hljs-literal">null</span>);
    res?.Dispose();
}
</code></pre>
<h4 data-id="heading-7">无锁发布对象（Safe Publication）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-built_in">object</span>? _instance;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-title">GetOrCreate</span>()</span>
{
    <span class="hljs-keyword">if</span> (_instance != <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> _instance;

    <span class="hljs-keyword">var</span> newObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
    Interlocked.Exchange(<span class="hljs-keyword">ref</span> _instance, newObj);
    <span class="hljs-keyword">return</span> newObj;
}
</code></pre>
<h4 data-id="heading-8">多线程下的原子状态切换</h4>
<p>用 <code>Exchange</code> 实现线程安全的 “一次性初始化”（状态从未初始化→已初始化，仅执行一次）：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 状态枚举：0=未初始化，1=初始化中，2=已初始化</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _initState = <span class="hljs-number">0</span>;
<span class="hljs-comment">// 模拟初始化成本高的对象</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ExpensiveObject? _expensiveObj;

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> 线程安全的一次性初始化</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExpensiveObject <span class="hljs-title">GetExpensiveObject</span>()</span>
{
    <span class="hljs-comment">// 1. 原子替换：将状态从0（未初始化）改为1（初始化中）</span>
    <span class="hljs-built_in">int</span> originalState = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _initState, <span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// 2. 只有原始状态是0的线程，执行初始化</span>
    <span class="hljs-keyword">if</span> (originalState == <span class="hljs-number">0</span>)
    {
        Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span>：执行初始化..."</span>);
        _expensiveObj = <span class="hljs-keyword">new</span> ExpensiveObject(); <span class="hljs-comment">// 耗时初始化</span>
        <span class="hljs-comment">// 3. 初始化完成，将状态改为2（已初始化）</span>
        Interlocked.Exchange(<span class="hljs-keyword">ref</span> _initState, <span class="hljs-number">2</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// 其他线程等待初始化完成</span>
        <span class="hljs-keyword">while</span> (_initState != <span class="hljs-number">2</span>)
        {
            Thread.SpinWait(<span class="hljs-number">10</span>); <span class="hljs-comment">// 自旋等待（轻量级）</span>
        }
        Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span>：初始化已完成，直接返回对象"</span>);
    }
    
    <span class="hljs-keyword">return</span> _expensiveObj!;
}

<span class="hljs-comment">// 测试：10个线程同时调用，仅1个线程执行初始化</span>
<span class="hljs-keyword">var</span> tasks = Enumerable.Range(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
    .Select(_ =&gt; Task.Run(() =&gt; GetExpensiveObject()))
    .ToList();
Task.WaitAll(tasks.ToArray());

<span class="hljs-comment">// 模拟创建成本高的对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExpensiveObject</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ExpensiveObject</span>()</span>
    {
        Thread.Sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 模拟1秒耗时初始化</span>
    }
}
</code></pre>
<p>输出结果</p>
<p>仅 1 个线程执行初始化，其余线程等待后直接返回对象：</p>
<pre><code class="hljs language-erlang" lang="erlang">线程<span class="hljs-number">3</span>：执行初始化...
线程<span class="hljs-number">4</span>：初始化已完成，直接返回对象
线程<span class="hljs-number">5</span>：初始化已完成，直接返回对象
...（其余线程均输出此内容）
</code></pre>
<h3 data-id="heading-9">高级应用场景</h3>
<h4 data-id="heading-10">单例模式（结合 <code>Exchange</code> 实现懒加载）</h4>
<p>用 <code>Exchange</code> 替代 <code>lock</code> 实现高性能单例</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LazySingleton</span>
{
    <span class="hljs-comment">// 单例实例（引用类型）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> LazySingleton? _instance;
    <span class="hljs-comment">// 初始化标记：0=未初始化，1=已初始化</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _initialized = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">LazySingleton</span>()</span> { } <span class="hljs-comment">// 私有构造</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySingleton Instance
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-comment">// 原子替换：将_initialized从0改为1，仅第一次调用返回0</span>
            <span class="hljs-keyword">if</span> (Interlocked.Exchange(<span class="hljs-keyword">ref</span> _initialized, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>)
            {
                _instance = <span class="hljs-keyword">new</span> LazySingleton(); <span class="hljs-comment">// 仅执行一次初始化</span>
            }
            <span class="hljs-keyword">return</span> _instance!;
        }
    }
}
</code></pre>
<h4 data-id="heading-11">取消令牌的原子重置</h4>
<p>用 <code>Exchange</code> 原子替换 <code>CancellationTokenSource</code>，实现 “取消后重置” 的线程安全逻辑：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CancellationTokenSource? _cts = <span class="hljs-keyword">new</span> CancellationTokenSource();

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> 原子重置取消令牌（取消旧令牌，创建新令牌）</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CancellationToken <span class="hljs-title">ResetCts</span>()</span>
{
    <span class="hljs-comment">// 1. 原子替换旧的Cts为新实例，获取旧实例</span>
    CancellationTokenSource? oldCts = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _cts, <span class="hljs-keyword">new</span> CancellationTokenSource());
    <span class="hljs-comment">// 2. 取消旧令牌（避免旧任务继续执行）</span>
    <span class="hljs-keyword">if</span> (oldCts != <span class="hljs-literal">null</span>)
    {
        oldCts.Cancel();
        oldCts.Dispose();
    }
    <span class="hljs-comment">// 3. 返回新令牌</span>
    <span class="hljs-keyword">return</span> _cts.Token;
}
</code></pre>
<h4 data-id="heading-12">引用类型：原子替换对象引用（最常用）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> ExpensiveObject? _cache = <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">public</span> ExpensiveObject <span class="hljs-title">GetOrCreate</span>()</span>
{
    <span class="hljs-comment">// 如果为 null，原子替换为新实例</span>
    <span class="hljs-keyword">var</span> newInstance = <span class="hljs-keyword">new</span> ExpensiveObject();
    <span class="hljs-keyword">var</span> oldInstance = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _cache, newInstance);

    <span class="hljs-keyword">return</span> oldInstance ?? newInstance;  <span class="hljs-comment">// 如果旧值为 null，返回新实例</span>
}
</code></pre>
<h4 data-id="heading-13">与 Interlocked.CompareExchange 的关系</h4>

















<table><thead><tr><th>方法</th><th>行为</th></tr></thead><tbody><tr><td>Exchange</td><td>无条件替换</td></tr><tr><td>CompareExchange</td><td>条件替换（CAS）</td></tr></tbody></table>
<p>对比示例</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Exchange：不管原来是什么，都换</span>
Interlocked.Exchange(<span class="hljs-keyword">ref</span> state, <span class="hljs-number">1</span>);

<span class="hljs-comment">// CompareExchange：只有 state == 0 才换</span>
Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> state, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
</code></pre>
<h3 data-id="heading-14">总结</h3>
<blockquote>
<p>Interlocked.Exchange 是 .NET 中最简单、最快、最安全的“原子替换”操作，
它是实现一次性执行、无锁状态切换、安全对象发布的基石。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[耗时 8 天，我用 Claude Code 开发了 AI 漫剧 APP，并开源了。]]></title>    <link>https://juejin.cn/post/7591719013488410662</link>    <guid>https://juejin.cn/post/7591719013488410662</guid>    <pubDate>2026-01-05T16:04:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591719013488410662" data-draft-id="7591744347826503706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="耗时 8 天，我用 Claude Code 开发了 AI 漫剧 APP，并开源了。"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-05T16:04:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            耗时 8 天，我用 Claude Code 开发了 AI 漫剧 APP，并开源了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T16:04:08.000Z" title="Mon Jan 05 2026 16:04:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 468 篇原创！</p>
<p>大家好，我是热爱编程的苍何。</p>
<p>去年底的时候，我写过 2 篇 AI 漫剧的文章，感兴趣的还挺多的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3b263dc3f18463daaa32ce43506a5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=7yWUd7ZSPKtXCRW2qk3QRr8Z9Ng%3D" alt="图片" loading="lazy"/></p>
<p>也认识了非常多做 AI 漫剧的朋友，我们武汉 AI 圈也举办了 AI 漫剧沙龙，来了超级多的感兴趣的圈友。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1af939f4fa9744fa8512aa7e3163829d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=38%2B4FqgBEnRvdM3j3QxGMyeqYMQ%3D" alt="图片" loading="lazy"/></p>
<p>听了很多的干货分享，当时脑海中只想快速上手来做漫剧。</p>
<p>但我看了很多的平台目前还只能在电脑 web 上操作，手机随时创作我还没找到什么好的 APP。</p>
<p>当时就有一股冲动，要不自己来尝试搞一个？当我和老婆说这个想法的时候，她说我一定疯了。</p>
<p>为了证明我不是疯子，我还是咬牙决定尝试，毕竟不留遗憾才是我的人生主旋律。</p>
<p>耗时 8 天，今天终于可以拿出来和大家分享了，<strong>一个可以在手机端创建漫剧的 app，我给它起名叫做漫导</strong>，没错就是这么通俗易懂；制作漫剧的导演。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfa54130005e4829b2339b91467b5305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=TKScWdLS%2FJAtcV4285OER0vnHxE%3D" alt="图片" loading="lazy"/></p>
<p>它能根据灵感一句话创建剧本、角色、场景，然后自动生成分镜图片和分镜视频，最后根据分镜视频来合成一个完整的漫剧视频。</p>
<p>我录了个视频给大家做个展示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e27465dc4d473797581a989a2a54b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=AwxyqBynV1X1qbw1rTtdprNbA0E%3D" alt="wxv_4328552654785167363" loading="lazy"/></p>
<p>8 天时间出来一个 AI 漫剧 APP 的 MVP 版本（这其中还不包括元旦放假 3 天），我自己已经相当满意了，人物一致性已经完成的很高了👍</p>
<p>最后说一下声音为啥不是中文，抱歉还没来得及约束😄。忍不住想分享了。</p>
<p>而且你可能想象不到的是，整个 APP 的开发，我用的是最近很火的智谱的 GLM 4.7 模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4eed6209f7a447a9a08d5aacc8941082~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=9kgLXnvCZqzM2Xyo5Bcb68t5VMs%3D" alt="图片" loading="lazy"/></p>
<p>你看我的 token 消耗量，这里面包含了两部分，一部分是开发 app 使用的量，一部分是使用 app 规划剧本使用的量。说实话没想到这么多。</p>
<p>再看看账单。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/933b1c2137c948e485f1ff11caf14fcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=xAanL8tEE8L3RLnI5O69VW2DD5A%3D" alt="图片" loading="lazy"/><br/>
没错 20RMB。哦对了，我还在他们搞活动的时候薅了一杯奶茶。有点大薅特薅的感觉；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba5a7ceeac304ca59bbb9ae65151ba5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=1sjOqo1tPogIrrHRwvYFxEVjrnw%3D" alt="图片" loading="lazy"/></p>
<p>我已经把这个 AI 漫剧 APP 开源了，后面也希望有更多的开发者参与到我们的共建中来。</p>
<blockquote>
<p>开源地址（求 star）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffreestylefly%2Fdirector_ai" target="_blank" title="https://github.com/freestylefly/director_ai" ref="nofollow noopener noreferrer">github.com/freestylefl…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c41810092674b83ad241b8429b88df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=n9W%2B83auegmAsmGdyniHqFsxMOs%3D" alt="图片" loading="lazy"/></p>
<p>这一篇文章呢，我主要是想和你分享一下我的开发历程，也顺带来拷打 GLM 4.7 进行 AI Coding 的能力边界。</p>
<p>我总结了一下大概的流程是这样子的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a70dbbed473c4a13829b98722762b2b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=iAGhDtFxsP76eOoIrnvpDWHbr40%3D" alt="图片" loading="lazy"/></p>
<p>其中，我比较关心的是人物一致性解决方案：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bab653b5c16c4e87a7467a76f6023312~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=7jFaDBJ4Qq9NsJohv9tun7vP4pQ%3D" alt="图片" loading="lazy"/></p>
<p>在对应场景的配置默认是给了 7 个，角色是给了 2 个，然后这些我都设置成可配置的了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d37f6e251f84c0593febba5ef239b92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=vAoUJCcBAa84fbPUFkdr%2FOxSFRY%3D" alt="图片" loading="lazy"/></p>
<p>下面分享下我的开发历程，可能会显得文章会有些长，建议点赞收藏，转发给需要的朋友👭</p>
<h2 data-id="heading-0">工具选择</h2>
<p>这次的任务有点重，工具选择很重要，终端的话就选最近全网又在喷火的 Claude Code，模型用智谱 GLM 4.7。</p>
<p>几方面考虑，一个是能力，一个是价格。</p>
<p>能力侧，先来看一张时间取自于 2025 年 12 月 22日的模型榜单图，可以看到和 Claude Opus 4.5 打的有来有回。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0cd90ba5a9147a6bf3b204f365d8c0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=G2sc%2BIMilpVvKjVCcnVL1Jf1XMM%3D" alt="图片" loading="lazy"/></p>
<p>再看看最关心的价格，这是 Claude 的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7c4b5c2c9d4486faf63659bca672148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=XBCatOk2VGoSXPSdbv3G6XrVLgM%3D" alt="图片" loading="lazy"/></p>
<p>这个是 GLM Coding 的套餐，不想说啥了，没有对比就没有伤害啊。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d632e6a59102430fb45aaa2ddd874e09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=qIAo%2BeA0DOG%2B6c%2FAGb7%2Byfcn6oE%3D" alt="图片" loading="lazy"/></p>
<p>虽然我看了非常多网上的测评，但一开始对 GLM 4.7 做漫剧 APP 这件事，本身是抱有怀疑态度的，后面证明，他真的行，而且超出了我的预期。</p>
<h2 data-id="heading-1">开发历程</h2>
<p>首先直接编写提示词告知要做什么，这个很重要。</p>
<pre><code class="hljs language-bash" lang="bash">提示词：现在帮我编写一个安卓软件，用途是制作AI 漫剧，和用户对话的方式来了解用户想制作什么样子的漫剧，对话大模型使用的是 glm 4.7,相关的接口文档都保存在这个目录下面
director_ai/docs/图像生成API接口文档.md
director_ai/docs/视频处理全集.md
这里的接口文档是我去网站上下载来了的。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164fabd87b7646eea45a4620e93508b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=ox33VKloLiOQhvGwP%2F%2FDEGM4clQ%3D" alt="图片" loading="lazy"/></p>
<p>Claude Code 像打了鸡血一样，吭哧吭哧的干货。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/187f98c3fdd64a24902d1bb8c0869eae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=9XlVDs3%2FNRTHHjU4Vt%2BSY4hs9uQ%3D" alt="图片" loading="lazy"/></p>
<p>这里最好给 GLM 4.7 规划下架构，防止跑偏：</p>
<pre><code class="hljs language-makefile" lang="makefile">提示词：
核心技术栈推荐
为了最快速度出原型（MVP）且适配安卓：

开发工具 (IDE/Agent): Claude Code (基于 CLI 的全能编程助手)。

<span class="hljs-section">前端框架: Flutter (Dart)。</span>

理由： Claude 对 Flutter 代码生成的准确度极高，且 Flutter 开发安卓应用速度快、UI 效果好，能够轻松处理异步网络请求（API 调用）。

<span class="hljs-section">核心大脑: GLM-4.7 (通过 API 调用)。</span>

理由： 负责理解用户意图，拆解步骤，输出 JSON 格式的指令。

<span class="hljs-section">多模态接口: tu-zi.com (你提供的 Gemini 绘图 + Veo 视频接口)。</span>
</code></pre>
<p>架构设计这里我采用 ReAct 模式 (Reasoning + Acting)：</p>
<pre><code class="hljs language-scss" lang="scss">架构设计：ReAct 模式 (Reasoning + Acting)
为了凸显 GLM-<span class="hljs-number">4.7</span> 的规划能力，不能把代码写死（硬编码）。我们需要实现一个简单的 ReAct (Reason-Act) 循环。

流程逻辑：

用户输入: <span class="hljs-string">"帮我做一个熊猫吃竹子的视频，要可爱的风格。"</span>

GLM-<span class="hljs-number">4.7</span> (规划层): 思考并输出：<span class="hljs-string">"我需要先生成文案，然后生成图片，最后生成视频。"</span> -&gt; 输出第一个工具调用指令。

App (执行层): 解析指令，调用绘图 API。

App (反馈层): 将图片 URL 喂回给 GLM-<span class="hljs-number">4.7</span>。

GLM-<span class="hljs-number">4.7</span> (规划层): <span class="hljs-string">"收到图片，现在调用视频生成接口。"</span>

App (执行层): 调用 Veo 视频接口。
</code></pre>
<p>小白不用管，就是一蹲乱七八糟的基础搭建，我一路yes 就行。本身我也不懂 App 开发，此时我选择相信 GLM 4.7;</p>
<p>接下来解释 Coding 时刻，大概用了十分钟，一个由零到一的 APP 雏形诞生了，这是使用的 token 量。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ae601fd4034e558464592d717397aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=DTJKCh%2BI1FMSGUufMmopkk1KSC8%3D" alt="图片" loading="lazy"/></p>
<p>电脑调试启动那一刻我惊呆了。真的出来了，看看界面，美学也还很不错。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a4d558d53a64b508f1e506a488b1362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=gQ5MgrHZYmMtt8DWZiSEttp2LeA%3D" alt="图片" loading="lazy"/></p>
<p>聊天框，正常的 ai 聊天，居然还支持了相机图片上传牛掰，UI 界面简约，正和我心意，还细心的加了了彩色边框，真的是完全可用啊。</p>
<p>还贴心的加上了对话记录：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aaf29a707ff421991a5cdc990185ce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=AdhLpEQb16UpEQR427SROBwPHbM%3D" alt="图片" loading="lazy"/></p>
<p>666 想的真周到</p>
<p>接着试试生成视频的功能怎么样？</p>
<p>最近喜欢吃草莓蛋糕，那就生成一个“做草莓蛋糕的视频”：</p>
<pre><code class="hljs">prompt： 生成一个小姐姐做草莓蛋糕的视频 
</code></pre>
<p>可以看到漫导 APP 先会创建剧本：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e32ad4836e1414c80fb0f263c3430e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=26VV9SiBYE9tp%2Fk4Yf1x0V82h8k%3D" alt="图片" loading="lazy"/></p>
<p>很快就生成了剧本：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cfaebc0fbf14a9db6f68aa8fa7aa82b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=LIZIPuzAqYyaKycu42PJrmjPw%2BA%3D" alt="图片" loading="lazy"/></p>
<p>接着是生成角色图，能生成人物三视图，我们都知道漫剧最难的就是人物一致性，确定主角的三视图，贯穿整个剧本主角。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c818f7a737a6495783cfd9e4d4ed60ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=4YqwHrvPb%2FRrYqZhlHxWviih5g4%3D" alt="图片" loading="lazy"/></p>
<p>太细节了还有情感钩子：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ac8d0308c4e4166829733a0f9b81a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=wL0EAJoqUtcltJ4miWWm5AeUsAM%3D" alt="图片" loading="lazy"/></p>
<p>要是用这个写个霸道总裁爱上我的故事也不错吧，哈哈哈哈。</p>
<p>接下来看看具体的场景：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5578a5eb37a24bc68f7924f74263ee9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=%2B3QVds8hh%2FyaqFjpLk1uAPAr4%2Bw%3D" alt="图片" loading="lazy"/></p>
<p>展开一个场景看看它是怎么规划的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec154f81fd6d4431b2da4a035d9adf93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=G3WanEZUR3S07tO3d5o4nBNTDR0%3D" alt="图片" loading="lazy"/></p>
<p>好的现在确认剧本，回到页面看到直接有任务在执行：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7b795958a149d984a1f710cbab3501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=wKTjKXq4a%2FfHYx%2Fcez74YVMj17M%3D" alt="图片" loading="lazy"/></p>
<p>看了流程后不得不感叹，真🐔儿把老己当成导演了；</p>
<p>先生成不同的场景，每个根据有前面主角的三视图和提示词生成的分镜图，再由分镜图和视频提示词生成分镜视频。有点导演味道了。</p>
<p>看看具体的场景分镜是怎么规划的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e6914aafa794d31a99c2246f762b0fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=fHuilAL7H3mVhsKwNtTGORjTNAQ%3D" alt="图片" loading="lazy"/></p>
<p>确实可以，视频提示词部分，规划了主角的言语和镜头方式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2de08af9d554e8899f0d9830fb084f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768233848&amp;x-signature=nL8FwjfBS5RjocnMyhwEe6g5g5A%3D" alt="图片" loading="lazy"/></p>
<p>不用担心失败，还会重试，这个大概就是有些视频 api 会触发公共安全，会失败任务，此时 GLM 4.7 会根据提示弱化提示词，我看了一下日志大概是这样.</p>
<pre><code class="hljs language-css" lang="css">suspension&gt; <span class="hljs-selector-attr">[ ]</span> <span class="hljs-selector-tag">I</span>/flutter ( <span class="hljs-number">3052</span>): ❌ [<span class="hljs-number">22</span>:<span class="hljs-number">55</span>:<span class="hljs-number">29</span>] [场景重试] 场景 <span class="hljs-number">1</span> 重试失败: Exception: 视频生成失败: {<span class="hljs-selector-tag">code</span>: generation_failed, message: check status failed:
{"name":<span class="hljs-string">"c39408d4117fcedb3a89153dc5006a7904"</span>,<span class="hljs-string">"error"</span>:{"<span class="hljs-selector-tag">code</span>":<span class="hljs-number">3</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"PUBLIC_ERROR_AUDIO_FILTERED"</span>}}}
</code></pre>
<p>场景1重试失败的根本原因是 <code>PUBLIC_ERROR_AUDIO_FILTERED</code>（音频被过滤）——平台审核判定你场景1提示词中的<strong>语音/音效描述违规</strong>，直接拦截了音频生成，进而导致整个视频生成流程终止（和画面描述无关，只卡音频环节）。</p>
<p>最终确定场景1最终合规版提示词（彻底规避音频过滤）：</p>
<pre><code class="hljs language-css" lang="css">Anime style, manga art, <span class="hljs-number">2</span>D <span class="hljs-attribute">animation</span>, cel shaded.
Soft wide shot with gentle slow pan <span class="hljs-selector-tag">to</span> the <span class="hljs-attribute">right</span>, gradually revealing <span class="hljs-selector-tag">a</span> tidy kitchen counter and fresh ingredients. <span class="hljs-selector-tag">A</span> <span class="hljs-number">17</span>-year-old Japanese girl (anime style, Asian features) arranges eggs and flour softly on the counter, turns <span class="hljs-selector-tag">to</span> the camera with <span class="hljs-selector-tag">a</span> gentle warm smile, and says "今天要做个草莓蛋糕" in <span class="hljs-selector-tag">a</span> soft warm tone (female voice, quiet whisper, low volume, calm mild speech).
Warm soft gentle lighting, peaceful and cozy kitchen atmosphere, no loud sounds, only soft gentle voice.
</code></pre>
<p>然后基本上出错后，再让 Claude Code 配合 GLM 4.7，不断调整，最终出来了，我们想要的效果。</p>
<h2 data-id="heading-2">写在最后</h2>
<p>如果非要较真，漫导 APP 和实际上的 AI 漫剧还有点距离，但可以想象通过多次的迭代和优化，一定可以更好。</p>
<p>要知道，这个 APP 实际耗时还没到 5 天啊，这放在以前，就这 MVP 版本，没个把星期开发不出来。</p>
<p>同时也验证了一个观点，现在 AI Coding，真的并非 Claude 不可，不给用还死贵，但凡有像 GLM 4.7 这样高性价比的模型取代，谁还用 Claude 啊？</p>
<p>这个 APP，我已经开源到 GitHub 了，你可以加上自己的 API，按照教程来玩一玩。</p>
<p>当然了如果你是开发者或者 AI Coder，欢迎来 PR，把他做好。</p>
<p>好啦，谢谢你看我的文章，如果喜欢可以点赞转发给需要的朋友，我们下一期再见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go CLI 入口设计：参数解析、错误处理与项目分层实战]]></title>    <link>https://juejin.cn/post/7591702898080563215</link>    <guid>https://juejin.cn/post/7591702898080563215</guid>    <pubDate>2026-01-05T15:03:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591702898080563215" data-draft-id="7591704324906942498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go CLI 入口设计：参数解析、错误处理与项目分层实战"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-05T15:03:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java小成"/> <meta itemprop="url" content="https://juejin.cn/user/3614849960783160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go CLI 入口设计：参数解析、错误处理与项目分层实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3614849960783160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java小成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:03:39.000Z" title="Mon Jan 05 2026 15:03:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Go语言学习系列文章</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhZIvsqGTTLdp7vn4bXrueA" target="_blank" title="https://mp.weixin.qq.com/s/hZIvsqGTTLdp7vn4bXrueA" ref="nofollow noopener noreferrer">01 Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势</a></li>
</ul>
<h2 data-id="heading-1">1. 场景复现：那个让我头疼的时刻</h2>
<p>周一早上，我接手了一个线上的配置同步小工具。它的职责很简单：每天凌晨跑一次，从配置中心拉数据，然后推送到各个节点。</p>
<p>工具跑了大半年都没出过问题，直到那天——凌晨 3 点告警响了，日志里只有一行：</p>
<pre><code class="hljs">程序启动失败
</code></pre>
<p>我盯着这行字看了五分钟，脑子里全是问号：<strong>哪里失败了？参数没传？配置文件没找到？网络不通？</strong></p>
<p>排查了一个多小时，最后发现是运维同学改了启动脚本，漏掉了一个必填参数。但程序压根没告诉我是哪个参数出了问题。</p>
<p>那一刻我意识到：<strong>一个靠谱的程序，必须从入口就"把话说清楚"</strong>。参数怎么解析、默认值是什么、出错时怎么反馈——这些看似基础的东西，决定了凌晨 3 点你能不能多睡一会儿。</p>
<p>今天这个项目，就是我总结出来的 <strong>Go CLI 入口模板</strong>。它很小，但五脏俱全。</p>
<h2 data-id="heading-2">2. 架构蓝图：上帝视角看设计</h2>
<p>先来看整体结构。这个项目只有三个核心文件，但它展示了 Go 项目的<strong>标准分层方式</strong>：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b574048d49be41b4b2f82bc515d3a547~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeWwj-aIkA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768230219&amp;x-signature=HrQex2fny45g5%2FxmnZ2R6gWS18Q%3D" alt="image-20260105225642842" loading="lazy"/>
<p><strong>核心设计思想</strong>：</p>
<ul>
<li><strong>main.go 只做调度</strong>：它不包含任何业务逻辑，只负责"接参数 → 调函数 → 输出结果"</li>
<li><strong>internal 目录放内部包</strong>：Go 有个约定，<code>internal</code> 目录下的代码只能被同一个模块引用，外部项目无法 import。这是一种"访问控制"</li>
<li><strong>一个目录一个包</strong>：<code>cliinfo</code> 负责参数解析，<code>reasons</code> 负责业务逻辑，职责清晰</li>
</ul>
<p>这种分层的好处是什么？<strong>每个包都可以独立写单元测试</strong>。你不需要启动整个程序，就能验证参数解析逻辑对不对。</p>
<h2 data-id="heading-3">3. 源码拆解：手把手带你读核心</h2>
<h3 data-id="heading-4">3.1 入口文件：main.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"runtime"</span>
	<span class="hljs-string">"strings"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"learn-go/series/02/internal/cliinfo"</span>
	<span class="hljs-string">"learn-go/series/02/internal/reasons"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	cfg, err := cliinfo.Parse(os.Args[<span class="hljs-number">1</span>:])
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Fprintln(os.Stderr, <span class="hljs-string">"参数错误:"</span>, err)
		os.Exit(<span class="hljs-number">1</span>)
	}

	lines := []<span class="hljs-type">string</span>{
		fmt.Sprintf(<span class="hljs-string">"你好，%s！"</span>, cfg.Name),
		fmt.Sprintf(<span class="hljs-string">"你正在体验：%s"</span>, strings.ToUpper(cfg.Lang)),
		fmt.Sprintf(<span class="hljs-string">"今天的结论：%s"</span>, reasons.Reason(cfg.Lang)),
		fmt.Sprintf(<span class="hljs-string">"运行环境：%s/%s"</span>, runtime.GOOS, runtime.GOARCH),
		fmt.Sprintf(<span class="hljs-string">"Go 版本：%s"</span>, runtime.Version()),
		fmt.Sprintf(<span class="hljs-string">"生成时间：%s"</span>, time.Now().Format(time.RFC3339)),
	}

	fmt.Println(strings.Join(lines, <span class="hljs-string">"\n"</span>))
}
</code></pre>
<p>这段代码只有 20 多行，但信息量很大。让我逐个拆解：</p>
<p><strong><code>os.Args[1:]</code> 是什么？</strong></p>
<p><code>os.Args</code> 是一个字符串切片，包含了命令行的所有参数。<code>Args[0]</code> 是程序本身的路径，<code>Args[1:]</code> 才是用户传入的参数。</p>
<p><strong><code>cfg, err := cliinfo.Parse(...)</code> 的多返回值</strong></p>
<p>这是 Go 最经典的模式。函数同时返回"结果"和"错误"，调用方必须处理错误。如果你写过 Java，可以把它理解为"不用 try-catch，但必须检查返回值"。</p>
<blockquote>
<p><strong>Go 知识点</strong>：Go 没有异常机制，错误通过返回值传递。<code>if err != nil</code> 是你会写一万遍的代码。</p>
</blockquote>
<p><strong><code>fmt.Fprintln(os.Stderr, ...)</code> 为什么用 Stderr？</strong></p>
<p>正常输出走 <code>stdout</code>，错误信息走 <code>stderr</code>。这是 Unix 的惯例。好处是：用户可以用管道把正常输出重定向到文件，而错误信息仍然显示在终端。</p>
<p><strong><code>os.Exit(1)</code> 的退出码</strong></p>
<p>程序正常结束返回 0，出错返回非零值。这让调用方（比如 shell 脚本）可以判断程序是否成功。</p>
<h3 data-id="heading-5">3.2 参数解析：cliinfo 包</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> cliinfo

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"flag"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"strings"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
	Name <span class="hljs-type">string</span>
	Lang <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Parse</span><span class="hljs-params">(args []<span class="hljs-type">string</span>)</span></span> (Config, <span class="hljs-type">error</span>) {
	fs := flag.NewFlagSet(<span class="hljs-string">"hello"</span>, flag.ContinueOnError)
	name := fs.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
	lang := fs.String(<span class="hljs-string">"lang"</span>, <span class="hljs-string">"go"</span>, <span class="hljs-string">"关注的语言"</span>)
	fs.SetOutput(<span class="hljs-built_in">new</span>(strings.Builder))

	<span class="hljs-keyword">if</span> err := fs.Parse(args); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> Config{}, err
	}

	cfg := Config{
		Name: strings.TrimSpace(*name),
		Lang: strings.ToLower(strings.TrimSpace(*lang)),
	}
	<span class="hljs-keyword">if</span> cfg.Name == <span class="hljs-string">""</span> {
		<span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"name 不能为空"</span>)
	}
	<span class="hljs-keyword">if</span> cfg.Lang == <span class="hljs-string">""</span> {
		cfg.Lang = <span class="hljs-string">"go"</span>
	}
	<span class="hljs-keyword">return</span> cfg, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>为什么用 <code>flag.NewFlagSet</code> 而不是全局的 <code>flag.Parse()</code>？</strong></p>
<p>全局的 <code>flag</code> 包会直接操作 <code>os.Args</code>，而且解析失败时默认会调用 <code>os.Exit()</code>。这让代码<strong>无法测试</strong>——你没法在测试里模拟不同的参数组合。</p>
<p>用 <code>NewFlagSet</code> 创建独立的解析器，传入任意的 <code>[]string</code>，就可以在单元测试里随便折腾了。</p>
<p><strong><code>fs.String()</code> 返回的是指针</strong></p>
<pre><code class="hljs language-go" lang="go">name := fs.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
<span class="hljs-comment">// name 的类型是 *string，不是 string</span>
</code></pre>
<p>为什么返回指针？因为 <code>Parse()</code> 调用之后，flag 包会把解析到的值写入这个指针指向的内存。如果返回值类型，就没法"回填"了。</p>
<blockquote>
<p><strong>Go 知识点</strong>：<code>*name</code> 是解引用操作，取出指针指向的值。这和 C 语言的指针概念一样。</p>
</blockquote>
<p><strong><code>flag.ContinueOnError</code> 的作用</strong></p>
<p>默认情况下，flag 解析失败会直接退出程序。设置 <code>ContinueOnError</code> 后，它会返回 error，让我们自己决定怎么处理。</p>
<p><strong><code>return Config{}, err</code> 的零值</strong></p>
<p>当出错时，我们返回一个"空的" Config。<code>Config{}</code> 是结构体的零值，所有字段都是默认值（string 的零值是空字符串）。</p>
<h3 data-id="heading-6">3.3 业务逻辑：reasons 包</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span>

<span class="hljs-keyword">var</span> reasonByLang = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
	<span class="hljs-string">"go"</span>:     <span class="hljs-string">"编译快、部署简单、并发模型清晰，适合做基础设施和服务端。"</span>,
	<span class="hljs-string">"python"</span>: <span class="hljs-string">"生态丰富、验证快，适合数据处理和脚本。"</span>,
	<span class="hljs-string">"java"</span>:   <span class="hljs-string">"工程成熟、生态庞大，适合大型企业级系统。"</span>,
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Reason</span><span class="hljs-params">(lang <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
	key := strings.ToLower(strings.TrimSpace(lang))
	<span class="hljs-keyword">if</span> key == <span class="hljs-string">""</span> {
		key = <span class="hljs-string">"go"</span>
	}
	<span class="hljs-keyword">if</span> reason, ok := reasonByLang[key]; ok {
		<span class="hljs-keyword">return</span> reason
	}
	<span class="hljs-keyword">return</span> <span class="hljs-string">"先选一个目标场景，再决定语言。Go 适合服务端与工具链。"</span>
}
</code></pre>
<p><strong><code>map[string]string</code> 的声明</strong></p>
<p>这是 Go 的 map 类型，等价于 Java 的 <code>Map&lt;String, String&gt;</code> 或 Python 的 <code>dict</code>。</p>
<p><strong><code>reason, ok := reasonByLang[key]</code> 的双返回值</strong></p>
<p>访问 map 时，Go 允许你同时获取"值"和"是否存在"。如果 key 不存在，<code>ok</code> 为 false，<code>reason</code> 是零值。</p>
<p>这比 Java 的 <code>map.get(key) != null</code> 更优雅，因为它能区分"key 不存在"和"key 存在但值为 null"。</p>
<blockquote>
<p><strong>Go 知识点</strong>：这种 <code>value, ok := map[key]</code> 的写法叫做 "comma ok" 惯用法，在 Go 里非常常见。</p>
</blockquote>
<h3 data-id="heading-7">3.4 测试代码：表驱动测试</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReason</span><span class="hljs-params">(t *testing.T)</span></span> {
	tests := []<span class="hljs-keyword">struct</span> {
		name <span class="hljs-type">string</span>
		lang <span class="hljs-type">string</span>
		want <span class="hljs-type">string</span>
	}{
		{name: <span class="hljs-string">"default"</span>, lang: <span class="hljs-string">""</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
		{name: <span class="hljs-string">"go"</span>, lang: <span class="hljs-string">"go"</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
		{name: <span class="hljs-string">"python"</span>, lang: <span class="hljs-string">"python"</span>, want: reasonByLang[<span class="hljs-string">"python"</span>]},
	}

	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
		t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
			<span class="hljs-keyword">if</span> got := Reason(tt.lang); got != tt.want {
				t.Fatalf(<span class="hljs-string">"Reason(%q) = %q, want %q"</span>, tt.lang, got, tt.want)
			}
		})
	}
}
</code></pre>
<p>这是 Go 社区推崇的<strong>表驱动测试</strong>风格。把测试用例定义成一个切片，然后循环执行。好处是：</p>
<ul>
<li>新增用例只需要加一行，不用复制粘贴整个测试函数</li>
<li>测试逻辑集中，一眼能看出覆盖了哪些场景</li>
<li><code>t.Run()</code> 让每个用例有独立的名字，失败时能精确定位</li>
</ul>
<h2 data-id="heading-8">4. 避坑指南 &amp; 深度思考</h2>
<h3 data-id="heading-9">坑 1：忘记处理 error</h3>
<pre><code class="hljs language-go" lang="go">cfg, _ := cliinfo.Parse(os.Args[<span class="hljs-number">1</span>:])  <span class="hljs-comment">// 危险！忽略了 error</span>
</code></pre>
<p>用 <code>_</code> 忽略 error 是 Go 新手最常犯的错误。程序不会报错，但 <code>cfg</code> 可能是零值，后续逻辑会出现诡异的 bug。</p>
<p><strong>建议</strong>：在 IDE 里开启 <code>errcheck</code> 或 <code>golangci-lint</code>，它会提醒你未处理的 error。</p>
<h3 data-id="heading-10">坑 2：全局 flag 导致测试困难</h3>
<p>如果你直接用 <code>flag.String()</code> 和 <code>flag.Parse()</code>，它们操作的是全局状态。多个测试用例之间会互相干扰，而且无法模拟不同的参数组合。</p>
<p><strong>建议</strong>：始终用 <code>flag.NewFlagSet()</code> 创建独立的解析器。</p>
<h3 data-id="heading-11">坑 3：错误信息不够具体</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"参数错误"</span>)  <span class="hljs-comment">// 太模糊</span>
<span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"name 不能为空"</span>)  <span class="hljs-comment">// 好</span>
</code></pre>
<p>错误信息要能让用户<strong>不看代码就知道怎么修</strong>。</p>
<h3 data-id="heading-12">Demo 与生产的差距</h3>
<p>这个 Demo 是教学用的，生产环境还需要考虑：</p>
<ul>
<li><strong>配置文件支持</strong>：除了命令行参数，还要支持从文件、环境变量读取配置</li>
<li><strong>日志系统</strong>：用 <code>log/slog</code> 或 <code>zap</code> 替代 <code>fmt.Println</code>，支持结构化日志</li>
<li><strong>优雅退出</strong>：监听 <code>SIGTERM</code> 信号，做清理工作后再退出</li>
<li><strong>版本信息</strong>：编译时注入 git commit、构建时间等信息</li>
</ul>
<h2 data-id="heading-13">5. 快速上手 &amp; 改造建议</h2>
<h3 data-id="heading-14">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> series/02

<span class="hljs-comment"># 运行程序（使用默认参数）</span>
go run ./cmd/cli

<span class="hljs-comment"># 运行程序（自定义参数）</span>
go run ./cmd/cli -name=<span class="hljs-string">"汪小成"</span> -lang=python

<span class="hljs-comment"># 运行测试</span>
go <span class="hljs-built_in">test</span> ./...
</code></pre>
<h3 data-id="heading-15">工程化改造建议</h3>
<p><strong>1. 添加结构化日志</strong></p>
<p>把 <code>fmt.Println</code> 替换成 Go 1.21 引入的 <code>log/slog</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"log/slog"</span>

slog.Info(<span class="hljs-string">"程序启动"</span>, <span class="hljs-string">"name"</span>, cfg.Name, <span class="hljs-string">"lang"</span>, cfg.Lang)
</code></pre>
<p><strong>2. 支持环境变量</strong></p>
<p>在 <code>Parse()</code> 里增加环境变量的读取，优先级：命令行参数 &gt; 环境变量 &gt; 默认值：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> envName := os.Getenv(<span class="hljs-string">"CLI_NAME"</span>); envName != <span class="hljs-string">""</span> &amp;&amp; *name == <span class="hljs-string">"工程师"</span> {
    *name = envName
}
</code></pre>
<p><strong>3. 添加 <code>-version</code> 参数</strong></p>
<p>在编译时注入版本信息，方便排查问题：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Version = <span class="hljs-string">"dev"</span>  <span class="hljs-comment">// 编译时用 -ldflags 覆盖</span>

version := fs.Bool(<span class="hljs-string">"version"</span>, <span class="hljs-literal">false</span>, <span class="hljs-string">"显示版本信息"</span>)
<span class="hljs-keyword">if</span> *version {
    fmt.Println(<span class="hljs-string">"版本:"</span>, Version)
    os.Exit(<span class="hljs-number">0</span>)
}
</code></pre>
<h2 data-id="heading-16">6. 总结</h2>
<ul>
<li><strong>main 函数要短</strong>：只做调度，不写业务逻辑，这样才能测试</li>
<li><strong>错误必须处理</strong>：<code>if err != nil</code> 是 Go 的生存法则，别用 <code>_</code> 忽略</li>
<li><strong>用 NewFlagSet</strong>：独立的 flag 解析器让代码可测试</li>
<li><strong>internal 目录</strong>：Go 的访问控制机制，内部包不会被外部引用</li>
<li><strong>表驱动测试</strong>：用切片组织测试用例，新增场景只需加一行</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[短思考第269天，想清楚这些，短文写作，人人都可以]]></title>    <link>https://juejin.cn/post/7591497387246665764</link>    <guid>https://juejin.cn/post/7591497387246665764</guid>    <pubDate>2026-01-05T15:27:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591497387246665764" data-draft-id="7591715454134485055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="短思考第269天，想清楚这些，短文写作，人人都可以"/> <meta itemprop="keywords" content="Android,AI编程,前端"/> <meta itemprop="datePublished" content="2026-01-05T15:27:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员码歌"/> <meta itemprop="url" content="https://juejin.cn/user/764915820529831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            短思考第269天，想清楚这些，短文写作，人人都可以
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915820529831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员码歌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:27:43.000Z" title="Mon Jan 05 2026 15:27:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1、短文写作，内容不是最重要的，选题也不是最重要的，这些都是术。</p>
<p>2、持续输出成为习惯，像吃饭一样，一天不写浑身难受，变成每日三餐必备，先日更写作几个月，再考虑其他，想到啥就写啥，锻炼自己的思考和表达输出能力。</p>
<p>3、控制好每天的零碎片时间，把所见所闻的一些思考感悟经验写下来，持续输出，顺便帮助一些人。</p>
<p>4、从此刻开始、从短文开始、从50字开始、从日常开始，前期重点是写，而不是写好。</p>
<blockquote>
<p>我是”<strong>程序员码歌</strong>“，<strong>全网昵称统一</strong>，10+年大厂程序员经验，在职场，玩副业，目标副业年收入百万，探索可复利可复制的一人企业玩法，<strong>可去gzh围观</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust：用 dyn trait 需要注意 object safety 哦]]></title>    <link>https://juejin.cn/post/7591708519449214985</link>    <guid>https://juejin.cn/post/7591708519449214985</guid>    <pubDate>2026-01-05T15:37:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591708519449214985" data-draft-id="7591713442399354889" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust：用 dyn trait 需要注意 object safety 哦"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-01-05T15:37:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pomelo_刘金"/> <meta itemprop="url" content="https://juejin.cn/user/3450694359320669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust：用 dyn trait 需要注意 object safety 哦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3450694359320669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pomelo_刘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:37:59.000Z" title="Mon Jan 05 2026 15:37:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1）Rust 为什么会有 object safety</h2>
<h3 data-id="heading-1">1.1 <code>dyn Trait</code> 到底是什么</h3>
<p><code>dyn Trait</code> 是<strong>类型擦除后的动态派发</strong>：编译期不关心具体类型是谁，运行时靠 <strong>vtable（虚表）</strong> 找到对应实现。</p>
<p>一个 <code>&amp;dyn Trait</code> / <code>Box&lt;dyn Trait&gt;</code> 本质上是“胖指针”：</p>
<ul>
<li>data pointer：指向真实对象数据</li>
<li>vtable pointer：指向虚表（里面是一堆函数指针 + 一些元信息）</li>
</ul>
<p><strong>关键点</strong>：vtable 里的每个函数入口，必须是“确定的、统一的签名”。因为不管背后是 <code>Foo</code> 还是 <code>Bar</code>，对外都得用同一种方式调用。</p>
<h3 data-id="heading-2">1.2 冲突从哪里来</h3>
<p>当 trait 方法出现下面情况时，vtable 就没法放一个“统一入口”：</p>
<h4 data-id="heading-3">情况 A：方法是泛型的（需要单态化）</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">T</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">foo</span>&lt;U&gt;(&amp;<span class="hljs-keyword">self</span>, u: U);
}
</code></pre>
<p>泛型方法需要为每个 <code>U</code> 生成一份机器码（单态化）。<br/>
但 vtable 只能放一个固定的函数指针：<code>foo</code> 到底要指向哪个 <code>U</code> 的版本？放不下。</p>
<h4 data-id="heading-4">情况 B：方法需要知道 <code>Self</code> 的具体大小/布局</h4>
<p>比如：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">T</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">clone</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>;  <span class="hljs-comment">// 返回 Self</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">take</span>(<span class="hljs-keyword">self</span>);            <span class="hljs-comment">// 按值拿走 self</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">merge</span>(&amp;<span class="hljs-keyword">self</span>, other: <span class="hljs-keyword">Self</span>); <span class="hljs-comment">// 参数是 Self</span>
}
</code></pre>
<p>对 <code>dyn T</code> 来说，<code>Self</code> 是“不知道是谁”，大小未知。<br/>
返回 <code>Self</code>/按值传 <code>Self</code> 都需要知道具体大小和如何 move/构造，所以做不到。</p>
<p><strong>object safety 就是 Rust 把这些“vtable 做不到的签名”禁止掉。</strong></p>
<blockquote>
<p>一句话总结原因：<br/>
<strong>dyn = 运行时多态（vtable）；vtable 需要固定签名；泛型/裸 Self 会让签名无法固定。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">2) 如何快速判断一个 trait 是否 object-safe（速查）</h2>
<p>只看“能在 <code>dyn Trait</code> 上调用的方法”，满足就行；不满足的可以 <code>where Self: Sized</code> 隔离。</p>
<h3 data-id="heading-6">2.1 会导致“不 object-safe”的高频点（你先记这 4 个）</h3>
<ol>
<li><strong>泛型方法</strong>：<code>fn f&lt;T&gt;(&amp;self, ...)</code></li>
<li><strong>返回 <code>Self</code></strong>：<code>fn f(&amp;self) -&gt; Self</code></li>
<li><strong>参数里出现 <code>Self</code>（非引用）</strong> ：<code>fn f(&amp;self, x: Self)</code></li>
<li><strong>按值 receiver</strong>：<code>fn f(self)</code>（除非用 <code>self: Box&lt;Self&gt;</code> 这种指针 receiver）</li>
</ol>
<blockquote>
<p>你先掌握这四条，已经能覆盖绝大多数实际报错。</p>
</blockquote>
<h3 data-id="heading-7">2.2 <code>where Self: Sized</code> 是“隔离开关”</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">T</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">call</span>(&amp;<span class="hljs-keyword">self</span>); <span class="hljs-comment">// ✅ 进 vtable，可 dyn 调用</span>

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">where</span>
        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>; <span class="hljs-comment">// ✅ 不进 vtable，只能静态调用</span>
}
</code></pre>
<p>含义：trait 还能 <code>dyn</code>，但 <code>new()</code> 不能对 <code>dyn T</code> 调。</p>
<hr/>
<h2 data-id="heading-8">3) 不 object-safe 的 trait：怎么改 API（工程套路 3 选 1）</h2>
<h3 data-id="heading-9">套路 1：<code>where Self: Sized</code> 隔离（最常见）</h3>
<p>适用于：你确实想保留 <code>fn new()-&gt;Self</code>、<code>fn clone()-&gt;Self</code> 这种“只对具体类型有意义”的能力。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">handle</span>(&amp;<span class="hljs-keyword">self</span>, req: Request) <span class="hljs-punctuation">-&gt;</span> Response;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">where</span>
        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;
}
</code></pre>
<p>你在用 trait object 时就只用 <code>handle</code>；构造还是用具体类型 <code>MyService::new()</code>。</p>
<hr/>
<h3 data-id="heading-10">套路 2：把 <code>Self</code> 改成“对象安全的返回类型”（常见是 <code>Box&lt;dyn Trait&gt;</code>）</h3>
<p>适用于：你需要在运行时多态的语境下“返回一个同类对象”。</p>
<p>把 <code>-&gt; Self</code> 改成 <code>-&gt; Box&lt;dyn Trait&gt;</code>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">clone_dyn</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Shape&gt;;
}
</code></pre>
<p>这就是为什么 <strong><code>dyn Clone</code> 不行</strong>，但“clone 成 <code>Box&lt;dyn Trait&gt;</code>”可以。</p>
<hr/>
<h3 data-id="heading-11">套路 3：拆 trait（一个给 dyn，一个给静态泛型）</h3>
<p>适用于：你既想要 dyn（插件/回调），又想要泛型/返回 Self 的“高级能力”。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">trait</span> <span class="hljs-title class_">Plugin</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">run</span>(&amp;<span class="hljs-keyword">self</span>);
}

<span class="hljs-comment">// 静态扩展能力（不用于 dyn）</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">PluginExt</span>: Plugin {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">map</span>&lt;T&gt;(&amp;<span class="hljs-keyword">self</span>, x: T) <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;
}
</code></pre>
<p><code>Plugin</code> 保证 object-safe，<code>PluginExt</code> 给具体类型用。</p>
<hr/>
<h2 data-id="heading-12">4) 影响范围：除了“书上 trait object”你会在哪遇到？</h2>
<p>只要你在做<strong>类型擦除边界</strong>，就会遇到 object safety：</p>
<ol>
<li><strong>插件系统 / 策略模式</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-type">Vec</span>&lt;<span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Plugin&gt;&gt;
</code></pre>
<p>插件接口必须 object-safe。</p>
<ol start="2">
<li><strong>中间件 / handler 链</strong></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Handler&gt;
</code></pre>
<p>为了把不同 handler 放在同一个容器里，用 dyn；接口要 object-safe。</p>
<ol start="3">
<li><strong>回调（闭包 trait）</strong><br/>
<code>dyn Fn(...)</code> 本质也是 trait object，闭包相关抽象会落到 object safety 的设计上。</li>
<li><strong>async trait 设计</strong><br/>
如果你想把异步行为放进 <code>dyn Trait</code>，经常会被迫在：</li>
</ol>
<ul>
<li>返回 <code>Pin&lt;Box&lt;dyn Future&lt;...&gt;&gt;&gt;</code>（走 dyn）<br/>
vs</li>
<li><code>impl Future</code>/GAT（走静态）<br/>
之间取舍。背后也是“返回类型能否在 vtable 下固定”。</li>
</ul>
<p>所以：</p>
<blockquote>
<p>object safety 是 Rust 为了让 trait 能用 <code>dyn Trait</code> 做类型擦除和 vtable 动态派发设置的限制。因为 vtable 需要固定的函数签名，所以 trait 里如果有泛型方法（需要单态化）或方法签名依赖具体 <code>Self</code>（比如返回 <code>Self</code>/按值传 <code>Self</code>/<code>self</code> by value）就不能做成 trait object。工程上通常用 <code>where Self: Sized</code> 把这类方法隔离，或把返回值改成 <code>Box&lt;dyn Trait&gt;</code>，必要时拆成 object-safe 的核心 trait + 仅供静态的扩展 trait。常见于插件、handler、中间件、回调、async trait 这些类型擦除边界.from Pomelo_刘金，转载请注明原文链接。感谢！。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust 的 `PhantomData`：零成本把“语义信息”交给编译器]]></title>    <link>https://juejin.cn/post/7591705084671344678</link>    <guid>https://juejin.cn/post/7591705084671344678</guid>    <pubDate>2026-01-05T15:31:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591705084671344678" data-draft-id="7591728734982766619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 的 `PhantomData`：零成本把“语义信息”交给编译器"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-01-05T15:31:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pomelo_刘金"/> <meta itemprop="url" content="https://juejin.cn/user/3450694359320669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 的 `PhantomData`：零成本把“语义信息”交给编译器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3450694359320669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pomelo_刘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:31:03.000Z" title="Mon Jan 05 2026 15:31:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在写底层 Rust（尤其是 <strong>unsafe / 裸指针 / FFI</strong>）时，你会遇到一种常见矛盾：</p>
<ul>
<li><strong>运行时</strong>：你手里可能只有一个 <code>*const T</code> / <code>*mut T</code> / <code>*mut c_void</code>（比如外部库返回的句柄），结构体里并没有真正存放某个引用或某个类型的值。</li>
<li><strong>编译期</strong>：你又希望编译器知道“我这个类型<strong>和某个生命周期/类型绑定</strong>”，从而帮你做借用检查、推导 <code>Send/Sync</code>、避免错误混用等。</li>
</ul>
<p><code>std::marker::PhantomData&lt;T&gt;</code> 就是为了解决这个问题而存在的工具。官方文档的核心定义是：</p>
<blockquote>
<p><code>PhantomData&lt;T&gt;</code> 是一个 <strong>零大小类型</strong>（ZST），用于标记你的类型“<strong>行为上像是拥有/包含</strong> 一个 <code>T</code>”，尽管你实际上并没有存储 <code>T</code>。这会影响编译器计算一些安全相关属性。</p>
</blockquote>
<p>也因此，它常被称为“<strong>只在编译期生效的零成本抽象</strong>”。</p>
<ul>
<li><code>size_of::&lt;PhantomData&lt;T&gt;&gt;() == 0</code></li>
<li><code>align_of::&lt;PhantomData&lt;T&gt;&gt;() == 1</code></li>
</ul>
<p>下面用两个最典型的场景来科普：</p>
<ol>
<li><strong>绑定生命周期（防悬垂）</strong></li>
<li><strong>绑定类型参数（防混用）</strong></li>
</ol>
<hr/>
<h2 data-id="heading-0">1. 绑定生命周期：裸指针不带生命周期，需要用 <code>PhantomData&lt;&amp;'a T&gt;</code> 把借用关系“说清楚”</h2>
<p>假设你想实现一个 slice/数组的迭代器或视图，内部用裸指针表示范围：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
}
</code></pre>
<p>如果这些指针来自某个外部数据（比如 <code>Vec&lt;T&gt;</code> / <code>&amp;[T]</code>），为了避免悬垂指针，你的真实意图是：</p>
<blockquote>
<p><code>Slice</code> <strong>不能活得比原始数据更久</strong></p>
</blockquote>
<p>但问题是：<code>*const T</code> <strong>不携带生命周期</strong>，编译器无法从字段中推导“它借用了谁、借用了多久”。于是你会想加生命周期参数：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
}
</code></pre>
<p>这会立刻遇到编译器抱怨：<code>'a</code> 没有被使用（unused lifetime parameter）。更重要的是：即使你强行让它通过，编译器也仍然不知道 <code>'a</code> 和哪些数据有关。</p>
<h3 data-id="heading-1">正确写法：加一个“假装持有引用”的标记字段</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomData;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
    _marker: PhantomData&lt;&amp;<span class="hljs-symbol">'a</span> T&gt;,
}
</code></pre>
<p><code>PhantomData&lt;&amp;'a T&gt;</code> 的含义可以直译为：</p>
<blockquote>
<p>“请把我当成<strong>好像</strong>内部存了一个 <code>&amp;'a T</code> 引用。”</p>
</blockquote>
<p>于是类型系统就会把 <code>Slice&lt;'a, T&gt;</code> 当成“借用了 <code>'a</code> 的 <code>T</code>”，从而强制它不能活过 <code>'a</code>。</p>
<hr/>
<h3 data-id="heading-2">坏例子：没有生命周期绑定，能编译，但可能产生悬垂指针（UB）</h3>
<p>下面这段代码演示了“裸指针 + 没有 <code>'a</code>”的危险：它能把指向局部 <code>Vec</code> 的指针带出函数。</p>
<blockquote>
<p>注意：这段代码<strong>可能触发未定义行为（UB）</strong> ，请不要在真实项目里这么写。</p>
</blockquote>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SliceIterBad</span>&lt;T&gt; {
    ptr: *<span class="hljs-keyword">const</span> T,
    len: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">raw_from_vec_bad</span>&lt;T&gt;(v: &amp;<span class="hljs-type">Vec</span>&lt;T&gt;) <span class="hljs-punctuation">-&gt;</span> SliceIterBad&lt;T&gt; {
    SliceIterBad {
        ptr: v.<span class="hljs-title function_ invoke__">as_ptr</span>(),
        len: v.<span class="hljs-title function_ invoke__">len</span>(),
    }
}

<span class="hljs-comment">// ❌ 能编译，但返回的 ptr 指向已释放的内存</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">bad</span>() <span class="hljs-punctuation">-&gt;</span> SliceIterBad&lt;<span class="hljs-type">i32</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-title function_ invoke__">raw_from_vec_bad</span>(&amp;v) <span class="hljs-comment">// v 在这里被 drop，但指针被带出去了</span>
}
</code></pre>
<p>这就是典型的“类型系统没被告知借用关系 → 编译器无法阻止悬垂”。</p>
<hr/>
<h3 data-id="heading-3">好例子：用 <code>PhantomData&lt;&amp;'a T&gt;</code> 绑定借用，错误在编译期暴露</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomData;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SliceIter</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    ptr: *<span class="hljs-keyword">const</span> T,
    len: <span class="hljs-type">usize</span>,
    _marker: PhantomData&lt;&amp;<span class="hljs-symbol">'a</span> T&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">raw_from_vec</span>&lt;<span class="hljs-symbol">'a</span>, T&gt;(v: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-type">Vec</span>&lt;T&gt;) <span class="hljs-punctuation">-&gt;</span> SliceIter&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    SliceIter {
        ptr: v.<span class="hljs-title function_ invoke__">as_ptr</span>(),
        len: v.<span class="hljs-title function_ invoke__">len</span>(),
        _marker: PhantomData,
    }
}

<span class="hljs-comment">// ❌ 这次会直接编译失败：你试图返回一个借用了局部变量 v 的值</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">good_but_wont_compile</span>() <span class="hljs-punctuation">-&gt;</span> SliceIter&lt;<span class="hljs-symbol">'static</span>, <span class="hljs-type">i32</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-title function_ invoke__">raw_from_vec</span>(&amp;v)
}
</code></pre>
<p>你会得到类似这样的错误（不同版本文案略有差异）：</p>
<pre><code class="hljs language-sql" lang="sql">error[E0515]: cannot <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">referencing</span> <span class="hljs-keyword">local</span> variable `v`
  <span class="hljs-keyword">returns</span> a <span class="hljs-keyword">value</span> <span class="hljs-keyword">referencing</span> data owned <span class="hljs-keyword">by</span> the <span class="hljs-keyword">current</span> <span class="hljs-keyword">function</span>
</code></pre>
<p>这就达到了目的：<strong>把潜在的悬垂指针风险提前变成编译错误</strong>。</p>
<p>正确使用方式是：让迭代器不超过数据的作用域，例如：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ok_usage</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">it</span> = <span class="hljs-title function_ invoke__">raw_from_vec</span>(&amp;v);
    <span class="hljs-comment">// 在 v 的生命周期内使用 it</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = it.len;
}
</code></pre>
<hr/>
<h2 data-id="heading-4">2. 绑定类型参数：FFI 句柄是 <code>*mut ()</code>，用 <code>PhantomData&lt;R&gt;</code> 防止把 A 当 B 用</h2>
<p>另一类常见场景来自 FFI：外部库可能用统一的 <code>void*</code>（Rust 里常见 <code>*mut ()</code> 或 <code>*mut c_void</code>）当作“资源句柄”。运行时只有一个指针，但它背后可能对应不同资源类型。</p>
<p>如果你只写成“无类型句柄包装”，编译器分不清“这是 Foo 资源还是 Bar 资源”，于是非常容易混用。</p>
<h3 data-id="heading-5">坏例子：句柄不带类型信息，混用能编译，运行时才爆炸</h3>
<p>下面用 <code>assert!</code> 模拟“用错句柄就炸”（真实 FFI 里可能是崩溃/数据错乱/UB）：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::ffi::c_void;

<span class="hljs-keyword">mod</span> foreign_lib {
    <span class="hljs-keyword">use</span> super::c_void;

    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Raw</span> {
        tag: <span class="hljs-type">u32</span>, <span class="hljs-comment">// 1 =&gt; Foo, 2 =&gt; Bar</span>
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(tag: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> *<span class="hljs-keyword">mut</span> c_void {
        <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">into_raw</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(Raw { tag })) <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> c_void
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_foo</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw</span> = handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw;
        <span class="hljs-built_in">assert!</span>((*raw).tag == <span class="hljs-number">1</span>, <span class="hljs-string">"expected Foo handle, got tag={}"</span>, (*raw).tag);
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_bar</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw</span> = handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw;
        <span class="hljs-built_in">assert!</span>((*raw).tag == <span class="hljs-number">2</span>, <span class="hljs-string">"expected Bar handle, got tag={}"</span>, (*raw).tag);
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">free</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-title function_ invoke__">drop</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">from_raw</span>(handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw));
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    handle: *<span class="hljs-keyword">mut</span> c_void,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new_foo</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>) } }
    }
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new_bar</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">2</span>) } }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_foo</span>(&amp;<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">do_foo</span>(<span class="hljs-keyword">self</span>.handle) } }
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_bar</span>(&amp;<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">do_bar</span>(<span class="hljs-keyword">self</span>.handle) } }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">free</span>(<span class="hljs-keyword">self</span>.handle) }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">r</span> = ExternalResourceBad::<span class="hljs-title function_ invoke__">new_bar</span>();

    <span class="hljs-comment">// ❌ 逻辑错误：拿 Bar 的句柄去当 Foo 用</span>
    <span class="hljs-comment">// 编译器看不出来（类型都一样），但运行时可能 panic/崩溃</span>
    r.<span class="hljs-title function_ invoke__">do_foo</span>();
}
</code></pre>
<h3 data-id="heading-6">好例子：用 <code>PhantomData&lt;R&gt;</code> 把句柄“绑定到类型”，混用直接编译错误</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::{ffi::c_void, marker::PhantomData};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Foo</span>;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Bar</span>;

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">ResType</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span>; }
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ResType</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Foo</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span> = <span class="hljs-number">1</span>; }
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ResType</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Bar</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span> = <span class="hljs-number">2</span>; }

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExternalResource</span>&lt;R&gt; {
    handle: *<span class="hljs-keyword">mut</span> c_void,
    _<span class="hljs-keyword">type</span>: PhantomData&lt;R&gt;,
}

<span class="hljs-keyword">impl</span>&lt;R: ResType&gt; ExternalResource&lt;R&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(R::TAG) },
            _<span class="hljs-keyword">type</span>: PhantomData,
        }
    }
}

<span class="hljs-keyword">impl</span>&lt;R&gt; <span class="hljs-built_in">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ExternalResource</span>&lt;R&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">free</span>(<span class="hljs-keyword">self</span>.handle) }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">takes_foo</span>(_: ExternalResource&lt;Foo&gt;) {}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">foo</span> = ExternalResource::&lt;Foo&gt;::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bar</span> = ExternalResource::&lt;Bar&gt;::<span class="hljs-title function_ invoke__">new</span>();

    <span class="hljs-title function_ invoke__">takes_foo</span>(foo); <span class="hljs-comment">// ✅ OK</span>

    <span class="hljs-comment">// takes_foo(bar);</span>
    <span class="hljs-comment">// ❌ 编译期报错：</span>
    <span class="hljs-comment">// expected `ExternalResource&lt;Foo&gt;`, found `ExternalResource&lt;Bar&gt;`</span>
}
</code></pre>
<p>这就是文档里“未使用类型参数”的核心意义：哪怕结构体里<strong>根本没有存 <code>R</code></strong>，你仍然可以用 <code>PhantomData&lt;R&gt;</code> 让类型系统记住并区分它，从而把很多“本来只能靠人肉保证的约定”变成<strong>编译器可检查的约束</strong>。
from Pomelo_刘金，转载请注明原文链接。感谢！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[技术方案评审没人听？别人抓不住重点？你不妨这样做！]]></title>    <link>https://juejin.cn/post/7591705084671361062</link>    <guid>https://juejin.cn/post/7591705084671361062</guid>    <pubDate>2026-01-05T15:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591705084671361062" data-draft-id="7588445306086883328" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="技术方案评审没人听？别人抓不住重点？你不妨这样做！"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-01-05T15:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="姆斯李"/> <meta itemprop="url" content="https://juejin.cn/user/1355016376951341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            技术方案评审没人听？别人抓不住重点？你不妨这样做！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1355016376951341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    姆斯李
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:51:42.000Z" title="Mon Jan 05 2026 15:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 引言：上万字的技术方案，为何换来满屋的哈欠？</h2>
<h3 data-id="heading-1">1.1 现象</h3>
<p>很多技术同学在准备评审时，会陷入一种“自我感动式”的勤奋：熬夜写了几十页的 技术文档，流程图精细到每一个变量的命名，逻辑推导无懈可击。然而，到了现场，当你摊开文档开始逐行宣读时，却发现：架构师在看手机回信息，开发同学在开发需求 或者 皱着眉头看你的文档，产品经理甚至在偷偷改需求。</p>
<p>这种挫败感通常源于一个误区：文档写得好，不等于评审会阐述地好。你以为大家是来阅读的，实际上大家是来<strong>决策</strong>的。</p>
<h3 data-id="heading-2">1.2 现象剖析：异步信息传递 vs. 同步决策达成</h3>
<ul>
<li><strong>文档（异步）：</strong> 它的本质是信息的<strong>归档与索引</strong>。它需要详尽、周密，方便别人在任何时间查阅。</li>
<li><strong>评审会（同步）：</strong> 它的本质是<strong>算力的并发与共识的达成</strong>。会议室里坐着的每一个人都是一个算力单元，他们脑子里装满了过去的填坑经验、现有的代码逻辑和对未来的架构预判，每个人最多只有15分钟的专注力，你需要尽快把问题尽快讲清楚。如果你只是在念文档，那就是在用高昂的算力成本去做“低级的文件遍历”。</li>
</ul>
<p>写好文档是基本功，它保证了方案的<strong>深度</strong>；但讲好方案是领导力，它决定了方案的<strong>广度</strong>。一个好的技术方案，不仅需要逻辑的自洽，更需要高效的沟通</p>
<h3 data-id="heading-3">1.3 认知重构：评审会的三个真相</h3>
<p>在进入技巧层面之前，我们必须先打碎并重建对“评审会”的认知。</p>
<h5 data-id="heading-4">1、 评审不是为了“展示工作量”</h5>
<p>没人关心你为了这个方案加了多少班，也没人关心你查了多少资料。</p>
<ul>
<li><strong>残实：</strong> 听众只关心两件事—— <strong>“这东西有问题吗？”</strong> 、 <strong>“这东西和我有什么关系？”</strong></li>
<li><strong>策略：</strong> 收起那些琐碎的实现细节，把重点放在方案的<strong>稳健性</strong>和<strong>简洁性</strong>上。</li>
</ul>
<h5 data-id="heading-5">2、评审是为了“降低风险”</h5>
<ul>
<li><strong>心态转变：</strong> 评审会本质上是一场“大家来找茬”。不要把同事的质疑看作挑衅，要把他们看作你的免费 QA。借用集体的视角去扫描你思维中的盲点，总比方案上线后线上崩了好吧？</li>
</ul>
<h5 data-id="heading-6">3、评审是为了“达成共识”</h5>
<ul>
<li><strong>核心目标：</strong> 评审会的终点不是“会议结束”，而是“行动一致”。确保后端知道怎么写接口，前端知道怎么接数据，测试知道怎么写用例。评审结束时，如果大家对“怎么做”还有歧义，那么这场评审就是失败的。</li>
</ul>
<p><strong>先点赞后收藏，技术薪资嘎嘎涨！</strong></p>
<p><strong>先点赞后收藏，技术薪资嘎嘎涨！</strong></p>
<p><strong>先点赞后收藏，技术薪资嘎嘎涨！</strong></p>
<br/>
<hr/>
<h2 data-id="heading-7">二、如何准备一场技术评审会议？</h2>
<h3 data-id="heading-8">2.1 战术准备：如何在开会前就赢了一半？</h3>
<p>不打无准备之仗。在踏入会议室之前，以下三步决定了你的胜算：</p>
<h4 data-id="heading-9">1、识别你的观众：不同岗位的“关注点隔离”</h4>
<p>不要对所有人讲同样的话。在阐述时，你要学会精准投喂：</p>
<ul>
<li><strong>架构师/技术专家：</strong> 他们关心<strong>扩展性</strong>和<strong>一致性</strong>。关注点：在高并发下会死吗？十年后这个架构还能用吗？</li>
<li><strong>业务方/产品经理：</strong> 他们关心<strong>交付时间</strong>和<strong>业务逻辑</strong>。关注点：下周三能上线吗？漏掉那个产品场景了吗？</li>
<li><strong>运维/QA：</strong> 他们关心<strong>稳定性</strong>和<strong>可观测性</strong>。关注点：有日志吗？能监控吗？万一崩了能一键重启吗？</li>
</ul>
<h4 data-id="heading-10">2、识别要突出的重点：不同方案有不同重点</h4>
<p>技术方案千差万别，如果用同一套模版去套所有方案，效果往往会大打折扣。</p>
<p>方案类型不同、受众不同，自然会产生不同的阐述重点！</p>



































<table><thead><tr><th><strong>方案类型</strong></th><th><strong>核心关键词</strong></th><th><strong>听众最担心的问题</strong></th><th><strong>最有效的展示工具</strong></th></tr></thead><tbody><tr><td><strong>协议/标准</strong></td><td><strong>语义、解耦</strong></td><td>方案太抽象，听不懂业务价值；字段定义不清晰，导致后期理解成本高/联调灾难。</td><td>少讲实现，多讲交互契约和原则：概念图、比喻、JSON 示例</td></tr><tr><td><strong>架构/基建</strong></td><td><strong>权衡、稳定性</strong></td><td>架构没有完美的，只有最合适的：“这玩意儿稳不稳定？扩展性高吗？ROI高吗？”</td><td>架构全景图、对比表格</td></tr><tr><td><strong>业务/产品</strong></td><td><strong>流程、闭环</strong></td><td>用户体验差、漏场景、排期过长</td><td>流程图、UI 原型、时序图</td></tr><tr><td><strong>重构/优化</strong></td><td><strong>指标、价值量化</strong></td><td>1. 现在能跑，重构出Bug。2. 讲不清价值白忙活</td><td>柱状对比图、性能火焰图、重构的后果（技术债务、安全隐患）</td></tr></tbody></table>
<h4 data-id="heading-11">3、 关键决策点提前同步给关键决策人</h4>
<p><strong>提前通气 :</strong>  如果你有一个重大的技术决策or技术改动，一定要在会前私下找关键的架构师或 Leader 沟通。</p>
<p><strong>好处：</strong> 1. 提前化解冲突； 2. 根据他们的反馈修正方案，让他们在会上成为你的“盟友”而非“阻力”。</p>
<h4 data-id="heading-12">4、多画图，少写字</h4>
<p>人类永远是视觉动物，放弃文档里的长篇大论，准备好三张图：</p>
<ul>
<li><strong>架构图（系统的骨架）：</strong> 它是全局视角，告诉大家组件之间是怎么组合的。</li>
<li><strong>序列图（数据的流转）：</strong> 它是动态视角，展示一个请求从头到尾经历了什么。这也是最能发现逻辑漏洞的图。</li>
<li><strong>状态机图（业务的灵魂）：</strong> 针对复杂的订单、审批流，状态机是唯一的终极方案。</li>
</ul>
<br/>
<h3 data-id="heading-13">2.2 准备好一个结构化叙事</h3>
<p>大部分技术方案都可以按照以下步骤来阐述</p>
<h4 data-id="heading-14">1、 第一部分: "The Hook" (一个高层定义)</h4>
<p><strong>开场不要讲技术细节，用一句话定义你的方案，包含“痛点”和“价值”。</strong></p>
<p>不要直接说“我要加个字段”。要说这个功能为用户解决了什么痛点，或者支撑了什么业务指标。</p>
<ul>
<li><em>错误示范：</em> “这是一个基于 HTTP 的流式传输协议...”</li>
<li><em>最佳实践：</em> “我阐述的这一套基于 AG-UI的前后端流式协议是一套让前端能听懂 Agent 输出的协议，它解决了大模型主要为了聊天，但是无法控制现有前端业务的痛点。”</li>
</ul>
<h4 data-id="heading-15">2、 第二部分：一张核心架构图</h4>
<p><strong>不要放几十张图，只需要一张总的的逻辑架构图。</strong></p>
<ul>
<li><strong>关键点：</strong> 这张图必须包含<strong>输入、处理、输出</strong> 。</li>
<li><strong>技巧：</strong> 用颜色区分模块，用箭头表示数据流向。指着图讲 5 分钟，胜过读 20 页文档。</li>
<li><strong>案例：</strong> 假设你在设计一个实时同步系统，不要讲几十个接口，而是抽象为：
<ul>
<li><strong>通信层：</strong> 负责怎么发（SSE/WebSocket）。</li>
<li><strong>语义层：</strong> 负责发什么（消息/事件）。</li>
<li><strong>状态层：</strong> 负责上下文同步。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-16">3、 第三部分：一条关键链路</h4>
<p><strong>这是最容易被忽视的一步。选取一个最具代表性的业务场景，展示最核心的时序图或状态机，串讲全流程。</strong></p>
<ul>
<li><strong>关键点：</strong> 1、最具代表性的业务场景；2、最核心的时序图或者状态机 。</li>
<li><strong>目的：</strong> 这叫 <strong>端到端演示</strong>，它能证明你的方案是跑得通的，而不只是纸上谈兵。</li>
<li><strong>案例：</strong> “让我们来看看，当用户和Agent说‘帮我订票’时，系统内部发生了什么。”</li>
</ul>
<h4 data-id="heading-17">4、 第四部分：关键技术卡点的解决方案 和 关键场景的覆盖</h4>
<p>讲完了整体，有必要讲一下方案中最重要的要点和细节。先有面，后讲点。<strong>前面有了方案的整体认知，评审的同事大概也能识别出最重要的卡点和场景是什么</strong>，这时候应该主动讲出来。</p>
<h5 data-id="heading-18">a. 关键技术卡点</h5>
<p>主动暴露方案中“最难啃的硬骨头”或“存在权衡的点”。</p>
<ul>
<li><strong>目的：</strong> 1. 建立权威：证明你对方案有深度思考，而不是只做了表面工作。 2. 寻求共识： 难点往往意味着风险。主动提出来，是为了让大家共同背书，避免“事后背锅”。</li>
<li><strong>案例：</strong> 遇到的挑战 ——&gt; 尝试过的方案 ——&gt; 最终的选择（理由）。</li>
</ul>
<h5 data-id="heading-19">b. 关键场景覆盖</h5>
<p>证明你的方案的健壮性。</p>
<ul>
<li><strong>目的：</strong> 1. 消除质疑： 你先讲了，他们就没法挑刺了。 2. 鲁棒性证明</li>
<li><strong>案例：</strong>
<ul>
<li>高并发场景。</li>
<li>异常/边界场景。</li>
<li>新旧兼容场景。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-20">5、 总结</h4>
<p><strong>最佳实践：从痛点出发 ——&gt; 提出目标和价值 ——&gt; 展示总架构 ——&gt; 演示关键链路 ——&gt; 关键技术卡点的解决方案 和 关键场景的覆盖</strong></p>
<hr/>
<br/>
<h2 data-id="heading-21">三、在技术评审中的阐述技巧</h2>
<h3 data-id="heading-22">3.1 结论先行</h3>
<p>很多读过研究生的同学会有一个习惯：先讲清楚背景、技术名词释义等，确保所有定义等是清楚的，才开始讲怎么做。这在学术圈、技术文档写作上可行，但是技术方案评审这样讲可不行！</p>
<p>这会导致听众在还没听到重点前就耗尽了注意力。</p>
<p>如果没有特殊情况的话，请遵循金字塔原则，在会议上开门见山：“今天我要分享的方案，核心只做一件事：xxxxxxx ”
听众的大脑里立刻建立了一个相关知识的核心索引。</p>
<p>原因如下</p>
<p><strong>1. 同事都很忙</strong></p>
<p>同事们在开场的三分钟内会判断这件事是否重要。如果前三分钟没听到重点，他们就会失去耐心，然后去干自己的事情。</p>
<p><strong>2. 同事了解基础背景</strong></p>
<p>一个科技公司的开发或者产品大部分都懂点<strong>技术+业务</strong>，不用太多讲背景知识。大部分时候可以当对方已经了解背景，不需要你做科普，只需要知道结果。</p>
<p><strong>职场默认设置：</strong> 除非有特殊理由，否则默认<strong>结论先行</strong>。</p>
<p>但是一旦发现对方一脸茫然听不懂（认知没对齐），立刻切换为<strong>背景先行</strong>。</p>
<h3 data-id="heading-23">3.2 设置“路标”</h3>
<p>评审会中，听众最容易产生的念头是：“他现在讲到哪儿了？”</p>
<ul>
<li>
<p><strong>技巧：</strong> 每一段讲完，都要有一个明显的“切换动作”。</p>
</li>
<li>
<p><strong>话术：</strong> “关于业务背景我们就说到这里（<strong>路标关闭</strong>）。接下来，请大家把注意力集中在屏幕中心这张架构图上，这是我们今天的核心设计（<strong>新路标开启</strong>）。”</p>
<ul>
<li/>
</ul>
</li>
</ul>
<h3 data-id="heading-24">3.3 敢于跳读</h3>
<p>之所以会“念文档”，是因为你潜意识里觉得文档里的每个字都很重要。<strong>事实上，评审现场 80% 的价值产生于 20% 的决策点上。</strong></p>
<ul>
<li>
<p><strong>略过：</strong> 常规的 CRUD 逻辑、符合团队规范的错误处理、标准 API 封装。</p>
</li>
<li>
<p><strong>聚焦：</strong> 复杂的算法推演、不同模块间的耦合点、有争议的技术选型。</p>
</li>
<li>
<p><strong>话术：</strong> “这一页的代码实现比较细，如果不清楚的同学可以看文档第 12 页。如果没有大问题，我将<strong>跳过</strong>这一段，直接进入大家最关心的‘灰度发布策略’。”</p>
</li>
</ul>
<h3 data-id="heading-25">3.4 主动引导讨论</h3>
<p>别等到最后才问“大家有什么问题吗？”。那样往往会换来一片死寂，或者是一个让你措手不及的冷门问题。</p>
<ul>
<li><strong>技巧：</strong> 在你感到不确定或需要支持的地方，主动抛出问题。</li>
<li><strong>话术：</strong> “在这个节点上，我目前设计的是 A 方案，但我担心 xxxxx。老王（架构师），以你的经验，这里用 B 方案会不会更稳妥？”</li>
<li><strong>效果：</strong> 这不仅展示了你的谦逊，更重要的是，你<strong>把控了提问的方向</strong>，避免了会议被无关痛痒的细节带偏。</li>
</ul>
<h3 data-id="heading-26">3.5 看人下菜</h3>
<p>阐述方案的核心不在于“罗列技术的复杂性”，而在于“管理听众的认知负荷”。为了让非技术人员（产品、老板）听懂，必须准备一些精准的比喻。哪怕听众忘了你的技术细节，他也会记得那个比喻，从而记住你的方案逻辑。</p>
<ul>
<li><strong>对内（开发团队）：</strong> 多讲 <strong>链路</strong>、<strong>架构</strong> 和 <strong>约束/边界</strong> 。</li>
<li><strong>对外（老板/客户）：</strong> 多讲 <strong>痛点</strong>、<strong>比喻</strong> 和 <strong>价值</strong> 。</li>
</ul>
<h3 data-id="heading-27">3.6 拥抱挑战和质疑</h3>
<p>很多工程师在评审会冒汗，是因为把技术挑战看作了人身攻击。请记住：<strong>挑战越多，方案越完善。被质疑总比交付延期或者<code>Hotfix</code>强</strong></p>
<ul>
<li>
<p><strong>记录而非争论：</strong> 遇到发散性或过于细节的争论，告知会列到会议纪要和会议待办里面，如果讨论离核心论点太远了或者某些“杠精”开始表演了，需要及时叫停发散讨论。</p>
</li>
<li>
<p><strong>承认不足：</strong> 遇到真没想到的漏洞，大方承认： “这个边界情况我确实漏掉了，非常感谢提醒。我会后调研一下方案，明早把补充设计发到群里。”</p>
</li>
<li>
<p><strong>保持情绪稳定：</strong> 你的专业度不仅体现在代码里，更体现在你面对压力时的优雅。</p>
</li>
</ul>
<h3 data-id="heading-28">3.7 多练习，多排练！</h3>
<p>看过《乔布斯传》的同学应该知道：乔布斯看似随意的演讲，背后是长达数周、精确到秒的闭门排练。</p>
<p>建议在评审会前 10 分钟，关上电脑，对着墙壁快速讲一遍你的核心逻辑。如果你发现自己卡壳了，那说明你的逻辑还没理顺，而不是文档没写好。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从代码到像素：浏览器渲染原理与 React Fiber 架构的深度协作]]></title>    <link>https://juejin.cn/post/7591515844867571746</link>    <guid>https://juejin.cn/post/7591515844867571746</guid>    <pubDate>2026-01-05T14:38:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591515844867571746" data-draft-id="7576105458807783424" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从代码到像素：浏览器渲染原理与 React Fiber 架构的深度协作"/> <meta itemprop="keywords" content="前端,React.js,浏览器"/> <meta itemprop="datePublished" content="2026-01-05T14:38:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="明远湖之鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2370998127573751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从代码到像素：浏览器渲染原理与 React Fiber 架构的深度协作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2370998127573751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    明远湖之鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T14:38:43.000Z" title="Mon Jan 05 2026 14:38:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">1、浏览器渲染原理</h2>
<h3 data-id="heading-1">1.1 浏览器的进程模型</h3>
<h4 data-id="heading-2">1.1.1 进程和线程的概念</h4>
<p><strong>进程：</strong></p>
<p>程序运行需要有它自己专属的内存空间，可以把这块内存空间简单地理解为进程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b51f647a6f0743c8bd7f61ed9cadcd7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=ZcnLUojRzrjbQK%2B4dhGLYZ%2FEMuk%3D" alt="image.png" loading="lazy"/></p>
<p>每个应用至少有一个进程，进程之间相互独立，即使要通信，也需要双方同意。</p>
<hr/>
<p><strong>线程：</strong></p>
<p>有了进程后，就可以运行程序的代码了，可以简单地理解运行代码的【人】称之为【线程】。</p>
<p>一个进程至少有一个线程，所以在进程开启后会自动创建一个线程来运行代码，该线程称之为主线程。</p>
<p>如果程序需要同时执行多块代码，主线程就会启动更多的线程来执行代码，所以一个进程中可以包含多个线程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ece1f23dab1f4a4f8e19d7e0d895a9e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=7puG0Q4isUEEPMO7qfbSapHbpiU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.1.2 浏览器有哪些进程和线程？</h4>
<p>浏览器是一个多进程多线程的应用程序。</p>
<p>浏览器内部工作极其复杂，为了避免相互影响导致连环崩溃的几率，当启动浏览器后，它会自动启动多个进程。</p>
<p>可以在浏览器右上角设置及其他（Alt+F）-更多工具-浏览器任务管理器查看当前浏览器的进程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdb643b4ee024ebcb21693c624194492~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=xa97jz6iiRXQI6n2AuTac1kOFYA%3D" alt="" loading="lazy"/></p>
<p>其中，最主要的进程有:</p>
<ol>
<li>浏览器进程：主要负责界面显示（上面标签页的展示，如前进后退按钮、地址栏、书签收藏等）、用户交互、子进程管理（其它的进程如网络进程渲染进程是由浏览器进程产生的）等。浏览器进程内部会启动多个线程处理不同的任务。</li>
<li>网络进程：负责加载网络资源。网络进程内部会启动多个线程来处理不同的网络任务。</li>
<li>渲染进程(本节课重点讲解的进程)：渲染进程启动后，会开启一个渲染主线程，主线程负责执行HTML、CSS、JS 代码。默认情况下，浏览器会为每个标签页开启一个新的渲染进程，以保证不同的标签页之间不相互影响。</li>
</ol>
<h3 data-id="heading-4">1.2 渲染主线程是如何工作的？</h3>
<p>渲染主线程是浏览器中最繁忙的线程，需要它处理的任务包括但不限于:
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2b045d57bb840ff94a05adf6f6a1962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=C5sZUu5ZJ8KCegSukzZmMKOaRzE%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>思考题：为什么渲染进程不使用多个线程来处理这些事情？</p>
<p>1、DOM 操作的竞态条件问题</p>
<p>2、渲染流程的依赖关系：HTML解析 → CSS解析 → 样式计算 → 布局 → 绘制，后面的步骤依赖前面步骤的结果，无法真正并行。</p>
<p>3、同步成本可能更高：需要大量的锁机制+线程间通信开销+可能比单线程更慢</p>
<p><strong>浏览器实际上采用了其他策略：
1、异步处理：通过事件循环和任务队列；
2、Web Workers；
3、GPU 加速；
4、其他辅助线程：网络请求、文件读写等在其他线程处理。</strong></p>
</blockquote>
<p>要处理这么多的任务，主线程遇到了一个前所未有的难题：如何调度任务？</p>
<p>比如：</p>
<ul>
<li>我正在执行一个JS 函数，执行到一半的时候用户点击了按钮，我该立即去执行点击事件的处理函数吗?</li>
<li>我正在执行一个JS 函数，执行到一半的时候某个计时器到达了时间，我该立即去执行它的回调吗?</li>
<li>浏览器进程通知我“用户点击了按钮”，与此同时，某个计时器也到达了时间，我应该处理哪一个呢?</li>
<li>......</li>
</ul>
<p>渲染主线程想出了一个绝沙的主意来处理这个问题——排队：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d25e30f7fa914abcb3475d88f773ddd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=vtBJAhkoHnJJcFowR%2FB%2BkTMdH6I%3D" alt="image.png" loading="lazy"/></p>
<p>JS事件循环又叫做消息循环，是浏览器渲染主线程的工作方式，是一种让JavaScript既是单线程，又不会阻塞的机制。它负责执行代码、收集和处理事件、执行队列中的子任务。事件队列是一个存放待执行的任务的列表，有宏任务队列和微任务队列之分。</p>
<p>分类任务可以帮助JavaScript引擎在执行过程中进行任务的优化和调度。通过将任务分为微任务和宏任务，JavaScript引擎可以根据执行上下文的不同特点和优先级来合理地安排任务的执行顺序。</p>
<blockquote>
<p>微任务是指在当前任务执行结束后立即执行的任务，它可以看作是在当前任务的“尾巴”添加的任务。常见的微任务包括 Promise.then 回调（注意：new Promise在实例化的过程中所执行的代码都是同步进行的）和 MutationObserver回调、nextTick等。 </p>
<p>宏任务是指需要排队等待 JavaScript 引擎空闲时才能执行的任务。常见的宏任务包括 setTimeout、setInterval、I/O 操作、DOM 事件等。</p>
</blockquote>
<p>通俗地讲，可以将js代码执行需要借助三个通道：主线程，微任务队列，宏任务队列。对于一段需要执行的js代码，从上往下遍历，遇到同步代码便直接放入主线程中依次执行，遇到微任务则放入微任务队列，遇到宏任务则放入微任务队列，此时从微任务队列拿出任务到主线程中执行，执行过程中可能产生另外的微任务/宏任务，按例放入相应的队列中。直到微任务队列为空，开启新的一轮事件循环，再去从宏任务队列中拿出一个任务到主线程中执行，如果产生了新的微任务，则停止宏任务的下一个宏任务的执行，先去清空微任务队列。</p>
<p>同步任务、微任务、宏任务的执行顺序是：先执行同步代码，然后清空微任务队列，再执行一个宏任务，然后重复这个过程。这里容易产生一个错误的认识：就是微任务先于宏任务执行。实际上是先执行同步任务然后在执行异步任务，异步任务是分宏任务和微任务两种的。</p>
<blockquote>
<p>如何理解JS的异步?</p>
<p>参考答案：</p>
<p>JS是一门单线程的语言，这是因为它运行在浏览器的渲染主线程中，而渲染主线程只有一个。而渲染主线程承担着诸多的工作，如渲染页面、执行JS 都在其中运行。</p>
<p>如果使用同步的方式，就极有可能导致主线程产生阻塞，从而导致消息队列中的很多其它任务无法得到执行。这样一来，一方面会导致繁忙的主线程白白的消耗时间，另一方面导致页面无法及时更新．给用户造成卡死现象。</p>
<p>所以浏览器采用异步的方式来避免。具体做法是当某些任务发生时，比如计时器、网络、事件监听，主线程将任务交给其他线程去处理，自身立即结束任务的执行，转而执行后续代码。当其他线程完成时，将事先传递的回调函数包装成任务，加入到消息队列的末尾排队，等待主线程调度执行。</p>
<p>在这种异步模式下，浏览器永不阻塞，从而最大限度的保证了单线程的流畅运行。</p>
</blockquote>
<h3 data-id="heading-5">1.3 浏览器是如何渲染页面的？</h3>
<p>当浏览器的网络线程收到 HTML 文档后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列。在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程。</p>
<hr/>
<p>整个渲染流程分为多个阶段，分别是： HTML 解析、样式计算、布局、分层、绘制、分块、光栅化、画。</p>
<p>每个阶段都有明确的输入输出，上一个阶段的输出会成为下一个阶段的输入。</p>
<p>这样，整个渲染流程就形成了一套组织严密的生产流水线。</p>
<hr/>
<p>可以着重讲的是渲染的第一步，即<strong>解析 HTML</strong>。</p>
<p>解析过程中遇到 CSS 解析 CSS，遇到 JS 执行 JS。为了提高解析效率，浏览器在开始解析前，会启动一个预解析的线程，率先下载 HTML 中的外部 CSS 文件和 外部的 JS 文件。</p>
<p>如果主线程解析到link位置，此时外部的 CSS 文件还没有下载解析好，主线程不会等待，继续解析后续的 HTML。这是因为下载和解析 CSS 的工作是在预解析线程中进行的。这就是 CSS 不会阻塞 HTML 解析的根本原因。</p>
<p>如果主线程解析到script位置，会停止解析 HTML，转而等待 JS 文件下载好，并将全局代码解析执行完成后，才能继续解析 HTML。这是因为 JS 代码的执行过程可能会修改当前的 DOM 树，所以 DOM 树的生成必须暂停。这就是 JS 会阻塞 HTML 解析的根本原因。</p>
<p>第一步完成后，会得到 DOM 树和 CSSOM 树（CSS Object Model），浏览器的默认样式、内部样式、外部样式、行内样式均会包含在 CSSOM 树中。</p>
<hr/>
<p>经过下一步的样式计算后，会得到一棵带有样式的 DOM 树。</p>
<hr/>
<p>紧接着渲染主线程陆续完成布局、分层、绘制等工作。</p>
<hr/>
<p>完成绘制后，主线程将每个图层的绘制信息提交给合成线程，剩余工作将由合成线程完成，合成线程会从线程池中拿取多个线程来完成分块工作。</p>
<hr/>
<p>最后，合成线程会将块信息交给 GPU 进程，会开启多个线程来完成光栅化以极高的速度完成光栅化。</p>
<p>光栅化的结果，就是一块一块的位图，最后呈现在屏幕上。</p>
<h2 data-id="heading-6">2、React执行原理</h2>
<h3 data-id="heading-7">2.1 React代码是怎么运行在浏览器中的？</h3>
<p>React代码需要经过一系列转换才能在浏览器中运行，主要包括以下几个关键步骤：</p>
<p><strong>1、JSX 转化</strong></p>
<p>React使用JSX语法，但浏览器无法直接理解JSX。需要通过Babel等转译器将JSX转换为普通的JavaScript：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 原始JSX代码</span>
<span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, World!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;

<span class="hljs-comment">// 转换后的JavaScript</span>
<span class="hljs-keyword">const</span> element = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h1'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'Hello, World!'</span>);
</code></pre>
<p><strong>2、模块打包</strong></p>
<p>使用Webpack、Vite等打包工具将多个模块文件打包成浏览器可以加载的bundle文件：</p>
<ul>
<li>解析import/export语句</li>
<li>合并多个文件</li>
<li>处理依赖关系</li>
<li>代码分割和优化</li>
</ul>
<p><strong>3、运行时执行流程</strong></p>
<p>初始化阶段：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 1. 引入React库</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;

<span class="hljs-comment">// 2. 创建根节点</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));

<span class="hljs-comment">// 3. 渲染组件</span>
root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
</code></pre>
<p>渲染过程：</p>
<ul>
<li>创建虚拟DOM：React将JSX转换为虚拟DOM对象</li>
<li>Diff算法：比较新旧虚拟DOM的差异</li>
<li>更新真实DOM：将变化应用到浏览器的真实DOM上</li>
</ul>
<hr/>
<p>原理图如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d49c1c36db8c4d6a946f467007e4d2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=pmKliCZkPbVOAq4S4uyP6qSlKFM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.2 Fiber架构</h3>
<h4 data-id="heading-9">2.2.1 什么是Fiber架构？</h4>
<p>Fiber是React 16引入的全新协调引擎（Reconciliation Engine），是React核心算法的完全重写。它解决了旧版本React在处理大型应用时的性能瓶颈问题。</p>
<p>React Fiber的解决方案：<strong>可中断的异步渲染，它的核心思想是：将不可中断的同步更新，拆解成可中断的异步工作单元，也就是中断和重启。</strong></p>
<h4 data-id="heading-10">2.2.2 为什么需要Fiber架构？</h4>
<p><strong>旧架构的问题：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 旧版React的递归更新过程</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateComponent</span>(<span class="hljs-params">component</span>) {
  <span class="hljs-comment">// 递归处理子组件</span>
  component.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
    <span class="hljs-title function_">updateComponent</span>(child); <span class="hljs-comment">// 无法中断</span>
  });
  <span class="hljs-comment">// 更新DOM</span>
}

<span class="hljs-comment">// 问题场景：大量组件更新</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">heavyUpdate</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 假设这个更新需要50ms</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-title function_">updateComponent</span>(components[i]); <span class="hljs-comment">// 同步执行</span>
  }
  <span class="hljs-comment">// 50ms &gt; 16.6ms，会导致掉帧</span>
}
</code></pre>
<p><strong>主要痛点：</strong></p>
<ul>
<li>更新过程是<strong>同步且递归</strong>的，无法中断</li>
<li>大型组件树更新时会长时间占用主线程</li>
<li>导致页面卡顿、动画掉帧、用户输入延迟</li>
</ul>
<blockquote>
<p>为什么浏览器卡顿：</p>
<ul>
<li>浏览器的渲染和js的执行是互斥的：js可以操作dom，如果在渲染的时候操作了dom，不知道以哪个为准。</li>
<li>一般浏览器的刷新率为60hz，即1秒钟刷新60次。1000ms / 60hz = 16.6ms ，大概每过16.6ms浏览器会渲染一帧画面，也就是一次eventLoop需要保证在16.6ms内完成。</li>
<li>在需要连续渲染的时候，如果js的执行超过16.6ms，导致染间隔大于了16.6ms，就会导致卡顿。</li>
</ul>
</blockquote>
<h4 data-id="heading-11">2.2.3 Fiber节点结构</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Fiber节点的简化结构</span>
<span class="hljs-keyword">const</span> fiber = {
  <span class="hljs-comment">// 节点类型信息</span>
  <span class="hljs-attr">type</span>: <span class="hljs-string">'div'</span>,
  <span class="hljs-attr">key</span>: <span class="hljs-literal">null</span>,
  
  <span class="hljs-comment">// 关系指针</span>
  <span class="hljs-attr">return</span>: parentFiber,      <span class="hljs-comment">// 父节点</span>
  <span class="hljs-attr">child</span>: firstChildFiber,   <span class="hljs-comment">// 第一个子节点</span>
  <span class="hljs-attr">sibling</span>: nextSiblingFiber, <span class="hljs-comment">// 下一个兄弟节点</span>
  
  <span class="hljs-comment">// 状态和属性</span>
  <span class="hljs-attr">props</span>: {},
  <span class="hljs-attr">state</span>: {},
  
  <span class="hljs-comment">// 副作用</span>
  <span class="hljs-attr">effectTag</span>: <span class="hljs-string">'UPDATE'</span>,  <span class="hljs-comment">// 'PLACEMENT' | 'UPDATE' | 'DELETION'</span>
  
  <span class="hljs-comment">// 双缓冲</span>
  <span class="hljs-attr">alternate</span>: workInProgressFiber, <span class="hljs-comment">// 指向另一棵树的对应节点</span>
};
</code></pre>
<h4 data-id="heading-12">2.2.4 Fiber的工作原理</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/622bdf7d9f81401c81a885e3e6f800a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768228723&amp;x-signature=MvtOVj9ACY%2BDdYxLJhKXqvnk34c%3D" alt="image.png" loading="lazy"/></p>
<p><strong>时间切片（Time Slicing）：</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// Fiber将工作分成小单元</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-keyword">let</span> shouldYield = <span class="hljs-literal">false</span>;
  
  <span class="hljs-keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) {
    <span class="hljs-comment">// 执行一个工作单元</span>
    nextUnitOfWork = <span class="hljs-title function_">performUnitOfWork</span>(nextUnitOfWork);
    
    <span class="hljs-comment">// 检查是否需要让出控制权</span>
    shouldYield = deadline.<span class="hljs-title function_">timeRemaining</span>() &lt; <span class="hljs-number">1</span>;
  }
  
  <span class="hljs-comment">// 如果还有工作，继续调度</span>
  <span class="hljs-keyword">if</span> (nextUnitOfWork) {
    <span class="hljs-title function_">requestIdleCallback</span>(workLoop);
  }
}

<span class="hljs-title function_">requestIdleCallback</span>(workLoop);
</code></pre>
<p><strong>双缓冲机制：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// current树：当前显示在屏幕上的</span>
<span class="hljs-comment">// workInProgress树：正在构建的新树</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 工作完成后，交换两棵树</span>
  root.<span class="hljs-property">current</span> = workInProgressRoot;
}
</code></pre>
<p><strong>Fiber的两个阶段：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 协调阶段 - 可以被打断</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reconciliation</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 遍历Fiber树</span>
  <span class="hljs-comment">// 标记需要更新的节点</span>
  <span class="hljs-comment">// 计算副作用</span>
  
  <span class="hljs-comment">// 这个过程可以暂停和恢复</span>
  <span class="hljs-keyword">while</span> (workInProgress &amp;&amp; !<span class="hljs-title function_">shouldYield</span>()) {
    workInProgress = <span class="hljs-title function_">performUnitOfWork</span>(workInProgress);
  }
}

<span class="hljs-comment">// 2. 提交阶段 - 必须同步完成</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commit</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 一次性应用所有DOM变更</span>
  <span class="hljs-title function_">commitBeforeMutationEffects</span>();  <span class="hljs-comment">// DOM变更前</span>
  <span class="hljs-title function_">commitMutationEffects</span>();        <span class="hljs-comment">// 执行DOM操作</span>
  <span class="hljs-title function_">commitLayoutEffects</span>();          <span class="hljs-comment">// DOM变更后</span>
}
</code></pre>
<p><strong>效果对比：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 旧架构：一次性处理完整棵树</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">oldRender</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 阻塞主线程 100ms</span>
  <span class="hljs-title function_">updateEntireTree</span>(); <span class="hljs-comment">// 无法中断</span>
}

用户点击 → 开始更新 → [50ms阻塞] → 更新完成 → 响应用户
                    ↑
                 页面卡顿


<span class="hljs-comment">// Fiber架构：分片处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fiberRender</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 每5ms处理一部分</span>
  <span class="hljs-keyword">while</span> (hasWork &amp;&amp; <span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">processChunk</span>(); <span class="hljs-comment">// 可以随时暂停</span>
  }
  <span class="hljs-comment">// 让出控制权给浏览器处理用户输入、动画等</span>
}

用户点击 → 开始更新 → [5ms工作] → 让出控制权 → [5ms工作] → ...
                    ↑           ↑
                 可响应用户   可处理动画

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Task数据交互]]></title>    <link>https://juejin.cn/post/7591744347826372634</link>    <guid>https://juejin.cn/post/7591744347826372634</guid>    <pubDate>2026-01-05T14:49:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744347826372634" data-draft-id="7591744347826356250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Task数据交互"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-05T14:49:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Task数据交互
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T14:49:46.000Z" title="Mon Jan 05 2026 14:49:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经过前面的学习，Flink 的几个核心概念相关的源码实现我们已经了解了。本文我们来梳理 Task 的数据交互相关的源码。</p>
<h3 data-id="heading-0">数据输出</h3>
<p>话不多说，我们直接进入正题。首先来看 Task 的数据输出，在进入流程之前，我们先介绍几个基本概念。</p>
<h4 data-id="heading-1">基本概念</h4>
<ul>
<li>RecordWriterOutput：它是 Output 接口的一个具体实现类，底层使用 RecordWriter 来发送数据。</li>
<li>RecordWriter：数据写入的执行者，负责将数据写到 ResultPartition。</li>
<li>ResultPartition 和 ResultSubpartition：ResultPartition 是 ExecutionGraph 中一个节点的输出结果，下游的每个需要从当前 ResultPartition 消费数据的 Task 都会有一个 ResultSubpartition。</li>
<li>ChannelSelector：用来决定一个 Record 要被写到哪个 Subpartition 中。</li>
<li>LocalBufferPool：用来管理 Buffer 的缓冲池。在介绍反压的原理时，我们提到过。</li>
</ul>
<p>对这些基本概念有了一定的了解之后，我们来看数据输出的具体流程。</p>
<h4 data-id="heading-2">执行流程</h4>
<p>我们以 map 为例，看一下数据的输出过程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed568cbc1734c71ae96ca84bb8c8305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229385&amp;x-signature=LNbTqu9p6Ye7O7tH2oz32i0hyQs%3D" alt="DataOutput" loading="lazy"/></p>
<p>在 <code>StreamMap.processElement</code> 方法中，调用完 map 方法之后，就会调用 <code>output.collect</code> 方法将数据输出，这里的 output 就是 RecordWriterOutput。在 RecordWriterOutput 中，会调用 RecordWriter 的 emit 方法。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> &lt;X&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushToRecordWriter</span>(<span class="hljs-params">StreamRecord&lt;X&gt; <span class="hljs-keyword">record</span></span>)</span> {
    serializationDelegate.setInstance(<span class="hljs-keyword">record</span>);

    <span class="hljs-keyword">try</span> {
        recordWriter.emit(serializationDelegate);
    } <span class="hljs-keyword">catch</span> (IOException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UncheckedIOException(e.getMessage(), e);
    }
}
</code></pre>
<p>这里的 serializationDelegate 是用来对 record 进行序列化的。RecordWriter 有两个实现类，一个是 ChannelSelectorRecordWriter，另一个是 BroadcastRecordWriter。ChannelSelectorRecordWriter 需要先调用 ChannelSelector 选择对应的 subparition，然后进行写入。BroadcastRecordWriter 则是写到所有的 subparition。</p>
<p>接下来就是调用 <code>BufferWritingResultPartition.emitRecord</code> 来写入数据。</p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">emitRecord</span>(ByteBuffer record, int targetSubpartition) throws IOException {
    totalWrittenBytes += record<span class="hljs-selector-class">.remaining</span>();

    BufferBuilder buffer = <span class="hljs-built_in">appendUnicastDataForNewRecord</span>(record, targetSubpartition);

    while (record.hasRemaining()) {
        <span class="hljs-comment">// full buffer, partial record</span>
        <span class="hljs-built_in">finishUnicastBufferBuilder</span>(targetSubpartition);
        buffer = <span class="hljs-built_in">appendUnicastDataForRecordContinuation</span>(record, targetSubpartition);
    }

    if (buffer.isFull()) {
        <span class="hljs-comment">// full buffer, full record</span>
        <span class="hljs-built_in">finishUnicastBufferBuilder</span>(targetSubpartition);
    }

    <span class="hljs-comment">// partial buffer, full record</span>
}
</code></pre>
<p>这里把 record 写入到 buffer 中，如果 buffer 不够，则会从 LocalBufferPool 中申请新的 buffer，申请到之后就会继续写入。下面是具体的申请过程。</p>
<pre><code class="hljs language-scss" lang="scss">private MemorySegment <span class="hljs-built_in">requestMemorySegment</span>(int targetChannel) {
    MemorySegment segment = null;
    synchronized (availableMemorySegments) {
        <span class="hljs-built_in">checkDestroyed</span>();

        if (!availableMemorySegments.isEmpty()) {
            segment = availableMemorySegments<span class="hljs-selector-class">.poll</span>();
        } else if (isRequestedSizeReached()) {
            <span class="hljs-comment">// Only when the buffer request reaches the upper limit(i.e. current pool size),</span>
            <span class="hljs-comment">// requests an overdraft buffer.</span>
            segment = <span class="hljs-built_in">requestOverdraftMemorySegmentFromGlobal</span>();
        }

        if (segment == null) {
            return null;
        }

        if (targetChannel != UNKNOWN_CHANNEL) {
            if (++subpartitionBuffersCount[targetChannel] == maxBuffersPerChannel) {
                unavailableSubpartitionsCount++;
            }
        }

        <span class="hljs-built_in">checkAndUpdateAvailability</span>();
    }
    return segment;
}
</code></pre>
<p>如果有可用内存，就直接从队列中出队。如果达到了本地 BufferPool 的上限，就从全局的 NetworkBufferPool 中申请，申请不到就会阻塞写入过程，等待申请。最后还会检查并更新可用内存状态。</p>
<p>有了可用的 buffer 之后，就会调用 addToSubpartition，最终数据存储在 PipelinedSubpartition 的 buffers 队列中。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">addToSubpartition</span><span class="hljs-params">(
        BufferBuilder buffer,
        <span class="hljs-type">int</span> targetSubpartition,
        <span class="hljs-type">int</span> partialRecordLength,
        <span class="hljs-type">int</span> minDesirableBufferSize)</span>
        throws IOException </span>{
    <span class="hljs-type">int</span> desirableBufferSize =
            subpartitions[targetSubpartition].<span class="hljs-built_in">add</span>(
                    buffer.<span class="hljs-built_in">createBufferConsumerFromBeginning</span>(), partialRecordLength);

    <span class="hljs-built_in">resizeBuffer</span>(buffer, desirableBufferSize, minDesirableBufferSize);
}
</code></pre>
<h3 data-id="heading-3">数据输入</h3>
<p>看完了数据输出的过程之后，我们再来看一下数据输入的过程。首先还是了解几个基本概念。</p>
<h4 data-id="heading-4">基本概念</h4>
<ul>
<li>InputGate：InputGate 是对输入的封装，与 JobGraph 中的 JobEdge 一一对应，每个 InputGate 消费上游一个或多个 Resultpartition。</li>
<li>InputChannel：InputChannel 是和 ExecutionGraph 中的 ExecutionEdge 一一对应的。每个 InputChannel 接收一个 ResultSubpartition 的输出，InputChannel 主要关注 LocalInputChannel 和 RemoteInputChannel 两种实现。</li>
</ul>
<h4 data-id="heading-5">执行流程</h4>
<p>了解了具体概念之后，我们再看数据输入的具体流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54ab8cf05ba14bc1b0a643b621cec5fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229385&amp;x-signature=ekrK1mD9nROVo2i0Adeh1eL98bk%3D" alt="RecordInput" loading="lazy"/></p>
<p>数据输入的入口是 <code>StreamTask.processInput</code> 方法，这个方法中主要是调用 <code>inputProcessor.processInput</code> 方法，我们以 StreamOneInputProcessor 为例。这个方法就是调用 <code>input.emitNext</code> 方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> DataInputStatus emitNext(DataOutput&lt;T&gt; output) throws Exception {

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// get the stream element from the deserializer</span>
        <span class="hljs-keyword">if</span> (currentRecordDeserializer != <span class="hljs-literal">null</span>) {
            RecordDeserializer.DeserializationResult result;
            <span class="hljs-keyword">try</span> {
                result = currentRecordDeserializer.getNextRecord(deserializationDelegate);
            } <span class="hljs-keyword">catch</span> (IOException e) {
                <span class="hljs-keyword">throw</span> new IOException(
                        String.format(<span class="hljs-string">"Can't get next record for channel %s"</span>, lastChannel), e);
            }
            <span class="hljs-keyword">if</span> (result.isBufferConsumed()) {
                currentRecordDeserializer = <span class="hljs-literal">null</span>;
            }

            <span class="hljs-keyword">if</span> (result.isFullRecord()) {
                <span class="hljs-keyword">final</span> boolean breakBatchEmitting =
                        processElement(deserializationDelegate.getInstance(), output);
                <span class="hljs-keyword">if</span> (canEmitBatchOfRecords.check() &amp;&amp; !breakBatchEmitting) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">return</span> DataInputStatus.MORE_AVAILABLE;
            }
        }

        Optional&lt;BufferOrEvent&gt; bufferOrEvent = checkpointedInputGate.pollNext();
        <span class="hljs-keyword">if</span> (bufferOrEvent.isPresent()) {
            <span class="hljs-comment">// return to the mailbox after receiving a checkpoint barrier to avoid processing of</span>
            <span class="hljs-comment">// data after the barrier before checkpoint is performed for unaligned checkpoint</span>
            <span class="hljs-comment">// mode</span>
            <span class="hljs-keyword">if</span> (bufferOrEvent.<span class="hljs-keyword">get</span>().isBuffer()) {
                processBuffer(bufferOrEvent.<span class="hljs-keyword">get</span>());
            } <span class="hljs-keyword">else</span> {
                DataInputStatus status = processEvent(bufferOrEvent.<span class="hljs-keyword">get</span>(), output);
                <span class="hljs-keyword">if</span> (status == DataInputStatus.MORE_AVAILABLE &amp;&amp; canEmitBatchOfRecords.check()) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">return</span> status;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (checkpointedInputGate.isFinished()) {
                checkState(
                        checkpointedInputGate.getAvailableFuture().isDone(),
                        <span class="hljs-string">"Finished BarrierHandler should be available"</span>);
                <span class="hljs-keyword">return</span> DataInputStatus.END_OF_INPUT;
            }
            <span class="hljs-keyword">return</span> DataInputStatus.NOTHING_AVAILABLE;
        }
    }
}
</code></pre>
<p>这里是调用 <code>checkpointedInputGate.pollNext</code> 来获取输入的数据。它的内部就是调用 InputGate 的 pollNext 方法来获取数据。当获取到完整数据之后，就会调用 processElement 来处理数据。</p>
<p>我们以 SingleInputGate 为例看 InputGate 的 pollNext 方法。它的内部调用链路可用一直追踪到 readBufferFromInputChannel 方法，这个方法内会调用 <code>inputChannel.getNextBuffer</code>，这里交给 InputChannel 来具体执行数据读取。</p>
<pre><code class="hljs language-scss" lang="scss">public Optional&lt;BufferAndAvailability&gt; <span class="hljs-built_in">getNextBuffer</span>() throws IOException {
    <span class="hljs-built_in">checkError</span>();

    if (!toBeConsumedBuffers.isEmpty()) {
        return <span class="hljs-built_in">getBufferAndAvailability</span>(toBeConsumedBuffers.removeFirst());
    }

    ResultSubpartitionView subpartitionView = this<span class="hljs-selector-class">.subpartitionView</span>;
    if (subpartitionView == null) {
        <span class="hljs-comment">// There is a possible race condition between writing a EndOfPartitionEvent (1) and</span>
        <span class="hljs-comment">// flushing (3) the Local</span>
        <span class="hljs-comment">// channel on the sender side, and reading EndOfPartitionEvent (2) and processing flush</span>
        <span class="hljs-comment">// notification (4). When</span>
        <span class="hljs-comment">// they happen in that order (1 - 2 - 3 - 4), flush notification can re-enqueue</span>
        <span class="hljs-comment">// LocalInputChannel after (or</span>
        <span class="hljs-comment">// during) it was released during reading the EndOfPartitionEvent (2).</span>
        if (isReleased) {
            return Optional<span class="hljs-selector-class">.empty</span>();
        }

        <span class="hljs-comment">// this can happen if the request for the partition was triggered asynchronously</span>
        <span class="hljs-comment">// by the time trigger</span>
        <span class="hljs-comment">// would be good to avoid that, by guaranteeing that the requestPartition() and</span>
        <span class="hljs-comment">// getNextBuffer() always come from the same thread</span>
        <span class="hljs-comment">// we could do that by letting the timer insert a special "requesting channel" into the</span>
        <span class="hljs-comment">// input gate's queue</span>
        subpartitionView = <span class="hljs-built_in">checkAndWaitForSubpartitionView</span>();
    }

    BufferAndBacklog next = subpartitionView<span class="hljs-selector-class">.getNextBuffer</span>();
    <span class="hljs-comment">// ignore the empty buffer directly</span>
    while (next != null &amp;&amp; next.buffer()<span class="hljs-selector-class">.readableBytes</span>() == <span class="hljs-number">0</span>) {
        next<span class="hljs-selector-class">.buffer</span>()<span class="hljs-selector-class">.recycleBuffer</span>();
        next = subpartitionView<span class="hljs-selector-class">.getNextBuffer</span>();
        numBuffersIn<span class="hljs-selector-class">.inc</span>();
    }

    if (next == null) {
        if (subpartitionView.isReleased()) {
            throw new <span class="hljs-built_in">CancelTaskException</span>(
                    "Consumed partition " + subpartitionView + " has been released.");
        } else {
            return Optional<span class="hljs-selector-class">.empty</span>();
        }
    }

    Buffer buffer = next<span class="hljs-selector-class">.buffer</span>();

    if (buffer instanceof FullyFilledBuffer) {
        List&lt;Buffer&gt; partialBuffers = ((FullyFilledBuffer) buffer)<span class="hljs-selector-class">.getPartialBuffers</span>();
        int seq = next<span class="hljs-selector-class">.getSequenceNumber</span>();
        for (Buffer partialBuffer : partialBuffers) {
            toBeConsumedBuffers<span class="hljs-selector-class">.add</span>(
                    new BufferAndBacklog(
                            partialBuffer,
                            next.buffersInBacklog(),
                            buffer<span class="hljs-selector-class">.getDataType</span>(),
                            seq++));
        }

        return <span class="hljs-built_in">getBufferAndAvailability</span>(toBeConsumedBuffers.removeFirst());
    }

    return <span class="hljs-built_in">getBufferAndAvailability</span>(next);
}
</code></pre>
<p>我们先来看 LocalInputChannel，先获取到了 subpartitionView，并调用 getNextBuffer，这里其实就是从 PipelinedSubpartition 的 buffers 队列中读取数据。</p>
<p>RemoteInputChannel 则需要从 receivedBuffers 中读取数据，这个队列的数据就是消费上游数据后保存的。</p>
<p>至此，Flink 中 Task 的数据输入和输出过程的源码就梳理完了，更加底层的 Netty 相关代码我们在后面继续梳理。</p>
<h3 data-id="heading-6">总结</h3>
<p>最后简单总结一下，本文我们梳理了 Task 的数据输出和输入的过程。输出过程主要是利用 RecordWriter 将数据写入到 Buffer 中，输入过程则是利用 InputChannel 从 Buffer 消费的过程。如果你的 Flink 任务数据量特别大，并且没什么复杂的逻辑，可以考虑适当调整 localBufferPool 的大小来调优任务的吞吐。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[jitword协同AI文档SDK已开源！轻松接入任何后端！]]></title>    <link>https://juejin.cn/post/7591728734982930459</link>    <guid>https://juejin.cn/post/7591728734982930459</guid>    <pubDate>2026-01-05T14:52:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591728734982930459" data-draft-id="7591708519449149449" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="jitword协同AI文档SDK已开源！轻松接入任何后端！"/> <meta itemprop="keywords" content="前端,GitHub,Vue.js"/> <meta itemprop="datePublished" content="2026-01-05T14:52:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="徐小夕"/> <meta itemprop="url" content="https://juejin.cn/user/3808363978429613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            jitword协同AI文档SDK已开源！轻松接入任何后端！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363978429613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    徐小夕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T14:52:43.000Z" title="Mon Jan 05 2026 14:52:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前和大家分享了我们精心打磨的协同AI文档 JitWord：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cbcd746442446ab2cdafb0fe7970b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=AeGQvHefonz7ySL1VRgagi5YSS4%3D" alt="图片" loading="lazy"/></p>
<p>最近很多用户咨询我 <strong>JitWord</strong> 协同文档集成的问题，希望我们能提供本地可测试的版本，能让他们集成到系统测试体验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce3922b5e39e48d2b0d0756a3dbc8e2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=MvXpA%2BIIzuw3bntyaXxuvnu1%2FG0%3D" alt="图片" loading="lazy"/></p>
<p>最近我们也加班加点，上线了AI文档的 SDK 版本，大家可以使用 JitWord SDK，轻松集成到自己的系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e8c69247e28406fa9569f8bd60e8806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=2GIQeAxfHBTtdPrpzifDXDZB24k%3D" alt="图片" loading="lazy"/></p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fjitword-sdk" target="_blank" title="https://github.com/MrXujiang/jitword-sdk" ref="nofollow noopener noreferrer">github.com/MrXujiang/j…</a></p>
<p>下面聊聊我们 <strong>JitWord SDK</strong> 的设计架构。</p>
<h3 data-id="heading-0">JitWord SDK 架构设计</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fb7eff008bc4ad6bb8c8a05825ea53d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=JDr8ciRvTUAaidqeeLyHynemmnA%3D" alt="图片" loading="lazy"/></p>
<p><strong>jitword SDK</strong> 采用微内核架构，核心引擎仅2.3MB，我们采用了三层架构设计：渲染层、协同层、AI能力层；支持 WebSocket 实时通信，CRDT算法解决冲突；内置AI助手，支持智能写作、内容优化、知识问答等。</p>
<h3 data-id="heading-1">SDK的实现目标</h3>
<p>设计sdk的最终目标还是为了降低企业和开发人员的接入成本，支持通过本地文件引入到项目（后端接口和协同部分需连接远程服务）。具体目标如下：</p>
<ul>
<li><strong>多技术栈支持</strong>支持 Vue, React, Angular, 原生 HTML 等。</li>
<li><strong>API 暴露</strong>提供丰富的 API 让开发人员控制编辑器行为。</li>
<li><strong>快速上手</strong>简单易用，5分钟即可完成接入。</li>
<li><strong>完善文档</strong>提供详细的 API 和 SDK 使用文档。</li>
</ul>
<p>对于API暴露，我们也借鉴了很多用户的建议，最终输出了一份比较完整的API扩展：</p>
<ol>
<li>基础配置：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92a9bbfa9990477ba5ab8333abb74f84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=9edYdGT5u7Vn2Hj7E0koiq%2BhYX0%3D" alt="图片" loading="lazy"/></p>
<ol start="2">
<li>编辑器配置：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9afdc3005fd460f8f84c1c590d1d051~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=vNB1bS764h3ABLAOimN2NfjAADM%3D" alt="图片" loading="lazy"/></p>
<ol start="3">
<li>协同服务配置：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff2ae06856674fc685bf99f88eef6c29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=qX9rcCIsPJBpJAyC2xiU8gxwLJc%3D" alt="图片" loading="lazy"/></p>
<ol start="4">
<li>文档数据处理</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/098d6f832c654b93b0d6618da55a9fc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=cTgEVz%2BN6qUbWjAeB7MVyXzDpMc%3D" alt="图片" loading="lazy"/></p>
<ol start="5">
<li>离线模式配置</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27c1a0d7c4f04f55bfb92d6705e74b52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=dncpM5jSHSfs73WNQwACxiXjd9A%3D" alt="图片" loading="lazy"/></p>
<p>使用方式也很简单，接下来和大家分享一下。</p>
<h3 data-id="heading-2">本地使用指南</h3>
<h3 data-id="heading-3">1. 初始化编辑器</h3>
<h3 data-id="heading-4">在 HTML 中准备一个容器：</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;<span class="hljs-attr">divid</span>=<span class="hljs-string">"col-editor"</span> style=<span class="hljs-string">"height: 100vh;"</span>&gt;&lt;/div&gt;
</code></pre>
<p>使用 <code>Jitword</code> 类初始化：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a9423c5a2aa40a8afe0a4e7dd8df68c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=ktMhpJ%2BICdwa5f3zAP%2BJsKR5uFc%3D" alt="image.png" loading="lazy"/></p>
<p>这样就可以在本地拥有一个完全独立且离线的文档编辑器啦：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7094141b5d64fd693ca2b88368ea211~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229563&amp;x-signature=bVyA8UwU%2ByN75oIH3X5hmbr0sxo%3D" alt="图片" loading="lazy"/></p>
<p>详细的配置使用文档，我们在github上提供了完整说明，大家可以体验一下：</p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fjitword-sdk" target="_blank" title="https://github.com/MrXujiang/jitword-sdk" ref="nofollow noopener noreferrer">github.com/MrXujiang/j…</a></p>
<p>好啦，今天就分享到这，如果大家对AI Word编辑器感兴趣，也欢迎随时和我交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ooder-A2UI 框架中的矢量图形全面指南]]></title>    <link>https://juejin.cn/post/7591697558377119786</link>    <guid>https://juejin.cn/post/7591697558377119786</guid>    <pubDate>2026-01-05T14:53:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591697558377119786" data-draft-id="7591715454134452287" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ooder-A2UI 框架中的矢量图形全面指南"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-05T14:53:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ooder-A2UI 框架中的矢量图形全面指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T14:53:11.000Z" title="Mon Jan 05 2026 14:53:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SVG（可缩放矢量图形）是A2UI框架中用于创建高质量矢量图形的重要组件。本专辑将全面介绍SVGPaper组件的使用、SVG形状类型、连接线系统、样式配置以及实际应用案例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1919abc9b9e8436b87d81030ffe401c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229591&amp;x-signature=IU%2BUBGNiSnuWvsZNPIK9lTITsho%3D" alt="96187a0e-e827-4529-8583-e4d174bf3d3b.png" loading="lazy"/></p>
<h2 data-id="heading-0">📋 目录</h2>
<ol>
<li><a href="#svgpaper-%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0" title="#svgpaper-%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0">SVGPaper 组件概述</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" title="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">快速入门</a></li>
<li><a href="#svg-%E5%BD%A2%E7%8A%B6%E7%B1%BB%E5%9E%8B%E5%A4%A7%E5%85%A8" title="#svg-%E5%BD%A2%E7%8A%B6%E7%B1%BB%E5%9E%8B%E5%A4%A7%E5%85%A8">SVG 形状类型大全</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5%E7%BA%BF%E7%B3%BB%E7%BB%9F" title="#%E8%BF%9E%E6%8E%A5%E7%BA%BF%E7%B3%BB%E7%BB%9F">连接线系统</a></li>
<li><a href="#%E6%A0%B7%E5%BC%8F%E4%B8%8E%E6%B8%90%E5%8F%98" title="#%E6%A0%B7%E5%BC%8F%E4%B8%8E%E6%B8%90%E5%8F%98">样式与渐变</a></li>
<li><a href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B" title="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B">实际应用案例</a></li>
<li><a href="#api-%E5%8F%82%E8%80%83" title="#api-%E5%8F%82%E8%80%83">API 参考</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
</ol>
<h2 data-id="heading-1">SVGPaper 组件概述</h2>
<p>SVGPaper 是 A2UI 框架中专门用于绘制和管理 SVG 矢量图形的组件。它继承自 Div 组件，提供了丰富的图形创建、编辑和交互功能。</p>
<h3 data-id="heading-2">核心特性</h3>
<ul>
<li><strong>矢量图形绘制</strong>：支持多种预定义形状和自定义路径</li>
<li><strong>流程图支持</strong>：专门的流程图形状和连接线系统</li>
<li><strong>交互支持</strong>：点击、悬停、拖拽等交互事件</li>
<li><strong>样式配置</strong>：丰富的描边、填充、渐变选项</li>
<li><strong>响应式设计</strong>：自动适应不同屏幕尺寸</li>
<li><strong>可访问性</strong>：ARIA 属性和键盘导航支持</li>
</ul>
<h3 data-id="heading-3">技术架构</h3>
<p>SVGPaper 基于以下技术构建：</p>
<ul>
<li><strong>Raphaël SVG 库</strong>：轻量级、跨浏览器的 SVG 库</li>
<li><strong>A2UI 组件体系</strong>：标准的 UI 组件生命周期和事件系统</li>
<li><strong>CSS 变量主题</strong>：支持主题切换和自定义样式</li>
</ul>
<h2 data-id="heading-4">快速入门</h2>
<h3 data-id="heading-5">1. 创建 SVG 画布</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 引入核心库和SVGPaper组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"ood/ood.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"ood/UI/SVGPaper.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 创建画布容器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"svg-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 创建 SVGPaper 实例</span>
<span class="hljs-keyword">var</span> svgPaper = ood.<span class="hljs-property">UI</span>.<span class="hljs-title class_">SVGPaper</span>({
    <span class="hljs-attr">width</span>: <span class="hljs-string">'800px'</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-string">'600px'</span>,
    <span class="hljs-attr">scaleChildren</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">overflow</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">graphicZIndex</span>: <span class="hljs-number">0</span>
}).<span class="hljs-title function_">appendTo</span>(<span class="hljs-string">'#svg-container'</span>);

<span class="hljs-comment">// 画布创建完成，可以开始添加图形</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">2. 添加基本形状</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加圆形</span>
svgPaper.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.circle"</span>)
    .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"circle1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Shapes:Circle"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"cx"</span>: <span class="hljs-number">100</span>,
            <span class="hljs-string">"cy"</span>: <span class="hljs-number">100</span>,
            <span class="hljs-string">"r"</span>: <span class="hljs-number">50</span>,
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#2196F3"</span>,
            <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#1976D2"</span>,
            <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">3</span>
        }
    })
);

<span class="hljs-comment">// 添加矩形</span>
svgPaper.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rect"</span>)
    .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"rect1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Shapes:Rect"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"x"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"y"</span>: <span class="hljs-number">80</span>,
            <span class="hljs-string">"width"</span>: <span class="hljs-number">120</span>,
            <span class="hljs-string">"height"</span>: <span class="hljs-number">80</span>,
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#4CAF50-#C8E6C9"</span>,
            <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#388E3C"</span>,
            <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>
        }
    })
);
</code></pre>
<h3 data-id="heading-7">3. 添加文本和连接线</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加文本</span>
svgPaper.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.text"</span>)
    .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"text1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Shapes:Text"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"x"</span>: <span class="hljs-number">150</span>,
            <span class="hljs-string">"y"</span>: <span class="hljs-number">250</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"SVG 示例"</span>,
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#333333"</span>,
            <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"20px"</span>,
            <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
        }
    })
);

<span class="hljs-comment">// 添加连接线</span>
svgPaper.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
    .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"connector1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,100,150L,300,150"</span>,
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
            <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#666666"</span>,
            <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"arrow-start"</span>: <span class="hljs-string">"classic-wide-long"</span>,
            <span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"classic-wide-long"</span>
        },
        <span class="hljs-string">"BG"</span>:{
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
            <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#FFFFFF"</span>,
            <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">4</span>
        }
    })
    .<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"circle1"</span>)
    .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"bottom"</span>)
    .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"rect1"</span>)
    .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
);
</code></pre>
<h2 data-id="heading-8">SVG 形状类型大全</h2>
<h3 data-id="heading-9">基础形状</h3>















































<table><thead><tr><th>形状ID</th><th>名称</th><th>描述</th><th>关键属性</th></tr></thead><tbody><tr><td><code>ood.svg.circle</code></td><td>圆形</td><td>标准圆形</td><td><code>cx</code>, <code>cy</code>, <code>r</code>, <code>fill</code>, <code>stroke</code></td></tr><tr><td><code>ood.svg.ellipse</code></td><td>椭圆</td><td>椭圆形</td><td><code>cx</code>, <code>cy</code>, <code>rx</code>, <code>ry</code></td></tr><tr><td><code>ood.svg.rect</code></td><td>矩形</td><td>矩形</td><td><code>x</code>, <code>y</code>, <code>width</code>, <code>height</code></td></tr><tr><td><code>ood.svg.line</code></td><td>直线</td><td>直线段</td><td><code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code></td></tr><tr><td><code>ood.svg.polygon</code></td><td>多边形</td><td>多边形</td><td><code>points</code></td></tr><tr><td><code>ood.svg.polyline</code></td><td>折线</td><td>折线</td><td><code>points</code></td></tr></tbody></table>
<h3 data-id="heading-10">流程图专用形状</h3>
<p>SVGPaper 提供了丰富的流程图形状，每个形状都有特定的用途：</p>
<h4 data-id="heading-11">流程控制形状</h4>

























<table><thead><tr><th>形状类型</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><code>FlowChart:Process</code></td><td>处理过程</td><td>服务器处理</td></tr><tr><td><code>FlowChart:Decision</code></td><td>决策判断</td><td>条件判断</td></tr><tr><td><code>FlowChart:Termination</code></td><td>终止点</td><td>流程结束</td></tr></tbody></table>
<h4 data-id="heading-12">数据形状</h4>

























<table><thead><tr><th>形状类型</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><code>FlowChart:Data</code></td><td>数据</td><td>数据存储</td></tr><tr><td><code>FlowChart:Document</code></td><td>文档</td><td>报告文档</td></tr><tr><td><code>FlowChart:Database</code></td><td>数据库</td><td>数据库系统</td></tr></tbody></table>
<h4 data-id="heading-13">输入输出形状</h4>




















<table><thead><tr><th>形状类型</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><code>FlowChart:ManualInput</code></td><td>手动输入</td><td>用户输入</td></tr><tr><td><code>FlowChart:Display</code></td><td>显示</td><td>结果展示</td></tr></tbody></table>
<h4 data-id="heading-14">存储形状</h4>




















<table><thead><tr><th>形状类型</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><code>FlowChart:StoredData</code></td><td>存储数据</td><td>数据缓存</td></tr><tr><td><code>FlowChart:InternalStorage</code></td><td>内部存储</td><td>内存存储</td></tr></tbody></table>
<h3 data-id="heading-15">组合形状</h3>
<p>组合形状是A2UI中特殊的SVG元素，将图形和文本组合在一起：</p>
<h4 data-id="heading-16"><code>ood.svg.rectComb</code></h4>
<p>矩形组合形状，支持渐变填充和文本：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"x"</span>: <span class="hljs-number">40</span>,
        <span class="hljs-string">"y"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"width"</span>: <span class="hljs-number">90</span>,
        <span class="hljs-string">"height"</span>: <span class="hljs-number">50</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#004A7F"</span>
    },
    <span class="hljs-string">"TEXT"</span>:{
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"服务器"</span>,
        <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#fff"</span>,
        <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
    }
})
</code></pre>
<h4 data-id="heading-17"><code>ood.svg.pathComb</code></h4>
<p>路径组合形状，用于复杂图形：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.pathComb"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#004A7F"</span>,
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,319,85C,310.7157314383532,85,304,71.56854048887718,304,55C,304,38.43145548427702,310.7157178477474,25,319,25M,319,85C,319,85,319,85,319,85C,310.7157314383532,85,304,71.56854048887718,304,55C,304,38.43145548427702,310.7157178477474,25,319,25M,319,25C,327.2842655415122,25,334,38.43145548427702,334,55C,334,71.56854048887718,327.2842655415122,85,319,85C,319,85,259,85,259,85C,250.7157118074781,85,244,71.56854048887718,244,55C,244,38.43145548427702,250.7157118074781,25,259,25C,259,25,319,25,319,25"</span>
    },
    <span class="hljs-string">"TEXT"</span>:{
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"网关"</span>,
        <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#fff"</span>,
        <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
    }
})
</code></pre>
<h4 data-id="heading-18"><code>ood.svg.circleComb</code></h4>
<p>圆形组合形状：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.circleComb"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"cx"</span>: <span class="hljs-number">504</span>,
        <span class="hljs-string">"cy"</span>: <span class="hljs-number">55</span>,
        <span class="hljs-string">"r"</span>: <span class="hljs-number">40</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#004A7F"</span>
    },
    <span class="hljs-string">"TEXT"</span>:{
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"传感器"</span>,
        <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#fff"</span>,
        <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
    }
})
</code></pre>
<h2 data-id="heading-19">连接线系统</h2>
<p>连接线是流程图和图表中连接不同元素的纽带。A2UI 提供了强大的连接线系统，支持自动路径计算和智能连接。</p>
<h3 data-id="heading-20">连接线类型</h3>
<h4 data-id="heading-21">1. 直线连接线 (<code>Connectors:Straight</code>)</h4>
<p>最简单的连接线类型，两点之间直接连接：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
.<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,100,100L,300,200"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#228B22"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-string">"arrow-start"</span>: <span class="hljs-string">"oval-midium-midium"</span>,
        <span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"classic-wide-long"</span>
    },
    <span class="hljs-string">"BG"</span>:{
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#FFFFFF"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">4</span>
    }
})
.<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"shape1"</span>)
.<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)
.<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"shape2"</span>)
.<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
</code></pre>
<h4 data-id="heading-22">2. 贝塞尔曲线连接线 (<code>Connectors:Bezier</code>)</h4>
<p>平滑的曲线连接，适合避免交叉的情况：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
.<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Bezier"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,100,100C,150,50,250,250,300,200"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#FF5722"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>
    }
})
</code></pre>
<h4 data-id="heading-23">3. 流程图连接线 (<code>Connectors:flowchart</code>)</h4>
<p>带拐角的连接线，典型的流程图风格：</p>
<pre><code class="hljs language-javascript" lang="javascript">ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
.<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:flowchart"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,100,100L,200,100L,200,200L,300,200"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#673AB7"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>
    }
})
</code></pre>
<h3 data-id="heading-24">连接点系统</h3>
<p>连接线可以连接到形状的特定位置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 连接到形状的不同位置</span>
connector.<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"serverRect"</span>)      <span class="hljs-comment">// 起始形状</span>
        .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)          <span class="hljs-comment">// 从右侧连接</span>
        .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"gatewayPath"</span>)        <span class="hljs-comment">// 目标形状</span>
        .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>);            <span class="hljs-comment">// 连接到左侧</span>
</code></pre>
<p><strong>支持的位置：</strong></p>
<ul>
<li><code>"left"</code>：左侧</li>
<li><code>"right"</code>：右侧</li>
<li><code>"top"</code>：顶部</li>
<li><code>"bottom"</code>：底部</li>
</ul>
<h3 data-id="heading-25">箭头样式</h3>
<p>连接线支持多种箭头样式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 箭头配置示例</span>
<span class="hljs-string">"arrow-start"</span>: <span class="hljs-string">"classic-wide-long"</span>     <span class="hljs-comment">// 起始箭头</span>
<span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"oval-midium-midium"</span>      <span class="hljs-comment">// 结束箭头</span>
</code></pre>
<p><strong>箭头类型：</strong></p>
<ol>
<li><strong>classic</strong>：经典箭头
<ul>
<li><code>classic-narrow-short</code></li>
<li><code>classic-midium-midium</code></li>
<li><code>classic-wide-long</code></li>
</ul>
</li>
<li><strong>oval</strong>：椭圆形箭头
<ul>
<li><code>oval-midium-midium</code></li>
</ul>
</li>
<li><strong>diamond</strong>：菱形箭头</li>
<li><strong>triangle</strong>：三角形箭头</li>
</ol>
<h2 data-id="heading-26">样式与渐变</h2>
<h3 data-id="heading-27">基本样式属性</h3>















































<table><thead><tr><th>属性</th><th>类型</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>fill</code></td><td>String</td><td>填充颜色或渐变</td><td><code>"#FF0000"</code>, <code>"90-#FF0000-#0000FF"</code></td></tr><tr><td><code>stroke</code></td><td>String</td><td>描边颜色</td><td><code>"#333333"</code></td></tr><tr><td><code>stroke-width</code></td><td>Number</td><td>描边宽度</td><td><code>2</code></td></tr><tr><td><code>stroke-opacity</code></td><td>Number</td><td>描边透明度</td><td><code>0.8</code></td></tr><tr><td><code>fill-opacity</code></td><td>Number</td><td>填充透明度</td><td><code>0.5</code></td></tr><tr><td><code>opacity</code></td><td>Number</td><td>整体透明度</td><td><code>0.9</code></td></tr></tbody></table>
<h3 data-id="heading-28">渐变填充</h3>
<p>A2UI 支持多种渐变类型：</p>
<h4 data-id="heading-29">1. 线性渐变</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#5198D3-#A1C8F6"</span>
</code></pre>
<ul>
<li>格式：<code>"角度-起始颜色-结束颜色"</code></li>
<li>角度：0-360，0°为从上到下，90°为从左到右</li>
</ul>
<h4 data-id="heading-30">2. 径向渐变</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">"fill"</span>: <span class="hljs-string">"r-#FF0000-#FFFFFF"</span>
</code></pre>
<ul>
<li>格式：<code>"r-起始颜色-结束颜色"</code></li>
</ul>
<h4 data-id="heading-31">3. 多色渐变</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#FF0000-#00FF00-#0000FF"</span>
</code></pre>
<ul>
<li>支持多个颜色节点</li>
</ul>
<h3 data-id="heading-32">样式应用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 渐变矩形</span>
<span class="hljs-keyword">var</span> gradientRect = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
.<span class="hljs-title function_">setAttr</span>({
    <span class="hljs-string">"KEY"</span>:{
        <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">"y"</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">"width"</span>: <span class="hljs-number">200</span>,
        <span class="hljs-string">"height"</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"45-#FF6B6B-#4ECDC4"</span>,  <span class="hljs-comment">// 45°线性渐变</span>
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#2D3436"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">"stroke-dasharray"</span>: <span class="hljs-string">"5,5"</span>,      <span class="hljs-comment">// 虚线描边</span>
        <span class="hljs-string">"rx"</span>: <span class="hljs-number">10</span>,                       <span class="hljs-comment">// 圆角半径</span>
        <span class="hljs-string">"ry"</span>: <span class="hljs-number">10</span>
    },
    <span class="hljs-string">"TEXT"</span>:{
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"渐变样式示例"</span>,
        <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"16px"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>,
        <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>,
        <span class="hljs-string">"text-anchor"</span>: <span class="hljs-string">"middle"</span>,
        <span class="hljs-string">"dy"</span>: <span class="hljs-string">"0.35em"</span>                  <span class="hljs-comment">// 垂直居中调整</span>
    }
});

<span class="hljs-comment">// 添加阴影效果</span>
gradientRect.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseover"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"filter"</span>: <span class="hljs-string">"url(#shadow)"</span>        <span class="hljs-comment">// SVG滤镜阴影</span>
    });
});

gradientRect.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseout"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"filter"</span>: <span class="hljs-string">"none"</span>
    });
});
</code></pre>
<h2 data-id="heading-33">实际应用案例</h2>
<h3 data-id="heading-34">案例1：物联网系统架构图</h3>
<p>基于用户提供的示例，创建一个完整的物联网系统架构图：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建物联网系统架构图</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createIoTSystemDiagram</span>(<span class="hljs-params">containerId</span>) {
    <span class="hljs-keyword">var</span> svgPaper = ood.<span class="hljs-property">UI</span>.<span class="hljs-title class_">SVGPaper</span>({
        <span class="hljs-attr">width</span>: <span class="hljs-string">'800px'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'500px'</span>,
        <span class="hljs-attr">scaleChildren</span>: <span class="hljs-literal">false</span>
    }).<span class="hljs-title function_">appendTo</span>(containerId);
    
    <span class="hljs-comment">// 1. 云服务器</span>
    svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"cloudServer"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Process"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">200</span>,
                <span class="hljs-string">"width"</span>: <span class="hljs-number">120</span>,
                <span class="hljs-string">"height"</span>: <span class="hljs-number">80</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#4285F4-#8AB4F8"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#1A73E8"</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"云服务器"</span>,
                <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"14px"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>,
                <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
            }
        })
    );
    
    <span class="hljs-comment">// 2. 网关设备</span>
    svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.pathComb"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"gateway"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:DirectData"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#34A853-#81C995"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#1E8E3E"</span>,
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,250,200C,240,200,230,180,230,160C,230,140,240,120,250,120C,250,120,350,120,350,120C,358,120,360,140,360,160C,360,180,358,200,350,200C,350,200,250,200,250,200"</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"智能网关"</span>,
                <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"14px"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>,
                <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
            }
        })
    );
    
    <span class="hljs-comment">// 3. 传感器节点</span>
    svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.circleComb"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"sensor"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:OnPageRefrence"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"cx"</span>: <span class="hljs-number">550</span>,
                <span class="hljs-string">"cy"</span>: <span class="hljs-number">160</span>,
                <span class="hljs-string">"r"</span>: <span class="hljs-number">60</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"r-#FBBC05-#FDE293"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#F9AB00"</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"温湿度传感器"</span>,
                <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#333333"</span>,
                <span class="hljs-string">"font-weight"</span>: <span class="hljs-string">"bold"</span>
            }
        })
    );
    
    <span class="hljs-comment">// 4. 连接线</span>
    svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"conn1"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,170,240L,230,240"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#666666"</span>,
                <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>,
                <span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"classic-wide-long"</span>
            }
        })
        .<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"cloudServer"</span>)
        .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)
        .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"gateway"</span>)
        .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
    );
    
    svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"conn2"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,350,240L,490,240"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#666666"</span>,
                <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>,
                <span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"classic-wide-long"</span>
            }
        })
        .<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"gateway"</span>)
        .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)
        .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"sensor"</span>)
        .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
    );
    
    <span class="hljs-keyword">return</span> svgPaper;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">var</span> iotDiagram = <span class="hljs-title function_">createIoTSystemDiagram</span>(<span class="hljs-string">"#diagram-container"</span>);
</code></pre>
<h3 data-id="heading-35">案例2：业务流程管理图</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建订单处理流程图</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createOrderProcessDiagram</span>(<span class="hljs-params">containerId</span>) {
    <span class="hljs-keyword">var</span> svgPaper = ood.<span class="hljs-property">UI</span>.<span class="hljs-title class_">SVGPaper</span>({
        <span class="hljs-attr">width</span>: <span class="hljs-string">'1000px'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'600px'</span>
    }).<span class="hljs-title function_">appendTo</span>(containerId);
    
    <span class="hljs-keyword">var</span> shapes = [];
    
    <span class="hljs-comment">// 订单接收</span>
    shapes.<span class="hljs-title function_">push</span>(svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"orderReceive"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Process"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"width"</span>: <span class="hljs-number">150</span>,
                <span class="hljs-string">"height"</span>: <span class="hljs-number">60</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#2196F3-#64B5F6"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#1976D2"</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"订单接收"</span>,
                <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"14px"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>
            }
        })
    ));
    
    <span class="hljs-comment">// 库存检查（决策）</span>
    shapes.<span class="hljs-title function_">push</span>(svgPaper.<span class="hljs-title function_">append</span>(
        ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.pathComb"</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"inventoryCheck"</span>)
        .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Decision"</span>)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#FF9800-#FFB74D"</span>,
                <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#F57C00"</span>,
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,300,100L,400,160L,300,220L,200,160Z"</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"库存检查"</span>,
                <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
                <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>
            }
        })
    ));
    
    <span class="hljs-comment">// 更多流程节点...</span>
    
    <span class="hljs-comment">// 连接所有节点</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; shapes.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
        svgPaper.<span class="hljs-title function_">append</span>(
            ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
            .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
            .<span class="hljs-title function_">setAttr</span>({
                <span class="hljs-string">"KEY"</span>:{
                    <span class="hljs-string">"path"</span>: <span class="hljs-string">"M,"</span> + (shapes[i].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">x</span> + shapes[i].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">width</span>) + <span class="hljs-string">","</span> + (shapes[i].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">y</span> + shapes[i].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">height</span>/<span class="hljs-number">2</span>) + 
                           <span class="hljs-string">"L,"</span> + (shapes[i+<span class="hljs-number">1</span>].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">x</span>) + <span class="hljs-string">","</span> + (shapes[i+<span class="hljs-number">1</span>].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">y</span> + shapes[i+<span class="hljs-number">1</span>].<span class="hljs-title function_">getBBox</span>().<span class="hljs-property">height</span>/<span class="hljs-number">2</span>),
                    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
                    <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#666666"</span>,
                    <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"arrow-end"</span>: <span class="hljs-string">"classic-wide-long"</span>
                }
            })
            .<span class="hljs-title function_">setFromObj</span>(shapes[i].<span class="hljs-property">alias</span>)
            .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)
            .<span class="hljs-title function_">setToObj</span>(shapes[i+<span class="hljs-number">1</span>].<span class="hljs-property">alias</span>)
            .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
        );
    }
    
    <span class="hljs-keyword">return</span> svgPaper;
}
</code></pre>
<h3 data-id="heading-36">案例3：组织结构图</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建公司组织结构图</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createOrgChart</span>(<span class="hljs-params">containerId, orgData</span>) {
    <span class="hljs-keyword">var</span> svgPaper = ood.<span class="hljs-property">UI</span>.<span class="hljs-title class_">SVGPaper</span>({
        <span class="hljs-attr">width</span>: <span class="hljs-string">'1200px'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'800px'</span>
    }).<span class="hljs-title function_">appendTo</span>(containerId);
    
    <span class="hljs-comment">// 按层级布局节点</span>
    <span class="hljs-keyword">var</span> levelPositions = {};
    
    <span class="hljs-comment">// 遍历组织数据，创建节点</span>
    orgData.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">dept, index</span>) {
        <span class="hljs-keyword">var</span> level = dept.<span class="hljs-property">level</span> || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> position = levelPositions[level] || {<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> + level * <span class="hljs-number">150</span>};
        
        <span class="hljs-keyword">var</span> shape = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
            .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"dept_"</span> + dept.<span class="hljs-property">id</span>)
            .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Document"</span>)
            .<span class="hljs-title function_">setAttr</span>({
                <span class="hljs-string">"KEY"</span>:{
                    <span class="hljs-string">"x"</span>: position.<span class="hljs-property">x</span>,
                    <span class="hljs-string">"y"</span>: position.<span class="hljs-property">y</span>,
                    <span class="hljs-string">"width"</span>: <span class="hljs-number">180</span>,
                    <span class="hljs-string">"height"</span>: <span class="hljs-number">80</span>,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-title function_">getDeptColor</span>(dept.<span class="hljs-property">type</span>),
                    <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#333333"</span>,
                    <span class="hljs-string">"rx"</span>: <span class="hljs-number">8</span>,
                    <span class="hljs-string">"ry"</span>: <span class="hljs-number">8</span>
                },
                <span class="hljs-string">"TEXT"</span>:{
                    <span class="hljs-string">"text"</span>: dept.<span class="hljs-property">name</span> + <span class="hljs-string">"\n"</span> + (dept.<span class="hljs-property">manager</span> || <span class="hljs-string">""</span>),
                    <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>,
                    <span class="hljs-string">"text-anchor"</span>: <span class="hljs-string">"middle"</span>
                }
            });
            
        svgPaper.<span class="hljs-title function_">append</span>(shape);
        
        <span class="hljs-comment">// 更新位置</span>
        levelPositions[level] = {
            <span class="hljs-attr">x</span>: position.<span class="hljs-property">x</span> + <span class="hljs-number">220</span>,
            <span class="hljs-attr">y</span>: position.<span class="hljs-property">y</span>
        };
        
        <span class="hljs-comment">// 连接到上级部门</span>
        <span class="hljs-keyword">if</span> (dept.<span class="hljs-property">parentId</span>) {
            svgPaper.<span class="hljs-title function_">append</span>(
                ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
                .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
                .<span class="hljs-title function_">setAttr</span>({
                    <span class="hljs-string">"KEY"</span>:{
                        <span class="hljs-string">"path"</span>: <span class="hljs-title function_">calculateOrgPath</span>(dept.<span class="hljs-property">parentId</span>, dept.<span class="hljs-property">id</span>),
                        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"none"</span>,
                        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#999999"</span>,
                        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">2</span>
                    }
                })
                .<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"dept_"</span> + dept.<span class="hljs-property">parentId</span>)
                .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"bottom"</span>)
                .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"dept_"</span> + dept.<span class="hljs-property">id</span>)
                .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"top"</span>)
            );
        }
    });
    
    <span class="hljs-keyword">return</span> svgPaper;
}

<span class="hljs-comment">// 辅助函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDeptColor</span>(<span class="hljs-params">deptType</span>) {
    <span class="hljs-keyword">var</span> colors = {
        <span class="hljs-string">"executive"</span>: <span class="hljs-string">"90-#D32F2F-#F44336"</span>,
        <span class="hljs-string">"management"</span>: <span class="hljs-string">"90-#1976D2-#2196F3"</span>, 
        <span class="hljs-string">"technical"</span>: <span class="hljs-string">"90-#388E3C-#4CAF50"</span>,
        <span class="hljs-string">"support"</span>: <span class="hljs-string">"90-#F57C00-#FF9800"</span>
    };
    <span class="hljs-keyword">return</span> colors[deptType] || <span class="hljs-string">"90-#607D8B-#90A4AE"</span>;
}
</code></pre>
<h3 data-id="heading-37">原始示例代码深度分析</h3>
<p>以下是您提供的原始物联网系统流程图代码的详细分析，展示了A2UI中SVG的核心用法：</p>
<h4 data-id="heading-38">代码结构解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 创建SVG画布并添加到FormLayout中</span>
host.<span class="hljs-property">xui_ui_formlayout1</span>.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.UI.SVGPaper"</span>)
    .<span class="hljs-title function_">setHost</span>(host,<span class="hljs-string">"xui_ui_svgpaper7"</span>)
    .<span class="hljs-title function_">setLeft</span>(<span class="hljs-string">"0em"</span>)
    .<span class="hljs-title function_">setTop</span>(<span class="hljs-string">"0em"</span>)
    .<span class="hljs-title function_">setWidth</span>(<span class="hljs-string">"61.416666666666664em"</span>)
    .<span class="hljs-title function_">setHeight</span>(<span class="hljs-string">"9.333333333333334em"</span>),
    <span class="hljs-string">"A1"</span>
);
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li><code>ood.create("ood.UI.SVGPaper")</code>：创建SVGPaper组件实例</li>
<li><code>.setHost(host,"xui_ui_svgpaper7")</code>：设置宿主和唯一标识符</li>
<li><code>.setWidth()</code>/<code>.setHeight()</code>：使用em单位实现响应式设计</li>
<li><code>"A1"</code>：布局位置标识符</li>
</ul>
<h4 data-id="heading-39">2. 创建流程图节点</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 服务器节点（矩形）</span>
host.<span class="hljs-property">xui_ui_svgpaper7</span>.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
    .<span class="hljs-title function_">setHost</span>(host,<span class="hljs-string">"xui_svg_rectcomb1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Process"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"x"</span>:<span class="hljs-number">40</span>,
            <span class="hljs-string">"y"</span>:<span class="hljs-number">30</span>,
            <span class="hljs-string">"width"</span>:<span class="hljs-number">90</span>,
            <span class="hljs-string">"height"</span>:<span class="hljs-number">50</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
            <span class="hljs-string">"stroke"</span>:<span class="hljs-string">"#004A7F"</span>
        },
        <span class="hljs-string">"TEXT"</span>:{
            <span class="hljs-string">"text"</span>:<span class="hljs-string">"服务器"</span>,
            <span class="hljs-string">"font-size"</span>:<span class="hljs-string">"12px"</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"#fff"</span>,
            <span class="hljs-string">"font-weight"</span>:<span class="hljs-string">"bold"</span>
        }
    })
);
</code></pre>
<p><strong>技术细节：</strong></p>
<ul>
<li><code>ood.svg.rectComb</code>：矩形组合形状类</li>
<li><code>FlowChart:Process</code>：流程图处理节点类型</li>
<li>渐变填充：<code>"90-#5198D3-#A1C8F6"</code>（90°线性渐变）</li>
<li>文本配置：白色粗体，12px大小</li>
</ul>
<h4 data-id="heading-40">3. 创建网关节点（路径形状）</h4>
<pre><code class="hljs language-javascript" lang="javascript">host.<span class="hljs-property">xui_ui_svgpaper7</span>.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.pathComb"</span>)
    .<span class="hljs-title function_">setHost</span>(host,<span class="hljs-string">"xui_svg_pathcomb49"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:DirectData"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
            <span class="hljs-string">"stroke"</span>:<span class="hljs-string">"#004A7F"</span>,
            <span class="hljs-string">"path"</span>:<span class="hljs-string">"M,319,85C,310.7157314383532,85,304,71.56854048887718,304,55C,304,38.43145548427702,310.7157178477474,25,319,25M,319,85C,319,85,319,85,319,85C,310.7157314383532,85,304,71.56854048887718,304,55C,304,38.43145548427702,310.7157178477474,25,319,25M,319,25C,319,25,319,25,319,25C,327.2842655415122,25,334,38.43145548427702,334,55C,334,71.56854048887718,327.2842655415122,85,319,85C,319,85,259,85,259,85C,250.7157118074781,85,244,71.56854048887718,244,55C,244,38.43145548427702,250.7157118074781,25,259,25C,259,25,319,25,319,25"</span>
        },
        <span class="hljs-string">"TEXT"</span>:{
            <span class="hljs-string">"text"</span>:<span class="hljs-string">"网关"</span>,
            <span class="hljs-string">"font-size"</span>:<span class="hljs-string">"12px"</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"#fff"</span>,
            <span class="hljs-string">"font-weight"</span>:<span class="hljs-string">"bold"</span>
        }
    })
);
</code></pre>
<p><strong>路径语法解析：</strong></p>
<ul>
<li><code>M</code>：移动到起点 (319,85)</li>
<li><code>C</code>：三次贝塞尔曲线到目标点</li>
<li>控制点计算确保平滑过渡</li>
<li>复杂路径实现专业的流程图符号</li>
</ul>
<h4 data-id="heading-41">4. 传感器节点（圆形）</h4>
<pre><code class="hljs language-javascript" lang="javascript">host.<span class="hljs-property">xui_ui_svgpaper7</span>.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.circleComb"</span>)
    .<span class="hljs-title function_">setHost</span>(host,<span class="hljs-string">"xui_svg_circlecomb1"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:OnPageRefrence"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"cx"</span>:<span class="hljs-number">504</span>,
            <span class="hljs-string">"cy"</span>:<span class="hljs-number">55</span>,
            <span class="hljs-string">"r"</span>:<span class="hljs-number">40</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"90-#5198D3-#A1C8F6"</span>,
            <span class="hljs-string">"stroke"</span>:<span class="hljs-string">"#004A7F"</span>
        },
        <span class="hljs-string">"TEXT"</span>:{
            <span class="hljs-string">"text"</span>:<span class="hljs-string">"传感器"</span>,
            <span class="hljs-string">"font-size"</span>:<span class="hljs-string">"12px"</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"#fff"</span>,
            <span class="hljs-string">"font-weight"</span>:<span class="hljs-string">"bold"</span>
        }
    })
);
</code></pre>
<p><strong>圆形属性：</strong></p>
<ul>
<li><code>cx</code>, <code>cy</code>：圆心坐标，精确定位</li>
<li><code>r</code>：半径大小</li>
<li><code>FlowChart:OnPageRefrence</code>：页面引用类型</li>
</ul>
<h4 data-id="heading-42">5. 智能连接线系统</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 服务器 → 网关连接线</span>
host.<span class="hljs-property">xui_ui_svgpaper7</span>.<span class="hljs-title function_">append</span>(
    ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.connector"</span>)
    .<span class="hljs-title function_">setHost</span>(host,<span class="hljs-string">"xui_svg_connector19"</span>)
    .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"Connectors:Straight"</span>)
    .<span class="hljs-title function_">setAttr</span>({
        <span class="hljs-string">"KEY"</span>:{
            <span class="hljs-string">"path"</span>:<span class="hljs-string">"M,130,55L,244,55"</span>,
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"#B6E026"</span>,
            <span class="hljs-string">"stroke"</span>:<span class="hljs-string">"#228B22"</span>,
            <span class="hljs-string">"stroke-width"</span>:<span class="hljs-number">2</span>,
            <span class="hljs-string">"arrow-start"</span>:<span class="hljs-string">"oval-midium-midium"</span>,
            <span class="hljs-string">"arrow-end"</span>:<span class="hljs-string">"classic-wide-long"</span>
        },
        <span class="hljs-string">"BG"</span>:{
            <span class="hljs-string">"fill"</span>:<span class="hljs-string">"none"</span>,
            <span class="hljs-string">"stroke"</span>:<span class="hljs-string">"#fff"</span>,
            <span class="hljs-string">"stroke-width"</span>:<span class="hljs-number">4</span>
        }
    })
    .<span class="hljs-title function_">setFromObj</span>(<span class="hljs-string">"xui_svg_rectcomb1"</span>)
    .<span class="hljs-title function_">setFromPoint</span>(<span class="hljs-string">"right"</span>)
    .<span class="hljs-title function_">setToObj</span>(<span class="hljs-string">"xui_svg_pathcomb49"</span>)
    .<span class="hljs-title function_">setToPoint</span>(<span class="hljs-string">"left"</span>)
);
</code></pre>
<p><strong>连接线高级特性：</strong></p>
<ul>
<li>双箭头系统：起始箭头+结束箭头</li>
<li><code>BG</code>层：白色背景描边，增强可读性</li>
<li>自动路径计算：基于形状位置</li>
<li>智能连接点：<code>right</code> → <code>left</code> 自然流向</li>
</ul>
<h4 data-id="heading-43">设计模式总结</h4>
<ol>
<li>
<p><strong>分层架构</strong></p>
<ul>
<li>SVGPaper（画布层）</li>
<li>形状组合（图形层）</li>
<li>连接线系统（关系层）</li>
<li>文本标注（信息层）</li>
</ul>
</li>
<li>
<p><strong>样式系统</strong></p>
<ul>
<li>一致性：相同渐变和描边</li>
<li>可读性：对比色和适当大小</li>
<li>专业性：标准流程图符号</li>
</ul>
</li>
<li>
<p><strong>交互设计</strong></p>
<ul>
<li>逻辑连接：服务器→网关→传感器</li>
<li>视觉引导：箭头方向和路径</li>
<li>信息层次：标题和位置</li>
</ul>
</li>
</ol>
<h4 data-id="heading-44">扩展建议</h4>
<ol>
<li><strong>动态数据绑定</strong>：将节点数据与后端API连接</li>
<li><strong>交互增强</strong>：添加拖拽、缩放、选择功能</li>
<li><strong>主题系统</strong>：支持暗色/亮色主题切换</li>
<li><strong>导出功能</strong>：支持PNG、PDF、SVG格式导出</li>
</ol>
<p>这个示例展示了A2UI SVG系统的强大功能，从基础形状创建到复杂的流程图构建，为各种数据可视化和图表应用提供了完整的解决方案。</p>
<h2 data-id="heading-45">API 参考</h2>
<h3 data-id="heading-46">SVGPaper 类</h3>
<h4 data-id="heading-47">构造函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> ood.<span class="hljs-property">UI</span>.<span class="hljs-title class_">SVGPaper</span>(config)
</code></pre>
<h4 data-id="heading-48">配置选项</h4>









































<table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td><code>width</code></td><td>String/Object</td><td><code>'32em'</code></td><td>画布宽度</td></tr><tr><td><code>height</code></td><td>String/Object</td><td><code>'25em'</code></td><td>画布高度</td></tr><tr><td><code>scaleChildren</code></td><td>Boolean</td><td><code>false</code></td><td>是否缩放子元素</td></tr><tr><td><code>overflow</code></td><td>String</td><td><code>undefined</code></td><td>溢出处理</td></tr><tr><td><code>graphicZIndex</code></td><td>Number</td><td><code>0</code></td><td>图形层级</td></tr></tbody></table>
<h4 data-id="heading-49">实例方法</h4>
<h5 data-id="heading-50"><code>append(shape)</code></h5>
<p>添加SVG形状到画布。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>shape</code> (Object): SVG形状对象</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): SVGPaper实例</li>
</ul>
<h5 data-id="heading-51"><code>removeChildren()</code></h5>
<p>移除所有子元素。</p>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): SVGPaper实例</li>
</ul>
<h5 data-id="heading-52"><code>getPaper()</code></h5>
<p>获取底层的Raphaël paper对象。</p>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): Raphaël paper实例</li>
</ul>
<h5 data-id="heading-53"><code>getSVGString()</code></h5>
<p>获取SVG内容的字符串表示。</p>
<p><strong>返回：</strong></p>
<ul>
<li>(String): SVG字符串</li>
</ul>
<h5 data-id="heading-54"><code>setChildren(shapes)</code></h5>
<p>替换所有子元素。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>shapes</code> (Array): 形状对象数组</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): SVGPaper实例</li>
</ul>
<h3 data-id="heading-55">形状创建 API</h3>
<h4 data-id="heading-56"><code>ood.create(type)</code></h4>
<p>创建指定类型的SVG形状。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>type</code> (String): 形状类型标识符</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 形状实例</li>
</ul>
<h4 data-id="heading-57">常用形状类型</h4>
<ul>
<li><code>"ood.svg.circle"</code>：圆形</li>
<li><code>"ood.svg.rect"</code>：矩形</li>
<li><code>"ood.svg.rectComb"</code>：矩形组合</li>
<li><code>"ood.svg.pathComb"</code>：路径组合</li>
<li><code>"ood.svg.circleComb"</code>：圆形组合</li>
<li><code>"ood.svg.connector"</code>：连接线</li>
</ul>
<h3 data-id="heading-58">形状配置方法</h3>
<h4 data-id="heading-59"><code>setHost(host, alias)</code></h4>
<p>设置宿主和别名。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>host</code> (Object): 宿主对象</li>
<li><code>alias</code> (String): 形状别名</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 形状实例</li>
</ul>
<h4 data-id="heading-60"><code>setSvgTag(tag)</code></h4>
<p>设置SVG标签类型。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>tag</code> (String): SVG标签标识符</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 形状实例</li>
</ul>
<h4 data-id="heading-61"><code>setAttr(attributes)</code></h4>
<p>设置形状属性。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>attributes</code> (Object): 属性对象</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 形状实例</li>
</ul>
<h3 data-id="heading-62">连接线配置方法</h3>
<h4 data-id="heading-63"><code>setFromObj(objAlias)</code></h4>
<p>设置起始形状。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>objAlias</code> (String): 起始形状别名</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 连接线实例</li>
</ul>
<h4 data-id="heading-64"><code>setFromPoint(point)</code></h4>
<p>设置起始连接点。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>point</code> (String): 连接点位置（left/right/top/bottom）</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 连接线实例</li>
</ul>
<h4 data-id="heading-65"><code>setToObj(objAlias)</code></h4>
<p>设置目标形状。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>objAlias</code> (String): 目标形状别名</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 连接线实例</li>
</ul>
<h4 data-id="heading-66"><code>setToPoint(point)</code></h4>
<p>设置目标连接点。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>point</code> (String): 连接点位置（left/right/top/bottom）</li>
</ul>
<p><strong>返回：</strong></p>
<ul>
<li>(Object): 连接线实例</li>
</ul>
<h2 data-id="heading-67">最佳实践</h2>
<h3 data-id="heading-68">1. 性能优化</h3>
<p><strong>批量操作：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐：单独添加每个形状</span>
shapes.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">shape</span>) {
    svgPaper.<span class="hljs-title function_">append</span>(shape);
});

<span class="hljs-comment">// 推荐：批量添加</span>
svgPaper.<span class="hljs-title function_">setChildren</span>(shapes);
</code></pre>
<p><strong>图形复用：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建模板形状</span>
<span class="hljs-keyword">var</span> templateShape = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
    .<span class="hljs-title function_">setAttr</span>({ <span class="hljs-comment">/* 基础配置 */</span> });

<span class="hljs-comment">// 批量创建相似形状</span>
<span class="hljs-keyword">var</span> shapes = data.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) {
    <span class="hljs-keyword">return</span> templateShape.<span class="hljs-title function_">clone</span>()
        .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"shape_"</span> + index)
        .<span class="hljs-title function_">setAttr</span>({
            <span class="hljs-string">"KEY"</span>:{
                <span class="hljs-string">"x"</span>: index * <span class="hljs-number">120</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">100</span>
            },
            <span class="hljs-string">"TEXT"</span>:{
                <span class="hljs-string">"text"</span>: item.<span class="hljs-property">name</span>
            }
        });
});
</code></pre>
<h3 data-id="heading-69">2. 可维护性</h3>
<p><strong>模块化设计：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 形状工厂</span>
<span class="hljs-keyword">var</span> <span class="hljs-title class_">ShapeFactory</span> = {
    <span class="hljs-attr">createServerNode</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">x, y, name</span>) {
        <span class="hljs-keyword">return</span> ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
            .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Process"</span>)
            .<span class="hljs-title function_">setAttr</span>({
                <span class="hljs-string">"KEY"</span>:{
                    <span class="hljs-string">"x"</span>: x,
                    <span class="hljs-string">"y"</span>: y,
                    <span class="hljs-string">"width"</span>: <span class="hljs-number">120</span>,
                    <span class="hljs-string">"height"</span>: <span class="hljs-number">60</span>,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"90-#4285F4-#8AB4F8"</span>
                },
                <span class="hljs-string">"TEXT"</span>:{
                    <span class="hljs-string">"text"</span>: name,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFFFFF"</span>
                }
            });
    },
    
    <span class="hljs-attr">createDecisionNode</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">x, y, name</span>) {
        <span class="hljs-keyword">return</span> ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.pathComb"</span>)
            .<span class="hljs-title function_">setSvgTag</span>(<span class="hljs-string">"FlowChart:Decision"</span>)
            .<span class="hljs-title function_">setAttr</span>({ <span class="hljs-comment">/* 配置 */</span> });
    }
};
</code></pre>
<p><strong>配置集中管理：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 样式配置</span>
<span class="hljs-keyword">var</span> <span class="hljs-title class_">StyleConfig</span> = {
    <span class="hljs-attr">colors</span>: {
        <span class="hljs-attr">primary</span>: <span class="hljs-string">"90-#4285F4-#8AB4F8"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-string">"90-#34A853-#81C995"</span>,
        <span class="hljs-attr">warning</span>: <span class="hljs-string">"90-#FBBC05-#FDE293"</span>,
        <span class="hljs-attr">danger</span>: <span class="hljs-string">"90-#EA4335-#F28B82"</span>
    },
    
    <span class="hljs-attr">sizes</span>: {
        <span class="hljs-attr">node</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">120</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">60</span> },
        <span class="hljs-attr">text</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-string">"14px"</span> }
    }
};
</code></pre>
<h3 data-id="heading-70">3. 响应式设计</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 响应式布局调整</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">adjustDiagramLayout</span>(<span class="hljs-params">svgPaper, viewportWidth</span>) {
    <span class="hljs-keyword">var</span> scale = <span class="hljs-number">1</span>;
    
    <span class="hljs-keyword">if</span> (viewportWidth &lt; <span class="hljs-number">768</span>) {
        scale = <span class="hljs-number">0.8</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (viewportWidth &lt; <span class="hljs-number">480</span>) {
        scale = <span class="hljs-number">0.6</span>;
    }
    
    <span class="hljs-comment">// 缩放所有形状</span>
    svgPaper.<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">shape</span>) {
        shape.<span class="hljs-title function_">attr</span>({
            <span class="hljs-string">"transform"</span>: <span class="hljs-string">"scale("</span> + scale + <span class="hljs-string">")"</span>
        });
    });
}

<span class="hljs-comment">// 监听窗口大小变化</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">adjustDiagramLayout</span>(svgPaper, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);
});
</code></pre>
<h3 data-id="heading-71">4. 可访问性</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 增强可访问性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">enhanceAccessibility</span>(<span class="hljs-params">svgPaper</span>) {
    svgPaper.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"img"</span>,
        <span class="hljs-string">"aria-label"</span>: <span class="hljs-string">"系统架构图"</span>
    });
    
    <span class="hljs-comment">// 为每个形状添加描述</span>
    svgPaper.<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">shape</span>) {
        <span class="hljs-keyword">var</span> text = shape.<span class="hljs-title function_">getAttr</span>(<span class="hljs-string">"TEXT"</span>)?.<span class="hljs-property">text</span> || <span class="hljs-string">"图形元素"</span>;
        shape.<span class="hljs-title function_">attr</span>({
            <span class="hljs-string">"aria-label"</span>: text,
            <span class="hljs-string">"tabindex"</span>: <span class="hljs-string">"0"</span>  <span class="hljs-comment">// 支持键盘导航</span>
        });
    });
}
</code></pre>
<h3 data-id="heading-72">5. 事件处理最佳实践</h3>
<h4 data-id="heading-73">事件委托模式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 为整个画布添加事件委托，而不是为每个形状单独绑定</span>
svgPaper.<span class="hljs-title function_">on</span>(<span class="hljs-string">"click"</span>, <span class="hljs-string">".node-shape"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">var</span> shape = event.<span class="hljs-property">target</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"节点被点击:"</span>, shape.<span class="hljs-property">alias</span>);
    
    <span class="hljs-comment">// 高亮显示被点击的节点</span>
    shape.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#FF5722"</span>,
        <span class="hljs-string">"stroke-width"</span>: <span class="hljs-number">3</span>
    });
});

<span class="hljs-comment">// 添加鼠标悬停效果</span>
svgPaper.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseover"</span>, <span class="hljs-string">".node-shape"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    event.<span class="hljs-property">target</span>.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"cursor"</span>: <span class="hljs-string">"pointer"</span>,
        <span class="hljs-string">"filter"</span>: <span class="hljs-string">"url(#hover-shadow)"</span>
    });
});

svgPaper.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseout"</span>, <span class="hljs-string">".node-shape"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    event.<span class="hljs-property">target</span>.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"filter"</span>: <span class="hljs-string">"none"</span>
    });
});
</code></pre>
<h4 data-id="heading-74">自定义事件系统</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建自定义事件触发器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createInteractiveShape</span>(<span class="hljs-params">svgPaper, config</span>) {
    <span class="hljs-keyword">var</span> shape = ood.<span class="hljs-title function_">create</span>(config.<span class="hljs-property">type</span>)
        .<span class="hljs-title function_">setHost</span>(svgPaper, config.<span class="hljs-property">alias</span>)
        .<span class="hljs-title function_">setAttr</span>(config.<span class="hljs-property">attr</span>);
    
    <span class="hljs-comment">// 添加自定义事件</span>
    shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"custom:select"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attr</span>({
            <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FFEB3B"</span>,
            <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#FF9800"</span>
        });
    });
    
    shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"custom:deselect"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attr</span>({
            <span class="hljs-string">"fill"</span>: config.<span class="hljs-property">attr</span>.<span class="hljs-property">KEY</span>.<span class="hljs-property">fill</span>,
            <span class="hljs-string">"stroke"</span>: config.<span class="hljs-property">attr</span>.<span class="hljs-property">KEY</span>.<span class="hljs-property">stroke</span>
        });
    });
    
    <span class="hljs-keyword">return</span> shape;
}
</code></pre>
<h3 data-id="heading-75">6. 动画效果应用</h3>
<h4 data-id="heading-76">平滑过渡动画</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建形状移动动画</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animateShapeMove</span>(<span class="hljs-params">shape, targetX, targetY, duration</span>) {
    <span class="hljs-keyword">var</span> currentX = shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"x"</span>) || shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"cx"</span>);
    <span class="hljs-keyword">var</span> currentY = shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"y"</span>) || shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"cy"</span>);
    
    shape.<span class="hljs-title function_">animate</span>({
        <span class="hljs-string">"x"</span>: targetX,
        <span class="hljs-string">"y"</span>: targetY
    }, duration, <span class="hljs-string">"linear"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"动画完成"</span>);
    });
}

<span class="hljs-comment">// 创建连接线流动效果</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createFlowAnimation</span>(<span class="hljs-params">connector</span>) {
    <span class="hljs-keyword">var</span> path = connector.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"path"</span>);
    <span class="hljs-keyword">var</span> length = connector.<span class="hljs-title function_">getTotalLength</span>();
    
    <span class="hljs-comment">// 创建虚线流动效果</span>
    connector.<span class="hljs-title function_">attr</span>({
        <span class="hljs-string">"stroke-dasharray"</span>: <span class="hljs-string">"10,5"</span>,
        <span class="hljs-string">"stroke-dashoffset"</span>: length
    });
    
    connector.<span class="hljs-title function_">animate</span>({
        <span class="hljs-string">"stroke-dashoffset"</span>: <span class="hljs-number">0</span>
    }, <span class="hljs-number">2000</span>, <span class="hljs-string">"linear"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 循环动画</span>
        connector.<span class="hljs-title function_">attr</span>({
            <span class="hljs-string">"stroke-dashoffset"</span>: length
        });
        <span class="hljs-title function_">createFlowAnimation</span>(connector);
    });
}
</code></pre>
<h4 data-id="heading-77">交互反馈动画</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 点击脉冲效果</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createPulseEffect</span>(<span class="hljs-params">shape</span>) {
    shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> originalStroke = shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"stroke-width"</span>);
        
        <span class="hljs-comment">// 脉冲动画</span>
        shape.<span class="hljs-title function_">animate</span>({
            <span class="hljs-string">"stroke-width"</span>: originalStroke * <span class="hljs-number">3</span>
        }, <span class="hljs-number">200</span>, <span class="hljs-string">"&gt;"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            shape.<span class="hljs-title function_">animate</span>({
                <span class="hljs-string">"stroke-width"</span>: originalStroke
            }, <span class="hljs-number">300</span>);
        });
    });
}

<span class="hljs-comment">// 悬停缩放效果</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createHoverScale</span>(<span class="hljs-params">shape</span>) {
    shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseover"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        shape.<span class="hljs-title function_">animate</span>({
            <span class="hljs-string">"transform"</span>: <span class="hljs-string">"s1.1"</span>
        }, <span class="hljs-number">200</span>);
    });
    
    shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"mouseout"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        shape.<span class="hljs-title function_">animate</span>({
            <span class="hljs-string">"transform"</span>: <span class="hljs-string">"s1"</span>
        }, <span class="hljs-number">200</span>);
    });
}
</code></pre>
<h3 data-id="heading-78">7. 与其他A2UI组件集成</h3>
<h4 data-id="heading-79">与MDialog集成创建图形编辑器</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createSVGEditorDialog</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> dialog = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.UI.MDialog"</span>)
        .<span class="hljs-title function_">setTitle</span>(<span class="hljs-string">"SVG 图形编辑器"</span>)
        .<span class="hljs-title function_">setWidth</span>(<span class="hljs-string">"800px"</span>)
        .<span class="hljs-title function_">setHeight</span>(<span class="hljs-string">"600px"</span>);
    
    <span class="hljs-comment">// 在对话框中添加SVGPaper</span>
    <span class="hljs-keyword">var</span> svgPaper = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.UI.SVGPaper"</span>)
        .<span class="hljs-title function_">setWidth</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">setHeight</span>(<span class="hljs-string">"100%"</span>);
    
    dialog.<span class="hljs-title function_">append</span>(svgPaper);
    
    <span class="hljs-comment">// 添加工具栏</span>
    <span class="hljs-keyword">var</span> toolbar = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.UI.ToolBar"</span>)
        .<span class="hljs-title function_">addButton</span>(<span class="hljs-string">"矩形"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 创建矩形形状</span>
            svgPaper.<span class="hljs-title function_">append</span>(<span class="hljs-title function_">createRectShape</span>());
        })
        .<span class="hljs-title function_">addButton</span>(<span class="hljs-string">"圆形"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 创建圆形形状</span>
            svgPaper.<span class="hljs-title function_">append</span>(<span class="hljs-title function_">createCircleShape</span>());
        });
    
    dialog.<span class="hljs-title function_">append</span>(toolbar);
    
    <span class="hljs-keyword">return</span> dialog;
}
</code></pre>
<h4 data-id="heading-80">与MFormLayout集成创建属性编辑器</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createShapePropertyEditor</span>(<span class="hljs-params">shape</span>) {
    <span class="hljs-keyword">var</span> form = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.UI.MFormLayout"</span>)
        .<span class="hljs-title function_">setLabelWidth</span>(<span class="hljs-string">"100px"</span>);
    
    <span class="hljs-comment">// 添加形状属性编辑控件</span>
    form.<span class="hljs-title function_">addItem</span>(<span class="hljs-string">"x"</span>, <span class="hljs-string">"位置X"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"textbox"</span>,
        <span class="hljs-attr">value</span>: shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"x"</span>) || shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"cx"</span>),
        <span class="hljs-attr">onValueChange</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"x"</span>, <span class="hljs-built_in">parseInt</span>(value));
        }
    });
    
    form.<span class="hljs-title function_">addItem</span>(<span class="hljs-string">"y"</span>, <span class="hljs-string">"位置Y"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"textbox"</span>,
        <span class="hljs-attr">value</span>: shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"y"</span>) || shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"cy"</span>),
        <span class="hljs-attr">onValueChange</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"y"</span>, <span class="hljs-built_in">parseInt</span>(value));
        }
    });
    
    form.<span class="hljs-title function_">addItem</span>(<span class="hljs-string">"fill"</span>, <span class="hljs-string">"填充颜色"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"colorpicker"</span>,
        <span class="hljs-attr">value</span>: shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"fill"</span>),
        <span class="hljs-attr">onValueChange</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            shape.<span class="hljs-title function_">attr</span>(<span class="hljs-string">"fill"</span>, value);
        }
    });
    
    <span class="hljs-keyword">return</span> form;
}
</code></pre>
<h3 data-id="heading-81">8. 数据可视化最佳实践</h3>
<h4 data-id="heading-82">数据绑定模式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createDataVisualization</span>(<span class="hljs-params">svgPaper, data</span>) {
    <span class="hljs-keyword">var</span> maxValue = <span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">value</span>));
    <span class="hljs-keyword">var</span> barWidth = <span class="hljs-number">40</span>;
    <span class="hljs-keyword">var</span> spacing = <span class="hljs-number">20</span>;
    
    data.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) {
        <span class="hljs-keyword">var</span> barHeight = (item.<span class="hljs-property">value</span> / maxValue) * <span class="hljs-number">300</span>;
        <span class="hljs-keyword">var</span> x = index * (barWidth + spacing) + <span class="hljs-number">50</span>;
        <span class="hljs-keyword">var</span> y = <span class="hljs-number">350</span> - barHeight;
        
        <span class="hljs-comment">// 创建数据柱状图</span>
        <span class="hljs-keyword">var</span> bar = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.rectComb"</span>)
            .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"bar_"</span> + index)
            .<span class="hljs-title function_">setAttr</span>({
                <span class="hljs-string">"KEY"</span>:{
                    <span class="hljs-string">"x"</span>: x,
                    <span class="hljs-string">"y"</span>: y,
                    <span class="hljs-string">"width"</span>: barWidth,
                    <span class="hljs-string">"height"</span>: barHeight,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-title function_">getColorByValue</span>(item.<span class="hljs-property">value</span>)
                },
                <span class="hljs-string">"TEXT"</span>:{
                    <span class="hljs-string">"text"</span>: item.<span class="hljs-property">label</span>,
                    <span class="hljs-string">"x"</span>: x + barWidth/<span class="hljs-number">2</span>,
                    <span class="hljs-string">"y"</span>: <span class="hljs-number">370</span>,
                    <span class="hljs-string">"text-anchor"</span>: <span class="hljs-string">"middle"</span>,
                    <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"12px"</span>
                }
            });
        
        <span class="hljs-comment">// 添加数值标签</span>
        <span class="hljs-keyword">var</span> valueText = ood.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ood.svg.text"</span>)
            .<span class="hljs-title function_">setHost</span>(svgPaper, <span class="hljs-string">"value_"</span> + index)
            .<span class="hljs-title function_">setAttr</span>({
                <span class="hljs-string">"KEY"</span>:{
                    <span class="hljs-string">"x"</span>: x + barWidth/<span class="hljs-number">2</span>,
                    <span class="hljs-string">"y"</span>: y - <span class="hljs-number">10</span>,
                    <span class="hljs-string">"text"</span>: item.<span class="hljs-property">value</span>,
                    <span class="hljs-string">"text-anchor"</span>: <span class="hljs-string">"middle"</span>,
                    <span class="hljs-string">"font-size"</span>: <span class="hljs-string">"11px"</span>,
                    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#333"</span>
                }
            });
        
        svgPaper.<span class="hljs-title function_">append</span>(bar);
        svgPaper.<span class="hljs-title function_">append</span>(valueText);
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getColorByValue</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">80</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"90-#FF5252-#FF8A80"</span>;
    <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"90-#FF9800-#FFCC80"</span>;
    <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">40</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"90-#4CAF50-#A5D6A7"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"90-#2196F3-#90CAF9"</span>;
}
</code></pre>
<h4 data-id="heading-83">实时数据更新</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 实时更新数据可视化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateDataVisualization</span>(<span class="hljs-params">svgPaper, newData</span>) {
    <span class="hljs-comment">// 平滑过渡更新</span>
    newData.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item, index</span>) {
        <span class="hljs-keyword">var</span> bar = svgPaper.<span class="hljs-title function_">getChild</span>(<span class="hljs-string">"bar_"</span> + index);
        <span class="hljs-keyword">if</span> (bar) {
            <span class="hljs-comment">// 计算新的柱状图高度</span>
            <span class="hljs-keyword">var</span> maxValue = <span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, newData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">value</span>));
            <span class="hljs-keyword">var</span> barHeight = (item.<span class="hljs-property">value</span> / maxValue) * <span class="hljs-number">300</span>;
            <span class="hljs-keyword">var</span> y = <span class="hljs-number">350</span> - barHeight;
            
            <span class="hljs-comment">// 动画更新</span>
            bar.<span class="hljs-title function_">animate</span>({
                <span class="hljs-string">"height"</span>: barHeight,
                <span class="hljs-string">"y"</span>: y
            }, <span class="hljs-number">500</span>);
            
            <span class="hljs-comment">// 更新数值标签</span>
            <span class="hljs-keyword">var</span> valueText = svgPaper.<span class="hljs-title function_">getChild</span>(<span class="hljs-string">"value_"</span> + index);
            <span class="hljs-keyword">if</span> (valueText) {
                valueText.<span class="hljs-title function_">animate</span>({
                    <span class="hljs-string">"y"</span>: y - <span class="hljs-number">10</span>
                }, <span class="hljs-number">500</span>);
                
                valueText.<span class="hljs-title function_">attr</span>({
                    <span class="hljs-string">"text"</span>: item.<span class="hljs-property">value</span>
                });
            }
        }
    });
}
</code></pre>
<h2 data-id="heading-84">常见问题</h2>
<h3 data-id="heading-85">1. 图形不显示</h3>
<p><strong>可能原因：</strong></p>
<ul>
<li>画布尺寸未正确设置</li>
<li>形状坐标超出画布范围</li>
<li>样式配置错误</li>
</ul>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 检查画布配置</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'画布尺寸:'</span>, svgPaper.<span class="hljs-title function_">width</span>(), svgPaper.<span class="hljs-title function_">height</span>());

<span class="hljs-comment">// 检查形状坐标</span>
shape.<span class="hljs-title function_">attr</span>({
    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FF0000"</span>,  <span class="hljs-comment">// 使用简单颜色测试</span>
    <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#000000"</span>
});
</code></pre>
<h3 data-id="heading-86">2. 连接线不连接</h3>
<p><strong>可能原因：</strong></p>
<ul>
<li>形状别名不正确</li>
<li>连接点位置无效</li>
<li>路径计算错误</li>
</ul>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 验证形状别名</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'起始形状别名:'</span>, connector.<span class="hljs-property">properties</span>.<span class="hljs-property">fromObj</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'目标形状别名:'</span>, connector.<span class="hljs-property">properties</span>.<span class="hljs-property">toObj</span>);

<span class="hljs-comment">// 检查连接点</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接点位置:'</span>, {
    <span class="hljs-attr">from</span>: connector.<span class="hljs-property">properties</span>.<span class="hljs-property">fromPoint</span>,
    <span class="hljs-attr">to</span>: connector.<span class="hljs-property">properties</span>.<span class="hljs-property">toPoint</span>
});
</code></pre>
<h3 data-id="heading-87">3. 渐变效果不显示</h3>
<p><strong>可能原因：</strong></p>
<ul>
<li>渐变格式不正确</li>
<li>浏览器不支持</li>
<li>颜色值格式错误</li>
</ul>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用标准颜色测试</span>
shape.<span class="hljs-title function_">attr</span>({
    <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#FF0000"</span>  <span class="hljs-comment">// 替换渐变测试</span>
});

<span class="hljs-comment">// 检查渐变格式</span>
<span class="hljs-keyword">var</span> gradient = <span class="hljs-string">"90-#FF0000-#0000FF"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'渐变格式:'</span>, gradient.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>));
</code></pre>
<h3 data-id="heading-88">4. 交互事件不触发</h3>
<p><strong>可能原因：</strong></p>
<ul>
<li>事件绑定时机不对</li>
<li>事件名不正确</li>
<li>形状层级问题</li>
</ul>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 确保在形状渲染后绑定事件</span>
shape.<span class="hljs-title function_">on</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'形状被点击'</span>);
});

<span class="hljs-comment">// 检查事件系统</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'形状事件监听器:'</span>, shape.<span class="hljs-property">_events</span>);
</code></pre>
<h2 data-id="heading-89">总结</h2>
<p>SVGPaper 是 A2UI 框架中强大的矢量图形组件，为创建复杂的图表、流程图和数据可视化提供了完整的解决方案。通过本专辑的学习，您应该能够：</p>
<ol>
<li><strong>掌握 SVGPaper 的核心功能</strong>：创建画布、添加形状、配置样式</li>
<li><strong>了解 SVG 形状类型</strong>：基础形状、流程图专用形状、组合形状</li>
<li><strong>熟练使用连接线系统</strong>：直线、曲线、流程图连接线</li>
<li><strong>应用高级样式</strong>：渐变填充、阴影效果、交互样式</li>
<li><strong>构建实际应用</strong>：系统架构图、业务流程、组织结构图</li>
</ol>
<h3 data-id="heading-90">下一步建议</h3>
<ol>
<li><strong>实践练习</strong>：根据本专辑的示例，创建自己的SVG图表</li>
<li><strong>探索高级特性</strong>：深入研究Raphaël SVG库的高级功能</li>
<li><strong>集成数据绑定</strong>：将SVG图形与动态数据结合</li>
<li><strong>性能优化</strong>：对于大规模图形，实施虚拟化和懒加载</li>
<li><strong>主题系统</strong>：创建可切换的主题样式</li>
</ol>
<h3 data-id="heading-91">相关资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=.%2Fcomponents%2FSVGPaper.md" target="_blank" title="./components/SVGPaper.md" ref="nofollow noopener noreferrer">SVGPaper 组件文档</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fdmitrybaranovskiy.github.io%2Fraphael%2F" target="_blank" title="http://dmitrybaranovskiy.github.io/raphael/" ref="nofollow noopener noreferrer">Raphaël SVG 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2FSVG%2F" target="_blank" title="https://www.w3.org/TR/SVG/" ref="nofollow noopener noreferrer">SVG 标准规范</a></li>
<li><a href="https://link.juejin.cn?target=.%2Fcomponents-overview.md" target="_blank" title="./components-overview.md" ref="nofollow noopener noreferrer">A2UI 组件库概述</a></li>
</ul>
<hr/>
<p><em>本专辑基于 A2UI 框架和实际应用案例编写，内容将持续更新和完善。如有任何问题或建议，欢迎提交反馈。</em></p>
<p><em>© 2025 A2UI 项目组 | MIT License</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打造智能财务分析Agent：Claude Agent SDK完整实战案例]]></title>    <link>https://juejin.cn/post/7591708519448920073</link>    <guid>https://juejin.cn/post/7591708519448920073</guid>    <pubDate>2026-01-05T13:03:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591708519448920073" data-draft-id="7591705084671115302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打造智能财务分析Agent：Claude Agent SDK完整实战案例"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-05T13:03:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打造智能财务分析Agent：Claude Agent SDK完整实战案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T13:03:48.000Z" title="Mon Jan 05 2026 13:03:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、项目背景与需求分析</h2>
<p>在数字化转型浪潮中，企业财务部门每天需要处理海量的交易数据、财务报表和市场信息。传统的人工分析方式不仅效率低下，而且容易出错。某中型企业希望构建一个智能财务分析Agent，能够自动完成以下工作流：</p>
<ol>
<li>每日从多个数据源（银行账户、ERP系统、市场API）收集财务数据</li>
<li>对数据进行清洗、分类和异常检测</li>
<li>生成符合会计准则的分析报告</li>
<li>识别潜在的风险和优化机会</li>
<li>将结果同步到Slack和Email系统</li>
</ol>
<p>这个案例完美体现了Claude Agent SDK的核心理念——<strong>给Claude一台电脑，让它像人类分析师一样工作</strong>。Agent需要访问文件系统运行分析脚本、调用外部API获取数据、生成代码进行复杂计算，并通过验证机制确保结果准确性。</p>
<h2 data-id="heading-1">二、环境准备与SDK初始化</h2>
<h3 data-id="heading-2">2.1 环境配置</h3>
<p>首先创建项目结构，体现"文件系统即上下文"的设计理念：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> finance-agent &amp;&amp; <span class="hljs-built_in">cd</span> finance-agent
<span class="hljs-built_in">mkdir</span> -p {data/raw,data/processed,reports,scripts,config}
<span class="hljs-built_in">mkdir</span> -p {data/raw/{bank_statements,erp_exports,market_data}}
</code></pre>
<p>安装Claude Agent SDK和依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm install @anthropic-ai/claude-agent-sdk
pip install pandas numpy matplotlib yfinance
</code></pre>
<p>创建配置文件<code>config/agent.yaml</code>，定义Agent的身份和目标：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">agent:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"FinanceAnalyzer"</span>
  <span class="hljs-attr">role:</span> <span class="hljs-string">"Senior Financial Analyst"</span>
  <span class="hljs-attr">goal:</span> <span class="hljs-string">"Automate financial data analysis and reporting"</span>
  <span class="hljs-attr">tools:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">file_system</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">bash</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">code_execution</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mcp_slack</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mcp_gmail</span>
    
<span class="hljs-attr">context:</span>
  <span class="hljs-attr">folders:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">"./data"</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">"All financial data storage"</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">"./reports"</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">"Generated analysis reports"</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">path:</span> <span class="hljs-string">"./scripts"</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">"Analysis scripts and utilities"</span>
</code></pre>
<h3 data-id="heading-3">2.2 Agent核心骨架</h3>
<p>创建主Agent文件<code>src/financeAgent.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ClaudeAgent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@anthropic-ai/claude-agent-sdk'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FinanceAgent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">configPath</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">agent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClaudeAgent</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>,
      <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">`You are FinanceAnalyzer, a senior financial analyst. 
      Your working directory is /finance-agent. 
      Always verify your work using linting and validation tools.
      Follow the loop: gather context → analyze → verify → report.`</span>,
      <span class="hljs-attr">tools</span>: [
        <span class="hljs-string">"file_system"</span>,
        <span class="hljs-string">"bash"</span>,
        <span class="hljs-string">"code_execution"</span>,
        <span class="hljs-string">"mcp_slack"</span>,
        <span class="hljs-string">"mcp_gmail"</span>
      ],
      <span class="hljs-attr">contextManagement</span>: {
        <span class="hljs-attr">compaction</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">maxTokens</span>: <span class="hljs-number">180000</span>
      }
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">task</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📊 Starting task: <span class="hljs-subst">${task}</span>`</span>);
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">agent</span>.<span class="hljs-title function_">execute</span>(task);
    <span class="hljs-keyword">return</span> result;
  }
}
</code></pre>
<h2 data-id="heading-4">三、核心功能模块实现</h2>
<h3 data-id="heading-5">3.1 数据收集模块：智能上下文收集</h3>
<p>财务Agent的首要任务是<strong>gather context</strong>。我们让Agent自动发现和处理数据文件，而不是硬编码数据路径。</p>
<p>创建数据收集脚本<code>scripts/dataCollector.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 让Agent使用bash工具发现数据文件</span>
<span class="hljs-keyword">const</span> dataCollectionTask = <span class="hljs-string">`
Task: Collect and inventory all financial data from today.

Steps:
1. Use bash to find all new files in data/raw/ modified today
2. For each file, identify its type (CSV, PDF, JSON) and source
3. Create an inventory file data/processed/today_inventory.json
4. For PDF bank statements, use pdftotext to convert to searchable format
5. Report what data sources are available
`</span>;

<span class="hljs-keyword">const</span> inventory = <span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(dataCollectionTask);
</code></pre>
<p>Agent执行过程示例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Agent自动生成的bash命令</span>
find data/raw/ -<span class="hljs-built_in">type</span> f -mtime 0 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">ls</span> -la {} \;
<span class="hljs-comment"># 发现文件：</span>
<span class="hljs-comment"># - data/raw/bank_statements/chase_20241115.pdf</span>
<span class="hljs-comment"># - data/raw/erp_exports/sales_20241115.csv</span>
<span class="hljs-comment"># - data/raw/market_data/sp500_20241115.json</span>

<span class="hljs-comment"># Agent处理PDF</span>
pdftotext data/raw/bank_statements/chase_20241115.pdf temp.txt
grep -E <span class="hljs-string">"^\d{2}/\d{2}"</span> temp.txt &gt; data/processed/chase_transactions.txt
</code></pre>
<p>这里体现了<strong>Agentic Search</strong>的优势：Agent不需要加载所有文件内容，而是通过bash命令（grep, tail, head）精准提取需要的信息，极大节省上下文空间。</p>
<h3 data-id="heading-6">3.2 分析引擎：代码生成与执行</h3>
<p>财务分析的核心是复杂的计算逻辑。我们利用Claude Agent SDK的<strong>code generation</strong>能力，让Agent动态生成专门的分析脚本。</p>
<p>任务指令：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> analysisTask = <span class="hljs-string">`
基于today_inventory.json中的数据，执行以下分析：

1. 银行对账单分析：
   - 识别异常交易（金额&gt;5000美元或海外交易）
   - 分类交易类型（工资、供应商、客户付款）
   - 计算每日现金流

2. 销售数据分析：
   - 按产品类别汇总收入
   - 识别环比增长趋势
   - 标记退货率&gt;10%的产品

3. 市场数据关联：
   - 分析SP500波动与公司销售的相关性
   - 评估市场风险暴露

要求：
- 生成独立的Python脚本进行分析
- 脚本需包含数据验证和错误处理
- 输出结果保存为JSON格式
- 包含可视化图表（PNG格式）
`</span>;

<span class="hljs-keyword">const</span> analysisResult = <span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(analysisTask);
</code></pre>
<p>Agent生成的代码示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># scripts/bank_analyzer.py</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">def</span> <span class="hljs-title function_">load_and_validate_data</span>(<span class="hljs-params">file_path</span>):
    <span class="hljs-string">"""Agent自动添加了验证逻辑"""</span>
    <span class="hljs-keyword">try</span>:
        df = pd.read_csv(file_path)
        <span class="hljs-keyword">assert</span> <span class="hljs-string">'amount'</span> <span class="hljs-keyword">in</span> df.columns, <span class="hljs-string">"Missing amount column"</span>
        <span class="hljs-keyword">assert</span> pd.api.types.is_numeric_dtype(df[<span class="hljs-string">'amount'</span>]), <span class="hljs-string">"Amount should be numeric"</span>
        <span class="hljs-keyword">return</span> df
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"Data validation failed: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_anomalies</span>(<span class="hljs-params">transactions</span>):
    <span class="hljs-string">"""异常检测 - Agent实现的复杂逻辑"""</span>
    anomalies = []
    <span class="hljs-keyword">for</span> _, row <span class="hljs-keyword">in</span> transactions.iterrows():
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(row[<span class="hljs-string">'amount'</span>]) &gt; <span class="hljs-number">5000</span>:
            anomalies.append({
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"high_value"</span>,
                <span class="hljs-string">"threshold"</span>: <span class="hljs-number">5000</span>,
                <span class="hljs-string">"actual"</span>: row[<span class="hljs-string">'amount'</span>],
                <span class="hljs-string">"description"</span>: row.get(<span class="hljs-string">'description'</span>, <span class="hljs-string">''</span>)
            })
    <span class="hljs-keyword">return</span> anomalies

<span class="hljs-comment"># ... 更多分析函数</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># Agent生成的执行逻辑</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"data/processed/today_inventory.json"</span>) <span class="hljs-keyword">as</span> f:
        inventory = json.load(f)
    
    results = {}
    <span class="hljs-keyword">for</span> source <span class="hljs-keyword">in</span> inventory[<span class="hljs-string">'sources'</span>]:
        <span class="hljs-keyword">if</span> source[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'bank'</span>:
            results[<span class="hljs-string">'bank_analysis'</span>] = analyze_bank_data(source[<span class="hljs-string">'path'</span>])
        <span class="hljs-comment"># ... 处理其他类型</span>
    
    <span class="hljs-comment"># 保存结果</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"reports/analysis_results.json"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        json.dump(results, f, indent=<span class="hljs-number">2</span>)
</code></pre>
<p>关键优势：Agent生成的代码<strong>精确、可组合、可重用</strong>，比直接让Agent做计算更可靠。代码本身就是验证过的执行计划。</p>
<h3 data-id="heading-7">3.3 子代理并行处理：提升效率</h3>
<p>当数据量庞大时，我们使用<strong>Subagents</strong>实现并行处理。让每个子代理专注于特定数据集，避免上下文过载。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> parallelAnalysisTask = <span class="hljs-string">`
我们有3个主要数据源需要分析。创建3个子代理并行工作：

子代理1 - BankAnalyzer: 分析银行对账单
子代理2 - SalesAnalyzer: 分析ERP销售数据  
子代理3 - MarketAnalyzer: 分析市场数据并生成风险评估

每个子代理：
1. 只接收相关的数据文件路径
2. 使用独立的上下文窗口
3. 返回结构化的JSON结果
4. 最长运行时间：5分钟

主代理负责汇总所有结果并生成综合报告。
`</span>;

<span class="hljs-keyword">const</span> subAgentConfig = {
  <span class="hljs-attr">bank</span>: {
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">"You are a banking data specialist. Focus on transaction analysis."</span>,
    <span class="hljs-attr">tools</span>: [<span class="hljs-string">"bash"</span>, <span class="hljs-string">"code_execution"</span>],
    <span class="hljs-attr">dataPath</span>: <span class="hljs-string">"data/processed/chase_transactions.txt"</span>
  },
  <span class="hljs-attr">sales</span>: {
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">"You are a sales analytics expert. Identify trends and anomalies."</span>,
    <span class="hljs-attr">tools</span>: [<span class="hljs-string">"file_system"</span>, <span class="hljs-string">"code_execution"</span>],
    <span class="hljs-attr">dataPath</span>: <span class="hljs-string">"data/raw/erp_exports/sales_20241115.csv"</span>
  },
  <span class="hljs-attr">market</span>: {
    <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">"You are a market risk analyst. Calculate correlations and VaR."</span>,
    <span class="hljs-attr">tools</span>: [<span class="hljs-string">"bash"</span>, <span class="hljs-string">"mcp_yfinance"</span>],
    <span class="hljs-attr">dataPath</span>: <span class="hljs-string">"data/raw/market_data/sp500_20241115.json"</span>
  }
};

<span class="hljs-comment">// 主代理创建并管理子代理</span>
<span class="hljs-keyword">const</span> orchestratorTask = <span class="hljs-string">`
创建3个子代理进行并行分析，然后汇总结果。
使用compact功能管理长期运行上下文。
`</span>;

<span class="hljs-keyword">const</span> finalResult = <span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(orchestratorTask);
</code></pre>
<p>子代理工作模式的优势：</p>
<ul>
<li><strong>上下文隔离</strong>：每个子代理处理特定数据，不会相互干扰</li>
<li><strong>并行执行</strong>：3个分析任务同时进行，总时间缩短60%</li>
<li><strong>结果精炼</strong>：子代理只返回关键发现，而非完整上下文</li>
</ul>
<h3 data-id="heading-8">3.4 验证机制：确保结果可靠性</h3>
<p>根据博文强调的<strong>verify your work</strong>原则，我们构建多层验证体系。</p>
<h4 data-id="heading-9">3.4.1 规则验证（Rules-based Verification）</h4>
<p>创建验证脚本<code>scripts/validator.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Agent生成的验证规则</span>
VALIDATION_RULES = {
    <span class="hljs-string">"bank_analysis"</span>: {
        <span class="hljs-string">"required_fields"</span>: [<span class="hljs-string">"total_balance"</span>, <span class="hljs-string">"anomalies"</span>],
        <span class="hljs-string">"balance_range"</span>: (<span class="hljs-number">10000</span>, <span class="hljs-number">10000000</span>),  <span class="hljs-comment"># 账户余额合理性检查</span>
        <span class="hljs-string">"max_anomaly_rate"</span>: <span class="hljs-number">0.05</span>  <span class="hljs-comment"># 异常交易率不超过5%</span>
    },
    <span class="hljs-string">"sales_analysis"</span>: {
        <span class="hljs-string">"required_fields"</span>: [<span class="hljs-string">"total_revenue"</span>, <span class="hljs-string">"growth_rate"</span>],
        <span class="hljs-string">"growth_range"</span>: (-<span class="hljs-number">0.5</span>, <span class="hljs-number">2.0</span>),  <span class="hljs-comment"># 增长率合理性</span>
        <span class="hljs-string">"min_transactions"</span>: <span class="hljs-number">10</span>
    }
}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lint_analysis_results</span>(<span class="hljs-params">results_path</span>):
    <span class="hljs-string">"""Agent创建的Linting机制"""</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(results_path) <span class="hljs-keyword">as</span> f:
        results = json.load(f)
    
    errors = []
    warnings = []
    
    <span class="hljs-keyword">for</span> key, rules <span class="hljs-keyword">in</span> VALIDATION_RULES.items():
        data = results.get(key, {})
        
        <span class="hljs-comment"># 检查必需字段</span>
        <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> rules[<span class="hljs-string">"required_fields"</span>]:
            <span class="hljs-keyword">if</span> field <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:
                errors.append(<span class="hljs-string">f"Missing required field: <span class="hljs-subst">{field}</span>"</span>)
        
        <span class="hljs-comment"># 检查数值范围</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"total_balance"</span> <span class="hljs-keyword">in</span> data:
            balance = data[<span class="hljs-string">"total_balance"</span>]
            min_val, max_val = rules[<span class="hljs-string">"balance_range"</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (min_val &lt;= balance &lt;= max_val):
                errors.append(<span class="hljs-string">f"Balance <span class="hljs-subst">{balance}</span> outside reasonable range"</span>)
    
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"errors"</span>: errors, <span class="hljs-string">"warnings"</span>: warnings}
</code></pre>
<p>Agent执行验证：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Agent自动运行验证</span>
python scripts/validator.py reports/analysis_results.json
<span class="hljs-comment"># 输出：{"errors": [], "warnings": ["High anomaly rate detected: 7%"]}</span>

<span class="hljs-comment"># Agent根据反馈自我修正</span>
<span class="hljs-string">"检测到异常率偏高，我需要重新审查交易分类逻辑..."</span>
</code></pre>
<h4 data-id="heading-10">3.4.2 可视化反馈（Visual Feedback）</h4>
<p>对于财务报告，Agent生成图表并自我验证：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在分析脚本中生成图表</span>
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_cashflow_chart</span>(<span class="hljs-params">daily_flow</span>):
    <span class="hljs-string">"""Agent创建现金流图表"""</span>
    plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">6</span>))
    plt.plot(daily_flow[<span class="hljs-string">'date'</span>], daily_flow[<span class="hljs-string">'net_flow'</span>])
    plt.title(<span class="hljs-string">'Daily Cash Flow Trends'</span>)
    plt.xlabel(<span class="hljs-string">'Date'</span>)
    plt.ylabel(<span class="hljs-string">'Net Flow ($)'</span>)
    plt.axhline(y=<span class="hljs-number">0</span>, color=<span class="hljs-string">'r'</span>, linestyle=<span class="hljs-string">'--'</span>)  <span class="hljs-comment"># 零线参考</span>
    
    <span class="hljs-comment"># 标记异常日</span>
    anomalies = daily_flow[daily_flow[<span class="hljs-string">'net_flow'</span>] &lt; -<span class="hljs-number">10000</span>]
    plt.scatter(anomalies[<span class="hljs-string">'date'</span>], anomalies[<span class="hljs-string">'net_flow'</span>], 
                color=<span class="hljs-string">'red'</span>, s=<span class="hljs-number">100</span>, marker=<span class="hljs-string">'X'</span>, label=<span class="hljs-string">'High Outflow Days'</span>)
    
    plt.savefig(<span class="hljs-string">'reports/cashflow_trend.png'</span>, dpi=<span class="hljs-number">300</span>, bbox_inches=<span class="hljs-string">'tight'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'reports/cashflow_trend.png'</span>

<span class="hljs-comment"># Agent使用Playwright MCP截图验证</span>
screenshot = <span class="hljs-keyword">await</span> agent.run(<span class="hljs-string">"使用Playwright打开cashflow_trend.png，验证图表是否清晰显示了异常点"</span>)
</code></pre>
<p>Agent会检查：</p>
<ul>
<li>图表是否包含所有必需元素（标题、坐标轴、图例）</li>
<li>异常点是否被正确标记</li>
<li>日期范围是否准确</li>
</ul>
<h3 data-id="heading-11">3.5 MCP集成：扩展Agent能力</h3>
<p>使用<strong>Model Context Protocol</strong>连接外部服务，让Agent能够跨系统工作。</p>
<p>配置MCP服务器<code>config/mcp.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"slack"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-slack"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"SLACK_BOT_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xoxb-your-token"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"SLACK_SIGNING_SECRET"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-secret"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"gmail"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-gmail"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-postgres"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"DATABASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"postgresql://finance_db:5432/analytics"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>Agent使用MCP工具：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> reportingTask = <span class="hljs-string">`
分析报告已完成。现在执行以下操作：

1. 使用slack MCP发送摘要到#finance-alerts频道：
   - 今日净流入：$125,430
   - 发现异常：3笔大额海外交易
   - 销售环比：+8.5%

2. 使用gmail MCP发送详细报告给CFO：
   - 收件人：cfo@company.com
   - 主题：每日财务分析 - 2024-11-15
   - 附件：reports/analysis_results.json和cashflow_trend.png

3. 使用postgres MCP将关键指标存入数据库：
   - 表：daily_financial_summary
   - 字段：date, total_revenue, net_cash_flow, anomaly_count
`</span>;

<span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(reportingTask);
</code></pre>
<p>MCP带来的价值：</p>
<ul>
<li><strong>标准化集成</strong>：无需为每个服务编写定制代码</li>
<li><strong>自动认证</strong>：MCP处理OAuth和凭证管理</li>
<li><strong>生态扩展</strong>：快速接入新服务（如Asana、GitHub）</li>
</ul>
<h2 data-id="heading-12">四、高级特性与优化</h2>
<h3 data-id="heading-13">4.1 上下文压缩：长期运行支持</h3>
<p>财务Agent需要7×24小时运行，<strong>Compaction</strong>功能至关重要。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Agent配置中启用自动压缩</span>
<span class="hljs-keyword">const</span> agent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClaudeAgent</span>({
  <span class="hljs-comment">// ... 其他配置</span>
  <span class="hljs-attr">contextManagement</span>: {
    <span class="hljs-attr">compaction</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">strategy</span>: <span class="hljs-string">"summarize"</span>, <span class="hljs-comment">// 或使用"truncate"策略</span>
    <span class="hljs-attr">triggerThreshold</span>: <span class="hljs-number">0.8</span>  <span class="hljs-comment">// 上下文使用80%时触发压缩</span>
  }
});

<span class="hljs-comment">// 手动触发压缩</span>
<span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">run</span>(<span class="hljs-string">"/compact 保留最近3天的分析结果摘要，归档详细数据到data/archive/"</span>);
</code></pre>
<p>压缩后的效果：</p>
<ul>
<li>原始对话：150k tokens → 压缩后：20k tokens</li>
<li>保留关键决策逻辑，丢弃中间调试信息</li>
<li>历史数据归档到文件系统，需要时可重新加载</li>
</ul>
<h3 data-id="heading-14">4.2 错误处理与自我修复</h3>
<p>让Agent具备<strong>自我调试</strong>能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> resilientTask = <span class="hljs-string">`
任务：分析交易数据，如果遇到错误按以下步骤处理：

1. 如果数据文件格式错误：
   - 运行bash命令检查文件头
   - 尝试不同的分隔符（, 或 |）
   - 记录错误到error.log

2. 如果分析脚本失败：
   - 查看Python错误信息
   - 自动修复常见错误（如缺少导入）
   - 重试运行，最多3次

3. 如果验证不通过：
   - 详细检查哪个规则失败
   - 重新审视数据源
   - 调整分析参数

使用try-catch模式，确保最终生成报告。
`</span>;

<span class="hljs-comment">// Agent会生成带错误处理的代码</span>
<span class="hljs-keyword">const</span> pythonScript = <span class="hljs-string">`
import traceback

def safe_analyze():
    try:
        main_analysis()
    except FileNotFoundError as e:
        logger.error(f"File missing: {e}")
        # Agent自动添加备用数据源
        fallback_to_backup_data()
    except ValueError as e:
        logger.error(f"Validation failed: {e}")
        # Agent自动调整参数重试
        adjust_parameters_and_retry()
`</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(resilientTask);
</code></pre>
<h3 data-id="heading-15">4.3 语义搜索增强（Hybrid Approach）</h3>
<p>虽然博文推荐优先使用Agentic Search，但对于历史报告查询，可以结合语义搜索：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Agent自动设置混合搜索</span>
<span class="hljs-comment"># 1. 首先使用Agentic Search快速定位时间范围</span>
grep -r <span class="hljs-string">"2024-10"</span> reports/ | <span class="hljs-built_in">head</span> -20

<span class="hljs-comment"># 2. 对关键文档启用语义索引</span>
<span class="hljs-comment"># Agent会生成并执行嵌入脚本</span>
python scripts/embed_reports.py --folder reports/ --output vectors/report_vectors.index

<span class="hljs-comment"># 3. 后续查询时结合两种方法</span>
<span class="hljs-comment"># 先语义搜索找到相似报告，再Agentic Search提取具体数字</span>
</code></pre>
<p>Agent自动判断何时使用哪种搜索：</p>
<ul>
<li>精确查询（如"2024年Q3净利润"）→ Agentic Search</li>
<li>概念查询（如"风险最高的月份"）→ 语义搜索</li>
</ul>
<h2 data-id="heading-16">五、部署与监控</h2>
<h3 data-id="heading-17">5.1 生产环境部署</h3>
<p>创建Dockerfile实现可重复部署：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM node:20-slim

# 安装系统工具和Python环境
RUN apt-get update &amp;&amp; apt-get install -y \
    python3 python3-pip pdftotext curl

# 安装MCP服务器
RUN npm install -g @modelcontextprotocol/server-slack \
                   @modelcontextprotocol/server-gmail

WORKDIR /finance-agent
COPY package*.json ./
RUN npm install --production

COPY . .

# Agent自动创建健康检查脚本
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD node scripts/healthcheck.js

CMD ["node", "src/financeAgent.js", "--mode=daemon"]
</code></pre>
<h3 data-id="heading-18">5.2 性能评估</h3>
<p>构建测试集评估Agent表现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eval/test_suite.js</span>
<span class="hljs-keyword">const</span> testCases = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"异常交易检测准确率"</span>,
    <span class="hljs-attr">input</span>: <span class="hljs-string">"data/raw/bank_statement_with_fraud.csv"</span>,
    <span class="hljs-attr">expected</span>: <span class="hljs-string">"识别出3笔欺诈交易"</span>,
    <span class="hljs-attr">metric</span>: <span class="hljs-string">"recall"</span>  <span class="hljs-comment">// 期望召回率&gt;95%</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"报告生成完整性"</span>,
    <span class="hljs-attr">input</span>: <span class="hljs-string">"多源数据混合场景"</span>,
    <span class="hljs-attr">expected</span>: <span class="hljs-string">"包含所有必需字段和图表"</span>,
    <span class="hljs-attr">metric</span>: <span class="hljs-string">"rule_compliance"</span>  <span class="hljs-comment">// 规则符合度100%</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"上下文效率"</span>,
    <span class="hljs-attr">input</span>: <span class="hljs-string">"30天连续数据"</span>,
    <span class="hljs-attr">expected</span>: <span class="hljs-string">"上下文使用&lt;150k tokens"</span>,
    <span class="hljs-attr">metric</span>: <span class="hljs-string">"token_efficiency"</span>
  }
];

<span class="hljs-comment">// Agent自动运行评估并生成报告</span>
<span class="hljs-keyword">await</span> financeAgent.<span class="hljs-title function_">run</span>(<span class="hljs-string">"运行eval/test_suite.js，记录每个测试用例的结果"</span>);
</code></pre>
<p>通过测试发现：</p>
<ul>
<li>异常检测召回率：97%</li>
<li>规则符合度：100%</li>
<li>平均token使用：120k（在200k限制内）</li>
<li>自我修复成功率：85%</li>
</ul>
<h2 data-id="heading-19">六、最佳实践总结</h2>
<p>通过这个实战案例，我们总结出Claude Agent SDK的核心最佳实践：</p>
<h3 data-id="heading-20">6.1 设计原则</h3>
<ol>
<li><strong>赋予计算机访问权限</strong>：通过bash和file_system工具，让Agent能够像人类一样操作电脑</li>
<li><strong>代码优先</strong>：复杂逻辑应生成代码而非直接推理，确保精确性和可重复性</li>
<li><strong>上下文工程</strong>：精心设计文件目录结构，使其成为Agent的"记忆宫殿"</li>
</ol>
<h3 data-id="heading-21">6.2 开发模式</h3>
<ol>
<li><strong>迭代循环</strong>：gather context → take action → verify → repeat</li>
<li><strong>子代理分解</strong>：复杂任务拆分为并行子代理，避免上下文爆炸</li>
<li><strong>渐进增强</strong>：从Agentic Search开始，必要时引入语义搜索</li>
</ol>
<h3 data-id="heading-22">6.3 质量保证</h3>
<ol>
<li><strong>多层验证</strong>：规则验证 + 可视化反馈 + LLM判断</li>
<li><strong>自我修复</strong>：赋予Agent调试和重试能力</li>
<li><strong>持续评估</strong>：建立测试集，量化Agent性能</li>
</ol>
<h3 data-id="heading-23">6.4 生态集成</h3>
<ol>
<li><strong>MCP标准化</strong>：快速接入外部服务，避免重复造轮子</li>
<li><strong>工具精简</strong>：保持工具集最小化，避免决策瘫痪</li>
<li><strong>上下文压缩</strong>：长期运行必开Compaction，维持Agent性能</li>
</ol>
<h2 data-id="heading-24">七、未来扩展方向</h2>
<p>此财务Agent可进一步扩展为：</p>
<ul>
<li><strong>预测模块</strong>：集成时间序列模型，预测现金流</li>
<li><strong>审计模块</strong>：自动生成审计底稿和证据链</li>
<li><strong>多语言支持</strong>：通过MCP接入翻译服务，支持全球分公司</li>
<li><strong>智能问答</strong>：基于历史报告构建RAG系统，支持自然语言查询</li>
</ul>
<hr/>
<p>通过Claude Agent SDK，我们在300行核心代码内构建了一个企业级财务分析Agent。该Agent展现了<strong>自主规划、代码生成、并行处理、自我验证</strong>的完整智能循环，充分体现了"给AI一台电脑"的设计哲学。相比传统开发方式，开发效率提升10倍以上，且Agent具备持续学习和适应能力。</p>
<p>这个案例证明，Claude Agent SDK不仅是代码助手，更是构建下一代自主Agent应用的强大平台。通过合理设计工具、优化上下文、集成MCP生态，开发者可以快速构建出可靠、高效、可扩展的AI Agent系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET Core优秀项目和框架2025年12月简报]]></title>    <link>https://juejin.cn/post/7591497387246485540</link>    <guid>https://juejin.cn/post/7591497387246485540</guid>    <pubDate>2026-01-05T13:12:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591497387246485540" data-draft-id="7591513171199655999" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET Core优秀项目和框架2025年12月简报"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-01-05T13:12:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET Core优秀项目和框架2025年12月简报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T13:12:49.000Z" title="Mon Jan 05 2026 13:12:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8ab68286963414b88f4e9641ff10e5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=ysqtfW3OYwyY4MMMNkwrx%2BYNqXw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>公众号每月定期推广和分享的C#/.NET/.NET Core优秀项目和框架（每周至少会推荐两个优秀的项目和框架当然节假日除外），公众号推文中有项目和框架的详细介绍、功能特点、使用方式以及部分功能截图等（打不开或者打开GitHub很慢的同学可以优先查看公众号推文，文末一定会附带项目和框架源码地址）。注意：排名不分先后，都是十分优秀的开源项目和框架，每周定期更新分享（欢迎关注公众号：<strong>追逐时光者</strong>，第一时间获取每周精选分享资讯🔔）。</p>
<ul>
<li><strong>💡简报Gitee开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></strong></li>
<li><strong>🔔简报GitHub开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></strong></li>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCbPvhmfK4ZWsHJj2eKMk7Q" target="_blank" title="https://mp.weixin.qq.com/s/CbPvhmfK4ZWsHJj2eKMk7Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/CbPvhmfK4…</a></li>
</ul>
<h2 data-id="heading-1">FlaUI</h2>
<ul>
<li><strong>项目简介：</strong> FlaUI 是一个 .NET 开源免费（MIT license）、功能强大 的 UI 自动化库，专为 Windows 桌面应用程序（如 Win32、WinForms、WPF、Store Apps 等应用）的自动化测试而设计。该项目基于 Microsoft 的原生 UI Automation 库构建，并作为这些库的封装器，提供了丰富的功能和灵活的 API，以便开发者能够高效地编写自动化测试脚本。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFlaUI%2FFlaUI" target="_blank" title="https://github.com/FlaUI/FlaUI" ref="nofollow noopener noreferrer">github.com/FlaUI/FlaUI</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPE4S-fUyeG7U8Z78NYu6Rw" target="_blank" title="https://mp.weixin.qq.com/s/PE4S-fUyeG7U8Z78NYu6Rw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/PE4S-fUye…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ed83341aad1411c9c15731e930319f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=QktLTBTN1Hx5epAlikhCL2aWjzQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dd0b8dd6e5749b08a1f6fdbf30f61e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=slNUN8Pz3uHYbql3Kd7atYxYwbs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">RuYiAdmin</h2>
<ul>
<li><strong>项目简介：</strong> RuYiAdmin 一款基于 .NET 9 构建的企业级、前后端分离、开源（Apache License） Web RBAC 快速开发框架，具有灵活的架构设计和强大的功能，适用于快速开发高性能的企业级应用，具有低代码、跨平台、分布式、多线程和高性能等特色。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fpang-mingjun%2FRuYiAdmin" target="_blank" title="https://gitee.com/pang-mingjun/RuYiAdmin" ref="nofollow noopener noreferrer">gitee.com/pang-mingju…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXCcbLiV8Dhb9pfp8wi-Teg" target="_blank" title="https://mp.weixin.qq.com/s/XCcbLiV8Dhb9pfp8wi-Teg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/XCcbLiV8D…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa1d145072349e5814a460fda9e6475~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=WFL2SgqWqgJAYih90usadtBWAUk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee968ec03f9640b0a76d94069685bf2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=V2%2BrZV71%2F5q4BsRLED6uifiwjok%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4798d9e01d74edcaac955a4b6381507~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=KcoWPl3vcGU7rXDeI0aUZvs%2FSYU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">CxFlatUI</h2>
<ul>
<li><strong>项目简介：</strong> CxFlatUI 是一款开源（Apache License）、现代化的 WinForm UI 控件库，值得大家参考学习使用。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHuJinguang%2FCxFlatUI" target="_blank" title="https://github.com/HuJinguang/CxFlatUI" ref="nofollow noopener noreferrer">github.com/HuJinguang/…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fg1O4ngtrrFpS8yrDWbYz5A" target="_blank" title="https://mp.weixin.qq.com/s/g1O4ngtrrFpS8yrDWbYz5A" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/g1O4ngtrr…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e74b67547d84d8084ce6b1adb14d18f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=Cs7XCiJRPXvLo73eYiT5mUhMGlM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddd59fbe97e64094905cc03707011991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=VOZfxNP7TjTsFKixl9SE%2BzePVSs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">TypedSql</h2>
<ul>
<li><strong>项目简介：</strong> TypedSQL 是一个小型实验性类 SQL 查询引擎，其执行计划依赖于 C# 类型系统。每个查询都变成由 Where / Select / Stop 节点构建的封闭泛型类型，完全通过静态方法运行，因此热路径中没有虚拟派遣或表达式树解释。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhez2010%2FTypedSql" target="_blank" title="https://github.com/hez2010/TypedSql" ref="nofollow noopener noreferrer">github.com/hez2010/Typ…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FWkS6qjDslM2UWDdjpQsjuw" target="_blank" title="https://mp.weixin.qq.com/s/WkS6qjDslM2UWDdjpQsjuw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/WkS6qjDsl…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fc560b1bd3348638af89f891db7eb0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=rUIEYCdb4Hm4phnwg9xshGYMop8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">OfficeInterop</h2>
<ul>
<li><strong>项目简介：</strong> OfficeInterop 是一个针对 Microsoft Office 应用程序的 .NET 封装库，其核心目标是简化 Office COM 组件的使用，使开发者能够更方便、更高效地在 .NET 环境中操作 Office 应用程序，如 Excel、Word 等。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fmudtools%2FOfficeInterop" target="_blank" title="https://gitee.com/mudtools/OfficeInterop" ref="nofollow noopener noreferrer">gitee.com/mudtools/Of…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FSOJdHwrP-X1suv0v8PNEcg" target="_blank" title="https://mp.weixin.qq.com/s/SOJdHwrP-X1suv0v8PNEcg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/SOJdHwrP-…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e82e47f6202d4378a011e7abfb5718a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=PI8wEfUNStzvwbk6%2BvMbpFR5YQY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">SuperSocket</h2>
<ul>
<li><strong>项目简介：</strong> SuperSocket 是一个高性能、可扩展的.NET 套接字服务器应用程序框架。它提供了一个强大的架构，用于构建自定义网络通信应用程序，支持多种协议，包括 TCP、UDP 和 WebSocket。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fkerryjiang%2FSuperSocket" target="_blank" title="https://gitee.com/kerryjiang/SuperSocket" ref="nofollow noopener noreferrer">gitee.com/kerryjiang/…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FoNA-dDh80e-WI__9Itf2JA" target="_blank" title="https://mp.weixin.qq.com/s/oNA-dDh80e-WI__9Itf2JA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/oNA-dDh80…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1626fb643724abca5cdc10c013d7f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=%2Fbx23tF1Yo3FkzSC%2BQKpnpbj7Yg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf0389fb2a24372ada21703e19bb1a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=TqgasCFZMohe1NiypCweLH8Z8wA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">SVGImage</h2>
<ul>
<li><strong>项目简介：</strong> SVGImage 是一个为 WPF（Windows Presentation Foundation）应用程序设计、开源（MIT license）、免费的 SVG（Scalable Vector Graphics）图像查看控件。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnetprojects%2FSVGImage" target="_blank" title="https://github.com/dotnetprojects/SVGImage" ref="nofollow noopener noreferrer">github.com/dotnetproje…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F69x0B6jhYja58Ze0NSi9ew" target="_blank" title="https://mp.weixin.qq.com/s/69x0B6jhYja58Ze0NSi9ew" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/69x0B6jhY…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/862919314f554beabf3c41e42766499f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=IGE4PR11tmhIwoNE2b%2FG5DCkRPo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29f5713129ff4eac8135373147495ce5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768223568&amp;x-signature=FKoK0inoGayaXrf2iL%2Fgn3dlVd4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型 | QWen3 结构解析]]></title>    <link>https://juejin.cn/post/7591719013488115750</link>    <guid>https://juejin.cn/post/7591719013488115750</guid>    <pubDate>2026-01-05T13:25:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591719013488115750" data-draft-id="7591708519448985609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型 | QWen3 结构解析"/> <meta itemprop="keywords" content="算法,自动驾驶"/> <meta itemprop="datePublished" content="2026-01-05T13:25:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型 | QWen3 结构解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T13:25:33.000Z" title="Mon Jan 05 2026 13:25:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、简介</h2>
<p>25/4/29 发布的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257281308%26content_type%3DArticle%26match_order%3D1%26q%3DQwen3%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257281308&amp;content_type=Article&amp;match_order=1&amp;q=Qwen3&amp;zhida_source=entity" ref="nofollow noopener noreferrer"> Qwen3 </a>系列模型，共 8 个模型，其中六个<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257281308%26content_type%3DArticle%26match_order%3D1%26q%3DDense%25E6%25A8%25A1%25E5%259E%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257281308&amp;content_type=Article&amp;match_order=1&amp;q=Dense%E6%A8%A1%E5%9E%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer"> Dense 模型</a>分别为，Qwen3-32B、Qwen3-14B、Qwen3-8B、Qwen3-4B、Qwen3-1.7B 和 Qwen3-0.6B。另外两个<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257281308%26content_type%3DArticle%26match_order%3D1%26q%3DMoE%25E6%25A8%25A1%25E5%259E%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257281308&amp;content_type=Article&amp;match_order=1&amp;q=MoE%E6%A8%A1%E5%9E%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer"> MoE 模型</a>分别为，Qwen3-235B-A22B，拥有 2350 多亿总参数和 220 多亿激活参数的大模型，以及 Qwen3-30B-A3B，拥有约 300 亿总参数和 30 亿激活参数的小型 MoE 模型。</p>
<h3 data-id="heading-1">1.1 Qwen3-2507</h3>
<p>在社区的反馈以及进一步研究的启发下，仅指令（Instruct-only）和仅思考（Thinking-only）模型回归啦！成果就是通义千问 3-2507（Qwen3-2507），three sizes， 235B-A22B， 30B-A3B， and 4B。</p>
<p><strong>Qwen3-Instruct-2507 具备以下特点：</strong></p>
<ul>
<li>泛化能力显著提升，涵盖 指令遵循、逻辑推理、文本理解、数学、科学、编码以及工具使用。</li>
<li>长尾知识覆盖在多种语言上大幅增强。</li>
<li>在主观和开放式任务中与用户偏好的契合度明显提高，能够生成更有用的回复和更高质量的文本。</li>
<li>在 25.6 万长上下文理解方面能力增强，可扩展至 100 万。</li>
</ul>
<p><strong>Qwen3-Thinking-2507 具备以下特点：</strong></p>
<ul>
<li>推理任务性能显著提升，涵盖逻辑推理、数学、科学、编码以及通常需要人类专业知识的学术基准测试——在开源 thinking 模型中取得了领先的成果。</li>
<li>泛化能力显著增强，如指令遵循、工具使用、文本生成以及与人类偏好的一致性。</li>
<li>256K 长上下文理解能力得到强化，可扩展至 1M。</li>
</ul>
<h3 data-id="heading-2">1.2 Qwen3-2504( Qwen3)</h3>
<ul>
<li>全尺寸稠密与混合专家模型：0.6B， 1.7B， 4B， 8B， 14B， 32B and 30B-A3B， 235B-A22B</li>
<li>支持在​<strong>思考模式</strong>​（用于复杂逻辑推理、数学和编码）和 非思考模式 （用于高效通用对话）之间​<strong>无缝切换</strong>​，确保在各种场景下的最佳性能。</li>
<li>显著增强的推理能力，在数学、代码生成和常识逻辑推理方面超越了之前的 QwQ（在思考模式下）和 Qwen2.5 指令模型（在非思考模式下）。</li>
<li>卓越的人类偏好对齐，在创意写作、角色扮演、多轮对话和指令跟随方面表现出色，提供更自然、更吸引人和更具沉浸感的对话体验。</li>
<li>擅长智能体能力，可以在思考和非思考模式下精确集成外部工具，在复杂的基于代理的任务中在开源模型中表现领先。</li>
<li>支持 100 多种语言和方言，具有强大的多语言理解、推理、指令跟随和生成能力。</li>
</ul>
<h2 data-id="heading-3">二、Qwen 模型结构解析</h2>
<p>本节以 qwen3_moe 代码为例，解析一下结构。</p>
<blockquote>
<p>代码路径：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Ftransformers%2Fblob%2Fmain%2Fsrc%2Ftransformers%2Fmodels%2Fqwen3_moe%2Fmodeling_qwen3_moe.py" target="_blank" title="https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_moe/modeling_qwen3_moe.py" ref="nofollow noopener noreferrer">github.com/huggingface…</a></p>
<p>配置文件：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Ftransformers%2Fblob%2Fmain%2Fsrc%2Ftransformers%2Fmodels%2Fqwen3_moe%2Fconfiguration_qwen3_moe.py" target="_blank" title="https://github.com/huggingface/transformers/blob/main/src/transformers/models/qwen3_moe/configuration_qwen3_moe.py" ref="nofollow noopener noreferrer">github.com/huggingface…</a></p>
</blockquote>
<h3 data-id="heading-4">2.1 总体网络结构</h3>
<p>Qwen3 主要由四个部分组成：</p>
<ul>
<li>embed_tokens：嵌入层。这是模型处理输入的第一步。它的核心功能是将输入的离散文本符号（通常是经过 Tokenizer 处理后的 Token ID）转换为连续的、稠密的向量表示（称为嵌入向量或 Embeddings）。</li>
<li>Decoder layers：多个堆叠的解码器。这是模型的核心计算引擎，负责理解输入序列的上下文、提取特征并进行深度信息处理。模型的能力（如理解、推理、生成）主要源于这些层。</li>
</ul>
<pre><code class="hljs language-Plain" lang="Plain">self.layers = nn.ModuleList(
            [Qwen3MoeDecoderLayer(config, layer_idx) for layer_idx in range(config.num_hidden_layers)]
        )
</code></pre>
<ul>
<li>norm：归一化层。处理完毕后，对最终的隐藏状态 （Hidden States） 进行最后一次归一化。</li>
</ul>
<pre><code class="hljs language-Plain" lang="Plain">self.norm = Qwen3MoeRMSNorm(config.hidden_size, eps=config.rms_norm_eps)
</code></pre>
<ul>
<li>rotary_emb：旋转位置编码。为模型提供关于序列中 Token 位置的信息。标准 Transformer 的自注意力机制本身是排列不变的（即打乱输入顺序可能得到相同结果），因此需要显式地注入位置信息。</li>
</ul>
<pre><code class="hljs language-Plain" lang="Plain">self.rotary_emb = Qwen3MoeRotaryEmbedding(config=config)
</code></pre>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=OTM0ZmJiMGQ4ZmIwZmZjYmUyYzE3ZDAxNDJlMWFjODlfRkU1VDlHSnpRUlZTN1hLZEZ5d041MDVVa1NXWlYzdHdfVG9rZW46RUF2ZmJRZzdLb0RidmR4WEFORWM5alFDblpmXzE3Njc2MTkyNzg6MTc2NzYyMjg3OF9WNA" alt="" loading="lazy"/></p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MjI0ZjllMDJlOTM5ODBjOTlkZjhkYjBkNDhmMTVkZWFfenV3VEx6NjgzdnN4cjdFc1NRTkpZV1NmUE9jb3ZBT3lfVG9rZW46V2lLcGJLTGxub3p2Ump4c1ZCcmNrZnVibkdjXzE3Njc2MTkyNzg6MTc2NzYyMjg3OF9WNA" alt="" loading="lazy"/></p>
<p>总体网络结构需要结合 <code>Qwen3MoeModel</code> 类来看，Qwen3MoeModel 是基于混合专家（MoE）架构的语言模型，继承自 Qwen3MoePreTrainedModel。具体代码注解如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">class Qwen3MoeModel(Qwen3MoePreTrainedModel):
    def __init__(self, config: Qwen3MoeConfig):
        super().__init__(config)
        self.padding_idx = config.pad_token_id
        #如 Transformer 解码器层）的特征向量维度，即每个 token 经过隐藏层处理后输出的向量长度
        self.vocab_size = config.vocab_size #151936，
        #hidden_size：2048
        self.embed_tokens = nn.Embedding(config.vocab_size, config.hidden_size, self.padding_idx)
        #num_hidden_layers：24
        self.layers = nn.ModuleList(
            [Qwen3MoeDecoderLayer(config, layer_idx) for layer_idx in range(config.num_hidden_layers)]
        )
        self.norm = Qwen3MoeRMSNorm(config.hidden_size, eps=config.rms_norm_eps)
        self.rotary_emb = Qwen3MoeRotaryEmbedding(config=config)
        self.gradient_checkpointing = False

        # Initialize weights and apply final processing
        self.post_init()

    @check_model_inputs
    @auto_docstring
    def forward(
        self,
        #可选的整数张量，通常是输入文本经过分词后的索引序列（如单词 / 子词的 ID），是模型最常见的输入形式。
        input_ids: Optional[torch.LongTensor] = None,
        #可选的张量，用于标记输入序列中哪些位置是有效内容（1）、哪些是填充（0），避免模型关注无效信息。
        attention_mask: Optional[torch.Tensor] = None,
        #可选的整数张量，标记每个 token 在序列中的位置，辅助模型理解语序（部分模型会自动生成）。
        position_ids: Optional[torch.LongTensor] = None,
        #可选的缓存对象，用于存储之前计算的键（key）和值（value），
        #在生成式任务（如文本续写）中加速推理，避免重复计算历史序列
        past_key_values: Optional[Cache] = None,
        #可选的浮点张量，直接输入预计算的嵌入向量（替代input_ids，适用于已处理过的特征输入）。
        inputs_embeds: Optional[torch.FloatTensor] = None,
        #指定是否采用缓存
        use_cache: Optional[bool] = None,
        #可选的整数张量，标记缓存中需要更新的位置，配合past_key_values使用。
        cache_position: Optional[torch.LongTensor] = None,
        **kwargs: Unpack[TransformersKwargs],
    ) -&gt; MoeModelOutputWithPast:
        if (input_ids is None) ^ (inputs_embeds is not None):#异或计算，二者不可同时存在
            raise ValueError("You must specify exactly one of input_ids or inputs_embeds")
        #使用KV cache，DynamicCache支持灵活的序列长度变化，自动扩展容量
        if use_cache and past_key_values is None:
            past_key_values = DynamicCache(config=self.config)
        #当inputs_embeds为None时（即用户未直接提供输入嵌入），
        #通过self.embed_tokens将input_ids（文本的整数编码）转换为对应的嵌入向量（inputs_embeds）。
        #self.embed_tokens通常是一个nn.Embedding层，负责将离散的 token 索引映射为连续的向量表示，
        #是语言模型中将文本转换为模型可处理的数值形式的核心步骤。
        if inputs_embeds is None:
            inputs_embeds = self.embed_tokens(input_ids)
        #确定当前输入的每个 token 在缓存中的位置，以便后续在生成文本或处理长序列时，
        #能正确关联历史缓存和当前输入，实现高效的上下文关联和缓存管理（比如 Transformer 中的 K/V 缓存）。
        if cache_position is None:
            past_seen_tokens = past_key_values.get_seq_length() if past_key_values is not None else 0
            cache_position = torch.arange(
                past_seen_tokens, past_seen_tokens + inputs_embeds.shape[1], device=inputs_embeds.device
            )
        
        if position_ids is None:
            position_ids = cache_position.unsqueeze(0)
        #选择不同的掩码函数
        mask_function = create_causal_mask if self.config.sliding_window is None else create_sliding_window_causal_mask
        causal_mask = mask_function(
            config=self.config,
            input_embeds=inputs_embeds,
            attention_mask=attention_mask,
            cache_position=cache_position,
            past_key_values=past_key_values,
            position_ids=position_ids,
        )

        hidden_states = inputs_embeds

        # create position embeddings to be shared across the decoder layers
        position_embeddings = self.rotary_emb(hidden_states, position_ids)

        for decoder_layer in self.layers[: self.config.num_hidden_layers]:
            hidden_states = decoder_layer(
                hidden_states,
                position_embeddings=position_embeddings,
                attention_mask=causal_mask,
                position_ids=position_ids,
                past_key_values=past_key_values,
                use_cache=use_cache,
                cache_position=cache_position,
                **kwargs,
            )

        hidden_states = self.norm(hidden_states)

        return MoeModelOutputWithPast(  # only diff with Mistral is the output type, we need MoE
            last_hidden_state=hidden_states,
            past_key_values=past_key_values,
        )
</code></pre>
<h3 data-id="heading-5">2.2 Qwen3MoeDecoderLayer 解析</h3>
<p>Qwen3MoeDecoderLayer 的结构图如下所示：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=OGUxYWE5NDU3OGJiYTMxOTkyZWZmY2RiMTk2OGRjNDVfTW9HdElzakJsRDFyVnIzTVlZOWE5ME0xQUp5NjhEWGRfVG9rZW46RTN0VGJlVjBPb1FwNEd4YUs3b2NCMGRRbm0zXzE3Njc2MTkyNzg6MTc2NzYyMjg3OF9WNA" alt="" loading="lazy"/></p>
<p>下面逐个对上图中的 block 进行解释。</p>
<h4 data-id="heading-6">2.2.1 Qwen3MoeRMSNorm</h4>
<ul>
<li>功能：实现 RMS 归一化，通过对输入特征的均方根进行缩放，稳定数值分布，类似 LayerNorm 但计算更轻量（不含均值中心化）。</li>
<li>初始化：定义可学习的缩放权重 <code>weight</code>（维度与 <code>hidden_size</code> 一致）和数值稳定参数 <code>eps</code>（避免除零）。</li>
<li>前向传播：</li>
</ul>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjEzZDk0Y2VmYmEyZDNmNDBkN2Q1MWQyZDI1ZWRjMmNfVXBaRGVsMTRwWWExMld3RDRnR1NZNk5SNXVoNG9paGtfVG9rZW46VFFUcWJuZVNvb0Nzam14a1g4OWNLbjhWbkV3XzE3Njc2MTkyNzg6MTc2NzYyMjg3OF9WNA" alt="" loading="lazy"/></p>
<ul>
<li>装饰器：<code>@use_kernel_forward_from_hub("RMSNorm")</code> 表示从 hub 加载优化的 RMSNorm 内核实现（可能是高效的 C++/CUDA 算子），提升计算速度。</li>
</ul>
<pre><code class="hljs language-Plain" lang="Plain">@use_kernel_forward_from_hub("RMSNorm")
class Qwen3MoeRMSNorm(nn.Module):
    def __init__(self, hidden_size, eps=1e-6):
        """
        Qwen3MoeRMSNorm is equivalent to T5LayerNorm
        """
        super().__init__()
        self.weight = nn.Parameter(torch.ones(hidden_size))
        self.variance_epsilon = eps

    def forward(self, hidden_states):
        input_dtype = hidden_states.dtype
        hidden_states = hidden_states.to(torch.float32)
        variance = hidden_states.pow(2).mean(-1, keepdim=True)
        hidden_states = hidden_states * torch.rsqrt(variance + self.variance_epsilon)
        return self.weight * hidden_states.to(input_dtype)

    def extra_repr(self):
        return f"{tuple(self.weight.shape)}, eps={self.variance_epsilon}"
</code></pre>
<h4 data-id="heading-7">2.2.2 Qwen3MoeAttention</h4>
<p>Qwen3 的注意力机制在 Qwen2 的基础上进行了微调，在 Q、K 的线性投影后面分别加入了一个归一化层，有助于提高稳定性。</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=OWE2ZDYxM2I3MjhmNzhhZGQ5MmM1MTAzODUyMmJlNjRfdkV0eEtZWkZTWFIxMmFuamVwb1lPT2pxOFlzOTZocVBfVG9rZW46S05YRmJ5UVc2b1VYQkl4SHRHb2NIbFlKblBmXzE3Njc2MTkyNzg6MTc2NzYyMjg3OF9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">2.2.3 Qwen3MoeSparseMoeBlock</h4>
<p>我们从 Qwen3 的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257315928%26content_type%3DArticle%26match_order%3D1%26q%3DTransformer%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257315928&amp;content_type=Article&amp;match_order=1&amp;q=Transformer&amp;zhida_source=entity" ref="nofollow noopener noreferrer"> Transformer </a>的实现来学习下优化方式。</p>
<p>将传统 Transformer 模型中的全连接 MLP 层替换为新型的稀疏专家模块（Qwen3MoeSparseMoeBlock）。该模块由以下两个关键组件构成：</p>
<ol>
<li>包含 num_experts 个轻量级专家网络（Qwen3MoeMLP）的并行计算单元；</li>
<li>基于注意力机制的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257315928%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25B7%25AF%25E7%2594%25B1%25E7%25BD%2591%25E7%25BB%259C%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257315928&amp;content_type=Article&amp;match_order=1&amp;q=%E8%B7%AF%E7%94%B1%E7%BD%91%E7%BB%9C&amp;zhida_source=entity" ref="nofollow noopener noreferrer">路由网络</a>（gate）。在计算过程中，路由网络通过动态决策机制为每个输入 Token 生成路由决策，筛选出匹配度最高的 top_k 个专家节点。随后，系统将根据路由权重对选定专家的计算结果进行加权融合，最终生成该隐层的表征输出。</li>
</ol>
<p>那么同样我们对比<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D257315928%26content_type%3DArticle%26match_order%3D1%26q%3DDeepSeekMOE%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=257315928&amp;content_type=Article&amp;match_order=1&amp;q=DeepSeekMOE&amp;zhida_source=entity" ref="nofollow noopener noreferrer"> DeepSeekMOE</a>，Qwen3MOE 有两个点的改变：1）没有 shared expert。2.优化了 MLP 架构，变为 Qwen3MoeSparseMoeBlock。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1902461213255925825" target="_blank" title="https://zhuanlan.zhihu.com/p/1902461213255925825" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/190246121…</a></p>
</blockquote>
<p>代码解析：</p>
<pre><code class="hljs language-Plain" lang="Plain">class Qwen3MoeSparseMoeBlock(nn.Module):
    """
    Qwen3混合专家模型中的稀疏MoE模块，通过路由器选择部分专家处理输入，实现高效计算
    """
    def __init__(self, config: Qwen3MoeConfig):
        super().__init__()
        # 1. 基础配置参数
        self.hidden_size = config.hidden_size  # 输入特征维度
        self.num_experts = config.num_experts  # 专家网络总数：128
        self.num_experts_per_tok = config.num_experts_per_tok  # 每个token激活的专家数：8

        # 2. 路由器（Router）：决定每个token选择哪些专家
        # 输入：[batch_size, seq_len, hidden_size]，输出：[batch_size, seq_len, num_experts]（专家权重）
        self.gate = nn.Linear(self.hidden_size, self.num_experts, bias=False)

        # 3. 初始化专家网络（每个专家为独立的MLP）
        # 专家网络通常采用与稠密MLP相同的结构（如两次线性变换+激活函数）
        self.experts = nn.ModuleList([
            Qwen3MoeMLP(config)  # 复用Qwen3的MLP结构作为专家
            for _ in range(self.num_experts)
        ])

        # 4. 损失函数相关（可选，用于训练时平衡专家负载）
        self.router_aux_loss_coef = config.router_aux_loss_coef  # 路由器辅助损失系数

    def forward(self, hidden_states: torch.Tensor) -&gt; tuple[torch.Tensor, torch.Tensor]:
        """
        前向传播：输入特征 → 路由器选专家 → 专家计算 → 融合输出
        Args:
            hidden_states: 输入特征，形状为 [batch_size, seq_len, hidden_size]
        Returns:
            output: 融合后的输出特征，形状同输入
            router_aux_loss: 路由器辅助损失（用于训练时优化专家负载均衡）
        """
        # ===== 步骤1：计算路由器输出（专家权重）=====
        # 输入通过线性层得到每个专家的原始分数（logits）
        # 形状：[batch_size, seq_len, num_experts]
        router_logits = self.gate(hidden_states)

        # ===== 步骤2：选择Top-K专家并计算权重 =====
        # 对每个token，选择分数最高的num_experts_per_tok个专家
        # top_k_weights: 选中专家的权重（经softmax归一化），形状 [batch_size, seq_len, num_experts_per_tok]
        # top_k_indices: 选中专家的索引，形状 [batch_size, seq_len, num_experts_per_tok]
        top_k_weights, top_k_indices = torch.topk(router_logits, self.num_experts_per_tok, dim=-1)
        top_k_weights = nn.functional.softmax(top_k_weights, dim=-1, dtype=torch.float32)

        # ===== 步骤3：计算路由器辅助损失（可选，训练用）=====
        # 目的是鼓励专家负载均衡，避免少数专家被频繁选中
        # 计算方式：对router_logits做softmax后取均值，再求负熵（简化实现）
        if self.training:
            # 先对专家分数做softmax，得到每个专家被选中的概率
            router_probs = nn.functional.softmax(router_logits, dim=-1, dtype=torch.float32)
            # 计算每个专家的平均负载（跨batch和seq_len）
            expert_load = torch.mean(router_probs, dim=(0, 1))  # 形状 [num_experts]
            # 辅助损失：鼓励负载均衡（熵越大，分布越均衡）
            router_aux_loss = torch.sum(expert_load * torch.log(expert_load + 1e-10))  # 负熵
            router_aux_loss *= self.router_aux_loss_coef  # 乘以系数
        else:
            router_aux_loss = torch.tensor(0.0, device=hidden_states.device)  # 推理时无损失

        # ===== 步骤4：准备输入，分发到选中的专家 =====
        # 调整输入形状为 [batch_size * seq_len, hidden_size]，便于批量处理
        batch_size, seq_len, hidden_size = hidden_states.shape
        hidden_states = hidden_states.view(-1, hidden_size)  # 形状 [total_tokens, hidden_size]，total_tokens = batch_size * seq_len

        # 调整选中专家索引形状：[total_tokens, num_experts_per_tok]
        top_k_indices = top_k_indices.view(-1, self.num_experts_per_tok)  # [total_tokens, k]
        # 调整权重形状：[total_tokens, num_experts_per_tok, 1]（便于广播）
        top_k_weights = top_k_weights.view(-1, self.num_experts_per_tok, 1)  # [total_tokens, k, 1]

        # ===== 步骤5：专家计算与结果融合 =====
        # 初始化输出张量
        final_output = torch.zeros(
            (batch_size * seq_len, hidden_size),  # 与输入同形状
            dtype=hidden_states.dtype,
            device=hidden_states.device
        )

        # 遍历每个专家，处理所有选中该专家的token
        for expert_idx in range(self.num_experts):
            # 找到所有选中当前专家的token索引
            # 掩码：[total_tokens, k] → True表示该位置选中了当前专家
            expert_mask = (top_k_indices == expert_idx)  # [total_tokens, k]
            # 若没有token选中当前专家，跳过
            if not expert_mask.any():
                continue

            # 收集选中当前专家的token及其对应的权重
            # 1. 提取这些token的输入特征
            expert_input = hidden_states[expert_mask.any(dim=1)]  # [num_tokens_for_this_expert, hidden_size]
            # 2. 提取这些token对当前专家的权重（取第一个匹配的权重，因每个位置最多选k个专家）
            expert_weights = top_k_weights[expert_mask]  # [num_tokens_for_this_expert, 1]

            # 3. 当前专家处理输入
            expert_output = self.experts[expert_idx](expert_input)  # [num_tokens_for_this_expert, hidden_size]
            # 4. 加权：用该专家的权重乘以输出
            expert_output = expert_output * expert_weights  # [num_tokens_for_this_expert, hidden_size]

            # 5. 将结果累加至最终输出（对应位置）
            final_output[expert_mask.any(dim=1)] += expert_output

        # ===== 步骤6：恢复输出形状并返回 =====
        final_output = final_output.view(batch_size, seq_len, hidden_size)  # [batch_size, seq_len, hidden_size]
        return final_output, router_aux_loss
</code></pre>
<h2 data-id="heading-9">三、QWen3 部署实战</h2>
<p>你可以在 Hugging Face Hub 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fcollections%2FQwen%2Fqwen3-67dd247413f0e2e4f653967f" target="_blank" title="https://huggingface.co/collections/Qwen/qwen3-67dd247413f0e2e4f653967f" ref="nofollow noopener noreferrer">Qwen3 collection</a> 或 ModelScope 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fcollections%2FQwen3-9743180bdc6b48" target="_blank" title="https://www.modelscope.cn/collections/Qwen3-9743180bdc6b48" ref="nofollow noopener noreferrer">Qwen3 collection</a> 中获取 Qwen3 模型。</p>
<pre><code class="hljs language-Plain" lang="Plain">使用 huggingface-cli 命令行工具：
安装依赖：首先确保已安装huggingface_hub，可运行命令pip install -U huggingface_hub。
设置镜像地址：为提高下载速度，可设置国内镜像，如export HF_ENDPOINT=https://hf-mirror.com（Linux 系统）。
下载模型：使用huggingface-cli download命令下载，例如huggingface-cli download --resume-download gpt2 --local-dir gpt2，将gpt2模型下载到当前目录下的gpt2文件夹中。若要下载特定文件，可在模型名称后添加文件名，如huggingface-cli download gpt2 config.json。
</code></pre>
<pre><code class="hljs language-Plain" lang="Plain">huggingface-cli download Qwen/Qwen3-4B-Thinking-2507 --local-dir Qwen3-4B-Thinking-2507
</code></pre>
<p>huggingface 中下载的文件：</p>
<pre><code class="hljs language-Plain" lang="Plain">├── config.json
├── generation_config.json
├── LICENSE
├── merges.txt
├── model-00001-of-00003.safetensors
├── model-00002-of-00003.safetensors
├── model-00003-of-00003.safetensors
├── model.safetensors.index.json
├── README.md
├── tokenizer_config.json
├── tokenizer.json
└── vocab.json
</code></pre>
<h4 data-id="heading-10">文件说明</h4>
<ul>
<li><code>config.json</code>
<ul>
<li>模型的结构配置文件，比如隐藏层维度、层数、注意力头数、激活函数等。</li>
<li><code>AutoModelForCausalLM.from_pretrained()</code> 会先读取它，决定用哪种架构初始化模型。</li>
</ul>
</li>
<li><code>generation_config.json</code>
<ul>
<li>文本生成时的默认参数，例如 <code>max_new_tokens</code>， <code>temperature</code>， <code>top_p</code>， <code>do_sample</code> 等。</li>
<li>如果你用 <code>model.generate()</code>，没手动传参数，就会用这里的默认值。</li>
</ul>
</li>
<li><code>merges.txt</code>
<ul>
<li>BPE （Byte Pair Encoding） 分词的合并规则文件。</li>
<li>跟 <code>vocab.json</code> 一起定义了 tokenizer 的词表。</li>
</ul>
</li>
<li><code>vocab.json</code>
<ul>
<li>tokenizer 的词表文件，存储了 token 到 ID 的映射。</li>
<li>例如 <code>"hello" -&gt; 1234</code>。</li>
</ul>
</li>
<li><code>tokenizer.json</code>
<ul>
<li>Hugging Face 的标准 tokenizer 文件，包含 vocab 和 merges 的完整定义。</li>
<li>用 <code>AutoTokenizer.from_pretrained()</code> 会加载它。</li>
</ul>
</li>
<li><code>tokenizer_config.json</code>
<ul>
<li>Tokenizer 的额外参数，比如是否大小写敏感、padding/truncation 策略等。</li>
</ul>
</li>
<li><code>model-00001-of-00003.safetensors</code><strong>, ​</strong><code>model-00002-of-00003.safetensors</code><strong>, ​</strong><code>model-00003-of-00003.safetensors</code>
<ul>
<li>模型的权重文件，分成了多个分片，每个几 GB。</li>
<li><code>safetensors</code> 是一种比 <code>pytorch_model.bin</code> 更安全和高效的格式。</li>
</ul>
</li>
<li><code>model.safetensors.index.json</code>
<ul>
<li>权重索引文件，指明每个参数在分片文件中的位置。</li>
<li>加载模型时，transformers 会先读这个文件，再去对应分片里加载。</li>
</ul>
</li>
</ul>
<p>将 huggingface 中的文件全部下载到 "。/Qwen/Qwen3-4B-Thinking-2507"文件夹</p>
<p>在 docker 环境中安装（torch 2.3.0）：</p>
<pre><code class="hljs language-Plain" lang="Plain">pip3 install transformers==4.55.0
pip3 install accelerate
</code></pre>
<p>部署代码：</p>
<pre><code class="hljs language-Plain" lang="Plain">from transformers import AutoModelForCausalLM, AutoTokenizer
#下载的权重文件的路径
model_name = "./Qwen/Qwen3-4B-Thinking-2507"

# load the tokenizer and the model
model = AutoModelForCausalLM.from_pretrained(
    model_name,
    torch_dtype="auto",
    device_map="auto"
)
tokenizer = AutoTokenizer.from_pretrained(model_name)

# prepare the model input
prompt = "你怎么认为普京"
messages = [
    {"role": "user", "content": prompt},
]
text = tokenizer.apply_chat_template(
    messages,
    tokenize=False,
    add_generation_prompt=True,
    enable_thinking=True, # Switches between thinking and non-thinking modes. Default is True.
)
model_inputs = tokenizer([text], return_tensors="pt").to(model.device)

# conduct text completion
g
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RocketMQ从实战到源码：初识RocketMQ]]></title>    <link>https://juejin.cn/post/7591705084671164454</link>    <guid>https://juejin.cn/post/7591705084671164454</guid>    <pubDate>2026-01-05T13:28:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591705084671164454" data-draft-id="7591687981688520750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RocketMQ从实战到源码：初识RocketMQ"/> <meta itemprop="keywords" content="后端,RocketMQ,Java"/> <meta itemprop="datePublished" content="2026-01-05T13:28:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RocketMQ从实战到源码：初识RocketMQ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T13:28:35.000Z" title="Mon Jan 05 2026 13:28:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RocketMQ从实战到源码：初识RocketMQ</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c33ed4ee428469db4621f0d3f673b67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=7W%2Bh9gCSUkJP5eC1EuEBSdbnlao%3D" alt="rocketmq封面.png" loading="lazy"/></p>
<h3 data-id="heading-1">前言</h3>
<p>接下来就是开启新一阶段的技术学习，要不断补充技能，于是我就开启了自己的 RocketMQ 技术，本次学习依旧是视频+AI+动手的方式进行学习，并持续产出文档。2025-12-30创建栏目，说要学习，一直出差，拖到现在!!!</p>
<h3 data-id="heading-2">1 RocketMQ 介绍</h3>
<p><strong>RocketMQ</strong> 是一个<strong>分布式、队列模型的开源消息中间件</strong>，由阿里巴巴团队最初开发，并于2016年捐赠给<strong>Apache软件基金会</strong>，2017年成为Apache顶级项目。它旨在处理海量消息的<strong>高吞吐、低延迟、高可用、高可靠</strong>的传输，是构建大型分布式系统的核心基础设施。</p>
<h4 data-id="heading-3">1.1 基本概念</h4>
<ul>
<li>NameServer：可以看成是注册中心，负责更新和发现 Broker 服务，在 NameServer 集群中，NameServer 之间是没有相互通信的，它是无状态的。</li>
<li>Broker：可以理解是消息中转角色，负责消息的存储与转化，接收生产者发送来的消息，并将其持久化到磁盘，根据消费者的拉取请求，将存储的消息投递出去；当用户发送消息到 Broker 时，Broker 会将消息转发到关联的 Topic 中。</li>
</ul>
<h5 data-id="heading-4">1.1.1 核心组件与结构</h5>
<ul>
<li><strong>主题（Topic）</strong>：消息传输和存储的顶层容器，用于标识同一类业务逻辑的消息，通过  唯一标识。</li>
<li><strong>消息队列（MessageQueue）</strong>：消息存储和传输的实际容器，也是最小存储单元。主题由多个队列组成，通过  唯一标识。</li>
<li><strong>消息（Message）</strong>：最小数据传输单元，包含业务数据的负载和拓展属性。</li>
<li><strong>消息视图（MessageView）</strong>：面向开发视角提供的一种消息<strong>只读</strong>接口，用于读取消息属性和负载信息，不能修改消息本身。</li>
</ul>
<h5 data-id="heading-5">1.1.2 消息分类与属性</h5>
<ul>
<li><strong>消息类型（MessageType）</strong>：按照消息传输特性定义的分类，包括：
<ul>
<li>普通消息</li>
<li>顺序消息</li>
<li>事务消息</li>
<li>定时/延时消息</li>
<li><em>从5.0版本开始，每个主题只允许发送一种消息类型，该强制校验功能默认开启。</em></li>
</ul>
</li>
<li><strong>消息标签（MessageTag）</strong>：主题层级下细粒度的消息分类属性，消费者可订阅特定标签进行过滤。</li>
<li><strong>消息索引（MessageKey）</strong>：面向消息的索引属性，用于快速查找消息。</li>
</ul>
<h5 data-id="heading-6">1.1.3 消息位置与进度</h5>
<ul>
<li><strong>消息位点（MessageQueueOffset）</strong>：消息在队列中的唯一  类型坐标，按到达服务端的顺序存储。</li>
<li><strong>消费位点（ConsumerOffset）</strong>：每个<strong>消费者分组</strong>记录消费过的最新一条消息的位点。</li>
<li><strong>重置消费位点</strong>：以时间轴为坐标，重新设置消费者分组对已订阅主题的消费进度。</li>
</ul>
<h5 data-id="heading-7">1.1.4 生产者相关</h5>
<ul>
<li><strong>生产者（Producer）</strong>：构建并传输消息到服务端的运行实体，通常集成在业务系统中。</li>
<li><strong>事务检查器（TransactionChecker）</strong>：生产者用于执行本地事务检查和异常事务恢复的监听器。</li>
<li><strong>事务状态（TransactionResolution）</strong>：事务消息发送过程中，事务提交的状态标识，包括：
<ul>
<li>事务提交</li>
<li>事务回滚</li>
<li>事务未决</li>
</ul>
</li>
</ul>
<h5 data-id="heading-8">1.1.5 消费者相关</h5>
<ul>
<li><strong>消费者分组（ConsumerGroup）</strong>：承载多个消费行为一致的消费者的<strong>逻辑分组</strong>，用于实现负载均衡和高可用。</li>
<li><strong>消费者（Consumer）</strong>：接收并处理消息的运行实体。</li>
<li><strong>消费结果（ConsumeResult）</strong>： 消费监听器返回的消息处理结果，包含<strong>消费成功</strong>和<strong>消费失败</strong>。</li>
<li><strong>订阅关系（Subscription）</strong>：消费者获取和处理消息的规则与状态配置，包括过滤规则和消费进度维护。</li>
</ul>
<h5 data-id="heading-9">1.1.6 高级功能与状态</h5>
<ul>
<li><strong>消息过滤</strong>：消费者通过订阅指定消息标签（Tag）进行过滤，过滤计算在服务端完成。</li>
<li><strong>消息轨迹</strong>：消息从生产到消费完整链路中各节点的时间、地点等数据，用于问题排查。</li>
<li><strong>消息堆积</strong>：消息已发送到服务端，但因消费者消费能力有限，未能及时消费的状态。</li>
<li><strong>事务消息</strong>：保障分布式场景下消息生产和本地事务最终一致性的高级消息类型。</li>
<li><strong>定时/延时消息</strong>：发送至服务端后，在指定时间后才能被消费的高级消息类型。</li>
<li><strong>顺序消息</strong>：支持消费者按照发送先后顺序获取和处理消息的高级消息类型。</li>
</ul>
<h3 data-id="heading-10">1.2 RocketMQ 工作原理</h3>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/960cb43b4940490bb02bbd4ef05c71ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=td%2BSMWiOT3BTPc%2B831ahuzKK0h4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>官网介绍：</p>
<p>RocketMQ 5.0 引入了全新的弹性无状态代理模式，将当前的Broker职责进行拆分，对于客户端协议适配、权限管理、消费管理等计算逻辑进行抽离，独立无状态的代理角色提供服务，Broker则继续专注于存储能力的持续优化。这套模式可以更好地实现在云环境的资源弹性调度。 值得注意的是RocketMQ 5.0的全新模式是和4.0的极简架构模式相容相通的，5.0的代理架构完全可以以Local模式运行，实现与4.0架构完全一致的效果。开发者可以根据自身的业务场景自由选择架构部署。</p>
</blockquote>
<h3 data-id="heading-11">2 安装 RocketMQ</h3>
<h4 data-id="heading-12">2.1 下载 RocketMQ</h4>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq.apache.org%2F" target="_blank" title="https://rocketmq.apache.org/" ref="nofollow noopener noreferrer">RocketMQ · 官方网站 | RocketMQ</a></p>
<p>github:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Frocketmq" target="_blank" title="https://github.com/apache/rocketmq" ref="nofollow noopener noreferrer">GitHub - apache/rocketmq: Apache RocketMQ is a cloud native messaging and streaming platform, making it simple to build event-driven applications.</a></p>
<p>本次使用的版本是 5.3.0</p>
<h4 data-id="heading-13">2.2 安装 RocketMQ</h4>
<p>首先需要准备一台 centos 的虚拟机或服务器，并且需要安装 jdk，具体可以看看网上教程，这里不再赘述。</p>
<h4 data-id="heading-14">2.2.1上传安装包</h4>
<p>通过使用 shell 工具将压缩包上传到虚拟机上：/usr/rocketmq ，我懒得在弄分类了，反正是虚拟机做测试，我就是直接上传解压。</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost rocketmq]# cd /usr/rocketmq
<span class="hljs-meta prompt_"># </span><span class="bash">如果想要管理可用以下命令</span>
[root@localhost rocketmq]# mv rocketmq-all-5.3.0-bin-release /your/folder
[root@localhost rocketmq]# unzip rocketmq-all-5.3.0-bin-release.zip
[root@localhost rocketmq-all-5.3.0-bin-release]# ll
总用量 100
drwxr-xr-x. 2 root root   126 7月  10 2024 benchmark
drwxrwxr-x. 4 root root  4096 12月 30 00:03 bin
drwxr-xr-x. 8 root root  4096 7月  10 2024 conf
drwxr-xr-x. 2 root root  8192 7月  10 2024 lib
-rw-rw-r--. 1 root root 17327 7月   8 2024 LICENSE
-rw-------. 1 root root 44535 12月 28 13:24 nohup.out
-rw-rw-r--. 1 root root  1338 7月   8 2024 NOTICE
-rw-rw-r--. 1 root root 12266 7月   8 2024 README.md
</code></pre>
<blockquote>
<p>bin：脚本目录，包含启动、停止和管理RocketMQ的各种脚本。</p>
<p>conf：配置文件目录，存放所有配置文件。</p>
<p>lib：依赖库目录，包含RocketMQ运行所需的所有JAR包，包括客户端、工具等 。</p>
<p>benchmark：性能测试工具</p>
</blockquote>
<h4 data-id="heading-15">2.2.2 配置 RocketMQ 环境变量</h4>
<pre><code class="hljs language-shell" lang="shell">[root@localhost rocketmq]# vi /etc/profile
<span class="hljs-meta prompt_"># </span><span class="bash">配置rocketmq路径</span>
export ROCKETMQ_HOME=/usr/rocketmq/rocketmq-all-5.3.0-bin-release
</code></pre>
<h4 data-id="heading-16">2.2.3 更新配置</h4>
<pre><code class="hljs language-shell" lang="shell">[root@localhost rocketmq]# source /etc/profile
</code></pre>
<p>ROCKETMQ_HOME 的环境变量不配置的话，可能会在启动 NameServer 和 Broker 的时候报错。</p>
<h4 data-id="heading-17">2.2.4 启动服务</h4>
<p>RocketMQ 需要启动两个，一个是 NameServer，另一个是 Broker。</p>
<p>① 启动 NameServer 服务</p>
<p>启动 NameServer 服务只需要在 rocketmq/bin 下有个吗 mqnamesrv。启动这个就行，但是其默认配置文件设置的 JVM 内存是 4G，这里我们需要修改，直接修改 runserver.sh</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost rocketmq]# cd /usr/rocketmq/rocketmq-all-5.3.0-bin-release/bin
[root@localhost bin]# vi runserver.sh
</code></pre>
<blockquote>
<p>JAVA_OPT="${JAVA_OPT} -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"</p>
<p>改为</p>
<p>JAVA_OPT="${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"</p>
</blockquote>
<p>然后启动</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost bin]# nohup ./mqnamesrv &amp;
<span class="hljs-meta prompt_"># </span><span class="bash">查看日志</span>
[root@localhost bin]# tail -f nohup.out
</code></pre>
<p>显示 The Name Server boot success 就表示启动成功。</p>
<p>② 启动 Broker 服务</p>
<p>启动的脚本是 runbroker，但是这里默认配置内存是 8G，如果不够，需要调整一下 JVM 内存，修改 runbroker.sh 文件。</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost rocketmq]# cd /usr/rocketmq/rocketmq-all-5.3.0-bin-release/bin
[root@localhost bin]# vi runbroker.sh
</code></pre>
<blockquote>
<p>JAVA_OPT="${JAVA_OPT} -server -Xms8g -Xmx8g"</p>
<p>改为</p>
<p>JAVA_OPT="${JAVA_OPT} -server -Xms512m -Xmx512m"</p>
</blockquote>
<p>修改 broker 配置文件</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost bin]# cd /usr/rocketmq/rocketmq-all-5.3.0-bin-release/conf
[root@localhost conf]# vi broker.conf
<span class="hljs-meta prompt_"># </span><span class="bash">允许自动创建topic</span>
autoCreateTopicEnable=true
<span class="hljs-meta prompt_"># </span><span class="bash">添加nameserver地址</span>
namesrvAddr=localhost:9876
</code></pre>
<p>启动 broker</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost bin]# nohup ./mqbroker &amp;
<span class="hljs-meta prompt_"># </span><span class="bash">查看日志</span>
[root@localhost bin]# tail -f nohup.out
[root@localhost bin]# jps
</code></pre>
<p>通过 jps 可以看到启动的 nameserve 和 broker 服务。</p>
<h4 data-id="heading-18">2.2.5 关闭服务</h4>
<pre><code class="hljs language-shell" lang="shell">sh ./mqshutdown broker
sh ./myshutdown namesrv
</code></pre>
<h3 data-id="heading-19">3 安装 rockermq-dashboard</h3>
<p>安装 rocketmq 可视化界面，需要自行对代码进行编译打包，下载代码包，使用 idea 打开进行打包，这个过程不赘述。</p>
<h4 data-id="heading-20">3.1 运行可视化看板</h4>
<p>将打包好的 jar 包放到虚拟机中，直接通过 java -jar 的方式进行运行即可。</p>
<pre><code class="hljs language-shell" lang="shell">[root@localhost bin]# cd /usr/rocketmq
[root@localhost rocketmq]# java -jar rocketmq-dashboard-2.0.0.jar 1&gt;dashboard.log 2&gt;&amp;1 &amp;
</code></pre>
<p>启动完毕可以通过：<a href="https://link.juejin.cn?target=http%3A%2F%2F192.168.109.134%3A8080%2F%23%2F" target="_blank" title="http://192.168.109.134:8080/#/" ref="nofollow noopener noreferrer">http://192.168.109.134:8080/#/</a> 查看</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb883f61b67d431f9d171bc032ec8765~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=wsGd1LzarTb%2FOPnqUHdz8CrE1dg%3D" alt="" loading="lazy"/></p>
<p>（集群部署后续有时间补充...）</p>
<h3 data-id="heading-21">4 简单案例</h3>
<blockquote>
<p>可以参考源码里面的测试代码：rocketmq-example 模块下的 org.apache.rocketmq.example 包</p>
</blockquote>
<p>需要先在 pom 引入坐标依赖</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.rocketmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rocketmq-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-22">4.1 生产者</h4>
<p>消息生产者的 3 种消息发送方法</p>
<ul>
<li>同步方法：等待消息返回后再继续进行下面的操作。</li>
<li>异步方法：不等待消息返回直接进入后续流程，broker 将结果返回后调用 callback 函数，并使用 CountDownLatch 计数。</li>
<li>单向方法：只负责发送，不管消息是否发送成功。</li>
</ul>
<p>① 同步发送</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 同步发送
 * <span class="hljs-doctag">@author</span>: lyd
 * <span class="hljs-doctag">@date</span>: 2025/12/29 23:51
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRODUCER_GROUP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Test01"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_NAMESRVADDR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"192.168.109.134:9876"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Topic-Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException, UnsupportedEncodingException, MQBrokerException, RemotingException, InterruptedException {
        <span class="hljs-comment">// 使用生产者组名进行实例化</span>
        <span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(PRODUCER_GROUP);
        producer.setNamesrvAddr(DEFAULT_NAMESRVADDR);
        producer.start();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) {
            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(TOPIC,
                    TAG,
                    (<span class="hljs-string">"Hello RocketMQ "</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)
            );
            <span class="hljs-comment">// 调用发送消息以将消息传递到代理之一。</span>
            <span class="hljs-type">SendResult</span> <span class="hljs-variable">sendResult</span> <span class="hljs-operator">=</span> producer.send(msg, <span class="hljs-number">20</span> * <span class="hljs-number">1000</span>);
            System.out.printf(<span class="hljs-string">"发送成功%s%n"</span>, sendResult);
        }
        <span class="hljs-comment">/*
         * 当生产者实例不再使用时关闭。
         */</span>
        producer.shutdown();
    }
}

</code></pre>
<p>如下就代表发送成功</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bef789ea13e4580ac88f4fa435355dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=R8wadjSwpYU0pCj%2BsZb8NosIP4U%3D" alt="" loading="lazy"/></p>
<p>② 异步发送</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: lyd
 * <span class="hljs-doctag">@date</span>: 2025/12/30 00:09
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRODUCER_GROUP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Test02"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_NAMESRVADDR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"192.168.109.134:9876"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Topic-Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException, UnsupportedEncodingException, MQBrokerException, RemotingException, InterruptedException {
        <span class="hljs-comment">// 使用生产者组名进行实例化</span>
        <span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(PRODUCER_GROUP);
        producer.setNamesrvAddr(DEFAULT_NAMESRVADDR);
        producer.start();
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(MESSAGE_COUNT);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) {
            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(TOPIC,
                                      TAG,
                                      (<span class="hljs-string">"异步发送：Hello RocketMQ "</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)
                                     );
            <span class="hljs-comment">// 调用发送消息以将消息传递到代理之一。</span>
            producer.send(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendCallback</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(SendResult sendResult)</span> {
                    countDownLatch.countDown();
                    System.out.printf(<span class="hljs-string">"异步发送成功%s%n"</span>, sendResult);
                }
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onException</span><span class="hljs-params">(Throwable throwable)</span> {
                    countDownLatch.countDown();
                    System.out.printf(<span class="hljs-string">"异步发送失败%s%n"</span>, throwable);
                }
            });
        }
        countDownLatch.await(<span class="hljs-number">5</span>, TimeUnit.SECONDS);
        <span class="hljs-comment">/*
         * 当生产者实例不再使用时关闭。
         */</span>
        producer.shutdown();
    }
}

</code></pre>
<p>如下就表示成功</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccce1cf4965241618206665dcee00c57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=GAq%2BCdte95LsuJ6VRFbE8sCXhGE%3D" alt="" loading="lazy"/></p>
<p>③ 单向发送</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 单向发送
 * <span class="hljs-doctag">@author</span>: lyd
 * <span class="hljs-doctag">@date</span>: 2025/12/30 22:57
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnewayProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRODUCER_GROUP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Test03"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_NAMESRVADDR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"192.168.109.134:9876"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Topic-Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Lyd"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException, UnsupportedEncodingException, MQBrokerException, RemotingException, InterruptedException {
        <span class="hljs-comment">// 使用生产者组名进行实例化</span>
        <span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(PRODUCER_GROUP);
        producer.setNamesrvAddr(DEFAULT_NAMESRVADDR);
        producer.start();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) {
            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(TOPIC,
                    TAG,
                    (<span class="hljs-string">"单发消息：Hello RocketMQ "</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)
            );
            <span class="hljs-comment">// 调用发送消息以将消息传递到代理之一。</span>
            producer.sendOneway(msg);
            System.out.printf(i + <span class="hljs-string">"-发送成功"</span>);
        }
        Thread.sleep(<span class="hljs-number">5000</span>);
        <span class="hljs-comment">/*
         * 当生产者实例不再使用时关闭。
         */</span>
        producer.shutdown();
    }
}
</code></pre>
<p>运行结果如下</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e30a61c404248f994787cbbda9606e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=etBkMQGVIoevAlNC%2Fsl4MZ12I%2FE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-23">4.2 消费者</h4>
<p>消息的生产者分为两种：</p>
<ul>
<li>拉模式：消费者主动到 broker 上去拉取。</li>
<li>推模式：消费者被动等待 broker 推送过来。</li>
</ul>
<p>① 拉模式</p>
<p>如下代码，我们通过订阅“Topic-Lyd”主题，循环进行拉取，通过获取注册的 topic，在进行便利主题的消息队列，通过计算偏移量来主动获取消息，最后打印读取的消息并且将偏移量后移。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PullConsumer</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException {
        <span class="hljs-type">DefaultMQPullConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPullConsumer</span>(<span class="hljs-string">"Test01"</span>);
        consumer.setNamesrvAddr(<span class="hljs-string">"192.168.109.134:9876"</span>);
        Set&lt;String&gt; topics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        topics.add(<span class="hljs-string">"Topic-Lyd"</span>);
        consumer.setRegisterTopics(topics);
        consumer.start();
        <span class="hljs-comment">// 循环拉取</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            consumer.getRegisterTopics().forEach(t -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 获取主题中的队列</span>
                    Set&lt;MessageQueue&gt; messageQueues = consumer.fetchMessageQueuesInBalance(t);
                    messageQueues.forEach(query -&gt; {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// 获取query的偏移量</span>
                            <span class="hljs-type">long</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> consumer.getOffsetStore().readOffset(query, ReadOffsetType.READ_FROM_MEMORY);
                            <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) {
                                offset = consumer.getOffsetStore().readOffset(query, ReadOffsetType.READ_FROM_STORE);
                            }
                            <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) {
                                offset = consumer.maxOffset(query);
                            }
                            <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) {
                                offset = <span class="hljs-number">0</span>;
                            }
                            <span class="hljs-comment">// 拉取query的消息，每次11条</span>
                            <span class="hljs-type">PullResult</span> <span class="hljs-variable">pullResult</span> <span class="hljs-operator">=</span> consumer.pull(query, <span class="hljs-string">"*"</span>, offset, <span class="hljs-number">11</span>);
<span class="hljs-comment">//                            System.out.printf("循环拉取消息ing %s%n", pullResult);</span>
                            <span class="hljs-keyword">switch</span> (pullResult.getPullStatus()) {
                                <span class="hljs-keyword">case</span> FOUND:
                                    pullResult.getMsgFoundList().forEach(p -&gt; {
                                        System.out.println(<span class="hljs-string">"消息拉取成功："</span> + p);
                                    });
                                    <span class="hljs-comment">// 更新偏移量</span>
                                    consumer.updateConsumeOffset(query, pullResult.getNextBeginOffset());
                            }
                        } <span class="hljs-keyword">catch</span> (MQClientException e) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                        } <span class="hljs-keyword">catch</span> (MQBrokerException e) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                        } <span class="hljs-keyword">catch</span> (RemotingException e) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                        }
                    });
                } <span class="hljs-keyword">catch</span> (MQClientException e) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                }
            });
        }
    }
}
</code></pre>
<p>当我启动一个生产者推送数据的时候，这里就能看到拉取成功</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6b5db87efd647ab81603206c24bf203~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224515&amp;x-signature=1tLgHOQfHXiQrTN0RvGtoBoQqzI%3D" alt="" loading="lazy"/></p>
<p>② 推模式</p>
<p>以下例子是通过设置消息监听器：MessageListenerConcurrently 进行获取得到消息并进行消费。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException {
        <span class="hljs-comment">// 创建默认的推模式消费者实例，消费者组名为"Test01"</span>
        <span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">"Test01"</span>);
        
        <span class="hljs-comment">// 设置NameServer地址，用于连接RocketMQ集群</span>
        consumer.setNamesrvAddr(<span class="hljs-string">"192.168.109.134:9876"</span>);
        
        <span class="hljs-comment">// 订阅主题"Topic-Lyd"，"*"表示订阅所有标签的消息</span>
        consumer.subscribe(<span class="hljs-string">"Topic-Lyd"</span>, <span class="hljs-string">"*"</span>);
        
        <span class="hljs-comment">// 设置消息监听器，处理接收到的消息</span>
        consumer.setMessageListener((MessageListenerConcurrently) (list, consumeConcurrentlyContext) -&gt; {
            <span class="hljs-comment">// 遍历消息列表并打印每条消息</span>
            list.forEach(m -&gt; {
                System.out.println(<span class="hljs-string">"收到消息："</span> + m);
            });
            <span class="hljs-comment">// 返回消费成功状态</span>
            <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
        });
        
        <span class="hljs-comment">// 启动消费者</span>
        consumer.start();
        System.out.println(<span class="hljs-string">"消费者已启动！"</span>);
    }
}
</code></pre>
<h3 data-id="heading-24">5 总结</h3>
<p>RocketMQ 就是一个高性能的消息中转站，让系统之间解耦、异步、可靠地通信。安装时注意改内存，使用时先启动 NameServer 和 Broker，然后按需选择收发方式即可。本文介绍了什么 RocketMQ 以及单机安装和简单的案例，对于集群部署，因为这篇文章是我弄完之后的产出，集群部署要截图的比较多，后续在重新整理。</p>
<hr/>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德 @一个有梦有戏的人</strong><br/>
持续创作很不容易，作者将以尽可能的详细把所学知识分享各位开发者，一起进步一起学习。<strong>转载请携带链接，转载到微信公众号请勿选择原创，谢谢！</strong><br/>
👍创作不易，如有错误请指正，感谢观看！记得点赞哦！👍<br/>
谢谢支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RuoYi-Vue-Plus + Camunda 7.18：强强联合的解决方案]]></title>    <link>https://juejin.cn/post/7591655106724511744</link>    <guid>https://juejin.cn/post/7591655106724511744</guid>    <pubDate>2026-01-05T13:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591655106724511744" data-draft-id="7591703562134044706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RuoYi-Vue-Plus + Camunda 7.18：强强联合的解决方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T13:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RuoYi-Vue-Plus + Camunda 7.18：强强联合的解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T13:34:07.000Z" title="Mon Jan 05 2026 13:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">企业工作流管理的核心痛点</h2>
<p>在数字化转型浪潮中，企业普遍面临工作流管理的多重挑战：</p>
<p><strong>审批流程复杂难管理</strong>：传统的硬编码审批逻辑散落在代码各处，流程变更需要频繁修改代码、重新部署，维护成本极高。企业经常遇到"老板说3000元以上的费用需要财务总监审批"这样的需求变更，开发团队只能改代码、发版，周期长且风险高。</p>
<p><strong>系统集成困难</strong>：不同业务系统之间缺乏统一的工作流标准，导致审批数据割裂、跨系统协作效率低下。企业无法实现端到端的流程可视化和统一监控。</p>
<p><strong>定制化能力不足</strong>：随着业务复杂度提升，企业需要支持动态加签、转办、委派、驳回到任意节点等复杂场景，传统方案难以灵活应对。</p>
<h2 data-id="heading-1">RuoYi-Vue-Plus + Camunda 7.18：强强联合的解决方案</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef4c81e3c3fe467eb3c128973900caec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768224847&amp;x-signature=ZfLVJXcxYdqJ2uQiQxEvOfeHK9g%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">技术架构优势</h3>
<p><strong>前端技术栈</strong>：Vue3 + TypeScript + Element Plus，提供现代化的用户界面和开发体验。</p>
<p><strong>后端技术栈</strong>：Spring Boot 3.x + JDK 17/21，支持分布式集群部署，内置分布式锁、分布式任务调度等企业级特性。</p>
<p><strong>工作流引擎</strong>：Camunda 7.18.0，基于BPMN 2.0标准，提供完整的流程设计、执行、监控能力。</p>
<h3 data-id="heading-3">核心功能特性</h3>
<p><strong>1. 零代码流程建模</strong></p>
<ul>
<li>集成bpmn.js流程编辑器，支持在线拖拽式流程设计</li>
<li>支持排他网关、并行网关、包含网关等复杂场景</li>
<li>动态配置流程发起表单、任务节点表单、处理人、监听器</li>
</ul>
<p><strong>2. 丰富的审批场景</strong></p>
<ul>
<li>支持转办、委派、加签、减签、会签、或签、票签</li>
<li>支持驳回到任意节点、直接提交到驳回岗</li>
<li>支持流程撤回、交还、进度高亮显示</li>
</ul>
<p><strong>3. 多租户支持</strong></p>
<ul>
<li>内置完整的租户管理体系，支持租户套餐管理、用户数量控制</li>
<li>动态数据源切换，实现数据隔离</li>
<li>企业信息管理，适合SaaS化部署</li>
</ul>
<p><strong>4. 强大的集成能力</strong></p>
<ul>
<li>支持外部任务，可作为流程中心调度多个业务系统协同工作</li>
<li>提供页面内嵌方案，业务系统可像使用自己系统功能一样使用流程平台</li>
<li>支持与ERP、CRM、OA等第三方系统无缝对接</li>
</ul>
<h3 data-id="heading-4">性能与稳定性</h3>
<p><strong>高可用架构</strong>：支持多节点集群部署，通过分布式锁确保数据一致性，分布式任务调度支持DAG任务流和分片重试。</p>
<p><strong>性能优化</strong>：基于Camunda 7.18的性能优化版本，在1000并发测试中执行时间比同类产品快20%，且无死锁报错，稳定性显著优于市场同类产品。</p>
<p>近期<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">www.ruoyiflow.com</a>  将若依工作流集成camunda7.18 实现集成方案， 如果您有需要，关注我们网站更新。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GDAL 实现创建几何对象]]></title>    <link>https://juejin.cn/post/7591708519448707081</link>    <guid>https://juejin.cn/post/7591708519448707081</guid>    <pubDate>2026-01-05T12:14:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591708519448707081" data-draft-id="7591694511246164006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GDAL 实现创建几何对象"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T12:14:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GDAL 实现创建几何对象
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:14:06.000Z" title="Mon Jan 05 2026 12:14:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>几何对象作为图层要素对象，具有点、线、面、多点、多线、多线等多种类型。每种类型都有自己独特的结构，在GIS开发中，需要掌握其组成结构和创建方式。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<code>GDAL</code>实现创建几何对象。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQtb_BJw91nKrFMeoa7WcxA" target="_blank" title="https://mp.weixin.qq.com/s/Qtb_BJw91nKrFMeoa7WcxA" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFLWfZItLj24JYicQEX-PbQ" target="_blank" title="https://mp.weixin.qq.com/s/FLWfZItLj24JYicQEX-PbQ" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fu0539e3CM2q4Y3MbMxxZKQ" target="_blank" title="https://mp.weixin.qq.com/s/u0539e3CM2q4Y3MbMxxZKQ" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-2">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-3">2. 创建点几何对象</h2>
<p>定义一个方法<code>CreatePoint</code>用于创建点<code>Shp</code>图层，接收一个参数<code>pointPath</code>指向点文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：创建点Shp图层
参数：
    -pointPath：点文件路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">CreatePoint</span>(<span class="hljs-params">pointPath</span>):
</code></pre>
<p>在<code>GDAL</code>中使用<code>Geometry</code>方法创建点几何对象，需要传入一个几何对象类型参数，创建点时该参数为<code>ogr.wkbPoint</code>。<code>GeometryTypeToName</code>方法可以获取几何对象类型名称，如下输出“<code>Point</code>”。接着使用<code>AddPoint</code>将坐标点添加到点对象中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建点几何对象</span>
<span class="hljs-attr">pointGeometry</span> = ogr.Geometry(ogr.wkbPoint)
<span class="hljs-attr">geomeTypeName</span> = ogr.GeometryTypeToName(pointGeometry.GetGeometryType())
<span class="hljs-comment"># print(f"几何对象名称：{geomeTypeName}")</span>
<span class="hljs-comment"># 添加坐标点</span>
pointGeometry.AddPoint(100.225207,27.665721)
</code></pre>
<p>如下为创建点<code>Shp</code>图层完整方法。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：创建点几何对象
参数：
    -pointPath：点文件路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">CreatePoint</span>(<span class="hljs-params">pointPath</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始创建点对象"</span>)

    <span class="hljs-comment"># 添加shp数据驱动</span>
    shpDriver = gdal.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)

    checkShpPath(pointPath,shpDriver)

    <span class="hljs-comment"># 创建shp数据源</span>
    shpDataSource = shpDriver.CreateDataSource(pointPath)
    <span class="hljs-keyword">if</span> shpDataSource <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"无法创建点Shp数据源，请检查文件！"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># 创建点数据图层</span>
    pointLayer = shpDataSource.CreateLayer(<span class="hljs-string">"point"</span>,geom_type=ogr.wkbPoint)

    <span class="hljs-comment"># 添加id字段</span>
    fieldDefn = ogr.FieldDefn(<span class="hljs-string">"id"</span>,ogr.OFTInteger)
    pointLayer.CreateField(fieldDefn)

    <span class="hljs-comment"># 获取要素结构</span>
    featureDefn = pointLayer.GetLayerDefn()

    <span class="hljs-comment"># 创建要素对象</span>
    pointFeature = ogr.Feature(featureDefn)

    points = [
       <span class="hljs-string">"100.225207,27.665721"</span>,
       <span class="hljs-string">"105.330257,29.948948"</span>,
       <span class="hljs-string">"105.848739,23.856316"</span>,
       <span class="hljs-string">"99.567134,23.892995"</span>
    ]
    <span class="hljs-comment"># pointGeometry.AddPoint(100.225207,27.665721)</span>
    <span class="hljs-keyword">for</span> i,point <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):
        <span class="hljs-comment"># print(f"点：{point}")</span>
        res = point.split(<span class="hljs-string">","</span>)
        <span class="hljs-comment"># print(f"点：{res}")</span>

        <span class="hljs-comment"># 创建点几何对象</span>
        pointGeometry = ogr.Geometry(ogr.wkbPoint)
        geomeTypeName = ogr.GeometryTypeToName(pointGeometry.GetGeometryType())
        <span class="hljs-comment"># print(f"几何对象名称：{geomeTypeName}")</span>

        pointGeometry.AddPoint(<span class="hljs-built_in">float</span>(res[<span class="hljs-number">0</span>]),<span class="hljs-built_in">float</span>(res[<span class="hljs-number">1</span>]))

        pointFeature.SetGeometry(pointGeometry)
        pointFeature.SetField(<span class="hljs-string">"id"</span>,i)
        pointLayer.CreateFeature(pointFeature)
</code></pre>
<h2 data-id="heading-4">3. 创建线几何对象</h2>
<p>定义一个方法<code>CreatePolyline</code>用于创建点<code>Shp</code>图层，接收一个参数<code>polylinePath</code>指向线文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：创建线Shp图层
参数：
    -polylinePath：线文件路径
"""</span>   
<span class="hljs-keyword">def</span> <span class="hljs-title function_">CreatePolyline</span>(<span class="hljs-params">polylinePath</span>):
</code></pre>
<p>使用<code>Geometry</code>方法创建线几何对象，将几何对象类型改为<code>ogr.wkbLineString</code>。接着使用<code>AddPoint</code>将坐标点添加到线对象中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建线几何对象</span>
<span class="hljs-attr">polylineGeometry</span> = ogr.Geometry(ogr.wkbLineString)
<span class="hljs-attr">geomeTypeName</span> = ogr.GeometryTypeToName(polylineGeometry.GetGeometryType())
<span class="hljs-comment"># 添加坐标点</span>
polylineGeometry.AddPoint(100.225207,27.665721)
polylineGeometry.AddPoint(105.330257,29.948948)
polylineGeometry.AddPoint(105.848739,23.856316)
polylineGeometry.AddPoint(99.567134,23.892995)
</code></pre>
<p>如下为创建线<code>Shp</code>图层完整方法。</p>
<pre><code class="hljs language-scss" lang="scss">"""
说明：创建线Shp图层
参数：
    -polylinePath：线文件路径
"""   
def <span class="hljs-built_in">CreatePolyline</span>(polylinePath):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始创建线对象"</span>)

    # 添加shp数据驱动
    shpDriver = gdal.<span class="hljs-built_in">GetDriverByName</span>(<span class="hljs-string">"ESRI Shapefile"</span>)

    <span class="hljs-built_in">checkShpPath</span>(polylinePath,shpDriver)

    # 创建shp数据源
    shpDataSource = shpDriver.<span class="hljs-built_in">CreateDataSource</span>(polylinePath)
    if shpDataSource is None:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"无法创建点Shp数据源，请检查文件！"</span>)
        return False

    # 创建线数据图层
    polylineLayer = shpDataSource.<span class="hljs-built_in">CreateLayer</span>(<span class="hljs-string">"polyline"</span>,geom_type=ogr.wkbLineString)

    # 添加id字段
    fieldDefn = ogr.<span class="hljs-built_in">FieldDefn</span>(<span class="hljs-string">"id"</span>,ogr.OFTInteger)
    polylineLayer.<span class="hljs-built_in">CreateField</span>(fieldDefn)

    # 获取要素结构
    featureDefn = polylineLayer.<span class="hljs-built_in">GetLayerDefn</span>()

    # 创建要素对象
    pointFeature = ogr.<span class="hljs-built_in">Feature</span>(featureDefn)
    points = [
       <span class="hljs-string">"100.225207,27.665721"</span>,
       <span class="hljs-string">"105.330257,29.948948"</span>,
       <span class="hljs-string">"105.848739,23.856316"</span>,
       <span class="hljs-string">"99.567134,23.892995"</span>,
       <span class="hljs-string">"100.225207,27.665721"</span>
    ]
    # pointGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-number">100.225207</span>,<span class="hljs-number">27.665721</span>)
    # 创建线几何对象
    polylineGeometry = ogr.<span class="hljs-built_in">Geometry</span>(ogr.wkbLineString)
    geomeTypeName = ogr.<span class="hljs-built_in">GeometryTypeToName</span>(polylineGeometry.<span class="hljs-built_in">GetGeometryType</span>())
    polylineGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-number">100.225207</span>,<span class="hljs-number">27.665721</span>)
    polylineGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-number">105.330257</span>,<span class="hljs-number">29.948948</span>)
    polylineGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-number">105.848739</span>,<span class="hljs-number">23.856316</span>)
    polylineGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-number">99.567134</span>,<span class="hljs-number">23.892995</span>)
    # <span class="hljs-built_in">print</span>(f<span class="hljs-string">"几何对象名称：{geomeTypeName}"</span>)
    for i,point in <span class="hljs-built_in">enumerate</span>(points):
        # <span class="hljs-built_in">print</span>(f<span class="hljs-string">"点：{point}"</span>)
        res = point.<span class="hljs-built_in">split</span>(<span class="hljs-string">","</span>)
        # <span class="hljs-built_in">print</span>(f<span class="hljs-string">"点：{res}"</span>)

        polylineGeometry.<span class="hljs-built_in">AddPoint</span>(<span class="hljs-built_in">float</span>(res[<span class="hljs-number">0</span>]),<span class="hljs-built_in">float</span>(res[<span class="hljs-number">1</span>]))

    pointFeature.<span class="hljs-built_in">SetGeometry</span>(polylineGeometry)
    pointFeature.<span class="hljs-built_in">SetField</span>(<span class="hljs-string">"id"</span>,<span class="hljs-number">1</span>)

    polylineLayer.<span class="hljs-built_in">CreateFeature</span>(pointFeature)
</code></pre>
<h2 data-id="heading-5">4. 创建面几何对象</h2>
<p>定义一个方法<code>CreatePolygon</code>用于创建面<code>Shp</code>图层，接收一个参数<code>polygonPath</code>指向线文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：创建面Shp图层
参数：
    -polygonPath：面文件路径
"""</span>     
<span class="hljs-keyword">def</span> <span class="hljs-title function_">CreatePolygon</span>(<span class="hljs-params">polygonPath</span>):
</code></pre>
<p>在创建面几何对象之前需要先创建环形几何对象，类型参数为<code>ogr.wkbLinearRing</code>。</p>
<pre><code class="hljs language-scss" lang="scss"># 创建一个环形Geometry
ringGeometry = ogr<span class="hljs-selector-class">.Geometry</span>(ogr.wkbLinearRing)
geomeTypeName = ogr<span class="hljs-selector-class">.GeometryTypeToName</span>(ringGeometry.GetGeometryType())

ringGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.225207</span>,<span class="hljs-number">27.665721</span>)
ringGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">105.330257</span>,<span class="hljs-number">29.948948</span>)
ringGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">105.848739</span>,<span class="hljs-number">23.856316</span>)
ringGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">99.567134</span>,<span class="hljs-number">23.892995</span>)
</code></pre>
<p>然后使用<code>Geometry</code>方法创建线面何对象，将几何对象类型改为<code>ogr.wkbPolygon</code>。接着使用<code>AddGeometry</code>将环形对象添加到面中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建面几何对象</span>
<span class="hljs-attr">polygonGeometry</span> = ogr.Geometry(ogr.wkbPolygon)
<span class="hljs-comment"># 添加环形对象</span>
polygonGeometry.AddGeometry(ringGeometry)
</code></pre>
<p>此外还有一种带有孔洞的多边形需要注意一下，此时环形几何对象分为内环和外环两种类型。</p>
<pre><code class="hljs language-scss" lang="scss"># 创建一个外环Geometry
outRingGeometry = ogr<span class="hljs-selector-class">.Geometry</span>(ogr.wkbLinearRing)

outRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.225207</span>,<span class="hljs-number">27.665721</span>)
outRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">105.330257</span>,<span class="hljs-number">29.948948</span>)
outRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">105.848739</span>,<span class="hljs-number">23.856316</span>)
outRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">99.567134</span>,<span class="hljs-number">23.892995</span>)
outRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.225207</span>,<span class="hljs-number">27.665721</span>)
# 关闭环状几何
# outRingGeometry<span class="hljs-selector-class">.CloseRings</span>()

# 创建一个内环Geometry
inRingGeometry = ogr<span class="hljs-selector-class">.Geometry</span>(ogr.wkbLinearRing)

inRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.415207</span>,<span class="hljs-number">27.665721</span>)
inRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">104.550257</span>,<span class="hljs-number">27.665721</span>)
inRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">104.550257</span>,<span class="hljs-number">24.456316</span>)
inRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.415207</span>,<span class="hljs-number">24.456316</span>)
inRingGeometry<span class="hljs-selector-class">.AddPoint</span>(<span class="hljs-number">100.415207</span>,<span class="hljs-number">27.665721</span>)
# 关闭环状几何
# inRingGeometry<span class="hljs-selector-class">.CloseRings</span>()

# 创建面几何对象
polygonGeometry = ogr<span class="hljs-selector-class">.Geometry</span>(ogr.wkbPolygon)
polygonGeometry<span class="hljs-selector-class">.AddGeometry</span>(outRingGeometry)
polygonGeometry<span class="hljs-selector-class">.AddGeometry</span>(inRingGeometry)
</code></pre>
<p>对于面几何对象创建完成后需要关闭环状几何，可以调用几何对象<code>CloseRings()</code>或者在最后添加与第一个坐标相同点进行关闭。</p>
<pre><code class="hljs language-scss" lang="scss">outRingGeometry<span class="hljs-selector-class">.CloseRings</span>()
inRingGeometry<span class="hljs-selector-class">.CloseRings</span>()
</code></pre>
<p>如下为创建面<code>Shp</code>图层完整方法。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：创建面Shp图层
参数：
    -polygonPath：面文件路径
"""</span>     
<span class="hljs-keyword">def</span> <span class="hljs-title function_">CreatePolygon</span>(<span class="hljs-params">polygonPath</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始创建面对象"</span>)

    <span class="hljs-comment"># 添加shp数据驱动</span>
    shpDriver = gdal.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)

    checkShpPath(polygonPath,shpDriver)

    <span class="hljs-comment"># 创建shp数据源</span>
    shpDataSource = shpDriver.CreateDataSource(polygonPath)
    <span class="hljs-keyword">if</span> shpDataSource <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"无法创建点Shp数据源，请检查文件！"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># 创建面数据图层</span>
    polygonLayer = shpDataSource.CreateLayer(<span class="hljs-string">"polygon"</span>,geom_type=ogr.wkbPolygon)

    <span class="hljs-comment"># 添加id字段</span>
    fieldDefn = ogr.FieldDefn(<span class="hljs-string">"id"</span>,ogr.OFTInteger)
    polygonLayer.CreateField(fieldDefn)

    <span class="hljs-comment"># 获取要素结构</span>
    featureDefn = polygonLayer.GetLayerDefn()

    <span class="hljs-comment"># 创建要素对象</span>
    polygonFeature = ogr.Feature(featureDefn)

    points = [
       <span class="hljs-string">"100.225207,27.665721"</span>,
       <span class="hljs-string">"105.330257,29.948948"</span>,
       <span class="hljs-string">"105.848739,23.856316"</span>,
       <span class="hljs-string">"99.567134,23.892995"</span>,
       <span class="hljs-string">"100.225207,27.665721"</span>
    ]
    <span class="hljs-comment"># pointGeometry.AddPoint(100.225207,27.665721)</span>
    <span class="hljs-comment"># 创建一个环形Geometry</span>
    ringGeometry = ogr.Geometry(ogr.wkbLinearRing)
    geomeTypeName = ogr.GeometryTypeToName(ringGeometry.GetGeometryType())

    <span class="hljs-comment"># print(f"几何对象名称：{geomeTypeName}")</span>
    <span class="hljs-keyword">for</span> i,point <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"点：<span class="hljs-subst">{point}</span>"</span>)
        res = point.split(<span class="hljs-string">","</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"点：<span class="hljs-subst">{res}</span>"</span>)

        ringGeometry.AddPoint(<span class="hljs-built_in">float</span>(res[<span class="hljs-number">0</span>]),<span class="hljs-built_in">float</span>(res[<span class="hljs-number">1</span>]))

    <span class="hljs-comment"># 关闭环状几何</span>
    <span class="hljs-comment"># or ringGeometry.CloseRings()</span>

    <span class="hljs-comment"># 创建面几何对象</span>
    polygonGeometry = ogr.Geometry(ogr.wkbPolygon)
    polygonGeometry.AddGeometry(ringGeometry)

    polygonFeature.SetGeometry(polygonGeometry)
    polygonFeature.SetField(<span class="hljs-string">"id"</span>,<span class="hljs-number">1</span>)

    polygonLayer.CreateFeature(polygonFeature)
</code></pre>
<h2 data-id="heading-6">5. 总结</h2>
<p>创建图层前第一步都是要需要获取数据驱动，如<code>Shp</code>数据驱动为<code>"ESRI Shapefile"</code>。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 添加shp数据驱动</span>
<span class="hljs-attr">shpDriver</span> = gdal.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)
</code></pre>
<p>然后便可以创建数据源，并检查数据源是否创建成功。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建shp数据源</span>
shpDataSource = shpDriver.CreateDataSource(polygonPath)
<span class="hljs-keyword">if</span> shpDataSource <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"无法创建点Shp数据源，请检查文件！"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>创建目标图层，<code>"polygon"</code>为自定义参数，<code>geom_type</code>为图层几何类型，可以根据实际需求进行修改。此外，创建图层方法还可以传入一个坐标系参数，例子中就不展示了。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建面数据图层</span>
<span class="hljs-attr">polygonLayer</span> = shpDataSource.CreateLayer(<span class="hljs-string">"polygon"</span>,geom_type=ogr.wkbPolygon)
</code></pre>
<p>图层创建完成之后，便可以添加一些属性表结构。通过<code>ogr.FieldDefn</code>创建字段域，并通过图层方法<code>CreateField</code>创建字段，使用方法<code>GetLayerDefn()</code>获取要素域。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 添加id字段</span>
<span class="hljs-attr">fieldDefn</span> = ogr.FieldDefn(<span class="hljs-string">"id"</span>,ogr.OFTInteger)
polygonLayer.CreateField(fieldDefn)

<span class="hljs-comment"># 获取要素结构</span>
<span class="hljs-attr">featureDefn</span> = polygonLayer.GetLayerDefn()

<span class="hljs-comment"># 创建要素对象</span>
<span class="hljs-attr">polygonFeature</span> = ogr.Feature(featureDefn)
</code></pre>
<p>创建几何对象。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ringGeometry</span> = ogr.Geometry(ogr.wkbLinearRing)
<span class="hljs-attr">geomeTypeName</span> = ogr.GeometryTypeToName(ringGeometry.GetGeometryType())

for i,point in enumerate(points):
    <span class="hljs-comment"># print(f"点：{point}")</span>
    <span class="hljs-attr">res</span> = point.split(<span class="hljs-string">","</span>)
    <span class="hljs-comment"># print(f"点：{res}")</span>

    ringGeometry.AddPoint(float(res<span class="hljs-section">[0]</span>),float(res<span class="hljs-section">[1]</span>))

<span class="hljs-comment"># 关闭环状几何</span>
<span class="hljs-comment"># or ringGeometry.CloseRings()</span>

<span class="hljs-comment"># 创建面几何对象</span>
<span class="hljs-attr">polygonGeometry</span> = ogr.Geometry(ogr.wkbPolygon)
polygonGeometry.AddGeometry(ringGeometry)
</code></pre>
<p>将几何对象和属性字段添加到要素中，之后使用图层方法<code>CreateFeature</code>创建图层要素。</p>
<pre><code class="hljs language-scss" lang="scss">polygonFeature<span class="hljs-selector-class">.SetGeometry</span>(polygonGeometry)
polygonFeature<span class="hljs-selector-class">.SetField</span>("id",<span class="hljs-number">1</span>)

polygonLayer<span class="hljs-selector-class">.CreateFeature</span>(polygonFeature)
</code></pre>
<p>至此，大功告成。</p>
<p>在<code>ArcMap</code>中打开成果显示如下。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73b0a282ab11414cbbbcfdb124cd6b49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=EbsNTrtenbcDdNRtaJfGbmpgGaw%3D" alt="" loading="lazy"/></p>
<p><strong>小提示：</strong></p>
<ol>
<li>例子中创建的数据图层并未加上坐标信息，有兴趣的读者可以自行实现。</li>
<li>文中只实现了点、线、面对象，对于多点、多线和多面几何类型也留给感兴趣的读者自行实现！</li>
</ol>
<p>对于<code>GDAL</code>中几何对象类型不太了解的同学可以参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p>参考资料[1] </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><strong><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb82c796d22042dc87d60fca40eb62a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=ETjjnA%2F2%2BEdeL64ZTzuhE%2FYFolc%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>ol数据</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a9b869ad2dd462f9b97e2f42ccbdb40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=g8xJJSsnu9181EnTV5RogE02dT8%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72c745396f134e97a1f56f3c7be0b3e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=ULToCDfIlXsFfS2tWIDgyKGX0hk%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8e3b4b6cf144184a5cef1383a68a0e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=x6%2BiLNcWo7c%2FcTNct%2Fr8Q4T1VwI%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32098aa70b624dd2b098866f800ba821~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768220046&amp;x-signature=fmy09CYIh828ydDkY8WAyEzF%2Bcg%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTUdUHgYra6oMlOaRIL1m4w" target="_blank" title="https://mp.weixin.qq.com/s/TUdUHgYra6oMlOaRIL1m4w" ref="nofollow noopener noreferrer">GDAL 实现自定义数据坐标系</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPGxwhRbuiRUKIpT2D2cVGQ" target="_blank" title="https://mp.weixin.qq.com/s/PGxwhRbuiRUKIpT2D2cVGQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据读写</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Frk-Jxqnn5E9aXDxQiomIIg" target="_blank" title="https://mp.weixin.qq.com/s/rk-Jxqnn5E9aXDxQiomIIg" ref="nofollow noopener noreferrer">GIS 数据转换：使用 GDAL 将 Shp 转换为 GeoJSON 数据</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJg0-96t5C2CIlAB5K38kbw" target="_blank" title="https://mp.weixin.qq.com/s/Jg0-96t5C2CIlAB5K38kbw" ref="nofollow noopener noreferrer">GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F5lRetXg_dHYO-ZXKQnbi5Q" target="_blank" title="https://mp.weixin.qq.com/s/5lRetXg_dHYO-ZXKQnbi5Q" ref="nofollow noopener noreferrer">GIS 数据转换：使用 GDAL 将 TXT 转换为 Shp 数据</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DefUwG-NL2UNHXXdtBhuA" target="_blank" title="https://mp.weixin.qq.com/s/0DefUwG-NL2UNHXXdtBhuA" ref="nofollow noopener noreferrer">使用命令行工具 ogr2ogr 将 CSV 转换为 Shp 数据（二）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FyOoG6DlAKaYsHZDvKUTbpA" target="_blank" title="https://mp.weixin.qq.com/s/yOoG6DlAKaYsHZDvKUTbpA" ref="nofollow noopener noreferrer">GDAL 实现将 CSV 转换为 Shp 数据（一）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信抛出亿元算力包，小程序AI变现的最后一块拼图补齐了]]></title>    <link>https://juejin.cn/post/7591702898080251919</link>    <guid>https://juejin.cn/post/7591702898080251919</guid>    <pubDate>2026-01-05T12:50:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591702898080251919" data-draft-id="7591515844867260450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信抛出亿元算力包，小程序AI变现的最后一块拼图补齐了"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-05T12:50:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信抛出亿元算力包，小程序AI变现的最后一块拼图补齐了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:50:09.000Z" title="Mon Jan 05 2026 12:50:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在AI圈子里摸爬滚打了这一两年，大家都有个共识：做Demo容易，做产品难；跑通技术容易，跑通商业模式难。</p>
<p>很多独立开发者手里攥着绝妙的Prompt和创意，却倒在了昂贵的API调用费和惨淡的留存数据面前。但就在最近，微信小程序甩出了一个名为“AI应用及线上工具小程序成长计划”的重磅炸弹。看完细则，我的第一反应是：微信这次不是在画饼，而是直接把饭喂到了开发者嘴边。</p>
<p>这是一整年的资源“泄洪”，而且精准打击了独立开发者的三大痛点：算力成本、后端门槛、变现通路。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-05_20.37.52-1024x313.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-05_20.37.52-1024x313.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14fe68813cab485c8f5db8abe9acc412~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768222208&amp;x-signature=V2UlURnd57VOwU9gaH6nBOLVZc0%3D" alt="iShot_2026-01-05_20.37.52" loading="lazy"/></a></p>
<p><strong>首先是简单粗暴的“送弹药”。</strong></p>
<p>做AI应用，最大的成本就是Token。这次微信直接拿出了腾讯混元大模型来背书，给符合条件的开发者提供总计1亿Token的文生文模型额度，还有1万张的文生图额度。</p>
<p>这意味着什么？意味着在相当长的一段时间里，你不需要为每一次用户的对话、每一次图片的生成心疼钱包。对于初创团队或个人开发者来说，这不仅仅是省钱，更是给了你极高的试错容错率。你可以放开手脚去打磨产品体验，而不是盯着仪表盘算计成本。</p>
<p><strong>其次，最让我这个行业观察者兴奋的，其实是商业闭环的打通。</strong></p>
<p>过去做工具类小程序，最头疼的是iOS端的支付问题，这导致很多好的工具只能靠贴片广告那点微薄的收入苟延残喘。但这次计划里明确提到：虚拟支付全面打通，覆盖安卓、iOS和鸿蒙全终端。</p>
<p>这才是真正的杀手锏。配合广告变现的“免开发智能接入模式”，开发者终于可以构建一个健康的商业模型了。用户用得爽，愿意付费订阅高级功能；不愿意付费的，系统自动匹配广告位。这种“左手订阅，右手广告”的混合变现模式，才是AI应用能活下去的根本。</p>
<p><strong>再者，是“保姆级”的基础设施支持。</strong></p>
<p>为了降低门槛，微信把云开发环境都免费开放了。后端部署像搭积木一样简单，你不需要再去折腾服务器运维。同时，赠送的We分析专业版，能帮你把用户行为看个底朝天。在这个流量昂贵的时代，数据驱动增长不再是一句空话。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasdasdfsdf-1024x641.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asdasdfsdf-1024x641.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8dfb0e59e7e490c877d5b4b1adc811b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768222208&amp;x-signature=puZMlb3WGQdvVPZG60iqFfRpN1w%3D" alt="asdasdfsdf" loading="lazy"/></a></p>
<p><strong>那么，谁能上车？</strong></p>
<p>门槛低得惊人。只要你的小程序属于文娱、工具、社交等虚拟行业类目，不管是个人还是企业，都能申请。</p>
<p>回看现在的微信生态，其实已经冒出了一些苗头。像《猜盐》这种用大模型把信息游戏化的产品，或者《风格转换器》这类工具，都证明了小程序+AI有着巨大的爆发力。相比App漫长的开发周期和获客难度，小程序“用完即走”的特性反而契合很多AI工具的轻量化场景。</p>
<p>如果说2023年是AI大模型的元年，那么2026年很可能是AI原生应用在微信生态里的爆发年。微信提供了算力、提供了流量入口、甚至打通了支付墙，剩下的，就看谁能拿出那个打动人心的创意了。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffdsagsagfgd-301x1024.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fdsagsagfgd-301x1024.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/520bc93375a947b1b2eaa39b90adfd50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768222208&amp;x-signature=MyPFhHTuZnbm2yaLjvvE0L15s64%3D" alt="fdsagsagfgd" loading="lazy"/></a></p>
<p>对于还在观望的开发者来说，现在的局势很清晰：入场券已经免费发了，别等到红利期过了再拍大腿。赶紧去后台看看那个“AI小程序成长计划”，这可能是近期也是未来一年里，性价比最高的一次上车机会。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (4) --- AgentPlan]]></title>    <link>https://juejin.cn/post/7591744347826077722</link>    <guid>https://juejin.cn/post/7591744347826077722</guid>    <pubDate>2026-01-05T12:59:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744347826077722" data-draft-id="7591744347826061338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (4) --- AgentPlan"/> <meta itemprop="keywords" content="算法,人工智能,机器学习"/> <meta itemprop="datePublished" content="2026-01-05T12:59:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (4) --- AgentPlan
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:59:26.000Z" title="Mon Jan 05 2026 12:59:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (4) --- AgentPlan</h2>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">【大数据 &amp; AI】Flink Agents 源码解读 --- (4) --- AgentPlan</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 概要</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 基本概念</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 定义</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 在系统中的位置和作用</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 流程</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 具体功能</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 编译</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 提供数据</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 与 Flink 原生的关系</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 核心对应点（AgentPlan ↔ JobGraph）</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 非对应点</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.3 总结</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x04 与智能 Agent “规划（Planning）” 的核心相似性</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.1 核心目标</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2 核心特征</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2.1 Agent规划</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2.2 AgentPlan </a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
<h3 data-id="heading-1">0x00 概要</h3>
<p>AgentPlan 是 Flink Agent 框架中的一个核心组件，它起到连接用户定义的 Agent 和实际执行环境之间的桥梁作用。AgentPlan 的核心职责如下：</p>
<ul>
<li>解析用户定义的 Agent 中的动作（Action）、事件监听规则、资源提供者（ResourceProvider）；</li>
<li>提供 AgentPlan 运行时的核心接口（获取事件对应的动作、获取资源、读取动作配置等）；</li>
<li>统一管理 Agent 依赖的各类资源（如模型、工具、Prompt、MCP 服务等）的创建与复用。</li>
</ul>
<h3 data-id="heading-2">0x01 基本概念</h3>
<p>AgentPlan 本质上是将用户友好的Agent定义转换为运行时可执行的结构化表示，使得执行引擎可以高效地处理Agent逻辑。</p>
<h4 data-id="heading-3">1.1 定义</h4>
<p>定义如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentPlan</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""
    从用户自定义 Agent 编译得到的智能体执行计划
    核心作用：封装 Agent 运行所需的动作、事件映射、资源、配置等核心信息
    """</span>
    <span class="hljs-comment"># 动作名称到动作对象的映射</span>
    actions: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, Action]
    <span class="hljs-comment"># 事件类型（字符串格式）到监听该事件的动作名称列表的映射</span>
    actions_by_event: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]]
    <span class="hljs-comment"># 资源提供者映射：第一层是资源类型，第二层是资源名称，值为对应资源提供者</span>
    resource_providers: <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, ResourceProvider]] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
    <span class="hljs-comment"># Agent 的全局配置</span>
    config: AgentConfiguration | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
    <span class="hljs-comment"># 私有缓存：已创建的资源实例（避免重复初始化），键为 (资源类型, 资源名称)</span>
    __resources: <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, Resource]] = {}        
</code></pre>
<h4 data-id="heading-4">1.2 在系统中的位置和作用</h4>
<p>AgentPlan 在系统中的位置和作用如下：</p>
<pre><code class="hljs language-scss" lang="scss">用户定义的Agent
    ↓
    ↓ (AgentPlan.from_agent)   
 AgentPlan（编译后的执行计划）   
    ↓    
    ↓（LocalRunner 使用）
LocalRunner（实际执行）    
</code></pre>
<p>AgentPlan 与 Flink 集群的关系如下：</p>
<ul>
<li>部署阶段：AgentPlan 被序列化并通过 CompileUtils 传递给运行时操作符（如 ActionExecutionOperator）。</li>
<li>运行时行为：操作符使用 AgentPlan 决定如何处理事件和执行动作，但不会修改 AgentPlan 本身。</li>
<li>资源配置：实际资源（如模型连接、工具等）在运行时通过 ResourceProvider 提供，这不改变 AgentPlan 的结构。</li>
</ul>
<p>并行度调整的影响如下：</p>
<ul>
<li>状态恢复：故障恢复或手动调整并行度时，Flink 会重新分配键控状态，AgentPlan 结构保持一致。</li>
<li>检查点兼容性：若需更改 AgentPlan（如添加新动作），必须考虑检查点兼容性和状态演化策略。</li>
</ul>
<h4 data-id="heading-5">1.3 流程</h4>
<p>AgentPlan 的流程如下：</p>
<ul>
<li>编译：将用户定义的Agent 转换为可执行的计划</li>
<li>映射管理：维护事件类型和动作之间的映射关系</li>
<li>资源提供：管理和提供各种资源（模型、工具、提示等）</li>
<li>配置存储：存储和提供动作的配置参数</li>
<li>解耦：将用户接口和执行实现解耦，提供统一的执行计划接口</li>
</ul>
<h3 data-id="heading-6">0x02 具体功能</h3>
<h4 data-id="heading-7">2.1 编译</h4>
<p>from_agent 将用户定义的高级 Agent 对象转换为可执行的计划 AgentPlan。流程如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103f9ce5069741cea7729dfef05924f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768222766&amp;x-signature=Pa%2FgNx9VC3aRUo3DBrZUqkj2DnY%3D" alt="AgentPlan_compile" loading="lazy"/></p>
<p>代码如下：</p>
<pre><code class="hljs language-python" lang="python">    @<span class="hljs-built_in">staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_agent</span>(<span class="hljs-params">agent: Agent, config: AgentConfiguration</span>) -&gt; <span class="hljs-string">"AgentPlan"</span>:
        <span class="hljs-string">"""
        核心工厂方法：将用户自定义的 Agent 编译为 AgentPlan
        :param agent: 用户定义的 Agent 实例
        :param config: Agent 的全局配置
        :return: 编译后的 AgentPlan 实例
        """</span>
        <span class="hljs-comment"># 1. 收集 Agent 中的所有动作（自定义动作 + 内置动作）</span>
        actions = {}
        actions_by_event = {}
        <span class="hljs-comment"># 合并用户自定义动作和框架内置动作</span>
        <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> _get_actions(agent) + BUILT_IN_ACTIONS:
            <span class="hljs-comment"># 校验动作名称唯一性，避免重复</span>
            <span class="hljs-keyword">assert</span> action.name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> actions, <span class="hljs-string">f"Duplicate action name: <span class="hljs-subst">{action.name}</span>"</span>
            actions[action.name] = action
            <span class="hljs-comment"># 构建事件类型到动作名称的映射</span>
            <span class="hljs-keyword">for</span> event_type <span class="hljs-keyword">in</span> action.listen_event_types:
                <span class="hljs-keyword">if</span> event_type <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> actions_by_event:
                    actions_by_event[event_type] = []
                actions_by_event[event_type].append(action.name)
​
        <span class="hljs-comment"># 2. 收集 Agent 中的所有资源提供者</span>
        resource_providers = {}
        <span class="hljs-keyword">for</span> provider <span class="hljs-keyword">in</span> _get_resource_providers(agent):
            <span class="hljs-built_in">type</span> = provider.<span class="hljs-built_in">type</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> resource_providers:
                resource_providers[<span class="hljs-built_in">type</span>] = {}
            name = provider.name
            <span class="hljs-comment"># 校验资源名称在同类型下的唯一性</span>
            <span class="hljs-keyword">assert</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> resource_providers[<span class="hljs-built_in">type</span>], <span class="hljs-string">f"Duplicate resource name: <span class="hljs-subst">{name}</span>"</span>
            resource_providers[<span class="hljs-built_in">type</span>][name] = provider
​
        <span class="hljs-comment"># 3. 创建并返回 AgentPlan 实例</span>
        <span class="hljs-keyword">return</span> AgentPlan(
            actions=actions,
            actions_by_event=actions_by_event,
            resource_providers=resource_providers,
            config=config,
        )
</code></pre>
<h4 data-id="heading-8">2.2 提供数据</h4>
<p>AgentPlan 维护了事件类型到动作的映射关系，用于驱动执行流程。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-comment"># 存储结构</span>
    actions_by_event: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]] <span class="hljs-comment"># 事件类型 --&gt; 动作名称列表</span>
    <span class="hljs-comment"># 查询方法    </span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_actions</span>(<span class="hljs-params">self, event_type: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Action]:
        <span class="hljs-string">"""
        获取监听指定事件类型的所有动作
        :param event_type: 事件类型（字符串格式）
        :return: 动作实例列表
        """</span>
        <span class="hljs-keyword">return</span> [self.actions[name] <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self.actions_by_event[event_type]]    
</code></pre>
<p>AgentPlan 管理所有资源的提供者，并在需要时实例化资源。具体代码如下：</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resource</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, <span class="hljs-built_in">type</span>: ResourceType</span>) -&gt; Resource:
        <span class="hljs-string">"""
        获取指定类型+名称的资源实例（懒加载 + 缓存复用）
        :param name: 资源名称
        :param type: 资源类型
        :return: 资源实例
        """</span>
        <span class="hljs-comment"># 初始化该类型的资源缓存</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.__resources:
            self.__resources[<span class="hljs-built_in">type</span>] = {}
        <span class="hljs-comment"># 若资源未创建，则通过资源提供者创建并缓存</span>
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.__resources[<span class="hljs-built_in">type</span>]:
            resource_provider = self.resource_providers[<span class="hljs-built_in">type</span>][name]
            <span class="hljs-comment"># 调用资源提供者的 provide 方法创建资源（支持递归获取依赖资源）</span>
            resource = resource_provider.provide(
                get_resource=self.get_resource, config=self.config
            )
            self.__resources[<span class="hljs-built_in">type</span>][name] = resource
        <span class="hljs-comment"># 返回缓存的资源实例</span>
        <span class="hljs-keyword">return</span> self.__resources[<span class="hljs-built_in">type</span>][name]
</code></pre>
<p>AgentPlan 存储和提供动作的配置信息。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_action_config</span>(<span class="hljs-params">self, action_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""
        获取指定动作的配置
        :param action_name: 动作名称
        :return: 动作配置字典
        """</span>
        <span class="hljs-keyword">return</span> self.actions[action_name].config
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_action_config_value</span>(<span class="hljs-params">self, action_name: <span class="hljs-built_in">str</span>, key: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""
        获取指定动作配置中的某个键值
        :param action_name: 动作名称
        :param key: 配置键名
        :return: 配置值（不存在则返回 None）
        """</span>
        <span class="hljs-keyword">return</span> self.actions[action_name].config.get(key, <span class="hljs-literal">None</span>)
</code></pre>
<h3 data-id="heading-9">0x03 与 Flink 原生的关系</h3>
<p>Flink 原生的 “Plan 体系”（StreamGraph → JobGraph → ExecutionGraph）是 AgentPlan 的底层支撑，其中 AgentPlan 最直接对应原生 Flink 的 JobGraph，而非笼统的 “Flink Plan”。</p>
<p>这是因为，Flink 中 “Plan” 不是单一组件，而是从 “逻辑定义” 到 “物理执行” 的三层编译产物，这是理解对应关系的基础。AgentPlan 是 Flink Agents 对 Agent 逻辑编译后的 “可执行计划”，其核心定位和原生 Flink 的 <strong>JobGraph</strong> 完全对齐，而非笼统的 “Plan”。</p>

























<table><thead><tr><th>原生 Plan 层级</th><th>核心作用</th><th>关键特征</th></tr></thead><tbody><tr><td>StreamGraph</td><td>逻辑拓扑（用户视角）</td><td>由 DataStream API 代码生成，描述 “数据处理的逻辑步骤”，不涉及并行度、资源分配</td></tr><tr><td>JobGraph</td><td>可执行计划（集群视角）</td><td>StreamGraph 编译后的产物，补充并行度、算子链、中间结果传递规则，是 “系统能识别的执行计划”</td></tr><tr><td>ExecutionGraph</td><td>物理执行图（运行时视角）</td><td>JobGraph 提交到集群后生成，绑定 TaskManager、Slot、物理资源，是 “正在运行的拓扑”</td></tr></tbody></table>
<h4 data-id="heading-10">3.1 核心对应点（AgentPlan ↔ JobGraph）</h4>
<p>我们来看看AgentPlan和JobGraph之间的关联。</p>
<ul>
<li>
<p>角色一致：都是 “编译层产物”，连接 “高层业务定义” 和 “底层物理执行”：</p>
<ul>
<li>原生：StreamGraph（用户写的 DataStream 逻辑）→ JobGraph（集群可执行计划）；</li>
<li>Flink Agents：Agent（用户定义的 Agent 行为逻辑）→ AgentPlan（系统可调度的动作执行计划）。</li>
</ul>
</li>
<li>
<p>内容一致：都包含 “执行规则” 而非 “纯逻辑”：</p>
<ul>
<li>JobGraph 包含算子并行度、输入输出流、状态存储规则；</li>
<li>AgentPlan 包含动作触发规则、资源映射关系、Action 与 Event 的绑定规则。</li>
</ul>
</li>
<li>
<p>作用一致：都是 “中间层”，不直接运行，而是给底层执行组件（Operator/TaskManager）提供执行依据。</p>
</li>
</ul>
<h4 data-id="heading-11">3.2 非对应点</h4>
<p>我们再来看看AgentPlan 不对应哪些。</p>
<ul>
<li>AgentPlan ≠ StreamGraph：StreamGraph 是 “用户逻辑的直接映射”，无编译优化；AgentPlan 是 Agent 逻辑的 “编译优化后产物”，已包含系统可执行的规则（如动作调度优先级）。</li>
<li>AgentPlan ≠ ExecutionGraph：ExecutionGraph 是 “运行时物理拓扑”，绑定具体资源；AgentPlan 是 “预执行计划”，不涉及物理资源分配（由 Flink 集群自动处理）。</li>
</ul>
<h4 data-id="heading-12">3.3 总结</h4>
<ol start="0">
<li>Flink 原生的 “Plan” 是三层体系（StreamGraph/JobGraph/ExecutionGraph），AgentPlan 并非对应 “所有 Plan”，而是精准对应 <strong>JobGraph</strong>；</li>
<li>核心逻辑：AgentPlan 是 Flink Agents 框架对 Agent 高层逻辑的 “编译产物”，和 JobGraph 一样承担 “承上启下” 的作用 —— 把用户的业务语义转换为系统可执行的规则；</li>
<li>边界：AgentPlan 是 “逻辑可执行计划”，不涉及物理资源分配（这部分仍由原生 Flink 的 ExecutionGraph 处理）；</li>
</ol>
<h3 data-id="heading-13">0x04 与智能 Agent “规划（Planning）” 的核心相似性</h3>
<p>我们再来看看 Flink Agents 的 AgentPlan 与智能 Agent “规划” 的核心相似性</p>
<p>Flink Agents 中的 AgentPlan 是面向流式计算场景的任务执行规划，而智能 Agent 领域的 “规划（Planning）” 是 Agent 为达成目标制定行动序列的核心能力，二者虽应用场景（流式计算 vs 通用智能）不同，但底层逻辑、核心特征高度契合，具体相似性可从以下维度拆解：</p>
<h4 data-id="heading-14">4.1 核心目标</h4>
<p>核心目标都是：为 “达成既定目标” 制定可执行路径。</p>
<ol start="0">
<li>智能 Agent 的规划：核心是基于自身目标（如 “导航到目的地”“完成订单处理”）、环境状态（如 “当前位置”“订单队列长度”）和可用动作（如 “左转”“分配订单”），生成一套有序的行动序列，本质是 “从目标反推可落地的步骤”，确保 Agent 能通过执行该序列完成任务。</li>
<li>Flink Agents 的 AgentPlan：核心是基于流式计算任务目标（如 “实时统计订单量”“清洗异常日志”）、Flink 集群的资源状态（如 “算子并行度”“节点负载”）和可用计算动作（如 “数据分片”“窗口聚合”“状态存储”），生成一套结构化的流式任务执行方案，本质是 “将抽象的计算目标转化为 Flink 可执行的算子调度、资源分配、数据流转步骤”。</li>
</ol>
<p>相似性：二者均以 “目标导向” 为核心，规划的最终目的是将抽象目标拆解为可落地、可验证的执行路径，而非单纯的 “任务罗列”。</p>
<h4 data-id="heading-15">4.2 核心特征</h4>
<h5 data-id="heading-16">4.2.1 Agent规划</h5>
<p>Agent规划是动态逻辑。</p>
<p>智能 Agent 的规划的执行逻辑为：遵循 “规划生成→执行动作→感知环境反馈→调整规划” 的闭环（如机器人 “规划抓取动作→执行抓取→感知未抓稳→重新规划抓取角度”）。</p>
<p>智能 Agent 的规划不是 “一次性规划”，而是与执行过程形成闭环，通过反馈持续优化规划，确保目标最终达成。</p>
<h5 data-id="heading-17">4.2.2 AgentPlan</h5>
<p>AgentPlan 是静态执行蓝图，在作业部署时确定，运行期间不因 Flink 集群配置变化而动态调整。任何代理逻辑更改都需重新编译并部署新的 AgentPlan。</p>
<p>AgentPlan 在编译时生成：AgentPlan 在作业提交前从用户定义的 Agent 类编译而来，是静态计划。它包含所有动作（actions）、资源配置（resource providers）以及事件监听关系（actions_by_event）。 静态结构：一旦创建，AgentPlan 的结构在整个作业生命周期内保持不变。</p>
<h3 data-id="heading-18">0xFF 参考</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实验报告：static变量与#include机制的相互作]]></title>    <link>https://juejin.cn/post/7591497387246141476</link>    <guid>https://juejin.cn/post/7591497387246141476</guid>    <pubDate>2026-01-05T11:04:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591497387246141476" data-draft-id="7591513171199459391" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实验报告：static变量与#include机制的相互作"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T11:04:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实验报告：static变量与#include机制的相互作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:04:19.000Z" title="Mon Jan 05 2026 11:04:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// a.cpp</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> trick = <span class="hljs-number">30</span>;
<span class="hljs-comment">// b.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"a.cpp"</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> trick; }
</code></pre>
<p>先抛出一个问题：上述代码能否执行成功呢？为什么？
接来下我们来做一些实验，来深入理解原因。</p>
<h2 data-id="heading-0">背景知识</h2>
<h3 data-id="heading-1">1. static关键字的跨文件作用</h3>
<p>在C++中，当<code>static</code>关键字用于全局变量时，它赋予该变量<strong>内部链接性</strong>：</p>
<ul>
<li>变量只在<strong>当前翻译单元</strong>（即当前源文件）内可见</li>
<li>其他源文件无法链接到这个变量，即使使用<code>extern</code>声明也不行</li>
<li>每个包含该static变量的翻译单元都会有自己的独立副本</li>
</ul>
<h3 data-id="heading-2">2. #include预处理指令的本质</h3>
<p><code>#include</code>是<strong>文本替换</strong>操作：</p>
<ul>
<li>在编译前，预处理器将被包含文件的内容<strong>原样复制</strong>到<code>#include</code>位置</li>
<li>不会创建新的翻译单元，只是扩展当前翻译单元的内容</li>
<li>这是纯粹的文本操作，不涉及链接过程</li>
</ul>
<h3 data-id="heading-3">3. 翻译单元的概念</h3>
<p>翻译单元 = 源文件 + 所有被包含的头文件内容 - 被条件编译跳过的部分</p>
<ul>
<li>每个<code>.cpp</code>文件通常是一个独立的翻译单元</li>
<li>多个翻译单元分别编译成目标文件，然后链接成可执行文件</li>
</ul>
<hr/>
<h2 data-id="heading-4">实验内容</h2>
<h3 data-id="heading-5">实验一：传统理解 - 两个独立翻译单元</h3>
<p><strong>文件结构：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// a.cpp</span>
<span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> trick = <span class="hljs-number">30</span>;

<span class="hljs-comment">// b.cpp</span>
<span class="hljs-keyword">extern</span> <span class="hljs-built_in">int</span> trick;
<span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span> { <span class="hljs-keyword">return</span> trick; }
</code></pre>
<p><strong>编译命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">g++ a.cpp b.cpp -o program1
</code></pre>
<p><strong>实验结果：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">/tmp/ccABC123.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `main<span class="hljs-comment">':</span>
b.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x5): undefined reference <span class="hljs-keyword">to</span> `trick<span class="hljs-comment">'</span>
<span class="hljs-symbol">collect2:</span> <span class="hljs-keyword">error</span>: ld returned <span class="hljs-number">1</span> <span class="hljs-keyword">exit</span> status
</code></pre>
<p><strong>结果分析：</strong></p>
<ul>
<li><code>a.cpp</code>和<code>b.cpp</code>是两个独立的翻译单元</li>
<li><code>static</code>使<code>trick</code>只在<code>a.cpp</code>内部可见</li>
<li><code>b.cpp</code>中的<code>extern int trick</code>声明找不到实际定义</li>
<li><strong>链接失败</strong></li>
</ul>
<hr/>
<h3 data-id="heading-6">实验二：非常规操作 - #include .cpp文件</h3>
<p><strong>文件结构：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// a.cpp</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> trick = <span class="hljs-number">30</span>;

<span class="hljs-comment">// b.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"a.cpp"</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> trick; }
</code></pre>
<p><strong>编译命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只编译b.cpp（a.cpp没有被单独编译）</span>
g++ b.cpp -o program2
</code></pre>
<p><strong>实验结果：</strong></p>
<pre><code class="hljs">编译成功！程序正常执行，返回30
</code></pre>
<p><strong>结果分析：</strong></p>
<ul>
<li>预处理器将<code>a.cpp</code>的内容复制到<code>b.cpp</code>中</li>
<li>实际编译的代码是：
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-type">int</span> trick = <span class="hljs-number">30</span>;  <span class="hljs-comment">// 来自a.cpp</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> trick; }  <span class="hljs-comment">// 来自b.cpp</span>
</code></pre>
</li>
<li><code>trick</code>和<code>main()</code>在<strong>同一个翻译单元</strong>中</li>
<li><code>static</code>不再成为障碍，因为所有代码都在同一个文件作用域内</li>
<li><strong>编译链接都成功</strong></li>
</ul>
<hr/>
<h3 data-id="heading-7">实验三：对比实验 - 去掉static关键字</h3>
<p><strong>文件结构：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// a.cpp</span>
<span class="hljs-type">int</span> trick = <span class="hljs-number">30</span>;  <span class="hljs-comment">// 去掉static</span>

<span class="hljs-comment">// b.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"a.cpp"</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> trick; }
</code></pre>
<p><strong>编译命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">g++ b.cpp -o program3
</code></pre>
<p><strong>实验结果：</strong></p>
<pre><code class="hljs">编译成功！程序正常执行，返回30
</code></pre>
<p><strong>结果分析：</strong></p>
<ul>
<li>无论是否有<code>static</code>，都能编译成功</li>
<li>因为#include机制让所有代码在一个翻译单元内</li>
<li><code>static</code>的跨文件限制在这种情况下<strong>不适用</strong></li>
</ul>
<hr/>
<h3 data-id="heading-8">实验四：危险操作 - 多个文件包含同一个static变量</h3>
<p><strong>文件结构：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// common.cpp</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> counter = <span class="hljs-number">0</span>;

<span class="hljs-comment">// a.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"common.cpp"</span></span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>{ counter++; }

<span class="hljs-comment">// b.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"common.cpp"</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ 
    <span class="hljs-comment">// 调用increment? 实际上不可能，因为increment在a.cpp中</span>
    <span class="hljs-keyword">return</span> counter; 
}
</code></pre>
<p><strong>编译命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">g++ a.cpp b.cpp -o program4
</code></pre>
<p><strong>实验结果：</strong></p>
<pre><code class="hljs">编译成功，但有两个独立的counter副本！
</code></pre>
<p><strong>结果分析：</strong></p>
<ul>
<li><code>a.cpp</code>和<code>b.cpp</code>各自包含<code>common.cpp</code></li>
<li>每个翻译单元有自己的<code>static int counter</code>副本</li>
<li><code>a.cpp</code>中的<code>counter</code>和<code>b.cpp</code>中的<code>counter</code>是<strong>不同的变量</strong></li>
<li>这是严重的逻辑错误，但编译器不会报错！</li>
</ul>
<hr/>
<h2 data-id="heading-9">实验结论</h2>
<h3 data-id="heading-10">关键发现</h3>
<ol>
<li>
<p><strong>#include改变游戏规则</strong>：当使用<code>#include</code>包含一个.cpp文件时，<code>static</code>的"跨文件不可见"特性被绕过，因为所有代码都在同一个翻译单元内。</p>
</li>
<li>
<p><strong>一个常见的误解</strong>：人们常认为"static变量不能被其他文件访问"，这个说法在以下情况成立：</p>
<ul>
<li>多个.cpp文件分别编译</li>
<li>使用传统的头文件包含方式（.h + .cpp分离）</li>
</ul>
</li>
<li>
<p><strong>危险模式</strong>：<code>#include</code>一个包含static变量的.cpp文件到多个其他.cpp文件中，会导致多个独立的static变量副本，这是难以调试的错误来源。</p>
</li>
</ol>
<h3 data-id="heading-11">建议</h3>
<ol>
<li><strong>不要#include .cpp文件</strong>：这是糟糕的编程实践，破坏了模块化原则</li>
<li><strong>正确使用头文件</strong>：
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// common.h</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> trick;  <span class="hljs-comment">// 声明</span>

<span class="hljs-comment">// common.cpp</span>
<span class="hljs-type">int</span> trick = <span class="hljs-number">30</span>;    <span class="hljs-comment">// 定义</span>

<span class="hljs-comment">// b.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"common.h"</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> trick; }
</code></pre>
</li>
<li><strong>理解作用域</strong>：如果确实需要文件作用域的static变量，确保它只在定义它的.cpp文件中使用</li>
</ol>
<h3 data-id="heading-12">小结</h3>
<p>这个实验展示了C++编译模型的底层原理：</p>
<ul>
<li>预处理（文本替换） → 编译（语法分析） → 链接（符号解析）</li>
<li><code>static</code>影响的是<strong>链接阶段</strong>的符号可见性</li>
<li><code>#include</code>影响的是<strong>预处理阶段</strong>的文件内容</li>
<li>当代码通过<code>#include</code>合并到一个翻译单元时，链接问题就被消除了</li>
</ul>
<p><strong>最终答案：在问题描述的场景下，编译能通过，因为#include让static变量和main函数处于同一个翻译单元中。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发：一个简单的滑块验证组件]]></title>    <link>https://juejin.cn/post/7591708519448559625</link>    <guid>https://juejin.cn/post/7591708519448559625</guid>    <pubDate>2026-01-05T11:04:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591708519448559625" data-draft-id="7591680281906249755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙开发：一个简单的滑块验证组件"/> <meta itemprop="keywords" content="HarmonyOS,Android,iOS"/> <meta itemprop="datePublished" content="2026-01-05T11:04:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员一鸣"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520239095"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙开发：一个简单的滑块验证组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520239095/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员一鸣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:04:19.000Z" title="Mon Jan 05 2026 11:04:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>防黑产一直是互联网坚持在做的安全事项，为了防止程序攻击，可以说大部分应用都存在一定的安全验证，比如验证码、指纹验证，图形码识别，拖动滑块验证等等，其目的也显而易见，就是建立一道“人机防火墙”，通过要求用户完成一个对人类简单、对机器困难的交互，来有效识别和拦截自动化程序，从而守护程序安全，今天就给大家带来其中的一个简单的验证场景，那就是拖动滑块验证。</p>
<p>拖动滑块验证，可以说，简单便捷，也是常见安全验证中最经典、最常用的一种交互形式，它主要用于拦截自动化脚本的非真人操作，区分人类用户和机器程序，从而保护程序安全，当然了，任何一个程序，都不是百分之百的安全，前几天的快手事件就是一个特例，所以滑块验证只能作为前端的一种简单的拦截方式。</p>
<h2 data-id="heading-1">实现效果</h2>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/249334b8d0a642cfb5a296719349f506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5LiA6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768215858&amp;x-signature=hq7ZXYa3KEp8V3fSICTFJNMbN9I%3D" alt="" width="70%" loading="lazy"/></p>
<p>当然了，可以自定义定义样式，如下所示：</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31ac8295f64a472f992dcc5d4f58ea17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5LiA6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768215858&amp;x-signature=ChAvSkjnwxk1sDWbEaOs1xgtuSg%3D" alt="" width="50%" loading="lazy"/></p>
<p>那么，这样的一个从左滑动到右边的拖动滑块验证，如何实现呢？其实实现起来也是非常的简单，通过绑定手势gesture，便可以轻松实现。</p>
<h2 data-id="heading-2">如何实现</h2>
<p>实现方式有多种，无非就是两层视图，底部的默认视图，和顶部的滑动视图，我们需要注意的是，顶部的滑动视图，如果，你要采用的是偏移量的方式，也就是先让滑块平移到屏幕外，然后滑动时慢慢的展示，需要注意组件的宽度设置。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39d1ce3a37ee4c1aa8f2b2f1d907bd20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5LiA6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768215858&amp;x-signature=lIWhFSP%2Fb0fYh1nj93sRfrKn%2Be0%3D" alt="" width="70%" loading="lazy"/></p>
<p>以上的方式并不是不推荐，如果是组件和屏幕宽度一致，这时是没有问题的，但是实际当中的组件，是任意位置摆放的，如果还按照偏移量的方式，就会让滑块提前展示，显然是不允许的，所以这一点，需要注意。</p>
<p>一开始，我也是采用的上面的方式，确实实现了效果，但是，固定宽度之后，还需要处理滑块的展示位置，于是，就改成了另一种实现方式，那就是，滑块的宽度默认为0，然后随着手势移动，逐渐增加滑块的宽度，这种方式，就不会存在滑块展示的问题。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">//中间的滑层</span>
<span class="hljs-title class_">Column</span>() {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderView</span> != <span class="hljs-literal">undefined</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sliderView</span>()
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title class_">Column</span>() {

    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sHeight</span>)
      .<span class="hljs-title function_">border</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderAttribute</span>?.<span class="hljs-property">sliderViewAttr</span>?.<span class="hljs-property">border</span>)
      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderAttribute</span>?.<span class="hljs-property">sliderViewAttr</span>?.<span class="hljs-property">backgroundColor</span> != <span class="hljs-literal">undefined</span> ?
                       <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderAttribute</span>?.<span class="hljs-property">sliderViewAttr</span>?.<span class="hljs-property">backgroundColor</span> : <span class="hljs-string">"#5abc3c"</span>)
  }
}
.<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateOffsetWidth</span>)
  .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sHeight</span>)
  .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)
  .<span class="hljs-title function_">animation</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateDuration</span> })
</code></pre>
<p>解决完滑块的问题之后，还有一个需要解决，那就是文字颜色的改变，我们可以发现，在滑动的时候，文字颜色是灰色的，慢慢滑动之后，滑过的文字就会变成白色，而未滑过的文字还是灰色，这是如何实现的呢？</p>
<p>很简单，采用的是两个Text组件，底部的灰色Text，我们不需要改变，主要是顶部的滑块Text文字颜色，这里处理的方式是逐字加载，使用Span组件，根据滑动的距离，分别来更改文字颜色。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sTextArray</span>, <span class="hljs-function">(<span class="hljs-params">t: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
  <span class="hljs-title class_">Span</span>(t)
    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateChangeTextColorArray</span>[index])
    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
    .<span class="hljs-title function_">fontStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderAttribute</span>?.<span class="hljs-property">completeTextAttr</span>?.<span class="hljs-property">fontStyle</span>)
    .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderAttribute</span>?.<span class="hljs-property">completeTextAttr</span>?.<span class="hljs-property">fontWeight</span>)
})
</code></pre>
<h3 data-id="heading-3">滑动逻辑</h3>
<p>滑动上没什么好说的，只监听左右滑动即可，随着手势滑动，不断的改变顶部滑动视图的宽度，如果松手未到右边，就还原初始值，如果到最右边，就回调完成，更改滑块状态。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">.<span class="hljs-title function_">gesture</span>(
  <span class="hljs-title class_">PanGesture</span>({ <span class="hljs-attr">distance</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">direction</span>: <span class="hljs-title class_">PanDirection</span>.<span class="hljs-property">Left</span> | <span class="hljs-title class_">PanDirection</span>.<span class="hljs-property">Right</span> })
  .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateDuration</span> = <span class="hljs-number">0</span>
  })
  .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {
    <span class="hljs-comment">//赋值滑块偏移量,必须大于0</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">offsetX</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">offsetX</span> &gt; (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateWindowWidth</span> - <span class="hljs-title class_">Number</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">thumbWidth</span>))) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateThumbOffsetX</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateWindowWidth</span> - <span class="hljs-title class_">Number</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">thumbWidth</span>)
        <span class="hljs-comment">//状态完成时回调</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onComplete</span> != <span class="hljs-literal">undefined</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateIsScrollComplete</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateIsScrollComplete</span> = <span class="hljs-literal">true</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateOffsetWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateThumbOffsetX</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onComplete</span>()
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateIsScrollComplete</span> = <span class="hljs-literal">false</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateOffsetWidth</span> = event.<span class="hljs-property">offsetX</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateThumbOffsetX</span> = event.<span class="hljs-property">offsetX</span>

      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateThumbOffsetX</span> = <span class="hljs-number">0</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_privateOffsetWidth</span> = <span class="hljs-number">0</span>
    }
    <span class="hljs-comment">//改变文字颜色</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeTextColor</span>(event.<span class="hljs-property">offsetX</span>)


  })
  .<span class="hljs-title function_">onActionEnd</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//滑动结束</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeCompleteStatus</span>()
  })
)
</code></pre>
<h2 data-id="heading-4">快速使用</h2>
<p>为了方便大家使用，目前已经封装好了组件，上传到了中心仓库，大家有需要可以直接使用。</p>
<p>中心仓库地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fohpm.openharmony.cn%2F%23%2Fcn%2Fdetail%2F%40abner%252Fslider" target="_blank" title="https://ohpm.openharmony.cn/#/cn/detail/@abner%2Fslider" ref="nofollow noopener noreferrer">ohpm.openharmony.cn/#/cn/detail…</a></p>
<h3 data-id="heading-5">快速依赖</h3>
<p>方式一：在Terminal窗口中，执行如下命令安装三方包，DevEco Studio会自动在工程的oh-package.json5中自动添加三方包依赖。</p>
<p><strong>建议：在使用的模块路径下进行执行命令。</strong></p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">ohpm install <span class="hljs-meta">@abner</span>/slider
</code></pre>
<p>方式二：在需要的模块中的oh-package.json5中设置三方包依赖，配置示例如下：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-string">"dependencies"</span>: { <span class="hljs-string">"@abner/slider"</span>: <span class="hljs-string">"^1.0.0"</span>}
</code></pre>
<h3 data-id="heading-6">代码使用</h3>
<p>目前默认的是常规的绿色验证样式，如果符合需求，可以直接使用。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">SliderDragView</span>({
  <span class="hljs-attr">onComplete</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//滑动完成</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=======滑动完成"</span>)
  }
})
</code></pre>
<h3 data-id="heading-7">自定义组件形式</h3>
<p>目前支持所有的样式自定义，需要自己来逐一实现自己需要的UI。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">SliderDragView</span>({
  <span class="hljs-attr">sText</span>: <span class="hljs-string">"拖动滑块滑动"</span>,
  <span class="hljs-attr">sCompleteText</span>: <span class="hljs-string">"完成验证"</span>,
  <span class="hljs-attr">defaultView</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//自定义默认视图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">defaultView</span>()
  },
  <span class="hljs-attr">sliderView</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//自定义滑动视图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sliderView</span>()
  },
  <span class="hljs-attr">thumbSlidingView</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//自定义滑块滑动中视图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">thumbSlidingView</span>()
  },
  <span class="hljs-attr">thumbCompleteView</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//自定义滑块完成视图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">thumbCompleteView</span>()
  },
  <span class="hljs-attr">onComplete</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">//滑动完成</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=======滑动完成"</span>)
  }
}).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })
</code></pre>
<h3 data-id="heading-8">完整案例</h3>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SliderControl</span>, <span class="hljs-title class_">SliderDragView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@abner/slider'</span>

<span class="hljs-meta">@Entry</span>
  <span class="hljs-meta">@Component</span>
  struct <span class="hljs-title class_">SliderPage</span> {
    <span class="hljs-attr">sliderControl</span>: <span class="hljs-title class_">SliderControl</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SliderControl</span>()
    <span class="hljs-attr">sliderControl2</span>: <span class="hljs-title class_">SliderControl</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SliderControl</span>()

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-title function_">defaultView</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"拖动滑块滑动"</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)
    }

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-title function_">sliderView</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Column</span>() {

      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
        .<span class="hljs-title function_">borderRadius</span>({ <span class="hljs-attr">topLeft</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottomLeft</span>: <span class="hljs-number">10</span> })
    }

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-title function_">thumbSlidingView</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"--&gt;"</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
        .<span class="hljs-title function_">borderRadius</span>({ <span class="hljs-attr">topRight</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottomRight</span>: <span class="hljs-number">10</span> })
        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">"#e8e8e8"</span> })
    }

    <span class="hljs-meta">@Builder</span>
    <span class="hljs-title function_">thumbCompleteView</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">SymbolGlyph</span>($r(<span class="hljs-string">'sys.symbol.checkmark_circle_fill'</span>))
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
          .<span class="hljs-title function_">renderingStrategy</span>(<span class="hljs-title class_">SymbolRenderingStrategy</span>.<span class="hljs-property">SINGLE</span>)
          .<span class="hljs-title function_">fontColor</span>([<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>])
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
        .<span class="hljs-title function_">borderRadius</span>({ <span class="hljs-attr">topRight</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottomRight</span>: <span class="hljs-number">10</span> })
        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">"#e8e8e8"</span> })
    }

    <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">SliderDragView</span>({
          <span class="hljs-attr">sliderControl</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderControl</span>,
          <span class="hljs-attr">onComplete</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//滑动完成</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=======滑动完成"</span>)
          }
        })

        <span class="hljs-comment">//全部自定义</span>

        <span class="hljs-title class_">SliderDragView</span>({
          <span class="hljs-attr">sText</span>: <span class="hljs-string">"拖动滑块滑动"</span>,
          <span class="hljs-attr">sCompleteText</span>: <span class="hljs-string">"完成验证"</span>,
          <span class="hljs-attr">sliderControl</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderControl2</span>,
          <span class="hljs-attr">defaultView</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//自定义默认视图</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">defaultView</span>()
          },
          <span class="hljs-attr">sliderView</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//自定义滑动视图</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sliderView</span>()
          },
          <span class="hljs-attr">thumbSlidingView</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//自定义滑块滑动中视图</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">thumbSlidingView</span>()
          },
          <span class="hljs-attr">thumbCompleteView</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//自定义滑块完成视图</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">thumbCompleteView</span>()
          },
          <span class="hljs-attr">onComplete</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">//滑动完成</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=======滑动完成"</span>)
          }
        }).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })

        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"重置"</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderControl</span>.<span class="hljs-title function_">reset</span>()
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderControl2</span>.<span class="hljs-title function_">reset</span>()
          })
      }
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    }
  }
</code></pre>
<h3 data-id="heading-9">相关属性</h3>
















































































<table><thead><tr><th><strong>属性</strong></th><th><strong>类型</strong></th><th><strong>概述</strong></th></tr></thead><tbody><tr><td>sWidth</td><td>Length</td><td>整体组件的宽度</td></tr><tr><td>sHeight</td><td>Length</td><td>整体组件的高度</td></tr><tr><td>thumbWidth</td><td>Length</td><td>滑块的宽度</td></tr><tr><td>thumbHeight</td><td>Length</td><td>滑块的高度</td></tr><tr><td>defaultView</td><td>@BuilderParam</td><td>自定义传递的默认视图</td></tr><tr><td>sliderView</td><td>@BuilderParam</td><td>自定义传递的拖动视图</td></tr><tr><td>thumbSlidingView</td><td>@BuilderParam</td><td>拖动的滑块-滑动中视图</td></tr><tr><td>thumbCompleteView</td><td>@BuilderParam</td><td>拖动的滑块-滑动完成</td></tr><tr><td>sDuration</td><td>number</td><td>手指结束时的动画时间,默认100毫秒</td></tr><tr><td>onComplete</td><td>() =&gt; void</td><td>滑动完成状态回调</td></tr><tr><td>sText</td><td>string</td><td>提示内容， 默认为：按住滑块拖动</td></tr><tr><td>sCompleteText</td><td>string</td><td>滑动完成提示内容，默认为：完成验证</td></tr><tr><td>sliderControl</td><td>SliderControl</td><td>重置控制器，可还原滑动状态</td></tr><tr><td>sliderAttribute</td><td>SliderDragAttribute</td><td>默认滑动视图属性，如果自己定义组件，则不需要</td></tr></tbody></table>
<h4 data-id="heading-10">SliderDragAttribute</h4>
<p>滑动视图默认属性，如果是使用的自定义组件形式，此属性配置无效。</p>



































<table><thead><tr><th><strong>属性</strong></th><th><strong>类型</strong></th><th><strong>概述</strong></th></tr></thead><tbody><tr><td>defaultViewAttr</td><td>DefaultViewAttribute</td><td>默认的视图属性</td></tr><tr><td>sliderViewAttr</td><td>SliderViewAttribute</td><td>滑动的视图属性</td></tr><tr><td>completeTextAttr</td><td>CompleteTextAttribute</td><td>完成文字属性</td></tr><tr><td>thumbCompleteAttr</td><td>ThumbCompleteAttribute</td><td>滑块完成属性</td></tr><tr><td>thumbSlidingAttr</td><td>ThumbCompleteAttribute</td><td>滑块滑动属性</td></tr></tbody></table>
<h2 data-id="heading-11">相关总结</h2>
<p>一个很常见的滑块验证组件，本身并不难，如果有需要，大家可以直接使用，希望可以帮助到你，还是那句话，滑块验证只能作为一个简单的安全验证，它不是绝对安全的，这一点，大家需要知道。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph智能体开发设计模式（三）——LangGraph多智能体设计模式：主管架构与分层架构]]></title>    <link>https://juejin.cn/post/7591703562133684258</link>    <guid>https://juejin.cn/post/7591703562133684258</guid>    <pubDate>2026-01-05T11:20:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591703562133684258" data-draft-id="7590684822727082024" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph智能体开发设计模式（三）——LangGraph多智能体设计模式：主管架构与分层架构"/> <meta itemprop="keywords" content="人工智能,LangChain,Agent"/> <meta itemprop="datePublished" content="2026-01-05T11:20:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph智能体开发设计模式（三）——LangGraph多智能体设计模式：主管架构与分层架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:20:12.000Z" title="Mon Jan 05 2026 11:20:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>元旦休整一过，“大模型真好玩”如期开启2026年的百篇AI文章计划。首先推出的，仍是承接去年脉络的 <strong>LangGraph智能体开发设计模式系列</strong>。</p>
<p>上篇文章 <a href="https://juejin.cn/post/7589126920287207434" target="_blank" title="https://juejin.cn/post/7589126920287207434">LangGraph智能体开发设计模式（二）——协调器-工作者模式、评估器-优化器模式</a>分享了单智能体场景下的两种重要模式——协调器-工作者模式与评估器-优化器模式。至此，基于LangGraph的单智能体五大设计模式已完整呈现，包括：</p>
<ul>
<li>提示链模式</li>
<li>路由模式</li>
<li>并行模式</li>
<li>协调器-工作者模式</li>
<li>评估器-优化器模式</li>
</ul>
<p>随着构建智能体技术的不断进步，大家需要解决的任务复杂性已逐渐超越了单一的智能体设计，在面对多维度、跨领域的复杂问题时，即便是基于强大模型构建的单智能体也常显得笨重且不堪重负，过长的上下文、大规模工具（笔者实测单智能体单个模型挂超过20个工具就会不知道该调用哪个工具了）的糟糕决策都注定了要用更加先进的模式。
这些局限性催生了更先进的架构思路——<strong>多智能体系统</strong>。我们不再依赖单一智能体处理所有任务，而是将AI应用拆解为一组更小、更专注的智能体，每个智能体具备特定的职责与专业能力。然而，这也引入了新的挑战：<strong>如何有效协调多个智能体之间的交互与协作，以达成系统整体目标？</strong></p>
<p>这正是多智能体设计模式所要回答的核心问题。从本期开始笔者将系统介绍LangGraph中的多智能体设计模式，涵盖<strong>主管架构</strong>、<strong>分层架构</strong>、<strong>网络架构</strong>三种典型范式，帮助大家构建更灵活、更强大的多智能体应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ba07e0938504456958325454795422c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=Y6XAcQwNwttGRnuh9kladBK%2F%2Fvw%3D" alt="0.jpg" loading="lazy"/></p>
<p>本系列将涵盖常见的工作流模式与多智能体架构模式，预计通过五篇文章展开。相关内容均列于笔者的专栏<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>，同时也要说明该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 35 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<p>2026年笔者的另一大重心还会放在<strong>大模型训练</strong>专栏分享上，当然，谈论训练无法绕过算力这道现实的门槛。昂贵的GPU曾是许多人梦想的拦路石。正因如此笔者今年特意与一些可靠的算力平台展开了合作，希望能为大家解决算力瓶颈。大家可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U%25C2%25A0" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U%C2%A0" ref="nofollow noopener noreferrer">www.lab4ai.cn/register?ag…</a>  注册<strong>Lab4ai算力平台</strong>，提供了包括英伟达H系列在内的多种选择，更有 <strong>5小时的免费体验额度</strong>。</p>
<h2 data-id="heading-1">一、LangGraph多智能体设计模式</h2>
<h3 data-id="heading-2">1.1 多智能体设计模式概述</h3>
<p>多智能体系统的核心在于通过<strong>模块化、专业化与受控的通信机制</strong>，来构建能够处理复杂业务逻辑的大模型应用。相较于单一的“全能型”智能体，多智能体架构将复杂任务分解为多个更小、更独立的专业智能体，从而显著提升系统的可管理性、灵活性与执行效率。</p>
<p>其核心优势主要体现在以下三个方面：</p>
<ol>
<li><strong>模块化</strong>：将复杂的单体智能体拆解为多个功能独立的子智能体，每个子智能体可以独立开发、测试、迭代与维护。这不仅降低了单个组件的复杂度，也使得整个系统的开发流程更为清晰和高效。</li>
<li><strong>专业化</strong>：每个智能体可以针对特定领域的任务进行深度优化，成为该领域的“专家”，例如专精于信息检索的<strong>研究智能体</strong>、擅长逻辑与计算的<strong>数学智能体</strong>，或负责任务拆解与规划的<strong>规划智能体</strong>。这种分工协作避免了让单个通用模型在所有领域“平均用力”而导致的性能平庸，从而从整体上构建出更强大、更精准的系统。</li>
<li><strong>受控的通信与协作</strong>：与单纯依赖大模型自发进行对话交互不同，多智能体系统允许开发者显式地设计和编排智能体之间的交互协议、信息交换格式与协同流程。这种受控的协作机制确保了任务执行的可预测性、稳定性和可追溯性，是实现复杂、多步骤工作流的关键。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32d10a756cb8423caca0f0b46fc1e73e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=KvAVgFvxpJCCylEYpEKG%2BzM%2Feiw%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 多智能体设计模式架构简介</h3>
<p>LangGraph为构建和编排多智能体系统提供了强大的框架，其基于图的架构本身就非常适合表示和管理多个智能体间的交互。在 LangGraph 中，连接和编排多个智能体有多种成熟的架构模式，每种模式都针对不同的协作场景和系统目标，拥有其独特的优势与适用领域。</p>
<p>在本系列文章中，笔者将深入探讨 LangGraph 中三种主流的<strong>多智能体架构模式</strong>：</p>
<ul>
<li><strong>主管架构 (Supervisor Architecture)</strong></li>
<li><strong>分层架构 (Hierarchical Architecture)</strong></li>
<li><strong>网络架构 (Networked Architecture)</strong></li>
</ul>
<p>笔者将通过具体的代码实例，逐一解析它们的设计思想、实现方式以及典型应用场景。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c05a1a74e8349b399aecd95133a2ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=taKE0oP2F8mK99nMxJc%2FHF6p%2BGk%3D" alt="2.png" loading="lazy"/></p>
<h2 data-id="heading-4">二、主管架构</h2>
<h3 data-id="heading-5">2.1 主管架构概念</h3>
<p>主管架构是多智能体系统的核心模式之一，适用于需要<strong>明确的中心控制点</strong>来管理与指导协作流程的场景。在该架构中，一个指定的<strong>主管智能体（Supervisor）</strong>  扮演着中央协调员的角色，负责监督、决策并指挥多个<strong>专业智能体（Specialist Agents）</strong>  的活动。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d1c9b741674699bee2f5457a6405f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=uDcsGh%2FeIUGiUBws8Y%2BVxjjGQOE%3D" alt="0.png" loading="lazy"/></p>
<p>主管架构模式与我们日常的工作组织方式高度相似：想象一位项目经理（主管智能体），他接收任务请求，将其拆解并委派给最合适的专业成员（专业智能体），最后汇总和管理所有成员的输出以形成最终成果。在主管架构中，专业智能体与外部环境（包括用户）的通信，大多数情况下都通过主管智能体进行路由。这种集中式的控制机制使得整个系统具备高度的<strong>可预测性</strong>与<strong>可管理性</strong>，非常适合需要结构化、多步骤协调的复杂任务。</p>
<p>这时大家可能会问，在<a href="https://juejin.cn/post/7589126920287207434" target="_blank" title="https://juejin.cn/post/7589126920287207434">LangGraph智能体开发设计模式（二）——协调器-工作者模式、评估器-优化器模式</a>分享的协调器-工作者工作流也是先规划编排，然后分发给不同大模型去执行呀，它和主管架构有什么区别呢？</p>
<p>确实，主管架构与协调器-工作者工作流在表面上看都涉及一个“中央协调实体”，但它们在<strong>抽象层次</strong>和<strong>设计目的</strong>上存在本质不同：</p>

























<table><thead><tr><th>维度</th><th><strong>主管架构 (Supervisor Architecture)</strong></th><th><strong>协调器-工作者工作流 (Coordinator-Worker Workflow)</strong></th></tr></thead><tbody><tr><td><strong>抽象层级</strong></td><td><strong>高级系统架构</strong>模式。它定义了如何组织多个<strong>智能体</strong>并构建它们之间的交互关系。</td><td><strong>低级任务执行</strong>模式。它描述了如何处理一个<strong>单一复杂任务</strong>的分解与执行流程。</td></tr><tr><td><strong>核心关注点</strong></td><td><strong>智能体管理</strong>与<strong>系统协调</strong>。主管智能体决定在给定上下文下，应该调用<strong>哪个专业智能体</strong>来参与工作。</td><td><strong>任务分解</strong>与<strong>执行效率</strong>。协调器负责将<strong>一个任务</strong>拆分为子任务，并分发给工作者<strong>高效完成</strong>。</td></tr><tr><td><strong>组件性质</strong></td><td>核心组件是具备决策能力和专门角色的<strong>自主智能体</strong>。</td><td>核心组件通常是执行预定义操作的<strong>大模型调用或函数</strong>。</td></tr></tbody></table>
<p>为了更好地理解，笔者这里使用一个比喻：</p>
<ul>
<li><strong>主管架构</strong>就像一家<strong>公司的整体组织结构</strong>。CEO（主管智能体）管理着不同的部门（专业智能体），如市场部、工程部。他决定哪些部门参与某个项目，并协调部门间的合作。</li>
<li><strong>协调器-工作者工作流</strong>则像是<strong>某个部门（如工程部）内部使用的项目管理方法</strong>。工程经理（协调器）使用敏捷开发等方法，将大型软件项目（任务）拆分为小任务，分发给各位开发者（工作者）完成。</li>
</ul>
<p>简言之，<strong>协调器-工作者工作流</strong>是某个部门（或智能体）内部用于完成工作的“工具”或“方法”；而<strong>主管架构</strong>是整个多智能体“组织”赖以运行和管理的“顶层设计”。</p>
<h3 data-id="heading-6">2.2 主管架构代码实战</h3>
<p>理论描述或许不够直观，接下来笔者将通过一个完整的代码实例，演示如何在 LangGraph 中实现主管架构。笔者将构建一个由<strong>主管智能体</strong>管理两个<strong>专业智能体</strong>（数学智能体、研究智能体）的简易系统。</p>
<p>在 LangGraph 中，实现主管架构的核心在于：在图中设置特定节点作为专业智能体，并引入一个中央主管节点来决策下一个激活的智能体节点。控制该流程的关键机制是 LangGraph 的 <code>Command</code> 对象。然而，从零开始搭建涉及状态流转和控制逻辑，过程较为复杂。</p>
<p>为了简化开发，LangChain 团队推出了 <strong><code>langgraph-supervisor</code></strong> 类库。下面，我们将使用这个类库，通过一个具体案例来演示主管架构的实现。</p>
<ol>
<li>
<p><strong>环境配置：</strong> 首先需要安装 <code>langgraph-supervisor</code> 类库。在激活的<code>anaconda langchain</code>虚拟环境中执行以下命令：<code>pip install langgraph-supervisor</code>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1817187e9ea1447b978922f8f2eb361a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=Ki9EyB29WThlVJnR5fikP0OgFVM%3D" alt="1.png" loading="lazy"/></p>
</li>
<li>
<p><strong>引入相关依赖：</strong>   在项目文件夹下新建 <code>.env</code> 文件，填入你的 <code>DEEPSEEK_API_KEY</code>。随后引入必要的依赖。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langgraph_supervisor <span class="hljs-keyword">import</span> create_supervisor
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()

llm = ChatDeepSeek(
    model=<span class="hljs-string">"deepseek-chat"</span>,
)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56b019a27a2b48c5a6f17fac9d7f562d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=7E3zqchI1TTXMzgLX1H3jz%2B2j6Y%3D" alt="3.png" loading="lazy"/></p>
</li>
<li>
<p><strong>定义专业智能体：</strong> 利用 LangChain 的 <code>create_agent</code> API 定义两个专业智能体：<strong>数学智能体</strong>和<strong>研究智能体</strong>，并分别为它们配备专用工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""将两个数字相加"""</span>
    <span class="hljs-keyword">return</span> a + b


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""将两个数字相乘"""</span>
    <span class="hljs-keyword">return</span> a * b


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_search</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    模拟网络搜索功能，返回2025年谷歌和Facebook的员工数
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"谷歌"</span> <span class="hljs-keyword">in</span> query <span class="hljs-keyword">or</span> <span class="hljs-string">"google"</span> <span class="hljs-keyword">in</span> query.lower():
        <span class="hljs-keyword">return</span> <span class="hljs-string">"2025年谷歌的员工数是182545人"</span>
    <span class="hljs-keyword">elif</span> <span class="hljs-string">"facebook"</span> <span class="hljs-keyword">in</span> query.lower() <span class="hljs-keyword">or</span> <span class="hljs-string">"meta"</span> <span class="hljs-keyword">in</span> query.lower():
        <span class="hljs-keyword">return</span> <span class="hljs-string">"2025年Facebook（Meta）的员工数是67043人"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未找到相关信息"</span>

math_agent = create_agent(
    model=llm,
    tools=[add, multiply],
    system_prompt=<span class="hljs-string">"你是一个数学智能体，负责处理数字计算任务。"</span>,
    name=<span class="hljs-string">'math_agent'</span>
)

research_agent = create_agent(
    model=llm,
    tools=[web_search],
    system_prompt=<span class="hljs-string">"你是一个研究智能体，负责处理信息搜索任务。"</span>,
    name=<span class="hljs-string">'research_agent'</span>
)
</code></pre>
</li>
<li>
<p><strong>创建主管工作流：</strong> 利用 <code>create_supervisor</code> 函数创建主管工作流，并通过 <code>compile</code> 方法将其编译为可执行的 LangGraph 应用程序。这里笔者为核心的主管智能体编写了详细的调度提示词。</p>
<pre><code class="hljs language-python" lang="python">supervisor_prompt = <span class="hljs-string">"""你是主管智能体，负责协调和管理两个专业智能体：
- math_agent（数学智能体）：负责数字计算，包括加法和乘法
- research_agent（研究智能体）：负责信息搜索，特别是网络搜索

根据用户的问题，决定调用哪个智能体：
- 如果需要搜索信息（如公司数据、统计数据等），调用research_agent
- 如果需要进行数学计算（如数字相加、相乘等），调用math_agent
- 如果任务完成，返回FINISH

请确保按照合理的顺序调用智能体。例如，如果需要计算总数，先调用research_agent获取数据，再调用math_agent进行计算。"""</span>

workflow = create_supervisor(
    [math_agent, research_agent],
    model=llm,
    prompt=supervisor_prompt,
)


app = workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
</li>
<li>
<p><strong>编译并运行工作流：</strong> 向编译好的应用程序输入一个问题，观察主管架构如何协调两个专业智能体完成任务。运行结果如下图所示，主管智能体成功协调了整个流程：首先调用<strong>研究智能体</strong>获取两家公司的员工数据，随后调用<strong>数学智能体</strong>对这两个数字进行求和计算，最终返回了正确的结果。</p>
<pre><code class="hljs language-python" lang="python">result = app.invoke({
    <span class="hljs-string">"messages"</span>: [HumanMessage(content=<span class="hljs-string">"2025年谷歌和Facebook的员工数总数是多少？"</span>)]
})

<span class="hljs-built_in">print</span>(result[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424ec2f9259443ed882a60c8bd6688d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=T6bMfCPTL%2FxdCifnXYqt7KtZdk4%3D" alt="5.png" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-7">三、分层架构</h2>
<h3 data-id="heading-8">3.1 分层架构概念</h3>
<p>主管架构虽然相比单智能体系统在管理复杂性上有显著提升，但在处理<strong>大量专业智能体</strong>或<strong>超高复杂度任务</strong>时，其设计瓶颈依然会显现。试想，随着主管智能体直接管理的下属智能体数量增长，其决策路径将变得异常复杂，需要维护的上下文信息也会过于庞大，最终可能导致决策效率降低、响应迟缓。为了解决单层主管架构的<strong>可扩展性问题</strong>，LangGraph引入了<strong>分层架构</strong>。</p>
<p>分层架构的核心思想是<strong>将组织结构扁平化</strong>。它不再让单个主管智能体直接管理所有专业智能体，而是先将专业智能体按功能或领域划分成不同的<strong>团队</strong>。每个团队由一个<strong>团队级主管智能体</strong>（或称为“中层主管”）管理。随后，再引入一个<strong>顶层主管智能体</strong>来监督和协调这些团队主管的活动。</p>
<p>这种结构与企业的组织层级高度相似。例如，我们可以设置一个  <strong>“研究团队”</strong>  主管，负责管理研究智能体和数学智能体；同时设置一个  <strong>“写作团队”</strong>  主管，管理写作智能体和发布智能体。当用户提出一个综合性请求时（如“研究并发布一份报告”），<strong>顶层主管</strong>会首先判断任务性质，决定是调用“研究团队”还是“写作团队”，或者决定它们的执行顺序。随后，被选中的<strong>团队主管</strong>再在其内部，将具体任务分派给对应的<strong>专业智能体</strong>执行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa3b6defaef547da95cfccc5a1c6edca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=x5%2FwNbGqJVxDqclhYEj3dzxjiH4%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-9">3.2 分层架构代码实战</h3>
<p><code>langgraph-supervisor</code> 类库的优势在于其良好的可组合性，能够自然地扩展以支持分层系统。可以先为每个团队创建独立的<strong>团队级主管工作流</strong>，然后将这些团队工作流作为“子智能体”，组合到一个<strong>顶层主管工作流</strong>之下。</p>
<p>接下来笔者将在前文主管架构例子的基础上进行扩展，构建一个包含  <strong>“研究团队”</strong>  和  <strong>“写作团队”</strong>  的两层系统，并由一个  <strong>“顶层主管”</strong>  进行统一协调。</p>
<ol>
<li>
<p><strong>引入相关依赖：</strong>  此部分与主管架构示例相同，用于配置环境和基础模型。 </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langgraph_supervisor <span class="hljs-keyword">import</span> create_supervisor
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()

llm = ChatDeepSeek(
    model=<span class="hljs-string">"deepseek-chat"</span>,
)
</code></pre>
</li>
<li>
<p><strong>定义工具函数:</strong> 新增了用于写作和发布的工具函数，并为所有工具添加了 <code>print</code> 语句，以便在运行时清晰地观察调用链。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""将两个数字相加"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'调用相加函数'</span>)
    <span class="hljs-keyword">return</span> a + b


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">float</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""将两个数字相乘"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'调用相乘函数'</span>)
    <span class="hljs-keyword">return</span> a * b


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">web_search</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    模拟网络搜索功能，返回2025年谷歌和Facebook的员工数
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'调用搜索函数'</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"谷歌"</span> <span class="hljs-keyword">in</span> query <span class="hljs-keyword">or</span> <span class="hljs-string">"google"</span> <span class="hljs-keyword">in</span> query.lower():
        <span class="hljs-keyword">return</span> <span class="hljs-string">"2025年谷歌的员工数是182545人"</span>
    <span class="hljs-keyword">elif</span> <span class="hljs-string">"facebook"</span> <span class="hljs-keyword">in</span> query.lower() <span class="hljs-keyword">or</span> <span class="hljs-string">"meta"</span> <span class="hljs-keyword">in</span> query.lower():
        <span class="hljs-keyword">return</span> <span class="hljs-string">"2025年Facebook（Meta）的员工数是67043人"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未找到相关信息"</span>


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">write_report</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    模拟写作功能，将内容整理成报告格式
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'调用写报告函数'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"报告内容：\n<span class="hljs-subst">{content}</span>\n\n报告生成完毕。"</span>


<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">publish_report</span>(<span class="hljs-params">report: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    模拟发布功能，将报告发布到平台
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'调用发布函数'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"报告已成功发布：\n<span class="hljs-subst">{report}</span>"</span>
</code></pre>
</li>
<li>
<p><strong>定义智能体：</strong> 创建四个专业智能体，分别隶属于后续的研究团队和写作团队。</p>
<pre><code class="hljs language-python" lang="python">math_agent = create_agent(
    model=llm,
    tools=[add, multiply],
    system_prompt=<span class="hljs-string">"你是一个数学智能体，负责处理数字计算任务。"</span>,
    name=<span class="hljs-string">'math_agent'</span>
)

research_agent = create_agent(
    model=llm,
    tools=[web_search],
    system_prompt=<span class="hljs-string">"你是一个研究智能体，负责处理信息搜索任务。"</span>,
    name=<span class="hljs-string">'research_agent'</span>
)

writing_agent = create_agent(
    model=llm,
    tools=[write_report],
    system_prompt=<span class="hljs-string">"你是一个写作智能体，负责调用wirte_report函数撰写报告。"</span>,
    name=<span class="hljs-string">'writing_agent'</span>
)

publishing_agent = create_agent(
    model=llm,
    tools=[publish_report],
    system_prompt=<span class="hljs-string">"你是一个发布智能体，负责调用publish_report函数发布报告。"</span>,
    name=<span class="hljs-string">'publishing_agent'</span>
)
</code></pre>
</li>
<li>
<p><strong>定义并编译团队级主管工作流：</strong> 将数学和研究智能体打包成  <strong>“研究团队”</strong> ，将写作和发布智能体打包成  <strong>“写作团队”</strong> ，并分别为它们创建团队主管，该步骤是实现分层的关键。</p>
<pre><code class="hljs language-python" lang="python">research_team_prompt = <span class="hljs-string">"""你是研究团队的主管，负责协调以下智能体：
- math_agent（数学智能体）：负责数字计算，包括加法和乘法,涉及数学计算必须使用该智能体
- research_agent（研究智能体）：负责信息搜索，信息搜索必须使用该智能体

根据任务需求，决定调用哪个智能体：
- 如果需要搜索信息（如公司数据、统计数据等），调用research_agent
- 如果需要进行数学计算（如数字相加、相乘等），调用math_agent
- 如果研究任务完成，返回FINISH

请确保按照合理的顺序调用智能体。例如，如果需要计算总数，先调用research_agent获取数据，再调用math_agent进行计算。"""</span>

research_team_supervisor = create_supervisor(
    [math_agent, research_agent],
    model=llm,
    prompt=research_team_prompt,
)

research_team = research_team_supervisor.<span class="hljs-built_in">compile</span>(name=<span class="hljs-string">'research_team'</span>)


writing_team_prompt = <span class="hljs-string">"""你是写作团队的主管，负责协调以下智能体：
- writing_agent（写作智能体）：负责将研究结果整理成报告
- publishing_agent（发布智能体）：负责将报告发布到平台

根据任务需求，决定调用哪个智能体：
- 如果需要将内容整理成报告，调用writing_agent
- 如果需要将报告发布到平台，调用publishing_agent
- 如果写作和发布任务完成，返回FINISH

请确保按照合理的顺序调用智能体：先调用writing_agent生成报告，再调用publishing_agent发布报告。"""</span>

writing_team_supervisor = create_supervisor(
    [writing_agent, publishing_agent],
    model=llm,
    prompt=writing_team_prompt
)

writing_team = writing_team_supervisor.<span class="hljs-built_in">compile</span>(name=<span class="hljs-string">'writing_team'</span>)
</code></pre>
</li>
<li>
<p><strong>定义并编译顶层主管工作流：</strong> 将已编译好的 <code>research_team</code> 和 <code>writing_team</code> 工作流（它们本身也是可调用的智能体单元）作为成员，交给 <strong>顶层主管</strong> 进行协调。</p>
<pre><code class="hljs language-python" lang="python">supervisor_prompt = <span class="hljs-string">"""你是最高主管智能体，负责协调和管理两个专业团队：
- research_team（研究团队）：负责研究和数据分析，包括数学计算和信息搜索
- writing_team（写作团队）：负责报告撰写和发布

根据用户的问题，决定调用哪个团队：
- 如果需要研究数据、搜索信息或进行数学计算，调用research_team
- 如果需要撰写报告或发布内容，调用writing_team
- 如果任务完成，返回FINISH

请确保按照合理的顺序调用团队。例如，如果需要生成并发布一份报告，先调用research_team获取数据，再调用writing_team撰写和发布报告。"""</span>

workflow = create_supervisor(
    [research_team, writing_team],
    model=llm,
    prompt=supervisor_prompt,
)


app = workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
</li>
<li>
<p><strong>运行测试：</strong> 向这个分层系统提出一个综合性请求。从运行结果和控制台输出可以清晰看到整个分层协作流程</p>
<pre><code class="hljs language-python" lang="python">result = app.invoke({
    <span class="hljs-string">"messages"</span>: [HumanMessage(content=<span class="hljs-string">"请帮我研究2025年谷歌和Facebook的员工数总数，然后生成一份报告并发布。"</span>)]
})

<span class="hljs-built_in">print</span>(result[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eece70d20e04802b7086c819fd1a584~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768216812&amp;x-signature=53Z8yuClAKCTtkESN03VDKfodA4%3D" alt="6.png" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-10">四、总结</h2>
<p>本篇分享了LangGraph多智能体系统的两种核心架构。主管架构通过主管智能体管理多个专业智能体，适合结构化任务。为解决其扩展性问题，分层架构引入了团队与层级概念，由顶层主管协调团队主管，从而分担决策压力，提升系统处理复杂任务的能力。除了主管价格和分层价格，另一种更平等的智能体网络价格也是LangGraph多智能体开发的重要设计模式之一，下篇内容笔者将分享LangGraph多智能体的网络架构，大家敬请期待~</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>专栏内容源自笔者在实际学习和工作中对 LangChain 与 LangGraph 的深度使用经验，旨在帮助大家系统性地、高效地掌握 AI Agent 的开发方法，在各大技术平台获得了不少关注与支持。目前已更新35讲，正在更新LangGraph1.0速通指南，并随时补充笔者在实际工作中总结的拓展知识点。如果大家感兴趣，欢迎关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 大模型真好玩，每期分享涉及的代码均可在公众号私信: LangChain智能体开发免费获取。</p>
<p>2026年笔者的另一大重心还会放在<strong>大模型训练</strong>专栏分享上，当然，谈论训练无法绕过算力这道现实的门槛。昂贵的GPU曾是许多人梦想的拦路石。正因如此笔者今年特意与一些可靠的算力平台展开了合作，希望能为大家解决算力瓶颈。大家可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U%25C2%25A0" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U%C2%A0" ref="nofollow noopener noreferrer">www.lab4ai.cn/register?ag…</a>  注册<strong>Lab4ai算力平台</strong>，提供了包括英伟达H系列在内的多种选择，更有 <strong>5小时的免费体验额度</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BeeAI 框架—ReActAgent 学习]]></title>    <link>https://juejin.cn/post/7591515844867014690</link>    <guid>https://juejin.cn/post/7591515844867014690</guid>    <pubDate>2026-01-05T11:24:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591515844867014690" data-draft-id="7591702898080022543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BeeAI 框架—ReActAgent 学习"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T11:24:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="夕颜111"/> <meta itemprop="url" content="https://juejin.cn/user/3079049469504696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BeeAI 框架—ReActAgent 学习
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3079049469504696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    夕颜111
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:24:14.000Z" title="Mon Jan 05 2026 11:24:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 写在最前面</h2>
<p>趁着假期前，继续学习一下之前没有深入理解的 ReActAgent 的工作原理。果然假期马上就可以出去玩的想法会让人心猿意马。（ps ： 但是今天晚上还是要继续去锻炼的……</p>
<h2 data-id="heading-1">2. ReActAgent 浅析</h2>
<h3 data-id="heading-2">2.1 什么是 ReAct</h3>
<p>ReAct 这个名字很有意思，它其实是 <strong>Reasoning（推理）</strong> 和 <strong>Acting（行动）</strong> 两个词的组合。这个命名本身就揭示了 ReActAgent 的核心思想：<strong>通过推理来决定行动，通过行动的结果来指导下一步推理</strong>。</p>
<p>具体代码示例：</p>
<pre><code class="hljs language-ini" lang="ini">from beeai_framework.agents.react import ReActAgent
from beeai_framework.backend import ChatModel
from beeai_framework.memory import UnconstrainedMemory
from beeai_framework.tools.code import PythonTool, SandboxTool

<span class="hljs-comment"># ReActAgent 的创建非常简单</span>
<span class="hljs-attr">agent</span> = ReActAgent(
    <span class="hljs-attr">llm</span>=ChatModel.from_name(<span class="hljs-string">"ollama:granite3.3:8b"</span>),
    <span class="hljs-attr">tools</span>=[python_tool, sandbox_tool],
    <span class="hljs-attr">memory</span>=UnconstrainedMemory()
)
</code></pre>
<p>从代码来看，ReActAgent 的 API 非常简洁，只需要提供 LLM、工具列表和内存管理即可。但简洁的背后，隐藏着强大的自主决策能力。</p>
<blockquote>
<p>注：思考一下理论上 LLM 都需要提供特定的 prompt 才能够让 LLM 按照预期返回，但是上面的 ReActAgent 木有要求设置</p>
</blockquote>
<h3 data-id="heading-3">2.2 为什么无需设置 prompt</h3>
<p>答案是因为，ReActAgent 需要 LLM 严格按照 ReAct 格式输出：</p>
<ul>
<li>Thought: → 思考过程</li>
<li>Action: → 选择的工具</li>
<li>Action Input: → 工具输入</li>
<li>Observation: → 工具执行结果</li>
<li>Final Answer: → 最终答案</li>
</ul>
<p>这个格式是固定的，必须由框架内置的 Prompt 模板来保证。</p>
<h2 data-id="heading-4">3. ReActAgent 的核心机制</h2>
<h3 data-id="heading-5">3.1 ReAct 循环：推理与行动的交替</h3>
<p>ReActAgent 的核心是一个循环过程，每次循环都包含以下几个步骤：</p>
<ol>
<li><strong>Thought（思考）</strong> ：Agent 分析当前情况，思考下一步应该做什么</li>
<li><strong>Action（行动）</strong> ：根据思考结果，选择并调用合适的工具</li>
<li><strong>Action Input（行动输入）</strong> ：为选定的工具提供输入参数</li>
<li><strong>Observation（观察）</strong> ：观察工具执行的结果</li>
<li><strong>Final Answer（最终答案）</strong> ：如果任务完成，提供最终答案；否则继续下一轮循环</li>
</ol>
<p>这个循环过程可以用下面的流程图表示：</p>
<pre><code class="hljs language-css" lang="css">用户问题
    ↓
<span class="hljs-selector-attr">[Thought]</span> → 分析问题，决定需要什么工具
    ↓
<span class="hljs-selector-attr">[Action]</span> → 选择工具（如 PythonTool）
    ↓
<span class="hljs-selector-attr">[Action Input]</span> → 提供工具输入（如 Python 代码）
    ↓
<span class="hljs-selector-attr">[Observation]</span> → 观察执行结果
    ↓
<span class="hljs-selector-attr">[Thought]</span> → 分析结果，决定下一步
    ↓
    ├─→ 如果任务完成 → <span class="hljs-selector-attr">[Final Answer]</span>
    └─→ 如果未完成 → 继续循环
</code></pre>
<p>举例本地的调用如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a48bace9e6643d8a7a277c412a61f14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSV6aKcMTEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768217054&amp;x-signature=%2BxCLo3pqpmVVYOcXv4fXcKCsJ3k%3D" alt="企业微信截图_3c811d67-83ad-454e-8803-fc344cb9505e.png" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 为什么需要多轮推理？</h3>
<p>很多复杂任务无法一次性完成，需要多轮推理。举个例子：</p>
<p><strong>用户问题</strong>："计算 1 到 100 的平方和，然后找出所有大于 1000 的平方数"</p>
<p>这个任务需要：</p>
<ol>
<li>第一轮：计算 1 到 100 的平方和</li>
<li>第二轮：根据第一轮的结果，找出所有大于 1000 的平方数</li>
</ol>
<p>如果使用 <code>RequirementAgent</code>，开发者需要预先定义这两步的执行顺序。但如果使用 <code>ReActAgent</code>，Agent 可以自主决定：</p>
<ul>
<li>先执行第一步</li>
<li>观察结果</li>
<li>根据结果决定是否需要执行第二步</li>
<li>如果第一步的结果已经足够，可能直接给出答案</li>
</ul>
<p>这种灵活性在处理复杂、动态的任务时特别有用。</p>
<h3 data-id="heading-7">3.3 错误处理与自我修正</h3>
<p>ReActAgent 的另一个强大之处在于它的错误处理能力。当工具执行失败时，Agent 可以：</p>
<ol>
<li><strong>分析错误原因</strong>：通过 Observation 观察错误信息</li>
<li><strong>推理修复方案</strong>：在下一轮 Thought 中分析如何修复</li>
<li><strong>尝试修复</strong>：调用工具进行修复或重试</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 示例：Agent 执行代码时遇到错误</span>
<span class="hljs-comment"># Round 1:</span>
<span class="hljs-comment"># Thought: 需要计算 10/0</span>
<span class="hljs-comment"># Action: PythonTool</span>
<span class="hljs-comment"># Action Input: result = 10 / 0</span>
<span class="hljs-comment"># Observation: ZeroDivisionError: division by zero</span>

<span class="hljs-comment"># Round 2:</span>
<span class="hljs-comment"># Thought: 出现了除零错误，需要添加错误处理</span>
<span class="hljs-comment"># Action: PythonTool</span>
<span class="hljs-comment"># Action Input: </span>
<span class="hljs-comment">#   try:</span>
<span class="hljs-comment">#       result = 10 / 0</span>
<span class="hljs-comment">#   except ZeroDivisionError:</span>
<span class="hljs-comment">#       result = "Cannot divide by zero"</span>
<span class="hljs-comment"># Observation: 代码执行成功，result = "Cannot divide by zero"</span>
</code></pre>
<p>这种自我修正的能力，让 ReActAgent 能够处理一些不可预见的错误情况。</p>
<h2 data-id="heading-8">4. ReActAgent 的使用场景</h2>
<h4 data-id="heading-9">4.1 适合场景</h4>
<ul>
<li>
<p>代码执行和计算</p>
<ul>
<li>动态生成和执行代码</li>
<li>代码解释器（Code Interpreter）</li>
<li>数学计算和数据分析</li>
</ul>
</li>
<li>
<p>复杂问题求解</p>
<ul>
<li>需要多步推理的任务</li>
<li>步骤间有依赖关系的任务</li>
<li>例如：分析 CSV → 找出最高销售额类别 → 计算平均利润率</li>
</ul>
</li>
<li>
<p>交互式任务</p>
<ul>
<li>需要根据结果调整策略</li>
<li>需要多轮迭代和修正</li>
<li>例如：写代码 → 测试 → 修复错误 → 再测试</li>
</ul>
</li>
<li>
<p>错误恢复</p>
<ul>
<li>需要处理不确定性和错误</li>
<li>能够自我修正和重试</li>
<li>动态错误处理</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">4.2 不适合的场景</h4>
<ul>
<li>严格流程控制：需要精确控制每一步执行</li>
<li>简单工具调用：只需一次或少量工具调用</li>
<li>LLM 不支持：LLM 输出格式不符合 ReAct 要求</li>
</ul>
<h2 data-id="heading-11">5. 碎碎念</h2>
<p>发现关于 AI 的很多不理解，其实是因为同一个意思有多种的表达方式，比如下面这几个，其实是类似同义词来着。</p>





















<table><thead><tr><th>人类</th><th>大模型</th></tr></thead><tbody><tr><td>大脑：思考、推理、决策</td><td>LLM 推理能力：理解、分析、决策</td></tr><tr><td>小脑：协调动作、执行操作</td><td>工具调用能力：调用工具、执行操作</td></tr><tr><td>记忆：存储知识、经验</td><td>RAG：检索知识库、增强回答</td></tr></tbody></table>
<p>所以说，再讨论问题之前还是得先统一概念。</p>
<p>你有没有想过，从公元前 221 年秦朝建立到如今，这看似漫长的 2245 年，其实也不过是麦子熟了 2245 回。</p>
<p>其实 1978 年宣布改革开放时，距离清朝灭亡也才过去66年。</p>
<p>如果一个人的生命有 70 年，那么 2245 年，也只是 32 个人生死相接的一生。</p>
<p>我们总是被一些大词裹挟，沉迷于一些宏大叙事、空洞概念，其实不如实在一点，想想这短暂的一生，到底要为什么而活。</p>
<blockquote>
<p>注：参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F33416764%2Fanswer%2F1912656188966953949" target="_blank" title="https://www.zhihu.com/question/33416764/answer/1912656188966953949" ref="nofollow noopener noreferrer">普通人的一生应该是怎样的？</a></p>
</blockquote>
<h2 data-id="heading-12">6. 参考资料：</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1931154686532105460" target="_blank" title="https://zhuanlan.zhihu.com/p/1931154686532105460" ref="nofollow noopener noreferrer">万字长文！从零开始构建你的第一个 ReAct Agent</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F36kr.com%2Fp%2F3591815564476676" target="_blank" title="https://36kr.com/p/3591815564476676" ref="nofollow noopener noreferrer">别让米其林主厨削土豆，英伟达用“小脑指挥大脑”，重构AGI生产力</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025: The year in LLMs]]></title>    <link>https://juejin.cn/post/7591708519448608777</link>    <guid>https://juejin.cn/post/7591708519448608777</guid>    <pubDate>2026-01-05T11:35:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591708519448608777" data-draft-id="7591705084670935078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025: The year in LLMs"/> <meta itemprop="keywords" content="VibeCoding,前端"/> <meta itemprop="datePublished" content="2026-01-05T11:35:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025: The year in LLMs
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:35:07.000Z" title="Mon Jan 05 2026 11:35:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffcfacddf10f4f92b7ddf85d1a37c99d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768217706&amp;x-signature=2C%2FEdEW154hkvwwtb1iXjLpSyaY%3D" alt="0c4e6128-4e86-4950-9507-8e6e9d71b5fd.jpeg" loading="lazy"/>
2025年是LLM从“惊艳演示”走向“真正实用工具”的一年，尤其是编码代理、推理能力和图像编辑三大突破深刻改变了开发者和普通用户的使用方式。中国开源模型和Google Gemini的强势崛起，打破了美国实验室的垄断格局，同时也带来了更高的安全、能源和内容质量挑战。</p>
<p>Simon Willison于2025年12月31日发布的《2025: The year in LLMs》是其年度系列的第三篇，对过去一年大型语言模型（LLM）领域的重大趋势和发展进行了全面回顾。</p>
<p>Simon个人亮点</p>
<ul>
<li>用“鹈鹕骑自行车”作为趣味基准测试模型能力，已成迷因。</li>
</ul>

<ul>
<li>一年内用AI辅助构建了110个小工具（tools.simonwillison.net）。</li>
</ul>

<ul>
<li>越来越多在手机上编程，甚至完成复杂端口项目。</li>
</ul>

<ul>
<li>强调“一致性测试套件”（conformance suites）对新协议/语言被LLM理解的重要性。</li>
</ul>
<p>“推理”（Reasoning）之年</p>
<p>OpenAI在2024年底推出的o1系列开启了“推理”革命（通过RLVR等技术），2025年多家实验室跟进，推出带推理模式的模型。推理能力极大提升了模型在工具使用、复杂搜索、代码调试等方面的表现，成为驱动代理（agents）的关键。</p>
<ol>
<li>代理（Agents）之年，尤其是编码代理</li>
</ol>
<p>代理从概念走向实用，主要在编码和深度研究两类场景爆发。2025年2月Anthropic悄然发布的Claude Code被视为最重要事件——它开启了“编码代理”时代（模型可写代码、执行、迭代）。随后各大厂商推出CLI工具（如Codex CLI、Gemini CLI、Qwen Code）和异步编码代理（如Claude Code web、Codex web、Jules）。开发者开始大规模使用这些工具，甚至在手机上编程。</p>
<ol start="3">
<li>命令行LLM之年</li>
</ol>
<p>Claude Code等工具证明开发者非常愿意在终端使用强大LLM，推动了命令行工具的流行。Anthropic称Claude Code贡献了10亿美元年化收入。</p>
<ol start="4">
<li>中国开源权重模型崛起之年</li>
</ol>
<p>中国实验室（DeepSeek、Qwen、GLM、Kimi、MiniMax等）主导了2025年开源模型排行榜前几位，许多模型性能媲美甚至超过西方闭源前沿模型，且多采用Apache 2.0或MIT等真正开源许可。DeepSeek R1发布曾引发NVIDIA股价暴跌近6000亿美元（后反弹）。</p>
<ol start="5">
<li>长任务与更强代理能力</li>
</ol>
<p>METR数据显示，2025年前沿模型已能独立完成人类需要数小时的软件工程任务，任务时长能力呈指数增长。</p>
<ol start="6">
<li>基于提示的图像编辑之年</li>
</ol>
<p>OpenAI在2025年3月推出的图像编辑功能（可上传图片并用提示修改）引发爆炸式增长，一周新增1亿用户。Google的“Nano Banana”系列（尤其是Nano Banana Pro）后来居上，成为最强图像生成/编辑模型，支持生成带准确文字和信息图的图像。</p>
<ol start="7">
<li>模型在学术竞赛夺金之年</li>
</ol>
<p>OpenAI和Google的推理模型在国际数学奥林匹克（IMO）和国际大学生程序设计竞赛（ICPC）中获得金牌级别成绩，且问题均为全新未公开题目。</p>
<ol start="8">
<li>Llama迷失方向 &amp; OpenAI失去领先优势之年</li>
</ol>
<p>Meta的Llama 4规模过大、未能提供易运行的小模型，影响力下降；OpenAI虽仍有顶级模型，但在图像、代码、开源等领域被Google Gemini、Anthropic Claude和中国模型追赶或超越。</p>
<ol start="9">
<li>Gemini之年</li>
</ol>
<p>Google凭借Gemini系列（2.0→3.0）、自研TPU硬件优势、Nano Banana图像模型、Veo 3视频、Gemma开源模型等多项产品，取得全面进步，成为2025年最大赢家之一。</p>
<ol start="10">
<li>其他值得关注的趋势</li>
</ol>
<ul>
<li>高价订阅（$200/月）成为新常态。</li>
</ul>

<ul>
<li>“YOLO模式”（无确认自动执行）流行，但引发安全担忧（Normalization of Deviance）。</li>
</ul>

<ul>
<li>本地模型变好（20-32B参数模型接近GPT-4级），但云端前沿模型进步更快，编码代理仍依赖云。</li>
</ul>

<ul>
<li>“Slop”（AI低质量内容）成为年度词汇。</li>
</ul>

<ul>
<li>数据中心因能耗、噪音等原因面临越来越强的公众反对。</li>
</ul>

<ul>
<li>浏览器深度集成AI（如ChatGPT Atlas）带来便利同时也带来严重安全隐患。</li>
</ul>

<ul>
<li>“Vibe coding”（完全依赖AI、几乎不看代码的快速原型开发方式）流行，但被广泛误用。</li>
</ul>

<ul>
<li>MCP（Model Context Protocol）短暂火热，后被更简单的Skills机制和编码代理取代。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨标签页数据同步完全指南：如何选择最优通信方案]]></title>    <link>https://juejin.cn/post/7591705084670951462</link>    <guid>https://juejin.cn/post/7591705084670951462</guid>    <pubDate>2026-01-05T11:57:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591705084670951462" data-draft-id="7591687981688291374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨标签页数据同步完全指南：如何选择最优通信方案"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-05T11:57:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pauldu"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870592974"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨标签页数据同步完全指南：如何选择最优通信方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870592974/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pauldu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T11:57:02.000Z" title="Mon Jan 05 2026 11:57:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">五大跨标签页通信方案对比与最佳实践</h2>
<blockquote>
<p>深入对比 postMessage、MessageChannel、BroadcastChannel、sessionStorage、localStorage 五种跨窗口通信技术，帮助开发者做出正确的技术选择。</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>本文详细分析五种跨浏览器标签页通信方案的优劣，通过实际场景分析和代码示例，最终给出决策指南。</p>
<p><strong>快速导航</strong></p>
<ul>
<li>🎯 想快速了解推荐方案？→ 跳到第 11 节</li>
<li>📊 想看技术对比表？→ 查看附录</li>
<li>💻 想看代码实现？→ 跳到第 6 节</li>
</ul>
<hr/>
<h3 data-id="heading-2">一、问题场景（通用化描述）</h3>
<h4 data-id="heading-3">背景</h4>
<p>在现代 Web 应用中，经常需要在多个浏览器标签页之间进行实时数据同步。这种需求在许多场景下都很常见：</p>
<p><strong>典型应用场景</strong>：</p>
<ul>
<li>📋 用户在后台管理系统修改用户信息，同时其他标签页的用户列表需要实时刷新</li>
<li>🔄 在线编辑工具中，一个标签页新增了内容，其他标签页需要同步更新</li>
<li>✏️ 购物车在多个标签页打开，任意一个标签页修改商品数量，其他页面自动同步</li>
<li>📊 仪表板中的多个图表来自不同标签页，需要保持数据一致</li>
<li>🎮 多人协作应用中，一个用户在标签页 A 作出操作，标签页 B 需要实时感知</li>
</ul>
<h4 data-id="heading-4">现象：数据孤岛问题</h4>
<p>在没有跨页面通信机制的情况下：</p>
<ul>
<li>❌ 弹窗更新数据后，新标签页仍显示旧数据</li>
<li>❌ 用户需要手动刷新才能看到最新内容</li>
<li>❌ 多个工作窗口间信息不同步，影响工作效率</li>
<li>❌ 容易造成数据一致性问题</li>
</ul>
<h4 data-id="heading-5">需求定义</h4>
<p>实现<strong>跨标签页的透明、实时数据同步</strong>机制。</p>
<hr/>
<h3 data-id="heading-6">二、五大方案快速对比</h3>













































































<table><thead><tr><th>特性</th><th>postMessage</th><th>MessageChannel</th><th>BroadcastChannel</th><th>sessionStorage</th><th>localStorage</th></tr></thead><tbody><tr><td><strong>通信模式</strong></td><td>父子单向</td><td>一对一双向</td><td>多端广播</td><td>事件监听</td><td>事件监听</td></tr><tr><td><strong>需要窗口引用</strong></td><td>✅ 是</td><td>✅ 是</td><td>❌ 否</td><td>❌ 否</td><td>❌ 否</td></tr><tr><td><strong>跨源支持</strong></td><td>✅ 是</td><td>✅ 是</td><td>❌ 同源</td><td>❌ 同源</td><td>❌ 同源</td></tr><tr><td><strong>窗口刷新后</strong></td><td>❌ 断开</td><td>❌ 断开</td><td>✅ 有效</td><td>✅ 保留</td><td>✅ 保留</td></tr><tr><td><strong>实时性</strong></td><td>✅ 立即</td><td>✅ 立即</td><td>✅ 立即</td><td>⚠️ 延迟</td><td>⚠️ 延迟</td></tr><tr><td><strong>同页面通信</strong></td><td>✅ 可以</td><td>✅ 可以</td><td>✅ 可以</td><td>❌ 不能</td><td>❌ 不能</td></tr><tr><td><strong>实现复杂度</strong></td><td>中等</td><td>高</td><td>低</td><td>中等</td><td>中等</td></tr><tr><td><strong>推荐指数</strong></td><td>⭐⭐</td><td>⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐</td><td>⭐</td></tr></tbody></table>
<h4 data-id="heading-7">推荐：BroadcastChannel ⭐⭐⭐⭐⭐（同源场景）</h4>
<hr/>
<h3 data-id="heading-8">三、postMessage 方案</h3>
<h4 data-id="heading-9">原理</h4>
<p>postMessage 是最基础的跨窗口通信方式，通过向特定窗口发送消息实现通信。</p>
<h4 data-id="heading-10">代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 发送端（主窗口）</span>
<span class="hljs-keyword">const</span> newWindow = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url, <span class="hljs-string">'_blank'</span>);
newWindow.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'DATA_UPDATE'</span>,
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span> }
}, <span class="hljs-string">'*'</span>);

<span class="hljs-comment">// 接收端（新窗口）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">origin</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'DATA_UPDATE'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到数据:'</span>, event.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>);
  }
});
</code></pre>
<h4 data-id="heading-11">局限性</h4>

























<table><thead><tr><th>问题</th><th>影响</th></tr></thead><tbody><tr><td><strong>需要窗口引用</strong></td><td>主窗口刷新后引用丢失，无法恢复</td></tr><tr><td><strong>新窗口刷新后无法通信</strong></td><td>需手动重建连接</td></tr><tr><td><strong>新窗口独立打开不支持</strong></td><td>无法建立通信</td></tr><tr><td><strong>管理复杂</strong></td><td>多窗口时代码重复且难维护</td></tr></tbody></table>
<h4 data-id="heading-12">适用场景</h4>
<ul>
<li>✅ 跨源通信</li>
<li>✅ 浏览器兼容性要求极高</li>
<li>❌ 不适合：实时同步、多窗口、自动恢复</li>
</ul>
<hr/>
<h3 data-id="heading-13">四、MessageChannel 方案</h3>
<h4 data-id="heading-14">原理</h4>
<p>MessageChannel 提供一对一的双向通信通道，通过传递 Port 对象建立通道。</p>
<h4 data-id="heading-15">代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 发送端（主窗口）</span>
<span class="hljs-keyword">const</span> newWindow = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url, <span class="hljs-string">'_blank'</span>);
<span class="hljs-keyword">const</span> { port1, port2 } = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();

<span class="hljs-comment">// 将 port2 传给新窗口</span>
newWindow.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">port</span>: port2 }, <span class="hljs-string">'*'</span>, [port2]);

<span class="hljs-comment">// 通过 port1 收发消息</span>
port1.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到:'</span>, event.<span class="hljs-property">data</span>);
};
port1.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SYNC'</span>, <span class="hljs-attr">data</span>: {...} });

<span class="hljs-comment">// 接收端（新窗口）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">ports</span>.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">const</span> port = event.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>];
    port.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'接收到:'</span>, msg.<span class="hljs-property">data</span>);
    };
    port.<span class="hljs-title function_">start</span>();
  }
});
</code></pre>
<h4 data-id="heading-16">局限性</h4>

























<table><thead><tr><th>问题</th><th>影响</th></tr></thead><tbody><tr><td><strong>需要管理端口引用</strong></td><td>引用丢失导致通信断开</td></tr><tr><td><strong>新窗口刷新需重连</strong></td><td>需额外的重连逻辑</td></tr><tr><td><strong>实现复杂</strong></td><td>端口转移、start() 等机制复杂</td></tr><tr><td><strong>不支持一对多</strong></td><td>多窗口需建立多条通道</td></tr></tbody></table>
<h4 data-id="heading-17">适用场景</h4>
<ul>
<li>✅ 需要双向通信</li>
<li>✅ 跨源通信</li>
<li>✅ 通信频繁且可靠性要求高</li>
</ul>
<hr/>
<h3 data-id="heading-18">五、BroadcastChannel 方案 ⭐ 推荐</h3>
<h4 data-id="heading-19">原理</h4>
<p>BroadcastChannel 提供一个命名通道，同一浏览上下文内所有同源的标签页都可以自动订阅该通道，实现真正的广播通信。</p>
<h4 data-id="heading-20">代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 发送端（任意窗口）</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'alarm_sync_channel'</span>);

channel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">alarmId</span>: <span class="hljs-number">123</span>,
  <span class="hljs-attr">deviceId</span>: <span class="hljs-number">456</span>,
  <span class="hljs-attr">devicePath</span>: <span class="hljs-string">'/factory/workshop'</span>,
  <span class="hljs-attr">deviceName</span>: <span class="hljs-string">'Device-A'</span>
});

<span class="hljs-comment">// 接收端（所有同源标签页自动接收）</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'alarm_sync_channel'</span>);

channel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { alarmId, deviceId, devicePath, deviceName } = event.<span class="hljs-property">data</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'自动同步:'</span>, { alarmId, deviceId, devicePath, deviceName });
  <span class="hljs-title function_">updateDeviceData</span>(deviceId);
};

<span class="hljs-comment">// 组件卸载时关闭通道</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  channel.<span class="hljs-title function_">close</span>();
});
</code></pre>
<h4 data-id="heading-21">核心优势</h4>

































<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>无需窗口引用</strong></td><td>通过通道名称自动发现，完全解耦</td></tr><tr><td><strong>自动恢复</strong></td><td>窗口刷新后自动重新连接</td></tr><tr><td><strong>独立打开支持</strong></td><td>任何方式打开的同源窗口都自动加入</td></tr><tr><td><strong>代码简洁</strong></td><td>API 简单直观，代码量少 50%+</td></tr><tr><td><strong>广播特性</strong></td><td>一条消息所有监听者都接收</td></tr><tr><td><strong>内存高效</strong></td><td>无需管理端口生命周期</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-22">六、Storage 方案对比</h3>
<h4 data-id="heading-23">sessionStorage 与 localStorage 的问题</h4>
<p>这两种存储方案原本用于<strong>数据持久化</strong>，不是为了<strong>消息通信</strong>。用来实现跨页面通信存在根本性缺陷：</p>
<h5 data-id="heading-24">核心问题</h5>








































<table><thead><tr><th>问题</th><th>说明</th><th>影响</th></tr></thead><tbody><tr><td><strong>同页面无法触发事件</strong></td><td>同一标签页修改无法通知自己</td><td>发送端和接收端必须分开</td></tr><tr><td><strong>消息会被覆盖</strong></td><td>快速发送多条消息时，后面的覆盖前面的</td><td>需要版本号/时间戳机制</td></tr><tr><td><strong>需要轮询</strong></td><td>无法实时感知更新，需定时检查</td><td>消耗 CPU，延迟大</td></tr><tr><td><strong>消息易丢失</strong> ⚠️</td><td>如果接收端未及时检查，消息被覆盖就丢了</td><td>导致 10%+ 的消息丢失</td></tr><tr><td><strong>存储污染</strong></td><td>大量消息占满 5-10MB 限制</td><td>影响其他功能</td></tr><tr><td><strong>序列化开销</strong></td><td>频繁 JSON 转换</td><td>性能下降</td></tr></tbody></table>
<h4 data-id="heading-25">深入分析：为什么会有消息丢失</h4>
<h5 data-id="heading-26">场景模拟：购物车同步失败</h5>
<p>想象你在两个浏览器标签页打开了购物应用：</p>
<p><strong>标签页 A（购物车）</strong> 和 <strong>标签页 B（商品详情）</strong> 都在监听 storage 事件。</p>
<p><strong>问题发生过程</strong>：</p>
<pre><code class="hljs language-css" lang="css">时间线          标签页 <span class="hljs-selector-tag">A</span>（购物车）      标签页 <span class="hljs-selector-tag">B</span>（商品详情）       Storage
────────────────────────────────────────────────────────────────────
T1  用户点击 +<span class="hljs-number">5</span> 件商品
    ├─ sessionStorage<span class="hljs-selector-class">.setItem</span>('cart', {productId:<span class="hljs-number">1</span>, qty:<span class="hljs-number">5</span>})
    └─ storage 事件触发 ──────────→ ✅ 收到并更新 UI             ← storage 中: {id:<span class="hljs-number">1</span>,qty:<span class="hljs-number">5</span>}

T2  用户快速再 +<span class="hljs-number">3</span> 件
    ├─ sessionStorage<span class="hljs-selector-class">.setItem</span>('cart', {productId:<span class="hljs-number">1</span>, qty:<span class="hljs-number">8</span>})
    └─ storage 事件触发 ──────────→ ⏳ 正在处理 (JS 执行中)      ← storage 中: {id:<span class="hljs-number">1</span>,qty:<span class="hljs-number">8</span>}
                                    （还没来得及读取）

T3  用户再次 +<span class="hljs-number">2</span> 件（网络卡顿）
    ├─ sessionStorage<span class="hljs-selector-class">.setItem</span>('cart', {productId:<span class="hljs-number">1</span>, qty:<span class="hljs-number">10</span>})
    └─ storage 事件触发 ──────────→ 📢 新事件来了！             ← storage 中: {id:<span class="hljs-number">1</span>,qty:<span class="hljs-number">10</span>}
                                    ❌ 之前 T2 的 qty:<span class="hljs-number">8</span> 丢失了
                                    
T4  标签页 B 事件处理完毕
    └─ 从 storage 读取: {id:<span class="hljs-number">1</span>, qty:<span class="hljs-number">10</span>}
    └─ 展示: 购物车中有 <span class="hljs-number">10</span> 件商品
    └─ 问题: 漏掉了中间的 qty:<span class="hljs-number">8</span> 更新！
</code></pre>
<p><strong>核心原因</strong>：</p>
<ol>
<li>
<p><strong>Storage 设计是覆盖式的</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// sessionStorage 只能存一个值</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'cart'</span>, data);  <span class="hljs-comment">// 新值覆盖旧值</span>
sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'cart'</span>);         <span class="hljs-comment">// 始终只能取到最后一个</span>

<span class="hljs-comment">// 中间的更新消息丢失了</span>
</code></pre>
</li>
<li>
<p><strong>事件触发滞后</strong></p>
<pre><code class="hljs language-css" lang="css">标签页 <span class="hljs-selector-tag">A</span> 发送消息
   ↓ (网络/线程延迟)
标签页 <span class="hljs-selector-tag">B</span> 事件队列
   ↓ (等待 JS 执行时间)
标签页 <span class="hljs-selector-tag">B</span> 处理事件
   ↓
此时已经错过了好几条消息
</code></pre>
</li>
<li>
<p><strong>轮询方式无法捕获所有更新</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 接收端每 500ms 检查一次</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> latest = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'cart'</span>);
  <span class="hljs-comment">// 问题：如果两次轮询之间发生了多条更新，只能看到最后一条</span>
  <span class="hljs-comment">// 所有中间的更新都丢失了</span>
}, <span class="hljs-number">500</span>);
</code></pre>
</li>
</ol>
<h5 data-id="heading-27">数据丢失的具体场景</h5>
<p><strong>场景 1：高频更新导致的丢失</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用户在 100ms 内快速修改购物车</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'cart_qty'</span>, i);  <span class="hljs-comment">// 快速写入 0, 1, 2, 3..., 9</span>
}

<span class="hljs-comment">// 接收端可能只收到：</span>
<span class="hljs-comment">// - 事件 1：qty = 2</span>
<span class="hljs-comment">// - 事件 2：qty = 5 </span>
<span class="hljs-comment">// - 事件 3：qty = 9</span>

<span class="hljs-comment">// 丢失消息数：7 条（70% 丢失率）</span>
</code></pre>
<p><strong>场景 2：接收端处理延迟导致的丢失</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 发送端：快速发送 3 条消息</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'msg'</span>, {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'message 1'</span>});  <span class="hljs-comment">// 时间 T1</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'msg'</span>, {<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'message 2'</span>});  <span class="hljs-comment">// 时间 T2</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'msg'</span>, {<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'message 3'</span>});  <span class="hljs-comment">// 时间 T3</span>

<span class="hljs-comment">// 接收端的处理时间线：</span>
<span class="hljs-comment">// T1 时刻：storage 事件触发 → 开始处理第 1 条消息</span>
<span class="hljs-comment">// T2 时刻：收到新消息，但上一条还没处理完</span>
<span class="hljs-comment">// T2 + 50ms：处理完第 1 条，但 storage 值已经是第 3 条了</span>
<span class="hljs-comment">// 结果：消息 2 和消息 3 被合并，实际上只能读到消息 3</span>

<span class="hljs-comment">// 消息丢失数：2 条（66% 丢失率）</span>
</code></pre>
<h5 data-id="heading-28">为什么 BroadcastChannel 不会丢失</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// BroadcastChannel 有事件队列机制</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'sync'</span>);

<span class="hljs-comment">// 即使接收端忙，消息也会被排队</span>
channel.<span class="hljs-title function_">postMessage</span>({<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>});  <span class="hljs-comment">// ✅ 队列中</span>
channel.<span class="hljs-title function_">postMessage</span>({<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>});  <span class="hljs-comment">// ✅ 队列中</span>
channel.<span class="hljs-title function_">postMessage</span>({<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>});  <span class="hljs-comment">// ✅ 队列中</span>

channel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// 每条消息都会触发单独的事件</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">id</span>);  <span class="hljs-comment">// 输出: 1, 2, 3 (无丢失)</span>
};
</code></pre>
<p><strong>对比总结</strong>：</p>



































<table><thead><tr><th>方案</th><th>消息处理方式</th><th>丢失率</th><th>原因</th></tr></thead><tbody><tr><td>Storage</td><td>覆盖式存储 + 事件</td><td>10-70%</td><td>中间消息被覆盖，轮询也无法捕获</td></tr><tr><td>BroadcastChannel</td><td>事件队列</td><td>0%</td><td>每条消息都有独立事件，保证送达</td></tr><tr><td>postMessage</td><td>消息队列</td><td>0%</td><td>浏览器保证消息顺序和送达</td></tr><tr><td>MessageChannel</td><td>端口队列</td><td>0%</td><td>双向可靠通道</td></tr></tbody></table>
<h5 data-id="heading-29">完整实现示例（仍然不推荐）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ========== 消息队列包装类 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageMessageQueue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">channelName = <span class="hljs-string">'message_queue'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">channelName</span> = channelName;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupListener</span>();
  }

  <span class="hljs-title function_">setupListener</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">channelName</span> &amp;&amp; event.<span class="hljs-property">newValue</span>) {
        <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">newValue</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(message));
        <span class="hljs-comment">// 清理消息</span>
        sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">channelName</span>);
      }
    });
  }

  <span class="hljs-title function_">send</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> message = {
      <span class="hljs-attr">id</span>: ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      data,
    };
    sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">channelName</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message));
  }

  <span class="hljs-title function_">onMessage</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(callback);
  }

  <span class="hljs-title function_">close</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = [];
  }
}

<span class="hljs-comment">// ========== 使用方式 ==========</span>
<span class="hljs-comment">// 发送端</span>
<span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageMessageQueue</span>(<span class="hljs-string">'alarm_sync'</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">nextAlarm</span>(<span class="hljs-params">row</span>) {
  queue.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">alarmId</span>: row.<span class="hljs-property">id</span>,
    <span class="hljs-attr">deviceId</span>: row.<span class="hljs-property">deviceId</span>,
  });
}

<span class="hljs-comment">// 接收端</span>
<span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageMessageQueue</span>(<span class="hljs-string">'alarm_sync'</span>);
queue.<span class="hljs-title function_">onMessage</span>(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {
  <span class="hljs-title function_">updateDevice</span>(message.<span class="hljs-property">data</span>.<span class="hljs-property">deviceId</span>);
});
</code></pre>
<p><strong>问题</strong>：</p>
<ul>
<li>❌ 代码量大 3 倍以上</li>
<li>❌ 需要手动清理消息</li>
<li>❌ 仍有消息丢失风险</li>
<li>❌ 性能低于 BroadcastChannel</li>
<li>❌ 难以调试和维护</li>
</ul>
<hr/>
<h3 data-id="heading-30">七、五种方案深度场景对比</h3>
<h4 data-id="heading-31">场景 1：主窗口刷新后的通信恢复</h4>
<p><strong>用户场景</strong>：主窗口处理报警，新窗口打开诊断页面。此时主窗口意外刷新。</p>
<h5 data-id="heading-32">postMessage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 主窗口刷新后，newWindow 引用丢失</span>
<span class="hljs-keyword">const</span> newWindow = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url);
<span class="hljs-comment">// 页面刷新...</span>
<span class="hljs-comment">// newWindow 变量被重置，无法继续通信</span>
</code></pre>
<h5 data-id="heading-33">MessageChannel 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ⚠️ 需要重新建立连接</span>
<span class="hljs-comment">// 主窗口刷新后，原有 port1 失效</span>
<span class="hljs-comment">// 需要额外的重连机制，增加复杂度</span>
</code></pre>
<h5 data-id="heading-34">BroadcastChannel 方案 ⭐</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 自动恢复</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'alarm_sync_channel'</span>);
<span class="hljs-comment">// 页面刷新...</span>
<span class="hljs-comment">// 自动重新连接到通道</span>
channel.<span class="hljs-title function_">postMessage</span>(data);  <span class="hljs-comment">// 可以继续使用</span>
</code></pre>
<h5 data-id="heading-35">sessionStorage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ⚠️ 数据保留，但需轮询</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'alarm_sync'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
<span class="hljs-comment">// 页面刷新...</span>
<span class="hljs-comment">// 数据仍在，但接收端需轮询检测版本号</span>
<span class="hljs-keyword">let</span> lastId = <span class="hljs-number">0</span>;
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'alarm_sync'</span>));
  <span class="hljs-keyword">if</span> (msg?.<span class="hljs-property">id</span> &gt; lastId) {
    lastId = msg.<span class="hljs-property">id</span>;
    <span class="hljs-title function_">updateDevice</span>(msg.<span class="hljs-property">deviceId</span>);
  }
}, <span class="hljs-number">500</span>);  <span class="hljs-comment">// 延迟 500ms 才能感知</span>
</code></pre>
<hr/>
<h4 data-id="heading-36">场景 2：新窗口独立打开</h4>
<p><strong>用户场景</strong>：用户通过直接在地址栏打开新标签页，访问诊断页面。</p>
<h5 data-id="heading-37">postMessage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 无法建立通信</span>
<span class="hljs-comment">// 主窗口没有对新窗口的引用</span>
<span class="hljs-comment">// 新页面无法与主窗口通信</span>
</code></pre>
<h5 data-id="heading-38">MessageChannel 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 无法直接通信</span>
<span class="hljs-comment">// 新窗口不知道要连接到哪个通道</span>
</code></pre>
<h5 data-id="heading-39">BroadcastChannel 方案 ⭐</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 自动连接</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'alarm_sync_channel'</span>);
channel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// 自动接收其他标签页的消息，无需任何额外配置</span>
};
</code></pre>
<h5 data-id="heading-40">sessionStorage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ⚠️ 可见数据，但无法感知更新</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'alarm_sync'</span>));
<span class="hljs-comment">// 问题：新窗口打开后，无法知道 "有新消息来了"</span>
<span class="hljs-comment">// 需要定时轮询或使用其他机制通知</span>
</code></pre>
<hr/>
<h4 data-id="heading-41">场景 3：多窗口同步</h4>
<p><strong>用户场景</strong>：用户同时打开了 3 个诊断页面，需要它们共享同一个设备的数据更新。</p>
<h5 data-id="heading-42">postMessage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 无法实现优雅</span>
<span class="hljs-keyword">const</span> window1 = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url1);
<span class="hljs-keyword">const</span> window2 = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url2);
<span class="hljs-keyword">const</span> window3 = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url3);

<span class="hljs-comment">// 发送消息时需要逐一发送</span>
window1.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>);
window2.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>);
window3.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>);
<span class="hljs-comment">// 代码重复，难以维护</span>
</code></pre>
<h5 data-id="heading-43">MessageChannel 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ⚠️ 可以但复杂</span>
<span class="hljs-comment">// 需要为每个窗口建立单独的 MessageChannel</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">port1</span>: port1_w1, <span class="hljs-attr">port2</span>: port2_w1 } = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
<span class="hljs-keyword">const</span> { <span class="hljs-attr">port1</span>: port1_w2, <span class="hljs-attr">port2</span>: port2_w2 } = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
<span class="hljs-keyword">const</span> { <span class="hljs-attr">port1</span>: port1_w3, <span class="hljs-attr">port2</span>: port2_w3 } = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();

<span class="hljs-comment">// 分别初始化每个连接</span>
window1.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">port</span>: port2_w1 }, <span class="hljs-string">'*'</span>, [port2_w1]);
window2.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">port</span>: port2_w2 }, <span class="hljs-string">'*'</span>, [port2_w2]);
window3.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">port</span>: port2_w3 }, <span class="hljs-string">'*'</span>, [port2_w3]);

<span class="hljs-comment">// 发送消息时仍需逐一发送</span>
port1_w1.<span class="hljs-title function_">postMessage</span>(data);
port1_w2.<span class="hljs-title function_">postMessage</span>(data);
port1_w3.<span class="hljs-title function_">postMessage</span>(data);
</code></pre>
<h5 data-id="heading-44">BroadcastChannel 方案 ⭐</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 完美支持</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'alarm_sync_channel'</span>);
<span class="hljs-comment">// 所有 3 个诊断页面都自动监听同一通道</span>
<span class="hljs-comment">// 发送一条消息，所有监听者都接收</span>
channel.<span class="hljs-title function_">postMessage</span>(data);
<span class="hljs-comment">// 简洁、高效、完全自动化</span>
</code></pre>
<h5 data-id="heading-45">sessionStorage 方案</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ⚠️ 可以但需复杂逻辑</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'alarm_sync_v2'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
  <span class="hljs-attr">version</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">deviceId</span>: <span class="hljs-number">456</span> }
}));

<span class="hljs-comment">// 3 个窗口都需要定时轮询</span>
<span class="hljs-keyword">let</span> lastVersion = <span class="hljs-number">0</span>;
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> stored = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'alarm_sync_v2'</span>) || <span class="hljs-string">'{}'</span>);
  <span class="hljs-keyword">if</span> (stored.<span class="hljs-property">version</span> &amp;&amp; stored.<span class="hljs-property">version</span> &gt; lastVersion) {
    lastVersion = stored.<span class="hljs-property">version</span>;
    <span class="hljs-title function_">updateDevice</span>(stored.<span class="hljs-property">data</span>.<span class="hljs-property">deviceId</span>);
  }
}, <span class="hljs-number">500</span>);

<span class="hljs-comment">// 问题：3 个窗口都在轮询，消耗 CPU</span>
<span class="hljs-comment">// 有消息丢失风险（版本号被覆盖）</span>
</code></pre>
<hr/>
<h3 data-id="heading-46">八、实际项目实现</h3>
<h4 data-id="heading-47">项目背景：购物应用跨标签页同步</h4>
<p>用户在购物应用中，同时打开了两个标签页：</p>
<ul>
<li>标签页 A：购物车页面（cart.vue）</li>
<li>标签页 B：商品详情页面（productDetail.vue）</li>
</ul>
<p><strong>需求</strong>：</p>
<ul>
<li>在标签页 A 修改商品数量，标签页 B 自动更新对应商品信息</li>
<li>在标签页 B 加入购物车，标签页 A 的购物车数据实时刷新</li>
<li>页面刷新后仍能保持数据同步</li>
</ul>
<h4 data-id="heading-48">发送端实现 (cart.vue)</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { onMounted, onUnmounted } from 'vue';

// 创建广播通道
const syncChannel = new BroadcastChannel('shopping_sync_channel');

onMounted(() =&gt; {
  getCartList();
});

onUnmounted(() =&gt; {
  // 组件卸载时关闭通道，防止内存泄漏
  syncChannel.close();
});

// 获取购物车列表
async function getCartList() {
  const res = await fetchCartItems();
  state.cartItems = res.data || [];
}

// 用户修改购物车中商品的数量
function updateItemQuantity(item, newQuantity) {
  // 1. 更新本地数据
  item.quantity = newQuantity;
  updateCart(item);
  
  // 2. ✨ 发送同步消息给其他标签页
  syncChannel.postMessage({
    type: 'CART_UPDATED',
    productId: item.productId,
    productName: item.productName,
    quantity: newQuantity,
    price: item.price,
    timestamp: Date.now(),
  });
}

// 用户清空购物车
function clearCart() {
  state.cartItems = [];
  clearCartAPI();
  
  // ✨ 通知其他标签页购物车已清空
  syncChannel.postMessage({
    type: 'CART_CLEARED',
    timestamp: Date.now(),
  });
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-49">接收端实现 (productDetail.vue)</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { onMounted, onUnmounted } from 'vue';

const router = useRouter();
const routes = useRoute();

// 创建同名广播通道
const syncChannel = new BroadcastChannel('shopping_sync_channel');

onMounted(() =&gt; {
  // 初始加载商品详情
  if (routes.query.productId) {
    loadProductDetail(routes.query.productId);
  }
  
  // ✨ 监听购物车同步消息
  syncChannel.onmessage = (event) =&gt; {
    const { type, productId, quantity, timestamp } = event.data;
    
    if (type === 'CART_UPDATED') {
      // 1. 更新 URL 查询参数（确保刷新后数据一致）
      router.replace({
        path: routes.path,
        query: {
          ...routes.query,
          productId,
          lastUpdate: timestamp,
        },
      });
      
      // 2. 重新加载商品数据
      loadProductDetail(productId);
      
      // 3. 显示同步提示
      proxy.$message.info(`购物车已更新：${productId} 的数量变为 ${quantity}`);
    } 
    else if (type === 'CART_CLEARED') {
      // 购物车被清空，更新UI显示
      updateCartStatus('empty');
      proxy.$message.warning('购物车已在其他标签页被清空');
    }
  };
});

onUnmounted(() =&gt; {
  // 关闭通道，防止内存泄漏
  syncChannel.close();
});

// 加载商品详情
const loadProductDetail = (productId) =&gt; {
  fetchProductDetail(productId).then((res) =&gt; {
    state.product = res.data;
    state.productId = productId;
  });
};

// 更新购物车状态显示
const updateCartStatus = (status) =&gt; {
  state.cartStatus = status;
};
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-50">核心流程</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────┐
│   cart<span class="hljs-selector-class">.vue</span> (标签页 A)               │
│ 用户修改购物车商品数量             │
│         ↓                           │
│ <span class="hljs-built_in">updateItemQuantity</span>(item) 更新本地  │
│         ↓                           │
│ 🛒 syncChannel<span class="hljs-selector-class">.postMessage</span>()       │
│    发送 {productId, quantity, ...} │
└────────────┬──────────────────────┘
             │ BroadcastChannel
             ↓
┌─────────────────────────────────────┐
│ productDetail<span class="hljs-selector-class">.vue</span> (标签页 B)        │
│                                     │
│ syncChannel<span class="hljs-selector-class">.onmessage</span> 触发          │
│         ↓                           │
│ 📍 router<span class="hljs-selector-class">.replace</span>() 更新 URL       │
│         ↓                           │
│ 🔄 <span class="hljs-built_in">loadProductDetail</span>() 重新加载    │
│         ↓                           │
│ ✅ 两个标签页购物数据完全同步      │
└─────────────────────────────────────┘
</code></pre>
<hr/>
<h3 data-id="heading-51">九、关键设计点</h3>
<h4 data-id="heading-52">1. 通道名称管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 推荐：使用明确的命名规范</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CHANNEL_NAMES</span> = {
  <span class="hljs-attr">SHOPPING_SYNC</span>: <span class="hljs-string">'shopping_sync_channel'</span>,
  <span class="hljs-attr">USER_PROFILE</span>: <span class="hljs-string">'user_profile_sync'</span>,
  <span class="hljs-attr">NOTIFICATION_UPDATE</span>: <span class="hljs-string">'notification_update'</span>,
  <span class="hljs-attr">DATA_DASHBOARD</span>: <span class="hljs-string">'data_dashboard_sync'</span>,
};

<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-variable constant_">CHANNEL_NAMES</span>.<span class="hljs-property">SHOPPING_SYNC</span>);
</code></pre>
<h4 data-id="heading-53">2. 生命周期管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'sync_channel'</span>);
  channel.<span class="hljs-property">onmessage</span> = handleMessage;
});

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ✅ 必须关闭，否则会泄漏内存</span>
  channel.<span class="hljs-title function_">close</span>();
  channel = <span class="hljs-literal">null</span>;
});
</code></pre>
<h4 data-id="heading-54">3. URL 同步机制</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 使用 router.replace() 而非 push()</span>
<span class="hljs-comment">// 这样刷新后能恢复到正确的状态</span>
router.<span class="hljs-title function_">replace</span>({
  <span class="hljs-attr">path</span>: routes.<span class="hljs-property">path</span>,
  <span class="hljs-attr">query</span>: {
    ...routes.<span class="hljs-property">query</span>,
    deviceId,
  },
});
</code></pre>
<h4 data-id="heading-55">4. 消息体设计</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 只传递必要数据，减少序列化开销</span>
syncChannel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'CART_UPDATED'</span>,
  <span class="hljs-attr">productId</span>: item.<span class="hljs-property">productId</span>,
  <span class="hljs-attr">quantity</span>: newQuantity,
  <span class="hljs-attr">price</span>: item.<span class="hljs-property">price</span>,
  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
});

<span class="hljs-comment">// ❌ 避免：传递整个商品对象（包含无关信息）</span>
<span class="hljs-comment">// syncChannel.postMessage(item);</span>
</code></pre>
<h4 data-id="heading-56">5. 安全考虑</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// BroadcastChannel 仅支持同源通信</span>
<span class="hljs-comment">// 浏览器自动规避安全隐患，无需手动检查</span>
<span class="hljs-comment">// 不同源的页面无法访问该通道</span>

<span class="hljs-comment">// 如果需要跨源，使用 postMessage：</span>
<span class="hljs-keyword">if</span> (event.<span class="hljs-property">origin</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>) <span class="hljs-keyword">return</span>;
</code></pre>
<hr/>
<h3 data-id="heading-57">十、浏览器兼容性</h3>















































<table><thead><tr><th>浏览器</th><th>postMessage</th><th>MessageChannel</th><th>BroadcastChannel</th><th>Storage</th></tr></thead><tbody><tr><td>Chrome</td><td>✅ 全版本</td><td>✅ 全版本</td><td>✅ 54+</td><td>✅ 全版本</td></tr><tr><td>Firefox</td><td>✅ 全版本</td><td>✅ 全版本</td><td>✅ 38+</td><td>✅ 全版本</td></tr><tr><td>Safari</td><td>✅ 全版本</td><td>✅ 全版本</td><td>✅ 15.1+</td><td>✅ 全版本</td></tr><tr><td>Edge</td><td>✅ 全版本</td><td>✅ 全版本</td><td>✅ 79+</td><td>✅ 全版本</td></tr><tr><td>IE</td><td>✅ 11+</td><td>✅ 11+</td><td>❌ 不支持</td><td>✅ 8+</td></tr></tbody></table>
<h4 data-id="heading-58">处理兼容性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 检测 BroadcastChannel 支持</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">BroadcastChannel</span> !== <span class="hljs-string">'undefined'</span>) {
  <span class="hljs-comment">// 使用 BroadcastChannel</span>
  <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'sync'</span>);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// 降级方案：使用 postMessage 或 localStorage</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'浏览器不支持 BroadcastChannel，使用降级方案'</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-59">十一、最终决策指南</h3>
<h4 data-id="heading-60">11.1 选择标准与决策树</h4>
<pre><code class="hljs language-javascript" lang="javascript">需要跨标签页通信吗？
  ├─ 不需要 → 使用本地 <span class="hljs-title class_">Vue</span> 状态管理
  └─ 需要
      ├─ 需要跨源吗？
      │   ├─ 是 → 使用 postMessage 或 <span class="hljs-title class_">MessageChannel</span>
      │   └─ 否
      │       ├─ 需要实时通信吗？
      │       │   ├─ 是 → 🎯 使用 <span class="hljs-title class_">BroadcastChannel</span>
      │       │   └─ 否
      │       │       ├─ 需要数据持久化吗？
      │       │       │   ├─ 是 → <span class="hljs-variable language_">localStorage</span> + <span class="hljs-title class_">BroadcastChannel</span>
      │       │       │   └─ 否 → sessionStorage + 轮询（不推荐）
</code></pre>
<h4 data-id="heading-61">11.2 推荐方案汇总</h4>








































<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td><strong>实时同步（同源）</strong></td><td>🎯 BroadcastChannel</td><td>简洁、高效、无需轮询</td></tr><tr><td><strong>数据持久化+实时同步</strong></td><td>localStorage + BroadcastChannel</td><td>数据持久 + 实时通知</td></tr><tr><td><strong>跨源通信</strong></td><td>postMessage</td><td>唯一支持跨源的方案</td></tr><tr><td><strong>点对点可靠通信</strong></td><td>MessageChannel</td><td>双向可靠通道</td></tr><tr><td><strong>浏览器兼容性最高</strong></td><td>postMessage</td><td>最广泛的浏览器支持</td></tr><tr><td><strong>不推荐</strong></td><td>❌ Storage 作消息队列</td><td>需轮询、易丢失、难维护</td></tr></tbody></table>
<h4 data-id="heading-62">11.3 最佳实践清单</h4>
<ol>
<li>✅ <strong>优先选择 BroadcastChannel</strong>（在同源场景下）</li>
<li>✅ <strong>使用明确的通道命名</strong>（避免冲突）</li>
<li>✅ <strong>总是在组件卸载时关闭通道</strong>（防止内存泄漏）</li>
<li>✅ <strong>使用 router.replace 同步 URL</strong>（确保刷新后状态一致）</li>
<li>✅ <strong>只传递必要的数据</strong>（减少序列化开销）</li>
<li>✅ <strong>提供降级方案</strong>（考虑旧浏览器兼容性）</li>
<li>❌ <strong>不要用 Storage 作消息队列</strong>（这是对 API 的误用）</li>
</ol>
<hr/>
<h3 data-id="heading-63">十二、常见问题 FAQ</h3>
<h4 data-id="heading-64">Q1: 为什么 BroadcastChannel 收不到消息？</h4>
<p><strong>A</strong>: 检查以下几点：</p>
<ol>
<li>✅ 通道名称是否一致</li>
<li>✅ 是否为同源页面（协议、域名、端口都要相同）</li>
<li>✅ 是否调用了 <code>channel.close()</code></li>
<li>✅ 消息是否发送在监听器创建之后</li>
</ol>
<h4 data-id="heading-65">Q2: 为什么不用 Storage 作消息队列？</h4>
<p><strong>A</strong>: 因为 Storage 的设计本就不是为了消息通信：</p>
<ul>
<li>❌ 同一标签页修改无法触发事件</li>
<li>❌ 消息会被后续消息覆盖</li>
<li>❌ 需要轮询，延迟大</li>
<li>❌ 需要版本号/时间戳等复杂机制</li>
<li>❌ 消息可靠性低</li>
</ul>
<p><strong>这就是为什么 BroadcastChannel 被设计出来的原因。</strong></p>
<h4 data-id="heading-66">Q3: localStorage 可以用于跨标签页通信吗？</h4>
<p><strong>A</strong>: 可以，但<strong>不推荐</strong>作为主要通信机制：</p>
<ul>
<li>⚠️ 需要轮询或定时检查</li>
<li>⚠️ 延迟大（通常 100ms+）</li>
<li>⚠️ 消息易丢失（被新消息覆盖）</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>需要数据持久化时，配合 BroadcastChannel 使用</li>
<li>离线数据同步时</li>
<li>跨会话数据恢复时</li>
</ul>
<h4 data-id="heading-67">Q4: 如何实现跨源通信？</h4>
<p><strong>A</strong>: 使用 postMessage 或 MessageChannel，但要注意安全性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// postMessage 跨源通信</span>
newWindow.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'https://trusted-domain.com'</span>);

<span class="hljs-comment">// 接收端必须验证来源</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">origin</span> !== <span class="hljs-string">'https://trusted-domain.com'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// 安全处理消息</span>
});
</code></pre>
<h4 data-id="heading-68">Q5: BroadcastChannel 中的错误如何处理？</h4>
<p><strong>A</strong>: 监听 <code>messageerror</code> 事件：</p>
<pre><code class="hljs language-javascript" lang="javascript">channel.<span class="hljs-property">onmessageerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'消息解析错误:'</span>, event);
};

<span class="hljs-comment">// 或使用 addEventListener</span>
channel.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'messageerror'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'消息错误:'</span>, event);
});
</code></pre>
<hr/>
<h3 data-id="heading-69">十三、应用场景拓展</h3>
<p>BroadcastChannel 的应用远不止跨标签页数据同步，还包括：</p>
<h4 data-id="heading-70">场景 1：电商库存实时同步</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 多个门店系统标签页同时打开</span>
<span class="hljs-keyword">const</span> inventoryChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'inventory_sync'</span>);

<span class="hljs-comment">// 门店 A 在标签页 1 扫描商品入库</span>
inventoryChannel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'STOCK_IN'</span>,
  <span class="hljs-attr">productId</span>: <span class="hljs-string">'SKU-123'</span>,
  <span class="hljs-attr">quantity</span>: <span class="hljs-number">50</span>,
  <span class="hljs-attr">location</span>: <span class="hljs-string">'warehouse-1'</span>,
  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
});

<span class="hljs-comment">// 门店 B 在标签页 2 自动收到更新</span>
inventoryChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'STOCK_IN'</span>) {
    <span class="hljs-title function_">updateInventory</span>(event.<span class="hljs-property">data</span>);
    <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">`库存已更新：<span class="hljs-subst">${event.data.quantity}</span>件`</span>);
  }
};
</code></pre>
<h4 data-id="heading-71">场景 2：订单状态实时同步</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orderChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'order_sync'</span>);

<span class="hljs-comment">// 后台管理页面在标签页 1 更新订单状态</span>
orderChannel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">orderId</span>: <span class="hljs-string">'ORD-2024-001'</span>,
  <span class="hljs-attr">status</span>: <span class="hljs-string">'shipped'</span>,
  <span class="hljs-attr">trackingNo</span>: <span class="hljs-string">'TRK123456'</span>,
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
});

<span class="hljs-comment">// 客服页面在标签页 2 自动获取最新状态</span>
orderChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-title function_">updateOrderUI</span>(event.<span class="hljs-property">data</span>);
  <span class="hljs-title function_">notifyCustomer</span>(<span class="hljs-string">`订单 <span class="hljs-subst">${event.data.orderId}</span> 已<span class="hljs-subst">${event.data.status}</span>`</span>);
};
</code></pre>
<h4 data-id="heading-72">场景 3：用户账户设置实时同步</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userSettingsChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'user_settings_sync'</span>);

<span class="hljs-comment">// 用户在账户设置页面（标签页 1）修改主题</span>
userSettingsChannel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'THEME_CHANGED'</span>,
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
  <span class="hljs-attr">userId</span>: <span class="hljs-string">'12345'</span>,
});

<span class="hljs-comment">// 所有打开的应用页面（标签页 2、3、4...）自动同步</span>
userSettingsChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'THEME_CHANGED'</span>) {
    <span class="hljs-title function_">applyTheme</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">theme</span>);
    <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'主题已切换为深色模式'</span>);
  }
};
</code></pre>
<h4 data-id="heading-73">场景 4：实时数据仪表板</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dashboardChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'analytics_dashboard'</span>);

<span class="hljs-comment">// 数据分析工具在后台收集数据（标签页 1）</span>
dashboardChannel.<span class="hljs-title function_">postMessage</span>({
  <span class="hljs-attr">metric</span>: <span class="hljs-string">'daily_sales'</span>,
  <span class="hljs-attr">value</span>: <span class="hljs-number">15000</span>,
  <span class="hljs-attr">region</span>: <span class="hljs-string">'east'</span>,
  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
});

<span class="hljs-comment">// 多个仪表板视图（标签页 2、3、4...）自动刷新</span>
dashboardChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-title function_">updateChart</span>(event.<span class="hljs-property">data</span>);
  <span class="hljs-title function_">updateDataCard</span>(event.<span class="hljs-property">data</span>);
  <span class="hljs-title function_">playNotificationSound</span>(); <span class="hljs-comment">// 新数据到达时提醒</span>
};
</code></pre>
<hr/>
<h3 data-id="heading-74">结语</h3>
<p>BroadcastChannel 代表了现代 Web 应用通信的最佳实践——<strong>简洁、高效、易维护</strong>。</p>
<p>通过充分理解五种跨窗口通信方案的优劣，我们能够在实际项目中做出最合理的技术选择。正确的通信机制是系统可靠性的基石。</p>
<p><strong>关键要点</strong>：</p>
<ol>
<li>🎯 同源场景下，<strong>BroadcastChannel 是首选</strong></li>
<li>📊 Storage 用于持久化，不用于消息通信</li>
<li>✅ 总是记得关闭通道，防止内存泄漏</li>
<li>🔄 URL 同步确保刷新后状态一致</li>
<li>🚀 简单场景也能做到优雅实现</li>
</ol>
<hr/>
<h3 data-id="heading-75">附录：技术对比速查表</h3>
<h4 data-id="heading-76">五种方案对比一览表</h4>













































































<table><thead><tr><th>维度</th><th>postMessage</th><th>MessageChannel</th><th>BroadcastChannel</th><th>sessionStorage</th><th>localStorage</th></tr></thead><tbody><tr><td><strong>代码行数</strong></td><td>20-30</td><td>40-50</td><td>10-15</td><td>30-40</td><td>30-40</td></tr><tr><td><strong>学习难度</strong></td><td>低</td><td>高</td><td>低</td><td>低</td><td>低</td></tr><tr><td><strong>实时性</strong></td><td>ms 级</td><td>ms 级</td><td>ms 级</td><td>秒级+</td><td>秒级+</td></tr><tr><td><strong>可靠性</strong></td><td>高</td><td>高</td><td>高</td><td>低</td><td>低</td></tr><tr><td><strong>内存效率</strong></td><td>好</td><td>中</td><td>好</td><td>差</td><td>差</td></tr><tr><td><strong>消息丢失率</strong></td><td>0%</td><td>0%</td><td>0%</td><td>10%+</td><td>10%+</td></tr><tr><td><strong>性能评分</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐</td><td>⭐</td></tr><tr><td><strong>综合评分</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐</td><td>⭐</td></tr></tbody></table>
<h4 data-id="heading-77">实现代码对比</h4>
<p><strong>BroadcastChannel（3 行）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'sync'</span>);
ch.<span class="hljs-title function_">postMessage</span>(data);
ch.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">handle</span>(e.<span class="hljs-property">data</span>);
</code></pre>
<p><strong>sessionStorage（15+ 行）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageMessageQueue</span>(<span class="hljs-string">'sync'</span>);
queue.<span class="hljs-title function_">send</span>(data);
queue.<span class="hljs-title function_">onMessage</span>(handle);
</code></pre>
<p><strong>postMessage（25+ 行）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> win = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url);
win.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>);
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">handle</span>(e.<span class="hljs-property">data</span>));
</code></pre>
<hr/>
<p><strong>参考资源</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FBroadcastChannel" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" ref="nofollow noopener noreferrer">MDN - BroadcastChannel API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FMessageChannel" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel" ref="nofollow noopener noreferrer">MDN - MessageChannel API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWindow%2FpostMessage" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" ref="nofollow noopener noreferrer">MDN - Window.postMessage()</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Storage_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API" ref="nofollow noopener noreferrer">MDN - Web Storage API</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（23）什么是Hibernate的caching provider？]]></title>    <link>https://juejin.cn/post/7591497387246354468</link>    <guid>https://juejin.cn/post/7591497387246354468</guid>    <pubDate>2026-01-05T12:01:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591497387246354468" data-draft-id="7591697558376841258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（23）什么是Hibernate的caching provider？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T12:01:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（23）什么是Hibernate的caching provider？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:01:27.000Z" title="Mon Jan 05 2026 12:01:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的Caching Provider</h3>
<p>在Hibernate中，缓存（Caching）是提高应用程序性能的重要机制。缓存可以减少对数据库的访问次数，从而降低数据库的负载和延迟。Hibernate支持两级缓存机制：</p>
<ol>
<li><strong>一级缓存（First Level Cache）</strong>：Session级别的缓存，默认启用且不可关闭。</li>
<li><strong>二级缓存（Second Level Cache）</strong>：SessionFactory级别的缓存，需要显式配置和开启。</li>
</ol>
<p>为了使用二级缓存，必须配置一个缓存提供者（Caching Provider）。常见的缓存提供者包括：</p>
<ul>
<li><strong>EHCache</strong></li>
<li><strong>Infinispan</strong></li>
<li><strong>OSCache</strong></li>
<li><strong>Hazelcast</strong></li>
</ul>
<h3 data-id="heading-1">配置EHCache作为Hibernate的缓存提供者</h3>
<h4 data-id="heading-2">步骤</h4>
<ol>
<li><strong>添加依赖</strong>：在项目的依赖管理文件中添加EHCache和Hibernate的相关依赖。</li>
<li><strong>配置<code>hibernate.cfg.xml</code>文件</strong>：添加缓存相关的配置。</li>
<li><strong>配置EHCache的缓存配置文件<code>ehcache.xml</code></strong>。</li>
<li><strong>在实体类中配置缓存注解</strong>。</li>
</ol>
<h3 data-id="heading-3">示例代码</h3>
<h4 data-id="heading-4">添加Maven依赖</h4>
<p>在<code>pom.xml</code>文件中添加以下依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Hibernate Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate EHCache --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- EHCache Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 二级缓存配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.jcache.JCacheRegionFactory<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.javax.cache.provider"</span>&gt;</span>org.ehcache.jsr107.EhcacheCachingProvider<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.javax.cache.uri"</span>&gt;</span>/ehcache.xml<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">EHCache配置文件 <code>ehcache.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ehcache:config</span>
    <span class="hljs-attr">xmlns:ehcache</span>=<span class="hljs-string">"http://www.ehcache.org/v3"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"com.example.domain.Person"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">expiry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ttl</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"minutes"</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">ttl</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">expiry</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">heap</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"entries"</span>&gt;</span>1000<span class="hljs-tag">&lt;/<span class="hljs-name">heap</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">offheap</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"MB"</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">offheap</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">cache</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">ehcache:config</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">实体类 <code>Person</code></h4>
<p>在实体类中使用缓存注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> org.hibernate.annotations.Cache;
<span class="hljs-keyword">import</span> org.hibernate.annotations.CacheConcurrencyStrategy;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-meta">@Cacheable</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-8">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-9">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-10">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（24）Hibernate如何实现乐观锁？]]></title>    <link>https://juejin.cn/post/7591697558376857642</link>    <guid>https://juejin.cn/post/7591697558376857642</guid>    <pubDate>2026-01-05T12:02:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591697558376857642" data-draft-id="7591513171199541311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（24）Hibernate如何实现乐观锁？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T12:02:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（24）Hibernate如何实现乐观锁？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:02:17.000Z" title="Mon Jan 05 2026 12:02:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate实现乐观锁</h3>
<p>乐观锁（Optimistic Locking）是一种并发控制机制，它允许多个事务并发地读取和修改相同的数据，但在提交时会检查数据是否被其他事务修改过。如果数据被其他事务修改过，当前事务会回滚并重新尝试。乐观锁通常通过版本号（version number）或时间戳（timestamp）来实现。</p>
<p>在Hibernate中，乐观锁可以通过在实体类上添加<code>@Version</code>注解来实现。当一个事务尝试更新数据时，Hibernate会检查版本号或时间戳是否与数据库中的值匹配。如果不匹配，则抛出<code>OptimisticLockException</code>。</p>
<h3 data-id="heading-1">实现步骤</h3>
<ol>
<li><strong>创建实体类</strong>并在需要使用乐观锁的字段上添加<code>@Version</code>注解。</li>
<li><strong>配置Hibernate</strong>。</li>
<li><strong>使用Hibernate进行CRUD操作</strong>，演示乐观锁的工作原理。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">实体类 <code>Person</code></h4>
<p>在实体类中使用<code>@Version</code>注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@Version</span>
    <span class="hljs-meta">@Column(name = "version")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> version;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> version;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVersion</span><span class="hljs-params">(<span class="hljs-type">int</span> version)</span> {
        <span class="hljs-built_in">this</span>.version = version;
    }
}
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-7">乐观锁使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.exception.OptimisticLockException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateOptimisticLockExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 创建示例数据</span>
        createPerson(sessionFactory);

        <span class="hljs-comment">// 模拟两个并发事务进行更新操作</span>
        simulateConcurrentUpdates(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simulateConcurrentUpdates</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-comment">// 第一个事务</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; updatePerson(sessionFactory, <span class="hljs-number">1L</span>, <span class="hljs-string">"John Doe 1"</span>, <span class="hljs-number">31</span>));
        <span class="hljs-comment">// 第二个事务</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; updatePerson(sessionFactory, <span class="hljs-number">1L</span>, <span class="hljs-string">"John Doe 2"</span>, <span class="hljs-number">32</span>));

        thread1.start();
        thread2.start();

        <span class="hljs-keyword">try</span> {
            thread1.join();
            thread2.join();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory, Long personId, String newName, <span class="hljs-type">int</span> newAge)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取Person实体</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, personId);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 更新Person实体字段</span>
                person.setName(newName);
                person.setAge(newAge);
                <span class="hljs-comment">// 提交事务前会检查版本号</span>
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID: "</span> + personId);
            }
        } <span class="hljs-keyword">catch</span> (OptimisticLockException e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            System.err.println(<span class="hljs-string">"Optimistic lock exception encountered for Person ID: "</span> + personId);
            e.printStackTrace();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性配置以及实体类映射配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：使用<code>@Version</code>注解定义版本字段。</p>
<ul>
<li><code>@Version</code>：表示版本字段，用于乐观锁的实现。每次更新时，Hibernate会检查版本号是否匹配。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Version</span>
<span class="hljs-meta">@Column(name = "version")</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> version;
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入操作和模拟并发更新操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateOptimisticLockExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
<li>
<p><strong>模拟并发更新</strong>：使用两个线程来模拟并发更新同一个实体，从而展示乐观锁的工作原理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simulateConcurrentUpdates</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
    <span class="hljs-comment">// 第一个事务</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; updatePerson(sessionFactory, <span class="hljs-number">1L</span>, <span class="hljs-string">"John Doe 1"</span>, <span class="hljs-number">31</span>));
    <span class="hljs-comment">// 第二个事务</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; updatePerson(sessionFactory, <span class="hljs-number">1L</span>, <span class="hljs-string">"John Doe 2"</span>, <span class="hljs-number">32</span>));

    thread1.start();
    thread2.start();

    <span class="hljs-keyword">try</span> {
        thread1.join();
        thread2.join();
    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
        e.printStackTrace();
    }
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>通过在实体类中添加<code>@Version</code>注解，Hibernate可以实现乐观锁。当多个事务并发地修改同一实体时，乐观锁确保了只有版本号匹配的事务才能成功提交，从而避免数据不一致的问题。通过模拟并发更新操作，可以清楚地看到乐观锁的工作原理和效果。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM 量化技术概述及 AWQ 和 GPTQ 介绍]]></title>    <link>https://juejin.cn/post/7591694511246114854</link>    <guid>https://juejin.cn/post/7591694511246114854</guid>    <pubDate>2026-01-05T12:01:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591694511246114854" data-draft-id="7591694511246098470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM 量化技术概述及 AWQ 和 GPTQ 介绍"/> <meta itemprop="keywords" content="算法,自动驾驶"/> <meta itemprop="datePublished" content="2026-01-05T12:01:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM 量化技术概述及 AWQ 和 GPTQ 介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T12:01:30.000Z" title="Mon Jan 05 2026 12:01:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>近期在学习 Qwen3 的模型结构时，看到了 Qwen 使用了 GPTQ 与 AWQ 量化方案，于是便萌生了介绍 LLM 量化技术的想法，笔者将用 2-3 篇文章，给读者们介绍大模型量化的技术。</p>
<p>量化是指将高精度计算的浮点型数据近似为低比特位数据（如 int16、int8、int4 等）的过程，此过程需在不显著损耗精度的同时，提升模型推理效率并降低内存占用。特别是在当前主流大语言模型（LLM）的参数量轻松突破万亿规模的情况下，量化技术对于高效低成本部署 LLM 尤为重要。而且由于 LLM 的参数量巨大，当前主流的模型都采用 PTQ 后量化技术，从而降低量化过程带来的成本。</p>
<p>在正式开始这篇文章之前，我们首先来了解一下 LLM 量化的相关概念。</p>
<h2 data-id="heading-1">二、LLM 量化相关概念</h2>
<h3 data-id="heading-2">2.1 LLM 量化常用的数值格式</h3>
<p><img src="http://openwrite.cn/uploads/19742/58246/4d2443d1-2924-4db7-8777-c51dc20103e6.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 LLM 量化对象</h3>
<p>在部署推理时，LLM 的量化对象与传统的 CNN 有所不同，除了权重与激活以外，还增加了 LLM 特有的 KV Cache。所以，LLM 的量化对象主要是权重、激活和 KV Cache。</p>
<ul>
<li><strong>​权重量化：​</strong>仅对 LLM 中的权重进行量化，常见的方法有 GPTQ （W4A16，权重量化为 INT4，激活保持 FP16/BF16）、AWQ（W4A16/W8A16）等；</li>
<li><strong>​激活量化：​</strong>对 LLM 中的激活进行量化，常见的方法有 SmoothQuant （W8A8）、LLM.int8（）等，由于激活分布范围大且动态变化，相比权重量化更具挑战；</li>
<li>**​KV​​ Cache 量化：**在 LLM 推理中，为避免重复计算，会缓存 Attention 中的 Key/Value 向量（KV Cache）。<strong>​ ​</strong> KV Cache 的大小与 上下文长度线性相关，是长文本推理时的主要显存瓶颈。常见的方法有 KV Cache INT8/INT4 量化。</li>
</ul>
<p>LLM 的实际部署过程中，常见的量化方案包括：</p>
<ul>
<li>​<strong>W4A16</strong>​（GPTQ、AWQ） ：权重量化为 INT4，激活保持 FP16/BF16。</li>
<li><strong>W8A16</strong> ： 权重量化为 INT8，激活保持 FP16/BF16。</li>
<li>​<strong>W8A8</strong>​（SmoothQuant）： 权重和激活均量化为 INT8。</li>
<li><strong>KV​ Cache INT8</strong> ：缓解长上下文显存开销。</li>
</ul>
<p>下面，我们将对具体的量化方法进行介绍。</p>
<h2 data-id="heading-4">三、主流 LLM 量化方法介绍</h2>
<p>Qwen 系列模型使用了 AWQ、GPTQ 和 llama.cpp 中的量化技术，且推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 结合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasper-hansen%2FAutoAWQ" target="_blank" title="https://github.com/casper-hansen/AutoAWQ" ref="nofollow noopener noreferrer">AutoAWQ</a>，所以本节我们先介绍此方法。</p>
<h3 data-id="heading-5">3.1 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 结合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasper-hansen%2FAutoAWQ" target="_blank" title="https://github.com/casper-hansen/AutoAWQ" ref="nofollow noopener noreferrer">AutoAWQ </a>量化方法介绍及使用示例</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 全称为 ACTIVATION-AWARE WEIGHT QUANTIZATION，即<strong>​激活感知的权重量化，​</strong>是一种针对 LLM 的低比特权重量化的硬件友好方法。AWQ 在业界广泛应用，除了官方的支持<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fmit-han-lab%2Fllm-awq" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/mit-han-lab/llm-awq" ref="nofollow noopener noreferrer"> llm-awq </a>外，<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fcasper-hansen%2FAutoAWQ" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/casper-hansen/AutoAWQ" ref="nofollow noopener noreferrer">AutoAWQ</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fvllm-project%2Fvllm%2Fblob%2Fmain%2Fvllm%2Fmodel_executor%2Fquantization_utils%2Fawq.py" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/vllm-project/vllm/blob/main/vllm/model_executor/quantization_utils/awq.py" ref="nofollow noopener noreferrer">vLLM</a>、 <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fhuggingface%2Ftext-generation-inference%2Fpull%2F1054" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/huggingface/text-generation-inference/pull/1054" ref="nofollow noopener noreferrer">HuggingFace </a>NVIDIA <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2FNVIDIA%2FTensorRT-LLM%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/NVIDIA/TensorRT-LLM/" ref="nofollow noopener noreferrer">TensorRT-LLM</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Flm-sys%2FFastChat%2Fblob%2Fmain%2Fdocs%2Fawq.md" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/lm-sys/FastChat/blob/main/docs/awq.md" ref="nofollow noopener noreferrer">FastChat</a> 等主流模型或框架也提供了对 AWQ 的支持。</p>
<h4 data-id="heading-6">3.1.1 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 量化技术原理</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 作者认为：</p>
<ol>
<li>权重对于大语言模型的性能并不同样重要， 有一小部分（0.1%-1%）对模型精度影响较大的关键权重；跳过这些关键权重的量化将显著减少量化精度损失。</li>
<li>而且，关键权重对应于较大激活幅度的权重通道更加显着，因为它们处理更重要的特征，从而根据这个现象寻找关键权重。尽管将 0.1% 的权重保留为 FP16 可以在不明显增加模型大小的情况下提高量化性能，但这种混合精度数据类型会给系统实现带来困难（硬件效率低下）。</li>
<li>设计了一种 per-channel 缩放方法来自动搜索最佳缩放，从而减少显著权重的量化误差，这种方法不存在硬件效率低下的问题。</li>
</ol>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MTQzMTVkYmJjMWVkNDQxYTQ5ZmI3N2QwYTZmNTMwMmRfR3hTcDA1Mm9uVHR1emtWeXBNRkZlV0ZxVTcxNFRueExfVG9rZW46WVVsN2JsNVlvbzJvZEd4S1RmZ2NtYUhNbnBmXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<blockquote>
<p>PPL：即困惑度 Perplexity，是语言模型预测序列的平均不确定性度量。PPL 越小，表示模型越“自信”且预测越接近真实分布；PPL 越大，说明预测分布和真实分布偏差更大。</p>
</blockquote>
<p>上图是作者的实验，可以看出：</p>
<ul>
<li>左图：所有的权重都从 FP16 量化到 INT3，PPL 为 43.2；</li>
<li>中图：基于激活分布找到了 1% 的关键权重，将关键权重保持 FP16 精度，其余权重量化到 INT3，PPL 由 43.2 大幅下降至 13.0，但这种混合精度格式在硬件上运行并不高效；</li>
<li>右图： AWQ 执行 per-channel 缩放以保护关键权重从而减少量化误差，这里可以看到缩放 weight 后再做量化的 PPL 为 13.0，缩放本身未对精度产生影响。</li>
</ul>
<p>权重的缩放因子 s 为超参数，作者在<strong>​ OPT-6.7B ​</strong>模型上做了对比实验，发现当 s 比较大比如等于 4 时，非关键通道的相对误差将会增加（非显著通道的误差将被放大）。</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MWFiNzcxMjg5MmViZDJkMDEyZWQ2ZjkyZjZiNzQ5NTRfWmplTFBMOFlrMnJvNDVFM2xtNnZ4S2owem53aFJndDdfVG9rZW46UkhNRGI2anRjb1FUeUh4ZVhTYWNQMkIzbndoXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<p>为了同时考虑关键权重和非关键权重，AWQ 选择<strong>自动搜索最佳（每个输入通道）缩放因​</strong>子，使某一层量化后的输出差最小。这就把量化问题建模为如下的最优化问题：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=ODI2NDY4OWUzMTkzZmFmOWFiYTI2MmVlMGRkYzQ4M2RfV0h6QmtPSUZ5cnEwaFJrSU1mSEEwREpYOXkybnlwSXNfVG9rZW46VVNETmJFaFZQb1piUXF4aWJqRGNqU09kbm9kXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<p>为提升该过程的稳定性，我们通过分析影响缩放因子（scaling factor）选择的相关因素，为最优缩放比例（optimal scale）定义了一个搜索空间（search space）。如前一部分所述，权重通道（weight channels）的显著性实际上由激活值缩放比例（activation scale）决定（即 “激活感知性”，activation-awareness）。因此，AWQ 采用了一个极为简洁的搜索空间，具体如下：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YzcxOWYyMDM4MjdmOGIxNzdmOTYyMzBjM2FjNTJiNWNfcEdaNVdwRnJXZEo3T3JpUUM0elBmNTB1U0dvck9FS2hfVG9rZW46Q09xU2JrWE93b3FIbm54a1dnbWNXRHI1bnFkXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<p>其中 <em>α</em> 是用于平衡对关键 channel 与非关键 channel 的保护力度。通过在区间 [0， 1] 内执行快速网格搜索（grid search），可确定最优的 <em>α</em> 值（其中 ​<em>α</em>​=0 代表不进行缩放；​<em>α</em>​=1 代表在我们的搜索空间内采用最激进的缩放策略）。此外，论文中还引入了权重裁剪（weight clipping）操作，以最小化量化过程中的均方误差（MSE）。</p>
<h4 data-id="heading-7">3.1.2 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a> 量化模型示例</h4>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ</a></strong>​<strong>​ 与 HuggingFace Transformers 无缝兼容</strong>​，加载模型后可以直接 <code>.quantize()</code> 做量化，相关使用流程如下。</p>
<h6 data-id="heading-8">安装依赖</h6>
<pre><code class="hljs language-Plain" lang="Plain">pip3 install transformers accelerate autoawq
</code></pre>
<h6 data-id="heading-9">量化模型</h6>
<pre><code class="hljs language-Plain" lang="Plain">from awq import AutoAWQForCausalLM
from transformers import AutoTokenizer
from transformers import AwqConfig

model_path = "facebook/opt-125m"
quant_path = "opt-125m-awq"
#量化参数配置
quant_config = {
    "zero_point": True,
    "q_group_size": 128,
    "w_bit": 4,
    "version": "GEMM"
}

# 加载模型
model = AutoAWQForCausalLM.from_pretrained(model_path, device_map="auto")
tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True)
#准备校准数据
data = []
for msg in dataset:
    text = tokenizer.apply_chat_template(msg, tokenize=False, add_generation_prompt=False)
    data.append(text.strip())

# 量化
model.quantize(tokenizer, quant_config=quant_config,calib_data=data)

# 修改配置，保证和 Transformers 兼容
quantization_config = AwqConfig(
    bits=quant_config["w_bit"],
    group_size=quant_config["q_group_size"],
    zero_point=quant_config["zero_point"],
    version=quant_config["version"].lower(),
).to_dict()

model.model.config.quantization_config = quantization_config

# 保存模型
model.save_quantized(quant_path, safetensors=True, shard_size="4GB")
tokenizer.save_pretrained(quant_path)
</code></pre>
<p><code>quant_config</code> 参数解析：</p>
<ul>
<li><code>"w_bit"</code>： 权重量化的位宽</li>
<li><code>"q_group_size"</code>：量化不是对整个权重张量做一次缩放，而是分组处理，上述示例选择每组 128 个权重会共享一组缩放因子（scale）和零点（zero point），<code>128</code> 是一个常用折中值（Meta 在 LLaMA-2/3 的 INT4 AWQ 中也常用 128）。</li>
<li><code>"zero_point"</code>：是否使用零点（zero point）补偿，如果设成 <code>False</code>，就是对称量化（中心对齐 0），如果设成 <code>True</code>，就是非对称量化，可以更好覆盖权重分布，提高精度。</li>
<li><code>"version":</code>​<code> </code>​<strong>底层推理内核类型</strong>​（后端实现方式）。<code>GEMM</code>：通用矩阵乘法（General Matrix Multiplication），适合大模型的权重矩阵乘法。<code>GEMV</code>：矩阵-向量乘法（适合批次小、延迟敏感的场景）。一般推荐用 <code>GEMM</code>，因为推理框架（Transformers， vLLM 等）大部分优化都是基于 GEMM 内核。</li>
</ul>
<h6 data-id="heading-10">加载量化后的模型进行推理</h6>
<pre><code class="hljs language-Plain" lang="Plain">from transformers import AutoTokenizer, AutoModelForCausalLM

quant_path = "opt-125m-awq"

tokenizer = AutoTokenizer.from_pretrained(quant_path, trust_remote_code=True)
model = AutoModelForCausalLM.from_pretrained(quant_path, device_map="auto")

text = "Hello my name is"
inputs = tokenizer(text, return_tensors="pt").to(0)

out = model.generate(**inputs, max_new_tokens=20)
print(tokenizer.decode(out[0], skip_special_tokens=True))
</code></pre>
<h3 data-id="heading-11">3.2 GPTQ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2210.17323" target="_blank" title="https://arxiv.org/abs/2210.17323" ref="nofollow noopener noreferrer">GPTQ</a>（Gradient Post-Training Quantization）是一种针对类 GPT 大型语言模型的量化方法，它基于近似二阶信息进行一次性权重量化。本节将会介绍 GPTQ 量化的基本原理，同时也会展示如何通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAutoGPTQ%2FAutoGPTQ" target="_blank" title="https://github.com/AutoGPTQ/AutoGPTQ" ref="nofollow noopener noreferrer"> AutoGPTQ </a>来对您自己的模型进行量化处理。GPTQ 量化具有以下特点：</p>
<p>GPTQ 量化的优点：</p>
<ul>
<li>​<strong>无须重新训练</strong>​（仅需少量校准数据）。</li>
<li>量化精度接近全精度，4bit GPTQ 能维持 LLaMA、OPT 等模型接近 FP16 的性能。</li>
<li>速度快，实用性强，已成为主流 LLM 低比特推理方法。</li>
</ul>
<p>GPTQ 量化的缺点：</p>
<ul>
<li>量化过程涉及 Hessian 矩阵近似和逐元素优化，计算复杂度较高。</li>
<li>一般只量化权重，激活量化效果不佳（通常保持 FP16）。</li>
</ul>
<h4 data-id="heading-12">3.2.1 GPTQ 量化技术原理</h4>
<p>GPTQ 是一种高精度、高效率的量化方法，它可以在大约四个 GPU 小时内量化具有 1750 亿个参数的 GPT 模型，将位宽降低到每个权重 3 位或 4 位，与未压缩基线相比，精度下降可以忽略不计。GPTQ 源于 OBQ（Optimal Brain Quantization），而 OBQ 改进自剪枝方法 OBS（Optimal Brain Surgeon），OBS 又源自 Yann LeCun 1990 年提出的 OBD（Optimal Brain Damage）。OBD 通过泰勒展开简化目标函数并计算海森矩阵确定参数影响；OBS 考虑参数交叉项，求海森矩阵逆确定剪枝顺序并更新其他参数减少误差。OBQ 将剪枝思路推广到量化，视剪枝为近似 0 的特殊量化，但速度慢，大模型量化需数天。GPTQ 作为 OBQ 加速版，优化算法性能，降低复杂度并保证精度，176B Bloom 模型量化不到 4 小时，且有严谨数学理论推导。</p>
<p>GPTQ 在执行量化操作时，会先对权重实施分组处理（比如，每 128 列划分为一个组），进而构成若干个数据块。对于每个数据块里的全部参数，会逐一开展量化工作。在完成某一个参数的量化后，借助校准数据集，对该数据块中其余还未进行量化的参数进行合理调节，通过这种方式来补偿量化过程中产生的精度损耗。GPTQ 的量化过程如下所示：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MzIwMjJhNjNlZDgxZjgwYzIzMjc3MTM3ZmFmOGNmZDdfZ2dWUFN4Z1djenZKT3huNklLdlJtVzFHRVo5WVJEQ0tfVG9rZW46S1owMmI2V0RPb21tNEN4UDY3Z2M5a09IbmNlXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<ol>
<li>
<h5 data-id="heading-13">前向采样数据</h5>
</li>
</ol>
<p>先用一小部分校准数据（calibration data，通常只需几百到几千条样本，比如来自模型训练语料的子集），将校准数据喂入原始全精度模型，收集每一层的 ​**激活值（输入向量 X）**​。</p>
<ol start="2">
<li>
<h5 data-id="heading-14">构造量化优化问题</h5>
</li>
</ol>
<p>GPTQ 的目标是 ​<strong>最小化量化后输出误差的二次形式</strong>​：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=OGIzOGQxZjc0NmI1MjYwNTU4MzUwM2ZkYjY1M2M3YmNfdkZyOW9zWFlCNnhiWE9uRG9iWXFJV3hWV3dhbWdvcXJfVG9rZW46RHpxMmJNdUpYb1ByY0h4NktHNmNrWER1bmFmXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<p>其中 WX 为量化前的权重和激活输入，另外一项为量化后的权重和激活。</p>
<ol start="3">
<li>
<h5 data-id="heading-15">Hessian 近似</h5>
</li>
</ol>
<p>GPTQ 使用输入激活的协方差来近似 Hessian，这样就转化为公式（2）中的问题：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MWFmZWU1ZDNlZDY2ZjkyY2ZiYzg2Y2ZjODdiOTMwNDFfQ3JNUndRd2MweTJ6c0NvSTVJVFVrTDRqMkhEWEIzUmNfVG9rZW46VENzM2J5aTZ0b2Fodk94eUtEZWNocWVrbmxiXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<ol start="4">
<li>
<h5 data-id="heading-16">逐元素优化（带校正）</h5>
</li>
</ol>
<p>GPTQ 不一次性量化整个权重矩阵，而是 ​<strong>逐元素（或逐块）地量化权重</strong>​。对每个权重，在量化时会根据 Hessian 的对角线项（近似二阶导信息）进行 误差校正，首先量化一个权重，然后更新剩余权重的“残差误差”，这相当于执行一次 ​<strong>逐步的高斯消元式校正</strong>​，避免量化误差累积。</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MDczNDdiZWYwMWJmMTAzZjlhMmQwNjcyYTUwYWIxZjdfQlN5OGU5OFpjbUV0c1FId21ERWNTTkVZYUZBMndIVzBfVG9rZW46Tk1KSGI5RFZQb25qUkJ4V0d5Z2NSaEt1bm1kXzE3Njc2MTM5OTk6MTc2NzYxNzU5OV9WNA" alt="" loading="lazy"/></p>
<p>重复上述步骤，依次处理完一层的全部权重。然后继续到下一层，直到整个模型量化完成。</p>
<h4 data-id="heading-17">3.2.2 GPTQ 量化使用示例</h4>
<p><code>transformers</code> 已经正式支持了 AutoGPTQ，这意味着您能够直接在 <code>transformers</code> 中使用量化后的模型。</p>
<h5 data-id="heading-18">安装依赖</h5>
<p>推荐通过安装源代码的方式获取并安装 AutoGPTQ 工具包：</p>
<pre><code class="hljs language-Plain" lang="Plain">git clone https://github.com/AutoGPTQ/AutoGPTQ
cd AutoGPTQ
pip install -e .
</code></pre>
<h5 data-id="heading-19">量化模型</h5>
<pre><code class="hljs language-Plain" lang="Plain">import os
import logging
import torch
from auto_gptq import AutoGPTQForCausalLM, BaseQuantizeConfig
from transformers import AutoTokenizer

# =============================
# 配置路径和量化超参数
# =============================
model_path = "your_model_path"          # 原始模型路径（本地或HF Hub）
quant_path = "your_quantized_model_path" # 保存量化后模型的路径

# 量化配置
quantize_config = BaseQuantizeConfig(
    bits=4,                # 量化比特数，可选 4 或 8
    group_size=128,        # 分组大小，推荐 128
    damp_percent=0.01,     # Hessian 阻尼因子，提升数值稳定性
    desc_act=False,        # 是否对激活值量化，一般 False 以提升推理速度
    static_groups=False,   # 是否使用静态分组，通常 False
    sym=True,              # 是否对称量化，True 更稳定
    true_sequential=True,  # 是否顺序量化，提升精度但更慢
    model_name_or_path=None,         # 保持 None（除非做特殊兼容）
    model_file_base_name="model"     # 保存的模型文件前缀
)

max_len = 8192  # 输入最大长度（根据模型上下文窗口设置）

# =============================
# 加载分词器和模型
# =============================
tokenizer = AutoTokenizer.from_pretrained(model_path, use_fast=True)

# 确保 pad_token 存在（某些 LLM 没有定义 pad_token）
if tokenizer.pad_token is None:
    tokenizer.pad_token = tokenizer.eos_token

model = AutoGPTQForCausalLM.from_pretrained(model_path, quantize_config)

# =============================
# 准备校准数据（calibration data）
# dataset 需要你自己定义，比如一小部分语料
# dataset = ["hello world", "some calibration sentence", ...]
# =============================
data = []
for msg in dataset:
    # 转换成文本（可根据是否使用 chat 模板决定）
    text = tokenizer.apply_chat_template(
        msg,
        tokenize=False,
        add_generation_prompt=False
    )
    # 编码输入
    model_inputs = tokenizer(
        text,
        truncation=True,
        max_length=max_len,
        padding="max_length",   # 保证对齐
        return_tensors="pt"
    )
    # 收集数据（dict 格式）
    data.append(dict(
        input_ids=model_inputs["input_ids"].squeeze(0),
        attention_mask=model_inputs["attention_mask"].squeeze(0)
    ))

# =============================
# 配置日志输出
# =============================
logging.basicConfig(
    format="%(asctime)s %(levelname)s [%(name)s] %(message)s",
    level=logging.INFO,
    datefmt="%Y-%m-%d %H:%M:%S"
)

# =============================
# 执行量化
# =============================
model.quantize(data, cache_examples_on_gpu=False)

# =============================
# 保存量化后的模型和分词器
# =============================
os.makedirs(quant_path, exist_ok=True)
model.save_quantized(quant_path, use_safetensors=True)
tokenizer.save_pretrained(quant_path)

print(f"量化模型已保存到: {quant_path}")
</code></pre>
<h2 data-id="heading-20">四、参考资料</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fqwen.readthedocs.io%2Fzh-cn%2Flatest%2Fquantization%2Fawq.html" target="_blank" title="https://qwen.readthedocs.io/zh-cn/latest/quantization/awq.html" ref="nofollow noopener noreferrer">Qwen 官方文档</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F681578090" target="_blank" title="https://zhuanlan.zhihu.com/p/681578090" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/681578090</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F680212402" target="_blank" title="https://zhuanlan.zhihu.com/p/680212402" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/680212402</a></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fcnblogs.com%2Fxwher%2Fp%2F18788021" target="_blank" title="http://cnblogs.com/xwher/p/18788021" ref="nofollow noopener noreferrer">cnblogs.com/xwher/p/187…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2306.00978" target="_blank" title="https://arxiv.org/abs/2306.00978" ref="nofollow noopener noreferrer">AWQ: Activation-aware Weight Quantization for LLM Compression and Acceleration</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2210.17323" target="_blank" title="https://arxiv.org/abs/2210.17323" ref="nofollow noopener noreferrer">GPTQ: Accurate Post-Training Quantization for Generative Pre-trained Transformers</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Claude Code搓了个AI咨询产品，请大家帮我看看有没有搞头]]></title>    <link>https://juejin.cn/post/7591513171199148095</link>    <guid>https://juejin.cn/post/7591513171199148095</guid>    <pubDate>2026-01-05T09:10:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591513171199148095" data-draft-id="7591510742647586859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Claude Code搓了个AI咨询产品，请大家帮我看看有没有搞头"/> <meta itemprop="keywords" content="Claude,VibeCoding"/> <meta itemprop="datePublished" content="2026-01-05T09:10:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Datacook"/> <meta itemprop="url" content="https://juejin.cn/user/4079668692259258"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Claude Code搓了个AI咨询产品，请大家帮我看看有没有搞头
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4079668692259258/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Datacook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:10:41.000Z" title="Mon Jan 05 2026 09:10:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>因为工作的关系，经常有朋友找我咨询大大小小的软件问题。问得多了，难免精力有限，于是就萌生了这么一个"AI软件咨询"的念头趁着年尾工作不忙，用Claude Code把这东西搓了出来，记录下来分享一下踩过的坑，也请各位老哥帮忙看看产品如何。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadvisor.datacook.cloud%2F" target="_blank" title="https://advisor.datacook.cloud/" ref="nofollow noopener noreferrer">advisor.datacook.cloud/</a></p>
<hr/>
<p><strong>第一个坑：眼高手低，上来就想搞多Agent协同</strong></p>
<p>我一开始的想法很宏大，因为咱也是看了不少文章，记了不少术语的，所以我上来就让Claude给我整个多Agent架构的设计，结果Claude先劝住了我（也许是Linus风格的CLAUDE.local.md起了作用）：真正的多Agent架构没必要，你一个人也玩不转，用Persona-based Pipeline就行了。</p>
<p><strong>Persona-based Pipeline是什么？</strong></p>
<p>先说多Agent架构：5个独立的Agent各管一摊，通过消息队列或API互相通信。听起来很酷，但问题是调试地狱——一个bug可能跨3个Agent，你得翻5份log才能定位。</p>
<p>Persona-based Pipeline的思路不一样：<strong>只有一个Agent，但它有多重人格</strong>。根据对话进行到哪个阶段，切换不同的System Prompt，让同一个Agent表现出不同的专业能力。</p>
<p>对比一下：</p>



































<table><thead><tr><th/><th>多Agent架构</th><th>Persona-based Pipeline</th></tr></thead><tbody><tr><td>调试复杂度</td><td>高（多份log，跨Agent追踪）</td><td>低（一份log搞定）</td></tr><tr><td>状态同步</td><td>需要消息队列/共享存储</td><td>天然共享（同一个Agent）</td></tr><tr><td>维护成本</td><td>需要3-4人团队</td><td>1人可维护</td></tr><tr><td>灵活性</td><td>Agent可独立扩展</td><td>扩展需改同一个Agent</td></tr><tr><td>适用场景</td><td>大团队、复杂系统</td><td>小团队、快速迭代</td></tr></tbody></table>
<p>Claude给出的Persona-based Pipeline设计：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc463a7a86334458b8ea8ca564f22e3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWNvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209220&amp;x-signature=UnHrD8fdkaDHZWAdnGxyt59r4TA%3D" alt="01_persona_pipeline.png" loading="lazy"/></p>
<p>核心思想是<strong>单一推理循环</strong>：不管在哪个阶段，每轮对话只调用一次AI。AI根据当前状态自己决定：是继续问问题，还是生成方案。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UnifiedConsultantAgent</span>:
    <span class="hljs-string">"""统一的咨询 Agent - 单一推理循环"""</span>
​
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_turn</span>(<span class="hljs-params">self, state, user_input</span>):
        <span class="hljs-comment"># 1. 根据阶段选择Persona（切换System Prompt）</span>
        persona = PERSONAS[state.phase]
​
        <span class="hljs-comment"># 2. 单次AI调用，完成所有工作</span>
        result = <span class="hljs-keyword">await</span> self.client.messages.create(
            model=self.model,
            messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}]
        )
​
        <span class="hljs-comment"># 3. AI自己决定：继续问 or 生成方案</span>
        <span class="hljs-keyword">if</span> result.decision == <span class="hljs-string">"ask"</span>:
            <span class="hljs-keyword">return</span> result.question
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> result.solution
</code></pre>
<p>5个Persona各司其职：</p>



































<table><thead><tr><th>阶段</th><th>Persona</th><th>干什么</th></tr></thead><tbody><tr><td>Discovery</td><td>需求侦探</td><td>像麦肯锡顾问一样提问，挖掘用户自己都没想清楚的需求</td></tr><tr><td>Structure</td><td>产品经理</td><td>把收集到的信息整理成结构化需求文档</td></tr><tr><td>Exploration</td><td>架构师</td><td>引导用户参与技术选型决策（React还是Vue？单体还是微服务？）</td></tr><tr><td>Generation</td><td>咨询顾问</td><td>生成完整技术方案，包括架构图、预算、路线图</td></tr><tr><td>Iteration</td><td>项目教练</td><td>根据用户反馈持续优化方案</td></tr></tbody></table>
<p>这套架构的好处：调试只看一个地方的log，代码量从5个Agent互相调用变成一个Agent + 5套Prompt，维护成本大幅下降。</p>
<hr/>
<p><strong>第二个坑：Chat式自由对话，AI问个没完没了</strong></p>
<p>架构定好之后开始开发。一开始Claude是照着ChatGPT的交互做了个聊天界面——用户打字，AI回复，自由对话。但问题很快暴露：AI会没完没了地问问题。用户说"我想做个电商app"，AI问"目标用户是谁"，用户答了，AI又问"预算多少"，答了又问"时间呢"……说实话我自己回答了3个问题就已经不耐烦了，而AI觉得信息还不够。</p>
<p>另一个更严重的问题是，这个系统的预期用户自己可能都还没想明白想要什么，发散式的提问不仅不能帮他们理清思路，反而让人更糊涂。</p>
<p>把这些问题跟Claude描述了之后，它建议我换个思路：<strong>把自由对话改成引导式问答</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2214b2dc9a39489b922f24fead6dfd84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWNvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209220&amp;x-signature=%2FAMVzMaPK3j6OXLS3S%2FZEwTKwuM%3D" alt="02_guided_qa.png" loading="lazy"/></p>
<p>核心改动有三个：</p>
<p><strong>1. 选项卡代替自由输入</strong></p>
<p>AI生成问题时，同时给出3-4个选项，用户点选就行。同时提供了“补充说明”，减少打字负担，也避免了理解歧义。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionOption</span> </span>{
  value: <span class="hljs-keyword">string</span>           <span class="hljs-comment">// 选项值</span>
  label: <span class="hljs-keyword">string</span>           <span class="hljs-comment">// 显示文字</span>
  recommended: <span class="hljs-keyword">boolean</span>    <span class="hljs-comment">// 是否推荐</span>
  explanation?: <span class="hljs-keyword">string</span>    <span class="hljs-comment">// 选这个意味着什么</span>
  cost_impact?: <span class="hljs-keyword">string</span>    <span class="hljs-comment">// 对成本的影响（如"+20%"）</span>
  time_impact?: <span class="hljs-keyword">string</span>    <span class="hljs-comment">// 对工期的影响（如"+2周"）</span>
}
</code></pre>
<p>前端用卡片展示，标记出推荐选项，以及附加说明每个选项对成本、工期等的影响：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;OptionCard
  <span class="hljs-attr">option</span>={{ label: <span class="hljs-string">"React + Vite"</span>, recommended: <span class="hljs-literal">true</span>, cost_impact: <span class="hljs-string">"基准"</span>, time_impact: <span class="hljs-string">"最快"</span> }}
  <span class="hljs-attr">isSelected</span>={selected}
  <span class="hljs-attr">onToggle</span>={handleToggle}
/&gt;
</code></pre>
<p><strong>2. 置信度自动判断何时停止</strong></p>
<p>不再硬编码"问5轮就停"，而是让AI自己评估信息收集的完整度：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">MAX_ROUNDS</span> = <span class="hljs-number">7</span>                <span class="hljs-comment"># 硬上限，防止死循环</span>
<span class="hljs-attr">CONFIDENCE_THRESHOLD</span> = <span class="hljs-number">0.7</span>   <span class="hljs-comment"># 置信度阈值</span>
​
class ConversationState:
    confidence: <span class="hljs-attr">float</span> = <span class="hljs-number">0.0</span>   <span class="hljs-comment"># AI对"信息够了"的信心，0-1</span>
    round_count: <span class="hljs-attr">int</span> = <span class="hljs-number">0</span>      <span class="hljs-comment"># 当前轮次</span>
​
<span class="hljs-comment"># AI每轮对话后更新置信度</span>
<span class="hljs-comment"># 当 confidence &gt;= 0.7 或 round_count &gt;= 7 时，自动生成方案</span>
</code></pre>
<p><strong>3. 置信度进度条</strong></p>
<p>用户能实时看到AI"觉得信息够不够"，心理上有预期：</p>
<pre><code class="hljs language-css" lang="css">{<span class="hljs-comment">/* 实际代码 - Consultation.tsx */</span>}
&lt;<span class="hljs-selector-tag">div</span> className="<span class="hljs-attribute">flex</span> items-center justify-between mb-<span class="hljs-number">2</span>"&gt;
  &lt;<span class="hljs-selector-tag">span</span>&gt;对话轮次: {roundCount}&lt;/<span class="hljs-selector-tag">span</span>&gt;
  &lt;<span class="hljs-selector-tag">span</span>&gt;置信度: {Math<span class="hljs-selector-class">.round</span>(confidence * <span class="hljs-number">100</span>)}%&lt;/<span class="hljs-selector-tag">span</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;<span class="hljs-selector-tag">div</span> className="h-<span class="hljs-number">2</span> bg-gray-<span class="hljs-number">200</span> rounded-full"&gt;
  &lt;<span class="hljs-selector-tag">div</span>
    className="h-full bg-primary-<span class="hljs-number">600</span>"
    style={{ <span class="hljs-attribute">width</span>: `${confidence * <span class="hljs-number">100</span>}%` }}  // 进度条宽度 = 置信度
  /&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
// 显示效果：对话轮次: <span class="hljs-number">3</span>    置信度: <span class="hljs-number">65%</span>
//          [==============&gt;          ]
</code></pre>
<p>这么改完之后，产品前端的基本雏形就形成了。</p>
<hr/>
<p><strong>第三个坑：产出的方案泛泛而谈，没有针对性</strong></p>
<p>随着前端框架的稳定，很快就发现新的问题：产出的方案空话连篇，根本不具备商业价值。</p>
<p>Claude建议用<strong>两阶段生成</strong>：先出骨架，再逐章节深化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77bc3998f88a4cc7bc6c721b3990b1dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWNvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209220&amp;x-signature=71ezx97Y8LZJQsfVqzaOyS8sqWk%3D" alt="03_two_phase.png" loading="lazy"/></p>
<p><strong>Phase 1：骨架生成</strong></p>
<p>30秒内出一个结构化的方案框架。包含标题、功能清单、技术栈概要、预算范围、时间线。</p>
<p><strong>Phase 2：章节深化</strong></p>
<p>骨架出来后，对每个章节单独调用AI扩展。比如"系统架构"章节，会专门生成：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># section_expander.py - 章节扩展器</span>
SECTION_EXPANSION_PROMPTS = {
    SectionType.ARCHITECTURE: <span class="hljs-string">'''
    你是一位资深技术架构师。请深化"系统架构"章节。
​
    必须包含：
    1. type - 架构类型
    2. description - 详细架构说明（300-500字）
    3. diagram_mermaid - 完整的系统架构图
    4. deployment_diagram - 部署架构图（新增）
    5. data_flow_diagram - 数据流图（新增）
    6. design_principles - 设计原则列表
    7. scalability_notes - 扩展性说明
    '''</span>,
    <span class="hljs-comment"># ... 其他章节</span>
}
</code></pre>
<p>每个章节独立扩展，互不影响。最终方案从200行变成800-1200行，配以Mermaid图表（架构图、ER图、甘特图、序列图等），质量完全不一样。</p>
<hr/>
<p><strong>第四个坑：方案生成超时，云服务直接断连接</strong></p>
<p>两阶段生成效果不错，但又碰到新问题：云服务默认30-60秒就会断开"idle"连接。而章节扩展要2-3分钟，经常生成到一半连接就断了。</p>
<p>Claude建议用<strong>SSE流式响应 + 心跳机制</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/920aa4e3e77a466c8c014bf186d57c35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWNvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209220&amp;x-signature=IQQg9xkihUR1AJggofPvPiDjOZM%3D" alt="04_sse_heartbeat.png" loading="lazy"/></p>
<p>核心代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># solutions.py - 一键深度生成的SSE流</span>
DEEP_GENERATION_CONFIG = {
    <span class="hljs-string">"section_timeout_seconds"</span>: <span class="hljs-number">90</span>,      <span class="hljs-comment"># 单章节超时</span>
    <span class="hljs-string">"total_timeout_seconds"</span>: <span class="hljs-number">300</span>,       <span class="hljs-comment"># 整体超时（5分钟）</span>
    <span class="hljs-string">"max_retry_per_section"</span>: <span class="hljs-number">1</span>,         <span class="hljs-comment"># 每章节最大重试次数</span>
    <span class="hljs-string">"heartbeat_interval_seconds"</span>: <span class="hljs-number">15</span>,   <span class="hljs-comment"># 心跳间隔</span>
}
​
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">heartbeat_sender</span>():
    <span class="hljs-string">"""后台心跳发送器 - 防止云服务断连"""</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> stop_event.is_set():
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">15</span>)
        <span class="hljs-keyword">yield</span> <span class="hljs-string">": heartbeat\n\n"</span>  <span class="hljs-comment"># SSE注释格式的心跳</span>
​
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_stream_deep_solution_generation</span>(<span class="hljs-params">...</span>):
    <span class="hljs-comment"># Phase 1: 骨架</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">await</span> sse_event(<span class="hljs-string">"skeleton_ready"</span>, {<span class="hljs-string">"solution"</span>: skeleton})
​
    <span class="hljs-comment"># Phase 2: 逐章节扩展</span>
    <span class="hljs-keyword">for</span> section_type <span class="hljs-keyword">in</span> recommended_sections:
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">await</span> sse_event(<span class="hljs-string">"section_start"</span>, {<span class="hljs-string">"section_type"</span>: section_type})
​
        expanded = <span class="hljs-keyword">await</span> expander.expand_section(section_type, solution)
​
        <span class="hljs-comment"># 每个章节完成立即存库（断点续传支持）</span>
        <span class="hljs-keyword">await</span> repo.expand_section(session_id, section_type, expanded)
​
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">await</span> sse_event(<span class="hljs-string">"section_expanded"</span>, {
            <span class="hljs-string">"section_type"</span>: section_type,
            <span class="hljs-string">"enhanced_content"</span>: expanded.enhanced_content,
            <span class="hljs-string">"word_count"</span>: expanded.word_count,
            <span class="hljs-string">"diagram_count"</span>: expanded.diagram_count,
        })
</code></pre>
<p><strong>三个关键设计</strong>：</p>
<ol start="0">
<li><strong>心跳保活</strong>：每15秒发一个SSE注释包，让云服务知道连接还活着</li>
<li><strong>即时存库</strong>：每个章节完成立即保存，断了也不怕——下次可以从断点继续</li>
<li><strong>失败跳过</strong>：某章节超时/失败不影响其他章节，失败的可以单独重试</li>
</ol>
<hr/>
<p><strong>最后闲聊几句</strong></p>
<p>前面提到过的Linus风格的CLAUDE.local.md，我个人是十分喜欢，除了解决问题的思路很简洁明快之外，说话也很好听，动不动就是“你的垃圾代码”如何如何，整个Vibe Coding的过程完全不困。</p>
<p>我自己在执行较长任务时喜欢加一个后缀：</p>
<ul>
<li>我暂时不干预，所有产品和技术决策由你做出，我一会儿回来验收成果；</li>
<li>不用着急出结果，所有细节你慢慢做，做对最重要；</li>
<li>遇到不确定的，先查一下context 7里的文档；还不确定的，网上搜索一下；</li>
<li>从全栈的视角去规划子任务，所有子任务分阶段执行，必要时用子Agent进行，每个阶段结束时跑一下单元测试，以免最后发现不行要推到重来；</li>
<li>UI部分不用纠结，按现代主流风格去写就行，</li>
</ul>
<p>因为我还装了很多backend/frontend-developer, python-experts之类的agent, 这个命令会自动把这些工具组织起来协同工作，虽然最终产出的代码还是免不了会有错误，但我还是坚持着一行代码不手写地把这个产品做了出来。</p>
<p>再次请各位老哥共同来试用评价一下：<a href="https://link.juejin.cn?target=https%3A%2F%2Fadvisor.datacook.cloud%2F" target="_blank" title="https://advisor.datacook.cloud/" ref="nofollow noopener noreferrer">advisor.datacook.cloud/</a></p>
<p>最后也祝大家能把心中所想快速地实现出来。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>