<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[MCP 完全指南（上）：撕掉标签，看清本质]]></title>    <link>https://juejin.cn/post/7581888578507522075</link>    <guid>https://juejin.cn/post/7581888578507522075</guid>    <pubDate>2025-12-10T01:48:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507522075" data-draft-id="7580623265791901734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP 完全指南（上）：撕掉标签，看清本质"/> <meta itemprop="keywords" content="后端,前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-10T01:48:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一旅人"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP 完全指南（上）：撕掉标签，看清本质
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一旅人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:48:03.000Z" title="Wed Dec 10 2025 01:48:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>2024 年末，MCP（Model Context Protocol）火了。各种技术文章蜂拥而至："MCP 革命性突破！"、"AI 工具调用的未来！"、"不懂 MCP 就out了！"</p>
<p>但当你真正去了解时，会发现很多文章要么是概念科普（讲了半天不知道怎么用），要么是愿景描绘（听起来很美好但落不了地）。</p>
<p><strong>这篇文章就是来破局的。</strong> 我们不讲故事，只讲本质：MCP 到底是什么？它解决了什么问题？和 Function Call 有什么关系？该不该用？</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、MCP 到底是什么？</h2>
<h3 data-id="heading-1">1.1 一句话说清楚</h3>
<p><strong>MCP（Model Context Protocol，模型上下文协议）</strong> 是一套标准化的协议，用来规范 AI 应用如何调用外部工具和数据源。</p>
<p>听起来还是有点抽象？我们换个说法：</p>
<p>想象你在开发一个 AI 助手，需要接入：</p>
<ul>
<li>📍 <strong>地图服务</strong>：查地址、规划路线</li>
<li>🌤️ <strong>天气查询</strong>：实时天气、天气预报</li>
<li>📊 <strong>数据库</strong>：查用户数据、订单信息</li>
<li>📧 <strong>邮件服务</strong>：发送通知</li>
</ul>
<p><strong>没有 MCP 之前</strong>：每个服务都有自己的接口格式</p>
<ul>
<li>A 服务用 JSON-RPC</li>
<li>B 服务用 REST API</li>
<li>C 服务用 gRPC</li>
<li>D 服务要自定义协议</li>
</ul>
<p>你得分别研究每个 API 文档，写不同的适配代码，维护多套调用逻辑。团队协作时还要反复对齐接口格式。</p>
<p><strong>有了 MCP 之后</strong>：大家约定统一的"接口标准"</p>
<ul>
<li>工具提供方按 MCP 协议暴露能力（MCP Server）</li>
<li>AI 应用按 MCP 协议调用工具（MCP Client）</li>
<li>格式、认证、错误处理都有统一规范</li>
</ul>
<p><strong>类比理解</strong>：MCP 之于 AI 工具调用，就像 USB 之于数据传输。</p>
<ul>
<li>没有 USB 前：每个设备都有自己的接口（各种圆口、方口、扁口），乱七八糟</li>
<li>有了 USB 后：一个标准走天下，插上就能用</li>
</ul>
<hr/>
<h3 data-id="heading-2">1.2 MCP 解决的核心问题</h3>
<p>我们用一个实际场景说明：</p>
<p><strong>场景</strong>：你在做一个智能客服系统，需要：</p>
<ol>
<li>查询用户订单状态（调用内部订单系统 API）</li>
<li>查询物流信息（调用顺丰/京东物流 API）</li>
<li>查询商品库存（调用库存系统 API）</li>
<li>发送客服消息（调用企业微信 API）</li>
</ol>
<h4 data-id="heading-3">问题 1：接口格式不统一</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 订单系统的接口</span>
{
  <span class="hljs-string">"action"</span>: <span class="hljs-string">"query_order"</span>,
  <span class="hljs-string">"params"</span>: {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"12345"</span>}
}

<span class="hljs-comment">// 物流系统的接口</span>
{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"trackShipment"</span>,
  <span class="hljs-string">"arguments"</span>: {<span class="hljs-string">"tracking_no"</span>: <span class="hljs-string">"SF123456"</span>}
}

<span class="hljs-comment">// 库存系统的接口</span>
<span class="hljs-variable constant_">POST</span> /api/inventory/check
<span class="hljs-title class_">Body</span>: {<span class="hljs-string">"sku"</span>: <span class="hljs-string">"PROD-001"</span>, <span class="hljs-string">"warehouse"</span>: <span class="hljs-string">"BJ"</span>}
</code></pre>
<p>每个接口都不一样，你得写大量的适配代码。</p>
<h4 data-id="heading-4">问题 2：AI 不知道该调用哪个工具</h4>
<p>AI 收到用户问题"我的订单什么时候到？"，需要判断：</p>
<ul>
<li>这个问题需要调用什么工具？</li>
<li>需要哪些参数？</li>
<li>参数从用户的话里怎么提取？</li>
</ul>
<p>没有统一规范，每个开发者都自己定义，导致：</p>
<ul>
<li>工具描述格式不一致</li>
<li>参数定义方式不一致</li>
<li>AI 难以准确判断</li>
</ul>
<h4 data-id="heading-5">问题 3：团队协作困难</h4>
<ul>
<li>前端开发者：后端接口怎么调？参数格式是什么？</li>
<li>后端开发者：AI 会传什么参数过来？怎么处理？</li>
<li>AI 工程师：工具列表怎么维护？提示词怎么写？</li>
</ul>
<p>缺乏标准，沟通成本巨大。</p>
<hr/>
<p><strong>MCP 的解决方案</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 统一的 MCP 工具定义格式</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"query_order"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"查询订单状态"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"inputSchema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"订单ID"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>所有工具都按这个格式定义，AI 能统一处理，开发者能快速集成。</p>
<blockquote>
<p>💡 <strong>Tip</strong>：MCP 不是银弹，它只是把"调用外部工具"这件事标准化了。原有的问题（AI 判断不准、参数提取错误）并没有消失。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">1.3 破除三个常见误解</h3>
<h4 data-id="heading-7">误解 1："MCP 是一种新的 AI 技术"</h4>
<p>很多文章会说"MCP 提升了 AI 的工具调用能力"，这是不准确的。</p>
<p><strong>真相</strong>：MCP 底层用的还是传统的 <strong>Function Call</strong>（工具调用）。</p>
<p>看一段 MCP 客户端的核心代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// MCP 客户端决定使用哪个工具</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">messages</span>: messages,
  <span class="hljs-attr">tools</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>  <span class="hljs-comment">// ← 这就是传统的 Function Call 参数！</span>
});
</code></pre>
<p>MCP 只是在 Function Call 外面包了一层标准化协议，<strong>没有改变 AI 的判断能力</strong>。</p>
<p>Function Call 原有的问题依然存在：</p>
<ul>
<li>❌ 工具选择不准确（工具太多时容易选错）</li>
<li>❌ 参数提取错误（复杂参数容易提取不准）</li>
<li>❌ 多意图识别困难（一个问题涉及多个工具）</li>
</ul>
<p><strong>结论</strong>：MCP 是协议标准化，不是技术突破。</p>
<hr/>
<h4 data-id="heading-8">误解 2："用了 MCP 就不用自己写工具调用代码了"</h4>
<p>很多人以为 MCP 是什么"开箱即用"的解决方案，装上就能用。</p>
<p><strong>真相</strong>：MCP 的工作流程和你自己实现 Function Call 几乎一模一样。</p>
<p>对比一下：</p>






























<table><thead><tr><th>实现步骤</th><th>自己写 Function Call</th><th>使用 MCP</th></tr></thead><tbody><tr><td><strong>1️⃣ 定义工具</strong></td><td>写工具描述 + 参数定义</td><td>MCP Server 定义工具（还是要写）</td></tr><tr><td><strong>2️⃣ AI 决策</strong></td><td>调用 AI 的 Function Call</td><td>MCP Client 调用 AI（还是 Function Call）</td></tr><tr><td><strong>3️⃣ 执行工具</strong></td><td>后端接收参数，调用真实 API</td><td>MCP Server 执行并返回（还是要实现）</td></tr><tr><td><strong>4️⃣ 生成回复</strong></td><td>把结果给 AI 生成回复</td><td>MCP Client 把结果给 AI（逻辑一样）</td></tr></tbody></table>
<p><strong>本质上是一样的</strong>。</p>
<p>那 MCP 的价值在哪？答案是：<strong>生态标准化</strong>。</p>
<p>当大家都按同一套规则来：</p>
<ul>
<li>✅ 工具能跨项目复用</li>
<li>✅ 团队协作有统一规范</li>
<li>✅ 第三方工具能方便集成</li>
<li>✅ 降低学习和沟通成本</li>
</ul>
<p>但如果你只是一个人开发，或者工具都是自己的内部 API，MCP 的价值就没那么大。</p>
<blockquote>
<p>💡 <strong>Tip</strong>：把 MCP 理解成"工具调用的接口标准"，就像 RESTful API 是 Web 服务的接口标准一样。</p>
</blockquote>
<hr/>
<h4 data-id="heading-9">误解 3："MCP 服务都是免费的"</h4>
<p>看到各种 MCP Server（高德地图、百度地图、天气服务），有人以为调用是免费的。</p>
<p><strong>真相</strong>：API 调用成本最终还是要有人承担。</p>
<p>以高德地图 MCP 为例：</p>
<ol>
<li>你通过 Cursor 调用高德地图 MCP</li>
<li>高德的 MCP Server 收到请求后，会调用高德自己的地图 API</li>
<li>这些 API 调用是<strong>计费的</strong>（按调用次数或配额）</li>
</ol>
<p>有些大厂的 MCP 服务是免费的，但那是因为：</p>
<ul>
<li>前期投入，吸引开发者</li>
<li>调用量有限制（超过就收费）</li>
<li>培养生态、获取数据、占领市场</li>
</ul>
<p><strong>天下没有免费的午餐</strong>，只是谁付费、怎么付费的问题。</p>
<p>如果你用 MCP 接入收费服务，要注意：</p>
<ul>
<li>⚠️ 了解计费规则（按次数？按流量？按时长？）</li>
<li>⚠️ 设置调用限额（防止意外超支）</li>
<li>⚠️ 监控使用量（定期检查账单）</li>
<li>⚠️ 考虑缓存策略（减少重复调用）</li>
</ul>
<hr/>
<h3 data-id="heading-10">1.4 MCP 的真正价值：生态话语权</h3>
<p>既然 MCP 没有技术创新，为什么 Anthropic（Claude 的母公司）要大力推？</p>
<p>答案是：<strong>争夺 AI 工具生态的话语权</strong>。</p>
<h4 data-id="heading-11">类比：USB 标准的故事</h4>
<p>还记得 USB 标准是怎么来的吗？</p>
<p>1990 年代：</p>
<ul>
<li>键盘用 PS/2 接口</li>
<li>鼠标用串口</li>
<li>打印机用并口</li>
<li>扫描仪用 SCSI 接口</li>
<li>每个设备都不一样，乱七八糟</li>
</ul>
<p>1996 年：</p>
<ul>
<li>Intel、微软、IBM 等巨头联合推出 USB 标准</li>
<li>一个接口统一所有设备</li>
<li>谁制定标准，谁就掌握话语权</li>
</ul>
<p>今天：</p>
<ul>
<li>USB 成为事实标准</li>
<li>USB-IF（USB 标准化组织）掌握生态控制权</li>
<li>新技术（Type-C、USB4）都要通过他们认证</li>
</ul>
<h4 data-id="heading-12">MCP 想做的就是 AI 领域的 USB</h4>
<p>Anthropic 推 MCP 的真实意图：</p>
<ol>
<li><strong>制定规则</strong>：让大家按自己定的协议开发</li>
<li><strong>占领生态</strong>：所有工具提供商、AI 应用都接入 MCP</li>
<li><strong>话语权</strong>：在未来的标准委员会中占据关键位置</li>
</ol>
<p>如果 MCP 真的成为行业共识：</p>
<ul>
<li>所有模型的工具调用格式可能被统一</li>
<li>Anthropic 在标准委员会的位置举足轻重</li>
<li>能影响整个 AI 工具生态的走向</li>
</ul>
<p><strong>对开发者来说</strong>，MCP 的价值在于：</p>
<ol>
<li>✅ <strong>快速接入现成服务</strong>：不用研究 API 文档，装个 MCP Server 就行</li>
<li>✅ <strong>团队协作规范</strong>：统一配置格式，方便版本控制</li>
<li>✅ <strong>参与生态建设</strong>：早期参与者能占先机</li>
<li>✅ <strong>降低集成成本</strong>：一次开发，到处运行</li>
</ol>
<p>但也要认清：</p>
<ul>
<li>⚠️ MCP 还在早期，规范可能变化</li>
<li>⚠️ 生态不够成熟，可用工具有限</li>
<li>⚠️ 不是所有场景都适合用 MCP</li>
<li>⚠️ 核心业务逻辑建议自己掌控</li>
</ul>
<hr/>
<h2 data-id="heading-13">二、MCP 的工作原理</h2>
<p>理解了 MCP 是什么，我们来看它具体是怎么工作的。</p>
<h3 data-id="heading-14">2.1 核心工作流程</h3>
<p>MCP 的工作流程分为三步，我们用一个实际例子说明：</p>
<p><strong>场景</strong>：用户在 Cursor 中问 AI："北京天安门的经纬度是多少？"</p>
<pre><code class="hljs language-markdown" lang="markdown">第 1 步：用户提问
┌─────────────────────┐
│   用户               │
│  "北京天安门的经纬   │
│   度是多少？"        │
└──────────┬──────────┘
<span class="hljs-code">           │
           ▼
</span>
第 2 步：MCP 客户端询问 AI
┌─────────────────────┐
│  MCP 客户端          │
│  (Cursor)           │
│                      │
│  把问题和可用工具    │
│  列表发给 AI：       │
│  - 地理编码工具      │
│  - 路径规划工具      │
│  - 天气查询工具      │
└──────────┬──────────┘
<span class="hljs-code">           │
           ▼
</span>
第 3 步：AI 决策
┌─────────────────────┐
│  AI 模型             │
│  (GPT-4/Claude)     │
│                      │
│  分析后决定：        │
│  ✓ 使用「地理编码」  │
│    工具              │
│  ✓ 参数：            │
│    address=         │
│    "北京天安门"      │
└──────────┬──────────┘
<span class="hljs-code">           │
           ▼
</span>
第 4 步：MCP 服务端执行
┌─────────────────────┐
│  MCP 服务端          │
│  (高德地图 API)     │
│                      │
│  收到请求后：        │
│  1. 调用高德地图API  │
│  2. 获取坐标数据     │
│  3. 返回结果：       │
│     116.397428,     │
│     39.90923        │
└──────────┬──────────┘
<span class="hljs-code">           │
           ▼
</span>
第 5 步：AI 生成友好回复
┌─────────────────────┐
│  用户看到的回复：    │
│                      │
│  "北京天安门的经纬   │
│   度是：             │
│   经度：116.397428  │
│   纬度：39.90923"   │
└─────────────────────┘
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>MCP 客户端负责和 AI 模型通信（这部分用的是 Function Call）</li>
<li>MCP 服务端负责真正执行工具逻辑（调用真实的 API）</li>
<li>中间的数据传输按照 MCP 协议标准进行</li>
</ul>
<blockquote>
<p>💡 <strong>Tip</strong>：MCP 没有改变 AI 的决策过程，只是规范了"工具列表 → AI 决策 → 工具执行"这个流程的数据格式。</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">2.2 MCP 的三个核心概念</h3>
<p>MCP 定义了三种能力类型，理解它们只需记住：<strong>给什么、做什么、怎么做</strong>。</p>
<h4 data-id="heading-16">📦 Resources（资源）—— 给 AI "看"的东西</h4>
<p><strong>简单说</strong>：只读的数据源，AI 可以读取但不能修改。</p>
<p><strong>常见例子</strong>：</p>
<ul>
<li>文件内容（代码、文档、配置）</li>
<li>数据库记录（用户数据、订单信息）</li>
<li>API 响应（第三方服务返回的数据）</li>
</ul>
<p><strong>使用场景</strong>："分析一下这个文件有什么问题" → AI 读取文件内容（Resource）→ 分析并给出建议</p>
<hr/>
<h4 data-id="heading-17">🛠️ Tools（工具）—— AI 能"做"的事情</h4>
<p><strong>简单说</strong>：可执行的函数，AI 调用后会产生实际效果。</p>
<p><strong>常见例子</strong>：</p>
<ul>
<li>查询地理坐标、规划路线</li>
<li>发送邮件、创建日历事件</li>
<li>读写数据库、执行系统命令</li>
</ul>
<p><strong>使用场景</strong>："帮我查北京的天气" → AI 调用天气查询工具（Tool）→ 返回实时天气数据</p>
<hr/>
<h4 data-id="heading-18">💬 Prompts（提示词模板）—— 标准化的工作流</h4>
<p><strong>简单说</strong>：预定义的对话模板，用户一键触发常见任务。</p>
<p><strong>常见例子</strong>：</p>
<ul>
<li>"代码审查"：自动分析性能、安全、可读性</li>
<li>"生成文档"：根据代码自动生成 README</li>
<li>"Bug 诊断"：系统化排查问题</li>
</ul>
<p><strong>使用场景</strong>：用户选择"代码审查"模板 → 自动填充代码 → AI 按模板执行审查流程</p>
<hr/>
<p><strong>一句话区分</strong>：</p>

























<table><thead><tr><th>概念</th><th>一句话说明</th><th>最常见用途</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td>AI 读取的数据</td><td>读取文件、查询数据库</td></tr><tr><td><strong>Tools</strong></td><td>AI 执行的操作</td><td><strong>调用外部 API</strong>（最常用）</td></tr><tr><td><strong>Prompts</strong></td><td>用户触发的模板</td><td>标准化工作流</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>Tip</strong>：实际使用中 <strong>Tools 占 90%</strong>，Resources 适合需要大量上下文的场景，Prompts 用于固定流程。</p>
</blockquote>
<hr/>
<h3 data-id="heading-19">2.3 MCP 的传输方式</h3>
<p>MCP 支持两种主流传输方式（还有第三种 Streamable HTTP，但较少用），理解它们只需记住：<strong>本地还是远程</strong>。</p>
<h4 data-id="heading-20">方式 1：STDIO —— 本地进程通信</h4>
<p><strong>简单说</strong>：Cursor 启动一个本地程序（如 Node.js 脚本），通过标准输入输出通信。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>本地文件系统操作（读写文件、搜索代码）</li>
<li>本地数据库查询（SQLite、本地 MySQL）</li>
<li>开发和调试自己的 MCP Server</li>
</ul>
<p><strong>优点</strong>：快、安全、不需要网络<br/>
<strong>缺点</strong>：只能本地用，需要安装依赖</p>
<p><strong>典型配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"/path/to/mcp-server.js"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-21">方式 2：SSE —— 远程 HTTP 服务</h4>
<p><strong>简单说</strong>：Cursor 通过网络访问远程服务器（如高德地图的云端 API）。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>第三方服务（地图、天气、翻译）</li>
<li>企业内部 API（统一部署的工具）</li>
<li>生产环境（多人共享同一个服务）</li>
</ul>
<p><strong>优点</strong>：免安装、可共享、易更新<br/>
<strong>缺点</strong>：需要网络，有延迟</p>
<p><strong>典型配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.example.com/sse?key=your_key"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<p><strong>如何选择？</strong></p>






























<table><thead><tr><th>你的需求</th><th>推荐方式</th><th>典型例子</th></tr></thead><tbody><tr><td>读写本地文件</td><td>STDIO</td><td>文件搜索、代码分析</td></tr><tr><td>查询本地数据库</td><td>STDIO</td><td>SQLite、本地 PostgreSQL</td></tr><tr><td>调用第三方 API</td><td>SSE</td><td>高德地图、天气服务</td></tr><tr><td>团队共享工具</td><td>SSE</td><td>企业内部 API、统一认证</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>Tip</strong>：记住一句话：<strong>本地用 STDIO，远程用 SSE</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-22">写在最后：看懂本质，少踩坑</h2>
<p>读到这里，你应该已经明白：</p>
<p><strong>MCP 不是什么黑科技</strong>，它就是把 Function Call 包了一层标准化协议。<br/>
<strong>MCP 不会让 AI 变聪明</strong>，该选错工具还是会选错，该提取错参数还是会提取错。<br/>
<strong>MCP 也不是免费午餐</strong>，API 调用成本该谁付还是谁付。</p>
<p>那为什么还要了解 MCP？</p>
<p>因为它代表了一个趋势：<strong>AI 工具生态的标准化</strong>。就像当年的 USB 标准，虽然技术上没什么创新，但统一了接口，让整个生态繁荣起来。</p>
<hr/>
<h3 data-id="heading-23">给你三个建议</h3>
<p><strong>1. 不要盲目追新</strong></p>
<p>看到 MCP 火了就觉得必须用，这是最大的误区。如果你的项目：</p>
<ul>
<li>工具就几个，都是自己的 API</li>
<li>一个人开发，不需要团队协作</li>
<li>对工具调用有深度定制需求</li>
</ul>
<p>那自己实现 Function Call 可能更合适，掌控力更强，调试也更方便。</p>
<hr/>
<p><strong>2. 也不要一棍子打死</strong></p>
<p>如果你需要快速接入：</p>
<ul>
<li>高德地图、百度地图这类现成服务</li>
<li>团队共享的标准化工具</li>
<li>开源社区提供的 MCP Server</li>
</ul>
<p>那 MCP 能帮你省不少事，不用研究每个 API 的文档，装上就能用。</p>
<hr/>
<p><strong>3. 混合策略最务实</strong></p>
<p><strong>核心业务逻辑自己掌控，通用能力用 MCP 快速接入</strong>。</p>
<p>比如你做一个智能客服：</p>
<ul>
<li>查订单、查库存 → 自己实现（核心业务）</li>
<li>地图导航、天气查询 → 用 MCP（通用能力）</li>
<li>发邮件、发短信 → 用 MCP（标准化操作）</li>
</ul>
<p>这样既能保证核心竞争力，又能享受生态红利。</p>
<hr/>
<h3 data-id="heading-24">最后一句话</h3>
<p><strong>MCP 是个好协议，但不要神化它。</strong></p>
<p>技术永远是为业务服务的。理解它的本质，看清它的边界，在合适的场景用好它——这才是工程师该有的态度。</p>
<p>就像你不会因为 USB 出现了，就把所有设备都换成 USB 接口。有些场景该用雷电口还得用雷电口，有些场景干脆直接焊线更可靠。</p>
<p><strong>工具是死的，人是活的。别让工具框住了思维。</strong></p>
<p>下篇我们聊实战：如何在 Cursor 中配置 MCP，手把手接入高德地图，让你的 AI 助手真正"动"起来。</p>
<hr/>
<h2 data-id="heading-25">参考资料</h2>
<p>📖 <strong>官方文档</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io" target="_blank" title="https://modelcontextprotocol.io" ref="nofollow noopener noreferrer">Anthropic MCP 协议规范</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2Fdocs%2Fcontext%2Fmcp" target="_blank" title="https://cursor.com/cn/docs/context/mcp" ref="nofollow noopener noreferrer">Cursor MCP 文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Perf 工具与火焰图使用指南]]></title>    <link>https://juejin.cn/post/7581698074361135113</link>    <guid>https://juejin.cn/post/7581698074361135113</guid>    <pubDate>2025-12-09T10:23:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074361135113" data-draft-id="7581666412021317641" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Perf 工具与火焰图使用指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T10:23:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_lai"/> <meta itemprop="url" content="https://juejin.cn/user/905653310994535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Perf 工具与火焰图使用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310994535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_lai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T10:23:05.000Z" title="Tue Dec 09 2025 10:23:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Perf 工具与火焰图使用指南</h2>
<blockquote>
<p><strong>参考资料</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.brendangregg.com%2Fflamegraphs.html" target="_blank" title="https://www.brendangregg.com/flamegraphs.html" ref="nofollow noopener noreferrer">Brendan Gregg's Flame Graphs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrendangregg%2FFlameGraph%2Fblob%2Fmaster%2FREADME.md" target="_blank" title="https://github.com/brendangregg/FlameGraph/blob/master/README.md" ref="nofollow noopener noreferrer">FlameGraph GitHub</a></li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="#%E4%B8%80perf-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D" title="#%E4%B8%80perf-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D">一、Perf 工具介绍</a></li>
<li><a href="#%E4%BA%8Cperf-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F" title="#%E4%BA%8Cperf-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F">二、Perf 工作模式</a></li>
<li><a href="#%E4%B8%89perf-%E5%AE%89%E8%A3%85" title="#%E4%B8%89perf-%E5%AE%89%E8%A3%85">三、Perf 安装</a></li>
<li><a href="#%E5%9B%9Bperf-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" title="#%E5%9B%9Bperf-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">四、Perf 使用方法</a></li>
<li><a href="#%E4%BA%94%E7%94%9F%E6%88%90%E7%81%AB%E7%84%B0%E5%9B%BE" title="#%E4%BA%94%E7%94%9F%E6%88%90%E7%81%AB%E7%84%B0%E5%9B%BE">五、生成火焰图</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">一、Perf 工具介绍</h3>
<p><code>perf</code> 命令（performance 的缩写），是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3DLinux%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">Linux</a> 系统提供的性能分析工具集，包含多种子工具，能够监测多种硬件及软件性能指标，包括 CPU、内存、IO 等，这些可监测指标我们称为 <strong>Event</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[Perf 工具] --&gt; B[Hardware Event]
    A --&gt; C[Software Event]
    A --&gt; D[Tracepoint Event]
    B --&gt; B1[CPU 周期]
    B --&gt; B2[Cache 缺失]
    B --&gt; B3[分支预测]
    C --&gt; C1[上下文切换]
    C --&gt; C2[缺页异常]
    C --&gt; C3[系统调用]
    D --&gt; D1[内核跟踪点]
    D --&gt; D2[Slab 分配]
</code></pre>
<hr/>
<h3 data-id="heading-3">二、Perf 工作模式</h3>
<h4 data-id="heading-4">2.1 计数模式</h4>
<p>记录 perf 执行过程中 event 的出现次数。</p>
<h4 data-id="heading-5">2.2 采样模式</h4>
<p>在 perf 执行过程中，按照指定频率去采样 event，每次采样时，记录当前性能指标信息（CPU、进程 ID、运行栈等）。</p>
<blockquote>
<p>⚠️ <strong>注意</strong>：这种方式由于每次都记录信息，所以额外的资源消耗是比较大的，需要权衡采样频率。</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 计数模式
        A1[开始监控] --&gt; A2[统计 Event 次数] --&gt; A3[输出统计结果]
    end
    subgraph 采样模式
        B1[开始监控] --&gt; B2[按频率采样] --&gt; B3[记录详细信息] --&gt; B4[生成数据文件]
    end
</code></pre>
<hr/>
<h3 data-id="heading-6">三、Perf 安装</h3>
<h4 data-id="heading-7">3.1 通过包管理器安装（Ubuntu）</h4>
<p>对于 Ubuntu 等 Linux 系统发行版，都提供了对应的包，只要根据内核版本进行安装即可：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Ubuntu 下安装</span>
sudo apt-get install linux-tools-common
sudo apt-get install linux-tools-<span class="hljs-string">"<span class="hljs-subst">$(uname -r)</span>"</span>
sudo apt-get install linux-cloud-tools-<span class="hljs-string">"<span class="hljs-subst">$(uname -r)</span>"</span>
sudo apt-get install linux-tools-generic
sudo apt-get install linux-cloud-tools-generic
</code></pre>
<blockquote>
<p>💡 <strong>提示</strong>：Linux 系统可能无法找到和 kernel 版本相同的工具安装包，可以使用其他版本替换。</p>
</blockquote>
<p>如果版本不匹配，可以手动创建软链接：</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">rm</span> /usr/bin/perf
sudo <span class="hljs-built_in">ln</span> -s /usr/lib/linux-tools-4.15.0-163/perf /usr/local/bin/perf
</code></pre>
<h4 data-id="heading-8">3.2 从源码编译安装（推荐）</h4>
<blockquote>
<p>⚠️ <strong>重要提示</strong>：不能直接 <code>make</code>，需要先安装某些依赖，否则会导致某些异常。缺少某些库请参照编译的提示进行安装。</p>
</blockquote>
<p><strong>内核资源</strong>：</p>
<ul>
<li>内核官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kernel.org%2F" target="_blank" title="https://www.kernel.org/" ref="nofollow noopener noreferrer">www.kernel.org/</a></li>
<li>内核下载地址：<a href="https://link.juejin.cn?target=http%3A%2F%2Fftp.sjtu.edu.cn%2Fsites%2Fftp.kernel.org%2Fpub%2Flinux%2Fkernel%2F" target="_blank" title="http://ftp.sjtu.edu.cn/sites/ftp.kernel.org/pub/linux/kernel/" ref="nofollow noopener noreferrer">ftp.sjtu.edu.cn/sites/ftp.k…</a></li>
</ul>
<p><strong>编译步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 下载源码</span>
git <span class="hljs-built_in">clone</span> git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git

<span class="hljs-comment"># 2. 切换至对应的版本分支</span>
<span class="hljs-built_in">cd</span> linux
git branch -r      <span class="hljs-comment"># 查看所有远程分支</span>
git branch -a      <span class="hljs-comment"># 查看所有分支</span>
git checkout v5.4  <span class="hljs-comment"># 切换到 v5.4 分支</span>

<span class="hljs-comment"># 3. 编译安装 perf</span>
<span class="hljs-built_in">cd</span> tools/perf
make

<span class="hljs-comment"># 4. 测试 perf 是否成功安装</span>
<span class="hljs-built_in">cd</span> ../..
sudo perf top
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[下载源码] --&gt; B[切换版本分支]
    B --&gt; C[进入 tools/perf]
    C --&gt; D[执行 make]
    D --&gt; E[验证安装]
</code></pre>
<hr/>
<h3 data-id="heading-9">四、Perf 使用方法</h3>
<h4 data-id="heading-10">4.1 perf list</h4>
<p>查看当前系统支持的性能事件。使用 <code>perf list</code> 命令可以显示当前软硬件环境下支持的所有事件：</p>

























<table><thead><tr><th>事件类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>Hardware Event</strong></td><td>由 PMU 部件产生，在特定条件下探测性能事件</td><td>CPU 周期、分支指令、TLB 重填例外、Cache 缺失</td></tr><tr><td><strong>Software Event</strong></td><td>内核产生的事件，统计操作系统相关性能事件</td><td>系统调用次数、上下文切换次数、任务迁移次数、缺页例外次数</td></tr><tr><td><strong>Tracepoint Event</strong></td><td>内核中静态 tracepoint 触发的事件</td><td>slab 分配器的分配次数等</td></tr></tbody></table>
<h4 data-id="heading-11">4.2 perf top</h4>
<p>类似 <code>top</code> 命令，主要用于<strong>实时分析</strong>各个函数在某个性能事件上的热度，能够快速定位热点函数，包括应用程序函数、模块函数与内核函数，甚至能够定位到热点指令。</p>
<blockquote>
<p>🔐 <strong>执行需要 root 权限</strong></p>
</blockquote>
<p><strong>常用参数</strong>：</p>

















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-e &lt;event&gt;</code></td><td>指明要分析的性能事件</td></tr><tr><td><code>-p &lt;pid&gt;</code></td><td>仅分析目标进程及其创建的线程</td></tr></tbody></table>
<h4 data-id="heading-12">4.3 perf stat</h4>
<p>用于统计 event 出现的次数（计数模式）。</p>
<p><strong>默认事件说明</strong>：</p>









































<table><thead><tr><th>事件名称</th><th>说明</th></tr></thead><tbody><tr><td><code>cpu-clock</code></td><td>任务真正占用的处理器时间（ms）。<code>CPUs utilized = cpu-clock / time elapsed</code>，值高说明程序多数时间花费在 CPU 计算上而非 IO</td></tr><tr><td><code>context-switches</code></td><td>上下文的切换次数</td></tr><tr><td><code>CPU-migrations</code></td><td>处理器迁移次数。Linux 为维持多处理器负载均衡，会将任务从一个 CPU 迁移到另一个 CPU</td></tr><tr><td><code>page-faults</code></td><td>缺页异常次数。页面未建立、不在内存、映射关系未建立、TLB 不命中、权限不匹配等都会触发</td></tr><tr><td><code>cycles</code></td><td>消耗的处理器周期数</td></tr><tr><td><code>instructions</code></td><td>执行的指令数。IPC 为平均每个 CPU cycle 执行的指令数</td></tr><tr><td><code>branches</code></td><td>遇到的分支指令数</td></tr><tr><td><code>branch-misses</code></td><td>预测错误的分支指令数</td></tr></tbody></table>
<p><strong>参数说明</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">-e &lt;event&gt;  <span class="hljs-comment"># 指定性能事件（可以是多个，用 , 分隔）</span>
-p &lt;pid&gt;    <span class="hljs-comment"># 指定待分析进程的 pid（可以是多个，用 , 分隔）</span>
-t &lt;tid&gt;    <span class="hljs-comment"># 指定待分析线程的 tid（可以是多个，用 , 分隔）</span>
-a          <span class="hljs-comment"># 从所有 CPU 收集系统数据</span>
-d          <span class="hljs-comment"># 打印更详细的信息，可重复 3 次</span>
            <span class="hljs-comment">#   -d：L1 和 LLC data cache</span>
            <span class="hljs-comment">#   -d -d：dTLB 和 iTLB events</span>
            <span class="hljs-comment">#   -d -d -d：增加 prefetch events</span>
</code></pre>
<h4 data-id="heading-13">4.4 perf record</h4>
<p>采样模式，perf 收集采样信息并记录在文件中，可以离线分析。使用 <code>perf report</code> 解析收集的采样数据文件。</p>
<p><strong>参数说明</strong>：</p>





















































<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-e</code></td><td>选择性能事件</td></tr><tr><td><code>-p</code></td><td>待分析进程的 id</td></tr><tr><td><code>-t</code></td><td>待分析线程的 id</td></tr><tr><td><code>-a</code></td><td>分析整个系统的性能</td></tr><tr><td><code>-C</code></td><td>只采集指定 CPU 数据</td></tr><tr><td><code>-F</code></td><td>采样频率，每秒多少次</td></tr><tr><td><code>-c</code></td><td>事件的采样周期</td></tr><tr><td><code>-o</code></td><td>指定输出文件，默认为 <code>perf.data</code></td></tr><tr><td><code>-A</code></td><td>以 append 的方式写输出文件</td></tr><tr><td><code>-f</code></td><td>以 OverWrite 的方式写输出文件</td></tr><tr><td><code>-g</code></td><td>记录函数间的调用关系</td></tr></tbody></table>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">sudo perf record -e cpu-clock -g -p 2548
<span class="hljs-comment"># -g         告诉 perf record 额外记录函数的调用关系</span>
<span class="hljs-comment"># -e cpu-clock  监控的指标为 cpu 周期 </span>
<span class="hljs-comment"># -p         指定需要 record 的进程 pid</span>
</code></pre>
<blockquote>
<p>💡 采样一段时间后，可以使用 <code>Ctrl+C</code> 停止命令，这时会生成 <code>perf.data</code> 文件（默认文件名）</p>
</blockquote>
<h4 data-id="heading-14">4.5 perf report</h4>
<p>主要用来分析 <code>perf record</code> 生成的 <code>perf.data</code> 文件。</p>
<hr/>
<h3 data-id="heading-15">五、生成火焰图</h3>
<h4 data-id="heading-16">5.1 操作流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[perf record&lt;br/&gt;采集数据] --&gt; B[perf script&lt;br/&gt;导出文本]
    B --&gt; C[stackcollapse-perf.pl&lt;br/&gt;折叠堆栈]
    C --&gt; D[flamegraph.pl&lt;br/&gt;生成 SVG]
    D --&gt; E[浏览器查看&lt;br/&gt;火焰图]
</code></pre>
<h4 data-id="heading-17">5.2 第一步：采样并记录性能数据</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 对 CPU 所有进程 99Hz 采集，执行 60 秒后采集完成，当前目录生成 perf.data 文件</span>
perf record -F 99 -a -g -- <span class="hljs-built_in">sleep</span> 60
perf script &gt; out.perf

<span class="hljs-comment"># 或者：对进程 id 181 采集，采集时间 60 秒，执行期间不要退出</span>
perf record -F 99 -p 181 -g -- <span class="hljs-built_in">sleep</span> 60
perf script &gt; out.perf
</code></pre>
<h4 data-id="heading-18">5.3 第二步：用 FlameGraph 工具解析</h4>
<p><strong>工具仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrendangregg%2FFlameGraph" target="_blank" title="https://github.com/brendangregg/FlameGraph" ref="nofollow noopener noreferrer">github.com/brendangreg…</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆工具仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/brendangregg/FlameGraph.git
<span class="hljs-built_in">cd</span> FlameGraph

<span class="hljs-comment"># 折叠堆栈信息</span>
./stackcollapse-perf.pl out.perf &gt; out.folded

<span class="hljs-comment"># 生成火焰图</span>
./flamegraph.pl out.folded &gt; kernel.svg
</code></pre>
<h4 data-id="heading-19">5.4 解读火焰图</h4>
<p>火焰图是基于 stack 信息生成的 SVG 图片，用来展示 CPU 的调用栈。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 火焰图结构
        direction TB
        Y[Y 轴：调用栈深度&lt;br/&gt;顶部是正在执行的函数&lt;br/&gt;下方是父函数]
        X[X 轴：抽样数/执行时间&lt;br/&gt;宽度越大执行时间越长&lt;br/&gt;按字母顺序排列]
    end
</code></pre>
<p><strong>关键要点</strong>：</p>





























<table><thead><tr><th>元素</th><th>说明</th></tr></thead><tbody><tr><td><strong>方框</strong></td><td>每个方框代表一个函数</td></tr><tr><td><strong>宽度</strong></td><td>方框越宽，代表执行时间越久</td></tr><tr><td><strong>高度</strong></td><td>楼层越高，代表调用栈越深</td></tr><tr><td><strong>顶层</strong></td><td>最顶层的函数是叶子函数（正在执行的函数）</td></tr><tr><td><strong>平顶</strong></td><td>如果有"平顶"（plateaus），表示该函数可能存在性能问题</td></tr></tbody></table>
<blockquote>
<p>🎯 <strong>分析技巧</strong>：火焰图就是看顶层的哪个函数占据的宽度最大。只要有"平顶"，就表示该函数可能存在性能问题，是优化的重点目标。</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">附录：快速参考卡片</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 实时查看热点函数</span>
sudo perf top -p &lt;pid&gt;

<span class="hljs-comment"># 统计性能事件</span>
sudo perf <span class="hljs-built_in">stat</span> -p &lt;pid&gt; -d

<span class="hljs-comment"># 采样并生成火焰图（完整流程）</span>
sudo perf record -F 99 -p &lt;pid&gt; -g -- <span class="hljs-built_in">sleep</span> 60
perf script &gt; out.perf
./stackcollapse-perf.pl out.perf &gt; out.folded
./flamegraph.pl out.folded &gt; flame.svg
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python实现基于UDP的文件传输：完整教程（附避坑指南）]]></title>    <link>https://juejin.cn/post/7581693431740006463</link>    <guid>https://juejin.cn/post/7581693431740006463</guid>    <pubDate>2025-12-09T14:19:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740006463" data-draft-id="7581669438577426468" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python实现基于UDP的文件传输：完整教程（附避坑指南）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-09T14:19:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刚哥的进化路"/> <meta itemprop="url" content="https://juejin.cn/user/71892859621675"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python实现基于UDP的文件传输：完整教程（附避坑指南）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/71892859621675/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刚哥的进化路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:19:01.000Z" title="Tue Dec 09 2025 14:19:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>UDP本身是无连接、不可靠的传输协议，直接用来传文件容易出现丢包、乱序问题，但通过“分块传输+校验+重传”的设计，依然能实现稳定的文件传输。</p>
<h2 data-id="heading-0">一、UDP文件传输的核心设计思路</h2>
<p>UDP不保证数据送达，所以要先解决三个关键问题：</p>
<ol>
<li><strong>分块传输</strong>：将大文件拆分成固定大小的数据包（如1024字节），避免单次发送数据过大导致丢包；</li>
<li><strong>包标识</strong>：每个数据包添加“序号+总包数+校验位”，服务端接收后能校验完整性、排序重组；</li>
<li><strong>确认重传</strong>：服务端接收每个数据包后返回确认（ACK），客户端未收到ACK则重传该数据包，保证可靠性。</li>
</ol>
<p>核心流程：</p>
<ul>
<li><strong>客户端</strong>：读取文件→分块→加标识→发送数据包→等待ACK→重传失败包→发送结束标识；</li>
<li><strong>服务端</strong>：接收数据包→校验→排序→重组→保存文件→返回ACK。</li>
</ul>
<h2 data-id="heading-1">二、完整实现代码</h2>
<h3 data-id="heading-2">1. 服务端代码（接收文件）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 配置参数</span>
UDP_IP = <span class="hljs-string">""</span>  <span class="hljs-comment"># 监听所有本机IP</span>
UDP_PORT = <span class="hljs-number">9999</span>
BUFFER_SIZE = <span class="hljs-number">1024</span>  <span class="hljs-comment"># 数据包大小（需和客户端一致）</span>
SAVE_DIR = <span class="hljs-string">"received_files"</span>  <span class="hljs-comment"># 文件保存目录</span>

<span class="hljs-comment"># 创建保存目录</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(SAVE_DIR):
    os.makedirs(SAVE_DIR)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_file_server</span>():
    <span class="hljs-comment"># 1. 创建UDP Socket</span>
    server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    server_socket.bind((UDP_IP, UDP_PORT))
    <span class="hljs-comment"># 允许端口复用，避免重启报错</span>
    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"UDP文件服务端已启动，监听端口 <span class="hljs-subst">{UDP_PORT}</span>..."</span>)

    <span class="hljs-comment"># 初始化接收状态</span>
    file_data = {}  <span class="hljs-comment"># 存储接收的数据包 {序号: 数据}</span>
    total_packets = <span class="hljs-number">0</span>  <span class="hljs-comment"># 总包数</span>
    file_name = <span class="hljs-string">""</span>  <span class="hljs-comment"># 文件名</span>
    client_addr = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 客户端地址</span>

    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># 2. 接收数据包（阻塞）</span>
            data, client_addr = server_socket.recvfrom(BUFFER_SIZE + <span class="hljs-number">32</span>)  <span class="hljs-comment"># 预留标识位空间</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># 解析数据包标识："文件名|总包数|当前序号|数据"</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 分割标识和数据（用|分隔，最后一段是文件数据）</span>
                parts = data.decode(<span class="hljs-string">'utf-8'</span>, errors=<span class="hljs-string">'ignore'</span>).split(<span class="hljs-string">'|'</span>, <span class="hljs-number">3</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) != <span class="hljs-number">4</span>:
                    <span class="hljs-comment"># 不是文件数据包，可能是结束标识</span>
                    <span class="hljs-keyword">if</span> data.decode(<span class="hljs-string">'utf-8'</span>) == <span class="hljs-string">"TRANSFER_FINISH"</span>:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"客户端发送结束标识，开始重组文件..."</span>)
                        <span class="hljs-keyword">break</span>
                    <span class="hljs-keyword">continue</span>

                file_name, total_packets_str, packet_num_str, file_chunk = parts
                total_packets = <span class="hljs-built_in">int</span>(total_packets_str)
                packet_num = <span class="hljs-built_in">int</span>(packet_num_str)
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"数据包解析失败：<span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-comment"># 返回错误ACK</span>
                server_socket.sendto(<span class="hljs-string">f"ERR|<span class="hljs-subst">{packet_num}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>), client_addr)
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># 3. 校验并保存数据包</span>
            <span class="hljs-keyword">if</span> <span class="hljs-number">1</span> &lt;= packet_num &lt;= total_packets:
                file_data[packet_num] = file_chunk
                <span class="hljs-comment"># 返回成功ACK</span>
                server_socket.sendto(<span class="hljs-string">f"ACK|<span class="hljs-subst">{packet_num}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>), client_addr)
                <span class="hljs-comment"># 打印进度</span>
                progress = (<span class="hljs-built_in">len</span>(file_data) / total_packets) * <span class="hljs-number">100</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"接收进度：<span class="hljs-subst">{progress:<span class="hljs-number">.1</span>f}</span>% (<span class="hljs-subst">{<span class="hljs-built_in">len</span>(file_data)}</span>/<span class="hljs-subst">{total_packets}</span>)"</span>, end=<span class="hljs-string">'\r'</span>)

        <span class="hljs-comment"># 4. 重组并保存文件</span>
        <span class="hljs-keyword">if</span> file_data <span class="hljs-keyword">and</span> total_packets &gt; <span class="hljs-number">0</span>:
            <span class="hljs-comment"># 按序号排序数据包</span>
            sorted_chunks = [file_data[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, total_packets + <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> file_data]
            <span class="hljs-comment"># 拼接所有数据</span>
            file_path = os.path.join(SAVE_DIR, file_name)
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:
                <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> sorted_chunks:
                    f.write(chunk.encode(<span class="hljs-string">'utf-8'</span>))  <span class="hljs-comment"># 若传二进制文件，需调整编码逻辑（见进阶部分）</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n文件接收完成！保存路径：<span class="hljs-subst">{file_path}</span>"</span>)
            <span class="hljs-comment"># 发送完成确认</span>
            server_socket.sendto(<span class="hljs-string">"FILE_SAVED"</span>.encode(<span class="hljs-string">'utf-8'</span>), client_addr)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n未接收到完整文件数据"</span>)

    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n服务端手动停止"</span>)
    <span class="hljs-keyword">finally</span>:
        server_socket.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    udp_file_server()
</code></pre>
<h3 data-id="heading-3">2. 客户端代码（发送文件）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 配置参数</span>
SERVER_IP = <span class="hljs-string">"127.0.0.1"</span>  <span class="hljs-comment"># 服务端IP（远程传输改实际IP）</span>
SERVER_PORT = <span class="hljs-number">9999</span>
BUFFER_SIZE = <span class="hljs-number">1024</span>  <span class="hljs-comment"># 每个数据包的文件数据大小</span>
RETRY_TIMES = <span class="hljs-number">3</span>  <span class="hljs-comment"># 单个数据包最大重传次数</span>
RETRY_INTERVAL = <span class="hljs-number">0.5</span>  <span class="hljs-comment"># 重传间隔（秒）</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">udp_file_client</span>(<span class="hljs-params">file_path</span>):
    <span class="hljs-comment"># 1. 检查文件是否存在</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(file_path):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：文件 <span class="hljs-subst">{file_path}</span> 不存在"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-comment"># 获取文件名和文件大小</span>
    file_name = os.path.basename(file_path)
    file_size = os.path.getsize(file_path)
    <span class="hljs-comment"># 计算总包数（向上取整）</span>
    total_packets = (file_size + BUFFER_SIZE - <span class="hljs-number">1</span>) // BUFFER_SIZE
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"准备发送文件：<span class="hljs-subst">{file_name}</span>，大小：<span class="hljs-subst">{file_size}</span>字节，总包数：<span class="hljs-subst">{total_packets}</span>"</span>)

    <span class="hljs-comment"># 2. 创建UDP Socket</span>
    client_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    client_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)
    <span class="hljs-comment"># 设置超时（避免等待ACK卡死）</span>
    client_socket.settimeout(<span class="hljs-number">2</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 3. 读取文件并分块发送</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># 二进制文件用'rb'（见进阶部分）</span>
            <span class="hljs-keyword">for</span> packet_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, total_packets + <span class="hljs-number">1</span>):
                <span class="hljs-comment"># 读取当前块数据</span>
                file_chunk = f.read(BUFFER_SIZE)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> file_chunk:
                    <span class="hljs-keyword">break</span>

                <span class="hljs-comment"># 构造数据包："文件名|总包数|当前序号|数据"</span>
                packet_data = <span class="hljs-string">f"<span class="hljs-subst">{file_name}</span>|<span class="hljs-subst">{total_packets}</span>|<span class="hljs-subst">{packet_num}</span>|<span class="hljs-subst">{file_chunk}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>)
                retry_count = <span class="hljs-number">0</span>
                ack_received = <span class="hljs-literal">False</span>

                <span class="hljs-comment"># 4. 发送并等待ACK，失败则重传</span>
                <span class="hljs-keyword">while</span> retry_count &lt; RETRY_TIMES <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> ack_received:
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-comment"># 发送数据包</span>
                        client_socket.sendto(packet_data, (SERVER_IP, SERVER_PORT))
                        <span class="hljs-comment"># 等待ACK</span>
                        ack_data, _ = client_socket.recvfrom(<span class="hljs-number">128</span>)
                        ack_parts = ack_data.decode(<span class="hljs-string">'utf-8'</span>).split(<span class="hljs-string">'|'</span>)
                        <span class="hljs-keyword">if</span> ack_parts[<span class="hljs-number">0</span>] == <span class="hljs-string">"ACK"</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">int</span>(ack_parts[<span class="hljs-number">1</span>]) == packet_num:
                            ack_received = <span class="hljs-literal">True</span>
                            <span class="hljs-comment"># 打印进度</span>
                            progress = (packet_num / total_packets) * <span class="hljs-number">100</span>
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发送进度：<span class="hljs-subst">{progress:<span class="hljs-number">.1</span>f}</span>% (<span class="hljs-subst">{packet_num}</span>/<span class="hljs-subst">{total_packets}</span>)"</span>, end=<span class="hljs-string">'\r'</span>)
                    <span class="hljs-keyword">except</span> socket.timeout:
                        retry_count += <span class="hljs-number">1</span>
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n数据包 <span class="hljs-subst">{packet_num}</span> 超时，重传 <span class="hljs-subst">{retry_count}</span>/<span class="hljs-subst">{RETRY_TIMES}</span>"</span>)
                        time.sleep(RETRY_INTERVAL)
                    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n数据包 <span class="hljs-subst">{packet_num}</span> 发送失败：<span class="hljs-subst">{e}</span>"</span>)
                        retry_count += <span class="hljs-number">1</span>
                        time.sleep(RETRY_INTERVAL)

                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ack_received:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n错误：数据包 <span class="hljs-subst">{packet_num}</span> 重传<span class="hljs-subst">{RETRY_TIMES}</span>次失败，传输终止"</span>)
                    <span class="hljs-keyword">return</span>

        <span class="hljs-comment"># 5. 发送结束标识</span>
        client_socket.sendto(<span class="hljs-string">"TRANSFER_FINISH"</span>.encode(<span class="hljs-string">'utf-8'</span>), (SERVER_IP, SERVER_PORT))
        <span class="hljs-comment"># 等待服务端保存完成确认</span>
        <span class="hljs-keyword">try</span>:
            finish_ack, _ = client_socket.recvfrom(<span class="hljs-number">128</span>)
            <span class="hljs-keyword">if</span> finish_ack.decode(<span class="hljs-string">'utf-8'</span>) == <span class="hljs-string">"FILE_SAVED"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n文件发送完成！服务端已保存"</span>)
        <span class="hljs-keyword">except</span> socket.timeout:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n未收到服务端完成确认，但数据已发送完毕"</span>)

    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n客户端手动停止"</span>)
    <span class="hljs-keyword">finally</span>:
        client_socket.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 替换为你要发送的文件路径（本地测试用绝对/相对路径）</span>
    target_file = <span class="hljs-string">"test.txt"</span>  <span class="hljs-comment"># 示例：发送当前目录的test.txt</span>
    udp_file_client(target_file)
</code></pre>
<h2 data-id="heading-4">三、基础版使用步骤</h2>
<ol>
<li><strong>准备测试文件</strong>：在客户端目录创建一个<code>test.txt</code>文件（内容任意）；</li>
<li><strong>启动服务端</strong>：运行服务端代码，控制台显示“UDP文件服务端已启动”；</li>
<li><strong>启动客户端</strong>：修改客户端代码中<code>target_file</code>为实际文件路径，运行客户端；</li>
<li><strong>查看结果</strong>：服务端控制台显示传输进度，完成后文件会保存到<code>received_files</code>目录。</li>
</ol>
<h2 data-id="heading-5">四、关键优化：支持二进制文件（图片/视频/压缩包）</h2>
<p>基础版仅支持文本文件，要传输图片、视频等二进制文件，需修改<strong>编码逻辑</strong>（核心是避免字符编码导致的数据损坏）：</p>
<h3 data-id="heading-6">1. 客户端修改（读取二进制文件）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 替换客户端文件读取部分</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># 改为二进制读取</span>
    <span class="hljs-keyword">for</span> packet_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, total_packets + <span class="hljs-number">1</span>):
        file_chunk = f.read(BUFFER_SIZE)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> file_chunk:
            <span class="hljs-keyword">break</span>
    <span class="hljs-comment"># 构造数据包：用特殊分隔符（如b'|||'），避免二进制数据冲突</span>
    packet_header = <span class="hljs-string">f"<span class="hljs-subst">{file_name}</span>|<span class="hljs-subst">{total_packets}</span>|<span class="hljs-subst">{packet_num}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>)
    packet_data = packet_header + <span class="hljs-string">b'|||'</span> + file_chunk  <span class="hljs-comment"># 二进制拼接</span>
</code></pre>
<h3 data-id="heading-7">2. 服务端修改（解析二进制数据）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 替换服务端数据包解析部分</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 分割头部和二进制数据（按b'|||'分割）</span>
    header, file_chunk = data.split(<span class="hljs-string">b'|||'</span>, <span class="hljs-number">1</span>)
    <span class="hljs-comment"># 解析头部（转字符串）</span>
    parts = header.decode(<span class="hljs-string">'utf-8'</span>).split(<span class="hljs-string">'|'</span>, <span class="hljs-number">2</span>)
    file_name, total_packets_str, packet_num_str = parts
    total_packets = <span class="hljs-built_in">int</span>(total_packets_str)
    packet_num = <span class="hljs-built_in">int</span>(packet_num_str)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"二进制数据包解析失败：<span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-keyword">continue</span>

<span class="hljs-comment"># 保存时直接写入二进制数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> sorted_chunks:
        f.write(chunk)  <span class="hljs-comment"># 无需encode，直接写二进制</span>
</code></pre>
<h2 data-id="heading-8">五、避坑指南：常见问题与解决方案</h2>
<h3 data-id="heading-9">1. 数据包丢包/重传失败</h3>
<ul>
<li>原因：UDP无可靠性保证，网络波动易丢包；</li>
<li>解决方案：
<ul>
<li>增大<code>RETRY_TIMES</code>（如改为5），延长<code>RETRY_INTERVAL</code>；</li>
<li>减小<code>BUFFER_SIZE</code>（如改为512），降低单包传输压力；</li>
<li>远程传输时确保服务端端口已开放防火墙。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">2. 大文件传输卡顿</h3>
<ul>
<li>原因：循环发送未做速率控制，网络拥塞；</li>
<li>解决方案：在客户端发送每个数据包后添加<code>time.sleep(0.001)</code>，控制发送速率。</li>
</ul>
<h3 data-id="heading-11">3. 数据包解析错误</h3>
<ul>
<li>原因：分隔符（|）与文件内容冲突；</li>
<li>解决方案：改用更复杂的分隔符（如<code>|||</code>或随机字符串），或对头部做Base64编码。</li>
</ul>
<h3 data-id="heading-12">4. 端口被占用</h3>
<ul>
<li>解决方案：修改<code>UDP_PORT</code>（如改为10000），并在服务端添加<code>SO_REUSEADDR</code>选项（代码已包含）。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🤖 当人工智能开始“写”前端：一场硅基的艺术创作]]></title>    <link>https://juejin.cn/post/7581698635866390554</link>    <guid>https://juejin.cn/post/7581698635866390554</guid>    <pubDate>2025-12-10T01:50:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698635866390554" data-draft-id="7581738974424481811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🤖 当人工智能开始“写”前端：一场硅基的艺术创作"/> <meta itemprop="keywords" content="人工智能,HTML,LLM"/> <meta itemprop="datePublished" content="2025-12-10T01:50:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🤖 当人工智能开始“写”前端：一场硅基的艺术创作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:50:45.000Z" title="Wed Dec 10 2025 01:50:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧠 第一幕：AI脑袋里的“算盘”是怎么打的？</h2>
<p>想象一个 AI 坐在电脑前（当然，它并没有椅子，也没有咖啡 ☕），它面对一个人类的请求：</p>
<blockquote>
<p>“请帮我写一个响应式的网页，能展示猫咪的照片，还要有按钮切换。”</p>
</blockquote>
<p>对于你我，这是个编码任务；<br/>
对于 AI，这是一个<strong>语言理解 + 逻辑推理 + 生成代码</strong>的过程。</p>
<p>底层其实分成三步走：</p>
<ol>
<li>
<p><strong>语义理解（Semantic Understanding）</strong><br/>
AI 首先得明白“展示猫咪的照片”这句话的意思。这一步相当于它在脑中生成一个抽象的网页结构树（有点类似 DOM，但是是脑内的）。</p>
</li>
<li>
<p><strong>模式搜索（Pattern Matching）</strong><br/>
接着它会在记忆中搜索“网页”、“响应式”、“按钮”等的最佳实现方式。换句话说，它在思考：</p>
<blockquote>
<p>“嗯，我以前看过这种写法，大概 HTML 要一层容器，一个 <code>img</code>，再加一个 <code>button</code> 来切换图片。”</p>
</blockquote>
</li>
<li>
<p><strong>代码生成（Code Generation）</strong><br/>
当逻辑结构敲定，AI 就开始“敲键盘”——准确来说，是在语言模型的概率分布里，逐词预测出正确的 HTML、CSS 和 JavaScript。</p>
</li>
</ol>
<p>🎷这就像即兴爵士：没有固定的谱子，但每个音符都“合理”。</p>
<hr/>
<h2 data-id="heading-1">💡 第二幕：AI 是怎么编织 HTML 那张“蛛网”的</h2>
<p>HTML（超文本标记语言）其实是最像“诗”的程序语言。<br/>
AI 在生成 HTML 时，并不是死记硬背模板，而是在<strong>搭建语义结构</strong>。</p>
<p>AI 想的逻辑大致如下（伪思维模式💭）：</p>
<pre><code class="hljs language-css" lang="css">我需要一个网页
│
├── 顶部：标题区域 &lt;<span class="hljs-selector-tag">header</span>&gt;
│
├── 中间：展示内容 &lt;<span class="hljs-selector-tag">main</span>&gt;
│    │
│    ├── 图片容器 &lt;<span class="hljs-selector-tag">div</span>&gt;
│    └── 按钮区域 &lt;<span class="hljs-selector-tag">button</span>&gt;
│
└── 底部：版权信息 &lt;<span class="hljs-selector-tag">footer</span>&gt;
</code></pre>
<p>然后，它会根据上下文补充必要的属性，比如：</p>
<ul>
<li>“响应式” → 加入 <code>meta viewport</code></li>
<li>“切换图片” → 准备按钮和 JS 脚本</li>
<li>“猫咪” → 加载一张可爱的示例图片 🐱</li>
</ul>
<p>于是，AI 生成的 HTML 就像下面这样：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>AI的猫咪画廊<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: sans-serif;
      <span class="hljs-attribute">text-align</span>: center;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, <span class="hljs-number">#ffe6f2</span>, <span class="hljs-number">#fff</span>);
    }
    <span class="hljs-selector-tag">img</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">90%</span>;
      <span class="hljs-attribute">height</span>: auto;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
    }
    <span class="hljs-selector-tag">button</span> {
      <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">1rem</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.6rem</span> <span class="hljs-number">1.2rem</span>;
      <span class="hljs-attribute">border</span>: none;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ff99cc</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
    <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ff6699</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>🐾 欢迎来到 AI 的猫咪画廊<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"catImg"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://placekitten.com/400/300"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Cute cat"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"changeBtn"</span>&gt;</span>换一只猫🐱<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> catImg = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'catImg'</span>);
    <span class="hljs-keyword">const</span> changeBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'changeBtn'</span>);
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRandomCat</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> w = <span class="hljs-number">300</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span>);
      <span class="hljs-keyword">const</span> h = <span class="hljs-number">200</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-string">`https://placekitten.com/<span class="hljs-subst">${w}</span>/<span class="hljs-subst">${h}</span>`</span>;
    }
    changeBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      catImg.<span class="hljs-property">src</span> = <span class="hljs-title function_">getRandomCat</span>();
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<blockquote>
<p>👀 小结：AI 的“创作”不是盲目的拼凑，而是基于概率、语义和逻辑的“推理输出”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">⚙️ 第三幕：从 0 到代码的底层秘密</h2>
<p>如果我们把 AI 拆开看（比方说像显微镜下看元件 🧬），背后其实是一连串<strong>矩阵运算和概率计算</strong>：</p>
<ul>
<li>每个词（比如 <code>&lt;button&gt;</code>）都有一个向量表示；</li>
<li>神经元在数十亿个参数中权衡这些词的可能性；</li>
<li>每输出一个字符，都在选择“下一个最合适的词”；</li>
<li>整个过程循环不止，直到写出完整的网页。</li>
</ul>
<p>如果用文字描述这个“过程的节奏”，是这样的：</p>
<blockquote>
<p>向量进 → 概率出 → 再预测 → 再输出 → 一页网页成。</p>
</blockquote>
<p>是不是有点像神经元在弹《编程的肖邦夜曲》？🎹</p>
<hr/>
<h2 data-id="heading-3">🤹 第四幕：AI 与前端的美学冲突</h2>
<p>人类程序员写前端时，常常会考虑：</p>
<ul>
<li>用户体验；</li>
<li>可维护性；</li>
<li>性能优化；</li>
<li>还有“老板喜欢不喜欢这个颜色”。</li>
</ul>
<p>而 AI 写代码的重点是：</p>
<ul>
<li>是否符合语义；</li>
<li>是否逻辑正确；</li>
<li>是否对齐用户的文本意图。</li>
</ul>
<p>AI 不会抱怨“这个改三像素没意义”，<br/>
但也不会因为“看起来舒服”而自发调整色调 🎨。</p>
<p>这正是未来的魅力与挑战——<br/>
<strong>AI懂逻辑，而人类懂情绪；两者结合，才有真正的前端艺术。</strong></p>
<hr/>
<h2 data-id="heading-4">🌈 尾声：当AI写下HTML的那一刻</h2>
<p>AI 写 HTML，不仅是在“输出代码”，<br/>
更像是在讲述用户意图的“结构化故事”。</p>
<p>它懂 <code>&lt;div&gt;</code> 的职责，<br/>
也理解“按钮”是交互的灵魂。<br/>
而我们，则是它的导演、编辑、与灵感缔造者。</p>
<p>最终，这场合作不是替代，而是共创。<br/>
当硅与肉身共同书写网页时，<br/>
未来的 HTML 不只是结构，而是一种诗意的表达 🌌。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学而时习之：C++中的异常处理1]]></title>    <link>https://juejin.cn/post/7581666412021465097</link>    <guid>https://juejin.cn/post/7581666412021465097</guid>    <pubDate>2025-12-09T11:10:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666412021465097" data-draft-id="7581408984415649811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学而时习之：C++中的异常处理1"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-09T11:10:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="煤球王子"/> <meta itemprop="url" content="https://juejin.cn/user/4088439235949739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学而时习之：C++中的异常处理1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088439235949739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    煤球王子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T11:10:44.000Z" title="Tue Dec 09 2025 11:10:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C++ 异常处理</h2>
<p>异常处理是 C++ 提供的一种<strong>结构化机制</strong>，用于在程序运行期间<strong>检测并处理错误</strong>。常见的运行时错误包括：</p>
<ul>
<li>除以零</li>
<li>访问非法内存</li>
<li>文件读写失败</li>
</ul>
<p>C++ 异常处理的工作方式<br/>
当错误发生时，不再让程序直接崩溃，而是通过“抛出 → 捕获 → 处理”的流程进行<strong>优雅恢复</strong>：</p>
<ol>
<li>
<p><strong>抛出异常（throw）</strong><br/>
出现错误或意外情况时，用 <code>throw</code> 关键字“抛出”一个异常对象。</p>
</li>
<li>
<p><strong>捕获异常（catch）</strong><br/>
程序沿着调用栈向上查找<strong>类型匹配</strong>的 <code>catch</code> 块，一旦找到就拦截该异常。</p>
</li>
<li>
<p><strong>处理异常</strong><br/>
<code>catch</code> 块内编写应对逻辑，使程序可以<strong>恢复运行</strong>或<strong>优雅退出</strong>。</p>
</li>
</ol>
<h3 data-id="heading-1">try-catch 块</h3>
<p>C++ 自有的异常处理机制：</p>
<ul>
<li>把<strong>可能出错</strong>的代码放进 <code>try</code> 块；</li>
<li>把<strong>处理错误</strong>的代码放进 <code>catch</code> 块。</li>
</ul>
<p>语法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 可能抛出异常的代码</span>
}
<span class="hljs-built_in">catch</span> (异常类型 变量) {
    <span class="hljs-comment">// 异常处理代码</span>
}
</code></pre>
<p>执行流程：<br/>
一旦 <code>try</code> 块内抛出异常，<strong>立即中断</strong>后续语句，<strong>跳转</strong>到类型匹配的 <code>catch</code> 块执行；<br/>
若无匹配 <code>catch</code>，异常继续沿调用链向上传递。</p>
<h3 data-id="heading-2">抛出异常（Throwing Exceptions）</h3>
<p>“抛出异常”就是<strong>从 try 块中返回一个代表错误的值</strong>，系统根据该值的类型寻找匹配的 <code>catch</code> 块。<br/>
使用关键字 <code>throw</code> 完成抛出。</p>
<p>语法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">throw</span> 表达式;
}
<span class="hljs-built_in">catch</span> (类型 变量) {
    <span class="hljs-comment">// 处理代码</span>
}
</code></pre>
<p>可抛出的值分三类：</p>
<ol>
<li>内置类型</li>
<li>标准库异常类</li>
<li>自定义异常类</li>
</ol>
<h4 data-id="heading-3">A.抛出内置类型</h4>
<p>最简单，但几乎不带任何语义信息。示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> x = <span class="hljs-number">7</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (x % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>){
            <span class="hljs-keyword">throw</span> <span class="hljs-number">-1</span>;  <span class="hljs-comment">// 抛出 int 值</span>
        }       <span class="hljs-comment">// 抛出 int 值</span>
    }
    <span class="hljs-built_in">catch</span> (<span class="hljs-type">int</span> e) {       <span class="hljs-comment">// 捕获 int</span>
        cout &lt;&lt; <span class="hljs-string">"捕获异常: "</span> &lt;&lt; e;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">捕获异常: -1</span>
</code></pre>
<p>缺点：必须靠<strong>错误码</strong>判断问题，与 <code>if-else</code> 无异。C++ 推荐的做法是：抛出<strong>带有错误描述</strong>的类对象，而非裸值。</p>
<h4 data-id="heading-4">B.抛出标准异常</h4>
<p>标准异常是一组<strong>已定义好的类</strong>，用于表示常见的各种错误。<br/>
这些类都位于头文件 <code>&lt;stdexcept&gt;</code> 中，并统一继承自基类 <code>std::exception</code>，形成一棵标准的异常类继承树。<br/>
（下图给出了 C++ 标准异常的层次结构。）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8bbdb10ef3a48f3875155ed2348edd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765883444&amp;x-signature=Ru08z8lOdt%2Br0qZSQ895bdSmPK8%3D" alt="image.png" loading="lazy"/></p>
<p>使用标准异常的好处：</p>
<ul>
<li>语义清晰，可携带详细的错误信息；</li>
<li>与 C++ 标准库异常体系无缝衔接；</li>
<li>支持 <code>what()</code> 成员函数，返回描述性字符串。
这些异常会被 C++ 标准库自身抛出，因此我们必须学会如何处理它们。<br/>
每个标准异常都提供 <code>what()</code> 方法，返回描述异常详情的字符串。</li>
</ul>
<p>示例：<br/>
<code>vector::at()</code> 在索引越界时会抛出 <code>out_of_range</code> 异常。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>};

    <span class="hljs-keyword">try</span> {
        v.<span class="hljs-built_in">at</span>(<span class="hljs-number">10</span>);          <span class="hljs-comment">// 访问越界元素</span>
    }
    <span class="hljs-built_in">catch</span> (out_of_range e) {
        cout &lt;&lt; <span class="hljs-string">"捕获到: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin">捕获到: vector::_M_range_check: __n (which <span class="hljs-keyword">is</span> <span class="hljs-number">10</span>) &gt;= <span class="hljs-keyword">this</span>-&gt;size() (which <span class="hljs-keyword">is</span> <span class="hljs-number">3</span>)
</code></pre>
<p>我们也可以用 <code>throw</code> 语句<strong>手动抛出</strong>这些标准异常。</p>













































<table><thead><tr><th>C++定义好的异常</th><th>主要用途</th><th>典型抛出场景</th></tr></thead><tbody><tr><td><strong><code>out_of_range</code></strong></td><td>访问超出有效范围</td><td><code>vector::at()</code>、<code>string::at()</code>索引越界</td></tr><tr><td><strong><code>length_error</code></strong></td><td>试图创建超过最大长度的对象</td><td><code>string</code>构造函数长度过大，<code>vector::reserve()</code>超限</td></tr><tr><td><strong><code>domain_error</code></strong></td><td>数学运算定义域错误</td><td>数学函数参数不在有效定义域内</td></tr><tr><td><strong><code>invalid_argument</code></strong></td><td>函数参数无效</td><td>参数不符合函数要求</td></tr><tr><td><strong><code>range_error</code></strong></td><td>计算结果超出有意义的值域</td><td>浮点数运算结果精度损失</td></tr><tr><td><strong><code>overflow_error</code></strong></td><td>算术运算上溢</td><td>计算结果超出数据类型上限</td></tr><tr><td><strong><code>underflow_error</code></strong></td><td>算术运算下溢</td><td>计算结果低于数据类型下限</td></tr></tbody></table>
<h4 data-id="heading-5">C.抛出自定义异常</h4>
<p>当标准异常无法满足需求时，可以<strong>自己写一个异常类</strong>。<br/>
推荐继承 <code>std::exception</code>，这样就能与标准库的异常体系无缝衔接（当然不强制）。</p>
<p>完整示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;exception&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-comment">/* ---------- 自定义异常类 ---------- */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NegativeValueException</span> : <span class="hljs-keyword">public</span> exception {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> value;                      <span class="hljs-comment">// 保存出错数值</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">NegativeValueException</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> : value(val) {</span>}

    <span class="hljs-comment">// 重写 what()，返回错误描述</span>
    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">what</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"出现负值错误！"</span>;
    }

    <span class="hljs-comment">// 可选：提供接口获取当时传入的非法值</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> value; }
};

<span class="hljs-comment">/* ---------- 可能抛出异常的函数 ---------- */</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkValue</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">NegativeValueException</span>(x);   <span class="hljs-comment">// 抛出自定义异常对象</span>
    <span class="hljs-keyword">else</span>
        cout &lt;&lt; <span class="hljs-string">"数值为: "</span> &lt;&lt; x &lt;&lt; endl;
}

<span class="hljs-comment">/* ---------- 使用示例 ---------- */</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> numbers[] = {<span class="hljs-number">10</span>, <span class="hljs-number">-5</span>, <span class="hljs-number">20</span>};

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> n : numbers) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">checkValue</span>(n);
        }
        <span class="hljs-built_in">catch</span> (NegativeValueException&amp; e) {          <span class="hljs-comment">// 捕获自定义异常</span>
            cout &lt;&lt; <span class="hljs-string">"捕获异常: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; <span class="hljs-string">" 非法值 = "</span> &lt;&lt; e.<span class="hljs-built_in">getValue</span>() &lt;&lt; endl;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">数值为: 10</span>
<span class="hljs-section">捕获异常: 出现负值错误！ 非法值 = -5</span>
<span class="hljs-section">数值为: 20</span>
</code></pre>
<h3 data-id="heading-6">捕获异常catch</h3>
<p>如前所述，<code>catch</code> 块用来接收并处理 <code>try</code> 块中抛出的异常。 <code>catch</code> 括号里必须写一个<strong>与抛出异常同类型</strong>的形参：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">catch</span> (异常类型 e) {
    <span class="hljs-comment">// 处理语句</span>
}
</code></pre>
<p>其中 <code>e</code> 是给异常对象起的名字。 只有当 <code>try</code> 块里抛出的异常类型与这里的 <code>异常类型</code> 匹配时，才会进入该 <code>catch</code> 块执行其内部的代码。</p>
<h4 data-id="heading-7">A.捕获多种异常</h4>
<p>一个 <code>try</code> 块后面可以跟<strong>多个</strong> <code>catch</code> 块，用来分别处理不同类型的异常。例如：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 可能抛出多种异常的代码</span>
}
<span class="hljs-built_in">catch</span> (类型<span class="hljs-number">1</span> e) {
    <span class="hljs-comment">// 当抛出的异常是类型1 时执行</span>
}
<span class="hljs-built_in">catch</span> (类型<span class="hljs-number">2</span> e) {
    <span class="hljs-comment">// 当抛出的异常是类型2 时执行</span>
}
<span class="hljs-built_in">catch</span> (...) {
    <span class="hljs-comment">// 兜底：前面都没匹配到时执行</span>
}
</code></pre>
<p>说明</p>
<ul>
<li>编译器会按<strong>从上到下的顺序</strong>寻找第一个类型匹配的 <code>catch</code>；</li>
<li><code>catch(...)</code> 称为“通配捕获”，可接住<strong>任何类型</strong>的异常，常用来做<strong>最后兜底</strong>处理。</li>
</ul>
<h4 data-id="heading-8">B.按值或按引用捕获</h4>
<p>与函数传参一样，<code>catch</code> 也能“按值”或“按引用”接收异常对象，两者各有用途。</p>
<h5 data-id="heading-9">B1. 按值捕获</h5>
<p>会<strong>复制</strong>一份被抛出的异常对象。 由于异常对象通常不大，复制开销一般可接受。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">catch</span> (runtime_error e)          <span class="hljs-comment">// 按值</span>
{
    cout &lt;&lt; <span class="hljs-string">"Caught: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>();
}
</code></pre>
<h5 data-id="heading-10">B2. 按引用捕获</h5>
<p>直接绑定到原异常对象，<strong>无复制开销</strong>； 核心优势在于支持<strong>多态</strong>：可以用基类引用捕获派生类异常，从而一个 <code>catch</code> 就能处理整个继承体系。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">catch</span> (exception&amp; e)             <span class="hljs-comment">// 按引用（基类）</span>
{
    cout &lt;&lt; <span class="hljs-string">"Caught: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>();
}
</code></pre>
<p>示例中抛出的是 <code>runtime_error</code>，却被 <code>exception&amp;</code> 成功捕获，这就是<strong>多态异常处理</strong>的典型用法。</p>
<h2 data-id="heading-11">异常传播</h2>
<p>异常传播描述“异常在调用栈中如何向上传递”。</p>
<ol>
<li>一旦 <code>throw</code> 抛出异常，<strong>当前代码块立即终止</strong>，栈上已构造的局部对象会被<strong>自动析构</strong>（栈回溯），但 <code>new</code> 出来的动态资源需要手动释放。</li>
<li>运行时沿着调用链<strong>逐帧向上</strong>查找类型匹配的 <code>catch</code> 块，这一过程称为 <strong>stack unwinding（栈展开）</strong>。</li>
<li>找到对应 <code>catch</code> 即捕获并处理；若最终仍未匹配，程序调用 <code>std::terminate()</code> 终止。</li>
</ol>
<p>示例流程：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GfG</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">GfG</span>()  { cout &lt;&lt; <span class="hljs-string">"Object Created\n"</span>; }
    ~<span class="hljs-built_in">GfG</span>() { cout &lt;&lt; <span class="hljs-string">"Object Destroyed\n"</span>; }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">try</span> {
        cout &lt;&lt; <span class="hljs-string">"Inside try block\n"</span>;
        GfG gfg;      <span class="hljs-comment">// 构造局部对象</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-number">10</span>;     <span class="hljs-comment">// 抛出异常</span>
        cout &lt;&lt; <span class="hljs-string">"After throw\n"</span>;  <span class="hljs-comment">// 不会执行</span>
    }
    <span class="hljs-built_in">catch</span> (<span class="hljs-type">int</span> e) {
        cout &lt;&lt; <span class="hljs-string">"Exception Caught\n"</span>;
    }
    cout &lt;&lt; <span class="hljs-string">"After catch"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Inside</span> <span class="hljs-keyword">try</span> block
<span class="hljs-title class_">Object</span> <span class="hljs-title class_">Created</span>
<span class="hljs-title class_">Object</span> <span class="hljs-title class_">Destroyed</span>     ← 栈展开时自动析构
<span class="hljs-title class_">Exception</span> <span class="hljs-title class_">Caught</span>
<span class="hljs-title class_">After</span> <span class="hljs-keyword">catch</span>
</code></pre>
<h2 data-id="heading-12">嵌套 try-catch 块</h2>
<p>在 C++ 里，<code>try-catch</code> 块可以<strong>嵌套</strong>在另一个 <code>try</code> 或 <code>catch</code> 块内部。结构如下：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">try</span> {                      <span class="hljs-comment">// 外层</span>
    <span class="hljs-comment">// ... 可能抛 e2</span>
    <span class="hljs-keyword">try</span> {                  <span class="hljs-comment">// 内层</span>
        <span class="hljs-comment">// ... 可能抛 e1</span>
    }
    <span class="hljs-built_in">catch</span> (eType1 e1) {    <span class="hljs-comment">// 内层只匹配 eType1</span>
        <span class="hljs-comment">// 处理 e1</span>
    }
}
<span class="hljs-built_in">catch</span> (eType2 e2) {        <span class="hljs-comment">// 外层可处理内层未接住的其他异常</span>
    <span class="hljs-comment">// 处理 e2</span>
}
</code></pre>
<ul>
<li>若内层抛出的异常<strong>不是</strong> <code>eType1</code>，内层 <code>catch</code> 不会执行，异常继续<strong>向外层传播</strong>，由外层 <code>catch</code> 尝试匹配。</li>
<li>如此可形成<strong>多级</strong>异常处理链。</li>
</ul>
<hr/>
<p>重新抛出异常（Rethrow） 在内层 <code>catch</code> 中，可用<strong>空 throw 语句</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">throw</span>;   <span class="hljs-comment">// 必须位于 catch 块内</span>
</code></pre>
<p>把已捕获的异常<strong>原样再次抛出</strong>，保留其类型与信息，供<strong>更外层</strong> <code>catch</code> 继续处理。<br/>
这种方式常用于<strong>分层处理</strong>：底层记录日志/做清理，上层决定最终策略。</p>
<h2 data-id="heading-13">异常规格说明</h2>
<p>C++ 允许在函数声明中<strong>显式说明</strong>该函数是否可能抛出异常。现代 C++ 只有两种规格：</p>

















<table><thead><tr><th>规格</th><th>含义</th></tr></thead><tbody><tr><td><code>noexcept</code></td><td><strong>保证</strong>此函数<strong>不会抛出异常</strong>；若运行时仍抛出，将调 <code>std::terminate()</code> 终止程序。</td></tr><tr><td><code>noexcept(false)</code></td><td><strong>可能抛出异常</strong>；这是<strong>默认行为</strong>（不写任何规格时即为此）。</td></tr></tbody></table>
<p>写法示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> <span class="hljs-keyword">noexcept</span>          <span class="hljs-comment">// 承诺不抛异常</span>
</span>{
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func2</span><span class="hljs-params">(<span class="hljs-type">int</span> b)</span> <span class="hljs-title">noexcept</span><span class="hljs-params">(<span class="hljs-literal">false</span>)</span>   <span class="hljs-comment">// 允许抛异常（可省略不写）</span>
</span>{
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<blockquote>
<p>注：旧式 <code>throw(type-list)</code> 规格已在 C++11 起被<strong>废弃</strong>，现代代码应使用 <code>noexcept</code>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 不只是自动装配：让你专注业务，而不是配置]]></title>    <link>https://juejin.cn/post/7581870491755495459</link>    <guid>https://juejin.cn/post/7581870491755495459</guid>    <pubDate>2025-12-09T16:22:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491755495459" data-draft-id="7581688255625838644" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 不只是自动装配：让你专注业务，而不是配置"/> <meta itemprop="keywords" content="后端,Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-12-09T16:22:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="最贪吃的虎"/> <meta itemprop="url" content="https://juejin.cn/user/1109832819826707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 不只是自动装配：让你专注业务，而不是配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1109832819826707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    最贪吃的虎
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T16:22:03.000Z" title="Tue Dec 09 2025 16:22:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p>我们总在寻找捷径。</p>
<p>从前写程序，像推一辆没轮子的车，走三步，停两步，不是缺个螺丝，就是少根轴。配文件比写业务还长，引依赖像在雷区里走路，一不小心就炸了版本。</p>
<p>后来来了个叫 Spring Boot 的家伙。</p>
</blockquote>
<h2 data-id="heading-0">—— 从“会用”到“真懂”的一次彻底梳理</h2>
<p>你是不是也这样？</p>
<ul>
<li>
<p>能用 Spring Boot 快速搭个 REST API；</p>
</li>
<li>
<p>知道它有“自动装配”、“起步依赖”、“内嵌 Tomcat”；</p>
</li>
<li>
<p>但当别人问：“Spring Boot 到底强在哪儿？”</p>
<p>我..好像从没有仔细想过，但是我很喜欢一句话，它能够给出合理解释：<strong>约定大于配置</strong>，你只需要聚焦业务的处理，而不用关心使用的是什么工具，因为我会为你提供默认的，就像我需要切菜，使用水果刀、菜刀、剪刀...不同颜色种类，因为大部分人都会使用菜刀，所以默认给你的就是菜刀，如果你想要试试剪刀，只需要更改配置，而不是更改代码。</p>
</li>
</ul>
<p>今天，我们就抛开术语堆砌，从<strong>真实开发场景出发</strong>，彻底搞清楚：<strong>Spring Boot 为什么能成为现代 Java 开发的事实标准？</strong></p>
<hr/>
<h2 data-id="heading-1">一、它不是新框架，而是“最佳实践的集成包”</h2>
<p>很多人误以为 Spring Boot 是 Spring 的替代品。其实恰恰相反——<br/>
<strong>它是 Spring 的“开发者体验优化版”</strong>。</p>
<p>过去用 Spring MVC + MyBatis + Tomcat，你要：</p>
<ul>
<li>配 <code>web.xml</code></li>
<li>写数据源配置</li>
<li>引一堆版本可能冲突的 jar 包</li>
<li>手动部署 WAR 到外部服务器</li>
</ul>
<p>而 <strong>Spring Boot</strong>的出现，告诉你：“你只需要关心业务的逻辑，配置就让我来吧”。</p>
<hr/>
<h2 data-id="heading-2">二、五大核心机制：让开发“少写、少配、少错”</h2>
<h3 data-id="heading-3">1. <strong>约定大于配置（Convention over Configuration）</strong></h3>
<blockquote>
<p>“如果你不特别说明，我就按最合理的方式办。”</p>
</blockquote>
<ul>
<li>主类放 <code>src/main/java</code>？→ 自动扫描同包及子包的组件。</li>
<li>配置文件叫 <code>application.yml</code>？→ 自动加载。</li>
<li>用了 <code>@RestController</code>？→ 自动注册为 Web 接口。</li>
</ul>
<p><strong>结果</strong>：90% 的常规项目，零配置就能跑起来。</p>
<blockquote>
<p><strong>深层价值</strong>：省下的不是几行代码，而是决策成本和认知负担。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2. <strong>起步依赖（Starter Dependencies）</strong></h3>
<p>还记得以前为了整合 Redis，要查半天该引哪些包吗？</p>
<p>现在只需一行：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>这个 starter 已经包含了：</p>
<ul>
<li>Lettuce 客户端</li>
<li>Spring Data Redis 支持</li>
<li>连接池配置</li>
<li>自动序列化器</li>
</ul>
<p><strong>背后是 Spring 团队帮你做了依赖版本对齐和组合测试，告别“依赖地狱”，技术栈开箱即用。</strong></p>
<hr/>
<h3 data-id="heading-5">3. <strong>内嵌服务器</strong></h3>
<p>传统 Java Web：WAR → 外部 Tomcat → 启动慢、环境不一致。</p>
<p>Spring Boot：<strong>JAR = 应用 + 服务器</strong>。</p>
<pre><code class="hljs language-bash" lang="bash">java -jar myapp.jar
</code></pre>
<p>服务秒级启动，且自带 Tomcat / Jetty / Undertow（可切换），开发调试快如闪电，Docker 部署一行搞定，真正实现“一次构建，随处运行”。</p>
<hr/>
<h3 data-id="heading-6">4. <strong>自动装配（Auto-configuration）</strong></h3>
<p>这是 Spring Boot 的“魔法心脏”。</p>
<p>当你引入 <code>spring-boot-starter-jdbc</code> 并配置了数据库 URL，<br/>
Spring Boot 会<strong>自动</strong>：</p>
<ul>
<li>创建 <code>DataSource</code></li>
<li>配置事务管理器</li>
<li>注册 JdbcTemplate</li>
</ul>
<p>这一切基于 <strong>条件装配（Conditional）</strong>：</p>
<ul>
<li>如果 classpath 有 HikariCP → 用它做连接池</li>
<li>如果你没自定义 DataSource → 我来创建</li>
<li>如果你写了 <code>@EnableTransactionManagement</code> → 就不再重复注册</li>
</ul>
<blockquote>
<p>智能推断你的意图，只在必要时让你介入。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">5. <strong>自定义 Starter：把团队能力产品化</strong></h3>
<p>想象一下：公司有统一的日志规范、认证 SDK、监控埋点。</p>
<p>你可以封装成 <code>company-spring-boot-starter-xxx</code>，其他项目只需引入：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.yourcompany<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>company-spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>然后——日志格式自动统一、TraceID 自动注入、错误上报自动开启。</p>
<blockquote>
<p>想象一下：新人上手零成本，架构治理落地到每一行代码。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">三、被低估的“隐藏优势”：不止于开发阶段</h2>
<p>Spring Boot 的厉害，还体现在<strong>全生命周期支持</strong>：</p>
<h3 data-id="heading-9">🔹 <strong>统一配置管理</strong></h3>
<ul>
<li><code>application-{profile}.yml</code> 按环境隔离</li>
<li><code>@ConfigurationProperties</code> 类型安全绑定</li>
<li>支持命令行、环境变量、Config Server 多种来源</li>
</ul>
<h3 data-id="heading-10">🔹 <strong>Actuator：生产级监控开箱即用</strong></h3>
<ul>
<li><code>/health</code>：服务是否健康？</li>
<li><code>/metrics</code>：QPS、内存、GC 情况？</li>
<li><code>/loggers</code>：线上动态调日志级别（不用重启！）</li>
</ul>
<p>配合 Prometheus + Grafana，运维从此有“眼睛”。</p>
<h3 data-id="heading-11">🔹 <strong>DevTools：开发效率倍增器</strong></h3>
<ul>
<li>代码修改 → 自动重启（秒级）</li>
<li>模板文件修改 → 实时刷新</li>
<li>禁用缓存 + 详细错误页</li>
</ul>
<p>告别“改一行 → 重启 30 秒”的痛苦循环。</p>
<h3 data-id="heading-12">🔹 <strong>测试超级友好</strong></h3>
<ul>
<li><code>@WebMvcTest</code>：只测 Controller</li>
<li><code>@DataJpaTest</code>：只测 Repository（自动回滚）</li>
<li>内置 MockMvc、TestRestTemplate、JsonPath</li>
</ul>
<h3 data-id="heading-13">🔹 <strong>与 Spring 生态无缝融合</strong></h3>
<p>Security、Cloud、Batch、Kafka……<br/>
只要加个 starter，<strong>默认配置已为你调优</strong>，无需研究如何“拼装”。</p>
<h3 data-id="heading-14">🔹 <strong>构建 &amp; 部署现代化</strong></h3>
<ul>
<li>Maven/Gradle 插件一键打包可执行 JAR</li>
<li>支持分层 JAR（Layered JAR），优化 Docker 构建缓存</li>
<li><code>./mvnw spring-boot:build-image</code> 直接生成 OCI 镜像！</li>
</ul>
<hr/>
<h2 data-id="heading-15">结语：</h2>
<h4 data-id="heading-16">它解决的不是“技术问题”，而是<strong>开发者的痛点</strong>：</h4>
<p>不用纠结配置的选择，可插拔设计不再重复造轮子，团队代码规范，运维成本更低...等等，并且 <strong>它不强迫你理解所有细节，但永远给你深入的自由。</strong></p>
<ul>
<li>你可以只写 Controller，享受“开箱即用”；</li>
<li>也可以通过 <code>@Configuration</code>、<code>EnvironmentPostProcessor</code>、<code>BeanFactoryPostProcessor</code> 深度定制；</li>
<li>甚至可以基于它构建自己的框架（比如国内很多中台 PaaS）。</li>
</ul>
<p>这种“<strong>简单而不简陋，强大而不复杂</strong>”的设计，才是 Spring Boot 十年不衰的真正原因。</p>
<hr/>
<h2 data-id="heading-17">写在最后</h2>
<p>“Spring Boot 好在哪？”</p>
<p><strong>// 写给每一个每天和 <code>@SpringBootApplication</code> 打交道，却总觉得“好像还差点什么”的 Java 开发者。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 中为何未定义变量在 typeof 与 delete 中不会报错？——原理、示例与最佳实践]]></title>    <link>https://juejin.cn/post/7581727073581383731</link>    <guid>https://juejin.cn/post/7581727073581383731</guid>    <pubDate>2025-12-10T01:54:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581727073581383731" data-draft-id="7581691182004584458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 中为何未定义变量在 typeof 与 delete 中不会报错？——原理、示例与最佳实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T01:54:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 中为何未定义变量在 typeof 与 delete 中不会报错？——原理、示例与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:54:45.000Z" title="Wed Dec 10 2025 01:54:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、背景与概念</h3>
<p>在 JavaScript 中，如果直接访问未声明的变量，如：</p>
<pre><code class="hljs language-arduino" lang="arduino">console.<span class="hljs-built_in">log</span>(name);
</code></pre>
<p>会抛出：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">ReferenceError:</span> name <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> defined
</code></pre>
<p>但是，使用：</p>
<pre><code class="hljs language-ini" lang="ini">typeof name<span class="hljs-comment">;</span>
delete name<span class="hljs-comment">;</span>
</code></pre>
<p>却不会报错，这给了我们一种“安全探测变量是否存在”的能力。<br/>
本文将深入解释原因、原理，并提供最佳实践示例。</p>
<hr/>
<h3 data-id="heading-1">二、语言设计原理：为什么 typeof 不会抛 ReferenceError？</h3>
<h4 data-id="heading-2"><strong>1. JavaScript 初期的设计目标</strong></h4>
<p>JS 在 1995 年设计时，需要：</p>
<ul>
<li>允许“弱错误”并继续执行</li>
<li>非专业程序员也能上手</li>
<li>有利于容错（浏览器脚本不能轻易崩溃整个页面）</li>
</ul>
<p>因此 <code>typeof</code> 被特意设计为 <strong>永远不会因为未声明变量而抛错</strong>。</p>
<hr/>
<h3 data-id="heading-3">三、typeof 的底层行为机制</h3>
<h4 data-id="heading-4"><strong>1. ECMAScript 规范：检查变量之前不触发 ReferenceError</strong></h4>
<p>伪流程：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">if</span> (变量声明存在)
    返回其类型字符串
<span class="hljs-keyword">else</span>
    返回 <span class="hljs-string">"undefined"</span>
</code></pre>
<p>这意味着：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">typeof</span> name; <span class="hljs-comment">// "undefined"，即使 name 未声明，也不会报错</span>
</code></pre>
<p>示例（带逐行注释）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 示例：检测一个可能不存在的变量</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> userProfile !== <span class="hljs-string">"undefined"</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"变量存在，可使用:"</span>, userProfile);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"变量不存在"</span>);
}
</code></pre>
<p><strong>逐行解释：</strong></p>
<ul>
<li><code>typeof userProfile</code> 不会触发错误</li>
<li>若变量未声明 → 返回字符串 <code>"undefined"</code></li>
<li>因此条件判断安全可靠</li>
</ul>
<hr/>
<h3 data-id="heading-5">四、delete 为什么也不会报错？</h3>
<p><code>delete</code> 的主要作用是删除对象属性，而不是变量。</p>
<p>例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">a</span>;
<span class="hljs-keyword">delete</span> obj.<span class="hljs-property">key</span>;
</code></pre>
<p>如果删除一个不存在的变量或属性，规范要求：</p>
<pre><code class="hljs language-arduino" lang="arduino">删除失败 → 返回 <span class="hljs-literal">false</span>（严格模式报错）
删除成功 → 返回 <span class="hljs-literal">true</span>
</code></pre>
<p>但非严格模式下：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">delete</span> name; <span class="hljs-comment">// name 未声明 → 返回 true，不报错</span>
</code></pre>
<p>这是为了浏览器脚本的容错设计。</p>
<hr/>
<h3 data-id="heading-6">五、如何利用 typeof 判断变量是否存在？（推荐用法）</h3>
<h4 data-id="heading-7"><strong>通用写法</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> someVar !== <span class="hljs-string">"undefined"</span>) {
    <span class="hljs-comment">// 安全使用该变量</span>
}
</code></pre>
<h4 data-id="heading-8">示例：根据全局变量切换运行模式</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 若 globalConfig 存在，优先使用</span>
<span class="hljs-type">const</span> config = (typeof globalConfig !== <span class="hljs-string">"undefined"</span>)
    ? globalConfig
    : { debug: <span class="hljs-literal">false</span>, mode: <span class="hljs-string">"default"</span> };

console.<span class="hljs-built_in">log</span>(config);
</code></pre>
<p><strong>逐行解释：</strong></p>
<ul>
<li>安全检查变量是否声明</li>
<li>若存在则使用</li>
<li>若不存在不报错并使用默认配置</li>
</ul>
<hr/>
<h3 data-id="heading-9">六、不要使用 try...catch 判断变量是否存在（反例）</h3>
<p>错误示例：</p>
<pre><code class="hljs language-ini" lang="ini">let exists<span class="hljs-comment">;</span>

try {
    name<span class="hljs-comment">; // name 未声明</span>
    <span class="hljs-attr">exists</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
} catch {
    <span class="hljs-attr">exists</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
}
</code></pre>
<p>虽然可行，但效率低、不优雅，也不符合 JS 设计初衷。<br/>
<code>typeof</code> 才是官方推荐的方式。</p>
<hr/>
<h3 data-id="heading-10">七、对比：声明但值为 undefined 与未声明变量的区别</h3>
<h4 data-id="heading-11"><strong>1. 变量声明但未赋值</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">let</span> a;
<span class="hljs-keyword">typeof</span> a; <span class="hljs-comment">// "undefined"</span>
</code></pre>
<h4 data-id="heading-12"><strong>2. 根本未声明变量</strong></h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">typeof</span> <span class="hljs-selector-tag">b</span>; <span class="hljs-comment">// "undefined" —— 不报错</span>
<span class="hljs-selector-tag">b</span>;        <span class="hljs-comment">// ReferenceError —— 报错</span>
</code></pre>
<p>表格区分：</p>




















<table><thead><tr><th>情况</th><th>typeof 结果</th><th>直接访问</th></tr></thead><tbody><tr><td>已声明但未赋值</td><td>"undefined"</td><td>值为 undefined</td></tr><tr><td>未声明变量</td><td>"undefined"</td><td>ReferenceError</td></tr></tbody></table>
<p>因此，<strong>只有 typeof 能区分安全访问与直接访问的区别</strong>。</p>
<hr/>
<h3 data-id="heading-13">八、再扩展：检测全局变量的另一种安全方式</h3>
<p>在浏览器全局作用域中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-string">"Vue"</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Vue 已加载"</span>);
}
</code></pre>
<p>但是此方法不能判断局部变量是否存在，因此<br/>
<strong>typeof 是最万能、适用所有作用域的方式</strong>。</p>
<hr/>
<h3 data-id="heading-14">九、潜在问题与注意事项</h3>
<h4 data-id="heading-15">❌ 不要用 typeof null 判断对象类型</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">typeof</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// "object" —— 历史遗留 bug</span>
</code></pre>
<h4 data-id="heading-16">❌ typeof 不能判断变量是否已初始化（TDZ 问题）</h4>
<p>在 ES6 的块级作用域中：</p>
<pre><code class="hljs language-ini" lang="ini">console.log(typeof x)<span class="hljs-comment">; // ❌ ReferenceError (在 TDZ 中)</span>
let <span class="hljs-attr">x</span> = <span class="hljs-number">10</span><span class="hljs-comment">;</span>
</code></pre>
<p>只有<strong>完全未声明</strong>才不会报错。</p>
<h4 data-id="heading-17">❌ delete 不适合作为变量存在性检查</h4>
<p><code>delete</code> 的语义是删除属性，不是检测变量，也不保证跨作用域一致性。</p>
<hr/>
<h2 data-id="heading-18">十、总结要点</h2>
<ul>
<li><code>typeof</code> 永远不会因为未声明变量而报错</li>
<li>它是 <strong>唯一安全判断变量是否存在的方式</strong></li>
<li><code>delete</code> 删除不存在的变量在非严格模式下不报错</li>
<li>推荐检查变量存在性的方式：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> someVar !== <span class="hljs-string">"undefined"</span>) {
    <span class="hljs-comment">// safe</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-19">完整示例：可直接运行</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkVar</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// 安全探测变量是否存在</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>[name] !== <span class="hljs-string">"undefined"</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`变量 <span class="hljs-subst">${name}</span> 存在，值为：`</span>, <span class="hljs-variable language_">window</span>[name]);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`变量 <span class="hljs-subst">${name}</span> 不存在`</span>);
    }
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-title function_">checkVar</span>(<span class="hljs-string">"abc"</span>);  <span class="hljs-comment">// 未声明变量，不报错</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">abc</span> = <span class="hljs-number">123</span>;
<span class="hljs-title function_">checkVar</span>(<span class="hljs-string">"abc"</span>);  <span class="hljs-comment">// 变量已经存在</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">✨ 本文结语</h2>
<p>本文部分内容借助 AI 辅助生成，并由作者整理审核。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧭 2025 年「大前端 Monorepo 架构」最佳实践指南]]></title>    <link>https://juejin.cn/post/7581676787380928531</link>    <guid>https://juejin.cn/post/7581676787380928531</guid>    <pubDate>2025-12-10T01:54:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787380928531" data-draft-id="7581738974424498195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧭 2025 年「大前端 Monorepo 架构」最佳实践指南"/> <meta itemprop="keywords" content="前端,前端框架,前端工程化"/> <meta itemprop="datePublished" content="2025-12-10T01:54:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧭 2025 年「大前端 Monorepo 架构」最佳实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:54:43.000Z" title="Wed Dec 10 2025 01:54:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧩 一、为什么 2025 年还在谈 Monorepo？</h2>
<blockquote>
<p>“因为我们不只是写页面，我们在协调宇宙。”</p>
</blockquote>
<h3 data-id="heading-1">🌈 背景演进：</h3>
<ul>
<li><strong>2018 以前</strong>：前端项目分散，每个 repo 都是一个孤岛 🏝️。</li>
<li><strong>2019–2022</strong>：组件库复用开始流行，人们引入 Lerna / Yarn Workspaces。</li>
<li><strong>2023–2024</strong>：微前端 + PNPM Workspaces 成为主流，TurboRepo、Nx 攻城略地。</li>
<li><strong>2025</strong>：AI 自动化、CI/CD 智能化、跨端构建统一化的时代。<br/>
👉 一个 repo 管理多个平台，已经不只是趋势，而是刚需。</li>
</ul>
<p>举例，一个现代公司可能有以下前端资产：</p>
<pre><code class="hljs language-bash" lang="bash">/apps
  ├── web-admin-dashboard
  ├── mobile-react-native-app
  ├── desktop-electron-shell
/packages
  ├── ui-components
  ├── utils
  ├── config
  ├── shared-apis
/tools
  ├── scripts
  └── ai-automation
</code></pre>
<p>这些项目耦合而不乱，各自独立又共享底层逻辑。<br/>
一个提交，影响多个生态。让工程协同像调交响乐一样优雅 🎻。</p>
<hr/>
<h2 data-id="heading-2">🏗️ 二、核心理念：依赖统一 · 构建分层 · 模块自治</h2>
<p>要设计一个面向未来的 Monorepo，我们得明确三大原则：</p>
<h3 data-id="heading-3">1. <strong>依赖统一（Unified Dependency Graph）</strong></h3>
<p>使用 <code>pnpm</code> 或 <code>yarn berry</code> 实现 workspace 的扁平依赖管理。<br/>
核心思想是：</p>
<blockquote>
<p>所有模块共享依赖声明，但只在本地建立“引用符号链接”，避免重复安装。</p>
</blockquote>
<p><strong>推荐配置：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">init</span>
pnpm install -w
pnpm <span class="hljs-keyword">add</span> typescript eslint prettier -w
</code></pre>
<p><code>package.json</code> 的结构 👇：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@company/monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"apps/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"packages/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.8.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"turbo"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.0.1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">2. <strong>构建分层（Layered Build System）</strong></h3>
<p>在 2025 年，你可以让 <strong>单个命令自动调度依赖构建链</strong> 💥。</p>
<p>例如使用 <strong>Turborepo</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># turbo.json</span>
{
  <span class="hljs-string">"<span class="hljs-variable">$schema</span>"</span>: <span class="hljs-string">"https://turborepo.org/schema.json"</span>,
  <span class="hljs-string">"pipeline"</span>: {
    <span class="hljs-string">"build"</span>: {
      <span class="hljs-string">"dependsOn"</span>: [<span class="hljs-string">"^build"</span>],
      <span class="hljs-string">"outputs"</span>: [<span class="hljs-string">"dist/**"</span>]
    },
    <span class="hljs-string">"lint"</span>: {},
    <span class="hljs-string">"dev"</span>: {
      <span class="hljs-string">"cache"</span>: <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<p>在任意子项目执行：</p>
<pre><code class="hljs language-arduino" lang="arduino">pnpm turbo run build
</code></pre>
<p>Turbo 会自动：</p>
<ul>
<li>跳过未变更模块；</li>
<li>并行执行独立任务；</li>
<li>缓存产物到远端（甚至可以进入 AI 编译缓存阶段，调用云 API 提速）。</li>
</ul>
<p>AI 实际用这种模式可在 30 秒内构建一个百模块前端仓库 🚀。</p>
<hr/>
<h3 data-id="heading-5">3. <strong>模块自治（Autonomous Module Design）</strong></h3>
<p>每个子包（package）应该自包含：</p>
<ul>
<li>自己的依赖；</li>
<li><code>tsconfig.json</code>;</li>
<li>测试与构建脚本；</li>
<li>与主仓库 ESLint、Prettier 一致的约束。</li>
</ul>
<p>例如 <code>/packages/ui-components/package.json</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@company/ui-components"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsup src/index.ts --dts"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"vitest"</span>
  }
}
</code></pre>
<p>它既能作为独立 npm 包发布，也能被内部 app 实时引用。<br/>
这就是所谓 <strong>模块自治 + 内部共享生态</strong>。</p>
<hr/>
<h2 data-id="heading-6">🧠 三、灵魂武器：工具组合拳</h2>













































<table><thead><tr><th>工具</th><th>职责</th><th>备注</th></tr></thead><tbody><tr><td><strong>PNPM Workspaces</strong></td><td>快速管理多项目依赖</td><td>替代 Yarn Workspaces</td></tr><tr><td><strong>TurboRepo / Nx</strong></td><td>构建和缓存调度</td><td>Turbo 更轻量，Nx 更企业级</td></tr><tr><td><strong>ESBuild / Vite</strong></td><td>开发与构建</td><td>统一构建接口</td></tr><tr><td><strong>TypeScript Project References</strong></td><td>跨包 TS 类型共享</td><td>VSCode 智能推导</td></tr><tr><td><strong>Vitest / Playwright</strong></td><td>单元与端到端测试</td><td>一体化测试方案</td></tr><tr><td><strong>Changesets</strong></td><td>自动版本与发布日志管理</td><td>💡 Monorepo 宝藏</td></tr><tr><td><strong>AI Assistant (自研)</strong></td><td>自动生成 CI 配置、Doc 与代码检查</td><td>2025 新趋势！🤖</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">⚡ 四、实际项目结构：带电的架构树</h2>
<pre><code class="hljs language-csharp" lang="csharp">company-monorepo/
│
├── apps/
│   ├── web-dashboard/
│   │   ├── src/
│   │   ├── vite.config.ts
│   │   └── package.json
│   ├── mobile-rn/
│   └── electron-shell/
│
├── packages/
│   ├── ui-kit/
│   ├── hooks/
│   ├── api/
│   ├── config/
│   └── shared-types/
│
├── .husky/              <span class="hljs-meta"># 提交钩子</span>
├── turbo.json           <span class="hljs-meta"># 构建管控</span>
├── pnpm-workspace.yaml
└── tsconfig.<span class="hljs-keyword">base</span>.json
</code></pre>
<hr/>
<h2 data-id="heading-8">🧬 五、从零搭建命令摘要</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化 monorepo 框架</span>
pnpm init
pnpm install -D turbo typescript eslint prettier

<span class="hljs-comment"># 初始化构建缓存与脚本</span>
npx turbo init

<span class="hljs-comment"># 新建 package 与 app</span>
pnpm create vite apps/web-dashboard --template react-ts
pnpm create package packages/ui-kit

<span class="hljs-comment"># 关联开发</span>
pnpm add @company/ui-kit -F @company/web-dashboard
</code></pre>
<p>💡 <strong>Tip：</strong><br/>
使用 <code>-F</code> 指定 workspace，能保证关联时版本精准，不会“拉最新”。</p>
<hr/>
<h2 data-id="heading-9">🧑‍💻 六、2025 年的前端 CI/CD 革命</h2>
<p><strong>AI 工程辅助 + 云缓存 = Monorepo 飞起</strong></p>
<p>建议在 CI 管线中加入 AI 审查逻辑，例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/build.yml</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">turbo</span> <span class="hljs-string">run</span> <span class="hljs-string">lint</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npx</span> <span class="hljs-string">ai-cli</span> <span class="hljs-string">check</span> <span class="hljs-string">code-quality</span> <span class="hljs-string">--mode</span> <span class="hljs-string">deep</span>
</code></pre>
<p>AI 可在此阶段执行：</p>
<ul>
<li>智能依赖剔除；</li>
<li>构建速度预测；</li>
<li>commit 语义检查；</li>
<li>自动修复潜在的"循环引用"问题。</li>
</ul>
<p>让代码像 Ferrari 一样流畅上路 🏎️。</p>
<hr/>
<h2 data-id="heading-10">🧘 七、哲学总结：Monorepo ≠ 巨大代码仓库</h2>
<p>Monorepo 不是“代码都堆一起”，而是：</p>
<blockquote>
<p>“一个逻辑上的星系，每个模块都是一颗恒星。”</p>
</blockquote>
<p>它的灵魂是<strong>统一协作、共享生态、分层构建、智能管理</strong>。<br/>
当你配合 AI 工具链、云缓存、项目引用机制，<br/>
整个前端团队的效率，将比肩量子传送般顺畅 ⚛️。</p>
<hr/>
<h2 data-id="heading-11">🪄 结语：2025，前端工程师的蜕变</h2>
<p>未来的前端不止是写 UI，而是建造整个信息生态的“系统工程”。</p>
<p>Monorepo 是这场蜕变的土壤；<br/>
AI 是新一代的开发同事；<br/>
而工程师，则是架构的诗人。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每日一个C++知识点|多线程基础]]></title>    <link>https://juejin.cn/post/7581693431740350527</link>    <guid>https://juejin.cn/post/7581693431740350527</guid>    <pubDate>2025-12-09T16:47:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740350527" data-draft-id="7581678032336961578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每日一个C++知识点|多线程基础"/> <meta itemprop="keywords" content="编程语言,C++"/> <meta itemprop="datePublished" content="2025-12-09T16:47:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="图形学爱好者_Wu"/> <meta itemprop="url" content="https://juejin.cn/user/1060359067408631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每日一个C++知识点|多线程基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1060359067408631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    图形学爱好者_Wu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T16:47:54.000Z" title="Tue Dec 09 2025 16:47:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>多线程开发场景基本是每一个C++开发工程师无法避免的场景,今天就带大家从零基础入门C++多线程编程,掌握其中的基础用法、锁管理工具和条件变量的内容</p>
<h2 data-id="heading-0">多线程的认识</h2>
<p>多线程就是一个程序内部运行多个任务,每个任务就是一个线程,充分利用CPU的资源,提高效率的技术</p>
<p>在多个线程中,作为程序入口的线程称为<code>主线程</code>,由主线程创建负责独立执行细分任务的线程称为<code>子线程</code></p>
<h2 data-id="heading-1">实现依赖</h2>
<p>在C++中想使用多线程技术,就要引入头文件<code>&lt;thread&gt;</code></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
</code></pre>
<h2 data-id="heading-2">线程创建基本流程</h2>
<p>首先要定义线程要执行的任务函数,然后要通过<code>std::thread</code>实例化线程对象并且绑定该任务函数,最后调用<code>join()</code>函数或者<code>detach()</code>函数</p>
<p>其中<code>join()</code>来阻塞主线程,等待子线程执行完毕;<code>detach()</code>来将主线程和子线程分离</p>
<p>代码示例如下</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>

<span class="hljs-comment">// 子线程任务函数</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">task</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> </span>{
    cout &lt;&lt; <span class="hljs-string">"子线程执行任务，传入参数："</span> &lt;&lt; num &lt;&lt; endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 实例化thread对象并绑定任务，传入参数5</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(task, <span class="hljs-number">5</span>)</span></span>;
    
    <span class="hljs-comment">// 阻塞主线程，等待子线程执行完成</span>
    t.<span class="hljs-built_in">join</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"主线程继续执行"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>为什么要调用<code>join(</code>或<code>detach()</code>函数呢,如果不调用线程在对象析构时会触发程序异常终止</p>
<h2 data-id="heading-3">互斥锁</h2>
<p>当多个线程访问同一块共享内存时,会出现数据读写混乱的情况,这就是竞态条件,为了解决这个问题,可以采用互斥锁<code>std::mutex</code></p>
<p><code>std::mutex</code>的核心接口是<br/>
<code>lock()</code>,<code>unlock()</code>,<code>try_lock()</code></p>
<p><code>lock()</code>给互斥锁加锁，若锁已被其他线程持有，则当前线程会阻塞，直到获取到锁,必须确保只有持<code>unlock()</code>是释放锁,确保只有持有锁的线程才能调用,<code>try_lock()</code>是尝试加锁，成功返回true，失败返回false，不会阻塞当前线程</p>
<p>代码示例</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::mutex mtx;  <span class="hljs-comment">// 定义全局互斥锁</span>
<span class="hljs-type">int</span> shared_counter = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 共享资源</span>

<span class="hljs-comment">// 子线程任务：对共享计数器进行累加</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment_counter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        mtx.<span class="hljs-built_in">lock</span>();  <span class="hljs-comment">// 加锁，进入临界区</span>
        shared_counter++;
        mtx.<span class="hljs-built_in">unlock</span>();  <span class="hljs-comment">// 解锁，退出临界区</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(increment_counter)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(increment_counter)</span></span>;

    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();

    std::cout &lt;&lt; <span class="hljs-string">"最终计数器值："</span> &lt;&lt; shared_counter &lt;&lt; std::endl;  <span class="hljs-comment">// 预期输出2000</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>互斥锁虽然可以解决竞态条件问题,但需要需手动调用<code>lock()</code>和<code>unlock()</code>,若临界区代码抛出异常，会导致unlock()无法执行，进而引发死锁,而且多锁场景下，若加锁顺序不一致，极易出现死锁问题,操作难度太大,因而就有了让互斥锁更安全灵活的<code>锁管理工具</code></p>
<h2 data-id="heading-4">锁管理工具</h2>
<p>锁管理工具主要有三种:分别是<code>守卫锁</code>,<code>唯一锁</code>,<code>作用域锁</code></p>
<h3 data-id="heading-5">std::lock_guard（守卫锁）</h3>
<p><code>std::lock_guard</code>是最轻量化的<code>RAII 锁管理工具</code>,构造时自动调用<code>lock()</code>加锁，析构时自动调用<code>unlock()</code>解锁</p>
<p>适用于简单的临界区资源保护，无需手动控制加解锁时机,以下是代码示例:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::mutex mtx;
<span class="hljs-type">int</span> shared_num = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_num</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 构造lock_guard时自动加锁</span>
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
    shared_num++;
    std::cout &lt;&lt; <span class="hljs-string">"当前共享变量值："</span> &lt;&lt; shared_num &lt;&lt; std::endl;
    <span class="hljs-comment">// 函数结束，lock_guard析构自动解锁，即使中途抛异常也能正常解锁</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(add_num)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(add_num)</span></span>;
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-6">std::unique_lock（唯一锁）</h3>
<p><code>std::unique_lock</code>是最灵活的<code> RAII 锁管理工具</code>，支持手动加解锁、超时等待、延迟加锁等操作,并且可配合条件变量使用</p>
<p>适用于复杂的锁控制场景，需要灵活调整加解锁时机,代码示例如下:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::mutex mtx;
<span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">task</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx, std::defer_lock)</span></span>; <span class="hljs-comment">// 延迟加锁，构造时不自动加锁</span>
    <span class="hljs-comment">// 手动加锁</span>
    lock.<span class="hljs-built_in">lock</span>();
    count += <span class="hljs-number">5</span>;
    std::cout &lt;&lt; <span class="hljs-string">"count更新为："</span> &lt;&lt; count &lt;&lt; std::endl;
    <span class="hljs-comment">// 手动解锁</span>
    lock.<span class="hljs-built_in">unlock</span>();
    
    <span class="hljs-comment">// 可再次加锁</span>
    lock.<span class="hljs-built_in">lock</span>();
    count += <span class="hljs-number">3</span>;
    std::cout &lt;&lt; <span class="hljs-string">"count最终值："</span> &lt;&lt; count &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(task)</span></span>;
    t.<span class="hljs-built_in">join</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-7">std::scoped_lock（作用域锁）</h3>
<p><code>std::scoped_lock</code>是专为多锁场景设计的<code>RAII管理工具</code>，能自动对传入的多个互斥锁排序加锁，从根源杜绝多锁死锁问题</p>
<p>适用于需要同时获取多个互斥锁的场景,代码示例如下:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::mutex mtx1, mtx2;
<span class="hljs-type">int</span> data1 = <span class="hljs-number">0</span>, data2 = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_data</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 自动对mtx1、mtx2排序加锁，避免死锁</span>
    <span class="hljs-function">std::scoped_lock <span class="hljs-title">lock</span><span class="hljs-params">(mtx1, mtx2)</span></span>;
    data1++;
    data2++;
    std::cout &lt;&lt; <span class="hljs-string">"data1="</span> &lt;&lt; data1 &lt;&lt; <span class="hljs-string">"，data2="</span> &lt;&lt; data2 &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(update_data)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(update_data)</span></span>;
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-8">条件变量</h2>
<p><code>std::condition_variable</code>（条件变量）是 C++ 多线程中实现线程阻塞等待的核心工具，它允许线程阻塞至特定条件满足后再被唤醒，避免了 “忙等” 带来的 CPU 资源浪费</p>
<h3 data-id="heading-9">核心特性</h3>
<p><strong>阻塞等待</strong>：线程调用<code>wait()</code>后会释放持有的互斥锁，进入阻塞状态，直到被其他线程唤醒</p>
<p><strong>唤醒机制</strong>：通过<code>notify_one()</code>唤醒一个等待线程，或<code>notify_all()</code>唤醒所有等待线程</p>
<p><strong>绑定互斥锁</strong>：必须配合<code>std::unique_lock&lt;std::mutex&gt;</code>使用，无法直接搭配其他锁</p>
<p><strong>虚假唤醒</strong>：即使未被主动唤醒，等待线程也可能被唤醒，因此需在循环中检查条件是否真的满足</p>
<p>适用于生产者 - 消费者模型：队列满或者空时让对应线程等待,线程池,多线程同步等待某个事件触发和超时等待场景等场景,代码示例如下:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>

std::queue&lt;<span class="hljs-type">int</span>&gt; task_queue;
std::mutex mtx;
std::condition_variable cv;

<span class="hljs-comment">// 生产者：往队列中添加任务</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">producer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        task_queue.<span class="hljs-built_in">push</span>(i);
        std::cout &lt;&lt; <span class="hljs-string">"生产者生产任务："</span> &lt;&lt; i &lt;&lt; std::endl;
        lock.<span class="hljs-built_in">unlock</span>();
        <span class="hljs-comment">// 唤醒一个消费者线程</span>
        cv.<span class="hljs-built_in">notify_one</span>();
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">500</span>));
    }
}

<span class="hljs-comment">// 消费者：从队列中取任务执行</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">consumer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        <span class="hljs-comment">// 循环检查条件，避免虚假唤醒</span>
        cv.<span class="hljs-built_in">wait</span>(lock, []{ <span class="hljs-keyword">return</span> !task_queue.<span class="hljs-built_in">empty</span>(); });
        
        <span class="hljs-type">int</span> task = task_queue.<span class="hljs-built_in">front</span>();
        task_queue.<span class="hljs-built_in">pop</span>();
        std::cout &lt;&lt; <span class="hljs-string">"消费者执行任务："</span> &lt;&lt; task &lt;&lt; std::endl;
        lock.<span class="hljs-built_in">unlock</span>();
        
        <span class="hljs-keyword">if</span> (task == <span class="hljs-number">5</span>) <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 任务执行完毕退出</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">prod</span><span class="hljs-params">(producer)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">cons</span><span class="hljs-params">(consumer)</span></span>;
    
    prod.<span class="hljs-built_in">join</span>();
    cons.<span class="hljs-built_in">join</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p><code>多线程</code>是通过在程序中创建多个线程,并且结合<code>互斥锁</code>以及<code>锁管理工具</code>和<code>条件变量</code>来实现CPU利用效率的提高,在短时间内跑完多个任务的技术,是我们每个C++程序员绕不开的技术</p>
<p>觉得文章对您有帮助的话可以点赞关注,我将会持续分享高质量的内容~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于SpreadJS的协同填报应用 | 葡萄城技术团队]]></title>    <link>https://juejin.cn/post/7581741663183323171</link>    <guid>https://juejin.cn/post/7581741663183323171</guid>    <pubDate>2025-12-10T01:54:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581741663183323171" data-draft-id="7581741663183306787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于SpreadJS的协同填报应用 | 葡萄城技术团队"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T01:54:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="葡萄城技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868332765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于SpreadJS的协同填报应用 | 葡萄城技术团队
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868332765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    葡萄城技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:54:26.000Z" title="Wed Dec 10 2025 01:54:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于SpreadJS的协同填报应用</h2>
<h3 data-id="heading-1">协同电子表格带来的效率革命</h3>
<p>在数字化转型的浪潮中，企业对高效协作和数据处理的需求日益增长。以 Microsoft 365、飞书多维表格等为代表的协同电子表格工具，凭借其实时编辑、多方共享的特性，极大地革新了传统基于本地Excel分享的工作模式。</p>
<p>协同电子表格的普及，显著提升了日常办公的效率，它成功解决了以下关键问题：</p>
<ul>
<li>文件版本混乱问题： 彻底告别“最终版-最终版-最终版-v2”的困境，保证所有参与者始终在同一个最新的文档上工作。</li>
<li>数据孤岛与传输延迟： 实现了数据的集中管理和实时同步，从而无需通过邮件或即时通讯工具反复发送文件，有效加快了业务流转速度。</li>
<li>基础协作门槛高： 提供了在线评论、权限管理等功能，让团队协作更加便捷和透明。</li>
</ul>
<h3 data-id="heading-2">传统协同电子表格在企业级填报场景的局限性</h3>
<p>尽管主流协同电子表格在通用协作方面表现出色，但在企业级数据填报这一核心场景中，其局限性也日益凸显：</p>
<ol>
<li><strong>数据安全与私有化挑战</strong>： 大多采用SaaS模式，难以满足金融、政府等行业对核心业务数据进行私有化部署和保证严格安全合规的要求。</li>
<li><strong>系统集成度低</strong>： 缺乏作为底层组件嵌入企业现有 ERP、OA 等业务系统的能力，导致数据在应用间形成“数据烟囱”。</li>
<li><strong>高昂的部署成本</strong>： 商业协同工具的私有化版本通常费用高昂，且定制化难度大，维护成本高。</li>
<li><strong>数据交互受限</strong>： 难以灵活地进行结构化数据的提取和回写，阻碍了表格数据与企业数据库之间的无缝连接。</li>
</ol>
<h3 data-id="heading-3">SpreadJS 协同插件：专为企业级协同填报设计的解决方案</h3>
<p>SpreadJS的协同能力并非简单的“黑盒”功能，而是采用了多层、解耦的中间件架构。这种架构设计赋予了企业极高的部署灵活性和定制化空间。</p>
<ul>
<li>灵活的私有化部署方式，可选择将协同服务和业务系统共同部署，也可部署独立的微服务，通过API为多个业务系统提供填报协作能力，并支持docker、负载均衡等技术。</li>
<li>多层次的定制化空间，从前端页面、冲突处理到用户鉴权，数据存储等各个环节，均可以通过中间件的方式二开处理，从而开发满足个性化需求的系统。</li>
</ul>
<p>例如SpreadJS协同文档服务不仅支持自定义数据库配置，同时可配置快照存取规则，同时也可以使用use中间件和on注册钩子自定义处理逻辑注册中间件和on注册钩子自定义处理逻辑，在自定义逻辑中记录额外日志或者添加业务相关操作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59e473dda7dd401b91084630c203ecc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936465&amp;x-signature=X0ozP0KAWjcN2zXaShvJzKbNwiI%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-4">基于“数据区域管理器”实现业务解耦</h3>
<p>在协同填报场景中，一个核心挑战是如何既支持业务数据的按权限展示填报，又可以实现文档的多人共享协同操作。SpreadJS的数据区域管理器（Data Range Provider）可以结合协同插件共同解决这个问题。</p>
<ul>
<li>独立的数据区域，SpreadJS可以在客户端创建客户独享的“数据区域”，结合业务、用户权限单独对区域进行配置，实现每个用户拥有个性化的表格。</li>
<li>业务数据和文档分离，通过数据区域指定业务数据，使这些业务数据可以通过数据区域与业务系统同步，而其他区域内容则有协同服务来处理</li>
<li>业务与协同解耦，大大简化了系统设计的复杂度，无需考虑如何从协同的文档中抽取业务数据。</li>
</ul>
<p>在填报数据区域内，每个客户端可独立控制数据区域内的数据存取校验、单元格样式以及编辑权限等电子表格特性，当校验通过或存储成功后，交由协同层同步。区域以外由协同层直接同步共享。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b65d5ebeb61341fca1d5d958ea44d2e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936465&amp;x-signature=mEwXh7nJns4EeV1T02Tfkvx9XOI%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-5">总结：企业级协同填报新基座</h3>
<p>在数字化转型浪潮中，尽管传统协同电子表格提升了日常办公效率 ，但 SpreadJS 通过组件化特性、多层解耦的中间件架构，特别是独有的“数据区域管理器”，成功弥补了主流工具在企业级应用中的局限 。该方案支持灵活的私有化部署，满足金融、政府等行业对核心业务数据的严格安全合规要求 。同时，它允许作为底层组件嵌入企业现有系统，打破了系统集成度低的挑战 ，并实现了业务数据与文档内容的分离，有效解决业务与协同的解耦问题 。最终，SpreadJS 为企业提供了一个强大、灵活且安全的新基座，赋能企业级数据协作新模式 。</p>
<h3 data-id="heading-6">扩展链接</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.grapecity.com.cn%2Fblogs%2Fwhy-exactly-do-excel-files-get-corrupted-in-depth-ooxml-underlying-principles-and-practical-repair-strategies" target="_blank" title="https://www.grapecity.com.cn/blogs/why-exactly-do-excel-files-get-corrupted-in-depth-ooxml-underlying-principles-and-practical-repair-strategies" ref="nofollow noopener noreferrer">硬核干货 | Excel 文件到底是怎么坏掉的？深入 OOXML 底层原理讲解修复策略</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[订单超时取消机制中的重复取消问题]]></title>    <link>https://juejin.cn/post/7581727073580990515</link>    <guid>https://juejin.cn/post/7581727073580990515</guid>    <pubDate>2025-12-10T00:50:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581727073580990515" data-draft-id="7579920818871615530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="订单超时取消机制中的重复取消问题"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-10T00:50:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uup"/> <meta itemprop="url" content="https://juejin.cn/user/4378706456356627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            订单超时取消机制中的重复取消问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378706456356627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:50:51.000Z" title="Wed Dec 10 2025 00:50:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Bug 场景</h2>
<p>在一个电商系统中，订单创建后若 30 分钟未支付则自动取消。系统采用两种方式处理超时订单：① 定时任务（每 5 分钟扫描一次未支付订单，执行取消逻辑）；② 基于 Redis 过期键通知（订单创建时在 Redis 中设置 30 分钟过期键，过期时触发取消回调）。但实际运行中发现，部分订单被重复取消，导致库存回滚多次，出现库存异常。</p>
<h2 data-id="heading-1">二、代码示例</h2>
<h3 data-id="heading-2">定时任务取消订单</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@EnableScheduling</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeoutSchedule</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-comment">// 每5分钟执行一次</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0/5 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelTimeoutOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 查询30分钟前未支付的订单</span>
        List&lt;Order&gt; timeoutOrders = orderService.queryUnpaidOrdersBefore(LocalDateTime.now().minusMinutes(<span class="hljs-number">30</span>));
        <span class="hljs-keyword">for</span> (Order order : timeoutOrders) {
            <span class="hljs-comment">// 执行取消订单逻辑（扣减的库存回滚）</span>
            orderService.cancelOrder(order.getId());
        }
    }
}
</code></pre>
<h3 data-id="heading-3">Redis 过期通知取消订单</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisKeyExpireListener</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 订阅Redis过期键通知</span>
        redisTemplate.getConnectionFactory().getConnection().subscribe(
            message -&gt; {
                <span class="hljs-comment">// 消息内容为过期的键名，格式：order:timeout:{orderId}</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">expiredKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());
                <span class="hljs-keyword">if</span> (expiredKey.startsWith(<span class="hljs-string">"order:timeout:"</span>)) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> expiredKey.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">2</span>];
                    <span class="hljs-comment">// 执行取消订单逻辑</span>
                    orderService.cancelOrder(Long.parseLong(orderId));
                }
            },
            <span class="hljs-string">"__keyevent@0__:expired"</span>.getBytes()
        );
    }
}
</code></pre>
<h3 data-id="heading-4">订单服务（取消订单逻辑）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;

    <span class="hljs-comment">/**
     * 取消订单（回滚库存）
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span> || order.getStatus() != <span class="hljs-number">0</span>) { <span class="hljs-comment">// 0-未支付</span>
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// 1. 更新订单状态为取消</span>
        order.setStatus(<span class="hljs-number">2</span>); <span class="hljs-comment">// 2-已取消</span>
        orderMapper.updateById(order);
        <span class="hljs-comment">// 2. 回滚商品库存</span>
        productMapper.increaseStock(order.getProductId(), order.getQuantity());
    }

    <span class="hljs-comment">// 其他方法：queryUnpaidOrdersBefore等</span>
}
</code></pre>
<h2 data-id="heading-5">三、问题描述</h2>
<ol>
<li>
<p><strong>预期行为</strong>：每个超时未支付的订单仅被取消一次，库存正确回滚一次。</p>
</li>
<li>
<p><strong>实际行为</strong>：部分订单被重复取消，导致库存多次回滚（例如，实际库存 10 件，订单购买 2 件，重复取消 3 次后库存变为 16 件）。原因如下：</p>
<ul>
<li><strong>定时任务与 Redis 通知冲突</strong>：同一订单既被定时任务扫描到，又触发了 Redis 过期通知，两种机制同时执行取消逻辑。</li>
<li><strong>定时任务内部并发</strong>：定时任务执行时，若处理时间过长，下一次任务提前启动（如前一次未执行完，新任务开始），导致同一批订单被重复处理。</li>
<li><strong>订单状态判断非原子</strong>：<code>cancelOrder</code> 方法中，“查询订单状态” 与 “更新状态” 非原子操作，高并发下可能多个线程同时通过状态检查，执行后续逻辑。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-6">四、解决方案</h2>
<ol>
<li>
<p><strong>统一超时取消入口</strong>：保留一种主要机制（如 Redis 过期通知），定时任务作为兜底，且兜底任务增加幂等性校验。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 定时任务优化：仅处理未被Redis通知处理的订单</span>
<span class="hljs-meta">@Scheduled(cron = "0 0/5 * * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelTimeoutOrders</span><span class="hljs-params">()</span> {
    List&lt;Order&gt; timeoutOrders = orderService.queryUnpaidOrdersBefore(LocalDateTime.now().minusMinutes(<span class="hljs-number">35</span>)); <span class="hljs-comment">// 比Redis过期时间晚5分钟，确保Redis已处理</span>
    <span class="hljs-keyword">for</span> (Order order : timeoutOrders) {
        orderService.cancelOrder(order.getId());
    }
}
</code></pre>
</li>
<li>
<p><strong>定时任务加分布式锁</strong>：防止任务并发执行，确保同一时间只有一个实例的定时任务在运行。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0/5 * * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelTimeoutOrders</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:order:cancel:schedule"</span>;
    <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES);
    <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(locked)) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 执行取消逻辑</span>
            List&lt;Order&gt; timeoutOrders = orderService.queryUnpaidOrdersBefore(LocalDateTime.now().minusMinutes(<span class="hljs-number">35</span>));
            <span class="hljs-keyword">for</span> (Order order : timeoutOrders) {
                orderService.cancelOrder(order.getId());
            }
        } <span class="hljs-keyword">finally</span> {
            redisTemplate.delete(lockKey);
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>订单状态更新原子化</strong>：通过 SQL 条件更新确保状态判断与更新的原子性，替代先查后更。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(Long orderId)</span> {
    <span class="hljs-comment">// 1. 原子更新订单状态（仅当状态为0时更新为2）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">updateRows</span> <span class="hljs-operator">=</span> orderMapper.updateStatusToCanceled(orderId);
    <span class="hljs-keyword">if</span> (updateRows == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 状态已变更，无需处理</span>
    }
    <span class="hljs-comment">// 2. 回滚库存（仅当状态更新成功时执行）</span>
    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
    productMapper.increaseStock(order.getProductId(), order.getQuantity());
}
</code></pre>
<p>对应的 SQL（OrderMapper.xml）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateStatusToCanceled"</span>&gt;</span>
    UPDATE `order` 
    SET status = 2, cancel_time = NOW() 
    WHERE id = #{orderId} AND status = 0
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jackson 3 迁移核心注意点总结]]></title>    <link>https://juejin.cn/post/7581727073580941363</link>    <guid>https://juejin.cn/post/7581727073580941363</guid>    <pubDate>2025-12-10T00:44:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581727073580941363" data-draft-id="7581666815002509363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jackson 3  迁移核心注意点总结"/> <meta itemprop="keywords" content="JSON,Java"/> <meta itemprop="datePublished" content="2025-12-10T00:44:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="闲煮光阴"/> <meta itemprop="url" content="https://juejin.cn/user/1523239911963420"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jackson 3  迁移核心注意点总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1523239911963420/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    闲煮光阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:44:30.000Z" title="Wed Dec 10 2025 00:44:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心要点（必掌握，迁移基础）</h2>
<p><strong>1. 环境基线升级：</strong> 最低支持 JDK 17（2.x 为 JDK 8），项目需先完成 JDK 升级适配。</p>
<p><strong>2. 包名与依赖变更：</strong></p>
<ul>
<li>Maven groupId：com.fasterxml.jackson → tools.jackson（jackson-annotations 除外，仍用 2.x 版本）Java 导入包：</li>
<li>com.fasterxml.jackson.xxx → tools.jackson.xxx（com.fasterxml.jackson.annotation 保留不变）</li>
</ul>
<p><strong>3. 核心 API 不可变性：</strong> ObjectMapper（及子类）、JsonFactory（及子类）变为完全不可变，必须通过 Builder 模式构建（不再支持直接 set 配置）。</p>
<pre><code class="hljs language-java" lang="java">JsonMapper m=JsonMapper.builder().build();
<span class="hljs-type">JsonFactory</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> JsonFactory.builder().build();
</code></pre>
<p><strong>4 .异常体系重构：</strong> 所有异常改为非检查型（继承 RuntimeException），核心异常类重命名（如 JsonProcessingException → JacksonException）。
<strong>5. 格式绑定强制化：</strong> 必须使用格式对齐的 ObjectMapper 子类（如 JsonMapper、YAMLMapper、XmlMapper），禁止 new ObjectMapper(new YAMLFactory()) 写法。
<strong>6. Java 8 模块内置：</strong> jackson-module-parameter-names、jackson-datatype-jdk8、jackson-datatype-jsr310 已整合到 jackson-databind，无需单独依赖。</p>
<h2 data-id="heading-1">二、关键变更（影响代码改造）</h2>
<p><strong>1. 内容移除</strong></p>
<ul>
<li>版本标记为 @Deprecated 的方法、字段、类全部删除（ 参考 2.20 javadoc 替换为替代方案）。</li>
<li>移除模块 jackson-module-jsonSchema 、jackson-datatype-hibernateX。</li>
<li>移除功能：格式自动检测（DataFormatDetector 等相关类）、ObjectMapper.canSerialize()/canDeserialize() 方法。</li>
<li>JsonParser <code>canWriteBinaryNatively(), canWriteFormattedNumbers() </code>分别替为 <code> StreamWriteCapability.CAN_WRITE_BINARY_NATIVELY  /  StreamWriteCapability.CAN_WRITE_FORMATTED_NUMBERS</code></li>
<li>JsonFactory  <code>getCodec() 、 setCodec()</code> 被移除</li>
<li>com.fasterxml.jackson.databind.MappingJsonFactory  被移除</li>
<li>com.fasterxml.jackson.core.ObjectCodec 被移除，替换为 2 个独立的接口：  tools.jackson.core.ObjectReadContext（实现类：DeserializationContext） ， tools.jackson.core.ObjectWriteContext（实现类：
SerializationContext ）</li>
<li>tools.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator 已不再公开。请使用  BasicPolymorphicTypeValidator.builder()</li>
<li>JsonGenerator.setPrettyPrinter() 被移除</li>
<li>request payload 能力被移除</li>
<li>BufferRecyclers.SYSTEM_PROPERTY_TRACK_REUSABLE_BUFFERS 被移除</li>
<li>TokenStreamFactory.Feature.USE_THREAD_LOCAL_FOR_BUFFER_RECYCLING 被移除</li>
<li>在 Jackson 2.x 的 JsonFactory 类中，接受 URL 参数的工厂方法将被移除</li>
</ul>
<p><strong>2. 类与方法重命名（高频变更）</strong></p>















































































































































<table><thead><tr><th>2.x 旧名称</th><th>3.x 新名称</th></tr></thead><tbody><tr><td>JsonProcessingException</td><td>JacksonException（基类）</td></tr><tr><td>JsonParseException</td><td>StreamReadException</td></tr><tr><td>JsonEOFException </td><td>UnexpectedEndOfInputException </td><td/><td>JsonGenerationException  </td><td>StreamWriteException </td></tr><tr><td>JsonGenerator.writeObject()</td><td>JsonGenerator.writePOJO()</td></tr><tr><td>JsonGenerator.getCurrentValue()</td><td>JsonGenerator.currentValue()</td><td/><td>JsonGenerator.setCurrentValue()</td><td>JsonGenerator.assignCurrentValue()</td></tr><tr><td>JsonGenerator.getCodec()</td><td>JsonGenerator.objectWriteContext()</td></tr><tr><td>JsonParser.getCurrentLocation()</td><td>JsonParser.currentLocation()</td></tr><tr><td>JsonParser.getTokenLocation()</td><td>JsonGenerator.currentTokenLocation()</td></tr><tr><td>JsonParser.getCurrentValue()</td><td>JsonParser.currentValue()</td></tr><tr><td>JsonParser.setCurrentValue()</td><td>JsonParser.assignCurrentValue()</td></tr><tr><td>JsonParser."xxxTextYyy"() 格式 如（getTextCharacters()）</td><td>JsonParser."xxxStringYyy"() 格式 如（getStringCharacters()）</td></tr><tr><td>JsonParser.getCodec()</td><td>JsonParser.objectReadContext()</td></tr><tr><td>JsonToken.FIELD_NAME</td><td>JsonToken.PROPERTY_NAME</td></tr><tr><td>JsonFactory </td><td>TokenStreamFactory </td></tr><tr><td>JsonStreamContext </td><td>TokenStreamContext </td></tr><tr><td>JsonLocation </td><td>TokenStreamLocation</td></tr><tr><td>JsonDeserializer</td><td>ValueDeserializer</td></tr><tr><td>JsonSerializer</td><td>ValueSerializer</td></tr><tr><td>JsonMappingException</td><td>DatabindException</td></tr><tr><td>Module</td><td>JacksonModule（避免与 JDK Module 冲突）</td></tr><tr><td>TextNode</td><td>StringNode</td></tr><tr><td>BeanSerializerModifier</td><td>ValueSerializerModifier</td></tr><tr><td>BeanDeserializerModifier</td><td>ValueDeserializerModifier</td></tr><tr><td>SerializerProvider </td><td>SerializationContext </td></tr><tr><td>TextNode</td><td>StringNode</td></tr><tr><td>AnnotationIntrospector.findDefaultCreator()</td><td>findPreferredCreator()</td></tr><tr><td>JsonNode.elements()</td><td>JsonNode.values()</td></tr><tr><td>ContainerSerializer</td><td>StdContainerSerializer</td></tr><tr><td>ObjectMapper.getRegisteredModuleIds()</td><td>ObjectMapper.registeredModules()</td></tr><tr><td>TreeNode.propertyNames()  的返回类型</td><td>从  Iterator  更改为  Collection</td></tr><tr><td>TreeNode.isContainerNode()</td><td>TreeNode. isContainer()</td></tr><tr><td>JsonGenerator.Feature.AUTO_CLOSE_JSON_CONTENT</td><td>JsonGenerator.Feature.AUTO_CLOSE_CONTENT</td></tr></tbody></table>
<p><strong>3. 配置默认值变更（易引发行为差异）</strong></p>




















































































































































































<table><thead><tr><th>枚举</th><th>配置项</th><th>2.x 默认值</th><th>3.x 默认值</th><th>影响说明</th></tr></thead><tbody><tr><td>DeserializationFeature</td><td>FAIL_ON_TRAILING_TOKENS</td><td>关闭</td><td>开启</td><td>校验 JSON 末尾是否存在多余字符（如解析对象后还有额外的逗号 / 字符），提升数据合法性校验，但会增加少量解析开销；若输入数据可信（如内部系统交互），可关闭以恢复 2.x 性能。</td></tr><tr><td/><td>FAIL_ON_UNKNOWN_PROPERTIES</td><td>开启</td><td>关闭</td><td>反序列化时遇到目标类不存在的字段，不再抛出 UnrecognizedPropertyException，而是直接忽略；可能掩盖字段名拼写错误、接口字段变更等问题，建议在测试环境开启该配置，生产环境按需关闭。</td></tr><tr><td/><td>READ_ENUMS_USING_TO_STRING</td><td>关闭</td><td>开启（迁移至 EnumFeature）</td><td>反序列化枚举时，默认按 Enum.toString() 结果匹配（2.x 默认按枚举名称 / 索引）；若枚举重写了 toString()，会改变反序列化逻辑，需确认枚举值映射规则，或显式配置 EnumFeature.READ_ENUMS_USING_TO_STRING=false 回退。</td></tr><tr><td/><td>FAIL_ON_NULL_FOR_PRIMITIVES</td><td>关闭</td><td>开启</td><td>反序列化时，若基本类型（int/long/boolean 等）字段接收到 null 值，会抛出 DatabindException；2.x 会默认赋值基本类型默认值（如 int=0），可能暴露空值处理漏洞，但也会导致原有依赖 “空值转默认值” 的代码报错。</td></tr><tr><td>SerializationFeature</td><td>WRITE_ENUMS_USING_TO_STRING</td><td>关闭</td><td>开启（迁移至 EnumFeature）</td><td>序列化枚举时，默认输出 Enum.toString() 结果（2.x 默认输出枚举名称）；若枚举重写了 toString()，序列化结果会变化，需统一枚举序列化规则，或配置 EnumFeature.WRITE_ENUMS_USING_TO_STRING=false。</td></tr><tr><td/><td>FAIL_ON_EMPTY_BEANS</td><td>开启</td><td>关闭</td><td>序列化无属性 / 无 getter 的空 Bean 时，不再抛出 JsonMappingException，而是输出空对象 {}；避免因 Bean 结构临时调整导致序列化失败，但需注意空对象可能不符合下游系统的解析预期。</td></tr><tr><td/><td>FAIL_ON_ORDER_MAP_BY_INCOMPARABLE_KEY</td><td>开启</td><td>关闭</td><td>序列化 SortedMap 时，若 Key 不实现 Comparable 接口，不再抛出异常；2.x 会强制校验 Key 的可比较性，3.x 放宽限制，但可能导致 Map 排序混乱，需确保 SortedMap 的 Key 符合 Comparable 规范。</td></tr><tr><td/><td>WRITE_DURATIONS_AS_TIMESTAMPS</td><td>开启</td><td>关闭（迁移至 DateTimeFeature）</td><td>序列化 java.time.Duration 时，默认输出 ISO-8601 字符串（如 PT1H30M），而非 2.x 的毫秒数时间戳；需确认下游系统是否兼容 Duration 的字符串格式，或配置 DateTimeFeature.WRITE_DURATIONS_AS_TIMESTAMPS=true 回退。</td></tr><tr><td/><td>WRITE_DATES_AS_TIMESTAMPS</td><td>开启</td><td>关闭（迁移至 DateTimeFeature）</td><td>序列化日期时间类型（如 LocalDateTime/Date）时，默认输出 ISO-8601 字符串（如 2025-12-09T10:00:00），而非 2.x 的毫秒时间戳；会改变接口返回的日期格式，需同步更新前端 / 下游系统的解析逻辑。</td></tr><tr><td/><td>WRITE_DATE_KEYS_AS_TIMESTAMPS</td><td>关闭</td><td>关闭（迁移至 DateTimeFeature）</td><td>无默认值变化，但配置项归属从 SerializationFeature 迁移至 DateTimeFeature；代码中需替换配置引用路径，否则会报 “配置项不存在” 错误。</td></tr><tr><td>StreamReadFeature</td><td>USE_FAST_DOUBLE_PARSER</td><td>关闭</td><td>开启</td><td>解析浮点数字段时使用更快的双精度解析器（基于 jdk.incubator.vector 或优化算法）；提升浮点数解析性能，但极端场景下可能存在精度差异（概率极低），需校验高精度浮点数据的解析结果。</td></tr><tr><td/><td>USE_FAST_BIG_NUMBER_PARSER</td><td>关闭</td><td>开启</td><td>解析大数字（如 BigDecimal/BigInteger）时使用优化解析器；提升大数字解析效率，无兼容性风险，但需确保解析后的大数精度符合业务要求。</td></tr><tr><td>StreamWriteFeature</td><td>USE_FAST_DOUBLE_WRITER</td><td>关闭</td><td>开启</td><td>序列化浮点数时使用更快的双精度写入器；提升浮点数字段序列化性能，极端场景可能存在小数位输出格式差异（如 0.1 变为 0.100000001），需校验金融 / 高精度场景的浮点输出。</td></tr><tr><td>TokenStreamFactory.Feature</td><td>INTERN_PROPERTY_NAMES</td><td>启用</td><td>关闭</td><td>不再对 JSON 属性名进行字符串驻留（String Intern）；减少内存占用（避免常量池膨胀），但频繁解析相同属性名的 JSON 时，会增加字符串创建开销，高并发场景可按需重新开启。</td></tr><tr><td>MapperFeature</td><td>USE_STD_BEAN_NAMING</td><td>关闭</td><td>移除（始终启用）</td><td>强制使用标准 JavaBean 命名规范（如 getXxx() 对应字段 xxx）；2.x 需手动开启，3.x 内置生效，若代码依赖非标准命名（如 getXXX() 对应 XXX），会导致字段序列化 / 反序列化失败。</td></tr><tr><td/><td>AUTO_DETECT_xxx（CREATORS/FIELDS/GETTERS/IS_GETTERS/SETTERS）</td><td>开启</td><td>移除</td><td>不再自动检测 Bean 的创建器 / 字段 / 访问器，需显式配置可见性规则；2.x 依赖自动检测的场景（如无注解的私有字段序列化）会失效，需通过 changeDefaultVisibility 配置字段 / 方法的可见性。</td></tr><tr><td/><td>ALLOW_FINAL_FIELDS_AS_MUTATORS</td><td>启用</td><td>关闭</td><td>禁止通过反射修改 final 字段的值；2.x 允许强制修改 final 字段（非规范行为），3.x 禁用后，依赖 “final 字段反序列化赋值” 的代码会报错，需改为通过构造器 / 工厂方法初始化 final 字段。</td></tr><tr><td/><td>DEFAULT_VIEW_INCLUSION</td><td>启用</td><td>关闭</td><td>未指定 @JsonView 时，不再默认序列化所有字段，仅序列化无 View 注解的字段；若代码依赖 “默认包含所有字段” 的逻辑，需显式配置 MapperFeature.DEFAULT_VIEW_INCLUSION=true，或补全 @JsonView 注解。</td></tr><tr><td/><td>USE_GETTERS_AS_SETTERS</td><td>启用</td><td>关闭</td><td>不再将 getXxx() 方法当作 setXxx() 使用（如反序列化集合字段时调用 getter 获取集合后添加元素）；2.x 为兼容 JAXB 的非规范行为，3.x 禁用后，需为集合 / 映射字段添加显式的 setter 方法。</td></tr><tr><td/><td>SORT_PROPERTIES_ALPHABETICALLY</td><td>关闭</td><td>开启</td><td>序列化 POJO 时默认按字段名字母排序输出；2.x 按字段定义顺序输出，3.x 改变输出顺序，可能导致依赖字段顺序的签名校验（如 MD5 验签）失败，需显式配置 @JsonPropertyOrder 固定顺序。</td></tr><tr><td/><td>OVERRIDE_PUBLIC_ACCESS_MODIFIERS</td><td>启用</td><td>关闭</td><td>不再覆盖公共字段 / 方法的访问修饰符（如强制访问 public final 方法）；2.x 可通过反射突破访问限制，3.x 禁用后，需确保 Bean 的字段 / 方法访问权限符合序列化要求（如 public getter）。</td></tr><tr><td>DateTimeFeature</td><td>ONE_BASED_MONTHS</td><td>关闭</td><td>开启</td><td>解析 / 序列化日期时，月份按 “1 基” 处理（1=1 月，12=12 月）；2.x 部分场景为 “0 基”（0=1 月），修复了月份解析的反直觉问题，但需校验老数据中 “0 基月份” 的兼容性（如 2025-00-09 会解析失败）。</td></tr><tr><td>StreamReadConstraints</td><td>DEFAULT_MAX_DEPTH</td><td>1000</td><td>500</td><td>JSON 嵌套解析的最大深度从 1000 降至 500；限制深层嵌套 JSON 的解析，防止栈溢出攻击，但解析超过 500 层的嵌套 JSON 时会抛出 StreamConstraintsException，需调整超大嵌套 JSON 的解析限制。</td></tr><tr><td>StreamWriteConstraints</td><td>DEFAULT_MAX_DEPTH</td><td>1000</td><td>500</td><td>JSON 嵌套序列化的最大深度从 1000 降至 500；序列化深层嵌套对象（如递归引用的对象）时会提前终止，需优化对象结构，或通过 StreamWriteConstraints.builder().maxDepth(1000) 调整限制。</td></tr></tbody></table>
<p><strong>4. 功能拆分与迁移</strong></p>
<ul>
<li><strong>流式 API 特性拆分：</strong> JsonParser.Feature → StreamReadFeature（通用）+ JsonReadFeature（JSON 专用）；
JsonGenerator.Feature → StreamWriteFeature + JsonWriteFeature（其他格式如 XML/YAML 同理）。</li>
<li><strong>迁移配置：</strong></li>
</ul>









































































































<table><thead><tr><th>属性/方法</th><th>原位置</th><th>迁移位置</th></tr></thead><tbody><tr><td>ADJUST_DATES_TO_CONTEXT_TIME_ZONE</td><td>DeserializationFeature  </td><td>DateTimeFeature</td></tr><tr><td>READ_DATE_TIMESTAMPS_AS_NANOSECONDS </td><td>DeserializationFeature  </td><td>DateTimeFeature</td></tr><tr><td>FAIL_ON_NUMBERS_FOR_ENUMS </td><td>DeserializationFeature  </td><td>EnumFeature </td></tr><tr><td>READ_ENUMS_USING_TO_STRING  </td><td>DeserializationFeature  </td><td>EnumFeature </td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_AS_NULL </td><td>DeserializationFeature  </td><td>EnumFeature </td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE </td><td>DeserializationFeature  </td><td>EnumFeature </td></tr><tr><td>WRITE_DATES_AS_TIMESTAMPS </td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_DATE_KEYS_AS_TIMESTAMPS</td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS</td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_DATES_WITH_CONTEXT_TIME_ZONE</td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_DURATIONS_AS_TIMESTAMPS</td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_DATES_WITH_ZONE_ID</td><td>SerializationFeature </td><td>DateTimeFeature</td></tr><tr><td>WRITE_ENUMS_USING_TO_STRING </td><td>SerializationFeature </td><td>EnumFeature </td></tr><tr><td>WRITE_ENUMS_USING_INDEX </td><td>SerializationFeature </td><td>EnumFeature </td></tr><tr><td>WRITE_ENUM_KEYS_USING_INDEX </td><td>SerializationFeature </td><td>EnumFeature </td></tr><tr><td>createContextual()</td><td>ContextualDeserializer </td><td>ValueDeserializer</td></tr><tr><td>createContextual()</td><td>ContextualSerializer  </td><td>ValueSerializer</td></tr><tr><td>resolve()</td><td>ResolvableDeserializer   </td><td>ValueDeserializer</td></tr><tr><td>resolve()</td><td>ResolvableSerializer    </td><td>ValueSerializer</td></tr></tbody></table>
<h2 data-id="heading-2">三、注意事项（避坑关键）</h2>
<p><strong>1. 依赖管理建议</strong></p>
<p>优先使用 jackson-bom 统一版本（避免 jackson-annotations 版本冲突）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>tools.jackson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
</code></pre>
<p>无需手动引入 jackson-core 和 jackson-annotations，jackson-databind 会自动传递依赖。</p>
<p><strong>2. 代码改造注意</strong></p>
<p><strong>ObjectMapper 构建：</strong> 必须用 Builder 模式，示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 3.x 正确写法</span>
<span class="hljs-type">JsonMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder()
    .enable(JsonWriteFeature.ESCAPE_NON_ASCII)
    .changeDefaultPropertyInclusion(incl -&gt; incl.withValueInclusion(JsonInclude.Include.NON_NULL))
    .build();

<span class="hljs-comment">// 重新配置已有 mapper（不可变对象无法直接修改）</span>
<span class="hljs-type">JsonMapper</span> <span class="hljs-variable">newMapper</span> <span class="hljs-operator">=</span> mapper.rebuild()
    .enable(SerializationFeature.INDENT_OUTPUT)
    .build();
</code></pre>
<p><strong>泛型类型校验：</strong> LaissezFaireSubTypeValidator 不再公开，需用 BasicPolymorphicTypeValidator 构建：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BasicPolymorphicTypeValidator</span> <span class="hljs-variable">validator</span> <span class="hljs-operator">=</span> BasicPolymorphicTypeValidator.builder()
    .allowIfSubType(<span class="hljs-string">"com.example"</span>)
    .build();
</code></pre>
<p><strong>日期格式/时区配置：</strong>
UTC 的默认形式现在尾部是 Z ，而不是像 2.x 版本中的  +00 。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//错误的方式</span>
mapper.setDateFormat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd'T'HH:mm:ssZ"</span>));
mapper.setTimeZone(TimeZone.getDefault());

<span class="hljs-comment">//正确的方式</span>
<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder()
.defaultDateFormat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd'T'HH:mm:ssZ"</span>))
.defaultTimeZone(TimeZone.getDefault())
.build();
</code></pre>
<p><strong>序列化配置：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//错误的方式</span>
mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);

<span class="hljs-comment">//正确的方式</span>
<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder()
  .changeDefaultPropertyInclusion(incl -&gt; incl.withValueInclusion(JsonInclude.Include.NON_NULL))
  .changeDefaultPropertyInclusion(incl -&gt; incl.withContentInclusion(JsonInclude.Include.NON_NULL))
  .build();

</code></pre>
<p><strong>可见性配置：</strong> MapperFeature.AUTO_DETECT_XXX 已移除，需通过 changeDefaultVisibility 配置：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//错误的方式</span>
mapper.disable(MapperFeature.AUTO_DETECT_FIELDS);

<span class="hljs-comment">//正确的方式</span>
<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder()
    .changeDefaultVisibility(vc -&gt;
        vc.withFieldVisibility(JsonAutoDetect.Visibility.NONE))
.build();

</code></pre>
<p><strong>包含类型信息配置：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//错误的方式</span>

mapper.activateDefaultTypingAsProperty(LaissezFaireSubTypeValidator.instance,
    ObjectMapper.DefaultTyping.NON_CONCRETE_AND_ARRAYS,
    <span class="hljs-string">"@class"</span>);
    
 <span class="hljs-comment">//正确的方式</span>
 
<span class="hljs-type">var</span> <span class="hljs-variable">typeValidator</span> <span class="hljs-operator">=</span> BasicPolymorphicTypeValidator.builder()
        .allowIfSubType(<span class="hljs-string">"my.package.base.name."</span>)
        .allowIfSubType(<span class="hljs-string">"java.util.concurrent."</span>)
        .allowIfSubTypeIsArray()
        <span class="hljs-comment">// ...</span>
        .build();
        
<span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder()
    .activateDefaultTypingAsProperty(typeValidator, DefaultTyping.NON_CONCRETE_AND_ARRAYS, <span class="hljs-string">"@class"</span>)
.build();
   
</code></pre>
<p><strong>JsonNode 处理中的 DecimalNode 创建策略</strong>
通过 JsonNodeFactory 创建 DecimalNode 时，旧行为：可能会自动截断尾随零（如 1.200 → 1.2）新行为：默认不截断尾随零，保持最小限度修剪</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例：不同的表示方式</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">value1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1.200"</span>);  <span class="hljs-comment">// 三位小数</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1.2"</span>);     <span class="hljs-comment">// 一位小数</span>

<span class="hljs-comment">// 新行为：DecimalNode会保持原始精度</span>
<span class="hljs-comment">// value1 仍会表示为 "1.200"</span>
<span class="hljs-comment">// value2 仍会表示为 "1.2"</span>
</code></pre>
<p><strong>Month 序列化/反序列化行为变更</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// java.time.Month 枚举</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Month</span> {
    JANUARY,    <span class="hljs-comment">// 1</span>
    FEBRUARY,   <span class="hljs-comment">// 2</span>
    <span class="hljs-comment">// ... </span>
    DECEMBER    <span class="hljs-comment">// 12</span>
}

<span class="hljs-comment">// Jackson 2.x 序列化结果（默认）</span>
{<span class="hljs-string">"month"</span>: <span class="hljs-string">"JANUARY"</span>}  <span class="hljs-comment">// 或使用索引：{"month": 0}</span>

<span class="hljs-comment">// Jackson 3.x 序列化结果（默认）</span>
{<span class="hljs-string">"month"</span>: <span class="hljs-number">1</span>}  <span class="hljs-comment">// 直接使用 Month 的数值（1-12）</span>
</code></pre>
<p><strong>3. 性能优化点</strong></p>
<p><strong>关闭末尾字符校验：</strong> 若输入数据可信，可禁用 FAIL_ON_TRAILING_TOKENS 减少开销：</p>
<pre><code class="hljs language-java" lang="java">JsonMapper.builder().disable(DeserializationFeature.FAIL_ON_TRAILING_TOKENS).build();
</code></pre>
<p><strong>缓冲区回收配置：</strong> 3.x 默认使用双端队列回收池，高并发场景可切换回 2.x 的 ThreadLocal 池：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-type">JsonFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> JsonFactory.builder() .recyclerPool(JsonRecyclerPools.threadLocalPool()) .build();
<span class="hljs-type">JsonMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> JsonMapper.builder(factory).build();
</code></pre>
<p><strong>4. 兼容性适配</strong></p>
<ul>
<li>若需保留 2.x 部分默认行为，可使用 JsonMapper.builderWithJackson2Defaults() 快速迁移（但无法覆盖所有配置）。</li>
<li>单元测试需重点检查：字段序列化顺序、日期格式、未知字段处理、枚举序列化方式等受默认配置变更影响的场景。</li>
</ul>
<p><strong>5. 生态支持</strong></p>
<ul>
<li>Spring 已在 2025.10 版本支持 Jackson 3.x（需升级 Spring 相关依赖）。</li>
<li>可使用 OpenRewrite 工具自动完成部分迁移（参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openrewrite.org%2Frecipes%2Fjava%2Fjackson%2Fupgradejackson_2_3%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="https://docs.openrewrite.org/recipes/java/jackson/upgradejackson_2_3%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">docs.openrewrite.org/recipes/jav…</a></li>
</ul>
<h2 data-id="heading-3">总结</h2>
<p>Jackson 3.x 迁移的核心是 <strong>“环境升级 + 依赖变更 + Builder 模式适配 + 废弃 API 替换”</strong>，关键在于处理包名、不可变对象构建和默认配置变更带来的兼容性问题。建议先升级 JDK 17，再通过依赖替换、代码批量改造（重点是 ObjectMapper 构建和异常处理）、单元测试验证逐步完成迁移，优先使用官方提供的 Builder 方法和兼容工具减少手动改造成本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day26 | Java集合框架概览]]></title>    <link>https://juejin.cn/post/7581691182004158474</link>    <guid>https://juejin.cn/post/7581691182004158474</guid>    <pubDate>2025-12-10T01:04:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581691182004158474" data-draft-id="7581698074362183689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day26 | Java集合框架概览"/> <meta itemprop="keywords" content="后端,Java,Java EE"/> <meta itemprop="datePublished" content="2025-12-10T01:04:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="懒惰蜗牛"/> <meta itemprop="url" content="https://juejin.cn/user/615342556327752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day26 | Java集合框架概览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615342556327752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    懒惰蜗牛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:04:57.000Z" title="Wed Dec 10 2025 01:04:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经过前面25天的学习，我们已经打下了Java的语言基础。</p>
<p>从今天起，我们进入一个全新的、至关重要的领域——Java集合框架。</p>
<h2 data-id="heading-0">一、什么是集合框架</h2>
<p>在没有集合框架之前，如果你需要存储一组学生对象，你可能会使用数组。</p>
<p>但数组有一个致命的缺陷：长度一旦确定，就没办法改变了。</p>
<p>定义短了，可能不够用，定义长了，又可能造成资源浪费。</p>
<p>为了解决这类问题，Java提供了一套性能优良、使用方便的API，用来表示和操作对象的集合。</p>
<p>可以把它看成一个收纳万物的"工具箱"，里面有各种各样的"容器"（比如列表、集合、队列、映射表等），可以高效地对数据进行增、删、改、查等操作。</p>
<p>为什么Java要给我们提供这些集合框架？</p>
<p>很多复杂的数据结构，你如链表、哈希表、红黑树等，Java集合框架已经帮我们实现好了，而且经过了一定的优化，不再需要我们从零开始实现这些结构，方便我们的使用。</p>
<p>这些数据结构是我们在日常开发中比较常使用的，集合框架都经过了精心设计和优化，通常情况下比我们自己去现写的要高效得多。</p>
<p>集合框架提供了一套标准化的接口，不管具体的实现是什么，或者发生什么变化，操作这些集合的方法都是一致的，我们在学习和使用的时候，成本都比较低。</p>
<h2 data-id="heading-1">二、Java集合框架图谱</h2>
<p>Java集合框架主要由两个核心接口分支构成，它们是所有集合类的"老祖宗"：</p>
<h3 data-id="heading-2">2.1 Collection</h3>
<p>ArrayList</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5db3f698026843a1bde16a81be1e2c2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765933496&amp;x-signature=MzyhOvCyGvVXuufBJltJaLSbjqM%3D" alt="" loading="lazy"/></p>
<p>HashSet</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c2de38a7144144ae3c4fb5b2c4af6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765933496&amp;x-signature=Y5FpR%2FH5Q%2F4vUYlDs0poT6qAKTA%3D" alt="" loading="lazy"/></p>
<p>PriorityQueue</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d2b2440929d4d42baf76d11e2a951da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765933496&amp;x-signature=eCopsBRBDA%2Frp52mChntm9Ay8pw%3D" alt="" loading="lazy"/></p>
<p>上面的ArrayList、HashSet、PriorityQueue都实现了一个共同的接口Collection。</p>
<p>Collection是存放独立元素的集合的根接口。它的特点就是，容器里的每个位置只存放一个元素。</p>
<p>Collection有三个主要的子接口：List、Set、Queue。</p>
<p>List是一个有序的集合，允许存放重复的元素。你可以像操作数组一样通过索引来访问元素。（代表实现：ArrayList, LinkedList）</p>
<p>Set是一个不重复元素的集合。它不保证元素的顺序（某些实现类除外）。（代表实现：HashSet, TreeSet）</p>
<p>Queue是一个按特定规则（通常是先进先出FIFO）来处理元素的集合。（代表实现：LinkedList, PriorityQueue）</p>
<h3 data-id="heading-3">2.2 Map</h3>
<p>HashMap</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7395cdac69840e598d400fd6ff2c33c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765933496&amp;x-signature=PV4b4x6Xi3cIxNQFBa9JpsrCOpE%3D" alt="" loading="lazy"/></p>
<p>Map是存放键值对的集合的根接口。</p>
<p>Map里的每个元素都包含一个唯一的键（Key）和一个值（Value）。</p>
<p>它不继承自Collection接口，自成一派。（代表实现：HashMap, TreeMap）</p>
<h2 data-id="heading-4">三、Collection的核心能力</h2>
<p>Collection接口定义了所有单元素集合都必须具备的通用方法。</p>
<p>掌握了它，你就掌握了操作List、Set、Queue的一半了。</p>
<p>一起简单的梳理下Collection中定义的属性和行为：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Collection</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Iterable</span>&lt;E&gt; {
<span class="hljs-comment">// 集合里装的元素个数</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span>;

<span class="hljs-comment">// 集合是不是空的</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span>;

<span class="hljs-comment">// 集合里是不是包含某个对象</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(Object o)</span>;

<span class="hljs-comment">// 返回一个用来遍历集合的迭代器</span>
Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;

<span class="hljs-comment">// 把集合转换成一个Object数组</span>
Object[] toArray();

<span class="hljs-comment">// 把集合转换成一个指定类型的数组</span>
&lt;T&gt; T[] toArray(T[] a);

<span class="hljs-comment">// 添加一个元素到集合里</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span>;

<span class="hljs-comment">// 从集合里移除一个元素</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Object o)</span>;

<span class="hljs-comment">// 把另一个集合的所有元素都添加到这个集合</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span>;

<span class="hljs-comment">// 移除集合里也存在于另一个集合中的所有元素</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">removeAll</span><span class="hljs-params">(Collection&lt;?&gt; c)</span>;

<span class="hljs-comment">// 清空集合里的所有元素</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span>;
}
</code></pre>
<blockquote>
<p>Collection里的E就是我们之前学习的泛型，表示元素的类型。</p>
</blockquote>
<h2 data-id="heading-5">四、Iterable和Iterator</h2>
<p>你可能已经注意到，Collection接口继承了一个Iterable接口。</p>
<p>Iterable接口其实是Java 5引入的，它让实现了这个接口的集合都具备了使用for-each循环的能力。</p>
<blockquote>
<p>我们在看继承关系的时候，看到able结尾的接口，大多数情况下下就可以理解成，让子类具有某项能力。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterable</span>&lt;E&gt; {
    Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;
}
</code></pre>
<p>Iterator（迭代器） 可以看成真正负责遍历的指针。</p>
<p>类似一个游标，在集合上移动，并提供了安全地访问和删除元素的方法。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; {
<span class="hljs-comment">// 判断集合里是不是还有下一个元素可以访问。</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span>;

<span class="hljs-comment">// 返回集合里的下一个元素，并将"指针"后移一位。</span>
E <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;

}
</code></pre>
<p>提到删除元素，我们在初学的时候，还会遇到一个坑。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day26;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day26Demo
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/6/23 13:42
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day26Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"懒惰"</span>);
        list.add(<span class="hljs-string">"蜗牛"</span>);
        list.add(<span class="hljs-string">"Java"</span>);

        <span class="hljs-keyword">for</span> (String str : list) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"懒惰"</span>.equals(str)) {
                list.remove(str);
            }
        }
    }
}
</code></pre>
<p>在调用list.remove()的时候，ArrayList的内部结构发生了变化（元素数量、索引等），但迭代器Iterator并不知道这个变化。</p>
<p>当迭代器继续下一次next()操作时，它会发现"账对不上了"，然后马上就抛出ConcurrentModificationException（并发修改异常）来防止后面可能发生更严重的数据错乱问题。</p>
<p>推荐的遍历删除方式就是使用迭代器的remove()方法：</p>
<pre><code class="hljs language-java" lang="java">Iterator&lt;String&gt; iterator = list.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> iterator.next();
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"懒惰"</span>.equals(str)) {
                iterator.remove();
            }
        }
</code></pre>
<p>iterator.remove()会通知集合本次修改，确保数据的一致性，因此是唯一推荐在遍历时修改集合的方式。</p>
<blockquote>
<p>在实际开发中，必须使用迭代器的remove()或removeIf来保证代码的健壮性和可维护性。</p>
</blockquote>
<h2 data-id="heading-6">结语</h2>
<p>今天，我们算是开始了一个Java新板块的学习。</p>
<p>我们了解了Java集合框架是什么、它的宏观架构，了解了根接口Collection所定义的通用能力。</p>
<p>然后聊了一下迭代器和ConcurrentModificationException。</p>
<p>接下来我们会看一下集合框架下的一些具体实现。</p>
<p>下一篇预告</p>
<blockquote>
<p>Day27 | List接口详解</p>
</blockquote>
<p>如果你觉得这系列文章对你有帮助，欢迎关注专栏，我们一起坚持下去！</p>
<p><strong>更多文章请关注我的公众号《懒惰蜗牛工坊》</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[缓存被打穿？1000万数据只用12MB内存：布隆过滤器实战指南]]></title>    <link>https://juejin.cn/post/7581738974424350739</link>    <guid>https://juejin.cn/post/7581738974424350739</guid>    <pubDate>2025-12-10T01:27:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581738974424350739" data-draft-id="7581738974424334355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="缓存被打穿？1000万数据只用12MB内存：布隆过滤器实战指南"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-12-10T01:27:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            缓存被打穿？1000万数据只用12MB内存：布隆过滤器实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:27:37.000Z" title="Wed Dec 10 2025 01:27:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近在做系统性能优化，发现一个可以优化的点：大量请求在查询不存在的用户ID，每次都要穿透Redis缓存去查MySQL。虽然有缓存空值的机制，但内存占用还是很大。</p>
<p>团队讨论时，有人提到用布隆过滤器来解决。我研究了一下，发现这个方案确实合适：1000万用户数据，HashSet要400MB内存，布隆过滤器只需要12MB，还能挡住99%的无效请求。</p>
<p>这篇文章记录了我从原理、参数调优到分布式实战的完整过程。无论你是第一次听说布隆过滤器，还是准备在生产环境用它，都能找到有价值的内容。</p>
<p><strong>阅读建议：</strong></p>
<ul>
<li>想快速解决问题？直接跳到「六、实际工作中的应用场景」</li>
<li>想理解原理？精读「一、布隆过滤器的本质」</li>
<li>准备上生产？重点看「七、使用注意事项」</li>
<li>技术选型或面试？关注「八、总结」</li>
</ul>
<h2 data-id="heading-1">一、布隆过滤器的本质</h2>
<h3 data-id="heading-2">1.1 解决什么问题</h3>
<p>我们先看一个实际场景。假设系统有1000万注册用户，现在需要快速判断一个用户ID是否存在。</p>
<p>常规方案对比：</p>
<p><strong>方案1：HashSet</strong></p>
<pre><code class="hljs language-java" lang="java">Set&lt;Long&gt; userIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
<span class="hljs-comment">// 加载1000万用户ID</span>
userIds.contains(userId);  <span class="hljs-comment">// 判断是否存在</span>
</code></pre>
<p>内存占用：</p>
<ul>
<li>Long类型：8字节</li>
<li>HashSet额外开销：约32字节/元素</li>
<li>总计：1000万 × 40字节 = 400MB</li>
</ul>
<p><strong>方案2：布隆过滤器</strong></p>
<pre><code class="hljs language-java" lang="java">BloomFilter&lt;Long&gt; filter = BloomFilter.create(
    Funnels.longFunnel(),
    <span class="hljs-number">10_000_000</span>,  <span class="hljs-comment">// 1000万</span>
    <span class="hljs-number">0.01</span>         <span class="hljs-comment">// 1%误判率</span>
);
filter.mightContain(userId);  <span class="hljs-comment">// 判断是否存在</span>
</code></pre>
<p>内存占用：</p>
<ul>
<li>约120MB</li>
</ul>
<p><strong>节省了70%的内存！</strong></p>
<p>但布隆过滤器有个特点：它会有误判。具体来说：</p>
<ul>
<li>如果它说"不存在"，那一定不存在</li>
<li>如果它说"可能存在"，那可能是误判</li>
</ul>
<p>这个特性决定了它的使用场景。</p>
<h3 data-id="heading-3">1.2 工作原理</h3>
<p>布隆过滤器的核心数据结构是一个很长的bit数组，加上若干个Hash函数。</p>
<p><strong>添加元素的过程：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[元素 hello] --&gt; B[Hash1]
    A --&gt; C[Hash2]
    A --&gt; D[Hash3]
    B --&gt; E[位置3 = 1]
    C --&gt; F[位置7 = 1]
    D --&gt; G[位置12 = 1]
    E --&gt; H[bit数组]
    F --&gt; H
    G --&gt; H
</code></pre>
<p><strong>查询元素的过程：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[查询 hello] --&gt; B[Hash1]
    A --&gt; C[Hash2]
    A --&gt; D[Hash3]
    B --&gt; E{位置3是1?}
    C --&gt; F{位置7是1?}
    D --&gt; G{位置12是1?}
    E --&gt; H{都是1?}
    F --&gt; H
    G --&gt; H
    H --&gt;|是| I[可能存在]
    H --&gt;|否| J[一定不存在]
</code></pre>
<p>用代码表示就是：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// bit数组</span>
<span class="hljs-type">boolean</span>[] bits = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">1000000</span>];

<span class="hljs-comment">// 添加元素</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String key)</span> {
    bits[hash1(key) % bits.length] = <span class="hljs-literal">true</span>;
    bits[hash2(key) % bits.length] = <span class="hljs-literal">true</span>;
    bits[hash3(key) % bits.length] = <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 查询元素</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-keyword">return</span> bits[hash1(key) % bits.length]
        &amp;&amp; bits[hash2(key) % bits.length]
        &amp;&amp; bits[hash3(key) % bits.length];
}
</code></pre>
<p>核心就这么简单：用多个Hash函数映射到bit数组的不同位置，打上标记。</p>
<h3 data-id="heading-4">1.3 为什么会误判</h3>
<p>看一个例子：</p>
<pre><code class="hljs language-css" lang="css">添加 "hello":
  <span class="hljs-built_in">hash1</span>(<span class="hljs-string">"hello"</span>) → 位置<span class="hljs-number">3</span> ✓
  <span class="hljs-built_in">hash2</span>(<span class="hljs-string">"hello"</span>) → 位置<span class="hljs-number">7</span> ✓
  <span class="hljs-built_in">hash3</span>(<span class="hljs-string">"hello"</span>) → 位置<span class="hljs-number">12</span> ✓

添加 <span class="hljs-string">"world"</span>:
  <span class="hljs-built_in">hash1</span>(<span class="hljs-string">"world"</span>) → 位置<span class="hljs-number">5</span> ✓
  <span class="hljs-built_in">hash2</span>(<span class="hljs-string">"world"</span>) → 位置<span class="hljs-number">3</span> ✓  (和hello冲突)
  <span class="hljs-built_in">hash3</span>(<span class="hljs-string">"world"</span>) → 位置<span class="hljs-number">9</span> ✓

此时bit数组: [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,...]
               位置:  <span class="hljs-number">3</span>   <span class="hljs-number">5</span>   <span class="hljs-number">7</span>   <span class="hljs-number">9</span>      <span class="hljs-number">12</span>

查询 <span class="hljs-string">"java"</span>:
  <span class="hljs-built_in">hash1</span>(<span class="hljs-string">"java"</span>) → 位置<span class="hljs-number">3</span>  (被hello占了)
  <span class="hljs-built_in">hash2</span>(<span class="hljs-string">"java"</span>) → 位置<span class="hljs-number">7</span>  (被hello占了)
  <span class="hljs-built_in">hash3</span>(<span class="hljs-string">"java"</span>) → 位置<span class="hljs-number">9</span>  (被world占了)
  
三个位置都是<span class="hljs-number">1</span>，误判为存在！
</code></pre>
<p>随着插入的元素越来越多，bit数组中1的密度越来越高，误判的概率也会增加。这就是为什么需要合理设置参数。</p>
<p><strong>但别担心这1%的误判</strong>：它只是让你多查一次数据库，而不是返回错误结果。对于防缓存穿透这种场景，已经挡住了99%的无效请求，完全够用。</p>
<h2 data-id="heading-5">二、参数的数学原理</h2>
<h3 data-id="heading-6">2.1 关键参数</h3>
<p>布隆过滤器有三个核心参数：</p>
<ul>
<li><strong>n</strong>: 预期插入的元素个数</li>
<li><strong>p</strong>: 期望的误判率</li>
<li><strong>m</strong>: bit数组的长度</li>
<li><strong>k</strong>: Hash函数的个数</li>
</ul>
<p>前两个是我们设置的，后两个是自动计算出来的。</p>
<h3 data-id="heading-7">2.2 参数怎么算出来的</h3>
<p>你只需要告诉布隆过滤器两个数字，它就能自动算出需要多大的空间和多少个Hash函数。</p>
<p><strong>你设置：</strong></p>
<ul>
<li>预计存多少个元素（比如1000万）</li>
<li>能接受多少误判率（比如1%）</li>
</ul>
<p><strong>它自动计算：</strong></p>
<ul>
<li>需要多大的bit数组</li>
<li>需要几个Hash函数</li>
</ul>
<p><strong>举个例子：</strong></p>
<pre><code class="hljs language-diff" lang="diff">我说：要存1000万个用户ID，误判率控制在1%

布隆过滤器算出来：
<span class="hljs-deletion">- bit数组：需要12MB内存</span>
<span class="hljs-deletion">- Hash函数：需要7个</span>
</code></pre>
<p>具体的数学公式很复杂，但好在Guava已经帮我们封装好了，直接用就行：</p>
<pre><code class="hljs language-java" lang="java">BloomFilter.create(
    Funnels.longFunnel(),
    <span class="hljs-number">10_000_000</span>,  <span class="hljs-comment">// 告诉它：1000万元素</span>
    <span class="hljs-number">0.01</span>         <span class="hljs-comment">// 告诉它：1%误判率</span>
);
<span class="hljs-comment">// 剩下的它自己算</span>
</code></pre>
<h3 data-id="heading-8">2.3 不同参数的对比</h3>















































<table><thead><tr><th>元素数量</th><th>误判率</th><th>内存占用</th><th>Hash函数数</th></tr></thead><tbody><tr><td>100万</td><td>1%</td><td>1.2 MB</td><td>7</td></tr><tr><td>100万</td><td>0.1%</td><td>1.8 MB</td><td>10</td></tr><tr><td>1000万</td><td>1%</td><td>12 MB</td><td>7</td></tr><tr><td>1000万</td><td>0.1%</td><td>18 MB</td><td>10</td></tr><tr><td>1亿</td><td>1%</td><td>120 MB</td><td>7</td></tr><tr><td>1亿</td><td>0.1%</td><td>180 MB</td><td>10</td></tr></tbody></table>
<p><strong>经验法则：</strong> 1%误判率下，每个元素约需1.2字节，远低于HashSet的40+字节。省下的几百MB内存，可能就是你的服务能否塞进容器的关键。</p>
<p>从表格可以看出：</p>
<ul>
<li>误判率降低10倍，内存增加约50%</li>
<li>Hash函数个数主要受误判率影响</li>
<li>元素数量增加10倍，内存也增加约10倍</li>
</ul>
<h3 data-id="heading-9">2.4 参数选择建议</h3>
<p><strong>误判率的选择：</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">高精度场景(金融、安全): 0.001 (0.1%)</span>
<span class="hljs-section">常规业务场景: 0.01 (1%)</span>
<span class="hljs-section">宽松场景(日志去重): 0.03 (3%)</span>
</code></pre>
<p><strong>元素数量的预估：</strong></p>
<p>这个非常关键。如果预估不准确，会导致实际误判率远高于预期。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：预估10万，实际插入100万</span>
BloomFilter&lt;Long&gt; filter = BloomFilter.create(
    Funnels.longFunnel(),
    <span class="hljs-number">100_000</span>,   <span class="hljs-comment">// 预估太小</span>
    <span class="hljs-number">0.01</span>
);

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
    filter.put(i);  <span class="hljs-comment">// 实际插入100万</span>
}

<span class="hljs-comment">// 此时误判率可能高达30%以上</span>
</code></pre>
<p>正确的做法是留出一定余量：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> userMapper.count();
<span class="hljs-type">int</span> <span class="hljs-variable">expectedCount</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (currentCount * <span class="hljs-number">1.5</span>);  <span class="hljs-comment">// 留50%余量</span>

BloomFilter&lt;Long&gt; filter = BloomFilter.create(
    Funnels.longFunnel(),
    expectedCount,
    <span class="hljs-number">0.01</span>
);
</code></pre>
<h2 data-id="heading-10">三、单机场景实战</h2>
<h3 data-id="heading-11">3.1 Guava实现</h3>
<p>Guava是最常用的布隆过滤器实现。</p>
<p><strong>基本使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.hash.BloomFilter;
<span class="hljs-keyword">import</span> com.google.common.hash.Funnels;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBloomFilter</span> {
    
    <span class="hljs-keyword">private</span> BloomFilter&lt;Long&gt; filter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 创建布隆过滤器</span>
            filter = BloomFilter.create(
                Funnels.longFunnel(),  <span class="hljs-comment">// 数据类型</span>
                <span class="hljs-number">10_000_000</span>,            <span class="hljs-comment">// 预期元素数</span>
                <span class="hljs-number">0.01</span>                   <span class="hljs-comment">// 误判率</span>
            );
            
            <span class="hljs-comment">// 从数据库加载所有用户ID</span>
            List&lt;Long&gt; userIds = userMapper.getAllUserIds();
            userIds.forEach(filter::put);
            
            log.info(<span class="hljs-string">"布隆过滤器初始化完成，加载{}个用户ID"</span>, userIds.size());
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"布隆过滤器初始化失败，服务无法启动"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"BloomFilter init failed"</span>, e);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">mightContain</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> filter.mightContain(userId);
    }
    
    <span class="hljs-comment">// 关键：注册新用户时，必须同步更新过滤器</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(Long userId)</span> {
        filter.put(userId);  <span class="hljs-comment">// 否则会漏判，导致有效请求被拦截</span>
    }
}
</code></pre>
<p><strong>防止缓存穿透：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserBloomFilter bloomFilter;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, User&gt; redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMapper userMapper;
    
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 第一层：布隆过滤器</span>
        <span class="hljs-keyword">if</span> (!bloomFilter.mightContain(userId)) {
            log.info(<span class="hljs-string">"布隆过滤器判断用户不存在: {}"</span>, userId);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 一定不存在，直接返回</span>
        }
        
        <span class="hljs-comment">// 第二层：Redis缓存</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + userId;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(cacheKey);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> user;
        }
        
        <span class="hljs-comment">// 第三层：数据库</span>
        user = userMapper.selectById(userId);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            redisTemplate.opsForValue().set(cacheKey, user, <span class="hljs-number">1</span>, TimeUnit.HOURS);
        }
        
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<p><strong>查询流程：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户请求 userId] --&gt; B{布隆过滤器}
    B --&gt;|不存在| C[直接返回null]
    B --&gt;|可能存在| D{Redis缓存}
    D --&gt;|命中| E[返回用户信息]
    D --&gt;|未命中| F[查询MySQL]
    F --&gt; G[写入Redis]
    G --&gt; E
</code></pre>
<h3 data-id="heading-12">3.2 实战案例：短链接去重</h3>
<p>在生成随机短码时，需要检查是否已被占用。如果每次都查数据库，性能会很差。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShortUrlService</span> {
    
    <span class="hljs-comment">// 布隆过滤器</span>
    <span class="hljs-keyword">private</span> BloomFilter&lt;String&gt; keywordFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        keywordFilter = BloomFilter.create(
            Funnels.stringFunnel(Charsets.UTF_8),
            <span class="hljs-number">100_000_000</span>,  <span class="hljs-comment">// 预期1亿短链</span>
            <span class="hljs-number">0.01</span>
        );
        
        <span class="hljs-comment">// 加载已有的短码</span>
        List&lt;String&gt; keywords = shortUrlMapper.getAllKeywords();
        keywords.forEach(keywordFilter::put);
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateUniqueKeyword</span><span class="hljs-params">()</span> {
        String keyword;
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">do</span> {
            <span class="hljs-comment">// 生成6位随机码</span>
            keyword = RandomStringUtils.randomAlphanumeric(<span class="hljs-number">6</span>);
            
            <span class="hljs-comment">// 布隆过滤器快速判断</span>
            <span class="hljs-keyword">if</span> (!keywordFilter.mightContain(keyword)) {
                <span class="hljs-comment">// 一定不存在，可以直接使用</span>
                keywordFilter.put(keyword);
                <span class="hljs-keyword">return</span> keyword;
            }
            
            <span class="hljs-comment">// 可能存在，查数据库确认</span>
            <span class="hljs-keyword">if</span> (!shortUrlMapper.exists(keyword)) {
                keywordFilter.put(keyword);
                <span class="hljs-keyword">return</span> keyword;
            }
            
            retryCount++;
        } <span class="hljs-keyword">while</span> (retryCount &lt; <span class="hljs-number">10</span>);
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"生成短码失败"</span>);
    }
}
</code></pre>
<p>这个方案的优势：</p>
<ul>
<li>对于不存在的短码，直接返回，不查数据库</li>
<li>对于可能存在的短码，才去数据库确认</li>
<li>大约能减少90%的数据库查询</li>
</ul>
<h3 data-id="heading-13">3.3 定期重建</h3>
<p>随着数据量的增长，布隆过滤器的误判率会上升。需要定期重建。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BloomFilterRebuilder</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-keyword">private</span> BloomFilter&lt;Long&gt; userIdFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        rebuildFilter();
    }
    
    <span class="hljs-comment">// 每天凌晨2点重建</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleRebuild</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"开始重建布隆过滤器"</span>);
        rebuildFilter();
        log.info(<span class="hljs-string">"布隆过滤器重建完成"</span>);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rebuildFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 查询当前用户数</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> userMapper.count();
        <span class="hljs-type">long</span> <span class="hljs-variable">expectedCount</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>) (currentCount * <span class="hljs-number">1.5</span>);
        
        <span class="hljs-comment">// 创建新的过滤器</span>
        BloomFilter&lt;Long&gt; newFilter = BloomFilter.create(
            Funnels.longFunnel(),
            expectedCount,
            <span class="hljs-number">0.01</span>
        );
        
        <span class="hljs-comment">// 分批加载用户ID</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">pageNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            List&lt;Long&gt; userIds = userMapper.selectUserIds(pageNum, pageSize);
            <span class="hljs-keyword">if</span> (userIds.isEmpty()) {
                <span class="hljs-keyword">break</span>;
            }
            
            userIds.forEach(newFilter::put);
            pageNum++;
        }
        
        <span class="hljs-comment">// 原子替换</span>
        <span class="hljs-built_in">this</span>.userIdFilter = newFilter;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> userIdFilter.mightContain(userId);
    }
}
</code></pre>
<h2 data-id="heading-14">四、分布式场景实战</h2>
<h3 data-id="heading-15">4.1 单机布隆过滤器的问题</h3>
<p>在分布式环境下，单机内存中的布隆过滤器有明显的问题：</p>
<pre><code class="hljs language-java" lang="java">应用实例<span class="hljs-number">1</span>: BloomFilter <span class="hljs-title function_">A</span> <span class="hljs-params">(内存)</span>
应用实例<span class="hljs-number">2</span>: BloomFilter <span class="hljs-title function_">B</span> <span class="hljs-params">(内存)</span>
应用实例<span class="hljs-number">3</span>: BloomFilter <span class="hljs-title function_">C</span> <span class="hljs-params">(内存)</span>
</code></pre>
<p>问题：</p>
<ol>
<li>每个实例都要加载全量数据，内存浪费</li>
<li>数据不同步，A添加的元素，B和C不知道</li>
<li>扩容时，新实例需要重新加载</li>
</ol>
<h3 data-id="heading-16">4.2 Redis实现</h3>
<p>使用Redisson提供的分布式布隆过滤器。</p>
<p><strong>添加依赖：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.23.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();
        config.useSingleServer()
            .setAddress(<span class="hljs-string">"redis://localhost:6379"</span>)
            .setDatabase(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> Redisson.create(config);
    }
}
</code></pre>
<p><strong>使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedUserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">private</span> RBloomFilter&lt;Long&gt; userIdFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取布隆过滤器</span>
        userIdFilter = redissonClient.getBloomFilter(<span class="hljs-string">"user:id:filter"</span>);
        
        <span class="hljs-comment">// 初始化（只需要执行一次）</span>
        <span class="hljs-keyword">if</span> (!userIdFilter.isExists()) {
            userIdFilter.tryInit(<span class="hljs-number">10_000_000</span>, <span class="hljs-number">0.01</span>);
            
            <span class="hljs-comment">// 加载用户ID</span>
            List&lt;Long&gt; userIds = userMapper.getAllUserIds();
            userIds.forEach(userIdFilter::add);
            
            log.info(<span class="hljs-string">"Redis布隆过滤器初始化完成"</span>);
        }
    }
    
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 布隆过滤器判断</span>
        <span class="hljs-keyword">if</span> (!userIdFilter.contains(userId)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 查Redis缓存</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + userId;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(cacheKey);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> user;
        }
        
        <span class="hljs-comment">// 查数据库</span>
        user = userMapper.selectById(userId);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            redisTemplate.opsForValue().set(cacheKey, user, <span class="hljs-number">1</span>, TimeUnit.HOURS);
        }
        
        <span class="hljs-keyword">return</span> user;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-comment">// 保存到数据库</span>
        userMapper.insert(user);
        
        <span class="hljs-comment">// 添加到布隆过滤器</span>
        userIdFilter.add(user.getId());
    }
}
</code></pre>
<h3 data-id="heading-17">4.3 架构对比</h3>
<p><strong>单机版：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[应用实例1] --&gt; B[本地BloomFilter]
    C[应用实例2] --&gt; D[本地BloomFilter]
    E[应用实例3] --&gt; F[本地BloomFilter]
    B --&gt; G[MySQL]
    D --&gt; G
    F --&gt; G
</code></pre>
<p><strong>分布式版：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[应用实例1] --&gt; D[Redis BloomFilter]
    B[应用实例2] --&gt; D
    C[应用实例3] --&gt; D
    D --&gt; E[MySQL]
</code></pre>
<p>分布式版的优势：</p>
<ul>
<li>所有实例共享一个过滤器</li>
<li>数据实时同步</li>
<li>节省内存（只有一份）</li>
</ul>
<h2 data-id="heading-18">五、开源项目中的使用</h2>
<p>看看大厂和知名开源项目都在哪些地方用布隆过滤器，可以给我们一些启发。</p>
<h3 data-id="heading-19">5.1 爬虫框架</h3>
<p><strong>Scrapy</strong>：Python爬虫框架用布隆过滤器做URL去重。</p>
<pre><code class="hljs">已爬URL → 放入布隆过滤器
新URL → 先查布隆过滤器 → 判断是否爬过
</code></pre>
<p>这样就不用把几亿个URL都存在内存里了。</p>
<h3 data-id="heading-20">5.2 数据库存储引擎</h3>
<p><strong>RocksDB</strong>：在读SSTable文件前，先用布隆过滤器判断key是否存在。</p>
<pre><code class="hljs language-markdown" lang="markdown">查询key → 布隆过滤器判断 
<span class="hljs-code">         → 不存在：直接返回，省一次磁盘IO
         → 可能存在：读文件确认
</span></code></pre>
<p><strong>HBase</strong>：在表配置里可以开启布隆过滤器。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">'user'</span> (
    <span class="hljs-string">'info'</span> {BLOOMFILTER <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'ROW'</span>}
)
</code></pre>
<p>避免查询不存在的行时还要扫描磁盘。</p>
<h3 data-id="heading-21">5.3 浏览器安全</h3>
<p><strong>Chrome浏览器</strong>：用布隆过滤器判断URL是否为恶意网站。</p>
<pre><code class="hljs language-markdown" lang="markdown">本地存2MB的布隆过滤器（包含已知恶意网站）
访问网址 → 先查本地过滤器
<span class="hljs-code">         → 安全：直接访问
         → 可能危险：请求服务器确认
</span></code></pre>
<p>这样大部分URL都不用请求服务器，快很多。</p>
<h3 data-id="heading-22">5.4 消息队列</h3>
<p><strong>Kafka</strong>：某些场景下用布隆过滤器做消息去重。</p>
<p><strong>RabbitMQ</strong>：插件支持布隆过滤器防止重复消费。</p>
<hr/>
<p><strong>小结：</strong> 布隆过滤器在工业界主要用于：</p>
<ul>
<li>去重（爬虫、消息队列）</li>
<li>加速查询（数据库、存储引擎）</li>
<li>减少网络请求（浏览器安全）</li>
</ul>
<p>这些场景的共同点是：数据量大、允许一定误判、对性能要求高。</p>
<h2 data-id="heading-23">六、实际工作中的应用场景</h2>
<h3 data-id="heading-24">6.1 防止缓存穿透</h3>
<p>这是最常见的场景。</p>
<p><strong>场景描述：</strong>
系统有1000万注册用户，恶意攻击者不断请求不存在的用户ID（如：99999999），每次请求都会穿透Redis缓存，直接查询MySQL。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-keyword">private</span> BloomFilter&lt;Long&gt; userIdFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 初始化布隆过滤器</span>
        userIdFilter = BloomFilter.create(
            Funnels.longFunnel(),
            <span class="hljs-number">10_000_000</span>,
            <span class="hljs-number">0.01</span>
        );
        
        <span class="hljs-comment">// 加载所有用户ID</span>
        userMapper.getAllUserIds().forEach(userIdFilter::put);
    }
    
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 布隆过滤器挡在最前面</span>
        <span class="hljs-keyword">if</span> (!userIdFilter.mightContain(userId)) {
            log.info(<span class="hljs-string">"拦截无效请求: {}"</span>, userId);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 查缓存和数据库</span>
        <span class="hljs-keyword">return</span> getUserFromCacheOrDb(userId);
    }
    
    <span class="hljs-comment">// 新用户注册时，加入过滤器</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> {
        userMapper.insert(user);
        userIdFilter.put(user.getId());
    }
}
</code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>无效请求直接被拦截，不会打到数据库</li>
<li>QPS从500提升到5000</li>
<li>MySQL负载下降80%</li>
</ul>
<h3 data-id="heading-25">6.2 爬虫URL去重</h3>
<p><strong>场景描述：</strong>
开发一个网页爬虫，需要记录已经爬取过的URL，避免重复爬取。如果用HashSet存储1亿个URL，需要占用约4GB内存。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlDuplicateChecker</span> {
    
    <span class="hljs-keyword">private</span> BloomFilter&lt;String&gt; urlFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        urlFilter = BloomFilter.create(
            Funnels.stringFunnel(Charsets.UTF_8),
            <span class="hljs-number">100_000_000</span>,  <span class="hljs-comment">// 1亿URL</span>
            <span class="hljs-number">0.03</span>          <span class="hljs-comment">// 3%误判率（爬虫场景可接受）</span>
        );
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDuplicate</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-keyword">if</span> (urlFilter.mightContain(url)) {
            <span class="hljs-comment">// 可能重复，查数据库确认</span>
            <span class="hljs-keyword">return</span> urlRepository.exists(url);
        }
        
        <span class="hljs-comment">// 一定没爬过</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">markAsCrawled</span><span class="hljs-params">(String url)</span> {
        urlFilter.put(url);
        urlRepository.save(url);
    }
}
</code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>内存占用从4GB降低到360MB</li>
<li>90%的重复URL在布隆过滤器阶段就被识别</li>
</ul>
<h3 data-id="heading-26">6.3 实时推荐去重</h3>
<p><strong>场景描述：</strong>
给用户推荐内容时，需要过滤掉已经推荐过的内容。用户的历史记录可能有上万条。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">public</span> List&lt;Content&gt; <span class="hljs-title function_">recommend</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 获取用户的布隆过滤器</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">filterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"recommend:history:"</span> + userId;
        RBloomFilter&lt;Long&gt; historyFilter = 
            redissonClient.getBloomFilter(filterKey);
        
        <span class="hljs-keyword">if</span> (!historyFilter.isExists()) {
            historyFilter.tryInit(<span class="hljs-number">50_000</span>, <span class="hljs-number">0.01</span>);
            
            <span class="hljs-comment">// 加载历史记录</span>
            List&lt;Long&gt; history = recommendMapper.getHistory(userId);
            history.forEach(historyFilter::add);
        }
        
        <span class="hljs-comment">// 获取候选内容</span>
        List&lt;Content&gt; candidates = getTopCandidates(userId, <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// 过滤已推荐的</span>
        List&lt;Content&gt; filtered = candidates.stream()
            .filter(c -&gt; !historyFilter.contains(c.getId()))
            .limit(<span class="hljs-number">20</span>)
            .collect(Collectors.toList());
        
        <span class="hljs-comment">// 记录本次推荐</span>
        filtered.forEach(c -&gt; historyFilter.add(c.getId()));
        
        <span class="hljs-keyword">return</span> filtered;
    }
}
</code></pre>
<h3 data-id="heading-27">6.4 分布式日志去重</h3>
<p><strong>场景描述：</strong>
微服务架构下，同一个错误可能在多个实例上大量出现。需要对日志进行去重，避免告警轰炸。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogDeduplicator</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">private</span> RBloomFilter&lt;String&gt; logFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        logFilter = redissonClient.getBloomFilter(<span class="hljs-string">"log:dedup"</span>);
        <span class="hljs-keyword">if</span> (!logFilter.isExists()) {
            logFilter.tryInit(<span class="hljs-number">1_000_000</span>, <span class="hljs-number">0.01</span>);
        }
        
        <span class="hljs-comment">// 每小时重置一次</span>
        Executors.newSingleThreadScheduledExecutor()
            .scheduleAtFixedRate(<span class="hljs-built_in">this</span>::resetFilter, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, TimeUnit.HOURS);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logError</span><span class="hljs-params">(String message, Throwable t)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">logKey</span> <span class="hljs-operator">=</span> message + <span class="hljs-string">":"</span> + t.getStackTrace()[<span class="hljs-number">0</span>].toString();
        
        <span class="hljs-keyword">if</span> (logFilter.contains(logKey)) {
            <span class="hljs-comment">// 已经记录过，不重复告警</span>
            <span class="hljs-keyword">return</span>;
        }
        
        logFilter.add(logKey);
        
        <span class="hljs-comment">// 发送告警</span>
        alertService.sendAlert(message, t);
        
        <span class="hljs-comment">// 记录日志</span>
        log.error(message, t);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetFilter</span><span class="hljs-params">()</span> {
        logFilter.delete();
        logFilter.tryInit(<span class="hljs-number">1_000_000</span>, <span class="hljs-number">0.01</span>);
    }
}
</code></pre>
<h3 data-id="heading-28">6.5 黑名单快速判断</h3>
<p><strong>场景描述：</strong>
API网关需要拦截黑名单IP，黑名单有100万个IP地址。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IpBlacklistFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">private</span> RBloomFilter&lt;String&gt; blacklistFilter;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        blacklistFilter = redissonClient.getBloomFilter(<span class="hljs-string">"ip:blacklist"</span>);
        
        <span class="hljs-keyword">if</span> (!blacklistFilter.isExists()) {
            blacklistFilter.tryInit(<span class="hljs-number">1_000_000</span>, <span class="hljs-number">0.001</span>);  <span class="hljs-comment">// 更严格</span>
            
            <span class="hljs-comment">// 加载黑名单</span>
            List&lt;String&gt; blacklist = blacklistMapper.getAll();
            blacklist.forEach(blacklistFilter::add);
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, 
                        FilterChain chain)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> getClientIp(request);
        
        <span class="hljs-comment">// 布隆过滤器判断</span>
        <span class="hljs-keyword">if</span> (blacklistFilter.contains(ip)) {
            <span class="hljs-comment">// 可能在黑名单，数据库确认</span>
            <span class="hljs-keyword">if</span> (blacklistMapper.exists(ip)) {
                response.sendError(<span class="hljs-number">403</span>, <span class="hljs-string">"IP被封禁"</span>);
                <span class="hljs-keyword">return</span>;
            }
        }
        
        chain.doFilter(request, response);
    }
}
</code></pre>
<h2 data-id="heading-29">七、使用注意事项</h2>
<h3 data-id="heading-30">7.1 不能删除元素</h3>
<p>这是布隆过滤器最大的限制。</p>
<p><strong>问题场景：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 用户注销账号</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long userId)</span> {
    userMapper.delete(userId);
    
    <span class="hljs-comment">// 想从布隆过滤器中删除</span>
    userIdFilter.remove(userId);  <span class="hljs-comment">// 没有这个方法！</span>
}
</code></pre>
<p><strong>为什么不能删除？</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">假设 <span class="hljs-string">"user1"</span> 和 <span class="hljs-string">"user2"</span> 都映射到位置<span class="hljs-number">3</span>

bit[<span class="hljs-number">3</span>] = <span class="hljs-number">1</span>  (由user1和user2共同标记)

删除 user1 时，把 bit[<span class="hljs-number">3</span>] 设为<span class="hljs-number">0</span>
那么 user2 也查不到了！
</code></pre>
<p><strong>解决方案：</strong></p>
<p>方案1：定期重建</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rebuild</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 每天凌晨重建过滤器</span>
    rebuildBloomFilter();
}
</code></pre>
<p>方案2：使用Counting Bloom Filter</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 每个位置不是0/1，而是计数器</span>
<span class="hljs-type">int</span>[] counters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[size];

<span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(key)</span> {
    counters[hash1(key)]++;
    counters[hash2(key)]++;
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(key)</span> {
    counters[hash1(key)]--;
    counters[hash2(key)]--;
}
</code></pre>
<p>缺点是内存占用增加4倍（int vs bit）。</p>
<p>方案3：设置过期时间</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Redis版本，设置整体过期</span>
RBloomFilter&lt;String&gt; filter = redisson.getBloomFilter(<span class="hljs-string">"key"</span>);
filter.expire(<span class="hljs-number">1</span>, TimeUnit.DAYS);
</code></pre>
<h3 data-id="heading-31">7.2 不能更新元素</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
    userMapper.update(user);
    
    <span class="hljs-comment">// 想更新过滤器</span>
    userIdFilter.remove(oldUserId);  <span class="hljs-comment">// 不支持</span>
    userIdFilter.add(newUserId);
}
</code></pre>
<p>布隆过滤器只支持两个操作：</p>
<ul>
<li>add(): 添加元素</li>
<li>contains(): 查询元素</li>
</ul>
<p>没有update()和remove()方法。</p>
<h3 data-id="heading-32">7.3 只能判断"一定不存在"</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误理解</span>
<span class="hljs-keyword">if</span> (bloomFilter.contains(key)) {
    <span class="hljs-comment">// 以为key一定存在 ← 错误！</span>
    <span class="hljs-keyword">return</span> db.get(key);
}

<span class="hljs-comment">// 正确理解</span>
<span class="hljs-keyword">if</span> (!bloomFilter.contains(key)) {
    <span class="hljs-comment">// key一定不存在 ← 正确</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">if</span> (bloomFilter.contains(key)) {
    <span class="hljs-comment">// key可能存在，需要再确认</span>
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> db.get(key);
    <span class="hljs-keyword">return</span> user;
}
</code></pre>
<h3 data-id="heading-33">7.4 预估必须准确</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 场景：预估100万，实际插入1000万</span>
BloomFilter&lt;Long&gt; filter = BloomFilter.create(
    Funnels.longFunnel(),
    <span class="hljs-number">1_000_000</span>,  <span class="hljs-comment">// 预估</span>
    <span class="hljs-number">0.01</span>
);

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000_000</span>; i++) {
    filter.put(i);  <span class="hljs-comment">// 实际</span>
}

<span class="hljs-comment">// 测试误判率</span>
<span class="hljs-type">int</span> <span class="hljs-variable">falsePositive</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">10_000_000</span>; i &lt; <span class="hljs-number">10_010_000</span>; i++) {
    <span class="hljs-keyword">if</span> (filter.mightContain(i)) {
        falsePositive++;
    }
}

System.out.println(<span class="hljs-string">"误判率: "</span> + falsePositive / <span class="hljs-number">10000.0</span>);
<span class="hljs-comment">// 输出：误判率: 0.35 (35%!)</span>
</code></pre>
<p>实际误判率远超预期的1%。</p>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方案1：预估时留余量</span>
<span class="hljs-type">int</span> <span class="hljs-variable">expected</span> <span class="hljs-operator">=</span> currentCount * <span class="hljs-number">2</span>;

<span class="hljs-comment">// 方案2：监控并重建</span>
<span class="hljs-keyword">if</span> (actualCount &gt; expectedCount * <span class="hljs-number">0.8</span>) {
    rebuildWithLargerCapacity();
}

<span class="hljs-comment">// 方案3：分片</span>
BloomFilter[] filters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BloomFilter</span>[<span class="hljs-number">10</span>];
<span class="hljs-type">int</span> <span class="hljs-variable">shardIndex</span> <span class="hljs-operator">=</span> userId % <span class="hljs-number">10</span>;
filters[shardIndex].add(userId);
</code></pre>
<h3 data-id="heading-34">7.5 分布式场景的同步问题</h3>
<p>单机版布隆过滤器在分布式环境下存在数据不一致。</p>
<pre><code class="hljs language-css" lang="css">实例<span class="hljs-selector-tag">A</span>添加了user1
实例<span class="hljs-selector-tag">B</span>不知道
实例<span class="hljs-selector-tag">B</span>查询user1，返回"不存在"
</code></pre>
<p>必须使用Redis等分布式实现。</p>
<h3 data-id="heading-35">7.6 序列化和持久化</h3>
<p>Guava的布隆过滤器支持序列化：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 序列化到文件</span>
BloomFilter&lt;Long&gt; filter = createFilter();
<span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"bloom.dat"</span>)) {
    filter.writeTo(fos);
}

<span class="hljs-comment">// 从文件读取</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"bloom.dat"</span>)) {
    BloomFilter&lt;Long&gt; filter = BloomFilter.readFrom(fis, Funnels.longFunnel());
}
</code></pre>
<p>这在以下场景有用：</p>
<ul>
<li>应用重启后快速恢复</li>
<li>定期备份</li>
<li>跨应用共享</li>
</ul>
<h3 data-id="heading-36">7.7 性能考虑</h3>
<p><strong>Hash函数的个数影响性能：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 误判率0.01，需要7个Hash</span>
<span class="hljs-comment">// 每次查询要计算7次Hash</span>

<span class="hljs-comment">// 误判率0.001，需要10个Hash</span>
<span class="hljs-comment">// 每次查询要计算10次Hash</span>
</code></pre>
<p>在高并发场景下，需要权衡：</p>
<ul>
<li>更低的误判率 vs 更高的CPU消耗</li>
</ul>
<p><strong>建议：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 常规场景</span>
误判率 = <span class="hljs-number">0.01</span>, Hash数 = <span class="hljs-number">7</span>

<span class="hljs-comment">// 高并发场景</span>
误判率 = <span class="hljs-number">0.03</span>, Hash数 = <span class="hljs-number">5</span>

<span class="hljs-comment">// 高精度场景</span>
误判率 = <span class="hljs-number">0.001</span>, Hash数 = <span class="hljs-number">10</span>
</code></pre>
<h3 data-id="heading-37">7.8 常见反模式</h3>
<p>这些错误在生产环境中经常出现，需要特别注意：</p>
<p><strong>反模式1：把布隆过滤器当精确集合用</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误：判断用户是否在线</span>
<span class="hljs-keyword">if</span> (onlineUsersFilter.contains(userId)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"在线"</span>;  <span class="hljs-comment">// 可能误判！</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"离线"</span>;  <span class="hljs-comment">// 这个是准的</span>
}

<span class="hljs-comment">// 布隆过滤器只能确定"一定不在"，不能确定"一定在"</span>
</code></pre>
<p><strong>反模式2：在频繁增删的场景使用</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误：购物车去重</span>
cartFilter.add(productId);      <span class="hljs-comment">// 加入购物车</span>
cartFilter.remove(productId);   <span class="hljs-comment">// 不支持删除！</span>

<span class="hljs-comment">// 购物车这种频繁增删的场景，应该用Redis Set</span>
</code></pre>
<p><strong>反模式3：忽略冷启动问题</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误：服务重启后过滤器为空</span>
<span class="hljs-meta">@PostConstruct</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
    filter = BloomFilter.create(...);
    <span class="hljs-comment">// 忘记加载历史数据</span>
}

<span class="hljs-comment">// 结果：服务重启后，所有请求都判断为"不存在"，瞬间穿透DB</span>
</code></pre>
<p><strong>反模式4：分布式环境各自维护</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误：每个实例维护本地过滤器</span>
<span class="hljs-comment">// 实例A添加了user1</span>
bloomFilter.add(<span class="hljs-number">1L</span>);

<span class="hljs-comment">// 实例B不知道，还是判断不存在</span>
<span class="hljs-comment">// 导致数据不一致</span>
</code></pre>
<p><strong>正确做法：使用Redis分布式版本。</strong></p>
<h2 data-id="heading-38">八、总结</h2>
<h3 data-id="heading-39">8.1 核心要点</h3>
<ol>
<li><strong>本质</strong>：用bit数组 + 多个Hash函数，实现空间高效的集合判断</li>
<li><strong>特点</strong>：允许一定的误判，但节省大量内存</li>
<li><strong>适用场景</strong>：海量数据去重、缓存穿透防护、黑名单判断</li>
<li><strong>关键参数</strong>：预期元素数量、误判率</li>
<li><strong>限制</strong>：不能删除、不能更新、有误判</li>
</ol>
<h3 data-id="heading-40">8.2 决策框架</h3>
<p><strong>是否该用布隆过滤器？按这个流程判断：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 数据量是否 ≥ 百万级？
   └─ 否 → 直接用 HashSet
   └─ 是 → 继续

<span class="hljs-bullet">2.</span> 能否接受少量误判（1-3%）？
   └─ 否 → 考虑 BitMap 或 RoaringBitmap
   └─ 是 → 继续

<span class="hljs-bullet">3.</span> 主要用途是判断"不存在"？
   └─ 是 → 布隆过滤器很合适
   └─ 否 → 继续

<span class="hljs-bullet">4.</span> 是否需要删除或更新元素？
   └─ 是 → 考虑 Cuckoo Filter 或定期重建
   └─ 否 → 布隆过滤器完美匹配
</code></pre>
<h3 data-id="heading-41">8.3 使用建议</h3>
<p><strong>什么时候用布隆过滤器：</strong></p>
<ul>
<li>数据量大（百万级以上）</li>
<li>允许一定的误判</li>
<li>主要用于判断"不存在"</li>
<li>对内存敏感</li>
</ul>
<p><strong>什么时候不用：</strong></p>
<ul>
<li>数据量小（直接用HashSet）</li>
<li>需要100%准确</li>
<li>需要删除或更新元素</li>
<li>需要持久化全部数据</li>
</ul>
<h3 data-id="heading-42">8.4 最佳实践</h3>
<ol>
<li><strong>预估准确</strong>：预期数量 × 1.5倍</li>
<li><strong>定期重建</strong>：避免误判率上升</li>
<li><strong>监控指标</strong>：实际数量、误判率、内存占用</li>
<li><strong>分布式用Redis</strong>：避免数据不一致</li>
<li><strong>降级方案</strong>：过滤器失效时的兜底策略</li>
</ol>
<h3 data-id="heading-43">8.5 进阶方向</h3>
<p>如果这些基础的布隆过滤器不能满足需求，可以研究：</p>
<ul>
<li>Counting Bloom Filter（支持删除）</li>
<li>Scalable Bloom Filter（动态扩容）</li>
<li>Cuckoo Filter（更低误判率，支持删除）</li>
</ul>
<p>但对于大部分业务场景，Guava的基础实现已经足够了。</p>
<hr/>
<p><strong>最后说一句：</strong> 布隆过滤器不是银弹，但它是在"空间、速度、准确性"三角中，一个极其优雅的折中。真正的工程智慧，不在于知道多少算法，而在于知道何时用哪个工具。</p>
<p>希望这篇文章能帮你避开90%工程师踩过的坑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WinForm 中实现高质量自定义圆角按钮控件]]></title>    <link>https://juejin.cn/post/7581888578507423771</link>    <guid>https://juejin.cn/post/7581888578507423771</guid>    <pubDate>2025-12-10T01:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507423771" data-draft-id="7516751639666442276" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WinForm 中实现高质量自定义圆角按钮控件"/> <meta itemprop="keywords" content="后端,.NET,C#"/> <meta itemprop="datePublished" content="2025-12-10T01:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小码编匠"/> <meta itemprop="url" content="https://juejin.cn/user/1308876155395739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WinForm 中实现高质量自定义圆角按钮控件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1308876155395739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小码编匠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:35:04.000Z" title="Wed Dec 10 2025 01:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>WinForm开发中，默认的Button控件外观比较单调，且圆角效果显示质量较差。为了提升界面美观度和用户体验，本文将介绍如何使用GDI+创建一个高质量的自定义圆角按钮控件。该控件参考了YouTube上一位大神的设计思路，采用双层绘制机制，实现了平滑的圆角渲染和多种自定义功能。</p>
<h3 data-id="heading-1">正文</h3>
<h4 data-id="heading-2">主要特性</h4>
<ul>
<li>
<p>可自定义边框大小</p>
</li>
<li>
<p>可自定义圆角半径</p>
</li>
<li>
<p>可自定义边框颜色</p>
</li>
<li>
<p>支持背景色和文本颜色设置</p>
</li>
<li>
<p>平滑的圆角渲染效果</p>
</li>
</ul>
<p>这些特性使得控件可以灵活适应不同UI设计需求，同时保证视觉上的高品质表现。</p>
<h4 data-id="heading-3">实现步骤</h4>
<h4 data-id="heading-4">创建自定义按钮类</h4>
<p>首先，我们需要创建一个继承自<code>Button</code>的自定义类：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Windows.Forms;
<span class="hljs-keyword">using</span> System.Drawing;
<span class="hljs-keyword">using</span> System.Drawing.Drawing2D;
<span class="hljs-keyword">using</span> System.ComponentModel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RoundButton</span> : <span class="hljs-title">Button</span>
{
    <span class="hljs-comment">// 字段定义</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> borderSize = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> borderRadius = <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> Color borderColor = Color.PaleVioletRed;
}
</code></pre>
<h4 data-id="heading-5">添加属性</h4>
<p>接下来为按钮添加可配置的属性，包括边框大小、圆角半径、边框颜色、背景色和文本颜色，并在每次修改时调用<code>Invalidate()</code>方法以触发重绘。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Category(<span class="hljs-string">"Round Button"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BorderSize
{
    <span class="hljs-keyword">get</span> =&gt; borderSize;
    <span class="hljs-keyword">set</span>
    {
        borderSize = <span class="hljs-keyword">value</span>;
        Invalidate();
    }
}

[<span class="hljs-meta">Category(<span class="hljs-string">"Round Button"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BorderRadius
{
    <span class="hljs-keyword">get</span> =&gt; borderRadius;
    <span class="hljs-keyword">set</span>
    {
        borderRadius = <span class="hljs-keyword">value</span>;
        Invalidate();
    }
}

[<span class="hljs-meta">Category(<span class="hljs-string">"Round Button"</span>)</span>]
<span class="hljs-keyword">public</span> Color BorderColor
{
    <span class="hljs-keyword">get</span> =&gt; borderColor;
    <span class="hljs-keyword">set</span>
    {
        borderColor = <span class="hljs-keyword">value</span>;
        Invalidate();
    }
}

[<span class="hljs-meta">Category(<span class="hljs-string">"Round Button"</span>)</span>]
<span class="hljs-keyword">public</span> Color BackgroundColor
{
    <span class="hljs-keyword">get</span> =&gt; BackColor;
    <span class="hljs-keyword">set</span> =&gt; BackColor = <span class="hljs-keyword">value</span>;
}

[<span class="hljs-meta">Category(<span class="hljs-string">"Round Button"</span>)</span>]
<span class="hljs-keyword">public</span> Color TextColor
{
    <span class="hljs-keyword">get</span> =&gt; ForeColor;
    <span class="hljs-keyword">set</span> =&gt; ForeColor = <span class="hljs-keyword">value</span>;
}
</code></pre>
<h4 data-id="heading-6">构造函数实现</h4>
<p>在构造函数中设置按钮的默认样式、尺寸和颜色，并绑定<code>Resize</code>事件以确保圆角不超过按钮高度。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RoundButton</span>()</span>
{
    FlatStyle = FlatStyle.Flat;
    FlatAppearance.BorderSize = <span class="hljs-number">0</span>;
    Size = <span class="hljs-keyword">new</span> Size(<span class="hljs-number">150</span>, <span class="hljs-number">40</span>);
    BackColor = Color.MediumSlateBlue;
    ForeColor = Color.White;
    Resize += <span class="hljs-keyword">new</span> EventHandler(Button_Resize);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Button_Resize</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    <span class="hljs-keyword">if</span> (borderRadius &gt; Height)
        borderRadius = Height;
}
</code></pre>
<h4 data-id="heading-7">圆角路径生成</h4>
<p>通过<code>GraphicsPath</code>对象实现圆角图形路径的生成，支持左上、右上、右下、左下四个方向的弧线绘制。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> GraphicsPath <span class="hljs-title">GetFigurePath</span>(<span class="hljs-params">Rectangle rect, <span class="hljs-built_in">float</span> radius</span>)</span>
{
    GraphicsPath path = <span class="hljs-keyword">new</span> GraphicsPath();
    <span class="hljs-built_in">float</span> curveSize = radius * <span class="hljs-number">2F</span>;
    path.StartFigure();
    <span class="hljs-comment">// 左上角</span>
    path.AddArc(rect.X, rect.Y, curveSize, curveSize, <span class="hljs-number">180</span>, <span class="hljs-number">90</span>);
    <span class="hljs-comment">// 右上角</span>
    path.AddArc(rect.Right - curveSize, rect.Y, curveSize, curveSize, <span class="hljs-number">270</span>, <span class="hljs-number">90</span>);
    <span class="hljs-comment">// 右下角</span>
    path.AddArc(rect.Right - curveSize, rect.Bottom - curveSize, curveSize, curveSize, <span class="hljs-number">0</span>, <span class="hljs-number">90</span>);
    <span class="hljs-comment">// 左下角</span>
    path.AddArc(rect.X, rect.Bottom - curveSize, curveSize, curveSize, <span class="hljs-number">90</span>, <span class="hljs-number">90</span>);
    path.CloseFigure();
    <span class="hljs-keyword">return</span> path;
}
</code></pre>
<h4 data-id="heading-8">重写OnPaint方法</h4>
<p>核心绘制逻辑位于<code>OnPaint</code>方法中，采用双层绘制机制：外层路径用于按钮整体形状与边缘抗锯齿处理，内层路径用于边框绘制。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPaint</span>(<span class="hljs-params">PaintEventArgs pevent</span>)</span>
{
    <span class="hljs-keyword">base</span>.OnPaint(pevent);
    Rectangle rectSurface = ClientRectangle;
    Rectangle rectBorder = Rectangle.Inflate(rectSurface, -borderSize, -borderSize);
    <span class="hljs-built_in">int</span> smoothSize = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">if</span> (borderSize &gt; <span class="hljs-number">0</span>)
        smoothSize = borderSize;
    <span class="hljs-keyword">if</span> (borderRadius &gt; <span class="hljs-number">2</span>) <span class="hljs-comment">// 圆角按钮</span>
    {
        <span class="hljs-keyword">using</span> (GraphicsPath pathSurface = GetFigurePath(rectSurface, borderRadius))
        <span class="hljs-keyword">using</span> (GraphicsPath pathBorder = GetFigurePath(rectBorder, borderRadius - borderSize))
        <span class="hljs-keyword">using</span> (Pen penSurface = <span class="hljs-keyword">new</span> Pen(Parent.BackColor, smoothSize))
        <span class="hljs-keyword">using</span> (Pen penBorder = <span class="hljs-keyword">new</span> Pen(borderColor, borderSize))
        {
            pevent.Graphics.SmoothingMode = SmoothingMode.AntiAlias;
            Region = <span class="hljs-keyword">new</span> Region(pathSurface);
            pevent.Graphics.DrawPath(penSurface, pathSurface);
            <span class="hljs-keyword">if</span> (borderSize &gt;= <span class="hljs-number">1</span>)
                pevent.Graphics.DrawPath(penBorder, pathBorder);
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// 普通按钮</span>
    {
        pevent.Graphics.SmoothingMode = SmoothingMode.None;
        Region = <span class="hljs-keyword">new</span> Region(rectSurface);
        <span class="hljs-keyword">if</span> (borderSize &gt;= <span class="hljs-number">1</span>)
        {
            <span class="hljs-keyword">using</span> (Pen penBorder = <span class="hljs-keyword">new</span> Pen(borderColor, borderSize))
            {
                penBorder.Alignment = PenAlignment.Inset;
                pevent.Graphics.DrawRectangle(penBorder, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Width - <span class="hljs-number">1</span>, Height - <span class="hljs-number">1</span>);
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">处理父容器颜色变化</h4>
<p>为确保按钮在父容器背景颜色变化时能正确刷新，需监听<code>BackColorChanged</code>事件并调用<code>Invalidate()</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnHandleCreated</span>(<span class="hljs-params">EventArgs e</span>)</span>
{
    <span class="hljs-keyword">base</span>.OnHandleCreated(e);
    Parent.BackColorChanged += Container_BackColorChanged;
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Container_BackColorChanged</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    Invalidate();
}
</code></pre>
<h3 data-id="heading-10">双层绘制机制详解</h3>
<p>外层路径(<code>pathSurface</code>)：定义按钮的整体形状，并用于绘制边缘抗锯齿线条。</p>
<p>内层路径(<code>pathBorder</code>)：根据边框大小计算出内部矩形区域，并用于绘制实际的边框。</p>
<p>代码示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPaint</span>(<span class="hljs-params">PaintEventArgs pevent</span>)</span>
{
    <span class="hljs-keyword">base</span>.OnPaint(pevent);
    Rectangle rectSurface = ClientRectangle;
    Rectangle rectBorder = Rectangle.Inflate(rectSurface, -borderSize, -borderSize);
    <span class="hljs-built_in">int</span> smoothSize = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">if</span> (borderSize &gt; <span class="hljs-number">0</span>) smoothSize = borderSize;

    <span class="hljs-keyword">if</span> (borderRadius &gt; <span class="hljs-number">2</span>)
    {
        <span class="hljs-keyword">using</span> (GraphicsPath pathSurface = GetFigurePath(rectSurface, borderRadius))
        <span class="hljs-keyword">using</span> (GraphicsPath pathBorder = GetFigurePath(rectBorder, borderRadius - borderSize))
        <span class="hljs-keyword">using</span> (Pen penSurface = <span class="hljs-keyword">new</span> Pen(Parent.BackColor, smoothSize))
        <span class="hljs-keyword">using</span> (Pen penBorder = <span class="hljs-keyword">new</span> Pen(borderColor, borderSize))
        {
            pevent.Graphics.SmoothingMode = SmoothingMode.AntiAlias;
            Region = <span class="hljs-keyword">new</span> Region(pathSurface);
            pevent.Graphics.DrawPath(penSurface, pathSurface);
            <span class="hljs-keyword">if</span> (borderSize &gt;= <span class="hljs-number">1</span>)
                pevent.Graphics.DrawPath(penBorder, pathBorder);
        }
    }
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过继承<code>Button</code>类并结合GDI+绘图技术，我们成功实现了一个功能丰富、视觉效果出色的<strong>自定义圆角按钮控件</strong>。</p>
<p>该控件不仅具备良好的扩展性，还采用了双层绘制机制，确保了圆角的平滑性和边框的准确性。</p>
<p>可以根据项目需求自由调整边框大小、圆角半径、颜色等参数，从而满足多样化的UI设计需求。</p>
<h3 data-id="heading-12">关键词</h3>
<p>WinForms、GDI+、自定义控件、圆角按钮、双层绘制、抗锯齿、GraphicsPath、Pen、SmoothingMode、Region</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db8d8df90c0b4320898f7b24dbdd9ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56CB57yW5Yyg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935304&amp;x-signature=imxfGrEO0atzYi2i%2B7MchxLqb0s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">最后</h3>
<p>如果你觉得这篇文章对你有帮助，不妨点个赞支持一下！你的支持是我继续分享知识的动力。如果有任何疑问或需要进一步的帮助，欢迎随时留言。</p>
<p>也可以加入微信公众号 <strong>[DotNet技术匠]</strong> 社区，与其他热爱技术的同行一起交流心得，共同成长！</p>
<p><strong>优秀是一种习惯，欢迎大家留言学习！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 实现QPS监控：别等系统“咳血”了才想起装“心电图”！]]></title>    <link>https://juejin.cn/post/7581728606308139060</link>    <guid>https://juejin.cn/post/7581728606308139060</guid>    <pubDate>2025-12-10T01:20:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606308139060" data-draft-id="7581752787563561000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 实现QPS监控：别等系统“咳血”了才想起装“心电图”！"/> <meta itemprop="keywords" content="后端,Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-12-10T01:20:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悟空码字"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 实现QPS监控：别等系统“咳血”了才想起装“心电图”！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    悟空码字
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:20:24.000Z" title="Wed Dec 10 2025 01:20:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小悟。</p>
<h2 data-id="heading-0">一、什么是QPS？—— 系统的"心跳频率" 💗</h2>
<p>想象一下你的系统就像一个忙碌的外卖小哥，QPS（Query Per Second）就是他每秒能送多少份外卖！如果小哥每秒只能送1单，那估计顾客早就饿晕在厕所了；要是每秒能送100单，那他绝对是"闪电侠"附体！</p>
<p>正常系统的QPS就像人的心跳：</p>
<ul>
<li><strong>60-100 QPS</strong>：健康小伙子，心跳平稳</li>
<li><strong>100-1000 QPS</strong>：健身达人，有点小激动</li>
<li><strong>1000+ QPS</strong>：跑马拉松呢！快喘口气！</li>
<li><strong>10000+ QPS</strong>：这货是打了鸡血吧？</li>
</ul>
<h2 data-id="heading-1">二、方案大比拼——给系统装上"智能手环"</h2>
<h3 data-id="heading-2">方案1：简易版手环（AOP拦截器）</h3>
<p>适合小项目，就像给系统戴个手环</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QpsMonitorAspect</span> {
    
    <span class="hljs-comment">// 用ConcurrentHashMap存计数器，线程安全！</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, AtomicLong&gt; counterMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"QPS监控龟龟已启动，开始慢慢爬..."</span>);
        <span class="hljs-comment">// 每秒统计一次，像乌龟一样稳定</span>
        scheduler.scheduleAtFixedRate(<span class="hljs-built_in">this</span>::printQps, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS);
    }
    
    <span class="hljs-meta">@Around("@annotation(org.springframework.web.bind.annotation.GetMapping) || " +
            "@annotation(org.springframework.web.bind.annotation.PostMapping)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">countQps</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().toShortString();
        
        <span class="hljs-comment">// 计数器自增，像小松鼠囤松果一样积极</span>
        counterMap.computeIfAbsent(methodName, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>))
                 .incrementAndGet();
        
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> joinPoint.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">cost</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;
            <span class="hljs-comment">// 顺便记录一下响应时间，看看系统是不是"老了腿脚慢"</span>
            <span class="hljs-keyword">if</span> (cost &gt; <span class="hljs-number">1000</span>) {
                log.warn(<span class="hljs-string">"方法 {} 执行了 {}ms，比蜗牛还慢！"</span>, methodName, cost);
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printQps</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (counterMap.isEmpty()) {
            log.info(<span class="hljs-string">"系统在睡大觉，没有请求..."</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"\n========== QPS报告 ==========\n"</span>);
        counterMap.forEach((method, counter) -&gt; {
            <span class="hljs-type">long</span> <span class="hljs-variable">qps</span> <span class="hljs-operator">=</span> counter.getAndSet(<span class="hljs-number">0</span>); <span class="hljs-comment">// 重置计数器</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
            <span class="hljs-keyword">if</span> (qps &gt; <span class="hljs-number">1000</span>) status = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">if</span> (qps &gt; <span class="hljs-number">5000</span>) status = <span class="hljs-string">""</span>;
            
            sb.append(String.format(<span class="hljs-string">"%s %-40s : %d QPS%n"</span>, 
                    status, method, qps));
        });
        sb.append(<span class="hljs-string">"================================"</span>);
        log.info(sb.toString());
    }
}
</code></pre>
<h3 data-id="heading-3">方案2：专业版体检仪（Micrometer + Prometheus）</h3>
<p>适合大项目，就像给系统做全面体检</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricsConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MeterRegistryCustomizer</span>&lt;<span class="hljs-title class_">MeterRegistry</span>&gt; <span class="hljs-title function_">metricsCommonTags</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> registry -&gt; {
            registry.<span class="hljs-title function_">config</span>().<span class="hljs-title function_">commonTags</span>(<span class="hljs-string">"application"</span>, <span class="hljs-string">"my-awesome-app"</span>);
            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"系统体检中心开业啦！欢迎随时来检查身体~"</span>);
        };
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Counter</span> orderCounter;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Timer</span> orderTimer;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">MeterRegistry</span> meterRegistry;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderService</span>(<span class="hljs-title class_">MeterRegistry</span> meterRegistry) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">meterRegistry</span> = meterRegistry;
        
        <span class="hljs-comment">// 创建订单计数器，像收银机一样"叮叮叮"</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderCounter</span> = <span class="hljs-title class_">Counter</span>.<span class="hljs-title function_">builder</span>(<span class="hljs-string">"order.count"</span>)
                .<span class="hljs-title function_">description</span>(<span class="hljs-string">"订单数量统计"</span>)
                .<span class="hljs-title function_">tag</span>(<span class="hljs-string">"type"</span>, <span class="hljs-string">"create"</span>)
                .<span class="hljs-title function_">register</span>(meterRegistry);
        
        <span class="hljs-comment">// 创建订单耗时计时器</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderTimer</span> = <span class="hljs-title class_">Timer</span>.<span class="hljs-title function_">builder</span>(<span class="hljs-string">"order.process.time"</span>)
                .<span class="hljs-title function_">description</span>(<span class="hljs-string">"订单处理时间"</span>)
                .<span class="hljs-title function_">register</span>(meterRegistry);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Order</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params">OrderDTO dto</span>) {
        <span class="hljs-comment">// 记录方法执行时间</span>
        <span class="hljs-keyword">return</span> orderTimer.<span class="hljs-title function_">record</span>(() -&gt; {
            log.<span class="hljs-title function_">debug</span>(<span class="hljs-string">"正在打包订单，请稍候..."</span>);
            
            <span class="hljs-comment">// 业务逻辑...</span>
            <span class="hljs-title class_">Order</span> order = <span class="hljs-title function_">doCreateOrder</span>(dto);
            
            <span class="hljs-comment">// 订单创建成功，计数器+1</span>
            orderCounter.<span class="hljs-title function_">increment</span>();
            
            <span class="hljs-comment">// 动态QPS统计（最近1分钟）</span>
            double qps = meterRegistry.<span class="hljs-title function_">get</span>(<span class="hljs-string">"order.count"</span>)
                    .<span class="hljs-title function_">counter</span>()
                    .<span class="hljs-title function_">measure</span>()
                    .<span class="hljs-title function_">stream</span>()
                    .<span class="hljs-title function_">findFirst</span>()
                    .<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Measurement</span>::getValue)
                    .<span class="hljs-title function_">orElse</span>(<span class="hljs-number">0.0</span>) / <span class="hljs-number">60.0</span>;
            
            <span class="hljs-keyword">if</span> (qps &gt; <span class="hljs-number">100</span>) {
                log.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"订单处理太快了！当前QPS: {}/s，考虑加点运费？"</span>, qps);
            }
            
            <span class="hljs-keyword">return</span> order;
        });
    }
    
    <span class="hljs-comment">// 动态查看QPS的API</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/metrics/qps"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">getRealTimeQps</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; metrics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 收集所有接口的QPS</span>
        meterRegistry.<span class="hljs-title function_">getMeters</span>().<span class="hljs-title function_">forEach</span>(meter -&gt; {
            <span class="hljs-title class_">String</span> meterName = meter.<span class="hljs-title function_">getId</span>().<span class="hljs-title function_">getName</span>();
            <span class="hljs-keyword">if</span> (meterName.<span class="hljs-title function_">contains</span>(<span class="hljs-string">".count"</span>)) {
                double qps = meter.<span class="hljs-title function_">counter</span>().<span class="hljs-title function_">count</span>() / <span class="hljs-number">60.0</span>; <span class="hljs-comment">// 转换为每秒</span>
                metrics.<span class="hljs-title function_">put</span>(meterName, <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"%.2f QPS"</span>, qps));
                
                <span class="hljs-comment">// 添加表情包增强可视化效果</span>
                <span class="hljs-title class_">String</span> emoji = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (qps &gt; <span class="hljs-number">100</span>) emoji = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (qps &gt; <span class="hljs-number">500</span>) emoji = <span class="hljs-string">""</span>;
                metrics.<span class="hljs-title function_">put</span>(meterName + <span class="hljs-string">"_emoji"</span>, emoji);
            }
        });
        
        metrics.<span class="hljs-title function_">put</span>(<span class="hljs-string">"report_time"</span>, <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());
        metrics.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"系统当前状态良好，吃嘛嘛香！"</span>);
        
        <span class="hljs-keyword">return</span> metrics;
    }
}
</code></pre>
<h3 data-id="heading-4">方案3：豪华版监控大屏（Spring Boot Admin）</h3>
<p>给老板看的，必须高大上！</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">boot:</span>
    <span class="hljs-attr">admin:</span>
      <span class="hljs-attr">client:</span>
        <span class="hljs-attr">url:</span> <span class="hljs-string">http://localhost:9090</span>  <span class="hljs-comment"># Admin Server地址</span>
        <span class="hljs-attr">instance:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">"青龙系统"</span>
          <span class="hljs-attr">metadata:</span>
            <span class="hljs-attr">owner:</span> <span class="hljs-string">"码农小张"</span>
            <span class="hljs-attr">department:</span> <span class="hljs-string">"爆肝事业部"</span>

<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">"*"</span>  <span class="hljs-comment"># 暴露所有端点，不穿"隐身衣"</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">export:</span>
      <span class="hljs-attr">prometheus:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">show-details:</span> <span class="hljs-string">ALWAYS</span>
</code></pre>

<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QpsDashboardController</span> {
    
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/dashboard/qps"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> qpsDashboard() {
        <span class="hljs-comment">// 模拟从各个服务收集QPS数据</span>
        <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; serviceQps <span class="hljs-operator">=</span> getClusterQps();
        
        <span class="hljs-comment">// 生成ASCII艺术报表</span>
        <span class="hljs-type">StringBuilder</span> dashboard <span class="hljs-operator">=</span> new <span class="hljs-type">StringBuilder</span>();
        dashboard.append(<span class="hljs-string">"<span class="hljs-subst">\n</span>"</span>);
        dashboard.append(<span class="hljs-string">"╔══════════════════════════════════════════╗<span class="hljs-subst">\n</span>"</span>);
        dashboard.append(<span class="hljs-string">"║        系统QPS监控大屏                     ║<span class="hljs-subst">\n</span>"</span>);
        dashboard.append(<span class="hljs-string">"╠══════════════════════════════════════════╣<span class="hljs-subst">\n</span>"</span>);
        
        serviceQps.forEach((service, qps) -&gt; {
            <span class="hljs-comment">// 生成进度条</span>
            int bars <span class="hljs-operator">=</span> (int) <span class="hljs-type">Math</span>.min(qps <span class="hljs-operator">/</span> <span class="hljs-number">10</span>, <span class="hljs-number">50</span>);
            <span class="hljs-type">String</span> progressBar <span class="hljs-operator">=</span> <span class="hljs-string">"█"</span>.repeat(bars) <span class="hljs-operator">+</span> 
                               <span class="hljs-string">"░"</span>.repeat(<span class="hljs-number">50</span> <span class="hljs-operator">-</span> bars);
            
            <span class="hljs-type">String</span> status <span class="hljs-operator">=</span> <span class="hljs-string">"正常"</span>;
            <span class="hljs-keyword">if</span> (qps <span class="hljs-operator">&gt;</span> <span class="hljs-number">500</span>) status <span class="hljs-operator">=</span> <span class="hljs-string">"警告"</span>;
            <span class="hljs-keyword">if</span> (qps <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>) status <span class="hljs-operator">=</span> <span class="hljs-string">"紧急"</span>;
            
            dashboard.append(<span class="hljs-type">String</span>.format(<span class="hljs-string">"║ %-15s : %-30s ║<span class="hljs-subst">\n</span>"</span>, 
                    service, progressBar));
            dashboard.append(<span class="hljs-type">String</span>.format(<span class="hljs-string">"║   %6.1f QPS %-20s        ║<span class="hljs-subst">\n</span>"</span>, 
                    qps, status));
        });
        
        dashboard.append(<span class="hljs-string">"╚══════════════════════════════════════════╝<span class="hljs-subst">\n</span>"</span>);
        
        <span class="hljs-comment">// 添加系统健康建议</span>
        dashboard.append(<span class="hljs-string">"<span class="hljs-subst">\n</span> 系统建议：<span class="hljs-subst">\n</span>"</span>);
        double maxQps <span class="hljs-operator">=</span> serviceQps.values().stream().max(Double::compare).orElse(<span class="hljs-number">0.0</span>);
        <span class="hljs-keyword">if</span> (maxQps <span class="hljs-operator">&lt;</span> <span class="hljs-number">50</span>) {
            dashboard.append(<span class="hljs-string">"   系统有点闲，可以考虑接点私活~ <span class="hljs-subst">\n</span>"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (maxQps <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>) {
            dashboard.append(<span class="hljs-string">"   系统快冒烟了！快加机器！<span class="hljs-subst">\n</span>"</span>);
        } <span class="hljs-keyword">else</span> {
            dashboard.append(<span class="hljs-string">"   状态完美，继续保持！<span class="hljs-subst">\n</span>"</span>);
        }
        
        <span class="hljs-keyword">return</span> dashboard.toString();
    }
    
    <span class="hljs-comment">// 定时推送QPS警告</span>
    <span class="hljs-meta">@Scheduled</span>(fixedRate <span class="hljs-operator">=</span> <span class="hljs-number">60000</span>)
    <span class="hljs-keyword">public</span> void checkQpsAlert() {
        <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; currentQps <span class="hljs-operator">=</span> getClusterQps();
        
        currentQps.forEach((service, qps) -&gt; {
            <span class="hljs-keyword">if</span> (qps <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>) {
                log.error(<span class="hljs-string">"救命！{}服务QPS爆表了：{}，快看看是不是被爬了！"</span>, 
                         service, qps);
                <span class="hljs-comment">// 这里可以接入钉钉/企业微信告警</span>
                sendAlertToDingTalk(service, qps);
            }
        });
    }
    
    <span class="hljs-keyword">private</span> void sendAlertToDingTalk(<span class="hljs-type">String</span> service, double qps) {
        <span class="hljs-type">String</span> message <span class="hljs-operator">=</span> <span class="hljs-type">String</span>.format(
            <span class="hljs-string">"{<span class="hljs-subst">\"</span>msgtype<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>text<span class="hljs-subst">\"</span>, <span class="hljs-subst">\"</span>text<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>content<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>%s服务QPS异常：%.1f，快去看看吧！<span class="hljs-subst">\"</span>}}"</span>,
            service, qps
        );
        <span class="hljs-comment">// 调用钉钉webhook</span>
        log.warn(<span class="hljs-string">"已发送钉钉告警：{}"</span>, message);
    }
}
</code></pre>
<h2 data-id="heading-5">三、方案详细实施步骤</h2>
<h3 data-id="heading-6">方案1实施步骤（简易版）：</h3>
<ol>
<li><strong>添加依赖</strong>：给你的<code>pom.xml</code>来点"维生素"</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ol>
<li><strong>启用AOP</strong>：在主类上贴个"创可贴"</li>
</ol>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-variable">@EnableAspectJAutoProxy</span>  <span class="hljs-comment">// 启用AOP魔法</span>
public class Application {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application.class, args);
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"QPS监控小鸡破壳而出！"</span>);
    }
}
</code></pre>
<ol>
<li><strong>创建切面类</strong>：如上文的<code>QpsMonitorAspect</code></li>
<li><strong>测试一下</strong>：疯狂刷新接口，看看控制台输出</li>
</ol>
<h3 data-id="heading-7">方案2实施步骤（专业版）：</h3>
<ol>
<li><strong>添加全家桶依赖</strong>：</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micrometer-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ol>
<li><strong>配置application.yml</strong>：</li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,metrics,prometheus</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">export:</span>
      <span class="hljs-attr">prometheus:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-attr">application:</span> <span class="hljs-string">${spring.application.name}</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">metrics:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<ol>
<li><strong>访问监控数据</strong>：</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">http://localhost:8080/actuator/metrics  <span class="hljs-comment"># 查看所有指标</span>
http://localhost:8080/actuator/prometheus  <span class="hljs-comment"># Prometheus格式</span>
</code></pre>
<h3 data-id="heading-8">方案3实施步骤（豪华版）：</h3>
<ol>
<li><strong>搭建Spring Boot Admin Server</strong>：</li>
</ol>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-variable">@EnableAdminServer</span>
public class AdminServerApplication {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(AdminServerApplication.class, args);
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"监控大屏已就位，陛下请检阅！"</span>);
    }
}
</code></pre>
<ol>
<li><strong>客户端配置</strong>：如上文yml配置</li>
<li><strong>访问Admin UI</strong>：<code>http://localhost:9090</code></li>
</ol>
<h2 data-id="heading-9">四、QPS统计的进阶技巧</h2>
<h3 data-id="heading-10">1. 滑动窗口统计（最近N秒的QPS）</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlidingWindowQpsCounter</span> {
    <span class="hljs-comment">// 用环形队列实现滑动窗口</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LinkedList&lt;Long&gt; timestamps = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> windowSeconds;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SlidingWindowQpsCounter</span><span class="hljs-params">(<span class="hljs-type">int</span> windowSeconds)</span> </span>{
        <span class="hljs-keyword">this</span>.windowSeconds = windowSeconds;
        log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"创建滑动窗口监控，窗口大小：{}秒"</span>, windowSeconds);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">void</span> <span class="hljs-title">hit</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">long</span> now = System.<span class="hljs-built_in">currentTimeMillis</span>();
        timestamps.<span class="hljs-built_in">add</span>(now);
        <span class="hljs-comment">// 移除窗口外的记录</span>
        <span class="hljs-keyword">while</span> (!timestamps.<span class="hljs-built_in">isEmpty</span>() &amp;&amp; 
               now - timestamps.<span class="hljs-built_in">getFirst</span>() &gt; windowSeconds * <span class="hljs-number">1000</span>) {
            timestamps.<span class="hljs-built_in">removeFirst</span>();
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title">getQps</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> timestamps.<span class="hljs-built_in">size</span>() / (<span class="hljs-type">double</span>) windowSeconds;
    }
}
</code></pre>
<h3 data-id="heading-11">2. 分位数统计（P90/P95/P99响应时间）</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Bean</span>
public MeterRegistryCustomizer&lt;MeterRegistry&gt; addQuantiles() {
    return registry -&gt; {
        DistributionStatisticConfig config = DistributionStatisticConfig<span class="hljs-selector-class">.builder</span>()
                <span class="hljs-selector-class">.percentiles</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">0.99</span>)  <span class="hljs-comment">// 50%, 90%, 95%, 99%</span>
                <span class="hljs-selector-class">.percentilePrecision</span>(<span class="hljs-number">2</span>)
                <span class="hljs-selector-class">.build</span>();
        
        registry<span class="hljs-selector-class">.config</span>()<span class="hljs-selector-class">.meterFilter</span>(
            new MeterFilter() {
                <span class="hljs-keyword">@Override</span>
                public DistributionStatisticConfig configure(
                    Meter.Id id, DistributionStatisticConfig config) {
                    if (id.getName()<span class="hljs-selector-class">.contains</span>(".timer")) {
                        return config<span class="hljs-selector-class">.merge</span>(DistributionStatisticConfig.builder()
                                <span class="hljs-selector-class">.percentiles</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">0.99</span>)
                                <span class="hljs-selector-class">.build</span>());
                    }
                    return config;
                }
            }
        );
        
        log<span class="hljs-selector-class">.info</span>("分位数统计已启用，准备精准打击慢查询！");
    };
}
</code></pre>
<h3 data-id="heading-12">3. 基于QPS的自动熔断</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveCircuitBreaker</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">circuitOpen</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-variable">currentQps</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-meta">@Scheduled(fixedRate = 1000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorAndAdjust</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前QPS</span>
        currentQps = calculateCurrentQps();
        
        <span class="hljs-keyword">if</span> (circuitOpen &amp;&amp; currentQps &lt; <span class="hljs-number">100</span>) {
            circuitOpen = <span class="hljs-literal">false</span>;
            log.info(<span class="hljs-string">"熔断器关闭，系统恢复供电！当前QPS: {}"</span>, currentQps);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!circuitOpen &amp;&amp; currentQps &gt; <span class="hljs-number">1000</span>) {
            circuitOpen = <span class="hljs-literal">true</span>;
            log.error(<span class="hljs-string">"熔断器触发！QPS过高: {}，系统进入保护模式"</span>, currentQps);
        }
        
        <span class="hljs-comment">// 动态调整线程池大小</span>
        adjustThreadPool(currentQps);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustThreadPool</span><span class="hljs-params">(<span class="hljs-type">double</span> qps)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">suggestedSize</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (qps * <span class="hljs-number">0.5</span>);  <span class="hljs-comment">// 经验公式</span>
        log.debug(<span class="hljs-string">"建议线程池大小调整为: {} (基于QPS: {})"</span>, suggestedSize, qps);
    }
}
</code></pre>
<h2 data-id="heading-13">五、总结：给系统做QPS监控就像...</h2>
<h3 data-id="heading-14">1. <strong>为什么要监控QPS？</strong></h3>
<ul>
<li><strong>对系统</strong>：就像给汽车装时速表，超速了会报警</li>
<li><strong>对开发</strong>：就像给程序员装"健康手环"，代码跑太快会冒烟</li>
<li><strong>对老板</strong>：就像给公司装"业绩大屏"，数字好看心情好</li>
</ul>
<h3 data-id="heading-15">2. <strong>各方案选择建议</strong>：</h3>
<ul>
<li><strong>初创公司/小项目</strong>：用方案1，简单粗暴见效快，就像"创可贴"</li>
<li><strong>中型项目/微服务</strong>：用方案2，全面体检不遗漏，就像"年度体检"</li>
<li><strong>大型分布式系统</strong>：用方案3，全景监控无死角，就像"卫星监控"</li>
</ul>
<h3 data-id="heading-16">3. <strong>最佳实践提醒</strong>：</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 记住这些黄金法则：</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QpsGoldenRules</span> {
    <span class="hljs-comment">// 法则1：监控不是为了监控而监控</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> RULE_1 = <span class="hljs-string">"别让监控把系统压垮了！"</span>;
    
    <span class="hljs-comment">// 法则2：告警要有意义</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> RULE_2 = <span class="hljs-string">"狼来了喊多了，就没人信了！"</span>;
    
    <span class="hljs-comment">// 法则3：数据要可视化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> RULE_3 = <span class="hljs-string">"老板看不懂的图表都是废纸！"</span>;
    
    <span class="hljs-comment">// 法则4：要有应对方案</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> RULE_4 = <span class="hljs-string">"光报警不解决，要你有何用？"</span>;
}
</code></pre>
<h3 data-id="heading-17">4. <strong>最后总结</strong>：</h3>
<p>给你的系统加QPS监控，就像是：</p>
<ul>
<li><strong>给外卖小哥配了计步器</strong> —— 知道他每天跑多少</li>
<li><strong>给程序员装了键盘计数器</strong> —— 知道他有多卷</li>
<li><strong>给系统装了"心电图机"</strong> —— 随时掌握生命体征</li>
</ul>
<p>记住，一个健康的系统应该：</p>
<ul>
<li>平时 <strong>心跳平稳</strong>（QPS稳定）</li>
<li>大促时 <strong>适当兴奋</strong>（弹性扩容）</li>
<li>故障时 <strong>自动降压</strong>（熔断降级）</li>
</ul>
<p>现在就去给你的SpringBoot系统装上"智能手环"吧！让它在代码的海洋里，游得更快、更稳、更健康！</p>
<p><strong>最后的最后</strong>：监控千万条，稳定第一条；QPS不规范，运维两行泪！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/145930fb74f74197af4b3ec3f190de01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765934424&amp;x-signature=qek89Vz2xpa2rLHWI83HaeDzmG0%3D" alt="SpringBoot 实现QPS监控：别等系统“咳血”了才想起装“心电图”！.png" loading="lazy"/></p>
<p><strong>谢谢你看我的文章，既然看到这里了，如果觉得不错，随手点个赞、转发、在看三连吧，感谢感谢。那我们，下次再见。</strong></p>
<p>您的一键三连，是我更新的最大动力，谢谢</p>
<p>山水有相逢，来日皆可期，谢谢阅读，我们再会</p>
<p>我手中的金箍棒，上能通天，下能探海</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI真能看懂你在做什么吗？计算机视觉如何驱动人类动作识别]]></title>    <link>https://juejin.cn/post/7581752787563872296</link>    <guid>https://juejin.cn/post/7581752787563872296</guid>    <pubDate>2025-12-10T01:59:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787563872296" data-draft-id="7581752787563823144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI真能看懂你在做什么吗？计算机视觉如何驱动人类动作识别"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-12-10T01:59:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI真能看懂你在做什么吗？计算机视觉如何驱动人类动作识别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:59:29.000Z" title="Wed Dec 10 2025 01:59:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>日常生活中充满了我们很少留意的小动作。穿过房间、坐在桌前、向朋友挥手，这些对我们来说轻而易举，但用人工智能来识别却远没有这么简单。对人类来说自然而然的事情，在机器试图理解时就变得复杂得多。</p>
<p>这种能力被称为人类动作识别（HAR），它让计算机能够检测并解读人类行为中的模式。健身应用就是HAR的一个典型例子——通过追踪步数和锻炼规律，它展示了AI如何监测日常活动。</p>
<p>看到了HAR的潜力，许多行业已开始采用这项技术。事实上，预计到2033年，人类动作识别市场规模将超过125.6亿美元。</p>
<p>这一进展很大程度上得益于计算机视觉的推动。作为人工智能的一个分支，它让机器能够分析图像、视频等视觉数据。借助计算机视觉和图像识别技术，HAR已从一个研究概念，发展成为前沿AI应用中实用而令人兴奋的一部分。</p>
<p>本文将探讨什么是HAR，识别人类动作的不同方法，以及计算机视觉如何帮助我们回答这个问题：AI能否在真实场景中检测人类动作？让我们开始吧！</p>
<h2 data-id="heading-0"><strong>什么是人类动作识别？</strong></h2>
<p>人类动作识别使计算机系统能够通过分析人体运动来理解人类的活动或行为。它不仅仅是检测图像中是否有人，更能帮助识别这个人在做什么。例如，区分走路和跑步、识别挥手动作，或者发现有人摔倒。</p>
<p>HAR的基础在于运动和姿势的模式。人体手臂或腿部位置的细微变化，可能对应着不同的动作。通过捕捉并解读这些细节，HAR系统可以从身体运动中提取出有意义的信息。</p>
<p>为了实现这一点，人类动作识别综合运用了机器学习、深度学习模型、计算机视觉和图像处理等多种技术，共同分析身体运动，从而更准确地解读人类行为。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c59ecece460947629f41ca1f99890cde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=ZXzA6q8mprTy9sae04Vhotq85lc%3D" alt="screenshot_2025-12-09_16-46-47.png" loading="lazy"/></p>
<p>早期的HAR系统功能有限，通常只能在受控环境中处理少数简单、重复的动作，且难以应对真实场景。</p>
<p>如今，得益于AI和海量视频数据，HAR在准确性和鲁棒性上都取得了显著进步。现代系统能够以更高的精度识别多种活动，使得该技术在医疗保健、安防、交互设备等领域具备了实用价值。</p>
<h2 data-id="heading-1"><strong>检测人类动作的不同方法</strong></h2>
<p>了解了人类动作识别的基本概念后，我们来看看机器检测人类动作的几种常见方式：</p>
<ul>
<li><strong>基于传感器的方法：</strong> 加速度计、可穿戴设备、智能手机等智能设备可以直接从人体捕获信号。它们能显示行走、奔跑甚至静止等运动模式。智能手表上的计步器就是这种方法的一个典型例子。</li>
<li><strong>基于视觉的方法：</strong> 摄像头结合计算机视觉，逐帧分析图像和视频，追踪人体的外观和运动。这使得识别更复杂的活动成为可能。手势控制的电视或游戏系统就依赖于这种方法。</li>
<li><strong>多模态方法：</strong> 结合传感器和摄像头，构建更可靠的系统。一种来源可以验证另一种来源的检测结果。例如，可穿戴设备记录运动，而摄像头验证姿势，这种设置常用于老年人护理中的摔倒检测。</li>
</ul>
<h2 data-id="heading-2"><strong>数据集在人类动作识别中的作用</strong></h2>
<p>对于任何HAR模型或系统来说，数据集都是起点。一个HAR数据集包含视频片段、图像或传感器数据等样本，记录了行走、坐下、挥手等动作。这些样本用于训练AI模型识别人类运动模式，进而应用于实际场景。</p>
<p>训练数据的质量直接影响模型的性能。干净、一致的数据使系统更容易准确识别动作。</p>
<p>因此，数据集在训练前通常需要进行预处理。一个常见的步骤是归一化，即统一缩放数值，以减少误差并防止过拟合（模型在训练数据上表现良好，但遇到新数据时则不佳）。</p>
<p>为了衡量模型在训练之外的表现，研究人员依赖于评估指标和基准数据集，以便进行公平的测试和比较。像UCF101、HMDB51和Kinetics这样的流行数据集包含了成千上万段标记好的视频片段，用于人类动作检测。在传感器方面，从智能手机和可穿戴设备收集的数据集提供了宝贵的运动信号，使得识别模型在不同环境下更加稳健。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6612acbb55fc4db49b6fb2d78b98de8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=qaTGfBJjCygFqE%2Fl2lsFc43dzSI%3D" alt="screenshot_2025-12-09_16-47-16.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>计算机视觉如何支持人类动作识别</strong></h2>
<p>在各种检测人类动作的方法中，计算机视觉迅速成为最受欢迎和研究最广泛的方向之一。它的关键优势在于可以直接从图像和视频中提取丰富的细节。通过逐帧分析像素并研究运动模式，它可以实时识别活动，而无需人们佩戴额外设备。</p>
<p>近年来，深度学习（尤其是专为图像分析设计的卷积神经网络）的进步，使得计算机视觉更快、更准、更可靠。</p>
<p>例如，广泛使用的先进计算机视觉模型，如 YOLO11，正是基于这些进步构建的。YOLO11支持物体检测、实例分割、跨视频帧的人物跟踪以及人体姿态估计等任务，这使它成为人类动作识别的一个强大工具。</p>
<ul>
<li><strong>YOLO11概述</strong></li>
</ul>
<p>YOLO11是一款兼顾速度与精度的视觉AI模型。它支持物体检测、物体跟踪、姿态估计等核心计算机视觉任务，这些能力对人类动作识别尤其有用。</p>
<p>物体检测识别并定位场景中的人。</p>
<p>跟踪在视频帧中跟随人的移动，以识别动作序列。</p>
<p>姿态估计映射人体关键关节，以区分相似活动或检测如摔倒之类的突发变化。</p>
<p>例如，利用该模型的洞察力，可以区分一个人从安静坐着，到站起来，再到举起手臂欢呼这一系列动作。这些简单的日常行为乍看相似，但在序列分析中却承载着完全不同的含义。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec9aab5668d425893cf0c1e7dd488e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=yDXDmtqtlgxJwesrr5262%2FELIZQ%3D" alt="screenshot_2025-12-09_16-47-27.png" loading="lazy"/></p>
<p>然而，将这些先进的模型转化为实际场景中稳定、可用的应用，仍然面临着数据处理复杂、模型迭代周期长、部署运维门槛高等一系列挑战。这正是 Coovally 这类AI开发平台旨在解决的问题。从数据集的集中管理与智能标注，到自动化模型训练、超参调优与性能评估，再到最终的一键模型部署与持续监控，Coovally为开发者和企业团队提供了端到端的工具链。这意味着，无论是基于YOLO11构建新的行为识别模型，还是对现有算法进行优化和规模化部署，团队都可以在同一个协同平台上高效完成，从而将更多精力集中于核心业务逻辑与创新，加速HAR技术从实验室走向真实世界的步伐。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45d0ba0724e84f6d8dbb659c6f53dad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=Pe%2BKga6vV5Z65KkIuZqEjr4qkac%3D" alt="Coovally操作动图.gif" loading="lazy"/></p>
<p>Coovally平台不仅提供模型资源，还可以帮助你提供<strong>AI解决方案</strong>，可以扫描二维码，我们来给你提供解决方案！！</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e0116df22b34e3fa6690f8593b8dce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=0RIXdR%2FBasw8NQnNcsM4yYap5zo%3D" alt="小助手二维码.png" loading="lazy"/></p>
<p>点击<strong>阅读原文</strong>，即可体验Coovally平台！</p>
<h2 data-id="heading-4"><strong>计算机视觉与HAR的实际应用</strong></h2>
<p>接下来，让我们具体看看基于计算机视觉的人类动作识别如何应用于影响日常生活的实际场景中。</p>
<ul>
<li><strong>医疗保健与健康</strong></li>
</ul>
<p>在医疗领域，运动中的细微变化能提供有关个人状况的重要信息。例如，老年患者的踉跄，或者康复过程中肢体的角度，都可能揭示风险或进展。这些迹象在传统检查方式下很容易被忽略。</p>
<p>YOLO11可以通过姿态估计和图像分析实时监测患者，提供帮助。它可以用于检测摔倒、追踪康复锻炼情况，并观察行走、伸展等日常活动。由于它通过视觉分析工作，无需传感器或可穿戴设备，因此为收集支持患者护理的准确信息提供了一种简便方法。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/536cc84392cb4278a75c5d65629cb47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936768&amp;x-signature=2sfhrquHizjzu7TaSfh4jA8RnIo%3D" alt="screenshot_2025-12-09_16-47-34.png" loading="lazy"/></p>
<ul>
<li><strong>安防与监控</strong></li>
</ul>
<p>安防系统依赖快速检测异常人类活动，例如有人徘徊、在限制区域奔跑或突然表现出攻击性。在繁忙的环境中，安保人员无法手动监控一切，这些迹象常常被遗漏。这正是计算机视觉和YOLO11发挥作用的地方。</p>
<p>YOLO11通过驱动能够检测可疑动作并即时发出警报的实时视频监控，让安防监控变得更高效。它有助于维护公共空间的人群安全，并加强私人区域的入侵检测。</p>
<p>通过这种方式，安保人员可以与计算机视觉系统协同工作，形成人机互动与协作，从而更快、更及时地对可疑活动做出反应。</p>
<h2 data-id="heading-5"><strong>使用计算机视觉进行 HAR 的优缺点</strong></h2>
<p>以下是使用计算机视觉进行人体活动识别的一些优势：</p>
<ul>
<li><strong>可扩展性：</strong> 设置完成后，同一识别系统可以自动同时监控多人，使其可用于医疗机构、工厂和公共场所的自动化。</li>
<li><strong>实时处理：</strong> 视觉 AI 解决方案 可用于分析正在发生的视频流，从而实现更快的响应。</li>
<li><strong>非侵入式跟踪：</strong> 与可穿戴设备或传感器不同，它不需要人们携带设备，从而可以进行自然而轻松的行为分析。 </li>
</ul>
<p>虽然使用计算机视觉进行 HAR 有很多好处，但也存在一些局限性需要考虑。以下是一些需要记住的因素：  </p>
<ul>
<li><strong>隐私问题：</strong> 基于视频的监控可能会引发关于数据保护和同意的问题，尤其是在家庭或工作场所等敏感环境中。</li>
<li><strong>潜在偏差：</strong> 如果训练数据集缺乏多样性，算法可能会错误地解释某些人群的行为，从而导致不公平或不准确的结果。</li>
<li><strong>环境敏感性：</strong> 由于光线不足、背景杂乱或人员部分隐藏，准确性可能会下降，这意味着需要仔细设计系统。</li>
</ul>
<h2 data-id="heading-6"><strong>总结</strong></h2>
<p>人工智能和计算机视觉使机器能够更准确、实时地识别人类行为。通过分析视频帧和运动模式，这些系统可以识别日常手势和突发变化。随着技术的不断进步，人类活动识别正在走出研究实验室，成为医疗保健、安全和日常应用的实用工具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 在高并发场景下基于MQ实现可靠短信发送机制]]></title>    <link>https://juejin.cn/post/7581741663183159331</link>    <guid>https://juejin.cn/post/7581741663183159331</guid>    <pubDate>2025-12-10T01:36:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581741663183159331" data-draft-id="7581752787563708456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 在高并发场景下基于MQ实现可靠短信发送机制"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-10T01:36:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天摸鱼的java工程师"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 在高并发场景下基于MQ实现可靠短信发送机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天摸鱼的java工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:36:39.000Z" title="Wed Dec 10 2025 01:36:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀 在高并发场景下基于MQ实现可靠短信发送机制</h2>
<blockquote>
<p>作者：天天摸鱼的java工程师 · 8年经验<br/>
标签：Java · RocketMQ/Kafka · 高并发 · 消息重试 · 架构设计 · 分布式可靠性</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">📌 背景场景</h3>
<p>在实际的业务系统中，短信通知是一个非常常见的非核心但又关键的功能。例如：</p>
<ul>
<li>用户注册/登录时发送验证码</li>
<li>订单支付成功通知用户</li>
<li>活动营销、优惠券提醒等</li>
</ul>
<p><strong>短信服务属于强依赖外部服务的非确定性操作</strong>，可能因为第三方网关不稳定、网络抖动、限流等原因导致失败。如果你把短信发送逻辑直接写在业务流程内，那么一旦短信服务挂了，整个业务链就会受到影响，这是非常不可靠的。</p>
<hr/>
<h3 data-id="heading-2">🧠 设计目标</h3>
<p>我们希望实现一个具备以下能力的短信发送系统：</p>
<ol>
<li><strong>异步解耦</strong>：业务系统不被短信服务影响；</li>
<li><strong>可靠消息投递</strong>：短信失败后支持自动重试；</li>
<li><strong>高并发支撑</strong>：能承受百万级并发消息流；</li>
<li><strong>可观测性强</strong>：方便排查失败消息、查看状态。</li>
</ol>
<hr/>
<h3 data-id="heading-3">🏗️ 架构设计</h3>
<p>整体架构如下图：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[业务服务]</span> ---&gt; <span class="hljs-selector-attr">[MQ Topic: sms-topic]</span> ---&gt; <span class="hljs-selector-attr">[短信消费者服务]</span> ---&gt; <span class="hljs-selector-attr">[短信网关]</span>
                          ↑
                    <span class="hljs-selector-attr">[失败消息重试队列]</span>
</code></pre>
<h4 data-id="heading-4">消息流转说明：</h4>
<ol>
<li>业务服务将短信消息发送到 <strong>MQ（如 RocketMQ/Kafka）</strong> ；</li>
<li>短信消费者异步消费消息，调用短信网关接口发送；</li>
<li>若发送失败（如第三方接口异常），将消息重新投递到延迟队列或 DeadLetter Queue；</li>
<li>系统根据重试策略进行补发，最大重试次数后仍失败则记录日志/人工告警。</li>
</ol>
<hr/>
<h3 data-id="heading-5">🧪 核心代码实现（基于 RocketMQ）</h3>
<h4 data-id="heading-6">1. 消息生产者发送短信任务</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsProducer</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DefaultMQProducer producer;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SmsProducer</span><span class="hljs-params">(String producerGroup)</span> <span class="hljs-keyword">throws</span> MQClientException {
        producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(producerGroup);
        producer.setNamesrvAddr(<span class="hljs-string">"localhost:9876"</span>);
        producer.start();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendSmsMessage</span><span class="hljs-params">(SmsMessage smsMessage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"sms-topic"</span>, 
            smsMessage.getBizType(), 
            JSONObject.toJSONString(smsMessage).getBytes(StandardCharsets.UTF_8));
        message.setDelayTimeLevel(<span class="hljs-number">0</span>); <span class="hljs-comment">// 立即发送</span>

        <span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.send(message);
        log.info(<span class="hljs-string">"消息发送成功：{}"</span>, result);
    }
}
</code></pre>
<h4 data-id="heading-7">2. 消费者接收并发送短信</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RocketMQMessageListener</span>(topic = <span class="hljs-string">"sms-topic"</span>, consumerGroup = <span class="hljs-string">"sms-consumer"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;<span class="hljs-title class_">String</span>&gt; {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">SmsGatewayClient</span> smsGateway;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RetryProducer</span> retryProducer;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> messageStr</span>) {
        <span class="hljs-title class_">SmsMessage</span> sms = <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>.<span class="hljs-title function_">parseObject</span>(messageStr, <span class="hljs-title class_">SmsMessage</span>.<span class="hljs-property">class</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">boolean</span> success = smsGateway.<span class="hljs-title function_">send</span>(sms);
            <span class="hljs-keyword">if</span> (!success) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"短信发送失败"</span>);
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"短信发送异常：{}"</span>, e.<span class="hljs-title function_">getMessage</span>());
            retryProducer.<span class="hljs-title function_">sendRetryMessage</span>(sms); <span class="hljs-comment">// 发送到重试队列</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-8">3. 重试队列逻辑（延迟队列）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryProducer</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DefaultMQProducer retryProducer;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryProducer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MQClientException {
        retryProducer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">"sms-retry-group"</span>);
        retryProducer.setNamesrvAddr(<span class="hljs-string">"localhost:9876"</span>);
        retryProducer.start();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendRetryMessage</span><span class="hljs-params">(SmsMessage smsMessage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (smsMessage.getRetryCount() &gt;= <span class="hljs-number">3</span>) {
            log.warn(<span class="hljs-string">"短信重试超过最大次数，记录日志告警：{}"</span>, smsMessage);
            <span class="hljs-keyword">return</span>;
        }

        smsMessage.setRetryCount(smsMessage.getRetryCount() + <span class="hljs-number">1</span>);
        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"sms-topic"</span>, 
            smsMessage.getBizType(), 
            JSONObject.toJSONString(smsMessage).getBytes(StandardCharsets.UTF_8));

        message.setDelayTimeLevel(<span class="hljs-number">3</span>); <span class="hljs-comment">// 延迟10s再重试（RocketMQ内置的延迟等级）</span>
        retryProducer.send(message);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-9">⚙️ 高并发处理建议</h3>
<h4 data-id="heading-10">1. <strong>业务层异步解耦</strong></h4>
<p>使用 MQ 完全脱离主业务链路，业务响应时间更短：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 接口响应无需等待短信发送完成</span>
smsProducer<span class="hljs-selector-class">.sendSmsMessageAsync</span>(smsMessage);
</code></pre>
<h4 data-id="heading-11">2. <strong>消费者水平扩展</strong></h4>
<p>RocketMQ/Kafka 都支持 <strong>多个消费者实例并发消费</strong>，通过部署多个实例来提升吞吐量。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">5</span>  <span class="hljs-comment"># Kubernetes部署多个副本消费短信队列</span>
</code></pre>
<h4 data-id="heading-12">3. <strong>短信网关异步并发发送</strong></h4>
<p>如果使用第三方 SDK，可以使用线程池进行异步发送：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
executor.submit(() -&gt; smsGateway.send(sms))<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">📈 可观测性与监控</h3>
<ul>
<li><strong>失败消息入库</strong>：记录失败原因、重试次数、最终状态；</li>
<li><strong>Prometheus + Grafana</strong>：监控短信发送成功率、MQ堆积情况；</li>
<li><strong>报警机制</strong>：短信失败率超过阈值自动报警；</li>
</ul>
<hr/>
<h3 data-id="heading-14">✅ 总结</h3>
<p>通过 MQ 解耦和异步处理机制，我们不仅提升了系统的 <strong>稳定性和可用性</strong>，还具备了应对 <strong>高并发、可重试、可观测</strong> 的能力。经验告诉我们：</p>
<ul>
<li><strong>外部服务一定要隔离，不能影响主业务链路</strong></li>
<li><strong>一定要有重试机制和失败告警</strong></li>
<li><strong>系统越大，越要注重每一环的可靠性设计</strong></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AutoOps 实际应用：调查 ECK 上的 Elasticsearch 集群性能]]></title>    <link>https://juejin.cn/post/7581689310644174890</link>    <guid>https://juejin.cn/post/7581689310644174890</guid>    <pubDate>2025-12-10T01:36:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310644174890" data-draft-id="7581693431740678207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AutoOps 实际应用：调查 ECK 上的 Elasticsearch 集群性能"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-10T01:36:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AutoOps 实际应用：调查 ECK 上的 Elasticsearch 集群性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T01:36:02.000Z" title="Wed Dec 10 2025 01:36:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Faram-favela" title="https://www.elastic.co/search-labs/author/aram-favela" target="_blank" ref="nofollow noopener noreferrer">Aram Favela</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a551f3d19da4108862413d81dedbf8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=IyiSUbEDe475Fqgxrp1U%2FyOh%2BVA%3D" alt="" loading="lazy"/></p>
<p>了解 Elastic 的 InfoSec 团队如何在多集群 ECK 环境中实施 AutoOps，将集群性能调查时间从 30 多分钟减少到五分钟。</p>
<p>通过实时问题检测和可操作的建议来优化性能并降低成本，从而简化你的 Elasticsearch 运维。AutoOps 可用于 cloud 和 self-managed 部署。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fplatform%2Fautoops" title="https://www.elastic.co/platform/autoops" target="_blank" ref="nofollow noopener noreferrer">了解更多关于 AutoOps 的信息</a>。</p>
<hr/>
<p>在 Elastic，InfoSec Security Engineering 团队负责部署和管理 InfoSec 的 ECK 集群。在 Elastic on Elastic 系列中，我们强调 InfoSec 作为 Customer Zero 的角色。通过运行最新的 stack 版本和功能，我们致力于提供实用建议，并展示我们如何运营。在本节中，我们介绍在多集群 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud on Kubernetes</a> （ ECK ）环境中安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fplatform%2Fautoops" title="https://www.elastic.co/platform/autoops" target="_blank" ref="nofollow noopener noreferrer">AutoOps</a>，并强调它如何立即带来价值。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fplatform%2Fautoops" title="https://www.elastic.co/platform/autoops" target="_blank" ref="nofollow noopener noreferrer">AutoOps for Elasticsearch</a> 通过提供性能建议、资源使用洞察、实时问题检测和引导式修复来简化集群运维。随着 AutoOps for self-managed （ on-premises ）集群的最新<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152440560" title="https://elasticstack.blog.csdn.net/article/details/152440560" target="_blank" ref="nofollow noopener noreferrer">发布</a>，我们迫不及待地将其部署，看看它如何帮助我们监控和维护<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Felastic-on-elastic-data-collected-to-the-infosec-siem" title="https://www.elastic.co/blog/elastic-on-elastic-data-collected-to-the-infosec-siem" target="_blank" ref="nofollow noopener noreferrer">大型</a>多集群 ECK 环境的健康状况。</p>
<h2 data-id="heading-0">在 ECK 上安装 AutoOps</h2>
<p>为了确保可扩展性和一致性，Security Engineering 团队致力于将所有基础设施作为代码（ IaC ）进行管理。遵循这种方式，我们创建了一个 Helm chart 来在整个 ECK 环境中部署 AutoOps agent。关于我们基础的 ECK 和 Helm 方法的更多信息，请参考本系列之前的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Felastic-on-elastic-how-infosec-deploys-infrastructure-and-stays-up-to-date-with-eck" title="https://www.elastic.co/blog/elastic-on-elastic-how-infosec-deploys-infrastructure-and-stays-up-to-date-with-eck" target="_blank" ref="nofollow noopener noreferrer">博客</a>文章。</p>
<p>AutoOps chart</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  cloud-connected-autoops/
<span class="hljs-bullet">2.</span>  ├─ chart.yaml
<span class="hljs-bullet">3.</span>  ├─ values.yaml
<span class="hljs-bullet">4.</span>  └─ templates/
<span class="hljs-bullet">5.</span>     └─ deployment.yaml

`AI写代码
</code></pre>
<p>chart.yaml</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  apiVersion: v1
<span class="hljs-bullet">2.</span>  description: Autoops cloud connected Agent chart
<span class="hljs-bullet">3.</span>  name: cloud-connected-autoops
<span class="hljs-bullet">4.</span>  version: 0.1.0

`AI写代码
</code></pre>
<p>values.yaml</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`version: 9.2.0`</span>AI写代码
</code></pre>
<p>deployment.yaml</p>
<p>这来自官方的 AutoOps 仓库，不过我们将 image 版本模板化，以简化未来升级，并与现有自动化保持兼容：</p>
<pre><code class="hljs language-arduino" lang="arduino"> `<span class="hljs-number">1.</span>   image: &gt;-
<span class="hljs-number">2.</span>     docker.elastic.co/elastic-agent/elastic-otel-collector-wolfi:{{ .Values.version }}`AI写代码
</code></pre>
<p>在定义好 AutoOps 的 Helm chart 之后，我们现在可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fcloud-connect" title="https://www.elastic.co/docs/deploy-manage/cloud-connect" target="_blank" ref="nofollow noopener noreferrer">Cloud Connect</a> 在环境中安装 AutoOps。这个功能让我们能够在 self-managed 的 ECK 集群中使用 Elastic Cloud 服务，而无需安装和维护额外的基础设施。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fmonitor%2Fautoops%2Fcc-connect-self-managed-to-autoops" title="https://www.elastic.co/docs/deploy-manage/monitor/autoops/cc-connect-self-managed-to-autoops" target="_blank" ref="nofollow noopener noreferrer">文档</a>列出了创建 Elastic Cloud Connect 账号以及为每个集群生成必要连接信息的步骤。基于我们的 ECK 环境，我们使用了 Kubernetes 安装方法。</p>
<p>配置好连接后，我们只需要在每个 ECK 集群的 values.yml 中添加一个简单的布尔标志，就能启用 Elastic Agent：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-attr">1.  cloud-connected-autoops:</span>
<span class="hljs-attr">2.    enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-string">`AI写代码</span>
</code></pre>
<p>安装完成后，每个已连接的集群都会显示在 AutoOps 概览页面上：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8cd71d66847436baee46054f233f4c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=mKfdnvQ1AaWycrP8ZtoXgARdAYI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">AutoOps 实际应用</h2>
<p>我们目前使用 Stack Monitoring 来监控集群健康状况，并使用默认规则向我们发送告警。虽然我们计划在不久的将来迁移到 AutoOps 告警，但我们现有的告警仍依赖 Stack Monitoring。</p>
<p>当我们在告警的 Slack 频道收到 thread pool write rejections 告警时，就有了测试 AutoOps 的机会：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/382ac79825b5433e86d8517663fb3b4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=nFBTPTLJADkmyXecBDJBXlZrdFM%3D" alt="" loading="lazy"/></p>
<p>在收到标准警报后，我们查看了 AutoOps 以获取更多上下文。AutoOps 标记了同样的问题，但提供了额外的关键细节，包括导致写入拒绝的确切索引：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9115b9e71e0b49f3ba9bbbe50630892c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=gyl8U5%2FgfTwMdclkfjmDS1Uhimw%3D" alt="" loading="lazy"/></p>
<p>接下来，我们导航到 shard Analyzer 页面，该页面可视化分片热点。可视化显示这个特定节点的写入速率最高，并管理两个写入索引。图表还显示其他节点的利用率较低：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/739c8ae833b74570bdbca44a35e6874e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=F1R%2FOK4Wze%2Bz29tWNnQG44nE%2FQo%3D" alt="" loading="lazy"/></p>
<p>为减轻 es-data-3 的负载，我们使用 cluster reroute 命令将较小的写入索引移动到 es-data-5：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  POST /_cluster/reroute
2.  {
3.    <span class="hljs-string">"commands"</span>: [
4.      {
5.        <span class="hljs-string">"move"</span>: {
6.          <span class="hljs-string">"index"</span>: <span class="hljs-string">".ds-logs-osquery_manager.result-workstation-2025.09.15-000632"</span>,
7.          <span class="hljs-string">"shard"</span>: 0, 
8.          <span class="hljs-string">"from_node"</span>: <span class="hljs-string">"es-data-3"</span>,  
9.          <span class="hljs-string">"to_node"</span>: <span class="hljs-string">"es-data-5"</span>
10.        }
11.      }
12.    ]
13.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>在执行 reroute 后，es-data-3 的写入线程池立即下降：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/119ee95bdcf44d7fa42ed578169079d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765935361&amp;x-signature=3%2Bo6X1mopHTNazflgqxHWLD7XJE%3D" alt="" loading="lazy"/></p>
<p>如果没有 AutoOps，调查 Elasticsearch 性能问题将需要手动查询各个节点的指标、分片分配和线程池，通常还需要多次调用时间点 API。AutoOps 将这些数据集中管理，实时持续收集，并可视化随时间变化的趋势。<strong>因此，我们能够在五分钟内调查并解决一个之前可能需要三十分钟或更长时间的问题</strong>。</p>
<p>虽然这个示例只是展示了 AutoOps 功能的一部分，但我们的实践经验表明，其详细的指标和可视化使得调查和解决 Elasticsearch 性能问题比以前更简单、更高效。</p>
<p>想了解更多关于自管理集群部署 AutoOps 的信息，请查看<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152440560" title="https://elasticstack.blog.csdn.net/article/details/152440560" target="_blank" ref="nofollow noopener noreferrer">公告</a>。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Felasticsearch-autoops-on-prem" title="https://www.elastic.co/blog/elasticsearch-autoops-on-prem" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/blog/elasti…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拯救发际线行动：用 Swift 和 Image Playground 驾驭 AI 绘图]]></title>    <link>https://juejin.cn/post/7581727073581465651</link>    <guid>https://juejin.cn/post/7581727073581465651</guid>    <pubDate>2025-12-10T02:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581727073581465651" data-draft-id="7581760987762524211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拯救发际线行动：用 Swift 和 Image Playground 驾驭 AI 绘图"/> <meta itemprop="keywords" content="Swift,AI编程,Apple"/> <meta itemprop="datePublished" content="2025-12-10T02:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大熊猫侯佩"/> <meta itemprop="url" content="https://juejin.cn/user/4292907536222152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拯救发际线行动：用 Swift 和 Image Playground 驾驭 AI 绘图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292907536222152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大熊猫侯佩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T02:01:33.000Z" title="Wed Dec 10 2025 02:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00ed8d22943142dba8a494533ebff618~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=NhDZ9zNCs4i7donksqZv%2FAtzJNY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<blockquote>
<p>面对产品总监老王深夜抛出的“AI 灵魂绘图”离谱需求，资深 iOS 工程师 Leo 如何在不献祭发际线的前提下，用几行 Swift 代码实现绝地反击？本文将带你深入 Apple 最新的 Image Playground 框架，在充满黑色幽默的职场剧情中，轻松掌握 文本转图片、风格化渲染 以及 图生图 的核心技术。别造轮子了，快来召唤“神笔”，明早准时打脸 KPI！🚀</p>
</blockquote>
<h2 data-id="heading-0">🎨 引子</h2>
<p>夜深了，北京西二旗的写字楼里依旧灯火通明。</p>
<p>资深 iOS 工程师 <strong>Leo（李奥）</strong> 看着屏幕上的一行行报错，不由得摸了摸自己日益稀疏的头顶。就在十分钟前，那个总是把“赋能”、“抓手”和“闭环”挂在嘴边的大反派——产品总监 <strong>老王</strong>，又提出了一个令人窒息的需求：</p>
<p><em>“Leo啊，我们的 App 现在缺乏‘灵魂’。在这个 AI 爆发的时代，用户上传一段文字，我们要立刻生成一张绝美的配图！就像变魔术一样！明早给个 Demo，不然今年的 KPI 咱们就再议。”</em></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b806ad7065541459c4f233a21e2a79e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=9fY5Ql21oLvT9dRxNKTB0QY%2BLpk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>坐在旁边的 UI 设计师 <strong>Zoe（苏一）</strong> 绝望地趴在桌子上，作为完美主义者，她无法容忍任何丑陋的设计，但这种“千人千面”的实时绘图需求，根本不是她能画得过来的。</p>
<p>Leo 嘴角微微上扬，露出了一个意味深长的微笑。他推了推眼镜，打开了 Xcode。</p>
<p><strong>在本篇博文中，您将学到如下内容：</strong></p>
<ul>
<li>🎨 引子</li>
<li>🛠 第一章：召唤神笔马良 —— ImageCreator</li>
<li>🎭 第二章：炼金术的配方 —— 概念与风格</li>
<li>🧩 第三章：混合双打 —— 图生图</li>
<li>🛡 第四章：防御式编程 —— 别让老手机炸了</li>
<li>🎉 终章：黎明前的 Demo</li>
</ul>
<p>“别慌，Zoe。Apple 最近放了个大招，咱们不用造轮子，直接召唤 <strong>Image Playground</strong> 框架，让 iPhone 自己画。”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/669da9e67bc541ee8a3cdaccf51d5570~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=Cnsp0o6TVEzlqWfBFYMij69OLYU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">🛠 第一章：召唤神笔马良 —— ImageCreator</h2>
<p>Leo 指着屏幕对 Zoe 说：“在 Swift 的世界里，想要无中生有，首先得拿到那支‘神笔’。这个核心类就是 <code>ImageCreator</code>。”</p>
<p>Image Playground 框架为我们提供了强大的 <strong>文本转图片（Text-to-Image）</strong> 功能。这不仅仅是简单的滤镜，而是真正的生成式 AI。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/278107f7e28146eb998b7e774b77f22e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=U3OLtlLc2dxX3wS5oQqf2xVY%2BtE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Leo 熟练地敲下了第一段代码：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> ImagePlayground

<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Eye</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>() {}
    
    <span class="hljs-comment">// 这个函数就是我们的“天眼”，负责把文字具象化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">visualize</span>(<span class="hljs-params">text</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">CGImage</span>? {
        <span class="hljs-comment">// 1. 尝试初始化造物主 ImageCreator</span>
        <span class="hljs-comment">// 注意：如果设备不支持 AI 生成（比如老古董机型），这里会直接抛出异常，</span>
        <span class="hljs-comment">// 就像你试图在诺基亚上运行 3A 大作一样。</span>
        <span class="hljs-keyword">let</span> creator <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">ImageCreator</span>()

        <span class="hljs-comment">// 2. 开始生成图片</span>
        <span class="hljs-comment">// for: 定义生成的概念（这里纯文本）</span>
        <span class="hljs-comment">// style: 风格选择素描</span>
        <span class="hljs-comment">// limit: 我们只需要一张，毕竟算力也是钱</span>
        <span class="hljs-keyword">let</span> images <span class="hljs-operator">=</span> creator.images(
            for: [.text(text)],
            style: .sketch,
            limit: <span class="hljs-number">1</span>
        )

        <span class="hljs-comment">// 3. 这是一个异步序列，图片会像回转寿司一样一个个出来</span>
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> image <span class="hljs-keyword">in</span> images {
            <span class="hljs-keyword">return</span> image.cgImage
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
}
</code></pre>
<p>“看，” Leo 解释道，“我们创建了一个 <code>ImageCreator</code> 实例。这个初始化过程可能会失败（Throw Error），毕竟不是所有手机都装得下这么大的脑子。接着，我们定义了想要的画面——这就是 <code>concepts</code>。”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/207270f4174845129e7837c1be153c3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=ZoyUXY6uqcGRb8cLBUSNRW2u8xc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">🎭 第二章：炼金术的配方 —— 概念与风格</h2>
<p>Zoe 凑过来看了看代码，皱眉问道：“只能生成素描吗？老王那个人你也知道，一会要五彩斑斓的黑，一会要赛博朋克的红。”</p>
<p>Leo 笑了笑：“放心，<code>ImageCreator</code> 的 <code>images</code> 函数接收三个关键参数，就像炼金术的三大要素：</p>
<ol>
<li><strong>Concepts（概念）：</strong> 这是原料。</li>
<li><strong>Style（风格）：</strong> 这是火候。</li>
<li><strong>Limit（限制）：</strong> 这是产量。”</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbb91d9b8c994ffbbf194a8527d5483d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=j3VlNHrye%2FYAqXnCx9m5JDNkaBg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>目前支持的风格包括：</p>
<ul>
<li><strong><code>.animation</code> (动画风)</strong>：适合二次元浓度高的场景。</li>
<li><strong><code>.illustration</code> (插画风)</strong>：精致，适合配图。</li>
<li><strong><code>.sketch</code> (素描风)</strong>：正如我们上面用的，简约而不简单。</li>
</ul>
<p>“至于产量，” Leo 补充道，“系统限制最多一次生成 <strong>4</strong> 张图片。毕竟手机发热太严重的话，用户会以为我们开发的是暖手宝。”</p>
<p>最妙的是，<code>images</code> 函数返回的是一个 <strong><code>AsyncSequence</code></strong>。这意味着图片不是一股脑扔给你，而是像挤牙膏一样，生成好一张就吐出一张。所以我们需要用 <code>for loop</code> 搭配 <code>await</code> 来逐个接收。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34f285b91ed64a9798ff460db2dbb2cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=vIsNH5jlpBbIrk5VyMcjZXXxv0M%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">🧩 第三章：混合双打 —— 图生图</h2>
<p>“那如果用户画了个草图，想让 AI 帮他润色呢？”Zoe 依然忧心忡忡，“比如老王经常画一些只有他自己看得懂的火柴人。”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1247161f11fa4798a76a5b7cc7644653~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=VOoqwJlV3SQ3mvgh2zkwYRLHkUQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>“成语说得好，<strong>抛砖引玉</strong>。” Leo 敲击着键盘，“我们可以混合使用多个概念（Concepts）。既给它文字，又给它参考图。”</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Eye</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>() {}
    
    <span class="hljs-comment">// 这次我们要传入一张参考图 image</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">visualize</span>(<span class="hljs-params">text</span>: <span class="hljs-type">String</span>, <span class="hljs-params">image</span>: <span class="hljs-type">CGImage</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">CGImage</span>? {
        <span class="hljs-keyword">let</span> creator <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">ImageCreator</span>()

        <span class="hljs-comment">// 注意这里：数组里同时放入了 .text 和 .image</span>
        <span class="hljs-comment">// AI 会结合你的咒语（文字）和你的灵魂画作（图片）来生成结果</span>
        <span class="hljs-keyword">let</span> images <span class="hljs-operator">=</span> creator.images(
            for: [.text(text), .image(image)],
            style: .sketch,
            limit: <span class="hljs-number">1</span>
        )

        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> image <span class="hljs-keyword">in</span> images {
            <span class="hljs-keyword">return</span> image.cgImage
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
}
</code></pre>
<p><code>ImagePlaygroundConcept</code> 类型提供了一系列静态方法来构建这些概念。除了我们用到的 <code>.text()</code> 和 <code>.image()</code>，还有两个狠角色：</p>
<ul>
<li><strong><code>.drawing()</code></strong>：允许你传入 PencilKit 框架中的 <code>PKDrawing</code> 对象。这意味着用户的手绘笔迹可以直接作为输入。</li>
<li><strong><code>.extracted()</code></strong>：这个更厉害，比如你扔进去一篇长篇大论的文章（比如老王那又臭又长的需求文档），它能从中提取核心意图来生成图片。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ad4543a531c461ab38296cde4ba8ad5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=kxq%2FZ64YSUG1ITvbjEwYOjXGpsI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">🛡 第四章：防御式编程 —— 别让老手机炸了</h2>
<p>此时，Zoe 拿出了她那台战损版的备用机：“那在这台老手机上能跑吗？”</p>
<p>Leo 摇了摇头，表情严肃起来：“技术再好，也怕硬件拉胯。并不是所有风格在所有设备上都可用。作为一个稳健的工程师，我们要学会<strong>看菜下碟</strong>。”</p>
<p><code>ImageCreator</code> 提供了一个静态属性叫 <code>availableStyles</code>。这是一个数组，告诉我们在当前设备上到底能玩哪些花样。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09cdda1732d4e519e61a92893d455dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=VIMjZfSpu2hVq5qshMfEZ6HUz%2Fw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>“为了防止 App 崩溃导致老王借机扣工资，我们必须加上安全检查：”</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Eye</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>() {}
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">visualize</span>(<span class="hljs-params">text</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">CGImage</span>? {
        <span class="hljs-keyword">let</span> creator <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">ImageCreator</span>()

        <span class="hljs-comment">// 1. 先看看当前设备支持啥风格，如果啥都不支持，趁早收工</span>
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> availableStyle <span class="hljs-operator">=</span> creator.availableStyles.first <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }

        <span class="hljs-comment">// 2. 只有当设备明确支持动画风(.animation)时，我们才用它</span>
        <span class="hljs-comment">// 否则就用设备支持的第一个风格凑合一下</span>
        <span class="hljs-comment">// 这叫“退而求其次”，也是生存的智慧</span>
        <span class="hljs-keyword">let</span> style <span class="hljs-operator">=</span> <span class="hljs-operator">!</span>creator.availableStyles.contains(.animation) <span class="hljs-operator">?</span> availableStyle : .animation

        <span class="hljs-keyword">let</span> images <span class="hljs-operator">=</span> creator.images(
            for: [.text(text)],
            style: style,
            limit: <span class="hljs-number">1</span>
        )

        <span class="hljs-keyword">for</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> image <span class="hljs-keyword">in</span> images {
            <span class="hljs-keyword">return</span> image.cgImage
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/510004f47f854798a312d90814ccf1fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=lUv8yUN9yNDl0e%2By4vaHXCniz7M%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">🎉 终章：黎明前的 Demo</h2>
<p>窗外，东方的天空已经泛起了鱼肚白。</p>
<p>Leo 点击了运行按钮。模拟器上，随着输入“一只在写代码的疲惫猫咪”，屏幕上瞬间浮现出一张神态生动、充满艺术感的素描插画。猫咪眼里的红血丝都依稀可见，像极了此刻的 Leo。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f884d437aa544de0b1a83dd833bd9351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=p7Mc8Bnu2gl1%2FSv6wE9lvcgFSt0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Zoe 惊叹道：“哇！这简直比我熬夜画的还要快！”</p>
<p>Image Playground 框架确实将 Apple 的生成式 AI 能力完美地融入了 Swift。它不仅让<strong>文本转图片</strong>变得易如反掌，还能处理手绘和现有照片。仅仅几十行代码，就为 App 注入了老王梦寐以求的“灵魂”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/369bac5d329b42fe807779db03faa948~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=vO8mjIcWH%2FYVrcFP5Jf%2FMBcFXHs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>“搞定。” Leo 合上电脑，对 Zoe 眨了眨眼，“走吧，去吃早饭。等老王醒来看到这个 Demo，估计又该想出什么‘AI 生成五彩斑斓的黑’的新需求了。”</p>
<p>Zoe 笑了：“只要你不脱发，什么需求都好说。”</p>
<p>这就是 Swift 开发者的日常——用最优雅的代码，解决最棘手的问题，顺便在黑色的幽默中，寻找那一抹技术的亮色。</p>
<p><strong>感谢阅读，如果宝子们也想保住发际线，记得关注我哦。下回见！👋</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db95400a72b649969de14ee3cdc9641b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn54aK54yr5L6v5L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765936892&amp;x-signature=YLwLa6qJcDKafRXFx6q7Dr%2BrXmQ%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%]]></title>    <link>https://juejin.cn/post/7581870491756052515</link>    <guid>https://juejin.cn/post/7581870491756052515</guid>    <pubDate>2025-12-10T00:16:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491756052515" data-draft-id="7581870491756036131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T00:16:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:16:41.000Z" title="Wed Dec 10 2025 00:16:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>从混乱到优雅：这5个现代JavaScript技巧让你的代码性能提升50%</strong></h3>
<h3 data-id="heading-1">引言</h3>
<p>在现代Web开发中，JavaScript的性能优化一直是开发者关注的重点。随着应用程序变得越来越复杂，代码的效率和可维护性直接影响到用户体验和开发效率。许多开发者仍然在使用过时的模式或冗余的代码结构，这不仅降低了性能，还增加了维护成本。</p>
<p>本文将介绍5个现代JavaScript技巧，这些技巧可以帮助你从混乱的代码过渡到优雅、高效的解决方案。通过合理的优化策略，你可以显著提升代码性能（甚至高达50%），同时保持代码的可读性和可扩展性。</p>
<hr/>
<h3 data-id="heading-2">1. 使用<code>async/await</code>替代回调地狱</h3>
<h4 data-id="heading-3">问题：回调地狱与性能损耗</h4>
<p>传统的回调模式（Callback）虽然简单，但嵌套过多会导致“回调地狱”（Callback Hell），不仅难以阅读，还可能引发内存泄漏和性能问题。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">getData</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-title function_">processData</span>(data, <span class="hljs-keyword">function</span>(<span class="hljs-params">processedData</span>) {
        <span class="hljs-title function_">saveData</span>(processedData, <span class="hljs-keyword">function</span>(<span class="hljs-params">saved</span>) {
            <span class="hljs-comment">// 更多嵌套...</span>
        });
    });
});
</code></pre>
<h4 data-id="heading-4">解决方案：<code>async/await</code></h4>
<p>ES2017引入的<code>async/await</code>语法可以显著改善异步代码的可读性和性能。它基于Promise实现，避免了不必要的嵌套和上下文切换开销。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getData</span>();
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processData</span>(data);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveData</span>(processedData);
}
</code></pre>
<h4 data-id="heading-5">性能优势</h4>
<ul>
<li><strong>减少堆栈开销</strong>：相比多层嵌套的回调，<code>async/await</code>减少了函数调用堆栈的深度。</li>
<li><strong>更好的错误处理</strong>：通过<code>try/catch</code>可以统一捕获错误，避免了回调中的手动错误传递。</li>
<li><strong>V8引擎优化</strong>：现代JavaScript引擎（如V8）对<code>async/await</code>有专门优化，执行效率更高。</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. 利用WeakMap和WeakSet管理内存</h3>
<h4 data-id="heading-7">问题：内存泄漏</h4>
<p>传统的Map和Set会强引用键值，导致即使对象不再需要也无法被垃圾回收（GC）。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processObj</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(obj);
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">heavyComputation</span>(obj);
    cache.<span class="hljs-title function_">set</span>(obj, result); <span class="hljs-comment">// obj会被长期持有</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-8">解决方案：WeakMap和WeakSet</h4>
<p>WeakMap和WeakSet的键是弱引用，不会阻止垃圾回收机制回收对象。适合缓存或临时关联数据场景。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processObj</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(obj);
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">heavyComputation</span>(obj);
    cache.<span class="hljs-title function_">set</span>(obj, result); <span class="hljs-comment">// obj可被GC回收</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-9">性能优势</h4>
<ul>
<li><strong>减少内存占用</strong>：避免无意的内存泄漏，尤其是在长生命周期应用中。</li>
<li><strong>更高效的GC</strong>：垃圾回收器能更快释放不再使用的对象。</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. 使用Array.prototype.at()简化数组访问</h3>
<h4 data-id="heading-11">问题：冗长的负数索引处理</h4>
<p>传统的负数索引需要通过<code>arr.length + index</code>计算，既不直观又容易出错：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> lastItem = arr[arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 3</span>
</code></pre>
<h4 data-id="heading-12">解决方案：Array.prototype.at()</h4>
<p>ES2022引入的<code>at()</code>方法支持直接使用负数索引访问数组元素：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> lastItem = arr.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>); <span class="hljs-comment">// 3</span>
</code></pre>
<h4 data-id="heading-13">性能优势</h4>
<ul>
<li><strong>代码更简洁</strong>：减少冗余计算和潜在的错误风险。</li>
<li><strong>引擎优化</strong>：现代浏览器对内置方法进行了高度优化，执行效率更高。</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. Object.groupBy替代手动分组逻辑</h3>
<h4 data-id="heading-15">问题：低效的手动分组</h4>
<p>开发者通常用reduce或循环实现分组功能，但这类手动实现往往不够高效且难以维护：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [{ <span class="hljs-attr">age</span>:<span class="hljs-number">25</span> }, { <span class="hljs-attr">age</span>:<span class="hljs-number">30</span> }, { <span class="hljs-attr">age</span>:<span class="hljs-number">25</span> }];
<span class="hljs-keyword">const</span> groupedByAge = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
    acc[user.<span class="hljs-property">age</span>] ??= [];
    acc[user.<span class="hljs-property">age</span>].<span class="hljs-title function_">push</span>(user);
    <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-16">ES2024新特性提案中的Object.groupBy方法可以直接完成分组操作：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> groupedByAge = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">groupBy</span>(users , <span class="hljs-function">(<span class="hljs-params">{age}</span>) =&gt;</span> age ) ;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(groupedByAge )
<span class="hljs-comment">/* 
{
   "25": [{"age":25},{"age":25}],
   "30": [{"age":30}]
}
*/</span>
</code></pre>
<h5 data-id="heading-17">Performance Benefits:</h5>
<p>•	Native Implementation Speed - No need for manual iteration logic that may be suboptimal.
•	Cleaner Code - Readability is greatly improved over reduce-based approaches.
•	Future Optimization Potential - As engines optimize this new API further.</p>
<hr/>
<h2 data-id="heading-18">Conclusion</h2>
<p>Mastering modern JavaScript features isn’t just about writing cleaner code – it’s about unlocking significant performance gains while improving maintainability. The five techniques we’ve covered demonstrate how evolving language features can help you:</p>
<ol>
<li>Replace callback hell with streamlined async/await workflows</li>
<li>Prevent memory leaks using WeakMap/WeakSet</li>
<li>Access array elements elegantly with at()</li>
<li>Leverage upcoming APIs like Object.groupBy for common operations</li>
</ol>
<p>Each optimization might seem small individually, but combined they can easily deliver the promised ≥50% performance improvement in real-world applications.</p>
<p>The key takeaway? Regularly update your JavaScript knowledge and challenge old patterns – today’s “best practice” might be tomorrow’s performance bottleneck. By adopting these modern techniques proactively, you’ll stay ahead of the curve while writing faster, more robust applications.</p>
<p>What modern JavaScript optimizations have you found most impactful? Share your experiences in the comments!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战深入理解Promise与async&await]]></title>    <link>https://juejin.cn/post/7581698074362052617</link>    <guid>https://juejin.cn/post/7581698074362052617</guid>    <pubDate>2025-12-10T00:18:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074362052617" data-draft-id="7581888578507079707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战深入理解Promise与async&amp;await"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-10T00:18:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战深入理解Promise与async&amp;await
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:18:46.000Z" title="Wed Dec 10 2025 00:18:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 的异步编程体系中，回调函数虽然简单高效，但也容易造成嵌套复杂、难以维护的“回调地狱”问题。随着 JavaScript 语言标准的发展，Promise 和 async/await 成为了现代 Node.js 异步编程的主流方式。在工程实践中，它们不仅让代码更清晰，也更易调试和扩展。本文将系统解析 Promise 与 async/await 的核心原理、使用方式以及实际开发中的常见模式。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、Promise：解决回调地狱的第一步</h2>
<p>Promise 是一种用于处理异步操作的对象，它代表的是“未来某个时间点才会返回的结果”。相比传统回调，Promise 让异步流程可以更优雅地组织和链式调用。</p>
<h3 data-id="heading-1">1. Promise 的基本语法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"任务完成"</span>);
  }, <span class="hljs-number">1000</span>);
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
});
</code></pre>
<p>Promise 的状态分为：</p>
<ul>
<li>pending（进行中）</li>
<li>fulfilled（已成功）</li>
<li>rejected（已失败）</li>
</ul>
<p>状态一旦改变，就不会再次变化，这让异步处理更稳定。</p>
<h3 data-id="heading-2">2. Promise 链式调用</h3>
<p>多个异步操作可以通过 <code>.then()</code> 串联起来：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultA</span> =&gt;</span> <span class="hljs-title function_">doB</span>(resultA))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultB</span> =&gt;</span> <span class="hljs-title function_">doC</span>(resultB))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resultC</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(resultC))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>这种链式结构有效解决了回调的深度嵌套问题。</p>
<hr/>
<h2 data-id="heading-3">二、async/await：异步编程的终极形态</h2>
<p>Promise 虽然好用，但链式结构在复杂逻辑中仍显冗长。因此，ES8 引入了 async/await，让异步写法更接近同步思维。</p>
<h3 data-id="heading-4">1. async/await 用法示例</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始"</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"等待结束"</span>);
}

<span class="hljs-title function_">run</span>();
</code></pre>
<p>使用 <code>await</code> 时，函数必须定义为 <code>async</code>。
其效果相当于暂停代码执行，但不会阻塞 Node.js 主线程，非常适合逻辑清晰的异步流程。</p>
<h3 data-id="heading-5">2. 错误处理更直观</h3>
<p>Promise 中需要 <code>.catch()</code> 来捕获错误，
而 async/await 可以直接使用 try/catch：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFileAsync</span>(<span class="hljs-string">"demo.txt"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败："</span>, err);
  }
}
</code></pre>
<p>这让错误处理方式更加接近同步代码。</p>
<hr/>
<h2 data-id="heading-6">三、Promise 与 async/await 的关系</h2>
<p>很多人会误以为 async/await 可以完全取代 Promise，但本质上 async/await 只是 Promise 的语法糖，底层仍依赖 Promise 的状态机制。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;
}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">123</span>);
}
</code></pre>
<p>理解 Promise 是掌握 async/await 的基础。</p>
<hr/>
<h2 data-id="heading-7">四、实际项目中的常见模式</h2>
<h3 data-id="heading-8">1. 并发执行多个任务</h3>
<p>如果多个任务互不依赖，可以用 <code>Promise.all</code> 提升性能：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> [a, b, c] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">doA</span>(), <span class="hljs-title function_">doB</span>(), <span class="hljs-title function_">doC</span>()]);
</code></pre>
<p>避免这样写：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doA</span>();
<span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doB</span>();
<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doC</span>();
</code></pre>
<p>后者是串行执行，性能更低。</p>
<h3 data-id="heading-9">2. 使用 util.promisify 转换回调 API</h3>
<p>Node.js 原生很多 API 仍然使用回调，例如 fs.readFile。
可以通过 promisify 转换为 Promise 格式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-string">"demo.txt"</span>, <span class="hljs-string">"utf8"</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}
</code></pre>
<p>这样就能自然地使用 async/await。</p>
<h3 data-id="heading-10">3. 处理多个 Promise 的错误</h3>
<p>当你使用 <code>Promise.all</code> 时，有任何一个任务出错，都可能导致整体失败。
更安全的方式是使用 <code>Promise.allSettled</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
</code></pre>
<p>非常适合批量任务处理场景。</p>
<hr/>
<h2 data-id="heading-11">五、常见陷阱与注意事项</h2>
<h3 data-id="heading-12">1. 避免在 forEach 中使用 await</h3>
<p>因为 forEach 不支持异步等待，会导致未按预期执行。</p>
<p>错误示例：</p>
<pre><code class="hljs language-js" lang="js">list.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (item) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
});
</code></pre>
<p>正确方式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> list) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
}
</code></pre>
<h3 data-id="heading-13">2. await 多层嵌套造成性能损耗</h3>
<p>如果任务没有依赖关系，应该使用 Promise 并发而不是 await 来等待每一步。</p>
<h3 data-id="heading-14">3. async 函数默认返回 Promise</h3>
<p>若未显式 return，结果会是 <code>Promise&lt;void&gt;</code>，需要注意函数返回值类型。</p>
<hr/>
<h2 data-id="heading-15">六、总结</h2>
<p>Promise 和 async/await 是现代 Node.js 异步编程的核心。
两者并不是互相替代，而是共同组成完整的异步解决方案：</p>
<ul>
<li>Promise 解决回调地狱、支持链式调用</li>
<li>async/await 让异步代码更清晰、更易维护</li>
<li>Promise 是 async/await 的底层基础</li>
<li>Promise.all 等工具让并发任务更高效</li>
</ul>
<p>掌握它们不仅是写好 Node.js 项目的必要技能，也是理解事件循环与非阻塞 I/O 的前提。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：全面理解异步错误处理]]></title>    <link>https://juejin.cn/post/7581888578507096091</link>    <guid>https://juejin.cn/post/7581888578507096091</guid>    <pubDate>2025-12-10T00:19:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507096091" data-draft-id="7581698074362069001" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：全面理解异步错误处理"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-10T00:19:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：全面理解异步错误处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:19:17.000Z" title="Wed Dec 10 2025 00:19:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 开发中，程序的大部分操作都是异步执行的，例如文件读写、网络请求、数据库操作等。异步带来了高性能的优势，但也让错误处理变得更加复杂。如果处理不当，错误可能悄无声息地被忽略，导致程序异常、资源泄漏，甚至服务崩溃。理解并正确掌握 Node.js 的异步错误处理机制，是构建稳定可靠服务的重要前提。</p>
</blockquote>
<p>本文将系统讲解 Node.js 中的异步错误处理策略，包括回调、Promise、async/await，以及常见陷阱和最佳实践。</p>
<hr/>
<h2 data-id="heading-0">一、为什么异步错误处理更难？</h2>
<p>在同步代码中，只需要 try/catch 即可捕获异常：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">"a.txt"</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
}
</code></pre>
<p>但在异步代码中，异常并不会被外围的 try/catch 捕获。例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"a.txt"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"捕获不到错误"</span>);
}
</code></pre>
<p>原因在于：回调在未来某个时间点执行，已经脱离了 try/catch 的同步范围。</p>
<p>因此，Node.js 引入了不同阶段的错误处理模式。</p>
<hr/>
<h2 data-id="heading-1">二、回调风格中的“错误优先”规则</h2>
<p>Node.js 所有基于回调的 API 都遵循一个约定：回调的第一个参数永远是错误对象。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"demo.txt"</span>, <span class="hljs-string">"utf8"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败："</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
});
</code></pre>
<p>这是处理异步错误的基础方式。
好处是：</p>
<ul>
<li>明确区分成功和失败</li>
<li>调用者必须显式处理错误，避免吞错</li>
<li>提升代码安全性</li>
</ul>
<p>但随着嵌套回调增多，错误处理也会变得重复甚至混乱。</p>
<hr/>
<h2 data-id="heading-2">三、Promise 中的错误捕获</h2>
<p>Promise 的设计让错误处理更清晰，任何抛出的异常都会被 <code>.catch()</code> 捕获。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"失败了"</span>));
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {})
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"捕获到错误："</span>, err);
  });
</code></pre>
<p>Promise 的错误处理有几种特点：</p>
<ol>
<li>只要 reject 或者 then 中抛出异常，都能被 catch 捕获</li>
<li>在链式调用中，只需一个 catch 即可捕获所有上游错误</li>
<li>未处理的 Promise 错误会触发 <code>unhandledRejection</code> 事件</li>
</ol>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未捕获的 Promise 错误："</span>, err);
});
</code></pre>
<p>在生产环境中，这类错误必须记录，否则将难以排查。</p>
<hr/>
<h2 data-id="heading-3">四、async/await 的错误处理方式</h2>
<p>async/await 是构建整洁异步代码的关键，但错误处理仍然要使用 try/catch。</p>
<p>示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFileAsync</span>(<span class="hljs-string">"demo.txt"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"捕获错误："</span>, err);
  }
}
</code></pre>
<p>try/catch 在 async/await 中有几个优势：</p>
<ul>
<li>可读性强，结构和同步逻辑一致</li>
<li>一段代码中可以统一处理多个 await 的错误</li>
<li>调试更方便</li>
</ul>
<p>但常见错误是：把 try/catch 放错位置，导致部分 await 未被包含。</p>
<hr/>
<h2 data-id="heading-4">五、如何处理多个并发任务的错误？</h2>
<p>当多个异步任务同时执行时，错误处理方式更为复杂。</p>
<h3 data-id="heading-5">1. Promise.all：其中一个失败就全部失败</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"其中一个任务失败："</span>, err);
}
</code></pre>
<p>适用于“任务必须同时成功”的场景。</p>
<hr/>
<h3 data-id="heading-6">2. Promise.allSettled：每个任务独立执行</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([<span class="hljs-title function_">taskA</span>(), <span class="hljs-title function_">taskB</span>(), <span class="hljs-title function_">taskC</span>()]);
</code></pre>
<p>返回结果中：</p>
<ul>
<li>fulfilled 代表成功</li>
<li>rejected 代表失败</li>
</ul>
<p>非常适合批量处理或任务结果不互相依赖的场景。</p>
<hr/>
<h2 data-id="heading-7">六、常见的异步错误陷阱</h2>
<h3 data-id="heading-8">1. 忘记返回 Promise</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>();
    }, <span class="hljs-number">1000</span>);
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"错误"</span>);
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">wrong</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"捕获不到"</span>);
  }
}
</code></pre>
<p>原因：没有 return，导致 run() 无法等待错误抛出。</p>
<hr/>
<h3 data-id="heading-9">2. 在 forEach 中使用 await</h3>
<p>forEach 不能等待异步任务，因此错误难以捕获。</p>
<pre><code class="hljs language-js" lang="js">items.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> item =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item); <span class="hljs-comment">// 错误无法被外层捕获</span>
});
</code></pre>
<p>正确方式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">process</span>(item);
}
</code></pre>
<hr/>
<h3 data-id="heading-10">3. async 函数中的未处理错误最终会导致 Promise rejection</h3>
<p>如果没有 try/catch，也没有被外层 await 捕获，错误会引发 <code>unhandledRejection</code>。</p>
<hr/>
<h2 data-id="heading-11">七、全局层面的异常处理</h2>
<p>即使处理了大多数错误，仍可能出现未捕获错误。
Node.js 提供全局事件用于兜底：</p>
<h3 data-id="heading-12">1. 未捕获的异常</h3>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"uncaughtException"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未捕获异常："</span>, err);
});
</code></pre>
<h3 data-id="heading-13">2. 未捕获的 Promise 错误</h3>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"未处理的 Promise 错误："</span>, err);
});
</code></pre>
<p>在生产环境，通常会记录日志并安全退出，而不是继续运行。</p>
<hr/>
<h2 data-id="heading-14">八、最佳实践总结</h2>
<ol>
<li>回调函数中始终检查 err</li>
<li>Promise 链中使用统一的 catch</li>
<li>async/await 中使用 try/catch 进行局部保护</li>
<li>批量任务优先选择 Promise.allSettled</li>
<li>避免在 forEach 中使用 await</li>
<li>必须监听 unhandledRejection 和 uncaughtException</li>
<li>对外暴露 API 时防止错误被吞掉</li>
</ol>
<p>高质量的异步错误处理不仅提升稳定性，也能显著降低维护成本。</p>
<hr/>
<h2 data-id="heading-15">九、总结</h2>
<p>Node.js 的异步错误处理机制看似复杂，但它遵循清晰规律：
回调依赖错误优先模式，Promise 依赖 catch，async/await 依赖 try/catch。
理解每种模式的特点和适用场景，就能写出可靠、可维护的 Node.js 服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」]]></title>    <link>https://juejin.cn/post/7581738974424088595</link>    <guid>https://juejin.cn/post/7581738974424088595</guid>    <pubDate>2025-12-10T00:21:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581738974424088595" data-draft-id="7581664885862105098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」"/> <meta itemprop="keywords" content="GitHub,开源"/> <meta itemprop="datePublished" content="2025-12-10T00:21:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上班摸鱼玩塔防，竟然是为了学架构？「GitHub 热点速览」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:21:42.000Z" title="Wed Dec 10 2025 00:21:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a38f2672d0274178bb3dfd04f27f7471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=%2FOUcfcAN3J5vh1A0Ov85W1EAVsI%3D" alt="" loading="lazy"/></p>
<p>如果你的生产环境用了 NextJS——基于 React 的流行开源 Web 开发框架，那上周末可能过得并不轻松。<strong>受 React 高危漏洞的影响，攻击者可以通过 HTTP 请求攻击 NextJS 项目，远程执行任意指令</strong>。如果你不确定项目是否受影响，可以使用官方提供的工具，一条命令 <code>npx fix-react2shell-next</code> 即可检查和修复该安全漏洞。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cfe35892a874321b0333d99670291cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=jGMOyLUCpW%2BAf%2B6anSk7%2FlBn2vA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Ffix-react2shell-next" target="_blank" title="https://github.com/vercel-labs/fix-react2shell-next" ref="nofollow noopener noreferrer">github.com/vercel-labs…</a></p>
</blockquote>
<p>接下来，让我们看看上周 GitHub 又有哪些好玩的开源项目。近期，微软开源的支持 90 分钟高质量长语音合成框架，连续多天登顶热榜。让你在“摸鱼”时学习云架构知识的塔防游戏 server-survival，除了界面有些简陋但真能学到东西。如果你在寻找 Vim 的终端编辑器替代品，可以试试最近很火的新项目 Fresh，没点东西也不可能一周 Star 破千。</p>
<p>最后是无需客户端、浏览器访问就能用的远程桌面工具 CrossDesk，以及完全免费、开源的 Android 白噪音应用 XMSLEEP，帮你放松、助你入眠。</p>
<ul>
<li>本文目录
<ul>
<li>1. 热门开源项目
<ul>
<li>1.1 扮演云架构师的塔防游戏：server-survival</li>
<li>1.2 秒开大文件的终端编辑器：Fresh</li>
<li>1.3 开箱即用的文件传输工具：alt-sendme</li>
<li>1.4 一句话生成小红书的创作工具：RedInk</li>
<li>1.5 长时长多角色语音合成框架：VibeVoice</li>
</ul>
</li>
<li>2. HelloGitHub 热评
<ul>
<li>2.1 支持 Web 端的远程桌面工具：CrossDesk</li>
<li>2.2 开源的 Android 白噪音应用：XMSLEEP</li>
</ul>
</li>
<li>3. 结尾</li>
</ul>
</li>
</ul>
<h2 data-id="heading-0">1. 热门开源项目</h2>
<h3 data-id="heading-1">1.1 扮演云架构师的塔防游戏：server-survival</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeec31c921ac438c9bf4689a4fbaee3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=tIr4k0%2BC6TkEmXS1KuZB9ccWYbw%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：JavaScript</strong>，<strong>Star：2.3k</strong>，<strong>周增长：2k</strong></p>
<p>这是一个基于 Web 的塔防模拟游戏，旨在通过玩游戏的方式学习云架构知识。玩家在游戏中扮演云架构师，利用有限的预算搭建云基础设施。面对持续增长的访问流量和 DDoS 攻击，需要合理规划和部署资源，尽可能延长云服务稳定运行时间（生存更长时间）。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpshenok%2Fserver-survival" target="_blank" title="https://github.com/pshenok/server-survival" ref="nofollow noopener noreferrer">github.com/pshenok/ser…</a></p>
</blockquote>
<h3 data-id="heading-2">1.2 秒开大文件的终端编辑器：Fresh</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/034d60cca1cb434e8b11d007b691bb86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=8deN%2BuY1YLdZ0TrB781mKi1p160%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Rust</strong>，<strong>Star：1.4k</strong>，<strong>周增长：1.3k</strong></p>
<p>这是一款支持鼠标操作的终端文本编辑器，能够流畅编辑 GB 级大文件。它开箱即用、上手简单，内置 LSP 客户端，提供自动补全、跳转到定义等 IDE 功能，以及 TypeScript 插件系统。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinelaw%2Ffresh" target="_blank" title="https://github.com/sinelaw/fresh" ref="nofollow noopener noreferrer">github.com/sinelaw/fre…</a></p>
</blockquote>
<h3 data-id="heading-3">1.3 开箱即用的文件传输工具：alt-sendme</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332202d034154ad59481016bade649b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=XC7NLLecxHewG2aUkhlZXn9l3vk%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Rust、TypeScript</strong>，<strong>Star：4k</strong></p>
<p>这是一款采用 Rust 和 Tauri 构建的开源 P2P 文件传输工具，无需注册和服务器，即可实现端到端的文件传输。用户只需将文件拖入应用，将随机生成的传输凭证发给接收方，对方输入后即可轻松接收文件。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftonyantony300%2Falt-sendme" target="_blank" title="https://github.com/tonyantony300/alt-sendme" ref="nofollow noopener noreferrer">github.com/tonyantony3…</a></p>
</blockquote>
<h3 data-id="heading-4">1.4 一句话生成小红书的创作工具：RedInk</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f63bc2a53904e389e3b5a52fe19e6f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=O7kLsjD9lJ4FOp%2F8SXljV1jY0Q4%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Python</strong>，<strong>Star：3.2k</strong>，<strong>周增长：1k</strong></p>
<p>该项目是基于 AI 的一站式小红书图文生成工具，只需输入一句话描述主题，并上传主页截图作为风格参考，即可自动生成包含封面图和内容的完整图文笔记，支持重新生成单页内容、大纲预览和编辑等功能。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHisMax%2FRedInk" target="_blank" title="https://github.com/HisMax/RedInk" ref="nofollow noopener noreferrer">github.com/HisMax/RedI…</a></p>
</blockquote>
<h3 data-id="heading-5">1.5 长时长多角色语音合成框架：VibeVoice</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6ee558b38c8453ba070539dde9bbe3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=xC6N5981xi%2Fzn91I4PIWax0adnM%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Python</strong>，<strong>Star：14k</strong>，<strong>周增长：4k</strong></p>
<p>该项目是微软开源的文本转语音框架，旨在解决传统 TTS 系统在生成长篇幅、多角色对话时（博客、有声书）的痛点。它能够基于文本，一次性合成长达 90 分钟、4 位不同角色对话的高质量长音频，支持中文、英语等 9 种语言。</p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FVibeVoice" target="_blank" title="https://github.com/microsoft/VibeVoice" ref="nofollow noopener noreferrer">github.com/microsoft/V…</a></p>
</blockquote>
<h2 data-id="heading-6">2. HelloGitHub 热评</h2>
<p>在此章节中，我们将为大家介绍本周 HelloGitHub 网站上的热门开源项目，希望你能从中收获开源神器和编程知识，更欢迎与我们分享你在使用这些<strong>开源项目的体验和评价</strong>，用最真实反馈为开源项目的作者提供动力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d178ca6ce8c476e86d77f3917be2b82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=TNd0BT9Z9WQ1sijZSQ%2B4XmBnKT8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.1 支持 Web 端的远程桌面工具：CrossDesk</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9336a5651d784fb8ae47da73d1ad3965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=OzA2a2L3Al1gGbiQeUzxPDjkx9w%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：C++</strong></p>
<p>这是一款开源、轻量级的跨平台远程桌面工具，支持不同设备间（Windows、Linux 和 macOS）的远程桌面控制和音视频传输，特点是可直接通过浏览器控制远程设备，无需额外安装任何应用。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2Fkunkundi%2Fcrossdesk" target="_blank" title="https://hellogithub.com/repository/kunkundi/crossdesk" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h3 data-id="heading-8">2.2 开源的 Android 白噪音应用：XMSLEEP</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5afce9f7e134ddb872f46e0dc815171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930901&amp;x-signature=34EZEIl2KVQPPrJ4pDdJfTWdvmE%3D" alt="" loading="lazy"/></p>
<p><strong>主语言：Kotlin</strong></p>
<p>这是一个专注于白噪音播放的 Android 应用，提供雨声、篝火、雷声、猫咪呼噜、鸟鸣、夜虫等多种自然声音，帮助你放松、冥想和入睡。</p>
<blockquote>
<p>项目详情→<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Frepository%2FTosencen%2FXMSLEEP" target="_blank" title="https://hellogithub.com/repository/Tosencen/XMSLEEP" ref="nofollow noopener noreferrer">hellogithub.com/repository/…</a></p>
</blockquote>
<h2 data-id="heading-9">3. 结尾</h2>
<p>以上就是本期「GitHub 热点速览」的全部内容，我始终坚信：兴趣是最好的老师！希望这些开源项目能激发你的兴趣，让你找到下一个想尝试和学习的开源项目。如果你也发现了好玩、有趣的 GitHub 开源项目想要分享，欢迎来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com" target="_blank" title="https://hellogithub.com" ref="nofollow noopener noreferrer">HelloGitHub</a> 与我们交流、讨论使用体验。</p>
<p><strong>往期回顾</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F44TR75pFspRM3kGf-6gU2Q" target="_blank" title="https://mp.weixin.qq.com/s/44TR75pFspRM3kGf-6gU2Q" ref="nofollow noopener noreferrer">节省 60% Token 的新数据格式</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fn_junef2MC3GTV7leQy-Ww" target="_blank" title="https://mp.weixin.qq.com/s/n_junef2MC3GTV7leQy-Ww" ref="nofollow noopener noreferrer">DIY ChatGPT 一周狂揽 27k Star</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）]]></title>    <link>https://juejin.cn/post/7581888578507128859</link>    <guid>https://juejin.cn/post/7581888578507128859</guid>    <pubDate>2025-12-10T00:23:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578507128859" data-draft-id="7581691182003961866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）"/> <meta itemprop="keywords" content="人工智能,GPU,面试"/> <meta itemprop="datePublished" content="2025-12-10T00:23:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 处理器全景指南（CPU、GPU、TPU、APU、NPU、IPU、RPU...）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:23:08.000Z" title="Wed Dec 10 2025 00:23:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>编者按：</strong> 当大模型的算力需求呈指数级增长，GPU 还是唯一答案吗？在 AI 硬件军备竞赛愈演愈烈的今天，是否存在更高效、更专精、甚至更具颠覆性的替代方案？</p>
<p>我们今天为大家带来的文章，作者的核心观点是：AI 硬件生态正在迅速多元化，除了广为人知的 CPU、GPU 和 TPU 之外，一系列新兴架构 —— 如 ASIC、NPU、IPU、FPGA 乃至存内计算与神经形态芯片，正从不同维度重塑 AI 的算力未来。</p>
<p>文章系统梳理了三大经典处理单元（CPU、GPU、TPU）的原理与局限，并深入剖析了包括 Cerebras 晶圆级引擎、AWS Trainium/Inferentia、AMD APU、NPU 在内的专用芯片设计思路；进而拓展至 IPU、RPU、FPGA 等前沿架构，揭示它们如何针对稀疏计算、图神经网络、边缘推理或存算一体等特定场景提供突破性性能。</p>
</blockquote>
<p><strong>作者 | Ksenia Se and Alyona Vert</strong></p>
<p><strong>编译 | 岳扬</strong></p>
<h2 data-id="heading-0"><strong>目录</strong></h2>
<p><strong>01 CPU、GPU、TPU – 三种核心硬件架构</strong></p>
<p>1.1 中央处理单元（Central Processing Unit, CPU）</p>
<p>1.2 图形处理单元（Graphics Processing Unit, GPU）</p>
<p>1.3 张量处理单元（Tensor Processing Unit, TPU）</p>
<p><strong>02 专用集成电路（Application-Specific Integrated Circuits, ASICs）</strong></p>
<p>2.1 Cerebras 晶圆级引擎（Wafer-Scale Engine, WSE）</p>
<p>2.2 AWS Trainium 与 AWS Inferentia</p>
<p>2.3 加速处理单元（Accelerated Processing Unit, APU）</p>
<p>2.4 神经网络处理单元（Neural Processing Unit, NPU）</p>
<p><strong>03 其他有前景的替代架构</strong></p>
<p>3.1 智能处理单元（Intelligence Processing Unit, IPU）</p>
<p>3.2 阻变处理单元（Resistive Processing Unit, RPU）</p>
<p>3.3 现场可编程门阵列（Field-Programmable Gate Arrays, FPGAs）</p>
<p><strong>04 新兴架构（Emerging Architectures）</strong></p>
<p>4.1 量子处理器（Quantum Processors）</p>
<p>4.2 存内计算（Processing-in-Memory, PIM）与基于 MRAM 的芯片</p>
<p>4.3 神经形态芯片（Neuromorphic Chips）</p>
<p><strong>05 结语（Conclusion）</strong></p>
<hr/>
<p>如今连小孩子都知道 GPU（图形处理单元）是什么了 —— 这得归功于 AI，也归功于英伟达（Nvidia），它始终在不遗余力地推进自家芯片的发展。当然，硬件既是绊脚石，也是推动模型运行及其技术栈的引擎。但为什么人们讨论的焦点只集中在 GPU 上呢？难道没有其他竞争者可能塑造 AI 硬件的未来吗？CPU 和 TPU 当然算 —— 但仅此而已吗？</p>
<p>今天，让我们跳出 GPU 的思维茧房，将视线拓展到 GPU、CPU、TPU 这“老三样”之外。全球开发者一直在探索各类替代设计方案，每一种都承诺带来可观的效率提升和全新的创新路径。</p>
<p>我们希望能各位读者打造一份完整的 AI 硬件指南，因此先从这三大巨头讲起，再转向那些虽不主流却内有乾坤的方案：例如 Cerebras WSE 和 AWS 自研的定制 ASIC；还有 APU、NPU、IPU、RPU 以及 FPGA。我们会帮你厘清这些术语，让你全面掌握 AI 硬件的完整图景。这篇文章必将让你收获满满！</p>
<h2 data-id="heading-1"><strong>01 CPU、GPU、TPU – 三种核心硬件架构</strong></h2>
<p>在探讨其他替代方案之前，先来剖析一下这些我们耳熟能详的 CPU、GPU 和 TPU 到底是什么。</p>
<p>这三大巨头都属于处理单元（Processing Units，简称 PUs） —— 即专门用于执行软件程序指令、进行计算的电子电路。许多人称它们为计算机系统的“大脑”。PUs 执行各类算术、逻辑、控制以及输入/输出操作，将原始数据处理成有用的信息。</p>
<p>不同类型的 PU 针对不同的工作负载进行了优化 →</p>
<h3 data-id="heading-2"><strong>1.1 中央处理单元（Central Processing Unit, CPU）</strong></h3>
<p>中央处理单元（CPU）专为通用计算和顺序任务执行而设计。</p>
<p>CPU 是三者中最古老的。其前身的故事始于 1945 年 —— 约翰·莫奇利（John Mauchly）与 J. 普雷斯珀·埃克特（J. Presper Eckert Jr.）推出了 ENIAC（Electronic Numerical Integrator and Computer）。这是世界上第一台可编程、电子式、通用型的数字计算机，能通过重新编程解决多种数值问题，使用了约 18,000 个真空管。</p>
<p>同年，约翰·冯·诺依曼（John von Neumann）发表了《First Draft of a Report on the EDVAC》，提出将数据和指令存储在同一内存中。这一“存储程序”模型成为现代 CPU 的设计蓝本。</p>
<p>到了 1950 年代中期，真空管被晶体管取代。从那时起，处理器开始由大量基于晶体管的元件组成，并安装在电路板上，使计算机变得更小、更快、更省电。</p>
<p>1960 年代，集成电路（ICs）出现，将多个晶体管集成到单块硅片上。最终在 1971 年，英特尔（Intel）推出了 4004 —— 全球首款商用微处理器，即一颗集成在单一芯片上的 4 位 CPU。这标志着现代 CPU 的真正诞生。</p>
<p>Intel 8086 是如今 x86 CPU 架构的始祖，而目前提升效率的主流方案则是多核处理器 —— 将多个 CPU 核心集成在单一芯片上。</p>
<p>那么，现代 CPU 内部究竟包含什么？它们又是如何工作的？</p>
<p>CPU 的核心是控制单元（control unit），它包含复杂的电路，通过发出电信号来控制整台计算机，并将数据和指令引导至正确的位置。算术逻辑单元（ALU）负责执行数学与逻辑运算，而寄存器（registers）和高速缓存（cache）则提供了极小但极快的存储空间，用于存放处理器频繁需要的数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc7b3f8f98e4060801df745f6f64e59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=H%2BPPAlfo1bekNi7W9JzvALUWH1I%3D" alt="image.png" loading="lazy"/></p>
<p>Image Credit: Wikipedia</p>
<p>CPU 还包含核心（cores） —— 即 CPU 内部的处理单元，每个核心都能独立处理指令；以及线程（threads），允许一个核心同时处理多条指令流。这些组件都按照时钟信号（clock）的节拍运行，时钟提供了同步整个系统所需的节拍。此外，还有总线（buses，用于数据传输）、指令寄存器（instruction register）和指令指针（instruction pointer，用于追踪下一步要执行的内容）等辅助组件，将整个系统紧密连接，使指令能顺畅地从一个步骤流转到下一个。</p>
<p>CPU 的工作遵循一个简单却强大的循环：<strong>取指（fetch）→ 译码（decode）→ 执行（execute）</strong> 。</p>
<ul>
<li>它从内存中取指数据或指令，</li>
<li>将它们译码为硬件能理解的信号，</li>
<li>然后执行所需的操作（例如计算、数值比较，或将数据发送到其他地方）。</li>
</ul>
<p>在现代处理器中，这一过程每秒可发生数十亿次，多个核心与线程并行工作提升性能，使 CPU 如同一个高度协同的组件团队。CPU 核心数量较少（例如 1 到 2 个）时，通常更注重能效（即单位功耗下完成更多有效工作），适合轻量或日常任务，而核心数量较多的 CPU 则用于支撑高性能、高负载的任务。</p>
<p>如今的 CPU 主要来自以下厂商：</p>
<ul>
<li>Intel，产品包括 Core 系列（消费级）、Xeon（服务器/工作站）、Pentium 和 Celeron（入门级）芯片；</li>
<li>AMD，提供 Ryzen（消费级/高性能）和 EPYC（服务器）处理器，以及 APU（Accelerated Processing Unit），它将 CPU 和 GPU 集成在同一颗芯片上（我们稍后会详细讨论）。</li>
</ul>
<p>CPU 用于 AI 时面临的主要问题是：<strong>它针对的是顺序执行的通用任务，而非大规模并行的矩阵运算，因此在速度和能效上远逊于 GPU 或专用芯片。</strong></p>
<p>接下来，让我们转向介绍第二款芯片 —— 著名的 GPU。</p>
<h3 data-id="heading-3"><strong>1.2 图形处理单元（Graphics Processing Unit, GPU）</strong></h3>
<p>图形处理单元（GPU）专为高吞吐量的大规模并行数据处理而优化。GPU 最初被发明用于加速图像和视频中的计算机图形渲染，但后来人们发现它在非图形计算任务中同样大有用武之地。如今，GPU 被广泛应用于可并行化的工作负载，例如处理数据密集型任务和训练 AI 模型。</p>
<p>如今，GPU 是推动 AI 性能提升的核心力量，也是衡量 AI 计算能力的一项关键指标。</p>
<p>“图形处理单元”（GPU）这一术语由 NVIDIA 于 1999 年正式提出，随 GeForce 256 显卡一同发布。NVIDIA 称其为全球首款 GPU，其官方定义为：“集成变换、光照、三角形设置/裁剪及渲染引擎的单芯片处理器。”</p>
<p>那么，这款传奇的 GPU 究竟是如何工作的？→</p>
<p>GPU 内部是一块硅芯片，上面蚀刻着数十亿个微型晶体管，被组织成数千个轻量级处理核心。这些核心通过复杂的布线相互连接，并由高带宽内存和缓存提供支持，使数据能在核心之间高速流动。整个芯片被封装在保护材料中，并配有散热系统来维持稳定运行。</p>
<p>（了解芯片历史的最佳读物之一是克里斯·米勒（Chris Miller）所著的《芯片战争：世界最关键技术的争夺战》（Chip War: The Fight for the World’s Most Critical Technology），强烈推荐。）</p>
<p>与 CPU 不同，GPU 专为并行计算而生 —— 它会将一项大型任务拆分成成千上万个更小、彼此独立的子任务，并将它们分发到各个核心上同步计算。正因如此，GPU 非常适合训练和运行 AI 模型，因为这些模型涉及对海量数据集进行重复的矩阵与张量运算。得益于 GPU 的并行架构，原本需要数月的训练如今几天就能完成，推理速度也足以支撑实时应用 —— 比如聊天机器人。</p>
<p>全球 GPU 生产的领军者是 NVIDIA，它打造了完整的并行计算平台 CUDA（Compute Unified Device Architecture），将 GPU 硬件能力释放到通用计算领域，大幅降低了 GPU 编程的门槛。</p>
<p>NVIDIA 面向 AI 基础设施和行业应用的主要 GPU 产品包括：</p>
<ul>
<li><strong>V100（Volta 架构）</strong>  – 专为深度学习加速而设计，首次引入 Tensor Core（张量核心） —— 专用于加速 AI 训练中矩阵运算的硬件单元。</li>
<li><strong>A100（Ampere 架构）</strong>  – 拥有更多 Tensor Core、更高内存带宽，并支持多实例 GPU（MIG）技术，可将一块物理 GPU 划分为多个逻辑 GPU，提升资源利用效率。</li>
<li><strong>H100、H200（Hopper 架构）</strong>  – 当前 AI 领域的行业标准。H 系列支持 Transformer Engine、超大内存带宽，以及极致的训练与推理速度。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6352519dc001427c80a82a672d7b5a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=tXzzbTwgXULy5EgEQ33J35UX3RU%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：NVIDIA H100 NVL GPU 产品文档</p>
<ul>
<li><strong>Blackwell（例如 B200 和 GB200 Grace-Blackwell “超级芯片”）</strong> 专为下一代拥有数万亿甚至十万亿级参数的 AI 模型而设计。作为 Hopper 架构的继任者，它引入了 FP4 精度，并在推理吞吐量上实现了大幅提升，尤其针对超大规模 Transformer 工作负载。</li>
</ul>
<p>随着行业对 AI 专用处理器的需求日益增长，第三类核心硬件 —— TPU 应运而生。</p>
<h3 data-id="heading-4"><strong>1.3 张量处理单元（Tensor Processing Unit, TPU）</strong></h3>
<p>张量处理单元（TPU）是由 Google 专为加速神经网络运算（尤其是矩阵乘法与机器学习工作流）定制的芯片。它最初在 2016 年 Google I/O 大会上亮相，属于 ASIC（Application-Specific Integrated Circuits，专用集成电路）类别。TPU 的基本架构如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8044bca4ab3747fb968b5a88c360411d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=SKz600s%2FFc6vqntRDUxdvt5H1Yk%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：论文《In-Datacenter Performance Analysis of a Tensor Processing Unit》</p>
<ul>
<li>其核心组件是矩阵乘法单元（Matrix Multiply Unit） —— 一个巨大的 256×256 乘加单元（MAC）阵列，采用脉动阵列（systolic array）结构，数据以“波”的形式在网格中流动。</li>
<li>TPU 还配备了大容量片上存储器：</li>
</ul>

<ul>
<li>
<ul>
<li>统一缓冲区（Unified Buffer，24 MB）：用于存放中间激活值；</li>
<li>权重存储器/ FIFO（Weight Memory/FIFOs）：用于存储神经网络权重；</li>
<li>累加器（Accumulators，4 MB）：用于收集求和结果。</li>
<li>控制逻辑、PCIe 接口和激活单元（用于 ReLU、sigmoid 等函数）为矩阵引擎提供支持，但芯片的大部分面积都用于原始计算和高速数据传输。</li>
</ul>
</li>
</ul>
<p>TPU 的主要特点是作为协处理器工作：</p>
<ul>
<li>主机 CPU 通过 PCIe 向 TPU 发送指令，TPU 直接执行这些指令。</li>
<li>其指令集非常精简（仅约十几条指令），硬件通过流水线设计确保矩阵单元始终处于忙碌状态。</li>
<li>像 TensorFlow 这样的框架会将模型编译成这些底层指令。</li>
</ul>
<p>256 个小型片上存储器（分布式累加器 RAM）用于收集部分和，而脉动阵列则执行乘加（MAC）运算。通过将权重和数据持续流入脉动阵列，并在片上缓冲区中本地复用，TPU 最大限度地减少了对片外内存的访问。因此，大部分计算任务（逐层进行）都能直接在芯片上完成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a12c71695d54079bf56c1fbf1f40991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=bpCoRBbY%2Bb3FKYhivhCZ6c05g4E%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：论文《In-Datacenter Performance Analysis of a Tensor Processing Unit》</p>
<p>总结来说，<strong>TPU 中的每个单元执行小规模计算，并将部分结果传递下去，从而节省功耗，并极大加快 AI 模型背后的数学运算速度。</strong> 这正是 TPU 在相同任务中能实现高吞吐量，同时功耗远低于 CPU/GPU 的原因。根据 Google 2017 年的分析，TPU 在能效比（每瓦性能）上比同期 CPU 和 GPU 高出约 30–80 倍（在推理任务中，拿 TPU 和 K80 这类 GPU 做能效对比）。</p>
<p>然而，仅靠这三种硬件（CPU、GPU、TPU），我们仍无法全面理解驱动 AI 发展的全部技术力量。因此，我们还需梳理整个领域还有哪些技术可供选择。由于 TPU 属于 ASIC 类 AI 芯片，我们将从这一类别出发，探索更多强有力的替代方案。接下来，让我们来深入看看它们如何构想未来 →</p>
<h2 data-id="heading-5"><strong>02 专用集成电路（Application-Specific Integrated Circuits, ASICs）</strong></h2>
<p>ASIC 是完全定制的硅芯片，专为某一种特定的 AI 工作负载而设计。这类芯片既包括云服务巨头的自研芯片，也涵盖初创企业打造的专用 AI 硬件。在这一领域，我们不得不提及……</p>
<h3 data-id="heading-6"><strong>2.1 Cerebras 晶圆级引擎（Wafer-Scale Engine, WSE）</strong></h3>
<p>Cerebras 将未来押注于晶圆级芯片。其最新款 Cerebras WSE-3 芯片实际上是史上尺寸最大的 AI 芯片之一 —— 面积高达 46,255 mm²。其核心技术在于：<strong>Cerebras 将整片硅晶圆直接制成一颗芯片，而不是像传统 CPU 或 GPU 那样将晶圆切割成数百个小处理器。</strong></p>
<p>WSE-3 包含 4 万亿个晶体管、90 万个专为 AI 优化的核心，以及 44 GB 片上 SRAM 内存。每个核心都配备有独立的本地内存，并通过横跨整个晶圆的超高带宽互连网络（fabric）彼此连接，从而大幅缩短计算单元与内存之间的距离。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba80e99b5a4b4e86848ce97984f8a9b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=4uM7jmxiSbfGfGIrrdnzemGJngo%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：Cerebras Wafer-Scale Engine (WSE) 产品手册</p>
<p>Cerebras 的晶圆级理念带来了令人瞩目的成果：</p>
<ul>
<li>单颗 WSE-3 可提供 125 petaFLOPS 的 AI 算力。</li>
<li>据 Cerebras 声称，将 WSE-3 组合成晶圆级集群（Wafer-Scale Cluster, WSC），并集成 MemoryX（用于存储超大模型权重的片外存储）和 SwarmX（用于在节点间广播权重并聚合梯度），即可高效支持数万亿参数模型的训练，且几乎能随硬件规模线性提升性能，同时规避传统 GPU 集群中复杂的通信开销。</li>
</ul>
<p><strong>目前有哪些模型已在 Cerebras WSE 上运行？</strong> 以下是两个典型示例：</p>
<p>1）阿里巴巴的 Qwen3 Coder 480B Instruct，推理速度达到 每秒 2,000 个 token。</p>
<p>2）混合专家模型（Mixture-of-Experts, MoE）：Cerebras 使其大规模训练变得更加简单高效。这类模型可在单个设备上完成训练，无需模型并行（而使用 GPU 时通常必须依赖模型并行）。Cerebras 采用的注意力批处理分块（Batch Tiling on Attention, BTA）技术，解决了稀疏 MoE 模型的计算效率问题 —— 它将注意力层与专家层的批处理需求解耦：注意力层在较小的“分块”（tiles）上运行，以降低内存压力；专家网络则处理更大的有效批次，确保其核心始终处于高利用率状态。</p>
<p>由此可见，这是一项以规模制胜的强大技术。</p>
<h3 data-id="heading-7"><strong>2.2 AWS Trainium 与 AWS Inferentia</strong></h3>
<p>亚马逊同样推出了突破 GPU 垄断的替代方案，并形成了自己对高效硬件的独特构想。其两款自研芯片专为 AI 工作负载设计，并深度集成于 AWS 生态系统之中。</p>
<p>AWS Trainium 专用于模型训练，AWS Inferentia 则面向推理任务。<strong>这两款芯片内部均采用定制的 NeuronCore、高带宽内存（HBM），以及用于张量运算、集合通信和稀疏性加速的专用引擎。</strong></p>
<p>配备 64 颗 Trainium 2 芯片的 Trainium 2 UltraServer 服务器，在处理稀疏模型时，最高可提供 83.2 petaflops 的 FP8 算力；在处理稠密模型时，FP8 算力约为 20.8 petaflops。相比之下，单颗 NVIDIA H100 GPU 的 FP8 算力大约只有 4 petaflops。</p>
<p>AWS Inferentia 2 支持大规模部署大语言模型（LLM）和扩散模型（diffusion models），其每瓦性能比基于 GPU 的同类 EC2 实例（例如 G5 系列）提升约 50 %。</p>
<p>因此，AWS 硬件为生成式 AI 的需求提供了在规模、性能与成本效益三者之间高度平衡的解决方案。</p>
<p>在了解了这些定制化的高效 ASIC 的案例后，我们再回到那些名字中带有 “..PU” 的硬件新锐。接下来是……</p>
<h3 data-id="heading-8"><strong>2.3 加速处理单元（Accelerated Processing Unit, APU）</strong></h3>
<p>如前文所述，<strong>AMD 开发了一种混合型处理单元架构，将 CPU 与 GPU 的能力融合进单一芯片封装中，由此诞生了加速处理单元（APU）。这种设计消除了在独立处理器之间来回传输数据所带来的性能瓶颈。</strong></p>
<p>迄今为止，该理念的最大代表作是 AMD Instinct MI300A。它集成了 24 个 “Zen 4” CPU 核心、228 个 GPU 计算单元，以及高达 128 GB 的 HBM3 内存。</p>
<p>其内部采用 AMD 的 chiplet（小芯片）与 3D 堆叠技术打造。MI300A 的内存能够在 CPU 和 GPU 之间共享，峰值带宽高达 5.3 TB/s。其多芯片架构通过 chiplet 与裸片堆叠，将 CPU 和 GPU 计算单元紧邻高带宽内存布置，并由 AMD 的 Infinity Fabric 与 Infinity Cache 统一互联。此外，该芯片全面支持主流 AI 数据格式，并具备硬件级稀疏性加速能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d36bc4cce34a53bf714f045abdd3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=72ZbDtIgwDa1wq5zLqUGHcUP4W8%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：AMD INSTINCT™ MI300A APU 产品手册</p>
<p>那么问题来了：既然可以拥有“一体式引擎”，又何必在 CPU 和 GPU 之间做选择？</p>
<p>NVIDIA 也在其 NVIDIA Grace Hopper Superchip 中践行了类似理念 —— 这是一款统一模块，将基于 Arm 架构的 Grace CPU 与 Hopper GPU 通过 NVIDIA 自研的 NVLink-C2C 芯片间互连技术紧密耦合。其核心优势与 AMD MI300A 高度一致：</p>
<ul>
<li>CPU 与 GPU 线程可直接访问彼此的内存，</li>
<li>能够执行原子操作，</li>
<li>并实现更高效的同步管理。</li>
</ul>
<p>NVIDIA 表示，Grace Hopper Superchip 在图神经网络（GNN）训练上，速度比通过 PCIe 互联的 H100 GPU 快最多 8 倍；在嵌入向量（embedding）生成任务上，比纯 CPU 方案快约 30 倍。</p>
<p>然而，这种 CPU 与 GPU 的融合也带来了更高的功耗、更低的灵活性以及更复杂的制造工艺。</p>
<p>接下来，我们将转向一些更小巧的硬件类型。</p>
<h3 data-id="heading-9"><strong>2.4 神经网络处理单元（Neural Processing Unit, NPU）</strong></h3>
<p>你可以想象一下，在一颗普通芯片内部专门内置一个用于 AI 任务的加速器 —— 这也正是神经网络处理单元（NPU）的核心理念。NPU 本质上是现代芯片中专为运行 AI 工作负载而打造的小型引擎，用于处理神经网络、图像与语音识别，甚至本地运行的大语言模型（LLM）。通过模拟人脑神经网络架构，NPU 针对 AI 工作负载的计算模式进行专门优化：大量矩阵乘法、激活函数运算，以及在极低功耗下实现高速数据移动。</p>
<p>以下是一些我们如今能在各种设备中实际找到的 NPU 示例：</p>
<ul>
<li>高通（Qualcomm）Snapdragon 芯片中的 Hexagon NPU，为智能手机、汽车、可穿戴设备等提供 AI 功能支持。</li>
<li>Apple Neural Engine：首次亮相于 2017 年的 A11 Bionic 芯片，如今已集成于所有搭载 Apple Silicon 的 iPhone、iPad 和 Mac 中，用于驱动 Face ID、图像处理和 Sir 等功能。</li>
<li>英特尔 NPU（搭载于新一代酷睿 Ultra AI PC 处理器，如 Lunar Lake、Arrow Lake），专为在本地运行 Windows Copilot+ 功能而设计。</li>
<li>AMD 的 XDNA / XDNA 2 NPU：出现在面向笔记本的 Ryzen AI 处理器中，AI 性能高达 55 TOPS。</li>
</ul>
<p><strong>NPUs 非常适合端侧推理，但尚不足以用于训练大语言模型或运行极高负载的任务。</strong> <strong>此外，它们也无法取代 CPU 或 GPU 来执行通用计算任务。</strong> 如果你运行的不是神经网络类负载，NPU 甚至无法正常发挥作用。正是这种高度专精的特性，使 NPU 在众多“PU”中独树一帜。</p>
<h2 data-id="heading-10"><strong>03 其他有前景的替代架构</strong></h2>
<h3 data-id="heading-11"><strong>3.1 智能处理单元（Intelligence Processing Unit, IPU）</strong></h3>
<p>Graphcore 开发的 IPU 是一款具备 1,472 个独立处理器核心的大规模并行处理器，可同时运行近 9,000 个并行线程，并紧密耦合 900 MB 高速片上内存。这意味着数据可以在存储位置直接被处理。IPU 专为机器学习工作负载设计，凭借极高的细粒度并行能力和片上内存架构，它在图计算方面表现出色，能够通过并行处理图中各个节点上的操作，高效应对不规则且稀疏的工作负载。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf8aef48e8f4131b77817255a81a315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765930988&amp;x-signature=fLjxZaPndgeVEBZRYK8fI%2Fv8mL4%3D" alt="image.png" loading="lazy"/></p>
<p>图片来源：Graphcore IPU 博客，《Colossus™ MK2 GC200 IPU》</p>
<h3 data-id="heading-12"><strong>3.2 阻变处理单元（Resistive Processing Unit, RPU）</strong></h3>
<p>RPU 是一种实验性的存内计算（in-memory compute）单元，利用阻变存储器（如忆阻器 memristor 或 RRAM）直接在内存阵列中执行矩阵运算。这种方法极大减少了数据搬运，有望显著降低能耗与延迟。2025 年，IBM 研究人员展示了基于 ReRAM 的模拟存内 AI 加速器，支持片上训练与推理，具备低电压开关特性和多比特存储能力。</p>
<h3 data-id="heading-13"><strong>3.3 现场可编程门阵列（Field-Programmable Gate Arrays, FPGAs）</strong></h3>
<p>FPGA 在可重构 AI 领域具有重要地位，尤其适合需要完全掌控并行性、内存和延迟的场景。与 GPU 或 ASIC 不同，我们可以根据模型的具体需求定制 FPGA 的硬件逻辑，并在架构变更后重新编程。</p>
<p>典型案例如 AMD Versal™ AI Edge 系列 Gen 2，它属于 AMD 的自适应 SoC（System-on-Chip）家族。该芯片在传统 FPGA 可编程逻辑的基础上，进一步在同一裸片上集成了 Arm CPU 和专用 AI 引擎。</p>
<h2 data-id="heading-14"><strong>04 新兴架构（Emerging Architectures）</strong></h2>
<h3 data-id="heading-15"><strong>4.1 量子处理器（Quantum Processors）</strong></h3>
<p>量子芯片使用量子比特（qubits），而非经典比特，利用叠加（superposition）与纠缠（entanglement）等量子特性进行计算。目前，它们正被用于优化、搜索和模拟等任务领域的测试 —— 这些领域在理论上有望借助量子力学实现指数级加速。然而，量子比特仍然极其脆弱且易受噪声干扰，因此当前的量子计算机仅能处理“玩具级”问题。就现阶段而言，它仍是一个长期的“登月计划”，尚无法替代 GPU 或 ASIC。</p>
<h3 data-id="heading-16"><strong>4.2 存内计算（Processing-in-Memory, PIM）与基于 MRAM 的芯片</strong></h3>
<p>AI 面临的一大瓶颈在于内存与计算单元之间的数据搬运。PIM 技术将计算逻辑直接集成到内存阵列中，从而大幅减少这种来回传输。MRAM（磁阻随机存储器）是一种前景广阔的非易失性存储技术，能够支持这一范式转变，助力打造更高密度、更节能的 AI 加速器。三星等大厂以及 Mythic 等初创公司已开始试验相关原型。PIM 并非科幻概念 —— 未来十年内有望实际进入数据中心与边缘设备。</p>
<h3 data-id="heading-17"><strong>4.3 神经形态芯片（Neuromorphic Chips）</strong></h3>
<p>神经形态处理器受人脑脉冲神经元（spiking neurons）启发。与传统依赖密集的、时钟驱动的矩阵乘法不同，它们采用稀疏的、事件驱动的脉冲信号进行计算。例如 Intel 的 Loihi 和 IBM 的 TrueNorth，目标是在传感器、物联网（IoT）和机器人等场景中实现超低功耗的智能。其主要挑战在于：脉冲神经网络（SNN）仍处于早期阶段。尽管神经形态硬件在低功耗边缘 AI 领域潜力巨大，但尚不确定它能否扩展至像大型 Transformer 这类的主流工作负载。</p>
<h2 data-id="heading-18"><strong>05 结语（Conclusion）</strong></h2>
<p>总体而言，各类硬件的定位如下：</p>
<ul>
<li>CPU（中央处理单元）——通用处理器。</li>
<li>GPU（图形处理单元）——专为并行图形计算/数学计算优化。</li>
<li>TPU（张量处理单元）——Google 的 AI 加速器。</li>
<li>ASICs（专用集成电路）——为特定 AI 工作负载定制的芯片。</li>
<li>APU（加速处理单元）——AMD 的 CPU + GPU 融合架构。</li>
<li>NPU（神经网络处理单元）——专为端侧 AI/ML 推理优化的小型芯片。</li>
<li>IPU（智能处理单元）——提供极高细粒度的并行性与片上内存架构。</li>
<li>RPU（阻变处理单元）——基于阻变存储器的存内计算单元。</li>
<li>FPGAs（现场可编程门阵列）——支持对并行性、内存和延迟的完全控制。</li>
</ul>
<p>由此可见，如今“PU”家族选项丰富，GPU 之外也涌现出多种替代方案，这使得硬件生态呈现多样化的态势，并为未来多方向的突破敞开大门。近期，多家科技巨头纷纷宣布正在研发新一代硬件：NVIDIA 正在推进 Rubin 架构，Meta 在测试自研芯片，阿里巴巴及其他中国公司也在开发 AI 推理芯片，以构建自主的硬件生态。这意味着更多全新的技术栈将陆续登场。</p>
<p>若跳出 GPU 和 CPU 的传统框架，我们能清晰看到一个趋势：<strong>AI 硬件市场正加速碎片化，各大厂商都在推动各自的软硬一体化生态。</strong> 这对开发者和企业而言，既是机遇，也是挑战 —— 如何在不断扩张的硬件版图中，有效应对兼容性、软件支持与成本效益等问题，将成为未来的关键课题。</p>
<p><strong>END</strong></p>
<p><strong>本期互动内容 🍻</strong></p>
<p><strong>❓AI 硬件生态正加速碎片化，你认为未来是“一超多强”还是“百花齐放”？</strong></p>
<p><strong>原文链接：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.artificialintelligencemadesimple.com%2Fp%2Finside-the-ai-hardware-race-guest" target="_blank" title="https://www.artificialintelligencemadesimple.com/p/inside-the-ai-hardware-race-guest" ref="nofollow noopener noreferrer">www.artificialintelligencemadesimple.com/p/inside-th…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[量子位：量子计算的支柱]]></title>    <link>https://juejin.cn/post/7581702285563691058</link>    <guid>https://juejin.cn/post/7581702285563691058</guid>    <pubDate>2025-12-10T00:30:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581702285563691058" data-draft-id="7581666412022251529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="量子位：量子计算的支柱"/> <meta itemprop="keywords" content="量子计算"/> <meta itemprop="datePublished" content="2025-12-10T00:30:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天行无忌"/> <meta itemprop="url" content="https://juejin.cn/user/4406498333033918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            量子位：量子计算的支柱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498333033918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天行无忌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:30:06.000Z" title="Wed Dec 10 2025 00:30:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad6e1fa63244f77a5190386cb10fcad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931405&amp;x-signature=Oe144rZShdTHHYtVXo31q%2BSym0E%3D" alt="未标题-1.jpg" loading="lazy"/></p>
<p>量子位是量子信息的基本单位，这是一个既有趣又复杂的概念。这不仅仅是科技领域的另一种趋势；它也是一种趋势。它是即将到来的量子计算时代的革命性基石。</p>
<blockquote>
<p>“量子位代表原子、离子、光子或电子以及它们各自的控制设备，它们一起工作，充当计算机存储器和处理器。” — IBM 量子研究员</p>
</blockquote>
<p>在接下来的几节中，将深入探讨量子位对量子计算领域如此重要的原因。但首先，需要一个基础，首先要了解量子位到底是什么以及为什么它对量子计算的未来至关重要。</p>
<ul>
<li>什么是量子比特？</li>
<li>量子比特如何工作？</li>
<li>为什么量子比特在量子计算中很重要？</li>
</ul>
<p>无论是对这个概念完全陌生还是只是寻求深入的解释，本文都将引导了解量子位的世界并定义其在未来计算中的作用。</p>
<p>首先解释什么是量子位。通俗地说，量子比特，即“量子位”，是量子信息的基本单位。这与经典计算中“位”的概念相似，但有一些重要的差异。</p>
<p>如果熟悉传统计算，就会知道位提供两种可能的状态：<code>0</code> 和 <code>1</code>。这是经典计算机的二进制基础。然而，量子位超越了这种二元性。由于量子物理学的独特性质，量子位不仅可以存在于状态 <code>0</code> 或 <code>1</code>，还可以存在于这些状态的叠加中。这意味着一个量子位可以同时处于 <code>0</code> 和 <code>1</code> 状态，这个概念乍一看似乎很陌生。</p>
<p>当开始将几个量子位以一种称为量子纠缠的方式组合在一起时，真正的魔法就会发生。在这样一个纠缠系统中，量子位可以以经典计算中无法做到的方式相互关联。这些叠加和纠缠释放了巨大的计算能力，这就是量子计算真正发挥作用的时候。</p>
<p>那么，为什么要关心量子位呢？计算的未来在于量子计算及其量子比特的核心。量子计算的潜在应用是巨大的：从以极低的成本和时间创造新药，到破解以前无法破解的代码，到准确预测气候变化等等。了解量子比特是人类实现这一巨大飞跃的一小步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d260ffac2fc4bccb3fba95d10338686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp6KGM5peg5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931405&amp;x-signature=3kU%2FmDV1xTR%2BRMcVynBNO%2FCIuTc%3D" alt="image.png" loading="lazy"/></p>
<p>虽然仍处于量子计算技术的早期阶段，但对量子位的理解和操纵正在取得重大进展。通过深入研究量子位的世界，正在为未来铺平道路，在未来，曾经因计算限制而被认为无法解决的问题可以得到正面解决。</p>
<p>当更加深入地探究量子计算的奥秘时，可能会取得的成就令人惊讶。这一切都始于理解不起眼但功能强大的量子位。</p>
<p>通过一个例子来仔细研究一下量子位。想象一下有一个处于 <code>|ψ⟩</code> 状态的量子位。在量子力学中，这种状态可以使用线性代数作为列向量来表示：</p>
<pre><code class="hljs">|ψ⟩ = α | 0 ⟩ + β | 1 ⟩
</code></pre>
<p>在上面的等式中，<code>α</code> 和 <code>β</code> 是复概率幅，其平方后给出量子位处于状态 <code>|0⟩</code> 或状态 <code>|1⟩</code> 的可能性。对于有效的量子态，这些概率的总和必须等于 <code>1</code>。因此，可以写：</p>
<pre><code class="hljs language-css" lang="css">|<span class="hljs-selector-tag">a</span>|^ <span class="hljs-number">2</span> + |<span class="hljs-selector-tag">b</span>|^ <span class="hljs-number">2</span> = <span class="hljs-number">1</span>
</code></pre>
<p>因此，通过这个数学方程，可以计算量子计算中任何给定状态的概率！这不是很迷人吗？</p>
<ul>
<li>与经典计算中的传统位不同，量子位由于叠加的特性可以同时处于两种状态，使其更能够进行复杂的计算。</li>
<li>每增加一个量子位，量子计算机的计算能力就会呈指数级增长，展现出计算能力的巨大飞跃。</li>
<li>纠缠是另一种关键的量子现象，它使纠缠的量子位无论距离如何都能立即相互影响，为超高速、下一代数据传输奠定了基础。</li>
<li>量子纠错是量子计算的另一个关键方面，由于量子位的脆弱性，因此需要它。科学家们全神贯注于开发管理和纠正量子错误的技术。</li>
<li>量子霸权时代是可以​​预见的，即量子计算机在解决复杂问题方面超越经典计算机，但尚未完全到来。我们是量子计算发展的一部分。</li>
<li>最后，虽然量子计算拥有巨大的潜力，但由于其目前处于起步阶段以及与扩大规模相关的技术挑战，它仍然主要存在于实验室环境中。然而，过去十年所取得的进步证明了这项技术不可阻挡的发展。</li>
</ul>
<p>总之，在改变游戏规则的量子信息单位——量子比特的引领下，释放量子计算真正潜力的冒险之旅正在顺利进行。凭借叠加和纠缠等独特功能，量子位有望重新定义计算能力和速度的界限，有望实现量子霸权等突破，这可能会彻底改变从解密到复杂问题解决等许多领域。然而，必须承认所面临的挑战。对有效量子纠错方法的探索和扩大量子系统的任务证明了这条道路的复杂性。然而，不断的进步提醒我们，这个方向的每一步都是计算进化的一步，开启了量子计算不再局限于实验室，而是成为我们日常生活不可或缺的一部分的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个让你爽歪歪的请求工具是怎样的]]></title>    <link>https://juejin.cn/post/7581752787563413544</link>    <guid>https://juejin.cn/post/7581752787563413544</guid>    <pubDate>2025-12-10T00:35:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787563413544" data-draft-id="7578719771588788234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个让你爽歪歪的请求工具是怎样的"/> <meta itemprop="keywords" content="Vue.js,React.js,Node.js"/> <meta itemprop="datePublished" content="2025-12-10T00:35:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古韵"/> <meta itemprop="url" content="https://juejin.cn/user/1538972010422872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个让你爽歪歪的请求工具是怎样的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1538972010422872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古韵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:35:28.000Z" title="Wed Dec 10 2025 00:35:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>各位好，很久没出来发一发alova文章了，现在的alova已经更新到第3个大版本了，看这篇文章可能会让你对它有个全新的认识。</p>
<p>如果你之前了解过alova，那么大概率知道alova是一个轻量级的请求策略库，通过它的客户端请求hooks和缓存高效地处理前端数据请求。</p>
<p>而到今天，alova3在此基础上实现了更大的提升，它不只是在客户端中使用，现在还能在服务端环境下大放异彩，是一个<strong>全栈式的极致高效的请求工具集</strong>，其核心目标是帮助开发团队更高效地集成和调用API，并且完美兼容fetch、axios等HTTP客户端，以及react、vue、svelte等UI框架。</p>
<p>具体来说，alova3相比之前的版本，它带来了以下的大更新。</p>
<ol>
<li>多级缓存：请求效率和减压利器。</li>
<li>全栈的请求策略：帮你大大减少请求代码。</li>
<li>更加现代化的OpenAPI工具：不仅可以自动生成请求代码，还能把api文档搬到编辑器中，交互式地调用api，打破过去的api集成流程。</li>
</ol>
<p><strong>这里我想郑重声明一下，由于ai大模型对alova知识学习的不足，现在网上充斥着各种ai编写的alova的错误使用的文章，建议大家前往<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org" target="_blank" title="https://alova.js.org" ref="nofollow noopener noreferrer">alova官网</a>了解alova的正确使用方法。</strong></p>
<h2 data-id="heading-0">一、多级缓存</h2>
<p>多级缓存机制可以为你的服务端应用提供最快的请求体验。你可以自由选择单级缓存还是多级缓存使用，它们运行机制如下：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户请求] --&gt; B{检查L1缓存}
    B --&gt;|命中| C[返回数据]
    B --&gt;|未命中| D{检查L2缓存}
    D --&gt;|命中| E[更新L1缓存]
    D --&gt;|未命中| F[请求API接口]
    F --&gt; G[更新L2缓存]
    E --&gt; C
    G --&gt; E
    C --&gt; H[结束]
</code></pre>
<p>默认情况下，alova 的一级缓存是简单的 object 以 key-value 的方式缓存，而二级缓存在不同环境下的默认表现也不同，具体看下面。</p>
<h3 data-id="heading-1">客户端</h3>
<p>在客户端环境下，一级缓存一般用于短时的请求数据缓存，例如几分钟或几秒钟的频繁请求相同数据带来的性能消耗，当你在写 todo 详情页的时候，你可能会想到用户会频繁在 todo 列表中点击查看详情，此时使用一级缓存可以大大提升效率，降低服务端压力。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对详情数据设置60秒的一级缓存</span>
alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/todo/detail'</span>, {
  <span class="hljs-attr">params</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span>
  },
  <span class="hljs-attr">cacheFor</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 设置60秒的一级缓存</span>
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<p>而二级缓存可用于一些枚举数据、节日等长期不变的请求为主，默认使用<code>localStorage</code>存储。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 对枚举数据设置3天缓存时间</span>
alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/config/enum'</span>, {
  <span class="hljs-attr">params</span>: {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'xxx'</span>
  },
  <span class="hljs-attr">cacheFor</span>: {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'restore'</span>,
    <span class="hljs-attr">expire</span>: <span class="hljs-number">3</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 缓存3天时间</span>
  }, 
});
</code></pre>
<h3 data-id="heading-2">服务端</h3>
<p>在服务端环境下，多级缓存机制特别适用于以下场景：</p>
<ol>
<li>
<p><strong>高访问频率和低延迟需求</strong>：例如热门新闻、商品详情，可以进一步减少网络开销，在网络不稳定时也保持更快的响应。</p>
</li>
<li>
<p><strong>减轻下游服务器压力</strong>：例如有访问高峰期的服务，上层缓存可以有效减少对后端数据库和微服务的压力。</p>
</li>
<li>
<p><strong>整合多个下游服务器的数据合并和处理</strong>：多个串行请求可能导致更长的响应时间，也可能因复杂的数据转换消耗性能，可将转换后的数据进行缓存。</p>
</li>
<li>
<p><strong>API 速率限制和计费</strong>：天气预报服务 API 每小时更新一次天气信息，地理位置数据 API 等。</p>
</li>
<li>
<p><strong>鉴权数据</strong>：用户token等数据缓存到内存中，避免频繁的鉴权操作。</p>
</li>
<li>
<p><strong>请求速率限制等分布式数据</strong>：用户的请求次数限制等数据。</p>
</li>
</ol>
<p>具体可以看<a href="https://juejin.cn/post/7578820431018622991?share_token=0ebefce4-4817-450a-bae9-191040529eb6" target="_blank" title="https://juejin.cn/post/7578820431018622991?share_token=0ebefce4-4817-450a-bae9-191040529eb6">这篇文章</a></p>
<p>以下是一个使用进程间内存共享适配器加 LRU cache 作为一级缓存，redis 作为二级缓存的示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { createPSCAdapter, <span class="hljs-title class_">NodeSyncAdapter</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@alova/psc'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">LRUCache</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lru-cache'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RedisStorageAdapter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./adapter-redis'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">lRUCache</span>(<span class="hljs-params">options = {}</span>) {
  <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>(options);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">set</span>(key, value);
    },

    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(key);
    },

    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">delete</span>(key);
    },

    <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">clear</span>();
    }
  };
}

<span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>

  <span class="hljs-comment">// 进程间共享缓存适配器</span>
  <span class="hljs-attr">l1Cache</span>: <span class="hljs-title function_">createPSCAdapter</span>(
    <span class="hljs-title class_">NodeSyncAdapter</span>(),
    <span class="hljs-title function_">lRUCache</span>({
      <span class="hljs-attr">max</span>: <span class="hljs-number">1000</span>,
      <span class="hljs-attr">ttl</span>: <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">10</span>
    })
  ),

  <span class="hljs-comment">// redis缓存适配器</span>
  <span class="hljs-attr">l2Cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStorageAdapter</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>,
    <span class="hljs-attr">username</span>: <span class="hljs-string">'default'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'my-top-secret'</span>,
    <span class="hljs-attr">db</span>: <span class="hljs-number">0</span>
  })
});
</code></pre>
<p>通过多级缓存机制，alova3能够实现：</p>
<ul>
<li><strong>响应时间减少80%+</strong>：通过内存缓存实现毫秒级响应</li>
<li><strong>服务器负载降低60%+</strong>：减少不必要的API调用</li>
<li><strong>离线体验优化</strong>：持久化缓存支持完整的离线功能</li>
<li><strong>带宽节约</strong>：减少重复数据传输</li>
</ul>
<p>这种多级缓存架构使得alova3特别适合需要高性能数据访问的现代Web应用，在微服务架构和分布式系统中也表现出色。</p>
<h2 data-id="heading-3">二、全栈的请求策略</h2>
<h3 data-id="heading-4">服务端请求策略</h3>
<p>alova3一个关键特性是引入了对服务端的完整支持，你不仅可以在nodejs、deno、bun等运行时中使用，还提供了独有的服务端请求策略，简称server hooks，它可以很方便地处理分布式的BFF、API网关、第三方token管理等，同时还有请求速率限制、请求重试、验证码发送与校验等模块，可以快速实现分布式的特定业务逻辑。</p>
<p>BFF、API网关、第三方token管理等，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.alova.cn%2Fdocs%2Fserver-hooks" target="_blank" title="https://www.alova.cn/docs/server-hooks" ref="nofollow noopener noreferrer">这篇文章</a>中有详细的介绍，这边我们来看看验证码发送校验模块的使用。</p>
<p>按照惯例，首先创建一个alova实例。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { createAlova } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/server'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RedisStorageAdapter</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@alova/storage-redis'</span>);
<span class="hljs-keyword">const</span> adapterFetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/fetch'</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">requestAdapter</span>: <span class="hljs-title function_">adapterFetch</span>(),
  <span class="hljs-comment">// redis缓存适配器</span>
  <span class="hljs-attr">l2Cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStorageAdapter</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">6379</span>,
    <span class="hljs-attr">username</span>: <span class="hljs-string">'default'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'my-top-secret'</span>,
    <span class="hljs-attr">db</span>: <span class="hljs-number">0</span>
  })
});
</code></pre>
<p>然后再创建一个验证码提供者函数，并指定使用redis适配器作为缓存载体，以便实现分布式环境下的使用。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { createCaptchaProvider } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alova/server'</span>);

<span class="hljs-keyword">const</span> { sendCaptcha, verifyCaptcha } = <span class="hljs-title function_">createCaptchaProvider</span>({
  <span class="hljs-attr">store</span>: alovaInstance.<span class="hljs-property">options</span>.<span class="hljs-property">l2Cache</span>
});

<span class="hljs-keyword">export</span> sendCaptcha;
<span class="hljs-keyword">export</span> verifyCaptcha;
</code></pre>
<p>第三步，再发送验证码，这里我们使用<code>retry</code>来实现重试，提高成功率。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建一个发送验证码的method实例</span>
<span class="hljs-keyword">const</span> createCaptchaMethod = (code, key) = &gt; alovaInstance.<span class="hljs-title class_">Post</span>(<span class="hljs-string">'/api/captcha'</span>, {
  code,
  <span class="hljs-attr">email</span>: key,
});

<span class="hljs-comment">// 使用sendCaptcha hook包装createCaptchaMethod</span>
<span class="hljs-keyword">const</span> captchaMethod = <span class="hljs-title function_">sendCaptcha</span>(createCaptchaMethod, {
  <span class="hljs-attr">key</span>: <span class="hljs-string">'xxx@xxx.com'</span>
});

<span class="hljs-comment">// 使用retry hook包装captchaMethod，并通过await发送请求并获取响应结果</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">retry</span>(captchaMethod, {
  <span class="hljs-attr">retry</span>: <span class="hljs-number">3</span>,
  <span class="hljs-attr">backoff</span>: {
    <span class="hljs-attr">delay</span>: <span class="hljs-number">2000</span>
  }
});
</code></pre>
<p>最后一步，通过用户的提交来验证验证码。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fakeCaptchaFromUserInput = <span class="hljs-string">'1234'</span>;
<span class="hljs-keyword">const</span> isValid = <span class="hljs-keyword">await</span> <span class="hljs-title function_">verifyCaptcha</span>(fakeCaptchaFromUserInput, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid ? <span class="hljs-string">'验证通过'</span> : <span class="hljs-string">'验证码错误'</span>);
</code></pre>
<h3 data-id="heading-5">客户端的请求策略</h3>
<p>alova3的客户端请求策略与之前的版本大相径庭，依然提供了<code>useRequest</code>、<code>useWatcher</code>、<code>usePagination</code>等UI框架相关的hooks，在这里大家应该都很熟悉了，但不同的是，无论你使用react、vue还是svelte，这些hook都由统一的<code>alova/client</code>中导入。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'alova/client'</span>;

<span class="hljs-keyword">const</span> { data, loading, error, send } = <span class="hljs-title function_">useRequest</span>(alovaInstance.<span class="hljs-title class_">Get</span>(<span class="hljs-string">'/todo/list'</span>));
</code></pre>
<h3 data-id="heading-6">全栈框架nuxt支持</h3>
<p>虽然在之前的版本中，alova已经支持在next、nuxt、svelitekit等SSR框架中使用，不过在alova3中，提供了一个专门适配nuxt的statesHook，可以在使用<code>useRequest</code>、<code>useWatcher</code>等几乎所有的hooks时不仅可以同步两端的数据，像内置的<code>useFetch</code>一样避免在客户端重复请求，还可以同步例如<code>Date</code>，<code>Error</code>等以及自定义类型的数据，用法也非常简单，设置一下<code>NuxtHook</code>即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createAlova } <span class="hljs-keyword">from</span> <span class="hljs-string">'alova'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NuxtHook</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'alova/nuxt'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> alovaInstance = <span class="hljs-title function_">createAlova</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">statesHook</span>: <span class="hljs-title class_">NuxtHook</span>({
    <span class="hljs-attr">nuxtApp</span>: useNuxtApp <span class="hljs-comment">// 必须指定useNuxtApp</span>
  })
});
</code></pre>
<h2 data-id="heading-7">三、工具链支持：更加现代化的OpenAPI工具</h2>
<p>除了核心库的增强，alova3还提供了开发工具和vscode扩展来优化工作流。</p>
<p>如果你的项目支持openapi，这些开发工具可以基本消除API文档，让你直接在编辑器中查找接口、查看完整文档并交互式地快速插入接口的调用代码，很大程度地提升了开发效率和体验。</p>
<p>同时，你还可以完全控制openapi在前端生成的内容，例如过滤掉某些接口，新增、删除或修改某个接口的参数等，这些在openapi文件不够规范，或者有错误时非常有用，并且是其他openapi自动生成工具所不具备的。</p>
<p>一起来具体看看怎么回事。</p>
<h3 data-id="heading-8">快速查找和插入调用代码</h3>
<h3 data-id="heading-9">自定义修改生成内容</h3>
<p>在一般情况下，服务端的返回数据格式会外包一层，例如：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>而此时我们希望生成的响应数据类型为<code>response.data</code>，你可以在alova配置文件中使用<code>payloadModifier</code>插件。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@alova/wormhole'</span>;
<span class="hljs-keyword">import</span> { payloadModifier } <span class="hljs-keyword">from</span> <span class="hljs-string">'@alova/wormhole/plugin'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">generator</span>: [
    {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-attr">plugin</span>: [
        <span class="hljs-title function_">payloadModifier</span>([
          {
            <span class="hljs-attr">scope</span>: <span class="hljs-string">'response'</span>,
            <span class="hljs-attr">handler</span>: <span class="hljs-function"><span class="hljs-params">schema</span> =&gt;</span> schema.<span class="hljs-property">data</span>
          }
        ])
      ]
    }
  ]
});
</code></pre>
<p>你也还可以通过<code>handleApi</code>实现完全的自定义，例如以下是一个修改tag的例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">generator</span>: [
    {
      <span class="hljs-attr">handleApi</span>: <span class="hljs-function"><span class="hljs-params">apiDescription</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (apiDescription.<span class="hljs-property">url</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/user'</span>)) {
          apiDescription.<span class="hljs-property">tags</span> = [<span class="hljs-string">'userTag'</span>];
        }
        <span class="hljs-keyword">return</span> apiDescription;
      }
    }
  ]
});
</code></pre>
<h3 data-id="heading-10">边查边接入接口</h3>
<p>使用alova的vscode扩展，你可以直接在编辑器中查找接口，并直接插入调用代码，不仅如此，接口的所有相关信息都可以直接在代码中查看，像这样。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf48e785e23b487eac71aa3b41a98ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931728&amp;x-signature=3QJ%2FgaMng%2FpTCDoERIcQXiTqgi4%3D" alt="image.png" loading="lazy"/></p>
<p>弹框中能清楚的看到接口的描述信息、请求参数、响应参数等，你可以一边看着弹框中的参数，一边在代码中传参，这个点子太棒啦，再也不用在api文档和编辑器中来回切换，然后每次还要重新找对应信息了。</p>
<h3 data-id="heading-11">编辑器中的api文档</h3>
<p>这个vscode扩展还提供了在编辑器中查看接口文档的功能，你可以直接在编辑的侧边栏中查看接口文档，就像这样。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f1d07da3dfe49b7ac83c6401f3b9048~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765931728&amp;x-signature=R3G9Glf0284RekqbQLBZ1n3cIPI%3D" alt="" loading="lazy"/></p>
<p>也可以在代码中的调用代码上直接点击“view documentation”打开对应的接口文档，可以实现快速查看接口的描述信息、请求参数、响应参数等。</p>
<h2 data-id="heading-12">写在最后</h2>
<p>到这里，你应该感受到了一点alova3的不同了吧，通过以上的方式让前端在接口集成方向很大程度地提升效率，无论你是前端开发者希望提升应用性能，还是后端工程师需要构建高效的API网关，亦或是全栈开发者追求统一的开发体验，alova3都能为你提供完整的支持。</p>
<p>如果觉得alova还不错，真诚希望你可以<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fexamples" target="_blank" title="https://alova.js.org/examples" ref="nofollow noopener noreferrer">尝试体验一下</a>，也可以给我们来一个免费的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova" target="_blank" title="https://github.com/alovajs/alova" ref="nofollow noopener noreferrer">github stars</a>。</p>
<p>访问alovajs的官网查看更多详细信息：<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org" target="_blank" title="https://alova.js.org" ref="nofollow noopener noreferrer">alovajs官网</a>。</p>
<p>有兴趣可以加入我们的交流社区，在第一时间获取到最新进展，也能直接和开发团队交流，提出你的想法和建议。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fimg%2Fwechat_qrcode.jpg" target="_blank" title="https://alova.js.org/img/wechat_qrcode.jpg" ref="nofollow noopener noreferrer">加入微信群参与交流</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FS47QGJgkVb" target="_blank" title="https://discord.gg/S47QGJgkVb" ref="nofollow noopener noreferrer">加入在 Discord 社区参与交流</a></li>
</ul>
<p>有任何问题，你可以加入以下群聊咨询，也可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova%2Fdiscussions" target="_blank" title="https://github.com/alovajs/alova/discussions" ref="nofollow noopener noreferrer">github 仓库中发布 Discussions</a>，如果遇到问题，也请在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova%2Fissues" target="_blank" title="https://github.com/alovajs/alova/issues" ref="nofollow noopener noreferrer">github 的 issues</a>中提交，我们会在最快的时间解决。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter自定义日历table_calendar完全指南+案例]]></title>    <link>https://juejin.cn/post/7581693431740448831</link>    <guid>https://juejin.cn/post/7581693431740448831</guid>    <pubDate>2025-12-10T00:45:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740448831" data-draft-id="7581097545671376915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Flutter自定义日历table_calendar完全指南+案例"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-10T00:45:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Flutter自定义日历table_calendar完全指南+案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:45:26.000Z" title="Wed Dec 10 2025 00:45:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 简介</h2>
<p><code>table_calendar</code> 是 Flutter 生态中功能强大的日历组件，支持多种视图切换、事件标记、日期范围选择等核心功能，适合需集成日历功能的应用场景（如日程管理、预约系统等）。其高度可定制化的特性使其能适配不同的 UI 需求。</p>
<h2 data-id="heading-1">2. 基础配置</h2>
<h3 data-id="heading-2">安装</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">table_calendar:</span> <span class="hljs-string">^3.0.1</span>  <span class="hljs-comment"># 请使用最新版本</span>
</code></pre>
<h3 data-id="heading-3">最简实现</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:table_calendar/table_calendar.dart'</span>;

TableCalendar(
  firstDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2020</span>),
  lastDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2030</span>),
  focusedDay: <span class="hljs-built_in">DateTime</span>.now(),
  selectedDayPredicate: (day) {
    <span class="hljs-keyword">return</span> isSameDay(_selectedDay, day);
  },
  onDaySelected: (selectedDay, focusedDay) {
    setState(() {
      _selectedDay = selectedDay;
      _focusedDay = focusedDay;
    });
  },
)
</code></pre>
<p>核心参数说明：</p>
<ul>
<li><code>firstDay</code>/<code>lastDay</code>：日历显示范围（必传）</li>
<li><code>focusedDay</code>：当前聚焦的日期（控制滚动位置，必传）</li>
<li><code>selectedDayPredicate</code>：判断日期是否被选中的条件</li>
<li><code>onDaySelected</code>：日期选择回调（返回选中日期和新聚焦日期）</li>
</ul>
<h2 data-id="heading-4">3. 核心属性全解析</h2>
<h3 data-id="heading-5">3.1. 核心基础属性</h3>








































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>firstDay</code></td><td><code>DateTime</code></td><td>日历显示的起始日期（必传）</td></tr><tr><td><code>lastDay</code></td><td><code>DateTime</code></td><td>日历显示的结束日期（必传）</td></tr><tr><td><code>focusedDay</code></td><td><code>DateTime</code></td><td>当前聚焦的日期（必传，控制日历滚动位置）</td></tr><tr><td><code>selectedDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否被选中的条件</td></tr><tr><td><code>onDaySelected</code></td><td><code>void Function(DateTime, DateTime)</code></td><td>单个日期选中回调（选中日期+聚焦日期）</td></tr><tr><td><code>onPageChanged</code></td><td><code>void Function(DateTime)</code></td><td>日历页面切换时回调（返回新聚焦日期）</td></tr></tbody></table>
<h3 data-id="heading-6">3.2. 视图控制属性</h3>








































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarFormat</code></td><td><code>CalendarFormat</code></td><td>日历展示格式（month/week/twoWeeks）</td></tr><tr><td><code>onFormatChanged</code></td><td><code>void Function(CalendarFormat)</code></td><td>视图格式切换回调</td></tr><tr><td><code>availableCalendarFormats</code></td><td><code>Map&lt;CalendarFormat, String&gt;</code></td><td>允许的视图格式及对应显示文本</td></tr><tr><td><code>pageJumpingEnabled</code></td><td><code>bool</code></td><td>是否允许点击表头月份快速跳转页面（默认true）</td></tr><tr><td><code>weekNumbersVisible</code></td><td><code>bool</code></td><td>是否显示周数（默认false）</td></tr><tr><td><code>weekNumberStyle</code></td><td><code>TextStyle</code></td><td>周数文本样式</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  <span class="hljs-comment">// ...基础参数</span>
  calendarFormat: _calendarFormat,
  onFormatChanged: (format) {
    setState(() {
      _calendarFormat = format;
    });
  },
  availableCalendarFormats: {
    CalendarFormat.month: <span class="hljs-string">'月'</span>,
    CalendarFormat.week: <span class="hljs-string">'周'</span>,
    CalendarFormat.twoWeeks: <span class="hljs-string">'两周'</span>,
  },
)
</code></pre>
<h3 data-id="heading-7">3.3. 范围选择属性</h3>



































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>rangeStartDay</code></td><td><code>DateTime?</code></td><td>范围选择的起始日期</td></tr><tr><td><code>rangeEndDay</code></td><td><code>DateTime?</code></td><td>范围选择的结束日期</td></tr><tr><td><code>rangeSelectionMode</code></td><td><code>RangeSelectionMode</code></td><td>范围选择模式（toggledOff/toggledOn/forced）</td></tr><tr><td><code>onRangeSelected</code></td><td><code>void Function(DateTime?, DateTime?, DateTime)</code></td><td>范围选择回调（起始/结束/聚焦日期）</td></tr><tr><td><code>rangeDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否允许被纳入范围选择</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart">RangeSelectionMode _rangeSelectionMode = RangeSelectionMode.toggledOff;
<span class="hljs-built_in">DateTime?</span> _rangeStart;
<span class="hljs-built_in">DateTime?</span> _rangeEnd;

TableCalendar(
  <span class="hljs-comment">// ...基础参数</span>
  rangeStartDay: _rangeStart,
  rangeEndDay: _rangeEnd,
  rangeSelectionMode: _rangeSelectionMode,
  onRangeSelected: (start, end, focusedDay) {
    setState(() {
      _rangeStart = start;
      _rangeEnd = end;
      _rangeSelectionMode = RangeSelectionMode.toggledOn;
      _selectedDay = <span class="hljs-keyword">null</span>;  <span class="hljs-comment">// 清除单个选中</span>
    });
  },
)
</code></pre>
<h3 data-id="heading-8">3.4. 事件与标记属性</h3>






























<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>eventLoader</code></td><td><code>List&lt;Object&gt; Function(DateTime)</code></td><td>加载指定日期的事件数据</td></tr><tr><td><code>calendarBuilders</code></td><td><code>CalendarBuilders</code></td><td>自定义日历元素构建器（标记/日期等）</td></tr><tr><td><code>holidayLoader</code></td><td><code>List&lt;Object&gt; Function(DateTime)</code></td><td>加载指定日期的假日数据</td></tr><tr><td><code>eventFadeTransitionEnabled</code></td><td><code>bool</code></td><td>事件标记是否启用淡入动画（默认true）</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 定义事件数据结构</span>
<span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">DateTime</span>, <span class="hljs-built_in">List</span>&gt; _events = {
  <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>): [<span class="hljs-string">'会议'</span>, <span class="hljs-string">'生日'</span>],
  <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>): [<span class="hljs-string">'deadline'</span>],
};

TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  eventLoader: (day) {
    <span class="hljs-keyword">return</span> _events[day] ?? [];
  },
  calendarBuilders: CalendarBuilders(
    markerBuilder: (context, date, events) {
      <span class="hljs-keyword">if</span> (events.isEmpty) <span class="hljs-keyword">return</span> SizedBox();
      <span class="hljs-keyword">return</span> Positioned(
        bottom: <span class="hljs-number">1</span>,
        child: Container(
          width: <span class="hljs-number">16</span>,
          height: <span class="hljs-number">4</span>,
          decoration: BoxDecoration(
            color: Colors.blue,
            borderRadius: BorderRadius.circular(<span class="hljs-number">2</span>),
          ),
        ),
      );
    },
  ),
)
</code></pre>
<h3 data-id="heading-9">3.5. 样式定制属性</h3>


















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarStyle</code></td><td><code>CalendarStyle</code></td><td>日历主体样式配置</td></tr><tr><td><code>headerStyle</code></td><td><code>HeaderStyle</code></td><td>表头（月份栏）样式配置</td></tr><tr><td><code>daysOfWeekStyle</code></td><td><code>DaysOfWeekStyle</code></td><td>星期标题样式配置</td></tr><tr><td><code>rowHeight</code></td><td><code>double</code></td><td>日历行高（影响整体高度）</td></tr><tr><td><code>columnWidth</code></td><td><code>double?</code></td><td>日历列宽（null时自动计算）</td></tr><tr><td><code>padding</code></td><td><code>EdgeInsets</code></td><td>日历内边距</td></tr><tr><td><code>margin</code></td><td><code>EdgeInsets</code></td><td>日历外边距</td></tr><tr><td><code>clipBehavior</code></td><td><code>Clip</code></td><td>裁剪行为（默认Clip.hardEdge）</td></tr></tbody></table>
<h4 data-id="heading-10">CalendarStyle 子属性</h4>



















































































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>defaultTextStyle</code></td><td><code>TextStyle</code></td><td>默认日期文本样式</td></tr><tr><td><code>selectedTextStyle</code></td><td><code>TextStyle</code></td><td>选中日期文本样式</td></tr><tr><td><code>todayTextStyle</code></td><td><code>TextStyle</code></td><td>今天日期文本样式</td></tr><tr><td><code>weekendTextStyle</code></td><td><code>TextStyle</code></td><td>周末日期文本样式</td></tr><tr><td><code>outsideTextStyle</code></td><td><code>TextStyle</code></td><td>显示范围外日期文本样式</td></tr><tr><td><code>disabledTextStyle</code></td><td><code>TextStyle</code></td><td>禁用日期文本样式</td></tr><tr><td><code>selectedDecoration</code></td><td><code>Decoration</code></td><td>选中日期装饰（背景等）</td></tr><tr><td><code>todayDecoration</code></td><td><code>Decoration</code></td><td>今天日期装饰</td></tr><tr><td><code>defaultDecoration</code></td><td><code>Decoration</code></td><td>默认日期装饰</td></tr><tr><td><code>weekendDecoration</code></td><td><code>Decoration</code></td><td>周末日期装饰</td></tr><tr><td><code>outsideDecoration</code></td><td><code>Decoration</code></td><td>范围外日期装饰</td></tr><tr><td><code>disabledDecoration</code></td><td><code>Decoration</code></td><td>禁用日期装饰</td></tr><tr><td><code>rangeStartDecoration</code></td><td><code>Decoration</code></td><td>范围选择起始日期装饰</td></tr><tr><td><code>rangeEndDecoration</code></td><td><code>Decoration</code></td><td>范围选择结束日期装饰</td></tr><tr><td><code>rangeMiddleDecoration</code></td><td><code>Decoration</code></td><td>范围选择中间日期装饰</td></tr><tr><td><code>markersDecoration</code></td><td><code>Decoration</code></td><td>事件标记容器装饰</td></tr><tr><td><code>markersMaxCount</code></td><td><code>int</code></td><td>最多显示的事件标记数量</td></tr><tr><td><code>markerSize</code></td><td><code>double</code></td><td>事件标记大小</td></tr><tr><td><code>markersOffset</code></td><td><code>PositionedOffset</code></td><td>事件标记偏移量</td></tr><tr><td><code>canMarkersOverflow</code></td><td><code>bool</code></td><td>标记是否允许溢出日期单元格</td></tr><tr><td><code>outsideDaysVisible</code></td><td><code>bool</code></td><td>是否显示范围外的日期（默认true）</td></tr></tbody></table>
<h4 data-id="heading-11">HeaderStyle 子属性</h4>











































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>formatButtonVisible</code></td><td><code>bool</code></td><td>是否显示视图切换按钮（默认true）</td></tr><tr><td><code>formatButtonShowsNext</code></td><td><code>bool</code></td><td>切换按钮是否显示下一个格式（默认true）</td></tr><tr><td><code>formatButtonDecoration</code></td><td><code>BoxDecoration</code></td><td>视图切换按钮装饰</td></tr><tr><td><code>formatButtonTextStyle</code></td><td><code>TextStyle</code></td><td>视图切换按钮文本样式</td></tr><tr><td><code>leftChevronIcon</code></td><td><code>Widget</code></td><td>左箭头图标</td></tr><tr><td><code>rightChevronIcon</code></td><td><code>Widget</code></td><td>右箭头图标</td></tr><tr><td><code>titleTextStyle</code></td><td><code>TextStyle</code></td><td>标题（月份）文本样式</td></tr><tr><td><code>titleCentered</code></td><td><code>bool</code></td><td>标题是否居中（默认false）</td></tr><tr><td><code>titleFormatter</code></td><td><code>String Function(DateTime, dynamic)</code></td><td>标题文本格式化器</td></tr><tr><td><code>headerPadding</code></td><td><code>EdgeInsets</code></td><td>表头内边距</td></tr><tr><td><code>headerMargin</code></td><td><code>EdgeInsets</code></td><td>表头外边距</td></tr><tr><td><code>chevronPadding</code></td><td><code>EdgeInsets</code></td><td>箭头图标内边距</td></tr><tr><td><code>chevronVisible</code></td><td><code>bool</code></td><td>是否显示箭头图标（默认true）</td></tr></tbody></table>
<p>样式定制示例：</p>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  calendarStyle: CalendarStyle(
    <span class="hljs-comment">// 选中日期样式</span>
    selectedDecoration: BoxDecoration(
      color: Colors.blue,
      shape: BoxShape.circle,
    ),
    <span class="hljs-comment">// 今天日期样式</span>
    todayDecoration: BoxDecoration(
      color: Colors.grey[<span class="hljs-number">200</span>],
      shape: BoxShape.circle,
    ),
    <span class="hljs-comment">// 周末样式</span>
    weekendTextStyle: TextStyle(color: Colors.red),
    <span class="hljs-comment">// 事件标记样式</span>
    markersMaxCount: <span class="hljs-number">3</span>,  <span class="hljs-comment">// 最多显示3个标记</span>
    markerSize: <span class="hljs-number">6</span>,
  ),
  <span class="hljs-comment">// 表头样式</span>
  headerStyle: HeaderStyle(
    formatButtonVisible: <span class="hljs-keyword">false</span>,  <span class="hljs-comment">// 隐藏视图切换按钮</span>
    titleCentered: <span class="hljs-keyword">true</span>,
    headerPadding: EdgeInsets.symmetric(vertical: <span class="hljs-number">8</span>),
    titleTextStyle: TextStyle(fontSize: <span class="hljs-number">18</span>, fontWeight: FontWeight.bold),
  ),
)
</code></pre>
<h3 data-id="heading-12">3.6. 本地化属性</h3>






























<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>locale</code></td><td><code>String?</code></td><td>本地化语言代码（如'zh_CN'、'en_US'）</td></tr><tr><td><code>daysOfWeekLabels</code></td><td><code>List&lt;String&gt;</code></td><td>星期标签文本（默认按locale生成）</td></tr><tr><td><code>daysOfWeekLabelsExceptions</code></td><td><code>Map&lt;int, String&gt;</code></td><td>特定星期几的文本覆盖</td></tr><tr><td><code>weekNumberLabel</code></td><td><code>String</code></td><td>周数标签文本（默认'W'）</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:intl/intl.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:intl/date_symbol_data_local.dart'</span>;

<span class="hljs-comment">// 初始化本地化</span>
initializeDateFormatting().then((_) {
  setState(() {});
});

TableCalendar(
  <span class="hljs-comment">// ...其他参数</span>
  locale: <span class="hljs-string">'zh_CN'</span>,  <span class="hljs-comment">// 支持 'en_US', 'ja_JP' 等</span>
  daysOfWeekStyle: DaysOfWeekStyle(
    weekdayStyle: TextStyle(),
    weekendStyle: TextStyle(color: Colors.red),
  ),
)
</code></pre>
<h3 data-id="heading-13">3.7. 交互控制属性</h3>



































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>enabledDayPredicate</code></td><td><code>bool Function(DateTime)</code></td><td>判断日期是否可交互（默认全部可交互）</td></tr><tr><td><code>onHeaderTapped</code></td><td><code>void Function(DateTime)</code></td><td>表头点击回调</td></tr><tr><td><code>onHeaderLongPressed</code></td><td><code>void Function(DateTime)</code></td><td>表头长按回调</td></tr><tr><td><code>onDayLongPressed</code></td><td><code>void Function(DateTime, DateTime)</code></td><td>日期长按回调</td></tr><tr><td><code>dragStartBehavior</code></td><td><code>DragStartBehavior</code></td><td>拖拽起始行为（默认start）</td></tr></tbody></table>
<h3 data-id="heading-14">3.8. 高级自定义属性</h3>













































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>calendarBuilders</code></td><td><code>CalendarBuilders</code></td><td>自定义构建器集合（以下为常用子项）</td></tr><tr><td>- <code>dayBuilder</code></td><td><code>Widget Function(BuildContext, DateTime, DateTime, bool, bool, bool, bool, List)</code></td><td>自定义日期单元格</td></tr><tr><td>- <code>markerBuilder</code></td><td><code>Widget Function(BuildContext, DateTime, List)</code></td><td>自定义事件标记</td></tr><tr><td>- <code>headerTitleBuilder</code></td><td><code>Widget Function(BuildContext, DateTime)</code></td><td>自定义表头标题</td></tr><tr><td>- <code>weekNumberBuilder</code></td><td><code>Widget Function(BuildContext, int)</code></td><td>自定义周数显示</td></tr><tr><td><code>transitionDuration</code></td><td><code>Duration</code></td><td>视图切换动画时长（默认200ms）</td></tr><tr><td><code>pageAnimationEnabled</code></td><td><code>bool</code></td><td>是否启用页面切换动画（默认true）</td></tr></tbody></table>
<h2 data-id="heading-15">4. 性能优化</h2>
<ul>
<li>使用 <code>ValueNotifier</code> 管理事件数据，避免不必要重建</li>
<li>复杂标记使用缓存Widget</li>
<li>合理设置 <code>firstDay</code> 和 <code>lastDay</code> 范围</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> ValueNotifier&lt;<span class="hljs-built_in">List</span>&gt; _selectedEvents = ValueNotifier([]);

<span class="hljs-comment">// 监听选中日期变化更新事件</span>
<span class="hljs-keyword">void</span> _updateSelectedEvents() {
  _selectedEvents.value = _events[_selectedDay] ?? [];
}

<span class="hljs-comment">// 构建时使用ValueListenableBuilder</span>
ValueListenableBuilder&lt;<span class="hljs-built_in">List</span>&gt;(
  valueListenable: _selectedEvents,
  builder: (context, value, _) {
    <span class="hljs-keyword">return</span> <span class="hljs-comment">// 事件列表</span>
  },
)
</code></pre>
<h2 data-id="heading-16">5. 完整配置示例</h2>
<pre><code class="hljs language-dart" lang="dart">TableCalendar(
  firstDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2020</span>),
  lastDay: <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2030</span>),
  focusedDay: _focusedDay,
  selectedDayPredicate: (day) =&gt; isSameDay(_selectedDay, day),
  onDaySelected: (selectedDay, focusedDay) {
    <span class="hljs-keyword">if</span> (!isSameDay(_selectedDay, selectedDay)) {
      setState(() {
        _selectedDay = selectedDay;
        _focusedDay = focusedDay;
      });
    }
  },
  <span class="hljs-comment">// 视图配置</span>
  calendarFormat: _calendarFormat,
  onFormatChanged: (format) =&gt; setState(() =&gt; _calendarFormat = format),
  availableCalendarFormats: <span class="hljs-keyword">const</span> {
    CalendarFormat.month: <span class="hljs-string">'月'</span>,
    CalendarFormat.week: <span class="hljs-string">'周'</span>,
  },
  <span class="hljs-comment">// 范围选择</span>
  rangeStartDay: _rangeStart,
  rangeEndDay: _rangeEnd,
  rangeSelectionMode: _rangeSelectionMode,
  onRangeSelected: (start, end, focusedDay) =&gt; setState(() {
    _rangeStart = start;
    _rangeEnd = end;
    _rangeSelectionMode = RangeSelectionMode.toggledOn;
  }),
  <span class="hljs-comment">// 事件加载</span>
  eventLoader: (day) =&gt; _events[day] ?? [],
  <span class="hljs-comment">// 样式定制</span>
  calendarStyle: CalendarStyle(
    selectedDecoration: <span class="hljs-keyword">const</span> BoxDecoration(
      color: Colors.blue,
      shape: BoxShape.circle,
    ),
    todayDecoration: BoxDecoration(
      color: Colors.grey[<span class="hljs-number">200</span>],
      shape: BoxShape.circle,
    ),
    markersMaxCount: <span class="hljs-number">3</span>,
  ),
  headerStyle: <span class="hljs-keyword">const</span> HeaderStyle(
    titleCentered: <span class="hljs-keyword">true</span>,
    formatButtonVisible: <span class="hljs-keyword">false</span>,
  ),
  <span class="hljs-comment">// 本地化</span>
  locale: <span class="hljs-string">'zh_CN'</span>,
  <span class="hljs-comment">// 自定义构建器</span>
  calendarBuilders: CalendarBuilders(
    markerBuilder: (context, date, events) =&gt; events.isNotEmpty
        ? Container(
            width: <span class="hljs-number">12</span>,
            height: <span class="hljs-number">12</span>,
            decoration: <span class="hljs-keyword">const</span> BoxDecoration(
              color: Colors.red,
              shape: BoxShape.circle,
            ),
          )
        : <span class="hljs-keyword">null</span>,
  ),
)
</code></pre>
<h2 data-id="heading-17">6. 总结</h2>
<p><code>table_calendar</code> 提供了灵活的日历解决方案，核心关注：</p>
<ul>
<li>基础日期选择与范围选择的状态管理</li>
<li>事件标记与自定义样式的视觉定制</li>
<li>视图切换与本地化的用户体验优化</li>
<li>性能优化技巧（如状态隔离、合理设置范围）</li>
</ul>
<p>更复杂功能可参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Ftable_calendar" target="_blank" title="https://pub.dev/packages/table_calendar" ref="nofollow noopener noreferrer">官方文档</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faleksanderwozniak%2Ftable_calendar" target="_blank" title="https://github.com/aleksanderwozniak/table_calendar" ref="nofollow noopener noreferrer">Github仓库</a>实现。使用时需注意范围选择与单个选择的互斥性，以及本地化配置的初始化步骤。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信红包封面制作redbag-cover]]></title>    <link>https://juejin.cn/post/7581728606308073524</link>    <guid>https://juejin.cn/post/7581728606308073524</guid>    <pubDate>2025-12-10T00:56:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606308073524" data-draft-id="7581750252999868451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信红包封面制作redbag-cover"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T00:56:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信红包封面制作redbag-cover
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:56:07.000Z" title="Wed Dec 10 2025 00:56:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年春节，我注意到微信红包封面搜索量暴增，却鲜有便捷的生成工具。于是我决定做一个红包封面生成网站。
借助AI强大开发能力， 仅用一周时间。完成<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.redbagcover.com" target="_blank" title="https://www.redbagcover.com" ref="nofollow noopener noreferrer">www.redbagcover.com</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc6ff12f7de049e9b85749975b6604f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765932967&amp;x-signature=lDyKUN8%2FQ%2BplSiLqdGbI94HZloY%3D" alt="image.png" loading="lazy"/>
产品核心功能：一个<strong>允许用户通过简单提示词快速生成符合微信官方要求的红包封面的工具</strong>
欢迎大家体验！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路]]></title>    <link>https://juejin.cn/post/7581728606308089908</link>    <guid>https://juejin.cn/post/7581728606308089908</guid>    <pubDate>2025-12-10T00:56:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606308089908" data-draft-id="7581741663182962723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-10T00:56:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beordie"/> <meta itemprop="url" content="https://juejin.cn/user/2928754708190679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LeetCode 1. 两数之和 | 从暴力到哈希表的优化之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754708190679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beordie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T00:56:55.000Z" title="Wed Dec 10 2025 00:56:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为 LeetCode 的第一道入门题，「两数之和」虽然标注为<strong>简单</strong>难度，却是理解数组遍历与哈希表核心思想的经典案例。它不仅是算法新手的入门必修课，更能让我们体会到 <strong>空间换时间</strong> 的优化思维。今天从最基础的暴力解法开始，一步步拆解到时间复杂度 O (n) 的最优解法，带你彻底搞懂这道题的解题逻辑～</p>
<h2 data-id="heading-0">📖 题目重述</h2>
<p>给你一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请在数组中找出<strong>两个不同位置</strong>的整数，使它们的和恰好等于 <code>target</code>，最后返回这两个数的下标。这里有几个关键规则要注意：</p>
<ol>
<li>每个输入都<strong>只有一个正确答案</strong>；</li>
<li>数组中的同一个元素不能被重复使用；</li>
<li>返回的下标顺序没有要求。</li>
</ol>
<p>举个例子，输入数组 <code>[2,7,11,15]</code>、目标值 9，因为 2+7=9，所以返回下标 <code>[0,1]</code> 即可。</p>
<h2 data-id="heading-1">🚶 阶梯思路拆解</h2>
<h3 data-id="heading-2">第一步：暴力枚举所有可能 🥾</h3>
<p>要找两个数的和等于目标值，最直观的想法就是<strong>把数组中所有数两两配对，逐一检查和是否符合要求</strong>。这就是暴力解法的核心逻辑，也是最容易想到的思路。</p>
<h3 data-id="heading-3">💡 核心逻辑</h3>
<p>用两层嵌套的 for 循环遍历数组：</p>
<ul>
<li>外层循环固定一个数 <code>nums[i]</code>，遍历范围是数组的每一个元素；</li>
<li>内层循环遍历 <code>i</code> 之后的所有数 <code>nums[j]</code>（避免重复检查同一对数字）；</li>
<li>若 <code>nums[i] + nums[j] == target</code>，直接返回下标数组 <code>{i, j}</code>。</li>
</ul>
<h3 data-id="heading-4">✅ 代码实现（Java）</h3>
<pre><code class="hljs language-ini" lang="ini">class Solution {
    public int<span class="hljs-section">[]</span> twoSum(int<span class="hljs-section">[]</span> nums, int target) {
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        // 外层循环固定第一个数
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
            // 内层循环遍历第二个数，从i+1开始避免重复
            for (int <span class="hljs-attr">j</span> = i + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt; n; j++) {</span>
                if (nums<span class="hljs-section">[i]</span> + nums<span class="hljs-section">[j]</span> == target) {
                    return new int<span class="hljs-section">[]</span>{i, j}<span class="hljs-comment">;</span>
                }
            }
        }
        // 题目保证有解，此处仅为语法兜底
        return new int<span class="hljs-section">[0]</span><span class="hljs-comment">;</span>
    }
}

// 测试代码
public class Main {
    public static void main(String<span class="hljs-section">[]</span> args) {
        Solution <span class="hljs-attr">solution</span> = new Solution()<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums1</span> = {<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res1</span> = solution.twoSum(nums1, <span class="hljs-number">9</span>)<span class="hljs-comment">;</span>
        System.out.println(res1<span class="hljs-section">[0]</span> + "," + res1<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>

        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums2</span> = {<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res2</span> = solution.twoSum(nums2, <span class="hljs-number">6</span>)<span class="hljs-comment">;</span>
        System.out.println(res2<span class="hljs-section">[0]</span> + "," + res2<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出1,2</span>
    }
}
</code></pre>
<h3 data-id="heading-5">⚙️ 复杂度分析</h3>




















<table><thead><tr><th align="left">复杂度类型</th><th align="left">计算结果</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">时间复杂度</td><td align="left">O(n²)</td><td align="left">两层嵌套循环，最坏情况下需要遍历 n*(n-1)/2 次，n 为数组长度</td></tr><tr><td align="left">空间复杂度</td><td align="left">O(1)</td><td align="left">仅使用了几个临时变量，未开辟额外的数组或集合空间</td></tr></tbody></table>
<h3 data-id="heading-6">🚫 遇到的问题</h3>
<p>暴力解法的逻辑简单，但效率极低。当数组长度 <code>n</code> 达到 10⁴ 时，n² 就是 10⁸ 次运算，会触发 LeetCode 的超时判定；如果是百万级别的数组，这种方法更是完全不可行。问题的核心在于：<strong>内层循环的查找过程重复且耗时</strong>，我们需要找到一种更高效的查找方式。</p>
<h3 data-id="heading-7">第二步：用哈希表优化查找效率 🗺️</h3>
<p>既然暴力解法的痛点是 <strong>查找补数</strong> 的过程太慢，那我们可以用 哈希表（HashMap）来记录已经遍历过的数字和它的下标，把查找操作从 O (n) 降到 O (1)。这是算法优化中典型的 <strong>空间换时间</strong> 策略。</p>
<h3 data-id="heading-8">💡 核心逻辑</h3>
<ol>
<li>初始化一个 <code>HashMap</code>，键存储<strong>遍历过的数字</strong>，值存储该数字对应的<strong>数组下标</strong>；</li>
<li>遍历数组时，对当前数字 <code>nums[i]</code>，计算它的 <code>补数</code> <code>complement = target - nums[i]</code>；</li>
<li>检查补数是否存在于 HashMap 中：
<ul>
<li>若存在，说明之前已经遍历过这个补数，直接返回 <code>{map.get(complement), i}</code>；</li>
<li>若不存在，将当前数字和下标存入 HashMap，继续遍历下一个元素。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">📊 图文演示（以 nums=[2,7,11,15], target=9 为例）</h3>
<p>我们一步步拆解 HashMap 的变化和查找过程，直观感受优化后的逻辑（如图所示）：</p>
<ol>
<li>遍历 i=0，nums [i]=2，补数 = 9-2=7。此时 HashMap 为空，将 <code>2→0</code> 存入 Map：
<pre><code class="hljs language-ini" lang="ini">HashMap：{<span class="hljs-attr">2</span>=<span class="hljs-number">0</span>}
当前遍历：nums<span class="hljs-section">[0]</span>=2 → 补数7不存在 ❌
</code></pre>
</li>
<li>遍历 i=1，nums [i]=7，补数 = 9-7=2。检查 HashMap，发现 2 存在且对应下标 0：
<pre><code class="hljs language-ini" lang="ini">HashMap：{<span class="hljs-attr">2</span>=<span class="hljs-number">0</span>}
当前遍历：nums<span class="hljs-section">[1]</span>=7 → 补数2存在 ✅ → 返回{0,1}
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">✅ 代码实现（Java）</h3>
<pre><code class="hljs language-ini" lang="ini">import java.util.HashMap<span class="hljs-comment">;</span>
import java.util.Map<span class="hljs-comment">;</span>

class Solution {
    public int<span class="hljs-section">[]</span> twoSum(int<span class="hljs-section">[]</span> nums, int target) {
        // 初始化HashMap，键：数字，值：下标
        Map&lt;Integer, Integer&gt; <span class="hljs-attr">numMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
            int <span class="hljs-attr">complement</span> = target - nums[i]<span class="hljs-comment">;</span>
            // 检查补数是否在HashMap中
            if (numMap.containsKey(complement)) {
                return new int<span class="hljs-section">[]</span>{numMap.get(complement), i}<span class="hljs-comment">;</span>
            }
            // 若不存在，将当前数字和下标存入Map
            numMap.put(nums<span class="hljs-section">[i]</span>, i)<span class="hljs-comment">;</span>
        }
        // 题目保证有解，此处仅为语法兜底
        return new int<span class="hljs-section">[0]</span><span class="hljs-comment">;</span>
    }
}

// 测试代码
public class Main {
    public static void main(String<span class="hljs-section">[]</span> args) {
        Solution <span class="hljs-attr">solution</span> = new Solution()<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums1</span> = {<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">15</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res1</span> = solution.twoSum(nums1, <span class="hljs-number">9</span>)<span class="hljs-comment">;</span>
        System.out.println(res1<span class="hljs-section">[0]</span> + "," + res1<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>

        int<span class="hljs-section">[]</span> <span class="hljs-attr">nums2</span> = {<span class="hljs-number">3</span>,<span class="hljs-number">3</span>}<span class="hljs-comment">;</span>
        int<span class="hljs-section">[]</span> <span class="hljs-attr">res2</span> = solution.twoSum(nums2, <span class="hljs-number">6</span>)<span class="hljs-comment">;</span>
        System.out.println(res2<span class="hljs-section">[0]</span> + "," + res2<span class="hljs-section">[1]</span>)<span class="hljs-comment">; // 输出0,1</span>
    }
}
</code></pre>
<h3 data-id="heading-11">⚙️ 复杂度分析</h3>




















<table><thead><tr><th align="left">复杂度类型</th><th align="left">计算结果</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">时间复杂度</td><td align="left">O(n)</td><td align="left">仅需遍历一次数组，HashMap 的查找和插入操作均为 O (1)</td></tr><tr><td align="left">空间复杂度</td><td align="left">O(n)</td><td align="left">最坏情况下，需要将数组中 n 个元素全部存入 HashMap</td></tr></tbody></table>
<h3 data-id="heading-12">✨ 优化亮点</h3>
<p>这种方法通过 HashMap 将原本 O (n) 的查找过程优化为 O (1)，时间复杂度从 O (n²) 骤降到 O (n)，虽然牺牲了部分空间，但在实际开发中，时间效率的提升往往更重要。这也是「两数之和」这道题的<strong>最优解法</strong>。</p>
<h2 data-id="heading-13">📝 总结</h2>
<p>「两数之和」看似简单，却蕴含了算法优化的核心思维：<strong>用合适的数据结构解决性能瓶颈</strong>。我们从暴力枚举的基础思路出发，找到 <strong>重复查找</strong> 的性能问题，再通过<code>哈希表</code>实现高效查找，这个优化路径也是很多数组类算法题的通用解题模板。</p>
<h3 data-id="heading-14">同类题扩展建议</h3>
<p>掌握了这道题的哈希表思路后，可以继续练习这些进阶题目，巩固优化思维：</p>
<ol>
<li><strong>LeetCode 15. 三数之和</strong>：在两数之和的基础上增加一层循环，结合双指针优化去重；</li>
<li><strong>LeetCode 18. 四数之和</strong>：延续三数之和的思路，注意边界条件和去重逻辑；</li>
<li><strong>LeetCode 454. 四数相加 II</strong>：用两个 HashMap 分别存储两组数的和，进一步降低时间复杂度。</li>
</ol>
<p>算法学习不是一蹴而就的，从基础解法开始逐步优化，才能真正理解背后的逻辑。希望这篇文章能帮你吃透「两数之和」，也为后续的算法学习打下坚实的基础～</p>
<h3 data-id="heading-15">📢 关注不迷路，算法学习更高效！</h3>
<p>如果这篇拆解对你有帮助，别忘了<strong>关注我的微信公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEKY2kxsfVxLv6G10wS6rjg" target="_blank" title="https://mp.weixin.qq.com/s/EKY2kxsfVxLv6G10wS6rjg" ref="nofollow noopener noreferrer">【小镇冥想人】</a></strong> ～ 后续会持续更新 LeetCode 高频题的阶梯式解题思路，从暴力到最优解层层递进，每道题都搭配详细图文和代码注释，帮你轻松攻克算法难关。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[费曼学习法：为什么你应该通过写博客来掌握任何知识]]></title>    <link>https://juejin.cn/post/7581676787380355091</link>    <guid>https://juejin.cn/post/7581676787380355091</guid>    <pubDate>2025-12-09T23:27:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581676787380355091" data-draft-id="7581693431740383295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="费曼学习法：为什么你应该通过写博客来掌握任何知识"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-12-09T23:27:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            费曼学习法：为什么你应该通过写博客来掌握任何知识
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:27:51.000Z" title="Tue Dec 09 2025 23:27:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾花费数小时学习某个概念，却在几天后发现自己几乎忘得一干二净？或者你是否曾试图向他人解释你刚刚学到的知识，却发现自己的理解支离破碎？</p>
<p>理查德·费曼——诺贝尔物理学奖得主、杰出的教育家——提出了一种简单却极其强大的学习方法，它不仅能帮你真正理解知识，还能让你长期记住所学内容。而今天，我要向你推荐一个将费曼学习法效果最大化的实践方式：写博客。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc32f73056664b30a0435c21860b7f63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765927670&amp;x-signature=4ZdCRWTkbCUB9XjhndQH4zZkkP4%3D" alt="v2-44083e9702de380f873f664b40d3ccb7_1440w.jpg" loading="lazy"/></p>
<p>v2-44083e9702de380f873f664b40d3ccb7_1440w.jpg</p>
<h2 data-id="heading-0">什么是费曼学习法？</h2>
<p>费曼学习法的核心思想很简单：<strong>如果你不能简单地解释某件事，你就没有真正理解它。</strong></p>
<p>这个方法包含五个关键步骤：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a438bf373e794a4aaa62fff3b5a5ae3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765927670&amp;x-signature=BCGT%2BRGsLCeXYF2D5FSekQ2d1Jk%3D" alt="_20251210_071503.png" loading="lazy"/></p>
<p>_20251210_071503.png</p>
<ol>
<li><strong>确认目标</strong>：确定你想要理解的主题或概念</li>
<li><strong>开始学习</strong>：学习你确认的目标</li>
<li><strong>教授他人</strong>：假装你在向一个完全没有相关知识的人解释这个概念</li>
<li><strong>反思回顾</strong>：在解释过程中，识别你理解不足的地方</li>
<li><strong>简化吸收</strong>：用更简单的语言和类比重新组织你的解释</li>
</ol>
<h2 data-id="heading-1">🎯 为什么博客是实践费曼学习法的完美载体？</h2>
<h3 data-id="heading-2">1. 写作是思考的延伸</h3>
<p>当你开始将想法转化为文字时，你被迫组织思维、理清逻辑。博客写作要求你按照连贯的结构表达思想，这本身就是一种深度处理信息的过程。</p>
<h3 data-id="heading-3">2. 面向“假想的初学者”</h3>
<p>博客的天然属性是面向读者的，即使你的读者可能只是未来的自己。这种“为他人写作”的心态恰好符合费曼学习法的核心——用简单明了的语言解释复杂概念。</p>
<h3 data-id="heading-4">3. 发现知识缺口的放大镜</h3>
<p>在写作过程中，你会遇到“这里我其实不太确定”或“这两部分如何连接”的困境，这些正是你需要填补的知识缺口。与仅仅在脑中思考不同，文字将这些缺口具象化，让你无法忽视。</p>
<h3 data-id="heading-5">4. 建立可回顾的知识库</h3>
<p>你的博客文章成为个人学习档案，方便日后回顾和更新。这是传统学习方式无法提供的持续价值。</p>
<h2 data-id="heading-6">🚀 如何通过博客实践费曼学习法：四步实操指南</h2>
<h3 data-id="heading-7">第一步：选择主题，开始“学习型写作”</h3>
<p>不要等到完全掌握某个主题后再开始写作。相反，<strong>将写作作为学习过程的一部分</strong>。</p>
<p>例如，假设你想学习机器学习中的“梯度下降”算法：</p>
<ul>
<li>不要等到上完所有课程再写</li>
<li>在学习基本概念后，立即开始撰写博客：“梯度下降：一个初学者的理解尝试”</li>
<li>标题本身就承认了你仍在学习，减轻了完美主义压力</li>
</ul>
<h3 data-id="heading-8">第二步：像教孩子一样写作</h3>
<p>设定你的目标读者是完全的新手：</p>
<ul>
<li>避免专业术语，或至少每次使用时都加以解释</li>
<li>使用类比和比喻（如“梯度下降就像下山找最低点”）</li>
<li>加入简单的图表或示意图</li>
<li>想象你在向一个聪明的12岁孩子解释这个概念</li>
</ul>
<h3 data-id="heading-9">第三步：识别并填补知识缺口</h3>
<p>在写作中，你会自然遇到问题：</p>
<ul>
<li>“这部分我不太确定是否准确”</li>
<li>“这个公式为什么这样推导？”</li>
<li>“这个概念与之前学的那个有什么联系？”</li>
</ul>
<p><strong>不要跳过这些困难部分</strong>。标记它们，然后：</p>
<ol>
<li>回到原始资料深入研究</li>
<li>查找额外的解释资源</li>
<li>向他人请教</li>
<li>更新你的博客文章，包含新的理解</li>
</ol>
<h3 data-id="heading-10">第四步：精简与重构</h3>
<p>完成初稿后，进行费曼式的精简：</p>
<ul>
<li>能否用更少的词语表达？</li>
<li>有没有更简单的类比？</li>
<li>结构是否可以更清晰？ 请他人阅读并提供反馈，特别是那些不熟悉该领域的人。</li>
</ul>
<h2 data-id="heading-11">✨ 克服常见障碍</h2>
<h3 data-id="heading-12">“我不是专家，没资格写”</h3>
<p>记住：<strong>你不需要成为专家才能写作，写作能帮助你成为专家</strong>。你的学习过程本身就是价值——其他初学者正经历同样的困惑。</p>
<h3 data-id="heading-13">“我的理解可能有误”</h3>
<p>这正是重点！公开写作让你更有可能得到纠正。在博客中坦诚你的不确定性：“根据我目前的理解...”或“如果我错了请指正...”</p>
<h3 data-id="heading-14">“没时间同时学习和写作”</h3>
<p>将写作视为学习的一部分，而不是额外任务。每周花1-2小时整理一周所学，这实际上会节省你后期的复习时间。</p>
<h2 data-id="heading-15">开始你的第一个费曼式博客</h2>
<p>今天就可以开始：</p>
<ol>
<li>
<p><strong>选择一个小概念</strong>：选一个你最近学过但感觉不够牢固的概念</p>
</li>
<li>
<p><strong>设定时间限制</strong>：给自己25分钟写初稿</p>
</li>
<li>
<p><strong>使用简单结构</strong>：</p>
<ul>
<li>我想解释什么？</li>
<li>最简单的解释是什么？</li>
<li>最好的类比是什么？</li>
<li>我还有什么疑问？</li>
</ul>
</li>
<li>
<p><strong>发布它</strong>：即使不完美，也要发布。注明“初步理解，持续更新”</p>
</li>
</ol>
<h2 data-id="heading-16">长期回报：超越学习的额外收益</h2>
<p>实践“费曼学习法+博客”不仅加深理解，还带来：</p>
<ul>
<li><strong>个人品牌建设</strong>：展示你的学习能力和专业知识</li>
<li><strong>职业机会</strong>：很多招聘者会查看候选人的技术博客</li>
<li><strong>社区连接</strong>：吸引志同道合者，形成学习网络</li>
<li><strong>思维清晰度提升</strong>：写作训练逻辑思维和表达能力</li>
</ul>
<h2 data-id="heading-17">🤝最后的鼓励</h2>
<p>理查德·费曼曾说：<strong><code>第一原则是不要欺骗自己，而你自己是最容易欺骗的人。</code></strong> 博客写作正是对抗自我欺骗的利器——你无法在清晰的文字面前假装理解。</p>
<p>学习不是被动吸收信息，而是主动建构理解。而写作，尤其是面向他人的写作，是最强大的建构工具之一。</p>
<p>今天，就选择一个你“以为”自己理解的概念，尝试为完全的新手写一篇解释文章。你可能会惊讶地发现那些隐藏的理解缺口，更会惊喜于通过填补这些缺口获得的深刻理解。</p>
<p><strong>真正的理解不是当你能够重复信息时获得的，而是当你能够重塑并传递它时获得的。</strong> 开始写吧，让博客成为你深度学习的见证者和催化剂。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（1）什么是Netty？它的主要特点是什么？]]></title>    <link>https://juejin.cn/post/7581750252999475235</link>    <guid>https://juejin.cn/post/7581750252999475235</guid>    <pubDate>2025-12-09T23:08:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581750252999475235" data-draft-id="7581750252999458851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（1）什么是Netty？它的主要特点是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T23:08:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（1）什么是Netty？它的主要特点是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:08:06.000Z" title="Tue Dec 09 2025 23:08:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty是一个基于Java NIO的网络编程框架，它提供了简单而强大的API，用于快速开发高性能、可扩展的网络应用程序。以下是Netty的一些主要特点：</p>
<ol>
<li>
<p>异步和事件驱动：Netty使用事件驱动的方式处理网络请求和数据传输，通过异步的方式实现高效的处理和响应。</p>
</li>
<li>
<p>高性能和可扩展性：Netty的设计目标之一是提供高性能和可扩展性。它使用了高度优化的数据结构和算法，以及基于事件驱动的模型，使得它能够处理大量的并发连接。</p>
</li>
<li>
<p>灵活的网络协议支持：Netty支持多种网络协议，包括TCP、UDP、HTTP、WebSocket等，可以灵活地构建各种网络应用。</p>
</li>
</ol>
<p>下面是一个简单的示例代码，展示了如何使用Netty创建一个简单的Echo服务器：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">bootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            bootstrap.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO))
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">EchoServerHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> bootstrap.bind(PORT).sync();
            future.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }
}

<span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) msg;
        System.out.println(<span class="hljs-string">"Received message: "</span> + message);
        ctx.write(msg); <span class="hljs-comment">// 将接收到的消息写回给客户端</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelReadComplete</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        ctx.flush(); <span class="hljs-comment">// 将消息发送队列中的消息写入到SocketChannel中发送给对方</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        cause.printStackTrace();
        ctx.close(); <span class="hljs-comment">// 发生异常时关闭连接</span>
    }
}
</code></pre>
<p>在上面的示例中，我们创建了一个Echo服务器，它接收客户端发送的消息，并将其原样返回给客户端。使用Netty，我们可以通过简单的配置和处理器来实现这个功能。在服务器启动时，我们创建了两个EventLoopGroup，一个用于接收连接，一个用于处理连接的I/O操作。然后，我们配置了服务器的引导类(ServerBootstrap)，指定了服务器的通道类型(NioServerSocketChannel)，设置了日志处理器(LoggingHandler)和消息处理器(EchoServerHandler)。最后，我们绑定端口并启动服务器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（2）Netty的核心组件是什么？]]></title>    <link>https://juejin.cn/post/7581752787563249704</link>    <guid>https://juejin.cn/post/7581752787563249704</guid>    <pubDate>2025-12-09T23:09:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752787563249704" data-draft-id="7581752787563233320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（2）Netty的核心组件是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T23:09:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（2）Netty的核心组件是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:09:48.000Z" title="Tue Dec 09 2025 23:09:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的核心组件包括：</p>
<ol>
<li>
<p>Channel：表示一个网络连接或一个能够进行I/O操作的实体。它可以用于读取和写入数据，以及进行各种网络操作。在Netty中，Channel是消息传输的载体。</p>
</li>
<li>
<p>EventLoop：是一个处理I/O事件的线程，负责处理所有的I/O操作，如接收连接、读取数据、写入数据等。每个Channel都会关联一个EventLoop，用于处理该Channel的所有事件。</p>
</li>
<li>
<p>ChannelPipeline：是一个处理Channel中事件的处理器链。它包含了一系列的ChannelHandler，用于处理和转换数据。当有数据进入或者出去时，会经过ChannelPipeline中的各个ChannelHandler进行处理。</p>
</li>
<li>
<p>ChannelHandler：是一个用于处理I/O事件和数据的组件。它可以接收事件和数据，对其进行处理，并将结果传递给下一个ChannelHandler。</p>
</li>
</ol>
<p>下面是一个示例代码，展示了如何使用Netty的核心组件：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">bootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            bootstrap.group(group)
                    .channel(NioSocketChannel.class)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO))
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">EchoClientHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> bootstrap.connect(HOST, PORT).sync();
            future.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}

<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, Netty!"</span>;
        ctx.writeAndFlush(message); <span class="hljs-comment">// 发送消息给服务器</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) msg;
        System.out.println(<span class="hljs-string">"Received message: "</span> + message);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        cause.printStackTrace();
        ctx.close(); <span class="hljs-comment">// 发生异常时关闭连接</span>
    }
}
</code></pre>
<p>在上面的示例中，我们创建了一个Echo客户端，它连接到服务器并发送消息。我们使用了与服务器类似的配置，创建了一个EventLoopGroup和一个Bootstrap。然后，我们配置了Bootstrap的通道类型(NioSocketChannel)，设置了日志处理器(LoggingHandler)和消息处理器(EchoClientHandler)。在channelActive方法中，我们发送了一条消息给服务器。在channelRead方法中，我们接收并打印从服务器返回的消息。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！]]></title>    <link>https://juejin.cn/post/7581741663182749731</link>    <guid>https://juejin.cn/post/7581741663182749731</guid>    <pubDate>2025-12-09T23:15:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581741663182749731" data-draft-id="7581406561684963374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！"/> <meta itemprop="keywords" content="人工智能,前端,Trae"/> <meta itemprop="datePublished" content="2025-12-09T23:15:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:15:05.000Z" title="Tue Dec 09 2025 23:15:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>一到年末，撰写年终总结总是绕不开一项费时又费力的任务——绘制图表。作为量化工作成果、直观呈现业务进展的重要方式，图表既要清晰传达信息，又需在视觉上吸引眼球。以往笔者常借助阿里 AntV 团队推出的 <code>mcp-server-chart</code>，通过对话式交互快速生成基础图表，虽然方便，但其样式较为简单，难以在汇报中脱颖而出（关于<code>mcp-server-chart</code>的使用大家可以参考笔者的文章<a href="https://juejin.cn/post/7504142780526723081" target="_blank" title="https://juejin.cn/post/7504142780526723081">推荐一款宝藏MCP Server—mcp-server-chart, 从此再也不发愁绘制图表啦！</a>）。</p>
<p>正为此发愁时笔者偶然发现了 AntV 新推出的信息图可视化引擎——<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2F" target="_blank" title="https://infographic.antv.vision/" ref="nofollow noopener noreferrer">AntV Infographic</a></strong>。它同样出自 AntV 团队，能够通过简洁的配置生成设计感十足、重点突出的信息图表，正好切中了笔者在图表展示上的痛点。</p>
<p>这么好的工具，自然不能独享，本篇分享笔者就把这个工具库分享给大家， 同时作为长期关注智能体开发的博主，笔者更进一步结合 <code>AntV Infographic</code> 与 <code>vibe coding</code> 快速搭建了一个轻量级图表生成智能体。本文将分享整个实现思路与过程，手把手带你用 <strong>AntV + Trae</strong>，在五分钟内构建属于自己的“智能图表生成器”，让大家今年的年终报告，用图表说话，靠颜值出彩！(希望大家可以到<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantvis%2Finfographic" target="_blank" title="https://github.com/antvis/infographic" ref="nofollow noopener noreferrer">github</a>上给Infographic 点 star 打 call，支持antv团队开发出更多实用美丽的可视化图表功能~)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31429ac9e1174724ab3322a4ac4e3141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=fYfCwSi4bmqISpMb%2FgnZYqqONpY%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、AntV Infographic简介</h2>
<h3 data-id="heading-2">1.1 什么是信息图（Infographic）？</h3>
<p>在深入了解 AntV Infographic 之前，首先需要明确一个核心概念：<strong>信息图（Infographic）</strong> 。</p>
<p>传统图表（如折线图、柱状图）的核心目标是精确、标准化地呈现数据。而信息图则更进一步，它融合了<strong>数据可视化</strong>与<strong>视觉设计</strong>，旨在将复杂的数据、信息和知识转化为直观的、富有美感的图形语言。它通过视觉元素来“压缩”信息，突出重点、叙述故事、传达洞察，最终目标是让受众“看得懂、记得住”。</p>
<p>笔者这里通过AntV官网的例子来让大家直观了解信息图，以下是一段关于阿里巴巴技术职级的文字描述：</p>
<pre><code class="hljs language-text" lang="text">在阿里巴巴，技术人的职级从 P5 到 P10，每一级都对应着不同的职责与能力要求。  
P5 是初入职场的执行者，主要负责完成具体任务，在指导下学习和成长；  
P6 是独立贡献者，能够自主解决问题并交付模块级的工作成果；P7 开始承担更复杂的系统设计与项目推进，成为团队中的技术骨干；  
P8 则需要具备架构能力，主导大型项目的实施，并在领域内形成影响力；  
P9 是技术专家或管理者，负责跨团队的战略规划与资源整合，推动业务创新；  
而 P10 作为行业领军人物，不仅要在公司内部引领技术方向，还要在行业内树立标杆，为组织带来深远的技术和商业价值。
</code></pre>
<p>如果将其转化为信息图，效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f96c7b8f10814a618c8793ffa33b8d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=D1GJ5E2uMxmKPxZ0Gefxwj%2BKmmk%3D" alt="1.png" loading="lazy"/></p>
<p>对比可见信息图通过层次化的视觉设计，极大地提升了信息的传达效率与视觉吸引力。</p>
<h3 data-id="heading-3">1.2 AntV Infographic 是什么？</h3>
<p><strong>AntV Infographic</strong> 正是为了解决“如何高效创建精美信息图”而生的新一代前端可视化引擎。它不是一个简单的图表库，将复杂数据转化为优雅、可交互信息图的完整解决方案。该框架的核心思想是：用户只需要通过简洁的声明式JSON配置方式描述数据与想要的视觉呈现，引擎便会自动将其渲染为高质量的信息图，无需你手动计算像素或绘制图形。</p>
<h3 data-id="heading-4">1.3 如何用 Infographic 构建信息图？</h3>
<p>InfoGraphic的使用非常简单，用户只需要按规定传入配置项，定义结构、设计、数据与主题，InfoGraphic即可自动根据用户的配置绘制出精美的信息图。可以说Infographic的整个过程围绕三个核心配置项展开：</p>
<ul>
<li>
<p><strong>设计 (<code>design</code>)</strong> ：定义信息图的视觉样式，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Fdesign" target="_blank" title="https://infographic.antv.vision/learn/design" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/desig…</a> 了解更多。</p>
<ul>
<li><code>structure</code>：布局与组织方式（如列表、网格）。</li>
<li><code>title</code>：标题的样式设计。</li>
<li><code>item</code>：每个数据单元的视觉样式（如卡片、箭头图）。</li>
</ul>
</li>
<li>
<p><strong>数据 (<code>data</code>)</strong> ：填入要展示的具体内容，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Fdata" target="_blank" title="https://infographic.antv.vision/learn/data" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/data</a> 了解更多。</p>
<ul>
<li>支持一维列表数据（如上图示例）和层级数据。</li>
<li>每个数据项可包含标签、描述、时间、图标等字段。</li>
</ul>
</li>
<li>
<p><strong>主题 (<code>theme</code>)</strong> ：控制全局视觉风格，参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn%2Ftheme" target="_blank" title="https://infographic.antv.vision/learn/theme" ref="nofollow noopener noreferrer">infographic.antv.vision/learn/theme</a> 了解更多。</p>
<ul>
<li>配置主色、色板、背景等。</li>
<li>自定义文本、图形等元素的样式。</li>
<li>应用手绘风等风格化效果。</li>
</ul>
</li>
</ul>
<p>下面是一个完整的代码示例，它创建了一个包含三个步骤的“计划进展”图:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Infographic</span>,
  registerResourceLoader,
  loadSVGResource,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@antv/infographic'</span>;

<span class="hljs-title function_">registerResourceLoader</span>(<span class="hljs-keyword">async</span> (config) =&gt; {
  <span class="hljs-keyword">const</span> {data} = config;
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.iconify.design/<span class="hljs-subst">${data}</span>.svg`</span>);
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">text</span>();
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">loadSVGResource</span>(text);
});

<span class="hljs-keyword">const</span> infographic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#container'</span>,
  <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
  <span class="hljs-attr">editable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">padding</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">design</span>: {
    <span class="hljs-attr">title</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'default'</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,
    },
    <span class="hljs-attr">structure</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'list-row'</span>,
      <span class="hljs-attr">gap</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">zigzag</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">item</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'horizontal-icon-arrow'</span>,
    },
  },
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
  <span class="hljs-attr">themeConfig</span>: {
    <span class="hljs-attr">palette</span>: [<span class="hljs-string">'#61DDAA'</span>, <span class="hljs-string">'#F6BD16'</span>, <span class="hljs-string">'#F08BB4'</span>],
    <span class="hljs-attr">base</span>: {
      <span class="hljs-attr">text</span>: {
        <span class="hljs-string">'font-family'</span>: <span class="hljs-string">'851tegakizatsu'</span>,
      },
    },
    <span class="hljs-attr">stylize</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'rough'</span>,
    },
  },
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'计划进展'</span>,
    <span class="hljs-attr">items</span>: [
      {
        <span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 1'</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">'开始'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'Last Day'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/rocket-launch'</span>,
      },
      {
        <span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 2'</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">'进行中'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'Today'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/progress-clock'</span>,
      },
      {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 3'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'完成'</span>, <span class="hljs-attr">time</span>: <span class="hljs-string">'Tomorrow'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'mdi/trophy'</span>},
    ],
  },
});

infographic.<span class="hljs-title function_">render</span>();
</code></pre>
<p><strong>代码要点解析:</strong></p>
<ul>
<li><strong>资源加载器</strong>：通过 <code>registerResourceLoader</code> 从 Iconify 按需拉取 SVG。</li>
<li><strong>编辑器</strong>：设置 <code>editable: true</code> 启用交互式编辑功能。</li>
<li><strong>设计</strong>：<code>design</code> 字段自定义标题、结构与数据项类型及参数。</li>
<li><strong>主题</strong>：切换暗色主题并用 <code>themeConfig</code> 配置色板、字体、风格化。</li>
<li><strong>数据</strong>：传入标题与数据项（标签、描述、时间、图标）。</li>
</ul>
<p>最终绘制的图片效果如下：</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cd1bd3f21ab4c52b79592ec625d0de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=xHoH%2FrCbJaMrV1JZPvQaPEu29jQ%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-5">1.4 Infographic模板基本介绍</h3>
<p>对于常见的图表类型，每次都从头配置 <code>design</code> 显然效率不高。为此，Infographic 提供了<strong>模板（Template）</strong> 功能。用户可以将一套成熟的 <code>design</code> 配置保存为模板，以便复用。</p>
<ol>
<li>
<p><strong>注册与使用自定义模板:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {registerTemplate, <span class="hljs-title class_">Infographic</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@antv/infographic'</span>;

<span class="hljs-title function_">registerTemplate</span>(<span class="hljs-string">'simple-list'</span>, {
  <span class="hljs-attr">design</span>: {
    <span class="hljs-attr">structure</span>: <span class="hljs-string">'list-row'</span>,
    <span class="hljs-attr">item</span>: <span class="hljs-string">'simple'</span>,
  },
});

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
  <span class="hljs-comment">// 其他配置项...</span>
  <span class="hljs-attr">template</span>: <span class="hljs-string">'simple-list'</span>,
});
</code></pre>
</li>
<li>
<p><strong>使用官方模板:</strong></p>
</li>
</ol>
<p>除了自定义模板的方法外，鉴于现实生活中有许多设计好的信息展示图表组件，大家直接在上面替换数据呈现的效果往往比自定义的图表组件展示效果还要好。基于此AntV 团队已经为我们准备了上百种精心设计的模板，覆盖了时间轴、组织架构、产品路线图等多种场景。你可以在 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fexamples" target="_blank" title="https://infographic.antv.vision/examples" ref="nofollow noopener noreferrer">官方示例库</a></strong> 中浏览并找到心仪的样式，直接复制其模板名称并将数据修改为自己的数据即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7331d4b1fb3437ea537ac1fdc67758c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=pZQ%2BQtPx8Nkb958JLSUufDInK1o%3D" alt="3.png" loading="lazy"/></p>
<p>例如，以下代码使用官方 <code>list-row-simple-horizontal-arrow</code> 模板，在纯HTML环境中快速生成了一个步骤流程图：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Infographic Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/@antv/infographic@latest/dist/infographic.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> {<span class="hljs-title class_">Infographic</span>} = <span class="hljs-title class_">AntVInfographic</span>;
      <span class="hljs-keyword">const</span> infographic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Infographic</span>({
        <span class="hljs-attr">container</span>: <span class="hljs-string">'#container'</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-string">'100%'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'list-row-simple-horizontal-arrow'</span>,
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">items</span>: [
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 1'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'开始'</span>},
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 2'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'进行中'</span>},
            {<span class="hljs-attr">label</span>: <span class="hljs-string">'步骤 3'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'完成'</span>},
          ],
        },
      });
      infographic.<span class="hljs-title function_">render</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6ac9e0af746441d83865bdf8afc599b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=rww0w%2F8xU6nn4k0oVn0YQGWtwRI%3D" alt="4.png" loading="lazy"/></p>
<p>至此，大家已经掌握了 AntV Infographic 的核心用法。如果你想深入了解其所有功能，建议查阅 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Flearn" target="_blank" title="https://infographic.antv.vision/learn" ref="nofollow noopener noreferrer">官方教程</a></strong>。接下来，笔者将进入实战环节，看看如何将它与智能体（Agent）技术结合，打造一个真正“能说会画”的图表生成器。</p>
<h2 data-id="heading-6">二、基于AntV Infographic的图表生成智能体</h2>
<p>笔者在文章 <a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">LangChain1.0实战之多模态RAG系统（四）——Trae Solo搭建部署多模态RAG前端(附AI编程实践指南)</a>介绍了 <strong>Vibe Coding（氛围编程）</strong>  的理念，并展示了如何利用字节跳动的 <strong>Trae Solo</strong> 模式，仅凭自然语言描述就能快速开发出功能完整的前端应用。</p>
<p>这次笔者同样要借助 Vibe Coding 的力量，并遵循其<a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">最佳实践</a>，快速构建一个能够理解需求、自动生成精美信息图的智能体。</p>
<h3 data-id="heading-7">2.1 核心思路：让大模型“学会”图表配置</h3>
<p>要构建这个智能体，首先要理清它的运作逻辑。<code>AntV Infographic</code> 生成图表高度依赖配置项（<code>data</code>, <code>design</code>, <code>theme</code>），而官方又提供了丰富的模板库。那么一个很自然的想法是：<strong>能否让大模型充当“配置工程师”？</strong>  让大模型从用户输入的自然语言描述中，智能地抽取出关键数据、判断合适的图表类型（选择模板），并生成完整的 <code>Infographic</code> 配置代码。这个想法与 AntV 官方的 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 网站不谋而合。</p>
<p>为了让大模型掌握这项技能笔者需要给它一份“说明书”。最直接的方式就是借鉴官方 AI 功能的提示词（Prompt）。通过浏览器的开发者工具（Network 面板）笔者捕获到 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 网站与大模型交互时使用的提示词模板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8914f3ef01754d01a3e2adafe1fcd722~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=RBIvmVZIU%2FbRda9uUxgvj7xd7Ws%3D" alt="5.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28720350e3284ebfa8f1da006c5f4723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=UTyYsDJO%2FBKGh%2BU1TmedTIyZGaM%3D" alt="6.png" loading="lazy"/></p>
<p>获取到的提示词笔者将其保存在<code>提示词.txt</code>文件中。限于篇幅原因，提示词就不在这里展示啦，感兴趣的小伙伴大家可以关注笔者同名微信公众号：<strong>大模型真好玩</strong>， 并私信 <strong>Infographic智能体</strong> 获得全部源码。</p>
<h3 data-id="heading-8">2.2 编写结构化代码开发提示词</h3>
<p>有了核心思路和提示词基础，接下来就轮到 <strong>Vibe Coding</strong> 上场了。遵循最佳实践的第一步，笔者需要为 <strong>Trae Solo</strong> 撰写一份结构清晰、要素完整的提示词。</p>
<ol>
<li><strong>角色定位：</strong> 明确赋予 Trae Solo 一个专业身份和能力范围</li>
</ol>
<pre><code class="hljs language-text" lang="text">你是一个智能体应用开发人员，熟练掌握使用langchain1.0 python语言开发一个智能体
</code></pre>
<ol start="2">
<li><strong>清晰需求：</strong> 详细描述业务场景与功能点</li>
</ol>
<pre><code class="hljs language-text" lang="text">该智能体可以通过根据用户输入的数据，采用提示词.txt文件中的提示词，生成一个.html文件。
该智能体使用deepseek接口作为大模型服务，api key在.env文件配置中，该智能体会根据用户输入搭配我提示词.txt中的内容，生成相关配置。同时参考example.html中的代码，将其中的infographic配置项替换成你生成的配置项
</code></pre>
<ol start="3">
<li><strong>明确的任务:</strong> 将需求转化为具体的开发指令</li>
</ol>
<pre><code class="hljs language-text" lang="text">请使用Python代码和Langchain1.0版本生成我的需求
</code></pre>
<ol start="4">
<li><strong>代码约束规范:</strong> 因为这里的代码比较简单，属于玩具代码也不是完整项目，这里就不写啦，但大家要系统开发项目还是应该加上。</li>
</ol>
<h3 data-id="heading-9">2.3 DeepSeek提示优化</h3>
<p>原始提示词已经具备了所有要素，但其表述偏向口语化，逻辑连贯性有待加强。现在笔者执行第二步：使用另一个大模型（这里选用 DeepSeek）对提示词进行优化，使其更符合大模型的“阅读习惯”。</p>
<p><strong>原始提示词:</strong></p>
<pre><code class="hljs language-text" lang="text">你是一个智能体应用开发人员，熟练掌握使用langchain1.0 python语言开发一个智能体。该智能体可以通过根据用户输入的数据，采用提示词.txt文件中的提示词，生成一个.html文件。
该智能体使用deepseek接口作为大模型服务，api key在.env文件配置中，该智能体会根据用户输入搭配我提示词.txt中的内容，生成相关配置。同时参考example.html中的代码，将其中的infographic配置项替换成你生成的配置项。
请使用Python代码和Langchain1.0版本生成我的需求
</code></pre>
<p><strong>DeepSeek优化后的结果:</strong></p>
<pre><code class="hljs language-text" lang="text">项目概述：
开发一个基于LangChain的智能体应用，它能够：1. 读取用户输入的文本数据 2. 结合提示词.txt文件中的提示词模板 3. 调用DeepSeek API生成配置项 4. 读取example.html中的代码，使用新生成的配置项替换掉example.html中infographic的配置项，并写入新的名为example-result.html的文件中。
功能详细需求：
输入处理：智能体接收用户输入的文本数据作为内容素材
读取提示词.txt文件作为系统提示词
配置管理：
API密钥从.env文件中读取，变量名建议为DEEPSEEK_API_KEY
支持配置DeepSeek模型参数（如temperature, max_tokens等）
核心功能：
1. 将用户输入与提示词模板智能结合
2. 调用DeepSeek API生成正确的配置
3. 确保替换后的HTML文件可直接在浏览器中打开并正确显示
文件操作：
读取：提示词.txt（提示词模板）
写入：example-result.html（最终生成的HTML文件）
配置：.env（API密钥配置）
所有文件均为utf-8编码格式
智能体设计：
1. 使用LangChain的Agent框架
2. 包含错误处理机制（API调用失败、文件读取错误等）
提供清晰的执行状态反馈
</code></pre>
<p>优化后的提示词层级分明、指令明确，消除了冗余和歧义。此时将其提交给 <strong>Trae Solo</strong>，能够确保指令被最高效、最准确地执行。</p>
<h3 data-id="heading-10">2.4 Trae Solo 自动开发</h3>
<p>将优化后的提示词提交给 <strong>Trae Solo</strong>，它便开始自动进行代码开发。整个过程流畅，<strong>Trae Solo</strong> 依次完成了环境设置、文件读取、API 调用、模板替换等核心模块的编写。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b085f6f37e28408987f5f4581ad62dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=iZvbp7SIV17YYIGfc%2BK6vDwVC0g%3D" alt="8.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feffbf2b7edc4f1c85439b487ac8e6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=PzDLce5D5ciNRcjAODVWN7Kkwfs%3D" alt="9.png" loading="lazy"/></p>
<p>笔者审查一下生成的 <code>infographic_agent.py</code> 核心代码逻辑。虽然 Trae Solo 本次<strong>并未严格使用 LangChain 框架</strong>（这反映了当前 AI 编程工具在精准遵循框架指令上仍有提升空间），但它生成的代码逻辑清晰、功能完整：</p>
<ol>
<li><strong>加载环境</strong>：读取 <code>.env</code> 中的 API Key。</li>
<li><strong>读取知识</strong>：加载 <code>提示词.txt</code> 中的模板。</li>
<li><strong>获取输入</strong>：接收用户描述文本。</li>
<li><strong>调用大模型</strong>：拼接提示词和用户输入，请求 DeepSeek API 生成配置。</li>
<li><strong>替换模板</strong>：读取 <code>example.html</code>，将其中预设的配置替换为新生成的配置。</li>
<li><strong>输出结果</strong>：保存为新的 <code>example-result.html</code> 文件。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ... (代码导入和环境加载部分)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># 1. 加载环境变量</span>
    load_dotenv()
    api_key = os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>)
    <span class="hljs-comment"># ... (校验API Key)</span>

    <span class="hljs-comment"># 2. 读取提示词模板</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"提示词.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        prompt_template = f.read()
    
    <span class="hljs-comment"># 3. 获取用户输入</span>
    user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入文本数据作为内容素材: "</span>)
    
    <span class="hljs-comment"># 4. 调用DeepSeek API生成配置</span>
    headers = {<span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{api_key}</span>"</span>, <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>}
    payload = {
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-chat"</span>,
        <span class="hljs-string">"messages"</span>: [
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: prompt_template},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_input}
        ],
        <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>,
        <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">2048</span>,
        <span class="hljs-string">"response_format"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"json_object"</span>} <span class="hljs-comment"># 关键：要求返回JSON</span>
    }
    response = requests.post(<span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>, ...)
    config = response.json() <span class="hljs-comment"># 解析大模型返回的配置</span>
    
    <span class="hljs-comment"># 5. 读取并替换HTML模板</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"example.html"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        html_content = f.read()
    <span class="hljs-comment"># ... (使用生成的config替换html中的Infographic配置项)</span>
    
    <span class="hljs-comment"># 6. 写入新文件</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"example-result.html"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        f.write(updated_html)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ 操作完成！"</span>)
<span class="hljs-comment"># ... (主函数调用)</span>
</code></pre>
<h3 data-id="heading-11">2.5 测试与效果展示</h3>
<p><strong>测试流程</strong>：</p>
<p>运行 <code>python infographic_agent.py</code>，并输入一段业务描述：</p>
<pre><code class="hljs language-text" lang="text">2020年聚焦亚太市场，营收占比60%。
2021年拓展欧洲市场，占比提升至25%。
2022年进军北美，三大市场形成均衡格局，分别为40%、30%、25%。2023年新兴市场突破，拉美和中东合计贡献15%，全球化布局初步完成。
</code></pre>
<p>程序运行后，成功生成了 <code>example-result.html</code>。在浏览器中打开得到了一个可视化全球市场拓展历程的信息图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c615501220549c2ad4762a4edad43dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=KxWNKXyFCjFYDl%2BVDVN3b4YKOXE%3D" alt="10.png" loading="lazy"/></p>
<p><strong>效果分析</strong>：</p>
<p>智能体成功理解了时间序列数据，并选择了一个合适的时间线模板进行展示。它将各年份的市场分布数据提取并结构化，生成了一份基本可用的信息图。当然，与官方 <a href="https://link.juejin.cn?target=https%3A%2F%2Finfographic.antv.vision%2Fai" target="_blank" title="https://infographic.antv.vision/ai" ref="nofollow noopener noreferrer">AI Infographic</a> 的产出相比，在细节优化、图表精准度和视觉丰富度上还有差距，这可能与提示词的完整性、模型参数调优等因素有关，值得进一步探索和优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39afa3cd4df049acab502a09ada38bbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765926905&amp;x-signature=URwSgbbf5jYD1kw8b76yR7TiZOI%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-12">三、总结</h2>
<p>本文分享了利用AntV Infographic可视化引擎，通过声明式配置快速生成精美信息图。同时结合Trae Solo与Vibe Coding方法，构建智能体实现自然语言描述自动转换为图表代码。五分钟即可搭建智能图表生成器。想让智能体真正融入日常生活，不必从一开始就追求宏大构想。<strong>从解决一个具体问题的小工具起步</strong>，往往就是最好的开始。当简洁灵巧的小工具遇上大模型的能力，常常能碰撞出令人惊喜的火花！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画]]></title>    <link>https://juejin.cn/post/7581689310643814442</link>    <guid>https://juejin.cn/post/7581689310643814442</guid>    <pubDate>2025-12-09T23:20:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310643814442" data-draft-id="7581676787380338707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-12-09T23:20:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue Router 进阶指南：打造丝滑的滚动控制与惊艳的路由动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:20:56.000Z" title="Tue Dec 09 2025 23:20:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代单页应用（SPA）开发中，页面切换的流畅体验已成为衡量应用品质的重要标准。用户期望获得媲美原生应用的顺滑感受，而不仅仅是简单的页面跳转。Vue Router 作为 Vue.js 生态中的核心路由解决方案，提供了强大的滚动行为控制和路由过渡动画能力，让我们能够打造出令人印象深刻的用户体验。</p>
<h2 data-id="heading-0">一、掌握滚动行为：让页面“记住”它的位置</h2>
<h3 data-id="heading-1">1.1 什么是滚动行为？</h3>
<p>滚动行为指的是用户在路由切换时，页面滚动位置的智能管理。想象一下这样的场景：您在一个长列表页面滚动到中间位置，点击某个项目进入详情页，然后点击浏览器返回按钮——您是否希望直接回到刚才的列表位置？这正是滚动行为要解决的问题。</p>
<h3 data-id="heading-2">1.2 Vue Router 的滚动行为配置</h3>
<p>Vue Router 提供了 <code>scrollBehavior</code> 选项，让我们可以定义路由切换时的滚动行为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  <span class="hljs-attr">routes</span>: [...],
  <span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
    <span class="hljs-comment">// 返回滚动位置信息</span>
    <span class="hljs-keyword">if</span> (savedPosition) {
      <span class="hljs-comment">// 有保存的位置时（如浏览器前进/后退）</span>
      <span class="hljs-keyword">return</span> savedPosition
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (to.<span class="hljs-property">hash</span>) {
      <span class="hljs-comment">// 存在哈希锚点时</span>
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">el</span>: to.<span class="hljs-property">hash</span>,
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> <span class="hljs-comment">// 平滑滚动</span>
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 默认滚动到顶部</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> }
    }
  }
})
</code></pre>
<h3 data-id="heading-3">1.3 高级滚动控制技巧</h3>
<p><strong>延迟滚动与异步组件结合</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 等待页面渲染完成后再滚动</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (savedPosition) {
        <span class="hljs-title function_">resolve</span>(savedPosition)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (to.<span class="hljs-property">hash</span>) {
        <span class="hljs-title function_">resolve</span>({
          <span class="hljs-attr">el</span>: to.<span class="hljs-property">hash</span>,
          <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
          <span class="hljs-comment">// 添加偏移量，避免被固定导航栏遮挡</span>
          <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>
        })
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> })
      }
    }, <span class="hljs-number">300</span>) <span class="hljs-comment">// 等待300ms，确保动态内容已加载</span>
  })
}
</code></pre>
<p><strong>页面特定滚动策略</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 为特定路由禁用自动滚动</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">noScroll</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
  
  <span class="hljs-comment">// 在特定路由中保持滚动位置</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">keepScroll</span> &amp;&amp; to.<span class="hljs-property">meta</span>.<span class="hljs-property">keepScroll</span>) {
    <span class="hljs-keyword">return</span> {}
  }
  
  <span class="hljs-comment">// 默认行为</span>
  <span class="hljs-keyword">return</span> savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }
}
</code></pre>
<h2 data-id="heading-4">二、打造惊艳的路由切换动画</h2>
<h3 data-id="heading-5">2.1 Vue 过渡系统与路由的完美结合</h3>
<p>Vue 的 <code>&lt;Transition&gt;</code> 和 <code>&lt;TransitionGroup&gt;</code> 组件为路由动画提供了强大的基础。结合 Vue Router，我们可以创建各种炫酷的过渡效果。</p>
<p><strong>基础路由过渡实现</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component }"&gt;
    &lt;Transition name="fade" mode="out-in"&gt;
      &lt;component :is="Component" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;style&gt;
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-6">2.2 进阶动画：滑动过渡效果</h3>
<p><strong>水平滑动动画</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component, route }"&gt;
    &lt;Transition :name="transitionName"&gt;
      &lt;component :is="Component" :key="route.path" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, watch } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()
const transitionName = ref('slide-left')

watch(() =&gt; router.currentRoute.value, (to, from) =&gt; {
  // 根据路由深度判断滑动方向
  const toDepth = to.path.split('/').length
  const fromDepth = from.path.split('/').length
  transitionName.value = toDepth &lt; fromDepth ? 'slide-right' : 'slide-left'
})
&lt;/script&gt;

&lt;style&gt;
.slide-left-enter-active,
.slide-left-leave-active,
.slide-right-enter-active,
.slide-right-leave-active {
  transition: all 0.3s ease;
  position: absolute;
  width: 100%;
}

.slide-left-enter-from {
  transform: translateX(100%);
  opacity: 0;
}

.slide-left-leave-to {
  transform: translateX(-100%);
  opacity: 0;
}

.slide-right-enter-from {
  transform: translateX(-100%);
  opacity: 0;
}

.slide-right-leave-to {
  transform: translateX(100%);
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-7">2.3 基于路由元信息的动态动画</h3>
<p><strong>为不同路由配置不同动画</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 路由配置</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Dashboard</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">transition</span>: <span class="hljs-string">'zoom'</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/settings'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Settings</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">transition</span>: <span class="hljs-string">'fade'</span> }
  }
]
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;RouterView v-slot="{ Component, route }"&gt;
    &lt;Transition 
      :name="route.meta.transition || 'fade'"
      mode="out-in"
    &gt;
      &lt;component :is="Component" :key="route.path" /&gt;
    &lt;/Transition&gt;
  &lt;/RouterView&gt;
&lt;/template&gt;

&lt;style&gt;
.zoom-enter-active,
.zoom-leave-active {
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

.zoom-enter-from {
  transform: scale(0.8);
  opacity: 0;
}

.zoom-leave-to {
  transform: scale(1.2);
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-8">三、滚动行为与动画的协同优化</h2>
<h3 data-id="heading-9">3.1 动画期间的滚动管理</h3>
<p>在路由过渡动画期间，合理的滚动控制可以避免视觉混乱：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
  <span class="hljs-comment">// 如果启用了路由动画，延迟滚动</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">withAnimation</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-comment">// 等待动画完成</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> })
      }, <span class="hljs-number">500</span>) <span class="hljs-comment">// 与动画时长保持一致</span>
    })
  }
  <span class="hljs-keyword">return</span> savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }
}
</code></pre>
<h3 data-id="heading-10">3.2 性能优化建议</h3>
<ol>
<li><strong>硬件加速</strong>：为动画元素添加 <code>transform: translateZ(0)</code> 或 <code>will-change: transform</code> 启用GPU加速</li>
<li><strong>动画简化</strong>：避免同时为过多属性添加动画，优先使用 <code>transform</code> 和 <code>opacity</code></li>
<li><strong>节流处理</strong>：在快速连续导航时，取消未完成的动画</li>
</ol>
<h2 data-id="heading-11">四、实战：完整的用户体验优化方案</h2>
<p>下面是一个综合应用滚动行为和路由动画的完整示例：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app-container"&gt;
    &lt;AppHeader /&gt;
    &lt;main class="main-content"&gt;
      &lt;RouterView v-slot="{ Component, route }"&gt;
        &lt;Transition
          :name="getTransitionName(route, $route)"
          @before-enter="onBeforeEnter"
          @after-enter="onAfterEnter"
          mode="out-in"
        &gt;
          &lt;KeepAlive :include="cachedRoutes"&gt;
            &lt;component
              :is="Component"
              :key="route.fullPath"
              class="page-content"
            /&gt;
          &lt;/KeepAlive&gt;
        &lt;/Transition&gt;
      &lt;/RouterView&gt;
    &lt;/main&gt;
    &lt;AppFooter /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'
import { useRouter } from 'vue-router'

const router = useRouter()
const previousRoute = ref(null)

// 动态计算过渡名称
const getTransitionName = (to, from) =&gt; {
  if (!from.name) return 'fade'
  
  const toDepth = to.meta.depth || 0
  const fromDepth = from.meta.depth || 0
  
  if (toDepth &lt; fromDepth) return 'slide-right'
  if (toDepth &gt; fromDepth) return 'slide-left'
  
  return to.meta.transition || 'fade'
}

// 动画生命周期钩子
const onBeforeEnter = () =&gt; {
  // 动画开始前的准备工作
  document.body.style.overflow = 'hidden'
}

const onAfterEnter = () =&gt; {
  // 动画结束后的清理工作
  document.body.style.overflow = ''
}

// 需要缓存的组件
const cachedRoutes = computed(() =&gt; {
  return router.getRoutes()
    .filter(route =&gt; route.meta.keepAlive)
    .map(route =&gt; route.name)
    .filter(Boolean)
})
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-12">结语：打造极致的用户体验</h2>
<p>通过精心设计的滚动行为和流畅的路由过渡动画，我们可以将普通的单页应用提升到新的高度。Vue Router 提供的这些功能不仅仅是技术实现，更是连接用户与内容的桥梁。记住，最好的用户体验往往是用户感受不到的——自然的滚动恢复、流畅的页面过渡，这些细节共同构成了应用的品质感。</p>
<p>从简单的淡入淡出到复杂的多层动画，从基本的滚动定位到智能的位置记忆，每一处优化都是对用户体验的深思熟虑。正如我们开始时提到的，现代用户期待的是丝滑流畅的交互体验。通过掌握 Vue Router 的滚动行为控制与自定义路由动画技术，我们不仅满足了这一期待，更创造了超越用户预期的愉悦体验。</p>
<p>在下一个 Vue 项目中，不妨尝试实现这些技巧，让您的应用在众多竞争者中脱颖而出，用细节打动每一位用户。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择]]></title>    <link>https://juejin.cn/post/7581691182003896330</link>    <guid>https://juejin.cn/post/7581691182003896330</guid>    <pubDate>2025-12-09T23:37:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581691182003896330" data-draft-id="7581888578507046939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-09T23:37:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次弄懂 C# 内联数组（Inline Array）：高性能数组的新选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T23:37:02.000Z" title="Tue Dec 09 2025 23:37:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>内联数组是 <code>C# 12</code> 和 <code>.NET 8</code> 中引入的一个高级特性，它允许开发者创建固定大小的、在栈上分配或内联在结构体中的数组。这个特性主要用于高性能场景，可以避免堆分配和垃圾回收的开销。</p>
<h4 data-id="heading-1">性能优势</h4>
<p>内联数组的主要优势在于性能：</p>
<ul>
<li>
<p>栈上分配：避免堆分配和垃圾回收</p>
</li>
<li>
<p>内存局部性：元素在内存中连续存储，提高缓存命中率</p>
</li>
<li>
<p>减少指针间接寻址：直接访问元素，不需要通过数组对象引用</p>
</li>
</ul>
<h4 data-id="heading-2">内联数组 vs 传统数组</h4>








































<table><thead><tr><th>特性</th><th>内联数组</th><th>传统数组</th></tr></thead><tbody><tr><td>内存位置</td><td>栈/包含结构体内存</td><td>托管堆</td></tr><tr><td>分配开销</td><td>无额外分配</td><td>需要堆分配</td></tr><tr><td>最大长度</td><td>受栈空间限制（通常≤1MB）</td><td>受GC限制（通常≤2GB）</td></tr><tr><td>适用场景</td><td>高性能计算/嵌入式开发</td><td>通用场景</td></tr><tr><td>灵活性</td><td>固定长度</td><td>动态长度</td></tr><tr><td>C#版本要求</td><td>≥ C# 12 (.NET 8+)</td><td>所有版本</td></tr></tbody></table>
<h3 data-id="heading-3">基本语法</h3>
<p>内联数组使用 <code>InlineArray</code> 特性和特定的模式来定义：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Runtime.CompilerServices;

[<span class="hljs-meta">InlineArray(Size)</span>]
<span class="hljs-keyword">struct</span> InlineArrayStruct
{
    <span class="hljs-keyword">private</span> T _element; <span class="hljs-comment">// 单一字段，表示数组的起点</span>
}
</code></pre>
<ul>
<li>
<p><code>Size</code>：一个编译时常量，表示数组的固定长度。</p>
</li>
<li>
<p><code>T</code>：数组元素的类型（可以是值类型或引用类型）。</p>
</li>
<li>
<p>单一字段：结构体中只能有一个字段，表示数组的起点，编译器会将其扩展为固定大小的连续内存。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">System.Runtime.CompilerServices.InlineArray(10)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> MyInlineArray
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0; <span class="hljs-comment">// 只需要定义一个字段，实际大小由特性指定</span>
}
</code></pre>
<h3 data-id="heading-4">创建和使用内联数组</h3>
<h4 data-id="heading-5">基本定义和使用</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;

<span class="hljs-comment">// 定义包含10个整数的内联数组</span>
[<span class="hljs-meta">InlineArray(10)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> IntArray10
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0;
    
    <span class="hljs-comment">// 可以添加方法或属性来增强功能</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">10</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">Sum</span>()</span>
    {
        <span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Length; i++)
        {
            sum += <span class="hljs-keyword">this</span>[i];
        }
        <span class="hljs-keyword">return</span> sum;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        IntArray10 array = <span class="hljs-keyword">new</span> IntArray10();
        
        <span class="hljs-comment">// 初始化数组</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; array.Length; i++)
        {
            array[i] = i * <span class="hljs-number">2</span>;
        }
        
        <span class="hljs-comment">// 访问元素</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; array.Length; i++)
        {
            Console.WriteLine(<span class="hljs-string">$"array[<span class="hljs-subst">{i}</span>] = <span class="hljs-subst">{array[i]}</span>"</span>);
        }
        
        Console.WriteLine(<span class="hljs-string">$"总和: <span class="hljs-subst">{array.Sum()}</span>"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">与 <code>Span&lt;T&gt;</code> 结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">struct</span> FloatBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element;
}

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> FloatBuffer();
buffer[<span class="hljs-number">0</span>] = <span class="hljs-number">1.5f</span>;
buffer[<span class="hljs-number">1</span>] = <span class="hljs-number">2.5f</span>;

Span&lt;<span class="hljs-built_in">float</span>&gt; span = buffer;
Console.WriteLine(span[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 输出: 1.5</span>
Console.WriteLine(span.Length); <span class="hljs-comment">// 输出: 5</span>
</code></pre>
<h4 data-id="heading-7">泛型内联数组</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> GenericArray&lt;T&gt;
{
    <span class="hljs-keyword">private</span> T _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">5</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">T initialValue</span>)</span>
    {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; Length; i++)
        {
            <span class="hljs-keyword">this</span>[i] = initialValue;
        }
    }
}

<span class="hljs-comment">// 使用示例</span>
GenericArray&lt;<span class="hljs-built_in">string</span>&gt; stringArray = <span class="hljs-keyword">new</span> GenericArray&lt;<span class="hljs-built_in">string</span>&gt;();
stringArray.Initialize(<span class="hljs-string">"default"</span>);
</code></pre>
<h4 data-id="heading-8">在性能敏感场景中使用</h4>
<p>内联数组适合需要极致性能的场景，例如处理向量或缓冲区。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(3)</span>]
<span class="hljs-keyword">struct</span> Vector3D
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element;
}

<span class="hljs-function">Vector3D <span class="hljs-title">AddVectors</span>(<span class="hljs-params">Vector3D a, Vector3D b</span>)</span>
{
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> Vector3D();
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)
    {
        result[i] = a[i] + b[i];
    }
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">var</span> v1 = <span class="hljs-keyword">new</span> Vector3D { [<span class="hljs-number">0</span>] = <span class="hljs-number">1.0f</span>, [<span class="hljs-number">1</span>] = <span class="hljs-number">2.0f</span>, [<span class="hljs-number">2</span>] = <span class="hljs-number">3.0f</span> };
<span class="hljs-keyword">var</span> v2 = <span class="hljs-keyword">new</span> Vector3D { [<span class="hljs-number">0</span>] = <span class="hljs-number">4.0f</span>, [<span class="hljs-number">1</span>] = <span class="hljs-number">5.0f</span>, [<span class="hljs-number">2</span>] = <span class="hljs-number">6.0f</span> };
<span class="hljs-keyword">var</span> sum = AddVectors(v1, v2);

Console.WriteLine(<span class="hljs-string">$"(<span class="hljs-subst">{sum[<span class="hljs-number">0</span>]}</span>, <span class="hljs-subst">{sum[<span class="hljs-number">1</span>]}</span>, <span class="hljs-subst">{sum[<span class="hljs-number">2</span>]}</span>"</span>); <span class="hljs-comment">// 输出: (5, 7, 9)</span>
</code></pre>
<ul>
<li>
<p><code>Vector3D</code> 模拟一个三维向量，内联数组确保内存连续。</p>
</li>
<li>
<p>适合游戏开发或科学计算。</p>
</li>
</ul>
<h4 data-id="heading-9">与本机代码交互</h4>
<p>内联数组的连续内存布局使其非常适合与本机代码（如 <code>C/C++</code> ）交互。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Runtime.InteropServices;

[<span class="hljs-meta">InlineArray(8)</span>]
<span class="hljs-keyword">struct</span> CharBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">char</span> _element;
}

[<span class="hljs-meta">DllImport(<span class="hljs-string">"someNativeLib.dll"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ProcessBuffer</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> CharBuffer buffer</span>)</span>;

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> CharBuffer();
buffer[<span class="hljs-number">0</span>] = <span class="hljs-string">'H'</span>;
buffer[<span class="hljs-number">1</span>] = <span class="hljs-string">'e'</span>;
buffer[<span class="hljs-number">2</span>] = <span class="hljs-string">'l'</span>;
buffer[<span class="hljs-number">3</span>] = <span class="hljs-string">'l'</span>;
buffer[<span class="hljs-number">4</span>] = <span class="hljs-string">'o'</span>;
ProcessBuffer(<span class="hljs-keyword">ref</span> buffer);
</code></pre>
<ul>
<li>
<p><code>CharBuffer</code> 的内存布局与 <code>C</code> 语言中的 <code>char[8]</code> 兼容。</p>
</li>
<li>
<p>通过 <code>ref</code> 传递，确保本机代码可以直接操作内存。</p>
</li>
</ul>
<h3 data-id="heading-10">高级用法</h3>
<h4 data-id="heading-11">与不安全代码结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(8)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">struct</span> DoubleArray
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">fixed</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">8</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span>* GetPointer()
    {
        <span class="hljs-keyword">fixed</span> (<span class="hljs-built_in">double</span>* ptr = &amp;<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>])
        {
            <span class="hljs-keyword">return</span> ptr;
        }
    }
}
</code></pre>
<h4 data-id="heading-12">模拟多维数组</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用一维内联数组模拟二维数组</span>
[<span class="hljs-meta">InlineArray(16)</span>] <span class="hljs-comment">// 4x4 矩阵</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Matrix4x4
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Rows =&gt; <span class="hljs-number">4</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Columns =&gt; <span class="hljs-number">4</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> row, <span class="hljs-built_in">int</span> col]
    {
        <span class="hljs-keyword">get</span> =&gt; <span class="hljs-keyword">this</span>[row * Columns + col];
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">this</span>[row * Columns + col] = <span class="hljs-keyword">value</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Matrix4x4 <span class="hljs-title">Identity</span>()</span>
    {
        <span class="hljs-keyword">var</span> matrix = <span class="hljs-keyword">new</span> Matrix4x4();
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)
        {
            matrix[i, i] = <span class="hljs-number">1.0f</span>;
        }
        <span class="hljs-keyword">return</span> matrix;
    }
}
</code></pre>
<h4 data-id="heading-13">与 Span 和 Memory 互操作</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(100)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer100
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span> _element0;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Length =&gt; <span class="hljs-number">100</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Span&lt;<span class="hljs-built_in">byte</span>&gt; <span class="hljs-title">AsSpan</span>()</span>
    {
        <span class="hljs-keyword">return</span> MemoryMarshal.CreateSpan(<span class="hljs-keyword">ref</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], Length);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> ReadOnlySpan&lt;<span class="hljs-built_in">byte</span>&gt; <span class="hljs-title">AsReadOnlySpan</span>()</span>
    {
        <span class="hljs-keyword">return</span> MemoryMarshal.CreateReadOnlySpan(<span class="hljs-keyword">ref</span> <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], Length);
    }
}
</code></pre>
<h3 data-id="heading-14">底层原理</h3>
<h4 data-id="heading-15">编译后代码结构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 原始代码</span>
[<span class="hljs-meta">InlineArray(5)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer5 { <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element; }

<span class="hljs-comment">// 近似编译结果</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Buffer5
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element0;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element1;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element2;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element3;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element4;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">ref</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> index]
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">uint</span>)index &gt;= <span class="hljs-number">5</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfRangeException();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">ref</span> Unsafe.Add(<span class="hljs-keyword">ref</span> _element0, index);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">适用场景</h3>
<ul>
<li>
<p>高性能计算：游戏引擎、图形处理或科学计算中需要连续内存的场景。</p>
</li>
<li>
<p>缓冲区管理：处理固定大小的缓冲区，如网络数据包或文件读写。</p>
</li>
<li>
<p>与本机代码交互：与 <code>C/C++</code> 或其他本机库交互，传递连续内存块。</p>
</li>
<li>
<p>替代小型数组：在结构体中替代 <code>T[]</code> 字段，减少堆分配。</p>
</li>
<li>
<p>向量/矩阵操作：表示数学向量或矩阵，优化内存访问。</p>
</li>
</ul>
<h3 data-id="heading-17">注意事项</h3>
<h4 data-id="heading-18">仅限结构体：</h4>
<ul>
<li>
<p>只能定义在 <code>struct</code> 中，不能用于 <code>class</code>。</p>
</li>
<li>
<p>这是因为结构体是值类型，内存分配更可控。</p>
</li>
</ul>
<h4 data-id="heading-19">固定大小：</h4>
<ul>
<li>
<p>内联数组的大小在编译时必须是常量，无法动态调整。</p>
</li>
<li>
<p>不适合需要变长数组的场景。</p>
</li>
</ul>
<h4 data-id="heading-20">单一字段限制：</h4>
<ul>
<li>
<p>带有 <code>[InlineArray]</code> 的结构体只能包含一个字段。</p>
</li>
<li>
<p>如果需要其他字段，必须使用嵌套结构体。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(10)</span>]
<span class="hljs-keyword">struct</span> InvalidBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _otherField; <span class="hljs-comment">// 错误：只能有一个字段</span>
}
</code></pre>
<h4 data-id="heading-21">性能优势：</h4>
<ul>
<li>
<p>内联数组分配在栈上（对于局部变量）或嵌入结构体中，减少堆分配。</p>
</li>
<li>
<p>连续内存布局减少缓存未命中（<code>cache miss</code>），提高性能。</p>
</li>
</ul>
<h4 data-id="heading-22">版本要求：</h4>
<ul>
<li>
<p>内联数组是 <code>C# 12（.NET 8）</code>的新特性，需确保项目目标框架为 <code>.NET 8.0</code> 或更高。</p>
</li>
<li>
<p>需要 <code>System.Runtime.CompilerServices.InlineArray</code> 特性。</p>
</li>
</ul>
<h4 data-id="heading-23">索引越界：</h4>
<ul>
<li>
<p>内联数组支持索引访问，但不会自动检查越界。</p>
</li>
<li>
<p>使用 <code>Span&lt;T&gt;</code> 操作时，<code>Span&lt;T&gt;</code> 会提供边界检查。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">InlineArray(2)</span>]
<span class="hljs-keyword">struct</span> SmallBuffer
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _element;
}

<span class="hljs-keyword">var</span> buffer = <span class="hljs-keyword">new</span> SmallBuffer();
buffer[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// 运行时异常：索引越界</span>
</code></pre>
<h4 data-id="heading-24">与普通数组的对比：</h4>
<ul>
<li>
<p>普通数组（<code>T[]</code>）：分配在托管堆上，动态大小，支持垃圾回收。</p>
</li>
<li>
<p>内联数组：固定大小，嵌入结构体，连续内存，适合高性能场景。</p>
</li>
</ul>
<h3 data-id="heading-25">与其他特性的对比</h3>
<h4 data-id="heading-26">与普通数组（T[]）的对比：</h4>
<ul>
<li>
<p>普通数组是引用类型，分配在堆上，大小可动态调整。</p>
</li>
<li>
<p>内联数组是值类型的一部分，固定大小，内存连续，性能更高。</p>
</li>
</ul>
<h4 data-id="heading-27">与固定大小缓冲区（fixed）的对比：</h4>
<ul>
<li>
<p><code>C#</code> 的 <code>fixed</code> 关键字用于在 <code>unsafe</code> 上下文中创建固定大小缓冲区。</p>
</li>
<li>
<p>内联数组是类型安全的，无需 <code>unsafe</code>，更易用。</p>
</li>
</ul>
<h4 data-id="heading-28">与 <code>Span&lt;T&gt;/Memory&lt;T&gt;</code> 的对比：</h4>
<ul>
<li>
<p>内联数组是数据的存储结构，而 <code>Span&lt;T&gt;和Memory&lt;T&gt;</code>是访问视图。</p>
</li>
<li>
<p>内联数组可直接转换为 <code>Span&lt;T&gt;</code>，结合使用效率更高。</p>
</li>
</ul>
<h4 data-id="heading-29">与栈分配（stackalloc）的对比：</h4>
<ul>
<li>
<p><code>stackalloc</code> 在栈上分配临时内存，生命周期短。</p>
</li>
<li>
<p>内联数组嵌入结构体，支持更灵活的生命周期和传递。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣]]></title>    <link>https://juejin.cn/post/7581693431740170303</link>    <guid>https://juejin.cn/post/7581693431740170303</guid>    <pubDate>2025-12-09T15:07:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740170303" data-draft-id="7581669438577442852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣"/> <meta itemprop="keywords" content="前端,Puppeteer,Chrome"/> <meta itemprop="datePublished" content="2025-12-09T15:07:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🤝 了解 CDP (Chrome DevTools Protocol)：browser-use 背后的隐藏功臣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:07:09.000Z" title="Tue Dec 09 2025 15:07:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Chrome DevTools Protocol (CDP)</strong> 是 Chromium 浏览器调试工具的核心通信协议：它基于 JSON 格式，可以通过 WebSocket 实现客户端与浏览器内核之间的双向实时交互。</p>
<p>基于 CDP 的开源产品有许多，其中最有名的应该是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fdevtools-frontend" target="_blank" title="https://github.com/ChromeDevTools/devtools-frontend" ref="nofollow noopener noreferrer">Chrome Devtools Frontend</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2F" target="_blank" title="https://pptr.dev/" ref="nofollow noopener noreferrer">Puppeteer</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright" target="_blank" title="https://github.com/microsoft/playwright" ref="nofollow noopener noreferrer">Playwright</a> 了。</p>
<p>Chrome Devtools Frontend 就是前端开发者天天按 F12 唤起的调试面板，而 Puppeteer 和 Playwright 是非常有名的浏览器自动化操作工具，如今的 agent browser tool（例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp" target="_blank" title="https://github.com/microsoft/playwright-mcp" ref="nofollow noopener noreferrer">playwright-mcp</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowser-use%2Fbrowser-use" target="_blank" title="https://github.com/browser-use/browser-use" ref="nofollow noopener noreferrer">browser-use</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp" ref="nofollow noopener noreferrer">chrome-devtools-mcp</a>）也是基于它们构建的。可以说每个开发者都在使用 CDP，但因它的定位比较底层，大家常常又意识不到他的存在。</p>













<table><thead><tr><th>Chrome Devtools Frontend</th><th>Puppeteer</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58fc0c7fcb5c43f88206432327f5c557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=H65vL%2Bv7rZanFTzqlwWbj%2F2i9Ig%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b4a23d85cd04ae5b5fc0b49a4845518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=xSvHO2Cb2Njx2ueJxY5wgf5oc%2B4%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<br/>
<p>CDP 有自己的<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2F" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/" ref="nofollow noopener noreferrer">官方文档站</a>和相关的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fdevtools-protocol" target="_blank" title="https://github.com/ChromeDevTools/devtools-protocol" ref="nofollow noopener noreferrer">Github 地址</a>，秉承了 Google 开源项目的一贯风格，简洁，克制，就是没什么可读性。文档和项目都是根据源码变动自动生成的，所以只能用来做 API 的查询，这也导致如果没有相关的领域知识，直接阅读相关文档或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.com%2FChromeDevTools%2Fdevtools-protocol" target="_blank" title="https://deepwiki.com/ChromeDevTools/devtools-protocol" ref="nofollow noopener noreferrer">deepwiki</a> 是拿不到什么有建设性内容的。</p>
<p>上面的那些吐槽，也是我写本文的原因，互联网上介绍 CDP 的博文太少了，也没什么系统性的架构分析，所以不如我自己来写丰富一下 AI 的语料库（bushi）。</p>
<h2 data-id="heading-0">协议格式</h2>
<p>首先 CDP 协议是一个典型的 CS 架构，这里我们拿 Chrome Devtools 为例：</p>
<ul>
<li><strong>Chrome Devtools</strong>：就是 <strong>Client</strong>，用来做调试数据的 UI 展示，方便用户阅读</li>
<li><strong>CDP</strong>：就是连接 Client-Server 的 <strong>Protocol</strong>，定义 API 的各种格式和细节</li>
<li><strong>Chromium/Chrome</strong>：就是 <strong>Server</strong>，用来产生各种数据</li>
</ul>
<p>CDP 协议的格式基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2Fspecification" target="_blank" title="https://www.jsonrpc.org/specification" ref="nofollow noopener noreferrer">JSON-RPC 2.0</a> 做了一些轻量的定制。首先是去掉了 JSON 结构体中的 <code>"jsonrpc": "2.0"</code> 这种每次都要发送的冗余信息。可以看下面几个 CDP 的实际例子：</p>
<p>首先是常规的 JSON RFC Request/Response，细节不用关注，就看整体的格式：</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/404ef253e3e7477e84e80d57dd18f894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=tW6ygST3zI61YPx7bAYtgpXrFpA%3D" width="50%" alt="Target.setDiscoverTargets" loading="lazy"/>
</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client -&gt; Chromium</span>
{
  <span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.setDiscoverTargets"</span>,
  <span class="hljs-string">"params"</span>: {<span class="hljs-string">"discover"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"filter"</span>:[{}]},
}

<span class="hljs-comment">// Chromium -&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-string">"result"</span>: {}
}
</code></pre>
<p>可以看到这就是一个经典的 JSON RFC 调用，用 id 串起 request 和 response 的关系，然后 request 中通过 <code>method</code> 和 <code>params</code> 把请求方法和请求参数带上；response 通过 <code>result</code> 带上响应结果。</p>
<p>关于 JSON RFC Notification（Event）的例子如下，定义也很清晰，就不展开了：</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42364511aa564fbb882c1741747b5ca3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=qpvAhUMxHWvnwa1Bo5IzxmL6zlw%3D" width="50%" alt="Target.targetCreated" loading="lazy"/>
</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.targetCreated"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"targetInfo"</span>: {
      <span class="hljs-string">"targetId"</span>: <span class="hljs-string">"12345"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"browser"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"attached"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"canAccessOpener"</span>: <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<p>众所周知，JSON RFC 只是一套协议标准，它其实可以跑在任意的支持双向通讯的通信协议上。目前 CDP 的主流方案还是跑在 WebSocket 上（也可以用本地 pipe 的方式连接，但用的人少），所以用户可以借助任意的 Websocket 开源库搭建出合适的产品。</p>
<br/>
<h2 data-id="heading-1">Domain 整体分类</h2>
<p>如果直接看 CDP 的文档，会发现它的目录侧边栏只有一列，那就是 Domains，然后下面有一堆看起来很熟悉的名词：DOM，CSS，Console，Debugger 等等...</p>













<table><thead><tr><th>CDP Domains</th><th>Chrome Devtools Frontend</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caaf795166e64422af13c099195561d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=uKibT6F6hhwmV5NF5ueUJl1TIzE%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dc754f66f2e4286a51da6bae6d3787a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=NAdtwX2RUDJTM6sVOhSmONY%2Fsp4%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<p>其实这些 Domain 都可以和 Chrome Devtools 联系起来的。所以我们可以从 Chrome Devtools 的各种功能反推 CDP 中的各种 Domain 作用：</p>
<ul>
<li><strong>Elements</strong>：会用到 DOM，CSS 等 domain 的 API</li>
<li><strong>Console</strong>：会用到 Log，Runtime 等 domain 的 API</li>
<li><strong>Network</strong>：会用到 Network 等 domain 的 API</li>
<li><strong>Performance</strong>：会用到 Performance，Emulation 等 domain 的 API</li>
<li>......</li>
</ul>
<p>那么到这里就有一个比较直观的认识了。我们再返回看 CDP 本身，CDP 其实可以分为两大类，然后下面有不同的 Domain 分类：</p>
<ul>
<li><strong>Browser Protocol</strong>：浏览器相关的协议，之下的 Domain 都是平台相关的，比如说 Page，DOM，CSS，Network，都是和浏览器功能相关</li>
<li><strong>JavaScript Protocol</strong>：JS 引擎相关的协议，主要围绕 JS 引擎功能本身，比如说 Runtime，Debugger，HeapProfiler 等，都是比较纯粹的 JS 语言调试功能</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0f160d77054854bd2820aff7f488a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=OoOCkjRBujMReK%2FcsD4%2BxbEP7vU%3D" alt="deepwiki 给出的 CDP Domains 分类" loading="lazy"/></p>
<p>了解了 Domain 的整体分类，下一步我们探索一下 Domain 内部的运行流程。</p>
<h2 data-id="heading-2">Domain 内部通信</h2>
<p>理解某个 Domain 的运行流程，还是老办法，对照着 <code>Chrome Devtools Frontend</code> 的某个调试面板反推，这样理解起来是最快的。</p>
<p>这里我们拿 Console 面板为例，这个基本上是 Web 开发者日常使用频率最高的功能了。</p>
<p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a3dd170dfe406c9a62748d1d03addf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=Focsa5DZZEZHPikx8vTgfnYUmU8%3D" width="70%" loading="lazy"/>
</p>
<p>从 UI 面板上看有很多功能，有筛选，分类，分组等各种高级功能，但绝大部分的功能都是前端上的实现，联系到背后和 Console 相关的 CDP 协议，其实主要就 5 条：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23method-enable" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#method-enable" ref="nofollow noopener noreferrer">Method: Log.enable</a>/<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23method-disable" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#method-disable" ref="nofollow noopener noreferrer">Method: <strong>Log</strong>.disable</a>: 开启/关闭当前页面的 log 日志输出功能</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FLog%2F%23event-entryAdded" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Log/#event-entryAdded" ref="nofollow noopener noreferrer">Event: Log.entryAdded</a>: 浏览器内部产生日志时触发，比如说一些网络错误，安全错误</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FRuntime%2F%23event-consoleAPICalled" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#event-consoleAPICalled" ref="nofollow noopener noreferrer">Event: Runtime.consoleAPICalled</a>: JS 代码调用 console API 时触发</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FRuntime%2F%23event-exceptionThrown" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#event-exceptionThrown" ref="nofollow noopener noreferrer">Event: Runtime.exceptionThrown</a>: 有未被捕获的 JS 错误时触发</li>
</ul>
<br/>
<p>举一个真实的例子，我们在 Console 面板先发起一个不合规的网络请求，然后再 log 一句话：</p>
<ul>
<li>首先每个页面打开 Devtools 的时候，会默认调用 <code>Log.enable</code> 启动 log 监听</li>
<li>手动 fetch 一个不合规的地址时，浏览器会先做安全检查，通过 <code>Log.entryAdded</code> 提示不合规</li>
<li>发起一个真实的网络请求，失败后会通过 <code>Runtime.exceptionThrown</code> 提示 Failed to fetch</li>
<li>最后手动调用 console API，CDP 会发一个 <code>Runtime.consoleAPICalled</code> 的调用 log event</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80c5622ae54642fe972570dcc41dd180~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=djhVR8%2BMlIDN7xPY2mP9U4gGZao%3D" alt="" loading="lazy"/></p>
<p>把上面的的例子抽象一下，其实<strong>所有的 Domain 的调用流程</strong>基本都是一样的：</p>
<ul>
<li>通过 <code>Domain.enable</code> 开启某个 Domain 的调试功能</li>
<li>开启功能后，就可以在这个阶段发送相关的 methods 调用，也可以监听 Chrome 发来的各种 event</li>
<li>通过 <code>Domain.disable</code> 关闭这个 Domain 的调试功能</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1bddb28db9449489cdf77b998d8c081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=gQPanPxMyKtUwZQ9FoYyiNoWptY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>部分 Domain 并没有 enable/disable 这两个 methods，具体情况具体分析</p>
</blockquote>
<h2 data-id="heading-3">Target: 特殊的 Domain</h2>
<p>上面介绍了 Domain 的分类和 Domain 内部运转的整体流程，但是有一个 Domain 非常的特殊，那就是 <strong>Target</strong>。</p>
<h3 data-id="heading-4">type 分类</h3>
<p>Target 是一个较为抽象的概述，它指的是浏览器中的<strong>可交互实体</strong>：</p>
<ul>
<li>我创建了一个<strong>浏览器</strong>，那么它本身就是一个 type 为「browser」的 Target</li>
<li>浏览器里有一个<strong>标签页</strong>，那么这个页面本身就是一个 type 为「page」的 Target</li>
<li>这个页面里要做一些耗时计算创建了一个 <strong>Worker</strong>，那么它就是一个 type 为「worker」的 Target</li>
</ul>
<p>目前从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.chromium.org%2Fchromium%2Fchromium%2Fsrc%2F%2B%2Fmain%3Acontent%2Fbrowser%2Fdevtools%2Fdevtools_agent_host_impl.cc%3Fss%3Dchromium%26q%3Df%3Adevtools%2520-f%3Aout%2520%2522%3A%3AkTypeTab%255B%255D%2522" target="_blank" title="https://source.chromium.org/chromium/chromium/src/+/main:content/browser/devtools/devtools_agent_host_impl.cc?ss=chromium&amp;q=f:devtools%20-f:out%20%22::kTypeTab%5B%5D%22" ref="nofollow noopener noreferrer">chromium 源码</a>上可以看出，Target 的 type 有以下几种：</p>
<ul>
<li>browser，browser_ui，webview</li>
<li>tab，page，iframe</li>
<li>worker，shared_worker，service_worker</li>
<li>worklet，shared_storage_worklet，auction_worklet</li>
<li>assistive_technology，other</li>
</ul>
<p>从上面的 target type 可以看出，Target 整体是属于一个 scope 比较大的实体，基本上是以<strong>进程/<strong><strong>线程</strong></strong>作为隔离单位</strong>分割的，每个 type 下可能包含多个 CDP domain，比如说 page 下就有 Runtime，Network，Storage，Log 等 domain，其他类型同理。</p>
<h3 data-id="heading-5">交互流程</h3>
<p>Target 的内部分类清晰了，那么还剩重要的一环：<strong>如何和 Target 做交互</strong>？ <br/></p>
<p>CDP 这里的逻辑是，先发个请求，向 Target 发起交互申请，然后 Target 就会给你一个 sessionId，之后的交互就在这个 session 信道上进行。CDP 在这里也对 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2Fspecification" target="_blank" title="https://www.jsonrpc.org/specification" ref="nofollow noopener noreferrer">JSON-RPC 2.0</a> 做了一个轻量定制，它们把 sessionId 放在了 JSON 的最外层，和 id 同一个层级：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">{
  <span class="hljs-attr">method</span>: <span class="hljs-string">"SystemInfo.getInfo"</span>,
  <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>,
  <span class="hljs-attr">sessionId</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
}
</code></pre>
<br/>
<p>我举个实际的例子看 session 的交互流程。</p>
<p>假设我们想从 browser Target 上获取一些系统消息，先假设我们事先已经知道了 browser 的 targetId，那么一个完整的 session 通信如下：</p>
<blockquote>
<p>这里为了聚焦 session 的核心交互逻辑，下面的 CDP message 删除了不必要的信息</p>
</blockquote>
<ol>
<li>Client 通过 <code>Target.attachToTarget</code> API 向 browser 发起会话请求，拿到 sessionId</li>
</ol>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-comment">// Client —&gt; Chromium</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Target.attachToTarget"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"targetId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"31a082d2-ba00-4d8f-b807-9d63522a6112"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// browser targetId</span>
    <span class="hljs-attr">"flatten"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-comment">// 使用 flatten 模式，后续将会把 sessionId 和 id 放在同一层级</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// Chromium —&gt; Client</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span> <span class="hljs-comment">// 拿到这次对话的 sessionId</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="2">
<li>Client 带上上一步给的 sessionId，发送一条获取系统信息的 CDP 调用并获取到相关消息</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client —&gt; Chromium</span>
{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"SystemInfo.getInfo"</span>, <span class="hljs-comment">// 获取系统信息的方法</span>
  <span class="hljs-string">"id"</span>: <span class="hljs-number">9</span>,
  <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span> <span class="hljs-comment">// sessionId 和 id 同级，在最外层</span>
}

<span class="hljs-comment">// Chromium —&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">9</span>,
  <span class="hljs-string">"sessionId"</span>: <span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
  <span class="hljs-string">"result"</span>: { <span class="hljs-comment">/* ... */</span> },
}
</code></pre>
<ol start="3">
<li>不想在这个 session 上聊了，调用 <code>Target.detachFromTarget</code> 直接断开连接，自此这个会话就算销毁了</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Client —&gt; Chromium</span>
{
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"Target.detachFromTarget"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-number">11</span>,
  <span class="hljs-string">"sessionId"</span>:<span class="hljs-string">"62584FD718EC0B52B47067AE1F922DF1"</span>
}

<span class="hljs-comment">// Chromium —&gt; Client</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-number">11</span>,
  <span class="hljs-string">"result"</span>: {}
}
</code></pre>
<p>上面的流程可以用下面的图表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0974656c9a1f4046bcff29d3a2d2f9c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=WouIsCouKtStwX6%2FgwO6zrRkE6I%3D" alt="" loading="lazy"/></p>
<p>当然涉及 Target 生命周期的相关 Methods 和 Event 还有很多，一一讲解也不现实，感兴趣的同学可以自己探索。</p>
<h3 data-id="heading-6">一对多</h3>
<p>除了上述的特性，Target 还有一个特点，那就是<strong>一个 Target 允许多个 session 连接</strong>。这意味着可以有多个 Client 去控制同一个 Target。这在现实中也是很常见的。比如说对于一个网页实体，它既可以被 Chrome Devtools（Client1）调试，也可以同时被 puppeteer（Client2）连接做自动化控制。当然这也会带来了一些资源访问的并发问题，在实际应用场景上需要万分的小心。</p>
<h2 data-id="heading-7">综合案例</h2>
<p>综上所述，我们可以看一个实际的例子，把上面的内容都囊括起来。</p>
<p>下面的案例我是用 puppeteer 创建了一个 url 为 <code>about:blank</code> 的新网页时，底层的 CDP 调用流程。调用的源文件可以访问右边的超链接下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Flf3-static.bytednsdoc.com%2Fobj%2Feden-cn%2Feojfrzeh7vhouloj%2Fagent-infra-browser%2Fcreate_about_blank_page.har" target="_blank" title="https://lf3-static.bytednsdoc.com/obj/eden-cn/eojfrzeh7vhouloj/agent-infra-browser/create_about_blank_page.har" ref="nofollow noopener noreferrer">create_about_blank_page.har</a>，har 文件可用 Chrome Devtools Network 导入查看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddd1bad12f9649579c6df68053b1af15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=gMZOm1cx74%2Fv9liucTtQ0cq3hec%3D" alt="" loading="lazy"/></p>
<br/>
<p>首先是最开始的 Target 创建流程。注意下图红框和红线里的内容：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc4fab4cf1d40ac80e5164547917576~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=0yciZ8XPPsrATzbBVX5%2FYCX62hk%3D" alt="" loading="lazy"/></p>
<ul>
<li>首先调用 <code>Target.createTarget</code> 创建一个 page（在调用 <code>createTarget</code> 时，会同步生成一个 tab Target，我们可以忽略这个行为，不影响后续理解）</li>
<li>page Target 创建好后，在响应 <code>Target.createTarget</code> methods 的同时，还会发送一个 <code>Target.targetCreated</code> 的 event，里面有这个 page Target 的详细 meta info，例如 targetId，url，title 等</li>
<li>page Target 的 meta info 变动时，会下发 <code>Target.targetInfoChanged</code> event 同步信息变化</li>
<li>page Target 下发一个 <code>Target.attachedToTarget</code> 的 event，告知 client 这次连接的 sessionId，这样后续的一些 domain 操作就可以带上 sessionId 保证信道了</li>
</ul>
<br/>
<p>Target 创建好后，就要开启这个 page 下的各个 Domain 了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc124c24e86b47a297fb9a27e2394941~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=3w1fDfS1PLgYbE3x6fKvmLpWwPc%3D" alt="" loading="lazy"/></p>
<ul>
<li>Network.enable：开启 Network Domain 的监听，比如说各种网络请求的 request/response 的细节</li>
<li>Page.enable：开启 Page Domain 的监听，比如说 navigation 行为的操纵</li>
<li>Runtime.enable：开启 Runtime Domain 的监听，比如说要在 page 里 evaluate 一段注入函数</li>
<li>Performance.enable：开启 Performance Domain 的监听，比如说一些 metrics 信息</li>
<li>Log.enable：开启 log 相关信息的监听，比如说各种 console.log 信息</li>
</ul>
<br/>
<p>开启相关 Domain 后，就可以监听这个 page Target 的相关 event 或者主动触发一些方法，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37ea0781e7f54ccf8db57c06f718cd35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897628&amp;x-signature=l5KVbjd8QgrWz3MvdWCZ7U8HphY%3D" alt="" loading="lazy"/></p>
<ul>
<li>我们主动执行 <code>Page.getNavigationHistory</code> methods，获取当前页面的 history 导航记录</li>
<li>我们监听到 <code>Runtime.consoleAPICalled</code> event 的触发，拿到了一些 console 信息</li>
</ul>
<p>相关的细节还有很多就不一一列举了，感兴趣的同学可以看上面的 har 源文件，我相信全部看完后就会对 CDP 有个清晰的认知了。</p>
<h2 data-id="heading-8">编码建议</h2>
<p>就目前（2025.12）而言，Code Agent 和 DeepResearch 等常见的 AI 辅助编程工具在 CDP 领域上表现<strong>并不是很好</strong>，主要的原因有 3 点：</p>
<ul>
<li><strong>预训练语料少</strong>：从前文可知，CDP 因为协议过于底层，所以相关的使用案例和代码非常少，模型预训练时语料很少，导致幻觉还是比较严重的</li>
<li><strong>文档质量一般</strong>：CDP 文档写的太简洁了，基本就是根据出入参自动生成的类型文档，只能用来查询核实一下，想从中获得完整的概念，对 AI 和人来说还是太难了</li>
<li><strong>API 动态迭代</strong>：CDP 虽然开源出来了，但其本质还是一个为 Chromium 服务的私有协议，其 latest 版本一直在动态迭代中，所以这种动态变化也影响了 AI 的发挥</li>
</ul>
<br/>
<p>综合以上原因，我的一个策略是「<strong>小步快跑，随时验证</strong>」。方案就是对于自己想实现的功能，先让 AI 出一个大致的方案，但是不要直接在自己的迭代的项目里直接写，而是先生成一个可以快速验证相关功能的最小 DEMO，然后亲自去验证这个方案是否符合预期。</p>
<p>「亲自验证 DEMO 可行性」 这一步非常重要，因为 AI 直出的 CDP 解决方案可靠性并不高，不像 <code>AI -&gt; UI</code> 有较高的容错率和置信度，只有在 DEMO 上验证成功的方案才有迁移到正式项目的价值。</p>
<p>另一个解决方案，就是<strong>从</strong> <strong>puppeteer</strong> <strong>等优秀项目上吸取经验</strong>。puppeteer 底层也是调用 CDP，而且它迭代了十余年，对一些常见案例已经沉淀了一套成熟的解决方案。通过学习它内部的 CDP 调用流程，可以学习到很多文档未曾描述的运用场景。下一篇 Blog，我们就分析一下 puppeteer 的源码架构，让我们在调用过程中更加得心应手。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🕹️ [AI] Chrome DevTools MCP 原理分析]]></title>    <link>https://juejin.cn/post/7581689310643634218</link>    <guid>https://juejin.cn/post/7581689310643634218</guid>    <pubDate>2025-12-09T15:23:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581689310643634218" data-draft-id="7566946330695139378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🕹️ [AI] Chrome DevTools MCP 原理分析"/> <meta itemprop="keywords" content="前端,MCP"/> <meta itemprop="datePublished" content="2025-12-09T15:23:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🕹️ [AI] Chrome DevTools MCP 原理分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:23:40.000Z" title="Tue Dec 09 2025 15:23:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025.09.23 Google 官方发布了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp" ref="nofollow noopener noreferrer">Chrome DevTools MCP</a>，目前版本号还是 0.9.0，Google 官方对它的定位是协助 AI coding assistants 做调试和性能测试，提高网页编程的 debug 能力，一些使用案例可见官方 blog：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fblog%2Fchrome-devtools-mcp%3Fhl%3Den" target="_blank" title="https://developer.chrome.com/blog/chrome-devtools-mcp?hl=en" ref="nofollow noopener noreferrer">Chrome DevTools (MCP) for your AI agent</a>。</p>
<p>本文主要是结合 源码 和 MCP output 内容，分析 chrome-devtools-mcp 的运行原理，探索它的能力边界。</p>
<h2 data-id="heading-0">Tools 分类</h2>
<p>从它的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp%2Fblob%2Fmain%2Fdocs%2Ftool-reference.md" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp/blob/main/docs/tool-reference.md" ref="nofollow noopener noreferrer">MCP Tools</a> 可以看出，它的 tools 可以分为以下类别：</p>
<ul>
<li>
<p><strong>基础能力</strong>：这部分能力主要是做网页操作，这个是所有的 Browser MCP 的基石，用户也可以不用任何网页调试的能力，只用这部分基础能力做网页自动化操作</p>
<ul>
<li><strong>Navigation</strong>：就是 createPage，closePage 等</li>
<li><strong>Input</strong>：就是 page 内的 click，hover 等操作</li>
</ul>
</li>
<li>
<p><strong>调试能力</strong>：这个其实是 chrome-devtools-mcp 主要定位的地方，提供基础的调试信息透出</p>
<ul>
<li><strong>Emulation</strong>：目前的功能还是比较弱，主要是弱网模拟，CPU 降速模拟，尺寸模拟，其实对应的是这几个功能:
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5fca893091842548301b4b3a4917c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=MMOPBahCOzSReg%2FtyNMdrdhfgNs%3D" alt="cdm-perfs" loading="lazy"/></li>
<li><strong>Performance</strong>：用来收集性能 trace 数据，对标如下的功能：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7401622b47ff4a628a94c8f5a375df0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=2inC47aSzobtuJiQ7oX2DNmh%2FvY%3D" alt="cdm-cpu-network" loading="lazy"/></li>
<li><strong>Network</strong>：获取当前 page 的所有网络信息</li>
<li><strong>Debugging</strong>：获取 console 信息，截图，还可以注入一些代码</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">技术细节</h2>
<p>chrome-devtools-mcp 底层使用的还是 <strong>puppeteer</strong>，所以很多功能直接可以对标到 puppeteer 的操作。我们直接分析 Tools 的一些技术细节。</p>
<h3 data-id="heading-2">Navigation</h3>
<p>Navigation 这块儿包装的内容很少。</p>
<p><strong>首先是 Tabs 管理。</strong></p>
<p>其实就是用了 <code>browser.pages()</code> 这个 API，然后对每个 tab 做一个基础的编号，然后利用 <code>bringToFront()</code> 做 tab 的激活，被激活的 tab 会有一个 <code>[selected]</code> 的标记：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> parts = [<span class="hljs-string">`## Pages`</span>];
<span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> page <span class="hljs-keyword">of</span> context.<span class="hljs-title function_">getPages</span>()) {
  parts.<span class="hljs-title function_">push</span>(
    <span class="hljs-string">`<span class="hljs-subst">${idx}</span>: <span class="hljs-subst">${page.url()}</span><span class="hljs-subst">${idx === context.getSelectedPageIdx() ? <span class="hljs-string">' [selected]'</span> : <span class="hljs-string">''</span>}</span>`</span>,
  );
  idx++;
}
</code></pre>
<p>最后给模型的 response 结构如下：</p>
<pre><code class="hljs language-javascript" lang="javascript">## <span class="hljs-title class_">Pages</span>
<span class="hljs-number">0</span>: <span class="hljs-attr">https</span>:<span class="hljs-comment">//developer.chrome.com/?hl=zh-cn</span>
<span class="hljs-number">1</span>: <span class="hljs-attr">https</span>:<span class="hljs-comment">//www.baidu.com/ [selected]</span>
</code></pre>
<p>chrome-devtools-mcp 这里封装非常浅，其实很多错误处理，超时处理都没有做。</p>
<br/>
<p><strong>然后是页面导航内容。</strong></p>
<p>比如说 <code>new_page</code>，<code>navigate_page</code>，<code>close_page</code> 等，其实都比较简单：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// new_page</span>
<span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();
<span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">url</span>, {
  <span class="hljs-attr">timeout</span>: request.<span class="hljs-property">params</span>.<span class="hljs-property">timeout</span>,
});

<span class="hljs-comment">// navigate_page</span>
<span class="hljs-keyword">const</span> page = context.<span class="hljs-title function_">getSelectedPage</span>();
<span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">url</span>, {
  <span class="hljs-attr">timeout</span>: request.<span class="hljs-property">params</span>.<span class="hljs-property">timeout</span>,
});

<span class="hljs-comment">// close_page</span>
<span class="hljs-keyword">await</span> context.<span class="hljs-title function_">closePage</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">pageIdx</span>);
</code></pre>
<p>这里的封装也是比较浅的，很多健壮性工作都没有做。</p>
<h3 data-id="heading-3">Input</h3>
<p>chrome-devtools-mcp 目前还是基于 DOM 的 snapshot 去做 click/drag/hover 等操作的。这里以百度首页为例，从一个简单的 click 场景分析一下它的运行流程。</p>
<ol>
<li>首先，我们通过 pptr 的可访问性 API 拿到 DOM 的 JSON 树：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rootNode = <span class="hljs-keyword">await</span> page.<span class="hljs-property">accessibility</span>.<span class="hljs-title function_">snapshot</span>({
 <span class="hljs-attr">includeIframes</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<ol start="2">
<li>然后，保存 JSON 树的每个节点，对每个节点做好编号方便后续格式化：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> idCounter = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> idToNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">TextSnapshotNode</span>&gt;();
<span class="hljs-keyword">const</span> assignIds = (<span class="hljs-attr">node</span>: <span class="hljs-title class_">SerializedAXNode</span>): <span class="hljs-function"><span class="hljs-params">TextSnapshotNode</span> =&gt;</span> {
 <span class="hljs-keyword">const</span> <span class="hljs-attr">nodeWithId</span>: <span class="hljs-title class_">TextSnapshotNode</span> = {
   ...node,
   <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${snapshotId}</span>_<span class="hljs-subst">${idCounter++}</span>`</span>, <span class="hljs-comment">// 编号</span>
   <span class="hljs-attr">children</span>: node.<span class="hljs-property">children</span>
     ? node.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">assignIds</span>(child)) <span class="hljs-comment">// 递归处理 dom 树节点</span>
     : [],
 };
 idToNode.<span class="hljs-title function_">set</span>(nodeWithId.<span class="hljs-property">id</span>, nodeWithId);
 <span class="hljs-keyword">return</span> nodeWithId;
};
</code></pre>













<table><thead><tr><th>处理前的 snapshot</th><th>处理后的 snapshot</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7df4e9252394c948e85529de6721c77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=F97%2FU0zuUx%2BNCkynOoT%2BwSiYkjY%3D" alt="" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8388e310df4462bba70d484cf83914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=snfmmiSIvezhMP2EvCFCzD3CnbY%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<ol>
<li>最后，执行相关 action 操作，比如说我要 click「新闻」这个按钮，会定位到 <code>uid=1_1 link "新闻"</code> 这条数据，然后参数传入 <code>1_1</code>，执行如下的代码：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.#textSnapshot?.<span class="hljs-property">idToNode</span>.<span class="hljs-title function_">get</span>(uid); <span class="hljs-comment">// uid="1_1"</span>
<span class="hljs-comment">// pptr 可以根据 node.elementHandle 拿到相关 dom 的 handle</span>
<span class="hljs-keyword">const</span> handle = <span class="hljs-keyword">await</span> node.<span class="hljs-title function_">elementHandle</span>(); 

<span class="hljs-keyword">await</span> handle.<span class="hljs-title function_">asLocator</span>().<span class="hljs-title function_">click</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
</code></pre>
<br/>
<p>其余 action 操作都大差不差，都是 <strong>拿到 snapshot</strong> -&gt; <strong>分析意图拿到 uid</strong> -&gt; <strong>通过 uid 拿到 DOM 执行 action</strong> 的操作。</p>
<p>这一套方案的优势是可以直接通过 pptr 的 accessibility API 拿到 DOM 的信息（而不是 browser-use 注入 JS 代码然后做自定义格式化），封装更浅更通用；劣势是可能最终 snapshot 会构建的比较大，可能会占用不少上下文。</p>
<h3 data-id="heading-4">Emulation</h3>
<p>这个内容比较简单，就是通过 pptr 的 API 调用用来模拟慢速网络，慢速 CPU，调整网页大小。只是把 API MCP 化了，不涉及很多的逻辑和上下文处理，所以略过。</p>
<h3 data-id="heading-5">Performance</h3>
<p>这个是 MCP 主打的一个功能，做性能度量和性能测试。我们先看一下它是怎么做的。</p>
<p>目前 MCP 的实现很简单，其实就是通过 pptr 提供的 API，对相关网页做性能测试的 start/stop 两个操作：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa251eff1c34ecd9011281de0e85ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=SE6UPprylN0rSOdpRmhG0Pb282o%3D" alt="" loading="lazy"/></p>
<p>但是它不会把完整的 trace 交给模型分析（完整的 trace 数据量很大，可能是 10～100 MB的 json 数据，交给模型分析也不现实），而是输出为一份<strong>性能报告模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Summary of Performance trace findings:</span>
URL: https://developer.chrome.com/?hl=zh-cn
Bounds: {min: 771625656677, max: 771629299667}
CPU throttling: none
Network throttling: none
Metrics (lab / observed):
<span class="hljs-bullet">  -</span> LCP: 907 ms, event: (eventKey: r-6881, ts: 771626610159), nodeId: 170
<span class="hljs-bullet">  -</span> LCP breakdown:
<span class="hljs-bullet">    -</span> TTFB: 808 ms, bounds: {min: 771625702955, max: 771626510489}
<span class="hljs-bullet">    -</span> Render delay: 100 ms, bounds: {min: 771626510489, max: 771626610159}
<span class="hljs-bullet">  -</span> CLS: 0.03, event: (eventKey: s--1, ts: 771626595695)
Metrics (field / real users): n/a – no data for this page in CrUX
Available insights:
<span class="hljs-bullet">  -</span> insight name: DocumentLatency
<span class="hljs-code">    description: Your first network request is the most important.  Reduce its latency by avoiding redirects, ensuring a fast server response, and enabling text compression.
    relevant trace bounds: {min: 294, max: 771626579945}
    estimated metric savings: FCP 706 ms, LCP 706 ms
    example question: How do I decrease the initial loading time of my page?
    example question: Did anything slow down the request for this document?
  - insight name: RenderBlocking
    description: Requests are blocking the page's initial render, which may delay LCP. [Deferring or inlining](https://web.dev/learn/performance/understanding-the-critical-path#render-blocking_resources) can move these network requests out of the critical path.
    relevant trace bounds: {min: 771626513396, max: 771626531288}
    estimated metric savings: FCP 90 ms, LCP 90 ms
    example question: Show me the most impactful render blocking requests that I should focus on
    example question: How can I reduce the number of render blocking requests?
  - insight name: LCPBreakdown
    description: Each [subpart has specific improvement strategies](https://web.dev/articles/optimize-lcp#lcp-breakdown). Ideally, most of the LCP time should be spent on loading the resources, not within delays.
    relevant trace bounds: {min: 771625702955, max: 771626610159}
    example question: Help me optimize my LCP score
    example question: Which LCP phase was most problematic?
    example question: What can I do to reduce the LCP time for this page load?
  - insight name: CLSCulprits
    description: Layout shifts occur when elements move absent any user interaction. [Investigate the causes of layout shifts](https://web.dev/articles/optimize-cls), such as elements being added, removed, or their fonts changing as the page loads.
    relevant trace bounds: {min: 771626595695, max: 771628821131}
    example question: Help me optimize my CLS score
    example question: How can I prevent layout shifts on this page?
  - insight name: NetworkDependencyTree
    description: [Avoid chaining critical requests](https://developer.chrome.com/docs/lighthouse/performance/critical-request-chains) by reducing the length of chains, reducing the download size of resources, or deferring the download of unnecessary resources to improve page load.
    relevant trace bounds: {min: 771625703654, max: 771626579945}
    example question: How do I optimize my network dependency tree?
  - insight name: ThirdParties
    description: 3rd party code can significantly impact load performance. [Reduce and defer loading of 3rd party code](https://web.dev/articles/optimizing-content-efficiency-loading-third-party-javascript/) to prioritize your page's content.
    relevant trace bounds: {min: 771626513396, max: 771628820176}
    example question: Which third parties are having the largest impact on my page performance?
</span>
<span class="hljs-section">## Details on call tree &amp; network request formats:</span>
Information on performance traces may contain main thread activity represented as call frames and network requests.

Each call frame is presented in the following format:

'id;eventKey;name;duration;selfTime;urlIndex;childRange;[S]'

Key definitions:

<span class="hljs-bullet">*</span> id: A unique numerical identifier for the call frame. Never mention this id in the output to the user.
<span class="hljs-bullet">*</span> eventKey: String that uniquely identifies this event in the flame chart.
<span class="hljs-bullet">*</span> name: A concise string describing the call frame (e.g., 'Evaluate Script', 'render', 'fetchData').
<span class="hljs-bullet">*</span> duration: The total execution time of the call frame, including its children.
<span class="hljs-bullet">*</span> selfTime: The time spent directly within the call frame, excluding its children's execution.
<span class="hljs-bullet">*</span> urlIndex: Index referencing the \"All URLs\" list. Empty if no specific script URL is associated.
<span class="hljs-bullet">*</span> childRange: Specifies the direct children of this node using their IDs. If empty ('' or 'S' at the end), the node has no children. If a single number (e.g., '4'), the node has one child with that ID. If in the format 'firstId-lastId' (e.g., '4-5'), it indicates a consecutive range of child IDs from 'firstId' to 'lastId', inclusive.
<span class="hljs-bullet">*</span> S: <span class="hljs-emphasis">_Optional_</span>. The letter 'S' terminates the line if that call frame was selected by the user.

Example Call Tree:

1;r-123;main;500;100;;
2;r-124;update;200;50;;3
3;p-49575-15428179-2834-374;animate;150;20;0;4-5;S
4;p-49575-15428179-3505-1162;calculatePosition;80;80;;
5;p-49575-15428179-5391-2767;applyStyles;50;50;;

Network requests are formatted like this:
<span class="hljs-code">`urlIndex;eventKey;queuedTime;requestSentTime;downloadCompleteTime;processingCompleteTime;totalDuration;downloadDuration;mainThreadProcessingDuration;statusCode;mimeType;priority;initialPriority;finalPriority;renderBlocking;protocol;fromServiceWorker;initiators;redirects:[[redirectUrlIndex|startTime|duration]];responseHeaders:[header1Value|header2Value|...]`</span>

<span class="hljs-bullet">-</span> <span class="hljs-code">`urlIndex`</span>: Numerical index for the request's URL, referencing the \"All URLs\" list.
<span class="hljs-bullet">-</span> <span class="hljs-code">`eventKey`</span>: String that uniquely identifies this request's trace event.
Timings (all in milliseconds, relative to navigation start):
<span class="hljs-bullet">-</span> <span class="hljs-code">`queuedTime`</span>: When the request was queued.
<span class="hljs-bullet">-</span> <span class="hljs-code">`requestSentTime`</span>: When the request was sent.
<span class="hljs-bullet">-</span> <span class="hljs-code">`downloadCompleteTime`</span>: When the download completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`processingCompleteTime`</span>: When main thread processing finished.
Durations (all in milliseconds):
<span class="hljs-bullet">-</span> <span class="hljs-code">`totalDuration`</span>: Total time from the request being queued until its main thread processing completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`downloadDuration`</span>: Time spent actively downloading the resource.
<span class="hljs-bullet">-</span> <span class="hljs-code">`mainThreadProcessingDuration`</span>: Time spent on the main thread after the download completed.
<span class="hljs-bullet">-</span> <span class="hljs-code">`statusCode`</span>: The HTTP status code of the response (e.g., 200, 404).
<span class="hljs-bullet">-</span> <span class="hljs-code">`mimeType`</span>: The MIME type of the resource (e.g., \"text/html\", \"application/javascript\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`priority`</span>: The final network request priority (e.g., \"VeryHigh\", \"Low\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`initialPriority`</span>: The initial network request priority.
<span class="hljs-bullet">-</span> <span class="hljs-code">`finalPriority`</span>: The final network request priority (redundant if <span class="hljs-code">`priority`</span> is always final, but kept for clarity if <span class="hljs-code">`initialPriority`</span> and <span class="hljs-code">`priority`</span> differ).
<span class="hljs-bullet">-</span> <span class="hljs-code">`renderBlocking`</span>: 't' if the request was render-blocking, 'f' otherwise.
<span class="hljs-bullet">-</span> <span class="hljs-code">`protocol`</span>: The network protocol used (e.g., \"h2\", \"http/1.1\").
<span class="hljs-bullet">-</span> <span class="hljs-code">`fromServiceWorker`</span>: 't' if the request was served from a service worker, 'f' otherwise.
<span class="hljs-bullet">-</span> <span class="hljs-code">`initiators`</span>: A list (separated by ,) of URL indices for the initiator chain of this request. Listed in order starting from the root request to the request that directly loaded this one. This represents the network dependencies necessary to load this request. If there is no initiator, this is empty.
<span class="hljs-bullet">-</span> <span class="hljs-code">`redirects`</span>: A comma-separated list of redirects, enclosed in square brackets. Each redirect is formatted as
<span class="hljs-code">`[redirectUrlIndex|startTime|duration]`</span>, where: <span class="hljs-code">`redirectUrlIndex`</span>: Numerical index for the redirect's URL. <span class="hljs-code">`startTime`</span>: The start time of the redirect in milliseconds, relative to navigation start. <span class="hljs-code">`duration`</span>: The duration of the redirect in milliseconds.
<span class="hljs-bullet">-</span> <span class="hljs-code">`responseHeaders`</span>: A list (separated by '|') of values for specific, pre-defined response headers, enclosed in square brackets.
The order of headers corresponds to an internal fixed list. If a header is not present, its value will be empty.
</code></pre>
<p>从上面这个 Summary 模板可以看出主要是暴露了一些常用的性能数据，可以拿到一个较为完整的性能报告。</p>
<p>另外一个用法是通过 <code>performance_analyze_insight</code> API 拿到具体的指标内容，比如说我想看一下 LCP 的数据，它就会从 trace 数据中拿 LCP 的内容，其实内容也是<strong>预设好的模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># performance<span class="hljs-emphasis">_analyze_</span>insight response</span>

<span class="hljs-section">## Insight Title: LCP breakdown</span>

<span class="hljs-section">## Insight Summary:</span>
This insight is used to analyze the time spent that contributed to the final LCP time and identify which of the 4 phases (or 2 if there was no LCP resource) are contributing most to the delay in rendering the LCP element.

<span class="hljs-section">## Detailed analysis:</span>
The Largest Contentful Paint (LCP) time for this navigation was 4,412 ms.
The LCP element (IMG, nodeId: 6815) is an image fetched from https://contentcms-bj.cdn.bcebos.com/cmspic/dc39f2b27f6e7b4ce3d76a5019276cde.jpeg?x-bce-process=image/crop,x<span class="hljs-emphasis">_0,y_</span>0,w<span class="hljs-emphasis">_665,h_</span>362 (eventKey: s-4377, ts: 779075655743).
<span class="hljs-section">## LCP resource network request: https://contentcms-bj.cdn.bcebos.com/cmspic/dc39f2b27f6e7b4ce3d76a5019276cde.jpeg?x-bce-process=image/crop,x<span class="hljs-emphasis">_0,y_</span>0,w<span class="hljs-emphasis">_665,h_</span>362</span>
eventKey: s-4377
Timings:
<span class="hljs-bullet">-</span> Queued at: 457 ms
<span class="hljs-bullet">-</span> Request sent at: 457 ms
<span class="hljs-bullet">-</span> Download complete at: 457 ms
<span class="hljs-bullet">-</span> Main thread processing completed at: 457 ms
Durations:
<span class="hljs-bullet">-</span> Download time: 0.2 ms
<span class="hljs-bullet">-</span> Main thread processing time: 0 μs
<span class="hljs-bullet">-</span> Total duration: 0.2 ms
Initiator: https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/module_</span>static<span class="hljs-emphasis">_include/module_</span>static<span class="hljs-emphasis">_include_</span>5d6af88.js
Redirects: no redirects
Status code: 200
MIME Type: image/jpeg
Protocol: h2
Priority: Low
Render blocking: No
From a service worker: No
Initiators (root request to the request that directly loaded this one): https://news.baidu.com/, https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/module_</span>static<span class="hljs-emphasis">_include/module_</span>static<span class="hljs-emphasis">_include_</span>5d6af88.js
Response headers
<span class="hljs-bullet">-</span> content-md5: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-flow-control-type: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-image-info: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> age: 10675
<span class="hljs-bullet">-</span> ohc-cache-hit: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> expires: Fri, 17 Oct 2025 04:17:05 GMT
<span class="hljs-bullet">-</span> date: Tue, 14 Oct 2025 07:16:54 GMT
<span class="hljs-bullet">-</span> content-type: image/jpeg
<span class="hljs-bullet">-</span> last-modified: Tue, 14 Oct 2025 04:17:04 GMT
<span class="hljs-bullet">-</span> ohc-cos.ap-shanghai-size: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-cache-status: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-debug-id: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-request-id: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> accept-ranges: bytes
<span class="hljs-bullet">-</span> ohc-global-saved-time: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> content-length: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> x-bce-is-transition: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>
<span class="hljs-bullet">-</span> server: nginx
<span class="hljs-bullet">-</span> x-bce-storage-class: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">redacted</span>&gt;</span></span>

We can break this time down into the 4 phases that combine to make the LCP time:

<span class="hljs-bullet">-</span> Time to first byte: 207 ms (4.7% of total LCP time)
<span class="hljs-bullet">-</span> Resource load delay: 250 ms (5.7% of total LCP time)
<span class="hljs-bullet">-</span> Resource load duration: 0.2 ms (0.0% of total LCP time)
<span class="hljs-bullet">-</span> Element render delay: 3,955 ms (89.6% of total LCP time)

<span class="hljs-section">## Estimated savings: none</span>

<span class="hljs-section">## External resources:</span>
<span class="hljs-bullet">-</span> https://web.dev/articles/lcp
<span class="hljs-bullet">-</span> https://web.dev/articles/optimize-lcp
</code></pre>
<p>值得注意的是，上面的模板内容其实都不在 MCP 代码里，而是直接复用的 devtools 里的代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c28f8760a6450498981967e4121ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=QWETjrsQ2o95RcrEqwxpzfuj4%2Fs%3D" alt="" loading="lazy"/></p>
<p>综上所述，MCP 做性能测试时的流程如下：</p>
<ul>
<li>先全量获取一份 trace 数据</li>
<li>然后通过全量的 trace 数据给一份 Summary 内容</li>
<li>如果想看具体的性能指标（比如说 LCP），可以直接指定相关指标拿到一份相关模板数据</li>
</ul>
<br/>
<p>从我个人角度看，chrome-devtools-mcp 的性能测试其实就是<strong>预制菜</strong>。目前它的能力上限就是 Lighthouse。</p>
<p>因为我做过较长时间的性能优化，所以对 devtool 这套 perfs 的使用还是比较有心得的。MCP 提供的这些性能优化，其实都是复用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev" target="_blank" title="https://web.dev" ref="nofollow noopener noreferrer">web.dev</a> 中的性能优化建议（这也是 Google 官方的好处，可以复用相同的资产），如果开发中接入 MCP，可能会修复解决一些初级的性能优化问题。</p>
<p>如果想解决一些非常复杂的性能问题，目前 MCP 提供的能力还是远远不够的，可以这样理解，一个 100MB 的 trace 数据，现在的 MCP 只提供了几个切面（Summary/LCP/FCP 等），从几个切面是无法获取全局理解的。</p>
<h3 data-id="heading-6">Network</h3>
<p>提供了两个 API，<code>list_network_requests</code>，列出网络请求列表，还有一个 <code>get_network_request</code> 查看具体请求的细节信息。</p>
<p>其实 network 能力核心就 1 行代码，pptr page 监听并收集所有的网络数据：</p>
<pre><code class="hljs language-javascript" lang="javascript">page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'request'</span>, <span class="hljs-function"><span class="hljs-params">request</span> =&gt;</span> <span class="hljs-title function_">collect</span>(request));
</code></pre>
<p>拿到所有的网络数据了，那么 全量/筛选/细节 其实都能拿到，然后做格式化即可。</p>
<br/>
<p>下面是百度首页的全量 network response summary 信息：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># list<span class="hljs-emphasis">_network_</span>requests response</span>
<span class="hljs-section">## Network requests</span>
Showing 1-63 of 63 (Page 1 of 1).
https://news.baidu.com/ GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/common/resource/js/usermonitor_</span>88a158c.js?v=1.2 GET [failed - 304]
https://gss0.bdstatic.com/5foIcy0a2gI2n2jgoY3K/static/fisp<span class="hljs-emphasis">_static/wza/aria.js?appid=c890648bf4dd00d05eb9751dd0548c30 GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/js/jquery-1.8.3.min<span class="hljs-emphasis">_a6ffa58.js GET [failed - 304]
https://efe-h2.cdn.bcebos.com/cliresource/ubc-report-sdk/2.0.8/ubc-web-sdk.umd.min.js GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/module<span class="hljs-emphasis">_static_</span>include/module<span class="hljs-emphasis">_static_</span>include<span class="hljs-emphasis">_326f211.css GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/focustop/focustop<span class="hljs-emphasis">_2701266.css GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/img/sidebar/newErweima<span class="hljs-emphasis">_9fa03e0.png GET [failed - 304]
https://news-bos.cdn.bcebos.com/mvideo/log-news.png GET [success - 200]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/img/footer/newErweima<span class="hljs-emphasis">_9fa03e0.png GET [failed - 304]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/common/lib/mod<span class="hljs-emphasis">_b818356.js GET [failed - 304]
https://mbdp02.bdstatic.com/pcnews/static/fisp_</span>static/news/focustop/focustop<span class="hljs-emphasis">_b924ecb.js GET [success - 200]
</span></code></pre>
<p>下面是某个 HTTP 请求的 request/response 细节：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># get<span class="hljs-emphasis">_network_</span>request response</span>
<span class="hljs-section">## Request https://mbdp02.bdstatic.com/pcnews/static/fisp<span class="hljs-emphasis">_static/news/js/jquery-1.8.3.min_</span>a6ffa58.js</span>
Status:  [failed - 304]
<span class="hljs-section">### Request Headers</span>
<span class="hljs-bullet">-</span> sec-ch-ua-platform:\"macOS\"
<span class="hljs-bullet">-</span> if-none-match:\"a6ffa586a4bd1dc6ac369de9a08c18ef\"
<span class="hljs-bullet">-</span> referer:https://news.baidu.com/
<span class="hljs-bullet">-</span> user-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10<span class="hljs-emphasis">_15_</span>7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
<span class="hljs-bullet">-</span> sec-ch-ua:\"Google Chrome\";v=\"141\", \"Not?A<span class="hljs-emphasis">_Brand\";v=\"8\", \"Chromium\";v=\"141\"
- if-modified-since:Wed, 12 Mar 2025 06:44:26 GMT
- sec-ch-ua-mobile:?0
### Response Headers
- accept-ranges:bytes
- access-control-allow-origin:*
- age:165476
- connection:keep-alive
- content-md5:pv+lhqS9HcasNp3poIwY7w==
- content-type:text/javascript; charset=utf-8
- date:Tue, 14 Oct 2025 07:52:52 GMT
- etag:\"a6ffa586a4bd1dc6ac369de9a08c18ef\"
- expires:Wed, 15 Oct 2025 09:54:56 GMT
- last-modified:Wed, 12 Mar 2025 06:44:26 GMT
- ohc-cache-hit:wzix57 [2]
- ohc-cos.ap-shanghai-size:93010
- ohc-global-saved-time:Sun, 12 Oct 2025 09:54:56 GMT
- server:JSP3/2.0.14
- x-cache-status:HIT
- x-bce-content-crc32:2237621194
- x-bce-debug-id:Rm9nn/ehbuTaGCz6KrvSy6cqmggWUatfykgluv61oqpFxkZl6/I9a7WaPOkKP9v5zCrujYrhMbyf9b2K0sYiUA==
- x-bce-flow-control-type:-1
- x-bce-is-transition:false
- x-bce-request-id:bf31960c-378d-46b8-a13d-95dbbb3741fa
- x-bce-storage-class:STANDARD
### Response Body
!function(e,t){function n(e){var t...
</span></code></pre>
<p>从上面两段 response 可以看出，这部分数据不复杂，也没有做更多的预制处理。基本就是把所有网络请求列出来，把 HTTP 的 Header/Body 打印出来。</p>
<h3 data-id="heading-7">Debugging</h3>
<p>Debugging 的内容比较杂，可以分类说一下。</p>
<h4 data-id="heading-8">evaluate_script</h4>
<p>首先是 <code>evaluate_script</code> 这个 tool，就是向 page 里注入一段 JS 代码做执行，然后拿到结果。</p>
<h4 data-id="heading-9">list_console_messages</h4>
<p>另一个是 <code>list_console_messages</code>，核心两行代码，监听页面的 console 和 error 事件，然后全部收集起来：</p>
<pre><code class="hljs language-javascript" lang="javascript">page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'console'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> <span class="hljs-title function_">collect</span>(event));
page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pageerror'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> <span class="hljs-title function_">collect</span>(event));
</code></pre>
<p>比如说这里我收集到的百度首页信息，从 devtools 控制台和 MCP 的 response 对比，可见内容是一致的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7444f2befd24453aa6337bff2667912d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=5DeL23EDU2DwzK%2B3OCMN3vwmup4%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># list<span class="hljs-emphasis">_console_</span>messages response</span>
<span class="hljs-section">## Console messages</span>
A parser-blocking, cross site (i.e. different eTLD+1) script, https://news-bos.cdn.bcebos.com/mvideo/pcconf<span class="hljs-emphasis">_2019.js?1760428369873, is invoked via document.write. The network request for this script MAY be blocked by the browser in this or a future page load due to poor network connectivity. If blocked in this page load, it will be confirmed in a subsequent console message. See https://www.chromestatus.com/feature/5718547946799104 for more details.
A parser-blocking, cross site (i.e. different eTLD+1) script, https://news-bos.cdn.bcebos.com/mvideo/pcconf_</span>2019.js?1760428369873, is invoked via document.write. The network request for this script MAY be blocked by the browser in this or a future page load due to poor network connectivity. If blocked in this page load, it will be confirmed in a subsequent console message. See https://www.chromestatus.com/feature/5718547946799104 for more details.
Error&gt; Failed to load resource: the server responded with a status of 500 (Internal Server Error)
b.jpg?cmd=1&amp;class=technnews&amp;cy=0&amp;0.4963333576628812:undefined:undefined
Error&gt; Failed to load resource: the server responded with a status of 500 (Internal Server Error)
&amp;refer<span class="hljs-emphasis">_hostname=news.baidu.com&amp;byInputUrl=1&amp;ra=3078942552352606:undefined:undefined
</span></code></pre>
<h4 data-id="heading-10">take_screenshot</h4>
<p>就是对当前页面或某个 DOM 做截图。直接套用 pptr 的 API，没什么特别的。</p>
<h2 data-id="heading-11">总结</h2>
<p>从「<strong>基础能力</strong>」的角度看，如果只是想用 chrome-devtools-mcp 去控制浏览器做一些自动化操作，它其实还是非常基础的，很多能力都是属于入门级别，只能说能用，和其他的 Browser MCP 相比谈不上有什么优势（优势可能是 Google 官方出品？）。但是这些能力如果只是为了方便开发者调试网页，可能也够用了。</p>
<p>从「<strong>调试能力</strong>」的角度看，chrome-devtools-mcp 可以复用 ChromeDevTools 团队的一些工作，在调试能力上可以保证长期维护的稳定性。但目前看调试能力提供的还是<strong>比较少的</strong>：</p>
<ul>
<li>可以感知到 console 控制台的一些  warning/error log，然后反向去优化修改代码</li>
<li>可以感知一些 network 信息，可以做一些网络问题的分析</li>
<li>可以做一些基础的性能优化，目前看分析的上限就是 Lighthouse。但性能优化本身是一个很复杂的事情，目前的形态可能帮助不大</li>
</ul>
<p>其余的基础调试能力其实都没有涉及，比如说 Element 调试，分析一下各种奇形怪状的 CSS，这个还是做不到的，即使是借助 screenshot，也拿不到真正的细节只能纯瞎蒙。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f214e960c265456d8d2a136d25ce3c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898620&amp;x-signature=wx%2FIOyj7sylDNzh9W8OLFi9EoGs%3D" alt="" loading="lazy"/></p>
<p>更高级的调试能力（比如说 Animations，Rendering 等能力）预期后续也很难加入，因为基础能力还没有打磨好，还需要大量的时间去完善和优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent 入门科普：从"人工智障"到"数字打工人"的进化史]]></title>    <link>https://juejin.cn/post/7581698074361905161</link>    <guid>https://juejin.cn/post/7581698074361905161</guid>    <pubDate>2025-12-09T15:28:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074361905161" data-draft-id="7581691182003650570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent 入门科普：从&quot;人工智障&quot;到&quot;数字打工人&quot;的进化史"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T15:28:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限大6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent 入门科普：从"人工智障"到"数字打工人"的进化史
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限大6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:28:30.000Z" title="Tue Dec 09 2025 15:28:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🤖 Agent 入门科普：从"人工智障"到"数字打工人"的进化史</h2>
<blockquote>
<p>大家好，欢迎来到无限大的博客，这个专栏是新开的，打算讲一讲Agent，其实早就有学习的打算了</p>
<p>近期在逛<strong>github</strong>的时候看到一个高star项目，叫做<strong>Hello-Agents</strong>，项目地址是[<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatawhalechina%2Fhello-agents" target="_blank" title="https://github.com/datawhalechina/hello-agents" ref="nofollow noopener noreferrer">github.com/datawhalech…</a>]
我的文章也是参考了这个内容写的，这个系列更新比较慢，因为我也是边学边写的，所以会比较慢，但是我会尽量写的详细一些，用更多贴近生活的抽象案例来讲解，希望能帮助到大家</p>
</blockquote>
<h3 data-id="heading-1">引言：当 AI 开始自己"打工"了</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3b157dde39547e18de24c6edf2fcf25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=rGIKFoqmUWCX3PoyqGx4vvcMHaU%3D" alt="6c10b139f9c135dd75cbc5dd7a0493f0.png" loading="lazy"/>
<em>2025年的AI打工人：不仅会干活，还会主动加班（老板狂喜）</em></p>
<p>2025 年的某个清晨，你被手机震醒——不是闹钟，而是你的 AI 助手发来的消息："主人，我已经帮你完成了本周工作报告的初稿（分析了过去 3 个月的销售数据 📊），订好了下周去上海的高铁票 🚄，还顺便帮你给女朋友挑了周年礼物 🎁（根据你们的聊天记录分析她最近喜欢的香水品牌）。对了，我发现你的信用卡账单有点问题，已经帮你联系银行 dispute 了那笔可疑交易 💳。"</p>
<p>你是不是以为这是科幻电影的场景？醒醒！这就是 AI Agent（智能体）正在干的事儿——它们不再是被动等待指令的"人工智障"，而是能主动规划、自己找活儿干的"数字打工人"👷‍♂️。</p>
<p>今天这篇文章，咱们就来聊聊：到底什么是 Agent？它和我们天天聊天的 ChatGPT 有啥不一样？为什么说它可能是未来十年最值得关注的 AI 技术？</p>
<h3 data-id="heading-2">什么是 Agent：会"自己拿主意"的 AI</h3>
<h4 data-id="heading-3">Agent 的官方定义：四要素缺一不可</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/998e1e62cc1f406cb4e017bb6296efac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=E7KfEJOCr17l8njwliH29FjphB0%3D" alt="d3d19d47228b1e6334f3e8f3b770ec51.png" loading="lazy"/>
<em>Agent的四大法宝：少一个都成不了"卷王"</em></p>
<p>用最人话的解释：<strong>Agent 就是能在环境中自主行动的 AI 系统</strong> 。就像《西游记》里的孙悟空 🐒——有火眼金睛（感知环境）、有金箍棒（工具）、有七十二变（行动能力）、还有自己的小算盘（目标和规划）。</p>
<p>学术一点说，Agent 必须具备四个核心要素（敲黑板！考试要考的 📝）：</p>



































<table><thead><tr><th>要素</th><th>解释</th><th>人类对应</th><th>生活例子</th></tr></thead><tbody><tr><td>🧠<strong>感知（Sensors）</strong></td><td>接收环境信息的能力</td><td>眼睛、耳朵、皮肤</td><td>你刷抖音时，手机摄像头感知你的表情变化</td></tr><tr><td>🌍<strong>环境（Environment）</strong></td><td>Agent 所处的"世界"</td><td>现实物理世界</td><td>智能家居系统的环境就是你的房子</td></tr><tr><td>🎯<strong>自主决策（Autonomy）</strong></td><td>不需要人类干预做决定</td><td>大脑思考</td><td>导航软件自动帮你避开拥堵路段</td></tr><tr><td>🦾<strong>行动（Actuators）</strong></td><td>影响环境的能力</td><td>手、脚、嘴巴</td><td>智能音箱帮你开关灯、定闹钟</td></tr></tbody></table>
<h4 data-id="heading-4">Agent 的三种"性格"：从"愣头青"到"老司机"</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ea1e9cb32044ebe8d2eb7f77862005c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=DPb9PjZQxPHaptyBaY%2FDBi9qgV0%3D" alt="c3baf6a25320b011ae4f14a863932e42.png" loading="lazy"/></p>
<p><em>三兄弟各有所长：橙的爱决策，蓝的会执行，紫的专捣乱（不是）</em></p>
<p>就像人有不同性格，Agent 也分三种类型，智商和能力天差地别：</p>
<h5 data-id="heading-5">1. 反应式 Agent：只会"条件反射"的愣头青 🤯</h5>
<p>这是最原始的 Agent，没脑子，只会"if...then..."。比如你家的扫地机器人 🤖，碰到障碍物就拐弯，没电了就回充——它不知道自己在扫地，只是机械执行预设规则。</p>
<p><strong>代码示例（伪代码）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">扫地机器人Agent</span>(<span class="hljs-params">传感器数据</span>):
    <span class="hljs-keyword">if</span> 前方有障碍物:
        随机左转或右转<span class="hljs-number">30</span>度
    <span class="hljs-keyword">elif</span> 电量 &lt; <span class="hljs-number">20</span>%:
        返回充电座
    <span class="hljs-keyword">else</span>:
        向前走并开启吸尘
</code></pre>
<h5 data-id="heading-6">2. 规划式 Agent：会"未雨绸缪"的聪明人 🤓</h5>
<p>这种 Agent 就高级了，它有"脑子"（内部状态），会规划未来。比如你手机里的导航 App🧭，它不仅知道现在的路况，还会预测 1 小时后的交通状况，帮你规划最优路线。</p>
<p><strong>生活案例</strong> ：当你用高德地图导航时，它会告诉你"前方 3 公里拥堵，预计延误 15 分钟，已为你重新规划路线"——这就是规划式 Agent 在工作！</p>
<h5 data-id="heading-7">3. 混合式 Agent："愣头青"和"老司机"的结合体 🚗</h5>
<p>大多数实用的 Agent 都是混合式的。平时用反应式快速处理简单任务，遇到复杂情况就启动规划模式。比如特斯拉的自动驾驶系统 🚘：</p>
<ul>
<li>反应式：突然有车加塞？立刻刹车！</li>
<li>规划式：导航去机场时，会提前规划高速入口、充电站点</li>
</ul>
<h3 data-id="heading-8">Agent vs ChatGPT：到底有啥不一样？</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50c8e03e8a524ee0bd28f4d90d7488e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=NV56xsHEsCKqrGU%2FcF3UkThQN5g%3D" alt="f31290a62ae9cb9256fa70a5577987f4.png" loading="lazy"/></p>
<p><em>左边ChatGPT：只能聊天；右边Agent：自己找工具干活的卷王本王</em></p>
<h4 data-id="heading-9">灵魂拷问：ChatGPT 是 Agent 吗？</h4>
<p>先给结论： <strong>不是！但它可以成为 Agent 的"大脑"</strong> 🧠。</p>
<p>很多人以为 ChatGPT 就是 Agent，这其实是个天大的误会！它们的区别，就像"计算器"和"会计"的区别——计算器很会算，但不会主动帮你报税；会计会用计算器，但更会帮你规划财务、处理复杂事务。</p>
<h4 data-id="heading-10">一张表看懂核心区别</h4>









































<table><thead><tr><th>对比维度</th><th>🤖 ChatGPT（大语言模型）</th><th>🦾 AI Agent（智能体）</th><th>形象比喻</th></tr></thead><tbody><tr><td><strong>工作模式</strong></td><td>被动等待指令，"问一句答一句"</td><td>主动找事做，"自己定 KPI"</td><td>客服 vs 项目经理</td></tr><tr><td><strong>记忆能力</strong></td><td>上下文窗口有限（比如只能记 4096 个词）</td><td>长期记忆，可存储和调用历史数据</td><td>鱼的 7 秒记忆 vs 人的日记本</td></tr><tr><td><strong>工具使用</strong></td><td>原生不支持（需要插件扩展）</td><td>天生会用工具（API 调用是基本功）</td><td>只会口算 vs 会用计算器+Excel</td></tr><tr><td><strong>目标导向</strong></td><td>没有内在目标，完成当前对话即可</td><td>有明确目标，会拆解任务并执行</td><td>外卖员 vs 创业老板</td></tr><tr><td><strong>环境交互</strong></td><td>只能通过文本交互</td><td>可接入各种传感器（摄像头、麦克风等）</td><td>盲人摸象 vs 正常人看世界</td></tr></tbody></table>
<h4 data-id="heading-11">举个栗子 🌰：订机票的区别</h4>
<p><strong>用 ChatGPT 订机票</strong> ：</p>
<ul>
<li>你："帮我查明天北京到上海的机票"</li>
<li>GPT："明天有以下航班：CA185（08:30 起飞）..."</li>
<li>你："选 CA185，经济舱"</li>
<li>GPT："已帮你生成订票链接..."</li>
<li>（全程需要你一步步指挥）</li>
</ul>
<p><strong>用 Agent 订机票</strong> ：</p>
<ul>
<li>你："我明天要去上海开会，帮我安排行程"</li>
<li>Agent："好的，已查询到明天会议时间是 14:00。为你选择了 CA185（08:30 起飞），理由：① 准点率 92% ② 价格比其他航班低 15% ③ 到达后有 2 小时缓冲时间。已帮你完成订票，座位选了靠窗的（根据你的历史偏好），还预约了接机服务。需要我同步发送行程给会议组织者吗？"</li>
<li>（全程无需你操心，它自己就把所有事办了）</li>
</ul>
<h3 data-id="heading-12">Agent 的核心模块：数字打工人的"五脏六腑"</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2175948e5ef4c66a39a8e57518a1ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=TpQdWtSBqCes1S4olrAG%2FEPnDK8%3D" alt="482a718273a4baca012bf28c5e57ba4f.png" loading="lazy"/>
<em>拆开看看Agent的五脏六腑</em></p>
<p>如果把 Agent 比作一个人，那它的"身体构造"是这样的：</p>
<h4 data-id="heading-13">1. 感知模块：Agent 的"五官" 👀👂👃👅👆</h4>
<p>负责接收外界信息，相当于人的眼耳口鼻。比如：</p>
<ul>
<li>智能家居 Agent 通过温湿度传感器感知环境 🌡️</li>
<li>自动驾驶 Agent 通过摄像头和雷达感知路况 🚗</li>
<li>手机助手通过麦克风接收语音指令 🎤</li>
</ul>
<p><strong>代码示例（简单感知模块）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">感知模块</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.摄像头 = 摄像头API()
        self.麦克风 = 麦克风API()
        self.温度传感器 = 温度传感器API()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">获取环境数据</span>(<span class="hljs-params">self</span>):
        图像 = self.摄像头.拍照()
        声音 = self.麦克风.录音(<span class="hljs-number">5</span>秒)
        温度 = self.温度传感器.读取()
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"图像"</span>: 图像,
            <span class="hljs-string">"声音"</span>: 声音,
            <span class="hljs-string">"温度"</span>: 温度
        }
</code></pre>
<h4 data-id="heading-14">2. 记忆模块：Agent 的"大脑硬盘" 💾</h4>
<p>负责存储信息，分两种：</p>
<p><strong>*短期记忆</strong> ：处理当前任务的临时数据（比如你正在和它说的话）</p>
<ul>
<li><strong>长期记忆</strong> ：历史经验、规则库、用户偏好（比如你喜欢喝奶茶不加糖）</li>
</ul>
<p>最酷的是，有些 Agent 还会"反思学习"——就像你写日记总结经验一样，它会分析自己哪里做得好、哪里做得不好，然后改进。</p>
<h4 data-id="heading-15">3. 规划模块：Agent 的"军师" 🧠</h4>
<p>这是 Agent 的核心竞争力！会把大目标拆解成小任务，还会制定详细计划。比如你让 Agent"帮我准备周末野餐"，它会：</p>
<ol>
<li>目标拆解：确定时间 → 选地点 → 列清单 → 采购 → 准备工具</li>
<li>资源规划：查天气预报（如果下雨就改期）→ 查公园开放时间</li>
<li>风险控制：准备备用方案（比如带雨伞、急救包）</li>
</ol>
<h4 data-id="heading-16">4. 工具调用模块：Agent 的"瑞士军刀" 🔧</h4>
<p>Agent 之所以强大，是因为它会用各种工具。就像 007 有万能手表，Agent 有万能 API：</p>
<ul>
<li>查天气？调用天气 API ☁️</li>
<li>订酒店？调用携程 API 🏨</li>
<li>算数据？调用 Python 计算器 🧮</li>
<li>发邮件？调用 SMTP 服务 📧</li>
</ul>
<p><strong>代码示例（工具调用）</strong> ：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">工具调用模块</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.工具库 = {
            <span class="hljs-string">"天气查询"</span>: <span class="hljs-string">"https://api.weather.com/query"</span>,
            <span class="hljs-string">"酒店预订"</span>: <span class="hljs-string">"https://api.ctrip.com/book"</span>,
            <span class="hljs-string">"计算器"</span>: <span class="hljs-string">"https://api.calculator.com/compute"</span>
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">调用工具</span>(<span class="hljs-params">self, 工具名, 参数</span>):
        <span class="hljs-keyword">if</span> 工具名 <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.工具库:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"抱歉，我还不会用这个工具"</span>
        <span class="hljs-comment"># 调用API并返回结果</span>
        <span class="hljs-keyword">return</span> requests.get(self.工具库[工具名], params=参数).json()

<span class="hljs-comment"># 使用示例</span>
agent_tools = 工具调用模块()
天气 = agent_tools.调用工具(<span class="hljs-string">"天气查询"</span>, {<span class="hljs-string">"城市"</span>: <span class="hljs-string">"北京"</span>, <span class="hljs-string">"日期"</span>: <span class="hljs-string">"2025-12-10"</span>})
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"明天天气：<span class="hljs-subst">{天气[<span class="hljs-string">'温度'</span>]}</span>℃，<span class="hljs-subst">{天气[<span class="hljs-string">'状况'</span>]}</span>"</span>)
</code></pre>
<h3 data-id="heading-17">Agent 的应用场景：已经在悄悄改变世界</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70eeb15b9de2471d8dba503ff4bdbff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765898910&amp;x-signature=HooQ79XhSD1kgceeeOmFecnoMVE%3D" alt="25d2b1e16535cd4f2b1dc5885e657d48.png" loading="lazy"/></p>
<p><em>上班摸鱼带娃炒股全在行，就是不会帮你背锅——毕竟电子打工人也怕失业</em></p>
<p>Agent 不是实验室里的概念，它已经在很多领域"打工"了：</p>
<h4 data-id="heading-18">1. 个人助理：你的"24 小时秘书" 🕵️‍♀️</h4>
<p><strong>*Microsoft Copilot+</strong> ：能帮你管理日程、回复邮件、甚至写代码时主动提示错误</p>
<ul>
<li><strong>Anthropic Claude 3</strong> ：可以分析你的文档，自动生成摘要和待办事项</li>
<li><strong>国内选手</strong> ：字节跳动"豆包 Agent"、阿里"通义千问 Agent"</li>
</ul>
<h4 data-id="heading-19">2. 企业应用：降本增效的"超级员工" 🏢</h4>
<ul>
<li><strong>客服 Agent</strong> ：不仅能回答问题，还能主动发现客户潜在需求（比如"您最近经常查询退货政策，是对产品有什么不满意吗？"）</li>
<li><strong>数据分析 Agent</strong> ：自动从数据库抓取数据、生成报表、发现异常（比如"本月西南地区销售额下降 15%，已帮您定位到 3 个重点问题..."）</li>
<li><strong>供应链 Agent</strong> ：预测库存需求，自动下单补货，甚至和供应商谈判价格</li>
</ul>
<h4 data-id="heading-20">3. 未来畅想：Agent 生态系统 🌐</h4>
<p>想象一下未来：你的个人 Agent 可以和医生 Agent、律师 Agent、老师 Agent"开会"，帮你解决复杂问题。就像现在的 App Store，未来可能会有"Agent Store"——你需要什么功能，下载一个 Agent 就行！</p>
<h3 data-id="heading-21">结语：为什么 Agent 值得你关注？</h3>
<p>看到这里，你可能会说："Agent 这么厉害，会抢我的工作吗？" 😱</p>
<p>我的回答是： <strong>会，但更会创造新工作</strong> 。就像计算机淘汰了打字员，却创造了程序员、产品经理等新职业。未来最吃香的，可能是那些会"管理 Agent 团队"的人 👩‍💼👨‍💼。</p>
<p>记住这个公式： <strong>Agent = 大语言模型（ChatGPT 等） + 记忆 + 规划 + 工具</strong> 。它不是凭空出现的新技术，而是 AI 技术发展到一定阶段的必然产物——就像手机从功能机进化到智能机，AI 正在从"被动工具"进化到"主动助手"。</p>
<blockquote>
<p>如果你觉得这篇文章有用，欢迎点赞 👍 收藏 🌟，关注我的 Agent 系列博客——下一篇我们聊聊： <strong>如何自己动手做一个简单的 Agent</strong> （不需要编程大神，普通人也能学会！）。</p>
<p>最后留个思考题：如果你能拥有一个 Agent，你最想让它帮你做什么？评论区告诉我！👇</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉]]></title>    <link>https://juejin.cn/post/7581693431740252223</link>    <guid>https://juejin.cn/post/7581693431740252223</guid>    <pubDate>2025-12-09T15:48:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740252223" data-draft-id="7581678032336846890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-12-09T15:48:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别让页面 “鬼畜跳”！Google 钦点的 3 个性能指标，治好了我 80% 的用户投诉
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T15:48:17.000Z" title="Tue Dec 09 2025 15:48:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">💥告别卡顿！前端性能优化第一课：Google钦点的三大核心指标，你真的懂吗？</h2>
<blockquote>
<p>欢迎来到前端性能优化专栏的第一课！在这个“用户体验至上”的时代，一个卡顿、缓慢、乱跳的网站，就像一辆抛锚在高速公路上的跑车，再酷炫也只会让人抓狂。别担心，Google已经为你准备好了一份“体检报告”——<strong>核心Web指标（Core Web Vitals）</strong> 。</p>
</blockquote>
<p>今天，我们就来揭开这份报告的神秘面纱，用最通俗易懂的方式，让你彻底搞懂这三大指标，迈出性能优化的第一步！</p>
<h3 data-id="heading-1">✨ LCP（Largest Contentful Paint）：最大内容绘制</h3>
<h4 data-id="heading-2">🚀 衡量：加载性能（你的“第一印象”）</h4>
<p>LCP，直译过来是<strong>最大内容绘制</strong>。它衡量的是用户在访问页面时，<strong>视口中最大的那块可见内容（图片或文本块）完成渲染所需的时间</strong>。</p>
<p>简单来说，它回答了一个核心问题：<strong>用户觉得你的页面“加载完成”了吗？</strong></p>
<p>想象一下，你打开一个电商网站，最想看到的是商品大图和价格。LCP就是衡量这个“最重要的东西”多久能出现在你面前。它直接反映了用户对页面加载速度的感知。</p>















<table><thead><tr><th>指标</th><th>衡量维度</th><th>优秀标准</th></tr></thead><tbody><tr><td><strong>LCP</strong></td><td>用户感知的加载速度</td><td><strong>&lt;= 2.5秒</strong></td></tr></tbody></table>
<p>如果你的 LCP 超过 2.5 秒，用户可能就开始感到不耐烦了。优化 LCP，就是让你的“门面”以最快的速度展示给客人！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1672e56406bc47e0aac380547f1f2c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765900097&amp;x-signature=CVcbklCH6NcDWqIjSLFshD4BVxQ%3D" alt="LCP 示意图" loading="lazy"/></p>
<h3 data-id="heading-3">⚠️ CLS（Cumulative Layout Shift）：累积布局偏移</h3>
<h4 data-id="heading-4">🛡️ 衡量：视觉稳定性（告别“鬼畜”跳动）</h4>
<p>CLS，<strong>累积布局偏移</strong>，听起来有点拗口，但它的作用非常直观：<strong>它衡量页面加载过程中元素的非预期移动</strong>。</p>
<p>你一定遇到过这种情况：正准备点击一个按钮，结果它上面的广告突然加载出来，把按钮挤下去了，你点了个空！这就是布局偏移（Layout Shift）。</p>
<p>CLS 的分数就是用来量化这种“鬼畜”跳动有多严重的。分数越低，代表你的页面布局越稳定，用户体验越丝滑。</p>















<table><thead><tr><th>指标</th><th>衡量维度</th><th>理想值</th></tr></thead><tbody><tr><td><strong>CLS</strong></td><td>页面布局稳定性</td><td><strong>&lt; 0.1</strong></td></tr></tbody></table>
<p><strong>小贴士：</strong> 布局偏移通常是由没有设置尺寸的图片、动态插入的广告或内容导致的。想要 CLS 达标，请给你的元素预留好“坑位”！</p>
<h3 data-id="heading-5">⚡️ INP（Interaction to Next Paint）：交互到下次绘制</h3>
<h4 data-id="heading-6">🔄 衡量：整体交互响应性（从“第一印象”到“全程流畅”）</h4>
<p>INP，<strong>交互到下次绘制</strong>，是性能指标家族的新晋“网红”。它衡量的是用户进行<strong>点击、触摸或键盘输入</strong>后，浏览器需要多长时间才能在屏幕上绘制出视觉反馈。</p>
<p>它取代了老前辈 <strong>FID（First Input Delay，首次输入延迟）</strong> ，为什么呢？</p>





















<table><thead><tr><th>为什么用 INP 替代 FID？</th><th>INP 的优势</th></tr></thead><tbody><tr><td><strong>FID 的局限性</strong></td><td>仅测量<strong>首次</strong>输入延迟，忽略了用户在后续操作中遇到的卡顿。</td></tr><tr><td><strong>INP 的全面性</strong></td><td>监控用户<strong>整个访问周期</strong>内的所有交互，更全面。</td></tr><tr><td><strong>更真实的用户体验</strong></td><td>INP 选取<strong>最慢的一次交互</strong>作为代表值，反映了“整个使用过程中”的流畅度，而不是仅仅看“第一印象”。</td></tr></tbody></table>
<p>简单来说，FID 就像面试官只看你的简历，而 INP 则是全程跟拍你的工作表现。一个真正流畅的网站，不应该只是第一次点击快，而是从头到尾都快！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4192b9eb4e4f48b18d13c2a2e6f47295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765900097&amp;x-signature=SB%2Bwny7ENj6Rwl1AohjgzDUAg7w%3D" alt="INP 与 FID 比较图" loading="lazy"/></p>
<h3 data-id="heading-7">🔬 实验室数据 vs. 🌍 现场数据：性能优化的“双重奏”</h3>
<p>搞懂了三大指标，接下来我们聊聊如何获取这些数据。性能数据主要分为两大类：<strong>实验室数据</strong>和<strong>现场数据</strong>。</p>























<table><thead><tr><th>类型</th><th>来源（数据渠道）</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>实验室数据 (Lab Data)</strong></td><td>Lighthouse</td><td>可控、快速、方便复现问题</td><td>非真实用户环境，可能与实际体验有偏差</td></tr><tr><td><strong>现场数据 (Field Data)</strong></td><td>CrUX/Web Vitals</td><td>真实用户体验，数据最可靠</td><td>不易复现问题，需要时间积累数据</td></tr></tbody></table>
<h4 data-id="heading-8">🔧 实验室数据工具</h4>
<p>实验室数据就像你在实验室里用精密仪器做的测试，环境是固定的。</p>
<ul>
<li><strong>Lighthouse (Chrome 内置)</strong> ：Chrome 开发者工具里就能找到，它能快速给你打分，支持 LCP/CLS/INP 评分。</li>
<li><strong>PageSpeed Insights</strong>：Google 官方工具，它会结合<strong>实验室数据</strong>（Lighthouse）和<strong>现场数据</strong>（CrUX），给你一份一站式的性能报告。</li>
</ul>
<h4 data-id="heading-9">🛠️ 现场数据工具</h4>
<p>现场数据则是你的网站在真实用户、真实网络、真实设备上跑出来的“实战成绩”。</p>
<ul>
<li><strong>Google Search Console</strong>：提供网站整体的核心指标健康报告，是 SEO 优化的重要参考。</li>
<li><strong>web-vitals JavaScript 库</strong>：这是前端工程师的“秘密武器”。它是一个轻量级的库，可以让你在用户浏览器中实时收集 LCP、CLS、INP 数据，并上报到你的分析后台。</li>
</ul>
<h4 data-id="heading-10">💡 使用 <code>web-vitals</code> 收集性能数据（实战代码）</h4>
<p>通过这个库，你可以将真实用户的性能数据发送到你的服务器进行分析，建立自己的性能监测体系（RUM，Real User Monitoring）。</p>
<pre><code class="hljs language-scss" lang="scss">import { onLCP, onCLS, onINP } from 'web-vitals'
​
function <span class="hljs-built_in">sendToAnalytics</span>(metric) {
  <span class="hljs-comment">// 将性能指标数据转换为 JSON 字符串</span>
  const <span class="hljs-selector-tag">body</span> = JSON<span class="hljs-selector-class">.stringify</span>(metric)
  
  <span class="hljs-comment">// 使用 navigator.sendBeacon 或 fetch 发送数据，确保在页面关闭前发送成功</span>
  ;(navigator.sendBeacon &amp;&amp; navigator.sendBeacon('/analytics', body)) ||
    <span class="hljs-built_in">fetch</span>('/analytics', { body, method: 'POST', keepalive: true })
}
​
<span class="hljs-comment">// 监听并上报三大核心指标</span>
<span class="hljs-built_in">onLCP</span>(sendToAnalytics)
<span class="hljs-built_in">onCLS</span>(sendToAnalytics)
<span class="hljs-built_in">onINP</span>(sendToAnalytics)
</code></pre>
<h3 data-id="heading-11">✅ 总结：性能优化的“三字真经”</h3>
<p>好了，总结一下我们今天学到的前端性能优化的“三字真经”：</p>
<ol>
<li><strong>LCP：核心内容尽快可见</strong>（加载速度要快！）</li>
<li><strong>CLS：页面布局稳定</strong>（别再乱跳了！）</li>
<li><strong>INP：交互响应及时</strong>（操作要流畅！）</li>
</ol>
<p>通过 <strong>Lighthouse</strong>、<strong>Search Console</strong> 以及 <strong>Web Vitals</strong> 库，我们不仅能建立起一套完善的性能监测体系，还能精准地识别并修复那些让用户抓狂的体验瓶颈。</p>
<p>提升网页质量，不仅能让用户开心，还能让你的网站在 Google 搜索中获得更好的排名。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Firebase CLI 一直关联失败]]></title>    <link>https://juejin.cn/post/7581666412021874697</link>    <guid>https://juejin.cn/post/7581666412021874697</guid>    <pubDate>2025-12-09T14:06:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666412021874697" data-draft-id="7581666412021858313" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Firebase CLI 一直关联失败"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T14:06:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="J船长"/> <meta itemprop="url" content="https://juejin.cn/user/1820446987136903"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Firebase CLI 一直关联失败
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446987136903/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    J船长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:06:03.000Z" title="Tue Dec 09 2025 14:06:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>比如执行`firebase login``然后跳转浏览器，进行关联</p>
<h2 data-id="heading-0">解决办法：</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> https_proxy=http:<span class="hljs-comment">//127.0.0.1:xxxx</span>
<span class="hljs-keyword">export</span> http_proxy=http:<span class="hljs-comment">//127.0.0.1:xxxx</span>
<span class="hljs-keyword">export</span> all_proxy=socks5:<span class="hljs-comment">//127.0.0.1:xxxx</span>
firebase login
</code></pre>
<hr/>
<h2 data-id="heading-1">原因:</h2>
<p>macOS 上开 V 只是让浏览器等应用走代理，但终端默认不走代理。终端里的命令（如 firebase）需要手动设置 http_proxy 和 https_proxy 环境变量才能走代理访问 Google 服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么在 Agent 时代，我选择了 Bun？]]></title>    <link>https://juejin.cn/post/7581678301216964608</link>    <guid>https://juejin.cn/post/7581678301216964608</guid>    <pubDate>2025-12-09T14:04:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581678301216964608" data-draft-id="7581664445241606159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么在 Agent 时代，我选择了 Bun？"/> <meta itemprop="keywords" content="JavaScript,Bun,Agent"/> <meta itemprop="datePublished" content="2025-12-09T14:04:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mCell"/> <meta itemprop="url" content="https://juejin.cn/user/2280829967146779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么在 Agent 时代，我选择了 Bun？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2280829967146779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mCell
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:04:58.000Z" title="Tue Dec 09 2025 14:04:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>同步至个人站点：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Ftopics%2Fbun%2F01_start" target="_blank" title="https://stack.mcell.top/topics/bun/01_start" ref="nofollow noopener noreferrer">为什么在 Agent 时代，我选择了 Bun？ - Bun 指南</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3cd035dbd624c1fbaae35c03f9cd479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=ccCGXokJPpTUBsibIK%2FRWU3KAgI%3D" alt="076.webp" loading="lazy"/></p>
<h2 data-id="heading-0">一切都从那条「收购 Bun」的新闻开始</h2>
<p>上周三，看到 Anthropic 的一则新闻：他们宣布收购 Bun，并在文中明确写到——对 Claude Code 的用户来说，这次收购意味着<strong>更快的性能、更高的稳定性以及全新的能力</strong>。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fanthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" title="https://www.anthropic.com/news/anthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" target="_blank" ref="nofollow noopener noreferrer">Anthropic</a>)</p>
<p>简单翻译一下就是：</p>
<blockquote>
<p>我们要把整个编码 Agent 的基础设施，换成一个更快、更顺手的 JS/TS 运行时。</p>
</blockquote>
<p>这条新闻对我触动很大，至少暴露出两个事实：</p>
<ol>
<li>
<p><strong>Agent 时代的基础设施在变化</strong>
以前我们写 CLI、写后端，Node 足够用了；但到了 Agent 这种「到处起小进程、到处跑工具」的场景里，<strong>启动速度、冷启动性能、all-in-one 工具链</strong>，突然变得非常关键。</p>
</li>
<li>
<p><strong>Bun 不再只是一个「新玩具」</strong>
它已经成为一家头部 AI 公司的底层组件之一：Anthropic 早就在内部用 Bun 跑 Claude Code，现在索性直接收购，把它当作下一代 AI 软件工程的基础设施。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</li>
</ol>
<p>当我再去翻 Bun 的官网时，就会发现：</p>
<blockquote>
<p>这是一个集 <strong>JavaScript/TypeScript 运行时、包管理器、打包器、测试运行器</strong> 于一身的 all-in-one 工具。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</blockquote>
<p>这和我对「传统 JS 运行时」的印象已经完全不一样了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ee9e9a5a084460ea7f346a8a1127782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=zpNVA%2BQw9bpf6xk%2FCO10dMKNzS0%3D" alt="078.webp" loading="lazy"/></p>
<h2 data-id="heading-1">先说说我的技术背景：为什么要写这个专题？</h2>
<p>我平时写代码偏向两类技术栈：</p>
<ul>
<li><strong>TypeScript</strong>：前端、工具脚本、Node 小服务</li>
<li><strong>Go</strong>：服务端、一些偏底层的活</li>
</ul>
<p>很长一段时间里，我对 Node 的使用场景大概就是这几种：</p>
<ul>
<li>写个小脚本：<code>ts-node</code> / <code>tsx</code> + 一点配置，跑完就扔</li>
<li>写个中小型服务端：Express / Nest 这一类</li>
</ul>
<p>这些场景里，一个很明显的感受是：</p>
<ul>
<li>Node <strong>够成熟</strong>：生态庞大，资料多，出了问题很容易搜到坑</li>
<li>但 Node 也<strong>够「厚重」</strong>：一堆配置、各种工具组合、打包测试 lint 各种链路</li>
</ul>
<p>直到我开始认真看 Bun 的文档，第一次有一种很强烈的对比感：</p>
<blockquote>
<p>「哦，原来现在写 JS/TS 后端已经可以这么简单了？」</p>
</blockquote>
<ul>
<li>不用写 <code>tsconfig.json</code>（很多时候默认就很好用）</li>
<li>dev / build / test 基本就是一行命令：
<code>bun run</code> / <code>bun build</code> / <code>bun test</code></li>
<li>起一个 HTTP server，用的还是 JS/TS，但 API 明显更简洁，很多地方甚至不需要 Node 的那一套底层 API</li>
</ul>
<p>再加上我最近在做 Agent 相关的东西，自然就顺势产生了一个问题：</p>
<blockquote>
<p>既然我本来就想用 TS 写一个 ReAct Agent，那为什么不干脆用 Bun 来做 runtime 呢？</p>
</blockquote>
<h2 data-id="heading-2">Agent CLI 的选型：为什么会想到 Bun？</h2>
<p>在开搞之前，我特地去看了一圈现在比较热门的 Agent CLI 都是怎么选技术栈的：</p>
<ul>
<li>Google 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" target="_blank" title="https://github.com/google-gemini/gemini-cli" ref="nofollow noopener noreferrer">Gemini CLI</a>：<strong>Node</strong></li>
<li>OpenAI 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex" target="_blank" title="https://github.com/openai/codex" ref="nofollow noopener noreferrer">Codex CLI</a>：<strong>Rust</strong>写核心逻辑，UI交给<strong>Node和TypeScript</strong></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code" target="_blank" title="https://github.com/anthropics/claude-code" ref="nofollow noopener noreferrer">Claude Code CLI</a> 和基础设施：<strong>Bun</strong>(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reuters.com%2Fbusiness%2Fmedia-telecom%2Fanthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02%2F" title="https://www.reuters.com/business/media-telecom/anthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02/" target="_blank" ref="nofollow noopener noreferrer">Reuters</a>)</li>
</ul>
<p>如果你把这些信息放在一起，会大致看到一个趋势：</p>
<ul>
<li>Rust：更偏向<strong>极致性能、可控性、安全性</strong>，适合那种「我要把一套工具做到很底层、很稳」的团队。</li>
<li>Node：稳定、生态成熟，但随着项目往 AI 工程、Agent 方向发展，在<strong>冷启动、工具链整合</strong>上没有那么「顺手」。</li>
<li>Bun：尝试在 Node 的生态基础上，往前推进一步，做一个<strong>all-in-one、性能极强的 JS/TS 运行时</strong>。</li>
</ul>
<p>而我这个人，有个很明显的偏好：</p>
<blockquote>
<p>能用 TS 解决的，就先别急着上 Rust。</p>
</blockquote>
<p>所以，当我看到：</p>
<ul>
<li>Anthropic 在 Agent 业务上，押注 Bun</li>
<li>Bun 自己的定位又是：<strong>“把你写 Node 的那套事，全部做到更快、更简单”</strong>(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
</ul>
<p>那我心里那个问题就更具体了：</p>
<blockquote>
<p><strong>在「写 Agent」这个具体场景里，Bun 真的比 Node 体验更好吗？</strong></p>
</blockquote>
<p>我不太喜欢只看 benchmark，于是就决定写点实打实的东西来试试看。</p>
<h2 data-id="heading-3">一个不到百行的 ReAct Agent Demo</h2>
<p>为了验证这个问题，我给自己定了一个很小的练习目标：</p>
<blockquote>
<p>用 <strong>Bun + TypeScript</strong>，写一个「不到百行代码」的极简 ReAct Agent Demo。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b908fc9be8984806815ffdb3a53db679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=p1FDHkeA85pyGFzyX%2Bvg%2BAqK684%3D" alt="079.webp" loading="lazy"/></p>
<p>这个 Agent 不追求多复杂的功能，专注这几件事：</p>
<ol>
<li>
<p>维护一个最小可用的 <strong>ReAct loop</strong>（思考 → 行动 → 观察 → 再思考）</p>
</li>
<li>
<p>内置少量工具，比如：</p>
<ul>
<li><code>read</code>：读取文件内容</li>
<li><code>write</code>：写入/更新文件</li>
</ul>
</li>
<li>
<p>整个项目尽量清爽，不做多余封装</p>
</li>
</ol>
<p>写的过程非常「AI 化」：</p>
<ul>
<li>先用 Node 写了一版最朴素的版本</li>
<li>再让 AI 帮我<strong>改写为 Bun 的 API</strong></li>
<li>我负责补坑、重构、整理结构</li>
</ul>
<p>结果出乎意料地顺畅：</p>
<ul>
<li>很多原来需要 <code>fs</code> 模块、各种工具库的地方，在 Bun 里可以用自己的 API 写得更简洁，比如 <code>Bun.file()</code>、<code>Bun.write()</code> 这种。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
<li>dev / build / test 自己都不用纠结，直接 <code>bun xxx</code> 的那一套就行，几乎不需要额外配置。</li>
<li>Agent loop 那段代码本身是比较核心的逻辑，集中精力在这里就好了，不太需要为工程化配置分心。</li>
</ul>
<p>更关键的是：</p>
<blockquote>
<p>整个 Demo 框架搭好后，我有一种「这个东西是可以往前认真维护」的感觉，而不是写完就丢。</p>
</blockquote>
<p>这和我之前写很多 Node 小脚本的心理预期是完全不一样的。</p>
<h2 data-id="heading-4">再聊一句「全栈」：TS 之后，运行时是谁？</h2>
<p>周末刷 X，看到老许的<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fxushiwei%2Fstatus%2F1997328503985852798" target="_blank" title="https://x.com/xushiwei/status/1997328503985852798" ref="nofollow noopener noreferrer">帖子</a>，如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9769d9e9c45f48d8b4e9c60a9497b6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765893954&amp;x-signature=PDVyJaTf04nuXCHyDoai5h4yKyQ%3D" alt="080.webp" loading="lazy"/></p>
<p>这句话我很认同。
前后端统一 TS 技术栈，对个人开发者来说太友好了：</p>
<ul>
<li>一门语言，从浏览器跑到服务端、再到 CLI、工具链</li>
<li>类型系统本身就成为你的「文档 + 校验器」</li>
</ul>
<p>那顺着这个思路，下一步的问题就自然来了：</p>
<blockquote>
<p>既然语言是 TypeScript，那<strong>运行时</strong>呢？
未来的 TS 运行时，会不会从 Node，逐渐走向 Bun（一部分场景）？</p>
</blockquote>
<p>我不打算在这里给出一个结论——毕竟 Node 的体量、生态、历史沉淀摆在那里，而 Bun 目前也还只是一个「两年多一点」的新 runtime。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
<p>但从我自己的体验看，有两点很值得关注：</p>
<ol>
<li>
<p><strong>Bun 是为「现代 JS/TS 开发」重新设计过的</strong>
它自带 bundler、test runner、包管理器，不再是「一个 runtime + 一堆第三方工具拼装」的模式。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</p>
</li>
<li>
<p><strong>Bun 和 Agent、AI 工程这类新场景的契合度异常高</strong></p>
<ul>
<li>CLI 需要冷启动快 → Bun 做得很好</li>
<li>项目喜欢 all-in-one 工具链 → Bun 直接内置</li>
<li>你本来就写 TS → Bun 对 TS 原生友好</li>
</ul>
</li>
</ol>
<p>这些特性，叠加起来就会让人产生那种感觉：</p>
<blockquote>
<p>「如果我要重写一遍现在手里这些 Node 脚本、工具、Agent，那好像真的可以考虑直接上 Bun。」</p>
</blockquote>
<h2 data-id="heading-5">这个专题想写些什么？</h2>
<p>既然已经有了实践的契机（ReAct Agent Demo），再加上我一贯「学新东西喜欢顺手写点东西」的习惯，那干脆就开一个新专题：《Bun 指南》。</p>
<p><strong>这第一篇就是引言，只回答一个问题：为什么要学 Bun？</strong></p>
<p>后面的几篇，我打算按这样的节奏展开（暂定）：</p>
<ol>
<li>
<p><strong>安装与上手：从 Node 迁移到 Bun 有多难？</strong></p>
<ul>
<li>安装 Bun</li>
<li>跑起第一个 <code>bun run</code> / <code>bun dev</code></li>
<li>把一个简单的 Node 脚本迁移到 Bun</li>
</ul>
</li>
<li>
<p><strong>Bun 的 all-in-one 工具链</strong></p>
<ul>
<li>包管理器：<code>bun install</code> vs npm/pnpm</li>
<li><code>bun test</code>：内置测试如何用</li>
<li><code>bun build</code>：打包、构建、单文件可执行</li>
</ul>
</li>
<li>
<p><strong>用 Bun 写 HTTP 服务</strong></p>
<ul>
<li><code>Bun.serve()</code> 的基本用法(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" title="https://bun.sh/" target="_blank" ref="nofollow noopener noreferrer">bun.sh</a>)</li>
<li>和 Node / Express 的直观对比</li>
<li>简单的 API 服务实战</li>
</ul>
</li>
<li>
<p><strong>文件、进程与工具脚本：Bun 的标准库体验</strong></p>
<ul>
<li><code>Bun.file()</code> / <code>Bun.write()</code> 等常用 API</li>
<li>用 Bun 写一个实用 CLI 小工具</li>
</ul>
</li>
<li>
<p><strong>实战篇：用 Bun + TS 写一个 ReAct Agent Demo</strong></p>
<ul>
<li>核心 loop 逻辑拆解</li>
<li>如何组织「工具」层（read / write / 调用外部接口）</li>
<li>运行、调试与「AI Coding 助攻」的一些经验</li>
</ul>
</li>
<li>
<p><strong>踩坑记录 &amp; 迁移经验</strong></p>
<ul>
<li>哪些地方真的爽了</li>
<li>哪些地方还不如 Node 成熟</li>
<li>写给准备从 Node 迁到 Bun 的你</li>
</ul>
</li>
</ol>
<p>如果你已经会写 JavaScript / Node，这个专题不会从「什么是 Promise」讲起，而会更聚焦在：</p>
<ul>
<li><strong>从 Node 迁移到 Bun 时，大脑需要切换的那一小部分东西</strong></li>
<li><strong>在 Bun 里，如何用尽量少的代码做更多事</strong></li>
<li><strong>结合 Agent / AI 工程场景，感受下一代 JS/TS runtime 的味道</strong></li>
</ul>
<h2 data-id="heading-6">写在最后</h2>
<p>我并不打算把 Bun 神化成「Node 杀手」——至少短期内，它更像是：</p>
<blockquote>
<p>一个极适合「个人开发者 / 小团队 / 新项目 / Agent 工程」尝鲜的 JS/TS 运行时。</p>
</blockquote>
<p>而这个系列，就是我在这个尝试过程中的「实践笔记」：</p>
<ul>
<li>一部分是 Bun 本身的能力整理</li>
<li>一部分是我做 ReAct Agent 的真实踩坑经验</li>
<li>还有一部分，是在这个过程中我对「全栈 / TS / runtime 演进」的一些小思考</li>
</ul>
<p>如果你：</p>
<ul>
<li>已经会 Node / TS</li>
<li>正在关注 Agent / AI 工程</li>
<li>又对「更快、更简洁的 JS/TS 运行时」有点好奇</li>
</ul>
<p>那欢迎一起把这个系列看下去，也欢迎你在实践中告诉我：
<strong>在你的场景里，Bun 到底是不是一个更好的选择？</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reuters.com%2Fbusiness%2Fmedia-telecom%2Fanthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02%2F" target="_blank" title="https://www.reuters.com/business/media-telecom/anthropic-acquires-developer-tool-startup-bun-scale-ai-coding-2025-12-02/" ref="nofollow noopener noreferrer">Reuters</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析]]></title>    <link>https://juejin.cn/post/7581666412021891081</link>    <guid>https://juejin.cn/post/7581666412021891081</guid>    <pubDate>2025-12-09T14:21:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581666412021891081" data-draft-id="7531888171584897059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-09T14:21:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            requestAnimationFrame 与 JS 事件循环：宏任务执行顺序分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:21:41.000Z" title="Tue Dec 09 2025 14:21:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">一、先理清核心概念</h2>
<p>在讲解执行顺序前，先明确几个关键概念：</p>
<ol>
<li><strong>宏任务（Macrotask）</strong> ：常见的有 <code>setTimeout</code>、<code>setInterval</code>、I/O 操作、script 整体代码、UI 渲染（注意：渲染是独立阶段，不是宏任务，但和 rAF 强相关）。</li>
<li><strong>微任务（Microtask）</strong> ：<code>Promise.then/catch/finally</code>、<code>queueMicrotask</code>、<code>MutationObserver</code> 等，会在宏任务执行完后、渲染 / 下一个宏任务前立即执行。</li>
<li><strong>requestAnimationFrame</strong>：不属于宏任务 / 微任务，是浏览器专门为动画设计的 API，会在<strong>浏览器重绘（渲染）之前</strong>执行，执行时机在微任务之后、宏任务之前（下一轮）。</li>
</ol>
<h2 data-id="heading-1">二、事件循环的执行流程</h2>
<p>一个完整的事件循环周期执行顺序：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 执行当前宏任务（如 script 主代码）
<span class="hljs-bullet">2.</span> 执行所有微任务（微任务队列清空）
<span class="hljs-bullet">3.</span> 执行 requestAnimationFrame 回调
<span class="hljs-bullet">4.</span> 浏览器进行 UI 渲染（重绘/回流）
<span class="hljs-bullet">5.</span> 取出下一个宏任务执行，重复上述流程
</code></pre>
<h2 data-id="heading-2">三、代码分析</h2>
<p><strong>代码执行优先级</strong>：同步代码 &gt; 微任务 &gt; rAF（当前帧） &gt; 普通宏任务（setTimeout） &gt; rAF（下一帧） &gt; 后续普通宏任务。</p>
<h4 data-id="heading-3">场景 1：基础顺序（script + 微任务 + rAF + 宏任务）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 同步代码（属于第一个宏任务：script 整体）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步代码执行'</span>);

<span class="hljs-comment">// 微任务</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'微任务执行'</span>);
});

<span class="hljs-comment">// requestAnimationFrame</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'requestAnimationFrame 执行'</span>);
});

<span class="hljs-comment">// 宏任务（setTimeout 是宏任务）</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 宏任务执行'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序大部分情况下是这样的：</span>
<span class="hljs-comment">// 同步代码执行</span>
<span class="hljs-comment">// 微任务执行</span>
<span class="hljs-comment">// requestAnimationFrame 执行</span>
<span class="hljs-comment">// setTimeout 宏任务执行</span>
</code></pre>
<p><strong>代码解释1</strong>：</p>
<ul>
<li>第一步：执行同步代码，打印「同步代码执行」；</li>
<li>第二步：微任务队列有 <code>Promise.then</code>，执行并打印「微任务执行」；</li>
<li>第三步：浏览器准备渲染前，执行 rAF 回调，打印「requestAnimationFrame 执行」；</li>
<li>第四步：浏览器完成渲染后，取出下一个宏任务（setTimeout）执行，打印「setTimeout 宏任务执行」。</li>
</ul>
<p><strong>代码解释2</strong>：</p>
<ul>
<li>
<p><strong>正常浏览器环境（60Hz 屏幕，无阻塞）</strong> ：输出顺序是按上方写的先后顺序执行的：</p>
<pre><code class="hljs language-arduino" lang="arduino">同步代码执行
微任务执行
requestAnimationFrame 执行
setTimeout 宏任务执行
</code></pre>
<p>原因：浏览器每 16.7ms 刷新一次，<code>requestAnimationFrame</code> 会在<strong>下一次重绘前</strong>执行，而 <code>setTimeout</code> 即使设为 0，也会有 4ms 左右的最小延迟（浏览器限制），所以 <code>requestAnimationFrame</code> 先执行。</p>
</li>
<li>
<p><strong>极端情况（主线程阻塞 / 浏览器刷新延迟）</strong> ：可能出现顺序互换：</p>
<pre><code class="hljs language-arduino" lang="arduino">同步代码执行
微任务执行
setTimeout 宏任务执行
requestAnimationFrame 执行
</code></pre>
<p><strong>原因</strong>：如果主线程处理完微任务后，<code>requestAnimationFrame</code> 的回调还没到执行时机（比如浏览器还没到重绘节点），但 <code>setTimeout</code> 的最小延迟已到，就会先执行 <code>setTimeout</code>。</p>
</li>
</ul>
<h3 data-id="heading-4">总结</h3>
<ol>
<li>
<p><strong>固定顺序</strong>：同步代码 → 微任务，这两步是绝对固定的，不受任何因素影响。</p>
</li>
<li>
<p><strong>不固定顺序</strong>：<code>requestAnimationFrame</code> 和 <code>setTimeout</code> 的执行先后不绝对，前者优先级更高但依赖渲染时机，后者受最小延迟限制，多数场景下前者先执行，但不能当作 “绝对结论”。</p>
</li>
<li>
<p>核心原则：<code>requestAnimationFrame</code> 属于 “渲染相关回调”，优先级高于普通宏任务（如 <code>setTimeout</code>），但并非 ECMAScript 标准定义的 “微任务 / 宏任务” 范畴，而是浏览器的扩展机制，因此执行时机存在微小不确定性。</p>
</li>
</ol>
<h4 data-id="heading-5">场景 2：嵌套场景（rAF 内嵌套微任务 / 宏任务）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步代码'</span>);

<span class="hljs-comment">// 第一个 rAF</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 执行'</span>);
  
  <span class="hljs-comment">// rAF 内的微任务</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 内的微任务'</span>);
  });
  
  <span class="hljs-comment">// rAF 内的宏任务</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 1 内的 setTimeout'</span>);
  }, <span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// rAF 内嵌套 rAF</span>
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 2 执行'</span>);
  });
});

<span class="hljs-comment">// 外层微任务</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'外层微任务'</span>);
});

<span class="hljs-comment">// 外层宏任务</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'外层 setTimeout'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序：</span>
<span class="hljs-comment">// 同步代码</span>
<span class="hljs-comment">// 外层微任务</span>
<span class="hljs-comment">// rAF 1 执行</span>
<span class="hljs-comment">// rAF 1 内的微任务</span>
<span class="hljs-comment">// 外层 setTimeout</span>
<span class="hljs-comment">// （浏览器下一次渲染前）</span>
<span class="hljs-comment">// rAF 2 执行</span>
<span class="hljs-comment">// rAF 1 内的 setTimeout</span>
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li>先执行同步代码 → 外层微任务；</li>
<li>执行 rAF 1 → 立即执行 rAF 1 内的微任务（微任务会在当前阶段清空）；</li>
<li>浏览器渲染后，执行下一轮宏任务：外层 setTimeout；</li>
<li>下一次事件循环的渲染阶段，执行嵌套的 rAF 2；</li>
<li>最后执行 rAF 1 内的 setTimeout（下下轮宏任务）。</li>
</ol>
<h4 data-id="heading-6">场景 3：rAF 与多个宏任务对比</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 宏任务1：setTimeout 0</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 1'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// rAF</span>
<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'rAF 执行'</span>);
});

<span class="hljs-comment">// 宏任务2：setTimeout 0</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 2'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 执行结果顺序：</span>
<span class="hljs-comment">// rAF 执行</span>
<span class="hljs-comment">// setTimeout 1</span>
<span class="hljs-comment">// setTimeout 2</span>
</code></pre>
<p><strong>结论</strong>：即使多个宏任务排在前面，rAF 依然会在「微任务后、渲染前」优先执行，然后才执行所有待处理的宏任务。</p>
<h2 data-id="heading-7">四、实际应用</h2>
<p>rAF 的这个执行特性，常用来做高性能动画（比如 DOM 动画），因为它能保证在渲染前执行，避免「布局抖动」：</p>
<pre><code class="hljs language-ini" lang="ini">// 用 rAF 实现平滑移动动画
const <span class="hljs-attr">box</span> = document.getElementById(<span class="hljs-string">'box'</span>)<span class="hljs-comment">;</span>
let <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

function moveBox() {
  left += 1<span class="hljs-comment">;</span>
  <span class="hljs-attr">box.style.left</span> = `<span class="hljs-variable">${left}</span>px`<span class="hljs-comment">;</span>
  
  // 动画未结束则继续调用 rAF
  if (left &lt; 300) {
    requestAnimationFrame(moveBox)<span class="hljs-comment">;</span>
  }
}

// 启动动画
requestAnimationFrame(moveBox)<span class="hljs-comment">;</span>
</code></pre>
<p>这个代码的优势：rAF 会和浏览器的刷新频率（通常 60Hz，每 16.7ms 一次）同步，不会像 <code>setTimeout</code> 那样可能出现丢帧，因为 <code>setTimeout</code> 是宏任务，执行时机不固定，可能错过渲染时机。</p>
<h3 data-id="heading-8">总结</h3>
<ol>
<li><strong>核心执行顺序</strong>：同步代码 → 所有微任务 → requestAnimationFrame → 浏览器渲染 → 下一轮宏任务（setTimeout/setInterval 等）。</li>
<li><strong>rAF 本质</strong>：不属于宏 / 微任务，是浏览器渲染阶段的「专属回调」，优先级高于下一轮宏任务。</li>
<li><strong>实战价值</strong>：rAF 适合做 UI 动画，能保证动画流畅；宏任务（setTimeout）适合非渲染相关的异步操作，避免阻塞渲染。</li>
</ol>
<h2 data-id="heading-9">相比传统的计时器防抖与节流</h2>
<h3 data-id="heading-10">实战代码：rAF 实现节流（最常用）</h3>
<p>rAF 做节流的核心优势：和浏览器渲染同步，不会出现「执行次数超过渲染帧」的无效执行，尤其适合 <code>resize</code>、<code>scroll</code>、<code>mousemove</code> 这类和 UI 相关的高频事件。</p>
<h4 data-id="heading-11">基础版 rAF 节流</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rafThrottle</span>(<span class="hljs-params">callback</span>) {
  <span class="hljs-keyword">let</span> isPending = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已有待执行的回调</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (isPending) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 已有待执行任务，直接返回</span>
    
    isPending = <span class="hljs-literal">true</span>;
    <span class="hljs-comment">// 绑定 this 指向，传递参数</span>
    <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      callback.<span class="hljs-title function_">apply</span>(context, args); <span class="hljs-comment">// 执行回调</span>
      isPending = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 执行完成后重置标记</span>
    });
  };
}

<span class="hljs-comment">// 测试：监听滚动事件</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">rafThrottle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动节流执行'</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>);
}));
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li><code>isPending</code> 标记是否有 rAF 回调待执行，避免同一帧内多次触发；</li>
<li>每次触发事件时，若没有待执行任务，就通过 rAF 注册回调；</li>
<li>rAF 会在<strong>下一次渲染前执行回调</strong>，执行完后重置标记，确保每帧只执行一次。</li>
</ol>
<h4 data-id="heading-12">对比传统 setTimeout 节流</h4>
<pre><code class="hljs language-ini" lang="ini">// 传统 setTimeout 节流（对比用）
function timeoutThrottle(callback, <span class="hljs-attr">delay</span> = <span class="hljs-number">16.7</span>) {
  let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
  return function(...args) {
    if (timer) return<span class="hljs-comment">;</span>
    <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
      callback.apply(this, args)<span class="hljs-comment">;</span>
      <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
    }, delay)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<p>rAF 节流的优势：</p>
<ul>
<li><strong>执行时机和浏览器渲染帧完全同步，不会出现「回调执行了但渲染没跟上」的无效操作</strong>；</li>
<li><strong>无需手动设置延迟（如 16.7ms），自动适配浏览器刷新率（60Hz/144Hz 都能兼容）</strong>。</li>
</ul>
<h3 data-id="heading-13">实战代码：rAF 实现防抖</h3>
<p>rAF 实现防抖需要结合「延迟 + 取消 rAF」的逻辑，核心是「触发事件后，只保留最后一次 rAF 回调」。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rafDebounce</span>(<span class="hljs-params">callback</span>) {
  <span class="hljs-keyword">let</span> rafId = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 保存 rAF 的 ID，用于取消</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;
    <span class="hljs-comment">// 若已有待执行的 rAF，先取消</span>
    <span class="hljs-keyword">if</span> (rafId) {
      <span class="hljs-title function_">cancelAnimationFrame</span>(rafId);
    }
    <span class="hljs-comment">// 重新注册 rAF，延迟到下一帧执行</span>
    rafId = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      callback.<span class="hljs-title function_">apply</span>(context, args);
      rafId = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 执行后清空 ID</span>
    });
  };
}

<span class="hljs-comment">// 测试：监听输入框输入</span>
<span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'input'</span>);
input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-title function_">rafDebounce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'输入防抖执行'</span>, e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
}));
</code></pre>
<p><strong>代码解释</strong>：</p>
<ol>
<li>每次触发事件时，先通过 <code>cancelAnimationFrame</code> 取消上一次未执行的 rAF 回调；</li>
<li>重新注册新的 rAF 回调，确保只有「最后一次触发」的回调会执行；</li>
<li>防抖的延迟本质是「一帧的时间（16.7ms）」，若需要更长延迟，可结合 <code>setTimeout</code>。</li>
</ol>
<h4 data-id="heading-14">带自定义延迟的 rAF 防抖</h4>
<pre><code class="hljs language-ini" lang="ini">function rafDebounceWithDelay(callback, <span class="hljs-attr">delay</span> = <span class="hljs-number">300</span>) {
  let <span class="hljs-attr">rafId</span> = null<span class="hljs-comment">;</span>
  let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
  return function(...args) {
    const <span class="hljs-attr">context</span> = this<span class="hljs-comment">;</span>
    // 取消之前的定时器和 rAF
    if (timer) clearTimeout(timer)<span class="hljs-comment">;</span>
    if (rafId) cancelAnimationFrame(rafId)<span class="hljs-comment">;</span>
    
    // 先延迟，再用 rAF 执行（保证渲染前执行）
    <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
      <span class="hljs-attr">rafId</span> = requestAnimationFrame(() =&gt; {
        callback.apply(context, args)<span class="hljs-comment">;</span>
        <span class="hljs-attr">rafId</span> = null<span class="hljs-comment">;</span>
        <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
    }, delay)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-15">四、适用场景 vs 不适用场景</h3>



































<table><thead><tr><th>场景</th><th>是否适合用 rAF 做防抖 / 节流</th><th>原因</th></tr></thead><tbody><tr><td>scroll/resize 事件</td><td>✅ 非常适合</td><td>和 UI 渲染强相关，rAF 保证每帧只执行一次</td></tr><tr><td>mousemove/mouseover 事件</td><td>✅ 适合</td><td>高频触发，rAF 减少无效执行，提升性能</td></tr><tr><td>输入框 input/change 事件</td><td>✅ 适合（防抖）</td><td>保证输入完成后，在渲染前执行回调（如搜索联想）</td></tr><tr><td>网络请求（如按钮点击提交）</td><td>❌ 不适合</td><td>网络请求和 UI 渲染无关，用传统 setTimeout 防抖更合适</td></tr><tr><td>后端数据处理（无 UI 交互）</td><td>❌ 不适合</td><td>rAF 是浏览器 API，Node.js 环境不支持，且无渲染需求</td></tr></tbody></table>
<h3 data-id="heading-16">总结</h3>
<ol>
<li><strong>rAF 适合做防抖 / 节流</strong>，尤其在「和 UI 交互相关的高频事件」（scroll/resize/mousemove）场景下，性能优于传统 setTimeout；</li>
<li><strong>rAF 节流</strong>：核心是「每帧只执行一次」，利用 <code>isPending</code> 标记避免重复执行；</li>
<li><strong>rAF 防抖</strong>：核心是「取消上一次 rAF，保留最后一次」，可结合 setTimeout 实现自定义延迟；</li>
<li>非 UI 相关的防抖 / 节流（如网络请求），优先用传统 setTimeout，避免依赖浏览器渲染机制。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发提效利器 - 用好Snippets]]></title>    <link>https://juejin.cn/post/7581698074361610249</link>    <guid>https://juejin.cn/post/7581698074361610249</guid>    <pubDate>2025-12-09T14:23:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698074361610249" data-draft-id="7581691182003535882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发提效利器 - 用好Snippets"/> <meta itemprop="keywords" content="前端,JavaScript,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-12-09T14:23:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发提效利器 - 用好Snippets
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:23:50.000Z" title="Tue Dec 09 2025 14:23:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><code>snippets</code> 意思是<strong>片段</strong>，在 <code>vscode</code> 中可以通过 <code>Snippets：Configure Snippets</code> 命令，可以定义<code>全局级（global）、项目级（Project）、语言级（Language）</code>代码片段，可以按照自定义的规则来快速生成一段代码，进而大幅提升我们的开发效率，可谓是工作提效利器。</p>
<h2 data-id="heading-1">1、如何创建 snippets？</h2>
<ol>
<li>第一步，在 vscode 按 <code>ctrl/command + shift + p</code>，输入 snippets，选择 <code>Snippets：Configure Snippets</code>，可以看到如下界面。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45813bd7b5e4894bc36283a689f765e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=Qo%2FIsfeXkkAFrp64W3r0DjmhY64%3D" alt="" loading="lazy"/></p>
<p>可根据需要选择 snippets 的创建类型，一般选择 global 全局级别的 snippets 即可。</p>
<ol start="2">
<li>第二步，选择 <code>New Global Snippets file</code>，输入文件名，按 <code>enter</code> 键，即进入 <code>snippets</code> 配置文件设置。</li>
</ol>
<p>snippets 文件以 JSON 编写，里面支持书写注释，并可定义无限数量的 snippets。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"snippet"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"javascript,typescript"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"snippet"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
		<span class="hljs-string">"console.log('$1');"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a simple snippet"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong>prefix</strong>：必填，可以定义一个或多个触发词，由于子字符串匹配不是严格匹配的，类似正则匹配，比如输入 <code>ts</code> 可以匹配到 <code>test</code>。</li>
<li><strong>body</strong>：必填，表示正文，是一行或多行内容，插入时会合并为多行。换行和嵌入的标签页将根据插入摘要的上下文进行格式化。</li>
<li><strong>description</strong>：可选，表示片段的描述。</li>
<li><strong>scope</strong>：可选，表示支持的语言，默认支持所有。</li>
</ul>
<h2 data-id="heading-2">2、snippets 支持语法</h2>
<h3 data-id="heading-3">2.1 光标控制</h3>
<ul>
<li>在 body 正文，它里面可以使用占位符：<code>$0、$1、$2...</code>，代表光标位置，<code>$0</code> 代表光标最后停留的位置，<code>$1</code> 代表光标第一个停留的位置，<code>$2</code> 代表光标第二个停留的位置，以此类推，在使用 <code>prefix</code> 触发词触发词生成代码片段后，可使用 <code>Tab</code> 键跳转到光标位置。</li>
<li>同名光标可以同时使用多个，比如可以使用多个 <code>$1</code>，就可以实现<strong>多光标同时编辑</strong>。</li>
<li>光标也可以加上默认值，比如 <code>${1：element}</code>，默认值为 <code>element</code>，如果触发词触发后，不输入任何内容，则光标位置默认为 <code>element</code>。</li>
<li>光标也可以提供多个值来选择，比如 <code>${1|element1,element2,element3|}</code>，当按 <code>Tab</code> 键移动到对应光标时，会出现下拉框可供选择。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfee01939b7b43a79f3423ce199291c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=R7Qdjzbk7YyVRRQheP8yfSKZ%2Bi8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 Variables 变量</h3>
<p>在 body 正文可以使用变量，语法是 <code>$name</code> 或 <code>${name：default}</code>。其中 <code>default</code> 表示默认值（占位符），当变量未知（即其名称未定义）时，会采用这个默认值。</p>
<p>vscode 中内置一些变量：</p>
<ul>
<li><code>${TM_FILENAME}</code>：当前文件名。</li>
<li><code>${TM_FILENAME_BASE}</code>：当前文件名（不带扩展名）。</li>
<li><code>${TM_DIRECTORY}</code>：当前文件所在目录。</li>
<li><code>${TM_FILEPATH}</code>：当前文件路径。</li>
<li><code>${RELATIVE_FILEPATH}</code>：当前文档的相对（相对于已打开的工作区或文件夹）文件路径。</li>
<li><code>${RELATIVE_FILEPATH}</code>：当前文档的相对（相对于已打开的工作区或文件夹）文件路径。</li>
<li><code>${CLIPBOARD}</code>：剪切板的内容。</li>
<li><code>${TM_SELECTED_TEXT}</code>：当前选择的文本或空字符串。</li>
<li><code>${CURRENT_SECONDS_UNIX}</code>：10位 unix 时间戳。</li>
<li>...等等。</li>
</ul>
<p>更多变量可查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Fediting%2Fuserdefinedsnippets%23_variables" target="_blank" title="https://code.visualstudio.com/docs/editing/userdefinedsnippets#_variables" ref="nofollow noopener noreferrer">vscode snippets 官方文档</a>。</p>
<h3 data-id="heading-5">2.3 Transform 变换</h3>
<p>还支持对变量做正则替换。</p>
<p>举个例子，变量 <code>${TM_FILENAME}</code> 是表示当前文件名，比如当前文件名为 <code>test.js</code>，使用 <code>"${TM_FILENAME/[\\.]/_/}"</code>，表示将文件名中的 <code>.</code> 替换为 <code>_</code>，会把 <code>test.js</code> 变成 <code>test_js</code>。</p>
<p>这个语法怎么理解呢？</p>
<p>拿 js 对比来说，比如当前字符串 s 为 <code>test.js</code>，使用正则替换 <code>s.replace(/(.+)\.js/i, '$1df')</code>，其输出结果为 <code>testdf</code>，而在 vscode 中，如果当前文件名为 <code>test.js</code>，使用 <code>${TM_FILENAME/(.+)\\.js/$1df/i}</code>，也能得到同样的结果。</p>
<p><strong>具体规则差异总结如下</strong>：</p>
<ul>
<li>也就是不用逗号分开，而改为 <code>/</code>。</li>
<li>在以前 <code>\.js</code> 的正则语法中，需要增加一个 <code>\</code> 表示再多转义一次，要不然会报错。</li>
</ul>
<h2 data-id="heading-6">3、多人项目协作时如何实现 snippets 共享？</h2>
<p>之前说过，snippets 可以定义在<strong>全局级、项目级、语言级</strong>，所以，如果多人协作时，可以把 snippets 定义在项目级，这样 vscode 在根目录生成配置配置，目录如下： <code>根目录/.vscode/[snippet名].code-snippets</code>，可以在这个文件提交到 <code>git</code> 仓库中，这样项目成员都可以共享该 <code>snippets</code> 了。</p>
<h2 data-id="heading-7">4、如何在 markdown 文件中使用 vscode snippets?</h2>
<p>默认在 <code>vscode</code> 中，在<code>markdown</code> 文件编写内容是默认不支持 snippets 的，比如我平时写一些 <code>markdown</code> 表格时，会配置一个 <code>markdown</code> 表格的 <code>snippets</code>，但发现在 <code>markdown</code> 文件中输入触发词 <code>prefix</code> 根本无法使用。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"md-table"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"md-table"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
			<span class="hljs-string">"| 列1标题 | 列2标题 | 列3标题 |"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"|---------|---------|---------|"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"| 内容A   | 内容B   | 内容C   |"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-string">"| 内容D   | 内容E   | 内容F   |"</span>
		<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"markdown 表格"</span>
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>后面发现可以手动插入 snippets。在 vscode 按 <code>ctrl/command + shift + p</code>，输入 snippets，选择 <code>Snippets：Insert Snippet</code>，就可以看到所有之前配置好对的 <code>snippets</code> 了，选择对应的 <code>snippet</code> 插入即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad056f39a5e543b0b3666bc72a6634fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=dfiKOIHUCsRPq6fW5PBcp0Z2tNQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">小结</h2>
<ul>
<li>vscode 支持<code>全局级（global）、项目级（Project）、语言级（Language）</code>代码片段，一般个人使用的话为了方便，直接定义<code>全局级</code>即可，需要进行多人协助时，可使用<code>项目级</code> snippets，将生成的配置文件上传到 <code>git</code> 仓库即可。</li>
<li>snippets 支持语法：<strong>光标控制、Variables 变量、Transform 变换</strong>等语法，可按需使用。</li>
<li>markdown 中默认不支持 snippets，但可以通过手动插入 snippets 来使用。</li>
</ul>
<p>最后为了方便，snippets 配置文件的编写可以使用这个工具网站进行生成：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsnippet-generator.app%2F%3Fdescription%3D%26tabtrigger%3D%26snippet%3D%26mode%3Dvscode" target="_blank" title="https://snippet-generator.app/?description=&amp;tabtrigger=&amp;snippet=&amp;mode=vscode" ref="nofollow noopener noreferrer">snippet-generator</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f57013cd7a5845ebaa7061e265696d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895030&amp;x-signature=clLBVG8S7xpt%2F243wzD9G5PtyTk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！]]></title>    <link>https://juejin.cn/post/7581693431740022847</link>    <guid>https://juejin.cn/post/7581693431740022847</guid>    <pubDate>2025-12-09T14:24:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581693431740022847" data-draft-id="7581689310643535914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-09T14:24:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不敢把个人信息喂给 AI？OneAIFW 简单搞定隐私保护！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:24:36.000Z" title="Tue Dec 09 2025 14:24:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近，在做几个落地的 AI 项目，发现“<strong>隐私</strong>”是无法绕开的一个关键挑战。</p>
<p>不是简单的达到“合规”，而是真正的避免客户的手机号、姓名等个人信息上传到云端大模型。</p>
<blockquote>
<p>本文暂不讨论私有部署大模型和端侧模型——它们虽理想，但并非所有场景都适用。</p>
</blockquote>
<p>我也了解了挺多方案，但是感觉都不那么自然或者简单，直到我看到 <code>OneAIFW</code> （一个AI防火墙？）。</p>
<h2 data-id="heading-0">OneAIFW</h2>
<p>连名字都是那么的朴实无华。</p>
<p><code>OneAIFW</code> 开源在 <code>GitHub</code> 上，采用 <code>MIT</code> 协议。</p>
<p>虽然目前 <code>star</code> 还不多，但我感觉前途可期。</p>
<p>它的原理简单概括就是：</p>
<ol>
<li><strong>脱敏</strong>：将发给大模型的文字中的隐私数据替换为为结构化占位符。</li>
<li>大模型接收的数据依然保留原有结构，不影响语义理解。</li>
<li><strong>还原</strong>：将大模型返回的文字中的为结构化占位符替换为原始文字。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50875c0df15b4c728b911a0e5fc628d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=c%2FflggbAYMLHxS4qfz0fsZhPVlI%3D" alt="" loading="lazy"/></p>
<p>是不是很简单，了解原理后我只有一个感觉：<strong>这么简单的思路，我为什么没有想出来。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e4701f02bd74e4cb5eebd9c16019aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=1ShMAnQSRThZ3JpMCTMmqHKsdPs%3D" alt="屏幕录制 2025-12-09 192135.gif" loading="lazy"/></p>
<h3 data-id="heading-1">保护内容</h3>
<p>目前支持脱敏的内容：</p>
<ul>
<li>物理地址</li>
<li>邮箱地址</li>
<li>姓名 / 用户名</li>
<li>公司 / 组织名</li>
<li>电话号码</li>
<li>银行账户 / 卡号</li>
<li>支付信息</li>
<li>验证码</li>
<li>密码</li>
<li>随机种子</li>
<li>私钥</li>
<li>URL 地址</li>
</ul>
<h2 data-id="heading-2">在线体验</h2>
<p>光说不练假把式，不如直接上手试试。</p>
<p>官方提供了一个线上 <code>demo</code>，可以在线体验。</p>
<p>地址：<code>https://oneaifw.com/</code></p>
<p>可以直接分析敏感信息，也可以直接尝试脱敏的效果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07f6aea8fe9440fd84aa22969f7f670f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895075&amp;x-signature=xyNPHdz9Pc6aEPIXKApzYUU%2B5NE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">使用方式</h2>
<p>该项目另一个很赞的点就是，它提供了我们常用的各种方式使用，包括本地 Web、浏览器插件、本地 API、本地命令行。</p>
<h3 data-id="heading-4">本地 Web</h3>
<p>一个轻量前端，依赖 <code>@oneaifw/aifw-js</code> 库，在浏览器里跑完整流程。</p>
<p>适合快速验证或嵌入现有 <code>Web</code> 应用。</p>
<h3 data-id="heading-5">浏览器插件</h3>
<p>提供 <code>Chrome/Edge</code> 扩展示例，可以注入到各类大模型网站，在你点击“发送”前自动脱敏。</p>
<p>这个估计是日常使用最佳的方式了。</p>
<h3 data-id="heading-6">本地 API</h3>
<p>通过 <code>py-origin</code> 或 <code>cli/python</code> 启动一个本地 HTTP 服务，提供 <code>/api/mask_text</code>、<code>/api/restore_text</code>、<code>/api/call</code> 等接口。</p>
<p>如果你和我一样正在开发 AI 项目，可以考虑通过 <code>API</code> 方式接入。</p>
<h3 data-id="heading-7">本地命令行</h3>
<p>装好 Python 包后，支持命令行直接调用，比如：</p>
<pre><code class="hljs language-perl" lang="perl">python -m aifw call <span class="hljs-string">"请把如下文本翻译为中文: My email address is test@example.com, and my phone number is 18744325579."</span>
</code></pre>
<p>非常适合脚本调用或自动化流程。</p>
<h2 data-id="heading-8">结语</h2>
<p>今天主要给大家分享了一个 AI 项目中解决<strong>隐私</strong>问题的产品，重点是设计思路，希望可以帮到大家。</p>
<p>我已经在跑通了 Web 版本，部署体验将在后续更新。</p>
<p>基座模型或许遥不可及，但 AI 时代的真正机会，往往藏在像 <code>OneAIFW</code> 这样的“<strong>小而关键</strong>”的环节里——它不炫技，只是让智能变得更安全、更可用。而这，正是我们每个人都能参与的方向。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件]]></title>    <link>https://juejin.cn/post/7581698635865505818</link>    <guid>https://juejin.cn/post/7581698635865505818</guid>    <pubDate>2025-12-09T14:31:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581698635865505818" data-draft-id="7581698074361643017" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件"/> <meta itemprop="keywords" content="后端,.NET,Visual Studio"/> <meta itemprop="datePublished" content="2025-12-09T14:31:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分享 4 款基于 C# 编写、实用、开源的 Visual Studio 扩展插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:31:29.000Z" title="Tue Dec 09 2025 14:31:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">EFCore.Visualizer</h2>
<p>EFCore.Visualizer 是一款可以直接在 Visual Studio 中查看 EF Core 查询计划调试器可视化工具（帮助开发者分析和优化数据库查询性能），目前，该可视化工具支持 SQL Server、PostgreSQL、SQLite、MySQL 和 Oracle。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGiorgi%2FEFCore.Visualizer" target="_blank" title="https://github.com/Giorgi/EFCore.Visualizer" ref="nofollow noopener noreferrer">github.com/Giorgi/EFCo…</a></li>
</ul>
<p><strong>SQL Server：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e691787d16a948af9e5d7a8ba5230db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=EX9RWOjdSPUmlm34MLpKQC7ivlQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a0fa37859cb4ebeb2228d9183c4936f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=dTAyyB8FKUyhxA9mEei8GJOQCAA%3D" alt="" loading="lazy"/></p>
<p><strong>PostgreSQL：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c864e10f0dd54195a00034b3a0580080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=HWji9kk5CIz6ibWqFxR%2BWn0JV6k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cd6e9076be42bb85881edfcfa06115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=d5d6tB2MtVqdEaEMFmkQt6NlXao%3D" alt="" loading="lazy"/></p>
<p><strong>MySQL：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba82dafcbe44c5f9fa47ac1ee2e770c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=MNldPXCOcpcNmSW7%2F9sFXgDnnN0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3a918d0160243f1b024aae56c1f4958~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=VAr4mvXtTuSrV9rCo9Ln%2BwrJmzI%3D" alt="" loading="lazy"/></p>
<p><strong>SQLite：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df060161a1de45ea96d7641f21b8eae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=LVYFrHftoPIQZ90gXorkuuZwKiI%3D" alt="" loading="lazy"/></p>
<p><strong>Oracle：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e781551b6adc4046a6e33cc848ea20bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=ZRy3dO7dLM9LuE1FpRWqTrsg%2FjE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4041db549b1418ea151ff96e2d358b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=NBqvhT5ds9JJF2U6tp3XQgrKPN0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">EFCorePowerTools</h2>
<p>EF Core Power Tools 是一款基于 C# 编写、开源免费（MIT license）、在 EF Core 命令行工具的基础上构建的适用于 Visual Studio 2022 中的 EF Core 反向工程和模型可视化扩展插件。它提供了反向工程、迁移和模型可视化、生成关系图、生成SQL语句等功能，旨在降低使用 EF Core 的门槛，并通过图形用户界面（GUI）辅助开发者进行数据库的反向工程和DbContext模型的可视化。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FErikEJ%2FEFCorePowerTools" target="_blank" title="https://github.com/ErikEJ/EFCorePowerTools" ref="nofollow noopener noreferrer">github.com/ErikEJ/EFCo…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f767bde05bfb4a018e63a031b75cca84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=qBIHeZ%2B9tMmVxMS5mTEwIlG4OTs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d76878419950449399eff07f3a51fc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=M9HASn8HCNTk39CHw79CGGYMqB8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">AntDeploy</h2>
<p>AntDeploy 是一款由 .NET 开源、实用的 Visual Studio 发布部署插件，支持部署 Docker、IIS、Windows 和 Linux 服务，同时支持 .NET Framework 和 .NET Core，支持回滚和增量部署，在支持 Visual Studio 2019 和 2022 中使用。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyuzd%2FAntDeploy" target="_blank" title="https://github.com/yuzd/AntDeploy" ref="nofollow noopener noreferrer">github.com/yuzd/AntDep…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef13464ed4e6407f92658906d6b21ace~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=QMKzcsOmoFQlbeTB%2FY31QAWdhL0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af8bc977ac27411a8c48387d41d3aa43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=1EUmS8duA55ynRMHlDoaqErQkuk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">FileEncoding</h2>
<p>FileEncoding 是一个专为 Visual Studio 设计的扩展插件，它能够在 Visual Studio 的文本编辑器右下角实时显示当前打开文档的编码格式。这一功能对于快速识别文件的编码非常有帮助，尤其是在处理来自不同平台或团队的代码时。更重要的是，通过简单的点击操作，用户还可以轻松修改文件的编码格式，无需借助外部工具或进行复杂的设置调整。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgenrwoody%2Fvs_file_encoding" target="_blank" title="https://github.com/genrwoody/vs_file_encoding" ref="nofollow noopener noreferrer">github.com/genrwoody/v…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3cdf1686f64422c8a480f4f17c39ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=EnbPlaGqCYDNP0MJPTvZD238VaI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f51f232298ba471b9d36fb101d99fdaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895489&amp;x-signature=Cy5IgElvafg7wD5YSAWY9Hjdl3U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。假如你有更好的推荐，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何设置你的 PWN 环境]]></title>    <link>https://juejin.cn/post/7581728606307008564</link>    <guid>https://juejin.cn/post/7581728606307008564</guid>    <pubDate>2025-12-09T14:36:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581728606307008564" data-draft-id="7581678301217013760" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何设置你的 PWN 环境"/> <meta itemprop="keywords" content="安全"/> <meta itemprop="datePublished" content="2025-12-09T14:36:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCultureBoy"/> <meta itemprop="url" content="https://juejin.cn/user/2664871913355463"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何设置你的 PWN 环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2664871913355463/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCultureBoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:36:17.000Z" title="Tue Dec 09 2025 14:36:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你首先需要的是 <strong>Linux Shell</strong> ，因为大多数 pwn 挑战通常是 <strong>64 位 ELF 可执行文件</strong> 。我会写两个不同的部分，分别针对 Windows 和 MacOS。如果你已经用<strong>过任何 Linux 发行</strong>版，这部分你就没问题了！对于剩下的 Windows/MacOS 用户，我强烈建议安装 <strong>Debian Bookworm</strong> 作为首选发行版，因为它目前使用 <code>glibc 2.36</code>，尚未实现<strong>完整的 RELRO，</strong>  且利用起来稍微容易一些。</p>
<h2 data-id="heading-0">Windows</h2>
<p>对于正在阅读本文的 Windows 用户，你可以按照链接的说明书轻松下载 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fwindows%2Fwsl%2Finstall" target="_blank" title="https://learn.microsoft.com/en-us/windows/wsl/install" ref="nofollow noopener noreferrer">WSL</a></strong>。如果你懒得看，这里有一份你应该执行的命令列表。</p>
<p>安装使用 Debian for WSL</p>
<pre><code class="hljs language-arduino" lang="arduino">wsl.exe --update
wsl --set-<span class="hljs-keyword">default</span>-version <span class="hljs-number">2</span>
wsl install -d Debian
</code></pre>
<p>就是这样！从现在起，你可以通过开始<strong>菜单</strong>中的 <code>Debian 搜索 Debian</code>，或者在命令行中运行 <code>Debian</code>，进入你的 <strong>Debian shell</strong>。关于上述 <strong>WSL 2</strong> 的要求，WSL 2 允许你在 WSL 内部的集成桌面模式下使用 GUI 应用。这其实没什么特别的意义，除了<strong>你可以让你的调试器在一个新窗口里弹出，不用 <code>tmux</code>，这对我来说简直是个大胜利!!</strong></p>
<p>补充一点，你可能需要<strong>更新系统包</strong> ，并下载文本编辑器，以避免在 WSL 终端和其他窗口之间切换。你可以用以下命令完成： <code>sudo apt update &amp;&amp; sudo apt dist-upgrade &amp;&amp; sudo apt(-get) install &lt;editor of choice&gt;</code> 。</p>
<p>如果你想要完全懒散的体验和最少的 Linux shell 作，你可以挂<strong>载你的 Windows 文件系统</strong> ，并在 <strong>Downloads</strong> 目录中使用以下命令（不区分大小写！）： <code>cd /mnt/c/users/your\ name/downloads</code></p>
<h2 data-id="heading-1">macOS</h2>
<p>不幸的是，对于 MacOS 用户来说，我觉得没有像 Windows 用户那样的集成桌面。所以，我建议你按照这个指南作，尽可能多<strong>地在终端里作</strong> ，你会在其中花费比预期更多的时间。好消息是，有 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flima-vm%2Flima" target="_blank" title="https://github.com/lima-vm/lima" ref="nofollow noopener noreferrer">Lima</a></strong>，我们可以用它帮助简化创建 x64 Linux 壳，即使是在 <strong>Apple Silicon</strong> 上。</p>
<p>这里有一份快速入门的推荐清单。</p>
<pre><code class="hljs language-arduino" lang="arduino">brew install lima
limactl start --name=x64-debian <span class="hljs-keyword">template</span>:<span class="hljs-comment">//debian --arch=x86_64</span>
limactl shell x64-debian 
sudo apt install tmux
</code></pre>
<p>你<strong>会</strong>遇到终端颜色的问题，解决方案完全<strong>取决于你的终端模拟器</strong> ，所以你自己找解决方案。</p>
<p>额外加分：可写主机文件系统！</p>
<p><code>LiMactl 编辑 x64-debian</code> 以编辑配置
添加以下不安全的配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">mounts:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">location:</span> <span class="hljs-string">"~"</span>
  <span class="hljs-attr">writable:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>现在你拥有了一个运行在 x64 上的 Linux <strong>Shell</strong> ，可以不受限制地访问你的主机文件系统！
你可以用<code>标签</code>自动补全<strong>你的虚拟机名字</strong>拼写！</p>
<p>恭喜你通过了 Linux 安装！繁琐的部分现在开始了......我们先着手安装调试器和基础工具。</p>
<h3 data-id="heading-2">工具安装</h3>
<hr/>
<p>恭喜你完成了Linux安装！乏味的部分现在开始了...让我们先安装调试器和基本工具。</p>
<h4 data-id="heading-3">实用工具</h4>
<hr/>
<h5 data-id="heading-4">pwntools</h5>
<ol>
<li><code>sudo apt install python3</code> 安装python</li>
<li><code>sudo apt-get install python3-pwntools</code> 安装pwntools</li>
<li><code>pwn checksec /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作</li>
</ol>
<h5 data-id="heading-5">one gadget</h5>
<ol>
<li><code>sudo apt install rubygems</code> 安装gem</li>
<li><code>gem install one_gadget</code> 安装one gadget</li>
<li><code>one_gadget /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作</li>
</ol>
<h5 data-id="heading-6">rop gadget</h5>
<ol>
<li><code>sudo -H python3 -m pip install ROPgadget</code> 安装ROPgadget</li>
<li><code>ROPgadget /lib/x86_64-linux-gnu/libc.so.6</code> 验证它是否工作（警告：输出量很大！！）</li>
</ol>
<h4 data-id="heading-7">调试器</h4>
<hr/>
<p>我<strong>强烈推荐<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbata24%2Fgef" target="_blank" title="https://github.com/bata24/gef" ref="nofollow noopener noreferrer">bata-gef</a></strong>，你也应该使用它！</p>
<p>我不建议盲目运行安装脚本。相反，<strong>克隆仓库</strong>并在你的<code>.gdbinit</code>中source它的<code>gef.py</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~
git <span class="hljs-built_in">clone</span> https://github.com/bata24/gef
vi ~/.gdbinit

<span class="hljs-comment">#.gdbinit</span>
<span class="hljs-built_in">source</span> /path/to/gef.py
</code></pre>
<p>对于没有集成桌面模式的MacOS用户，<strong>使用我们之前安装的tmux</strong>。只需运行以下命令：</p>
<ol>
<li><code>tmux</code> 启动tmux</li>
<li><code>[Ctrl] + B</code> 进入命令模式</li>
<li><code>]</code> 启用滚动</li>
<li><code>[Ctrl] + C</code> 重置状态</li>
<li><code>[Ctrl] + B</code>，然后<code>&lt;arrow&gt;</code> 切换焦点标签页</li>
</ol>
<h4 data-id="heading-8">反编译器/反汇编器</h4>
<hr/>
<p>太好了！现在我们有了开始编写和调试_pwn_脚本所需的一切，这<strong>技术上</strong>就是我们需要的全部，但有时，挑战不提供<strong>源代码</strong>。在这种情况下，需要进行一些<strong>逆向工程工作</strong>。让我们下载**<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fghidra" target="_blank" title="https://github.com/NationalSecurityAgency/ghidra" ref="nofollow noopener noreferrer">Ghidra</a>**。</p>
<p>设置相当简单，你只需要一个<strong>Java运行时</strong>，我推荐<strong>Temurin</strong>，你可以在</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadoptium.net%2Fen-GB%2Ftemurin%2Freleases" target="_blank" title="https://adoptium.net/en-GB/temurin/releases" ref="nofollow noopener noreferrer">这里</a>
找到它。</p>
<p>一旦你安装了运行时，只需运行<code>ghidraRun</code>或<code>ghidraRun.bat</code>来启动<strong>Ghidra</strong>。</p>
<h5 data-id="heading-9">使用Ghidra</h5>
<p>Ghidra实际上相当不错且用户友好，你所要做的就是<strong>创建一个空项目</strong>，然后<strong>拖放</strong>你的挑战二进制文件到其中，并给它一点时间来生成反汇编和反编译！</p>
<h3 data-id="heading-10">容器化和服务器复制</h3>
<hr/>
<p><strong>恭喜</strong>你走到这一步！你已经准备好处理几乎所有pwn挑战了。然而，我们可以做得更好。</p>
<p>有时，善意的挑战作者会提供<strong>libc、ld和/或Dockerfile</strong>。这些文件特别有用，因为它们帮助你确保你的挑战<strong>使用与服务器相同的库</strong>，确保你永远不会遇到_"在我的机器上可以运行"_的问题！所以，我将介绍如何处理这些文件的各种组合。</p>
<h4 data-id="heading-11">给定了Libc、ld和Dockerfile</h4>
<hr/>
<p>这是最好的情况，因为你不需要做太多。这里有一个你可以运行的命令来使用给定的<code>libc</code>和<code>ld</code>：</p>
<p><code>./ld-linux-x86-64.so.2 --library-path . ./chal</code></p>
<p>这将运行<strong>链接器</strong>，并告诉它使用<strong>你目录中的库</strong>来启动挑战。<strong>就这样！</strong> 你现在正在使用给定的库。但是，我们如何复制服务器呢？</p>
<p>首先，我们必须安装<strong>Docker</strong>。过程相当长，但请相信</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Finstall%2Fdebian%2F" target="_blank" title="https://docs.docker.com/engine/install/debian/" ref="nofollow noopener noreferrer">文档</a>
并遵循它。</p>
<p>一旦你安装了<strong>Docker</strong>，你所要做的就是运行以下命令：</p>
<p><code>docker run -p YOUR_PORT:CONTAINER_PORT -d --privileged $(docker build -q .)</code></p>
<p>这将构建容器，然后以<strong>特权</strong>运行它，这通常是_pwn.red/jail_模板所需要的。请将<code>CONTAINER_PORT</code>占位符替换为容器提供挑战的端口，将<code>YOUR_PORT</code>替换为宿主机上的任何未使用端口。默认情况下，这将<strong>绑定到所有接口</strong>。</p>
<p>设置完成后，你可以像这样连接到容器并运行挑战：</p>
<p><code>nc 127.0.0.1 YOUR_PORT</code></p>
<p>就这样！你已经成功复制了服务器使用的库，以及服务器本身！完成后，你应该通过运行<code>docker ps</code>找到容器哈希，然后运行<code>docker stop &lt;hash&gt;</code>来清理正在运行的容器。</p>
<h4 data-id="heading-12">只提供了Dockerfile</h4>
<hr/>
<p>有时，作者只提供<code>Dockerfile</code>。这很糟糕，但没关系，因为我们可以自己提取<code>libc</code>和<code>ld</code>。我们首先使用上述步骤启动容器，然后执行以下操作：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">cp</span> 1a2b:/lib/x86_64-linux-gnu/libc.so.6 ./libc.so.6
docker <span class="hljs-built_in">cp</span> 1a2b:/lib/x86_64-linux-gnu/ld-linux-x86-64 ./ld-linux-x86-64.so.2
</code></pre>
<p>记得将<code>1a2b</code>替换为容器哈希的<strong>前4个字符</strong>，启动时会显示给你。有时，<strong>Dockerfile</strong>会从另一个<strong>Linux发行版</strong>复制文件到一个文件夹来提供服务，以便使用该发行版的<code>libc</code>。在这种情况下，只需在路径前加上前缀。使用一个容器执行<code>COPY --from=debian:bookworm / /srv</code>的例子，我们只需在<code>/lib</code>前加上<code>/srv</code>来从服务器的文件中复制。</p>
<h3 data-id="heading-13">结论</h3>
<hr/>
<p>通过以上所有设置和安装，你应该拥有所有工具，以及开始处理pwn挑战的基本知识。<strong>快乐pwning！</strong> 如果你现在想了解更多关于pwn的一般知识，请阅读我的博客文章</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架]]></title>    <link>https://juejin.cn/post/7581848286387109934</link>    <guid>https://juejin.cn/post/7581848286387109934</guid>    <pubDate>2025-12-09T14:38:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581848286387109934" data-draft-id="7581666412021907465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架"/> <meta itemprop="keywords" content=".NET,AI编程"/> <meta itemprop="datePublished" content="2025-12-09T14:38:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            精选 8 个基于 .NET 开源、功能强大的 AI 和 LLM 相关项目框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:38:25.000Z" title="Tue Dec 09 2025 14:38:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>如今，AI 应用正以前所未有的速度蓬勃发展，在各行各业展现出巨大的潜力与深远的影响力。今天，大姚为大家精心整理了 8 个基于 .NET 开源、功能强大的 AI 与大语言模型（LLM）相关项目框架，希望能为你的开发和探索提供有价值的参考。如果你有更优秀的项目推荐，欢迎通过提交 PR 或在文末留言分享！</p>
<h2 data-id="heading-1">Microsoft Agent Framework</h2>
<p>Microsoft Agent Framework 是一个面向 .NET 和 Python 的开源开发套件，用于构建 AI 智能体及多智能体工作流。它融合并扩展了 Semantic Kernel 与 AutoGen 项目的核心理念，在结合两者优势的基础上，进一步引入了全新能力。该框架由原班团队打造，将成为未来构建 AI 智能体的统一基础平台。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fagent-framework" target="_blank" title="https://github.com/microsoft/agent-framework" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fagent-framework" target="_blank" title="https://learn.microsoft.com/en-us/agent-framework" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/agent…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/721ddf6a94624cbea1e6e6ad9b461d9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=047CxFYAMCM1u2KPvjO%2BOWjYPOg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c76fa44200c47bf8f3058e2c3d3ddef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=lXbg59XTc99O3T3CrZPwFA4QC%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">AutoGen</h2>
<p>AutoGen 是一个开源编程框架，它通过多个代理进行对话以解决任务，从而实现 LLM 应用的开发。AutoGen 代理可定制、可对话，并且能够无缝地允许人类参与。它们可以在不同的模式下运行，使用 LLM、人类输入和工具的组合。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fautogen" target="_blank" title="https://github.com/microsoft/autogen" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Fautogen" target="_blank" title="https://microsoft.github.io/autogen" ref="nofollow noopener noreferrer">microsoft.github.io/autogen</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c4024230364c5bbb7f04fc77d2bdab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=Oz31D7Rdq43UUYm%2F138Wrdn5AdU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/111d34687c5e45dbb94b82bdc36117c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=P9UKOLBSK3hCrXx%2FsI%2B%2FJrOjAU4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">Semantic Kernel</h2>
<p>Semantic Kernel 是一个开源的软件开发工具包（SDK），旨在将大型语言模型（LLM）如OpenAI、Azure OpenAI和Hugging Face与传统的编程语言如C#、Python和Java集成。这个项目通过提供插件系统，允许开发者轻松地创建能够调用这些大型语言模型的应用程序。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fsemantic-kernel" target="_blank" title="https://github.com/microsoft/semantic-kernel" ref="nofollow noopener noreferrer">github.com/microsoft/s…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fsemantic-kernel%2Foverview%2F" target="_blank" title="https://learn.microsoft.com/zh-cn/semantic-kernel/overview/" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/seman…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70d925378e974620b90b390162ffab19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=wisfEKrq5fYlfWcmXMiHilgWbBc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a5141450d9446bda6c70382130da282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=AwAgKzbhoVVGvCF%2Bd9zoxugNmRY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">BotSharp</h2>
<p>BotSharp 是一个面向企业级 LLM 应用的开源 AI 框架，旨在促进智能机器人助手在面向业务系统中的开发和应用。该项目涉及自然语言理解、计算机视觉和音频处理技术，并旨在推动智能机器人助手在企业级系统中的开发和应用。BotSharp 提供了开箱即用的机器学习算法，使普通程序员能够更快、更轻松地开发人工智能应用程序。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSciSharp%2FBotSharp" target="_blank" title="https://github.com/SciSharp/BotSharp" ref="nofollow noopener noreferrer">github.com/SciSharp/Bo…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbotsharp.readthedocs.io%2F" target="_blank" title="https://botsharp.readthedocs.io/" ref="nofollow noopener noreferrer">botsharp.readthedocs.io/</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aed24fa0fec4f81b70f65063130e852~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=iLc3MViotFGHOoWrTL%2BOH4I%2BWBM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06fec7b98514f2cbec883ba54579c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=FGLjJRFkA4hs6XiTP2jK51KWVDE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421b859bb7b14175b556d390b9e8bb2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=QZYFCD02VZG%2BW2mqiZ1%2BzU39g%2Bc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Kernel Memory</h2>
<p>Kernel Memory（KM）是一种多模态AI服务，RAG 架构，使用 LLM 和自然语言索引和查询任何数据、跟踪来源、显示引用、异步内存模式。该存储库提供了特定 AI 和 LLMs 应用场景中内存的最佳实践和参考架构。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fkernel-memory" target="_blank" title="https://github.com/microsoft/kernel-memory" ref="nofollow noopener noreferrer">github.com/microsoft/k…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Fkernel-memory" target="_blank" title="https://microsoft.github.io/kernel-memory" ref="nofollow noopener noreferrer">microsoft.github.io/kernel-memo…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ab00cb6efaa4d0691566a947bf4ae00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=6MEJ27aRjuDBmgf2tuEKikIS7Bw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09b2ba121b6e4c59a1da017996bffcb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=lDCrMcJTs3%2FV8qdMYAts8EGPPVs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">LLamaSharp</h2>
<p>LLamaSharp是一个跨平台库，用于在本地设备上运行LLaMA/LLaVA模型（以及其他模型）。它基于llama.cpp，能够在CPU和GPU上高效进行推理。通过提供高级API和RAG支持，LLamaSharp使得在应用程序中部署大型语言模型（LLM）变得方便。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSciSharp%2FLLamaSharp" target="_blank" title="https://github.com/SciSharp/LLamaSharp" ref="nofollow noopener noreferrer">github.com/SciSharp/LL…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fscisharp.github.io%2FLLamaSharp%2Flatest%2F" target="_blank" title="https://scisharp.github.io/LLamaSharp/latest/" ref="nofollow noopener noreferrer">scisharp.github.io/LLamaSharp/…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04709de314bb44a0a69e08e970b4afed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=7Kcf3n735ZOundSEVDxMlkYDFu0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f89f47c63c5425db079a6986b749351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=tIwQjqhpTcZ%2FF9E9nrZCnCfdRI8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">AntSK</h2>
<p>AntSK 是一个基于 .NET 9 和 Blazor 技术栈构建的企业级AI知识库和智能体平台，集成了 Semantic Kernel 和 Kernel Memory，提供完整的AI应用开发解决方案。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAIDotNet%2FAntSK" target="_blank" title="https://github.com/AIDotNet/AntSK" ref="nofollow noopener noreferrer">github.com/AIDotNet/An…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6940f925ca824af2a238d97c7693c321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=ikRfhxjUUpfoUnlw5MHkJCipRmI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0913b94e5de149cc9ebf6002fe205ab3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=bPUDCXEd7nzAPv3FM6vL3plAGIo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">OllamaSharp</h2>
<p>OllamaSharp 旨在通过提供.NET绑定，使得开发者能够轻松地在.NET应用程序中使用Ollama API。简化了 .NET 与 Ollama 的本地和远程交互。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fawaescher%2FOllamaSharp" target="_blank" title="https://github.com/awaescher/OllamaSharp" ref="nofollow noopener noreferrer">github.com/awaescher/O…</a></li>
<li>在线文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Follama%2Follama%2Fblob%2Fmain%2Fdocs%2Fapi.md" target="_blank" title="https://github.com/ollama/ollama/blob/main/docs/api.md" ref="nofollow noopener noreferrer">github.com/ollama/olla…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef628a92ca64421981c65fd2a6c347e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765895905&amp;x-signature=g91D1OTExi53sH1WyvG2gc8DJro%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。假如你有更好的推荐，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突]]></title>    <link>https://juejin.cn/post/7581688255625707572</link>    <guid>https://juejin.cn/post/7581688255625707572</guid>    <pubDate>2025-12-09T14:58:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581688255625707572" data-draft-id="7581728606307057716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突"/> <meta itemprop="keywords" content="Apache,数据库,后端"/> <meta itemprop="datePublished" content="2025-12-09T14:58:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浙江头部城商行：每日 700 万查询、秒级响应，Apache Doris 查算分离架构破局资源冲突
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T14:58:38.000Z" title="Tue Dec 09 2025 14:58:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当前银行业务全面线上化、实时化的驱动下，浙江省头部城商行亟需构建一个能够同时承载海量数据加工与高并发实时查询的数据平台，以支撑精准营销、实时风控和智能决策等关键业务。</p>
<p>在这一数字化转型进程中，我们最终引入了 Apache Doris 作为湖仓一体架构的核心组件。Doris 凭借其卓越的查询性能、高吞吐、对标准 SQL 的完整支持以及高效的实时数据摄入能力，在多个候选方案中脱颖而出。尤其值得一提的是，其架构的灵活度及可扩展性、极大降低了运维难度和成本投入。<strong>截至目前，我们已顺利完成 200TB+ 历史数据的平滑迁移与落地，为后续的深度应用奠定了坚实基础</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f63bef9fcecb4e38962c8b6f95f1133f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=cZtiLPeCAlQb%2FTrqTNYoX9qHwSo%3D" alt="1-整体架构图.PNG" loading="lazy"/></p>
<p>然而，在实践过程中，“算”（批量数据处理）与“查”（业务实时查询）这两种负载在资源需求与业务目标上的根本性矛盾逐渐凸显，解决这一矛盾已成为当下首要目标。</p>
<h2 data-id="heading-0">核心矛盾：“算”与“查”的资源争抢</h2>
<p>当“计算”和“查询”共用一个 Doris 集群时，资源争抢问题十分突出。例如，批量计算任务会在短时间内会占用大量 CPU、内存和 IO 资源，集群负载骤升，直接影响同时运行的业务查询的稳定性。其根本原因在于：</p>
<ul>
<li><strong>“算”的核心是吞吐量与任务交付</strong>。数仓专注于大规模数据的批量加工（如ETL、数据清洗与聚合计算），需要在有限资源下高效处理TB/PB级数据，确保任务在业务时间窗口内完成。其关键指标是任务成功率与产出时效，而对单个任务的响应时间并不敏感，只要能在业务允许的时间窗口内交付结果，即便耗时数小时亦可接受。</li>
<li><strong>“查”的核心是响应速度与服务可用性</strong>。它直接面向一线业务端（如实时风控、客户画像、经营报表），通常是对数仓加工后的结果数据进行即时查询，对查询响应速度和高可用有着严格要求——业务人员往往需要在秒级甚至毫秒级获取查询结果，且不能出现因集群问题导致的查询中断，否则会直接影响业务正常运转。</li>
</ul>
<h2 data-id="heading-1">解决方案：查算分离架构设计</h2>
<p>正因如此，我们意识到，<strong>要兼顾数据仓库“计算”的效率与业务“查询”的性能，“查算分离”架构是必然之选</strong>。该架构旨在将“计算”和“查询”的负载拆分到不同的集群中，使它们在各自专属的资源环境下运行。这样既能够充分发挥数据仓库的计算能力，又能确保业务查询的响应时间和稳定性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77a0e6418dbc4fcf8f35eb075058a46b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=dQcplujt8sVTy0n6PN6PA3wxORs%3D" alt="2-解决方案：查算分离架构设计.PNG" loading="lazy"/></p>
<p>结合上图所示的存算分离架构，我们通过以下四个方面的设计，系统性地实现了查算分离目标：</p>
<ol>
<li><strong>查询低延迟保障</strong>：
为确保查询的低延迟，在 Doris 中部署了独立的查询集群，实现与计算集群的物理资源隔离，从根本上避免批量任务对线上查询的干扰。</li>
<li><strong>数据实时同步</strong>：
为打通计算与查询集群之间的数据链路，引入<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F112" target="_blank" title="https://www.selectdb.com/blog/112" ref="nofollow noopener noreferrer">跨集群数据复制功能 CCR</a>，实现表级数据的近实时同步。<strong>CCR 基于 Doris Binlog 的增量物理复制机制，可确保数据产出后快速同步至查询集群，且不影响线上查询性能。基于该能力，已成功上线 500 张表、30TB 数据， 在跑批高峰期主从延迟也能控制在 15 分钟内</strong>。</li>
<li><strong>高可用与容灾</strong>：
我们构建了双集群热备体系，日常将 95% 的查询流量导向查询集群，5% 流量分流至计算集群。通过持续的流量压测，确保两集群随时具备故障切换能力。</li>
<li><strong>成本投入控制</strong>：
在保障查询性能的前提下，为控制整体投入，我们在计算集群中创建了与查询集群规格相近的 Workload Group（查询 WG），并设置资源软限制策略，允许 ETL 任务弹性复用其闲置资源。该设计在常态下显著节约资源，尽管极端故障场景下全量切流可能引发短暂性能波动，但发生概率极低，风险整体可控。</li>
</ol>
<h2 data-id="heading-2">优化实践：性能提升百倍、 CPU 消耗仅 10%</h2>
<p>查询性能优化向来就是一个复杂的课题，它与 SQL 语句写法、数据量的大小、建表的设计等多个因素共同影响，难以一蹴而就。在业务从原有系统迁移至新环境时， 我们暂未针对 Doris 进行优化，因此在业务上线初期遭遇性能挑战：集群 QPS 仅维持在 10 左右，而 CPU 消耗却高达 90%。这样的表现显然无法满足业务正常运转的需求。</p>
<p>为此，我们从分区裁剪、记录过滤、并发执行和查询结果获取这四个维度进行全面的优化。优化后，<strong>查询性能相比之前提升百倍</strong>；在相同负载下，<strong>集群 CPU 消耗从 90% 下降到 10% 内</strong>，效果十分显著。在这次优化过程中，积累了不少实用经验，在此分享给大家。</p>
<p><strong>01 拆分查询 SQL 、优化分区裁剪，查询性能提升 6 倍</strong></p>
<p>下方代码块展示了我们最常见的 SQL 模板，其典型特征是根据 <code>etl_job_flag</code> 表中记录的数据产出时间筛选最新的业务数据。由于分区字段 <code>data_dt</code> 的查询条件是一个子查询，导致 Doris 在执行时无法动态裁剪分区，只能扫描所有历史分区，从而产生大量无效 IO。</p>
<p>我们对其进行了优化，首先将查询 SQL 拆分成两条 SQL 语句，先获取数据产出时间，再查询目标数据。其次将分区字段 <code>data_dt</code> 的条件调整为常量，限制其只扫描一个分区。<strong>通过该优化，实现了查询性能 6 倍的提升</strong>。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>  原始 <span class="hljs-keyword">SQL</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> data_dt <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(data_dt) <span class="hljs-keyword">from</span> etl_job_flag wehre etl_table <span class="hljs-operator">=</span><span class="hljs-string">'t'</span>) <span class="hljs-keyword">and</span>  其他过滤条件

<span class="hljs-operator">/</span><span class="hljs-operator">/</span>  优化后 <span class="hljs-keyword">SQL</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(busi_dt) <span class="hljs-keyword">from</span> etl_job_flag <span class="hljs-keyword">where</span>  etl_table <span class="hljs-operator">=</span> <span class="hljs-string">'t'</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t  <span class="hljs-keyword">where</span> data_dt  <span class="hljs-operator">=</span> xxx <span class="hljs-keyword">and</span> 其他过滤条件
</code></pre>
<p><strong>02 合理设计 Key 和索引，查询性能提升 6-7 倍</strong></p>
<p>Doris 的记录过滤遵循“成本从低到高”的顺序，依次为 Key Range 、索引过滤、 ZoneMap 和 BloomFilter 等轻量级过滤，最后执行谓词评估。由此可知，合理设计 Key 和索引是提升筛选效率的关键。在实践中，通过补充合适的 Key 和索引，<strong>查询性能获得 6-7 倍的提升</strong>。</p>
<p>以用户信息表 <code>user_info</code> 为例：</p>
<ul>
<li>将高频查询字段 <code>user_id</code>设为 Unique Key 和分桶字段，以利用 Key Range 快速定位数据范围。</li>
<li>对次高频查询字段 <code>user_name</code>建立倒排索引，提高查询效率。</li>
<li>控制分桶大小在 1G～10G，减少 segment 文件数量，提升倒排索引查询速度（Doris 每个 segment 文件对应独立的倒排索引）。</li>
</ul>
<p><strong>03 参数调试， 查询吞吐率提升 2-3 倍</strong></p>
<p>高并发和低响应时间是查询集群的核心需求，适当调整 Doris 的执行相关参数可有效提升查询吞吐量</p>
<ul>
<li><code>parallel_pipeline_task_num</code>：Pipeline task 是 Doris 执行调度的基本单元，<code>parallel_pipeline_task_num</code> 决定了单个查询的最大并发度。该参数的默认值为 0，即 BE CPU 核心数的一半。</li>
<li><code>num_scanner_threads</code>：Scan 算子负责数据扫描，为 Pipeline task 提供数据。<code>num_scanner_threads</code> 是单个 Scan 算子一次性提交到 Scan 线程池的任务数量，它直接影响查询扫描数据的并发度。该参数默认值也为 0，动态计算。</li>
</ul>
<p>如果将两个参数的默认值设置为高值，可能导致单一查询占用过多资源，进而引发 CPU 缓存污染。根据实际应用经验以及测试结果，建议可将 <code>parallel_pipeline_task_num</code> 设置为 8，将 <code>num_scanner_threads</code> 设置为 2，<strong>查询吞吐率可提升 2 - 3 倍</strong>。此处作为参考，具体数值可根据实际业务情况来调整。</p>
<p><strong>04  开启行存、降低 IO 开销，查询性能提升 30%</strong></p>
<p>在业务中，如果存在大量 <code>SELECT *</code> 的全列查询，Doris 将默认采用按列存储的方式，该方式需要读取所有列并拼接成行返回。而对于字段较多的表，这并不是最佳处理方式，会导致极高的 IO 成本。</p>
<p>因此，我们在建表或修改表时配置 <code>"store_row_column" = "true"</code>，开启行存模式。避免了多列拼接的额外开销，<strong>查询性能提升约 30%</strong>。</p>
<h2 data-id="heading-3">优化利器：慢查询监测 + 性能压测</h2>
<p><strong>01 报表 + Profile，全局观测慢查询</strong></p>
<p>在性能优化中，慢查询监测为我们提供了关键的数据洞察。通过对慢查询的持续追踪与分析，我们能够快速定位根因、实施针对性优化，并最终验证策略的有效性，确保我们的工作始终朝着正确的方向推进。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a29113ce156a4a67894fd9ec71f3d465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765897117&amp;x-signature=XgLjH492%2BSTl%2F9H%2BmDNANoe%2FklA%3D" alt="3-优化利器：慢查询监测 + 性能压测.png" loading="lazy"/></p>
<p>作为监控集群查询状态的核心入口，<strong>查询报表在全局观测中扮演着重要角色</strong>。它基于审计日志（Audit log）及其他系统表构建，包括慢查询榜单、响应时间统计和错误统计等信息。</p>
<p><strong>Doris Profile 能够详细记录查询执行的统计信息</strong>，包括执行计划、每个算子的耗时和数据扫描量等，为定位查询性能问题提供了关键依据。Doris 默认的 Profile 存储机制是保存在内存中，默认保留 500 个；而我们因业务需求，需对 3 天内历史查询问题进行保留，以便问题追溯。因此，<strong>我们基于 Doris Profile 开发了 Profile 归档服务</strong>。</p>
<p><strong>具体工作原理为</strong>：当查询报表识别出慢查询时，Profile 归档服务会自动从 Doris 集群下载对应的 Profile 文件并保存至本地，同时生成专属的 HTTP 链接。管理员在浏览慢查询报表时，只需点击链接，即可直接查看对应的完整 Profile，无需担心因内存中 Profile 被清理而失去关键诊断信息，从而显著提升历史问题追溯的效率。</p>
<p>我们已在集群全局启用 Profile 功能，并将 <code>auto_profile_threshold_ms</code> 设置为 1000ms，这意味着所有执行时长超过 1 秒的查询都会自动记录 Profile，为后续分析提供充分的诊断依据。</p>
<p>查询报表与 Profile 的联动，构建了一套高效的性能优化闭环。一旦集群出现异常，报表会通过内部 IM 自动告警，管理员随即针对慢查询榜单，借助 Profile 进行深度分析、精准定位瓶颈。整个过程形成了从发现问题、精准定位到解决跟踪的完整闭环。</p>
<p><strong>02 查询压测工具，容量评估模拟器</strong></p>
<p>此外，我们基于 Python 开发了查询压测工具，用于上线新业务、扩容集群或优化配置之前，准确评估 Doris 集群的承载能力。</p>
<p>其设计理念是还原真实负载：从 Doris Audit log 中提取历史查询记录，通过多线程随机回放的方式，模拟生产环境中的实际查询压力。在压测过程中，工具会实时统计查询吞吐量、响应时间分布等关键指标。通过这些数据，我们能够评估集群的容量上限，或验证优化措施的有效性，为集群的资源规划与架构调整提供重要依据。</p>
<h2 data-id="heading-4">结束语</h2>
<p>通过以上优化，<strong>Doris 查询集群不仅实现了每日超 700 万次查询的稳定运行，99.95% 的查询响应时间均在 1 秒以内，更在压测中达到了 1500 QPS</strong>，充分验证了其已具备支撑实时查询的高性能与高稳定性，为 Doris 在湖仓一体平台中深度应用中扫清关键障碍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>