<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[基于SimCLR的自监督 YOLO：YOLOv5/8也能在低标注场景目标检测性能飙升]]></title>    <link>https://juejin.cn/post/7573896789366456358</link>    <guid>https://juejin.cn/post/7573896789366456358</guid>    <pubDate>2025-11-19T01:06:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789366456358" data-draft-id="7574204970745282606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于SimCLR的自监督 YOLO：YOLOv5/8也能在低标注场景目标检测性能飙升"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-11-19T01:06:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于SimCLR的自监督 YOLO：YOLOv5/8也能在低标注场景目标检测性能飙升
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:06:16.000Z" title="Wed Nov 19 2025 01:06:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自监督学习的核心思想是：从数据本身自动生成“标签”或“监督信号”，而无需依赖昂贵且耗时的人工标注。</p>
<p>想象一下，你教一个孩子认识“猫”。传统方法（监督学习）是拿出一堆猫的图片，每张都告诉他“这是猫”。而自监督学习的方法是，你把一本关于猫的漫画书撕成碎片，然后让孩子自己把这些碎片拼回去。在拼图的过程中，他自然就学会了猫的爪子、尾巴、胡须应该长什么样，以及这些部分是如何组合在一起的。他虽然没有被直接告知“这是猫”，但他通过完成“拼图”这个任务，内化了对猫的认知。</p>
<p>它就像是让一个学生在参加正式的期末考试（下游任务）之前，先通过做大量的练习题和模拟考试（自监督预训练）来打下坚实的知识基础，而不是直接去死记硬背考试答案。</p>
<p>当前，高性能的目标检测模型往往是“数据饥渴”的，其成功严重依赖于大规模、高质量的人工标注数据集。然而，在众多实际应用场景中，我们面对的往往是“数据荒漠”——标注数据稀缺且获取成本极高。这一矛盾催生了一个关键问题：如何充分利用大量易得的无标注数据，来增强模型在稀缺标签场景下的表现？对比自监督学习（SSL）为这一问题提供了一些思路。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f63f090493485eaa8c6e39abdb493a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=9eMtv5dquXD4g8X60kyzMqgcZFo%3D" alt="图片1.png" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>摘要</strong></h2>
<p>本文首次系统性地将对比自监督学习（SimCLR）应用于 YOLOv5/v8 单阶段检测器的主干网络预训练。通过在无标注 COCO 数据集上进行预训练，并在自行车小数据集上微调，实验表明该方法可稳定提升 mAP@50:95约0.1–0.2 个百分点，同时收敛更快、精确率-召回率更高。这验证了单阶段检测器同样受益于对比自监督学习，为标签稀缺场景下的高效检测提供了新思路。</p>
<h2 data-id="heading-1"><strong>贡献</strong></h2>
<p>作者进行了全面的研究（据作者所知），涵盖了YOLO单阶段目标检测器的自监督预训练，包括YOLOv5和 YOLOv8 。作者开发了一个流程，使用SimCLR在无标签数据上预训练YOLO Backbone 网络，并将它们迁移到检测任务中。</p>
<p>作者证明了SSL预训练的YOLOv5 和YOLOv8 在真实世界的自行车检测任务中始终优于从头开始训练，实现了更高的mAP和更好的精确率/召回率。值得注意的是，作者的SSL预训练YOLOv8的准确率甚至优于随机初始化的YOLOv8，这表明先进的架构仍然受益于无监督初始化。</p>
<p>作者提供了一份最新的讨论，将作者的工作置于现代SSL方法（SimCLR, MoCo , BYOL , MAE , DINO , DINOv2 , DenseCL , DetCon 等）的背景下进行定位，并强调了这些方法如何进一步改进单阶段检测器。</p>
<p>作者包含了对关键SSL方法的关键比较总结，并提出了未来研究方向，例如将 Mask 自编码器与YOLO特定的检测前任务相结合。最终，作者的工作动机是实现更标签高效的目标检测器训练——作者展示了通过利用丰富的 未标注 图像进行预训练，可以减少目标检测中昂贵标注数据的需求。</p>
<h2 data-id="heading-2"><strong>方法</strong></h2>
<p>作者的目标是实现YOLO目标检测器的有效自监督预训练，使得学习到的特征表示能够迁移到有限标注数据的情况下提升检测性能。作者关注两种特定的检测器架构：YOLOv5和YOLOv8。YOLOv5遵循传统的YOLO范式，采用基于 Anchor 点的检测Head，而YOLOv8是一种较新的设计，使用 Anchor-Free 点检测Head及其他架构改进（例如先进的CSPDarknet Backbone 网络和解耦检测层）。通过包含这两种架构，作者涵盖了多种单阶段检测器设计。Self-Supervised-YOLO包含两个主要阶段：（1）使用SimCLR目标在未标注图像上对YOLO Backbone 网络进行自监督预训练，以及（2）在下游自行车检测任务上对预训练模型进行微调。图1展示了这一流程。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77920e13a7c8426cab15de3302df3e0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=H4YBhBawCZK%2FKZEkkzX74OEedqA%3D" alt="图片2.png" loading="lazy"/></p>
<ul>
<li><strong>YOLO主干网络的自监督预训练</strong></li>
</ul>
<p>作者采用SimCLR 框架进行自监督表征学习。SimCLR是一种对比学习方法，通过训练编码器对同一图像的两个增强视图生成相似的嵌入，而对不同图像的视图生成不相似的嵌入。尽管SimCLR最初是在分类网络（例如ResNet）上展示的，但作者通过将YOLO主干网络作为编码器网络，将其应用于YOLO场景：</p>
<p>对于YOLOv5， Backbone 网络是一个CSP-Darknet53卷积网络，通常将其输入到PANet Neck 进行检测。作者移除 Neck 和检测Head，并取 Backbone 网络直至其最后的卷积特征图。然后作者对这些特征图应用全局平均池化，以获得每张图像的单个特征向量。该特征向量被输入到一个小的MLP投影头（两个全连接层），类似于SimCLR，该投影头产生用于对比损失的潜在嵌入。</p>
<p>对于YOLOv8， Backbone 网络是一个基于CSP的更新网络，包含卷积模块和C2f模块。作者同样在任意检测特定层（即输出类别和边框的预测头）之前截断模型。剩余的 Backbone 网络输出多尺度特征图；作者将全局池化和投影MLP附加到最深层的特征图（空间分辨率最小，捕获最High-Level特征）上，以获得用于SimCLR训练的嵌入。</p>
<p>作者在COCO无标签数据集（2017年COCO数据集的无标签分割集，包含约123k张无标注图像）上进行预训练。这一选择提供了大量多样化的图像，并且重要的是，这些图像与标准COCO图像来自同一分布——这对于作者涉及行人/自行车检测的下游任务具有相关性。在预训练过程中，每张图像通过SimCLR增强流程进行两次随机强增强（随机裁剪/缩放、色彩抖动、灰度化、高斯模糊等）。这两个增强视图通过YOLO主干网络投影头生成两个潜在向量和。然后作者计算NT-Xent对比损失，该损失鼓励来自同一图像的和相似（正对），并将其他图像的嵌入视为负对，应相互分离。作者使用较大的批处理大小（例如256），并采用与中相同的余弦学习率调度。对比损失的温控超参数设置为。作者在无标签数据集上进行200个epoch的预训练，这对于COCO规模数据的对比损失收敛是足够的。所有预训练实验均在单个NVIDIA RTX 4060 GPU（8GB显存）上完成。</p>
<p>本阶段的结果是为YOLOv5和YOLOv8预训练的主干网络（在作者的实验中分别独立训练）。作者强调，这种预训练并未使用任何 Token 数据：网络从未见过类别标签或边界框标注。然而，通过对比任务，它学会了编码对图像增强不变且能捕捉语义相似性的有意义的视觉特征。</p>
<ul>
<li><strong>在自行车检测人无伤的微调</strong></li>
</ul>
<p>在自监督预训练之后，我们将学习到的主干网络权重整合到完整的YOLO检测器架构中，并在目标检测任务上进行微调。我们考虑的任务是一个骑车者检测基准测试，该测试涉及在街景中检测骑车者（骑自行车的人）。这是自动驾驶和监控中的一个相关场景，并且这是一个具有挑战性的类别，能够从鲁棒的特征表示中受益（骑车者可能以不同的尺度和姿态出现）。我们使用一个自定义的骑车者检测数据集，该数据集包含交通图像，并带有针对"骑车者"类别的边界框标注。在我们的实验中，该数据集仅包含几千张带标注的图像，使其成为一个低资源场景，在这种场景下预训练尤其应该带来益处。</p>
<p>我们为每个YOLO模型创建两个版本以进行比较：一个使用我们SSL预训练的主干网络，另一个使用随机初始化的主干网络（从头训练）。对于SSL预训练版本，我们将SimCLR的权重加载到主干卷积层中。模型的其余部分（YOLO的颈部和检测头）则使用默认初始化方法（例如，卷积层使用Xavier/Glorot初始化）进行随机初始化。对于从头训练的基线模型，整个模型（主干+颈部+头部）都是随机初始化的。然后，我们在相同的训练设置下，在骑车者检测数据上对两个模型进行微调：</p>
<p>我们使用Ultralytics YOLO训练框架，并为两种情况使用相同的超参数。具体来说，我们训练50个周期，初始学习率为1e-3（在训练后期会逐步降低），使用随机梯度下降优化器，批量大小为16。在训练过程中应用了如马赛克和随机仿射变换等数据增强技术以提高泛化能力。</p>
<p>输入分辨率为640×640像素。我们使用标准的COCO指标在保留的验证集上评估性能：IoU阈值为0.5时的平均精度均值（mAP50）以及更严格的mAP50:95（主要的COCO AP指标）。</p>
<p>对于YOLOv5，我们使用YOLOv5s模型（小型变体）来代表一个轻量级模型。对于YOLOv8，我们使用YOLOv8s（小型变体）以获得可比较的模型大小。这确保了改进效果的公平比较，因为YOLOv8s和YOLOv5s具有相似的容量（参数量都在7-8百万左右）。我们发现使用更大的变体也产生了相似的趋势，但较小的模型已足以证明其效果。</p>
<p>在微调期间，我们不会冻结主干网络；相反，我们允许整个模型进行端到端的训练。这使得预训练的权重能够适应检测任务。在最初几个周期中，我们确实对主干层应用了较低的学习率（基础学习率的0.1倍），以避免破坏预训练特征的稳定性，这是从预训练模型进行微调时的常见做法。经过短暂的热身阶段后，学习率统一，训练正常继续。</p>
<p>在我们的设置中，骑车者类别检测被视为一个单类别物体检测问题（只有一个感兴趣的物体类别）。YOLO为每个预测框输出一个类别概率（针对"骑车者"）。我们评估该类别的精确率、召回率和mAP。由于只存在一个类别，YOLO中的分类损失相对简单（本质上是物体与背景）；尽管如此，学习到的视觉特征的质量仍然极大地影响着模型定位和分类骑车者的能力。</p>
<ul>
<li><strong>评估方案</strong></li>
</ul>
<p>我们比较以下模型：</p>
<p>YOLOv5（从头训练）：在骑车者数据上从随机初始化开始训练的YOLOv5s[18]。</p>
<p>YOLOv5+SSL预训练：主干网络通过SimCLR在COCO无标签数据上进行预训练初始化，然后在骑车者数据上微调的YOLOv5s[18]。</p>
<p>YOLOv8（从头训练）：在骑车者数据上从头训练的YOLOv8s。</p>
<p>YOLOv8+SSL预训练：主干网络权重来自SimCLR预训练，并在骑车者数据上微调的YOLOv8s。</p>
<p>性能在验证集上以mAP50:95（主要指标）以及作为参考的mAP50进行报告。我们还报告了IoU 0.5下的精确率和召回率，以理解误差权衡。记录训练曲线（损失和指标随周期的变化）以分析收敛行为。</p>
<h2 data-id="heading-3"><strong>实验结果</strong></h2>
<ul>
<li><strong>性能提升</strong></li>
</ul>
<p>在自行车检测任务上的详细实验结果：</p>
<p>YOLOv5系列：</p>
<ul>
<li><strong>基线模型（随机初始化）：</strong> mAP@50:95 = 0.7486</li>
<li><strong>SSL预训练模型：</strong> mAP@50:95 = 0.7467，精确率0.9142，召回率0.8376</li>
<li>验证框损失从0.6892降低至0.6715</li>
</ul>
<p>YOLOv8系列：</p>
<ul>
<li><strong>基线模型（随机初始化）：</strong> mAP@50:95 = 0.7652</li>
<li><strong>SSL预训练模型：</strong> mAP@50:95 = 0.7663，精确率0.9080，召回率0.8534</li>
<li>验证框损失从0.6681降低至0.6524</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43851fcb8e344720a6a61342e42c87f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=CE4HR1hlgHolSVzvGdIfgNveO14%3D" alt="图片3.png" loading="lazy"/></p>
<ul>
<li><strong>训练效率分析</strong></li>
</ul>
<p>SSL预训练模型展现出明显的训练优势：</p>
<ul>
<li><strong>收敛速度加快：</strong> 相比基线模型，SSL预训练模型达到相同精度所需的训练时间减少约15%</li>
<li><strong>训练更稳定：</strong> 验证损失曲线更加平滑，波动显著减小</li>
<li><strong>泛化能力更强：</strong> 在困难样本（遮挡、小目标等）上的检测效果提升明显</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/416db4135547440982b872e2b356e1ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=FukW%2B7txzxfHL1bXgfAYgkAMksE%3D" alt="图片5.png" loading="lazy"/></p>
<ul>
<li><strong>架构对比洞察</strong></li>
</ul>
<p>实验发现不同架构从SSL中的受益程度存在差异：</p>
<ul>
<li>YOLOv8在标准和SSL设置下均优于YOLOv5，显示其架构的先进性</li>
<li>YOLOv8从SSL预训练中获益更大，说明其Anchor-Free设计和解耦检测头与SSL特征更加兼容</li>
<li>两种架构都能从SSL预训练中受益，证明方法的普适性</li>
</ul>
<h2 data-id="heading-4"><strong>结论</strong></h2>
<p>本文提出了一种基于SimCLR对比学习框架的YOLOv5和YOLOv8目标检测器自监督预训练策略。Self-Supervised-YOLO使YOLO Backbone 网络能够从大规模无标签数据中学习，为下游检测任务提供强大的初始化，尤其是在标注数据有限的情况下。作者在自行车检测基准数据集上进行了广泛的实验，结果表明，SSL预训练模型在多个评估指标（包括精度、召回率和mAP）上均优于其监督学习对应模型。值得注意的是，这些改进在早期收敛和整体泛化能力上尤为明显，尤其是在数据稀缺的场景中。</p>
<p>作者的结果表明，对比自监督学习即使在像YOLO这样的实时检测架构中也能展现出其有效性，而这些架构传统上是以全监督方式训练的。通过利用 未标注 数据，作者证明了在不牺牲检测性能的前提下，可以显著降低标注负担。</p>
<h2 data-id="heading-5"><strong>实践平台推荐</strong></h2>
<p>想要亲身体验本文提出的自监督YOLO模型？推荐使用Coovally AI平台！Coovally为广大开发者和研究者提供了一个极其便利的AI开发环境：</p>
<ul>
<li><strong>模型自由上传：</strong> 支持直接上传本文开源的SimCLR预训练YOLO模型，快速进行验证和测试</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9727ef8ebad437aa99a925a8dae594b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=oZdBpSHqZDrxGqMzWcGGOO2rS4o%3D" alt="Coovally操作动图.gif" loading="lazy"/></p>
<ul>
<li><strong>便捷开发体验：</strong> 通过集成的VSCode环境，可以轻松对模型代码进行修改和调试，无需配置复杂本地环境</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c69226f6c704ec79aa3d9c565745f61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=5PLKzdzC0Bdzp2Xh14dDVH3oL4o%3D" alt="SSH.GIF" loading="lazy"/></p>
<ul>
<li><strong>一站式训练平台：</strong> 在Coovally平台上即可完成从数据准备到模型训练的全流程，支持分布式训练和自动调参</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b53f04388d794d39993228665af3bee9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=%2BeouJjUf0e%2FDhVuYDKbPFkgLlnY%3D" alt="无代码训练.GIF" loading="lazy"/></p>
<ul>
<li><strong>丰富数据资源：</strong> 平台内置数百类高质量开源数据集，涵盖多个领域，为您的模型训练提供充足的数据支持</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d599fa67a74ad7a1227c2be615e535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119176&amp;x-signature=IX%2BBC%2BhpTE4Md%2FvMi9WVIBuklxo%3D" alt="模型数据集.GIF" loading="lazy"/></p>
<p>无论您是想要复现本文的实验结果，还是基于此方法开展新的研究，Coovally都能为您提供强有力的技术支持。</p>
<p><strong>！！点击下方链接，立即体验Coovally！！</strong></p>
<p><strong>平台链接：</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coovally.com" target="_blank" title="https://www.coovally.com" ref="nofollow noopener noreferrer">www.coovally.com</a></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[麦肯锡联合QuantumBlack最新发布《2025年人工智能的现状：智能体、创新和转型》报告：32% 的企业预计会继续裁员]]></title>    <link>https://juejin.cn/post/7573864324714266676</link>    <guid>https://juejin.cn/post/7573864324714266676</guid>    <pubDate>2025-11-19T01:07:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573864324714266676" data-draft-id="7573892573346381876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="麦肯锡联合QuantumBlack最新发布《2025年人工智能的现状：智能体、创新和转型》报告：32% 的企业预计会继续裁员"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-19T01:07:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青梅主码"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825604222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            麦肯锡联合QuantumBlack最新发布《2025年人工智能的现状：智能体、创新和转型》报告：32% 的企业预计会继续裁员
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825604222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青梅主码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:07:37.000Z" title="Wed Nov 19 2025 01:07:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是<strong>杰哥</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b3df346a9e34b6f8e0d0e5b62314c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=ay4ySFqOcuLFR5vry8h1mCF8zCY%3D" alt="" loading="lazy"/></p>
<p>最近麦肯锡联合 <strong>QuantumBlack</strong> 发布了 2025年最新版《<strong>2025年人工智能的现状：智能体、创新和转型</strong>》（《<strong>The State of AI in 2025：Agents, Innovation, and Transformation</strong>》），这份报告基于全球近 2000 位企业高管和从业者的调研数据，真实反映了当下<strong>AI</strong>在企业的落地情况。简单来说：<strong>几乎所有公司都在用 AI，但大多数还停留在“玩票”阶段</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e513c0a181e41e7b0d1552572982e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=dxwjBgKY5f%2Fjhda3gc5zEzA02fI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">一、AI 使用率创历史新高，但大规模落地仍需时日</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b2c1ef59c2b4bffa6fc9d633e1beaa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=hQ8K8exMNKUcuvxbZrP7yOZVvlA%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>88%</strong> 的受访者表示他们的公司至少在一个业务部门<strong>定期使用AI</strong>（去年是 78%），接近九成！</li>
<li>**生成式AI（Gen AI）**的使用率也从去年的65%~71% 飙升到 <strong>79</strong>%。</li>
<li>但真正实现**全企业级规模化（Scaling）**的只有 <strong>7%</strong>，**31%**还在扩大部署，**30%**刚开始试点，<strong>32</strong>%还在实验阶段。</li>
</ul>
<p>换句话说：<strong>AI</strong> <strong>已经从“高大上”变成“基础设施”，但大多数公司还没把它真正用出生产力</strong>。</p>
<h2 data-id="heading-1">二、AI Agents（智能体）成最大亮点</h2>
<p>报告里最吸睛的数据就是<strong>AI Agents</strong>了——那种能自主规划、执行多步任务的“智能小助手”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4810832c63824cf8a0b4d8c918bab320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=echbESdqdyPptwMv%2FvybGU45swk%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>62%</strong> 的公司已经在实验或试点<strong>AI Agents</strong>。</li>
<li><strong>23%</strong> 的公司已经在某些部门开始规模化部署（Scaling）。</li>
<li>但注意：真正大规模落地的比例在每个具体业务部门都不超过<strong>10</strong>%。</li>
</ul>
<p>目前<strong>AI Agents</strong>最常出现的领域是：</p>
<ul>
<li><strong>IT</strong>（如自动服务台）</li>
<li><strong>知识管理</strong>（深度研究、资料汇总）</li>
<li><strong>软件工程</strong>、<strong>服务运营</strong>等</li>
</ul>
<p>领先行业是：<strong>科技、媒体电信、医疗保健</strong>，这些行业的受访者报告 <strong>AI Agents</strong> 落地比例明显更高。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01b1aff17c1149d082cad143ab2a1444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=4Djf3OfRWZDg7danI5PECCqx4fg%3D" alt="" loading="lazy"/></p>
<p>麦肯锡高级合伙人 <strong>Michael Chui</strong> 一针见血地说：<br/>
“<strong>AI Agents</strong> 确实很火，但真正做好很难。很多人看到的是炒作，我们看到的是大量还在探索阶段的公司。”</p>
<h2 data-id="heading-2">三、AI 正在带来真实价值，但企业级收益仍有限</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/621266fc596045d3a1c1273c0c9f50e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=p8d3jJnb7ikeoWYWooYQPtI7q%2Fs%3D" alt="" loading="lazy"/></p>
<p>好消息是，<strong>AI</strong> 已经开始真金白银地省钱、赚钱：</p>
<ul>
<li>用例层面（单个项目）大多数公司都看到了<strong>成本降低</strong>和<strong>收入提升</strong>。</li>
<li><strong>64%</strong> 的受访者明确表示<strong>AI</strong>正在帮助他们实现创新。</li>
</ul>
<p>但坏消息是：</p>
<ul>
<li>只有<strong>39%</strong> 的公司看到了**企业级EBIT（息税前利润）**的显著改善。</li>
</ul>
<p>为什么？因为<strong>高绩效公司</strong>和普通公司的做法完全不一样。</p>
<h2 data-id="heading-3">四、什么才是真正吃到 <strong>AI</strong> 红利的公司？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88f2ff5a80a4413a8d08428e6cdbd6d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S5qKF5Li756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119257&amp;x-signature=%2B5d9zfsGjLGUWNvUtm3s19k%2BH2A%3D" alt="" loading="lazy"/></p>
<p>报告把公司分成了**高绩效者（AI High Performers）**和普通玩家，差距非常明显：</p>






























<table><thead><tr><th>项目</th><th>高绩效公司</th><th>普通公司</th></tr></thead><tbody><tr><td><strong>AI目标</strong></td><td>80% 把<strong>提效</strong>作为目标，但同时追求<strong>增长+创新</strong></td><td>大多数只盯着降本</td></tr><tr><td><strong>业务转型意愿</strong></td><td><strong>50</strong>% 计划用AI彻底改造业务</td><td>大多只做局部优化</td></tr><tr><td><strong>工作流重设计</strong></td><td>大多数已经在<strong>重新设计工作流程</strong></td><td>很少触及核心流程</td></tr><tr><td><strong>落地阶段</strong></td><td>更多已进入规模化部署</td><td>大多还在试点或实验</td></tr></tbody></table>
<p>一句话总结：<strong>只想着省几个客服、写几篇文案的公司，基本赚不到大钱；把 AI 当成业务重塑工具的公司，才是真正赢家</strong>。</p>
<h4 data-id="heading-4">五、关于裁员的真实声音</h4>
<p>报告里还问了一个敏感问题：明年<strong>AI</strong>会对公司总人数产生什么影响？</p>
<ul>
<li><strong>32%</strong> 的人预计会<strong>减少员工</strong></li>
<li><strong>43%</strong> 预计<strong>基本不变</strong></li>
<li><strong>13%</strong> 预计会<strong>增加员工</strong></li>
</ul>
<p>观点非常分裂，但整体来看，<strong>AI</strong>带来的不是简单“取代”，而是岗位和技能的迁移与升级。</p>
<h2 data-id="heading-5">写在最后</h2>
<p>2025年的 <strong>AI</strong> 格局，用一句话概括就是：</p>
<p><strong>“工具已就位，能力待升级”</strong>。</p>
<p><strong>AI</strong>不再是少数科技公司的玩具，而是几乎所有企业的标配。但从“用AI”到“靠AI赚钱”，中间隔着无数个流程重构、组织变革和人才升级的坎。</p>
<p>麦肯锡的结论其实很清醒：<br/>
<strong>未来三年，决定公司生死的分水岭，可能不是你有没有AI，而是你有没有勇气把AI真正嵌入业务骨子里</strong>。</p>
<p>这份报告值得每一个关注<strong>AI</strong>落地的人认真读一读。真正的<strong>AI</strong>红利，从来不属于最早喊口号的人，而是属于最会执行的人。</p>
<p>关注我，回复 <strong>666</strong>，即可获取这份 AI 行业报告。</p>
<p>AI 技术正以前所未有的速度发展，它将如何塑造我们的未来？让我们拭目以待。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apple更新App审核条款，严打擅自与第三方 AI 共享个人数据的应用]]></title>    <link>https://juejin.cn/post/7573900332637634570</link>    <guid>https://juejin.cn/post/7573900332637634570</guid>    <pubDate>2025-11-19T01:12:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900332637634570" data-draft-id="7572880767584960563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apple更新App审核条款，严打擅自与第三方 AI 共享个人数据的应用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-19T01:12:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apple更新App审核条款，严打擅自与第三方 AI 共享个人数据的应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:12:48.000Z" title="Wed Nov 19 2025 01:12:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">App审核条款变更</h3>
<p>最近iOS开发者该都收到了Apple发来了更新审核条款的邮件，原文内容如下：</p>
<ul>
<li><strong>1.2.1(a):</strong> This new guideline specifies that creator apps must provide a way for users to identify content that exceeds the app’s age rating, and use an age restriction mechanism based on verified or declared age to limit access by underage users.</li>
<li><strong>2.5.10:</strong> This language has been deleted ("Apps should not be submitted with empty ad banners or test advertisements.”).</li>
<li><strong>3.2.2(ix):</strong> Clarified that loan apps may not charge a maximum APR higher than 36%, including costs and fees, and may not require repayment in full in 60 days or less.</li>
<li><strong>4.1(c):</strong> This new guideline specifies that you cannot use another developer's icon, brand, or product name in your app's icon or name, without approval from the developer.</li>
<li><strong>4.7:</strong> Clarifies that HTML5 and JavaScript mini apps and mini games are in scope of the guideline.</li>
<li><strong>4.7.2:</strong> Clarifies that apps offering software not embedded in the binary may not extend or expose native platform APIs or technologies to the software without prior permission from Apple.</li>
<li><strong>4.7.5:</strong> Clarifies that apps offering software not embedded in the binary must provide a way for users to identify content that exceeds the app’s age rating, and use an age restriction mechanism based on verified or declared age to limit access by underage users.</li>
<li><strong>5.1.1(ix):</strong> Adds crypto exchanges to the list of apps that provide services in highly regulated fields.</li>
<li><strong>5.1.2(i):</strong> Clarifies that you must clearly disclose where personal data will be shared with third parties, including with third-party AI, and obtain explicit permission before doing so.</li>
</ul>
<p>翻译过来就是：</p>
<ul>
<li>
<p><strong>1.2.1(a):</strong> 这项新的指南明确规定，创作者应用（creator apps）必须提供一种方式，让用户能够识别<strong>超出应用年龄分级的内容</strong>，并使用基于验证或声明年龄的<strong>年龄限制机制</strong>来限制未成年用户访问这些内容。</p>
</li>
<li>
<p><strong>2.5.10:</strong> 此措辞已被删除（原措辞为：“应用不应提交带有空白广告横幅或测试广告。”）。</p>
</li>
<li>
<p><strong>3.2.2(ix):</strong> 澄清了贷款应用收取的<strong>最高年利率 (Maximum APR)</strong> 不得高于 <strong>36%</strong> （包括所有成本和费用），并且不得要求在 <strong>60 天或更短时间</strong>内全额偿还贷款。</p>
</li>
<li>
<p><strong>4.1(c):</strong> 这项新的指南明确规定，<strong>未经该开发者批准</strong>，您不得在您的应用图标或名称中使用<strong>其他开发者的图标、品牌或产品名称</strong>。</p>
</li>
<li>
<p><strong>4.7:</strong> 澄清了 <strong>HTML5 和 JavaScript 小程序（mini apps）和迷你游戏（mini games）</strong> 属于该指南的管辖范围。</p>
</li>
<li>
<p><strong>4.7.2:</strong> 澄清了提供<strong>未嵌入二进制文件</strong>的软件的应用，<strong>未经 Apple 事先许可</strong>，不得向该软件扩展或暴露原生平台 API 或技术。</p>
</li>
<li>
<p><strong>4.7.5:</strong> 澄清了提供<strong>未嵌入二进制文件</strong>的软件的应用，必须提供一种方式，让用户能够识别<strong>超出应用年龄分级的内容</strong>，并使用基于验证或声明年龄的<strong>年龄限制机制</strong>来限制未成年用户访问这些内容。</p>
</li>
<li>
<p><strong>5.1.1(ix):</strong> 将 <strong>加密货币交易所 (crypto exchanges)</strong> 加入到提供高度监管服务的应用列表。</p>
</li>
<li>
<p><strong>5.1.2(i):</strong> 澄清了您必须<strong>清楚地披露</strong>个人数据将与<strong>第三方</strong>（包括<strong>第三方 AI</strong>）共享的位置，并在共享之前<strong>获得明确的许可</strong>。</p>
</li>
</ul>
<p>值得一提的是，Apple新规首次明确要求，各类应用若要把用户个人数据提供给第三方 AI，必须事先<strong>公开说明并获得用户授权</strong>。</p>
<p>苹果公司目前正着手调整其 App Store 政策，此举被视为对即将到来的 <strong>AI 时代</strong>，尤其是对 2026 年即将发布的<strong>全新、更智能的 Siri</strong> 的战略性准备。</p>
<p>据传闻，下一代 Siri 将具备<strong>更强大的跨应用语音操作能力</strong>，其部分核心技术据悉将由 <strong>Google 的 Gemini 模型</strong>提供支持。</p>
<h3 data-id="heading-1">政策调整背后的考量</h3>
<p>苹果在此时更新开发者指南，主要目标之一是<strong>加强对用户隐私的保护</strong>，特别是要防止应用程序在用户不知情或未经同意的情况下，将个人数据传输给 AI 服务提供商或其他相关公司。</p>
<p>这次政策修改的关键意义不在于引入了全新的数据保护概念，而在于<strong>苹果首次将 AI 相关的企业和技术明确纳入了既有的监管框架</strong>。</p>
<h3 data-id="heading-2">具体变化和影响</h3>
<p>原有的审核规则 <strong>5.1.2 (i)</strong> 已经要求开发者在分享用户数据前必须<strong>透明披露并获得用户许可</strong>，并禁止未经允许地“使用、传输或分享”个人信息。这一规定是苹果为遵守如欧盟 GDPR、加州 CCPA 等全球隐私法规的重要举措，旨在确保用户对个人数据拥有控制权。违规应用将面临被下架的风险。</p>
<p>新版本在这一要求的基础上<strong>加入了更具针对性的明确措辞</strong>：开发者必须清楚说明个人数据会被提供给哪些第三方——<strong>包括第三方 AI</strong>，并且在数据共享操作发生前，必须<strong>获取用户的明确授权</strong>。</p>
<p>这一变化预计将对那些<strong>依赖 AI 技术来收集、处理用户数据</strong>以提供个性化服务或特定功能的应用程序产生影响。然而，由于“AI”是一个广阔的范畴，既包含大型语言模型（LLM），也涵盖各种机器学习技术，目前尚不清楚苹果将以何种程度和力度去执行这一新要求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的 starship 终端配置]]></title>    <link>https://juejin.cn/post/7573952825953484863</link>    <guid>https://juejin.cn/post/7573952825953484863</guid>    <pubDate>2025-11-19T01:12:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573952825953484863" data-draft-id="7568461955015933971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的 starship 终端配置"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-19T01:12:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Legend80s"/> <meta itemprop="url" content="https://juejin.cn/user/2568105753839790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的 starship 终端配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2568105753839790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Legend80s
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:12:46.000Z" title="Wed Nov 19 2025 01:12:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一篇文章《<strong>别再社死了！<code>includeIf</code> 一招搞定 Git 提交者信息错乱，守护你的邮箱隐私</strong>》我们通过巧妙的 git 配置让进入不同目录能自动切换对应的用户名和邮箱，从根源上杜绝了 git 提交作者混乱问题。</p>
<p>今天我们直接让 git 用户名和邮箱在终端显示，更加一目了然，配置效果大概如下：</p>
<pre><code class="hljs language-ts" lang="ts">❯ nextjs-ecommerce on 🌱 master [⇡] via <span class="hljs-title class_">Node</span>.<span class="hljs-property">js</span> v24<span class="hljs-number">.9</span><span class="hljs-number">.0</span> 👨 legend80s 💌 legend80s<span class="hljs-meta">@example</span>.<span class="hljs-property">com</span>
</code></pre>
<p>如果你按照之前的文章配置过 git 自动切换用户名，现在切换到工作目录可以看到用户名邮箱也随着改变并直观展示在终端上。非常 NICE！</p>
<h2 data-id="heading-0">安装 starship</h2>
<p>详见官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarship.rs%2F" target="_blank" title="https://starship.rs/" ref="nofollow noopener noreferrer">starship.rs/</a> 略。</p>
<h2 data-id="heading-1">配置</h2>
<p>完整配置如下：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># ~/.config/starship.toml</span>
<span class="hljs-comment"># https://starship.rs/config/</span>

<span class="hljs-comment"># Get editor completions based on the config schema</span>
<span class="hljs-attr">"$schema"</span> = <span class="hljs-string">'https://starship.rs/config-schema.json'</span>

<span class="hljs-comment"># Inserts a blank line between shell prompts</span>
<span class="hljs-attr">add_newline</span> = <span class="hljs-literal">true</span>

<span class="hljs-section">[git_branch]</span>
<span class="hljs-attr">symbol</span> = <span class="hljs-string">'🌱 '</span>

<span class="hljs-section">[nodejs]</span>
<span class="hljs-attr">format</span> = <span class="hljs-string">'via [Node.js $version](bold green) '</span>

<span class="hljs-section">[custom.git_user]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"echo \"👨 $(git config user.name) 💌 $(git config user.email)\""</span>
<span class="hljs-attr">shell</span> = [<span class="hljs-string">"bash"</span>, <span class="hljs-string">"--noprofile"</span>, <span class="hljs-string">"--norc"</span>]
<span class="hljs-attr">style</span> = <span class="hljs-string">"bold yellow"</span>
<span class="hljs-attr">when</span> = <span class="hljs-string">"git rev-parse --is-inside-work-tree 2&gt;/dev/null"</span>
</code></pre>
<h3 data-id="heading-2">解释</h3>
<ul>
<li><code>"$schema" = 'https://starship.rs/config-schema.json'</code> 是为了让接下来的配置能自动补全。</li>
<li><code>add_newline = true</code> 前后命令行之间增加空行，给予呼吸空间。</li>
<li><code>[git_branch] symbol = '🌱</code> 给分支增加 emoji，可以换成任意你喜欢的 emoji。<em>如果不改必须安装 nerd 字体，否则显示乱码。</em></li>
<li><code>format = 'via [Node.js $version](bold green) '</code> 绿色加粗显示 Node.js 版本号：<strong>Via Node.js v24.x.x</strong>。你可以改成任意代表 Node.js 的 emoji 比如 🟢。<em>如果不改必须安装 nerd 字体，否则显示乱码。</em>
<ul>
<li>简洁配置：<code>format = '[🟢 $version](bold green) '</code>。效果： <code>nextjs-ecommerce on 🌱 master [⇡] 🟢 v24.9.0 </code></li>
</ul>
</li>
</ul>
<p>接下来是配置 git 用户名和邮箱，也是本文的重点。</p>
<h4 data-id="heading-3">显示 git user 和 email</h4>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[custom.git_user]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"echo \"👨 $(git config user.name) 💌 $(git config user.email)\""</span>
<span class="hljs-attr">shell</span> = [<span class="hljs-string">"bash"</span>, <span class="hljs-string">"--noprofile"</span>, <span class="hljs-string">"--norc"</span>]
<span class="hljs-attr">style</span> = <span class="hljs-string">"bold yellow"</span>
<span class="hljs-comment"># format = "[$output]($style) "</span>
<span class="hljs-attr">when</span> = <span class="hljs-string">"git rev-parse --is-inside-work-tree 2&gt;/dev/null"</span>
</code></pre>
<h5 data-id="heading-4">解释</h5>
<p>custom 表示自定义配置</p>
<ul>
<li><code>command</code> 表示 starship 将执行该命令来展示信息。我们配置<code>echo \"👨 $(git config user.name) 💌 $(git config user.email)\"</code>让其显示美观的：<strong><code>👨 username 💌 foo@example.com</code></strong>。</li>
<li><code>shell</code>：采用何种解释器运行 <code>command</code>。指定 bash，<strong>为了兼容性需指定</strong>否则 trae 中将不展示，因为 trae 默认使用 PowerShell。</li>
<li><code>format</code>：starship 固定格式，<code>$output</code> 是 <code>command</code> 的输出，<code>$style</code> 是 <code>style</code> 内容。<em>可不写</em>。</li>
<li><code>style</code>：加粗黄色，因为这个信息比较重要，当然你可以换成其他颜色，比如 red 或 purple，或使用其他样式比如 underline。更多详见参考链接。</li>
<li><code>when = "..."</code>：何时展示，<code>"true"</code> 则始终展示。<code>git rev-parse --is-inside-work-tree 2&gt;/dev/null</code> 只在<strong>Git 仓库目录内（git init 过）</strong> 才显示这个，<code>2&gt;/dev/null</code> 表示忽略报错，报错不输出 true 自然也不展示。</li>
</ul>
<p>最终效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e73303497c345b29e340169d12c0fe5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVnZW5kODBz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119566&amp;x-signature=S%2F%2FF9ATgHGRLdrgUaNjHxShf68Q%3D" alt="image.png" loading="lazy"/></p>
<p>如果大家觉得 Node.js 版本号和用户名之间空白太多，可以使用 <code>\b</code> 回退符。</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+ command = "echo \"\b👨 $(git config user.name) 💌 $(git config user.email)\""</span>
</code></pre>
<p>如果在小屏幕上可改成只显示用户名（要是能自适应就好了，但确实没有找到办法 🤷‍♂️）：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+ command = "echo \"\b👨 $(git config user.name)\""</span>
</code></pre>
<p>对应配置：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># ~/.config/starship.toml</span>
<span class="hljs-comment"># https://starship.rs/config/</span>

<span class="hljs-comment"># Get editor completions based on the config schema</span>
<span class="hljs-attr">"$schema"</span> = <span class="hljs-string">'https://starship.rs/config-schema.json'</span>

<span class="hljs-comment"># Inserts a blank line between shell prompts</span>
<span class="hljs-attr">add_newline</span> = <span class="hljs-literal">true</span>

<span class="hljs-section">[git_branch]</span>
<span class="hljs-attr">symbol</span> = <span class="hljs-string">'🌱 '</span>

<span class="hljs-section">[nodejs]</span>
<span class="hljs-attr">format</span> = <span class="hljs-string">'[🟢 $version](bold green) '</span>

<span class="hljs-section">[custom.git_user]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"echo \"\b👨 $(git config user.name) 💌 $(git config user.email)\""</span>
<span class="hljs-attr">style</span> = <span class="hljs-string">"bold yellow"</span>
<span class="hljs-attr">when</span> = <span class="hljs-string">"git rev-parse --is-inside-work-tree 2&gt;/dev/null"</span>
</code></pre>
<blockquote>
<p>注意修改实时生效无需重启终端，只需终端执行任何命令或者按 Enter 即可。</p>
</blockquote>
<h2 data-id="heading-5">展示 npm registry</h2>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+ [custom.npm]</span>
<span class="hljs-addition">+ command = "registry=$(npm config get registry) &amp;&amp; echo \"${registry#*://}\""</span>
# when package.json exists
<span class="hljs-addition">+ when = "[[ -f package.json ]]"</span>
</code></pre>
<p>这里将 <code>https://registry.npmjs.org</code> 截短为 <code>registry.npmjs.org</code>，好让空间占据变小，当然你可以不截断：<code>command = "npm config get registry"</code>。</p>
<p>其次只有当当前目录存在 package.json <code>[[ -f package.json ]]</code> 即是前端项目才展示，因为其他项目比如 Python 或 Golang 项目我们并不在意当前 npm 的 registry 是什么。如果多文件可用 <code>detect_files = ["package.json"]</code>。</p>
<blockquote>
<p>[!TIPS]
单文件为何推荐 <code>[[ -f package.json ]]</code> 首先 <code>[ -f package.json ]</code> 会唤起外部命令即新进程，性能慢。detect_files 不知其实现。</p>
</blockquote>
<blockquote>
<p><em><code>[</code> 是命令: 文件位置 <code>/usr/bin/[</code>    这个命令很特殊, 结尾只能是 <code>]</code> , 所以感觉像逻辑判断一样</em>。
<em><code>❯ which [</code> 将输出 <strong>[: shell built-in command</strong> 说明它其实就是一个命令。</em></p>
<p><em>英文介绍 <code>[</code>: <code>[ arg... ]</code> Evaluate conditional expression. This is a <strong>synonym for the "test"</strong> builtin, but the last argument <strong>must be a literal ']'</strong>, to match the opening '['.</em></p>
<p><em><code>test</code> 也是命令: <code>/usr/bin/test</code></em></p>
<p><em><code>[[</code> 才是 bash 真正的判断逻辑</em></p>
<p>来自：<strong>[ 和 [[ 和 test 谁更快??</strong> - <a href="https://link.juejin.cn?target=http%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1806703" target="_blank" title="http://cloud.tencent.com/developer/article/1806703" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/a…</a></p>
<p>更多区别：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000022265700%23item-4-3" target="_blank" title="https://segmentfault.com/a/1190000022265700#item-4-3" ref="nofollow noopener noreferrer">segmentfault.com/a/119000002…</a></p>
</blockquote>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfd9fbbe5d304218a357ac66afcec7f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVnZW5kODBz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119566&amp;x-signature=DEO2riU7J3urc%2Fi5FcBAPtyGn%2FE%3D" alt="[ 和 test 速度一样, [[ 略胜一筹" loading="lazy"/></p>
<h4 data-id="heading-6">效果</h4>
<pre><code class="hljs language-sh" lang="sh">nextjs-ecommerce on 🌱 master [!⇡] 🟢 v22.19.0 👨 legend80s registry.npmjs.org took 5s
❯ npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com <span class="hljs-comment"># 切换</span>

nextjs-ecommerce on 🌱 master [!⇡] 🟢 v22.19.0 👨 legend80s registry.npmmirror.com
</code></pre>
<p>可以看到当切换 registry 后相应也发生了变化 🎉！</p>
<p>进入一个非前端项目不展示 registry。</p>
<p><strong>注意 1</strong>：</p>
<pre><code class="hljs language-diff" lang="diff"># 如果超时可加
<span class="hljs-addition">+ command_timeout = 1500</span>
</code></pre>
<p><strong>注意 2</strong>：在 Windows 上如果发现终端enter后较慢建议不展示 npm registry。而采用下述 <code>gituser alias</code> 按需查看。</p>
<h2 data-id="heading-7">gituser alias</h2>
<p>最后再贡献一个 gituser alias 如果大家不喜欢在终端时刻展示自己的用户名邮箱，可以通过该命令迅速查看。</p>
<p><strong>效果如下：</strong></p>
<pre><code class="hljs language-ts" lang="ts"> nextjs-ecommerce on 🌱 master [⇡] 🟢 v24<span class="hljs-number">.9</span><span class="hljs-number">.0</span>  👨 legend80s 💌 liuchzong<span class="hljs-meta">@qq</span>.<span class="hljs-property">com</span> 
❯ gituser

┌────────────────┬────────────────────────────────┐
│ 👨 legend80s   │ 💌 liuchzong<span class="hljs-meta">@qq</span>.<span class="hljs-property">com</span>           │
└────────────────┴────────────────────────────────┘
</code></pre>
<p>在 <strong>~/.zshrc</strong> 文件中增加以下 function 和 alias（function 也是一种 alias 可全局调用）：</p>
<pre><code class="hljs language-sh" lang="sh">// ~/.zshrc

<span class="hljs-keyword">function</span> git-<span class="hljs-function"><span class="hljs-title">user</span></span>() {
  <span class="hljs-built_in">echo</span>
  <span class="hljs-built_in">echo</span> ┌────────────────┬────────────────────────────────┐
  <span class="hljs-built_in">echo</span> │ <span class="hljs-string">"👨 <span class="hljs-subst">$(git config user.name)</span>   │ 💌 <span class="hljs-subst">$(git config user.email)</span>            │"</span>
  <span class="hljs-built_in">echo</span> └────────────────┴────────────────────────────────┘
  <span class="hljs-built_in">echo</span>
}
<span class="hljs-built_in">alias</span> gituser=<span class="hljs-string">"git-user"</span>
<span class="hljs-built_in">alias</span> current-git=<span class="hljs-string">"git-user"</span>
</code></pre>
<h2 data-id="heading-8">参考链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fstarship.rs%2Fadvanced-config%2F%23style-strings" target="_blank" title="https://starship.rs/advanced-config/#style-strings" ref="nofollow noopener noreferrer">starship.rs/advanced-co…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[专为 LLM 设计的数据格式 TOON，可节省 60% Token]]></title>    <link>https://juejin.cn/post/7574204970745397294</link>    <guid>https://juejin.cn/post/7574204970745397294</guid>    <pubDate>2025-11-19T01:13:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574204970745397294" data-draft-id="7472577976657264692" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="专为 LLM 设计的数据格式 TOON，可节省 60% Token "/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-19T01:13:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            专为 LLM 设计的数据格式 TOON，可节省 60% Token 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:13:17.000Z" title="Wed Nov 19 2025 01:13:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>最近在使用 NestJs 和 NextJs 在做一个协同文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>，如果感兴趣，欢迎 star，有任何疑问，欢迎加我微信进行咨询 <code>yunmz777</code></p>
<p>随着社交媒体的深度渗透，朋友圈、微博、Instagram 等平台已成为用户展示生活、分享瞬间的核心场景。其中，"九宫格"排版形式凭借其规整的视觉美感和内容叙事性，成为年轻用户（尤其是女性群体）高频使用的图片发布方式。</p>
<p>在接下来的内容中，我们将使用 NextJs 结合 sharp 来实现图片裁剪的功能。</p>
<h2 data-id="heading-0">编写基本页面</h2>
<p>首先我们将编写一个图片裁剪的功能，以支持用户来生成不同规格的图片，例如 3x3、2x2 等格式。</p>
<p>如下代码所示：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">"use client"</span>;

<span class="hljs-keyword">import</span> { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [rows, setRows] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">3</span>);
  <span class="hljs-keyword">const</span> [columns, setColumns] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">3</span>);
  <span class="hljs-keyword">const</span> [image, setImage] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [splitImages, setSplitImages] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [isProcessing, setIsProcessing] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [imageLoaded, setImageLoaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> imageRef = useRef&lt;<span class="hljs-title class_">HTMLImageElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> fileInputRef = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileUpload</span> = (<span class="hljs-params">file: File</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"image/"</span>)) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"请上传图片文件"</span>);

      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 先重置状态</span>
    <span class="hljs-title function_">setImage</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setSplitImages</span>([]);
    <span class="hljs-title function_">setImageLoaded</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();

    reader.<span class="hljs-property">onload</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>?.<span class="hljs-property">result</span>) {
        <span class="hljs-title function_">setImage</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      }
    };

    reader.<span class="hljs-title function_">readAsDataURL</span>(file);
  };

  <span class="hljs-comment">// 修改图片加载完成的处理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleImageLoad</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Image loaded"</span>); <span class="hljs-comment">// 添加日志以便调试</span>
    <span class="hljs-title function_">setImageLoaded</span>(<span class="hljs-literal">true</span>);
  };

  <span class="hljs-comment">// 渲染切割辅助线</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderGuideLines</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image || !imageRef.<span class="hljs-property">current</span> || !imageLoaded) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> commonLineStyles = <span class="hljs-string">"bg-blue-500/50 absolute pointer-events-none"</span>;
    <span class="hljs-keyword">const</span> imgRect = imageRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> containerRect =
      imageRef.<span class="hljs-property">current</span>.<span class="hljs-property">parentElement</span>?.<span class="hljs-title function_">getBoundingClientRect</span>();

    <span class="hljs-keyword">if</span> (!containerRect) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> imgStyle = {
      <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.left - containerRect.left}</span>px`</span>,
      <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.top - containerRect.top}</span>px`</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.width}</span>px`</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.height}</span>px`</span>,
    };

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute pointer-events-none"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{imgStyle}</span>&gt;</span>
        {/* 垂直线 */}
        {Array.from({ length: Math.max(0, columns - 1) }).map((_, i) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">v-</span>${<span class="hljs-attr">i</span>}`}
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">commonLineStyles</span>} <span class="hljs-attr">top-0</span> <span class="hljs-attr">bottom-0</span> <span class="hljs-attr">w-</span>[<span class="hljs-attr">1px</span>] <span class="hljs-attr">md:w-</span>[<span class="hljs-attr">2px</span>] <span class="hljs-attr">backdrop-blur-sm</span>`}
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">left:</span> `${((<span class="hljs-attr">i</span> + <span class="hljs-attr">1</span>) * <span class="hljs-attr">100</span>) / <span class="hljs-attr">columns</span>}%`,
              <span class="hljs-attr">transform:</span> "<span class="hljs-attr">translateX</span>(<span class="hljs-attr">-50</span>%)",
            }}
          /&gt;</span>
        ))}
        {/* 水平线 */}
        {Array.from({ length: Math.max(0, rows - 1) }).map((_, i) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">h-</span>${<span class="hljs-attr">i</span>}`}
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">commonLineStyles</span>} <span class="hljs-attr">left-0</span> <span class="hljs-attr">right-0</span> <span class="hljs-attr">h-</span>[<span class="hljs-attr">1px</span>] <span class="hljs-attr">md:h-</span>[<span class="hljs-attr">2px</span>] <span class="hljs-attr">backdrop-blur-sm</span>`}
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">top:</span> `${((<span class="hljs-attr">i</span> + <span class="hljs-attr">1</span>) * <span class="hljs-attr">100</span>) / <span class="hljs-attr">rows</span>}%`,
              <span class="hljs-attr">transform:</span> "<span class="hljs-attr">translateY</span>(<span class="hljs-attr">-50</span>%)",
            }}
          /&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  };

  <span class="hljs-comment">// 处理图片切割</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSplitImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image) <span class="hljs-keyword">return</span>;

    <span class="hljs-title function_">setIsProcessing</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(image);
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
      <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>([blob], <span class="hljs-string">"image.jpg"</span>, { <span class="hljs-attr">type</span>: blob.<span class="hljs-property">type</span> });

      <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"image"</span>, file);
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"rows"</span>, rows.<span class="hljs-title function_">toString</span>());
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"columns"</span>, columns.<span class="hljs-title function_">toString</span>());

      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/split-image"</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
        <span class="hljs-attr">body</span>: formData,
      });

      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();

      <span class="hljs-keyword">if</span> (data.<span class="hljs-property">error</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span>);
      }

      <span class="hljs-title function_">setSplitImages</span>(data.<span class="hljs-property">pieces</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to split image:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"图片切割失败，请重试"</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsProcessing</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 添加下载单个图片的函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDownloadSingle</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">imageUrl: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(imageUrl);
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      link.<span class="hljs-property">href</span> = url;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">`piece_<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>.png`</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
      link.<span class="hljs-title function_">click</span>();
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"下载失败:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"下载失败，请重试"</span>);
    }
  };

  <span class="hljs-comment">// 添加打包下载所有图片的函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDownloadAll</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 如果没有 JSZip，需要先动态导入</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">JSZip</span> = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"jszip"</span>)).<span class="hljs-property">default</span>;
      <span class="hljs-keyword">const</span> zip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSZip</span>();

      <span class="hljs-comment">// 添加所有图片到 zip</span>
      <span class="hljs-keyword">const</span> promises = splitImages.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (imageUrl, index) =&gt; {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(imageUrl);
        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
        zip.<span class="hljs-title function_">file</span>(<span class="hljs-string">`piece_<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>.png`</span>, blob);
      });

      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);

      <span class="hljs-comment">// 生成并下载 zip 文件</span>
      <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> zip.<span class="hljs-title function_">generateAsync</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">"blob"</span> });
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(content);
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      link.<span class="hljs-property">href</span> = url;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">"split_images.zip"</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
      link.<span class="hljs-title function_">click</span>();
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"打包下载失败:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"打包下载失败，请重试"</span>);
    }
  };

  <span class="hljs-comment">// 修改预览区域的渲染函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderPreview</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>切割后的图片预览<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }

    <span class="hljs-keyword">if</span> (isProcessing) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>正在处理中...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }

    <span class="hljs-keyword">if</span> (splitImages.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative w-full h-full flex items-center justify-center"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-[3px] bg-[#242c3e]"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">gridTemplateColumns:</span> `<span class="hljs-attr">repeat</span>(${<span class="hljs-attr">columns</span>}, <span class="hljs-attr">1fr</span>)`,
              <span class="hljs-attr">gridTemplateRows:</span> `<span class="hljs-attr">repeat</span>(${<span class="hljs-attr">rows</span>}, <span class="hljs-attr">1fr</span>)`,
              <span class="hljs-attr">width:</span> <span class="hljs-attr">imageRef.current</span>?<span class="hljs-attr">.width</span> || "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">height:</span> <span class="hljs-attr">imageRef.current</span>?<span class="hljs-attr">.height</span> || "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">maxWidth:</span> "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">maxHeight:</span> "<span class="hljs-attr">100</span>%",
            }}
          &gt;</span>
            {splitImages.map((src, index) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative group"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                  <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span>
                  <span class="hljs-attr">alt</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">切片</span> ${<span class="hljs-attr">index</span> + <span class="hljs-attr">1</span>}`}
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full h-full object-cover"</span>
                /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleDownloadSingle(src, index)}
                  className="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity"
                &gt;
                  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"w-6 h-6 text-white"</span>
                    <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                    <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                  &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                      <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span>
                      <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"</span>
                    /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      );
    }

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>点击切割按钮开始处理<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"fixed inset-0 bg-[#0B1120] -z-10"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen w-full py-16 md:py-20"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mx-auto px-4 sm:px-6 max-w-7xl"</span>&gt;</span>
          {/* 标题区域 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center mb-12 md:mb-16"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl md:text-4xl lg:text-5xl font-bold mb-4 animate-fade-in"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-transparent bg-clip-text bg-[size:400%] animate-gradient"</span>&gt;</span>
                图片切割工具
              <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 text-base md:text-lg max-w-2xl mx-auto animate-fade-in-up"</span>&gt;</span>
              上传一张图片，快速将其切割成网格布局，支持自定义行列数。
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 图片区域 - 调整高度和响应式布局 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 mb-12 md:mb-16"</span>&gt;</span>
            {/* 上传区域 - 调整高度 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative h-[400px] md:h-[500px] lg:h-[600px] bg-[#1a2234] rounded-xl overflow-hidden"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                <span class="hljs-attr">ref</span>=<span class="hljs-string">{fileInputRef}</span>
                <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span>
                <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"hidden"</span>
                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
                  const file = e.target.files?.[0];
                  if (file) handleFileUpload(file);
                }}
                id="imageUpload"
              /&gt;
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span>
                <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"imageUpload"</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute inset-0 flex flex-col items-center justify-center cursor-pointer"</span>
              &gt;</span>
                {image ? (
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative w-full h-full flex items-center justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                      <span class="hljs-attr">ref</span>=<span class="hljs-string">{imageRef}</span>
                      <span class="hljs-attr">src</span>=<span class="hljs-string">{image}</span>
                      <span class="hljs-attr">alt</span>=<span class="hljs-string">"上传的图片"</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-full max-h-full object-contain"</span>
                      <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{handleImageLoad}</span>
                      <span class="hljs-attr">key</span>=<span class="hljs-string">{image}</span>
                    /&gt;</span>
                    {renderGuideLines()}
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                ) : (
                  <span class="hljs-tag">&lt;&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 rounded-full bg-[#242c3e] mb-4"</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                        <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 text-gray-400"</span>
                        <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                        <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                        <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                      &gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                          <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                          <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                          <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{1.5}</span>
                          <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"</span>
                        /&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>点击或拖拽图片到这里上传<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                  <span class="hljs-tag">&lt;/&gt;</span>
                )}
              <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 预览区域 - 调整高度 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-[400px] md:h-[500px] lg:h-[600px] bg-[#1a2234] rounded-xl flex items-center justify-center"</span>&gt;</span>
              {renderPreview()}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 控制器 - 添加上下边距的容器 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"py-4 md:py-6"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row items-center justify-center gap-4 md:gap-6"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-[#1a2234] rounded-xl px-5 py-2.5 flex items-center gap-4 border border-[#242c3e] w-full sm:w-auto"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 font-medium min-w-[40px]"</span>&gt;</span>
                    行数
                  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center gap-2 bg-[#242c3e] rounded-lg p-1 flex-1 sm:flex-none justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setRows(Math.max(1, rows - 1))}
                    &gt;
                      -
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-white min-w-[32px] text-center font-medium"</span>&gt;</span>
                      {rows}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setRows(rows + 1)}
                    &gt;
                      +
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-[#1a2234] rounded-xl px-5 py-2.5 flex items-center gap-4 border border-[#242c3e] w-full sm:w-auto"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 font-medium min-w-[40px]"</span>&gt;</span>
                    列数
                  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center gap-2 bg-[#242c3e] rounded-lg p-1 flex-1 sm:flex-none justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setColumns(Math.max(1, columns - 1))}
                    &gt;
                      -
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-white min-w-[32px] text-center font-medium"</span>&gt;</span>
                      {columns}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setColumns(columns + 1)}
                    &gt;
                      +
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-5 py-2.5 bg-[#1a2234] text-gray-400 rounded-xl hover:bg-[#242c3e] hover:text-white transition-all font-medium border border-[#242c3e] w-full sm:w-auto"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                    setRows(3);
                    setColumns(3);
                  }}
                &gt;
                  重置
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row gap-4 w-full sm:w-auto"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-medium shadow-lg shadow-blue-500/20 w-full sm:w-auto"</span>
                  <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!image</span> || <span class="hljs-attr">isProcessing</span>}
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSplitImage}</span>
                &gt;</span>
                  {isProcessing ? "处理中..." : "切割图片"}
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-lg shadow-red-500/20 w-full sm:w-auto"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                    setImage(null);
                    setSplitImages([]);
                    setImageLoaded(false);

                    if (fileInputRef.current) {
                      fileInputRef.current.value = "";
                    }
                  }}
                  disabled={!image}
                &gt;
                  清除
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

              {/* 下载按钮 */}
              {splitImages.length &gt; 0 &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleDownloadAll}</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all font-medium shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 w-full sm:w-auto"</span>
                &gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"w-5 h-5"</span>
                    <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                    <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                  &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                      <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span>
                      <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"</span>
                    /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                  打包下载
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 底部留白 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-16 md:h-20"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Home</span>;
</code></pre>
<p>在上面的代码中，当用户上传图片兵当图片加载完成之后，renderGuideLines 方法会绘制图片的切割网格，显示垂直和水平的分隔线，便于用户预览切割后的效果。</p>
<p>它会根据用户设置的行数（rows）和列数（columns），这些切割线将被动态渲染。用户设置完行列数后，点击 "切割图片" 按钮，会触发 handleSplitImage 函数，将图片传递到后端进行切割。图片会被发送到后端接口 /api/split-image，并返回切割后的图片数据（即每个小图的 URL）。</p>
<p>最终 ui 效果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c7e71c2cdbb40eabf5f6a78eff72a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119596&amp;x-signature=ubudRkRxtENlOB7m7lF7eRv%2FeeA%3D" alt="20250218163115" loading="lazy"/></p>
<h2 data-id="heading-1">设计 API</h2>
<p>前面的内容中，我们已经编写了前端的 ui，接下来我们要设计我们的 api 接口以支持前端页面调用。</p>
<p>首先我们要先知道一个概念，sharp 是一个高性能的 Node.js 图像处理库，支持各种常见的图像操作，如裁剪、调整大小、旋转、转换格式等。它基于 libvips（一个高效的图像处理库），与其他一些图像处理库相比，它的处理速度更快，内存消耗也更低。</p>
<p>而 Next.js 是一个服务器端渲染（SSR）的框架，可以通过 API 路由来处理用户上传的文件。在 API 路由中使用 sharp 可以确保图像在服务器端得到处理，而不是在客户端进行，这样可以减轻客户端的负担，并且保证图像在服务器上处理完成后再发送到客户端，从而提高页面加载速度。</p>
<p>如下代码所示：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> sharp <span class="hljs-keyword">from</span> <span class="hljs-string">"sharp"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">formData</span>();
    <span class="hljs-keyword">const</span> file = data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"image"</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">File</span>;
    <span class="hljs-keyword">const</span> rows = <span class="hljs-title class_">Number</span>(data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"rows"</span>));
    <span class="hljs-keyword">const</span> columns = <span class="hljs-title class_">Number</span>(data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"columns"</span>));

    <span class="hljs-keyword">if</span> (!file || !rows || !columns) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Missing required parameters"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"image/"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid file type"</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> });
    }

    <span class="hljs-keyword">const</span> buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>());

    <span class="hljs-keyword">if</span> (!buffer || buffer.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid image buffer"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">const</span> image = <span class="hljs-title function_">sharp</span>(buffer);
    <span class="hljs-keyword">const</span> metadata = <span class="hljs-keyword">await</span> image.<span class="hljs-title function_">metadata</span>();

    <span class="hljs-keyword">if</span> (!metadata.<span class="hljs-property">width</span> || !metadata.<span class="hljs-property">height</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid image metadata"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Processing image:"</span>, {
      <span class="hljs-attr">width</span>: metadata.<span class="hljs-property">width</span>,
      <span class="hljs-attr">height</span>: metadata.<span class="hljs-property">height</span>,
      <span class="hljs-attr">format</span>: metadata.<span class="hljs-property">format</span>,
      rows,
      columns,
    });

    <span class="hljs-keyword">const</span> <span class="hljs-attr">pieces</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">const</span> width = metadata.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">const</span> height = metadata.<span class="hljs-property">height</span>;
    <span class="hljs-keyword">const</span> pieceWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(width / columns);
    <span class="hljs-keyword">const</span> pieceHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(height / rows);

    <span class="hljs-keyword">if</span> (pieceWidth &lt;= <span class="hljs-number">0</span> || pieceHeight &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid piece dimensions"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; columns; j++) {
        <span class="hljs-keyword">const</span> left = j * pieceWidth;
        <span class="hljs-keyword">const</span> top = i * pieceHeight;
        <span class="hljs-keyword">const</span> currentWidth = j === columns - <span class="hljs-number">1</span> ? width - left : pieceWidth;
        <span class="hljs-keyword">const</span> currentHeight = i === rows - <span class="hljs-number">1</span> ? height - top : pieceHeight;

        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> piece = <span class="hljs-keyword">await</span> image
            .<span class="hljs-title function_">clone</span>()
            .<span class="hljs-title function_">extract</span>({
              left,
              top,
              <span class="hljs-attr">width</span>: currentWidth,
              <span class="hljs-attr">height</span>: currentHeight,
            })
            .<span class="hljs-title function_">toBuffer</span>();

          pieces.<span class="hljs-title function_">push</span>(
            <span class="hljs-string">`data:image/<span class="hljs-subst">${metadata.format}</span>;base64,<span class="hljs-subst">${piece.toString(<span class="hljs-string">"base64"</span>)}</span>`</span>
          );
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error processing piece:"</span>, { i, j, err });
          <span class="hljs-keyword">throw</span> err;
        }
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>({ pieces });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error processing image:"</span>, error);

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
      {
        <span class="hljs-attr">error</span>: <span class="hljs-string">"Failed to process image"</span>,
        <span class="hljs-attr">details</span>: error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"Unknown error"</span>,
      },
      { <span class="hljs-attr">status</span>: <span class="hljs-number">500</span> }
    );
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">api</span>: {
    <span class="hljs-attr">bodyParser</span>: {
      <span class="hljs-attr">sizeLimit</span>: <span class="hljs-string">"10mb"</span>,
    },
  },
};
</code></pre>
<p>在上面的这些代码中，它的具体流程如下：</p>
<ol>
<li>
<p>接收请求：首先通过 POST 方法接收包含图片和切割参数（行数和列数）的表单数据。request.formData() 用来解析表单数据并提取文件和参数。</p>
</li>
<li>
<p>参数验证：检查文件类型是否为图片，确保上传数据完整且有效。如果缺少必需的参数或上传的不是图片，返回相应的错误信息。</p>
</li>
<li>
<p>图片处理：通过 sharp 库将图片数据转换为可操作的 Buffer，然后获取图片的元数据（如宽度、高度、格式）。如果图片的元数据无效或获取不到，返回错误。</p>
</li>
<li>
<p>计算切割尺寸：根据用户输入的行数和列数计算每个小块的宽高，并检查计算出来的尺寸是否有效。如果计算出的尺寸不合适，返回错误。</p>
</li>
<li>
<p>图片切割：使用 sharp 的 extract 方法对图片进行切割。每次提取一个小块后，将其转换为 base64 编码的字符串，并保存到 pieces 数组中。</p>
</li>
<li>
<p>返回结果：成功处理后，将切割后的图片数据作为 JSON 响应返回，每个图片切块以 base64 编码形式存储。若遇到错误，捕获并返回详细的错误信息。</p>
</li>
<li>
<p>配置：通过 config 配置，设置请求体的最大大小限制为 10MB，防止上传过大的文件导致请求失败。</p>
</li>
</ol>
<p>这里的代码完成之后，我们还要设计一下 next.config.mjs 文件，如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">import('next').NextConfig</span>} */</span>
<span class="hljs-keyword">const</span> nextConfig = {
  <span class="hljs-attr">webpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">externals</span> = [...config.<span class="hljs-property">externals</span>, <span class="hljs-string">"sharp"</span>];
    <span class="hljs-keyword">return</span> config;
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<p>当我们点击切割图片的时候，最终生成的效果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f458680138c47b3b0c19f6b94d7fe28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119596&amp;x-signature=%2BEN6DjJ1SkO8XELRCVvcoJ8036c%3D" alt="20250218164009" loading="lazy"/></p>
<h2 data-id="heading-2">总结</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fimage" target="_blank" title="https://github.com/xun082/image" ref="nofollow noopener noreferrer">完整项目地址</a></p>
<p>如果你想参与进来开发或者想进群学习，可以添加我微信 <code>yunmz777</code>，后面还会有很多需求，等这个项目完成之后还会有很多新的并且很有趣的开源项目等着你。</p>
<p>如果该项目对你有帮助或者对这个项目感兴趣，欢迎 Star⭐️⭐️⭐️</p>
<p>最后再来提一些这两个开源项目，它们都是我们目前正在维护的开源项目：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fonline-edit-web" target="_blank" title="https://github.com/xun082/online-edit-web" ref="nofollow noopener noreferrer">在线代码协同编辑器</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fcreate-neat" target="_blank" title="https://github.com/xun082/create-neat" ref="nofollow noopener noreferrer">前端脚手架 create-neat</a></p>
</li>
</ul>
<p>🐒🐒🐒</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧭 前端周刊第440期（2025年11月10日–11月16日）]]></title>    <link>https://juejin.cn/post/7573912365911310378</link>    <guid>https://juejin.cn/post/7573912365911310378</guid>    <pubDate>2025-11-19T01:13:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573912365911310378" data-draft-id="7573952825953435711" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧭 前端周刊第440期（2025年11月10日–11月16日）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-19T01:13:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧭 前端周刊第440期（2025年11月10日–11月16日）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:13:40.000Z" title="Wed Nov 19 2025 01:13:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每周更新国外论坛的前端热门文章，推荐大家阅读/翻译，紧跟时事，掌握前端技术动态，也为写作或突破新领域提供灵感~</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee26b7933890437fb4f3f65f59888bef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119619&amp;x-signature=owsn%2BBUBawSaK2XsD9XjzjzFIQc%3D" alt="" loading="lazy"/></p>
<p><strong>📢 宣言</strong></p>
<p>我已经计划并开始实践：每周逐期翻译《前端周刊》内的每篇文章，并将其整理发布到 GitHub 仓库中，持续更深度的分享。</p>
<p>欢迎大家访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">github.com/TUARAN/fron…</a></p>
<p>顺手点个 ⭐ star 支持，是我持续输出的续航电池🔋✨！</p>
<p><strong>💬 推荐语</strong></p>
<p>如果说今年前端的底层趋势是什么，那本周周刊基本把答案摊开了：AI 前端化、本地化、组件结构重建、浏览器新能力普及、以及 React/Vue 的生态反思。</p>
<p>从 ONNX 本地推理，到 MCP 设计规范；从 Baseline 的统一标准，到 CSS 的奇点进化；再到 React useEffect 的全网“审判现场”。</p>
<p>这一期信息密度非常高，特别适合想提前布局 2025–2026 技术路线的同学认真读读。</p>
<p><strong>🧠 博主点评</strong></p>
<p>看完本期，我最大的感受是：<strong>前端已经走出了“写 UI”时代，而是全面迈入“智能化交互系统构建者”的角色。</strong></p>
<p>Baseline 成为事实标准，兼容性焦虑进一步减轻</p>
<p>AI 模型开始在浏览器本地跑，前端工程师掌握“模型加载与推理”将成常态</p>
<p>CSS 不再是样式语言，而是“交互描述语言”，甚至被用来做 tracking 和调试</p>
<p>React 社区的痛点（尤其是 useEffect）被系统性检讨</p>
<p>Vue 开始原生拥抱 MCP，这意味着设计→代码→服务将形成“自动流水线”</p>
<p>前端的未来是越来越“系统化”的，谁能理解这些结构化趋势，谁就能站在下一波浪潮的上游。</p>
<p><strong>🗂 本期精选目录</strong></p>
<p><strong>Web 开发</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloudfour.com%2Fthinks%2Fsimple-one-time-passcode-inputs%2F" target="_blank" title="https://cloudfour.com/thinks/simple-one-time-passcode-inputs/" ref="nofollow noopener noreferrer">Simple One-Time Passcode Inputs</a>：如何设计体验优秀的验证码输入框，解决自动跳格、粘贴识别与可访问性细节。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fprogramming-principles-for-self-taught-front-end-developers%2F" target="_blank" title="https://piccalil.li/blog/programming-principles-for-self-taught-front-end-developers/" ref="nofollow noopener noreferrer">Programming principles for self taught front-end developers</a>：写给自学前端开发者的编码原则指南，强调结构化和可维护性。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sitepoint.com%2Fheadings-in-html-structure%2F" target="_blank" title="https://www.sitepoint.com/headings-in-html-structure/" ref="nofollow noopener noreferrer">Why Headings Are Important in HTML</a>：说明标题语义在结构、可访问与 SEO 中的重要性。</p>
<p><strong>Baseline</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendmasters.com%2Fblog%2Fbrowserslist-baseline%2F" target="_blank" title="https://frontendmasters.com/blog/browserslist-baseline/" ref="nofollow noopener noreferrer">Browserslist &amp; Baseline</a>：解读 Baseline 如何影响前端兼容策略，并与 Browserslist 协同工作。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fperfecting-baseline%2F" target="_blank" title="https://piccalil.li/blog/perfecting-baseline/" ref="nofollow noopener noreferrer">Perfecting Baseline</a>：W3C WebDX 成员谈 Baseline 演进及其长远意义。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Fblog%2Fbaseline-digest-oct-2025" target="_blank" title="https://web.dev/blog/baseline-digest-oct-2025" ref="nofollow noopener noreferrer">October 2025 Baseline monthly digest</a>：10 月 Baseline 月报总结新特性落地情况。</p>
<p><strong>工具</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fwhy-the-frontend-should-run-ai-models-locally-with-onnx%2F" target="_blank" title="https://thenewstack.io/why-the-frontend-should-run-ai-models-locally-with-onnx/" ref="nofollow noopener noreferrer">Why the Frontend Should Run AI Models Locally With ONNX</a>：分析为何前端本地运行 ONNX 模型能降低延迟、保护隐私并提升交互体验。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Fux-design%2Fdesign-to-code-with-figma-mcp%2F" target="_blank" title="https://blog.logrocket.com/ux-design/design-to-code-with-figma-mcp/" ref="nofollow noopener noreferrer">How to structure Figma files for MCP and AI-powered code generation</a>：教你如何组织 Figma 文件结构，使之适配 MCP 与 AI 代码生成流程。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F3ru%2Feslint-plugin-baseline-js" target="_blank" title="https://github.com/3ru/eslint-plugin-baseline-js" ref="nofollow noopener noreferrer">ESLint Plugin for Baseline JavaScript</a>：针对 Baseline 规范的 ESLint 插件，帮助团队统一 JS 特性使用范围。</p>
<p><strong>性能</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fmotion.dev%2Fblog%2Fweb-animation-performance-tier-list" target="_blank" title="https://motion.dev/blog/web-animation-performance-tier-list" ref="nofollow noopener noreferrer">The Web Animation Performance Tier List</a>：不同动画实现方式的性能排名，给出更科学的选型建议。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2025%2F11%2Feffectively-monitoring-web-performance%2F" target="_blank" title="https://www.smashingmagazine.com/2025/11/effectively-monitoring-web-performance/" ref="nofollow noopener noreferrer">Effectively Monitoring Web Performance</a>：前端性能监控体系与指标全解析。</p>
<p><strong>动画</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Ftympanus.net%2Fcodrops%2F2025%2F11%2F11%2Fbuilding-a-3d-infinite-carousel-with-reactive-background-gradients%2F" target="_blank" title="https://tympanus.net/codrops/2025/11/11/building-a-3d-infinite-carousel-with-reactive-background-gradients/" ref="nofollow noopener noreferrer">Building a 3D Infinite Carousel…</a>：手把手教你实现 3D 无限轮播，并用背景渐变增强沉浸感。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trevorlasn.com%2Fblog%2Fview-transitions-api" target="_blank" title="https://www.trevorlasn.com/blog/view-transitions-api" ref="nofollow noopener noreferrer">View Transitions API</a>：用原生 View Transitions 让 DOM 状态切换更顺滑。</p>
<p><strong>CSS</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fhackyourmom.com%2Fen%2Fkibervijna%2Fnevydymyj-treking-u-brauzeri-yak-zlovzhyvayut-kaskadnymy-tablyczyamy-styliv-css%2F" target="_blank" title="https://hackyourmom.com/en/kibervijna/nevydymyj-treking-u-brauzeri-yak-zlovzhyvayut-kaskadnymy-tablyczyamy-styliv-css/" ref="nofollow noopener noreferrer">Invisible tracking in the browser</a>：揭露 CSS 如何被滥用进行浏览器隐形追踪。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bram.us%2F2025%2F11%2F13%2Fanimating-css-width-or-height-no-longer-force-a-main-thread-animation-in-chrome-under-the-right-conditions%2F" target="_blank" title="https://www.bram.us/2025/11/13/animating-css-width-or-height-no-longer-force-a-main-thread-animation-in-chrome-under-the-right-conditions/" ref="nofollow noopener noreferrer">Animating width/height no longer forces Main Thread</a>：Chrome 条件支持避免 width/height 动画导致主线程阻塞。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Funa.im%2Frange-style-queries" target="_blank" title="https://una.im/range-style-queries" ref="nofollow noopener noreferrer">Range Syntax for Style Queries</a>：介绍全新范围查询语法，让样式逻辑更灵活。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tip.com%2Fresponsive-stacked-img%2F" target="_blank" title="https://css-tip.com/responsive-stacked-img/" ref="nofollow noopener noreferrer">Responsive Stacked Images</a>：用 CSS 实现响应式的叠图/重叠布局。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2025%2F11%2Fcss-gamepad-api-visual-debugging-css-layers%2F" target="_blank" title="https://www.smashingmagazine.com/2025/11/css-gamepad-api-visual-debugging-css-layers/" ref="nofollow noopener noreferrer">CSS Gamepad Debugging With Layers</a>：利用 CSS 层可视化调试 Gamepad API 输入。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trevorlasn.com%2Fblog%2Fcss-interest-pseudo-classes" target="_blank" title="https://www.trevorlasn.com/blog/css-interest-pseudo-classes" ref="nofollow noopener noreferrer">:interest-invoker &amp; :interest-target</a>：两个适用于“兴趣触点”交互设计的新伪类。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tricks.com%2Fheadings-semantics-fluidity-and-styling-oh-my%2F" target="_blank" title="https://css-tricks.com/headings-semantics-fluidity-and-styling-oh-my/" ref="nofollow noopener noreferrer">Headings: Semantics, Fluidity, and Styling</a>：从语义、流动性到样式的一站式标题系统解析。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontendmasters.com%2Fblog%2Fperfectly-pointed-tooltips-to-the-corners%2F" target="_blank" title="https://frontendmasters.com/blog/perfectly-pointed-tooltips-to-the-corners/" ref="nofollow noopener noreferrer">Perfectly Pointed Tooltips</a>：创建“尖角完美”提示框的几何技巧。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Ftympanus.net%2Fcodrops%2F2025%2F11%2F10%2Fcrafting-generative-css-worlds%2F" target="_blank" title="https://tympanus.net/codrops/2025/11/10/crafting-generative-css-worlds/" ref="nofollow noopener noreferrer">Crafting Generative CSS Worlds</a>：使用 CSS 创造生成式视觉世界，充满创意灵感。</p>
<p><strong>JavaScript</strong></p>
<p><strong>理论</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fjsdev.space%2Fhowto%2Fblob-file-handling-guide%2F" target="_blank" title="https://jsdev.space/howto/blob-file-handling-guide/" ref="nofollow noopener noreferrer">Guide to Blobs, File APIs, and Memory Optimization</a>：深入理解 Blob 机制、文件 API 和浏览器内存优化策略。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fallthingssmitty.com%2F2025%2F11%2F10%2Ferror-chaining-in-javascript-cleaner-debugging-with-error-cause%2F" target="_blank" title="https://allthingssmitty.com/2025/11/10/error-chaining-in-javascript-cleaner-debugging-with-error-cause/" ref="nofollow noopener noreferrer">Error chaining with Error.cause</a>：Error.cause 如何提升调试体验与错误链路表达力。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.giuseppeciullo.it%2Fstop-splitting-strings-the-wrong-way-discover-intlsegmenter" target="_blank" title="https://dev.giuseppeciullo.it/stop-splitting-strings-the-wrong-way-discover-intlsegmenter" ref="nofollow noopener noreferrer">Intl.Segmenter</a>：用 Intl.Segmenter 正确处理 Unicode 字符分词与国际化场景。</p>
<p><strong>React</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2Ffix-react-routing-loopholes-react-router-middleware%2F" target="_blank" title="https://blog.logrocket.com/fix-react-routing-loopholes-react-router-middleware/" ref="nofollow noopener noreferrer">Fixing React routing loopholes</a>：用 React Router 中间件修复路由漏洞与跳转缺口。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.logrocket.com%2F15-common-useeffect-mistakes-react%2F" target="_blank" title="https://blog.logrocket.com/15-common-useeffect-mistakes-react/" ref="nofollow noopener noreferrer">15 useEffect mistakes</a>：React 开发中最常见的 useEffect 误用合集。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fis-server-side-rendering-reacts-holy-grail%2F" target="_blank" title="https://thenewstack.io/is-server-side-rendering-reacts-holy-grail/" ref="nofollow noopener noreferrer">Is SSR React’s Holy Grail?</a>：探讨 SSR 是否真的是 React 性能终极方案。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Freacts-useeffect-is-a-crime-scene-covered-in-fingerprints%2F" target="_blank" title="https://thenewstack.io/reacts-useeffect-is-a-crime-scene-covered-in-fingerprints/" ref="nofollow noopener noreferrer">UseEffect Is a Crime Scene</a>：一篇发人深省的 useEffect 反思文。</p>
<p><strong>Vue</strong></p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fnuxt.com%2Fblog%2Fbuilding-nuxt-mcp" target="_blank" title="https://nuxt.com/blog/building-nuxt-mcp" ref="nofollow noopener noreferrer">Building an MCP Server for Nuxt</a>：教你为 Nuxt 构建 MCP Server，直接连接 AI 生态。</p>
<p>🔹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwedgworth.dev%2Fusing-vite-with-vue-and-django%2F" target="_blank" title="https://wedgworth.dev/using-vite-with-vue-and-django/" ref="nofollow noopener noreferrer">Using Vite with Vue and Django</a>：如何将 Vite + Vue 集成到 Django 全栈环境中。</p>
<p><strong>小结</strong></p>
<p>本期内容有两个核心趋势值得关注：</p>
<p><strong>① 前端逐渐成为 AI 系统的一部分</strong></p>
<p>本地推理（ONNX）、MCP 服务器、设计到代码自动链路，都在快速成熟。</p>
<p><strong>② 浏览器与语言层不断增强底层能力</strong></p>
<p>新 CSS 语法、动画模型、Baseline 标准化，使前端工程变得“更可依赖、更像平台”。</p>
<p>这意味着未来的前端不止写页面，而是负责“交互智能 + 结构系统 + 多端一致性”的整体设计。</p>
<p>OK，以上就是本次分享，欢迎加我威 atar24，备注「前端周刊」，我会邀请你进交流群👇</p>
<p>🚀 每周分享技术干货</p>
<p>🎁 不定期抽奖福利</p>
<p>💬 有问必答，群友互助</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[⚡Trae Solo Coding 的效率法则]]></title>    <link>https://juejin.cn/post/7574204970745528366</link>    <guid>https://juejin.cn/post/7574204970745528366</guid>    <pubDate>2025-11-19T01:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574204970745528366" data-draft-id="7574204970745495598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="⚡Trae Solo Coding 的效率法则"/> <meta itemprop="keywords" content="Trae,人工智能,前端"/> <meta itemprop="datePublished" content="2025-11-19T01:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ⚡Trae Solo Coding 的效率法则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:21:34.000Z" title="Wed Nov 19 2025 01:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧭 一、什么是“Trae Solo Coding”？</h2>
<p>“<strong>Trae Solo Coding</strong>” 并不是某种官方的敏捷方法，而更像是一种 🧘‍♂️ 程序员的思维姿势：<br/>
当你独自面对需求、逻辑、Bug、甚至哲学问题时，如何在 <strong>无协作、无噪音、无救援</strong> 的状态下把效率推到极限。</p>
<p>一句话概括：</p>
<blockquote>
<p><strong>Solo coding ≠ 孤单写代码</strong>，而是一场与自己 CPU 对时钟的竞速。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🔋 二、Trae Solo 的五条效率法则</h2>
<p>以下是从底层模式到认知层面提炼出的五条“Solo效率律”，它们既是心理策略，也能映射到底层执行逻辑（task scheduling）。</p>
<hr/>
<h3 data-id="heading-2">🧠 法则 1：<strong>任务队列应像 CPU 调度一样短</strong></h3>
<p>程序员常犯的第一个错，是脑子里放太多“中断请求”。<br/>
内心任务越多，CPU cache miss 越频繁，切换成本剧增。</p>
<p><strong>做法：</strong></p>
<ul>
<li>
<p>维护一个三层队列：</p>
<ul>
<li>🚀 <em>Now</em> 队列（正在写的功能）</li>
<li>🧩 <em>Next</em> 队列（下一步的小任务）</li>
<li>🌌 <em>Later</em> 队列（冷冻区，未来考虑）</li>
</ul>
</li>
<li>
<p>一次只能提交一个“线程”到 <em>Now</em> 区。</p>
</li>
</ul>
<blockquote>
<p>💡 把自己当作操作系统的调度器，不要让线程陷入死锁（多任务崩溃）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">🧩 法则 2：<strong>每段代码的“入口与出口”都要显式</strong></h3>
<p>Solo 开发最大风险是，自己成为未来的“他人”。<br/>
三天后你再看自己的代码，仿佛走进陌生人的厨房。</p>
<p><strong>写法建议：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// [入口] 初始化用户模块，执行环境：登录后</span>
<span class="hljs-built_in">initUserModule</span>();

<span class="hljs-comment">// [出口] 清理状态与事件监听，防止内存残留</span>
<span class="hljs-built_in">cleanupUserModule</span>();
</code></pre>
<p>这就像在函数间加了 <em>标志门</em>：</p>
<blockquote>
<p>“我从这儿进，从那儿出。路就算曲折，也不迷路。”</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">🧮 法则 3：<strong>模块化是独行侠的社会化手段</strong></h3>
<p>当团队不存在时，模块边界就是你与混乱之间的唯一防线。<br/>
Solo coder 不需要完美的架构，但需要可“拔插”的思维。</p>
<p><strong>技巧：</strong></p>
<ul>
<li>每个模块都要能<strong>独立运行与测试</strong>；</li>
<li>文件命名清晰如变量：“userLogin.js” 胜过 “test1.js”；</li>
<li>公共逻辑抽象为 util 函数，像 libc 一样被重用。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/network.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchJSON</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; (<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)).<span class="hljs-title function_">json</span>();
</code></pre>
<blockquote>
<p>模块不是为了组织代码，而是为了防止精神崩溃。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">🧭 法则 4：<strong>不要调试，应该“观测”</strong></h3>
<p>Solo 状态下，没人给你第二视角。你的 bug 往往不是代码错了，而是信息不够。</p>
<p><strong>观测式调试</strong> 就是让系统自己“说话”。<br/>
以事件日志的形式追踪行为，而不是反复断点。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">monitor</span>(<span class="hljs-params">tag, data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${tag}</span>`</span>, data);
}
</code></pre>
<p>配合可视化（如 log viewer），你在低认知负荷下即可推断系统状态。</p>
<blockquote>
<p><strong>人类靠眼睛思考，程序靠时间线说话。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-6">🧩 法则 5：<strong>保持“节奏窗口”同步</strong></h3>
<p>我们在写代码时的思路，会形成一种“时间局部性”：<br/>
刚理解的函数上下文在脑中 cache 热度最高。<br/>
过了 20 分钟，cache 冷却，延迟上升。</p>
<p><strong>策略：</strong></p>
<ul>
<li>每 30 分钟为一个“节奏窗口”；</li>
<li>结束阶段必须留下执行线索（例如注释标记 TODO、断点处位置）；</li>
<li>下一窗口启动时能迅速“命中缓存”。</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 下一步将fetch结果映射到UI层——从这里继续</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">🧘‍♂️ 三、心流与底层机制</h2>
<p>Solo coding 的最高境界是 <strong>持续心流（flow）</strong> 。<br/>
你的大脑像事件循环（event loop）一样：</p>
<ul>
<li>🌀 专注执行当前任务；</li>
<li>⏳ 异步挂起待处理问题；</li>
<li>⚙️ 自动清理上下文无用对象。</li>
</ul>
<p>当心流打断时，相当于 event loop 被“阻塞”，你需要“异步恢复”：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setTimeout</span>(() =&gt; <span class="hljs-built_in">focusMode</span>(), <span class="hljs-number">1000</span>);
</code></pre>
<p>现实中可以这样“人肉实现”：</p>
<blockquote>
<p>关掉通知、放低音乐音量、切换黑暗模式、写一行注释→再出发。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">🧭 四、效率矩阵：Trae Solo 思维框架</h2>



































<table><thead><tr><th>层级</th><th>技术对应</th><th>思维描述</th></tr></thead><tbody><tr><td>⏱️ 时间管理</td><td>任务切片、短执行周期</td><td>“调度思想”</td></tr><tr><td>🧠 认知结构</td><td>模块化、显式边界</td><td>“缓存命中”</td></tr><tr><td>🔍 观测机制</td><td>日志、断点、性能分析</td><td>“事件驱动反馈”</td></tr><tr><td>💡 学习回环</td><td>每日总结、持续复用</td><td>“自监督学习”</td></tr><tr><td>🎭 心流实现</td><td>节奏窗口、情绪同步</td><td>“AI层面的线程安全”</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">✨ 五、结语：孤独 ≠ 低效</h2>
<p>Trae Solo Coding 的核心不是一个人在战斗，而是：</p>
<blockquote>
<p>让自己变成团队，<br/>
让思维有结构，<br/>
让代码像乐器一样——可独奏，也能成交响。</p>
</blockquote>
<p>或许你此刻正对着屏幕喝着冷咖啡、调着异步逻辑。<br/>
别忘记，你并非一个人写代码。<br/>
你的 CPU、事件循环、日志系统，<br/>
都在默默与你协奏。 🎵</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战：用好 pdb 和 logging，程序再也不黑箱运行了]]></title>    <link>https://juejin.cn/post/7573899782803767342</link>    <guid>https://juejin.cn/post/7573899782803767342</guid>    <pubDate>2025-11-19T01:22:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782803767342" data-draft-id="7574204970745544750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战：用好 pdb 和 logging，程序再也不黑箱运行了"/> <meta itemprop="keywords" content="Trae,后端,Python"/> <meta itemprop="datePublished" content="2025-11-19T01:22:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战：用好 pdb 和 logging，程序再也不黑箱运行了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:22:57.000Z" title="Wed Nov 19 2025 01:22:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Python 的学习路径里，能跑出结果只是第一步；真正让一个人从“会写”走向“能干活”的，是是否掌握调试技巧。
调试能力强，你的开发速度会呈指数级提升——问题定位快、输出可控、线上稳定，这才是职业化的表现。</p>
</blockquote>
<p>在 Python 中，最值得深入掌握的两个调试工具是：</p>
<ul>
<li><strong>pdb：交互式断点调试器</strong></li>
<li><strong>logging：可控、分级、可落盘的运行日志体系</strong></li>
</ul>
<p>这篇文章我们就系统聊一聊它们的核心使用方式。</p>
<hr/>
<h3 data-id="heading-0">一、为什么你必须学会调试？</h3>
<p>初学者常见的开发方式是“打印调试”——哪错了就 print 一行，然后不停改代码反复跑。</p>
<p>这种方式有两个明显问题：</p>
<ol>
<li><strong>效率低</strong>：每改一次就得重新运行。</li>
<li><strong>信息不全</strong>：看不到变量的真实状态、看不到调用栈。</li>
</ol>
<p>pdb 和 logging 正是为了解决这些痛点，让你在开发和线上运维阶段都更得心应手。</p>
<hr/>
<h2 data-id="heading-1">二、pdb：像打游戏一样单步查看你的代码</h2>
<p>pdb 是 Python 内置的命令行调试器，它允许你：</p>
<ul>
<li>在代码任意位置设置断点</li>
<li>暂停执行</li>
<li>查看变量</li>
<li>单步运行</li>
<li>跳过函数</li>
<li>回溯错误上下文</li>
</ul>
<p>简直是排查 bug 的神器。</p>
<hr/>
<h3 data-id="heading-2">1. 最简单的用法：pdb.set_trace()</h3>
<p>在你怀疑有问题的地方插入：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pdb
pdb.set_trace()
</code></pre>
<p>执行时程序会在这一行停下来，并进入调试界面。</p>
<hr/>
<h3 data-id="heading-3">2. 调试常用命令（非常实用）</h3>

































<table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>n</td><td>next，执行下一行，不进入函数内部</td></tr><tr><td>s</td><td>step，进入函数内部执行</td></tr><tr><td>c</td><td>continue，继续执行到下一个断点</td></tr><tr><td>l</td><td>list，查看当前执行区域的代码</td></tr><tr><td>p 变量名</td><td>查看变量的值</td></tr><tr><td>q</td><td>quit，退出调试</td></tr></tbody></table>
<p>举个简单例子：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">import</span> pdb; pdb.set_trace()
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-built_in">print</span>(calc(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>))
</code></pre>
<p>调试时你可以：</p>
<ul>
<li><code>p a</code> 查看参数</li>
<li><code>n</code> 逐步往下跑</li>
<li><code>q</code> 退出</li>
</ul>
<p>调试体验类似 VSCode，但直接在终端即可完成。</p>
<hr/>
<h3 data-id="heading-4">3. 遇到异常自动进入 pdb</h3>
<p>这个技巧非常实用：</p>
<pre><code class="hljs language-bash" lang="bash">python -m pdb your_script.py
</code></pre>
<p>当程序报错时会自动暂停在异常处，让你现场查看变量并回溯堆栈。</p>
<p>非常适合排查隐藏的边界问题、线上问题复现等场景。</p>
<hr/>
<h2 data-id="heading-5">三、logging：程序“自己写日记”，方便你随时回溯</h2>
<p>如果说 pdb 更适合开发阶段，那 logging 就是线上阶段的“黑盒记录器”。</p>
<p>print 只是把内容输出到控制台，但 logging 能做到：</p>
<ul>
<li>按严重级别打印日志</li>
<li>输出到文件</li>
<li>输出时间、行号、文件名、函数名</li>
<li>灵活配置</li>
<li>线上问题快速定位</li>
</ul>
<p>真正的项目一定要用 logging，而不是满屏的 print。</p>
<hr/>
<h3 data-id="heading-6">1. logging 的基本用法</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging

logging.basicConfig(level=logging.INFO)

logging.info(<span class="hljs-string">"任务开始"</span>)
logging.warning(<span class="hljs-string">"数据格式异常，已跳过一条记录"</span>)
logging.error(<span class="hljs-string">"数据库连接失败"</span>)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">INFO</span><span class="hljs-selector-pseudo">:root</span>:任务开始
<span class="hljs-selector-tag">WARNING</span><span class="hljs-selector-pseudo">:root</span>:数据格式异常，已跳过一条记录
<span class="hljs-selector-tag">ERROR</span><span class="hljs-selector-pseudo">:root</span>:数据库连接失败
</code></pre>
<hr/>
<h3 data-id="heading-7">2. 日志级别说明（非常关键）</h3>





























<table><thead><tr><th>级别</th><th>适用场景</th></tr></thead><tbody><tr><td>DEBUG</td><td>详细的调试信息，开发阶段最常用</td></tr><tr><td>INFO</td><td>程序正常运行的关键事件</td></tr><tr><td>WARNING</td><td>可疑，但程序还能继续</td></tr><tr><td>ERROR</td><td>错误，需要处理</td></tr><tr><td>CRITICAL</td><td>致命错误，程序即将终止</td></tr></tbody></table>
<p>生产环境一般用 <code>INFO</code> 或 <code>WARNING</code>。</p>
<hr/>
<h3 data-id="heading-8">3. logging 输出到文件</h3>
<pre><code class="hljs language-python" lang="python">logging.basicConfig(
    level=logging.INFO,
    filename=<span class="hljs-string">"run.log"</span>,
    <span class="hljs-built_in">format</span>=<span class="hljs-string">"%(asctime)s - %(levelname)s - %(message)s"</span>
)
</code></pre>
<p>关键参数解释：</p>
<ul>
<li><code>filename</code>：指定日志文件</li>
<li><code>format</code>：控制输出格式</li>
<li><code>asctime</code>：打印时间</li>
<li><code>levelname</code>：日志级别</li>
<li><code>message</code>：日志内容</li>
</ul>
<p>示例输出：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2025-03-05 10:33:21</span><span class="hljs-string">,932</span> <span class="hljs-bullet">-</span> <span class="hljs-string">INFO</span> <span class="hljs-bullet">-</span> <span class="hljs-string">爬虫启动</span>
<span class="hljs-number">2025-03-05 10:33:22</span><span class="hljs-string">,124</span> <span class="hljs-bullet">-</span> <span class="hljs-string">WARNING</span> <span class="hljs-bullet">-</span> <span class="hljs-string">请求延迟过高</span>
</code></pre>
<p>这个格式在定位问题时非常有用。</p>
<hr/>
<h3 data-id="heading-9">4. 同时输出到文件和控制台</h3>
<p>稍进阶一点：</p>
<pre><code class="hljs language-python" lang="python">logger = logging.getLogger()

logger.setLevel(logging.DEBUG)

<span class="hljs-comment"># 控制台输出</span>
console = logging.StreamHandler()
console.setLevel(logging.INFO)

<span class="hljs-comment"># 文件输出</span>
file = logging.FileHandler(<span class="hljs-string">"run.log"</span>)
file.setLevel(logging.DEBUG)

<span class="hljs-comment"># 设置格式</span>
formatter = logging.Formatter(<span class="hljs-string">"%(asctime)s [%(levelname)s] %(message)s"</span>)
console.setFormatter(formatter)
file.setFormatter(formatter)

logger.addHandler(console)
logger.addHandler(file)
</code></pre>
<p>这是实际项目非常常见的日志配置方式。</p>
<hr/>
<h2 data-id="heading-10">四、pdb 与 logging 的结合：最佳实践</h2>
<p>开发阶段：
用 <strong>pdb</strong> 精准定位问题。</p>
<p>上线阶段：
用 <strong>logging</strong> 持续记录程序运行行为。</p>
<p>现实开发中，常见调试流程就是：</p>
<ol>
<li>通过 logging 定位哪块逻辑可能有问题</li>
<li>在对应代码加 <code>pdb.set_trace()</code></li>
<li>单步查看变量是否异常</li>
<li>修复</li>
<li>清理断点，保留日志</li>
</ol>
<p>水平提升非常明显。</p>
<hr/>
<h2 data-id="heading-11">五、总结</h2>
<p>学会调试是一名 Python 工程师必须跨过的一道坎。
会用 pdb，你就不再盲看代码。
会用 logging，你的程序就不再黑箱运行。</p>
<p>两者结合，你在查问题、排障、优化性能、处理线上日志时都会变得轻松很多。
也正是这类能力，让一个开发者真正具备生产力和工程视角。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战：从 timeit 到 cProfile，一次搞懂代码为什么慢]]></title>    <link>https://juejin.cn/post/7573899782803783726</link>    <guid>https://juejin.cn/post/7573899782803783726</guid>    <pubDate>2025-11-19T01:23:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782803783726" data-draft-id="7573957755367768074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战：从 timeit 到 cProfile，一次搞懂代码为什么慢"/> <meta itemprop="keywords" content="Trae,Python,后端"/> <meta itemprop="datePublished" content="2025-11-19T01:23:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战：从 timeit 到 cProfile，一次搞懂代码为什么慢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:23:54.000Z" title="Wed Nov 19 2025 01:23:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当你写 Python 写得越来越多，就会突然发现——有些代码运行得慢得离谱，但自己却不知道“慢”到底发生在哪一步。
这时你就需要真正的性能分析工具上场了，而不是继续凭感觉优化。</p>
</blockquote>
<p>本篇我们一起搞定两大核心工具：</p>
<ul>
<li>timeit：测函数执行时间</li>
<li>cProfile：分析整段程序的性能瓶颈</li>
</ul>
<p>最后我会给你一个完整的优化示例，让性能提升看得见。</p>
<hr/>
<h3 data-id="heading-0">1. 为什么代码会慢？</h3>
<p>Python 是解释型语言，灵活但速度不是强项。
代码变慢常见原因包括：</p>
<ul>
<li>不必要的循环</li>
<li>低效的数据结构</li>
<li>重复计算</li>
<li>IO 阻塞（文件/网络）</li>
<li>第三方库使用不当</li>
</ul>
<p>搞清楚瓶颈在哪里，是所有优化的起点。</p>
<hr/>
<h2 data-id="heading-1">2. 用 timeit 测局部性能：谁更快，一测便知</h2>
<p><code>timeit</code> 是个轻量级工具，非常适合比较小片段代码的速度。</p>
<p>例如：列表推导 vs for 循环，谁更快？</p>
<h4 data-id="heading-2">示例：用 timeit 测试代码片段</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> timeit

<span class="hljs-comment"># 列表推导</span>
expr1 = <span class="hljs-string">"[i*i for i in range(1000)]"</span>
<span class="hljs-comment"># 普通循环</span>
expr2 = <span class="hljs-string">"""
result = []
for i in range(1000):
    result.append(i*i)
"""</span>

t1 = timeit.timeit(expr1, number=<span class="hljs-number">10000</span>)
t2 = timeit.timeit(expr2, number=<span class="hljs-number">10000</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"列表推导:"</span>, t1)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"for 循环:"</span>, t2)
</code></pre>
<h4 data-id="heading-3">输出示例（依据电脑不同会变化）</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">列表推导: 0.32</span>
for 循环: 0.45
</code></pre>
<p>你一下就看出列表推导更快。
这就是 timeit 的价值：
<strong>用数字说话，而不是猜测。</strong></p>
<hr/>
<h2 data-id="heading-4">3. 用 cProfile 查整段程序的瓶颈：慢在哪，一清二楚</h2>
<p>当你不确定慢的是哪部分时，就用 <code>cProfile</code>。</p>
<p>它会告诉你：</p>
<ul>
<li>每个函数调用几次</li>
<li>每次耗时多久</li>
<li>总耗时</li>
<li>占比情况</li>
</ul>
<p>超级适合分析中大型脚本。</p>
<hr/>
<h3 data-id="heading-5">示例：一个“看似没问题但其实很慢”的函数</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">slow_func</span>():
    total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):
            total += i + j
    <span class="hljs-keyword">return</span> total
</code></pre>
<p>现在我们用 cProfile 分析：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cProfile

cProfile.run(<span class="hljs-string">"slow_func()"</span>)
</code></pre>
<p>你会看到类似：</p>
<pre><code class="hljs language-bash" lang="bash">200000000 <span class="hljs-keyword">function</span> calls <span class="hljs-keyword">in</span> 3.821 seconds
ncalls  tottime  percall  cumtime  <span class="hljs-keyword">function</span>
1       3.821    3.821    3.821    slow_func
</code></pre>
<p>一下就能看出：
<strong>问题全在 slow_func 本身，特别是双层循环。</strong></p>
<hr/>
<h2 data-id="heading-6">4. 更清晰的结果？用 pstats 或 SnakeViz 可视化</h2>
<p>默认输出较难读，你可以这样格式化：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cProfile
<span class="hljs-keyword">import</span> pstats

<span class="hljs-keyword">with</span> cProfile.Profile() <span class="hljs-keyword">as</span> pr:
    slow_func()

stats = pstats.Stats(pr)
stats.sort_stats(pstats.SortKey.TIME)
stats.print_stats()
</code></pre>
<p>如果你想可视化展示（像瀑布图一样），可以安装 SnakeViz：</p>
<pre><code class="hljs language-lua" lang="lua">pip install snakeviz
snakeviz <span class="hljs-built_in">output</span>.prof
</code></pre>
<p>非常适合技术分享或团队协作。</p>
<hr/>
<h2 data-id="heading-7">5. 实战：一步步从 2.5s 优化到 0.01s</h2>
<p>假设我们有一个脚本统计每行是否包含某些关键词：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_keywords</span>(<span class="hljs-params">lines, keywords</span>):
    result = []
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> keywords:
            <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> line:
                result.append((line, k))
    <span class="hljs-keyword">return</span> result
</code></pre>
<h4 data-id="heading-8">分析：</h4>
<ul>
<li>双层循环</li>
<li>多次重复“是否包含”检查</li>
<li>关键词过多时会超级慢</li>
</ul>
<p>现在，我们用 cProfile 跑一下：</p>
<pre><code class="hljs language-python" lang="python">cProfile.run(<span class="hljs-string">"check_keywords(lines, keywords)"</span>)
</code></pre>
<p>你会看到绝大多数时间花在：</p>
<pre><code class="hljs language-markdown" lang="markdown">str.<span class="hljs-strong">__contains__</span>
</code></pre>
<p>因为你对每个 line、每个 keyword 都在做 <code>in</code> 操作。</p>
<hr/>
<h3 data-id="heading-9">优化方案：把关键词变成正则 OR 模式</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fast_check_keywords</span>(<span class="hljs-params">lines, keywords</span>):
    pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">"|"</span>.join(<span class="hljs-built_in">map</span>(re.escape, keywords)))
    result = []
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        m = pattern.search(line)
        <span class="hljs-keyword">if</span> m:
            result.append((line, m.group()))
    <span class="hljs-keyword">return</span> result
</code></pre>
<h4 data-id="heading-10">再跑性能测试</h4>
<p>从 2.5 秒 → 0.01 秒
优化效果巨大。</p>
<hr/>
<h2 data-id="heading-11">6. 性能优化原则：永远遵循这三条</h2>
<h3 data-id="heading-12">① 优化前先量化</h3>
<p>不要凭直觉优化
永远先用 <strong>timeit / cProfile</strong> 查看瓶颈。</p>
<h3 data-id="heading-13">② 优化数据结构</h3>
<p>例如：</p>
<ul>
<li>列表 → 集合（O(1) 查找）</li>
<li>循环计算 → 内建函数/向量化</li>
</ul>
<h3 data-id="heading-14">③ 避免重复计算</h3>
<p>缓存、预编译、提前转换格式，都能救命。</p>
<hr/>
<h2 data-id="heading-15">7. 总结</h2>
<p>性能优化是 Python 开发者进阶的必备技能。
<code>timeit</code> 解决“小范围速度比较”，
<code>cProfile</code> 负责“全局瓶颈定位”。</p>
<p>只要你掌握：</p>
<ul>
<li>定位</li>
<li>调试</li>
<li>替换更快的数据结构/算法</li>
</ul>
<p>你就可以让脚本从“能跑”变成“飞快”。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习 LiteLLM 的模型管理]]></title>    <link>https://juejin.cn/post/7573896789366472742</link>    <guid>https://juejin.cn/post/7573896789366472742</guid>    <pubDate>2025-11-19T01:06:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789366472742" data-draft-id="7573890735579463690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习 LiteLLM 的模型管理"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-19T01:06:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习 LiteLLM 的模型管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:06:37.000Z" title="Wed Nov 19 2025 01:06:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇文章中，我们快速了解了 LiteLLM 的核心特性和基本用法。我们知道 LiteLLM 通过统一的 API 接口支持调用 100+ 个 LLM 服务商的模型，而 Proxy Server 可以作为一个企业级的 LLM 网关来统一管理和路由请求。</p>
<p>但是，当我们真正去部署和使用 LiteLLM Proxy 时，会面临一个非常实际的问题：<strong>如何有效地管理这些模型？</strong></p>
<p>是否能够快速添加新模型而不需要重启服务？能否让用户清楚地了解有哪些模型可用？在使用过程中，如何追踪模型的定价和成本？怎样安全地存储和管理各个服务商的 API 凭据？这些都是模型管理需要解决的问题。</p>
<p>这一篇文章，我们就来深入学习 LiteLLM 的模型管理功能，看看它是如何帮助我们解决这些实际问题的。</p>
<h2 data-id="heading-0">基础配置</h2>
<p>在前面的快速入门篇，我们已经接触过简单的模型配置，可以通过 <code>config.yaml</code> 文件定义模型：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">claude</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">anthropic/claude-sonnet-4-20250514</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/ANTHROPIC_API_KEY</span>
</code></pre>
<p>这里的配置很直观：</p>
<ul>
<li><code>model_name</code> 是用户在调用 API 时使用的名称</li>
<li><code>litellm_params</code> 包含了 LiteLLM 在调用该模型时需要的所有参数，包括实际的模型名称、API 密钥、URL 地址等
<ul>
<li><code>model</code>：遵循 <code>provider/model_id</code> 的格式，LiteLLM 通过这个来识别实际的模型和服务商</li>
<li><code>api_key</code>：支持 <code>os.environ/KEY_NAME</code> 的格式来从环境变量中读取，避免将密钥硬编码在配置文件中</li>
</ul>
</li>
</ul>
<p>但在实际应用中，我们往往需要更多的信息。比如，某个模型的最大 Token 数是多少？调用这个模型的成本是多少？这个模型有什么特殊的功能限制吗？这就需要用到 <code>model_info</code> 字段，我们可以通过 <code>/model/info</code> 接口了解每个模型的详细信息：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X GET http://127.0.0.1:4000/model/info \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span>
</code></pre>
<p>返回结果类似下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/439d5c39c90244038ad6580f88ddf061~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=OG1qxJaynoIXRAIObvIbAtmTg3Q%3D" alt="model-info.png" loading="lazy"/></p>
<p>对于一些比较常见的模型，LiteLLM 会定期维护基本信息，不过用户也可以在配置文件中进行修改，这样会覆盖默认值，用户还可以添加自定义的字段：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">"这里是用户自定义字段"</span>
      <span class="hljs-attr">max_tokens:</span> <span class="hljs-number">4096</span>
      <span class="hljs-attr">supports_vision:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">supports_function_calling:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>这个 <code>/model/info</code> 接口非常有用，可以用来在应用的 UI 中展示可用的模型列表和详细信息，帮助用户选择最合适的模型，进行成本估算和预算规划。</p>
<h2 data-id="heading-1">动态管理</h2>
<p>通过配置文件管理模型固然简单，但是每次修改都需要重启 Proxy Server，这在生产环境下是不可接受的。LiteLLM 支持将模型信息保存到 Postgres 数据库中，从而实现动态管理功能。首先修改 <code>config.yaml</code> 文件，加上数据库配置并开启模型保存功能：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">general_settings:</span>
  <span class="hljs-attr">master_key:</span> <span class="hljs-string">sk-1234</span> <span class="hljs-comment"># 管理员密钥</span>
  <span class="hljs-attr">database_url:</span> <span class="hljs-string">"postgresql://postgres:password@127.0.0.1:5432/litellm"</span>
  <span class="hljs-attr">store_model_in_db:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否将模型保存到数据库</span>
</code></pre>
<p>然后重启 Proxy Server，现在我们就可以通过 API 接口的方式动态管理模型了，具体又可以分为 <strong>通过 API 管理</strong>、<strong>通过命令行管理</strong>、<strong>通过 Web UI 管理</strong> 几种方式。</p>
<h3 data-id="heading-2">通过 API 管理</h3>
<p>通过 <code>/model/new</code> 接口添加模型：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">"http://127.0.0.1:4000/model/new"</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "model_name": "deepseek",
    "litellm_params": {
      "model": "deepseek/deepseek-chat",
      "api_key": "sk-xxx"
    }
  }'</span>
</code></pre>
<h3 data-id="heading-3">通过命令行管理</h3>
<p>LiteLLM 还提供了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fproxy%2Fmanagement_cli" target="_blank" title="https://docs.litellm.ai/docs/proxy/management_cli" ref="nofollow noopener noreferrer">命令行工具 <code>litellm-proxy</code></a>，方便从命令行管理模型，这个工具在安装 Proxy Server 时会一起安装好：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install <span class="hljs-string">'litellm[proxy]'</span>
</code></pre>
<p>首先通过环境变量配置认证信息：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LITELLM_PROXY_URL=http://localhost:4000
<span class="hljs-built_in">export</span> LITELLM_PROXY_API_KEY=sk-1234
</code></pre>
<blockquote>
<p>也可以使用 <code>litellm-proxy login</code> 登录，这会打开浏览器进行身份认证，认证后的凭据会保存在本地。</p>
</blockquote>
<p><strong>列出所有模型</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ litellm-proxy models list
</code></pre>
<p><strong>添加新模型</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ litellm-proxy models add deepseek \
  --param model=deepseek/deepseek-chat \
  --param api_key=sk-xxxx
</code></pre>
<p><strong>删除模型</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ litellm-proxy models delete &lt;model-id&gt;
</code></pre>
<h3 data-id="heading-4">通过 Web UI 管理</h3>
<p>如果你不习惯使用命令行，LiteLLM Proxy 的 Web UI 也提供了可视化的模型管理界面，登录到管理后台后，点击 “Models + Endpoints” 菜单：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ee5e286d3b746b48f95d9de8cf5e49f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=OAuj1P1Xyvb5gGF8Ttp6EdFOjbI%3D" alt="web-ui-model-management.png" loading="lazy"/></p>
<p>这里列出了当前系统的所有模型，包括配置文件中的和数据库中的。点击 “Add Model” 标签添加新模型：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cae9e2825488414d902072e41b22e8d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=u4tviFWAPoLrcrs9eYEp0Fjvc%2Fk%3D" alt="web-ui-add-model.png" loading="lazy"/></p>
<p>填写 Provider、Model Names、Model Mappings、API Key 等参数，点击确认即可。</p>
<p>注意，Model Mappings 中的 Public Model Name 就对应配置文件中的 <code>model_name</code> 参数，LiteLLM Model Name 对应 <code>litellm_params.model</code> 参数。</p>
<p>如果有一些额外参数，可以展开 “Advanced Settings” 进行配置：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d2283d1c1f446496bc355e035725d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=tkBj4umD07h9XySw0s46TtmQc8E%3D" alt="web-ui-add-model-adv.png" loading="lazy"/></p>
<h2 data-id="heading-5">模型发现</h2>
<p>手动维护模型列表可能会很繁琐，特别是对于那些有大量模型的服务商，比如 OpenAI、Anthropic 等，每次他们发布新模型时我们都要手动更新配置。为此，LiteLLM 推出了 <strong>模型发现（Model Discovery）</strong> 功能，通过 <strong>Wildcard 模型</strong> LiteLLM 可以自动从服务商处获取最新的模型列表，无需手动更新。</p>
<p>其配置非常简单，只需要在 <code>config.yaml</code> 中使用 <code>/*</code> 后缀来表示 Wildcard 模型：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">anthropic/*</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">anthropic/*</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/ANTHROPIC_API_KEY</span>

<span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">check_provider_endpoint:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 启用模型发现功能</span>
</code></pre>
<p>注意 <code>litellm_settings.check_provider_endpoint</code> 必须设为 <code>true</code>，表示启用模型发现功能。</p>
<p>配置完成后，调用 <code>/v1/models</code> 接口就可以看到所有自动发现的模型：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X GET http://127.0.0.1:4000/v1/models \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span>
</code></pre>
<p>这里我使用的是 Anthropic 服务商，因此返回的结果包含了 Anthropic 的所有可用模型：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b47062c3e17848299b6f543146d487ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=O5aoW2TrVMe5kJu2Md4OXQ1nKKI%3D" alt="model-discovery.png" loading="lazy"/></p>
<p>目前 LiteLLM 的模型发现功能支持以下服务商：</p>
<ul>
<li>Fireworks AI</li>
<li>OpenAI</li>
<li>Gemini</li>
<li>LiteLLM Proxy（是的，可以级联！）</li>
<li>Topaz</li>
<li>Anthropic</li>
<li>xAI</li>
<li>vLLM</li>
<li>Vertex AI</li>
</ul>
<h2 data-id="heading-6">使用 Model Hub 公开模型</h2>
<p>在团队或企业环境中，你可能希望让用户知道哪些模型是可用的，LiteLLM 提供了一个 <strong>Model Hub</strong> 功能，可以公开展示模型列表。使用 Model Hub 有以下几点优势：</p>
<ol>
<li><strong>自服务探索</strong>：用户可以自己浏览可用的模型，无需询问管理员</li>
<li><strong>信息透明</strong>：每个模型都展示详细的信息，包括描述、能力、局限等</li>
<li><strong>降低门槛</strong>：新用户可以快速了解系统中有什么，如何使用</li>
<li><strong>公开演示</strong>：可以用来向客户或合作伙伴展示你的模型能力</li>
</ol>
<p>首先，我们需要在 Web UI 中选择要公开的模型。进入 Model Hub 页面后，点击 “Make Public” 按钮，选择要公开的模型：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544981869f4f4afc92f616e49e7aef67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=ZWFl3rzrlgA71YKf0vQhIRLcUjg%3D" alt="model-hub-make-public.png" loading="lazy"/></p>
<p>确认后，这些模型就会出现在公开的 Model Hub 页面上，访问下面这个 URL 进行查看：</p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//127.0.0.1:4000/ui/model_hub_table</span>
</code></pre>
<p>这个页面是公开的，所有人都能访问，就像一个应用商店一样：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/842124837d6648c5bc0b884b782d09bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=PX8xlCE%2FSAgu6fVUivZHvLQqvOY%3D" alt="model-hub-table.png" loading="lazy"/></p>
<p>用户可以在这里查看每个模型的详细信息以及使用文档。</p>
<h2 data-id="heading-7">模型价格同步</h2>
<p>在上面的学习中我们了解到，可以通过 <code>/model/info</code> 接口查询模型的详细信息，包括模型的上下文限制以及输入输出价格等，这些信息有助于企业进行准确的成本追踪和预算控制。</p>
<p>LiteLLM 在 GitHub 上维护了一个完整的模型成本映射表，包含了 100+ 个模型的详细信息：</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/BerriAI/litellm/blob/main/model_prices_and_context_window.json
</code></pre>
<p>随着新模型的发布和价格的变化，这个映射表会定期更新。为了保持你的 Proxy Server 中的成本数据最新，LiteLLM 提供了 <strong>手动同步</strong> 和 <strong>自动同步</strong> 的功能，可以从 GitHub 获取最新的价格信息，确保成本追踪的准确性。</p>
<p>如果你想立即同步最新的价格信息，可以使用以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">"http://127.0.0.1:4000/reload/model_cost_map"</span> \
  -H <span class="hljs-string">"Authorization: Bearer sk-1234"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span>
</code></pre>
<p>对于生产环境，更推荐设置自动定期同步，比如每 6 小时同步一次：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">"http://127.0.0.1:4000/schedule/model_cost_map_reload?hours=6"</span> \
  -H <span class="hljs-string">"Authorization: Bearer sk-1234"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span>
</code></pre>
<p>查看同步状态：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X GET <span class="hljs-string">"http://127.0.0.1:4000/schedule/model_cost_map_reload/status"</span> \
  -H <span class="hljs-string">"Authorization: Bearer sk-1234"</span>
</code></pre>
<p>取消定时同步：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X DELETE <span class="hljs-string">"http://127.0.0.1:4000/schedule/model_cost_map_reload"</span> \
  -H <span class="hljs-string">"Authorization: Bearer sk-1234"</span>
</code></pre>
<p>默认情况下，LiteLLM 从 GitHub 的官方仓库获取模型成本表。如果你有一些定制模型，想使用自定义的模型成本表，可以设置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LITELLM_MODEL_COST_MAP_URL=<span class="hljs-string">"https://your-server.com/your-cost-map.json"</span>
</code></pre>
<p>或者使用本地文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LITELLM_LOCAL_MODEL_COST_MAP=True
</code></pre>
<p>此时 LiteLLM 会读取 <code>litellm</code> 目录下的 <code>model_prices_and_context_window_backup.json</code> 文件，不会访问网络。</p>
<h2 data-id="heading-8">凭据管理</h2>
<p>关于模型管理的另一个话题是 <strong>凭据管理</strong>，我们知道，LiteLLM 支持 100 多个不同的模型服务商，每个服务商都有自己的 API Key 或认证方式，如何安全的管理这些服务商的凭据呢？</p>
<p>在前面的 <code>config.yaml</code> 文件中，我们配置 <code>api_key</code> 时使用了 <code>os.environ/KEY_NAME</code> 格式从环境变量中读取，这是最简单的一种凭据管理的方式，避免将密钥硬编码在配置文件中，虽然很方便，但是这种方式难以管理，而且也不够安全，在某些情况下，你可能希望在 LiteLLM 的数据库中直接存储和管理这些凭证。</p>
<p>LiteLLM 提供了一个专门的凭证管理界面，进入 Models -&gt; LLM Credentials -&gt; Add Credential，可以添加新的凭证：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f70133b3a564b2d8562be32e6b49419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=8iFVZnATpQgJmQX1NeUd03ooneY%3D" alt="web-ui-add-credentials.png" loading="lazy"/></p>
<p>选择你的 LLM 服务商后，输入 API Key 和其他必要信息（根据不同的服务商，界面会显示相应的字段），点击确认即可。添加凭证后，在创建新模型时就可以从下拉列表中选择已有的凭证，避免重复输入敏感信息：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5654aa312adf41c5a1d10a62536a5b14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119197&amp;x-signature=Xd%2FIZjE9ki4cLgCsjV8366Ys7nc%3D" alt="web-ui-add-model-use-credentials.png" loading="lazy"/></p>
<p>凭证在数据库中是加密存储的。LiteLLM 使用以下方式进行加密：</p>
<ul>
<li>优先使用 <code>LITELLM_SALT_KEY</code> 进行加密</li>
<li>如果未设置 <code>LITELLM_SALT_KEY</code>，则使用 <code>LITELLM_MASTER_KEY</code> 进行加密</li>
</ul>
<p>这两个密钥都应该被妥善保管，不要泄露。</p>
<h3 data-id="heading-9">企业级凭据管理</h3>
<p>对于企业级应用，对于凭据管理可能有着更高的安全要求，LiteLLM 支持与主流的 <strong>密钥管理服务（Secrets Manager）</strong> 集成，允许你将凭据存储在企业级的密钥管理服务中，而不是 LiteLLM 的数据库中。支持的 Secrets Manager 包括：</p>
<ul>
<li>AWS Secrets Manager</li>
<li>AWS Key Management Service</li>
<li>Azure Key Vault</li>
<li>Google Secret Manager</li>
<li>Google Key Management Service</li>
<li>HashiCorp Vault</li>
</ul>
<p>除了传统的 API Key，LiteLLM 还支持 <strong>OpenID Connect (OIDC)</strong> 身份认证，这是一种更现代、更安全的认证方式。支持的 OIDC 提供商包括：</p>
<ul>
<li>Google Cloud Run</li>
<li>GitHub Actions</li>
<li>Azure AD</li>
<li>CircleCI</li>
<li>Azure Kubernetes Service 等</li>
</ul>
<p>这两个功能特别适合大型企业环境，可以显著提高安全性和合规性。详细的企业特性配置，请参考 LiteLLM 官方文档。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fsecret" target="_blank" title="https://docs.litellm.ai/docs/secret" ref="nofollow noopener noreferrer">docs.litellm.ai/docs/secret</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Foidc" target="_blank" title="https://docs.litellm.ai/docs/oidc" ref="nofollow noopener noreferrer">docs.litellm.ai/docs/oidc</a></li>
</ul>
<h2 data-id="heading-10">小结</h2>
<p>通过这篇文章，我们详细学习了 LiteLLM Proxy 的模型管理功能。主要内容包括：</p>
<ul>
<li><strong>基础配置</strong>：对于相对稳定的模型配置，应该在 <code>config.yaml</code> 中定义，这样可以版本控制，便于回滚；充分利用 <code>model_info</code> 字段来添加模型描述、能力说明、使用建议等，这会让用户更容易选择合适的模型；</li>
<li><strong>动态管理</strong>：通过 <code>/model/new</code> 接口在运行时动态添加模型，支持 API、命令行、Web UI 三种方式对模型进行管理，无需重启服务；</li>
<li><strong>模型发现</strong>：通过通配符自动获取整个服务商的模型列表；</li>
<li><strong>Model Hub</strong>：公开展示可用的模型信息，提升用户体验；</li>
<li><strong>模型价格同步</strong>：手动或自动从 GitHub 同步最新的模型成本数据，支持自定义模型成本表；</li>
<li><strong>凭据管理</strong>：集中管理 API Key 和凭据信息，降低凭据泄露的风险；对于高安全要求场景，考虑使用企业特性（Secret Manager 或 OIDC），实现零密钥存储或临时凭据；</li>
</ul>
<p>LiteLLM 的模型管理系统设计得相当完善，既支持初期的简单配置，也支持后期的复杂运维场景。从 <code>config.yaml</code> 的声明式配置，到运行时的动态管理，再到企业级的高安全凭据存储，LiteLLM 为不同规模的应用提供了灵活的解决方案。</p>
<h2 data-id="heading-11">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🛰️ 低带宽环境下的 AIGC 内容传输优化技术]]></title>    <link>https://juejin.cn/post/7573896789366505510</link>    <guid>https://juejin.cn/post/7573896789366505510</guid>    <pubDate>2025-11-19T01:19:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789366505510" data-draft-id="7574204970745413678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🛰️ 低带宽环境下的 AIGC 内容传输优化技术"/> <meta itemprop="keywords" content="前端,人工智能,Trae"/> <meta itemprop="datePublished" content="2025-11-19T01:19:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🛰️ 低带宽环境下的 AIGC 内容传输优化技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:19:41.000Z" title="Wed Nov 19 2025 01:19:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧭 引言：当AI的脑子装不进网络的沙漏里</h2>
<p>在理想的未来世界里，我们的AI生成内容（AIGC, <em>AI-Generated Content</em>）可以像清风一样，在网络的管道中自由流淌。</p>
<p>但现实呢？<br/>
有些人身处在“2G情怀区”，或者公司内网像老爷的打字机。此时要打开一个AIGC生成的高分辨率图像页面，浏览器大概会先经历五个阶段：</p>
<ol>
<li>连接；</li>
<li>缓冲；</li>
<li>超时；</li>
<li>F5重试；</li>
<li>怀疑人生。</li>
</ol>
<p>于是，我们不得不重新审视 <strong>低带宽环境下的内容传输优化</strong> ——这是一个需要既懂算法、又懂人文关怀的技术领域。</p>
<hr/>
<h2 data-id="heading-1">🧩 一、AIGC内容的“胖身材”问题</h2>
<p>AIGC的“胖”主要来自三个方面：</p>
<ul>
<li><strong>图像/视频生成体积爆炸</strong>：一张高保真AI生成图动辄数MB；</li>
<li><strong>模型推理延迟</strong>：生成端等待时间+传输时间；</li>
<li><strong>动态内容碎片化</strong>：Web端需要同时加载脚本、字体、权重文件。</li>
</ul>
<p>想象一下，小区宽带相当于 <em>蚂蚁搬米</em>，而你却在让它搬一台冰箱。</p>
<hr/>
<h2 data-id="heading-2">🚀 二、传输优化的本质：在“细管子”里装更多水</h2>
<h3 data-id="heading-3">1. <strong>内容压缩：让图片做瑜伽</strong></h3>
<p>传统压缩算法（如JPEG、WebP）早已驾轻就熟，但AIGC内容往往是 <strong>动态生成</strong> 的，因此需要：</p>
<ul>
<li>在生成端就完成 <strong>多级降采样</strong>；</li>
<li>按浏览器设备<strong>DPR动态下发不同规格文件</strong>；</li>
<li>对生成的图片内容进行 <strong>语义感知压缩（semantic compression）</strong> ，保真重点区域细致保留，背景模糊处理。</li>
</ul>
<blockquote>
<p>💡 <strong>类比</strong>：网页中的AI图像像一杯奶茶，我们可以先喝珍珠（主体内容），等网络好一点再补把剩下的奶茶（背景和细节）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2. <strong>渐进式加载（Progressive Loading）</strong></h3>
<p>渐进式加载技术就像是“先上菜再上酒”，用户能先看到概要图，再逐步清晰。</p>
<p><strong>典型实现方案</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">// 渐进式图片替换示例
const <span class="hljs-attr">highResImg</span> = new Image()<span class="hljs-comment">;</span>
<span class="hljs-attr">highResImg.src</span> = <span class="hljs-string">'aigc-output-highres.webp'</span><span class="hljs-comment">;</span>
<span class="hljs-attr">highResImg.onload</span> = () =&gt; {
  document.getElementById('preview').<span class="hljs-attr">src</span> = highResImg.src<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// 初始低清图
document.getElementById('preview').<span class="hljs-attr">src</span> = <span class="hljs-string">'aigc-output-lowres.webp'</span><span class="hljs-comment">;</span>
</code></pre>
<p>配合使用 <code>IntersectionObserver</code> 可以实现懒加载（Lazy Loading），让浏览器<strong>只加载用户可见区域内容</strong>。</p>
<hr/>
<h3 data-id="heading-5">3. <strong>智能分片传输（Chunk Streaming）</strong></h3>
<blockquote>
<p>📦 一次别传完一整条咸鱼，可以先传尾巴。</p>
</blockquote>
<p>通过将内容按语义分片（Chunk），我们可以实时流式加载内容。例如在AIGC视频生成中，可将帧分段传输，边播边生。</p>
<p><strong>思想</strong>：</p>
<ul>
<li>服务端分片产出；</li>
<li>Web 端通过 <code>ReadableStream</code> 逐块接收；</li>
<li>各块按序拼接渲染（可结合 WebCodec）。</li>
</ul>
<hr/>
<h3 data-id="heading-6">4. <strong>传输协议优化：HTTP/3 与 QUIC 的救赎</strong></h3>
<p>低带宽环境下，TCP 的丢包重传机制可能让延迟雪上加霜。而 QUIC 协议基于 UDP，允许多流并行，不会因为一个包丢失就阻塞全局。</p>
<ul>
<li><strong>多路传输</strong> → 不怕“掉包连坐”；</li>
<li><strong>内置加密层</strong> → 少一次握手；</li>
<li><strong>头部压缩</strong> → 节省带宽。</li>
</ul>
<p>在 WebAPI 端，只要服务器支持 QUIC，前端就能轻松享受性能红利。</p>
<hr/>
<h3 data-id="heading-7">5. <strong>客户端缓存与增量更新（Delta Update）</strong></h3>
<p>让数据“留在身边”是传输优化的终极哲学。<br/>
通过 <strong>Service Worker + IndexedDB</strong>，我们可以：</p>
<ul>
<li>缓存AIGC静态部分；</li>
<li>仅传输变动片段；</li>
<li>提供离线回显体验。</li>
</ul>
<p>示例逻辑伪代码👇：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 增量更新逻辑示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchDeltaUpdate</span>(<span class="hljs-params">resourceUrl</span>) {
  <span class="hljs-keyword">const</span> localHash = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getLocalHash</span>(resourceUrl);
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${resourceUrl}</span>?clientHash=<span class="hljs-subst">${localHash}</span>`</span>);
  <span class="hljs-keyword">const</span> updateData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

  <span class="hljs-keyword">if</span> (updateData.<span class="hljs-property">patch</span>) {
    <span class="hljs-title function_">applyPatch</span>(localHash, updateData.<span class="hljs-property">patch</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">🧮 三、一点底层科学：为什么压缩能节省“时间的能量”</h2>
<p>让我们用非公式的方式描述一下带宽与时间的关系：</p>
<blockquote>
<p><strong>传输时间 ≈（数据量 ÷ 带宽） + 延迟</strong></p>
</blockquote>
<p>因此降低任何一个因素——比如数据量（压缩）、带宽（协议优化）、延迟（就近CDN）——都等价于在网络宇宙中<strong>折叠时空</strong>。</p>
<p>在底层实现中，浏览器的网络栈会通过缓冲队列和TCP窗口动态调整发送速率。<br/>
带宽利用率越高，丢包率越低，传输延迟就越可控。<br/>
这也是为什么AIGC数据流常和 <strong>流式并行计算（streaming compute）</strong> 共同使用。</p>
<hr/>
<h2 data-id="heading-9">🌐 四、图解：AIGC内容优化传输的工作流</h2>
<p>（用纯HTML生成一个小示意图👇）</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">display</span>:flex;<span class="hljs-attribute">flex-direction</span>:column;<span class="hljs-attribute">align-items</span>:center;<span class="hljs-attribute">font-family</span>:sans-serif<span class="hljs-string">"&gt;
  &lt;div style="</span>text-align:center<span class="hljs-string">"&gt;
    &lt;h3&gt;🧠 AIGC 内容 Web 传输优化流程&lt;/h3&gt;
  &lt;/div&gt;
  &lt;div style="</span>display:flex;<span class="hljs-attribute">flex-wrap</span>:wrap;<span class="hljs-attribute">justify-content</span>:center;<span class="hljs-attribute">gap</span>:<span class="hljs-number">10px</span><span class="hljs-string">"&gt;
    &lt;div style="</span>padding:<span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>:<span class="hljs-number">6px</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#fefefe</span><span class="hljs-string">"&gt;
      🔍 AI生成内容
    &lt;/div&gt;
    ➡️
    &lt;div style="</span>padding:<span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>:<span class="hljs-number">6px</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#f2fff2</span><span class="hljs-string">"&gt;
      🌀 语义压缩
    &lt;/div&gt;
    ➡️
    &lt;div style="</span>padding:<span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>:<span class="hljs-number">6px</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#f0f8ff</span><span class="hljs-string">"&gt;
      🌊 流式分片
    &lt;/div&gt;
    ➡️
    &lt;div style="</span>padding:<span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>:<span class="hljs-number">6px</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#fff3e6</span><span class="hljs-string">"&gt;
      🧩 渐进加载
    &lt;/div&gt;
    ➡️
    &lt;div style="</span>padding:<span class="hljs-number">10px</span>;<span class="hljs-attribute">border</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;<span class="hljs-attribute">border-radius</span>:<span class="hljs-number">6px</span>;<span class="hljs-attribute">background</span>:<span class="hljs-number">#fffae6</span><span class="hljs-string">"&gt;
      🛠️ 客户端缓存
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;p&gt;最终用户即可在“龟速网络”中愉快地浏览AIGC作品。&lt;/p&gt;
&lt;/div&gt;
</span></code></pre>
<hr/>
<h2 data-id="heading-10">🧠 五、实战建议：科学家也得讲艺术</h2>



































<table><thead><tr><th>优化策略</th><th>技术点</th><th>建议适用场景</th></tr></thead><tbody><tr><td>WebP/AVIF 压缩</td><td>编码优化</td><td>AI图片/壁纸类网站</td></tr><tr><td>Stream 分片</td><td>ReadableStream API</td><td>动态长内容、AIGC视频</td></tr><tr><td>Lazy Loading</td><td>IntersectionObserver</td><td>图像瀑布流</td></tr><tr><td>QUIC 协议</td><td>HTTP/3</td><td>移动端低带宽</td></tr><tr><td>Service Worker</td><td>离线缓存</td><td>工业应用/远端场景</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">🎭 结语：技术的浪漫</h2>
<p>“在低带宽环境下传AIGC内容”，听起来像是要让鲸鱼穿过吸管。<br/>
我们能做的，就是通过压缩、分片、缓存等技术——让这条鲸鱼优雅地<strong>变形通过</strong>。</p>
<p>而当页面在弱网中依然顺畅运行的那一刻，就像诗人在沙漏里写就的句子：<br/>
<strong>性能即是诗，延迟亦是美。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 项目静态资源 OSS 部署完整实现指南]]></title>    <link>https://juejin.cn/post/7573900332637798410</link>    <guid>https://juejin.cn/post/7573900332637798410</guid>    <pubDate>2025-11-19T01:38:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900332637798410" data-draft-id="7573899782803882030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 项目静态资源 OSS 部署完整实现指南"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-19T01:38:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮游本尊"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 项目静态资源 OSS 部署完整实现指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮游本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:38:13.000Z" title="Wed Nov 19 2025 01:38:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82" title="#%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82">背景与需求</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1" title="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1">技术方案设计</a></li>
<li><a href="#vue-cli-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3" title="#vue-cli-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3">Vue CLI 配置详解</a></li>
<li><a href="#oss-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE" title="#oss-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE">OSS 工具安装与配置</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99" title="#%E4%B8%8A%E4%BC%A0%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99">上传脚本编写</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B" title="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B">部署流程</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">注意事项与最佳实践</a></li>
<li><a href="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">问题排查</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">背景与需求</h2>
<h3 data-id="heading-2">业务场景</h3>
<p>在大型前端项目的生产环境部署中，静态资源（JS、CSS、字体文件等）通常占据较大的体积。将这些资源部署到对象存储服务（OSS）并通过 CDN 加速，可以带来以下优势：</p>
<ol>
<li><strong>减轻服务器压力</strong>：静态资源不再占用应用服务器的带宽和存储</li>
<li><strong>提升访问速度</strong>：CDN 边缘节点就近分发，降低延迟</li>
<li><strong>降低服务器成本</strong>：减少服务器带宽和存储需求</li>
<li><strong>提高可用性</strong>：CDN 的高可用性保障</li>
</ol>
<h3 data-id="heading-3">需求分析</h3>
<p>我们的项目需要实现以下功能：</p>
<ul>
<li><strong>环境区分</strong>：测试环境使用本地资源，生产环境使用 OSS CDN</li>
<li><strong>选择性上传</strong>：只上传 <code>static/css/</code>、<code>static/fonts/</code>、<code>static/js/</code> 目录</li>
<li><strong>路径处理</strong>：<code>favicon.ico</code> 和 <code>styles/</code> 目录不上传 OSS，使用相对路径</li>
<li><strong>自动化部署</strong>：通过脚本自动化完成上传流程</li>
<li><strong>版本管理</strong>：通过文件 hash 实现缓存控制</li>
</ul>
<hr/>
<h2 data-id="heading-4">技术方案设计</h2>
<h3 data-id="heading-5">架构设计</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────┐
│  本地开发环境    │  → 相对路径 (/)
└─────────────────┘

┌─────────────────┐
│  测试环境构建    │  → 相对路径 (/) → 直接部署
└─────────────────┘

┌─────────────────┐
│  生产环境构建    │  → CDN 路径 (https://cdn.example.com/)
└─────────────────┘
         │
         ├─→ static/css/   → 上传 OSS
         ├─→ static/fonts/ → 上传 OSS
         ├─→ static/js/    → 上传 OSS
         ├─→ favicon<span class="hljs-selector-class">.ico</span>   → 不上传（相对路径）
         └─→ styles/       → 不上传（相对路径）
</code></pre>
<h3 data-id="heading-6">技术选型</h3>
<ul>
<li><strong>构建工具</strong>：Vue CLI（基于 Webpack）</li>
<li><strong>OSS 工具</strong>：ossutil（阿里云官方命令行工具）</li>
<li><strong>脚本语言</strong>：Bash Shell</li>
<li><strong>路径处理</strong>：Webpack 插件 + 自定义 HTML 修改插件</li>
</ul>
<hr/>
<h2 data-id="heading-7">Vue CLI 配置详解</h2>
<h3 data-id="heading-8">1. publicPath 动态配置</h3>
<p><code>publicPath</code> 决定了构建后资源的引用路径。我们需要根据环境变量动态设置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">CDN_URL</span> || 
    (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> ? <span class="hljs-string">'/'</span> : <span class="hljs-comment">// 本地开发环境</span>
     process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PATH_TYPE</span> === <span class="hljs-string">'gray'</span> ? <span class="hljs-string">'/'</span> : <span class="hljs-comment">// 测试环境使用相对路径</span>
     <span class="hljs-string">'https://js-cdn.m.cc/'</span>), <span class="hljs-comment">// 生产环境使用 CDN</span>
  <span class="hljs-attr">outputDir</span>: <span class="hljs-string">'dist'</span>,
  <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">'static'</span>,
  <span class="hljs-attr">filenameHashing</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
<p><strong>关键点说明</strong>：</p>
<ul>
<li><code>assetsDir: 'static'</code>：所有资源输出到 <code>static/</code> 目录</li>
<li><code>filenameHashing: true</code>：启用文件名 hash，实现缓存控制</li>
<li>环境判断逻辑：
<ul>
<li>开发环境：始终使用相对路径</li>
<li>测试环境（<code>VUE_APP_PATH_TYPE === 'gray'</code>）：使用相对路径</li>
<li>生产环境：使用 CDN 路径</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">2. 输出文件名配置</h3>
<p>为了确保文件路径的一致性，需要显式设置输出文件名：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">configureWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 统一使用 static/js/ 路径，与 assetsDir 保持一致</span>
  config.<span class="hljs-property">output</span>.<span class="hljs-property">filename</span> = <span class="hljs-string">'static/js/[name].[hash:8].js'</span>
  config.<span class="hljs-property">output</span>.<span class="hljs-property">chunkFilename</span> = <span class="hljs-string">'static/js/[name].[hash:8].js'</span>
}
</code></pre>
<p><strong>为什么需要显式设置</strong>？</p>
<p>虽然 <code>assetsDir: 'static'</code> 会自动处理路径，但显式设置可以：</p>
<ul>
<li>确保所有环境路径一致</li>
<li>避免不同 Webpack 版本的差异</li>
<li>便于后续维护和理解</li>
</ul>
<h3 data-id="heading-10">3. HTML 路径修改插件</h3>
<p>生产环境需要特殊处理：静态资源使用 CDN，但 <code>favicon.ico</code> 和 <code>styles/</code> 使用相对路径。</p>
<p><strong>实现原理</strong>：</p>
<p>在 Webpack 的 <code>emit</code> 阶段（生成文件后，写入磁盘前），通过自定义插件修改 HTML 内容：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 只在生产环境（非测试环境）运行</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> &amp;&amp; process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PATH_TYPE</span> !== <span class="hljs-string">'gray'</span>) {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModifyHtmlPlugin</span> {
      <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
        compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">'ModifyHtmlPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> {
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">filename</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (filename.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.html'</span>)) {
              <span class="hljs-keyword">let</span> html = compilation.<span class="hljs-property">assets</span>[filename].<span class="hljs-title function_">source</span>()
              
              <span class="hljs-comment">// 1. 先处理 BASE_URL 变量（如果还没被 Vue CLI 替换）</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="&lt;%= BASE_URL %&gt;favicon\.ico"/g</span>, <span class="hljs-string">'href="/favicon.ico"'</span>)
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="&lt;%= BASE_URL %&gt;styles\/([^"]+)"/g</span>, <span class="hljs-string">'href="/styles/$1"'</span>)
              
              <span class="hljs-comment">// 2. 替换其他 BASE_URL 变量为 CDN 路径</span>
              <span class="hljs-keyword">const</span> baseUrl = process.<span class="hljs-property">env</span>.<span class="hljs-property">CDN_URL</span> || <span class="hljs-string">'https://js-cdn.m.cc/'</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;%= BASE_URL %&gt;/g</span>, baseUrl)
              
              <span class="hljs-comment">// 3. 最后处理已经被替换的 CDN 路径（将 favicon 和 styles 改回相对路径）</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="https:\/\/js-cdn\.modb\.cc\/favicon\.ico"/g</span>, <span class="hljs-string">'href="/favicon.ico"'</span>)
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="https:\/\/js-cdn\.modb\.cc\/styles\/([^"]+)"/g</span>, <span class="hljs-string">'href="/styles/$1"'</span>)
              
              compilation.<span class="hljs-property">assets</span>[filename] = {
                <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> html,
                <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> html.<span class="hljs-property">length</span>
              }
            }
          })
          <span class="hljs-title function_">callback</span>()
        })
      }
    }
    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'modify-html'</span>).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ModifyHtmlPlugin</span>)
  }
}
</code></pre>
<p><strong>处理顺序的重要性</strong>：</p>
<ol>
<li>先处理 <code>BASE_URL</code> 变量（模板阶段）</li>
<li>替换为 CDN 路径</li>
<li>最后将特定文件改回相对路径</li>
</ol>
<p>这样可以确保所有路径都被正确处理。</p>
<h3 data-id="heading-11">4. 代码分割优化</h3>
<p>为了提升加载性能，我们配置了代码分割：</p>
<pre><code class="hljs language-javascript" lang="javascript">config.<span class="hljs-property">optimization</span>.<span class="hljs-property">splitChunks</span> = {
  <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
  <span class="hljs-attr">minSize</span>: <span class="hljs-number">20000</span>,
  <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">15</span>,
  <span class="hljs-attr">cacheGroups</span>: {
    <span class="hljs-comment">// Vue 核心库单独拆分</span>
    <span class="hljs-attr">vueCore</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'chunk-vue-core'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](vue|vue-router|vuex|vue-i18n)[\\/]/</span>,
      <span class="hljs-attr">priority</span>: <span class="hljs-number">40</span>,
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
      <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">// 大型 UI 库单独拆分</span>
    <span class="hljs-attr">elementPlus</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'chunk-element-plus'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]element-plus[\\/]/</span>,
      <span class="hljs-attr">priority</span>: <span class="hljs-number">35</span>,
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
      <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">// 其他配置...</span>
  }
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>大型库单独拆分，便于缓存</li>
<li>按需加载的库设置为 <code>async</code>，减少初始加载体积</li>
<li>公共代码提取，避免重复打包</li>
</ul>
<hr/>
<h2 data-id="heading-12">OSS 工具安装与配置</h2>
<h3 data-id="heading-13">1. 确定服务器架构</h3>
<p>首先需要确定服务器的 CPU 架构，以选择正确的 ossutil 版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -m
<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># x86_64  → 使用 ossutil64</span>
<span class="hljs-comment"># aarch64 → 使用 ossutilarm64</span>
</code></pre>
<h3 data-id="heading-14">2. 下载 ossutil</h3>
<p>根据架构下载对应版本（以阿里云 OSS 为例）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建目录</span>
<span class="hljs-built_in">mkdir</span> -p /root/oss
<span class="hljs-built_in">cd</span> /root/oss

<span class="hljs-comment"># 下载对应版本（示例：ARM64 架构）</span>
wget https://gosspublic.alicdn.com/ossutil/1.7.13/ossutilarm64

<span class="hljs-comment"># 或者使用 curl</span>
curl -o ossutilarm64 https://gosspublic.alicdn.com/ossutil/1.7.13/ossutilarm64

<span class="hljs-comment"># 添加执行权限</span>
<span class="hljs-built_in">chmod</span> +x ossutilarm64

<span class="hljs-comment"># 验证安装</span>
/root/oss/ossutilarm64 --version
</code></pre>
<h3 data-id="heading-15">3. 配置 OSS 凭证</h3>
<p>ossutil 支持两种配置方式：</p>
<h4 data-id="heading-16">方式一：命令行配置（临时）</h4>
<pre><code class="hljs language-bash" lang="bash">/root/oss/ossutilarm64 config -e &lt;endpoint&gt; \
  -i &lt;accessKeyId&gt; \
  -k &lt;accessKeySecret&gt;
</code></pre>
<h4 data-id="heading-17">方式二：配置文件（推荐）</h4>
<p>创建配置文件 <code>~/.ossutilconfig</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt; /root/.ossutilconfig &lt;&lt; <span class="hljs-string">'EOF'</span>
[Credentials]
language=EN
endpoint=oss-cn-hangzhou.aliyuncs.com
accessKeyID=YOUR_ACCESS_KEY_ID
accessKeySecret=YOUR_ACCESS_KEY_SECRET
EOF

<span class="hljs-comment"># 设置文件权限（安全考虑）</span>
<span class="hljs-built_in">chmod</span> 600 /root/.ossutilconfig
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>language=EN</code>：使用英文输出，避免编码问题</li>
<li><code>endpoint</code>：OSS 区域节点地址</li>
<li><code>accessKeyID</code> 和 <code>accessKeySecret</code>：OSS 访问凭证</li>
</ul>
<h3 data-id="heading-18">4. 测试连接</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试连接</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/

<span class="hljs-comment"># 如果成功，会显示 OSS 上的文件列表</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">上传脚本编写</h2>
<h3 data-id="heading-20">脚本结构设计</h3>
<p>上传脚本需要包含以下功能：</p>
<ol>
<li><strong>环境检查</strong>：验证构建输出是否存在</li>
<li><strong>连接测试</strong>：确保 OSS 连接正常</li>
<li><strong>清理旧文件</strong>：删除 OSS 上的旧版本文件</li>
<li><strong>上传新文件</strong>：上传指定的目录</li>
<li><strong>验证上传</strong>：确认上传成功</li>
</ol>
<h3 data-id="heading-21">完整脚本示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e  <span class="hljs-comment"># 遇到错误立即退出</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting OSS upload for production environment..."</span>

<span class="hljs-comment"># ========== 1. OSS 配置 ==========</span>
<span class="hljs-comment"># 如果使用配置文件，可以跳过此步骤</span>
<span class="hljs-comment"># 如果需要动态配置，使用以下命令：</span>
<span class="hljs-comment"># /root/oss/ossutilarm64 config -e &lt;endpoint&gt; \</span>
<span class="hljs-comment">#   -i &lt;accessKeyId&gt; \</span>
<span class="hljs-comment">#   -k &lt;accessKeySecret&gt;</span>

<span class="hljs-comment"># ========== 2. 测试 OSS 连接 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Testing OSS connection..."</span>
<span class="hljs-keyword">if</span> /root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/ 2&gt;/dev/null &gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"OSS connection test passed"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: OSS connection test failed, but continuing..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 3. 设置构建路径 ==========</span>
DIST_PATH=<span class="hljs-string">"/u01/dist"</span>

<span class="hljs-comment"># ========== 4. 检查构建输出 ==========</span>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span> not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Build path: <span class="hljs-variable">$DIST_PATH</span>"</span>

<span class="hljs-comment"># 检查 static 目录</span>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/static not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 检查关键文件</span>
<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/index.html"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/index.html not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/favicon.ico"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/favicon.ico not found"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/styles"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/styles directory not found"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 5. 清理 OSS 上的旧文件 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Cleaning old files from OSS..."</span>

<span class="hljs-comment"># 删除 OSS 上的 css 目录（使用 -f 参数避免交互式提示）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old CSS files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/css/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (CSS directory may not exist, skipping)"</span>

<span class="hljs-comment"># 删除 OSS 上的 fonts 目录</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old fonts files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/fonts/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (Fonts directory may not exist, skipping)"</span>

<span class="hljs-comment"># 删除 OSS 上的 js 目录</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old JS files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/js/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (JS directory may not exist, skipping)"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Old files cleaned (if any existed)"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-comment"># ========== 6. 上传新文件 ==========</span>

<span class="hljs-comment"># 上传 static/css/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/css"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/css/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/css/ oss://your-bucket-name/static/css/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"CSS directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload CSS directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/static/css not found, skipping..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 上传 static/fonts/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/fonts"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/fonts/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/fonts/ oss://your-bucket-name/static/fonts/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Fonts directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload fonts directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/static/fonts not found, skipping..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 上传 static/js/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/js"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/js/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/js/ oss://your-bucket-name/static/js/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"JS directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload JS directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/static/js not found (required)"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 7. 验证上传 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Verifying upload..."</span>

<span class="hljs-comment"># 统计上传的文件数量</span>
JS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/js/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
CSS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/css/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
FONTS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/fonts/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload completed!"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload statistics:"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   JS files: <span class="hljs-variable">$JS_COUNT</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   CSS files: <span class="hljs-variable">$CSS_COUNT</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Fonts files: <span class="hljs-variable">$FONTS_COUNT</span>"</span>

<span class="hljs-comment"># 检查关键文件是否存在</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Checking key files..."</span>

JS_CHECK=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/js/app.*.js 2&gt;/dev/null | <span class="hljs-built_in">head</span> -1 | <span class="hljs-built_in">wc</span> -l)
CSS_CHECK=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/css/app.*.css 2&gt;/dev/null | <span class="hljs-built_in">head</span> -1 | <span class="hljs-built_in">wc</span> -l)

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$JS_CHECK</span>"</span> -gt 0 ] &amp;&amp; [ <span class="hljs-string">"<span class="hljs-variable">$CSS_CHECK</span>"</span> -gt 0 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Key files app.js and app.css found in OSS"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload verification passed!"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: Some key files may be missing"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OSS upload process completed!"</span>
</code></pre>
<h3 data-id="heading-22">脚本关键点说明</h3>
<h4 data-id="heading-23">1. <code>set -e</code> 的作用</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> -e
</code></pre>
<p>遇到任何错误立即退出，避免继续执行可能导致的问题。</p>
<h4 data-id="heading-24">2. 使用 <code>-f</code> 参数</h4>
<pre><code class="hljs language-bash" lang="bash">ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://bucket/path/ -f
ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-built_in">local</span>/path/ oss://bucket/path/ -f
</code></pre>
<p><code>-f</code> 参数的作用：</p>
<ul>
<li><code>rm -r -f</code>：强制删除，不询问确认</li>
<li><code>cp -r -f</code>：强制覆盖，不询问确认</li>
</ul>
<p><strong>为什么重要</strong>：在自动化脚本中，交互式提示会导致脚本挂起。</p>
<h4 data-id="heading-25">3. 错误处理</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">command</span> 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"fallback message"</span>
</code></pre>
<ul>
<li><code>2&gt;/dev/null</code>：隐藏错误输出</li>
<li><code>||</code>：如果命令失败，执行后续命令</li>
<li>适用于首次运行（目录可能不存在）的场景</li>
</ul>
<h4 data-id="heading-26">4. 变量命名注意事项</h4>
<p>避免使用可能被系统识别的变量名：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 不推荐（可能被某些系统识别为系统变量）</span>
BUILD_PATH=<span class="hljs-string">"/u01/dist"</span>

<span class="hljs-comment"># ✅ 推荐</span>
DIST_PATH=<span class="hljs-string">"/u01/dist"</span>
</code></pre>
<h4 data-id="heading-27">5. 文件计数验证</h4>
<pre><code class="hljs language-bash" lang="bash">JS_COUNT=$(ossutilarm64 <span class="hljs-built_in">ls</span> oss://bucket/static/js/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
</code></pre>
<p>使用 <code>wc -l</code> 统计文件数量，用于验证上传是否成功。</p>
<hr/>
<h2 data-id="heading-28">部署流程</h2>
<h3 data-id="heading-29">测试环境部署</h3>
<p>测试环境使用相对路径，不需要上传 OSS：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 构建项目</span>
npm run gray

<span class="hljs-comment"># 2. 打包</span>
tar -czf dist.gz dist/

<span class="hljs-comment"># 3. 上传到服务器并解压</span>
scp dist.gz user@server:/path/to/deploy/
ssh user@server <span class="hljs-string">"cd /path/to/deploy &amp;&amp; tar -xzf dist.gz"</span>
</code></pre>
<h3 data-id="heading-30">生产环境部署</h3>
<p>生产环境需要上传资源到 OSS：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 构建项目</span>
npm run build

<span class="hljs-comment"># 2. 打包</span>
tar -czf dist.gz dist/

<span class="hljs-comment"># 3. 上传到服务器</span>
scp dist.gz user@server:/u01/
scp upload-to-oss-production.sh user@server:/u01/

<span class="hljs-comment"># 4. 在服务器上执行部署脚本</span>
ssh user@server &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-built_in">cd</span> /u01
<span class="hljs-built_in">rm</span> -rf dist &amp;&amp; tar -zxvf ./dist.gz
<span class="hljs-built_in">chmod</span> +x upload-to-oss-production.sh
./upload-to-oss-production.sh
EOF
</code></pre>
<h3 data-id="heading-31">完整部署脚本示例</h3>
<p>可以将解压和上传合并到一个脚本中：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># 解压构建文件</span>
<span class="hljs-built_in">cd</span> /u01
<span class="hljs-built_in">rm</span> -rf dist &amp;&amp; tar -zxvf ./dist.gz

<span class="hljs-comment"># 执行 OSS 上传脚本</span>
./upload-to-oss-production.sh

<span class="hljs-comment"># 部署到 Web 服务器（Nginx 示例）</span>
<span class="hljs-comment"># cp -r dist/* /usr/share/nginx/html/</span>
<span class="hljs-comment"># systemctl reload nginx</span>
</code></pre>
<hr/>
<h2 data-id="heading-32">注意事项与最佳实践</h2>
<h3 data-id="heading-33">1. 安全性</h3>
<h4 data-id="heading-34">凭证管理</h4>
<ul>
<li><strong>不要</strong>在脚本中硬编码凭证</li>
<li><strong>使用</strong>环境变量或配置文件</li>
<li><strong>设置</strong>配置文件权限为 <code>600</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> 600 ~/.ossutilconfig
</code></pre>
<h4 data-id="heading-35">最小权限原则</h4>
<p>为 OSS 访问密钥设置最小必要权限：</p>
<ul>
<li>只允许上传到指定目录</li>
<li>禁止删除其他目录的文件</li>
</ul>
<h3 data-id="heading-36">2. 性能优化</h3>
<h4 data-id="heading-37">并行上传</h4>
<p>对于大量文件，可以考虑并行上传：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用后台任务并行上传</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/css/ oss://bucket/static/css/ -f &amp;
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/fonts/ oss://bucket/static/fonts/ -f &amp;
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/js/ oss://bucket/static/js/ -f &amp;

<span class="hljs-comment"># 等待所有任务完成</span>
<span class="hljs-built_in">wait</span>
</code></pre>
<h4 data-id="heading-38">增量上传</h4>
<p>如果文件很多，可以使用 <code>--update</code> 参数进行增量上传：</p>
<pre><code class="hljs language-bash" lang="bash">ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-built_in">local</span>/path/ oss://bucket/path/ --update
</code></pre>
<p>但需要注意：如果文件名包含 hash，每次构建都是新文件，增量上传意义不大。</p>
<h3 data-id="heading-39">3. 缓存策略</h3>
<h4 data-id="heading-40">HTTP 缓存头</h4>
<p>在 OSS 控制台或通过 API 设置缓存头：</p>
<pre><code class="hljs language-arduino" lang="arduino">Cache-Control: <span class="hljs-keyword">public</span>, max-age=<span class="hljs-number">31536000</span>
</code></pre>
<p>对于带 hash 的文件名，可以设置长期缓存。</p>
<h4 data-id="heading-41">CDN 缓存</h4>
<p>如果使用 CDN，需要配置：</p>
<ul>
<li>缓存规则：根据文件类型和路径</li>
<li>缓存刷新：更新后及时刷新 CDN 缓存</li>
</ul>
<h3 data-id="heading-42">4. 监控与日志</h3>
<h4 data-id="heading-43">上传日志</h4>
<p>记录上传过程的关键信息：</p>
<pre><code class="hljs language-bash" lang="bash">LOG_FILE=<span class="hljs-string">"/var/log/oss-upload.log"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: Starting OSS upload"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
<span class="hljs-comment"># ... 上传过程 ...</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: OSS upload completed"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
</code></pre>
<h4 data-id="heading-44">监控告警</h4>
<ul>
<li>监控上传失败率</li>
<li>监控 OSS 存储使用量</li>
<li>监控 CDN 流量</li>
</ul>
<h3 data-id="heading-45">5. 回滚策略</h3>
<h4 data-id="heading-46">保留历史版本</h4>
<p>在删除旧文件前，可以先备份：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份当前版本</span>
BACKUP_DIR=<span class="hljs-string">"backup/<span class="hljs-subst">$(date +%Y%m%d_%H%M%S)</span>"</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r oss://bucket/static/ oss://bucket/<span class="hljs-variable">$BACKUP_DIR</span>/ -f
</code></pre>
<h4 data-id="heading-47">快速回滚</h4>
<p>如果需要回滚，可以从备份恢复：</p>
<pre><code class="hljs language-bash" lang="bash">/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r oss://bucket/<span class="hljs-variable">$BACKUP_DIR</span>/static/ oss://bucket/static/ -f
</code></pre>
<hr/>
<h2 data-id="heading-48">问题排查</h2>
<h3 data-id="heading-49">1. 路径问题</h3>
<h4 data-id="heading-50">问题：HTML 中的路径不正确</h4>
<p><strong>症状</strong>：浏览器控制台显示 404 错误</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查 <code>dist/index.html</code> 中的路径</li>
<li>确认 <code>publicPath</code> 配置是否正确</li>
<li>验证 <code>ModifyHtmlPlugin</code> 是否正常运行</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查构建后的 HTML</span>
<span class="hljs-built_in">cat</span> dist/index.html | grep -E <span class="hljs-string">'(href|src)='</span>

<span class="hljs-comment"># 检查环境变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$NODE_ENV</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$VUE_APP_PATH_TYPE</span>
</code></pre>
<h3 data-id="heading-51">2. OSS 连接问题</h3>
<h4 data-id="heading-52">问题：ossutil 连接失败</h4>
<p><strong>症状</strong>：<code>ossutil: No such file or directory</code> 或连接超时</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查 ossutil 是否安装</li>
<li>检查网络连接</li>
<li>验证凭证是否正确</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 ossutil 是否存在</span>
<span class="hljs-built_in">ls</span> -la /root/oss/ossutilarm64

<span class="hljs-comment"># 测试网络连接</span>
ping oss-cn-hangzhou.aliyuncs.com

<span class="hljs-comment"># 测试 OSS 连接</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://bucket-name/
</code></pre>
<h3 data-id="heading-53">3. 上传失败</h3>
<h4 data-id="heading-54">问题：上传过程中断或失败</h4>
<p><strong>症状</strong>：脚本执行失败，部分文件未上传</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查磁盘空间</li>
<li>检查网络稳定性</li>
<li>查看 OSS 控制台的错误日志</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查磁盘空间</span>
<span class="hljs-built_in">df</span> -h

<span class="hljs-comment"># 检查网络</span>
curl -I https://oss-cn-hangzhou.aliyuncs.com

<span class="hljs-comment"># 重试上传</span>
./upload-to-oss-production.sh
</code></pre>
<h3 data-id="heading-55">4. 文件权限问题</h3>
<h4 data-id="heading-56">问题：ossutil 无执行权限</h4>
<p><strong>症状</strong>：<code>Permission denied</code></p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x /root/oss/ossutilarm64
</code></pre>
<h3 data-id="heading-57">5. 脚本语法问题</h3>
<h4 data-id="heading-58">问题：脚本执行报语法错误</h4>
<p><strong>症状</strong>：<code>syntax error: unexpected EOF</code> 等</p>
<p><strong>常见原因</strong>：</p>
<ol>
<li>括号不匹配</li>
<li>引号未闭合</li>
<li>变量名包含特殊字符</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查脚本语法</span>
bash -n upload-to-oss-production.sh

<span class="hljs-comment"># 使用 shellcheck 检查（如果已安装）</span>
shellcheck upload-to-oss-production.sh
</code></pre>
<h3 data-id="heading-59">6. 环境变量问题</h3>
<h4 data-id="heading-60">问题：构建时路径不正确</h4>
<p><strong>症状</strong>：测试环境使用了 CDN 路径，或生产环境使用了相对路径</p>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 package.json 中的脚本</span>
<span class="hljs-built_in">cat</span> package.json | grep -A 5 <span class="hljs-string">'"scripts"'</span>

<span class="hljs-comment"># 确认环境变量设置</span>
<span class="hljs-comment"># 测试环境应该设置 VUE_APP_PATH_TYPE=gray</span>
<span class="hljs-comment"># 生产环境不应该设置此变量</span>
</code></pre>
<hr/>
<h2 data-id="heading-61">总结</h2>
<p>本文详细介绍了 Vue.js 项目将静态资源部署到 OSS 的完整实现过程，包括：</p>
<ol>
<li><strong>配置层面</strong>：通过 Vue CLI 配置实现不同环境的路径处理</li>
<li><strong>工具层面</strong>：OSS 命令行工具的安装和配置</li>
<li><strong>脚本层面</strong>：自动化上传脚本的编写</li>
<li><strong>部署层面</strong>：完整的部署流程</li>
</ol>
<h3 data-id="heading-62">关键要点</h3>
<ul>
<li><strong>环境区分</strong>：测试环境使用相对路径，生产环境使用 CDN</li>
<li><strong>选择性上传</strong>：只上传必要的静态资源目录</li>
<li><strong>路径处理</strong>：通过自定义插件处理特殊文件的路径</li>
<li><strong>自动化</strong>：通过脚本实现一键部署</li>
<li><strong>安全性</strong>：妥善管理 OSS 凭证</li>
<li><strong>可维护性</strong>：清晰的代码结构和完善的错误处理</li>
</ul>
<h3 data-id="heading-63">扩展建议</h3>
<ol>
<li><strong>CI/CD 集成</strong>：将上传脚本集成到 CI/CD 流程中</li>
<li><strong>监控告警</strong>：添加监控和告警机制</li>
<li><strong>多环境支持</strong>：支持多个生产环境的配置</li>
<li><strong>版本管理</strong>：实现更完善的版本管理和回滚机制</li>
</ol>
<p>希望本文能帮助您成功实现静态资源的 OSS 部署！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提醒单纯的技术人，注意和公司签的合同]]></title>    <link>https://juejin.cn/post/7573892650815471631</link>    <guid>https://juejin.cn/post/7573892650815471631</guid>    <pubDate>2025-11-19T01:42:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892650815471631" data-draft-id="7573892650815324175" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提醒单纯的技术人，注意和公司签的合同"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-11-19T01:42:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TF男孩"/> <meta itemprop="url" content="https://juejin.cn/user/615370768790158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提醒单纯的技术人，注意和公司签的合同
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615370768790158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TF男孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:42:02.000Z" title="Wed Nov 19 2025 01:42:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你们公司可能早就买下几十个律师给他们出的策略，为的就是在你身体里种下一粒蛊，他们那里有个遥控器，当你不听话时……不，你必须听话。</p>
</blockquote>
<p>很多人都不了解竞业限制，我也是遇到事儿才开始了解的。以至于仔细翻看10年前刚工作时的合同，发现那时公司就已经开始种蛊了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a8c33fb4444431aa8c095c770b9ff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=kUxgVIcCxdVNENEdfvx5zhkUNwY%3D" alt="" loading="lazy"/></p>
<p>讲这个问题，咱首先得谈它的初心。</p>
<p>竞业限制的出现是为了保护企业的核心机密。想象一下，你开了一家公司，花了5年时间研发出了一款软件，你的公司就靠这个软件生存。结果，有个员工复制这套代码去了你死对头的公司，他们部署完就往外卖。因为他免费偷的，没成本，因此售价是你的一半。结果，你的公司倒闭了。这明显不公平，得加以限制。</p>
<p>于是，法律就有了竞业限制。它比保密协议更严格。保密协议只是让你不乱说话，但竞业限制却让你不能再干这行了。就像你是个知名饭店的厨师，可能掌握他们百年老菜的秘密，如果你把这道菜带去别的饭店，那不行。最好的办法就是让你不再接触炒菜。厨师说那不行，这是我吃饭的手艺，你不能饿死我呀！法律说，好吧，你承诺两年内不去相关行业，企业承诺养你两年。你们达成一致，我立法保护你们。</p>
<p>看起来，这没有什么问题。甚至很融洽，因为签合同是双方自愿的，没有人强迫你。你是个成年人了，有自己的判断力。</p>
<p>但是，既然两者签了合同。那员工按照公司的要求来，我不干这一行了，你要是不给我钱，我就告你。公司也按照合同办事，我养你，但是如果你偷偷去干这一行，我也一样告你。</p>
<p>然而，事情往往会违背它的初心。对于公司，它想既能限制你，又不想给钱。对于员工，他既想拿钱又不想受限制。</p>
<p>于是，他们就闹上公堂，这类案由为“竞业限制”的案件在劳动纠纷中最常见。从裁判文书网来看，它的数量远超过了劳动合同纠纷。而且都是新鲜热乎的，发布没几天。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d6fd716920143f280cfde8e3e71bfa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=RN4lPgDW%2BeyRne1NnYUZ3FHjV10%3D" alt="" loading="lazy"/></p>
<p>下面这个是双方签了协议，虽然员工遵守了，但是公司不给钱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5bbe8a897804665b0c767357925febc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=S4uv2yzUpMHa5btCtWDQp1kmGAI%3D" alt="" loading="lazy"/></p>
<p>下面这个是公司给钱了，但是员工不遵守。一般情况下，员工的违约金都是非常高，一般都是几十万起步（下面这个是要员工赔偿210万）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2875d9b7aa9545adb014bdff956cc82a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=ty1pxqxmDfYyA5DfAVyiRt701CQ%3D" alt="" loading="lazy"/></p>
<p>我之所以写这篇文章，是因为我一个朋友去一家公司面试，HR问他对公司有什么想要了解的。他说，咱们签合同是一式两份吗？HR说不是，任何协议，包括劳动合同、保密协议，都只签一份，留在公司。他说，为什么不给员工一份。HR说，你要这个有什么用呢？没有任何必要。他说，万一拿合同限制我，我会很被动。HR说，你要是没有道德问题，公司为什么要限制你？被限制的人，肯定是道德有问题。</p>
<p>我告诉朋友但凡还能找到其他工作，别去那里了。还搞出来道德问题了。她的这段话，让我想起之前的一个小经历。我曾经入职过一家公司，入职当天就签订了一份保密协议，里面说不能对外泄露公司的源代码什么的，倒也正常。但是里面有一句话很刺眼，说员工离职之后2年内不得入职任何同行业的公司。否则，将向公司赔偿违约金，金额为在职期间工资的总额。</p>
<p>我当时就找HR，我说我肯定要在这个行业混的，而且这个违约金什么意思？HR说模板就是这样的，大家都这么写。于是，我就签了。他们也是只有一份，留给公司。</p>
<p>几年后，我要离职了。我隐约记起这回事，于是问当时和我签协议的HR。那时，她已经离职一年多了，因为受不了公司的各类违规操作走的。她说，其实那个协议是众多法务制定的策略，属于保密协议中的竞业限制条款。大体运行规则是这样的。每一个离职的员工，HR都要加他们的微信，观察他们的动态，甚至询问亲近的同事。一旦发现员工入职了同类公司，就给员工发函要求遵守竞业限制，必要时索要违约金。如果员工去了别的行业，那么就当没有这回事。</p>
<p>那时，我查了查“竞业限制”这四个字。果然，广受诟病。主要是被严重滥用，法律规定竞业限制适用于高级管理人员、高级技术人员以及其他负有保密义务的人员。但是，企业常常和每个员工，比如前台、客服、销售等都签订，说他们是那个“其他”。至于理由嘛，销售掌握的客户信息，如果他们把客户信息带给对手，那岂不是严重损害单位利益。</p>
<p>我们的认识，甚至很多自媒体博主都这么说。公司不给你钱，竞业限制协议就无效。他们的知识来源都是HR。我们看司法实践是怎么样的。</p>
<p>以下是2025年7月发布的一个案例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11838bcb42b4e24921a69ae5ff7001c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=FQcty9t24LZJar%2B9AkYHbp8rz0Q%3D" alt="" loading="lazy"/></p>
<p>周某是一名工程师，离职去了同行业公司，他被原公司起诉，一审法院判他需要向原公司支付18.9万元的违约金。然后周某不服，向上级法院上诉，最终二审维持原判，周某就要向公司支付18.9万元，而且二审认为这还是很仁义了，因为约定的是一百万，只要了他不到20万。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdf887002e2d41fdb8e47d79049549e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=ZfH7KJeksNQO%2F0lPJkx2BzMgNkM%3D" alt="" loading="lazy"/></p>
<p>那我们看周某的遭遇是什么样的呢？他认为自己无罪的理由如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/983d2da9db5844b8bd9361a606fe75e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=ug0tbpWs5p7lbMOx3%2FKoe8sBrt8%3D" alt="" loading="lazy"/></p>
<p>第一，签的不是专门的竞业限制协议书，是隐藏在保密协议中的一项小字条款。而且入职时，以及离职后，公司没有提及与过问。</p>
<p>第二，两年时间内，公司从来没有给过补偿金。不给钱就无效。</p>
<p>因此，周某认为，这个协议无效。</p>
<p>正可谓是：人情似铁非似铁，官法如炉真如炉！</p>
<p>我们看公司那边怎么说的。</p>
<p>第一，字是你签的，签了就要认。我们有这个约定。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/361037c786fc4114919d520737b5dc27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=64W5TTE7%2B9k7Sk6WcJX%2BZ5pfajI%3D" alt="" loading="lazy"/></p>
<p>第二，我们虽然没给钱，但是你有权解除这个协议。然而，你并没有行使这个解除权利，而是直接违约了。因此要赔偿我们。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5522ff92930f474abc6e381269985666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=T2JivwTw7GTzzbFDblqXxMd7kCg%3D" alt="" loading="lazy"/></p>
<p>这里面好像和普通大众理解的不一样。为什么公司违约就行，但是员工违约就不行。我不是研究法律的，但是靠推测就好比你被人打了，你可以去找帽子叔叔维权，这是你的权利，但是你不能直接去打人家（他违法不是你违法的理由）。</p>
<p>后面还有很多拉扯，比如周某说入职的不是竞争对手公司，但是公司这边给出了两家公司的营业执照范围一样等等。</p>
<p>看最终法院怎么判呢？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/444958a1c1f144c0a9487ba2eb846bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=BcehYb5A9HuO7wudmglq1bIT2kQ%3D" alt="" loading="lazy"/></p>
<p>法院认为争议点：1、协议是否有效 2、周某是否违约，违约的话赔多少。</p>
<p>关于第一点，协议有效，签了就是得认可。没约定给多少经济补偿，不影响协议。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7623bd2be546209ec77f7429666066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=B27FoIe%2BuEn6Jmc4XrGji%2FCyem4%3D" alt="" loading="lazy"/></p>
<p>关于第二点，周某确实违约了，得赔钱，但是不是一百万，18.9万就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23a3acd1fc73433aa744cb88f322407d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=b5EDvqGgbRhRrKyKcUMZaDuqeaU%3D" alt="" loading="lazy"/></p>
<p>这里面大家可能还是那个疑问，我感觉公司没给钱协议应当终止呀！</p>
<p>但是，大家要明白，所有判决都要有法律依据。你俩都是成年人，签协议了，你们的协议就受法律保护，你俩都要遵守。也不是说非得有人特别通知或者催促你遵守。但是，却找不到任何一个条文说：他违约，整个协议就自动失效了。他违约不给钱，你有权利去告他，让他给钱。也有权利在一段时间（一般三个月）后申请解除限制，因为他违约，我申请协议失效。但唯独没有权利你直接违约。法官是看文件的，他看的第一个文件是你俩有协议。如果你能拿出第二个文件，证明协议已解除，那么就不用赔钱了。</p>
<p>你们可能觉得离你们很远。其实身边有很多人，已经对簿公堂了。像济南这类二线城市，从大集团当研发，到小培训学校做老师，都被限制了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/183bf330ffd240a095adf4f6345c8342~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=1nDCYOc%2BTYnw%2BePnjsIooq76Who%3D" alt="" loading="lazy"/></p>
<p>你们看，小到一个月几千块钱的音乐老师去别的地方教音乐，也要赔10万。而且也是没有竞业补偿金，因为都包含在工资里面了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140bbc0d657b43cbbdad7b2b9e893278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121322&amp;x-signature=AJsn%2FoH%2F%2B%2FfbTDa6B%2F%2BKezjB5Bw%3D" alt="" loading="lazy"/></p>
<p>最终判决结果是这个小老师需要向学校赔钱，但是数额没有那么多。</p>
<p>以上只是部分案例，各地有各地实践，并不完全统一。但是，有个共同的准则，你是个成年人，也认识字，签了就要认。裁判他们更看重签字和印章。因为故事它不是证据。</p>
<p>立法的初衷是我保你机密，你养我生活。但是，没有企业真的去签一份光明正大的竞业限制协议，多数条款躲在保密协议中或者劳动合同中。签的时候说没什么，这是通用格式条款，对你没影响。就像是在每个员工身体里埋下一颗雷。而遥控器就握在他的手里。</p>
<p>更有甚者，让员工签空白劳动合同，或者签完不给员工。不给员工劳动合同，其实根本不是怕他们劳动仲裁。因为现在管理严格了，社保、报税、对公账户发工资，都可以证明劳动关系。不给员工的目的，主要看中后期公司可以任意添加条款，替换里面的部分页面。反正你手里没有，你也没法反驳我。但是，我手里的有你签名的那一页，我临时新放的条款，你也没有办法拒绝。至于你的复印件或者你自己拍摄的照片嘛，那些都是你自己PS的，现在AI多强大呀，很容易生成的。</p>
<p>国内的员工勤劳肯干，但是再好的牛马，也打动不了部分企业老板的心。企业喜欢控制员工，在他们一入职就种下蛊。平时，你好我好大家好，相安无事。这就好像是原子弹，他们可以不用，但是不能没有。而你，只能每天祈祷与跪拜别被波及到。</p>
<p>据我所知，山东省不给劳动合同的情况很多，很多人都是为了不违逆公司而隐忍。我们没有能力去填坑，但是我们可以不跳进去。坑不坑的很难说，并不绝对，但起码你还没来的时候，就已经想好怎么对付你了。</p>
<p>打工本应该是风险极小的事情，起码不要有赔钱的风险。你干活，他给钱，为什么不能光明正大地进行？</p>
<p>不过，现在越来越完善了。2025年9月4日发布的《企业实施竞业限制合规指引》规定，前台、保安啥的不能签竞业了，并且经过员工提醒一个月不支付或超过三个月不支付，竞业限制可以自动失效。</p>
<p>但是，前提是你手里得有一份原件。否则，依然是只能他打你，你只有挨揍的份儿。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Xcode里自由使用第三方大模型？这个本地代理工具帮你实现！]]></title>    <link>https://juejin.cn/post/7573912365911572522</link>    <guid>https://juejin.cn/post/7573912365911572522</guid>    <pubDate>2025-11-19T01:41:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573912365911572522" data-draft-id="7573971406414512171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Xcode里自由使用第三方大模型？这个本地代理工具帮你实现！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-19T01:41:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大橙子打游戏"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170907086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Xcode里自由使用第三方大模型？这个本地代理工具帮你实现！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170907086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大橙子打游戏
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:41:37.000Z" title="Wed Nov 19 2025 01:41:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在Xcode里自由使用第三方大模型？这个本地代理工具帮你实现！</h2>
<p>作为iOS开发者，你是否也曾羡慕过其他IDE里各种AI辅助编程工具的便捷？是否想在Xcode中也能用上GPT-5、Claude等第三方大模型的强大能力？</p>
<p>今天给大家推荐一个实用工具——<strong>Xcode-Intelligence-Proxy</strong>，这是一个能让你在Xcode中自由使用各类第三方LLM大模型的本地代理服务，从此告别API限制，享受AI辅助编程的高效体验。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dc6a87d25424f52bd2bc515e189e1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=0b1tEfRaFxQ2B7IdsW%2BbtS8KVOw%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">什么是Xcode-Intelligence-Proxy？</h3>
<p>简单来说，这是一个运行在本地的代理服务，它能将Xcode的AI请求转发到你选择的第三方大模型服务，让你突破官方限制，在Xcode中使用更多更强大的AI模型。</p>
<p>项目基于开源社区的Xcode-AI-Proxy改造而来，但做了针对性优化——重点支持各类AI聚合平台，让模型选择更加灵活多样。</p>
<h3 data-id="heading-2">它能帮你解决什么问题？</h3>
<ul>
<li>• 支持更多第三方大模型（如GPT-5、Claude、GLM等）</li>
<li>• 无需依赖单一平台，可自由切换不同模型服务<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c572483fa2b54e128992044af2790dff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=OhEjAc8%2FUm4vRXJYFC0mnUihylg%3D" alt="图片" loading="lazy"/></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56e85cd6c36a4ccca29588967e00edd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=XZtHJPpEf5ZegSSgfVBuZkKgfnc%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/595ec539f01847cca38496d0d0c2cb3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=zEAO7qmD%2F7siQdfsY8Dm3lcfNuU%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3771e7d4c01944d2af12cfc570fafbe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=AvvVqVk14gQK2RM9o3vSrg%2FhebY%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de1356e484cc4d5d9ffc385744c5dc24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764121296&amp;x-signature=zKDml286HopheK%2FnuBssrwZI8so%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">目前已支持的平台</h3>
<h3 data-id="heading-4">当前已接入：</h3>
<ul>
<li>• 贞贞的AI工坊 邀请链接：</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">https://ai.t8star.cn/register?aff=U7mw51175
</code></pre>
<ul>
<li>• 酷爱API 邀请链接</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">https://api.kuai.host/register?<span class="hljs-attr">aff</span>=lziQ
</code></pre>
<p>通过这些聚合平台，你可以间接使用到包括GPT系列、Claude系列、GLM系列等数十种主流大模型，满足不同场景的开发需求。</p>
<h3 data-id="heading-5">如何快速上手？</h3>
<p>使用过程非常简单，只需三步即可完成配置：</p>
<ol>
<li>1. <strong>克隆项目到本地</strong></li>
</ol>

<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/learningpro/Xcode-Intelligence-Proxy.git
<span class="hljs-built_in">cd</span> Xcode-Intelligence-Proxy
</code></pre>
<ol>
<li>1. <strong>配置模型服务</strong> 编辑项目中的<code>models.toml</code>文件，填入你选择的AI平台API密钥：</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[t8star]</span>
<span class="hljs-attr">api_url</span> = <span class="hljs-string">"https://ai.t8star.cn/v1"</span>
<span class="hljs-attr">type</span> = <span class="hljs-string">"t8star"</span>
<span class="hljs-attr">api_key</span> = <span class="hljs-string">"你的API密钥"</span>  <span class="hljs-comment"># 填写从平台获取的密钥</span>
<span class="hljs-attr">models</span> = [
    { id = <span class="hljs-string">"grok-4.1"</span>, name = <span class="hljs-string">"grok-4.1"</span> },
    { id = <span class="hljs-string">"gpt-5.1-2025-11-13"</span>, name = <span class="hljs-string">"gpt-5.1-2025-11-13"</span> }
]
</code></pre>
<ol>
<li>1. <strong>启动服务</strong></li>
</ol>

<pre><code class="hljs language-bash" lang="bash">./start.sh
</code></pre>
<p>服务会默认启动在3000端口，之后你只需按照项目文档中的示例，在Xcode中进行简单配置，就能立即体验AI辅助编程的乐趣了！</p>
<h3 data-id="heading-6">技术实现简介</h3>
<p>项目采用Python的FastAPI框架构建，具有轻量高效的特点：</p>
<ul>
<li>• 通过本地代理服务转换Xcode的请求格式</li>
<li>• 支持流式响应，保持与原生AI体验一致的实时反馈</li>
<li>• 采用TOML配置文件管理不同模型服务</li>
<li>• 支持配置重试机制和超时控制，提升稳定性</li>
<li>• 完整的日志系统，方便排查问题</li>
</ul>
<h3 data-id="heading-7">如何扩展更多模型？</h3>
<p>如果你需要添加新的模型服务，可以：</p>
<ol>
<li>在<code>models.toml</code>中按照示例格式添加新供应商配置</li>
<li>提交PR贡献你的配置，帮助更多开发者</li>
</ol>
<p>项目采用Apache 2.0开源协议，欢迎大家参与开发，共同扩展更多实用功能。</p>
<h3 data-id="heading-8">最后</h3>
<p>Xcode-Intelligence-Proxy为iOS开发者提供了更灵活的AI辅助编程选择，无论是日常开发还是学习研究，都能帮你提升效率。</p>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flearningpro%2FXcode-Intelligence-Proxy" target="_blank" title="https://github.com/learningpro/Xcode-Intelligence-Proxy" ref="nofollow noopener noreferrer">github.com/learningpro…</a></p>
<p>如果你觉得这个工具有用，欢迎分享给更多开发者朋友，也期待你的Star和PR贡献！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SSE服务]]></title>    <link>https://juejin.cn/post/7573912365911621674</link>    <guid>https://juejin.cn/post/7573912365911621674</guid>    <pubDate>2025-11-19T01:45:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573912365911621674" data-draft-id="7573863952116252678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SSE服务"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-19T01:45:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WebGirl"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868584478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SSE服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868584478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WebGirl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:45:26.000Z" title="Wed Nov 19 2025 01:45:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>SSE（Server-Sent Events）</strong> —— 它是一种<strong>服务器向客户端单向实时推送</strong>的通信协议，基于 HTTP 协议实现，无需像 WebSocket 那样建立独立连接，适合需服务器主动推送、客户端仅接收的场景（如实时通知、行情更新）</p>
<h2 data-id="heading-0">核心概念</h2>
<ul>
<li><strong>单向通信</strong>：仅支持服务器向客户端主动推送数据，客户端无法通过 SSE 向服务器发送数据（需搭配 HTTP 接口补充双向通信）。​</li>
<li><strong>基于 HTTP 协议</strong>：复用 HTTP 连接，无需额外创建新协议（如 WebSocket 的 ws://），兼容性更好，服务器部署更简单。​</li>
<li><strong>协议标识</strong>：客户端通过 EventSource API 建立连接，请求头指定 Accept: text/event-stream，服务器以特定格式（文本流）响应。​</li>
<li><strong>核心特性</strong>：​
<ul>
<li>自动重连：客户端连接断开后，默认会自动重试（可配置重连时间）；​</li>
<li>断线重连时可恢复历史数据（通过 Last-Event-ID 实现）；​</li>
<li>支持自定义事件类型，不止于默认的 message 事件；​</li>
<li>仅支持文本数据传输（二进制数据需编码为 Base64）。​</li>
</ul>
</li>
<li><strong>生命周期</strong>：客户端建立连接 → 服务器持续推送文本流 → 客户端断开连接（主动 / 超时）。</li>
</ul>
<h2 data-id="heading-1">基本用法</h2>
<p><strong>1. 前端（浏览器）核心 API：EventSource</strong></p>
<p>浏览器原生支持 EventSource 对象，无需依赖第三方库，核心方法与事件如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 前端：SSE 客户端实现</span>
<span class="hljs-keyword">let</span> eventSource = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 1. 建立 SSE 连接</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initSSE</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 检测浏览器支持（所有现代浏览器均支持，IE 不支持）</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">EventSource</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'当前浏览器不支持 SSE（建议使用 Chrome/Firefox/Edge）'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 建立连接（URL 为后端 SSE 接口，支持跨域，需服务器配置 CORS）</span>
  eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">'http://localhost:8080/sse'</span>, {
    <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 跨域时携带 Cookie（如需）</span>
  });

  <span class="hljs-comment">// 2. 连接建立成功事件</span>
  eventSource.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE 连接已建立'</span>);
    <span class="hljs-comment">// 客户端如需向服务器发数据，需通过 HTTP 接口（如 POST）</span>
    <span class="hljs-comment">// 示例：发送用户登录状态到服务器（SSE 本身不支持客户端→服务器）</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:8080/login'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">'前端用户'</span> }),
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
    });
  };

  <span class="hljs-comment">// 3. 接收服务器默认事件（事件类型为 message）</span>
  eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-comment">// event.data 为服务器推送的文本数据</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到默认消息：'</span>, data);
    <span class="hljs-title function_">handleServerData</span>(<span class="hljs-string">'message'</span>, data);
  };

  <span class="hljs-comment">// 4. 接收服务器自定义事件（如 "notice" 事件）</span>
  eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'notice'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到自定义 notice 事件：'</span>, data);
    <span class="hljs-title function_">handleServerData</span>(<span class="hljs-string">'notice'</span>, data);
  });

  <span class="hljs-comment">// 5. 接收服务器行情事件（如 "stock" 事件）</span>
  eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'stock'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到股票行情：'</span>, data);
    <span class="hljs-title function_">handleServerData</span>(<span class="hljs-string">'stock'</span>, data);
  });

  <span class="hljs-comment">// 6. 连接错误事件（如网络中断、服务器异常）</span>
  eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SSE 连接错误：'</span>, error);
    <span class="hljs-comment">// 错误时会自动重连，可手动处理（如提示用户）</span>
    <span class="hljs-keyword">if</span> (eventSource.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">EventSource</span>.<span class="hljs-property">CLOSED</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE 连接已关闭，等待自动重连...'</span>);
    }
  };

  <span class="hljs-comment">// 7. 连接关闭事件（仅主动关闭时触发，自动重连时不触发）</span>
  eventSource.<span class="hljs-property">onclose</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE 连接已主动关闭'</span>);
  };
}

<span class="hljs-comment">// 处理服务器推送的数据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleServerData</span>(<span class="hljs-params">eventType, data</span>) {
  <span class="hljs-keyword">switch</span> (eventType) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'message'</span>:
      <span class="hljs-comment">// 渲染普通消息</span>
      <span class="hljs-keyword">const</span> msgDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      msgDom.<span class="hljs-property">textContent</span> = <span class="hljs-string">`系统消息：<span class="hljs-subst">${data.content}</span>`</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sse-container'</span>).<span class="hljs-title function_">appendChild</span>(msgDom);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'notice'</span>:
      <span class="hljs-comment">// 渲染通知（弹窗）</span>
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">`【实时通知】<span class="hljs-subst">${data.title}</span>：<span class="hljs-subst">${data.content}</span>`</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'stock'</span>:
      <span class="hljs-comment">// 更新行情数据</span>
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'stock-price'</span>).<span class="hljs-property">textContent</span> = data.<span class="hljs-property">price</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'stock-time'</span>).<span class="hljs-property">textContent</span> = data.<span class="hljs-property">timestamp</span>;
      <span class="hljs-keyword">break</span>;
  }
}

<span class="hljs-comment">// 主动关闭 SSE 连接</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">closeSSE</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (eventSource) {
    eventSource.<span class="hljs-title function_">close</span>(); <span class="hljs-comment">// 关闭后不会自动重连</span>
    eventSource = <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-comment">// 页面加载时建立连接</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, initSSE);

<span class="hljs-comment">// 页面卸载时关闭连接</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, closeSSE);
</code></pre>
<p><strong>2. 后端（Node.js）SSE 服务实现（基于 Express）​</strong></p>
<p>SSE 服务器需持续向客户端发送文本流，需设置特定响应头和数据格式，这里以 Node.js + Express 为例（需安装 express：npm install express）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 后端：Node.js SSE 服务（server.js）</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8080</span>;

<span class="hljs-comment">// 跨域配置（SSE 支持跨域，需允许特定域名）</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'http://localhost:3000'</span>); <span class="hljs-comment">// 允许前端域名</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>); <span class="hljs-comment">// 允许携带 Cookie</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-string">'Content-Type'</span>);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// 解析 JSON 请求体（用于接收客户端 HTTP 接口数据）</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// 存储所有 SSE 连接（用于广播消息）</span>
<span class="hljs-keyword">let</span> sseClients = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();

<span class="hljs-comment">// 1. SSE 核心接口（客户端通过 EventSource 连接此接口）</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/sse'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// 设置 SSE 响应头（关键！）</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/event-stream'</span>); <span class="hljs-comment">// 声明为事件流</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>); <span class="hljs-comment">// 禁用缓存</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>); <span class="hljs-comment">// 保持连接</span>
  res.<span class="hljs-title function_">flushHeaders</span>(); <span class="hljs-comment">// 立即发送响应头（避免缓存）</span>

  <span class="hljs-comment">// 存储当前连接（用于后续推送）</span>
  sseClients.<span class="hljs-title function_">add</span>(res);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'新 SSE 客户端连接，当前连接数：'</span>, sseClients.<span class="hljs-property">size</span>);

  <span class="hljs-comment">// 客户端断开连接时移除</span>
  req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
    sseClients.<span class="hljs-title function_">delete</span>(res);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE 客户端断开连接，当前连接数：'</span>, sseClients.<span class="hljs-property">size</span>);
  });

  <span class="hljs-comment">// 初始推送（连接成功后发送欢迎消息）</span>
  <span class="hljs-title function_">sendSSEMessage</span>(res, <span class="hljs-string">'message'</span>, { <span class="hljs-attr">content</span>: <span class="hljs-string">'欢迎连接 SSE 实时推送服务'</span> });
});

<span class="hljs-comment">// 2. 接收客户端数据的 HTTP 接口（SSE 单向，需补充此接口实现双向通信）</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { username } = req.<span class="hljs-property">body</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户登录：'</span>, username);
  <span class="hljs-comment">// 广播登录通知给所有 SSE 客户端</span>
  <span class="hljs-title function_">broadcastSSEMessage</span>(<span class="hljs-string">'notice'</span>, {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'登录通知'</span>,
    <span class="hljs-attr">content</span>: <span class="hljs-string">`<span class="hljs-subst">${username}</span> 已上线`</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>()
  });
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">'登录成功'</span> });
});

<span class="hljs-comment">// 3. 模拟服务器定时推送数据（如股票行情）</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (sseClients.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// 模拟股票价格波动</span>
  <span class="hljs-keyword">const</span> stockData = {
    <span class="hljs-attr">code</span>: <span class="hljs-string">'600000'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'浦发银行'</span>,
    <span class="hljs-attr">price</span>: (<span class="hljs-number">10</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>()
  };
  <span class="hljs-comment">// 向所有客户端推送行情</span>
  <span class="hljs-title function_">broadcastSSEMessage</span>(<span class="hljs-string">'stock'</span>, stockData);
}, <span class="hljs-number">3000</span>); <span class="hljs-comment">// 每 3 秒推送一次</span>

<span class="hljs-comment">// 工具函数：向单个客户端发送 SSE 消息</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendSSEMessage</span>(<span class="hljs-params">res, eventType = <span class="hljs-string">'message'</span>, data</span>) {
  <span class="hljs-comment">// SSE 数据格式规范（必须严格遵守）：</span>
  <span class="hljs-comment">// 1. 每行以 "\n" 结尾；</span>
  <span class="hljs-comment">// 2. 事件类型：event: 事件名\n；</span>
  <span class="hljs-comment">// 3. 数据：data: 字符串数据\n；</span>
  <span class="hljs-comment">// 4. 可选 ID：id: 消息ID\n；</span>
  <span class="hljs-comment">// 5. 结束符："\n\n"（必须两个换行）</span>
  <span class="hljs-keyword">const</span> message = <span class="hljs-string">`event: <span class="hljs-subst">${eventType}</span>\n`</span> +
                  <span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>\n`</span> +
                  <span class="hljs-string">`id: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>\n`</span> + <span class="hljs-comment">// 用于断线重连时恢复数据</span>
                  <span class="hljs-string">`\n`</span>; <span class="hljs-comment">// 消息结束符</span>
  res.<span class="hljs-title function_">write</span>(message); <span class="hljs-comment">// 发送消息（持续写入流）</span>
}

<span class="hljs-comment">// 工具函数：向所有客户端广播 SSE 消息</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">broadcastSSEMessage</span>(<span class="hljs-params">eventType, data</span>) {
  sseClients.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-comment">// 确保连接未关闭</span>
    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">finished</span>) {
      <span class="hljs-title function_">sendSSEMessage</span>(res, eventType, data);
    }
  });
}

<span class="hljs-comment">// 启动服务器</span>
app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SSE 服务启动成功，地址：http://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p><strong>3. 前端 HTML 结构（实时行情 + 通知示例）</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>SSE 实时推送示例（股票行情 + 通知）<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>浦发银行（600000）<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前价格：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stock-price"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>更新时间：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stock-time"</span>&gt;</span>--<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sse-container"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 20px; padding: 10px; border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeSSE()"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 10px;"</span>&gt;</span>关闭 SSE 连接<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"前端 SSE 核心逻辑.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">核心 API</h2>
<p>前端 EventSource 核心 API</p>









































<table><thead><tr><th>属性 / 方法</th><th>说明</th></tr></thead><tbody><tr><td>new EventSource(url[, options])</td><td>创建 SSE 连接，url 为后端接口，options 可选（如 withCredentials: true 跨域带 Cookie）</td></tr><tr><td>onopen</td><td>连接建立成功时触发</td></tr><tr><td>onmessage</td><td>接收服务器默认 message 事件时触发（event.data 为消息内容）</td></tr><tr><td>onerror</td><td>连接错误或断开时触发（自动重连）</td></tr><tr><td>onclose</td><td>主动调用 close() 后触发（不会自动重连）</td></tr><tr><td>addEventListener(eventType, callback)</td><td>监听服务器自定义事件（如 notice、stock）</td></tr><tr><td>close()</td><td>主动关闭 SSE 连接（关闭后需重新创建 EventSource 实例才能重连）</td></tr><tr><td>readyState</td><td>连接状态：0（CONNECTING，连接中）、1（OPEN，已连接）、2（CLOSED，已关闭）</td></tr></tbody></table>
<h2 data-id="heading-3">数据格式详解</h2>
<p>服务器 SSE 响应格式规范（关键！）​</p>
<p>服务器必须以特定文本格式响应，否则客户端无法解析，核心格式如下：</p>
<pre><code class="hljs language-js" lang="js"># 完整消息格式（每行以 \n 结尾，消息以 \n\n 结束）
<span class="hljs-attr">event</span>: 自定义事件名\n       # 可选，默认 message
<span class="hljs-attr">data</span>: 文本数据（可多行）\n  # 必选，支持 <span class="hljs-title class_">JSON</span> 字符串
<span class="hljs-attr">id</span>: 消息<span class="hljs-variable constant_">ID</span>\n               # 可选，用于断线重连时通过 <span class="hljs-title class_">Last</span>-<span class="hljs-title class_">Event</span>-<span class="hljs-variable constant_">ID</span> 恢复
<span class="hljs-attr">retry</span>: 重连时间（毫秒）\n  # 可选，指定客户端自动重连间隔（默认 3000ms）
\n\n  # 消息结束符（必须两个换行）

# 示例 <span class="hljs-number">1</span>：默认 message 事件
<span class="hljs-attr">data</span>: {<span class="hljs-string">"content"</span>: <span class="hljs-string">"这是默认事件消息"</span>}\n
<span class="hljs-attr">id</span>: <span class="hljs-number">1699999999999</span>\n
\n\n

# 示例 <span class="hljs-number">2</span>：自定义 notice 事件
<span class="hljs-attr">event</span>: notice\n
<span class="hljs-attr">data</span>: {<span class="hljs-string">"title"</span>: <span class="hljs-string">"通知"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"实时通知内容"</span>}\n
<span class="hljs-attr">retry</span>: <span class="hljs-number">5000</span>\n
\n\n

# 示例 <span class="hljs-number">3</span>：多行数据（data 可分多行）
<span class="hljs-attr">data</span>: {\n
<span class="hljs-attr">data</span>: <span class="hljs-string">"content"</span>: <span class="hljs-string">"多行消息"</span>,\n
<span class="hljs-attr">data</span>: <span class="hljs-string">"time"</span>: <span class="hljs-string">"2024-01-01"</span>\n
<span class="hljs-attr">data</span>: }\n
\n\n
</code></pre>
<h2 data-id="heading-4">典型应用场景</h2>
<ul>
<li>实时通知：如系统公告、订单状态更新、消息提醒（无需客户端向服务器反馈）；​</li>
<li>实时数据推送：如股票 / 加密货币行情、体育赛事比分、实时监控数据（服务器持续更新，客户端仅展示）；​</li>
<li>日志流展示：如后台系统操作日志、构建日志实时输出（服务器推送日志，客户端实时渲染）；​</li>
<li>新闻 / 资讯推送：如实时新闻、活动更新（服务器有新内容时主动推送给客户端）。​</li>
</ul>
<h2 data-id="heading-5">进阶用法与优化</h2>
<h3 data-id="heading-6">1. 断线重连与历史数据恢复</h3>
<p>SSE 原生支持通过 Last-Event-ID 恢复历史数据，客户端重连时会在请求头携带上次接收的 id，服务器可据此推送未接收的消息：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 后端：获取客户端 Last-Event-ID，恢复历史数据</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/sse'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> lastEventId = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'last-event-id'</span>]; <span class="hljs-comment">// 客户端重连时携带</span>
  <span class="hljs-keyword">if</span> (lastEventId) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'客户端重连，上次消息 ID：'</span>, lastEventId);
    <span class="hljs-comment">// 模拟恢复历史数据（实际场景从数据库/缓存查询）</span>
    <span class="hljs-keyword">const</span> historyData = { <span class="hljs-attr">content</span>: <span class="hljs-string">'恢复断线前未接收的消息'</span> };
    <span class="hljs-title function_">sendSSEMessage</span>(res, <span class="hljs-string">'message'</span>, historyData);
  }
  <span class="hljs-comment">// ... 其余逻辑不变</span>
});
</code></pre>
<h3 data-id="heading-7">2. 自定义重连时间</h3>
<p>服务器可通过 retry 字段指定客户端自动重连间隔，客户端也可通过 eventSource.retry 读取（但无法修改，需服务器返回）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 服务器响应时添加 retry 字段（客户端重连间隔改为 5 秒）</span>
<span class="hljs-keyword">const</span> message = <span class="hljs-string">`event: notice\n`</span> +
                <span class="hljs-string">`data: {"content": "自定义重连间隔"}\n`</span> +
                <span class="hljs-string">`retry: 500&lt;/doubaocanvas&gt;
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ConcurrentHashMap 重要方法实现原理和源码解析（一）]]></title>    <link>https://juejin.cn/post/7573890735579070474</link>    <guid>https://juejin.cn/post/7573890735579070474</guid>    <pubDate>2025-11-18T15:55:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735579070474" data-draft-id="7573896789365850150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ConcurrentHashMap 重要方法实现原理和源码解析（一）"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-18T15:55:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moe488"/> <meta itemprop="url" content="https://juejin.cn/user/1863002275971387"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ConcurrentHashMap 重要方法实现原理和源码解析（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1863002275971387/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moe488
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T15:55:56.000Z" title="Tue Nov 18 2025 15:55:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Node 内部类</h2>
<p>ConcurrentHashMap 内部有一个内部类 <code>Node</code>，实现了 <code>Map.Entry</code> 接口，作为 HashMap 内部的链表节点。</p>
<h3 data-id="heading-1">核心特性</h3>
<ul>
<li><strong>hashCode</strong>：<code>key.hashCode() ^ val.hashCode()</code></li>
<li><strong>toString</strong>：<code>key + "=" + val</code></li>
</ul>
<h3 data-id="heading-2">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>.Entry&lt;K,V&gt; {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    <span class="hljs-keyword">volatile</span> V val;
    <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt; next;
    
    Node(<span class="hljs-type">int</span> hash, K key, V val, Node&lt;K,V&gt; next) {
        <span class="hljs-built_in">this</span>.hash = hash;
        <span class="hljs-built_in">this</span>.key = key;
        <span class="hljs-built_in">this</span>.val = val;
        <span class="hljs-built_in">this</span>.next = next;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> K <span class="hljs-title function_">getKey</span><span class="hljs-params">()</span>       { <span class="hljs-keyword">return</span> key; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span>     { <span class="hljs-keyword">return</span> val; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span>   { <span class="hljs-keyword">return</span> key.hashCode() ^ val.hashCode(); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>{ <span class="hljs-keyword">return</span> key + <span class="hljs-string">"="</span> + val; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title function_">setValue</span><span class="hljs-params">(V value)</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }
}
</code></pre>
<h2 data-id="heading-3">二、带初始大小的构造函数</h2>
<h3 data-id="heading-4">核心逻辑</h3>
<ol>
<li><strong>参数校验</strong>：如果初始化数小于 0，抛出非法数字异常</li>
<li><strong>容量上限</strong>：如果初始大小大于最大限制长度的一半，就设置为 <code>MAXIMUM_CAPACITY</code></li>
<li><strong>容量优化</strong>：分两步理解
<ul>
<li><strong>步骤一</strong>：先计算「扩容后候选值」：<code>initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1</code>
<ul>
<li><code>initialCapacity &gt;&gt;&gt; 1</code>：右移 1 位等价于「整数除法 2」（例如 <code>initialCapacity=10</code>，<code>10&gt;&gt;&gt;1=5</code>）</li>
<li>整体计算结果：<code>initialCapacity * 1.5 + 1</code>（例如 <code>initialCapacity=10</code>，<code>10+5+1=16</code>；<code>initialCapacity=20</code>，<code>20+10+1=31</code>）</li>
<li>目的：预留充足空间，减少扩容次数</li>
</ul>
</li>
<li><strong>步骤二</strong>：通过 <code>tableSizeFor</code> 调整为「2 的幂」
<ul>
<li><code>tableSizeFor</code> 是 ConcurrentHashMap 的核心工具方法，作用是：返回大于等于输入值的最小的 2 的幂（例如输入 16，输出 16；输入 31，输出 32；输入 58，输出 64）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">为什么必须是 2 的幂？</h3>
<ol>
<li><strong>哈希分布均匀</strong>：底层哈希表的元素定位依赖「哈希值 &amp; (容量 - 1)」（位运算替代取模，效率更高），而只有 2 的幂的「容量 - 1」是全 1 二进制（例如容量 16，<code>15=0b1111</code>），能保证哈希值均匀分布，避免哈希冲突集中</li>
<li><strong>并发扩容基础</strong>：2 的幂容量是 ConcurrentHashMap 并发扩容（分段扩容、transfer 机制）的基础</li>
<li><strong>高效扩容</strong>：HashMap 在自动扩容的时候，是按两倍进行扩容的，两倍扩容的好处是原来的索引在两倍扩容之后计算新的索引，新索引只会有两种情况：
<ul>
<li>一种是索引不变</li>
<li>一种是索引长度加原来 HashMap 的长度</li>
<li>数据迁移的时候，分割成两部分（红黑树或者子链）头结点拼接就好</li>
<li>判断索引长度是否变化也只需要执行一条位运算语句就行（<code>(hash &amp; oldCap) == 0</code> → 不变，<code>== 1</code> → 长度加 <code>oldCap</code>）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> {
    <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();
    <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="hljs-number">1</span>)) 
        ? MAXIMUM_CAPACITY 
        : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>));
    <span class="hljs-built_in">this</span>.sizeCtl = cap;
}
</code></pre>
<h2 data-id="heading-7">三、size() 方法</h2>
<h3 data-id="heading-8">核心方法：sumCount()</h3>
<p><code>sumCount()</code> 是真正实现 HashMap 长度计算的关键方法。</p>
<h3 data-id="heading-9">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> sumCount();
    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> : (n &gt; (<span class="hljs-type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (<span class="hljs-type">int</span>)n);
}

<span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sumCount</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. 拿到分段计数器数组的引用（as 是局部变量，避免遍历中数组被修改的影响）</span>
    CounterCell[] as = counterCells;
    <span class="hljs-comment">// 2. 临时变量，用于遍历中存储单个 CounterCell</span>
    CounterCell a;
    <span class="hljs-comment">// 3. 初始化总和：先累加基础计数器 baseCount 的值</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> baseCount;
    <span class="hljs-comment">// 4. 若分段计数器数组不为 null（说明存在高并发竞争，有分散的计数）</span>
    <span class="hljs-keyword">if</span> (as != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 5. 遍历所有分段计数器</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; as.length; ++i) {
            <span class="hljs-comment">// 6. 若当前分段计数器不为 null，累加其 value 值</span>
            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-literal">null</span>)
                sum += a.value;
        }
    }
    <span class="hljs-comment">// 7. 返回总和（baseCount + 所有 CounterCell.value 的和）</span>
    <span class="hljs-keyword">return</span> sum;
}
</code></pre>
<h2 data-id="heading-10">四、get(key) 方法</h2>
<h3 data-id="heading-11">实现说明</h3>
<ol>
<li><strong>计算哈希值</strong>：获取传入参数 key 的 hashCode 值（进行二次 hash 减少碰撞）</li>
<li><strong>前置校验</strong>：校验 HashMap 是否进行初始化，table 中是否有 hash 值相同的节点（若是用链表或者红黑树解决冲突，整个结构中的节点 hash 值都是一样的，所以返回头节点）</li>
<li><strong>匹配逻辑</strong>：
<ul>
<li><strong>情况一</strong>：当前节点（头节点），通过引用地址判断和 equals 内容判断符合，返回当前节点的 val</li>
<li><strong>情况二</strong>：<code>hash &lt; 0</code>，说明当前结构是特殊数据结构：红黑树，调用对应的 <code>e.find()</code> 方法查找是否有符合的节点（同样是引用地址一致或者内容一致）</li>
<li><strong>情况三</strong>：普通的拉链法解决的 hash 冲突，while 循环调用 <code>next()</code> 进行判断</li>
<li><strong>情况四</strong>：没有匹配的返回 null</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> {
    <span class="hljs-comment">// 局部变量：tab=哈希表数组，e=当前遍历的节点，p=特殊节点的查找结果；n=数组长度，eh=当前节点的hash，ek=当前节点的key</span>
    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="hljs-type">int</span> n, eh; K ek;
    <span class="hljs-comment">// 1. 计算key的最终哈希值（二次哈希，减少碰撞）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> spread(key.hashCode());
    <span class="hljs-comment">// 2. 校验哈希表是否初始化、数组长度有效，且目标索引存在节点（核心前置判断）</span>
    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp; (e = tabAt(tab, (n - <span class="hljs-number">1</span>) &amp; h)) != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 3. 情况1：当前节点的hash与计算的hash完全匹配（直接命中候选节点）</span>
        <span class="hljs-keyword">if</span> ((eh = e.hash) == h) {
            <span class="hljs-comment">// 对比key：先==（地址/基本类型）再equals（内容），兼顾性能和正确性</span>
            <span class="hljs-keyword">if</span> ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))
                <span class="hljs-keyword">return</span> e.val; <span class="hljs-comment">// 命中，返回value</span>
        }
        <span class="hljs-comment">// 4. 情况2：当前节点是特殊节点（eh&lt;0，hash为负数）</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (eh &lt; <span class="hljs-number">0</span>)
            <span class="hljs-comment">// 调用特殊节点的find方法查找（适配扩容、红黑树等场景）</span>
            <span class="hljs-keyword">return</span> (p = e.find(h, key)) != <span class="hljs-literal">null</span> ? p.val : <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// 5. 情况3：普通链表节点，循环遍历查找</span>
        <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 对比hash（快速排除）和key（精确匹配）</span>
            <span class="hljs-keyword">if</span> (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek))))
                <span class="hljs-keyword">return</span> e.val;
        }
    }
    <span class="hljs-comment">// 6. 未找到（table未初始化/索引无节点/遍历无匹配key）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h2 data-id="heading-13">五、containsKey() 方法</h2>
<h3 data-id="heading-14">实现说明</h3>
<p><code>containsKey()</code> 的实现很简单，就是内部调用 <code>get(key)</code>，要是返回结果不为 null 说明存在，返回 null 说明不存在，返回 false。</p>
<h2 data-id="heading-15">六、containsValue(Object value) 方法</h2>
<h3 data-id="heading-16">背景铺垫</h3>
<ol>
<li><strong>value 的特性</strong>：与 key 不同，value 没有哈希值，无法通过哈希计算直接定位，只能通过「全表扫描」遍历所有节点判断，因此时间复杂度为 O(n)（n 为总键值对数量），效率远低于 <code>get(key)</code>（O(1) 或 O(logn)）</li>
<li><strong>并发安全基础</strong>：延续 ConcurrentHashMap 的核心设计 —— table 数组是 volatile、Node.val 是 volatile，确保遍历过程中能读取到最新的节点数据；特殊节点（如扩容标记 ForwardingNode、红黑树容器 TreeBin）需特殊处理，避免遍历遗漏或读取脏数据</li>
<li><strong>遍历器 Traverser</strong>：ConcurrentHashMap 的内部专用遍历器，负责「安全遍历哈希表的所有节点」，自动适配链表、红黑树、扩容等场景，无需手动处理特殊节点逻辑</li>
</ol>
<h3 data-id="heading-17">实现说明</h3>
<ol>
<li><strong>参数校验</strong>：<code>value == null</code> 是非法参数，ConcurrentHashMap 不允许 value 为 null，否则返回空指针异常</li>
<li><strong>获取 Traverser</strong>：全局遍历器，会从 table 的 0 序号位开始，一直遍历到最后</li>
<li><strong>遍历匹配</strong>：使用 <code>Traverser.advance()</code> 获取下一个节点，通过引用地址相同和 equals 内容相等进行判断</li>
</ol>
<h3 data-id="heading-18">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsValue</span><span class="hljs-params">(Object value)</span> {
    <span class="hljs-comment">// 1. 非法参数校验：ConcurrentHashMap 不允许 value 为 null，直接抛空指针异常</span>
    <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
    <span class="hljs-comment">// 2. 局部变量：t = 哈希表数组</span>
    Node&lt;K,V&gt;[] t;
    <span class="hljs-comment">// 3. 校验哈希表是否已初始化（未初始化则直接返回 false，无任何键值对）</span>
    <span class="hljs-keyword">if</span> ((t = table) != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 4. 创建全表遍历器 Traverser：遍历范围是整个哈希表（从索引 0 到 t.length-1）</span>
        Traverser&lt;K,V&gt; it = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Traverser</span>&lt;K,V&gt;(t, t.length, <span class="hljs-number">0</span>, t.length);
        <span class="hljs-comment">// 5. 循环遍历所有节点：it.advance() 获取下一个有效节点，直到返回 null（遍历结束）</span>
        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p; (p = it.advance()) != <span class="hljs-literal">null</span>; ) {
            <span class="hljs-comment">// 6. 局部变量：v = 当前节点的 value</span>
            V v;
            <span class="hljs-comment">// 7. value 匹配逻辑：先 ==（地址/基本类型）再 equals（内容），兼顾性能和正确性</span>
            <span class="hljs-keyword">if</span> ((v = p.val) == value || (v != <span class="hljs-literal">null</span> &amp;&amp; value.equals(v)))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 匹配成功，立即返回 true</span>
        }
    }
    <span class="hljs-comment">// 8. 未找到匹配的 value（table 未初始化/遍历全表无匹配）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h2 data-id="heading-19">七、put() 方法</h2>
<h3 data-id="heading-20">说明</h3>
<p><code>onlyIfAbsent</code> 作用：</p>
<ul>
<li><code>true</code>：只有当 key 不存在的时候才能够放入</li>
<li><code>false</code>：当 key 存在的时候会替换掉旧值</li>
</ul>
<h3 data-id="heading-21">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    <span class="hljs-comment">// key、value、onlyIfAbsent</span>
    <span class="hljs-keyword">return</span> putVal(key, value, <span class="hljs-literal">false</span>);
}
</code></pre>
<h2 data-id="heading-22">八、putVal() 方法</h2>
<p><code>putVal(K key, V value, boolean onlyIfAbsent)</code> 是 ConcurrentHashMap 中并发安全的键值对插入/更新核心方法（put、putIfAbsent 等公开方法均依赖此方法），核心目标是：</p>
<ol>
<li>在高并发场景下，安全地向哈希表插入键值对，避免数据竞争和脏读/写</li>
<li>支持两种语义：<code>onlyIfAbsent=true</code> 时「不存在则插入」（不覆盖已有值），<code>onlyIfAbsent=false</code> 时「存在则更新、不存在则插入」</li>
<li>自动处理哈希表初始化、并发扩容、链表红黑树转换等底层细节，兼顾并发安全性和操作效率</li>
</ol>
<p>其设计核心是「细粒度锁（桶级锁）+ 无锁 CAS + 并发协作」：通过最小粒度的锁（仅锁定单个桶的头节点）减少锁竞争，空桶插入用 CAS 避免加锁，扩容时支持多线程协作，最大化并发性能。</p>
<h3 data-id="heading-23">背景铺垫</h3>
<p><strong>核心约束</strong>：</p>
<ul>
<li>key 和 value 均不允许为 null（与 HashMap 区别），避免并发场景下的歧义；ConcurrentHashMap 是线程安全的，在 JDK 1.8 之后使用了 synchronized 锁，持有锁的对象是 Map.Entry，要是允许 key 和 value 为 null，会出现并发歧义</li>
</ul>
<p><strong>锁机制</strong>：Java 8+ 取消分段锁（锁的粒度大，并发效率低），改用「桶级 synchronized 锁」（锁定每个桶的头节点），锁粒度更小，并发冲突概率更低</p>
<p><strong>节点类型</strong>：</p>
<ul>
<li>普通链表节点（Node）：<code>hash &gt;= 0</code>，存储键值对和 next 指针</li>
<li>特殊节点：<code>hash &lt; 0</code>（<code>MOVED=-1</code> 扩容标记、<code>TreeBin=-2</code> 红黑树容器）</li>
</ul>
<p><strong>并发扩容</strong>：支持多线程协同扩容（<code>helpTransfer</code>），避免单线程扩容瓶颈（导致扩容的线程，扩容过程中执行 put 方法的线程都加进来）</p>
<p><strong>自适应结构</strong>：链表长度超过阈值（默认 8）且表容量 ≥ 64 时，自动转为红黑树（TreeBin），优化查询效率，要是 table 的大小没有达到 64，不会升级为红黑树，而是执行扩容。</p>
<h3 data-id="heading-24">实现说明</h3>
<ol>
<li><strong>参数校验</strong>：key 或者 value 为 null，抛出 NullPointer 异常</li>
<li><strong>计算哈希值</strong>：获取 key 的二次哈希值，设置 <code>binCount</code>，作用是记录链表或者红黑树节点数，用于判断是否要考虑将当前的链表转为红黑树</li>
<li><strong>死循环重试</strong>：进入一个死循环的 for，因为并发场景下可能会出现没有初始化，或者需要扩容后重新定位，链表升级为红黑树之后的重新定位，所以设计死循环，没有出口，直到数据存储成功了才会退出</li>
<li><strong>四个场景处理</strong>：
<ul>
<li><strong>场景一</strong>：table 为 null 或者 table 的长度为 0，通过 <code>initTable()</code> 方法进行初始化（线程安全的初始化方法（CAS 控制，避免重复初始化））</li>
<li><strong>场景二</strong>：通过 <code>tabAt</code> 方法获取桶列表（索引所在节点），要是为 null，说明该索引目前没有使用，不存在 hash 冲突和旧值，通过 <code>casTabAt</code> 方法插入新节点（目标桶为空（通过 CAS 原子插入节点，无锁操作（乐观锁操作）），CAS 插入新节点：对比 <code>tab[i]</code> 是否为 null，是则插入新 Node，成功则跳出循环，空桶插入无锁，性能最优）</li>
<li><strong>场景三</strong>：目标桶的头节点是扩容标记（<code>MOVED=-1</code>）协助扩容，<code>else if ((fh = f.hash) == MOVED) tab = helpTransfer(tab, f);</code> // 当前线程参与扩容，扩容后重新获取 table 重试</li>
<li><strong>场景四</strong>：目标桶有节点（非空、非扩容）加锁插入/更新（桶级锁）
<ul>
<li>通过 <code>synchronized (f)</code>，锁定当前桶的头节点 f，锁粒度为桶，不影响其他桶的操作，并发效率高</li>
<li>通过 <code>tabAt(tab, i) == f</code>，进行二次验证确保加锁前，当前桶的头节点未被其他线程修改（如扩容迁移、转红黑树）</li>
<li><strong>子场景 4.1</strong>：头节点是链表节点（<code>fh&gt;=0</code>）
<ul>
<li><code>binCount = 1;</code> // 初始化链表节点计数（从 1 开始，包含头节点）</li>
<li><code>for (Node&lt;K,V&gt; e = f;; ++binCount)</code> // 遍历链表，查找 key 是否存在</li>
<li>找到相同 key：判断是否需要更新 value</li>
<li>保存前置节点，遍历到链表尾部：插入新节点到尾部</li>
</ul>
</li>
<li><strong>子场景 4.2</strong>：头节点是红黑树容器（TreeBin，<code>fh=-2</code>）
<ul>
<li><code>binCount = 2;</code> // 红黑树节点计数设为 2（无需精确计数，仅用于触发转树判断）</li>
<li>调用红黑树的插入方法，返回已存在的节点（若 key 已存在）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>后续处理</strong>：循环的最后，判断是否执行扩容或者升级为红黑树操作：
<ul>
<li>加锁操作后：处理链表转红黑树和返回值</li>
<li>若链表长度 ≥ 阈值（默认 8），触发链表转红黑树（或扩容）</li>
<li>若 key 已存在，返回旧 value</li>
<li>插入新节点成功，跳出循环</li>
</ul>
</li>
<li><strong>计数更新</strong>：插入成功后，更新哈希表的键值对计数（baseCount 或 CounterCell）</li>
</ol>
<h3 data-id="heading-25">源码实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent)</span> {
    <span class="hljs-comment">// 1. 非法参数校验：key/value 为 null 直接抛空指针（ConcurrentHashMap 禁止 null 键值）</span>
    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
    <span class="hljs-comment">// 2. 二次哈希：减少哈希碰撞，保证 key 均匀分布（与 get 方法的 spread 逻辑一致）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> spread(key.hashCode());
    <span class="hljs-comment">// 3. 桶内节点计数：用于判断是否需要将链表转为红黑树</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 4. 死循环重试：并发场景下需重试（如初始化、扩容后需重新定位），直到插入/更新成功</span>
    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) {
        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> n, i, fh;
        <span class="hljs-comment">// 场景 1：哈希表未初始化（tab==null）或容量为 0  初始化 table</span>
        <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)
            tab = initTable(); <span class="hljs-comment">// 线程安全的初始化方法（CAS 控制，避免重复初始化）</span>
        <span class="hljs-comment">// 场景 2：目标桶为空（通过 CAS 原子插入节点，无锁操作）</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// CAS 插入新节点：对比 tab[i] 是否为 null，是则插入新 Node，成功则跳出循环</span>
            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="hljs-literal">null</span>)))
                <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 空桶插入无锁，性能最优</span>
        }
        <span class="hljs-comment">// 场景 3：目标桶的头节点是扩容标记（MOVED=-1） 协助扩容</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)
            tab = helpTransfer(tab, f); <span class="hljs-comment">// 当前线程参与扩容，扩容后重新获取 table 重试</span>
        <span class="hljs-comment">// 场景 4：目标桶有节点（非空、非扩容） 加锁插入/更新（桶级锁）</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-comment">// 锁定当前桶的头节点 f：锁粒度为桶，不影响其他桶的操作，并发效率高</span>
            <span class="hljs-keyword">synchronized</span> (f) {
                <span class="hljs-comment">// 二次校验：确保加锁前，当前桶的头节点未被其他线程修改（如扩容迁移、转红黑树）</span>
                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) {
                    <span class="hljs-comment">// 子场景 4.1：头节点是链表节点（fh&gt;=0）</span>
                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) {
                        binCount = <span class="hljs-number">1</span>; <span class="hljs-comment">// 初始化链表节点计数（从 1 开始，包含头节点）</span>
                        <span class="hljs-comment">// 遍历链表，查找 key 是否存在</span>
                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) {
                            K ek;
                            <span class="hljs-comment">// 找到相同 key：判断是否需要更新 value</span>
                            <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))) {
                                oldVal = e.val; <span class="hljs-comment">// 记录旧 value</span>
                                <span class="hljs-keyword">if</span> (!onlyIfAbsent) <span class="hljs-comment">// onlyIfAbsent=false 时覆盖旧值</span>
                                    e.val = value;
                                <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 跳出循环，插入/更新完成</span>
                            }
                            Node&lt;K,V&gt; pred = e; <span class="hljs-comment">// 前驱节点</span>
                            <span class="hljs-comment">// 遍历到链表尾部：插入新节点到尾部</span>
                            <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-literal">null</span>) {
                                pred.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="hljs-literal">null</span>);
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                    }
                    <span class="hljs-comment">// 子场景 4.2：头节点是红黑树容器（TreeBin，fh=-2）</span>
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) {
                        Node&lt;K,V&gt; p;
                        binCount = <span class="hljs-number">2</span>; <span class="hljs-comment">// 红黑树节点计数设为 2（随便设置的，只要不大于8就可以了，目的是不触发下面的判断是否要进行链表转树操作）</span>
                        <span class="hljs-comment">// 调用红黑树的插入方法，返回已存在的节点（若 key 已存在）</span>
                        <span class="hljs-keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != <span class="hljs-literal">null</span>) {
                            oldVal = p.val;
                            <span class="hljs-keyword">if</span> (!onlyIfAbsent) <span class="hljs-comment">// 覆盖旧值</span>
                                p.val = value;
                        }
                    }
                }
            }
            <span class="hljs-comment">// 加锁操作后：处理链表转红黑树和返回值</span>
            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 若链表长度阈值（默认 8），触发链表转红黑树（或扩容）（已经是红黑树的默认设置为2，永远不会触发）</span>
                <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)
                    treeifyBin(tab, i);
                <span class="hljs-comment">// 若 key 已存在，返回旧 value</span>
                <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-literal">null</span>)
                    <span class="hljs-keyword">return</span> oldVal;
                <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 插入新节点成功，跳出循环</span>
            }
        }
    }
    <span class="hljs-comment">// 5. 插入成功后，更新哈希表的键值对计数（baseCount 或 CounterCell）</span>
    addCount(<span class="hljs-number">1L</span>, binCount);
    <span class="hljs-comment">// 6. 插入新节点（key 不存在），返回 null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h3 data-id="heading-26">计数更新（addCount）</h3>
<p>插入新节点后，调用 <code>addCount(1L, binCount)</code> 更新总键值对数量；
计数逻辑：延续 <code>sumCount</code> 的设计，低并发时更新 <code>baseCount</code>（CAS），高并发时分散到 <code>CounterCell[]</code> 数组，避免计数竞争；
<code>binCount</code> 作用：辅助判断是否需要扩容（若总计数 ≥ <code>sizeCtl</code> 阈值，触发扩容）。</p>
<p>后续：<a href="https://juejin.cn/spost/7573899782803193902" target="_blank" title="https://juejin.cn/spost/7573899782803193902">juejin.cn/spost/75738…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gird布局详解]]></title>    <link>https://juejin.cn/post/7573890735578923018</link>    <guid>https://juejin.cn/post/7573890735578923018</guid>    <pubDate>2025-11-18T13:16:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735578923018" data-draft-id="7573899782802882606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gird布局详解"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-18T13:16:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嬉皮客"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825074285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gird布局详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825074285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嬉皮客
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:16:08.000Z" title="Tue Nov 18 2025 13:16:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、什么是 Grid 布局？</h3>
<p><strong>CSS Grid Layout</strong>（网格布局）是 CSS 提供的二维布局系统，可以同时在行（row）和列（column）两个方向上对元素进行排列。<br/>
它和 Flexbox 不同，Flexbox 是一维布局（只能按行或列排），而 Grid 是二维布局，可以轻松实现复杂的跨行、跨列布局。</p>
<p><strong>特点：</strong></p>
<ul>
<li><strong>二维布局</strong>：同时控制行和列，对应一维布局复杂度也随之增加</li>
<li><strong>跨行跨列</strong>：元素可以跨多个单元格，一维度布局需要层层嵌套来做这些效果</li>
<li><strong>语义清晰</strong>：<code>grid-template-areas</code> 像地图一样描述布局，布局就像ASCLL表一样清晰直观</li>
<li><strong>响应式友好</strong>：只改 Grid 定义，不动 HTML，就能重排布局，经常配合<code>@media</code>使用</li>
<li><strong>现代浏览器支持好</strong>：桌面端和移动端几乎全覆盖（IE11 部分支持旧语法），现代浏览器基本都是支持的，排除一下老旧项目（政府、银行等）还在使用</li>
</ul>
<h3 data-id="heading-1">二、基本概念</h3>
<h4 data-id="heading-2">容器和项目</h4>
<h5 data-id="heading-3">什么是容器？</h5>
<p>设置了 <code>display: grid</code> 或 <code>display: inline-grid</code> 的元素，就是 <strong>Grid 容器</strong>，容器的<strong>直接子元素</strong>就是 <strong>Grid 项目</strong>。容器负责定义整个网格的结构（行、列、间距、对齐方式等）。</p>
<h5 data-id="heading-4">什么是项目？</h5>
<p>Grid 容器的<strong>直接子元素</strong>就是 Grid 项目，项目可以通过属性控制它在网格中的位置、跨行跨列、对齐方式等。</p>
<h4 data-id="heading-5">行和列</h4>
<p>容器里面的水平区域称为"行"（row），垂直区域称为"列"（column）。</p>
<p>下图水平深色区域就是“行”，垂直深色区域就是“列”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d77bc153c40a4f0dbe7696b4676b15f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=GG3RYyhWVrxoZcAXFccu6YgTP4M%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">单元格</h4>
<p>行和列的交叉区域，称为"单元格"（cell），<code>n</code>行和<code>m</code>列会产生<code>n x m</code>个单元格。比如，3行3列会产生9个单元格。</p>
<h4 data-id="heading-7">网格线</h4>
<p>划分网格的线，称为"网格线"（grid line）。水平网格线划分出行，垂直网格线划分出列，<code>n</code>行有<code>n + 1</code>根水平网格线，<code>m</code>列有<code>m + 1</code>根垂直网格线，比如三行就有四根水平网格线。</p>
<p>如下图就有5根水平网格线和5根垂直网格线</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4adf9e1886bf4dd9b0a006bf24558d35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=DwVDDPIWwOweW67Fj8cU9318hqU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">三、容器属性</h3>
<h4 data-id="heading-9">display：grid | inline-grid</h4>
<p>作用：指定一个容器采用网格布局</p>
<p>语法：</p>
<pre><code class="hljs language-arduino" lang="arduino">.container{
    display: grid | <span class="hljs-keyword">inline</span>-grid;
}
</code></pre>
<p>注意：设为网格布局以后，容器子元素（项目）的<code>float</code>、<code>display: inline-block</code>、<code>display: table-cell</code>、<code>vertical-align</code>和<code>column-*</code>等设置都将失效。</p>
<h4 data-id="heading-10">grid-template-columns与grid-template-rows</h4>
<p>作用：<code>grid-template-columns</code>属性定义每一列的列宽，<code>grid-template-rows</code>属性定义每一行的行高</p>
<p>实例：指定了一个三行三列的网格，列宽和行高都是<code>100px</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/822867f0454547aca0a1aa1754041010~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=74oai%2FetrHjRQe1hENM9atAPaIs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span> <span class="hljs-number">100px</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">100px</span> <span class="hljs-number">100px</span> <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h5 data-id="heading-11">repeat()</h5>
<p>作用：使用<code>repeat()</code>函数，简化重复的值，接受两个参数，第一个参数是重复的次数，第二个参数是所要重复的值，也可以重复某个模式</p>
<p>实例：</p>
<ul>
<li>简单重复值</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b09c204c70344d8c86d4f83b970633a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=D%2FQKcb8V0uajMOmJOVMbtVYyNgE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}
<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li>重复某个模式</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e41dbbe095a74a928f69906d3f73f979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=jNHvMw8iAqJ02ioIXZGYfUNrFus%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}
<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<h5 data-id="heading-12">auto-fill与auto-fit</h5>
<p>作用：单元格的大小是固定的，但是容器的大小不确定。如果希望每一行（或每一列）容纳尽可能多的单元格，这时可以使用<code>auto-fill</code>关键字表示自动填充，只有当容器足够宽，可以在一行容纳所有单元格，并且单元格宽度不固定的时候，才会有差异：<code>auto-fill</code>会用空格子填满剩余宽度，<code>auto-fit</code>则会尽量扩大单元格的宽度</p>
<p>实例：</p>
<p>例子中宽设置了400px，高设置200px，属性auto-fill，高400px/100px=4个格子，宽200px/100px=2个格子，所以超出的第九个被空放了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/120911f35e794b1293cc7304bd9e0c18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=VuRwvcDTj33KjyP%2Be7PhBUs5p5k%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-number">100px</span>);
}
</code></pre>
<h5 data-id="heading-13">fr</h5>
<p>作用：为了方便表示比例关系，网格布局提供了<code>fr</code>关键字（fraction 的缩写，意为"片段"）。如果两列的宽度分别为<code>1fr</code>和<code>2fr</code>，就表示后者是前者的两倍</p>
<p>实例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb3585fd825e44a3a15445336bf255bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=Dvsqwxx3ZWBB95STTl%2Fim%2BE7%2FW0%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">300px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">2</span>fr;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}
</code></pre>
<h5 data-id="heading-14">minmax</h5>
<p>作用：<code>minmax()</code>函数产生一个长度范围，表示长度就在这个范围之中。它接受两个参数，分别为最小值和最大值</p>
<p>实例：</p>
<p>每行第三列位置宽度100px~2fr</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d0fdb277564b23ba9b3b252047f4a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=JyvrpxQa3VswP3BBh4vC52YWZpI%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-built_in">minmax</span>(<span class="hljs-number">100px</span>, <span class="hljs-number">2</span>fr);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}
</code></pre>
<h5 data-id="heading-15">auto</h5>
<p>作用：由浏览器自己决定长度</p>
<p>实例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62fe4c19abc74b1f8e9762f06276ca05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=xjN4nJOCsOyDxbjA3m5qQml5K1s%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span> auto <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}
</code></pre>
<h5 data-id="heading-16">自定义网格线名称</h5>
<p>作用：指定每一根网格线的名字，方便以后的引用</p>
<p>实例：</p>
<p>指定网格布局为3*3，因此有4根垂直网格线和4根水平网格线，每个网格线可以指定多个名字，比如<code>[r4 xipiker666]</code></p>
<pre><code class="hljs language-ini" lang="ini">.container {
  display: grid<span class="hljs-comment">;</span>
  grid-template-columns: <span class="hljs-section">[c1]</span> 100px <span class="hljs-section">[c2]</span> 100px <span class="hljs-section">[c3]</span> auto <span class="hljs-section">[c4]</span><span class="hljs-comment">;</span>
  grid-template-rows: <span class="hljs-section">[r1]</span> 100px <span class="hljs-section">[r2]</span> 100px <span class="hljs-section">[r3]</span> auto <span class="hljs-section">[r4 xipiker666]</span><span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-17">grid-columns-gap（columns-gap）与grid-rows-gap（rows-gap）与grid-gap（gap）</h4>
<p>作用：<code>grid-columns-gap</code>设置列间距、<code>grid-rows-gap</code>设置行间距，可以分别简写为<code>columns-gap</code>和<code>rows-gap</code>，<code>grid-gap</code>设置行列间距<code>grid-gap: &lt;行间距&gt; &lt;列间距&gt;</code> ，<code>grid-gap</code>可以简写为<code>gap</code>，如果行和列的值相等可以<code>gap: xxpx</code></p>
<p>实例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e37b7fb60d84e49a327e3bb07cbeeef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=2MNYlapBt9%2BtoWHpHYwnPNQKcYs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<h4 data-id="heading-18">grid-template-areas</h4>
<p>作用：网格布局允许指定"区域"（area），一个区域由单个或多个单元格组成</p>
<p>实例：</p>
<ul>
<li>划分出9个单元格</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-areas</span>: 
    <span class="hljs-string">'a b c'</span>
    <span class="hljs-string">'d e f'</span>
    <span class="hljs-string">'g h i'</span>;                 
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;  
}
</code></pre>
<ul>
<li>多个单元格合并成一个区域</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-areas</span>: 
    <span class="hljs-string">'a a a'</span>
    <span class="hljs-string">'b b b'</span>
    <span class="hljs-string">'c c c'</span>;                 
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;  
}
</code></pre>
<ul>
<li>某些区域不需要利用，则使用<code>.</code>表示</li>
</ul>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-areas</span>: 
    <span class="hljs-string">'a . a'</span>
    <span class="hljs-string">'b . b'</span>
    <span class="hljs-string">'c . c'</span>;                 
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;  
}
</code></pre>
<h4 data-id="heading-19">grid-auto-flow</h4>
<p>作用：容器的子元素的排序方式，属性值<code>row</code>先行后列，属性值<code>columns</code>先列后行，属性值<code>row dense</code>子项目指定位置后再先行后列排序，属性值<code>columns dense</code>子项目指定位置后再先列后行排序</p>
<p>实例：</p>
<ul>
<li><code>row</code>先行后列</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39856d6c5da04b22b81dceddc8d0745c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=UZTUI6bf4XXWdGvAvCHgRd5En7s%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-auto-flow</span>: row;
}
</code></pre>
<ul>
<li><code>columns</code>先列后行</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1994c4239b24e0facf4876837a8016f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=Q%2B86LZlrNovO9Ap4DKR7WjdEOFI%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-auto-flow</span>: column;
}
</code></pre>
<ul>
<li><code>row dense</code>子项目指定位置后先行后列</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d7af55211a64b54b4ede6f0cae701c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=AaQp4O%2FsaFHybCNjTemhfQ5sAuE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-auto-flow</span>: row dense;
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-column-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.item_two</span> {
  <span class="hljs-attribute">grid-column-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>columns dense</code>子项目指定位置后先列后行</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0c948e762e04559bdbe2d4c987cec20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=mZb3K52xjkCXfJntrpnq%2F98huRQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-auto-flow</span>: column dense;
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-column-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.item_two</span> {
  <span class="hljs-attribute">grid-column-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<h4 data-id="heading-20">justify-items与align-items与place-items</h4>
<p>作用：<code>justify-items</code>属性设置单元格内容的水平位置，<code>align-items</code>属性设置单元格内的垂直位置，<code>place-items</code>属性是<code>justify-items</code>和<code>align-items</code>的组合属性</p>
<p>实例：</p>
<ul>
<li><code>justify-items: start | center | end | stretch</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/accb9ec430d346fc8c768ec27749a3d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=hqXsePYxA07bSjvRiBR996ljMHA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  justify-items: center;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>align-items: start | center | end | stretch</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d557b3ed094e36b5034fbdf5c1be3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=MrwaN47imdmMqtDlIXA0iCb5tPo%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>place-items: &lt;align-items&gt; &lt;justify-items&gt;</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c8f91dab0644020b8e2ef6ebb7ca09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=qb2OHFGCOwmLm22nH8lvRPRmQhg%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  place-items: center end;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<h4 data-id="heading-21">justify-content与align-content与place-content</h4>
<p>作用：<code>justify-content</code>属性设置内容区域在容器里面的水平位置，<code>align-content</code>属性设置内容区域在容器里面的垂直位置，<code>place-content</code>属性是<code>justify-content</code>和<code>align-content</code>的组合属性</p>
<p>实例：</p>
<ul>
<li><code>justify-content: start | end | center | stretch | space-around | space-between | space-evenly</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/156834c854ac4faaa67edd913702fac2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=UzP9%2BIXHRBoc%2F0hG5MuL%2BbvRZ6E%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>align-content: start | end | center | stretch | space-around | space-between | space-evenly</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72d07f74d26145b1828b7e6a22615436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=I7uqVtID1fcEzTazkmoc8uTf6dU%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">align-content</span>: center;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>place-content: &lt;align-content&gt; &lt;justify-content&gt;</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d25ab2160f949f3bcf3c29a8699e114~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=dwrLBrVYQb5tghNnKA2jUL%2FUmG0%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  place-<span class="hljs-attribute">content</span>: center center;
}
</code></pre>
<h4 data-id="heading-22">grid-auto-columns与grid-auto-rows</h4>
<p>作用：可以理解为，现有网格的外部设置多余的网格，用来放超出的子项目</p>
<p>实例：</p>
<ul>
<li><code>grid-auto-columns</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36a98245ee8740a8abd9ad8fb1305faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=k5W6vg7erFXZFdXOGey9c510oR8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">grid-auto-rows</span>: <span class="hljs-number">80px</span>
  grid-auto-flow: row; <span class="hljs-comment">/*这里要设置按照行方向填充，可以不设置，因为默认按照行方向*/</span>
}
</code></pre>
<ul>
<li><code>grid-auto-rows</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cef749feb87444ac83ddfdd6ebccd8e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=bxC47pEFJi8w%2B1AWQE4W%2FqiDH1U%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span>{
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">50px</span> <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">grid-auto-columns</span>: <span class="hljs-number">150px</span>; 
  <span class="hljs-attribute">grid-auto-flow</span>: column; <span class="hljs-comment">/*注意这里要设置按照列方向填充，必须设置，因为默认按照行防线*/</span>
}
</code></pre>
<h4 data-id="heading-23">grid-template与grid</h4>
<p>作用：<code>grid-template</code>属性是<code>grid-template-columns</code>、<code>grid-template-rows</code>和<code>grid-template-areas</code>这三个属性的合并简写形式，<code>grid</code>属性是<code>grid-template-rows</code>、<code>grid-template-columns</code>、<code>grid-template-areas</code>、 <code>grid-auto-rows</code>、<code>grid-auto-columns</code>、<code>grid-auto-flow</code>这六个属性的合并简写形式</p>
<h3 data-id="heading-24">四、项目属性</h3>
<h4 data-id="heading-25">grid-column-start、grid-column-end与grid-row-start、grid-row-end</h4>
<p>作用：可以理解为设置项目占多少个网格线，分别定位在哪根网格线</p>
<p>实例：</p>
<ul>
<li><code>grid-column-start: &lt;number&gt;</code>左边框所在的垂直网格线、<code>grid-column-end: &lt;number&gt;</code>右边框所在的垂直网格线</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82fd8e9b7a7247b7a1d2a0001e62e025~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=0hiZRZeGUe0PI1r129RxSmTdyWc%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-column-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item_first"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>grid-row-start: &lt;number&gt;</code>上边框所在的垂直网格线、<code>grid-row-end: &lt;number&gt;</code>下边框所在的垂直网格线</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37b5dd654b4e4e6f85d0b2c7a7ca1499~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=VpneJtEmz%2BHRRu%2FvCM1xusZa1cs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-row-start</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">grid-row-end</span>: <span class="hljs-number">3</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item_first"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-26">grid-column与grid-row</h4>
<p>作用：<code>grid-column</code>属性是<code>grid-column-start</code>和<code>grid-column-end</code>的简写形式、<code>grid-row</code>属性是<code>grid-row-start</code>和<code>grid-row-end</code>的简写形式</p>
<p>实例：</p>
<ul>
<li><code>grid-column: &lt;grid-column-start&gt; / &lt;grid-column-end&gt;</code></li>
<li><code>grid-row: &lt;grid-row-start&gt; / &lt;grid-row-end&gt;</code></li>
</ul>
<h4 data-id="heading-27">grid-area</h4>
<p>作用：指定项目放在哪个区域，<code>grid-area</code>属性还可用作<code>grid-row-start</code>、<code>grid-column-start</code>、<code>grid-row-end</code>、<code>grid-column-end</code>的合并简写形式，直接指定项目的位置</p>
<p>实例：</p>
<ul>
<li>指定放在哪个区域</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/378e495d862140c494cc5f5508af907c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=LEbgQgjvcsh%2FeDH9AbVlzeFuZGc%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-areas</span>:
    <span class="hljs-string">'a b c'</span>
    <span class="hljs-string">'d e f'</span>
    <span class="hljs-string">'g h i'</span>;
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-area</span>: e;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<ul>
<li><code>grid-area: &lt;row-start&gt; / &lt;column-start&gt; / &lt;row-end&gt; / &lt;column-end&gt;</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1192d681c23477fbc22947b87ae60c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=%2BQgKF%2BwjKLPocy%2FGZEU5JNxNtqE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@pos:</span> <span class="hljs-string">~'1 / 1 / 3 / 3'</span>;

<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}

<span class="hljs-selector-class">.item_first</span> {
  <span class="hljs-attribute">grid-area</span>: <span class="hljs-variable">@pos</span>;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<h4 data-id="heading-28">justify-self与align-self与place-self</h4>
<p>作用：<code>justify-self</code>属性设置单元格内容的水平位置、<code>align-self</code>属性设置单元格内容的垂直位置，<code>place-self</code>属性是<code>justify-self</code>和<code>align-self</code>的属性组合</p>
<p>实例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9973b228319c49de9a877b90a2072dda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=nQYwnTUk2ncvUWo7ukbH%2FTd21vQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">100px</span>);
}

<span class="hljs-selector-class">.item_first</span> {
  justify-self: center;
  <span class="hljs-attribute">align-self</span>: center;
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<h3 data-id="heading-29">五、常见布局案例</h3>
<h4 data-id="heading-30">三列等宽布局</h4>
<p><strong>效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbe98d3f4c3c4db7a73963a86f1c044e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=2IJpQGvpq4DoqkkktgJ2G%2FEIQD8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
}

<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-31">圣杯布局</h4>
<p><strong>效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcb75d988f664ecc826b708e8ed191dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=LLt70h6fuI%2FsrgKEVDgoAYlTCls%3D" alt="image.png" loading="lazy"/></p>
<p><strong>代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-areas</span>:
    <span class="hljs-string">'header header'</span>
    <span class="hljs-string">'sidebar main'</span>
    <span class="hljs-string">'footer footer'</span>;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">200px</span> <span class="hljs-number">1</span>fr;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">60px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}
<span class="hljs-selector-class">.header</span> {
  <span class="hljs-attribute">grid-area</span>: header;
  <span class="hljs-attribute">background</span>: lightblue;
}
<span class="hljs-selector-class">.sidebar</span> {
  <span class="hljs-attribute">grid-area</span>: sidebar;
  <span class="hljs-attribute">background</span>: lightgoldenrodyellow;
}
<span class="hljs-selector-class">.main</span> {
  <span class="hljs-attribute">grid-area</span>: main;
  <span class="hljs-attribute">background</span>: lightgreen;
}
<span class="hljs-selector-class">.footer</span> {
  <span class="hljs-attribute">grid-area</span>: footer;
  <span class="hljs-attribute">background</span>: lightpink;
}
</code></pre>

<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="container"&gt;
    &lt;<span class="hljs-selector-tag">div</span> className="<span class="hljs-selector-tag">header</span>"&gt;<span class="hljs-selector-tag">header</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
    &lt;<span class="hljs-selector-tag">div</span> className="sidebar"&gt;sidebar&lt;/<span class="hljs-selector-tag">div</span>&gt;
    &lt;<span class="hljs-selector-tag">div</span> className="<span class="hljs-selector-tag">main</span>"&gt;<span class="hljs-selector-tag">main</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
    &lt;<span class="hljs-selector-tag">div</span> className="<span class="hljs-selector-tag">footer</span>"&gt;<span class="hljs-selector-tag">footer</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<h4 data-id="heading-32">媒体查询响应式布局（Gird+Flex最佳拍档）</h4>
<p><strong>效果</strong></p>
<p>屏幕宽度小于等于660px</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94a3a1e457f4d8589244fa8dd613396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=YjMuDrOwViA1nfAlCSaIGQ4gKJk%3D" alt="image.png" loading="lazy"/></p>
<p>屏幕宽度小于等于1024</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66409396fa654fe0bb63772a78751e8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=dGh0siyorBOm0%2F86QVEXRVd0JtA%3D" alt="image.png" loading="lazy"/></p>
<p>屏幕宽度大于1024</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd9d9c8fd21e4a63a074548c8be0a68a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=62ecBKlOZmCoUk6OGiPQ2OoAhWA%3D" alt="image.png" loading="lazy"/>
<strong>代码</strong></p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"dashboard"</span>&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;Stats&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"overview"</span>&gt;Overview&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"lifecycle"</span>&gt;Lifecycle&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"calendar"</span>&gt;Calendar&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"monitor"</span>&gt;Monitor&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"ladder"</span>&gt;Ladder&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"stage"</span>&gt;Stage&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.dashboard</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-comment">/* 桌面端布局 */</span>
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">2</span>fr <span class="hljs-number">2</span>fr <span class="hljs-number">1</span>fr;
  <span class="hljs-attribute">grid-template-areas</span>:
    <span class="hljs-string">'stats stats stats'</span>
    <span class="hljs-string">'overview lifecycle calendar'</span>
    <span class="hljs-string">'monitor ladder calendar'</span>
    <span class="hljs-string">'stage stage stage'</span>;
}

<span class="hljs-selector-class">.dashboard</span> &gt; <span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.stats</span> {
  <span class="hljs-attribute">grid-area</span>: stats;
}
<span class="hljs-selector-class">.overview</span> {
  <span class="hljs-attribute">grid-area</span>: overview;
}
<span class="hljs-selector-class">.lifecycle</span> {
  <span class="hljs-attribute">grid-area</span>: lifecycle;
}
<span class="hljs-selector-class">.calendar</span> {
  <span class="hljs-attribute">grid-area</span>: calendar;
}
<span class="hljs-selector-class">.monitor</span> {
  <span class="hljs-attribute">grid-area</span>: monitor;
}
<span class="hljs-selector-class">.ladder</span> {
  <span class="hljs-attribute">grid-area</span>: ladder;
}
<span class="hljs-selector-class">.stage</span> {
  <span class="hljs-attribute">grid-area</span>: stage;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1024px</span>) {
  <span class="hljs-selector-class">.dashboard</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">grid-template-areas</span>:
      <span class="hljs-string">'stats stats'</span>
      <span class="hljs-string">'overview lifecycle'</span>
      <span class="hljs-string">'calendar calendar'</span>
      <span class="hljs-string">'monitor ladder'</span>
      <span class="hljs-string">'stage stage'</span>;
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">600px</span>) {
  <span class="hljs-selector-class">.dashboard</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">grid-template-areas</span>:
      <span class="hljs-string">'stats'</span>
      <span class="hljs-string">'overview'</span>
      <span class="hljs-string">'lifecycle'</span>
      <span class="hljs-string">'calendar'</span>
      <span class="hljs-string">'monitor'</span>
      <span class="hljs-string">'ladder'</span>
      <span class="hljs-string">'stage'</span>;
  }
}
</code></pre>
<h4 data-id="heading-33">Grid瀑布流布局</h4>
<p><strong>效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3de6e49d12ef48b396de86b841143ce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ayJ55qu5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764076568&amp;x-signature=cR1M3Y9tpIxIga08qrEqxibja8E%3D" alt="image.png" loading="lazy"/></p>
<p><strong>代码</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">200px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">grid-auto-rows</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">grid-auto-flow</span>: dense;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}
<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">background</span>: lightblue;
}
<span class="hljs-selector-class">.item1</span> {
  <span class="hljs-attribute">grid-row-end</span>: span <span class="hljs-number">15</span>;
}
<span class="hljs-selector-class">.item2</span> {
  <span class="hljs-attribute">grid-row-end</span>: span <span class="hljs-number">25</span>;
}
<span class="hljs-selector-class">.item3</span> {
  <span class="hljs-attribute">grid-row-end</span>: span <span class="hljs-number">20</span>;
}
</code></pre>

<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item item1"</span>&gt;<span class="hljs-number">1</span>&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item item2"</span>&gt;<span class="hljs-number">2</span>&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item item3"</span>&gt;<span class="hljs-number">3</span>&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item item1"</span>&gt;<span class="hljs-number">4</span>&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h3 data-id="heading-34">六、总结</h3>
<p>上述内容主要参考，大家可以参考原文，如果能帮到您，欢迎点赞、收藏、+关注</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2019%2F03%2Fgrid-layout-tutorial.html" target="_blank" title="https://www.ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html" ref="nofollow noopener noreferrer">CSS Grid 网格布局教程 - 阮一峰的网络日志</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习React-DnD：实现多任务项拖拽-useDrag处理]]></title>    <link>https://juejin.cn/post/7573888000020332607</link>    <guid>https://juejin.cn/post/7573888000020332607</guid>    <pubDate>2025-11-18T13:18:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573888000020332607" data-draft-id="7573876900230987839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习React-DnD：实现多任务项拖拽-useDrag处理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-18T13:18:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Wect"/> <meta itemprop="url" content="https://juejin.cn/user/4185164878720068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习React-DnD：实现多任务项拖拽-useDrag处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185164878720068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Wect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:18:35.000Z" title="Tue Nov 18 2025 13:18:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在完成任务项的选中与取消选中功能后，核心需求升级为“<strong>选中状态下拖拽触发批量移动，未选中时保持单个拖拽</strong>”，同时需实现“所有选中项同步透明”的视觉反馈。本文将基于React DnD的<code>useDrag</code>钩子，完整拆解这一功能的实现逻辑。</p>
<h2 data-id="heading-0">一、核心设计思路</h2>
<p>多选拖拽的核心是“状态识别”与“数据联动”，需解决两个关键问题：</p>
<ol>
<li><strong>拖拽模式判断</strong>：通过任务项的选中状态（<code>todo.selected</code>）和选中集合（<code>selectedTodos</code>），区分“单个拖拽”和“多选拖拽”。</li>
<li><strong>批量状态同步</strong>：拖拽任意一个选中项时，让所有选中项同步响应拖拽状态（如透明效果），而非仅拖拽触发项。</li>
</ol>
<p>最终实现效果如示例所示：勾选多个任务项后，拖拽其中任意一项，所有选中项均变为透明并同步移动。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cfd45df31b74c3b93d0516f7b0bd87d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2VjdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077008&amp;x-signature=Vb5RbDzQx2tcW2tX%2FGvwO42GLAE%3D" alt="SelectTodosDrag.gif" loading="lazy"/></p>
<h2 data-id="heading-1">二、关键技术点：React DnD useDrag 配置优化</h2>
<p>拖拽功能的核心是<code>useDrag</code>钩子的配置，我们需要通过修改<code>item</code>（拖拽数据）和<code>isDragging</code>（拖拽状态判断）两个关键属性，实现模式切换与状态同步。</p>
<h3 data-id="heading-2">2.1 拖拽数据（item）：携带模式标识</h3>
<p>拖拽时传递的数据需包含“当前任务信息”和“选中集合（可选）”，让接收方（<code>useDrop</code>）能识别拖拽模式。当任务项处于选中状态且存在选中集合时，携带<code>selectedTodos</code>标识为多选拖拽。</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// TodoItem组件中useDrag的item配置</span>
    <span class="hljs-attr">item</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 构建拖拽数据，区分单个/多选拖拽</span>
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">id</span>: todo.<span class="hljs-property">id</span>,               <span class="hljs-comment">// 当前任务ID（必传，单个拖拽核心标识）</span>
        <span class="hljs-attr">index</span>: index,              <span class="hljs-comment">// 当前任务在列表中的原始索引</span>
        <span class="hljs-attr">selected</span>: todo.<span class="hljs-property">selected</span>,   <span class="hljs-comment">// 当前任务的选中状态</span>
        <span class="hljs-comment">// 关键：仅选中状态且存在选中集合时，携带选中列表</span>
        <span class="hljs-attr">selectedTodos</span>: todo.<span class="hljs-property">selected</span> &amp;&amp; selectedTodos ? selectedTodos : <span class="hljs-literal">undefined</span>
      };
    },
</code></pre>
<p>设计亮点：通过<code>selectedTodos</code>的“存在性”作为模式判断依据，无需额外定义“type”字段，简化数据结构的同时保证语义清晰。</p>
<h3 data-id="heading-3">2.2 拖拽状态（isDragging）：批量同步状态</h3>
<p>默认的<code>isDragging</code>仅判断“当前项是否为拖拽触发项”，无法满足多选场景。我们需要自定义判断逻辑：<strong>多选模式下，所有选中项均视为“正在拖拽”</strong> ，从而同步视觉效果。</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// TodoItem组件中useDrag的isDragging配置</span>
    <span class="hljs-attr">isDragging</span>: <span class="hljs-function">(<span class="hljs-params">monitor</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> item = monitor.<span class="hljs-title function_">getItem</span>();
      <span class="hljs-comment">// 安全校验：避免拖拽数据为空时的异常</span>
      <span class="hljs-keyword">if</span> (!item) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

      <span class="hljs-comment">// 场景1：单个拖拽（无选中集合或当前项未选中）</span>
      <span class="hljs-keyword">if</span> (!item.<span class="hljs-property">selectedTodos</span> || !item.<span class="hljs-property">selected</span>) {
        <span class="hljs-comment">// 仅当拖拽数据ID与当前项ID一致时，视为拖拽中</span>
        <span class="hljs-keyword">return</span> item.<span class="hljs-property">id</span> === todo.<span class="hljs-property">id</span>;
      }

      <span class="hljs-comment">// 场景2：多选拖拽（存在选中集合且当前项已选中）</span>
      <span class="hljs-comment">// 检查当前项是否在选中集合中，是则视为拖拽中</span>
      <span class="hljs-keyword">return</span> item.<span class="hljs-property">selectedTodos</span>.<span class="hljs-title function_">some</span>(
        <span class="hljs-function"><span class="hljs-params">selectedTodo</span> =&gt;</span> selectedTodo &amp;&amp; selectedTodo.<span class="hljs-property">id</span> === todo.<span class="hljs-property">id</span>
      );
    },
</code></pre>
<p>逻辑拆解：</p>
<ul>
<li>安全校验：优先判断<code>item</code>是否存在，避免<code>monitor.getItem()</code>返回空值导致的报错。</li>
<li>单个拖拽判断：无<code>selectedTodos</code>时，沿用默认逻辑（ID匹配即视为拖拽中）。</li>
<li>多选拖拽判断：通过<code>some()</code>方法遍历选中集合，只要当前项在集合中，就标记为“拖拽中”，实现批量状态同步。</li>
</ul>
<h2 data-id="heading-4">三、视觉效果联动：选中项透明化</h2>
<p>通过<code>isDragging</code>返回的布尔值，直接关联组件样式，实现“拖拽中选中项透明”的视觉反馈，这也是提升用户体验的关键一步。</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// TodoItem组件样式与拖拽状态联动</span>
    <span class="hljs-keyword">import</span> { useDrag } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;

    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoItem</span>(<span class="hljs-params">{ todo, index }</span>) {
      <span class="hljs-comment">// 省略useDrag其他配置...</span>
      <span class="hljs-keyword">const</span> [{ isDragging }, drag] = <span class="hljs-title function_">useDrag</span>({
        <span class="hljs-attr">item</span>: <span class="hljs-comment">/* 上文配置 */</span>,
        <span class="hljs-attr">isDragging</span>: <span class="hljs-comment">/* 上文配置 */</span>,
        <span class="hljs-comment">// 其他属性（如end：拖拽结束后的排序逻辑）</span>
      });

      <span class="hljs-comment">// 拖拽状态样式：选中项拖拽时透明化</span>
      <span class="hljs-keyword">const</span> todoItemStyle = {
        <span class="hljs-attr">opacity</span>: isDragging ? <span class="hljs-number">0.5</span> : <span class="hljs-number">1</span>, <span class="hljs-comment">// 核心视觉反馈</span>
        <span class="hljs-attr">transition</span>: <span class="hljs-string">'opacity 0.2s ease'</span>, <span class="hljs-comment">// 平滑过渡提升体验</span>
        <span class="hljs-comment">// 其他基础样式（如padding、border等）</span>
      };

      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">todo-item</span>${<span class="hljs-attr">isDragging</span> ? ' <span class="hljs-attr">isDragging</span>' <span class="hljs-attr">:</span> ''}`} <span class="hljs-attr">ref</span>=<span class="hljs-string">{divRef}</span>&gt;</span>
            {/* 其他 */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      );
    };
</code></pre>
<p>效果说明：当拖拽任意一个选中项时，所有选中项的<code>isDragging</code>均变为<code>true</code>，<code>opacity</code>同步变为0，实现示例中的透明效果；拖拽结束后，<code>isDragging</code>重置为<code>false</code>，样式恢复正常。</p>
<h2 data-id="heading-5">四、功能总结</h2>
<p>本次实现通过修改<code>useDrag</code>的核心配置，仅用“数据携带标识+状态批量判断”的轻量方案，完成了单个/多选拖拽的无缝切换，同时通过样式联动提升了用户体验。核心亮点：</p>
<ul>
<li>无侵入式设计：不修改原有单个拖拽逻辑，通过条件判断扩展多选能力。</li>
<li>状态自洽：依赖选中集合动态计算状态，避免局部状态与全局状态的不一致。</li>
<li>视觉反馈清晰：选中项同步透明，让用户明确感知批量拖拽的作用范围。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#常量(const)与枚举(enum)使用指南]]></title>    <link>https://juejin.cn/post/7573900879997927424</link>    <guid>https://juejin.cn/post/7573900879997927424</guid>    <pubDate>2025-11-19T01:55:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900879997927424" data-draft-id="7572844326390464546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#常量(const)与枚举(enum)使用指南"/> <meta itemprop="keywords" content="前端,C#"/> <meta itemprop="datePublished" content="2025-11-19T01:55:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#常量(const)与枚举(enum)使用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:55:22.000Z" title="Wed Nov 19 2025 01:55:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 常量 (const)</h2>
<p>常量，就是一个其值在程序编译时就已经确定，并且在整个运行期间都不能被修改的量。</p>
<p><strong>如何声明常量？</strong></p>
<p>使用 <code>const</code> 关键字进行声明，并且必须在声明时就进行初始化。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> PI = <span class="hljs-number">3.14159</span>;
<span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DAYS_IN_WEEK = <span class="hljs-number">7</span>;
<span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> AppVersion = <span class="hljs-string">"1.0.2"</span>;
</code></pre>
<p><em>命名约定：常量的名称通常使用全大写字母，并用下划线分隔单词，以示区别。</em></p>
<p><strong><code>const</code> vs <code>readonly</code></strong></p>
<p>你可能还会遇到 <code>readonly</code> (只读) 关键字，它与 <code>const</code> 类似但有一个关键区别：</p>
<ul>
<li><code>const</code> 的值必须在<strong>编译时</strong>确定。</li>
<li><code>readonly</code> 的值可以在<strong>运行时</strong>确定（在构造函数中赋值），但一旦赋值后就不能再更改。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>
{
    <span class="hljs-comment">// 编译时常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DefaultTimeout = <span class="hljs-number">5000</span>; 

    <span class="hljs-comment">// 运行时只读字段</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> DateTime CreationTime;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Config</span>()</span>
    {
        <span class="hljs-comment">// readonly 字段可以在构造函数中初始化</span>
        CreationTime = DateTime.Now; 
    }
}
</code></pre>
<h2 data-id="heading-1">二、 枚举 (enum)</h2>
<p><strong>枚举</strong>(<code>enum</code>)允许我们定义一个由一组命名的常量组成的集合，这个集合本身成为一个新的类型。</p>
<p><strong>如何声明和使用枚举？</strong></p>
<p>使用 <code>enum</code> 关键字来定义。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 定义一个订单状态的枚举</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> OrderStatus
{
    Pending,    <span class="hljs-comment">// 待处理</span>
    Processing, <span class="hljs-comment">// 处理中</span>
    Shipped,    <span class="hljs-comment">// 已发货</span>
    Completed,  <span class="hljs-comment">// 已完成</span>
    Cancelled   <span class="hljs-comment">// 已取消</span>
}
</code></pre>
<p>现在，<code>OrderStatus</code> 就成了一个新的数据类型。我们可以这样使用它：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 声明一个枚举类型的变量</span>
OrderStatus currentStatus = OrderStatus.Pending;

<span class="hljs-comment">// 在逻辑判断中使用，代码清晰易读</span>
<span class="hljs-keyword">if</span> (currentStatus == OrderStatus.Shipped)
{
    Console.WriteLine(<span class="hljs-string">"订单已发货！"</span>);
}

<span class="hljs-comment">// 在 switch 语句中使用，是枚举的最佳拍档</span>
<span class="hljs-keyword">switch</span> (currentStatus)
{
    <span class="hljs-keyword">case</span> OrderStatus.Pending:
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> OrderStatus.Processing:
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-comment">// ... 其他状态</span>
    <span class="hljs-literal">default</span>:
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">break</span>;
}
</code></pre>
<p><strong>枚举的优势：</strong></p>
<ol>
<li><strong>强类型安全</strong>：你不能将一个随意的整数赋给一个枚举变量，编译器会阻止你犯错。这避免了将无效的状态码（比如 <code>orderStatus = 10</code>）赋给变量的可能。</li>
<li><strong>极佳的可读性</strong>：<code>OrderStatus.Completed</code> 清晰地表达了其含义，而数字 <code>3</code> 则不能。你的代码会变得“自解释”。</li>
<li><strong>智能提示（IntelliSense）</strong>：在Visual Studio等IDE中，当你输入枚举变量时，会自动提示所有可用的成员，极大提高了开发效率并减少了拼写错误。</li>
</ol>
<p><strong>枚举的底层机制</strong></p>
<p>默认情况下，枚举的每个成员都对应一个整数，从0开始依次递增 (<code>Pending</code> 是 0, <code>Processing</code> 是 1, ...)。你也可以显式地为它们指定值，或者更改其底层的类型（默认为 <code>int</code>）。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> ErrorCode : <span class="hljs-built_in">ushort</span> <span class="hljs-comment">// 可以指定底层类型</span>
{
    None = <span class="hljs-number">0</span>,
    NotFound = <span class="hljs-number">404</span>,
    InternalServerError = <span class="hljs-number">500</span>,
    AccessDenied = <span class="hljs-number">403</span>
}
</code></pre>
<h2 data-id="heading-2">结语</h2>
<p><strong>点个赞，关注我获取更多实用 C# 技术干货！如果觉得有用，记得收藏本文！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React的useRef的深度解析与应用指南]]></title>    <link>https://juejin.cn/post/7573912365910884394</link>    <guid>https://juejin.cn/post/7573912365910884394</guid>    <pubDate>2025-11-19T00:16:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573912365910884394" data-draft-id="7554332546579529766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React的useRef的深度解析与应用指南"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-11-19T00:16:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React的useRef的深度解析与应用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T00:16:00.000Z" title="Wed Nov 19 2025 00:16:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 前言</h2>
<p>在React的函数式组件开发中，<code>useRef</code>是一个非常实用的钩子，它为我们提供了在组件渲染周期之间持久化存储值的能力，同时不会触发组件的重新渲染。本文将深入探讨<code>useRef</code>的工作原理、常见应用场景以及使用时的注意事项。</p>
<h2 data-id="heading-1">2. 基本概念与工作原理</h2>
<p><code>useRef</code>是React提供的一个钩子函数，其主要功能是创建一个可变的ref对象。这个对象在组件的整个生命周期内保持不变，无论组件渲染多少次，ref对象始终指向同一个值。其基本语法如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> refContainer = <span class="hljs-title function_">useRef</span>(initialValue);
</code></pre>
<p><code>useRef</code>返回的ref对象有一个特殊的<code>current</code>属性，用于存储和访问值。初始时，<code>current</code>属性被设置为传入的<code>initialValue</code>。需要注意的是，修改<code>current</code>属性不会触发组件的重新渲染，这是<code>useRef</code>与状态管理（如<code>useState</code>）的重要区别。</p>
<h2 data-id="heading-2">3. 核心应用场景</h2>
<p>下面是一些常见的使用场景：</p>
<h3 data-id="heading-3">3.1. 访问DOM元素</h3>
<p><code>useRef</code>最常见的用途之一是获取DOM元素的引用，从而可以直接操作DOM。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TextInputWithFocusButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputEl = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onButtonClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// `current` 指向已挂载到DOM上的文本输入元素</span>
    inputEl.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputEl}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onButtonClick}</span>&gt;</span>聚焦输入框<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>在这个例子中，<code>useRef</code>创建了一个ref对象<code>inputEl</code>，并将其绑定到input元素的<code>ref</code>属性上。当按钮被点击时，我们可以通过<code>inputEl.current</code>访问到实际的DOM元素，然后调用其<code>focus()</code>方法。</p>
<h3 data-id="heading-4">3.2. 存储组件间持久化数据</h3>
<p><code>useRef</code>还可以用于在组件的多次渲染之间存储数据，而不会触发重新渲染。这对于需要在组件生命周期内保持某些值的场景非常有用。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Timer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalRef = <span class="hljs-title function_">useRef</span>();
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    intervalRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prevCount</span> =&gt;</span> prevCount + <span class="hljs-number">1</span>);
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearInterval</span>(intervalRef.<span class="hljs-property">current</span>);
    };
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>计时: {count} 秒<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>在这个计时器组件中，我们使用<code>useRef</code>存储了setInterval返回的计时器ID。这样在组件卸载时，我们可以通过<code>intervalRef.current</code>访问到这个ID，并清除计时器，避免内存泄漏。</p>
<h3 data-id="heading-5">3.3. 避免不必要的重新渲染</h3>
<p>在某些情况下，我们可能需要在组件内部存储一些值，但又不希望这些值的变化触发组件的重新渲染。这时，<code>useRef</code>是一个理想的选择。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">DataFetcher</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> isMounted = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetchData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
      <span class="hljs-comment">// 只有当组件仍然挂载时才更新状态</span>
      <span class="hljs-keyword">if</span> (isMounted.<span class="hljs-property">current</span>) {
        <span class="hljs-title function_">setData</span>(result);
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
      }
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 组件卸载时更新标记</span>
      isMounted.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
    };
  }, []);

  <span class="hljs-keyword">return</span> loading ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>在这个数据获取组件中，我们使用<code>useRef</code>创建了一个<code>isMounted</code>标记，用于跟踪组件是否仍然挂载。在异步操作完成后，我们首先检查这个标记，只有在组件仍然挂载的情况下才更新状态，从而避免在组件卸载后更新状态导致的警告。</p>
<h2 data-id="heading-6">4. useRef与useState的对比</h2>
<p>虽然<code>useRef</code>和<code>useState</code>都可以用于存储数据，但它们有本质的区别：</p>
<ul>
<li><strong>触发渲染</strong>：修改<code>useState</code>存储的值会触发组件重新渲染，而修改<code>useRef</code>的<code>current</code>属性不会。</li>
<li><strong>数据持久性</strong>：<code>useState</code>的值在每次渲染时都是固定的，而<code>useRef</code>的<code>current</code>属性可以随时修改。</li>
<li><strong>适用场景</strong>：<code>useState</code>适用于需要根据数据变化更新UI的场景，而<code>useRef</code>适用于存储不影响UI的数据或访问DOM元素。</li>
</ul>
<h2 data-id="heading-7">5. 使用useRef的注意事项</h2>
<ol>
<li>
<p><strong>避免在渲染过程中修改current属性</strong>：修改<code>useRef</code>的<code>current</code>属性不会触发重新渲染，但如果在渲染过程中修改它，可能会导致难以调试的问题。</p>
</li>
<li>
<p><strong>注意内存泄漏</strong>：当使用<code>useRef</code>存储DOM元素或其他资源时，要确保在组件卸载时正确清理这些资源，避免内存泄漏。</p>
</li>
<li>
<p><strong>不要滥用useRef</strong>：虽然<code>useRef</code>很强大，但应该谨慎使用。过度使用<code>useRef</code>可能会导致代码变得难以理解和维护，应该优先使用状态管理和数据流模式。</p>
</li>
</ol>
<h2 data-id="heading-8">6. 总结</h2>
<p><code>useRef</code>是React中一个非常有用的钩子，它为我们提供了在组件渲染周期之间持久化存储值的能力，同时不会触发重新渲染。通过合理使用<code>useRef</code>，我们可以更方便地访问DOM元素、存储组件间持久化数据以及优化性能。但在使用过程中，我们也需要注意避免常见的陷阱，确保代码的健壮性和可维护性。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">纯前端提取图片颜色插件Color-Thief教学+实战完整指南</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konva实战指南：Canvas高性能+易维护的组件化图形开发实现教程</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">React无限滚动插件react-infinite-scroll-component的配置+优化+避坑指南</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">前端音频兼容解决：音频神器howler.js从基础到进阶完整使用指南</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">使用React-OAuth进行Google/GitHub登录的教程和案例</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">纯前端人脸识别利器：face-api.js手把手深入解析教学</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">关于React父组件调用子组件方法forwardRef的详解和案例</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">React跨组件数据共享useContext详解和案例</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Web图像编辑神器tui.image-editor从基础到进阶的实战指南</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">开发个人微信小程序类目选择/盈利方式/成本控制与服务器接入指南</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">前端图片裁剪Cropper.js核心功能与实战技巧详解</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">编辑器也有邪修？盘点VS Code邪门/有趣的扩展</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">js使用IntersectionObserver实现目标元素可见度的交互</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Web前端页面开发阿拉伯语种适配指南</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">让网页拥有App体验？PWA 将网页变为桌面应用的保姆级教程PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">手把手教你搭建规范的团队vue项目，包含commitlint，eslint，prettier，husky，commitizen等等</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3.4 性能优化实战：7个被低估的Composition API技巧让你的应用提速30%]]></title>    <link>https://juejin.cn/post/7573892650815143951</link>    <guid>https://juejin.cn/post/7573892650815143951</guid>    <pubDate>2025-11-19T00:16:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892650815143951" data-draft-id="7573904312712364067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3.4 性能优化实战：7个被低估的Composition API技巧让你的应用提速30%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-19T00:16:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3.4 性能优化实战：7个被低估的Composition API技巧让你的应用提速30%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T00:16:49.000Z" title="Wed Nov 19 2025 00:16:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue 3.4 性能优化实战：7个被低估的Composition API技巧让你的应用提速30%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Vue 3.4 在性能优化方面带来了许多改进，尤其是 Composition API 的成熟让开发者能够更灵活地控制组件的渲染逻辑。然而，许多开发者仍然停留在 Options API 的思维模式中，未能充分利用 Composition API 的潜力。本文将深入探讨 <strong>7个被低估的 Composition API 技巧</strong>，通过实际案例和性能对比，展示如何通过这些技巧将应用性能提升高达 <strong>30%</strong>。</p>
<p>无论你是正在迁移旧项目还是构建新应用，这些技巧都能帮助你显著减少不必要的渲染、优化响应式开销，并提升整体用户体验。</p>
<hr/>
<h2 data-id="heading-2">1. <code>shallowRef</code>：减少深度响应式开销</h2>
<h3 data-id="heading-3">问题背景</h3>
<p>默认情况下，Vue 的 <code>ref</code> 会对对象进行深度响应式转换，这在处理大型对象时可能导致性能问题。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">largeObject</span>: { ... } });
</code></pre>
<p>每次修改 <code>largeObject</code> 的任何属性都会触发依赖更新。</p>
<h3 data-id="heading-4">解决方案</h3>
<p>使用 <code>shallowRef</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">shallowRef</span>({ <span class="hljs-attr">largeObject</span>: { ... } });
</code></pre>
<p><code>shallowRef</code> 只对 <code>.value</code> 的变化进行响应式追踪，适合不需要深度监听的场景（如不可变数据或第三方库实例）。</p>
<h3 data-id="heading-5">性能收益</h3>
<ul>
<li><strong>减少 Proxy 创建开销</strong>：避免深层对象的递归代理。</li>
<li><strong>降低依赖追踪成本</strong>：仅顶层变化触发更新。</li>
</ul>
<hr/>
<h2 data-id="heading-6">2. <code>markRaw</code>：跳过不必要的响应式转换</h2>
<h3 data-id="heading-7">问题背景</h3>
<p>某些数据（如静态配置、第三方类实例）不需要响应式能力，但 Vue 默认会尝试将其转换为响应式对象。</p>
<h3 data-id="heading-8">解决方案</h3>
<p>使用 <code>markRaw</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> staticConfig = <span class="hljs-title function_">markRaw</span>({ <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'...'</span> });
</code></pre>
<p>标记后的对象会被 Vue <strong>跳过响应式处理</strong>。</p>
<h3 data-id="heading-9">适用场景</h3>
<ul>
<li>SSR Hydration 中的静态数据。</li>
<li>Class实例或复杂第三方库对象（如 Three.js Mesh）。</li>
</ul>
<hr/>
<h2 data-id="heading-10">3. <code>computed</code> + <code>watchEffect</code>：精细化依赖控制</h2>
<h3 data-id="heading-11"><code>computed</code> vs <code>watchEffect</code></h3>
<ul>
<li><strong>优先使用 <code>computed</code></strong>：当需要派生状态且依赖明确时（缓存计算结果）。</li>
<li><strong>谨慎使用 <code>watchEffect</code></strong>：避免在渲染函数中使用（可能引起多次执行）。</li>
</ul>
<h3 data-id="heading-12">优化示例</h3>
<p>❌低效写法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// doSomething(state.value);</span>
});
</code></pre>
<p>✅高效写法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> derivedValue = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">transform</span>(state.<span class="hljs-property">value</span>));
<span class="hljs-title function_">watch</span>(derivedValue, doSomething); <span class="hljs-comment">//仅在 derivedValue变化时执行</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">4. <code>toValue()</code> + Effect Scope：精准管理副作用生命周期</h2>
<p>Vue3.4新增了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Freactivity-utilities.html%23tovalue" target="_blank" title="https://vuejs.org/api/reactivity-utilities.html#tovalue" ref="nofollow noopener noreferrer"><code>toValue()</code></a> ，可智能解包 Ref/Getter/原始值 。结合 Effect Scope ，可精准控制副作用清理时机 ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { effectScope,toValue } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;   

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useAutoCleanup</span>(<span class="hljs-params">fn</span>){   
   <span class="hljs-keyword">const</span> scope=<span class="hljs-title function_">effectScope</span>();   
   scope.<span class="hljs-title function_">run</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-title function_">fn</span>(<span class="hljs-title function_">toValue</span>(someRef)));   
   <span class="hljs-keyword">return</span> <span class="hljs-function">()=&gt;</span>scope.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">//手动清理    </span>
}     
</code></pre>
<h3 data-id="heading-14">优势对比传统方式 ：</h3>
<ul>
<li>✅避免内存泄漏 （自动清理）</li>
<li>✅支持链式调用 （返回清理函数）</li>
</ul>
<hr/>
<h2 data-id="heading-15">5.“Lazy Refs”模式延迟计算密集型操作</h2>
<h3 data-id="heading-16">实现原理</h3>
<p>通过组合API封装高开销操作 ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useLazyRef</span>(<span class="hljs-params">getter</span>){      
   <span class="hljs-keyword">const</span> isActive=<span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);      
   <span class="hljs-keyword">const</span> result=<span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);      

   <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">()=&gt;</span>{      
      <span class="hljs-keyword">if</span>(isActive.<span class="hljs-property">value</span>){       
         result.<span class="hljs-property">value</span>=<span class="hljs-title function_">getter</span>();       
      }      
   });      

   <span class="hljs-keyword">return</span> {result,<span class="hljs-attr">activate</span>:<span class="hljs-function">()=&gt;</span>isActive.<span class="hljs-property">value</span>=<span class="hljs-literal">true</span>};      
}      

<span class="hljs-comment">//使用示例       </span>
<span class="hljs-keyword">const</span> {result,activate}=<span class="hljs-title function_">useLazyExpensiveCalculation</span>();      
<span class="hljs-title function_">activate</span>(); <span class="hljs-comment">//按需触发计算       </span>
</code></pre>
<h3 data-id="heading-17">适用场景</h3>
<ul>
<li>大型表格渲染前预处理</li>
<li>图表库初始化</li>
</ul>
<hr/>
<h2 data-id="heading-18">6.Signal-Like优化策略 （Vue3.4新增reactivityTransform）</h2>
<p>Vue3.4进一步优化了编译时响应性转换 ，可通过标志启用 ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//vite.config.js     </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({     
   <span class="hljs-attr">plugins</span>:[<span class="hljs-title function_">vue</span>({<span class="hljs-attr">reactivityTransform</span>:<span class="hljs-literal">true</span>})]     
})     

<span class="hljs-comment">//组件内直接访问ref无需.value      </span>
<span class="hljs-keyword">let</span> count=$ref(<span class="hljs-number">0</span>);     
<span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>){count++;}     
</code></pre>
<h3 data-id="heading-19">性能影响测试 （基于官方benchmark）</h3>

















<table><thead><tr><th>Operation</th><th>Traditional Ref</th><th>$ref Syntax</th><th>Improvement</th></tr></thead><tbody><tr><td>Read/Write (ops/sec)</td><td>~1M</td><td>~1.2M</td><td>+20%</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">7.Custom Ref工厂模式复用优化逻辑</h2>
<h3 data-id="heading-21">高级用例 ：防抖Ref</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useDebouncedRef</span>(<span class="hljs-params">value,delay</span>){        
   <span class="hljs-keyword">let</span> timeout;        
   <span class="hljs-keyword">return</span> <span class="hljs-title function_">customRef</span>(<span class="hljs-function">(<span class="hljs-params">track,trigger</span>)=&gt;</span>({        
     <span class="hljs-title function_">get</span>(<span class="hljs-params"/>){ <span class="hljs-title function_">track</span>(); <span class="hljs-keyword">return</span> value; },        
     <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>){          
        <span class="hljs-built_in">clearTimeout</span>(timeout);          
        timeout=<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{            
          value=newVal;            
          <span class="hljs-title function_">trigger</span>();            
        },delay);          
     }          
   }));          
}          

<span class="hljs-comment">//使用示例         </span>
<span class="hljs-keyword">const</span> searchQuery=<span class="hljs-title function_">useDebouncedRef</span>(<span class="hljs-string">''</span>,<span class="hljs-number">300</span>);         
</code></pre>
<hr/>
<h2 data-id="heading-22">总结</h2>
<p>Vue3.4的CompositionAPI为性能优化提供了更多底层控制能力 。本文介绍的7个技巧涵盖从 <strong>响应式粒度控制</strong> 、 <strong>计算缓存策略</strong>到 <strong>副作用生命周期管理</strong> ，合理运用可显著提升复杂应用的运行时效率 。建议结合实际项目瓶颈逐步引入这些优化 ，并通过Chrome DevTools的Performance面板验证效果 。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？]]></title>    <link>https://juejin.cn/post/7573892573346021428</link>    <guid>https://juejin.cn/post/7573892573346021428</guid>    <pubDate>2025-11-18T17:07:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892573346021428" data-draft-id="7573892650815094799" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-18T17:07:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Alang"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126162429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126162429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Alang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T17:07:50.000Z" title="Tue Nov 18 2025 17:07:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最终效果示例（测试文档：290 页）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cfc5be92af4f4a98e493f6c1ed7101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764090470&amp;x-signature=UKUnAGoyKcpNy%2FfaKGTR1w1JkXs%3D" alt="Kapture 2025-11-18 at 23.45.35.gif" loading="lazy"/></p>
<p>开源地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchennlang%2Flm-pdf" target="_blank" title="https://github.com/chennlang/lm-pdf" ref="nofollow noopener noreferrer">github.com/chennlang/l…</a> （如果觉得还不错，记得留下你的 star，这对我有很大帮助！）</p>
<h2 data-id="heading-0">背景</h2>
<p>随着 AGI 的日益发展，多模态的大模型也逐渐成为常态，出现在大众视野中，不过对于要求较高的场景，识别效果还是缺点意思，主要还是因为文档解析是一个复杂的流程（layout 分析 + 表格、文字识别 + 切片 + 原文对比、段落划分等），所以传统的 RAG 流程还是主流的方式。</p>
<p>大模型要去 “看” 到世界，首先得理解图片、文档。在 RAG 的流程中，大模型需要去学习本地的文档，从而生成更加专业的回答。而这些存量的文档大多数是 pdf 格式的，或者是以图片存在的。<strong>所以我们第一步要解决的问题就是如何把文档中的信息完整、准确的提取出来。</strong></p>
<p>PDF 渲染器其实是文档渲染的一个通用的文档展示方案，如果假设我们是在一个照相机后面看世界，所有图片、文档都能被看做是一张张图片，最终汇总起来就是一本 pdf 文档，所以理论上所有东西都能用 PDF 渲染器显示。</p>
<p>在 AGI 的前端项目中，无论是<code>训练模型语料</code>、还是模型回答<code>原文查看</code>、还是<code>切片来源</code>，都需要把原文档联系起来。所以都需要同时展示原文和回答的功能。</p>
<h2 data-id="heading-1">现有 PDF 预览方案</h2>



























































<table><thead><tr><th><strong>特性</strong></th><th><strong>pdf.js</strong></th><th><strong>react-pdf</strong></th><th><strong>react-pdf-viewer</strong></th></tr></thead><tbody><tr><td><strong>类型</strong></td><td>JavaScript 库</td><td>React 组件库</td><td>React 组件库</td></tr><tr><td><strong>依赖</strong></td><td>无</td><td>pdf.js</td><td>pdf.js</td></tr><tr><td><strong>UI</strong></td><td>无（需手动实现）</td><td>基础（需手动实现工具栏等）</td><td>完整（提供工具栏、缩略图等）</td></tr><tr><td><strong>功能</strong></td><td>渲染、缩放、搜索等</td><td>渲染、页面懒加载等</td><td>渲染、搜索、缩放、插件支持等</td></tr><tr><td><strong>定制性</strong></td><td>高（底层 API）</td><td>中（组件化）</td><td>中高（插件和主题定制）</td></tr><tr><td><strong>性能</strong></td><td>取决于 PDF 复杂度和实现</td><td>取决于 PDF 复杂度和实现</td><td>取决于 PDF 复杂度和实现</td></tr><tr><td><strong>学习成本</strong></td><td>高（需处理 UI 和交互）</td><td>中（React 组件）</td><td>中高（API 和插件系统）</td></tr><tr><td><strong>适用场景</strong></td><td>高度自定义、非 React 环境</td><td>React 项目，基础预览</td><td>React 项目，功能齐全的查看器</td></tr></tbody></table>
<p>目前主流开源的 pdf 渲染器都是基于 pdf.js 封装实现，其中比较有代表性的就是 react-pdf和 react-pdf-viewer，选型建议：</p>
<ul>
<li>如果你的项目基于 React，且需要一个开箱即用的 PDF 查看器，推荐选择 <strong>react-pdf-viewer</strong>。</li>
<li>如果你仅需在 React 中渲染 PDF 页面并希望自行设计 UI，建议使用 <strong>react-pdf</strong>。</li>
<li>如果你不在 React 环境中，或需要底层控制，建议直接使用 <strong>pdf.js</strong>。</li>
</ul>
<h2 data-id="heading-2">现存问题</h2>
<p>一直以来，我都是使用比较成熟的开源库 <code>react-pdf</code> 渲染 pdf 文档。不过，随着使用的深入，各种问题也随之浮现。例如开源的产品没法满足高度定制化、字体兼容问题导致显示错误.... 而最大的问题，是<strong>性能！</strong></p>
<ul>
<li>场景1： 500 页的 pdf 文档如果不做分页，市面上几乎没有一款 pdf 渲染器能做到流畅的滚动加载。</li>
<li>场景2：加载时间长，100M的文档，需要下载完才能预览，网络差的用户需要等 20分钟后才能看到。</li>
</ul>
<p>综上问题，本来原文档预览是一个方面使用者快速去对比分片、对比回答结果的快捷方式，却因为以上问题，使用起来特别难受。</p>
<p>react-pdf 兼容性问题可参考：<a href="https://juejin.cn/post/7429411484306128935" target="_blank" title="https://juejin.cn/post/7429411484306128935">全面解析 React-PDF 的浏览器兼容性及其解决策略背景 最近使用 react-pdf 进行 pdf 文件预览。上线 - 掘金</a></p>
<h2 data-id="heading-3">本文适用范围说明</h2>
<p>本文探讨的技术方案基于以下核心需求：</p>
<ol>
<li><strong>PDF 预览模式</strong>：采用无限滚动（Infinite Scroll）方式浏览文件内容，而非传统分页器（Pager）模式（逐页或固定页数翻页）。</li>
<li><strong>性能要求</strong>：需实现 PDF 文件的秒级加载，确保流畅体验。</li>
</ol>
<p><strong>重点说明</strong>： 无限滚动模式更符合现代用户习惯，适用于大多数实际场景。本文内容不涉及分页器模式的实现逻辑。</p>
<h2 data-id="heading-4">想法萌生</h2>
<p>就在我百思不得其解的时候，我看到了一款闭源的 canvas 实现的 pdf 渲染器。全文只有一个 canvas 元素！当然，简单体验了下，页数很多时依然会很卡，甚至不能用。</p>
<p>受此启发，所以我想，既然 pdf 文件在 OCR 识别之前的第一步，就一定是把每一页切成一张图片，那么基于这个场景下，我们完全可以使用图片来渲染呀，完全不用加载文件。</p>
<p>假设视图内只有一页，那么 canvas 中只会渲染 1 张图片，那速度岂不是秒开？</p>
<p>当然，pdf 文件流是二进制的，也能通过分段获取其中一部分文档。可是如何知道每一页的开始和结束符，这是一个问题。</p>
<h2 data-id="heading-5">lm-pdf</h2>
<p>为了方便下文讲解，我将此方案先命名为 <code>lm-pdf</code>, 主要是为了体现其出色的加载速度。</p>
<h2 data-id="heading-6">技术选型：react-konva</h2>
<p>有了以上思路，实现起来就是时间的问题了。我选用了 canvas 作为渲染底座，搜索一圈之后发现 <code>konvajs</code>在这个场景下非常适合。结合 react-konva, 在画布上渲染元素就非常简单了。</p>
<p>示例：在画布上渲染一张图片</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Stage</span>, <span class="hljs-title class_">Layer</span>, <span class="hljs-title class_">Image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-konva'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Stage</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{window.innerWidth}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{window.innerHeight}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Layer</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> <span class="hljs-attr">x</span>=<span class="hljs-string">{0}</span> <span class="hljs-attr">y</span>=<span class="hljs-string">{0}</span> <span class="hljs-attr">image</span>=<span class="hljs-string">{...}</span>&gt;</span>&lt;/ Image&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Layer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Stage</span>&gt;</span>
    );
  }
}
</span></code></pre>
<p>当然，使用 canvas 渲染还不够，既然要做到性能最好，我们还需要加上虚拟滚动。</p>
<h2 data-id="heading-7">核心功能：canvas 虚拟滚动</h2>
<p>很多人会说，都使用 canvas 了还使用什么虚拟滚动？可是你要知道，如果大量的元素常驻在画布上，加上滚动时，所有位置都要偏移，也就是说所有元素的位置都会被重新计算一遍。canvas 是按帧渲染的，这样 GPU 渲染肯定错错有余，不过内存和 CPU 性能却吃不消了！所以，<strong>要做就做到最好的！</strong> 而虚拟滚动恰好就能解决这个问题，因为视窗内同时显示的元素最多不超过 5 个，那么最多就这 5 个元素的计算量，会非常低。</p>
<h3 data-id="heading-8">虚拟滚动是什么</h3>
<p>虚拟滚动（Virtual Scrolling）是一种优化长列表渲染性能的技术。其基本原理是只渲染可视区域内的元素，而非整个列表，从而减少DOM节点的数量和提高页面性能。</p>
<p>虚拟滚动本身的原理说起来很简单，无非就是通过容器高度和滚动距离动态渲染子元素。不过，要实现一个基于 canvas 的<strong>虚拟滚动</strong>器，实现过程中，却有很多小细节值得分享。</p>
<h3 data-id="heading-9">传统实现方案</h3>
<p>Canvas 的虚拟滚动方案和常规实现方案有所不同，也有相同之处。所以我们需要先了解下传统的滚动条方案是怎么实现的。方便理解文章后面的内容。</p>
<p>完整 Demo 如下：</p>
<pre><code class="hljs language-ini" lang="ini">import React, { useState, useEffect, useRef } from 'react'<span class="hljs-comment">;</span>

// 虚拟滚动列表组件
const <span class="hljs-attr">VirtualScrollList</span> = ({ items, itemHeight }) =&gt; {
    // 状态：可见项的起始和结束索引
    const <span class="hljs-section">[startIndex, setStartIndex]</span> = useState(0)<span class="hljs-comment">;</span>
    const <span class="hljs-section">[endIndex, setEndIndex]</span> = useState(10)<span class="hljs-comment">;</span>

    // 引用：用于访问滚动容器
    const <span class="hljs-attr">containerRef</span> = useRef(null)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">handleScroll</span> = () =&gt; {
        // 获取当前滚动位置
        const <span class="hljs-attr">scrollTop</span> = containerRef.current.scrollTop<span class="hljs-comment">;</span>

        // 计算新的起始索引
        const <span class="hljs-attr">newStartIndex</span> = Math.floor(scrollTop / itemHeight)<span class="hljs-comment">;</span>

        // 计算新的结束索引
        const <span class="hljs-attr">newEndIndex</span> = newStartIndex + Math.ceil(containerRef.current.clientHeight / itemHeight)<span class="hljs-comment">;</span>

        // 更新可见项的索引
        setStartIndex(newStartIndex)<span class="hljs-comment">;</span>
        setEndIndex(newEndIndex)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>

    // 滚动事件监听
    useEffect(() =&gt; {
        const <span class="hljs-attr">container</span> = containerRef.current<span class="hljs-comment">;</span>
        container.addEventListener('scroll', handleScroll)<span class="hljs-comment">;</span>

        return () =&gt; {
            container.removeEventListener('scroll', handleScroll)<span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>
    }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

    // 可见项
    const <span class="hljs-attr">visibleItems</span> = items.slice(startIndex, endIndex)<span class="hljs-comment">;</span>

    // 计算占位符高度
    const <span class="hljs-attr">placeholderHeight</span> = items.length * itemHeight<span class="hljs-comment">;</span>

    return (
        &lt;div <span class="hljs-attr">style</span>={{ height: <span class="hljs-string">'300px'</span>, overflowY: <span class="hljs-string">'auto'</span> }} ref={containerRef}&gt;
            &lt;div <span class="hljs-attr">style</span>={{ height: `<span class="hljs-variable">${placeholderHeight}</span>px`, position: <span class="hljs-string">'relative'</span> }}&gt;
                &lt;div <span class="hljs-attr">style</span>={{ position: <span class="hljs-string">'absolute'</span>, top: `<span class="hljs-variable">${startIndex * itemHeight}</span>px`, left: <span class="hljs-number">0</span> }}&gt;
                    {visibleItems.map((item, index) =&gt; (
                        // 渲染可见项
                        &lt;div <span class="hljs-attr">key</span>={index} style={{ height: `<span class="hljs-variable">${itemHeight}</span>px` }}&gt;
                            {item}
                        &lt;/div&gt;
                    ))}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// 使用示例
const <span class="hljs-attr">items</span> = Array.from({ length: <span class="hljs-number">1000</span> }, (_, i) =&gt; `Item <span class="hljs-variable">${i + 1}</span>`)<span class="hljs-comment">;</span>
const <span class="hljs-attr">App</span> = () =&gt; (
    &lt;div&gt;
        &lt;h1&gt;虚拟滚动列表&lt;/h1&gt;
        &lt;VirtualScrollList <span class="hljs-attr">items</span>={items} itemHeight={<span class="hljs-number">30</span>} /&gt;
    &lt;/div&gt;
)<span class="hljs-comment">;</span>

export default App<span class="hljs-comment">;</span>
</code></pre>
<p>定义一个父容器，在容器中放一个<code>占位符</code>，占位符高度是所以 item 的总和，从而达到撑开父容器，出现滚动条。然后其子元素 item 使用 absolute 的方式悬浮在<code>占位符</code> 元素上。然后通过滚动的距离计算出要显示的子元素 visibleItems，渲染在页面上即可。</p>
<h3 data-id="heading-10">Canvas 虚拟滚动实现方案</h3>
<p>下面将使用伪代码展示核心原理。</p>
<p>一、canvas 内并没有滚动条的概念，所以我们需要自己实现一个滚动条。</p>
<p><strong>virtual-scroll-bar 组件</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Item</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Item</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
  [<span class="hljs-attr">k</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    <span class="hljs-attr">items</span>: <span class="hljs-title class_">Item</span> [];
    <span class="hljs-attr">onVisibleItemChange</span>: <span class="hljs-function">(<span class="hljs-params">items: Item[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    onScroll?: <span class="hljs-function">(<span class="hljs-params">scroll: { left: <span class="hljs-built_in">number</span>; top: <span class="hljs-built_in">number</span> }</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">VirtualScrollBar</span> = (<span class="hljs-params">{ items }: </span>) =&gt; {
    <span class="hljs-comment">// 滚动触发</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScroll</span> (scroll) {
        <span class="hljs-title function_">updateVisibleItems</span>(scroll)
        <span class="hljs-title function_">onScroll</span>(scroll)
    }

    <span class="hljs-comment">// 计算可视元素</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateVisibleItems</span> (scroll) {
       <span class="hljs-keyword">const</span> visibleItems = []
       <span class="hljs-comment">// .....省略计算过程</span>
       <span class="hljs-title function_">onVisibleItemChange</span>(visibleItems)
    }

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{divRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">v-scroll-bar</span> ${<span class="hljs-attr">direction</span>}`}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">height:</span> <span class="hljs-attr">items.reduce</span>((<span class="hljs-attr">sum</span>, <span class="hljs-attr">item</span>) =&gt;</span> (sum += item.height), 0),
        }}&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>同样的方式，我们在 div 中加入一个占位符，高度是所以 item 的总和。然后通过监听 divRef 的滚动，计算出视图内出现的元素。</p>
<p><strong>核心逻辑（伪代码）</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 当前显示元素</span>
const <span class="hljs-selector-attr">[displayItems, setDisplayItems]</span> = useState&lt;PageItem<span class="hljs-selector-attr">[]</span>&gt;([]);

const onScroll: VirtualScrollBarProps[<span class="hljs-string">"onScroll"</span>] = ({ <span class="hljs-attribute">left</span>, <span class="hljs-attribute">top</span> }) =&gt; {
    <span class="hljs-comment">// 整体 y 方向偏移, 这里使用 setData 而不是 setData =&gt; old,</span>
    <span class="hljs-comment">// 因为滚动频繁，利用 setData 更新机制可以做到节流，提升性能</span>
    <span class="hljs-built_in">setDisplayItems</span>((old) =&gt;
      old<span class="hljs-selector-class">.map</span>((m) =&gt; ({
        ...m,
        y: m.top - top,
      }))
)};


<span class="hljs-comment">// 对比新旧值，更新 Y 的坐标</span>
<span class="hljs-comment">// 滚动的过程中，y 会偏移，新的 items 进来，如果有公共的 items ,要和旧的保持一致。</span>
function diffAndUpdateY () {}

function <span class="hljs-built_in">onVisibleItemChange</span>(originItems: VirtualScrollBarProps["items"]) {
    const items = originItems as PageItem<span class="hljs-selector-attr">[]</span>;
    <span class="hljs-comment">// 这里要做一件事，新的 items 会把 y 的坐标全部重新排过，这会有问题，表现为突然弹跳位置。</span>
    <span class="hljs-comment">// 如果新的 items 中和旧的 items 中有共同的 item, 那么以旧的 item 的 y 为准，保持不变</span>
    <span class="hljs-comment">// 那么新出现的，排在旧的上面或下面</span>
    <span class="hljs-built_in">startTransition</span>(() =&gt; {
      <span class="hljs-built_in">startTransition</span>(() =&gt; {
        <span class="hljs-built_in">setDisplayItems</span>((old) =&gt; <span class="hljs-built_in">diffAndUpdateY</span>(old, items));
      });
    });
}


&lt;VirtualScrollBar
    items={pages}
    onVisibleItemChange={onVisibleItemChange}
    onScroll={onScroll}
&gt;&lt;/VirtualScrollBar&gt;
</code></pre>
<h2 data-id="heading-11">核心功能：如何实现页面平滑切换</h2>
<p>不过你会发现，页面是一卡一卡的，像是幻灯片，子元素没有随着滚动而移动的。只是会到达一定滚动距离后，就会全部替换成新的元素。因为我们还没有做偏移，元素要随着滚动在容器内上下移动，直到移动到容器外，才替换成新的元素。实现偏移：所以我们把整体元素 y 值随着滚动偏移，<code> y = y + offsetY</code>, 这样元素就会滚动效果 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ed2ae897b0484d8049aeb722ff9579~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764090470&amp;x-signature=UDEmKgUVD32%2BGNizJOOyYYFe%2FtM%3D" alt="image.png" loading="lazy"/></p>
<p>要想实现流畅滚动（平滑切换），还要实现新旧元素 Diff ，原理如下：</p>
<p>如上图，假设我们当前视图显示了 [元素1、元素2]，子元素高度都是 200px，滚动了 30px 后，显示了 [元素1、元素2、元素 3]。</p>
<p>元素 1、元素 2 在是它们的交集。所以元素 1、元素 2 的位置要保持以前的位置不变（用户界面能看到的已有的元素，不能因为切换了新的元素而改变位置），而元素 3 应该在元素 2 后面。</p>

























<table><thead><tr><th>元素</th><th>初始坐标（滚动前）</th><th>滚动后坐标（向下滚动 30px）</th></tr></thead><tbody><tr><td>元素1</td><td><code>[0, 0]</code></td><td><code>[0, -30]</code></td></tr><tr><td>元素2</td><td><code>[0, 200]</code></td><td><code>[0, 170]</code></td></tr><tr><td>元素3</td><td>—</td><td><code>[0, 370]</code></td></tr></tbody></table>
<p>做完 diff 后，从用户的角度就会发现是连续的滚动，而实际是不停的在切换新元素。</p>
<h2 data-id="heading-12">性能优化：异步加载，减少线程阻塞</h2>
<p>因为滚动的过程中是连续的，例如从第1页滚到 100页，那么中间的 2-99 都会被渲染一遍，其实我只是想看第 100 页，这会严重拖慢页面的渲染性能。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// page.ts</span>
<span class="hljs-built_in">useEffect</span>(() =&gt; {
    if (!blocks.length) return;

    <span class="hljs-comment">// 延迟渲染定时器</span>
    const timer = <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      <span class="hljs-comment">// 开始渲染</span>
      <span class="hljs-built_in">setDisplayBlocks</span>(blocks);
    }, <span class="hljs-number">500</span>);

    return () =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(timer);
    };
  }, <span class="hljs-selector-attr">[blocks]</span>);
</code></pre>
<p>上面我用了一个定时器，完美解决了这个问题，只有等组件出现在可视区域，渲染后且 500 毫秒内没有消失，才会真正渲染。这样就能避免无效的渲染任务。</p>
<p>500 毫秒最终使用过程中被我改成了 200，不然会出现明显的等待渲染过程，影响体验。</p>
<h2 data-id="heading-13">性能对比</h2>
<p>页面加载速度测试，我采用目前开源中用的最多的 <code>react-pdf</code> 和 <code>lm-pdf</code> 作对比:</p>
<ul>
<li>测试指标： 首页渲染时间</li>
<li>测试网速：13.9 Mbps</li>
</ul>






























<table><thead><tr><th>PDF 测试文件页码</th><th>react-pdf</th><th>lm-pdf</th></tr></thead><tbody><tr><td>3页</td><td>3.5s</td><td>1s</td></tr><tr><td>50页</td><td>7s</td><td>1.5s</td></tr><tr><td>344页</td><td>109s</td><td>2.5s</td></tr><tr><td>1000页</td><td>240s</td><td>2.5s</td></tr></tbody></table>
<p>react-pdf 的加载速度取决于文档的大小，下载的网速影响。而 <code>lm-pdf</code> 的优势在于无论多少页，都趋近于 2.5s，打开的速度取决于单页的图片大小。</p>
<h2 data-id="heading-14">lm-pdf 优缺点</h2>
<p>优点：</p>
<ul>
<li>极快的首次加载速度（和文件大小、页数无关）</li>
<li>丝滑的滚动体验</li>
<li>极低的内存占用</li>
<li>极少的页面 DOM</li>
</ul>
<p>缺点：</p>
<ul>
<li>目前不支持复制 PDF 文本（研究中）</li>
<li>PDF 必须先被切成图片</li>
</ul>
<p>持续优化的点：其实还可以在远端无损压缩图片，进一步提高渲染速度。</p>
<h2 data-id="heading-15">总结</h2>
<p>如果你看重的是加速速度和性能，lm-pdf 绝对能满足你的需求，不过此方案还存在一些局限，例如强依赖后端生成 pdf 单页图片、不支持复制 PDF 文本等，不过目前已开源，后续还会持续完善，也希望感兴趣的同学一起 PR 共建。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【claude code官网文章】Skills 功能解析：Skills 与 prompts、Projects、MCP 和 subagents 的比较]]></title>    <link>https://juejin.cn/post/7573904312712331299</link>    <guid>https://juejin.cn/post/7573904312712331299</guid>    <pubDate>2025-11-18T19:07:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573904312712331299" data-draft-id="7573900879997403136" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【claude code官网文章】Skills 功能解析：Skills 与 prompts、Projects、MCP 和 subagents 的比较"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-18T19:07:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【claude code官网文章】Skills 功能解析：Skills 与 prompts、Projects、MCP 和 subagents 的比较
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T19:07:11.000Z" title="Tue Nov 18 2025 19:07:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fskills-explained" target="_blank" title="https://www.claude.com/blog/skills-explained" ref="nofollow noopener noreferrer">转载</a></p>
<p>Skills 是一个日益强大的工具，用于创建自定义 AI 工作流和 agents，但它们在 Claude 技术栈中处于什么位置？我们解释什么时候使用什么工具——以及它们如何协同工作。</p>
<h2 data-id="heading-0">理解你的 agent 构建组件</h2>
<h3 data-id="heading-1">什么是 Skills？</h3>
<p>Skills 是包含指令、脚本和资源的文件夹，当与任务相关时，Claude 会动态发现和加载它们。可以将其视为专门化的训练手册，为 Claude 提供特定领域的专业知识——从处理 Excel 电子表格到遵循您组织的品牌指南。</p>
<p><strong>Skills 的工作原理：</strong> 当 Claude 遇到任务时，它会扫描可用的 Skills 以找到相关匹配。Skills 使用渐进式披露：元数据首先加载（约 100 tokens），为 Claude 提供足够的信息来了解 Skill 何时相关。完整指令在需要时加载（少于 5k tokens），捆绑文件或脚本仅在需要时加载。</p>
<p><strong>何时使用 Skills：</strong> 当您需要 Claude 一致且高效地执行专门任务时，选择 Skills。它们非常适合：</p>
<ul>
<li><strong>组织工作流：</strong> 品牌指南、合规程序、文档模板</li>
<li><strong>领域专业知识：</strong> Excel 公式、PDF 操作、数据分析</li>
<li><strong>个人偏好：</strong> 笔记系统、编码模式、研究方法</li>
</ul>
<p><strong>示例：</strong> 创建一个品牌指南 Skill，包括您公司的调色板、排版规则和布局规范。当 Claude 创建演示文稿或文档时，它会自动应用这些标准，而无需您每次都进行解释。</p>
<h3 data-id="heading-2">什么是 prompts？</h3>
<p>Prompts 是您在对话中用自然语言向 Claude 提供的指令。它们是短暂的、对话式的和反应性的——您在当下提供背景和方向。</p>
<p><strong>何时使用 prompts：</strong> 将 prompts 用于：</p>
<ul>
<li><strong>一次性请求：</strong>"总结这篇文章"</li>
<li><strong>对话式优化：</strong>"让语气更专业"</li>
<li><strong>即时背景：</strong>"分析这些数据并识别趋势"</li>
<li><strong>临时指令：</strong>"将其格式化为项目符号列表"</li>
</ul>
<p><strong>何时使用 Skill 代替：</strong> 如果您发现自己反复输入相同的 prompt，那么是时候创建一个 Skill 了。将重复出现的指令如"使用 OWASP 标准审查此代码的安全漏洞"或"用执行摘要、关键发现和建议格式化此分析"转换为 Skills。</p>
<h3 data-id="heading-3">什么是 Projects？</h3>
<p>在所有付费 Claude 计划中都可用，Projects 是具有自己聊天历史和知识库的自包含工作空间。每个项目包括一个 200K 上下文窗口，您可以在其中上传文档、提供背景信息，并设置适用于该项目内所有对话的自定义指令。</p>
<p><strong>Projects 的工作原理：</strong> 您上传到项目知识库的所有内容都会在该项目的所有聊天中变得可用。Claude 自动使用此背景信息提供更明智、更相关的回应。当您的项目知识接近上下文限制时，Claude 无缝启用检索增强生成（RAG）模式，将容量扩展最多 10 倍。</p>
<p><strong>何时使用 Projects：</strong> 当您需要以下情况时选择 Projects：</p>
<ul>
<li><strong>持久上下文：</strong> 应该为每次对话提供信息的背景知识</li>
<li><strong>工作空间组织：</strong> 为不同倡议分离上下文</li>
<li><strong>团队协作：</strong> 共享知识和对话历史</li>
<li><strong>自定义指令：</strong> 项目特定的语气、观点或方法</li>
</ul>
<p><strong>示例：</strong> 创建一个包含市场研究、竞争对手分析和产品规格的"Q4 产品发布"项目。此项目中的每次聊天都可以访问这些知识，而无需您重新上传或重新解释背景。</p>
<h3 data-id="heading-4">什么是 subagents？</h3>
<p>Subagents 是具有自己上下文窗口、自定义系统提示和特定工具权限的专业化 AI 助手。在 Claude Code 和 Claude Agent SDK 中可用，subagents 独立处理离散任务并将结果返回给主 agent。</p>
<p><strong>Subagents 的工作原理：</strong> 每个 subagent 都以自己的配置运行——您定义它做什么、如何处理问题以及可以访问哪些工具。Claude 根据其描述自动将任务委托给适当的 subagents，或者您可以明确请求特定的 subagent。</p>
<p><strong>何时使用 subagents：</strong> 将 subagents 用于：</p>
<ul>
<li><strong>任务专业化：</strong> 代码审查、测试生成、安全审计</li>
<li><strong>上下文管理：</strong> 保持主对话专注，同时卸载专门工作</li>
<li><strong>并行处理：</strong> 多个 subagents 可以同时处理不同方面</li>
<li><strong>工具限制：</strong> 将特定 subagents 限制为安全操作</li>
</ul>
<p><strong>示例：</strong> 创建一个代码审查器 subagent，可以访问 Read、Grep 和 Glob 工具，但不能访问 Write 或 Edit。当您修改代码时，Claude 自动委托给此 subagent 进行质量和安全审查，而不会面临意外代码更改的风险。</p>
<h3 data-id="heading-5">什么是 MCP？</h3>
<p>模型上下文协议（MCP）是一个开放标准，用于将 AI 助手连接到数据所在的外部系统——内容存储库、业务工具、数据库和开发环境。</p>
<p><strong>MCP 的工作原理：</strong> MCP 提供了一种标准化方式将 Claude 连接到您的工具和数据源。您不是为每个数据源构建自定义集成，而是构建单一协议。MCP 服务器暴露数据和功能；MCP 客户端（如 Claude）连接到这些服务器。</p>
<p><strong>何时使用 MCP：</strong> 当您需要 Claude 执行以下操作时选择 MCP：</p>
<ul>
<li><strong>访问外部数据：</strong> Google Drive、Slack、GitHub、数据库</li>
<li><strong>使用业务工具：</strong> CRM 系统、项目管理平台</li>
<li><strong>连接到开发环境：</strong> 本地文件、IDE、版本控制</li>
<li><strong>与自定义系统集成：</strong> 您的专有工具和数据源</li>
</ul>
<p><strong>示例：</strong> 通过 MCP 将 Claude 连接到您公司的 Google Drive。现在 Claude 可以搜索文档、读取文件并参考内部知识，无需手动上传——连接会自动持久化和更新。</p>
<h2 data-id="heading-6">它们如何协同工作</h2>
<p>真正的力量来自于将这些构建块结合起来。每个都有不同的用途，它们共同创建复杂的 agent 工作流。</p>
<h3 data-id="heading-7">比较：选择合适的工具</h3>





























































<table><thead><tr><th>功能</th><th>Skills</th><th>Prompts</th><th>Projects</th><th>Subagents</th><th>MCP</th></tr></thead><tbody><tr><td>提供什么</td><td>程序性知识</td><td>即时指令</td><td>背景知识</td><td>任务委托</td><td>工具连接</td></tr><tr><td>持久性</td><td>跨对话</td><td>单次对话</td><td>项目内</td><td>跨会话</td><td>持续连接</td></tr><tr><td>包含内容</td><td>指令 + 代码 + 资产</td><td>自然语言</td><td>文档 + 上下文</td><td>完整 agent 逻辑</td><td>工具定义</td></tr><tr><td>加载时机</td><td>动态，按需</td><td>每轮对话</td><td>项目中始终</td><td>调用时</td><td>始终可用</td></tr><tr><td>可包含代码</td><td>是</td><td>否</td><td>否</td><td>是</td><td>是</td></tr><tr><td>最适合</td><td>专门化专业知识</td><td>快速请求</td><td>集中化上下文</td><td>专门化任务</td><td>数据访问</td></tr></tbody></table>
<h3 data-id="heading-8">示例 agent 工作流：研究 agent</h3>
<p>让我们构建一个结合多个构建块的综合研究 agent。这个示例展示如何组装和激活一个用于竞争分析的 agent。</p>
<h4 data-id="heading-9">步骤 1：设置您的 Project</h4>
<p>创建一个"竞争情报"项目并上传行业报告、市场分析、竞争对手产品文档、客户反馈和之前的研究摘要。</p>
<h4 data-id="heading-10">步骤 2：通过 MCP 连接数据源</h4>
<p>为 Google Drive、GitHub 和网络搜索启用 MCP 服务器。</p>
<h4 data-id="heading-11">步骤 3：创建专门的 Skills</h4>
<p>创建一个包含您公司导航策略和搜索最佳实践的"竞争分析"skill。</p>
<h4 data-id="heading-12">步骤 4：配置 subagents</h4>
<p>为市场研究和技术分析创建具有特定工具和专业知识的专门化 subagents。</p>
<h4 data-id="heading-13">步骤 5：激活您的研究 agent</h4>
<p>现在当您向 Claude 请求竞争分析时，它会从多个数据源获取信息，遵循您的分析框架，利用专门化专业知识，并在整个研究项目中保持上下文。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue表单组件进阶：打造属于你的自定义v-model]]></title>    <link>https://juejin.cn/post/7573892156257746980</link>    <guid>https://juejin.cn/post/7573892156257746980</guid>    <pubDate>2025-11-18T23:32:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892156257746980" data-draft-id="7574069837526663210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue表单组件进阶：打造属于你的自定义v-model"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-18T23:32:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue表单组件进阶：打造属于你的自定义v-model
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:32:59.000Z" title="Tue Nov 18 2025 23:32:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从基础到精通：掌握组件数据流的核心</h2>
<p>每次写表单组件，你是不是还在用 props 传值、$emit 触发事件的老套路？面对复杂表单需求时，代码就像一团乱麻，维护起来让人头疼不已。今天我要带你彻底掌握自定义 v-model 的奥秘，让你的表单组件既优雅又强大。</p>
<p>读完本文，你将学会如何为任何组件实现自定义的 v-model，理解 Vue 3 中 v-model 的进化，并掌握在实际项目中的最佳实践。准备好了吗？让我们开始这段精彩的组件开发之旅！</p>
<h2 data-id="heading-1">重新认识 v-model：不只是语法糖</h2>
<p>在深入自定义之前，我们先来回顾一下 v-model 的本质。很多人以为 v-model 是 Vue 的魔法，其实它只是一个语法糖。</p>
<p>让我们看一个基础示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原生 input 的 v-model 等价于：</span>
&lt;input 
  :value=<span class="hljs-string">"searchText"</span> 
  @input=<span class="hljs-string">"searchText = $event.target.value"</span>
&gt;

<span class="hljs-comment">// 这就是 v-model 的真相！</span>
</code></pre>
<p>在 Vue 3 中，v-model 迎来了重大升级。现在你可以在同一个组件上使用多个 v-model，这让我们的表单组件开发更加灵活。</p>
<h2 data-id="heading-2">自定义 v-model 的核心原理</h2>
<p>自定义 v-model 的核心就是实现一个协议：组件内部管理自己的状态，同时在状态变化时通知父组件。</p>
<p>在 Vue 3 中，这变得异常简单。我们来看看如何为一个自定义输入框实现 v-model：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// CustomInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-input"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:modelValue', $event.target.value)"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"input-field"</span>
    &gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 定义 props - 默认的 modelValue</span>
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  }
})

<span class="hljs-comment">// 定义 emits - 必须声明 update:modelValue</span>
<span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>使用这个组件时，我们可以这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomInput</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> /&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>看到这里你可能要问：为什么是 <code>modelValue</code> 和 <code>update:modelValue</code>？这就是 Vue 3 的约定。默认情况下，v-model 使用 <code>modelValue</code> 作为 prop，<code>update:modelValue</code> 作为事件。</p>
<h2 data-id="heading-3">实战：打造一个功能丰富的搜索框</h2>
<p>让我们来实战一个更复杂的例子——一个带有清空按钮和搜索图标的搜索框组件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SearchInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-input-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-icon"</span>&gt;</span>🔍<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
      @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">"handleSearch"</span>
      <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">"placeholder"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"search-input"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"modelValue"</span> 
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"clearInput"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"clear-button"</span>
    &gt;</span>
      ×
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 接收 modelValue 和 placeholder</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">placeholder</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'请输入搜索内容...'</span>
  }
})

<span class="hljs-comment">// 定义可触发的事件</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'search'</span>])

<span class="hljs-comment">// 处理输入事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)
}

<span class="hljs-comment">// 处理清空操作</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">clearInput</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">''</span>)
}

<span class="hljs-comment">// 处理搜索事件（按回车时）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'search'</span>, props.<span class="hljs-property">modelValue</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.search-input-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dcdfe6</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.search-icon</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#909399</span>;
}

<span class="hljs-selector-class">.search-input</span> {
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.clear-button</span> {
  <span class="hljs-attribute">background</span>: none;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#c0c4cc</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.clear-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#909399</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>使用这个搜索框组件：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SearchInput</span> 
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"searchText"</span>
      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"搜索用户..."</span>
      @<span class="hljs-attr">search</span>=<span class="hljs-string">"handleSearch"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前搜索词：{{ searchText }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> searchText = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">value</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行搜索：'</span>, value)
  <span class="hljs-comment">// 这里可以调用 API 进行搜索</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-4">进阶技巧：多个 v-model 绑定</h2>
<p>Vue 3 最令人兴奋的特性之一就是支持多个 v-model。这在处理复杂表单时特别有用，比如一个用户信息编辑组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserForm.vue</span>
&lt;template&gt;
  &lt;div class="user-form"&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;姓名：&lt;/label&gt;
      &lt;input
        :value="name"
        @input="$emit('update:name', $event.target.value)"
      &gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
      &lt;label&gt;邮箱：&lt;/label&gt;
      &lt;input
        :value="email"
        @input="$emit('update:email', $event.target.value)"
        type="email"
      &gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
      &lt;label&gt;年龄：&lt;/label&gt;
      &lt;input
        :value="age"
        @input="$emit('update:age', $event.target.value)"
        type="number"
      &gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps({
  name: String,
  email: String,
  age: Number
})

defineEmits(['update:name', 'update:email', 'update:age'])
&lt;/script&gt;
</code></pre>
<p>使用这个多 v-model 组件：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span>
    <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"userInfo.name"</span>
    <span class="hljs-attr">v-model:email</span>=<span class="hljs-string">"userInfo.email"</span>
    <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"userInfo.age"</span>
  /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-literal">null</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-5">处理复杂数据类型</h2>
<p>有时候我们需要传递的不是简单的字符串，而是对象或数组。这时候自定义 v-model 同样能胜任：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ColorPicker.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"color-picker"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">v-for</span>=<span class="hljs-string">"color in colors"</span> 
      <span class="hljs-attr">:key</span>=<span class="hljs-string">"color"</span>
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"['color-option', { active: isSelected(color) }]"</span>
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ backgroundColor: color }"</span>
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"selectColor(color)"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Array</span>],
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">multiple</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">colors</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> [<span class="hljs-string">'#ff4757'</span>, <span class="hljs-string">'#2ed573'</span>, <span class="hljs-string">'#1e90ff'</span>, <span class="hljs-string">'#ffa502'</span>, <span class="hljs-string">'#747d8c'</span>]
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">// 处理颜色选择</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectColor</span> = (<span class="hljs-params">color</span>) =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">multiple</span>) {
    <span class="hljs-keyword">const</span> currentSelection = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(props.<span class="hljs-property">modelValue</span>) 
      ? [...props.<span class="hljs-property">modelValue</span>] 
      : []
    
    <span class="hljs-keyword">const</span> index = currentSelection.<span class="hljs-title function_">indexOf</span>(color)
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      currentSelection.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    } <span class="hljs-keyword">else</span> {
      currentSelection.<span class="hljs-title function_">push</span>(color)
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, currentSelection)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, color)
  }
}

<span class="hljs-comment">// 检查颜色是否被选中</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">isSelected</span> = (<span class="hljs-params">color</span>) =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">multiple</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(props.<span class="hljs-property">modelValue</span>) &amp;&amp; props.<span class="hljs-property">modelValue</span>.<span class="hljs-title function_">includes</span>(color)
  }
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">modelValue</span> === color
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.color-picker</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.color-option</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid transparent;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.color-option</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
}

<span class="hljs-selector-class">.color-option</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>使用这个颜色选择器：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 单选模式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ColorPicker</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"selectedColor"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>选中的颜色：{{ selectedColor }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 多选模式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ColorPicker</span> 
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"selectedColors"</span> 
      <span class="hljs-attr">:multiple</span>=<span class="hljs-string">"true"</span> 
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>选中的颜色：{{ selectedColors }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> selectedColor = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'#1e90ff'</span>)
<span class="hljs-keyword">const</span> selectedColors = <span class="hljs-title function_">ref</span>([<span class="hljs-string">'#ff4757'</span>, <span class="hljs-string">'#2ed573'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-6">性能优化与最佳实践</h2>
<p>在实现自定义 v-model 时，我们还需要注意一些性能问题和最佳实践：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优化版本的表单组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
    @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
    <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>
  &gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { watch, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Number</span>],
  <span class="hljs-comment">// 添加防抖功能</span>
  <span class="hljs-attr">debounce</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-keyword">let</span> timeoutId = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 使用 toRef 确保响应性</span>
<span class="hljs-keyword">const</span> modelValueRef = <span class="hljs-title function_">toRef</span>(props, <span class="hljs-string">'modelValue'</span>)

<span class="hljs-comment">// 监听外部对 modelValue 的更改</span>
<span class="hljs-title function_">watch</span>(modelValueRef, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
  <span class="hljs-comment">// 这里可以执行一些副作用</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'值发生变化：'</span>, newValue)
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">const</span> value = event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  
  <span class="hljs-comment">// 防抖处理</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">debounce</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timeoutId)
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
    }, props.<span class="hljs-property">debounce</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
  }
}

<span class="hljs-comment">// 组件卸载时清理定时器</span>
<span class="hljs-keyword">import</span> { onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">clearTimeout</span>(timeoutId)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-7">常见问题与解决方案</h2>
<p>在实际开发中，你可能会遇到这些问题：</p>
<p><strong>问题1：为什么我的 v-model 不工作？</strong>
检查两点：是否正确定义了 <code>update:modelValue</code> 事件，以及是否在 emits 中声明了这个事件。</p>
<p><strong>问题2：如何处理复杂的验证逻辑？</strong>
可以在组件内部实现验证，也可以通过额外的 prop 传递验证规则：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 带有验证的表单组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"validated-input"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ error: hasError }"</span>
    &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"hasError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>
      {{ errorMessage }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'validation'</span>])

<span class="hljs-comment">// 计算验证状态</span>
<span class="hljs-keyword">const</span> validationResult = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">rules</span>.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> props.<span class="hljs-property">rules</span>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">rule</span>(props.<span class="hljs-property">modelValue</span>)
    <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: result }
    }
  }
  
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
})

<span class="hljs-keyword">const</span> hasError = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !validationResult.<span class="hljs-property">value</span>.<span class="hljs-property">valid</span>)
<span class="hljs-keyword">const</span> errorMessage = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> validationResult.<span class="hljs-property">value</span>.<span class="hljs-property">message</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">const</span> value = event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'validation'</span>, validationResult.<span class="hljs-property">value</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-8">拥抱 Composition API 的强大能力</h2>
<p>使用 Composition API，我们可以创建更加灵活的可复用逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useVModel.js - 自定义 v-model 的 composable</span>
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useVModel</span>(<span class="hljs-params">props, emit, name = <span class="hljs-string">'modelValue'</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">computed</span>({
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> props[name]
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) {
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">`update:<span class="hljs-subst">${name}</span>`</span>, value)
    }
  })
}
</code></pre>
<p>在组件中使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 composable 的组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"valueProxy"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useVModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./useVModel'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">// 使用 composable</span>
<span class="hljs-keyword">const</span> valueProxy = <span class="hljs-title function_">useVModel</span>(props, emit)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-9">总结与思考</h2>
<p>通过今天的学习，我们深入掌握了 Vue 自定义 v-model 的方方面面。从基础原理到高级用法，从简单输入框到复杂表单组件，你现在应该能够自信地为任何场景创建自定义 v-model 组件了。</p>
<p>记住，自定义 v-model 的核心价值在于提供一致的用户体验。无论是在简单还是复杂的场景中，它都能让我们的组件使用起来更加直观和便捷。</p>
<p>现在，回顾一下你的项目，有哪些表单组件可以重构为自定义 v-model 的形式？这种重构会为你的代码库带来怎样的改善？欢迎在评论区分享你的想法和实践经验！</p>
<p>技术的进步永无止境，但掌握核心原理让我们能够从容应对各种变化。希望今天的分享能为你的 Vue 开发之路带来新的启发和思考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET DateTime 最强入门到进阶：格式化、转换、UTC、时区全覆盖]]></title>    <link>https://juejin.cn/post/7573892156257681444</link>    <guid>https://juejin.cn/post/7573892156257681444</guid>    <pubDate>2025-11-18T22:59:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892156257681444" data-draft-id="7573888000021004351" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET DateTime 最强入门到进阶：格式化、转换、UTC、时区全覆盖"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-18T22:59:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET DateTime 最强入门到进阶：格式化、转换、UTC、时区全覆盖
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T22:59:44.000Z" title="Tue Nov 18 2025 22:59:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>DateTime</code> 是 <code>System</code> 命名空间中用于表示日期和时间的结构体，广泛用于处理时间相关的操作，如存储、计算、格式化等。</p>
<h3 data-id="heading-1">DateTime 结构概述</h3>
<ul>
<li>
<p>定义：<code>System.DateTime</code> 是一个值类型（<code>struct</code>），表示自公元 0001 年 1 月 1 日午夜 00:00:00（<code>DateTime.MinValue</code>）起经过的“刻度”（ticks，1 tick = 100 纳秒）数。</p>
</li>
<li>
<p>内部存储：一个 <code>long</code> 值（ticks）+ 一个 <code>DateTimeKind</code> 枚举，指示时间的“种类”：</p>
<ul>
<li>
<p><code>Unspecified</code>：未指定是本地还是 <code>UTC</code></p>
</li>
<li>
<p><code>Utc</code>：协调世界时</p>
</li>
<li>
<p><code>Local</code>：本地时区时间</p>
</li>
</ul>
</li>
<li>
<p>范围：<code>DateTime.MinValue</code>（0001-01-01），<code>DateTime.MaxValue</code>（9999-12-31 23:59:59.9999999）</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 时间单位转换</span>
<span class="hljs-number">1</span> 秒 = <span class="hljs-number">10</span>,<span class="hljs-number">000</span>,<span class="hljs-number">000</span> Ticks
<span class="hljs-number">1</span> 毫秒 = <span class="hljs-number">10</span>,<span class="hljs-number">000</span> Ticks
<span class="hljs-number">1</span> 分钟 = <span class="hljs-number">600</span>,<span class="hljs-number">000</span>,<span class="hljs-number">000</span> Ticks
</code></pre>
<h3 data-id="heading-2">主要功能</h3>
<h4 data-id="heading-3">表示日期和时间：</h4>
<ul>
<li>
<p>包含年、月、日、时、分、秒、毫秒。</p>
</li>
<li>
<p>支持 <code>Kind</code> 属性（<code>Utc、Local、Unspecified</code>）。</p>
</li>
</ul>
<h4 data-id="heading-4">时间操作：</h4>
<ul>
<li>
<p>比较：<code>Compare、CompareTo</code>。</p>
</li>
<li>
<p>运算：加减时间（<code>AddDays、AddHours</code> 等）。</p>
</li>
<li>
<p>时间差：<code>Subtract</code> 返回 <code>TimeSpan</code>。</p>
</li>
</ul>
<h4 data-id="heading-5">格式化：</h4>
<ul>
<li>
<p>使用 <code>ToString</code> 格式化（如 <code>"yyyy-MM-dd HH:mm:ss"</code>）。</p>
</li>
<li>
<p>支持区域性（<code>CultureInfo</code>）。</p>
</li>
</ul>
<h4 data-id="heading-6">转换：</h4>
<ul>
<li>与字符串、<code>Unix</code> 时间戳、数据库时间互转。</li>
</ul>
<h4 data-id="heading-7">静态属性：</h4>
<ul>
<li>
<p><code>DateTime.Now</code>：本地时间。</p>
</li>
<li>
<p><code>DateTime.UtcNow</code>：<code>UTC</code> 时间。</p>
</li>
<li>
<p><code>DateTime.Today</code>：当前日期（时间为 00:00:00）。</p>
</li>
</ul>
<h3 data-id="heading-8">核心属性</h3>

















































<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><code>Now</code></td><td>返回本地时区当前时间</td></tr><tr><td><code>UtcNow</code></td><td>返回 UTC 当前时间</td></tr><tr><td><code>Today</code></td><td>返回本地时区当前日期（00:00:00 时分秒）</td></tr><tr><td><code>Date</code></td><td>取当前实例的日期部分，时间部分置 00:00:00</td></tr><tr><td><code>Year</code>, <code>Month</code>, <code>Day</code></td><td>年、月、日</td></tr><tr><td><code>Hour</code>, <code>Minute</code>, <code>Second</code>, <code>Millisecond</code></td><td>小时、分钟、秒、毫秒</td></tr><tr><td><code>DayOfWeek</code></td><td>星期枚举（<code>DayOfWeek.Monday</code>…）</td></tr><tr><td><code>DayOfYear</code></td><td>年内天数（1–366）</td></tr><tr><td><code>Kind</code></td><td>时间种类（<code>Utc</code>/<code>Local</code>/<code>Unspecified</code>）</td></tr><tr><td><code>Ticks</code></td><td>自 0001-01-01 00:00:00 起的刻度数（100ns 为单位）</td></tr></tbody></table>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> dt = DateTime.Now;
Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{dt.Year}</span>-<span class="hljs-subst">{dt.Month}</span>-<span class="hljs-subst">{dt.Day}</span> <span class="hljs-subst">{dt.Hour}</span>:<span class="hljs-subst">{dt.Minute}</span>:<span class="hljs-subst">{dt.Second}</span>, Kind=<span class="hljs-subst">{dt.Kind}</span>"</span>);
</code></pre>
<h3 data-id="heading-9">构造与转换</h3>
<h4 data-id="heading-10">构造器</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 指定年月日时分秒</span>
<span class="hljs-keyword">var</span> dt1 = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2025</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">14</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 指定 Kind</span>
<span class="hljs-keyword">var</span> dt2 = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2025</span>,<span class="hljs-number">8</span>,<span class="hljs-number">8</span>,<span class="hljs-number">14</span>,<span class="hljs-number">30</span>,<span class="hljs-number">0</span>, DateTimeKind.Utc);
</code></pre>
<h4 data-id="heading-11">从 ticks</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> dtTicks = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">637632000000000000L</span>);
</code></pre>
<h4 data-id="heading-12">与 Unix 时间戳</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// DateTime &lt;-&gt; Unix seconds</span>
<span class="hljs-keyword">var</span> unixEpoch = DateTimeOffset.FromUnixTimeSeconds(<span class="hljs-number">0</span>).UtcDateTime;
<span class="hljs-built_in">long</span> toUnix = ((DateTimeOffset)DateTime.UtcNow).ToUnixTimeSeconds();
</code></pre>
<h4 data-id="heading-13">与 DateTimeOffset</h4>
<ul>
<li>
<p><code>DateTimeOffset</code> 推荐用于跨时区场景，包含一个偏移量字段，且不朴素依赖 <code>Kind</code>。</p>
</li>
<li>
<p>从 <code>DateTime</code> 转换：</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> dto = <span class="hljs-keyword">new</span> DateTimeOffset(dt);              <span class="hljs-comment">// 按本地偏移</span>
<span class="hljs-keyword">var</span> dtoUtc = <span class="hljs-keyword">new</span> DateTimeOffset(dt, TimeSpan.Zero);
</code></pre>
<h4 data-id="heading-14">特殊日期获取</h4>
<pre><code class="hljs language-csharp" lang="csharp">DateTime today = DateTime.Today; <span class="hljs-comment">// 今天的午夜时间</span>
DateTime min = DateTime.MinValue;
DateTime max = DateTime.MaxValue;
DateTime unixEpoch = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">1970</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc);
</code></pre>
<h3 data-id="heading-15">DateTimeKind 与时区处理</h3>
<h4 data-id="heading-16">DateTimeKind 枚举</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> DateTimeKind
{
    Unspecified = <span class="hljs-number">0</span>, <span class="hljs-comment">// 未指定时区（默认）</span>
    Utc = <span class="hljs-number">1</span>,         <span class="hljs-comment">// UTC时间</span>
    Local = <span class="hljs-number">2</span>        <span class="hljs-comment">// 本地时间</span>
}
</code></pre>
<h4 data-id="heading-17">时区转换最佳实践</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 创建带时区信息的时间</span>
DateTime utcTime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc);
DateTime localTime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Local);

<span class="hljs-comment">// 时区转换</span>
TimeZoneInfo tz = TimeZoneInfo.FindSystemTimeZoneById(<span class="hljs-string">"China Standard Time"</span>);

<span class="hljs-comment">// UTC转本地时间</span>
DateTime utcToChina = TimeZoneInfo.ConvertTimeFromUtc(utcTime, tz);

<span class="hljs-comment">// 本地时间转UTC</span>
DateTime chinaToUtc = TimeZoneInfo.ConvertTimeToUtc(localTime, tz);

<span class="hljs-comment">// 跨时区转换</span>
TimeZoneInfo nyTz = TimeZoneInfo.FindSystemTimeZoneById(<span class="hljs-string">"Eastern Standard Time"</span>);
DateTime chinaToNy = TimeZoneInfo.ConvertTime(localTime, tz, nyTz);
</code></pre>
<h3 data-id="heading-18">格式化与解析</h3>
<h4 data-id="heading-19">标准格式化字符串</h4>

































































<table><thead><tr><th>格式符</th><th>说明</th><th>示例输出</th></tr></thead><tbody><tr><td>"d"</td><td>短日期</td><td>2023-06-15</td></tr><tr><td>"D"</td><td>长日期</td><td>2023年6月15日</td></tr><tr><td>"t"</td><td>短时间</td><td>14:30</td></tr><tr><td>"T"</td><td>长时间</td><td>14:30:45</td></tr><tr><td>"f"</td><td>完整日期/时间</td><td>2023年6月15日 14:30</td></tr><tr><td>"F"</td><td>完整格式</td><td>2023年6月15日 14:30:45</td></tr><tr><td>"g"</td><td>常规短格式</td><td>2023-06-15 14:30</td></tr><tr><td>"G"</td><td>常规长格式</td><td>2023-06-15 14:30:45</td></tr><tr><td>"s"</td><td>可排序格式</td><td>2023-06-15T14:30:45</td></tr><tr><td>"u"</td><td>通用可排序</td><td>2023-06-15 14:30:45Z</td></tr><tr><td>"U"</td><td>UTC完整格式</td><td>2023年6月15日 6:30:45</td></tr></tbody></table>
<h4 data-id="heading-20">格式化</h4>
<ul>
<li>标准格式</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">dt.ToString(<span class="hljs-string">"o"</span>);  <span class="hljs-comment">// ISO 8601 完整格式：2025-08-08T14:30:00.0000000Z</span>
dt.ToString(<span class="hljs-string">"s"</span>);  <span class="hljs-comment">// 可排序格式：2025-08-08T14:30:00</span>
dt.ToString(<span class="hljs-string">"G"</span>);  <span class="hljs-comment">// 默认长日期+长时间</span>
dt.ToString(<span class="hljs-string">"d"</span>);       <span class="hljs-comment">// "2023/10/1"（短日期）</span>
dt.ToString(<span class="hljs-string">"D"</span>);       <span class="hljs-comment">// "2023年10月1日"（长日期）</span>
dt.ToString(<span class="hljs-string">"t"</span>);       <span class="hljs-comment">// "14:30"（短时间）</span>
dt.ToString(<span class="hljs-string">"T"</span>);       <span class="hljs-comment">// "14:30:00"（长时间）</span>
</code></pre>
<ul>
<li>自定义格式</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">dt.ToString(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);      <span class="hljs-comment">// 2025-08-08 14:30:00</span>
dt.ToString(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss.fff"</span>);  <span class="hljs-comment">// 带毫秒</span>
dt.ToString(<span class="hljs-string">"dddd, MMM d yyyy"</span>);         <span class="hljs-comment">// 星期几, 月 日 年</span>
</code></pre>
<h4 data-id="heading-21">解析</h4>
<ul>
<li><code>Parse / TryParse</code></li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">DateTime.Parse(<span class="hljs-string">"2025-08-08 14:30"</span>);
DateTime.TryParse(<span class="hljs-string">"2025-08-08"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> dt);
</code></pre>
<ul>
<li>指定格式解析</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">DateTime.ParseExact(<span class="hljs-string">"08/08/2025"</span>, <span class="hljs-string">"MM/dd/yyyy"</span>, CultureInfo.InvariantCulture);
DateTime.TryParseExact(input, <span class="hljs-keyword">new</span>[] {<span class="hljs-string">"yyyy-MM-dd"</span>,<span class="hljs-string">"MM/dd/yyyy"</span>}, 
                       CultureInfo.InvariantCulture, DateTimeStyles.None, <span class="hljs-keyword">out</span> dt);
</code></pre>
<h3 data-id="heading-22">日期时间组件访问</h3>
<h4 data-id="heading-23">属性访问</h4>
<pre><code class="hljs language-csharp" lang="csharp">DateTime dt = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">14</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">123</span>);

<span class="hljs-built_in">int</span> year = dt.Year;       <span class="hljs-comment">// 2023</span>
<span class="hljs-built_in">int</span> month = dt.Month;     <span class="hljs-comment">// 10</span>
<span class="hljs-built_in">int</span> day = dt.Day;         <span class="hljs-comment">// 5</span>
<span class="hljs-built_in">int</span> hour = dt.Hour;       <span class="hljs-comment">// 14</span>
<span class="hljs-built_in">int</span> minute = dt.Minute;   <span class="hljs-comment">// 30</span>
<span class="hljs-built_in">int</span> second = dt.Second;   <span class="hljs-comment">// 45</span>
<span class="hljs-built_in">int</span> millisecond = dt.Millisecond; <span class="hljs-comment">// 123</span>
<span class="hljs-built_in">long</span> ticks = dt.Ticks;    <span class="hljs-comment">// 638,000,000,000,000,000 + ...</span>

DayOfWeek dayOfWeek = dt.DayOfWeek; <span class="hljs-comment">// DayOfWeek.Thursday</span>
<span class="hljs-built_in">int</span> dayOfYear = dt.DayOfYear;       <span class="hljs-comment">// 278 (10月5日是2023年第278天)</span>
</code></pre>
<h4 data-id="heading-24">日期计算辅助</h4>
<pre><code class="hljs language-csharp" lang="csharp">DateTime dt = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">2</span>, <span class="hljs-number">15</span>);

<span class="hljs-comment">// 获取月份天数</span>
<span class="hljs-built_in">int</span> daysInFeb = DateTime.DaysInMonth(<span class="hljs-number">2023</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 28</span>

<span class="hljs-comment">// 判断闰年</span>
<span class="hljs-built_in">bool</span> isLeap2023 = DateTime.IsLeapYear(<span class="hljs-number">2023</span>); <span class="hljs-comment">// false</span>
<span class="hljs-built_in">bool</span> isLeap2024 = DateTime.IsLeapYear(<span class="hljs-number">2024</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 获取月份首日和末日</span>
DateTime firstDayOfMonth = <span class="hljs-keyword">new</span> DateTime(dt.Year, dt.Month, <span class="hljs-number">1</span>);
DateTime lastDayOfMonth = <span class="hljs-keyword">new</span> DateTime(dt.Year, dt.Month, 
    DateTime.DaysInMonth(dt.Year, dt.Month));
</code></pre>
<h3 data-id="heading-25">日期时间运算与比较</h3>
<h4 data-id="heading-26">算术运算</h4>
<pre><code class="hljs language-csharp" lang="csharp">DateTime now = DateTime.Now;

<span class="hljs-comment">// 加法</span>
DateTime tomorrow = now.AddDays(<span class="hljs-number">1</span>);
DateTime nextHour = now.AddHours(<span class="hljs-number">1</span>);
DateTime nextMinute = now.AddMinutes(<span class="hljs-number">1</span>);

<span class="hljs-comment">// 减法</span>
DateTime yesterday = now.AddDays(<span class="hljs-number">-1</span>);
DateTime lastWeek = now.AddDays(<span class="hljs-number">-7</span>);

<span class="hljs-comment">// 时间跨度计算</span>
DateTime start = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
DateTime end = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>);
TimeSpan duration = end - start; <span class="hljs-comment">// 364天</span>

<span class="hljs-comment">// Ticks运算</span>
DateTime preciseTime = now.AddTicks(<span class="hljs-number">50000</span>); <span class="hljs-comment">// 增加5毫秒</span>
</code></pre>
<h4 data-id="heading-27">比较操作</h4>
<pre><code class="hljs language-csharp" lang="csharp">DateTime dateA = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>);
DateTime dateB = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">6</span>, <span class="hljs-number">20</span>);

<span class="hljs-comment">// 比较方法</span>
<span class="hljs-built_in">int</span> compareResult = DateTime.Compare(dateA, dateB); 
<span class="hljs-comment">// &lt;0: dateA &lt; dateB</span>
<span class="hljs-comment">// =0: 相等</span>
<span class="hljs-comment">// &gt;0: dateA &gt; dateB</span>

<span class="hljs-comment">// 运算符重载</span>
<span class="hljs-built_in">bool</span> isBefore = dateA &lt; dateB; <span class="hljs-comment">// true</span>
<span class="hljs-built_in">bool</span> isAfter = dateA &gt; dateB;  <span class="hljs-comment">// false</span>
<span class="hljs-built_in">bool</span> isSame = dateA == dateB;  <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 范围检查</span>
<span class="hljs-built_in">bool</span> isInRange = dateA &gt;= start &amp;&amp; dateA &lt;= end;
</code></pre>
<h3 data-id="heading-28">DateTime 与相关类型对比</h3>





































































<table><thead><tr><th>特性</th><th>DateTime</th><th>DateTimeOffset</th><th>TimeOnly</th><th>DateOnly</th><th>NodaTime</th></tr></thead><tbody><tr><td>时区支持</td><td>弱</td><td>强（偏移量）</td><td>无</td><td>无</td><td>强</td></tr><tr><td>日期部分</td><td>需要计算</td><td>需要计算</td><td>无</td><td>有</td><td>有</td></tr><tr><td>时间部分</td><td>有</td><td>有</td><td>有</td><td>无</td><td>有</td></tr><tr><td>精度</td><td>100ns</td><td>100ns</td><td>100ns</td><td>天</td><td>1ns</td></tr><tr><td>序列化</td><td>有问题</td><td>安全</td><td>安全</td><td>安全</td><td>安全</td></tr><tr><td>范围</td><td>0001-9999</td><td>0001-9999</td><td>00:00-24:00</td><td>0001-9999</td><td>无限</td></tr><tr><td>.NET版本</td><td>1.0+</td><td>2.0+</td><td>6.0+</td><td>6.0+</td><td>NuGet包</td></tr></tbody></table>
<h3 data-id="heading-29">最佳实践总结</h3>
<h4 data-id="heading-30">存储原则：</h4>
<ul>
<li>
<p>始终以 <code>UTC</code> 时间存储</p>
</li>
<li>
<p>仅在显示时转换为本地时间</p>
</li>
</ul>
<h4 data-id="heading-31">序列化准则：</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用ISO 8601格式</span>
DateTime.UtcNow.ToString(<span class="hljs-string">"O"</span>); <span class="hljs-comment">// 2023-10-05T06:30:45.1234567Z</span>
</code></pre>
<h4 data-id="heading-32">时区处理：</h4>
<ul>
<li>
<p>使用 <code>DateTimeOffset</code> 替代 <code>DateTime</code></p>
</li>
<li>
<p>复杂时区需求使用 <code>NodaTime</code> 或 <code>TimeZoneInfo</code></p>
</li>
</ul>
<h4 data-id="heading-33">日期/时间分离：</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// .NET 6+ 推荐</span>
DateOnly birthday = <span class="hljs-keyword">new</span> DateOnly(<span class="hljs-number">1990</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>);
TimeOnly meetingTime = <span class="hljs-keyword">new</span> TimeOnly(<span class="hljs-number">14</span>, <span class="hljs-number">30</span>);
</code></pre>
<h4 data-id="heading-34">性能敏感场景：</h4>
<ul>
<li>
<p>避免重复调用 <code>DateTime.Now/UtcNow</code></p>
</li>
<li>
<p>预计算静态日期值</p>
</li>
<li>
<p>高精度计时用 <code>Stopwatch</code></p>
</li>
</ul>
<h3 data-id="heading-35">资源和文档</h3>
<ul>
<li>
<p><code>DateTime</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fdotnet%2Fapi%2Fsystem.datetime" target="_blank" title="https://learn.microsoft.com/en-us/dotnet/api/system.datetime" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/dotne…</a></p>
</li>
<li>
<p><code>TimeZoneInfo</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fdotnet%2Fapi%2Fsystem.timezoneinfo" target="_blank" title="https://learn.microsoft.com/en-us/dotnet/api/system.timezoneinfo" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/dotne…</a></p>
</li>
<li>
<p><code>ASP.NET Core</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Faspnet%2Fcore%2F" target="_blank" title="https://learn.microsoft.com/en-us/aspnet/core/" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/aspne…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[某电商大厂技术面试场景解析]]></title>    <link>https://juejin.cn/post/7573952825953173567</link>    <guid>https://juejin.cn/post/7573952825953173567</guid>    <pubDate>2025-11-18T23:44:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573952825953173567" data-draft-id="7573890735578546186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="某电商大厂技术面试场景解析"/> <meta itemprop="keywords" content="JavaScript,后端,面试"/> <meta itemprop="datePublished" content="2025-11-18T23:44:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            某电商大厂技术面试场景解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:44:57.000Z" title="Tue Nov 18 2025 23:44:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在某电商大厂的技术面试中，候选人通常会面临一系列关于分布式系统、性能优化、数据一致性等问题。以下是一些常见的面试问题和解答，帮助你为面试做好准备。</p>
<hr/>
<h4 data-id="heading-0">1. <strong>如果我的服务器IP地址变了，客户端如何感知到呢？</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e84363b2a1c04904aa71cb462014085a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=LCuYdShotPgvgsjmigK9DbGacys%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>当服务器的IP地址发生变化时，客户端通常无法直接感知到变化，除非有特定的机制来解决这个问题。常见的解决方案包括：</p>
<ul>
<li><strong>DNS（域名系统）</strong>：通过DNS解析来动态更新服务器的IP地址。客户端会定期请求DNS，以获取最新的服务器IP。</li>
<li><strong>负载均衡器</strong>：客户端通过负载均衡器进行访问，负载均衡器会维护一组服务器的健康状况和IP地址。当服务器IP发生变化时，负载均衡器可以自动更新服务器池，并将请求路由到新的服务器。</li>
</ul>
<hr/>
<h4 data-id="heading-1">2. <strong>轮询的负载均衡的缺点是什么？如何改进？</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98a04ac518d342f8a85dd426c60f3433~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=Ux73DEq1JZYqfaLm4XAovuVPOvg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>轮询负载均衡的基本思想是按照固定的顺序将请求分发到不同的服务器。其主要缺点包括：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f87dee6eadc44888256ab02b863fcc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=jeq3t08%2BgvoHdOL%2BwAa4QnEQ2VQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li><strong>不考虑服务器的负载情况</strong>：如果某些服务器负载过高，而轮询仍然会发送请求，可能导致性能下降。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fb0950769ad49729127c6f66c4a3b7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=2gtOgCm3AUPtC7zCpvk6Jlkq0jI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</li>
<li><strong>不处理故障服务器</strong>：如果某个服务器宕机，轮询可能依然会将请求分配给它。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ce3c6f630f540aba4f77f89c1c1faa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=5oohMLjJNgbnYR8m5Ly9uvDn1QQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</li>
</ul>
<p><strong>改进方法</strong>：</p>
<ul>
<li><strong>加权轮询</strong>：根据服务器的能力（如CPU、内存、网络带宽等）来调整权重，给性能更好的服务器分配更多的请求。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/418e4ced30c241689334ff4127e1feb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=MNZ8AYBcPrSwMCTWlYsN%2BWODIAw%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</li>
<li><strong>健康检查</strong>：定期检测服务器的健康状况，避免将请求发送到宕机或响应较慢的服务器。</li>
</ul>
<hr/>
<h4 data-id="heading-2">3. <strong>让你来实现真正的负载均衡，你如何做？</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad8419a957644c629be11ed62ab71dae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=LNHaSfde9E1WcqM5%2BM%2F%2FmMRekxU%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>面试官提出了一个经典的负载均衡设计问题，首先，你的回答是：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b95e518fad43efb91cc43595b9378c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=fqun%2B6l9ZB8hoxtSb4L09zyfLLE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<blockquote>
<p>我会记录每台服务器在最近一段时间内接收到的请求数量，每次选择请求数量最小的服务器进行处理。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c7391ff9c434aa48246963dfea46d3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=QCOqvDimTJCASSFayMcWYrahxH0%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</blockquote>
<p>然而，面试官提醒你还应考虑每个请求的耗时。实际上，考虑到请求的处理时间，负载均衡的策略应该更加智能。具体来说：</p>
<ul>
<li><strong>加权轮询或加权最小连接</strong>：每台服务器应该记录其处理的请求数和请求的处理时长，而不是仅仅记录请求数。每次选择响应时间最短的服务器。</li>
<li><strong>动态调整负载</strong>：通过监控每个请求的处理时间和响应速度，实时调整负载均衡的策略，避免负载过高的服务器成为瓶颈。</li>
</ul>
<hr/>
<h4 data-id="heading-3">4. <strong>秒杀项目中静态资源CDN怎么做？</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa78d333eceb4b448453cdb749832dc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114297&amp;x-signature=OMtRB%2FoST9P4zhJOBQSLw50ZanE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>秒杀活动期间，静态资源（如商品图片、样式表、脚本等）通常会通过CDN（内容分发网络）进行缓存和加速，确保用户访问时可以更快速地加载这些资源，减轻源服务器的压力。CDN会将静态资源分发到全球各地的缓存节点，并根据用户的地理位置选择最近的节点来响应请求。</p>
<ul>
<li><strong>CDN配置</strong>：将静态资源上传到CDN，并设置合理的缓存策略（如缓存过期时间）。</li>
<li><strong>缓存更新</strong>：在秒杀开始前，提前将资源更新到CDN，并确保所有资源的缓存策略合理，以避免频繁刷新导致性能问题。</li>
</ul>
<hr/>
<h4 data-id="heading-4">5. <strong>CSS文件能放到CDN上吗？</strong></h4>
<p>是的，CSS文件完全可以放到CDN上。CDN非常适合缓存和加速静态资源，包括CSS、JS、图片、字体等。将CSS文件放到CDN上不仅能提高页面加载速度，还能减轻服务器的压力，尤其是在高并发的秒杀活动中。只要配置正确的缓存策略，CSS文件通过CDN分发可以获得更好的性能和用户体验。</p>
<hr/>
<h4 data-id="heading-5">6. <strong>秒杀缓存如何与数据库的数据保持一致性？</strong></h4>
<p>秒杀系统中的缓存一致性问题是一个常见的挑战，通常采用以下几种策略来确保缓存与数据库之间的数据一致性：</p>
<ul>
<li><strong>缓存失效策略</strong>：每当数据库中的数据更新时，通过消息队列或事件机制通知缓存进行失效或更新。</li>
<li><strong>延迟双删策略</strong>：在进行数据修改时，首先删除缓存，再更新数据库，然后再清除一次缓存。通过两次清除缓存，确保缓存与数据库的一致性。</li>
<li><strong>异步更新缓存</strong>：更新数据库后，可以异步更新缓存，避免直接影响响应时间。</li>
</ul>
<hr/>
<h4 data-id="heading-6">7. <strong>通过广播的方式去更新每个节点的缓存，如果某个节点的缓存更新失败，那么如何排查是哪个节点呢？</strong></h4>
<p>当通过广播更新每个节点的缓存时，可能会出现某些节点的缓存更新失败的情况。为了排查问题，可以使用以下方法：</p>
<ul>
<li><strong>日志记录</strong>：每个节点都应该记录缓存更新的日志，确保失败时可以追踪。</li>
<li><strong>健康检查</strong>：定期对各节点进行健康检查，确保节点的状态正常。如果某个节点无法响应更新请求，可以通过健康检查定位问题。</li>
<li><strong>监控系统</strong>：使用分布式监控系统（如Prometheus，Zabbix等）监控每个节点的缓存更新状态，出现异常时及时报警。</li>
</ul>
<hr/>
<h4 data-id="heading-7">8. <strong>消费者消费失败是怎么处理的？</strong></h4>
<p>在分布式消息队列系统中，消费者消费失败时可以采取以下几种处理策略：</p>
<ul>
<li><strong>重试机制</strong>：如果消费失败，消费者可以尝试重新消费该消息，通常会设置重试次数和重试间隔，避免无限重试。</li>
<li><strong>死信队列</strong>：如果消费失败达到一定次数，可以将消息发送到死信队列，等待后续人工或自动处理。</li>
<li><strong>事务性保证</strong>：通过事务消息的方式，确保消费过程的原子性，避免重复消费或数据丢失。</li>
</ul>
<hr/>
<h4 data-id="heading-8">9. <strong>如何保证消息消费的顺序性？</strong></h4>
<p>为了保证消息消费的顺序性，通常可以采取以下策略：</p>
<ul>
<li><strong>单一队列</strong>：确保所有相关的消息都进入同一个队列，这样消费者就可以按照消息的顺序来消费。</li>
<li><strong>分区队列</strong>：对于高并发场景，可以将消息分区，确保每个分区内的消息顺序被保持。消费者按分区顺序消费，但不同分区之间的顺序可能会不同。</li>
<li><strong>消息标识</strong>：为每条消息添加一个序列号或时间戳，消费者在处理时可以按照序列号进行排序和消费。</li>
</ul>
<hr/>
<h4 data-id="heading-9">10. <strong>如何保证消息不被重复消费？</strong></h4>
<p>为了避免消息重复消费，可以采取以下措施：</p>
<ul>
<li><strong>幂等性设计</strong>：确保每个消息的消费操作是幂等的，即无论消息被消费多少次，结果是相同的。可以通过给每个消息分配唯一ID来实现幂等性。</li>
<li><strong>消息去重</strong>：通过数据库或缓存（如Redis）记录已经消费的消息ID，避免重复消费相同的消息。</li>
<li><strong>事务保证</strong>：使用分布式事务或可靠的消息队列机制（如Kafka的Exactly Once语义）来保证消息的准确投递和消费。</li>
</ul>
<hr/>
<h3 data-id="heading-10">总结</h3>
<p>在电商大厂的技术面试中，候选人不仅要展示自己在系统设计、性能优化、缓存一致性等方面的能力，还要能够灵活应对面试官的提示和引导。在面试过程中，注重细节、清晰的思路和扎实的技术基础是成功的关键。希望通过本文的分析，能帮助你更好地理解面试中的一些常见问题，并做好准备。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[电商大厂技术面试：分布式扩展与系统设计问题解析]]></title>    <link>https://juejin.cn/post/7573952825953157183</link>    <guid>https://juejin.cn/post/7573952825953157183</guid>    <pubDate>2025-11-18T23:44:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573952825953157183" data-draft-id="7573890735578578954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="电商大厂技术面试：分布式扩展与系统设计问题解析"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-18T23:44:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            电商大厂技术面试：分布式扩展与系统设计问题解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:44:07.000Z" title="Tue Nov 18 2025 23:44:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在电商大厂的技术面试中，面试官常常会问到一些关于系统架构、性能优化、分布式设计以及常见的并发问题。下面我们通过一些常见的问题和解答，来帮助你更好地准备面试。</p>
<hr/>
<h4 data-id="heading-0">1. <strong>项目中要进行分布式扩展应该怎么做？</strong><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c27d8f7450a4b009b7f8c60126994c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=9gQgwzGn6hPho5bYKJz7RYi7%2F9g%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>分布式扩展的目标是确保系统能够应对更高的并发和流量压力，保持高可用性和可扩展性。要实现分布式扩展，可以采取以下几种方法：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44c3dcd2ad1d49b19aa18f3b0b3f0459~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=AFXiOHuN%2FETRoyhHH3a%2B8SHCFhc%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li>
<p><strong>水平扩展（Scale Out）</strong>：增加更多的服务器或节点，分摊负载。常见的做法包括使用负载均衡器（如Nginx、LVS等）将请求分发到多个应用服务器。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ba5e775d803401786adb5afa8d3af69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=hS%2Fl1L%2BArMSvwqHXWN1OakGDeWg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑<br/>
</p>
</li>
<li>
<p><strong>分库分表</strong>：将数据库拆分为多个实例，避免单一数据库成为瓶颈。分表可以通过按业务功能或按数据量来划分。</p>
</li>
<li>
<p><strong>使用分布式缓存</strong>：例如使用Redis、Memcached等来减轻数据库的压力，将热点数据缓存到内存中。</p>
</li>
<li>
<p><strong>消息队列</strong>：采用如Kafka、RabbitMQ等分布式消息队列来解耦系统各个部分，使得高并发的请求能够被异步处理。</p>
</li>
<li>
<p><strong>微服务架构</strong>：将系统拆分成多个微服务，每个微服务都可以独立扩展，支持按需进行水平扩展。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-1">2. <strong>缓存和 MySQL 数据一致性如何保证？</strong><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a912d32c9744ee78f9dc76dfa2d9f23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=q7UaUMzdS3dNSlYJOzKx62qixtA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>缓存和 MySQL 数据一致性是分布式系统中常见的挑战，以下是几种常见的解决方案：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/739219d624d744719dc14d02e2bd3704~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=%2BIriEgUNqCnt9rHrPrKcZdSdbFA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li>
<p><strong>缓存失效策略</strong>：在更新数据库时，及时清除缓存或更新缓存。可以使用 <code>cache-aside</code> 模式，只有在需要时才从数据库加载数据，并缓存结果。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc08a39b444e438cab479030320d82cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=2eVIeDfgJuzMK1XcejNU9kUmTMk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>双写一致性</strong>：当数据既写入数据库，又写入缓存时，需要保证写入顺序，通常可以采用事务性机制保证一致性，或者通过异步机制在数据库更新后再更新缓存。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddc9aef80d8d48ed95cfe988d74abc1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=CKJrU28xGsfhwFy77Zm3CWcSopk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>TTL（过期时间）策略</strong>：设置缓存的过期时间，定期刷新缓存内容。虽然这种方法不能实时保证一致性，但可以减小缓存失效对一致性的影响。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f362b9bbc63e47ef844f6e0e4ab6b271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=ODubD8sHUHqauQLMDKda7CnwpdA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>分布式锁</strong>：可以使用分布式锁来确保多个服务或线程在同一时间内只会有一个去更新缓存和数据库，防止并发导致的数据不一致。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2109b7d42dba4a36ad5497d817583dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764114246&amp;x-signature=pt51BTVPKNgBGlH2ljDDZzJ5Jwk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>事件驱动和消息队列</strong>：通过事件驱动机制（例如使用Kafka、RabbitMQ等）来通知缓存更新，确保缓存与数据库的一致性。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-2">3. <strong>微信步数排行，假设百万级用户，怎么排序，实时更新？</strong></h4>
<p>对于百万级用户的步数排行，实时排序和更新是一个非常具有挑战性的任务。可以采取以下方法来优化：</p>
<ul>
<li>
<p><strong>分组排序</strong>：将用户分为多个组，每组内进行排序。可以根据步数的范围来划分，例如步数较少的用户分为一组，步数较多的用户分为另一组。这样可以避免大范围排序的性能瓶颈。</p>
</li>
<li>
<p><strong>分度值不均匀</strong>：根据步数的分布特征，分组的大小可以是动态的。例如，步数为0到2000的用户可能是一个小组，步数为2000到4000的用户可以拆分为五个小组，步数较多的用户则可以分为更少的组。</p>
</li>
<li>
<p><strong>实时更新</strong>：在每个组内保持一个排名，通过增量更新（比如用户步数增加时，仅更新该用户所在组的排名）来减少每次计算的负担。组内排序更新可以使用高效的数据结构，如堆、平衡二叉树等。</p>
</li>
<li>
<p><strong>异步计算</strong>：使用后台任务处理步数变化时的排序更新，避免实时计算带来的延迟。可以通过异步队列来定期或按需计算和更新排行榜。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">4. <strong>发生了 OOM，应该怎么去分析解决？JVM 调优</strong></h4>
<p>OOM（OutOfMemoryError）通常是由于内存不足引起的。分析和解决OOM问题的步骤包括：</p>
<ul>
<li>
<p><strong>分析堆内存使用情况</strong>：通过分析JVM的堆转储（heap dump）文件，找出内存泄漏或者内存分配不合理的地方。</p>
</li>
<li>
<p><strong>JVM垃圾回收日志</strong>：通过分析GC日志，观察垃圾回收的情况。频繁的Full GC可能是内存问题的症状，可以根据日志来调整堆内存大小或垃圾回收策略。</p>
</li>
<li>
<p><strong>调整JVM内存参数</strong>：增加堆内存的大小（<code>-Xmx</code> 和 <code>-Xms</code> 参数），或者调整年轻代、老年代的比例，优化内存的分配和回收策略。</p>
</li>
<li>
<p><strong>内存泄漏检测</strong>：使用工具（如VisualVM、YourKit）来分析代码中是否存在内存泄漏，比如对象未被正确释放，导致堆内存逐渐增长。</p>
</li>
<li>
<p><strong>优化代码</strong>：检查代码中是否存在内存泄漏，避免大量对象的创建，及时释放不再使用的对象。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-4">5. <strong>什么时候发生线程的上下文切换？</strong></h4>
<p>线程的上下文切换是在多线程环境中，操作系统为了实现并发执行而在不同的线程之间切换执行的过程。上下文切换发生的原因有：</p>
<ul>
<li>
<p><strong>时间片用完</strong>：每个线程会分配一个时间片，时间片用完后，操作系统会进行上下文切换，切换到下一个线程。</p>
</li>
<li>
<p><strong>线程阻塞/等待</strong>：当线程调用<code>wait()</code>、<code>sleep()</code>、<code>join()</code>等方法进入阻塞或等待状态时，操作系统会选择其他线程运行。</p>
</li>
<li>
<p><strong>线程的优先级变化</strong>：如果线程的优先级发生变化，操作系统可能会进行上下文切换，选择优先级更高的线程执行。</p>
</li>
<li>
<p><strong>I/O操作</strong>：当线程进行I/O操作（如读写文件、数据库查询等）时，通常会被挂起，操作系统会切换到其他可运行的线程。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-5">6. <strong>CAS是硬件实现还是软件实现？</strong></h4>
<p>CAS（Compare and Swap，比较并交换）是由硬件实现的原子操作。它通过硬件指令（如x86的<code>CMPXCHG</code>指令）来保证操作的原子性，避免了多线程情况下的竞态条件。在Java中，CAS是通过<code>Unsafe</code>类中的方法来实现的，它利用了底层硬件提供的原子操作。</p>
<hr/>
<h4 data-id="heading-6">7. <strong>除了 wait 和 notifyAll，还有什么办法实现类似的功能？</strong></h4>
<p>除了<code>wait()</code>和<code>notifyAll()</code>，还可以使用以下方法实现线程的协调和通信：</p>
<ul>
<li>
<p><strong>CountDownLatch</strong>：<code>CountDownLatch</code>用于等待一组线程完成任务。例如，等待所有线程执行完毕后再继续执行。</p>
</li>
<li>
<p><strong>CyclicBarrier</strong>：<code>CyclicBarrier</code>用于让一组线程在某个屏障点同步。当线程到达屏障时会被阻塞，直到所有线程都到达该点。</p>
</li>
<li>
<p><strong>Semaphore</strong>：<code>Semaphore</code>控制线程对共享资源的访问。可以指定最多允许多少线程同时访问某个资源。</p>
</li>
<li>
<p><strong>Exchanger</strong>：<code>Exchanger</code>允许两个线程交换数据，它提供了一个双向的同步机制。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-7">8. <strong>微信抢红包设计（只讲了类似多线程抢、Semaphore，缓存）</strong></h4>
<p>微信抢红包的设计主要依赖于并发控制和高效的缓存策略。常见的设计步骤如下：</p>
<ul>
<li>
<p><strong>并发控制</strong>：可以使用<code>Semaphore</code>来控制每个用户抢红包的并发数。确保不会有过多的线程同时抢一个红包，避免系统崩溃。</p>
</li>
<li>
<p><strong>缓存</strong>：红包的剩余金额和状态可以存储在Redis等缓存中，以提高访问速度和减少对数据库的压力。</p>
</li>
<li>
<p><strong>抢红包算法</strong>：通过算法来确保红包金额的随机性，并且每个用户抢到的红包金额符合预定的总金额。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-8">9. <strong>海量文件找重复次数最多的个数（分治）</strong></h4>
<p>对于海量文件中的重复数据，分治算法是一种有效的解决方式。可以通过以下步骤实现：</p>
<ul>
<li>
<p><strong>分割文件</strong>：将大文件拆分为多个小块，分别进行处理。</p>
</li>
<li>
<p><strong>排序和归并</strong>：每个小块内进行排序和计数，找出重复次数最多的元素。然后，使用归并算法将这些局部结果合并，得到全局的重复元素。</p>
</li>
<li>
<p><strong>分治优化</strong>：根据内存和处理能力，可以调整每次拆分的粒度，逐步缩小文件的范围，直到找到重复次数最多的元素。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-9">总结</h3>
<p>电商大厂的技术面试通常考察候选人的系统设计、性能优化、并发控制等方面的能力。通过对分布式扩展、数据一致性、缓存优化、并发控制等问题的深入理解和实际</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（132） Redis的对象编码是什么？]]></title>    <link>https://juejin.cn/post/7573890735579119626</link>    <guid>https://juejin.cn/post/7573890735579119626</guid>    <pubDate>2025-11-18T23:00:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735579119626" data-draft-id="7573899782803341358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（132） Redis的对象编码是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T23:00:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（132） Redis的对象编码是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:00:34.000Z" title="Tue Nov 18 2025 23:00:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis中的对象编码（Object Encoding）是指Redis内部用来表示不同数据类型的具体存储结构和方式。不同的编码方式有其特定的适用场景，以便在不同的使用情况下，能够在性能和内存利用方面做最佳平衡。</p>
<p>Redis支持的对象类型包括：字符串（String）、列表（List）、集合（Set）、有序集合（Sorted Set）和哈希（Hash）。每种对象类型都有多种编码方式。</p>
<h3 data-id="heading-0">字符串（String）</h3>
<h4 data-id="heading-1">编码方式：</h4>
<ul>
<li>RAW：普通字符串。</li>
<li>EMBSTR：短字符串（长度小于等于39字节）采用这种编码方式。</li>
<li>INT：可以表示为64位整数的字符串。</li>
</ul>
<h4 data-id="heading-2">代码实现示例：</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createStringObject</span><span class="hljs-params">(<span class="hljs-type">char</span> *ptr, <span class="hljs-type">size_t</span> len)</span> {
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    <span class="hljs-keyword">if</span> (len &lt;= <span class="hljs-number">39</span>) {
        o-&gt;type = OBJ_STRING;
        o-&gt;encoding = OBJ_ENCODING_EMBSTR;
        o-&gt;ptr = zmalloc(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> sdshdr) + len + <span class="hljs-number">1</span>);
        <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sdshdr</span> *<span class="hljs-title">sh</span> =</span> (<span class="hljs-type">void</span>*)(o-&gt;ptr);
        sh-&gt;len = len;
        sh-&gt;alloc = len;
        sh-&gt;flags = SDS_TYPE_8;
        <span class="hljs-built_in">memcpy</span>(sh-&gt;buf, ptr, len);
        sh-&gt;buf[len] = <span class="hljs-string">'\0'</span>;
    } <span class="hljs-keyword">else</span> {
        o-&gt;type = OBJ_STRING;
        o-&gt;encoding = OBJ_ENCODING_RAW;
        o-&gt;ptr = sdsnewlen(ptr, len);
    }
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-3">列表（List）</h3>
<h4 data-id="heading-4">编码方式：</h4>
<ul>
<li>ZIPLIST：适用于小型列表。</li>
<li>LINKEDLIST：适用于大型列表。</li>
</ul>
<h4 data-id="heading-5">代码实现示例：</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createListObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-built_in">list</span> *l = listCreate();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_LIST;
    o-&gt;encoding = OBJ_ENCODING_LINKEDLIST;
    o-&gt;ptr = l;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}

robj *<span class="hljs-title function_">createZiplistObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = ziplistNew();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_LIST;
    o-&gt;encoding = OBJ_ENCODING_ZIPLIST;
    o-&gt;ptr = zl;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-6">集合（Set）</h3>
<h4 data-id="heading-7">编码方式：</h4>
<ul>
<li>INTSET：适用于整数值集合。</li>
<li>HT（Hash Table）：适用于大型集合，或包含非整数值的集合。</li>
</ul>
<h4 data-id="heading-8">代码实现示例：</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createSetObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    dict *d = dictCreate(&amp;setDictType, <span class="hljs-literal">NULL</span>);
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_SET;
    o-&gt;encoding = OBJ_ENCODING_HT;
    o-&gt;ptr = d;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}

robj *<span class="hljs-title function_">createIntsetObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    intset *is = intsetNew();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_SET;
    o-&gt;encoding = OBJ_ENCODING_INTSET;
    o-&gt;ptr = is;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-9">有序集合（Sorted Set）</h3>
<h4 data-id="heading-10">编码方式：</h4>
<ul>
<li>ZIPLIST：适用于小型有序集合。</li>
<li>SKIPLIST：适用于大型有序集合。</li>
</ul>
<h4 data-id="heading-11">代码实现示例：</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createZsetObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    zset *zs = zmalloc(<span class="hljs-keyword">sizeof</span>(zset));
    zs-&gt;dict = dictCreate(&amp;zsetDictType, <span class="hljs-literal">NULL</span>);
    zs-&gt;zsl = zslCreate();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_ZSET;
    o-&gt;encoding = OBJ_ENCODING_SKIPLIST;
    o-&gt;ptr = zs;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}

robj *<span class="hljs-title function_">createZsetZiplistObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = ziplistNew();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_ZSET;
    o-&gt;encoding = OBJ_ENCODING_ZIPLIST;
    o-&gt;ptr = zl;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-12">哈希（Hash）</h3>
<h4 data-id="heading-13">编码方式：</h4>
<ul>
<li>ZIPLIST：适用于小型哈希。</li>
<li>HT（Hash Table）：适用于大型哈希。</li>
</ul>
<h4 data-id="heading-14">代码实现示例：</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createHashObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    dict *d = dictCreate(&amp;hashDictType, <span class="hljs-literal">NULL</span>);
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_HASH;
    o-&gt;encoding = OBJ_ENCODING_HT;
    o-&gt;ptr = d;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}

robj *<span class="hljs-title function_">createHashZiplistObject</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = ziplistNew();
    robj *o = zmalloc(<span class="hljs-keyword">sizeof</span>(robj));
    o-&gt;type = OBJ_HASH;
    o-&gt;encoding = OBJ_ENCODING_ZIPLIST;
    o-&gt;ptr = zl;
    o-&gt;refcount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-15">对象的通用结构</h3>
<p>Redis中的对象结构<code>redisObject</code>定义如下：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">redisObject</span> {</span>
    <span class="hljs-type">unsigned</span> type:<span class="hljs-number">4</span>;
    <span class="hljs-type">unsigned</span> encoding:<span class="hljs-number">4</span>;
    <span class="hljs-type">unsigned</span> lru:<span class="hljs-number">24</span>; 
    <span class="hljs-type">int</span> refcount;
    <span class="hljs-type">void</span> *ptr;
} robj;
</code></pre>
<h3 data-id="heading-16">示例使用</h3>
<p>下面是一个简单的示例，展示如何创建和使用不同类型的Redis对象：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"zmalloc.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"intset.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ziplist.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"dict.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"skiplist.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"robj.h"</span> </span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 创建字符串对象</span>
    robj *strObj = createStringObject(<span class="hljs-string">"hello"</span>, <span class="hljs-number">5</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"String object: %s\n"</span>, (<span class="hljs-type">char</span>*)strObj-&gt;ptr);

    <span class="hljs-comment">// 创建整数集合对象</span>
    intset *is = intsetNew();
    <span class="hljs-type">uint8_t</span> success;
    is = intsetAdd(is, <span class="hljs-number">100</span>, &amp;success);
    is = intsetAdd(is, <span class="hljs-number">200</span>, &amp;success);

    robj *setObj = createIntsetObject();
    setObj-&gt;ptr = is;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Set object with 100 and 200 added.\n"</span>);

    <span class="hljs-comment">// 创建压缩列表对象</span>
    robj *ziplistObj = createZiplistObject();
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = ziplistObj-&gt;ptr;
    zl = ziplistPush(zl, (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-string">"world"</span>, <span class="hljs-number">5</span>, ZIPLIST_TAIL);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Ziplist object: %s\n"</span>, ziplistIndex(zl, <span class="hljs-number">0</span>));

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-17">总结</h3>
<p>Redis对象编码通过多种不同的存储和编码方式，为不同类型的数据提供了灵活高效的存储方案。每种编码方式都有其适用的场景和优点，合理选择合适的编码方式可以有效提升Redis的性能和内存利用率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（133）Redis的对象共享机制是什么？]]></title>    <link>https://juejin.cn/post/7573886599434027059</link>    <guid>https://juejin.cn/post/7573886599434027059</guid>    <pubDate>2025-11-18T23:01:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599434027059" data-draft-id="7573886599434010675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（133）Redis的对象共享机制是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T23:01:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（133）Redis的对象共享机制是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:01:51.000Z" title="Tue Nov 18 2025 23:01:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis的对象共享机制是一种优化手段，旨在节省内存。通过共享相同的对象实例，Redis可以避免存储多个具有相同值的对象，从而减少内存使用。这种机制在处理大量重复数据时尤其有效。</p>
<h3 data-id="heading-0">对象共享机制</h3>
<p>Redis在启动时会创建共享对象池，这些对象是一些常见的字符串对象（例如，数字0到9999的字符串表示）。当需要使用这些常见值时，Redis会复用这些共享对象，而不是创建新的对象实例。</p>
<h3 data-id="heading-1">共享对象池的创建</h3>
<p>在Redis启动时，会初始化共享对象池。以下是创建共享对象池的代码示例：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> REDIS_SHARED_INTEGERS 10000</span>

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sharedObjectsStruct</span> {</span>
    robj *integers[REDIS_SHARED_INTEGERS];
    robj *mbulkheaders[REDIS_SHARED_BULKHDR_LEN];
    robj *bulkhdr[REDIS_SHARED_BULKHDR_LEN];
    robj *select[REDIS_SHARED_SELECT_CMDS];
    robj *messagebulk;
    robj *message;
} shared;

<span class="hljs-type">void</span> <span class="hljs-title function_">createSharedObjects</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">int</span> j;
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; REDIS_SHARED_INTEGERS; j++) {
        shared.integers[j] = createObject(OBJ_STRING, sdsfromlonglong(j));
        shared.integers[j]-&gt;encoding = OBJ_ENCODING_INT;
    }
    <span class="hljs-comment">// 其他共享对象初始化代码...</span>
}
</code></pre>
<h3 data-id="heading-2">使用共享对象</h3>
<p>当Redis需要使用一个整数对象时，它会检查这个整数是否在共享对象池的范围内。如果在范围内，则直接使用共享对象，否则创建新的对象。</p>
<h4 data-id="heading-3">代码示例</h4>
<pre><code class="hljs language-c" lang="c">robj *<span class="hljs-title function_">createStringObjectFromLongLong</span><span class="hljs-params">(<span class="hljs-type">long</span> <span class="hljs-type">long</span> value)</span> {
    robj *o;

    <span class="hljs-keyword">if</span> (value &gt;= <span class="hljs-number">0</span> &amp;&amp; value &lt; REDIS_SHARED_INTEGERS) {
        incrRefCount(shared.integers[value]);
        <span class="hljs-keyword">return</span> shared.integers[value];
    }

    <span class="hljs-keyword">if</span> (value &gt;= LLONG_MIN &amp;&amp; value &lt;= LLONG_MAX) {
        o = createObject(OBJ_STRING, <span class="hljs-literal">NULL</span>);
        o-&gt;encoding = OBJ_ENCODING_INT;
        o-&gt;ptr = (<span class="hljs-type">void</span>*)((<span class="hljs-type">long</span>)value);
    } <span class="hljs-keyword">else</span> {
        o = createObject(OBJ_STRING, sdsfromlonglong(value));
    }
    <span class="hljs-keyword">return</span> o;
}
</code></pre>
<h3 data-id="heading-4">引用计数</h3>
<p>Redis使用引用计数来管理对象的生命周期。每个对象都有一个<code>refcount</code>字段，表示该对象被引用的次数。当引用计数为0时，该对象可以被释放。</p>
<h4 data-id="heading-5">增加引用计数</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">incrRefCount</span><span class="hljs-params">(robj *o)</span> {
    <span class="hljs-keyword">if</span> (o-&gt;refcount != OBJ_SHARED_REFCOUNT) {
        o-&gt;refcount++;
    }
}
</code></pre>
<h4 data-id="heading-6">减少引用计数</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">decrRefCount</span><span class="hljs-params">(robj *o)</span> {
    <span class="hljs-keyword">if</span> (o-&gt;refcount == <span class="hljs-number">1</span>) {
        freeStringObject(o);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (o-&gt;refcount != OBJ_SHARED_REFCOUNT) {
        o-&gt;refcount--;
    }
}
</code></pre>
<h3 data-id="heading-7">示例使用</h3>
<p>以下是一个简单的示例，展示了如何使用共享对象：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"zmalloc.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sds.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"robj.h"</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 创建共享对象池</span>
    createSharedObjects();

    <span class="hljs-comment">// 使用共享对象</span>
    robj *obj1 = createStringObjectFromLongLong(<span class="hljs-number">42</span>);
    robj *obj2 = createStringObjectFromLongLong(<span class="hljs-number">42</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Object 1 refcount: %d\n"</span>, obj1-&gt;refcount); <span class="hljs-comment">// 输出2，因为obj1和obj2共享同一个对象</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Object 2 refcount: %d\n"</span>, obj2-&gt;refcount); <span class="hljs-comment">// 输出2</span>

    <span class="hljs-comment">// 释放对象</span>
    decrRefCount(obj1);
    decrRefCount(obj2);

    <span class="hljs-comment">// 如果没有共享对象池，这里会显示释放后的处理</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p>Redis的对象共享机制通过共享常见的字符串对象，有效地节省了内存。初始化时创建共享对象池，在使用这些常见对象时复用共享对象，并通过引用计数管理对象的生命周期。这种机制对于处理大量重复数据的场景，能够显著提升性能和内存利用率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Claude code官网文章】通过 Skills 改进前端设计]]></title>    <link>https://juejin.cn/post/7573904312712347683</link>    <guid>https://juejin.cn/post/7573904312712347683</guid>    <pubDate>2025-11-18T19:13:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573904312712347683" data-draft-id="7573892573346070580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Claude code官网文章】通过 Skills 改进前端设计"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-18T19:13:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Claude code官网文章】通过 Skills 改进前端设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T19:13:38.000Z" title="Tue Nov 18 2025 19:13:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fimproving-frontend-design-through-skills" target="_blank" title="https://www.claude.com/blog/improving-frontend-design-through-skills" ref="nofollow noopener noreferrer">转载</a></p>
<blockquote>
<p>说实话这个话题社区里的实践和观点可太多了。openai和anthropic真的从社区里拿到了太多真金白银的反馈。</p>
<p>什么时候国产模型不是“登顶”“超越”的宣传稿满天飞，而且社区里有很多踏踏实实讨论最佳实践、反馈问题的帖子，热度能和这几个海外顶流一样高，那才是真的超越海外大模型的时刻。</p>
<p>国产加油！</p>
</blockquote>
<p><strong>日期</strong>: 2025年11月12日</p>
<p><strong>阅读时间</strong>: 5 分钟</p>
<p>你可能会注意到，当你在没有指导的情况下要求 LLM 构建一个 landing page 时，它几乎总是采用 Inter 字体、白色背景上的紫色渐变，以及最少的动画。</p>
<p>问题是什么？<strong>分布收敛</strong>（distributional convergence）。在采样过程中，模型基于训练数据中的统计模式来预测 token。安全的设计选择——那些普遍适用且不会冒犯任何人的选择——在网页训练数据中占主导地位。在没有方向指导的情况下，Claude 从这个高概率中心进行采样。</p>
<p>对于构建面向客户产品的开发者来说，这种通用美学会削弱品牌身份，并使 AI 生成的界面立即变得可识别——并且容易被忽视。</p>
<h2 data-id="heading-0">可引导性挑战</h2>
<p>好消息是，Claude 在正确的提示下具有高度的可引导性。告诉 Claude "避免使用 Inter 和 Roboto" 或 "使用有氛围的背景而不是纯色"，结果会立即改善。对指导的敏感性是一个特性；这意味着 Claude 可以适应不同的设计上下文、约束和美学偏好。</p>
<p>但这产生了一个实际的挑战：任务越是专门化，你需要提供的上下文就越多。对于前端设计，有效的指导涵盖字体设计原则、色彩理论、动画模式和背景处理。你需要在多个维度上指定要避免哪些默认值以及首选哪些替代方案。</p>
<p>你可以把所有这些都打包到系统提示中，但这样每个请求——调试 Python、分析数据、写邮件——都会携带前端设计上下文。问题变成了：你如何在需要时为 Claude 提供特定领域的指导，而不会为不相关的任务带来永久的上下文开销？</p>
<h2 data-id="heading-1">Skills：动态上下文加载</h2>
<p>这正是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fskills" target="_blank" title="https://www.anthropic.com/news/skills" ref="nofollow noopener noreferrer">Skills</a> 的设计目的：按需提供专门的上下文，而没有永久的开销。Skill 是一个包含指令、约束和领域知识的文档（通常是 markdown），存储在指定目录中，Claude 可以通过简单的文件读取工具访问。</p>
<p>Claude 可以利用这些技能在运行时动态加载所需的信息，逐步增强其上下文，而不是预先加载所有内容。当配备这些技能以及读取它们所需的必要工具时，Claude 可以根据手头的任务自主识别和加载相关技能。例如，当被要求构建 landing page 或创建 React 组件时，Claude 可以加载前端设计技能并及时应用其指令。</p>
<p>这是核心的思维模型：技能是按需激活的提示和上下文资源，为特定任务类型提供专门指导，而不会产生永久的上下文开销。</p>
<p>这使得开发者能够获得 Claude 可引导性的好处，而不会通过将许多不同任务的指令塞入系统提示来过载上下文窗口。正如我们<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Feffective-context-engineering-for-ai-agents" target="_blank" title="https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents" ref="nofollow noopener noreferrer">之前解释的</a>，上下文窗口中过多的 token 会导致性能下降，因此保持上下文窗口内容的精简和集中对于从模型中引出最佳性能极其重要。Skills 通过使有效的提示可重用和上下文化来解决这个问题。</p>
<h2 data-id="heading-2">为更好的前端输出进行提示</h2>
<p>我们可以通过创建前端设计技能来从 Claude 解锁显著更好的 UI 生成，而无需永久的上下文开销。核心洞察是以前端工程师的思维方式思考前端设计。你越是能将美学改进映射到可实现的前端代码，Claude 就能越好地执行。</p>
<p>利用这一洞察，我们确定了几个有针对性的提示效果很好的领域：字体设计、动画、背景效果和主题。这些都清晰地转换为 Claude 可以编写的代码。在你的提示中实现这一点并不需要详细的技术指令，只是使用有针对性的语言来促使模型更批判性地思考这些设计轴就足以引出更强的输出。这与我们在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Feffective-context-engineering-for-ai-agents" target="_blank" title="https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents" ref="nofollow noopener noreferrer">上下文工程</a>博客文章中提供的指导密切对应，关于在正确的高度提示模型，避免指定精确十六进制代码的低空硬编码逻辑和假设共享上下文的模糊高空指导这两个极端。</p>
<h3 data-id="heading-3">字体设计</h3>
<p>为了看到这一点，让我们开始将字体设计视为我们可以通过提示影响的一个维度。下面的提示专门引导 Claude 使用更有趣的字体：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">use_interesting_fonts</span>&gt;</span></span>
  排版立即传达品质信号。避免使用无聊、通用的字体。

  切勿使用：Inter、Roboto、Open Sans、Lato、默认系统字体

  以下是一些优秀、有影响力的选择示例：
<span class="hljs-bullet">  -</span> 代码美学：JetBrains Mono、Fira Code、Space Grotesk
<span class="hljs-bullet">  -</span> 编辑风格：Playfair Display、Crimson Pro
<span class="hljs-bullet">  -</span> 技术风格：IBM Plex 系列、Source Sans 3
<span class="hljs-bullet">  -</span> 独特风格：Bricolage Grotesque、Newsreader

  配对原则：高对比度 = 有趣。Display + 等宽字体、serif + 几何 sans、跨权重的可变字体。

  使用极端值：100/200 权重 vs 800/900，而不是 400 vs 600。3 倍以上的大小跳跃，而不是 1.5 倍。

  选择一个独特的字体，果断地使用它。从 Google Fonts 加载。
  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">use_interesting_fonts</span>&gt;</span></span>
</code></pre>
<p><strong>使用基础提示生成的输出：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b927b8da3ee40ce9a830b5ccebf250e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=vXs9boHkF1Pu7fk5eiEbdkGZb68%3D" alt="" loading="lazy"/></p>
<p><strong>使用基础提示和字体设计部分生成的输出</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8e0abfcdcca4aed844cca4c6ad9ab5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=KJqBkV1JVfJ9ccChvK2z5heIZP4%3D" alt="" loading="lazy"/></p>
<p>有趣的是，使用更有趣字体的指令似乎也鼓励模型改进设计的其他方面。</p>
<p>仅字体设计就带来了显著的改进，但字体只是一个维度。整个界面的连贯美学如何？</p>
<h3 data-id="heading-4">主题</h3>
<p>我们可以提示的另一个维度是受知名主题和美学启发的设计。Claude 对流行主题有丰富的理解；我们可以利用这一点来传达我们希望前端体现的具体美学。这是一个例子：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">always_use_rpg_theme</span>&gt;</span></span>
  始终使用 RPG 美学进行设计：
<span class="hljs-bullet">  -</span> 奇幻启发的调色板，具有丰富、戏剧性的色调
<span class="hljs-bullet">  -</span> 华丽的边框和装饰性框架元素
<span class="hljs-bullet">  -</span> 羊皮纸纹理、皮革装订风格和风化材料
<span class="hljs-bullet">  -</span> 史诗般的、冒险的氛围，具有戏剧性的光照
<span class="hljs-bullet">  -</span> 中世纪风格的 serif 排版，具有装饰性标题
  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">always_use_rpg_theme</span>&gt;</span></span>
</code></pre>
<p>这产生了以下 RPG 风格的 UI：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c48935e730a74bba8c7916e620b50ec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=K3XmDaPzbRfrULsRrBQlU%2BKHpe4%3D" alt="" loading="lazy"/></p>
<p>字体设计和主题显示了有针对性的提示是有效的。但手动指定每个维度是乏味的。如果我们能将所有这些改进组合到一个可重用的资产中会怎么样？</p>
<h3 data-id="heading-5">通用提示</h3>
<p>同样的原则扩展到其他设计维度：为动画（动画和微交互）添加提示会增加静态设计缺乏的抛光效果，而引导模型选择更有趣的背景选择会创建深度和视觉趣味。这是一个全面技能大放异彩的地方。</p>
<p>将这一切汇集在一起，我们开发了一个约 400 token 的提示——足够紧凑，可以在不膨胀上下文的情况下加载（即使作为技能加载）——显著改善字体设计、色彩、动画和背景的前端输出：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">frontend_aesthetics</span>&gt;</span></span>
  你倾向于收敛到通用的、"分布内"输出。在前端设计中，这创造了用户称为"AI slop"的美学。避免这一点：制作创造性的、独特的前端，让用户惊喜和愉悦。

  专注于：
<span class="hljs-bullet">  -</span> 排版：选择美观、独特和有趣的字体。避免通用字体如 Arial 和 Inter；相反，选择提升前端美学的独特选择。
<span class="hljs-bullet">  -</span> 颜色和主题：致力于统一的美学。使用 CSS 变量保持一致性。主导色配以鲜明强调色胜过胆怯的、均匀分布的调色板。从 IDE 主题和文化美学中汲取灵感。
<span class="hljs-bullet">  -</span> 动画：为效果和微交互使用动画。优先为 HTML 使用仅 CSS 解决方案。React 可用时使用 Motion
  库。专注于高影响力时刻：一个精心编排的页面加载，带有错开的揭示（animation-delay）比分散的微交互创造更多愉悦感。
<span class="hljs-bullet">  -</span> 背景：创造氛围和深度，而不是默认为纯色。

避免通用的 AI 生成美学：
<span class="hljs-bullet">  -</span> 过度使用的字体系列（Inter、Roboto、Arial、系统字体）
<span class="hljs-bullet">  -</span> 陈词滥调的配色方案（特别是白色背景上的紫色渐变）
<span class="hljs-bullet">  -</span> 可预测的布局和组件模式
<span class="hljs-bullet">  -</span> 缺乏上下文特定特色的千篇一律设计

  创造性解释并做出感觉真正为上下文设计的意外选择。在明暗主题、不同字体、不同美学之间变化。你仍然倾向于在各代之间收敛到常见选择（例如，Space
Grotesk）。避免这一点：跳出思维定势至关重要！
<span class="hljs-code">      &lt;/frontend_aesthetics&gt;
</span></code></pre>
<p>在上面的例子中，我们首先给 Claude 关于问题和我们要解决的问题的一般上下文。我们发现给模型这种类型的高级上下文是一种有帮助的提示策略来校准输出。然后我们确定了之前讨论的改进设计向量，并提供有针对性的建议来鼓励模型在所有这些维度上更有创意地思考。</p>
<p>我们还在末尾包含额外的指导来防止 Claude 收敛到不同的局部最大值。即使有明确的指令来避免某些模式，模型也可能默认选择其他常见选择（比如字体设计的 Space Grotesk）。最后提醒"think outside the box"加强了创意变化。</p>
<h3 data-id="heading-6">对前端设计的影响</h3>
<p>使用这个技能激活，Claude 的输出在几种类型的前端设计中都有所改善，包括：</p>
<p><strong>示例 1：SaaS landing page</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23c05410c5334db8a7ba45719ab176be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=yAKAwY3KxsnVOKGg6aOTX%2FITGOk%3D" alt="" loading="lazy"/></p>
<p><strong>说明：</strong> AI 生成的 SaaS landing page，使用通用的 Inter 字体、紫色渐变和标准布局。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6469fb74fce4b55bff1223630ac3344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=niuZcK5iN2rmlS4%2BLqcxc%2BNbQxw%3D" alt="" loading="lazy"/></p>
<p><strong>说明：</strong> 使用与上述渲染相同的提示以及前端技能生成的 AI 前端，现在具有独特的字体设计、连贯的色彩方案和分层背景。</p>
<p><strong>示例 2：Blog 布局</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3d74477cd6f4ed284cec63e2441967d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=ldSHxTnBxwlCHigx4voQpv8jncM%3D" alt="" loading="lazy"/></p>
<p>使用默认系统字体和平面白色背景的 AI 生成 blog 布局。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d11cbda014344d6f9acf1f97bdae3b51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=5jKws4y9IBc94p%2F2%2F9%2Fj1g7Hiqw%3D" alt="" loading="lazy"/></p>
<p>使用相同提示以及前端技能生成的 AI blog 布局，具有编辑风格的字体设计和有氛围的深度以及精细的间距。</p>
<p><strong>示例 3：Admin dashboard</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/917777c1b21f41b683c5eae70fa7f404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=y9NjPEMaweHmr0Br%2BYLJ%2FqAh3To%3D" alt="" loading="lazy"/></p>
<p>具有标准 UI 组件和最简化视觉层级的 AI 生成 admin dashboard。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3ec09b0b8ff426990f3fc83e1dba090~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=iOAfd2GuENAiQYrHxxdNa%2BRa0sM%3D" alt="" loading="lazy"/></p>
<p>使用相同提示以及前端技能生成的 AI admin dashboard，具有粗体字体设计、连贯的深色主题和有目的性的动画。</p>
<h2 data-id="heading-7">使用 Skills 改进 claude.ai 中的 artifacts 质量</h2>
<p>设计品味不是唯一的限制。Claude 在构建 artifacts 时还面临架构约束。<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.claude.com%2Fen%2Farticles%2F9487310-what-are-artifacts-and-how-do-i-use-them" target="_blank" title="https://support.claude.com/en/articles/9487310-what-are-artifacts-and-how-do-i-use-them" ref="nofollow noopener noreferrer">Artifacts</a> 是 Claude 创建并显示在聊天旁边的交互式、可编辑内容（如代码或文档）。</p>
<p>除了上面探讨的设计品味问题外，Claude 还有另一个默认行为限制了它在 claude.ai 中生成出色的前端 artifacts 的能力。目前，当被要求创建前端时，Claude 只是构建一个带有 CSS 和 JS 的单一 HTML 文件。这是因为 Claude 知道前端必须是单一 HTML 文件才能正确渲染为 artifacts。</p>
<p>就像你期望一个人类开发者如果只能用单一文件编写 HTML/CSS/JS 只能创建非常基本的前端一样，我们假设如果我们给 Claude 指令来使用更丰富的工具，Claude 将能够生成更令人印象深刻的前端 artifacts。</p>
<p>这导致我们创建了一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Fblob%2Fmain%2Fartifacts-builder%2FSKILL.md" target="_blank" title="https://github.com/anthropics/skills/blob/main/artifacts-builder/SKILL.md" ref="nofollow noopener noreferrer">web-artifacts-builder skill</a>，它利用 Claude <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fcreate-files" target="_blank" title="https://www.claude.com/blog/create-files" ref="nofollow noopener noreferrer">使用计算机</a> 的能力，并指导 Claude 使用多个文件和现代网络技术（如 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2F" target="_blank" title="https://tailwindcss.com/" ref="nofollow noopener noreferrer">Tailwind CSS</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.shadcn.com%2F" target="_blank" title="https://ui.shadcn.com/" ref="nofollow noopener noreferrer">shadcn/ui</a>）来构建 artifacts。在底层，该技能公开了脚本：(1) 帮助 Claude 高效设置基本的 React 仓库，(2) 在完成后使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fparceljs.org%2F" target="_blank" title="https://parceljs.org/" ref="nofollow noopener noreferrer">Parcel</a> 将所有内容捆绑到单一文件中以满足单一 HTML 文件的要求。这是技能的核心好处之一——通过给 Claude 访问脚本来执行样板操作，Claude 能够最小化 token 使用，同时提高可靠性和性能。</p>
<p>通过 web-artifacts-builder skill，Claude 可以利用 shadcn/ui 的表单组件和 Tailwind 的响应式网格系统来创建更全面的 artifact。</p>
<h3 data-id="heading-8">示例 1：白板应用</h3>
<p>例如，当被要求创建白板应用时，如果没有 web-artifacts-builder skill，Claude 输出了非常基本的界面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2647d886f74d4ca197e3d8570d236471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=%2BQuUMPfBl68SpueD6SqQdppxsCg%3D" alt="" loading="lazy"/></p>
<p>另一方面，当使用新的 web-artifacts-builder skill 时，Claude 生成了一个更清晰、功能更多的开箱即用应用程序，包括绘制不同形状和文本：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8eb625c0494fdea915f8f0c391440f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=arb2cza1J3qaGWecx%2FBKwmKVgno%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">示例 2：任务管理器应用</h3>
<p>类似地，当被要求创建任务管理应用时，没有技能的情况下，Claude 生成了一个功能齐全但非常最小的应用程序：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b5f41862a4b4f19a1b506a5a9e17f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=%2Fsj9qcBHEFsOM7NfAXBq22dbJLs%3D" alt="" loading="lazy"/></p>
<p>使用技能，Claude 生成了一个开箱即用时功能更多的应用。例如，Claude 包含了一个"创建新任务"表单组件，允许用户为任务设置相关的类别和截止日期：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/750193bb5e2240a2a8893cfb649b50e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=6EK31AtcPFErY64B2YUfYeBES%2Bw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13a3056301bf4b4ebacb9ad78c3548bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=fe23u2uqKBkUsmXixE7qiMwplnk%3D" alt="" loading="lazy"/></p>
<p>要在 Claude.ai 中尝试这个新技能，只需启用该技能，然后在构建 artifacts 时要求 Claude "使用 web-artifacts-builder skill"。</p>
<h2 data-id="heading-10">使用 Skills 优化 Claude 的前端设计能力</h2>
<p>这个前端设计技能展示了一个关于语言模型能力的更广泛原则：模型通常有能力做得比它们默认表达的更多。Claude 具有强大的设计理解力，但没有指导时分布收敛掩盖了这一点。虽然你可以将这些指令添加到系统提示中，但这意味着每个请求都会携带前端设计上下文，即使这些知识与当前任务无关。相反，使用 Skills 将 Claude 从一个需要不断指导的工具转变为一个为每个任务带来领域专业知识的工具。</p>
<p>Skills 也高度可定制——你可以创建适合你特定需求的自己的技能。这允许你定义想要嵌入技能的确切原语，无论是你公司的设计系统、特定的组件模式，还是行业特定的 UI 约定。通过将这些决策编码到 Skill 中，你可以将 agent 思考的组件部分转换为整个开发团队可以利用的可重用资产。技能成为持久化和扩展的组织知识，确保跨项目的一致质量。</p>
<p>这种模式扩展到前端工作之外。任何 Claude 产生通用输出尽管有更广泛理解的领域都是 Skill 开发的候选者。方法是一致的：识别收敛的默认值，提供具体的替代方案，在正确的高度构建指导，并通过 Skills 使其可重用。</p>
<p>对于前端开发，这意味着 Claude 可以生成独特的界面，而无需每次请求的提示工程。要开始，请探索我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-cookbooks%2Fblob%2Fmain%2Fcoding%2Fprompting_for_frontend_aesthetics.ipynb" target="_blank" title="https://github.com/anthropics/claude-cookbooks/blob/main/coding/prompting_for_frontend_aesthetics.ipynb" ref="nofollow noopener noreferrer">前端设计 cookbook</a> 或尝试我们在 Claude Code 中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Ftree%2Fmain%2Fplugins%2Ffrontend-design" target="_blank" title="https://github.com/anthropics/claude-code/tree/main/plugins/frontend-design" ref="nofollow noopener noreferrer">新前端设计插件</a>。</p>
<p><strong>感到启发？要创建你自己的前端技能，请查看我们的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskill-creator" target="_blank" title="https://github.com/anthropics/skills/tree/main/skill-creator" ref="nofollow noopener noreferrer">skill-creator</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何用Claude Code构建公司：三家YC初创公司的案例研究]]></title>    <link>https://juejin.cn/post/7573892573346054196</link>    <guid>https://juejin.cn/post/7573892573346054196</guid>    <pubDate>2025-11-18T17:42:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892573346054196" data-draft-id="7573864324713955380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何用Claude Code构建公司：三家YC初创公司的案例研究"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-18T17:42:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何用Claude Code构建公司：三家YC初创公司的案例研究
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T17:42:35.000Z" title="Tue Nov 18 2025 17:42:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fbuilding-companies-with-claude-code" target="_blank" title="https://www.claude.com/blog/building-companies-with-claude-code" ref="nofollow noopener noreferrer">转载</a></p>
<p><strong>日期</strong>：2025年11月17日</p>
<p><strong>阅读时间</strong>：5分钟</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ycombinator.com%2F" target="_blank" title="https://www.ycombinator.com/" ref="nofollow noopener noreferrer">Y Combinator</a>是一家创业加速器，自2005年以来已经孵化了超过5000家公司，这些公司的总估值超过8000亿美元，包括Airbnb、Stripe和DoorDash等知名企业。</p>
<p>如今，像<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://www.claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a>这样的agent编码工具正在从根本上改变YC初创公司构建和扩展的方式。创始人现在可以直接从终端发布产品，将开发周期从几周压缩到几小时，甚至让非技术创始人从第一天起就能与成熟企业竞争。</p>
<p>我们采访了三家展示这一变革实践的YC初创公司：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://www.claude.com/product/claude-code" ref="nofollow noopener noreferrer">HumanLayer</a>（F24）使用Claude Code构建了他们的整个平台，并开创了上下文工程实践</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ambral.com%2F" target="_blank" title="https://www.ambral.com/" ref="nofollow noopener noreferrer">Ambral</a>（W25）正在使用Claude Code和Claude Agents SDK构建的复杂sub-agent驱动工作流来扩展AI驱动的客户管理</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvulcan-tech.com%2F" target="_blank" title="https://vulcan-tech.com/" ref="nofollow noopener noreferrer">Vulcan Technologies</a>（S25）正在使用Claude Code为政府和行业解决监管复杂性</p>
<p>让我们深入了解。</p>
<h2 data-id="heading-0">HumanLayer：从SQL agents到扩展AI优先的工程团队</h2>
<blockquote>
<p>一个给 <em>agent 开发者</em> 用的 <strong>Human-in-the-Loop 平台 + Coding Agent 工具链</strong></p>
</blockquote>
<p>Dexter Horthy在构建自主AI agents来管理SQL仓库时，注意到agent采用面临一个根本性（但可以理解的）挑战：公司不愿意让AI应用在无人监督的情况下访问敏感操作，比如删除数据库表。</p>
<h3 data-id="heading-1">改变一切的转型</h3>
<p>这一认识成为HumanLayer的核心洞察：通常，任何软件中最有用的功能也是风险最高的，特别是对于非确定性的LLM驱动系统。</p>
<p>"我们的MVP是一个在Slack中与人类协调的agent，可以进行基本的清理工作，比如删除90多天未被查询的任何表格，"Horthy解释说。"我们不愿意让AI应用在无人监督的情况下运行原始SQL，所以我们加入了一些基本的人工审批步骤。"</p>
<p>2024年8月，Horthy构建了一个MVP，向旧金山的各个初创公司演示，并获得了他的第一批付费客户。这一进展使HumanLayer进入了YC F24批次，团队全力以赴提供API和SDK，让AI agents可以通过Slack、电子邮件、短信和其他渠道联系人类获取反馈、输入和批准。</p>
<p>通过2025年第一季度的广泛客户发现，HumanLayer团队与数十个构建AI agents的工程团队交流，意识到他们在agent开发循环中存在一个未曾预料到的差距。</p>
<p>"每个团队都有自己的agent架构，"Horthy解释说。"我们意识到我们不能只是构建一个更好的API——我们需要帮助建立让生态系统成熟的模式和原则。"</p>
<p>这促使Horthy在"<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhumanlayer%2F12-factor-agents" target="_blank" title="https://github.com/humanlayer/12-factor-agents" ref="nofollow noopener noreferrer">"12-Factor Agents: Patterns of reliable LLM applications"</a>"中记录了他们的学习成果。该指南于2025年4月发布，迅速走红，综合了他们构建生产agent系统的经验，并突出了新兴上下文工程学科的最佳实践。</p>
<h3 data-id="heading-2">使用Claude Code构建一切</h3>
<p>有了这些学习成果，HumanLayer团队开始探索替代产品理念和转型角度。</p>
<p>当Anthropic推出Claude Code时，Horthy和他的团队已经是Claude模型编码的强烈支持者。他们立即开始使用它来构建这些实验。</p>
<p>"我们只是用Claude Code编写所有内容，"Horthy说。"当Claude Agent SDK与Opus 4和Sonnet 4一起推出，支持无头agent执行时，我们知道这将是大事。"</p>
<p>在内部完善Claude Code工作流程几个月后，Horthy开始与亲密的创始人朋友分享它们。</p>
<p>"告诉我需要全力投入的时刻是与BoundaryML（YC W23）的Vaibhav进行的全天配对编程会议，"Horthy回忆说。"Vaibhav起初持怀疑态度，但在我们花了7个小时完成了通常需要1-2周的工作后，他被说服了。我意识到这个工作流程可以适用于其他团队和其他代码库。"</p>
<h3 data-id="heading-3">构建CodeLayer：扩展AI优先的工程</h3>
<p>如今，HumanLayer的产品CodeLayer帮助团队使用worktree和远程云端workers并行运行多个Claude agent会话。他们发现了一个关键模式：一旦工程师掌握了Claude Code，他们的生产力提升如此之大，以至于真正的挑战变成了组织性的——如何在整个团队中扩展这些工作流程。</p>
<p>"当你团队中的多个人都在发布AI编写的代码时，你面临的是完全不同类型的问题，"Horthy解释说。"这是一个沟通、协作、工具和管理问题。你必须重新构建团队构建软件的一切方式。"</p>
<p>自2025年第四季度开始以来，HumanLayer已经与各种规模的工程团队关闭了几个大型试点项目，部署这些工具和工作流程，所有这些都是用Claude Code构建的。</p>
<h2 data-id="heading-4">Ambral：用subagents构建生产系统</h2>
<blockquote>
<p>一家B2B SaaS / Salestech，做 <strong>AI Account Management Team / Customer Mission Control</strong>。</p>
<p>核心价值：</p>
<p>把 客户信号（产品使用日志、邮件、会议记录、工单等）汇总成每个账户的 <strong>AI 模型画像</strong>；</p>
<p>自动识别哪个客户需要关注、为什么需要关注，是 <strong>扩容机会</strong> 还是 <strong>流失风险</strong>；</p>
<p>主动给 AM/CSM 提建议甚至直接代为执行下一步动作（跟进邮件、安排会议等），本质上是“AI 版 post-sale 团队”。</p>
</blockquote>
<p>Jack Stettner和Sam Brickman创立Ambral来解决每个B2B创始人和CRO都熟悉的问题：随着公司扩展，推动早期增长的创始人级别的客户亲密关系变得不可能维持。</p>
<h3 data-id="heading-5">由Claude subagents驱动的客户管理</h3>
<p>无论是在经历高速增长的早期公司还是在成熟的企业公司，客户经理通常同时管理50到100个账户。"你无法用1/50的注意力提供有效的客户管理体验，"Stettner解释说。曾经适合创始人头脑中的客户背景分散在系统、日志、Slack消息、会议记录和产品使用数据中。</p>
<p>Ambral将来自客户活动和交互的信号综合成每个账户的AI驱动模型。系统精确指出谁需要关注以及为什么，自主驱动或推荐扩展，同时捕捉不满的早期迹象以防止流失。</p>
<p>"我们试图为每个客户提供一对一客户经理的体验，"Stettner说。</p>
<p>作为这家年轻初创公司的CTO和唯一工程师，Stettner在开发方面大量依赖Claude Code，并使用Claude的Agent SDK为产品本身提供动力。技术架构反映了对如何从不同Claude模型中提取最大价值的复杂理解。</p>
<h3 data-id="heading-6">委托工作流：Opus负责思考，Sonnet负责构建，周围都是subagents</h3>
<p>Stettner采用了一种精确的工作流程，结合subagents利用不同Claude模型的优势：</p>
<p>"我使用Opus 4.1进行研究规划。Sonnet 4.5在执行我在Markdown中创建的计划方面绝对killer，"Stettner解释说。</p>
<p>他的开发过程遵循三个不同阶段：</p>
<p><strong>研究阶段（Opus 4.1）</strong>：对功能实现所需的任何背景进行深入研究。"我认为最重要的是在规划之前做研究，"Stettner强调。"让Claude为你做研究，创建一个大的、长的研究文档。"他使用一系列subagents并行研究代码库的多个领域。</p>
<p><strong>规划阶段（Opus 4.1）</strong>：创建一个包含不同阶段的计划，说明如何实现功能。"我会让Opus创建一个包含阶段的计划，关于实际如何实现的具体阶段，然后我会修改那个计划。也许我会与Opus讨论某些细节的问题，或者我会手动更新这个markdown文件。"</p>
<p><strong>实现阶段（Sonnet 4.5）</strong>：系统地执行计划的每个阶段。"然后我会使用Sonnet 4.5去实现每个阶段。"</p>
<p>这种方法战胜了Stettner尝试的其他工作流程，并受到Humanlayer的Horthy正在做的一些工作的影响："我尝试了每个编码工具，基本上实验了每个模型。我只是认为Anthropic的模型目前在工具使用方面是最好的，这转化为代码。"</p>
<h3 data-id="heading-7">构建强大的研究引擎</h3>
<p>产品本身镜像了这种多agent方法。Stettner使用Claude Agent SDK构建了Ambral的核心研究引擎，每种数据类型都有专门的sub-agents。</p>
<p>"我花了很多时间使用Claude Agent SDK基本上构建了一个非常强大的研究引擎，可以在所有这些数据中运行，"Stettner解释说。"它基于Claude sub-agents，对于每种数据类型，我们都有一个专门的sub-agent，它是理解该数据的专家。"</p>
<p>无论用户与系统聊天还是Ambral为客户构建自动化，一切都由<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.claude.com%2Fen%2Fapi%2Fagent-sdk%2Foverview" target="_blank" title="https://docs.claude.com/en/api/agent-sdk/overview" ref="nofollow noopener noreferrer">Claude Agent SDK</a>和一系列sub-agents支持，这些sub-agents跨使用数据、Slack消息、会议记录和产品交互进行检索和推理。</p>
<p>架构灵感直接来自Stettner的开发经验："我认为Claude Code subagents做得多么好以及帮助我进行开发，这启发了我基本上想要采用那些相同的sub-agents并在产品本身的研究引擎中使用它。"</p>
<h2 data-id="heading-8">Vulcan Technologies：赋能非技术创始人发布产品</h2>
<blockquote>
<p>一家Reg-Tech / LegalTech**，做 <strong>AI 法规起草与合规</strong>，自称 <strong>“AI legal cartography”</strong> 。</p>
<p>用 AI 把美国的 <strong>法律、法规、判例</strong> 做成一个巨大的“法律图谱 / 知识图”；</p>
<p>帮政府部门、监管机构、行业组织和大企业做新法规/规章的起草、对现有法规进行一致性和合规性检查、找到“法律条文 vs 实际执行”中的错配</p>
</blockquote>
<p>对于Vulcan的CEO兼联合创始人Tanner Jones来说，Claude Code的影响远远超出了生产力——它构成了公司构建的民主化。在创立他们的初创公司时，Vulcan团队相信必须有一个能让政府为公民提供更好服务的产品。如果没有Claude Code，这一愿景将不可能实现，因为两位创始人都没有工程背景。</p>
<h3 data-id="heading-9">在没有专门工程师的情况下发布产品</h3>
<p>Vulcan解决了一个已经积累了几个世纪的问题：<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FCode_of_Federal_Regulations" target="_blank" title="https://en.wikipedia.org/wiki/Code_of_Federal_Regulations" ref="nofollow noopener noreferrer">监管条例</a>复杂性。弗吉尼亚州众议院，世界上最古老的持续运作的民主机构，体现了这一挑战。400多年的监管积累创造了美国最细致和复杂的法规之一。</p>
<p>当Aleksander Mekhanik和Tanner Jones在2025年4月联合创立Vulcan时，两人都没有传统的工程背景。Mekhanik在大学学习ML和数学，而Jones的最后一次编程经历是高中的AP JavaScript课程，当时他们用纸和笔编写代码。然而，这对组合在5月1日为弗吉尼亚州州长办公室构建了他们第一个产品的原型——并且在竞标中击败了成熟的咨询公司。</p>
<p>"整个原型都是使用Claude制作的，"Jones解释说。"这是Claude Code之前的事情。它实际上是将脚本复制粘贴到web应用程序中，然后替换其中的实现方法。。"在构建原型后，他们聘请了他们的CTO Christopher Minge，他有在Google的Gemini和Waymo工作的经验。然后，当Claude Code在6月推出时，三人的速度又成倍增长。</p>
<p>Vulcan的AI驱动监管分析帮助将弗吉尼亚州新房的平均价格降低了24,000美元，通过识别冗余和重复的监管要求，每年为弗吉尼亚人节省超过十亿美元。弗吉尼亚州州长非常喜欢Vulcan的工作，以至于他<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.govtech.com%2Fartificial-intelligence%2Fvirginia-to-use-agentic-ai-to-power-review-of-regulations" target="_blank" title="https://www.govtech.com/artificial-intelligence/virginia-to-use-agentic-ai-to-power-review-of-regulations" ref="nofollow noopener noreferrer">签署了第51号行政命令</a>，强制要求所有州机构使用"agentic AI监管审查"。</p>
<h3 data-id="heading-10">公司构建的民主化</h3>
<p>对于Jones来说，Claude Code的影响超越了生产力指标。</p>
<p>"如果你理解语言并且理解批判性思维，你就能很好地使用Claude Code，"他说。"我实际上认为学过人文科学的人可能会有一些边际好处，因为我们与AI交流的媒介是语言。如果你对语言有很好的掌握，擅长构建组织良好的有序列表、嵌套项目符号和深思熟虑的过程，你的prompts可能会执行得更好。"</p>
<p>Jones赞扬Claude Code是Vulcan成功的重要组成部分："在四个月内，三个创始人，只有一个真正是技术背景，我们获得了州和联邦政府合同，并从一些顶级VC那里筹集了1100万美元的种子轮。没有Anthropic令人难以置信的工具，这一切都不可能实现。"</p>
<p>拥有"真正技术"背景训练的Vulcan CTO Christopher Minge，在如何思考工程方面经历了自己的转变。</p>
<p>"感觉有点像我在Google有一个同事，我把所有的想法和任务都给他们，他们经常犯错，但我的角色是委托给几个Claude Code实例，并善于检查常见错误和有效沟通想法，"Minge解释说。</p>
<h2 data-id="heading-11">YC创始人的最佳实践</h2>
<p>这三家初创公司已经开发了最大化Claude Code影响的经过实战考验的方法，包括：</p>
<h3 data-id="heading-12">1. 将研究、规划和实现分离到不同的会话中</h3>
<p>"不要让Claude在试图规划的时候进行研究，在试图实现的时候进行规划，"Stettner建议。"使用不同的prompts，并将它们变成不同的步骤。"</p>
<p>这种模式防止了上下文污染，允许每个阶段专注于其核心目标。为每个主要阶段启动一个新的Claude Code会话，只向前传递提炼的结论，而不是拖拽整个上下文历史。</p>
<h3 data-id="heading-13">2. 审慎地进行上下文管理</h3>
<p>Stettner对其他创始人的建议集中在审慎的上下文管理上：</p>
<p>"上下文至关重要。当我看到意外或低质量的输出时，通常是因为我在某个prompt中有矛盾，"他解释说。"在向系统prompt中放入什么信息或选择何时开始新对话方面要非常审慎，因为你不想混淆你的上下文。如果你的prompt中有任何矛盾，你将收到更低质量的输出。"</p>
<h3 data-id="heading-14">3. 监控并中断思维链</h3>
<p>"试着审视思维链并观察它在做什么，"Jones建议。"把手指放在扳机上，随时准备逃脱并中断任何不良行为。"</p>
<p>这在运行多个实例时变得尤其重要。在早期——前几次工具调用内——捕捉错误方向比让Claude Code完成整个错误方法节省更多时间。</p>
<h2 data-id="heading-15">新构建者优势</h2>
<p>这三家初创公司展示了使用像Claude Code这样的工具构建公司的根本转变。HumanLayer在转型和扩展的同时，制定了现在在YC生态系统中使用的上下文工程实践。Ambral正在用精简的创始团队大规模解决客户成功问题。Vulcan作为非工程师赢得了政府合同。</p>
<p>构建软件的传统障碍——技术专长、团队规模、开发时间——正在让位于新的竞争优势：清晰思考、结构化问题分解以及与AI有效协作的能力。</p>
<p>准备用Claude Code构建吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Cursor & Claude 操作 Figma 画图]]></title>    <link>https://juejin.cn/post/7573899782803226670</link>    <guid>https://juejin.cn/post/7573899782803226670</guid>    <pubDate>2025-11-18T16:32:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782803226670" data-draft-id="7572749797469503497" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Cursor &amp; Claude 操作 Figma 画图"/> <meta itemprop="keywords" content="MCP,Cursor,Claude"/> <meta itemprop="datePublished" content="2025-11-18T16:32:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Keely40285"/> <meta itemprop="url" content="https://juejin.cn/user/2594503171249997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Cursor &amp; Claude 操作 Figma 画图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2594503171249997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Keely40285
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T16:32:48.000Z" title="Tue Nov 18 2025 16:32:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>版权声明：本文为博主原创文章，未经博主允许不得转载。 文章底部留言可联系作者。</p>
</blockquote>
<h2 data-id="heading-0">一、背景</h2>
<p>现在各种AI工具的普及让人眼花缭乱，大家都在拥抱AI，之前朋友推荐某音的一个小视频看到可以使用Cursor操作Figma自动画图感觉非常神奇，正好我 Claude和Cursor 都在使用，对有意思的工具做了一些尝试，现在总结下经验希望可以帮助大家。</p>
<h2 data-id="heading-1">二、Cursor 如何操作 Figma</h2>
<h3 data-id="heading-2">1. 安装 Cursor</h3>
<p>Cursor 可以点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2Fdownload" target="_blank" title="https://cursor.com/cn/download" ref="nofollow noopener noreferrer">官网下载</a>选择合适版本进行使用。新账号试用过后需要付费使用，具体使用方法可以自行网上百度各种方案,比如无限续杯，或者某鱼看看。如果公司能提供使用的账号那就更不错了。本人目前开通的是Pro版本。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae7950fb5d6458eb52bf393999016c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=UqzGwPSqXWxeR7PxYcHhj%2F2vPLU%3D" alt="Cursor下载页面.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99128ec1639e4ccd854b40d87d7396ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=m8AqvXMvppXq8b2VSmRl6unLTLE%3D" alt="Cursor购买方案.png" loading="lazy"/></p>
<p>Cursor安装后如何使用这边可以看B站的教学视频进行学习：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1zen9zHEVD%2F%3Fshare_source%3Dcopy_web%26vd_source%3D786b02b55d0bbbdeb4ec93c491968dac" target="_blank" title="https://www.bilibili.com/video/BV1zen9zHEVD/?share_source=copy_web&amp;vd_source=786b02b55d0bbbdeb4ec93c491968dac" ref="nofollow noopener noreferrer">【AI编程】2025最新Cursor全套使用教程，通俗易懂，从入门到实战！新手友好，学不会我退出AI圈！AI编程|Cursor教程</a></li>
</ul>
<h3 data-id="heading-3">2. 安装Figma</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2F" target="_blank" title="https://www.figma.com/" ref="nofollow noopener noreferrer">Figma</a> 也是付费软件才能使用MCP功能，这里可能会有小伙伴疑惑MCP是什么东西，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">点击这里链接</a>  来了解什么是MCP。总之有了MCP以后，Cursor、Claude 就可以操作Figma了。</p>
<p>Figma <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2Fdownloads%2F" target="_blank" title="https://www.figma.com/downloads/" ref="nofollow noopener noreferrer">点击官网进行下载</a>安装。付费版才可以使用MCP功能，开通方式自行搜索，或者有公司提供账号更好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acc3d1c97e92454a84bd880a11fe4be5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=LtKunKsxdTDXFfWU%2B0YHw5P5gik%3D" alt="figma下载.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efa6432067e4408d881665d6e4faeb04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=nfNPbyDcXskybox6Rtwtz315h1I%3D" alt="figma 付费方案.png" loading="lazy"/></p>
<p><strong>注意：</strong></p>
<ul>
<li>figma 可以通过 <code>shift+D</code> 或者右下角 <code>&lt;/&gt;</code> 按钮 切换 <code>DevMode</code>，然后开启 <code>MCP server</code>，但是开启这个MCP 无法在 Cursor 中操作画图。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4972554100474067a24b6061c605049e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=3rhiktSzNb9mPYrayjGckB4Zz7Q%3D" alt="shift+D.png" loading="lazy"/></p>
<h3 data-id="heading-4">3. 配置MCP</h3>
<p>当前面两步搞定之后，我们就可以给Cursor配置MCP了。首先从github上搜相关MCP，找到了star最多的，理论上应该也是最好用的MCP：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrab%2Fcursor-talk-to-figma-mcp" target="_blank" title="https://github.com/grab/cursor-talk-to-figma-mcp" ref="nofollow noopener noreferrer">cursor-talk-to-figma-mcp</a>。</p>
<p>此时你一定会好奇为什么不是上面的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGLips%2FFigma-Context-MCP" target="_blank" title="https://github.com/GLips/Figma-Context-MCP" ref="nofollow noopener noreferrer">Figma-Context-MCP</a> ？这是因为这款MCP主要是用来将设计稿转成代码的。可以参考下这篇文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1953846512003059905" target="_blank" title="https://zhuanlan.zhihu.com/p/1953846512003059905" ref="nofollow noopener noreferrer">《Cursor集成Figma Context MCP，设计稿直接生成代码》</a>来学习下。而我们的目标是通过Cursor来操作Figma生成设计稿所以就略微不太合适了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b325c81fe7344237a363dc29ef7fe24f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=z48WF7UvBU0OcL%2FXHQNaZ61LGGg%3D" alt="搜索Figma的MCP.jpg" loading="lazy"/></p>
<h4 data-id="heading-5">拷贝项目到本地并启动</h4>
<p>首先把项目克隆到本地，然后按照文档提示，安装依赖并启动</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github.com:grab/cursor-talk-to-figma-mcp.git
<span class="hljs-built_in">cd</span> cursor-talk-to-figma-mcp

bun setup
</code></pre>
<p>启动服务：</p>
<pre><code class="hljs language-perl" lang="perl">bun <span class="hljs-keyword">socket</span>
</code></pre>
<p>启动效果如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e6f08367a8748669013eb858d2e2f77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=wRnTqvAXwRYIpTHVR6b%2F8aquwj0%3D" alt="启动效果.png" loading="lazy"/></p>
<h4 data-id="heading-6">Figma中配置plugin</h4>
<p>打开figma软件以后，新建 Design</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b40027fef9f4bdc992202ed89d1c4bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=n6gNMj8p9%2BRJHNMXTUiNR5u29uU%3D" alt="新建 Design.png" loading="lazy"/></p>
<p>选择菜单栏 Plugins -&gt; Development
然后导入 <code>src/claude_mcp_plugin/manifest.json</code> 文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9df689da444f482594421bd7c0195e39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=keKzBJbwHHajjrbmjOMBXkYePTI%3D" alt="菜单.png" loading="lazy"/></p>
<p>或者点击 Plugins -&gt; Manage Plugins... 打开下面弹窗，直接搜索<code>Cursor Talk To Figma MCP Plugin</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad12fc9090e4bf98b0c948887bf1bde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=l%2BjnGTGA2TdJ0c37aL6lHH6b83c%3D" alt="Cursor Talk To Figma MCP Plugin.png" loading="lazy"/></p>
<p>安装后点击打开：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e32df60c4e47cc9d79dc985d23a106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=QnlQf2jQaYz9bBpPbeDm17bkNCE%3D" alt="mcp已连接.png" loading="lazy"/></p>
<h4 data-id="heading-7">在Cursor配置MCP</h4>
<p>将上面json格式文件复制，打开Cursor，选择<code>Tools &amp; MCP</code>菜单，点击 <code>New MCP Server</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140ae6389f3f4e9b811871027d41a363~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=s4s5kmYNBwkvO172lPwpO8qLz8o%3D" alt="Cursor mcp.png" loading="lazy"/></p>
<p>将刚才json文件添加进去：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de481b65076348a8b03065b23d1b9367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=OvHFAlqtzpg%2FRxwIkIR2oA%2FuO6Y%3D" alt="mcp配置.png" loading="lazy"/></p>
<p>然后启用<code>TalkToFigma</code>这个 MCP</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a0946344145289ffd0bc0898afc10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=gk%2BmFnC2uXCNpseRa%2BzoBGaoFHo%3D" alt="TalkToFigma.png" loading="lazy"/></p>
<p>此时就可以在Cursor对话框中输入<code>channel id</code> 进行连接，提示连接成功以后如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88b23062a6f0458f8e96813646ce2a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=tpxtxDonCxkVAyowH1dg%2BzavzKU%3D" alt="连接figma.png" loading="lazy"/></p>
<h4 data-id="heading-8">通过Cursor 操作 Figma</h4>
<p>此时就可以让Cursor在Figma中进行画图了，如下效果所示：</p>
<p>让figma设计一个移动端的登录页面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddd30ee06b140e6956ccf45992ef987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=Ss1oFUpdvcmsr%2FmcMA%2FNuW1NyNE%3D" alt="移动端的登录界面.png" loading="lazy"/></p>
<h2 data-id="heading-9">三、Claude 如何操作 Figma</h2>
<h3 data-id="heading-10">1. 安装 Claude</h3>
<p>点击查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fen%2Foverview%23npm" target="_blank" title="https://code.claude.com/docs/en/overview#npm" ref="nofollow noopener noreferrer">Claude 官方文档</a>进行安装，
网上有很多安装教程，如果没有 Claude的API key，可以参考这篇教程 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1678591" target="_blank" title="https://developer.aliyun.com/article/1678591" ref="nofollow noopener noreferrer">通过 DeepSeek 3.1 配置 Claude Code 教程</a>，API key 也可以。</p>
<p>安装完成，<strong>启动 Claude Code</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 控制台输入</span>
claude
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8094e2c3e4a4fe0bdce7151349ba451~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=1e5lrPbRyycIELAhIWh5EGkESTI%3D" alt="claude启动效果.png" loading="lazy"/></p>
<h3 data-id="heading-11">2. 配置MCP</h3>
<p>前面已经介绍过如何安装Figma了，这里接介绍下如何给Claude配置MCP，MCP依然使用前面安装的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrab%2Fcursor-talk-to-figma-mcp" target="_blank" title="https://github.com/grab/cursor-talk-to-figma-mcp" ref="nofollow noopener noreferrer">cursor-talk-to-figma-mcp</a></p>
<blockquote>
<p><strong>注意：</strong> 可能你也可以搜索到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Farinspunk%2Fclaude-talk-to-figma-mcp" target="_blank" title="https://github.com/arinspunk/claude-talk-to-figma-mcp" ref="nofollow noopener noreferrer">claude-talk-to-figma-mcp</a> 这个MCP，但是很遗憾在使用时，启动时会报错，暂时还没有找到解决办法，可以看这个issues：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Farinspunk%2Fclaude-talk-to-figma-mcp%2Fissues%2F19" target="_blank" title="https://github.com/arinspunk/claude-talk-to-figma-mcp/issues/19" ref="nofollow noopener noreferrer">github.com/arinspunk/c…</a> 。但是发现 cursor-talk-to-figma-mcp 是可以在claude中使用。</p>
</blockquote>
<ul>
<li>前面步骤中Figma中配置plugin 获取到的MCP的json文件可以配置到项目 .mcp.json 文件中（只有在当前项目目录下才有这个MCP），MCP配置方式可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fmcp" target="_blank" title="https://code.claude.com/docs/zh-CN/mcp" ref="nofollow noopener noreferrer">参考Claude 官方文档</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e04c8f2b91294a16918868be284bea5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=D6NYl22vMMshik4fTVsnLuZbK4U%3D" alt="配置claude mcp.png" loading="lazy"/></p>
<p>然后通过 <code>/mcp</code> 来查看配置的MCP是否连接正常</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5c6c2877044228a2750bc5a636c38b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=%2F8iPvNzasBorRO0iuSP4FCZeQEA%3D" alt="查看mcp.png" loading="lazy"/></p>
<h3 data-id="heading-12">3. Claude 操作 Figma</h3>
<p>Figma配置和启动等步骤和前面Cursor中介绍的相同，这里配置完MCP就可以测试连接figma：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a61043e52d4490787e682f354ef4e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=OtlHahJYXJes9eVQJD5PtHkam%2F4%3D" alt="连接figma.png" loading="lazy"/></p>
<p>操作figma生成移动端登录页面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84161c8b7f3545b3b77115bb346a969c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=XCYARewBO4qA2I%2B9SUAqgTegAE4%3D" alt="claude 控制figma.png" loading="lazy"/></p>
<h2 data-id="heading-13">参考文档</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2F" target="_blank" title="https://cursor.com/cn/" ref="nofollow noopener noreferrer">Cursor</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2F" target="_blank" title="https://www.figma.com/" ref="nofollow noopener noreferrer">Figma</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fen%2Foverview%23npm" target="_blank" title="https://code.claude.com/docs/en/overview#npm" ref="nofollow noopener noreferrer">Claude 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1678591" target="_blank" title="https://developer.aliyun.com/article/1678591" ref="nofollow noopener noreferrer">通过 DeepSeek 3.1 配置 Claude Code 教程</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fmcp" target="_blank" title="https://code.claude.com/docs/zh-CN/mcp" ref="nofollow noopener noreferrer">通过 MCP 将 Claude Code 连接到工具</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今晚Cloudflare一哆嗦，我的加班计划全泡汤]]></title>    <link>https://juejin.cn/post/7573886599433830451</link>    <guid>https://juejin.cn/post/7573886599433830451</guid>    <pubDate>2025-11-18T15:38:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433830451" data-draft-id="7573900332637126666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今晚Cloudflare一哆嗦，我的加班计划全泡汤"/> <meta itemprop="keywords" content="后端,前端,程序员"/> <meta itemprop="datePublished" content="2025-11-18T15:38:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一旅人"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今晚Cloudflare一哆嗦，我的加班计划全泡汤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一旅人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T15:38:35.000Z" title="Tue Nov 18 2025 15:38:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>事情发生在今晚加班的黄金时间。我正对着代码发愁，想着让ChatGPT帮我debug一下。结果连续三次重试，等来的都是冷冰冰的错误页面。</p>
<p>"行吧，AI也有累的时候"，我自我安慰着，顺手想点开X摸鱼五分钟。</p>
<p>结果呢？小鸟直接躺平了。页面加载圈转得比我家旧电脑开机还慢。</p>
<p>那一刻我突然顿悟——这不是某个网站的问题，这是互联网的"大动脉"堵了。</p>
<p>而罪魁祸首，就是那个你可能从未听说过，却在背后支撑着你每天访问的大半个互联网的<strong>Cloudflare</strong>。</p>
<hr/>
<h3 data-id="heading-0">这个幕后大佬，到底在互联网里扮演什么角色？</h3>
<p>想象一下，你要从北京点一份上海的生煎包。如果没有Cloudflare，你得亲自跑一趟上海，等包子送到你手里，早就凉透了。</p>
<p>但有了Cloudflare，就相当于在每个小区门口开了家"包子铺分店"——你下楼就能吃到热腾腾的包子，还省了机票钱。</p>
<p>具体来说，Cloudflare在互联网里干着三件大事：</p>
<p><strong>全球快递网络（CDN）</strong>
它在全球300多个城市建立了"分店"，把你网站的内容复制到世界各地。用户访问时，直接从最近的节点获取数据，速度快到飞起。</p>
<p><strong>24小时保安队长（安全防护）</strong>
它站在网站门口，识别并拦截恶意流量，把黑客攻击挡在门外。就像商场安检，让捣乱分子根本进不了门。</p>
<p><strong>永不迷路的导航系统（DNS解析）</strong>
它负责把"juejin.cn"这样的域名翻译成服务器能听懂的IP地址。今晚就是这个"导航系统"突然抽风，让大家都迷了路。</p>
<hr/>
<h3 data-id="heading-1">一次看似普通的维护，怎么就演变成了全球崩盘？</h3>
<p>根据Cloudflare状态页面的信息，故障从UTC时间06:40（北京时间14:40）左右开始。</p>
<p>其实在故障发生前，Cloudflare确实有几个数据中心的维护计划。这本来是个常规操作，就像给大楼换个灯泡那么简单。</p>
<p>但意外发生了：维护过程中触发了<strong>自动化故障转移的连锁反应</strong>。简单说，就是关掉A线路时，本该自动切换到B线路，结果B线路没接住，还把C线路也给带崩了。</p>
<p>这就好比你只是想换个灯泡，结果不小心触发了整栋楼的短路保护，连电梯都停运了。</p>
<p>多米诺骨牌开始接连倒下：</p>
<ul>
<li>X平台用户报告数在短时间内激增到<strong>5600多条</strong></li>
<li>ChatGPT直接摆烂，显示"请取消阻止challenges.cloudflare.com"</li>
<li>各种网站开始刷屏"500 Internal Server Error"</li>
<li>连Cloudflare自己的管理后台都进不去了</li>
</ul>
<p>最讽刺的是什么？就像一个修车师傅，在客户的车坏掉的同时，发现自己的工具箱也打不开了。</p>
<hr/>
<h3 data-id="heading-2">为什么Cloudflare一出事，影响范围就这么广？</h3>
<p>要理解这一点，先来看看Cloudflare在互联网世界的地位。</p>
<p>数据显示，全球<strong>超过20%</strong> 的网站使用Cloudflare的服务。这还不包括那些间接依赖它的大型平台。</p>
<p>把它想象成<strong>北京东直门立交桥</strong>：当这个交通枢纽突然封闭，受影响的不仅是桥上的车，还会导致整个二环、三环陷入瘫痪，进而波及整个城市的交通系统。</p>
<p>这不是Cloudflare第一次"牵一发而动全身"。根据你提供的资料，在故障期间，Cloudflare股价盘前下跌约<strong>4.1%</strong>，市场反应立竿见影。</p>
<hr/>
<h3 data-id="heading-3">从今晚的"数字便秘"中，我们该学到什么？</h3>
<p>这次事件与其说是一次事故，不如说是一次<strong>互联网依赖度的压力测试</strong>。</p>
<p><strong>别把鸡蛋都放在一个篮子里</strong>
再可靠的服务商也可能出问题。关键业务应该有备用方案，就像你不会只记电话号码在手机上，还会备份在别处。</p>
<p><strong>自动化是双刃剑</strong>
自动化系统能提高效率，但也可能放大错误。一个微小的配置问题，通过自动化流程的传导，可能演变成全球故障。</p>
<p><strong>监控不能只靠感觉</strong>
等到用户反馈问题时才意识到故障，为时已晚。建立完善的监控体系，才能在问题萌芽时就发现它。</p>
<hr/>
<h3 data-id="heading-4">写在最后</h3>
<p>几小时后，服务逐渐恢复。ChatGPT重新变得健谈，X上的小鸟再次起飞。</p>
<p>但这次短暂的"全球断联"，给我们提了个醒：我们习以为常的数字化生活，其实建立在一系列复杂且脆弱的基础设施之上。</p>
<p>下次再遇到全网抽风，不妨先泡杯茶——很可能不是你的网线出了问题，而是某个遥远的"云"，又打了个喷嚏。</p>
<p>而我们能做的，就是在享受便利的同时，随时准备好自己的"伞"。毕竟在这个高度互联的时代，<strong>越是便利，越是集中；越是集中，风险越高。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Anthropic 出手，大幅降低 MCP 的 Token 消耗]]></title>    <link>https://juejin.cn/post/7573888000020463679</link>    <guid>https://juejin.cn/post/7573888000020463679</guid>    <pubDate>2025-11-18T14:06:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573888000020463679" data-draft-id="7573888000020447295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Anthropic 出手，大幅降低 MCP 的 Token 消耗"/> <meta itemprop="keywords" content="Claude,MCP,人工智能"/> <meta itemprop="datePublished" content="2025-11-18T14:06:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Anthropic 出手，大幅降低 MCP 的 Token 消耗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:06:43.000Z" title="Tue Nov 18 2025 14:06:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以前要实现一个 <code>Agent</code>，需要手动完成一个个 <code>API</code> 的接入和调试，现在有了 <code>MCP</code>，接入外部能力的工作简单了许多。</p>
<p>但 MCP 多了之后，模型上下文中塞入了大量的工具定义，导致模型既慢，又浪费 <code>Token</code>。</p>
<p>直到看到了 <code>Anthropic</code> 的《Code execution with MCP: Building more efficient agents》，我才发现 MCP 的调用原来也是可以很高效的。</p>
<h2 data-id="heading-0">传统 MCP 的效率瓶颈</h2>
<p><code>MCP</code> 在规模化应用中有两个关键短板：</p>
<h3 data-id="heading-1">工具定义“占满”上下文</h3>
<p>为了让智能体知道如何使用工具，<code>MCP</code> 方式会把所有工具的功能描述、参数要求等加载到模型的上下文中。</p>
<p>在大规模项目中，这些定义信息可能就会占用数十万 <code>Token</code>，不仅拖慢响应速度，还会大幅增加使用成本。</p>
<h3 data-id="heading-2">中间结果重复消耗资源</h3>
<p>智能体完成复杂任务时，往往需要多次调用工具，并传递中间结果。</p>
<p>比如将云盘文档同步到业务系统，文档会在云盘 MCP 和业务系统 MCP 中<strong>多次传输</strong>，导致上下文超出限制，甚至任务中断。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f8e7cdd6e8b4bb2b2d052bb3223c4cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=MJOYgjsP2SDAciUlcZddJjxkvUI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">解决方案：代码执行</h2>
<p><strong>代码执行</strong>的核心逻辑，是把 MCP 工具从 “直接调用的功能” 转变为 “可由代码调用的 API”。</p>
<p>智能体不再被动接收全部的工具定义，而是根据需要自动编写代码进行 MCP 调用，这一方案带来了多重提升：</p>
<h3 data-id="heading-4">渐进式披露，减轻上下文负担</h3>
<p>将工具以代码形式呈现在文件系统上，能让模型按需读取工具定义，而非预先全部读取。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e300d0a2907e4218a438926816ae608d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=z%2BsjuxRR4EfY0BCbRdgqqxB69l8%3D" alt="代码执行的工具定义" loading="lazy"/></p>
<p>“渐进式披露”的工作流程如下：</p>
<p>1、预加载极简提示： 在 LLM 的上下文窗口中，我们只植入工具的名称、主要参数和功能的精炼代码签名（例如 tool.searchOrders(customer_id: str)）。这部分信息占用的 Token 非常少。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c796f8f9ede644ac9d692920fbb61c0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=kjU3iVuKKubtvsu2QO2B3KCTFH8%3D" alt="" loading="lazy"/></p>
<p>2、Schema 外部化： 所有工具冗长、复杂的 JSON Schema 和验证规则，被移出 LLM 上下文，存储在外部的 MCP Server 的“工具注册中心”。</p>
<p>3、代码触发查找： 当 LLM 生成代码 tool.searchOrders('U456') 并发送给 Server 执行时，Server 才会去其外部的工具注册中心查找 searchOrders 的完整定义，并用它来执行 API 调用。</p>
<h3 data-id="heading-5">本地处理数据，减少中间传输</h3>
<p>面对大文件、海量数据任务时，智能体可以编写代码，在执行容器中先筛选、处理，最后只需把<strong>结果返回给模型</strong>，避免大量冗余数据消耗传输 Token。</p>
<p>这个思路竟然与我们上半年实现“问数”的思路类似。不过，我们当时还没有意识到这样节省 Token 传输，我们仅仅是因为 text2sql 不太可靠，采用了智能体调用各种“算子”（各种已有的数据处理类 API）。</p>
<h3 data-id="heading-6">简化复杂流程，降低操作成本</h3>
<p>在一些复杂场景中，比如系统监控通知、批量处理数据场景中，代码执行模式还可以利用<strong>代码的循环、条件判断逻辑</strong>，简化实现，减少智能体的反复工具调用，大幅减少延迟及操作成本。</p>
<h3 data-id="heading-7">数据隐私保护</h3>
<p>除了上述提升效率、降低成本的益处外，代码执行还有一个隐藏的好处。</p>
<p>由于中间结果默认保留在安全的执行环境中，原始数据无需进入模型的上下文，只有统计结果才会返回给智能体，这在很大程度上可以<strong>保护用户的数据隐私</strong>。</p>
<h2 data-id="heading-8">结语</h2>
<p>尽管 <code>Anthropic</code> 在某些政策上存在争议，但其在 <code>Agent</code> 道路上的技术探索不得不说非常值得学习。</p>
<p>推荐大家多关注他们的技术博客，收益良多~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio 2026真的值得升级吗中国开发者实测报告]]></title>    <link>https://juejin.cn/post/7573886599433699379</link>    <guid>https://juejin.cn/post/7573886599433699379</guid>    <pubDate>2025-11-18T14:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433699379" data-draft-id="7573896789365686310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio 2026真的值得升级吗中国开发者实测报告"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T14:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio 2026真的值得升级吗中国开发者实测报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:17:21.000Z" title="Tue Nov 18 2025 14:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年11月11日，微软正式发布Visual Studio 2026，国内开发者社区瞬间炸锅！这款号称"世界首个智能开发环境（IDE）"的更新，解决5000多个bug、响应300多项功能请求，实测解决方案加载速度和UI响应时间直接砍半，最关键的是承诺100%兼容VS2022的项目和扩展。面对这样的开发神器，你还要守着VS2022当"钉子户"吗？</p>
<h2 data-id="heading-0">为什么现在必须升级到Visual Studio 2026</h2>
<p>在咱们码农的世界里，效率就是生命线！当你调试线上紧急bug或赶deadline时，IDE每卡顿一秒都可能让你头皮发麻。Visual Studio 2026的推出，正是来解救"效率焦虑症患者"的。微软官方数据显示，VS2026不仅解决5000多个bug，还响应300多个开发者功能请求，稳定性和实用性实现质的飞跃！</p>
<p>更重要的是，VS2026引入"智能开发环境"概念，把AI无缝融入开发全流程。这可不是简单的代码补全，而是从调试、性能分析到应用现代化的全方位智能支持。微软说："这不是为了AI而AI，而是工具的自然进化。"在AI驱动开发的时代，拒绝升级可能意味着你正在慢慢掉队！</p>
<p>国内开发者实测反馈更香！有位老哥在论坛分享："我用VS2026打开公司包含20多个微服务的解决方案，以前VS2022要加载3分钟，现在居然45秒搞定，编译速度也快不少，再也不用边喝咖啡边等IDE响应了！"这样的效率提升，难道不是每个开发者梦寐以求的吗？</p>
<p>早期采用者的反馈更印证这点。NimblePros首席软件架构师Steve Smith兴奋表示："我刚刚打开包含100多个项目的解决方案，简直不敢相信启动这么快，马上就能用了！干得好，Visual Studio团队！"</p>
<h2 data-id="heading-1">Visual Studio 2026与2022对比五大显著优化改变开发体验</h2>
<p>说到升级，咱们最关心的是：VS2026到底比VS2022强在哪儿？直接上干货！</p>
<p>首先是<strong>解决方案加载速度</strong>的革命性提升。微软测试数据显示，加载大型.NET解决方案时，VS2026交互就绪时间比VS2022快很多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60046b4d92a74910adfbb30d072b2e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=nAtYFsNjBP6%2FmniIOX0EOajTyJU%3D" alt="Visual Studio 2026与2022解决方案加载时间对比" loading="lazy"/></p>
<p>但速度快只是一方面，更重要的是<strong>UI响应性</strong>提升。咱们都经历过打开大型解决方案时IDE界面"卡死"的尴尬。VS2026彻底解决这个痛点，把UI无响应时间减少一半以上！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9743db817e74abf8de3c3c9ea626641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=5kxDuqZp3Eraav%2BtEJlOQow%2BY%2Fk%3D" alt="Visual Studio 2026与2022解决方案加载挂起时间对比" loading="lazy"/></p>
<p>第三大优化是<strong>整体性能和流畅度</strong>提升。虽然数字直观，但真正的爽快感只有用过才知道。VS2026给人的感觉就是"快、流畅、响应迅速"，这种体验飞跃没法用简单数字衡量。</p>
<p>第四，<strong>用户界面的现代化</strong>也是亮点。VS2026采用全新UI设计，不仅好看更重要的是好用。Context&amp; A/S的Erik Ejlskov Jensen特别提到："我最喜欢Visual Studio 2026的是它的性能和清新明快的UI——对Mermaid图表的支持更是锦上添花。"</p>
<p>最后，最让咱们兴奋的是<strong>AI原生体验</strong>的引入。VS2026不再简单添加AI功能，而是把AI深度融入整个开发流程，从代码编写到调试优化，AI都在恰当时候提供帮助，不会打断工作流。</p>
<h2 data-id="heading-2">Visual Studio 2026的AI革命智能但不越界的支持策略</h2>
<p>Visual Studio 2026最吸睛的莫过于AI功能。微软称其为"世界首个智能开发环境（IDE）"，这到底意味着什么？</p>
<p>说白了，VS2026的AI不是来抢饭碗的，而是当"超级助手"。它采用"需要时才出现"的策略，在你调试复杂问题、分析性能瓶颈或现代化应用时，AI会主动跳出来帮忙，消除障碍，提供洞见，让你更快前进，不会打断工作流。</p>
<p>这种策略核心是"增强而非替代"。微软强调："这意味着在最重要的时候给你智能。它旨在提升你已经信任的实践，而不是取代它们。"这种理念开发者太认同了！Redis高级全球解决方案架构师Roberto Perez分享："Visual Studio中的Profiler Agent立即突出瓶颈，并指导我实现更快、更简洁的性能——就像有一个内置的性能教练。"</p>
<p>VS2026还引入新的C#和C++智能代理，专为需要精确和速度的专业开发者设计。这些功能扩展能力却不增加复杂性，让你保持控制的同时，用更少时间干更多活儿。</p>
<p>国内多语言项目团队狂喜！有位做跨境电商系统的架构师分享："我们项目同时用C#写后端、C++做底层算法，VS2026的智能代理简直是救星！自动识别不同语言最佳实践，还能提示多语言交互坑点，比以前省至少30%调试时间。"</p>
<p>值得注意的是，微软选择将GitHub Copilot深度整合到VS2026中。这不是拍脑袋决定，而是基于开发者实际需求的战略选择。GitHub Copilot已成为VS中使用最广泛的功能之一，深受依赖它的开发者好评。通过将AI能力与实际开发需求紧密结合，VS2026成功避免"为AI而AI"的陷阱，真正做到"智能但不越界"。</p>
<h2 data-id="heading-3">从VS2022到VS2026开发者真正的无痛迁移如何实现</h2>
<p>对很多开发者来说，升级IDE最头疼的是兼容性问题。项目能不能打开？扩展还能不能用？会不会有隐藏的坑？VS2026给出惊喜答案：100%兼容！</p>
<p>微软承诺，VS2026完全兼容VS2022的项目和扩展。打开现有解决方案，立即开始编码，无需任何迁移步骤，不会有任何意外。所有喜欢的扩展都能使用，让工作区、工具和项目无缝过渡，从第一次启动就让IDE感觉像家一样。</p>
<p>国内云服务集成毫无压力！某互联网公司DevOps工程师分享："我们项目用了阿里云、腾讯云的各种SDK和工具，升级VS2026前还担心兼容性问题，结果完全多虑了！所有云服务集成代码直接跑，连调试断点都能完美命中，这才是真正的'无痛迁移'。"</p>
<p>数据显示，目前与VS2022兼容的4000多个扩展，全部都能在VS2026上运行。Aspen Technology首席软件工程师Didier Donner表示："能够从Visual Studio 2022获得扩展是一个明显优势：我可以立即开始使用VS 2026。"</p>
<p>更革命性的是，VS2026将IDE与构建工具解耦。过去，更新Visual Studio通常意味着必须升级.NET和C++构建工具，往往带来很多麻烦。现在，可以随时更新VS2026，不会影响.NET或C++编译器。更棒的是，将获得每月自动更新，新鲜功能、设计调整和 productivity 提升直接送到IDE，同时保持工具链稳定。</p>
<p>低配置设备福音！有位独立开发者分享："我那台用了三年的笔记本，跑VS2022经常卡顿，本来以为带不动VS2026，结果实测比VS2022还流畅！特别是解决方案加载速度，以前要等一分多钟，现在20秒搞定，这优化太良心了！"</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4b1defe181c422ea77c8b373fde404a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=qnoGC%2FfglQxt7A80Qe4dioVzWRs%3D" alt="Visual Studio团队过去12个月修复的反馈工单统计" loading="lazy"/></p>
<p>这张图表展示Visual Studio团队过去12个月修复的反馈工单数量，充分体现微软对开发者体验的重视。有这样的支持，还有什么理由拒绝升级呢？</p>
<h2 data-id="heading-4">结语升级VS2026拥抱开发者的未来</h2>
<p>Visual Studio 2026的推出，不仅是常规版本更新，更是开发工具的革命性进化。它带来的不仅是速度提升和bug修复，更是全新开发体验——AI驱动、无缝流畅、兼容稳定。</p>
<p>从解决5000多个bug到300多项功能改进，从解决方案加载速度飞跃到UI响应时间减少50%以上，再到100%兼容VS2022项目和扩展，VS2026用实实在在的数据证明价值。早期采用者热烈反馈印证：这不仅是更好的IDE，更是能真正提升开发效率和质量的智能助手。</p>
<p>在软件开发这个快速发展的领域，停滞不前就意味着落后。Visual Studio 2026不仅让你跟上时代，更让你走在前沿。现在就下载升级，体验"更快、更智能"的开发快感，让代码之旅与众不同！</p>
<p>记住，最好的开发工具，是让你忘记工具的存在，专注于创造本身。Visual Studio 2026，正是为开发者而来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[电科金仓在医院怎么用？从迁移到跑稳，聊点实在的]]></title>    <link>https://juejin.cn/post/7573890735579021322</link>    <guid>https://juejin.cn/post/7573890735579021322</guid>    <pubDate>2025-11-18T14:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735579021322" data-draft-id="7573899782803095598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="电科金仓在医院怎么用？从迁移到跑稳，聊点实在的"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-18T14:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            电科金仓在医院怎么用？从迁移到跑稳，聊点实在的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:42:23.000Z" title="Tue Nov 18 2025 14:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c873ea1428415e8b6199d526503984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=n7Pow7bQwpsoF0xCanm3sP70%2FuM%3D" alt="" loading="lazy"/>
@[toc]</p>
<h2 data-id="heading-0">写在前面</h2>
<p>近些年来，医院向数字化转型的速度极快，数据库这块“地基”非常关键，选型是否稳定，使用起来是否顺手，后期能否控制得住，这些都会影响到整个医院信息系统的根基。本文不过多阐述抽象概念，而是站在医院立场，用简单易懂的语言探讨电科金仓数据库如何切实落地，包含从国产化迁移以确保系统稳定运行的具体办法与步骤，并附上一些现成的SQL语句，这样一线工作人员在模仿操作时会更为便捷。</p>
<p>据公开资料，金仓数据库，已被许多三甲医院核心系统采用，云HIS，LIS，PACS，EMR等重要业务均有其应用实例，该产品已通过EAL4 + 这种高级别安全认证，具备主备，高可用，多活等架构能力，还附带一套包含迁移和同步功能的工具，在医疗这个关键领域，其基本形成了一套较为完善的国产化替代方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bf575dd9c80490aad70a0347187cbe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=8quJVqpX4lCty1eS%2Fp2f3fgTzR0%3D" alt="image.png" loading="lazy"/>
2024年中国数据库管理系统市场厂商竞争力象限分析图</p>
<h2 data-id="heading-1">医院信息系统有哪些绕不开的坎儿？</h2>
<ul>
<li><strong>换系统，风险得够低</strong>：核心的诊疗业务，哪个环节都不能出岔子。停机一分钟，外面可能就吵翻天了。所以数据库国产化替代，千万不能“勇”，得讲究“稳”，要好弄、风险小，还得有后悔药（能随时退回去）。</li>
<li><strong>高并发，必须扛得住</strong>：一到周一上午那种就诊高峰，挂号、开药、检验、付费全是人。系统响应稍微慢一点，窗口就得排长队。所以，数据库必须得快、得稳，时延一定得压下去。</li>
<li><strong>安全合规，一条都不能少</strong>：现在国家对数据安全的要求越来越严，等级保护、操作审计、数据加密、权限划分、操作留痕这些，都得有一套完整的方案，而且得是能实实在在落地、经得起检查的。</li>
<li><strong>新老系统，得能聊到一块儿</strong>：医院里老的系统五花八门，Oracle、SQL Server、MySQL、PostgreSQL啥都有。新上的数据库，不能自己玩自己的，得能跟这些老伙计们顺畅地兼容、通上话。</li>
<li><strong>运维要省心，还得可控</strong>：医院业务是7x24小时不能停的。高可用、自动监控、出了问题能自动切、平时能演练，这些都得是实打实能做、能看到效果的，不能光说不练。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fed5261a9dea48359f927140df56ff9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=dPk2iSJKtQL9pgMVHOwi5Fy5W44%3D" alt="a934216b173d5ea60ea5db6d2bcf30ca.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-2">迁移的“组合拳”：“三低一平”加“双轨并行”</h2>
<ul>
<li><strong>活儿要简单（低难度）</strong>：尽量用兼容模式和现成的工具，让业务系统的代码改动越少越好，这样开发那边的兄弟们才不会骂娘。</li>
<li><strong>花钱要少（低成本）</strong>：从评估、迁移到最后校验，最好都有一套自动化的工具链，这样能省下不少人力，成本自然就下来了。</li>
<li><strong>风险要小（低风险）</strong>：这就是“双轨并行”的核心了。老的数据库先别动，继续跑主要业务。在旁边搭一套新的金仓环境，像个镜子一样实时同步数据。正着同步、反着同步的工具都备好，万一新系统有啥问题，随时能切回老的，业务不受影响。</li>
<li><strong>切换要顺（平滑迁移）</strong>：真到了要正式切换的那天，停机窗口得按小时甚至分钟算。整个过程都得在掌控之中，万一有意外，得能一键退回去。</li>
</ul>
<h2 data-id="heading-3">一般来说，迁移的节奏是这么个“三步走”：</h2>
<p>第一步为适配阶段，此时期老系统居于核心地位，金仓则作为辅助存在，利用即时同步工具将老系统中的数据复制到金仓端，使得两者的数据内容相一致，之后可以将部分查询请求转向金仓处理，也可以借助其执行压力检测，考察其适配情况及性能表现是否良好。</p>
<p>第二步是试运行阶段，在此将金仓设为关键角色，老系统沦为备选方案，而且，要反向调整数据同步方向，即由金仓向老系统执行同步操作，如此一来，若金仓端出现意外状况时，便能够及时切换至老系统以维持业务正常运作。</p>
<p>第三步是正式上线，试运行没有问题的话就可以正式“转正”，也就是下线老系统，并完善好相关的监测，审查以及应急演习等工作，之后就进入到长期稳定的运行及改进阶段。</p>
<h2 data-id="heading-4">架构设计上，有几个关键点得抓住</h2>
<ul>
<li><strong>高可用和多活</strong>：具体是用同城双活，还是搞两地三中心，得看医院的等级和对业务连续性的要求（就是RTO/RPO指标）。方案做得好，RPO（数据零丢失）能接近0，RTO（业务恢复时间）能做到分钟级。当然，这牛不是吹的，得靠实打实的演练和压测数据说话。</li>
<li><strong>读写分离</strong>：这是个好习惯。把挂号、开药这些需要写数据的操作都放主库；像生成报表、数据分析这种只读的操作，就扔到备库或者只读节点上。这样主库的压力就小多了，跑得更欢。</li>
<li><strong>数据“冷热”分开管（分区与分层）</strong>：像门诊、检验、影像这些数据，增长得飞快。可以按时间（比如按季度、按年）或者按业务类型把它们隔开（分区）。时间久了不常用的“冷数据”，就放到便宜点的存储上，这样访问“热数据”的效率就高多了。</li>
<li><strong>数据能对得上，还能倒查（标识与溯源）</strong>：得有一套统一的“身份证”，比如患者ID、就诊ID、医嘱ID，把所有数据都串起来。再配上覆盖整个流程的审计，谁在什么时间动了什么数据，都得有记录，查起来才方便。</li>
<li><strong>运维尽量自动化</strong>：从安装、监控、备份，到诊断问题、搞应急演练，最好都用一个平台搞定。把日常的巡检和演练变成固定动作，这样才能心里有底。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57d47cbd617c4f2c9c0abdf30d37f3cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=Vu7oiy6ejh5nXaYqqY7Axj95ZSE%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-5">迁移和验证，手上有哪些“兵器”？</h2>
<ul>
<li><strong>“模拟考”工具（评估与回放）</strong>：有个叫“负载回放”的平台，能把老数据库上跑的真实业务流量录下来，然后在金仓上重新放一遍。这样，有啥不兼容的地方或者性能瓶颈，没上线就提前暴露了，可以从容地解决。</li>
<li><strong>“搬家”工具（迁移）</strong>：从数据库表结构到里面的数据，都能自动化地迁移，还支持全量和增量的方式。比人手一点点导数据，风险小得多，也省事儿。</li>
<li><strong>“镜子”工具（实时同步）</strong>：这个工具能在不同的数据库之间（比如Oracle和金仓）实时同步数据。它很聪明，能自动适应主备库的切换，万一网络断了还能断点续传，并且会自己检查两边数据是不是一致。</li>
<li><strong>“微创手术刀”（柔性迁移）</strong>：它的特点是从老系统抽数据的时候，尽量不影响老系统的正常运行。这样就能把正式切换时的停机时间压到最短，整个过程也更好控制。</li>
<li><strong>“对账单”工具（一致性校验）</strong>：不管是老数据还是新增加的数据，它都能帮你比对两边是不是完全一样，最后还能出个报告，让你清清楚楚、明明白白。</li>
</ul>
<h2 data-id="heading-6">再深入聊聊：迁移、验证和同步的细节</h2>
<p>KFS同步工具的“杀手锏”在于此，这个被称作KFS的同步软件到底有何特别之处？其可自动判别源数据库为单机亦或是集群，并且具备自主应对主备切换的能力，无需人工干预，面对网络抖动情形时，具备断点续传功能，而且能够随时核查数据准确性，不论是执行一对多，多对一或者更为繁杂的同步任务，它均能从容应对，在我们推行“双轨并行”策略期间，该软件充当着正向与反向同步的主要力量，是所谓“后悔药”的核心所在。</p>
<ul>
<li>只同步“有用”的数据就会变快，它很聪明，在分析数据库日志时，会先筛除无关数据，这可节省许多系统资源，它经由直接读取物理日志来捕捉数据变化，因此速度极快，通常同步延迟可维持在秒级。</li>
</ul>
<p>KRplay回归验证的“实战演习”这种说法，其中的KRplay这个工具就是前面提到的“模拟考”神器，它会把老数据库里真实业务请求录制下来，并在金仓上直接运行一遍，从而帮你预先找到那些潜藏的适配性问题以及性能不足之处，再加上数据一致性对比和SQL压力加载之后，所得到的测试结果就十分接近实际上线时的情形。</p>
<p>KDTS迁移比对的“一条龙”服务，这个叫KDTS的工具有助于“搬家”与“对账”，其会遵照你原先数据库的类型，自动将表结构及数据迁移过来，迁移完毕之后，还能帮你执行全面或者增加的数据比对，并出具详尽的报告，这样便无需凭借人力逐行对比，既节省时间又省却力气而且准确。</p>
<p>柔性迁移可概括为“准在线，全数据，低侵扰”，其含义在于尽可能不干扰当前业务，将全部数据稳定转移，并达到那些仅给你一至二小时停机时间的严格标准。</p>
<h2 data-id="heading-7">安全合规：红线碰不得</h2>
<ul>
<li><strong>资质得硬</strong>：产品本身通过了EAL4+这种高级别的信息安全认证，对于医院要过的等保三级，核心能力是能满足的。</li>
<li><strong>数据得保密，权限得分开</strong>：从数据传输到存储，都能加密。支持DBA、安全员、审计员“三权分立”的管理模式。权限控制能做到很细的粒度，还能对敏感数据（比如身份证号）做动态脱敏，给不同的人看不同的结果。</li>
<li><strong>操作得有记录</strong>：谁登录了、干了啥、改了什么数据，都得记下来，做到“雁过留声”。这样才能满足医疗数据安全和事后审计的要求。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc161a741ac9401e8d18cf17efc8837b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=WunIXybHVGyzqaCuzYmSeSVd0fc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">上手试试：来个挂号抢号的例子</h2>
<p>光说不练假把式。下面这段SQL代码，模拟了医院里最常见的“患者-医生-预约”场景，语法在金仓数据库上跑没问题，可以直接用，或者照着改改。重点是看看怎么建表，以及怎么处理好几个人同时抢一个号的并发问题。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_patient (
  patient_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  id_card <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  gender <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>),
  birth_date <span class="hljs-type">DATE</span>,
  phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>),
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_doctor (
  doctor_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  dept_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>),
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_doctor_schedule (
  schedule_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  start_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  end_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  capacity <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  booked <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  <span class="hljs-keyword">UNIQUE</span> (doctor_id, start_time, end_time)
);

<span class="hljs-keyword">CREATE</span> INDEX idx_schedule_doctor_time <span class="hljs-keyword">ON</span> kb_doctor_schedule (doctor_id, start_time);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_appointment (
  appt_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  patient_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_patient(patient_id),
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  schedule_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor_schedule(schedule_id),
  appt_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'scheduled'</span>,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> capacity, booked
<span class="hljs-keyword">FROM</span> kb_doctor_schedule
<span class="hljs-keyword">WHERE</span> schedule_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-keyword">UPDATE</span> kb_doctor_schedule
<span class="hljs-keyword">SET</span> booked <span class="hljs-operator">=</span> booked <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> schedule_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">AND</span> booked <span class="hljs-operator">&lt;</span> capacity;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_appointment (patient_id, doctor_id, schedule_id, appt_time)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">77</span>, <span class="hljs-number">123</span>, <span class="hljs-string">'2025-11-20 09:00:00'</span>);

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>这里头的门道是：</p>
<ul>
<li>在处理预约时，先用 <code>SELECT ... FOR UPDATE</code> 把这个号源记为“锁定”状态。这样，就算一百个人同时来抢这个号，也得一个个排队来，不会出现一个号卖给两个人的“超卖”情况。</li>
<li>在更新“已预约人数”之前，先检查一下是不是已经满了。然后，在同一个事务里，完成人数+1和插入预约记录这两个动作。这样能保证数据的一致性，不会出错。</li>
<li>一定要记住，整个过程要快！事务要短，干完活儿（<code>INSERT</code>、<code>UPDATE</code>）立刻提交（<code>COMMIT</code>）。最怕的就是一个连接长时间占着茅坑不拉屎（处于 <code>idle in transaction</code> 状态），这样很容易把整个数据库连接池给拖垮。</li>
</ul>
<h2 data-id="heading-9">再来个例子：病历分区和操作审计</h2>
<p>数据量大了，查询就会变慢。一个常见的优化办法就是“分区”，比如，可以把门诊病历按季度或者按年份存到不同的“抽屉”里。同时，为了安全，我们还得给核心操作加上审计，谁动了数据都得记下来。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record (
  record_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  patient_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_patient(patient_id),
  visit_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  dept_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  diagnosis TEXT,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (visit_date);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record_2025q4
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> kb_medical_record
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-10-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-31'</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_audit_log (
  audit_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  table_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  op <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  row_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ts <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> kb_appointment_audit()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">BEGIN</span>
  IF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'INSERT'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'INSERT'</span>, NEW.appt_id);
  ELSIF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'UPDATE'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'UPDATE'</span>, NEW.appt_id);
  ELSIF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'DELETE'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'DELETE'</span>, OLD.appt_id);
  <span class="hljs-keyword">END</span> IF;
  <span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">NULL</span>;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> trg_kb_appointment_audit
AFTER <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> kb_appointment
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">PROCEDURE</span> kb_appointment_audit();
</code></pre>
<h2 data-id="heading-10">关于连接池和事务，多啰嗦几句</h2>
<p>连接池需开启，并要调整好相关参数，数据库连接池化很有必要，最大连接数，空闲连接回收时限等参数得依照实际状况来调整，不能让系统在业务高峰期慌乱地生成新的物理连接，这样做速度太慢。</p>
<p>事务需干脆利落，在业务代码当中，每个逻辑单元结束时，要么执行提交（Commit），要么执行回滚（Rollback），不能含糊其辞。格外要防止出现历时过长的“长事务”，也要避开那些占着锁却不做任何事情的“懒汉”行为。</p>
<p>读操作要找“偏殿”，比如跑报表，做数据分析之类的只读任务，就安排到只读节点或者备库执行，不要影响主库处理关键的读写事务。</p>
<p>多留意“仪表盘”，要经常留意一些关键指标，比如连接池已使用的数量，是否存在锁等待情况，慢 SQL 语句有多频繁，哪个分区最为繁忙，以及是否启用了索引等，这些均可作为评判数据库健康状况的“体检报告”。</p>
<p>框架中的“坑”需谨慎对待，这里特意提及一个实际操作时会碰上的问题，假定你采用像 SqlSugar 这样的 ORM 框架，并且搭配金仓的 Kdbndp 驱动，就要格外留意事务的闭合情况。代码若调用了 <code>BeginTran()</code> 来开启事务，之后却忘记了执行 <code>CommitTran()</code> 或实施回滚，那么这个数据库连接就会一直陷于 <code>idle in transaction</code> 的状态，要么就是无法被释放，连接池很快就会被这些“僵尸”连接填满，从而致使整个应用程序因得不到新的连接而陷入瘫痪，所以，切记要有头有尾！</p>
<p>一个连接字符串的例子（参数根据你的环境改）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Host</span>=<span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span><span class="hljs-comment">;Port=54321;Database=hospital;</span>
User <span class="hljs-attr">ID</span>=app_user<span class="hljs-comment">;Password=******;</span>
<span class="hljs-attr">Pooling</span>=<span class="hljs-literal">true</span><span class="hljs-comment">;Maximum Pool Size=100;</span>
Connection Idle <span class="hljs-attr">Lifetime</span>=<span class="hljs-number">300</span><span class="hljs-comment">;Connection Pruning Interval=10</span>
</code></pre>
<h2 data-id="heading-11">性能调优：是个持续的活儿</h2>
<ul>
<li><strong>存数据要有规划</strong>：前面提过的，按时间或业务给数据分区、分冷热层，能大大减少查询时扫描的数据量，IO自然就下来了。再配合定期的归档和分区滚动策略，让主库保持“苗条”身材。</li>
<li><strong>索引要建得巧，统计信息要新</strong>：对于那些天天被查的SQL，要量身定做复合索引或者覆盖索引。另外，要记得定期执行 <code>ANALYZE</code>，更新数据库的统计信息，不然数据库“脑子”里的成本估算可能是错的，好好的索引它不用，非要去全表扫，慢SQL就是这么来的。</li>
<li><strong>人多力量大，任务要分担</strong>：有些复杂的查询或者大批量的处理，可以试试开启并行模式，让数据库调动多个CPU核心一起干。读的压力大了，就用只读节点或备库来分担，前面再架个负载均衡就更完美了。</li>
<li><strong>平时多“体检”，出事不慌张</strong>：先通过压力测试摸清系统的性能底线。然后把监控系统建起来，天天盯着响应时间、吞吐量、锁等待、缓存命中率这些关键指标。一旦发现数据有异常波动，就能快速定位问题，对症下药。</li>
</ul>
<p>再举两个索引优化的例子：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_appt_doctor_time_status <span class="hljs-keyword">ON</span> kb_appointment (doctor_id, appt_time, status);

<span class="hljs-keyword">CREATE</span> INDEX idx_patient_name_lower <span class="hljs-keyword">ON</span> kb_patient (<span class="hljs-built_in">lower</span>(name));
<span class="hljs-keyword">SELECT</span> patient_id, name
<span class="hljs-keyword">FROM</span> kb_patient
<span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">lower</span>(name) <span class="hljs-keyword">LIKE</span> <span class="hljs-built_in">lower</span>(<span class="hljs-string">'%张三%'</span>);
</code></pre>
<p>分区滚动是这么个意思：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record_2026q1
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> kb_medical_record
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2026-01-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2026-03-31'</span>);
</code></pre>
<h2 data-id="heading-12">上线之后：怎么让系统一直稳如老狗？</h2>
<p>演练！再演练！多次开展演练，高可用切换，数据回退，容灾演练这些关键措施，不能仅仅停留在口头上，而是应该定时将其拿出来实际操作一番，从而形成一种类似于肌肉记忆的效果，如此一来，一旦发生意外状况时就不会手足无措。</p>
<p>索引与统计信息需不断更新，业务情况及查询模式均会发生改变，所以要定时查看统计信息是否过时，并遵照新的查询特征来改良索引，去除多余部分并增添必要的内容。</p>
<p>要掌握好数据的“生老病死”，即分区和归档策略一旦制定，就要按时执行，不能让主库的数据无限制增长，否则早晚会出现IO压力过大这种情况。</p>
<p>要定时回溯审查，查看审计，权限以及脱敏策略是否仍有效执行，从而保证可以随时应对诸如等保之类的检测。</p>
<p>对于性能趋势要心中有数，留意事务延误和并发量的变向趋势，一旦察觉其不断上升，便要考虑是否需增加机器执行扩容，或者要在架构层面做一些小调整。</p>
<h2 data-id="heading-13">听听别人家的故事：几个案例的要点</h2>
<ul>
<li><strong>替换掉不听话的OGG</strong>：有家三甲医院，原来用OGG给SQL Server做异构同步。结果主备一切换，OGG就“懵了”，没法自动跟上，导致业务断了好长时间。后来换成金仓的KFS，主备切换后能自动识别，断了网也能续传，稳稳地搞定了两边SQL Server的实时同步。</li>
<li><strong>支撑互联网诊疗平台</strong>：在广州医科大学附属肿瘤医院，他们的互联网智慧医疗平台就跑在金仓上。用的是高可用双节点架构，服务等级协议（SLA）要求超过99.7%。对性能的要求也很具体：普通操作响应要小于2秒，精确查询小于2秒，模糊查询小于4秒。这套系统要能撑住2000个用户同时在线，每年还要处理超过500万条数据。</li>
<li><strong>灾备的目标值</strong>：在医疗行业，大家普遍追求的目标是RPO（数据丢失量）等于0，RTO（业务恢复时间）小于10分钟。通过部署多活架构和环形同步，只要方案设计得好，演练得充分，实现分钟级的RTO是完全可能的，能最大程度保证核心业务不中断。</li>
</ul>
<h2 data-id="heading-14">最后总结几句</h2>
<p>医院数据库实行国产化，并非仅点击“替换”按钮这么简单，这属于系统工程范畴，依照电科金仓以往的操作经验，其成败与否主要取决于几个要点，“替换进程需处于控制之下”，“高可用要可靠”，“迁移及数据一致性可予以验证”，“运维应当做到自动化”。</p>
<p>打法上采用“双轨并行”这种形式作为支撑，配合“柔性迁移”工具来缩减停机时间，并且利用“一致性校验”和“负载回放”多次核对，如此一来才能以风险尽可能小的方式，平稳地切换核心业务。</p>
<p>换过来仅仅是一步，后续需不断加以改善，要合理执行分区，妥善完成读写分离，持之以恒地开展演习，并切实做好审查工作，如此才能渐渐使系统变得更为流畅，进而提升患者的就医感受以及自身的运维水准。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL]]></title>    <link>https://juejin.cn/post/7573886599433601075</link>    <guid>https://juejin.cn/post/7573886599433601075</guid>    <pubDate>2025-11-18T13:09:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433601075" data-draft-id="7573899782802866222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-11-18T13:09:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:09:20.000Z" title="Tue Nov 18 2025 13:09:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>坦白讲，每次看性能测试排行榜，我都会下意识地先找找 Apache Doris 在哪个位置。</p>
<p>这次打开 JSONBench 的榜单，心情一如既往的期待加紧张。</p>
<p>好在结果让我松了一口气：默认配置下就能排到第三，仅次于维护方 ClickHouse 的两个版本。</p>
<p>不过，Doris 只能止步于此了吗？经过一系列优化后，查询时长能不能再缩短点？和 ClickHouse 的差距在哪里？</p>
<p>调优前后对比图镇楼，至于调优的具体思路，请一起往下看吧。</p>
<ul>
<li>
<p>Apache Doris 排名 (Default)</p>
<p><img src="https://cdn.selectdb.com/static/banner_3934965562.png" alt="Apache Doris 排名 (Default)" loading="lazy"/></p>
</li>
<li>
<p>Apache Doris 排名 (Unofficial Tuned)</p>
<p><img src="https://cdn.selectdb.com/static/JSON_Apache_Doris_vs_Click_House_Elasticsearch_Postgre_SQL_8e28e8e820.png" alt="Apache Doris 排名 (Unofficial Tuned)" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-0">JSONBench 简介</h2>
<p>JSONBench 是一个为 JSON 数据而生的数据分析 Benchmark，简单来说，它由 10 亿条来自真实生产环境的 JSON  数据、5 个针对 JSON  构造的特定 SQL 查询组成，旨在对比各个数据库系统对半结构化数据的处理能力。目前榜单包括 ClickHouse、MongoDB、Elasticsearch、DuckDB、PostgreSQL 等知名数据库系统，截至目前，<strong>Doris 的性能表现是 Elasticsearch 的 2 倍，是 PostgreSQL 的 80 倍</strong>。</p>
<blockquote>
<p><em>JSONBench 官网地址：jsonbench.com</em></p>
</blockquote>
<p><img src="https://cdn.selectdb.com/static/JSON_Bench_55427187e6.png" alt="JSONBench 简介.png" loading="lazy"/></p>
<p>不仅在性能上 Apache Doris 领先其他同类产品，<strong>在数据集相同的情况下，Apache Doris 的存储占用是 Elasticsearch 的 1/2、PostgreSQL 的 1/3</strong>。</p>
<p><img src="https://cdn.selectdb.com/static/JSON_Bench_2_cd1de97882.png" alt="JSONBench 简介-2.png" loading="lazy"/></p>
<p>JSONBench 测试具体流程：首先在数据库中创建一张名为 Bluesky 的表，并导入十亿条真实的用户行为日志数据。测试过程中，每个查询重复执行三次，并且在每次查询前清空操作系统的 Page Cache，以模拟冷热查询的不同场景。最终，通过综合计算各查询的执行耗时得出数据库的性能排名。</p>
<p>在这个测试中，Apache Doris 使用了 Variant 数据类型来存储 JSON 数据，默认的建表 Schema 如下：</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> bluesky (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `data` variant <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(id) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num"<span class="hljs-operator">=</span>"1");
</code></pre>
<p>Variant 是 Apache Doris 2.1 中引入一种新的数据类型 ，它可以存储半结构化 JSON 数据，并且允许存储包含不同数据类型（如整数、字符串、布尔值等）的复杂数据结构，而无需在表结构中提前定义具体的列。Variant 类型特别适用于处理复杂的嵌套结构，而这些结构可能随时会发生变化。在写入过程中，该类型可以自动根据列的结构、类型推断列信息，动态合并写入的 schema，并通过将 JSON 键及其对应的值存储为列和动态子列。</p>
<blockquote>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fsql-manual%2Fbasic-element%2Fsql-data-types%2Fsemi-structured%2FVARIANT" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/sql-manual/basic-element/sql-data-types/semi-structured/VARIANT" ref="nofollow noopener noreferrer">Apache Doris Variant 类型详情</a></li>
</ul>
</blockquote>
<h2 data-id="heading-1">调优思路与原理</h2>
<p>JSONBench 榜单排名依据各个数据库系统在默认配置下的性能数据，那么能否通过调优，让 Apache Doris 进一步释放性能潜力，实现更好的性能效果呢？</p>
<h3 data-id="heading-2">01 环境说明</h3>
<ul>
<li>测试机器：AWS M6i.8xlarge(32C128G);</li>
<li>操作系统：Ubuntu24.04;</li>
<li>Apache Doris: 3.0.5;</li>
</ul>
<h3 data-id="heading-3">02 Schema 结构化处理</h3>
<p>由于 JSONBench 特定查询中涉及到的 JSON 数据都是固定的提取路径，换言之，半结构化数据的 Schema 是固定的，因此，我们可以借助生成列，将常用的字段提取出来，实现半结构化数据和结构化数据结合的效果。类似的高频访问的 JSON 路径或者需要计算的表达式，都可以使用该优化思路，添加对应的生成列来实现查询加速。</p>
<blockquote>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FClickHouse%2FJSONBench%2Fblob%2Fmain%2Fdoris%2Fqueries_default.sql" target="_blank" title="https://github.com/ClickHouse/JSONBench/blob/main/doris/queries_default.sql" ref="nofollow noopener noreferrer">查看 JSONBench 查询</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fsql-manual%2Fsql-statements%2Ftable-and-view%2Ftable%2FCREATE-TABLE" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/sql-manual/sql-statements/table-and-view/table/CREATE-TABLE" ref="nofollow noopener noreferrer">Apache Doris 生成列详情</a></li>
</ul>
</blockquote>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> bluesky (
    kind <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.kind'</span>)) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    operation <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.commit.operation'</span>)) <span class="hljs-keyword">NULL</span>,
    collection <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.commit.collection'</span>)) <span class="hljs-keyword">NULL</span>,
    did <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data,<span class="hljs-string">'$.did'</span>)) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-type">time</span> DATETIME GENERATED ALWAYS <span class="hljs-keyword">AS</span> (from_microsecond(get_json_bigint(data, <span class="hljs-string">'$.time_us'</span>))) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `data` variant <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
DUPLICATE KEY (kind, operation, collection)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(collection, did) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num"<span class="hljs-operator">=</span>"1");
</code></pre>
<p>除了可以减少查询时提取数据的开销，还可以用展平出来的列作为分区列，使得数据分布更均衡。</p>
<p>需要注意的是，查询的 SQL 语句也要改为使用展平列的版本：</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> JSONBench 原始查询：
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count, <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT )) <span class="hljs-keyword">AS</span> users <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-keyword">HOUR</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))) <span class="hljs-keyword">AS</span> hour_of_day, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">IN</span> (<span class="hljs-string">'app.bsky.feed.post'</span>, <span class="hljs-string">'app.bsky.feed.repost'</span>, <span class="hljs-string">'app.bsky.feed.like'</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event, hour_of_day <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hour_of_day, event;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> user_id, <span class="hljs-built_in">MIN</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))) <span class="hljs-keyword">AS</span> first_post_ts <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_post_ts <span class="hljs-keyword">ASC</span> LIMIT <span class="hljs-number">3</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> user_id, MILLISECONDS_DIFF(<span class="hljs-built_in">MAX</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))),<span class="hljs-built_in">MIN</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>)))) <span class="hljs-keyword">AS</span> activity_span <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> activity_span <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">3</span>;

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用展平列改写的查询：
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count, <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> did) <span class="hljs-keyword">AS</span> users <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-keyword">HOUR</span>(<span class="hljs-type">time</span>) <span class="hljs-keyword">AS</span> hour_of_day, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-keyword">IN</span> (<span class="hljs-string">'app.bsky.feed.post'</span>, <span class="hljs-string">'app.bsky.feed.repost'</span>, <span class="hljs-string">'app.bsky.feed.like'</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event, hour_of_day <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hour_of_day, event;
<span class="hljs-keyword">SELECT</span> did <span class="hljs-keyword">AS</span> user_id, <span class="hljs-built_in">MIN</span>(<span class="hljs-type">time</span>) <span class="hljs-keyword">AS</span> first_post_ts <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_post_ts <span class="hljs-keyword">ASC</span> LIMIT <span class="hljs-number">3</span>;
<span class="hljs-keyword">SELECT</span> did <span class="hljs-keyword">AS</span> user_id, MILLISECONDS_DIFF(<span class="hljs-built_in">MAX</span>(<span class="hljs-type">time</span>),<span class="hljs-built_in">MIN</span>(<span class="hljs-type">time</span>)) <span class="hljs-keyword">AS</span> activity_span <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> activity_span <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">3</span>;
</code></pre>
<h3 data-id="heading-4">03 Page Cache 调整</h3>
<p>调整查询语句后，开启 profile，执行完整的查询测试：</p>
<pre><code class="hljs language-Plain" lang="Plain">set enable_profile=true;
</code></pre>
<p>进入 FE 8030 端口的 Web 页面，找到相关 profile 进行分析，此时发现 SCAN Operator 中的 Page Cache 命中率较低，导致热读测试过程中存在一部分冷读操作。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">-</span>  CachedPagesNum:  <span class="hljs-number">1.258</span>K  (<span class="hljs-number">1258</span>)
<span class="hljs-operator">-</span>  TotalPagesNum:  <span class="hljs-number">7.422</span>K  (<span class="hljs-number">7422</span>)
</code></pre>
<p>这种情况通常是由于 Page Cache 容量不足，无法完整缓存 Bluesky 表中的数据。建议在 <code>be.conf</code> 中添加配置项 <code>storage_page_cache_limit=60%</code>，将 Page Cache 的大小从默认的内存总量的 20% 提升至 60%。重新运行测试后，可以观察到冷读问题已得到解决。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">-</span>  CachedPagesNum:  <span class="hljs-number">7.316</span>K  (<span class="hljs-number">7316</span>)
<span class="hljs-operator">-</span>  TotalPagesNum:  <span class="hljs-number">7.316</span>K  (<span class="hljs-number">7316</span>)
</code></pre>
<h3 data-id="heading-5">04 最大化并行度</h3>
<p>为了进一步挖掘 Doris 的性能潜力，可以将 Session 变量中的<code>parallel_pipeline_task_num</code>设为 32，因为本次 Benchmark 测试机器<code>m6i.8xlarge</code>为 32 核，所以我们将并行度设置为 32 以最大程度发挥 CPU 的计算能力。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 单个 Fragment 的并行度
<span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> parallel_pipeline_task_num<span class="hljs-operator">=</span><span class="hljs-number">32</span>;
</code></pre>
<h2 data-id="heading-6">调优结果</h2>
<p>经过上述对 Schema、Query、内存限制、CPU 等参数的调整，我们对比了调优前后 Doris 的性能表现以及一些其他数据库系统的成绩，有如下结果：</p>
<p><img src="https://cdn.selectdb.com/static/_02b0f7abc5.png" alt="调优结果.png" loading="lazy"/></p>
<p>可以看到，<strong>对比调优前的 Doris，调优后 Doris 查询整体耗时降低了 74%，对比原榜单第一的 ClickHouse 产品实现了 39% 的领先优势</strong>。</p>
<h2 data-id="heading-7">总结与展望</h2>
<p>通过对 Schema 的结构化处理、查询语句的优化、缓存配置的调整以及并行参数的设置，Apache Doris 整体查询耗时显著下降，并超越 ClickHouse。</p>
<p>在默认设置下，Doris 在 10 亿条 JSON 的查询耗时与 ClickHouse 仍有数秒的差异。然而，依托于 Doris 在 JSON 处理、Variant 类型支持及生成列等能力的加持，经调优后，其半结构化数据处理性能获得了进一步显著提升，并在同类数据库中表现出明显的领先优势。</p>
<p>未来，Apache Doris 将继续打磨在半结构化领域的数据处理能力，为用户带来更加优质、高效的分析体验，包括：</p>
<ul>
<li>优化 Variant 类型稀疏列的存储空间，支持万列以上的子列；</li>
<li>优化万列大宽表的内存占用；</li>
<li>支持 Variant 子列根据列名的 Pattern 自定义类型、索引等。</li>
</ul>
<h2 data-id="heading-8">推荐阅读</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F949" target="_blank" title="https://www.selectdb.com/blog/949" ref="nofollow noopener noreferrer">Apache Doris 针对半结构化数据分析的解决方案及典型场景</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F185" target="_blank" title="https://www.selectdb.com/blog/185" ref="nofollow noopener noreferrer">揭秘 Variant 数据类型：灵活应对半结构化数据，JSON 查询提速超 8 倍，存储空间节省 65%</a></p>
</li>
</ul>
<p>欢迎扫码并备注 “半结构化” 加入 Apache Doris 社区专项交流群，免费领取 100+ 企业实践案例集和 Doris x AI 更多资料、获取技术帮助、了解最新动态，并与更多开发者和用户互动。</p>
<p><img src="https://cdn.selectdb.com/static/qrcode_4de53ab5c5.png" alt="qrcode" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Doris MCP Server v0.6.0 正式发布]]></title>    <link>https://juejin.cn/post/7573899782802964526</link>    <guid>https://juejin.cn/post/7573899782802964526</guid>    <pubDate>2025-11-18T13:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802964526" data-draft-id="7573899782802948142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Doris MCP Server v0.6.0 正式发布"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-18T13:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Doris MCP Server v0.6.0 正式发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:11:51.000Z" title="Tue Nov 18 2025 13:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Doris MCP Server v0.6.0 正式发布！</p>
<p>本次 v0.6.0 版本是里程碑式升级，从数据库连接工具全面跃升为企业级认证和数据库管理系统，核心亮点包括：</p>
<ul>
<li><strong>企业级多重认证体系</strong>：Token、JWT、OAuth 完整支持，创新性的 Token 绑定数据库配置，Doris-MCP-Server 与 Doris 权限全面打通，每个 Token 携带独立数据库连接参数，真正实现多租户数据完全隔离，由系统管理员统一赋权，避免敏感信息传递泄露。</li>
<li><strong>零停机运维能力</strong>：革命性热重载配置，10 秒内自动生效无需重启；即时数据库验证，100% 消除后期连接失败；多 Worker 水平扩展，按需拓展并发处理能力。</li>
<li><strong>Web 端可视化管理界面</strong>：全新安全的 localhost 专用 Token 管理面板，支持实时统计、一键创建、批量管理、自动持久化，复杂操作变得简单直观。</li>
<li><strong>连接池性能飞跃</strong>：智能会话缓存减少 60% 连接开销，100% 消除连接超时问题，自动连接释放与重连管理。</li>
<li><strong>企业级安全增强</strong>：多层 IP 限制、管理员认证、SQL 注入防护升级、完整审计追踪，生产环境安全无忧。</li>
<li><strong>架构全面优化</strong>：统一配置框架、Docker 跨平台兼容、异步操作标准化，部署运维更简单。</li>
</ul>
<p><strong>典型应用场景</strong>：多租户 SaaS（customer_a_token → database_a 完全隔离）、高可用环境零停机配置更新、安全敏感组织的企业级权限管控。</p>
<p>本次升级完全向后兼容 v0.5.x，现有 API 和配置无需修改，可平滑升级。</p>
<p>🚀 Doris MCP Server v0.6.0，开启企业级数据平台与认证管理新时代！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？]]></title>    <link>https://juejin.cn/post/7573899782802997294</link>    <guid>https://juejin.cn/post/7573899782802997294</guid>    <pubDate>2025-11-18T13:36:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802997294" data-draft-id="7573896789365637158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-18T13:36:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:36:39.000Z" title="Tue Nov 18 2025 13:36:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿，AI圈的朋友们！最近有没有感受到一股暗流涌动？没错，埃隆·马斯克旗下的xAI，这次玩了个“低调奢华”的大动作——Grok 4.1，它不是简单地来了，而是“炸裂”式地登场了！虽然从11月1日开始就已静默推送，直到11月17日才正式公布，并在11月18日实现全面可用，但这短短几周的“暗中观察”，已经足够让整个AI界为之侧目。</p>
<p>这次Grok 4.1的更新，绝不是小修小补，而是一次脱胎换骨的性能飞跃。它不仅仅是数字的堆砌，更是向我们展示了AI如何能变得更聪明、更懂你、甚至更有“人情味”。作为一名AI观察者，我不得不说，Grok 4.1带来的震撼，远超预期。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fwdasf-1024x738.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/wdasf-1024x738.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09878e04fdb54d1ebbd77973d63796dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=vMtA7nAOEn0s1hQaIgXhcAZ7ZN0%3D" alt="wdasf" loading="lazy"/></a></p>
<h3 data-id="heading-0">核心能力大盘点：它凭什么“碾压”群雄？</h3>
<p>让我们直接看看Grok 4.1在各项指标上的“疯狂表现”，你就知道我为什么会用“炸裂”来形容它了。</p>
<h4 data-id="heading-1">🏆 霸榜LMArena：通用能力的王座</h4>
<p>想象一下，在一个汇聚了全球顶尖AI模型的竞技场上，Grok 4.1直接包揽了冠亚军！ 它的<strong>思考模式（Grok 4.1 Thinking，代号quasarflux）<strong>以1483的Elo得分稳居榜首，而更令人惊叹的是，即便是为了追求极速响应而生的</strong>非推理模式（Grok 4.1 Fast，代号tensor）</strong>，也以1465的Elo得分位列第二，甚至超越了其他所有模型的完整推理配置。这简直是坐火箭的速度，要知道Grok 4此前还在第33位徘徊，这次直接冲上云霄，简直是逆风翻盘的教科书！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-18_21.25.34-1024x312.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-18_21.25.34-1024x312.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f677134f3b9461383304694dce3f3b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=tEAcMFeFXOcKXRIm4NA22v2uz4c%3D" alt="iShot_2025-11-18_21.25.34" loading="lazy"/></a></p>
<h4 data-id="heading-2">❤️ 情商爆表：情感理解更上一层楼</h4>
<p>我们总说AI缺乏“人情味”，但Grok 4.1却狠狠地打了我们的脸。在EQ-Bench 3情感智力测试中，Grok 4.1的两种模式双双包揽榜单前两名，Elo得分高达1586。当你说“我丢失了猫咪”时，它不再是冰冷的模板回复，而是能提供温暖、实用且富有同理心的建议。这种捕捉对话中细微意图的能力，让Grok 4.1的交互体验变得更具体、更有温度。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fbhdfbrgn-1024x648.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/bhdfbrgn-1024x648.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3477ac3d4ff54ba5be3331faa231ca74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=dDfDTrAHwJevm3ydrLo8u9fUxTU%3D" alt="bhdfbrgn" loading="lazy"/></a></p>
<h4 data-id="heading-3">📝 文采斐然：创意写作的新高峰</h4>
<p>写作能力更是突飞猛进。在Creative Writing v3测试中，Grok 4.1的两种模式分别位列第二和第三。Elo得分跃升至1722，较上一代提升了近600分。这意味着它能生成更具想象力、更连贯的文本，无论是叙事故事还是文学表达，甚至能写出让你惊叹的X帖子——这哪是AI，简直是未来世界的诗人！</p>
<h4 data-id="heading-4">✅ 告别“幻觉”：事实准确性质的飞跃</h4>
<p>最让人头疼的“幻觉”问题，Grok 4.1也给出了漂亮的解决方案。它的幻觉率从上一代的约12.09%大幅降低至约4.22%，降幅接近3倍。这意味着它在信息查询时产生错误或虚构信息的概率显著下降，它提供的信息更可靠，更能成为你值得信赖的助手。在长达两周的静默发布盲测中，用户对Grok 4.1的回答偏好率达到64.78%。这可不是小数字，这代表了实打实的认可！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fasdasdyyynn-954x1024.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/asdasdyyynn-954x1024.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf6a601316e4f6c9ba8a18eff763431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=iTsm87P%2BUGmZXXjTLmdjIb0UGoI%3D" alt="asdasdyyynn" loading="lazy"/></a></p>
<h3 data-id="heading-5">揭秘幕后：它究竟藏着什么“黑科技”？</h3>
<p>Grok 4.1之所以能取得如此逆天的表现，离不开xAI在技术上的大胆创新。</p>
<ul>
<li><strong>两种推理模式</strong>：Grok 4.1提供了“<strong>思考模式（quasarflux）</strong>”和“<strong>非推理模式（tensor）</strong>”两种选择。前者会展示其内部的推理链条，让你看到它如何一步步“思考”，特别适合解决复杂的数学、编程或多步骤逻辑问题，追求的是深度和精准；后者则以极快的响应速度著称，适合日常对话和快速查询，在速度与效率上做到了极致。</li>
<li><strong>智能体推理作为奖励模型</strong>：性能提升得益于训练方法的改进。xAI采用了前沿的<strong>智能体推理模型作为奖励模型</strong>，这让模型能够自主、大规模地评估和迭代输出结果。通俗来讲，就像给AI请了一个极其严苛又专业的老师，它会不断地“自我批评”和“自我优化”，最终在风格一致性和事实准确性上取得了显著进步。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Ffegefb-1024x617.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/fegefb-1024x617.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0884ed1380d247da9e042f5646dbd9f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=bRoxgNraS64Q4QjnXT%2BRiFEMcYM%3D" alt="fegefb" loading="lazy"/></a></p>
<h3 data-id="heading-6">如何体验：免费的AI未来近在眼前！</h3>
<p>好消息是，如此强大的Grok 4.1目前<strong>已免费向所有用户开放使用</strong>！你无需任何额外订阅，就可以通过以下平台轻松访问：</p>
<ul>
<li>Grok 官网 (grok.com)</li>
<li>X（原推特）平台</li>
<li>iOS 和 Android 官方移动应用</li>
</ul>
<p>在平台的应用内，你可以直接在模型选择器中手动指定使用“Grok 4.1”，当然，系统默认的“Auto”模式也会自动为你分配这个最新、最强的模型。</p>
<h3 data-id="heading-7">写在最后：AI的“人性化”之路</h3>
<p>Grok 4.1的发布，无疑是xAI在人工智能领域投下的一枚重磅炸弹。它不仅在客观性能测试中占据了领先地位，更重要的是，在情感理解、创意写作等体现“人性化”交互的维度上取得了显著进步，同时大幅提升了回答的可靠性。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Febeer-1024x492.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/ebeer-1024x492.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684bdaaa8e954699a8eff657c954ef37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=WFGsauZ8fQ8vHl16yzwLysJc6lw%3D" alt="ebeer" loading="lazy"/></a></p>
<p>这让我不禁思考，未来的AI，或许真能成为我们生活和工作中最懂、最得力的伙伴，不再是冰冷的工具，而是有温度、有创造力、值得信赖的“数字友人”。你准备好迎接Grok 4.1带来的新体验了吗？</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose中的阴影艺术]]></title>    <link>https://juejin.cn/post/7573896789365669926</link>    <guid>https://juejin.cn/post/7573896789365669926</guid>    <pubDate>2025-11-18T13:50:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789365669926" data-draft-id="7573886599432683571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose中的阴影艺术"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-11-18T13:50:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose中的阴影艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:50:16.000Z" title="Tue Nov 18 2025 13:50:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「The Art of Shadows in Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fproandroiddev%2Fthe-art-of-shadows-in-jetpack-compose-63a75070882f" target="_blank" title="https://medium.com/proandroiddev/the-art-of-shadows-in-jetpack-compose-63a75070882f" ref="nofollow noopener noreferrer">medium.com/proandroidd…</a>，由Stefano Natali发布于2025年10月4日。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6f100018f54ef9b05abaaf576913dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=6BCjP1%2BLZWcJpa0zweOSpj9LDqU%3D" alt="0.png" loading="lazy"/></p>
<p>UI中的阴影发挥着至关重要的作用：它们在视觉上<strong>提升</strong>元素，指示着<strong>交互性</strong>，并提供用户操作的即时<strong>反馈</strong>。多年来，我们一直依赖于<strong>高度</strong>属性，但 Jetpack Compose 现在提供了一套强大的工具，可以对<strong>阴影渲染</strong>进行精细控制。</p>
<p>Google 最近新增了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fgraphics%2Fdraw%2Fshadows" target="_blank" title="https://developer.android.com/develop/ui/compose/graphics/draw/shadows" ref="nofollow noopener noreferrer">文档页面</a>，其中包含一系列有趣的用例。本文将探索 Compose 中的主要阴影修改器，并深入讲解创建渐变和炫酷特效等高级技巧，从而提升应用的风格。</p>
<p>本文讨论的所有技巧的完整代码示例都可以在我的 GitHub 仓库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstefanoq21%2FComposePlayground" target="_blank" title="https://github.com/stefanoq21/ComposePlayground" ref="nofollow noopener noreferrer"><strong>Compose Playground</strong></a> 中找到。</p>
<h2 data-id="heading-0">阴影修改器（Shadow Modifiers）</h2>
<p>添加阴影最简单但自定义程度最低的方法是使用 <strong>Modifier.shadow()</strong>。与以往一样，它的行为依赖于<strong>基于高度的阴影</strong>，模拟来自上方的光源，阴影深度直接取决于你提供的高度值。其主要限制在于阴影始终被裁剪到可合成对象的形状内，并且你无法自定义扩展、颜色色调或偏移等属性。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Box(
    Modifier
        .size(<span class="hljs-number">100.</span>dp)
        .shadow(
            elevation = <span class="hljs-number">10.</span>dp, 
            shape = RectangleShape
        )
        .background(Color.White)
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/848a6de852dc4ec98cbf114959ffa2e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=NFnaXqKpvCMsNSlQVf6bujmEQns%3D" alt="" loading="lazy"/></p>
<p>让我们从一些新功能开始，这些功能赋予我们更强大的力量。使用 <strong>dropShadow()</strong>，我们可以在内容后面创建自定义阴影。这个修饰符是创建复杂阴影的关键，它允许对内容后面的阴影进行精细控制，使元素看起来像是被抬升了一样。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> .dropShadow(
    shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp), shadow = Shadow(
            radius = <span class="hljs-number">6.</span>dp,
            spread = <span class="hljs-number">2.</span>dp,
            color = Color.Black.copy(alpha = <span class="hljs-number">0.3f</span>),
            offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
              )
            )
 .background(
    color = Color.White, shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp)
            )
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d04d0db2e6142188d9e693cd946ce97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=f%2FRqIkoaJAUcgt5gB11w%2B0Zyg%2Bo%3D" alt="" loading="lazy"/></p>
<p>它使用 <strong>Shadow</strong> 参数，可以精确控制视觉效果。这个参数允许你使用几个关键属性来塑造阴影。 <strong>半径</strong> 决定了边缘的柔和度和扩散（模糊）程度。<strong>扩散</strong> 值控制阴影几何形状相对于可组合元素大小的扩展或收缩。最后，<strong>偏移</strong> 沿 <strong>X 轴和 Y 轴</strong>定位阴影，从而确定光源的视觉方向。结合阴影的<strong>颜色</strong>，这些属性可以实现完全自定义。</p>
<p>💡 <strong>顺序很重要：<strong>在修改器链中，<strong>dropShadow()</strong> 修改器必须出现在 <strong>background()</strong> 修改器</strong>之前</strong>，因为阴影先绘制，背景绘制在其上方。</p>
<p><strong>innerShadow()</strong> 修改器是 <strong>dropShadow()</strong> 的逆操作，它在可组合元素边界的<strong>内部</strong>创建阴影，从而实现元素凹陷或压入表面的视觉效果。与它的对应项一样，它也使用可自定义的<strong>Shadow</strong>对象，允许你使用<strong>半径</strong>、<strong>颜色</strong>、<strong>偏移</strong>和<strong>扩散</strong>来微调效果。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.background(
    Color.White, shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp)
)
.innerShadow(
    shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp), shadow = Shadow(
        radius = <span class="hljs-number">6.</span>dp,
        spread = <span class="hljs-number">2.</span>dp,
        color = Color.Black.copy(alpha = <span class="hljs-number">0.3f</span>),
        offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
    )
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc6fdb94495942e68c714abf39be614f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=jUvLmZvZqyc69AmZPBjbM9PKR5w%3D" alt="" loading="lazy"/></p>
<p>💡<strong>再次强调，顺序很重要：****innerShadow()<strong>修改器</strong>必须</strong>放在<strong>background()<strong>修改器</strong>之后</strong>。如果将其放在背景之前，内容将绘制在阴影之上，完全遮盖阴影。</p>
<p>这些修改器的真正强大之处在于它们的自定义和组合。通过叠加<strong>innerShadow()<strong>和</strong>dropShadow()</strong>，你可以创建复杂而逼真的视觉效果。我们来看一些高级用例。</p>
<h2 data-id="heading-1">高级技巧：组合和自定义阴影</h2>
<h3 data-id="heading-2">自定义阴影</h3>
<p>当你在 <strong>dropShadow()</strong> 函数中将 <strong>Brush</strong> 对象而非纯色传递给 <strong>Shadow</strong> 对象时，自定义的强大功能便显而易见。此功能允许你使用 <strong>Brush.sweepGradient</strong> 创建渐变效果。此外，无论你使用标准形状还是完全自定义的几何体，阴影始终会贴合可组合对象的形状。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.dropShadow(
    shape = MaterialShapes.Cookie12Sided.toShape(), shadow = Shadow(
        radius = <span class="hljs-number">10.</span>dp,
        spread = <span class="hljs-number">6.</span>dp,
        brush = Brush.sweepGradient(
            listOf(Color.Green, Color.Blue, Color.Yellow, Color.Green)
        ),
        offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
    )
)
.background(
    color = Color.White,
    shape = MaterialShapes.Cookie12Sided.toShape(),
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94aaa942ba8e41ea821bd59e15634086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=FYtpT6eJ2E5othJYE%2BadtHhazhE%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-3">新粗犷主义阴影</h3>
<p>这种风格完美地展现了 <strong>dropShadow()</strong> 修改器在实现极致高对比度效果方面的强大功能。要实现新粗犷主义（Neobrutalism）那种粗犷、棱角分明的视觉效果，你必须使用 <code>dropShadow()</code> 函数，并设置模糊度为零，偏移量要明显，通常还要配合粗边框。具体来说，你需要同时设置 <code>radius = 0.dp</code> 和 <code>spread = 0.dp</code> 来消除扩散，然后应用鲜艳的色彩，并设置一个明显的偏移量，从而创建出标志性的锐利轮廓。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> .dropShadow(
     shape = RoundedCornerShape(<span class="hljs-number">0.</span>dp),
     shadow = Shadow(
        radius = <span class="hljs-number">0.</span>dp,
        spread = <span class="hljs-number">0.</span>dp,
        color = dropShadowColor,
        offset = DpOffset(x = <span class="hljs-number">8.</span>dp, <span class="hljs-number">8.</span>dp)
                    )
        )
 .border(
    <span class="hljs-number">8.</span>dp, borderColor
        )
 .background(
    color = Color.White,
    shape = RoundedCornerShape(<span class="hljs-number">0.</span>dp)
        )
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f06cd7d3b604a68802ecf34b7ff63e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=%2Fh2btXZeUZ31bXwv3jXPh7uW5do%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-4">具有动效的阴影</h3>
<p>阴影并非只是静态的；它们可以制作成动画，从而提供即时的用户反馈。我们将要探索的最后一个高级技巧是创建交互式阴影，使其在特定操作（例如点击或按下）时平滑过渡。这项技术对于模拟物理交互至关重要，它能直观地确认元素的抬升或状态发生了变化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> Box(Modifier.fillMaxSize()) {
        <span class="hljs-keyword">val</span> interactionSource = remember { MutableInteractionSource() }
        <span class="hljs-keyword">val</span> isPressed <span class="hljs-keyword">by</span> interactionSource.collectIsPressedAsState()

        <span class="hljs-comment">// Create transition with pressed state</span>
        <span class="hljs-keyword">val</span> transition = updateTransition(
            targetState = isPressed, label = <span class="hljs-string">"button_press_transition"</span>
        )

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">buttonPressAnimation</span><span class="hljs-params">()</span></span> = tween&lt;T&gt;(
            durationMillis = <span class="hljs-number">400</span>, easing = Ease
        )

        <span class="hljs-comment">// Animate all properties using the transition</span>
        <span class="hljs-keyword">val</span> shadowAlpha <span class="hljs-keyword">by</span> transition.animateFloat(
            label = <span class="hljs-string">"shadow_alpha"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (pressed) <span class="hljs-number">0f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1f</span>
        }

        <span class="hljs-comment">//to animate the color</span>
        <span class="hljs-keyword">val</span> colorDropShadow <span class="hljs-keyword">by</span> transition.animateColor(
            label = <span class="hljs-string">"shadow_color"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (pressed) Color.Transparent <span class="hljs-keyword">else</span> Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>))
        }
        <span class="hljs-keyword">val</span> innerShadowAlpha <span class="hljs-keyword">by</span> transition.animateFloat(
            label = <span class="hljs-string">"inner_shadow_alpha"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (!pressed) <span class="hljs-number">0f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1f</span>
        }

        Box(
            Modifier
                .clickable(
                    interactionSource, indication = <span class="hljs-literal">null</span>
                ) {
                    <span class="hljs-comment">//...</span>
                }
                .width(<span class="hljs-number">300.</span>dp)
                .height(<span class="hljs-number">200.</span>dp)
                .align(Alignment.Center)
                .dropShadow(
                    shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp), shadow = Shadow(
                        radius = <span class="hljs-number">10.</span>dp,
                        spread = <span class="hljs-number">0.</span>dp,
                        color = Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>)),
                        offset = DpOffset(x = <span class="hljs-number">0.</span>dp, <span class="hljs-number">0.</span>dp),
                        alpha = shadowAlpha
                    )
                )
                <span class="hljs-comment">// note that the background needs to be defined before defining the inner shadow</span>
                .background(
                    color = Color(<span class="hljs-number">0xFFFFFFFF</span>), shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp)
                )
                .innerShadow(
                    shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp), shadow = Shadow(
                        radius = <span class="hljs-number">8.</span>dp,
                        spread = <span class="hljs-number">4.</span>dp,
                        color = Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>)),
                        alpha = innerShadowAlpha,
                        offset = DpOffset(x = <span class="hljs-number">0.</span>dp, <span class="hljs-number">0.</span>dp)
                    )
                )
        ) {
            <span class="hljs-comment">//...</span>
        }
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d57558daa7c40759bfe7307cf83be86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=2YM%2BP7i5yiWt8iP%2B1WVWaeOacCY%3D" alt="6.gif" loading="lazy"/></p>
<p>好的，我们已经了解了如何使用 <strong>updateTransition</strong> API 来创建流畅的交互反馈。它首先使用 <strong>MutableInteractionSource</strong> 跟踪按下状态。该状态会驱动一个 <strong>400 毫秒的过渡动画</strong>，同时为两个方向相反的阴影添加动画效果。外部的 <strong>dropShadow</strong> 在按下时会淡出，而内部的 <strong>innerShadow</strong> 则会淡入。这种双阴影动画使组件从 <strong>抬升</strong> 状态平滑过渡到 <strong>凹陷</strong> 状态，从而在用户交互时提供清晰且动态的反馈。</p>
<h2 data-id="heading-5">结论</h2>
<p>Compose 全新的阴影 API 标志着对传统 <strong>elevation</strong> 属性局限性的重大突破。它将核心概念拆分为 <strong>dropShadow()</strong> 和 <strong>innerShadow()</strong>，并赋予我们对 <strong>Shadow</strong> 对象属性的完全控制权。</p>
<p>无论你是打造简单的渐变效果、模拟物理深度，还是实现新粗野主义的高对比度视觉冲击，这种全新的自定义程度都意味着你的 <strong>UI 终于可以充分展现你设计的艺术愿景</strong>。</p>
<p>不妨尝试这些修饰符，为你的 Jetpack Compose 应用注入全新的创意维度！</p>
<p>如果你觉得这篇文章有趣，欢迎关注我，获取更多关于 Android 开发和 Jetpack Compose 的精彩内容。我会定期发布相关主题的文章。欢迎随时分享你的评论，或通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbsky.app%2Fprofile%2Fstefanoq21.bsky.social" target="_blank" title="https://bsky.app/profile/stefanoq21.bsky.social" ref="nofollow noopener noreferrer"><strong>Bluesky</strong></a> 或 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.linkedin.com%2Fin%2Fstefano-natali-q21" target="_blank" title="http://www.linkedin.com/in/stefano-natali-q21" ref="nofollow noopener noreferrer"><strong>LinkedIn</strong></a> 与我联系，进行更深入的讨论。</p>
<p>祝你开心，编程快乐！</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[N8N工作流中文转换神器！一键转中文]]></title>    <link>https://juejin.cn/post/7573670400154402868</link>    <guid>https://juejin.cn/post/7573670400154402868</guid>    <pubDate>2025-11-18T13:50:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573670400154402868" data-draft-id="7573864324713873460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" N8N工作流中文转换神器！一键转中文"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-18T13:50:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             N8N工作流中文转换神器！一键转中文
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:50:21.000Z" title="Tue Nov 18 2025 13:50:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>无论是 N8N 官方的工作流模板，还是社区开源的工作流都是英文的，这对国内用户来说是非常不友好的。</p>
<p>因此，我花了一些时间开发了一个 <strong>「N8N 工作流中文转换器」</strong>，一键将英文工作流转换为中文，先看效果吧。</p>
<p>这是原版工作流：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0c53cb00433456d92b38e0ae94d1a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=Rewf2PhF%2FDISpZT%2B9N8r%2B53n75E%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>PS：全英文的看不太懂。</p>
</blockquote>
<p>这是转换成中文的工作流：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f71798d54f4f758434516fee18ebd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=ZMIKicM57ul%2BUZFQ3Y%2FXaDLYTMo%3D" alt="" loading="lazy"/></p>
<p>这样就能让国内的用户也能轻松上手了。</p>
<h2 data-id="heading-0">实现思路</h2>
<ol>
<li>读取原本英文 N8N 模板内容。</li>
<li>将 N8N 模板内容交给大模型，并明确任务目标。大致思路是：将工作流中的英文备注全部替换成中文（将 JSON 文件中 type = stickyNote 的所有节点中的 content 翻译为中文）。</li>
<li>将转换后的中文工作流保存至本地。</li>
</ol>
<p>工作流如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0713686d68e54ac8aee85b17eadbc835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=4CU0dSu7mZ8rB8XY%2BKVgAlKBuvw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>因此，整个工作流中<strong>最核心的就是 AI Agent 的提示词了，我们需要把工作流的特征给大模型，让大模型进行中文转换</strong>。而提示词也分享给大家了，可以在下面视频中获取。</p>
</blockquote>
<h2 data-id="heading-1">视频教程</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1vay3BKEz3%2F" target="_blank" title="https://www.bilibili.com/video/BV1vay3BKEz3/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1va…</a></p>
<h2 data-id="heading-2">小结</h2>
<p>上述工作流仅支持单个文件的转换。如需批量处理，你可以使用 Java 或 Python 等语言遍历所有英文工作流，并将其传递至本工作流（可将起始节点改为 WebHook），从而实现一次性批量转换。</p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，其中包含的内容有：Spring AI、Spring AI Alibaba、LangChain4j、Dify、Coze、N8N、智能体（AI Agent）、MCP、Function Call、RAG、向量数据库、Prompt、多模态、向量数据库、嵌入模型、AI 常见面试问题等内容。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你支持游戏内显示电量、信号或时间吗？]]></title>    <link>https://juejin.cn/post/7573896789365456934</link>    <guid>https://juejin.cn/post/7573896789365456934</guid>    <pubDate>2025-11-18T12:10:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789365456934" data-draft-id="7572481101711147062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你支持游戏内显示电量、信号或时间吗？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-18T12:10:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你支持游戏内显示电量、信号或时间吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:10:20.000Z" title="Tue Nov 18 2025 12:10:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e96fc9ff08364138841c93be17b9f6d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=0eY8XMp4DISNf8bd9OjJiNIM0xg%3D" alt="素材源于网络" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，周末的时候，我看到了一个非常有趣的话题，就是我们的游戏里面，应该/不应该显示电量、信号或时间？</p>
<p><strong>不知道</strong>大家在玩王者荣耀的时候有没有这样类似的经历：当你打得正起劲的时候，勇冠三军，即将超神，突然间被一个弹框秒了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb847c09f3244c7aa3236eff5a6d672e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=GWAyx5eVBRw1%2BL15Ww0NABNFjHA%3D" alt="素材源于网络" loading="lazy"/></p>
<p><strong>没错</strong>，这个弹框就是天下苦<code>iOS</code>久矣的电池电量不足弹框。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bd10bcf22ea448b835d38668eb05a6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=7YzEK7sw102S%2FZTR5tY3f9KH0xc%3D" alt="还剩10%的电量" loading="lazy"/></p>
<p><strong>这个</strong>和显不显示电量有什么关系，难道王者荣耀没有显示电量吗？--的确没什么关系，只是吐槽一下这个电量不足的弹框。</p>
<p><strong>硬要说有关系</strong>的话，那就是电量没有显示数值，没办法提前预防弹框。</p>
<p><strong>言归正传</strong>，今天一起来聊一聊游戏内应该/不应该显示电量、信号或时间？</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">沉浸式的体验</h2>
<p><strong>首先</strong>，我们来看看反对方（游戏内不应该显示电量、信号或时间）的观点：</p>
<h3 data-id="heading-2">1.游戏的核心价值在于提供沉浸式的体验</h3>
<p><strong>经常</strong>做游戏的小伙伴都知道，我们做游戏的目的，很多时候就是为了让玩家能够“沉迷”进去游戏，产生共鸣。</p>
<p><strong>可以理解</strong>，玩家们为了得到放松，会暂时逃离现实世界，进入到游戏世界中，上演一个不一样的自己。</p>
<p><strong>但是</strong>，游戏内的电量、信号或时间，这些现实中的元素就会不断提醒玩家还在现实，没办法沉浸式代入游戏。</p>
<h3 data-id="heading-3">2.时间焦虑、电量焦虑</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a2f4546a9f4a11a3c25d75e6d376ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=wC4RxPnqXdUJJBRCrYDPes21vgk%3D" alt="图片由AI生成" loading="lazy"/></p>
<p><strong>往往</strong>游戏内不显示时间、电池的目的为了避免玩家不必要心理干扰和焦虑。</p>
<p><strong>时间的显示</strong>，会让人产生“我玩了多久了？”的焦虑；电量的显示则会引发“我还能玩多久？”的担忧。</p>
<p><strong>这些</strong>与游戏没太大关联的焦虑和担忧，很容易让玩家分心，送人头。</p>
<p><strong>游戏</strong>应该是放松和享受的，而不是另一个焦虑的来源。</p>
<h3 data-id="heading-4">3.多此一举</h3>
<p><strong>如果</strong>玩家实在是想看看电池电量、当前时间或者网络信号，顶部轻轻下滑就能看到，何必多此一举的优化呢？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/091ef8997ec4424bb3d193bc0a6e244f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=OJOPu9td4vr5PBsaC74Mnsl%2FdF4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">笔者的想法</h2>
<p><strong>我觉得</strong>游戏内显示电量、信号或时间挺好的：</p>
<h3 data-id="heading-6">1.提醒玩家</h3>
<p><strong>游戏</strong>内显示时间，目的就是为了方便提醒玩家。例如活动的开始和结束时间，某个<strong>Boss</strong>刷新的时间，或者副本的剩余时间，这些都是比较有效和玩家乐意收到的提醒。</p>
<h3 data-id="heading-7">2.转移压力</h3>
<p><strong>网络信号信息</strong>，当玩家，网络状态见红，或者高延迟时，那么玩家能够意识到自己的网络环境可能不太好，假如没有这个显示，那么玩家可能就对游戏开喷了，这是一种常见的转移压力手段。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db54a941f60842ee9c738018599b988f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=z2AmnHmHAJ4FEpa%2FH6Gby8L8Um8%3D" alt="素材源于网络" loading="lazy"/></p>
<h3 data-id="heading-8">3.心理预防</h3>
<p><strong>正如</strong>开篇的例子，假如游戏内有电池电量预防，那么我会在将要没电的时候去充电，或者避免一些重要的操作，因电量不足造成损失。例如“<strong>等等再开团，等我先充个电！</strong>”</p>
<h2 data-id="heading-9">聊着聊着又要上例子了</h2>
<p><strong>既然如此</strong>，我们在Cocos游戏开发中，如何显示电量、信号和时间信息呢？下面一起来看个例子。</p>
<h3 data-id="heading-10">1.相关API</h3>
<ul>
<li>
<p><strong>获取网络类型</strong>：常用于优化弱网体验以及网络调优，通过接口我们可以判断当前是是否连接<code>wifi</code>，是否是弱网环境。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aafa791ef7f41a3aed1697fc5e1f669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=XtO3hetVzSKnOV9vwteBLi0WZSA%3D" alt="来源于微信官方文档" loading="lazy"/></p>
</li>
<li>
<p><strong>获取设备电池信息</strong>：常用于获取设备电池信息，通过接口我们可以获取当前电量，是否正在充电，是否处于省电模式。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd0d54197e264ce19ba40cbfd7506906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=aniq7KwFuMTrDpfzAC3OCa5r5cc%3D" alt="来源于微信官方文档" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-11">2.资源准备</h3>
<p><strong>老规矩</strong>，先找<code>AI</code>搭子搞几个<code>Wifi</code>、<code>4G</code>信号、电池资源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171a80470c04407f84766978065a636c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=n1QUI%2F2VtxzsPZFfEJGqJMblu7c%3D" alt="" loading="lazy"/></p>
<p><strong>然后</strong>在场景中简单拼接一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9da2f87ba1f04f338d9bc6fad316811d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=5qH%2BOltFPq3GzZeohr9UDe6SAVg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">3.写代码</h3>
<p><strong>首先</strong>创建一个<code>Main</code>脚本，因为本次演示环境是微信小游戏，所以我们声明一下<code>declare const wx: any; </code>使用微信的<code>API</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbdd1efaef5c4bdba53382129ad03436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=pH5YIJ%2BB7VzghRa3aWxQyJ2vjhw%3D" alt="" loading="lazy"/></p>
<p><strong>定时</strong>获取信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b383b418c1d4fb7b533cdd771ea9f25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=m9n03HHUXp4CjkTs%2BjOMocAzY6U%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aa50929ea62463c9dba034514b2a2c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=mruSBowH6aAyCsyzfs4kMIPQ%2FSA%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>网络状态，由于延迟数据的判断涉及服务端，小伙伴们可以通过心跳包等方式计算，笔者这里不做详细演示。</p>
<p><strong>甚至可以使用<code>Math.random</code>，简单快捷，建议不要学</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e29d0ef7e25490b8d1d67c927938a36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=wbgbKGXW4ckcY%2FcYX5EcudVhafE%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>电池信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f887bc8854b416988a75a9c299b906c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=1t8mIEe0JJjlCNmQJXEoQBAXdq4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">4.效果演示</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/649c3290bd124071bbb8df6286764c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=OorzOoaxhCkrw6yq5k%2F9ogjeIoY%3D" alt="" loading="lazy"/></p>
<p><strong>Wifi</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f908c07c90c84b789eb069ae8cf5f6a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=0i6pGd6zMAzHQscy6fNobcsdeNI%3D" alt="" loading="lazy"/></p>
<p><strong>4G</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7f8ce9b573470496bd04d2922d5d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=2nwP5tkjvs7VlQTsn4B7XouTs70%3D" alt="" loading="lazy"/></p>
<p><strong>正在充电</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17f7dd7eb009477da3ef9b5d9294271e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=RoAGPGwYDk6e5aIPD43RG2rZx%2B0%3D" alt="" loading="lazy"/></p>
<p><strong>不在充电</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8c7b001e1754eaeb855da0b3d428765~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=2NmYgnjAm%2BxdcvsT38H3AN7J1JI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">结语</h2>
<p><strong>看到这里</strong>的小伙伴们，你们支持游戏内显示电量、信号或时间吗？</p>
<p>本文<strong>源工程</strong>可通过<strong>私信</strong>发送 <strong>TopBar</strong> 获取。</p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方绿色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速构建一个基础、现代化的 WinForm 管理系统]]></title>    <link>https://juejin.cn/post/7573886599433584691</link>    <guid>https://juejin.cn/post/7573886599433584691</guid>    <pubDate>2025-11-18T12:15:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433584691" data-draft-id="7573890735578759178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速构建一个基础、现代化的 WinForm 管理系统"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-11-18T12:15:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速构建一个基础、现代化的 WinForm 管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:15:53.000Z" title="Tue Nov 18 2025 12:15:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前段时间有小伙伴在后台留言问：<code>有没有好用的 WinForm 管理系统?</code>今天大姚给大家分享一个基于 AntdUI 构建的 WinForm 管理系统，不需要我们写一行代码既能快速构建一个基础、现代化的 WinForm 管理系统。</p>
<h2 data-id="heading-1">项目介绍</h2>
<p>WenAntdUI-Admin 是一个基于 AntdUI 构建、基础、现代化的 WinForm 管理系统，基于 Apache-2.0 License 开源，项目包含：AOT发布、字典管理、用户管理、菜单管理、权限管理、用户设置等功能。内部封装了很多常用组件，包含AdminTable等通用组件。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fe43W9dqTWnmwI2STQREolw" target="_blank" title="https://mp.weixin.qq.com/s/e43W9dqTWnmwI2STQREolw" ref="nofollow noopener noreferrer">DotNetGuide 突破了 9.5K + Star，一份全面的C#/.NET/.NET Core学习、工作、面试指南知识库！</a></li>
</ul>
<h2 data-id="heading-2">AntdUI 介绍</h2>
<p>AntdUI 是一款基于 Ant Design 设计语言的开源（Apache License） WinForm UI 界面库，致力于将现代美观的前端设计风格带入到桌面应用程序中。采用纯GDI绘图，不需任何图片资源，全面支持AOT，最低兼容 .NET Framework 4.0。</p>
<ul>
<li><strong>详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FH46V1EZ7DCduUeS9j7wO0w" target="_blank" title="https://mp.weixin.qq.com/s/H46V1EZ7DCduUeS9j7wO0w" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/H46V1EZ7D…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e49a776a70450b97e49626991e1a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=zevIe9UueOQQFvJO5ObuYqUZiAk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">功能模块</h2>

































<table><thead><tr><th>功能</th><th>状态</th></tr></thead><tbody><tr><td>AOT发布</td><td>✅</td></tr><tr><td>字典管理</td><td>✅</td></tr><tr><td>用户管理</td><td>✅</td></tr><tr><td>菜单管理</td><td>✅</td></tr><tr><td>权限管理</td><td>✅</td></tr><tr><td>用户设置</td><td>✅</td></tr></tbody></table>
<h2 data-id="heading-4">项目源代码</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99946371293348eeb790d7848fb9f13d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=Vq5UtVVTxF58SuZdNzbK5VZru4Q%3D" alt="" loading="lazy"/></p>
<p><strong>项目分层介绍：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239898acaebd4ca78514505431ffd1c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=LkgxO2TNK3MFuU1YE7QkUMVv1WU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">初始化 WinForm 管理系统</h2>
<p>首先我们设置 <code>WenAntdUI.Demo</code> 为启动项目，首次运行会自动初始化 <code>SQLite</code> 数据库，并且在运行目录下创建一个 <code>data.db</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bceb1df19bc24408860001c1cf8bff88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=WXYtMlyLExZshop8lPLSoa%2BUCtM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a32e9f23af3424293810f68d9176249~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=haW70gAtBN9cuc3g3cbU98wXlJY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/693d5cacd8554510958a16d6a2b30b66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=Iw4ViJVY%2FbV2foacYdYnUdLTPeg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">运行效果演示</h2>
<blockquote>
<p>账户：admin 密码：admin</p>
</blockquote>
<h3 data-id="heading-7">用户登录</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f2631fd417c47529247cf38359194a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=ShyJ6c3f5MiA9E%2FExvy0UoOH9Pc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">图表预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5263d96ef6d744afbc20b34a52fc05b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=KIllHGEhPKBQx%2BtDvOlstJ%2FvILw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">字典管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d1dfb3b246e4914ae0c8a822082a681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=wqONinkleI0ZPiMG6KmsRADPQ5g%3D" alt="" loading="lazy"/></p>
<p><img src="" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">菜单管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ce3a87fb55412385b3cc651b2e880a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=VBkiMKlcYvRWGmqG4r6HeYwCh4Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93f09742a6934640baadcf9a6d57a122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=UsfguZ9CyZQriJohYf4Xna2lMYw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">角色管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e1b137eaa74b3d8c46edeb737c9d0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=vUunICMqG75LDJRk8xBAWsfrgqE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5354c4e7b4b24307bdcd2a6bc9e57efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=1tOe%2F4%2BFejDg8jxiZZzjVXarGb4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">用户管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f6c84fae2a40d5bcd68191f6f7efd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=qQ%2FsefG2fw1n77RrwJ1XAmLTq0I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1b598486f4e480eabccea4fd371991c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=1MD0O302dgtrhjd48Y1qXQ3y1hM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">系统本地设置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7249b7b7c784b4a981fc23c081818e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=7DztIwyrPuh1bg6zaQIXjA7by3M%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">系统主题切换</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b701b357ed54684b1ff0e01e452bf59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=E7UOYOKqmC8CSdx0o4AMP8k%2B9og%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FAntdUI%2Fwen-antd-ui" target="_blank" title="https://gitee.com/AntdUI/wen-antd-ui" ref="nofollow noopener noreferrer">gitee.com/AntdUI/wen-…</a></li>
</ul>
<h2 data-id="heading-16">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂：localhost和局域网 IP 的核心区别与使用场景]]></title>    <link>https://juejin.cn/post/7573890735578857482</link>    <guid>https://juejin.cn/post/7573890735578857482</guid>    <pubDate>2025-11-18T12:38:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735578857482" data-draft-id="7573899782802833454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂：localhost和局域网 IP 的核心区别与使用场景"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-18T12:38:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂：localhost和局域网 IP 的核心区别与使用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:38:34.000Z" title="Tue Nov 18 2025 12:38:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端项目运行时给出的 <code>localhost:3000</code> 和 <code>192.168.1.41:3000</code> 本质上指向同一项目服务，但适用场景和访问范围不同，具体区别及选择建议如下：</p>
<h3 data-id="heading-0">一、核心区别</h3>

























<table><thead><tr><th>维度</th><th><code>localhost:3000</code></th><th><code>192.168.1.41:3000</code></th></tr></thead><tbody><tr><td><strong>指向对象</strong></td><td>仅指向「当前运行项目的本机」（通过本地回环地址 <code>127.0.0.1</code> 实现）</td><td>指向本机在局域网中的 IP 地址（<code>192.168.1.41</code> 是本机在路由器分配的私有 IP）</td></tr><tr><td><strong>访问范围</strong></td><td>只能在「本机」上访问（其他设备无法通过 <code>localhost</code> 访问）</td><td>同一局域网内的所有设备（如手机、其他电脑、平板）均可访问</td></tr><tr><td><strong>依赖条件</strong></td><td>无需网络（断网也能访问），仅依赖本机服务是否启动</td><td>需保证本机和其他设备在同一局域网（如同一 WiFi / 网线），且本机防火墙允许端口访问</td></tr></tbody></table>
<h3 data-id="heading-1">二、选择建议：根据场景决定</h3>
<ol>
<li>
<p><strong>开发调试时优先用 <code>localhost:3000</code></strong></p>
<ul>
<li>优势：访问速度更快（本地回环不经过网络路由），且不受局域网波动影响（断网也能工作），更稳定。</li>
<li>适用场景：自己在电脑上写代码、调试功能、修改样式等。</li>
</ul>
</li>
<li>
<p><strong>需要跨设备测试时用 <code>192.168.1.41:3000</code></strong></p>
<ul>
<li>优势：可以在手机、平板或同事的电脑上访问你的项目，验证响应式布局、多设备兼容性等。</li>
<li>适用场景：测试移动端显示效果、让团队成员临时查看项目进度、跨设备联调（如手机扫码测试支付流程）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-2">三、注意事项</h3>
<ul>
<li>若用局域网地址访问失败，可能是本机防火墙阻止了 <code>3000</code> 端口，或项目配置限制了仅本地访问（部分框架需手动开启局域网访问权限）。</li>
<li>局域网 IP 可能会变化（路由器重启可能重新分配），若后续访问失败，可重新运行项目获取新的局域网地址。</li>
</ul>
<p>总之，日常开发用 <code>localhost</code> 更高效，跨设备测试时再用局域网 IP 即可。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了]]></title>    <link>https://juejin.cn/post/7573680361991077928</link>    <guid>https://juejin.cn/post/7573680361991077928</guid>    <pubDate>2025-11-18T12:38:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573680361991077928" data-draft-id="7573680361991061544" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了"/> <meta itemprop="keywords" content="程序员,前端,后端"/> <meta itemprop="datePublished" content="2025-11-18T12:38:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摆烂工程师"/> <meta itemprop="url" content="https://juejin.cn/user/1552933235470589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1552933235470589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摆烂工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:38:15.000Z" title="Tue Nov 18 2025 12:38:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天 Cloudeflare 挂了，其实很多人都“躺枪”了。</p>
<p>当你刷着社交媒体、打开博客、访问网站的时候，发现页面卡住、提示 500 错误、或者直接 “访问失败”，这不是你的网线出了问题，而是男主角登场了：Cloudflare。</p>
<p>根据最新报道，Cloudflare 的全球网络正在遭遇技术障碍——多个平台、网站及服务一起受波及，连 ChatGPT、推特、Cladude 等等都躲不过～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c78565b02d974d7a86675ed8c8215ff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764074295&amp;x-signature=8hOlbc%2FzHf321q%2BRgkPQxNC%2FO0w%3D" alt="" loading="lazy"/></p>
<p>为什么“中招”这么多人？因为 Cloudflare 本身就是 “中枢”之一。它负责的网站加速、内容分发、DNS解析、安全防护——换句话说，它帮成千上万的网站在世界各地更快速、更安全地“上线”。而当这个“枢纽”出现问题，连锁反应几乎瞬时扩散。</p>
<p>比如，ChatGPT 就被用户报告 “请取消阻止 challenges.cloudflare.com 后继续”。 再比如，一些博客、个人网站甚至客户端服务，都可能因为 Cloudflare 的网络中断而直接“打不开网页”或“访问延迟严重”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b000b17a303646ffaabffd5bc84a5582~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764074295&amp;x-signature=6AukcRAnkk99%2FoYRct664oYMpMQ%3D" alt="" loading="lazy"/></p>
<p>这提醒我们两个现实：</p>
<ol>
<li><strong>互联网依赖度极高</strong>。我们平时并不觉得连接了多少“中介服务”，但其实你访问的某个网站，背后很可能借助了 Cloudflare 这样的“隐形网络服务商”。当它出问题，你我都中招。</li>
<li><strong>风险并非只在“黑客”或“攻击”层面</strong>。很多时候，出问题的是基础网络设施、节点故障、数据中心切换、配置误操作……不是谁“故意”要让你上不了网，而是“链条”中某一环出了状况。</li>
</ol>
<p>那么，对普通用户来说，遇到这种情况怎么办？简单三步：</p>
<ul>
<li>放松——不是你的设备、不是你犯错了，只是他们的服务暂时“挂了”。</li>
<li>刷新状态页面、社交公告。Cloudflare 官方在其状态页已说明：他们“意识到问题，正在调查并缓解中”。</li>
<li>耐心等待。此类基础服务恢复可能需要几分钟也可能更久。若你的网站也挂了，建议先做降级处理或通知用户“正在恢复中”。</li>
</ul>
<p>最后，作为网站运营者或内容创造者，也建议从今天这个事件里学到一点：<strong>依赖越深，风险越集中</strong>。即便使用云服务、CDN加速、防火墙保护，也不应忽视备用方案、冗余部署、用户提示机制。因为当“枢纽”失效，你依赖它的一切就可能“掉链子”。</p>
<p><strong>目前大部分服务都恢复了～ 如果你的服务还没有恢复，可能是地域性的问题，出去散散步，回来之后差不多就恢复了。</strong></p>
<p>总之，今天互联网“肠道”里出现一个短暂的“堵塞”，提醒我们：在这个看似“无处不在”的网络时代，也正是依赖与隐患并存。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[API无缝升级方案：从推模式到拉模式的架构演进]]></title>    <link>https://juejin.cn/post/7573900332636880906</link>    <guid>https://juejin.cn/post/7573900332636880906</guid>    <pubDate>2025-11-18T12:34:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900332636880906" data-draft-id="7573890735578841098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="API无缝升级方案：从推模式到拉模式的架构演进"/> <meta itemprop="keywords" content="后端,GraphQL,RESTful"/> <meta itemprop="datePublished" content="2025-11-18T12:34:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            API无缝升级方案：从推模式到拉模式的架构演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:34:25.000Z" title="Tue Nov 18 2025 12:34:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>知乎上有人问了一个问题：<strong>Java微服务API版本兼容如何实现平滑升级</strong>？</p>
<p>在微服务架构中，服务频繁迭代导致API版本差异增大，而客户端（如App、Web前端）的升级节奏往往滞后，这常常引发兼容性问题，甚至导致线上故障。常见的版本控制策略，比如在URL路径中加版本号（<code>/v1/user</code>）或使用请求头区分版本，虽然能明确区分不同版本，但也带来了维护多个版本接口的沉重成本，并增加了客户端的适配难度。</p>
<p>本文将分析这一问题的根源所在，并介绍 <strong>NopGraphQL 框架如何创新地解决这一问题</strong>。</p>
<h2 data-id="heading-0">1. 问题根源：推模式导致的共变问题</h2>
<p>REST 本质上是“推模式”，在理论层面必然导致<strong>共变问题</strong>。
REST API 的设计范式是由服务端预先定义每个端点返回的完整数据结构（DTO）。客户端被动接收这些数据，无法控制内容粒度。这种“服务端推送、客户端全盘接受”的模型，在信息论上属于 <strong>封闭输出系统</strong>。</p>
<p>一旦服务端对返回结构做出变更——无论是新增字段、修改嵌套结构，还是调整字段语义——所有消费该接口的客户端都必须同步适配。这就形成了典型的 <strong>共变耦合</strong>（covariance coupling）：服务端和客户端被迫在版本上强绑定，违背了微服务“独立演进”的核心原则。</p>
<p>即使采用 URL 路径（<code>/v1/user</code>）或 Accept Header 等版本控制手段，也只是将耦合显式化，并未消除根本问题：<strong>每个版本仍是一个刚性、全量的数据契约</strong>，维护成本随版本数线性甚至指数增长。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// REST接口的刚性数据契约</span>
<span class="hljs-meta">@GetMapping("/api/v1/users/{id}")</span>
<span class="hljs-keyword">public</span> UserDTOV1 <span class="hljs-title function_">getUserV1</span><span class="hljs-params">()</span> {  <span class="hljs-comment">// 版本1的固定结构</span>
  <span class="hljs-keyword">return</span> userService.getUser();
}

<span class="hljs-meta">@GetMapping("/api/v2/users/{id}")</span>
<span class="hljs-keyword">public</span> UserDTOV2 <span class="hljs-title function_">getUserV2</span><span class="hljs-params">()</span> {  <span class="hljs-comment">// 版本2的固定结构</span>
  <span class="hljs-keyword">return</span> userService.getUser();
}
<span class="hljs-comment">// 每个版本都是完整的DTO，变更需要新接口</span>
</code></pre>
<p>更糟糕的是，当 <code>UserDTO</code> 被嵌入到多个不同 API 的响应中时（如订单详情、审批流、通知中心），它的任何变动都将引发<strong>涟漪效应</strong>，导致大量接口连锁修改，形成典型的“组合爆炸”。</p>
<h2 data-id="heading-1">2. 解决方案：反转信息流向，转向拉模式</h2>
<p>GraphQL 提出了一种颠覆性的思路：<strong>由客户端声明所需字段，服务端按需返回</strong>。这种“客户端驱动的拉取模型”天然支持 <strong>渐进式演进</strong>，其核心在于<strong>解耦了服务端信息完整性与客户端消费粒度之间的强绑定</strong>。</p>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-comment"># 2018年客户端 - 仅请求基础字段</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment"># 2020年客户端 - 开始使用新增的安全字段</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    twoFactorEnabled  <span class="hljs-comment"># 新增字段，老客户端不受影响</span>
    lastLoginIp
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment"># 2023年客户端 - 使用完整功能集</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    twoFactorEnabled
    lastLoginIp
    preferences <span class="hljs-punctuation">{</span>     <span class="hljs-comment"># 新增嵌套对象</span>
      theme
      language
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>在传统 REST 的“推模式”中，服务端必须为每个接口预定义一个固定的响应结构。这意味着：</p>
<ul>
<li>服务端和客户端对“什么是有效数据”的理解必须完全一致；</li>
<li>一旦服务端模型扩展（例如用户对象新增 <code>twoFactorEnabled</code> 字段），要么强行让所有客户端升级以处理新字段，要么维护多个版本的 DTO 和端点。</li>
</ul>
<p>而拉取模型彻底改变了这一范式：</p>
<ul>
<li><strong>服务端作为完整、权威的信息源，持续演进其领域模型</strong>；</li>
<li><strong>客户端则根据自身场景，仅拉取当前所需的字段子集</strong>。</li>
</ul>
<h3 data-id="heading-2">GraphQL 拉模式的核心优势：</h3>
<ul>
<li>新增字段对旧客户端不可见；</li>
<li>字段删除可通过废弃标记逐步下线；</li>
<li>嵌套查询避免多次往返，同时保持细粒度控制。</li>
</ul>
<p>然而，在现有 Java 微服务体系中全面切换到 GraphQL 协议面临显著障碍：</p>
<ul>
<li>需要重构网关、鉴权、限流、监控等基础设施；</li>
<li>客户端（尤其是移动端或第三方）需重写调用逻辑；</li>
<li>团队需掌握新语法、类型系统和性能调优模式；</li>
<li>与 gRPC、消息队列等其他通信方式难以统一。</li>
</ul>
<p>因此，尽管 GraphQL 思想先进，但<strong>协议绑定限制了其在存量系统中的落地效率</strong>。</p>
<h2 data-id="heading-3">3. 创新方案：NopGraphQL 的多协议通用框架</h2>
<p>NopGraphQL 的关键创新在于：<strong>将 GraphQL 从一种传输协议，升维为通用的信息操作引擎</strong>。它提取 GraphQL 的核心思想——“字段级动态选择”——并将其泛化为可跨协议复用的能力。</p>
<p>在 Nop 中，同一个服务函数可以同时暴露为：</p>
<ul>
<li>REST 接口（通过 <code>@selection=name,email</code> 查询参数）</li>
<li>GraphQL 查询</li>
<li>gRPC 方法</li>
<li>Kafka 消息处理器</li>
<li>批处理任务入口</li>
</ul>
<p>开发者只需编写一次业务逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@BizModel("NopAuthUser")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBizModel</span> {
    <span class="hljs-meta">@BizQuery</span>
    <span class="hljs-keyword">public</span> NopAuthUser <span class="hljs-title function_">getUser</span><span class="hljs-params">(
        <span class="hljs-meta">@Name("id")</span> String id,
        FieldSelectionBean selection  // 自动注入客户端字段选择信息
    )</span> {
        <span class="hljs-comment">// 同一业务逻辑，多协议复用</span>
        <span class="hljs-type">NopAuthUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> dao.getById(id);

        <span class="hljs-comment">// 可选：根据 selection 决定是否加载 expensive 字段</span>
        <span class="hljs-keyword">if</span> (selection != <span class="hljs-literal">null</span> &amp;&amp; selection.hasField(<span class="hljs-string">"totalOrders"</span>)) {
            user.setTotalOrders(orderDao.countByUserId(id));
        }

        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<p>即可通过多种协议调用。</p>
<h3 data-id="heading-4">GraphQL 协议调用：</h3>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  NopAuthUser__get<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    roles <span class="hljs-punctuation">{</span>
      name
      permissions
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">REST 协议调用：</h3>
<pre><code class="hljs language-http" lang="http">GET /r/NopAuthUser__get?id=123&amp;@selection=id,name,email,roles{name,permissions}
</code></pre>
<p>NopGraphQL 通过统一的协议适配层，将不同协议的请求转换为标准化的内部表示：</p>
<pre><code class="hljs language-css" lang="css">GraphQL请求 → GraphQL适配器 → 统一服务调用引擎 → 业务函数
<span class="hljs-attribute">REST</span>请求   → <span class="hljs-attribute">REST</span>适配器    → 统一服务调用引擎 → 业务函数
gRPC请求   → gRPC适配器    → 统一服务调用引擎 → 业务函数
</code></pre>
<p>业务逻辑完全与协议解耦。开发者只需关注领域模型和字段加载逻辑，协议适配由框架自动完成。这使得团队可以在不改变现有调用链的前提下，<strong>渐进引入“拉模式”能力</strong>。</p>
<h2 data-id="heading-6">4. 核心机制：字段选择与默认策略</h2>
<p>NopGraphQL 在字段返回策略上做了精细化设计，对 GraphQL 进行了简化，并使其自然映射到 REST 协议。</p>
<ul>
<li>每个实体类型可定义一个默认字段集合 <code>F_defaults</code>（例如 <code>id, name, status</code>）；</li>
<li>当客户端未显式传入 <code>@selection</code> 时，自动返回 <code>F_defaults</code> 中的字段，行为等价于传统 REST，保障向后兼容；</li>
<li><strong>所有新增字段默认标记为 <code>lazy</code></strong>：除非客户端在 <code>@selection</code> 中明确请求，否则不会加载也不会返回；</li>
<li>客户端可通过 <code>...F_defaults</code> 语法快速继承默认字段集，并叠加新增字段。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-http" lang="http">GET /r/NopAuthUser__get?id=123&amp;@selection=...F_defaults,avatarUrl,roles{name}
</code></pre>
<p>表示：“返回所有默认字段 + <code>avatarUrl</code> + <code>roles</code> 的 <code>name</code> 子字段”。</p>
<blockquote>
<p>💡 <strong>Lazy 字段的实现</strong>：在 XMeta 元模型中，字段可声明为 <code>&lt;prop name="avatarUrl" lazy="true"&gt;</code>，并且可以通过 <code>@BizLoader</code> 注解实现批量加载，避免 N+1 问题。</p>
</blockquote>
<p>这种方式既保留了 REST 的简单性，又赋予了 GraphQL 的灵活性。服务端可以自由扩展模型，而客户端按需消费，<strong>彻底解耦了 API 的演进节奏</strong>。</p>
<h3 data-id="heading-7">结语</h3>
<p>API 版本兼容的本质，不是管理多个版本，而是<strong>消除不必要的耦合</strong>。
NopGraphQL 通过将 GraphQL 的“拉取思想”从协议中剥离，并以 <code>@selection</code> + <code>F_defaults</code> + <code>lazy</code> 字段机制落地到多协议场景，为 Java 微服务提供了一条 <strong>低侵入、高兼容、易演进</strong> 的平滑升级路径。</p>
<p>未来，后端不应再是一堆僵化的 REST 端点，而应是一个<strong>活的信息空间</strong>——客户端可以像查询数据库一样，精确、安全、高效地从中拉取所需知识。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用LangSmith评估智能体]]></title>    <link>https://juejin.cn/post/7573679820632719395</link>    <guid>https://juejin.cn/post/7573679820632719395</guid>    <pubDate>2025-11-18T09:21:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573679820632719395" data-draft-id="7573670400153714740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用LangSmith评估智能体"/> <meta itemprop="keywords" content="Agent,LangChain,Python"/> <meta itemprop="datePublished" content="2025-11-18T09:21:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用LangSmith评估智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:21:29.000Z" title="Tue Nov 18 2025 09:21:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>评估（Evaluations）是衡量大模型（LLM）应用程序性能的一种量化方式。LLM 的行为可能存在不确定性，即便对提示词、模型或输入做出微小调整，也可能对结果产生显著影响。而评估能够提供一种结构化方法，帮助识别故障、对比版本，并构建更可靠的人工智能应用程序。</p>
<p>在LangSmith中执行评估需要三个关键组件：</p>
<ul>
<li>数据集（Dataset）：一组测试输入（可选包含预期输出）。</li>
<li>目标函数（Target function）：你希望测试的应用程序部分 —— 可能是使用新提示词的单次LLM调用、某个模块，或是整个工作流程。</li>
<li>评估器（Evaluators）：为目标函数的输出打分的函数。</li>
</ul>
<p>本文将使用LangSmith SDK带你完成一次基础评估（验证LLM 响应的正确性）。</p>
<h2 data-id="heading-0">准备</h2>
<ul>
<li>一个 LangSmith 账号：可在 smith.langchain.com 注册或登录。</li>
<li>一个 LangSmith API 密钥：请参考《创建 API 密钥指南》操作。</li>
<li>一个 OpenAI API 密钥：可在 OpenAI 控制台（dashboard）中生成</li>
</ul>
<h2 data-id="heading-1">安装依赖</h2>
<pre><code class="hljs language-bash" lang="bash">pip install -U langsmith openevals openai
</code></pre>
<h2 data-id="heading-2">设置环境变量</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LANGSMITH_TRACING=<span class="hljs-literal">true</span>
<span class="hljs-built_in">export</span> LANGSMITH_API_KEY=<span class="hljs-string">"&lt;your-langsmith-api-key&gt;"</span>
<span class="hljs-built_in">export</span> OPENAI_API_KEY=<span class="hljs-string">"&lt;your-openai-api-key&gt;"</span>
<span class="hljs-built_in">export</span> LANGSMITH_WORKSPACE_ID=<span class="hljs-string">"&lt;your-workspace-id&gt;"</span>
</code></pre>
<h2 data-id="heading-3">创建数据集</h2>
<p>创建一个文件并添加以下代码，代码将实现以下功能：</p>
<ul>
<li>导入 Client 以连接 LangSmith。</li>
<li>创建一个数据集。</li>
<li>定义示例输入和输出。</li>
<li>在 LangSmith 中关联输入输出对与该数据集，以便它们能在评估中使用。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># dataset.py</span>
<span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    client = Client()

    <span class="hljs-comment"># Programmatically create a dataset in LangSmith</span>
    dataset = client.create_dataset(
        dataset_name=<span class="hljs-string">"Sample dataset"</span>,
        description=<span class="hljs-string">"A sample dataset in LangSmith."</span>
    )

    <span class="hljs-comment"># Create examples</span>
    examples = [
        {
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"question"</span>: <span class="hljs-string">"Which country is Mount Kilimanjaro located in?"</span>},
            <span class="hljs-string">"outputs"</span>: {<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Mount Kilimanjaro is located in Tanzania."</span>},
        },
        {
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"question"</span>: <span class="hljs-string">"What is Earth's lowest point?"</span>},
            <span class="hljs-string">"outputs"</span>: {<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Earth's lowest point is The Dead Sea."</span>},
        },
    ]

    <span class="hljs-comment"># Add examples to the dataset</span>
    client.create_examples(dataset_id=dataset.<span class="hljs-built_in">id</span>, examples=examples)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Created dataset:"</span>, dataset.name)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p>运行文件以创建数据集：</p>
<pre><code class="hljs language-bash" lang="bash">python dataset.py
</code></pre>
<h2 data-id="heading-4">创建目标函数</h2>
<p>定义一个包含待评估内容的目标函数（target function）。在本文中，将定义一个目标函数，该函数包含一次用于回答问题的大模型调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># eval.py</span>
<span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}
</code></pre>
<h2 data-id="heading-5">定义评估器</h2>
<p>在本步骤中，你需要告知LangSmith如何为应用程序生成的答案评分。从openevals中导入一个预构建的评估提示词（CORRECTNESS_PROMPT），以及一个辅助工具 —— 该工具会将其封装为 “以 LLM 作为评判者” 的评估器，此评估器将为应用程序的输出打分。
该评估器会对以下三类信息进行对比：
输入（inputs）：传入目标函数的内容（例如，问题文本）。
输出（outputs）：目标函数返回的内容（例如，模型生成的答案）。
参考输出（reference_outputs）：在创建数据集时，你为每个数据集示例附加的基准真值答案（即 “标准答案”）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">from</span> openevals.llm <span class="hljs-keyword">import</span> create_llm_as_judge
<span class="hljs-keyword">from</span> openevals.prompts <span class="hljs-keyword">import</span> CORRECTNESS_PROMPT

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correctness_evaluator</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span>, outputs: <span class="hljs-built_in">dict</span>, reference_outputs: <span class="hljs-built_in">dict</span></span>):
    evaluator = create_llm_as_judge(
        prompt=CORRECTNESS_PROMPT,
        model=<span class="hljs-string">"openai:o3-mini"</span>,
        feedback_key=<span class="hljs-string">"correctness"</span>,
    )
    <span class="hljs-keyword">return</span> evaluator(
        inputs=inputs,
        outputs=outputs,
        reference_outputs=reference_outputs
    )
</code></pre>
<h2 data-id="heading-6">运行评估实验</h2>
<p>若要运行评估实验，需调用 evaluate(...) 函数，该函数将执行以下操作：</p>
<ul>
<li>从数据集里提取示例数据。</li>
<li>将每个示例的输入传递至目标函数。</li>
<li>收集输出结果（即模型生成的答案）。</li>
<li>将输出结果与参考输出一同传递至评估器。</li>
<li>在LangSmith中以实验形式记录所有结果，以便你在界面（UI）中查看。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">from</span> openevals.llm <span class="hljs-keyword">import</span> create_llm_as_judge
<span class="hljs-keyword">from</span> openevals.prompts <span class="hljs-keyword">import</span> CORRECTNESS_PROMPT

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correctness_evaluator</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span>, outputs: <span class="hljs-built_in">dict</span>, reference_outputs: <span class="hljs-built_in">dict</span></span>):
    evaluator = create_llm_as_judge(
        prompt=CORRECTNESS_PROMPT,
        model=<span class="hljs-string">"openai:o3-mini"</span>,
        feedback_key=<span class="hljs-string">"correctness"</span>,
    )
    <span class="hljs-keyword">return</span> evaluator(
        inputs=inputs,
        outputs=outputs,
        reference_outputs=reference_outputs
    )

<span class="hljs-comment"># After running the evaluation, a link will be provided to view the results in langsmith</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    client = Client()
    experiment_results = client.evaluate(
        target,
        data=<span class="hljs-string">"Sample dataset"</span>,
        evaluators=[
            correctness_evaluator,
            <span class="hljs-comment"># can add multiple evaluators here</span>
        ],
        experiment_prefix=<span class="hljs-string">"first-eval-in-langsmith"</span>,
        max_concurrency=<span class="hljs-number">2</span>,
    )
    <span class="hljs-built_in">print</span>(experiment_results)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 入门实战：音乐专辑管理 API]]></title>    <link>https://juejin.cn/post/7573899782802587694</link>    <guid>https://juejin.cn/post/7573899782802587694</guid>    <pubDate>2025-11-18T10:11:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802587694" data-draft-id="7573988811916148786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 入门实战：音乐专辑管理 API"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T10:11:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OlahOlah"/> <meta itemprop="url" content="https://juejin.cn/user/1576016232062667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 入门实战：音乐专辑管理 API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576016232062667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OlahOlah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:11:17.000Z" title="Tue Nov 18 2025 10:11:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为 Go 新手，光看语法很难真正掌握编程。通过实践一个小项目，你可以同时了解 <strong>Go 基础语法、数据库操作和 Web 开发</strong>。</p>
<h2 data-id="heading-0">数据库设计</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> music_store;
USE music_store;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> albums (
    id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    artist <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> albums (id, title, artist, price) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'1'</span>, <span class="hljs-string">'Blue Train'</span>, <span class="hljs-string">'John Coltrane'</span>, <span class="hljs-number">56.99</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'Jeru'</span>, <span class="hljs-string">'Gerry Mulligan'</span>, <span class="hljs-number">17.99</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'Sarah Vaughan and Clifford Brown'</span>, <span class="hljs-string">'Sarah Vaughan'</span>, <span class="hljs-number">39.99</span>);
</code></pre>
<h2 data-id="heading-1">代码示例</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"net/http"</span>

	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
	<span class="hljs-string">"gorm.io/driver/mysql"</span>
	<span class="hljs-string">"gorm.io/gorm"</span>
)

<span class="hljs-comment">// Album 定义音乐专辑的数据模型</span>
<span class="hljs-keyword">type</span> Album <span class="hljs-keyword">struct</span> {
	ID     <span class="hljs-type">string</span>  <span class="hljs-string">`json:"id" gorm:"primaryKey"`</span> <span class="hljs-comment">// 主键</span>
	Title  <span class="hljs-type">string</span>  <span class="hljs-string">`json:"title"`</span>                <span class="hljs-comment">// 专辑标题</span>
	Artist <span class="hljs-type">string</span>  <span class="hljs-string">`json:"artist"`</span>               <span class="hljs-comment">// 艺术家</span>
	Price  <span class="hljs-type">float64</span> <span class="hljs-string">`json:"price"`</span>                <span class="hljs-comment">// 价格</span>
}

<span class="hljs-keyword">var</span> db *gorm.DB
<span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initDB</span><span class="hljs-params">()</span></span> {
	dsn := <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/music_store"</span>
	db, err = gorm.Open(mysql.Open(dsn), &amp;gorm.Config{}) <span class="hljs-comment">// 连接数据库</span>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Println(<span class="hljs-string">"连接数据库失败:"</span>, err)
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"连接数据库失败"</span>)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	initDB()                  <span class="hljs-comment">// 初始化数据库连接</span>
	router := gin.Default()   <span class="hljs-comment">// 创建 Gin 路由实例</span>

	<span class="hljs-comment">// 路由定义</span>
	router.GET(<span class="hljs-string">"/albums"</span>, getAlbums)        <span class="hljs-comment">// 获取所有专辑</span>
	router.GET(<span class="hljs-string">"/albums/:id"</span>, getAlbumByID) <span class="hljs-comment">// 根据 ID 获取专辑</span>
	router.POST(<span class="hljs-string">"/albums"</span>, postAlbum)       <span class="hljs-comment">// 创建新专辑</span>

	router.Run(<span class="hljs-string">"localhost:8080"</span>) <span class="hljs-comment">// 启动 HTTP 服务</span>
}

<span class="hljs-comment">// 获取所有专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAlbums</span><span class="hljs-params">(c *gin.Context)</span></span> {
	<span class="hljs-keyword">var</span> albums []Album
	db.Find(&amp;albums)                    <span class="hljs-comment">// 查询所有专辑</span>
	c.IndentedJSON(http.StatusOK, albums) <span class="hljs-comment">// 返回 JSON</span>
}

<span class="hljs-comment">// 根据 ID 获取专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAlbumByID</span><span class="hljs-params">(c *gin.Context)</span></span> {
	id := c.Param(<span class="hljs-string">"id"</span>)                 <span class="hljs-comment">// 获取 URL 参数</span>
	<span class="hljs-keyword">var</span> album Album
	db.First(&amp;album, <span class="hljs-string">"id = ?"</span>, id)      <span class="hljs-comment">// 查询指定 ID 的专辑</span>
	c.IndentedJSON(http.StatusOK, album) <span class="hljs-comment">// 返回 JSON</span>
}

<span class="hljs-comment">// 创建新专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">postAlbum</span><span class="hljs-params">(c *gin.Context)</span></span> {
	<span class="hljs-keyword">var</span> newAlbum Album
	c.BindJSON(&amp;newAlbum)               <span class="hljs-comment">// 解析请求 JSON</span>
	db.Create(&amp;newAlbum)                <span class="hljs-comment">// 插入数据库</span>
	c.IndentedJSON(http.StatusCreated, newAlbum) <span class="hljs-comment">// 返回创建结果</span>
}
</code></pre>
<h2 data-id="heading-2">测试 API</h2>
<p>启动服务后，可使用 <code>curl</code> 测试接口：</p>
<ol>
<li>获取所有专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/albums
</code></pre>
<ol start="2">
<li>获取单个专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/albums/2
</code></pre>
<ol start="3">
<li>新增专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl -X POST http://localhost:8080/albums \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-d <span class="hljs-string">'{"id":"4","title":"New Album","artist":"New Artist","price":29.99}'</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡]]></title>    <link>https://juejin.cn/post/7573988811916214322</link>    <guid>https://juejin.cn/post/7573988811916214322</guid>    <pubDate>2025-11-18T10:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573988811916214322" data-draft-id="7573710392213815323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡"/> <meta itemprop="keywords" content="C++,面试"/> <meta itemprop="datePublished" content="2025-11-18T10:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐怡旸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐怡旸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:15:14.000Z" title="Tue Nov 18 2025 10:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个条款揭示了C++函数返回语义的核心原则：当函数必须返回新对象时，应该直接返回值而非引用。试图返回局部对象的引用会导致悬空引用，而返回其他生命周期受控对象的引用则会带来接口复杂性和潜在错误。</p>
<hr/>
<h3 data-id="heading-0"><strong>思维导图：对象返回策略的完整体系</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b84346e6e9c148c0870ef9b038dfc2a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065714&amp;x-signature=YZGfs79PEmf3a6L3b%2FBug7tJolE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>关键洞见与行动指南</strong></h3>
<h4 data-id="heading-2"><strong>必须遵守的核心原则：</strong></h4>
<ol>
<li><strong>绝不返回局部对象的引用</strong>：局部对象在函数结束时销毁，返回其引用必然导致悬空引用</li>
<li><strong>优先直接返回对象</strong>：依赖编译器的RVO和移动语义优化，而非手动返回引用</li>
<li><strong>明确所有权语义</strong>：返回值意味着所有权转移，引用意味着共享访问</li>
<li><strong>信任编译器优化</strong>：现代编译器能高效处理对象返回，无需手动优化</li>
</ol>
<h4 data-id="heading-3"><strong>现代C++开发建议：</strong></h4>
<ol>
<li><strong>利用移动语义</strong>：为资源管理类实现移动操作，使返回大对象变得廉价</li>
<li><strong>使用智能指针</strong>：当需要返回动态分配对象时，使用智能指针明确所有权</li>
<li><strong>依赖RVO/NRVO</strong>：直接返回局部对象，让编译器处理优化</li>
<li><strong>避免过度工程</strong>：简单的返回值通常比复杂的引用返回更优</li>
</ol>
<h4 data-id="heading-4"><strong>设计原则总结：</strong></h4>
<ol>
<li><strong>语义正确性原则</strong>：接口行为应该清晰明确，不依赖隐晦的生命周期假设</li>
<li><strong>简单性原则</strong>：最简单的解决方案往往是最正确和最高效的</li>
<li><strong>零开销抽象原则</strong>：在不牺牲性能的前提下提供清晰的抽象</li>
<li><strong>最小惊讶原则</strong>：返回值的行为应该符合用户的合理预期</li>
</ol>
<h4 data-id="heading-5"><strong>需要警惕的陷阱：</strong></h4>
<ol>
<li><strong>悬空引用陷阱</strong>：返回局部stack对象的引用</li>
<li><strong>内存泄漏陷阱</strong>：返回堆对象引用导致无法正确释放</li>
<li><strong>线程安全陷阱</strong>：返回静态对象引用在多线程环境中的竞争</li>
<li><strong>封装破坏陷阱</strong>：返回成员变量引用破坏类的封装性</li>
</ol>
<p><strong>最终建议：</strong> 将对象返回视为语言设计者已经优化过的常见操作。培养"值语义思维"——在需要返回新对象时，直接返回对象值，让编译器的RVO、移动语义和拷贝省略为你工作。只有在确实需要共享现有对象且其生命周期明确受控时，才考虑返回引用。</p>
<p>记住：<strong>在C++中，返回对象值通常是安全、清晰且高效的。试图通过返回引用来优化往往适得其反，引入复杂性和错误。</strong> 条款21教会我们的不仅是一种技术选择，更是对C++对象模型和编译器能力的深刻信任。</p>
<hr/>
<h3 data-id="heading-6"><strong>深入解析：返回引用的致命陷阱</strong></h3>
<h4 data-id="heading-7"><strong>1. 问题根源：悬空引用的必然性</strong></h4>
<p><strong>返回局部对象引用的经典错误：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExpensiveResource</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-type">const</span> std::string&amp; name) : <span class="hljs-built_in">name_</span>(name) {
        data_.<span class="hljs-built_in">resize</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">42</span>);  <span class="hljs-comment">// 模拟昂贵资源</span>
        std::cout &lt;&lt; <span class="hljs-string">"构造 ExpensiveResource: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">ExpensiveResource</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构 ExpensiveResource: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-type">const</span> ExpensiveResource&amp; other) 
        : <span class="hljs-built_in">name_</span>(other.name_ + <span class="hljs-string">"(拷贝)"</span>), <span class="hljs-built_in">data_</span>(other.data_) {
        std::cout &lt;&lt; <span class="hljs-string">"拷贝构造: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">ExpensiveResource</span>(ExpensiveResource&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">name_</span>(std::<span class="hljs-built_in">move</span>(other.name_)), <span class="hljs-built_in">data_</span>(std::<span class="hljs-built_in">move</span>(other.data_)) {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用资源: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    std::string name_;
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
};

<span class="hljs-comment">// 错误示例1：返回局部对象的引用</span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ExpensiveResource <span class="hljs-title">local</span><span class="hljs-params">(<span class="hljs-string">"局部资源"</span>)</span></span>;
    <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 致命错误：返回局部对象的引用！</span>
}

<span class="hljs-comment">// 错误示例2：返回临时对象的引用  </span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong2</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"临时资源"</span>);  <span class="hljs-comment">// 更糟：返回临时对象的引用！</span>
}

<span class="hljs-comment">// 错误示例3：返回动态分配对象的引用</span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong3</span><span class="hljs-params">()</span> </span>{
    ExpensiveResource* resource = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"堆资源"</span>);
    <span class="hljs-keyword">return</span> *resource;  <span class="hljs-comment">// 内存泄漏！调用者不知道需要delete</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_dangling_references</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 演示悬空引用问题 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：局部对象引用</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. 返回局部对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref1 = <span class="hljs-built_in">createResourceWrong1</span>();
    <span class="hljs-comment">// 此时local已销毁，ref1是悬空引用！</span>
    <span class="hljs-comment">// ref1.use();  // 未定义行为！可能崩溃或输出乱码</span>
    
    <span class="hljs-comment">// 情况2：临时对象引用</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. 返回临时对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref2 = <span class="hljs-built_in">createResourceWrong2</span>();
    <span class="hljs-comment">// 临时对象立即销毁，ref2是悬空引用！</span>
    <span class="hljs-comment">// ref2.use();  // 未定义行为！</span>
    
    <span class="hljs-comment">// 情况3：堆对象引用泄漏</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 返回堆对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref3 = <span class="hljs-built_in">createResourceWrong3</span>();
    ref3.<span class="hljs-built_in">use</span>();  <span class="hljs-comment">// 虽然能工作，但内存泄漏！</span>
    <span class="hljs-comment">// 调用者不知道需要delete，也无法正确delete（没有原始指针）</span>
    <span class="hljs-comment">// delete &amp;ref3;  // 可能工作，但接口设计糟糕</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 悬空引用演示结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-8"><strong>2. 静态对象引用的线程安全问题</strong></h4>
<p><strong>返回静态对象引用的陷阱：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Configuration</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Configuration</span>(<span class="hljs-type">const</span> std::string&amp; name) : <span class="hljs-built_in">name_</span>(name) {
        std::cout &lt;&lt; <span class="hljs-string">"初始化配置: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        data_ = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用配置: "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (数据大小: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">()</span> </span>{
        data_.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 修改内部状态</span>
        std::cout &lt;&lt; <span class="hljs-string">"修改配置: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    std::string name_;
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
};

<span class="hljs-comment">// 危险的单例模式实现</span>
<span class="hljs-function"><span class="hljs-type">const</span> Configuration&amp; <span class="hljs-title">getGlobalConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-type">static</span> Configuration <span class="hljs-title">config</span><span class="hljs-params">(<span class="hljs-string">"全局配置"</span>)</span></span>;  <span class="hljs-comment">// 第一次调用时构造</span>
    <span class="hljs-keyword">return</span> config;
}

<span class="hljs-comment">// 线程安全的单例模式</span>
<span class="hljs-function">Configuration&amp; <span class="hljs-title">getThreadSafeConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-type">static</span> Configuration <span class="hljs-title">config</span><span class="hljs-params">(<span class="hljs-string">"线程安全配置"</span>)</span></span>;
    <span class="hljs-keyword">return</span> config;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_static_reference_issues</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 静态对象引用问题 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 单线程下看似正常工作</span>
    <span class="hljs-type">const</span> Configuration&amp; config1 = <span class="hljs-built_in">getGlobalConfig</span>();
    config1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-type">const</span> Configuration&amp; config2 = <span class="hljs-built_in">getGlobalConfig</span>();
    config2.<span class="hljs-built_in">use</span>();  <span class="hljs-comment">// 同一个对象</span>
    
    <span class="hljs-comment">// 多线程环境下的问题</span>
    <span class="hljs-keyword">auto</span> worker = [](<span class="hljs-type">int</span> id) {
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        Configuration&amp; config = <span class="hljs-built_in">getThreadSafeConfig</span>();  <span class="hljs-comment">// 注意：返回非const引用！</span>
        config.<span class="hljs-built_in">modify</span>();  <span class="hljs-comment">// 多个线程可能同时修改！</span>
        std::cout &lt;&lt; <span class="hljs-string">"线程 "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" 修改配置"</span> &lt;&lt; std::endl;
    };
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 多线程竞争演示 ==="</span> &lt;&lt; std::endl;
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(worker, <span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(worker, <span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">(worker, <span class="hljs-number">3</span>)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    t3.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-comment">// 数据竞争！未定义行为！</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>解决方案：正确返回对象</strong></h3>
<h4 data-id="heading-10"><strong>1. 直接返回对象值 + 编译器优化</strong></h4>
<p><strong>依赖RVO和移动语义的正确方式：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedReturn</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 正确方式1：返回匿名临时对象 - RVO优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"RVO优化"</span>);  <span class="hljs-comment">// 直接构造到调用者位置</span>
    }
    
    <span class="hljs-comment">// 正确方式2：返回具名局部对象 - NRVO优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithNRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">ExpensiveResource <span class="hljs-title">local</span><span class="hljs-params">(<span class="hljs-string">"NRVO优化"</span>)</span></span>;
        <span class="hljs-comment">// 一些处理...</span>
        local.<span class="hljs-built_in">use</span>();
        <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 编译器可能直接构造到调用者位置</span>
    }
    
    <span class="hljs-comment">// 正确方式3：多路径返回 - 仍然可能优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithMultiplePaths</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-number">1</span>) {
            <span class="hljs-function">ExpensiveResource <span class="hljs-title">resource</span><span class="hljs-params">(<span class="hljs-string">"类型1"</span>)</span></span>;
            <span class="hljs-keyword">return</span> resource;  <span class="hljs-comment">// NRVO可能仍然工作</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"类型2"</span>);  <span class="hljs-comment">// RVO</span>
        }
    }
    
    <span class="hljs-comment">// 正确方式4：返回移动语义优化的对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::vector&lt;std::string&gt; <span class="hljs-title">createStrings</span><span class="hljs-params">()</span> </span>{
        std::vector&lt;std::string&gt; strings;
        strings.<span class="hljs-built_in">reserve</span>(<span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i) {
            strings.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">"字符串_"</span> + std::<span class="hljs-built_in">to_string</span>(i));
        }
        
        <span class="hljs-keyword">return</span> strings;  <span class="hljs-comment">// 移动语义或NRVO</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_correct_object_return</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 正确返回对象演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：RVO优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. RVO优化返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource1 = OptimizedReturn::<span class="hljs-built_in">createWithRVO</span>();
    resource1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况2：NRVO优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. NRVO优化返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource2 = OptimizedReturn::<span class="hljs-built_in">createWithNRVO</span>();
    resource2.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况3：多路径返回</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 多路径返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource3 = OptimizedReturn::<span class="hljs-built_in">createWithMultiplePaths</span>(<span class="hljs-number">1</span>);
    resource3.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况4：移动语义优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"4. 移动语义优化:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> strings = OptimizedReturn::<span class="hljs-built_in">createStrings</span>();
    std::cout &lt;&lt; <span class="hljs-string">"创建字符串数量: "</span> &lt;&lt; strings.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 正确返回演示结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 测试编译器优化</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_compiler_optimizations</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"\n=== 编译器优化验证 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 观察构造/析构调用，验证优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"创建资源..."</span> &lt;&lt; std::endl;
    ExpensiveResource res = OptimizedReturn::<span class="hljs-built_in">createWithRVO</span>();
    std::cout &lt;&lt; <span class="hljs-string">"资源使用中..."</span> &lt;&lt; std::endl;
    res.<span class="hljs-built_in">use</span>();
    std::cout &lt;&lt; <span class="hljs-string">"资源即将销毁..."</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-11"><strong>2. 移动语义的革命性影响</strong></h4>
<p><strong>移动语义使返回大对象变得廉价：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MoveOptimized</span> {
<span class="hljs-keyword">private</span>:
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
    std::string name_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MoveOptimized</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">size_t</span> size) 
        : <span class="hljs-built_in">name_</span>(name), <span class="hljs-built_in">data_</span>(size, <span class="hljs-number">42</span>) {
        std::cout &lt;&lt; <span class="hljs-string">"构造 "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (大小: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 移动构造函数 - 关键！</span>
    <span class="hljs-built_in">MoveOptimized</span>(MoveOptimized&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">name_</span>(std::<span class="hljs-built_in">move</span>(other.name_))
        , <span class="hljs-built_in">data_</span>(std::<span class="hljs-built_in">move</span>(other.data_)) {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 移动赋值运算符</span>
    MoveOptimized&amp; <span class="hljs-keyword">operator</span>=(MoveOptimized&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            name_ = std::<span class="hljs-built_in">move</span>(other.name_);
            data_ = std::<span class="hljs-built_in">move</span>(other.data_);
            std::cout &lt;&lt; <span class="hljs-string">"移动赋值 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// 拷贝控制：禁止拷贝（或实现深拷贝）</span>
    <span class="hljs-built_in">MoveOptimized</span>(<span class="hljs-type">const</span> MoveOptimized&amp;) = <span class="hljs-keyword">delete</span>;
    MoveOptimized&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> MoveOptimized&amp;) = <span class="hljs-keyword">delete</span>;
    
    ~<span class="hljs-built_in">MoveOptimized</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用 "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (数据: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">" 元素)"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 工厂方法 - 高效返回</span>
    <span class="hljs-function"><span class="hljs-type">static</span> MoveOptimized <span class="hljs-title">createLargeObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; name)</span> </span>{
        <span class="hljs-function">MoveOptimized <span class="hljs-title">obj</span><span class="hljs-params">(name, <span class="hljs-number">1000000</span>)</span></span>;  <span class="hljs-comment">// 百万元素！</span>
        <span class="hljs-comment">// 一些处理...</span>
        <span class="hljs-keyword">return</span> obj;  <span class="hljs-comment">// NRVO或移动语义</span>
    }
    
    <span class="hljs-comment">// 返回处理后的对象</span>
    <span class="hljs-function">MoveOptimized <span class="hljs-title">process</span><span class="hljs-params">()</span> &amp;&amp; </span>{  <span class="hljs-comment">// 右值引用限定符</span>
        std::cout &lt;&lt; <span class="hljs-string">"处理右值对象: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        std::<span class="hljs-built_in">transform</span>(data_.<span class="hljs-built_in">begin</span>(), data_.<span class="hljs-built_in">end</span>(), data_.<span class="hljs-built_in">begin</span>(),
                      [](<span class="hljs-type">int</span> x) { <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; });
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(*<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// 显式移动</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_move_semantics</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 移动语义演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：移动构造优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. 工厂方法返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"大对象1"</span>);
    obj1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况2：链式移动操作</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. 链式处理:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj2 = MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"大对象2"</span>).<span class="hljs-built_in">process</span>();
    obj2.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况3：容器中的移动</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 容器存储:"</span> &lt;&lt; std::endl;
    std::vector&lt;MoveOptimized&gt; objects;
    objects.<span class="hljs-built_in">reserve</span>(<span class="hljs-number">3</span>);
    
    <span class="hljs-comment">// 使用emplace_back或移动插入</span>
    objects.<span class="hljs-built_in">push_back</span>(MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"容器对象1"</span>));
    objects.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-string">"容器对象2"</span>, <span class="hljs-number">500000</span>);  <span class="hljs-comment">// 原位构造</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"容器大小: "</span> &lt;&lt; objects.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 移动语义演示结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>智能指针的正确使用</strong></h3>
<h4 data-id="heading-13"><strong>1. 工厂模式与所有权转移</strong></h4>
<p><strong>明确所有权的智能指针返回：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphicBase</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">PolymorphicBase</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteA</span> : <span class="hljs-keyword">public</span> PolymorphicBase {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConcreteA</span>() { std::cout &lt;&lt; <span class="hljs-string">"构造 ConcreteA"</span> &lt;&lt; std::endl; }
    ~<span class="hljs-built_in">ConcreteA</span>() <span class="hljs-keyword">override</span> { std::cout &lt;&lt; <span class="hljs-string">"析构 ConcreteA"</span> &lt;&lt; std::endl; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ConcreteA::execute"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-function">std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;(*<span class="hljs-keyword">this</span>);
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteB</span> : <span class="hljs-keyword">public</span> PolymorphicBase {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ConcreteB</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> : value_(value) {</span>
        std::cout &lt;&lt; <span class="hljs-string">"构造 ConcreteB: "</span> &lt;&lt; value_ &lt;&lt; std::endl;
    }
    ~<span class="hljs-built_in">ConcreteB</span>() <span class="hljs-keyword">override</span> { std::cout &lt;&lt; <span class="hljs-string">"析构 ConcreteB"</span> &lt;&lt; std::endl; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ConcreteB::execute: "</span> &lt;&lt; value_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function">std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(*<span class="hljs-keyword">this</span>);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> value_;
};

<span class="hljs-comment">// 正确的工厂模式实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectFactory</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 返回unique_ptr - 明确所有权转移</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">createObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"A"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"B"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">42</span>);
        }
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"未知类型: "</span> + type);
    }
    
    <span class="hljs-comment">// 返回shared_ptr - 共享所有权</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::shared_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">createSharedObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"A"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;ConcreteA&gt;();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"B"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;ConcreteB&gt;(<span class="hljs-number">100</span>);
        }
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"未知类型: "</span> + type);
    }
    
    <span class="hljs-comment">// 返回unique_ptr的容器</span>
    <span class="hljs-type">static</span> std::vector&lt;std::unique_ptr&lt;PolymorphicBase&gt;&gt; <span class="hljs-built_in">createObjectCollection</span>() {
        std::vector&lt;std::unique_ptr&lt;PolymorphicBase&gt;&gt; objects;
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;());
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">1</span>));
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">2</span>));
        <span class="hljs-keyword">return</span> objects;  <span class="hljs-comment">// 移动语义！</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_smart_pointer_factory</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 智能指针工厂演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：unique_ptr工厂</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. unique_ptr工厂:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"A"</span>);
    obj1-&gt;<span class="hljs-built_in">execute</span>();
    
    <span class="hljs-keyword">auto</span> obj2 = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"B"</span>);
    obj2-&gt;<span class="hljs-built_in">execute</span>();
    
    <span class="hljs-comment">// 情况2：shared_ptr工厂</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. shared_ptr工厂:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> shared1 = ObjectFactory::<span class="hljs-built_in">createSharedObject</span>(<span class="hljs-string">"A"</span>);
    <span class="hljs-keyword">auto</span> shared2 = shared1;  <span class="hljs-comment">// 共享所有权</span>
    shared1-&gt;<span class="hljs-built_in">execute</span>();
    shared2-&gt;<span class="hljs-built_in">execute</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"共享引用计数: "</span> &lt;&lt; shared1.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况3：对象集合</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 对象集合:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> collection = ObjectFactory::<span class="hljs-built_in">createObjectCollection</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; obj : collection) {
        obj-&gt;<span class="hljs-built_in">execute</span>();
    }
    
    <span class="hljs-comment">// 情况4：克隆模式</span>
    std::cout &lt;&lt; <span class="hljs-string">"4. 克隆模式:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> original = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"A"</span>);
    <span class="hljs-keyword">auto</span> cloned = original-&gt;<span class="hljs-built_in">clone</span>();
    original-&gt;<span class="hljs-built_in">execute</span>();
    cloned-&gt;<span class="hljs-built_in">execute</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 智能指针工厂结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-14"><strong>2. 构建器模式的流畅接口</strong></h4>
<p><strong>返回*this引用的正确使用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>;  <span class="hljs-comment">// 前向声明</span>
    
    <span class="hljs-comment">// 只能通过Builder构造</span>
    <span class="hljs-function"><span class="hljs-type">static</span> Builder <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">Builder</span>(); }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"连接到: "</span> &lt;&lt; host_ &lt;&lt; <span class="hljs-string">":"</span> &lt;&lt; port_ 
                  &lt;&lt; <span class="hljs-string">" 用户: "</span> &lt;&lt; username_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">DatabaseConnection</span>() = <span class="hljs-keyword">default</span>;
    
    std::string host_;
    <span class="hljs-type">int</span> port_ = <span class="hljs-number">3306</span>;
    std::string username_;
    std::string password_;
    <span class="hljs-type">int</span> timeout_ = <span class="hljs-number">30</span>;
    
    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span>::Builder {
<span class="hljs-keyword">private</span>:
    std::unique_ptr&lt;DatabaseConnection&gt; connection_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Builder</span>() : <span class="hljs-built_in">connection_</span>(std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;()) {}
    
    <span class="hljs-comment">// 流畅接口 - 返回Builder&amp;引用</span>
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setHost</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; host)</span> </span>{
        connection_-&gt;host_ = host;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setPort</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> </span>{
        <span class="hljs-keyword">if</span> (port &lt;= <span class="hljs-number">0</span> || port &gt; <span class="hljs-number">65535</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"端口无效"</span>);
        }
        connection_-&gt;port_ = port;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setCredentials</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; username, <span class="hljs-type">const</span> std::string&amp; password)</span> </span>{
        connection_-&gt;username_ = username;
        connection_-&gt;password_ = password;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout)</span> </span>{
        <span class="hljs-keyword">if</span> (timeout &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"超时无效"</span>);
        }
        connection_-&gt;timeout_ = timeout;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// 关键：返回unique_ptr，明确所有权转移</span>
    <span class="hljs-function">std::unique_ptr&lt;DatabaseConnection&gt; <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 验证必填参数</span>
        <span class="hljs-keyword">if</span> (connection_-&gt;host_.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">"必须设置主机"</span>);
        }
        <span class="hljs-keyword">if</span> (connection_-&gt;username_.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">"必须设置用户名"</span>);
        }
        
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(connection_);  <span class="hljs-comment">// 转移所有权</span>
    }
    
    <span class="hljs-comment">// 返回shared_ptr的版本</span>
    <span class="hljs-function">std::shared_ptr&lt;DatabaseConnection&gt; <span class="hljs-title">buildShared</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(connection_);  <span class="hljs-comment">// 从unique_ptr转换</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_builder_pattern</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 构建器模式演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 流畅接口构建</span>
        <span class="hljs-keyword">auto</span> connection = DatabaseConnection::<span class="hljs-built_in">create</span>()
            .<span class="hljs-built_in">setHost</span>(<span class="hljs-string">"localhost"</span>)
            .<span class="hljs-built_in">setPort</span>(<span class="hljs-number">3306</span>)
            .<span class="hljs-built_in">setCredentials</span>(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"secret"</span>)
            .<span class="hljs-built_in">setTimeout</span>(<span class="hljs-number">60</span>)
            .<span class="hljs-built_in">build</span>();  <span class="hljs-comment">// 返回unique_ptr</span>
        
        connection-&gt;<span class="hljs-built_in">connect</span>();
        
        <span class="hljs-comment">// shared_ptr版本</span>
        <span class="hljs-keyword">auto</span> shared_connection = DatabaseConnection::<span class="hljs-built_in">create</span>()
            .<span class="hljs-built_in">setHost</span>(<span class="hljs-string">"127.0.0.1"</span>)
            .<span class="hljs-built_in">setPort</span>(<span class="hljs-number">5432</span>)
            .<span class="hljs-built_in">setCredentials</span>(<span class="hljs-string">"user"</span>, <span class="hljs-string">"pass"</span>)
            .<span class="hljs-built_in">buildShared</span>();
        
        shared_connection-&gt;<span class="hljs-built_in">connect</span>();
        
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"构建错误: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 构建器模式结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-15"><strong>编译器优化的信任与验证</strong></h3>
<h4 data-id="heading-16"><strong>1. RVO/NRVO的实际验证</strong></h4>
<p><strong>测试编译器优化能力：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizationTest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">OptimizationTest</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"默认构造"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">OptimizationTest</span>(<span class="hljs-type">const</span> OptimizationTest&amp; other) {
        std::cout &lt;&lt; <span class="hljs-string">"拷贝构造"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">OptimizationTest</span>(OptimizationTest&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造"</span> &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">OptimizationTest</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-comment">// 测试各种返回场景</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizationDemonstrator</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 场景1：RVO - 返回匿名临时对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">OptimizationTest</span>();  <span class="hljs-comment">// 应该只有一次构造</span>
    }
    
    <span class="hljs-comment">// 场景2：NRVO - 返回具名局部对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testNRVO</span><span class="hljs-params">()</span> </span>{
        OptimizationTest local;
        <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 应该只有一次构造</span>
    }
    
    <span class="hljs-comment">// 场景3：多路径返回</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testMultiplePaths</span><span class="hljs-params">(<span class="hljs-type">bool</span> flag)</span> </span>{
        <span class="hljs-keyword">if</span> (flag) {
            OptimizationTest local1;
            <span class="hljs-keyword">return</span> local1;  <span class="hljs-comment">// NRVO可能工作</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">OptimizationTest</span>();  <span class="hljs-comment">// RVO</span>
        }
    }
    
    <span class="hljs-comment">// 场景4：阻止NRVO - 使用std::move</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testBlockedNRVO</span><span class="hljs-params">()</span> </span>{
        OptimizationTest local;
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(local);  <span class="hljs-comment">// 阻止NRVO，强制移动构造</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_optimization_verification</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 编译器优化验证 ==="</span> &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"1. RVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = OptimizationDemonstrator::<span class="hljs-built_in">testRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"2. NRVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj2 = OptimizationDemonstrator::<span class="hljs-built_in">testNRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"3. 多路径测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj3 = OptimizationDemonstrator::<span class="hljs-built_in">testMultiplePaths</span>(<span class="hljs-literal">true</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"4. 阻止NRVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj4 = OptimizationDemonstrator::<span class="hljs-built_in">testBlockedNRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 优化验证结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 性能基准测试</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceTest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">createVectorByValue</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
        std::vector&lt;<span class="hljs-type">int</span>&gt; vec;
        vec.<span class="hljs-built_in">reserve</span>(size);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; size; ++i) {
            vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(i));
        }
        <span class="hljs-keyword">return</span> vec;  <span class="hljs-comment">// NRVO或移动语义</span>
    }
    
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">benchmark</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> size = <span class="hljs-number">1000000</span>;
        <span class="hljs-type">const</span> <span class="hljs-type">int</span> iterations = <span class="hljs-number">100</span>;
        
        std::cout &lt;&lt; <span class="hljs-string">"=== 性能基准测试 ==="</span> &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"向量大小: "</span> &lt;&lt; size &lt;&lt; <span class="hljs-string">", 迭代次数: "</span> &lt;&lt; iterations &lt;&lt; std::endl;
        
        <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            <span class="hljs-keyword">auto</span> vec = <span class="hljs-built_in">createVectorByValue</span>(size);
            <span class="hljs-comment">// 使用vec...</span>
            (<span class="hljs-type">void</span>)vec.<span class="hljs-built_in">size</span>();  <span class="hljs-comment">// 防止优化</span>
        }
        
        <span class="hljs-keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
        <span class="hljs-keyword">auto</span> duration = std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);
        
        std::cout &lt;&lt; <span class="hljs-string">"总耗时: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"平均每次: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() / <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(iterations) &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
    }
};
</code></pre>
<hr/>
<h3 data-id="heading-17"><strong>现代C++的最佳实践总结</strong></h3>
<p><strong>最终决策框架与示例：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModernBestPractices</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 规则1：小型对象直接返回值</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">calculateSum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> a + b;  <span class="hljs-comment">// 内置类型直接返回</span>
    }
    
    <span class="hljs-comment">// 规则2：标准库容器依赖移动语义</span>
    <span class="hljs-function">std::vector&lt;std::string&gt; <span class="hljs-title">getStrings</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>, <span class="hljs-string">"modern"</span>, <span class="hljs-string">"C++"</span>};  <span class="hljs-comment">// 移动语义优化</span>
    }
    
    <span class="hljs-comment">// 规则3：自定义大对象实现移动语义</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">LargeData</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">LargeData</span>() = <span class="hljs-keyword">default</span>;
        <span class="hljs-built_in">LargeData</span>(LargeData&amp;&amp;) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
        LargeData&amp; <span class="hljs-keyword">operator</span>=(LargeData&amp;&amp;) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
        
        <span class="hljs-comment">// 禁止拷贝（或实现深拷贝）</span>
        <span class="hljs-built_in">LargeData</span>(<span class="hljs-type">const</span> LargeData&amp;) = <span class="hljs-keyword">delete</span>;
        LargeData&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> LargeData&amp;) = <span class="hljs-keyword">delete</span>;
        
        <span class="hljs-function"><span class="hljs-type">static</span> LargeData <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{
            LargeData data;
            <span class="hljs-comment">// 初始化...</span>
            <span class="hljs-keyword">return</span> data;  <span class="hljs-comment">// NRVO或移动</span>
        }
    };
    
    <span class="hljs-comment">// 规则4：多态对象返回智能指针</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::unique_ptr&lt;ModernBestPractices&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ModernBestPractices&gt;(*<span class="hljs-keyword">this</span>);
    }
    
    <span class="hljs-comment">// 规则5：工厂方法返回unique_ptr</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::unique_ptr&lt;ModernBestPractices&gt; <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ModernBestPractices&gt;();
    }
    
    <span class="hljs-comment">// 规则6：构建器返回对象值或智能指针</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">public</span>:
            <span class="hljs-function">Builder&amp; <span class="hljs-title">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> </span>{ value_ = val; <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>; }
            
            <span class="hljs-function">Config <span class="hljs-title">build</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Config</span>(value_);  <span class="hljs-comment">// 返回值</span>
            }
            
            <span class="hljs-function">std::unique_ptr&lt;Config&gt; <span class="hljs-title">buildUnique</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
                <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;Config&gt;(value_);  <span class="hljs-comment">// 返回智能指针</span>
            }
            
        <span class="hljs-keyword">private</span>:
            <span class="hljs-type">int</span> value_ = <span class="hljs-number">0</span>;
        };
        
    <span class="hljs-keyword">private</span>:
        <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Config</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> : value_(value) {</span>}
        <span class="hljs-type">int</span> value_;
    };
};

<span class="hljs-comment">// 最终建议的实用模板</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectCreator</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 通用工厂方法</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> T <span class="hljs-title">create</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...);  <span class="hljs-comment">// 完美转发 + RVO</span>
    }
    
    <span class="hljs-comment">// 智能指针工厂</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> std::unique_ptr&lt;T&gt; <span class="hljs-title">createUnique</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;T&gt;(std::forward&lt;Args&gt;(args)...);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> std::shared_ptr&lt;T&gt; <span class="hljs-title">createShared</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(std::forward&lt;Args&gt;(args)...);
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_modern_best_practices</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 现代C++最佳实践 ==="</span> &lt;&lt; std::endl;
    
    ModernBestPractices practices;
    
    <span class="hljs-comment">// 1. 小型对象返回值</span>
    <span class="hljs-type">int</span> sum = practices.<span class="hljs-built_in">calculateSum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
    std::cout &lt;&lt; <span class="hljs-string">"和: "</span> &lt;&lt; sum &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 2. 容器移动语义</span>
    <span class="hljs-keyword">auto</span> strings = practices.<span class="hljs-built_in">getStrings</span>();
    std::cout &lt;&lt; <span class="hljs-string">"字符串数量: "</span> &lt;&lt; strings.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 3. 大对象移动语义</span>
    <span class="hljs-keyword">auto</span> largeData = ModernBestPractices::LargeData::<span class="hljs-built_in">create</span>();
    
    <span class="hljs-comment">// 4. 智能指针工厂</span>
    <span class="hljs-keyword">auto</span> obj = ModernBestPractices::<span class="hljs-built_in">create</span>();
    <span class="hljs-keyword">auto</span> cloned = obj-&gt;<span class="hljs-built_in">clone</span>();
    
    <span class="hljs-comment">// 5. 构建器模式</span>
    <span class="hljs-keyword">auto</span> config1 = ModernBestPractices::Config::<span class="hljs-built_in">Builder</span>().<span class="hljs-built_in">setValue</span>(<span class="hljs-number">42</span>).<span class="hljs-built_in">build</span>();
    <span class="hljs-keyword">auto</span> config2 = ModernBestPractices::Config::<span class="hljs-built_in">Builder</span>().<span class="hljs-built_in">setValue</span>(<span class="hljs-number">100</span>).<span class="hljs-built_in">buildUnique</span>();
    
    <span class="hljs-comment">// 6. 通用对象创建器</span>
    <span class="hljs-keyword">auto</span> created = ObjectCreator&lt;std::vector&lt;<span class="hljs-type">int</span>&gt;&gt;::<span class="hljs-built_in">create</span>(<span class="hljs-number">10</span>, <span class="hljs-number">42</span>);
    std::cout &lt;&lt; <span class="hljs-string">"创建的向量大小: "</span> &lt;&lt; created.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 最佳实践演示结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 最终的性能建议验证</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">final_performance_advice</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"\n=== 最终性能建议 ==="</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"1. 默认直接返回对象值"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"2. 为资源管理类实现移动语义"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"3. 多态对象使用智能指针工厂"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"4. 信任编译器的RVO/NRVO优化"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"5. 实际测量性能，而非猜测"</span> &lt;&lt; std::endl;
    
    PerformanceTest::<span class="hljs-built_in">benchmark</span>();
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">demonstrate_dangling_references</span>();
    <span class="hljs-built_in">demonstrate_static_reference_issues</span>();
    <span class="hljs-built_in">demonstrate_correct_object_return</span>();
    <span class="hljs-built_in">demonstrate_move_semantics</span>();
    <span class="hljs-built_in">demonstrate_smart_pointer_factory</span>();
    <span class="hljs-built_in">demonstrate_builder_pattern</span>();
    <span class="hljs-built_in">demonstrate_optimization_verification</span>();
    <span class="hljs-built_in">demonstrate_modern_best_practices</span>();
    <span class="hljs-built_in">final_performance_advice</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>通过以上全面分析，我们深刻理解了条款21的核心智慧：当必须返回新对象时，应该直接返回对象值，而非试图通过返回引用来优化。现代C++的编译器优化（RVO/NRVO）和语言特性（移动语义）已经使得对象返回变得高效，而试图手动优化往往引入复杂性和错误。正确的做法是信任语言设计者和编译器，编写语义清晰、正确性有保证的代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>